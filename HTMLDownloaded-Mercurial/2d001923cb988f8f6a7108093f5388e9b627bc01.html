<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20096:2d001923cb988f8f6a7108093f5388e9b627bc01</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2d001923cb988f8f6a7108093f5388e9b627bc01" />
<meta property="og:url" content="/comm-central/rev/2d001923cb988f8f6a7108093f5388e9b627bc01" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable indent rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2d001923cb988f8f6a7108093f5388e9b627bc01 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2d001923cb988f8f6a7108093f5388e9b627bc01">shortlog</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2d001923cb988f8f6a7108093f5388e9b627bc01">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01">files</a> |
changeset |
<a href="/comm-central/raw-rev/2d001923cb988f8f6a7108093f5388e9b627bc01">raw</a>  | <a href="/comm-central/archive/2d001923cb988f8f6a7108093f5388e9b627bc01.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable indent rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 09 Jul 2016 12:38:40 +0200</td></tr>

<tr>
 <td>changeset 20096</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2d001923cb988f8f6a7108093f5388e9b627bc01">2d001923cb988f8f6a7108093f5388e9b627bc01</a></td>
</tr>



<tr>
<td>parent 20095</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/880d5e4d567c33a4424cae66ac72fc523a663efd">880d5e4d567c33a4424cae66ac72fc523a663efd</a>
</td>
</tr>

<tr>
<td>child 20097</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/25a80188c50e5a1a4b9a142f8445930bfea18b7a">25a80188c50e5a1a4b9a142f8445930bfea18b7a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2d001923cb988f8f6a7108093f5388e9b627bc01">12312</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 17 Sep 2016 23:42:54 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2d001923cb98 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2d001923cb988f8f6a7108093f5388e9b627bc01">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2d001923cb988f8f6a7108093f5388e9b627bc01&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d001923cb988f8f6a7108093f5388e9b627bc01&newProject=comm-central&newRevision=311e2a727825d2b098d19ff265a9153f0eca1ebe&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d001923cb988f8f6a7108093f5388e9b627bc01&newProject=comm-central&newRevision=311e2a727825d2b098d19ff265a9153f0eca1ebe&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d001923cb988f8f6a7108093f5388e9b627bc01&newProject=comm-central&newRevision=311e2a727825d2b098d19ff265a9153f0eca1ebe&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable indent rule. r=MakeMyDay

MozReview-Commit-ID: CNVptKunJBx</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/backend/icaljs/calDateTime.js">calendar/base/backend/icaljs/calDateTime.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/backend/icaljs/calDateTime.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/backend/icaljs/calDateTime.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/backend/icaljs/calDateTime.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/backend/icaljs/calDateTime.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/backend/icaljs/calDateTime.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.xml">calendar/base/content/agenda-listbox.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/agenda-listbox.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-common-sets.js">calendar/base/content/calendar-common-sets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-common-sets.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-common-sets.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-common-sets.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-common-sets.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-common-sets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-daypicker.xml">calendar/base/content/calendar-daypicker.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-daypicker.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-daypicker.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-daypicker.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-daypicker.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-daypicker.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-item-bindings.xml">calendar/base/content/calendar-item-bindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-item-bindings.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-item-bindings.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-item-bindings.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-item-bindings.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-item-bindings.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-menus.xml">calendar/base/content/calendar-menus.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-menus.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-menus.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-menus.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-menus.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-menus.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-statusbar.js">calendar/base/content/calendar-statusbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-statusbar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-statusbar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-statusbar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-statusbar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-statusbar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.js">calendar/base/content/calendar-task-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.xml">calendar/base/content/calendar-views.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/calendar-views.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-invitations-list.xml">calendar/base/content/dialogs/calendar-invitations-list.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-invitations-list.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-invitations-list.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-invitations-list.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-invitations-list.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-invitations-list.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-properties-dialog.js">calendar/base/content/dialogs/calendar-properties-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-properties-dialog.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-properties-dialog.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-properties-dialog.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-properties-dialog.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-properties-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-summary-dialog.js">calendar/base/content/dialogs/calendar-summary-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-summary-dialog.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-summary-dialog.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-summary-dialog.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-summary-dialog.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/dialogs/calendar-summary-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/categories.js">calendar/base/content/preferences/categories.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/categories.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/categories.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/categories.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/categories.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/categories.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/editCategory.js">calendar/base/content/preferences/editCategory.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/editCategory.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/editCategory.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/editCategory.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/editCategory.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/preferences/editCategory.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-alarm-widget.xml">calendar/base/content/widgets/calendar-alarm-widget.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-alarm-widget.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-alarm-widget.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-alarm-widget.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-alarm-widget.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-alarm-widget.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-list-tree.xml">calendar/base/content/widgets/calendar-list-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-list-tree.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-list-tree.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-list-tree.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-subscriptions-list.xml">calendar/base/content/widgets/calendar-subscriptions-list.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-subscriptions-list.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-subscriptions-list.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-subscriptions-list.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-subscriptions-list.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-subscriptions-list.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-widgets.xml">calendar/base/content/widgets/calendar-widgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-widgets.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-widgets.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-widgets.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-widgets.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/calendar-widgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calExtract.jsm">calendar/base/modules/calExtract.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calExtract.jsm">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calExtract.jsm">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calExtract.jsm">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calExtract.jsm">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calExtract.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calHashedArray.jsm">calendar/base/modules/calHashedArray.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calHashedArray.jsm">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calHashedArray.jsm">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calHashedArray.jsm">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calHashedArray.jsm">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calHashedArray.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calRecurrenceUtils.jsm">calendar/base/modules/calRecurrenceUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calRecurrenceUtils.jsm">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calRecurrenceUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calRecurrenceUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calRecurrenceUtils.jsm">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calRecurrenceUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calApplicationUtils.js">calendar/base/src/calApplicationUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calApplicationUtils.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calApplicationUtils.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calApplicationUtils.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calApplicationUtils.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calApplicationUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calDeletedItems.js">calendar/base/src/calDeletedItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calDeletedItems.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calDeletedItems.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calDeletedItems.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calDeletedItems.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calDeletedItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calIcsSerializer.js">calendar/base/src/calIcsSerializer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calIcsSerializer.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calIcsSerializer.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calIcsSerializer.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calIcsSerializer.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calIcsSerializer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItipItem.js">calendar/base/src/calItipItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItipItem.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItipItem.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItipItem.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItipItem.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calItipItem.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calProtocolHandler.js">calendar/base/src/calProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/components/calItipProtocolHandler.js">calendar/lightning/components/calItipProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/components/calItipProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/components/calItipProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/components/calItipProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/components/calItipProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/components/calItipProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/html-item-editing/react-code.js">calendar/lightning/content/html-item-editing/react-code.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/html-item-editing/react-code.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/html-item-editing/react-code.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/html-item-editing/react-code.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/html-item-editing/react-code.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/html-item-editing/react-code.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/imip-bar.js">calendar/lightning/content/imip-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/imip-bar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/imip-bar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/imip-bar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/imip-bar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/imip-bar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/messenger-overlay-sidebar.js">calendar/lightning/content/messenger-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/messenger-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/messenger-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/messenger-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/messenger-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/messenger-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/suite-overlay-sidebar.js">calendar/lightning/content/suite-overlay-sidebar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/suite-overlay-sidebar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/suite-overlay-sidebar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/suite-overlay-sidebar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/suite-overlay-sidebar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/lightning/content/suite-overlay-sidebar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/composite/calCompositeCalendar.js">calendar/providers/composite/calCompositeCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/composite/calCompositeCalendar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/composite/calCompositeCalendar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/composite/calCompositeCalendar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/composite/calCompositeCalendar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/composite/calCompositeCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/gdata/content/gdata-list-tree.xml">calendar/providers/gdata/content/gdata-list-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/gdata/content/gdata-list-tree.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/gdata/content/gdata-list-tree.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/gdata/content/gdata-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/gdata/content/gdata-list-tree.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/gdata/content/gdata-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapErrors.js">calendar/providers/wcap/calWcapErrors.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapErrors.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapErrors.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapErrors.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapErrors.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapErrors.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/calendarCreation.js">calendar/resources/content/calendarCreation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/calendarCreation.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/calendarCreation.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/calendarCreation.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/calendarCreation.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/calendarCreation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/mouseoverPreviews.js">calendar/resources/content/mouseoverPreviews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/mouseoverPreviews.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/mouseoverPreviews.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/mouseoverPreviews.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/mouseoverPreviews.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/mouseoverPreviews.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publishDialog.js">calendar/resources/content/publishDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publishDialog.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publishDialog.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publishDialog.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publishDialog.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/resources/content/publishDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialog.js">calendar/test/mozmill/eventDialog/testEventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialog.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialog.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialog.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialog.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testUTF8.js">calendar/test/mozmill/eventDialog/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testUTF8.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testUTF8.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/eventDialog/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">calendar/test/mozmill/recurrence/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testDailyRecurrence.js">calendar/test/mozmill/recurrence/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/calendar-utils.js">calendar/test/mozmill/shared-modules/calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/calendar-utils.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/calendar-utils.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/timezone-utils.js">calendar/test/mozmill/shared-modules/timezone-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/timezone-utils.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/timezone-utils.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/timezone-utils.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/timezone-utils.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/shared-modules/timezone-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testAlarmDefaultValue.js">calendar/test/mozmill/testAlarmDefaultValue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testAlarmDefaultValue.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testAlarmDefaultValue.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testAlarmDefaultValue.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testAlarmDefaultValue.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testAlarmDefaultValue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testBasicFunctionality.js">calendar/test/mozmill/testBasicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testBasicFunctionality.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testBasicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testBasicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testBasicFunctionality.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testBasicFunctionality.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testLocalICS.js">calendar/test/mozmill/testLocalICS.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testLocalICS.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testLocalICS.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testLocalICS.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testLocalICS.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testLocalICS.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testTodayPane.js">calendar/test/mozmill/testTodayPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testTodayPane.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testTodayPane.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testTodayPane.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testTodayPane.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/testTodayPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test1.js">calendar/test/mozmill/timezoneTests/test1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test1.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test1.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test1.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test1.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test10.js">calendar/test/mozmill/timezoneTests/test10.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test10.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test10.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test10.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test10.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test10.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test2.js">calendar/test/mozmill/timezoneTests/test2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test2.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test2.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test2.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test2.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test3.js">calendar/test/mozmill/timezoneTests/test3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test3.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test3.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test3.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test3.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test3.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test4.js">calendar/test/mozmill/timezoneTests/test4.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test4.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test4.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test4.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test4.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test4.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test5.js">calendar/test/mozmill/timezoneTests/test5.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test5.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test5.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test5.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test5.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test5.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test6.js">calendar/test/mozmill/timezoneTests/test6.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test6.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test6.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test6.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test6.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test6.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test7.js">calendar/test/mozmill/timezoneTests/test7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test7.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test7.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test7.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test7.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test7.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test8.js">calendar/test/mozmill/timezoneTests/test8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test8.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test8.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test8.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test8.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test8.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test9.js">calendar/test/mozmill/timezoneTests/test9.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test9.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test9.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test9.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test9.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/timezoneTests/test9.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testDayView.js">calendar/test/mozmill/views/testDayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testDayView.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testDayView.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testDayView.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testDayView.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testDayView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMonthView.js">calendar/test/mozmill/views/testMonthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMonthView.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMonthView.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMonthView.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMonthView.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMonthView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMultiweekView.js">calendar/test/mozmill/views/testMultiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMultiweekView.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMultiweekView.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMultiweekView.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMultiweekView.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testMultiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testTaskView.js">calendar/test/mozmill/views/testTaskView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testTaskView.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testTaskView.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testTaskView.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testTaskView.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testTaskView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testWeekView.js">calendar/test/mozmill/views/testWeekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testWeekView.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testWeekView.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testWeekView.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testWeekView.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/mozmill/views/testWeekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmservice.js">calendar/test/unit/test_alarmservice.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmservice.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmservice.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmservice.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmservice.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmservice.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmutils.js">calendar/test/unit/test_alarmutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmutils.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmutils.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmutils.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmutils.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_alarmutils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_attendee.js">calendar/test/unit/test_attendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_attendee.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_attendee.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_attendee.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_attendee.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_attendee.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_bug350845.js">calendar/test/unit/test_bug350845.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_bug350845.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_bug350845.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_bug350845.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_bug350845.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_bug350845.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_calmgr.js">calendar/test/unit/test_calmgr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_calmgr.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_calmgr.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_calmgr.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_calmgr.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_calmgr.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_freebusy_service.js">calendar/test/unit/test_freebusy_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_freebusy_service.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_freebusy_service.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_freebusy_service.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_freebusy_service.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_freebusy_service.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics.js">calendar/test/unit/test_ics.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics_service.js">calendar/test/unit/test_ics_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics_service.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics_service.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics_service.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics_service.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_ics_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_providers.js">calendar/test/unit/test_providers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_providers.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_providers.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_providers.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_providers.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_providers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_webcal.js">calendar/test/unit/test_webcal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_webcal.js">file</a> |
<a href="/comm-central/annotate/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_webcal.js">annotate</a> |
<a href="/comm-central/diff/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_webcal.js">diff</a> |
<a href="/comm-central/comparison/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_webcal.js">comparison</a> |
<a href="/comm-central/log/2d001923cb988f8f6a7108093f5388e9b627bc01/calendar/test/unit/test_webcal.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -457,13 +457,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">         /* mail/calendar words */ &quot;to&quot;, &quot;cc&quot;,</span>
<a href="#l1.5"></a><span id="l1.5">         /* Components */ &quot;Ci&quot;, &quot;Cc&quot;, &quot;Cu&quot;, &quot;Cr&quot;,</span>
<a href="#l1.6"></a><span id="l1.6">       ]</span>
<a href="#l1.7"></a><span id="l1.7">     }],</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     // Disallow lexical declarations in case/default clauses</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;no-case-declarations&quot;: 2,</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Enforce consistent indentation (4-space)</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;indent&quot;: [2, 4, { &quot;SwitchCase&quot;: 1 }],</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.16"></a><span id="l1.16">     // easier updates in the future.</span>
<a href="#l1.17"></a><span id="l1.17">     &quot;no-else-return&quot;: 0,</span>
<a href="#l1.18"></a><span id="l1.18">   }</span>
<a href="#l1.19"></a><span id="l1.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calDateTime.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calDateTime.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -122,15 +122,15 @@ calDateTime.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">     get endOfMonth() { return new calDateTime(this.innerObject.endOfMonth()); },</span>
<a href="#l2.5"></a><span id="l2.5">     get startOfYear() { return new calDateTime(this.innerObject.startOfYear()); },</span>
<a href="#l2.6"></a><span id="l2.6">     get endOfYear() { return new calDateTime(this.innerObject.endOfYear()); },</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">     get icalString() { return this.innerObject.toICALString(); },</span>
<a href="#l2.9"></a><span id="l2.9">     set icalString(val) {</span>
<a href="#l2.10"></a><span id="l2.10">         let jcalString;</span>
<a href="#l2.11"></a><span id="l2.11">         if (val.length &gt; 10) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-           jcalString = ICAL.design.icalendar.value[&quot;date-time&quot;].fromICAL(val);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+            jcalString = ICAL.design.icalendar.value[&quot;date-time&quot;].fromICAL(val);</span>
<a href="#l2.14"></a><span id="l2.14">         } else {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-           jcalString = ICAL.design.icalendar.value.date.fromICAL(val);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+            jcalString = ICAL.design.icalendar.value.date.fromICAL(val);</span>
<a href="#l2.17"></a><span id="l2.17">         }</span>
<a href="#l2.18"></a><span id="l2.18">         this.innerObject = ICAL.Time.fromString(jcalString);</span>
<a href="#l2.19"></a><span id="l2.19">     }</span>
<a href="#l2.20"></a><span id="l2.20"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -700,17 +700,17 @@ agendaListbox.setupCalendar = function()</span>
<a href="#l3.4"></a><span id="l3.4">  * Usually called at midnight to update the agenda pane. Also retrieves the</span>
<a href="#l3.5"></a><span id="l3.5">  * items from the calendar.</span>
<a href="#l3.6"></a><span id="l3.6">  *</span>
<a href="#l3.7"></a><span id="l3.7">  * @see #refreshCalendarQuery</span>
<a href="#l3.8"></a><span id="l3.8">  * @param newDate       The first date to show if the agenda pane doesn't show</span>
<a href="#l3.9"></a><span id="l3.9">  *                        today.</span>
<a href="#l3.10"></a><span id="l3.10">  */</span>
<a href="#l3.11"></a><span id="l3.11"> agendaListbox.refreshPeriodDates = function(newDate) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-     this.kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    this.kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l3.14"></a><span id="l3.14">     // Today: now until midnight of tonight</span>
<a href="#l3.15"></a><span id="l3.15">     let oldshowstoday = this.showstoday;</span>
<a href="#l3.16"></a><span id="l3.16">     this.showstoday = this.showsToday(newDate);</span>
<a href="#l3.17"></a><span id="l3.17">     if ((this.showstoday) &amp;&amp; (!oldshowstoday)) {</span>
<a href="#l3.18"></a><span id="l3.18">         this.addPeriodListItem(this.tomorrow, &quot;tomorrow-header&quot;);</span>
<a href="#l3.19"></a><span id="l3.19">         this.addPeriodListItem(this.soon, &quot;nextweek-header&quot;);</span>
<a href="#l3.20"></a><span id="l3.20">     } else if (!this.showstoday) {</span>
<a href="#l3.21"></a><span id="l3.21">         this.removePeriodListItem(this.tomorrow);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -910,17 +910,17 @@ agendaListbox.calendarObserver.onDeleteI</span>
<a href="#l3.23"></a><span id="l3.23">     this.onLocalDeleteItem(item, true);</span>
<a href="#l3.24"></a><span id="l3.24"> };</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26"> agendaListbox.calendarObserver.onLocalDeleteItem = function(item, moveSelection) {</span>
<a href="#l3.27"></a><span id="l3.27">     if (!isEvent(item)) {</span>
<a href="#l3.28"></a><span id="l3.28">         return false;</span>
<a href="#l3.29"></a><span id="l3.29">     }</span>
<a href="#l3.30"></a><span id="l3.30">     let selectedItemHashId = -1;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-// get all sub items if it is a recurring item</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    // get all sub items if it is a recurring item</span>
<a href="#l3.33"></a><span id="l3.33">     let occs = this.getOccurrencesBetween(item);</span>
<a href="#l3.34"></a><span id="l3.34">     for (let i = 0; i &lt; occs.length; i++) {</span>
<a href="#l3.35"></a><span id="l3.35">         let isSelected = this.agendaListbox.deleteItem(occs[i], moveSelection);</span>
<a href="#l3.36"></a><span id="l3.36">         if (isSelected) {</span>
<a href="#l3.37"></a><span id="l3.37">             selectedItemHashId = occs[i].hashId;</span>
<a href="#l3.38"></a><span id="l3.38">         }</span>
<a href="#l3.39"></a><span id="l3.39">     }</span>
<a href="#l3.40"></a><span id="l3.40">     return selectedItemHashId;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -1028,17 +1028,17 @@ function setCurrentEvent() {</span>
<a href="#l3.42"></a><span id="l3.42">                                           .getInTimezone(agendaListbox.kDefaultTimezone)</span>
<a href="#l3.43"></a><span id="l3.43">                                           .subtractDate(anow).inSeconds;</span>
<a href="#l3.44"></a><span id="l3.44">                 if (msuntillend &gt; 0) {</span>
<a href="#l3.45"></a><span id="l3.45">                     complistItem.setAttribute(&quot;current&quot;, &quot;true&quot;);</span>
<a href="#l3.46"></a><span id="l3.46">                     if (msuntillend &lt; msScheduleTime || msScheduleTime == -1) {</span>
<a href="#l3.47"></a><span id="l3.47">                         msScheduleTime = msuntillend;</span>
<a href="#l3.48"></a><span id="l3.48">                     }</span>
<a href="#l3.49"></a><span id="l3.49">                 } else {</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-                     removelist.push(complistItem);</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+                    removelist.push(complistItem);</span>
<a href="#l3.52"></a><span id="l3.52">                 }</span>
<a href="#l3.53"></a><span id="l3.53">             } else {</span>
<a href="#l3.54"></a><span id="l3.54">                 complistItem.removeAttribute(&quot;current&quot;);</span>
<a href="#l3.55"></a><span id="l3.55">             }</span>
<a href="#l3.56"></a><span id="l3.56">             if (msScheduleTime == -1 || msuntillstart &lt; msScheduleTime) {</span>
<a href="#l3.57"></a><span id="l3.57">                 if (msuntillstart &gt; 0) {</span>
<a href="#l3.58"></a><span id="l3.58">                     msScheduleTime = msuntillstart;</span>
<a href="#l3.59"></a><span id="l3.59">                 }</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineat">@@ -1049,21 +1049,21 @@ function setCurrentEvent() {</span>
<a href="#l3.61"></a><span id="l3.61">         }</span>
<a href="#l3.62"></a><span id="l3.62">     } while (!leaveloop);</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64">     if (msScheduleTime &gt; -1) {</span>
<a href="#l3.65"></a><span id="l3.65">         scheduleNextCurrentEventUpdate(setCurrentEvent, msScheduleTime * 1000);</span>
<a href="#l3.66"></a><span id="l3.66">     }</span>
<a href="#l3.67"></a><span id="l3.67"> </span>
<a href="#l3.68"></a><span id="l3.68">     if (removelist) {</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-      if (removelist.length &gt; 0) {</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-          for (let i = 0; i &lt; removelist.length; i++) {</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-              removelist[i].remove();</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-          }</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-      }</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+        if (removelist.length &gt; 0) {</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+            for (let i = 0; i &lt; removelist.length; i++) {</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+                removelist[i].remove();</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+            }</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+        }</span>
<a href="#l3.79"></a><span id="l3.79">     }</span>
<a href="#l3.80"></a><span id="l3.80"> }</span>
<a href="#l3.81"></a><span id="l3.81"> </span>
<a href="#l3.82"></a><span id="l3.82"> var gEventTimer;</span>
<a href="#l3.83"></a><span id="l3.83"> </span>
<a href="#l3.84"></a><span id="l3.84"> /**</span>
<a href="#l3.85"></a><span id="l3.85">  * Creates a timer that will fire after the next event is current.</span>
<a href="#l3.86"></a><span id="l3.86">  *  Pass in a function as aRefreshCallback that should be called at that time.</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineat">@@ -1083,21 +1083,21 @@ function scheduleNextCurrentEventUpdate(</span>
<a href="#l3.88"></a><span id="l3.88">         }</span>
<a href="#l3.89"></a><span id="l3.89">     };</span>
<a href="#l3.90"></a><span id="l3.90"> </span>
<a href="#l3.91"></a><span id="l3.91">     if (gEventTimer) {</span>
<a href="#l3.92"></a><span id="l3.92">         gEventTimer.cancel();</span>
<a href="#l3.93"></a><span id="l3.93">     } else {</span>
<a href="#l3.94"></a><span id="l3.94">         // Observer for wake after sleep/hibernate/standby to create new timers and refresh UI</span>
<a href="#l3.95"></a><span id="l3.95">         let wakeObserver = {</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-           observe: function(aSubject, aTopic, aData) {</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-               if (aTopic == &quot;wake_notification&quot;) {</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-                   aRefreshCallback();</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-               }</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-           }</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+            observe: function(aSubject, aTopic, aData) {</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+                if (aTopic == &quot;wake_notification&quot;) {</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+                    aRefreshCallback();</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+                }</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+            }</span>
<a href="#l3.106"></a><span id="l3.106">         };</span>
<a href="#l3.107"></a><span id="l3.107">         // Add observer</span>
<a href="#l3.108"></a><span id="l3.108">         Services.obs.addObserver(wakeObserver, &quot;wake_notification&quot;, false);</span>
<a href="#l3.109"></a><span id="l3.109"> </span>
<a href="#l3.110"></a><span id="l3.110">         // Remove observer on unload</span>
<a href="#l3.111"></a><span id="l3.111">         window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l3.112"></a><span id="l3.112">             Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l3.113"></a><span id="l3.113">         }, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,29 +1,29 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.7"></a><span id="l4.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.8"></a><span id="l4.8">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> &lt;bindings id=&quot;agenda-list-bindings&quot;</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">- xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">- xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18">   &lt;binding id=&quot;agenda-base-richlist-item&quot;</span>
<a href="#l4.19"></a><span id="l4.19">            extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20">     &lt;implementation&gt;</span>
<a href="#l4.21"></a><span id="l4.21">       &lt;field name=&quot;mOccurrence&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l4.22"></a><span id="l4.22">       &lt;property name=&quot;occurrence&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l4.23"></a><span id="l4.23">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.24"></a><span id="l4.24">           return this.mOccurrence;</span>
<a href="#l4.25"></a><span id="l4.25">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.26"></a><span id="l4.26">       &lt;/property&gt;</span>
<a href="#l4.27"></a><span id="l4.27">     &lt;/implementation&gt;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+</span>
<a href="#l4.29"></a><span id="l4.29">     &lt;handlers&gt;</span>
<a href="#l4.30"></a><span id="l4.30">       &lt;handler event=&quot;click&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.31"></a><span id="l4.31">         if (event.detail == 1) {</span>
<a href="#l4.32"></a><span id="l4.32">             agendaListbox.onSelect(this);</span>
<a href="#l4.33"></a><span id="l4.33">         } else if (event.button == 0) {</span>
<a href="#l4.34"></a><span id="l4.34">             // We only care about button 0 doubleclick events</span>
<a href="#l4.35"></a><span id="l4.35">             document.getElementById(&quot;agenda_edit_event_command&quot;).doCommand();</span>
<a href="#l4.36"></a><span id="l4.36">             event.stopPropagation();</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineat">@@ -42,49 +42,51 @@</span>
<a href="#l4.38"></a><span id="l4.38">     &lt;content&gt;</span>
<a href="#l4.39"></a><span id="l4.39">       &lt;xul:treenode-checkbox class=&quot;agenda-checkbox&quot; anonid=&quot;agenda-checkbox-widget&quot;</span>
<a href="#l4.40"></a><span id="l4.40">                                                    flex=&quot;1&quot;</span>
<a href="#l4.41"></a><span id="l4.41">                                                    xbl:inherits=&quot;selected,label,hidden,disabled&quot;/&gt;</span>
<a href="#l4.42"></a><span id="l4.42">     &lt;/content&gt;</span>
<a href="#l4.43"></a><span id="l4.43">     &lt;implementation&gt;</span>
<a href="#l4.44"></a><span id="l4.44">       &lt;field name=&quot;kCheckbox&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l4.45"></a><span id="l4.45">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-          this.kCheckbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-checkbox-widget&quot;);</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+        this.kCheckbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-checkbox-widget&quot;);</span>
<a href="#l4.48"></a><span id="l4.48">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.49"></a><span id="l4.49"> </span>
<a href="#l4.50"></a><span id="l4.50">       &lt;method name=&quot;getItem&quot;&gt;</span>
<a href="#l4.51"></a><span id="l4.51">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-            return this.mItem;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+          return this.mItem;</span>
<a href="#l4.54"></a><span id="l4.54">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.55"></a><span id="l4.55">       &lt;/method&gt;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+</span>
<a href="#l4.57"></a><span id="l4.57">       &lt;method name=&quot;setItem&quot;&gt;</span>
<a href="#l4.58"></a><span id="l4.58">         &lt;parameter name=&quot;synthetic&quot;/&gt;</span>
<a href="#l4.59"></a><span id="l4.59">         &lt;parameter name=&quot;showsToday&quot;/&gt;</span>
<a href="#l4.60"></a><span id="l4.60">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-            this.mItem = synthetic;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-            let duration = synthetic.duration;</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-            if (showsToday) {</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-                this.kCheckbox.label = this.getAttribute(&quot;title&quot;);</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-                if (this.id == &quot;nextweek-header&quot;) {</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-                    if (duration &gt; 7) {</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-                        this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration / 7, &quot;weeks&quot;) + &quot;)&quot;;</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-                    } else {</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-                        this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration, &quot;days&quot;) + &quot;)&quot;;</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-                    }</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-                }</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-            } else if (synthetic.duration == 1) {</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-                this.kCheckbox.label = getDateFormatter().formatDate(synthetic.start);</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-            } else {</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-                this.kCheckbox.label = getDateFormatter().formatInterval(synthetic.start, synthetic.end);</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-            }</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+          this.mItem = synthetic;</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+          let duration = synthetic.duration;</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+          if (showsToday) {</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+              this.kCheckbox.label = this.getAttribute(&quot;title&quot;);</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+              if (this.id == &quot;nextweek-header&quot;) {</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+                  if (duration &gt; 7) {</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+                      this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration / 7, &quot;weeks&quot;) + &quot;)&quot;;</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+                  } else {</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+                      this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration, &quot;days&quot;) + &quot;)&quot;;</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+                  }</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+              }</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+          } else if (synthetic.duration == 1) {</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+              this.kCheckbox.label = getDateFormatter().formatDate(synthetic.start);</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+          } else {</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+              this.kCheckbox.label = getDateFormatter().formatInterval(synthetic.start, synthetic.end);</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+          }</span>
<a href="#l4.93"></a><span id="l4.93">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.94"></a><span id="l4.94">       &lt;/method&gt;</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineplus">+</span>
<a href="#l4.96"></a><span id="l4.96">       &lt;method name=&quot;getCheckbox&quot;&gt;</span>
<a href="#l4.97"></a><span id="l4.97">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-            return this.kCheckbox;</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+          return this.kCheckbox;</span>
<a href="#l4.100"></a><span id="l4.100">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.101"></a><span id="l4.101">       &lt;/method&gt;</span>
<a href="#l4.102"></a><span id="l4.102">     &lt;/implementation&gt;</span>
<a href="#l4.103"></a><span id="l4.103">   &lt;/binding&gt;</span>
<a href="#l4.104"></a><span id="l4.104"> </span>
<a href="#l4.105"></a><span id="l4.105">   &lt;binding id=&quot;agenda-allday-richlist-item&quot;</span>
<a href="#l4.106"></a><span id="l4.106">            extends=&quot;chrome://calendar/content/agenda-listbox.xml#agenda-base-richlist-item&quot;&gt;</span>
<a href="#l4.107"></a><span id="l4.107">     &lt;content tooltip=&quot;itemTooltip&quot;&gt;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineat">@@ -101,71 +103,74 @@</span>
<a href="#l4.109"></a><span id="l4.109">                                              flex=&quot;1&quot;</span>
<a href="#l4.110"></a><span id="l4.110">                                              flat=&quot;true&quot;/&gt;</span>
<a href="#l4.111"></a><span id="l4.111">           &lt;/xul:hbox&gt;</span>
<a href="#l4.112"></a><span id="l4.112">         &lt;/xul:vbox&gt;</span>
<a href="#l4.113"></a><span id="l4.113">       &lt;/xul:hbox&gt;</span>
<a href="#l4.114"></a><span id="l4.114">     &lt;/content&gt;</span>
<a href="#l4.115"></a><span id="l4.115">     &lt;implementation&gt;</span>
<a href="#l4.116"></a><span id="l4.116">       &lt;field name=&quot;mAllDayItem&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+</span>
<a href="#l4.118"></a><span id="l4.118">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-          this.mAllDayItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;allday-item&quot;);</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+        this.mAllDayItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;allday-item&quot;);</span>
<a href="#l4.121"></a><span id="l4.121">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+</span>
<a href="#l4.123"></a><span id="l4.123">       &lt;method name=&quot;setOccurrence&quot;&gt;</span>
<a href="#l4.124"></a><span id="l4.124">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l4.125"></a><span id="l4.125">         &lt;parameter name=&quot;aPeriod&quot;/&gt;</span>
<a href="#l4.126"></a><span id="l4.126">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-            this.mOccurrence = aOccurrence;</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-            this.mAllDayItem.occurrence = aOccurrence;</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-            let dateFormatter = cal.getDateFormatter();</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-            let periodStartDate = aPeriod.start.clone();</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-            periodStartDate.isDate = true;</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-            let periodEndDate = aPeriod.end;</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-            let startDate = this.mOccurrence[calGetStartDateProp(this.mOccurrence)]</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-                                .getInTimezone(calendarDefaultTimezone());</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-            let endDate = this.mOccurrence[calGetEndDateProp(this.mOccurrence)]</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+          this.mOccurrence = aOccurrence;</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+          this.mAllDayItem.occurrence = aOccurrence;</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+          let dateFormatter = cal.getDateFormatter();</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+          let periodStartDate = aPeriod.start.clone();</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+          periodStartDate.isDate = true;</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineplus">+          let periodEndDate = aPeriod.end;</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineplus">+          let startDate = this.mOccurrence[calGetStartDateProp(this.mOccurrence)]</span>
<a href="#l4.143"></a><span id="l4.143">                               .getInTimezone(calendarDefaultTimezone());</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-            let endPreviousDay = endDate.clone();</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-            endPreviousDay.day--;</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-            // Show items's date for long periods but also for &quot;Upcoming&quot;</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-            // period with one day duration.</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-            let showDate = aPeriod.multiday || aPeriod.duration &gt; 1;</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+          let endDate = this.mOccurrence[calGetEndDateProp(this.mOccurrence)]</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineplus">+                            .getInTimezone(calendarDefaultTimezone());</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineplus">+          let endPreviousDay = endDate.clone();</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineplus">+          endPreviousDay.day--;</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineplus">+          // Show items's date for long periods but also for &quot;Upcoming&quot;</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineplus">+          // period with one day duration.</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineplus">+          let showDate = aPeriod.multiday || aPeriod.duration &gt; 1;</span>
<a href="#l4.156"></a><span id="l4.156"> </span>
<a href="#l4.157"></a><span id="l4.157" class="difflineminus">-            let date = &quot;&quot;;</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineminus">-            let iconType = &quot;&quot;;</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineminus">-            let allDayDateLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-allDayEvent-date&quot;);</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineminus">-            setBooleanAttribute(allDayDateLabel, &quot;hidden&quot;, !showDate);</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineminus">-            if (startDate.compare(endPreviousDay) == 0) {</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineminus">-                // All day event one day duration.</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineminus">-                date = dateFormatter.formatDate(startDate);</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineminus">-            } else if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineminus">-                 startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineminus">-                // All day event spanning multiple days.</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineminus">-                iconType = &quot;start&quot;;</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineminus">-                date = dateFormatter.formatDate(startDate);</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineminus">-            } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineminus">-                       endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineminus">-                iconType = &quot;end&quot;;</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineminus">-                date = dateFormatter.formatDate(endPreviousDay);</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineminus">-            } else {</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-                iconType = &quot;continue&quot;;</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineminus">-                hideElement(allDayDateLabel);</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineminus">-            }</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+          let date = &quot;&quot;;</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+          let iconType = &quot;&quot;;</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+          let allDayDateLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-allDayEvent-date&quot;);</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineplus">+          setBooleanAttribute(allDayDateLabel, &quot;hidden&quot;, !showDate);</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineplus">+          if (startDate.compare(endPreviousDay) == 0) {</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+              // All day event one day duration.</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+              date = dateFormatter.formatDate(startDate);</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+          } else if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+               startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineplus">+              // All day event spanning multiple days.</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+              iconType = &quot;start&quot;;</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+              date = dateFormatter.formatDate(startDate);</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineplus">+          } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+                     endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+              iconType = &quot;end&quot;;</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+              date = dateFormatter.formatDate(endPreviousDay);</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+          } else {</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+              iconType = &quot;continue&quot;;</span>
<a href="#l4.195"></a><span id="l4.195" class="difflineplus">+              hideElement(allDayDateLabel);</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineplus">+          }</span>
<a href="#l4.197"></a><span id="l4.197"> </span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-            let multiDayImage = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-multiDayEvent-image&quot;);</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineminus">-            multiDayImage.setAttribute(&quot;type&quot;, iconType);</span>
<a href="#l4.200"></a><span id="l4.200" class="difflineminus">-            // class wrap causes allday items to wrap its text in today-pane</span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-            let addWrap = document.getAnonymousElementByAttribute(this.mAllDayItem, &quot;anonid&quot;, &quot;eventbox&quot;);</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-            addWrap.classList.add(&quot;wrap&quot;);</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-            addWrap = document.getAnonymousElementByAttribute(this.mAllDayItem, &quot;anonid&quot;, &quot;event-detail-box&quot;);</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-            addWrap.classList.add(&quot;wrap&quot;);</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-            allDayDateLabel.value = date;</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineplus">+          let multiDayImage = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-multiDayEvent-image&quot;);</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineplus">+          multiDayImage.setAttribute(&quot;type&quot;, iconType);</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+          // class wrap causes allday items to wrap its text in today-pane</span>
<a href="#l4.209"></a><span id="l4.209" class="difflineplus">+          let addWrap = document.getAnonymousElementByAttribute(this.mAllDayItem, &quot;anonid&quot;, &quot;eventbox&quot;);</span>
<a href="#l4.210"></a><span id="l4.210" class="difflineplus">+          addWrap.classList.add(&quot;wrap&quot;);</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineplus">+          addWrap = document.getAnonymousElementByAttribute(this.mAllDayItem, &quot;anonid&quot;, &quot;event-detail-box&quot;);</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineplus">+          addWrap.classList.add(&quot;wrap&quot;);</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+          allDayDateLabel.value = date;</span>
<a href="#l4.214"></a><span id="l4.214">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.215"></a><span id="l4.215">       &lt;/method&gt;</span>
<a href="#l4.216"></a><span id="l4.216">     &lt;/implementation&gt;</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineplus">+</span>
<a href="#l4.218"></a><span id="l4.218">     &lt;handlers&gt;</span>
<a href="#l4.219"></a><span id="l4.219">       &lt;handler event=&quot;dragstart&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.220"></a><span id="l4.220">         invokeEventDragSession(this.mAllDayItem.occurrence.clone(), this);</span>
<a href="#l4.221"></a><span id="l4.221">         event.stopPropagation();</span>
<a href="#l4.222"></a><span id="l4.222">         event.preventDefault();</span>
<a href="#l4.223"></a><span id="l4.223">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.224"></a><span id="l4.224">     &lt;/handlers&gt;</span>
<a href="#l4.225"></a><span id="l4.225">   &lt;/binding&gt;</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineat">@@ -184,98 +189,101 @@</span>
<a href="#l4.227"></a><span id="l4.227">           &lt;xul:hbox align=&quot;start&quot;&gt;</span>
<a href="#l4.228"></a><span id="l4.228">             &lt;xul:image anonid=&quot;agenda-multiDayEvent-image&quot; class=&quot;agenda-multiDayEvent-image&quot;/&gt;</span>
<a href="#l4.229"></a><span id="l4.229">             &lt;xul:label anonid=&quot;agenda-event-start&quot; class=&quot;agenda-event-start&quot; crop=&quot;end&quot; flex=&quot;1&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l4.230"></a><span id="l4.230">           &lt;/xul:hbox&gt;</span>
<a href="#l4.231"></a><span id="l4.231">           &lt;xul:label anonid=&quot;agenda-event-title&quot; class=&quot;agenda-event-title&quot; crop=&quot;end&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l4.232"></a><span id="l4.232">         &lt;/xul:vbox&gt;</span>
<a href="#l4.233"></a><span id="l4.233">       &lt;/xul:hbox&gt;</span>
<a href="#l4.234"></a><span id="l4.234">     &lt;/content&gt;</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineplus">+</span>
<a href="#l4.236"></a><span id="l4.236">     &lt;implementation&gt;</span>
<a href="#l4.237"></a><span id="l4.237">       &lt;method name=&quot;setOccurrence&quot;&gt;</span>
<a href="#l4.238"></a><span id="l4.238">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l4.239"></a><span id="l4.239">         &lt;parameter name=&quot;aPeriod&quot;/&gt;</span>
<a href="#l4.240"></a><span id="l4.240">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineminus">-            this.mOccurrence = aItem;</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineminus">-            this.setAttribute(&quot;status&quot;, aItem.status);</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineminus">-            let dateFormatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineminus">-                                  .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineplus">+          this.mOccurrence = aItem;</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineplus">+          this.setAttribute(&quot;status&quot;, aItem.status);</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineplus">+          let dateFormatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+                                .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l4.249"></a><span id="l4.249"> </span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-            let periodStartDate = aPeriod.start.clone();</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-            periodStartDate.isDate = true;</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-            let periodEndDate = aPeriod.end.clone();</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineminus">-            periodEndDate.day--;</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-            let start = this.mOccurrence[calGetStartDateProp(this.mOccurrence)]</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineminus">-                            .getInTimezone(calendarDefaultTimezone());</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineminus">-            let end = this.mOccurrence[calGetEndDateProp(this.mOccurrence)]</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineplus">+          let periodStartDate = aPeriod.start.clone();</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineplus">+          periodStartDate.isDate = true;</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineplus">+          let periodEndDate = aPeriod.end.clone();</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineplus">+          periodEndDate.day--;</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineplus">+          let start = this.mOccurrence[calGetStartDateProp(this.mOccurrence)]</span>
<a href="#l4.262"></a><span id="l4.262">                           .getInTimezone(calendarDefaultTimezone());</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-            let startDate = start.clone();</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-            startDate.isDate = true;</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-            let endDate = end.clone();</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-            endDate.isDate = true;</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-            let endAtMidnight = (end.hour == 0 &amp;&amp; end.minute == 0);</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-            if (endAtMidnight) {</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-                endDate.day--;</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">-            }</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-            // Show items's date for long periods but also for &quot;Upcoming&quot;</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-            // period with one day duration.</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-            let longFormat = aPeriod.multiday || aPeriod.duration &gt; 1;</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineplus">+          let end = this.mOccurrence[calGetEndDateProp(this.mOccurrence)]</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineplus">+                        .getInTimezone(calendarDefaultTimezone());</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineplus">+          let startDate = start.clone();</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineplus">+          startDate.isDate = true;</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineplus">+          let endDate = end.clone();</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineplus">+          endDate.isDate = true;</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineplus">+          let endAtMidnight = (end.hour == 0 &amp;&amp; end.minute == 0);</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineplus">+          if (endAtMidnight) {</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineplus">+              endDate.day--;</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineplus">+          }</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineplus">+          // Show items's date for long periods but also for &quot;Upcoming&quot;</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+          // period with one day duration.</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineplus">+          let longFormat = aPeriod.multiday || aPeriod.duration &gt; 1;</span>
<a href="#l4.287"></a><span id="l4.287"> </span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-            let duration = &quot;&quot;;</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-            let iconType = &quot;&quot;;</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-            if (startDate.compare(endDate) == 0) {</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-                // event that starts and ends in the same day, midnight included</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineminus">-                duration = longFormat ? dateFormatter.formatDateTime(start)</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineminus">-                                      : dateFormatter.formatTime(start);</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineminus">-            } else if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineminus">-                       startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-                // event spanning multiple days, start date within period</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-                iconType = &quot;start&quot;;</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-                duration = longFormat ? dateFormatter.formatDateTime(start)</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-                                      : dateFormatter.formatTime(start);</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-            } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-                       endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-                // event spanning multiple days, end date within period</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-                iconType = &quot;end&quot;;</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-                if (endAtMidnight) {</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-                    duration = dateFormatter.formatDate(endDate) + &quot; &quot;;</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-                    duration = longFormat ? duration + calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;)</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-                                          : calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;);</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-                } else {</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-                    duration = longFormat ? dateFormatter.formatDateTime(end)</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-                                          : dateFormatter.formatTime(end);</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-                }</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-            } else {</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-                iconType = &quot;continue&quot;;</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-            }</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-            let multiDayImage = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-multiDayEvent-image&quot;);</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-            multiDayImage.setAttribute(&quot;type&quot;, iconType);</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-            let durationbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-event-start&quot;);</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-            durationbox.textContent = duration;</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineplus">+          let duration = &quot;&quot;;</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineplus">+          let iconType = &quot;&quot;;</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineplus">+          if (startDate.compare(endDate) == 0) {</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineplus">+              // event that starts and ends in the same day, midnight included</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineplus">+              duration = longFormat ? dateFormatter.formatDateTime(start)</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineplus">+                                    : dateFormatter.formatTime(start);</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineplus">+          } else if (startDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineplus">+                     startDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineplus">+              // event spanning multiple days, start date within period</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineplus">+              iconType = &quot;start&quot;;</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineplus">+              duration = longFormat ? dateFormatter.formatDateTime(start)</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineplus">+                                    : dateFormatter.formatTime(start);</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineplus">+          } else if (endDate.compare(periodStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineplus">+                     endDate.compare(periodEndDate) &lt;= 0) {</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineplus">+              // event spanning multiple days, end date within period</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineplus">+              iconType = &quot;end&quot;;</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineplus">+              if (endAtMidnight) {</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineplus">+                  duration = dateFormatter.formatDate(endDate) + &quot; &quot;;</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineplus">+                  duration = longFormat ? duration + calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;)</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineplus">+                                        : calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;);</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineplus">+              } else {</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineplus">+                  duration = longFormat ? dateFormatter.formatDateTime(end)</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineplus">+                                        : dateFormatter.formatTime(end);</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineplus">+              }</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineplus">+          } else {</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineplus">+              iconType = &quot;continue&quot;;</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineplus">+          }</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineplus">+          let multiDayImage = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-multiDayEvent-image&quot;);</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineplus">+          multiDayImage.setAttribute(&quot;type&quot;, iconType);</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineplus">+          let durationbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-event-start&quot;);</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineplus">+          durationbox.textContent = duration;</span>
<a href="#l4.350"></a><span id="l4.350"> </span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-            // show items with time only (today &amp; tomorrow) as one line.</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineminus">-            if (longFormat) {</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineminus">-                let titlebox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-event-title&quot;);</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineminus">-                titlebox.textContent = aItem.title;</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineminus">-            } else {</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineminus">-                durationbox.textContent += &quot; &quot; + aItem.title;</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineminus">-            }</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-            this.refreshColor();</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineplus">+          // show items with time only (today &amp; tomorrow) as one line.</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineplus">+          if (longFormat) {</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineplus">+              let titlebox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-event-title&quot;);</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineplus">+              titlebox.textContent = aItem.title;</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineplus">+          } else {</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineplus">+              durationbox.textContent += &quot; &quot; + aItem.title;</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineplus">+          }</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineplus">+          this.refreshColor();</span>
<a href="#l4.367"></a><span id="l4.367">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.368"></a><span id="l4.368">       &lt;/method&gt;</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineplus">+</span>
<a href="#l4.370"></a><span id="l4.370">       &lt;method name=&quot;refreshColor&quot;&gt;</span>
<a href="#l4.371"></a><span id="l4.371">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineminus">-            let calcolor = (this.mOccurrence &amp;&amp;</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineminus">-                            this.mOccurrence.calendar.getProperty(&quot;color&quot;)) ||</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineminus">-                           &quot;#a8c2e1&quot;;</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineplus">+          let calcolor = (this.mOccurrence &amp;&amp;</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineplus">+                           this.mOccurrence.calendar.getProperty(&quot;color&quot;)) ||</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineplus">+                          &quot;#a8c2e1&quot;;</span>
<a href="#l4.378"></a><span id="l4.378"> </span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-            let imagebox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-calendar-image&quot;);</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-            imagebox.setAttribute(&quot;style&quot;, &quot;background-color: &quot; + calcolor + &quot;;&quot;);</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineplus">+          let imagebox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;agenda-calendar-image&quot;);</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineplus">+          imagebox.setAttribute(&quot;style&quot;, &quot;background-color: &quot; + calcolor + &quot;;&quot;);</span>
<a href="#l4.383"></a><span id="l4.383">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.384"></a><span id="l4.384">       &lt;/method&gt;</span>
<a href="#l4.385"></a><span id="l4.385">     &lt;/implementation&gt;</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineplus">+</span>
<a href="#l4.387"></a><span id="l4.387">     &lt;handlers&gt;</span>
<a href="#l4.388"></a><span id="l4.388">       &lt;handler event=&quot;dragstart&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.389"></a><span id="l4.389">         invokeEventDragSession(this.mOccurrence.clone(), this);</span>
<a href="#l4.390"></a><span id="l4.390">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.391"></a><span id="l4.391">     &lt;/handlers&gt;</span>
<a href="#l4.392"></a><span id="l4.392">   &lt;/binding&gt;</span>
<a href="#l4.393"></a><span id="l4.393"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,19 +1,18 @@</span>
<a href="#l5.4"></a><span id="l5.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l5.5"></a><span id="l5.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.6"></a><span id="l5.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">---&gt;</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> &lt;bindings id=&quot;calendar-multiday-view-bindings&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-  xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-  xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+          xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21">   &lt;binding id=&quot;calendar-base-view&quot;&gt;</span>
<a href="#l5.22"></a><span id="l5.22">     &lt;resources&gt;</span>
<a href="#l5.23"></a><span id="l5.23">       &lt;stylesheet src=&quot;chrome://calendar-common/skin/calendar-alarms.css&quot;/&gt;</span>
<a href="#l5.24"></a><span id="l5.24">     &lt;/resources&gt;</span>
<a href="#l5.25"></a><span id="l5.25">     &lt;implementation&gt;</span>
<a href="#l5.26"></a><span id="l5.26">       &lt;field name=&quot;mWeekStartOffset&quot;&gt;0&lt;/field&gt;</span>
<a href="#l5.27"></a><span id="l5.27">       &lt;field name=&quot;mRangeStartDate&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineat">@@ -39,29 +38,29 @@</span>
<a href="#l5.29"></a><span id="l5.29">       &lt;field name=&quot;mMagnifyAmount&quot;&gt;0&lt;/field&gt;</span>
<a href="#l5.30"></a><span id="l5.30">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l5.31"></a><span id="l5.31">       &lt;field name=&quot;mViewStart&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.32"></a><span id="l5.32">       &lt;field name=&quot;mViewEnd&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.33"></a><span id="l5.33">       &lt;field name=&quot;mToggleStatus&quot;&gt;0&lt;/field&gt;</span>
<a href="#l5.34"></a><span id="l5.34">       &lt;field name=&quot;mLog&quot;&gt;null&lt;/field&gt;</span>
<a href="#l5.35"></a><span id="l5.35">       &lt;field name=&quot;mToggleStatusFlag&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.36"></a><span id="l5.36">       ({</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-         WorkdaysOnly:  1,</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-         TasksInView:   2,</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-         ShowCompleted: 4,</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+          WorkdaysOnly: 1,</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+          TasksInView: 2,</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+          ShowCompleted: 4,</span>
<a href="#l5.43"></a><span id="l5.43">       })</span>
<a href="#l5.44"></a><span id="l5.44">       ]]&gt;&lt;/field&gt;</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">       &lt;field name=&quot;mPrefObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.47"></a><span id="l5.47">       ({</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-         calView: this,</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-         observe: function(subj, topic, pref) {</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-             this.calView.handlePreference(subj, topic, pref);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-             return;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-         }</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+          calView: this,</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+          observe: function(subj, topic, pref) {</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+              this.calView.handlePreference(subj, topic, pref);</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+              return;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+          }</span>
<a href="#l5.58"></a><span id="l5.58">       })</span>
<a href="#l5.59"></a><span id="l5.59">       ]]&gt;&lt;/field&gt;</span>
<a href="#l5.60"></a><span id="l5.60"> </span>
<a href="#l5.61"></a><span id="l5.61">       &lt;field name=&quot;mObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.62"></a><span id="l5.62">         // the calIObserver, calICompositeObserver, and calIAlarmServiceObserver</span>
<a href="#l5.63"></a><span id="l5.63">         ({</span>
<a href="#l5.64"></a><span id="l5.64">             QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l5.65"></a><span id="l5.65">                 Components.interfaces.calIObserver,</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineat">@@ -359,39 +358,39 @@</span>
<a href="#l5.67"></a><span id="l5.67">           this.mCalendar.addObserver(this.mObserver);</span>
<a href="#l5.68"></a><span id="l5.68">           this.refresh();</span>
<a href="#l5.69"></a><span id="l5.69">           return val;</span>
<a href="#l5.70"></a><span id="l5.70">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l5.71"></a><span id="l5.71">       &lt;/property&gt;</span>
<a href="#l5.72"></a><span id="l5.72"> </span>
<a href="#l5.73"></a><span id="l5.73">       &lt;property name=&quot;initialized&quot;&gt;</span>
<a href="#l5.74"></a><span id="l5.74">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-            let retval;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+          let retval;</span>
<a href="#l5.77"></a><span id="l5.77"> </span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-            // Some views throw when accessing an uninitialized startDay</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-            try {</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-                retval = this.displayCalendar &amp;&amp; this.startDay &amp;&amp;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-                         this.endDay;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-            } catch (ex) {</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-                return false;</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-            }</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-            return retval;</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+          // Some views throw when accessing an uninitialized startDay</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+          try {</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+              retval = this.displayCalendar &amp;&amp; this.startDay &amp;&amp;</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+                       this.endDay;</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+          } catch (ex) {</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+              return false;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+          }</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+          return retval;</span>
<a href="#l5.94"></a><span id="l5.94">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.95"></a><span id="l5.95">       &lt;/property&gt;</span>
<a href="#l5.96"></a><span id="l5.96"> </span>
<a href="#l5.97"></a><span id="l5.97">       &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l5.98"></a><span id="l5.98">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l5.99"></a><span id="l5.99">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-            this.showDate(aDate);</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+          this.showDate(aDate);</span>
<a href="#l5.102"></a><span id="l5.102">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.103"></a><span id="l5.103">       &lt;/method&gt;</span>
<a href="#l5.104"></a><span id="l5.104"> </span>
<a href="#l5.105"></a><span id="l5.105">       &lt;method name=&quot;getRangeDescription&quot;&gt;</span>
<a href="#l5.106"></a><span id="l5.106">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-            return getDateFormatter().formatInterval(this.rangeStartDate, this.rangeEndDate);</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+          return getDateFormatter().formatInterval(this.rangeStartDate, this.rangeEndDate);</span>
<a href="#l5.109"></a><span id="l5.109">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.110"></a><span id="l5.110">       &lt;/method&gt;</span>
<a href="#l5.111"></a><span id="l5.111"> </span>
<a href="#l5.112"></a><span id="l5.112">       &lt;!-- This function guarantees that the</span>
<a href="#l5.113"></a><span id="l5.113">        labels are clipped in the instance that the overflow occurrs,</span>
<a href="#l5.114"></a><span id="l5.114">        avoiding horizontal scrollbars from showing up for a short period. --&gt;</span>
<a href="#l5.115"></a><span id="l5.115">       &lt;method name=&quot;adjustWeekdayLength&quot;&gt;</span>
<a href="#l5.116"></a><span id="l5.116">         &lt;parameter name=&quot;forceShortName&quot;/&gt;</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineat">@@ -550,18 +549,18 @@</span>
<a href="#l5.118"></a><span id="l5.118"> </span>
<a href="#l5.119"></a><span id="l5.119">           refreshJob.execute();</span>
<a href="#l5.120"></a><span id="l5.120">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.121"></a><span id="l5.121">       &lt;/method&gt;</span>
<a href="#l5.122"></a><span id="l5.122"> </span>
<a href="#l5.123"></a><span id="l5.123">       &lt;method name=&quot;deleteItemsFromCalendar&quot;&gt;</span>
<a href="#l5.124"></a><span id="l5.124">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l5.125"></a><span id="l5.125">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-            /* This method must be implemented in subclasses. */</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-            throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineplus">+          /* This method must be implemented in subclasses. */</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineplus">+          throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.130"></a><span id="l5.130">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.131"></a><span id="l5.131">       &lt;/method&gt;</span>
<a href="#l5.132"></a><span id="l5.132"> </span>
<a href="#l5.133"></a><span id="l5.133">       &lt;!-- the end date that should be used for getItems and similar queries --&gt;</span>
<a href="#l5.134"></a><span id="l5.134">       &lt;property name=&quot;queryEndDate&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l5.135"></a><span id="l5.135">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l5.136"></a><span id="l5.136">           let end = this.endDate;</span>
<a href="#l5.137"></a><span id="l5.137">           if (!end) {</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineat">@@ -582,20 +581,20 @@</span>
<a href="#l5.139"></a><span id="l5.139">           event.initEvent(aEventName, true, false);</span>
<a href="#l5.140"></a><span id="l5.140">           event.detail = aEventDetail;</span>
<a href="#l5.141"></a><span id="l5.141">           this.dispatchEvent(event);</span>
<a href="#l5.142"></a><span id="l5.142">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.143"></a><span id="l5.143">       &lt;/method&gt;</span>
<a href="#l5.144"></a><span id="l5.144"> </span>
<a href="#l5.145"></a><span id="l5.145">       &lt;method name=&quot;removeDropShadows&quot;&gt;</span>
<a href="#l5.146"></a><span id="l5.146">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineminus">-            let dropbox = document.getAnonymousElementByAttribute(this, &quot;dropbox&quot;, &quot;true&quot;);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineminus">-            if (dropbox &amp;&amp; dropbox !== undefined) {</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-                dropbox.setAttribute(&quot;dropbox&quot;, &quot;false&quot;);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-            }</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+          let dropbox = document.getAnonymousElementByAttribute(this, &quot;dropbox&quot;, &quot;true&quot;);</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+          if (dropbox &amp;&amp; dropbox !== undefined) {</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+              dropbox.setAttribute(&quot;dropbox&quot;, &quot;false&quot;);</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+          }</span>
<a href="#l5.155"></a><span id="l5.155">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.156"></a><span id="l5.156">       &lt;/method&gt;</span>
<a href="#l5.157"></a><span id="l5.157"> </span>
<a href="#l5.158"></a><span id="l5.158">       &lt;method name=&quot;getLongWeekdayTotalPixels&quot;&gt;</span>
<a href="#l5.159"></a><span id="l5.159">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.160"></a><span id="l5.160">           if (this.mLongWeekdayTotalPixels &lt;= 0) {</span>
<a href="#l5.161"></a><span id="l5.161">               let maxDayWidth = 0;</span>
<a href="#l5.162"></a><span id="l5.162">               for (let label of this.labeldaybox.childNodes) {</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineat">@@ -615,74 +614,74 @@</span>
<a href="#l5.164"></a><span id="l5.164"> </span>
<a href="#l5.165"></a><span id="l5.165">       &lt;!-- A preference handler which is called by the preference observer.</span>
<a href="#l5.166"></a><span id="l5.166">            Can be overwritten in derived bindings. --&gt;</span>
<a href="#l5.167"></a><span id="l5.167">       &lt;method name=&quot;handleCommonPreference&quot;&gt;</span>
<a href="#l5.168"></a><span id="l5.168">         &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l5.169"></a><span id="l5.169">         &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l5.170"></a><span id="l5.170">         &lt;parameter name=&quot;aPreference&quot;/&gt;</span>
<a href="#l5.171"></a><span id="l5.171">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-           // refresh view if categories seem to have changed</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-           if (aPreference.startsWith(&quot;calendar.category.color&quot;)) {</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineminus">-               this.refreshView();</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineminus">-               return;</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineminus">-           }</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineminus">-           switch (aPreference) {</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineminus">-               case &quot;calendar.week.d0sundaysoff&quot;:</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineminus">-               case &quot;calendar.week.d1mondaysoff&quot;:</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-               case &quot;calendar.week.d2tuesdaysoff&quot;:</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineminus">-               case &quot;calendar.week.d3wednesdaysoff&quot;:</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineminus">-               case &quot;calendar.week.d4thursdaysoff&quot;:</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineminus">-               case &quot;calendar.week.d5fridaysoff&quot;:</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineminus">-               case &quot;calendar.week.d6saturdaysoff&quot;:</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineminus">-                   this.updateDaysOffPrefs();</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineminus">-                   break;</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineminus">-               case &quot;calendar.timezone.local&quot;:</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-                   this.timezone = calendarDefaultTimezone();</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-                   this.refreshView();</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-                   break;</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-               case &quot;calendar.alarms.indicator.show&quot;:</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-                   // Break here to ensure the view is refreshed</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-                   break;</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-               case &quot;calendar.week.start&quot;:</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineminus">-                   this.weekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineminus">-                   break;</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineminus">-               case &quot;calendar.date.format&quot;:</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineminus">-                   this.refreshView();</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-                   break;</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineminus">-               default:</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineminus">-                   return;</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineminus">-            }</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-            this.refreshView();</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineplus">+          // refresh view if categories seem to have changed</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineplus">+          if (aPreference.startsWith(&quot;calendar.category.color&quot;)) {</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineplus">+              this.refreshView();</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+              return;</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+          }</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+          switch (aPreference) {</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+              case &quot;calendar.week.d0sundaysoff&quot;:</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineplus">+              case &quot;calendar.week.d1mondaysoff&quot;:</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineplus">+              case &quot;calendar.week.d2tuesdaysoff&quot;:</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineplus">+              case &quot;calendar.week.d3wednesdaysoff&quot;:</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineplus">+              case &quot;calendar.week.d4thursdaysoff&quot;:</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineplus">+              case &quot;calendar.week.d5fridaysoff&quot;:</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineplus">+              case &quot;calendar.week.d6saturdaysoff&quot;:</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineplus">+                  this.updateDaysOffPrefs();</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineplus">+                  break;</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+              case &quot;calendar.timezone.local&quot;:</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineplus">+                  this.timezone = calendarDefaultTimezone();</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineplus">+                  this.refreshView();</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineplus">+                  break;</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineplus">+              case &quot;calendar.alarms.indicator.show&quot;:</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineplus">+                  // Break here to ensure the view is refreshed</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineplus">+                  break;</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+              case &quot;calendar.week.start&quot;:</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineplus">+                  this.weekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineplus">+                  break;</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineplus">+              case &quot;calendar.date.format&quot;:</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineplus">+                  this.refreshView();</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineplus">+                  break;</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineplus">+              default:</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineplus">+                  return;</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineplus">+          }</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineplus">+          this.refreshView();</span>
<a href="#l5.236"></a><span id="l5.236">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.237"></a><span id="l5.237">       &lt;/method&gt;</span>
<a href="#l5.238"></a><span id="l5.238"> </span>
<a href="#l5.239"></a><span id="l5.239">       &lt;method name=&quot;updateDaysOffPrefs&quot;&gt;</span>
<a href="#l5.240"></a><span id="l5.240">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineminus">-            const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineminus">-            const prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineminus">-                               &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineminus">-                               &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-            const defaults = [&quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-                              &quot;false&quot;, &quot;false&quot;, &quot;true&quot;];</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineminus">-            let daysOff = [];</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineminus">-            for (let i in prefNames) {</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineminus">-                if (Preferences.get(weekPrefix + prefNames[i], defaults[i])) {</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineminus">-                    daysOff.push(Number(i));</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineminus">-                }</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineminus">-            }</span>
<a href="#l5.253"></a><span id="l5.253" class="difflineminus">-            this.daysOffArray = daysOff;</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineplus">+          const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineplus">+          const prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineplus">+                             &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineplus">+                             &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineplus">+          const defaults = [&quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineplus">+                            &quot;false&quot;, &quot;false&quot;, &quot;true&quot;];</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineplus">+          let daysOff = [];</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineplus">+          for (let i in prefNames) {</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineplus">+              if (Preferences.get(weekPrefix + prefNames[i], defaults[i])) {</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineplus">+                  daysOff.push(Number(i));</span>
<a href="#l5.264"></a><span id="l5.264" class="difflineplus">+              }</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineplus">+          }</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineplus">+          this.daysOffArray = daysOff;</span>
<a href="#l5.267"></a><span id="l5.267">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.268"></a><span id="l5.268">       &lt;/method&gt;</span>
<a href="#l5.269"></a><span id="l5.269"> </span>
<a href="#l5.270"></a><span id="l5.270">       &lt;method name=&quot;refreshView&quot;&gt;</span>
<a href="#l5.271"></a><span id="l5.271">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.272"></a><span id="l5.272">           if (!this.startDay || !this.endDay) {</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineminus">-             // don't refresh if we're not initialized</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineminus">-             return;</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineplus">+              // don't refresh if we're not initialized</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineplus">+              return;</span>
<a href="#l5.277"></a><span id="l5.277">           }</span>
<a href="#l5.278"></a><span id="l5.278">           // Just refresh, the goToDay function will notice</span>
<a href="#l5.279"></a><span id="l5.279">           this.goToDay(this.selectedDay);</span>
<a href="#l5.280"></a><span id="l5.280">           this.forceRefresh();</span>
<a href="#l5.281"></a><span id="l5.281">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.282"></a><span id="l5.282">       &lt;/method&gt;</span>
<a href="#l5.283"></a><span id="l5.283"> </span>
<a href="#l5.284"></a><span id="l5.284">       &lt;!-- Default implementations follow, these make things easier for</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineat">@@ -757,21 +756,19 @@</span>
<a href="#l5.286"></a><span id="l5.286">       &lt;/method&gt;</span>
<a href="#l5.287"></a><span id="l5.287">       &lt;method name=&quot;zoomReset&quot;&gt;</span>
<a href="#l5.288"></a><span id="l5.288">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.289"></a><span id="l5.289">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.290"></a><span id="l5.290">       &lt;/method&gt;</span>
<a href="#l5.291"></a><span id="l5.291">     &lt;/implementation&gt;</span>
<a href="#l5.292"></a><span id="l5.292"> </span>
<a href="#l5.293"></a><span id="l5.293">     &lt;handlers&gt;</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineminus">-      &lt;handler event=&quot;move&quot;&gt;</span>
<a href="#l5.295"></a><span id="l5.295" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l5.296"></a><span id="l5.296" class="difflineminus">-          this.moveView(event.detail);</span>
<a href="#l5.297"></a><span id="l5.297" class="difflineminus">-        ]]&gt;</span>
<a href="#l5.298"></a><span id="l5.298" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineplus">+      &lt;handler event=&quot;move&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineplus">+        this.moveView(event.detail);</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l5.302"></a><span id="l5.302">       &lt;handler event=&quot;keypress&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.303"></a><span id="l5.303">         const kKE = Components.interfaces.nsIDOMKeyEvent;</span>
<a href="#l5.304"></a><span id="l5.304">         switch (event.keyCode) {</span>
<a href="#l5.305"></a><span id="l5.305">             case kKE.DOM_VK_PAGE_UP:</span>
<a href="#l5.306"></a><span id="l5.306">                 this.moveView(-1);</span>
<a href="#l5.307"></a><span id="l5.307">                 break;</span>
<a href="#l5.308"></a><span id="l5.308">             case kKE.DOM_VK_PAGE_DOWN:</span>
<a href="#l5.309"></a><span id="l5.309">                 this.moveView(1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-common-sets.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-common-sets.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -123,20 +123,20 @@ var calendarController = {</span>
<a href="#l6.4"></a><span id="l6.4">             case &quot;calendar_delete_event_command&quot;:</span>
<a href="#l6.5"></a><span id="l6.5">                 return CalendarDeleteCommandEnabled &amp;&amp; this.selected_items_writable;</span>
<a href="#l6.6"></a><span id="l6.6">             case &quot;calendar_new_todo_command&quot;:</span>
<a href="#l6.7"></a><span id="l6.7">             case &quot;calendar_new_todo_context_command&quot;:</span>
<a href="#l6.8"></a><span id="l6.8">             case &quot;calendar_new_todo_todaypane_command&quot;:</span>
<a href="#l6.9"></a><span id="l6.9">                 return CalendarNewTasksCommandEnabled;</span>
<a href="#l6.10"></a><span id="l6.10">             case &quot;calendar_modify_todo_command&quot;:</span>
<a href="#l6.11"></a><span id="l6.11">             case &quot;calendar_modify_todo_todaypane_command&quot;:</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                 return this.todo_items_selected;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                 // This code is temporarily commented out due to</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                 // bug 469684 Unifinder-todo: raising of the context menu fires blur-event</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                 // this.todo_tasktree_focused;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+                return this.todo_items_selected;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+                // This code is temporarily commented out due to</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+                // bug 469684 Unifinder-todo: raising of the context menu fires blur-event</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+                // this.todo_tasktree_focused;</span>
<a href="#l6.20"></a><span id="l6.20">             case &quot;calendar_edit_calendar_command&quot;:</span>
<a href="#l6.21"></a><span id="l6.21">                 return this.isCalendarInForeground();</span>
<a href="#l6.22"></a><span id="l6.22">             case &quot;calendar_task_filter_command&quot;:</span>
<a href="#l6.23"></a><span id="l6.23">                 return true;</span>
<a href="#l6.24"></a><span id="l6.24">             case &quot;calendar_delete_todo_command&quot;:</span>
<a href="#l6.25"></a><span id="l6.25">                 if (!CalendarDeleteCommandEnabled) {</span>
<a href="#l6.26"></a><span id="l6.26">                     return false;</span>
<a href="#l6.27"></a><span id="l6.27">                 }</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineat">@@ -231,21 +231,21 @@ var calendarController = {</span>
<a href="#l6.29"></a><span id="l6.29">             default:</span>
<a href="#l6.30"></a><span id="l6.30">                 if (this.defaultController &amp;&amp; !this.isCalendarInForeground()) {</span>
<a href="#l6.31"></a><span id="l6.31">                     // The delete-button demands a special handling in mail-mode</span>
<a href="#l6.32"></a><span id="l6.32">                     // as it is supposed to delete an element of the focused pane</span>
<a href="#l6.33"></a><span id="l6.33">                     if (aCommand == &quot;cmd_delete&quot; || aCommand == &quot;button_delete&quot;) {</span>
<a href="#l6.34"></a><span id="l6.34">                         let focusedElement = document.commandDispatcher.focusedElement;</span>
<a href="#l6.35"></a><span id="l6.35">                         if (focusedElement) {</span>
<a href="#l6.36"></a><span id="l6.36">                             if (focusedElement.getAttribute(&quot;id&quot;) == &quot;agenda-listbox&quot;) {</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-                                 return agendaListbox.isEventSelected();</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+                                return agendaListbox.isEventSelected();</span>
<a href="#l6.39"></a><span id="l6.39">                             } else if (focusedElement.className == &quot;calendar-task-tree&quot;) {</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-                                 return this.writable &amp;&amp;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-                                        this.todo_items_selected &amp;&amp;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-                                        this.todo_items_writable;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+                                return this.writable &amp;&amp;</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+                                       this.todo_items_selected &amp;&amp;</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+                                       this.todo_items_writable;</span>
<a href="#l6.46"></a><span id="l6.46">                             }</span>
<a href="#l6.47"></a><span id="l6.47">                         }</span>
<a href="#l6.48"></a><span id="l6.48">                     }</span>
<a href="#l6.49"></a><span id="l6.49"> </span>
<a href="#l6.50"></a><span id="l6.50">                     if (this.defaultController.supportsCommand(aCommand)) {</span>
<a href="#l6.51"></a><span id="l6.51">                         return this.defaultController.isCommandEnabled(aCommand);</span>
<a href="#l6.52"></a><span id="l6.52">                     }</span>
<a href="#l6.53"></a><span id="l6.53">                 }</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineat">@@ -690,18 +690,18 @@ var calendarController2 = {</span>
<a href="#l6.55"></a><span id="l6.55">                 goSetMenuValue(aCommand, &quot;valueDefault&quot;);</span>
<a href="#l6.56"></a><span id="l6.56">                 return canRedo();</span>
<a href="#l6.57"></a><span id="l6.57">             case &quot;button_delete&quot;:</span>
<a href="#l6.58"></a><span id="l6.58">             case &quot;cmd_delete&quot;:</span>
<a href="#l6.59"></a><span id="l6.59">                 return calendarController.isCommandEnabled(&quot;calendar_delete_focused_item_command&quot;);</span>
<a href="#l6.60"></a><span id="l6.60">             case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l6.61"></a><span id="l6.61">             case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l6.62"></a><span id="l6.62">             case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-              return calendarController.isInMode(&quot;calendar&quot;) &amp;&amp;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-                     currentView().supportsZoom;</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+                return calendarController.isInMode(&quot;calendar&quot;) &amp;&amp;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+                       currentView().supportsZoom;</span>
<a href="#l6.67"></a><span id="l6.67">             case &quot;cmd_properties&quot;:</span>
<a href="#l6.68"></a><span id="l6.68">             case &quot;cmd_printpreview&quot;:</span>
<a href="#l6.69"></a><span id="l6.69">                 return false;</span>
<a href="#l6.70"></a><span id="l6.70">             case &quot;cmd_showQuickFilterBar&quot;:</span>
<a href="#l6.71"></a><span id="l6.71">                 return calendarController.isInMode(&quot;task&quot;);</span>
<a href="#l6.72"></a><span id="l6.72">             default:</span>
<a href="#l6.73"></a><span id="l6.73">                 return true;</span>
<a href="#l6.74"></a><span id="l6.74">         }</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineat">@@ -832,36 +832,36 @@ function setupContextItemType(event, ite</span>
<a href="#l6.76"></a><span id="l6.76">  * Shows the given date in the current view, if in calendar mode.</span>
<a href="#l6.77"></a><span id="l6.77">  *</span>
<a href="#l6.78"></a><span id="l6.78">  * XXX This function is misplaced, should go to calendar-views.js or a minimonth</span>
<a href="#l6.79"></a><span id="l6.79">  * specific js file.</span>
<a href="#l6.80"></a><span id="l6.80">  *</span>
<a href="#l6.81"></a><span id="l6.81">  * @param aNewDate      The new date as a JSDate.</span>
<a href="#l6.82"></a><span id="l6.82">  */</span>
<a href="#l6.83"></a><span id="l6.83"> function minimonthPick(aNewDate) {</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-  if (gCurrentMode == &quot;calendar&quot; || gCurrentMode == &quot;task&quot;) {</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-      let cdt = cal.jsDateToDateTime(aNewDate, currentView().timezone);</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-      cdt.isDate = true;</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-      currentView().goToDay(cdt);</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+    if (gCurrentMode == &quot;calendar&quot; || gCurrentMode == &quot;task&quot;) {</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+        let cdt = cal.jsDateToDateTime(aNewDate, currentView().timezone);</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+        cdt.isDate = true;</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+        currentView().goToDay(cdt);</span>
<a href="#l6.92"></a><span id="l6.92"> </span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-      // update date filter for task tree</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-      let tree = document.getElementById(&quot;calendar-task-tree&quot;);</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-      tree.updateFilter();</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-  }</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+        // update date filter for task tree</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+        let tree = document.getElementById(&quot;calendar-task-tree&quot;);</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+        tree.updateFilter();</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+    }</span>
<a href="#l6.101"></a><span id="l6.101"> }</span>
<a href="#l6.102"></a><span id="l6.102"> </span>
<a href="#l6.103"></a><span id="l6.103"> /**</span>
<a href="#l6.104"></a><span id="l6.104">  * Selects all items, based on which mode we are currently in and what task tree is focused</span>
<a href="#l6.105"></a><span id="l6.105">  */</span>
<a href="#l6.106"></a><span id="l6.106"> function selectAllItems() {</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-  if (calendarController.todo_tasktree_focused) {</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-    getTaskTree().selectAll();</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-  } else if (calendarController.isInMode(&quot;calendar&quot;)) {</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-    selectAllEvents();</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-  }</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+    if (calendarController.todo_tasktree_focused) {</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineplus">+        getTaskTree().selectAll();</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+    } else if (calendarController.isInMode(&quot;calendar&quot;)) {</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+        selectAllEvents();</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+    }</span>
<a href="#l6.117"></a><span id="l6.117"> }</span>
<a href="#l6.118"></a><span id="l6.118"> </span>
<a href="#l6.119"></a><span id="l6.119"> /**</span>
<a href="#l6.120"></a><span id="l6.120">  * Returns the selected items, based on which mode we are currently in and what task tree is focused</span>
<a href="#l6.121"></a><span id="l6.121">  */</span>
<a href="#l6.122"></a><span id="l6.122"> function getSelectedItems() {</span>
<a href="#l6.123"></a><span id="l6.123">     if (calendarController.todo_tasktree_focused) {</span>
<a href="#l6.124"></a><span id="l6.124">         return getSelectedTasks();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-daypicker.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -24,33 +24,29 @@</span>
<a href="#l7.4"></a><span id="l7.4">                    class=&quot;toolbarbutton-text&quot;</span>
<a href="#l7.5"></a><span id="l7.5">                    flex=&quot;1&quot;</span>
<a href="#l7.6"></a><span id="l7.6">                    xbl:inherits=&quot;value=label&quot;/&gt;</span>
<a href="#l7.7"></a><span id="l7.7">       &lt;/xul:hbox&gt;</span>
<a href="#l7.8"></a><span id="l7.8">     &lt;/content&gt;</span>
<a href="#l7.9"></a><span id="l7.9">     &lt;implementation&gt;</span>
<a href="#l7.10"></a><span id="l7.10">       &lt;method name=&quot;onmodified&quot;&gt;</span>
<a href="#l7.11"></a><span id="l7.11">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-            if (aEvent.attrName == &quot;checked&quot;) {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-                let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-                event.initEvent(&quot;select&quot;, true, true);</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-                this.calendar.dispatchEvent(event);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-            }</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-          ]]&gt;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+          if (aEvent.attrName == &quot;checked&quot;) {</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+              let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+              event.initEvent(&quot;select&quot;, true, true);</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+              this.calendar.dispatchEvent(event);</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+          }</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l7.28"></a><span id="l7.28">       &lt;/method&gt;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-          this.setAttribute(&quot;autoCheck&quot;, &quot;true&quot;);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-          this.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-          this.addEventListener(&quot;DOMAttrModified&quot;, this.onmodified, false);</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-        ]]&gt;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+        this.setAttribute(&quot;autoCheck&quot;, &quot;true&quot;);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+        this.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+        this.addEventListener(&quot;DOMAttrModified&quot;, this.onmodified, false);</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l7.41"></a><span id="l7.41">     &lt;/implementation&gt;</span>
<a href="#l7.42"></a><span id="l7.42">   &lt;/binding&gt;</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44">   &lt;!--</span>
<a href="#l7.45"></a><span id="l7.45">   ########################################################################</span>
<a href="#l7.46"></a><span id="l7.46">   ## daypicker-weekday</span>
<a href="#l7.47"></a><span id="l7.47">   ########################################################################</span>
<a href="#l7.48"></a><span id="l7.48">   --&gt;</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineat">@@ -137,77 +133,76 @@</span>
<a href="#l7.50"></a><span id="l7.50">             if (dow &gt;= 7) {</span>
<a href="#l7.51"></a><span id="l7.51">                 dow -= 7;</span>
<a href="#l7.52"></a><span id="l7.52">             }</span>
<a href="#l7.53"></a><span id="l7.53">             let day = props.GetStringFromName(&quot;day.&quot; + (dow + 1) + &quot;.Mmm&quot;);</span>
<a href="#l7.54"></a><span id="l7.54">             child.label = day;</span>
<a href="#l7.55"></a><span id="l7.55">             child.calendar = this;</span>
<a href="#l7.56"></a><span id="l7.56">         }</span>
<a href="#l7.57"></a><span id="l7.57">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-</span>
<a href="#l7.59"></a><span id="l7.59">     &lt;/implementation&gt;</span>
<a href="#l7.60"></a><span id="l7.60">   &lt;/binding&gt;</span>
<a href="#l7.61"></a><span id="l7.61"> </span>
<a href="#l7.62"></a><span id="l7.62">   &lt;!--</span>
<a href="#l7.63"></a><span id="l7.63">   ########################################################################</span>
<a href="#l7.64"></a><span id="l7.64">   ## daypicker-monthday</span>
<a href="#l7.65"></a><span id="l7.65">   ########################################################################</span>
<a href="#l7.66"></a><span id="l7.66">   --&gt;</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68">   &lt;binding id=&quot;daypicker-monthday&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l7.69"></a><span id="l7.69">     &lt;resources&gt;</span>
<a href="#l7.70"></a><span id="l7.70">       &lt;stylesheet src=&quot;chrome://calendar/skin/calendar-daypicker.css&quot;/&gt;</span>
<a href="#l7.71"></a><span id="l7.71">     &lt;/resources&gt;</span>
<a href="#l7.72"></a><span id="l7.72"> </span>
<a href="#l7.73"></a><span id="l7.73">     &lt;content&gt;</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-          &lt;xul:vbox anonid=&quot;mainbox&quot; class=&quot;daypicker-monthday-mainbox&quot; flex=&quot;1&quot; &gt;</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-            &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-              &lt;daypicker label=&quot;1&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-              &lt;daypicker label=&quot;2&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-              &lt;daypicker label=&quot;3&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-              &lt;daypicker label=&quot;4&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-              &lt;daypicker label=&quot;5&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-              &lt;daypicker label=&quot;6&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-              &lt;daypicker label=&quot;7&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-            &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-              &lt;daypicker label=&quot;8&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-              &lt;daypicker label=&quot;9&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-              &lt;daypicker label=&quot;10&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-              &lt;daypicker label=&quot;11&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineminus">-              &lt;daypicker label=&quot;12&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-              &lt;daypicker label=&quot;13&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-              &lt;daypicker label=&quot;14&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-            &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-              &lt;daypicker label=&quot;15&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-              &lt;daypicker label=&quot;16&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-              &lt;daypicker label=&quot;17&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-              &lt;daypicker label=&quot;18&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-              &lt;daypicker label=&quot;19&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-              &lt;daypicker label=&quot;20&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-              &lt;daypicker label=&quot;21&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">-            &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-              &lt;daypicker label=&quot;22&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-              &lt;daypicker label=&quot;23&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineminus">-              &lt;daypicker label=&quot;24&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineminus">-              &lt;daypicker label=&quot;25&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-              &lt;daypicker label=&quot;26&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineminus">-              &lt;daypicker label=&quot;27&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-              &lt;daypicker label=&quot;28&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineminus">-            &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineminus">-              &lt;daypicker bottom=&quot;true&quot; label=&quot;29&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineminus">-              &lt;daypicker bottom=&quot;true&quot; label=&quot;30&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineminus">-              &lt;daypicker bottom=&quot;true&quot; label=&quot;31&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineminus">-              &lt;daypicker bottom=&quot;true&quot; right=&quot;true&quot; label=&quot;&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineminus">-          &lt;/xul:vbox&gt;</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineminus">-        &lt;/content&gt;</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineplus">+      &lt;xul:vbox anonid=&quot;mainbox&quot; class=&quot;daypicker-monthday-mainbox&quot; flex=&quot;1&quot; &gt;</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+        &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+          &lt;daypicker label=&quot;1&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineplus">+          &lt;daypicker label=&quot;2&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineplus">+          &lt;daypicker label=&quot;3&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineplus">+          &lt;daypicker label=&quot;4&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineplus">+          &lt;daypicker label=&quot;5&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineplus">+          &lt;daypicker label=&quot;6&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineplus">+          &lt;daypicker label=&quot;7&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+        &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineplus">+          &lt;daypicker label=&quot;8&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineplus">+          &lt;daypicker label=&quot;9&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineplus">+          &lt;daypicker label=&quot;10&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineplus">+          &lt;daypicker label=&quot;11&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+          &lt;daypicker label=&quot;12&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+          &lt;daypicker label=&quot;13&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+          &lt;daypicker label=&quot;14&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+        &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineplus">+          &lt;daypicker label=&quot;15&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineplus">+          &lt;daypicker label=&quot;16&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineplus">+          &lt;daypicker label=&quot;17&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+          &lt;daypicker label=&quot;18&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+          &lt;daypicker label=&quot;19&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineplus">+          &lt;daypicker label=&quot;20&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineplus">+          &lt;daypicker label=&quot;21&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineplus">+        &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineplus">+          &lt;daypicker label=&quot;22&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineplus">+          &lt;daypicker label=&quot;23&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineplus">+          &lt;daypicker label=&quot;24&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineplus">+          &lt;daypicker label=&quot;25&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineplus">+          &lt;daypicker label=&quot;26&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineplus">+          &lt;daypicker label=&quot;27&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+          &lt;daypicker label=&quot;28&quot; right=&quot;true&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineplus">+        &lt;xul:hbox class=&quot;daypicker-row&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineplus">+          &lt;daypicker bottom=&quot;true&quot; label=&quot;29&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineplus">+          &lt;daypicker bottom=&quot;true&quot; label=&quot;30&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineplus">+          &lt;daypicker bottom=&quot;true&quot; label=&quot;31&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineplus">+          &lt;daypicker bottom=&quot;true&quot; right=&quot;true&quot; label=&quot;&quot; xbl:inherits=&quot;disabled, mode=id&quot;/&gt;</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+      &lt;/xul:vbox&gt;</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l7.164"></a><span id="l7.164">     &lt;implementation&gt;</span>
<a href="#l7.165"></a><span id="l7.165">       &lt;property name=&quot;days&quot;&gt;</span>
<a href="#l7.166"></a><span id="l7.166">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l7.167"></a><span id="l7.167">           let mainbox =</span>
<a href="#l7.168"></a><span id="l7.168">               document.getAnonymousElementByAttribute(</span>
<a href="#l7.169"></a><span id="l7.169">                   this, &quot;anonid&quot;, &quot;mainbox&quot;);</span>
<a href="#l7.170"></a><span id="l7.170">           let numRows = mainbox.childNodes.length;</span>
<a href="#l7.171"></a><span id="l7.171">           let days = [];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -88,17 +88,17 @@ InvitationsManager.prototype = {</span>
<a href="#l8.4"></a><span id="l8.4">      */</span>
<a href="#l8.5"></a><span id="l8.5">     scheduleInvitationsUpdate: function(firstDelay, operationListener) {</span>
<a href="#l8.6"></a><span id="l8.6">         this.cancelInvitationsUpdate();</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">         this.mTimer = setTimeout(() =&gt; {</span>
<a href="#l8.9"></a><span id="l8.9">             if (Preferences.get(&quot;calendar.invitations.autorefresh.enabled&quot;, true)) {</span>
<a href="#l8.10"></a><span id="l8.10">                 this.mTimer = setInterval(() =&gt; {</span>
<a href="#l8.11"></a><span id="l8.11">                     this.getInvitations(operationListener);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                    }, Preferences.get(&quot;calendar.invitations.autorefresh.timeout&quot;, 3) * 60000);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                }, Preferences.get(&quot;calendar.invitations.autorefresh.timeout&quot;, 3) * 60000);</span>
<a href="#l8.14"></a><span id="l8.14">             }</span>
<a href="#l8.15"></a><span id="l8.15">             this.getInvitations(operationListener);</span>
<a href="#l8.16"></a><span id="l8.16">         }, firstDelay);</span>
<a href="#l8.17"></a><span id="l8.17">     },</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">     /**</span>
<a href="#l8.20"></a><span id="l8.20">      * Cancel pending any pending invitations update.</span>
<a href="#l8.21"></a><span id="l8.21">      */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -24,30 +24,30 @@</span>
<a href="#l9.4"></a><span id="l9.4">     &lt;/resources&gt;      </span>
<a href="#l9.5"></a><span id="l9.5">     &lt;content xbl:inherits=&quot;mode&quot;&gt;</span>
<a href="#l9.6"></a><span id="l9.6">       &lt;xul:label anonid=&quot;item-datetime-label&quot;</span>
<a href="#l9.7"></a><span id="l9.7">                  class=&quot;headline&quot;</span>
<a href="#l9.8"></a><span id="l9.8">                  xbl:inherits=&quot;align&quot;/&gt;</span>
<a href="#l9.9"></a><span id="l9.9">       &lt;xul:label anonid=&quot;item-datetime-value&quot;/&gt;</span>
<a href="#l9.10"></a><span id="l9.10">     &lt;/content&gt;</span>
<a href="#l9.11"></a><span id="l9.11">     &lt;implementation&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-      &lt;field name=&quot;mItem&quot;&gt;null&lt;/field&gt;  </span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+      &lt;field name=&quot;mItem&quot;&gt;null&lt;/field&gt;</span>
<a href="#l9.14"></a><span id="l9.14">       &lt;property name=&quot;mode&quot;</span>
<a href="#l9.15"></a><span id="l9.15">                 readonly=&quot;true&quot;&gt;</span>
<a href="#l9.16"></a><span id="l9.16">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-            if (this.hasAttribute(&quot;mode&quot;)) {</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-                return this.getAttribute(&quot;mode&quot;);</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-            } else {</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-                return &quot;start&quot;;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-            }</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+          if (this.hasAttribute(&quot;mode&quot;)) {</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+              return this.getAttribute(&quot;mode&quot;);</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+          } else {</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+              return &quot;start&quot;;</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+          }</span>
<a href="#l9.27"></a><span id="l9.27">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l9.28"></a><span id="l9.28">       &lt;/property&gt;</span>
<a href="#l9.29"></a><span id="l9.29">       &lt;property name=&quot;Item&quot;&gt;</span>
<a href="#l9.30"></a><span id="l9.30">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-            return mItem;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+          return mItem;</span>
<a href="#l9.33"></a><span id="l9.33">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l9.34"></a><span id="l9.34">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l9.35"></a><span id="l9.35">           this.mItem = val;</span>
<a href="#l9.36"></a><span id="l9.36">           let headerLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-label&quot;);</span>
<a href="#l9.37"></a><span id="l9.37">           let itemDateTimeLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-value&quot;);</span>
<a href="#l9.38"></a><span id="l9.38">           let date;</span>
<a href="#l9.39"></a><span id="l9.39">           if (this.mode == &quot;start&quot;) {</span>
<a href="#l9.40"></a><span id="l9.40">               date = this.mItem[calGetStartDateProp(this.mItem)];</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -60,17 +60,17 @@</span>
<a href="#l9.42"></a><span id="l9.42">                   }</span>
<a href="#l9.43"></a><span id="l9.43">                   headerLabel.value = label;</span>
<a href="#l9.44"></a><span id="l9.44">               }</span>
<a href="#l9.45"></a><span id="l9.45">           } else {</span>
<a href="#l9.46"></a><span id="l9.46">               date = this.mItem[calGetEndDateProp(this.mItem)];</span>
<a href="#l9.47"></a><span id="l9.47">               if (date) {</span>
<a href="#l9.48"></a><span id="l9.48">                   let label;</span>
<a href="#l9.49"></a><span id="l9.49">                   if (isToDo(this.mItem)) {</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-                          label = this.getAttribute(&quot;taskDueLabel&quot;);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+                      label = this.getAttribute(&quot;taskDueLabel&quot;);</span>
<a href="#l9.52"></a><span id="l9.52">                   } else {</span>
<a href="#l9.53"></a><span id="l9.53">                       label = this.getAttribute(&quot;eventEndLabel&quot;);</span>
<a href="#l9.54"></a><span id="l9.54">                   }</span>
<a href="#l9.55"></a><span id="l9.55">                   headerLabel.value = label;</span>
<a href="#l9.56"></a><span id="l9.56">               }</span>
<a href="#l9.57"></a><span id="l9.57">           }</span>
<a href="#l9.58"></a><span id="l9.58">           let hideLabels = (date == null);</span>
<a href="#l9.59"></a><span id="l9.59">           if (hideLabels) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-menus.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-menus.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,74 +1,74 @@</span>
<a href="#l10.4"></a><span id="l10.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-</span>
<a href="#l10.6"></a><span id="l10.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.7"></a><span id="l10.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.8"></a><span id="l10.8">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> &lt;!DOCTYPE bindings SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot;&gt;</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12"> &lt;bindings id=&quot;calendar-menu-bindings&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">- xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">- xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">- xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20">   &lt;binding id=&quot;task-menupopup&quot; extends=&quot;xul:menupopup&quot;&gt;</span>
<a href="#l10.21"></a><span id="l10.21">     &lt;implementation&gt;</span>
<a href="#l10.22"></a><span id="l10.22">       &lt;field name=&quot;mType&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l10.23"></a><span id="l10.23">       &lt;field name=&quot;mPopupHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l10.24"></a><span id="l10.24">       &lt;field name=&quot;mParentMenuPopup&quot;&gt;null&lt;/field&gt;</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+</span>
<a href="#l10.26"></a><span id="l10.26">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l10.27"></a><span id="l10.27">         this.mPopupHandler = () =&gt; { this.schangeMenuByPropertyName(); };</span>
<a href="#l10.28"></a><span id="l10.28">         this.mParentMenuPopup = getParentNodeOrThis(this, &quot;menupopup&quot;);</span>
<a href="#l10.29"></a><span id="l10.29">         this.mParentMenuPopup.addEventListener(&quot;popupshowing&quot;, this.mPopupHandler, true);</span>
<a href="#l10.30"></a><span id="l10.30">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+</span>
<a href="#l10.32"></a><span id="l10.32">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l10.33"></a><span id="l10.33">         this.mParentMenuPopup.removeEventListener(&quot;popupshowing&quot;, this.mPopupHandler, true);</span>
<a href="#l10.34"></a><span id="l10.34">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-&lt;!-- This method checks a command which naming follows</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">- *  the notation 'calendar_' +  mType + ' + '-' + propertyValue + 'command',</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">- *  when its propertyValue part matches the propertyValue of the selected tasks</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">- *  as long as the selected tasks share common propertyValues.</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">- * --&gt;</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+      &lt;!-- This method checks a command which naming follows</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+           the notation 'calendar_' +  mType + ' + '-' + propertyValue + 'command',</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+           when its propertyValue part matches the propertyValue of the selected tasks</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+           as long as the selected tasks share common propertyValues. --&gt;</span>
<a href="#l10.45"></a><span id="l10.45">       &lt;method name=&quot;changeMenuByPropertyName&quot;&gt;</span>
<a href="#l10.46"></a><span id="l10.46">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-            let liveList = document.getAnonymousNodes(this);</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-            for (let item of liveList) {</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-                let commandName = item.getAttribute(&quot;command&quot;);</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-                let command = document.getElementById(commandName);</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-                if (command) {</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-                    command.setAttribute(&quot;checked&quot;, &quot;false&quot;);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-                    item.setAttribute(&quot;checked&quot;, &quot;false&quot;);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-                }</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-            }</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-            let propertyValue;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-            if (gTabmail &amp;&amp; gTabmail.currentTabInfo.mode.type == &quot;calendarTask&quot;) {</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-                // We are in a task tab (editing a single task).</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-                propertyValue = gConfig[this.mType];</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-            } else {</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-                // We are in the Tasks tab.</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-                let tasks = getSelectedTasks();</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-                let tasksSelected = (tasks != null) &amp;&amp; (tasks.length &gt; 0);</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-                if (tasksSelected) {</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-                    let task = tasks[0];</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-                    if (isPropertyValueSame(tasks, this.mType)) {</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-                        propertyValue = task[this.mType];</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-                    }</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-                } else {</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-                    applyAttributeToMenuChildren(this, &quot;disabled&quot;, !tasksSelected);</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-                }</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-            }</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-            if (propertyValue || propertyValue == 0) {</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-                let command = document.getElementById(&quot;calendar_&quot; + this.mType + &quot;-&quot; + propertyValue + &quot;_command&quot;);</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-                if (command) {</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-                    command.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-                }</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-            }</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+          let liveList = document.getAnonymousNodes(this);</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+          for (let item of liveList) {</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+              let commandName = item.getAttribute(&quot;command&quot;);</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+              let command = document.getElementById(commandName);</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+              if (command) {</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+                  command.setAttribute(&quot;checked&quot;, &quot;false&quot;);</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+                  item.setAttribute(&quot;checked&quot;, &quot;false&quot;);</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+              }</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+          }</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+          let propertyValue;</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+          if (gTabmail &amp;&amp; gTabmail.currentTabInfo.mode.type == &quot;calendarTask&quot;) {</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+              // We are in a task tab (editing a single task).</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+              propertyValue = gConfig[this.mType];</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+          } else {</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+              // We are in the Tasks tab.</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+              let tasks = getSelectedTasks();</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+              let tasksSelected = (tasks != null) &amp;&amp; (tasks.length &gt; 0);</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+              if (tasksSelected) {</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+                  let task = tasks[0];</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+                  if (isPropertyValueSame(tasks, this.mType)) {</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+                      propertyValue = task[this.mType];</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+                  }</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+              } else {</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+                  applyAttributeToMenuChildren(this, &quot;disabled&quot;, !tasksSelected);</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+              }</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+          }</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+          if (propertyValue || propertyValue == 0) {</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+              let command = document.getElementById(&quot;calendar_&quot; + this.mType + &quot;-&quot; + propertyValue + &quot;_command&quot;);</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+              if (command) {</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+                  command.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+              }</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+          }</span>
<a href="#l10.111"></a><span id="l10.111">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.112"></a><span id="l10.112">       &lt;/method&gt;</span>
<a href="#l10.113"></a><span id="l10.113">     &lt;/implementation&gt;</span>
<a href="#l10.114"></a><span id="l10.114">    &lt;/binding&gt;</span>
<a href="#l10.115"></a><span id="l10.115"> </span>
<a href="#l10.116"></a><span id="l10.116">   &lt;binding id=&quot;task-progress-menupopup&quot; extends=&quot;chrome://calendar/content/calendar-menus.xml#task-menupopup&quot;&gt;</span>
<a href="#l10.117"></a><span id="l10.117">     &lt;content&gt;</span>
<a href="#l10.118"></a><span id="l10.118">       &lt;xul:menuitem anonid=&quot;percent-0-menuitem&quot;</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineat">@@ -100,50 +100,50 @@</span>
<a href="#l10.120"></a><span id="l10.120">                 label=&quot;&amp;progress.level.100;&quot;</span>
<a href="#l10.121"></a><span id="l10.121">                 accesskey=&quot;&amp;progress.level.100.accesskey;&quot;</span>
<a href="#l10.122"></a><span id="l10.122">                 observes=&quot;calendar_percentComplete-100_command&quot;</span>
<a href="#l10.123"></a><span id="l10.123">                 command=&quot;calendar_percentComplete-100_command&quot;/&gt;</span>
<a href="#l10.124"></a><span id="l10.124">       &lt;children/&gt;</span>
<a href="#l10.125"></a><span id="l10.125">     &lt;/content&gt;</span>
<a href="#l10.126"></a><span id="l10.126">     &lt;implementation&gt;</span>
<a href="#l10.127"></a><span id="l10.127">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineminus">-          this.mType = &quot;percentComplete&quot;;</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-          this.changeMenuByPropertyName();</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+        this.mType = &quot;percentComplete&quot;;</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+        this.changeMenuByPropertyName();</span>
<a href="#l10.132"></a><span id="l10.132">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l10.133"></a><span id="l10.133">     &lt;/implementation&gt;</span>
<a href="#l10.134"></a><span id="l10.134">    &lt;/binding&gt;</span>
<a href="#l10.135"></a><span id="l10.135"> </span>
<a href="#l10.136"></a><span id="l10.136">   &lt;binding id=&quot;task-priority-menupopup&quot; extends=&quot;chrome://calendar/content/calendar-menus.xml#task-menupopup&quot;&gt;</span>
<a href="#l10.137"></a><span id="l10.137">     &lt;content&gt;</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineminus">-          &lt;xul:menuitem id=&quot;priority-0-menuitem&quot;</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+      &lt;xul:menuitem id=&quot;priority-0-menuitem&quot;</span>
<a href="#l10.140"></a><span id="l10.140">                     type=&quot;checkbox&quot;</span>
<a href="#l10.141"></a><span id="l10.141">                     label=&quot;&amp;priority.level.none;&quot;</span>
<a href="#l10.142"></a><span id="l10.142">                     accesskey=&quot;&amp;priority.level.none.accesskey;&quot;</span>
<a href="#l10.143"></a><span id="l10.143">                     command=&quot;calendar_priority-0_command&quot;</span>
<a href="#l10.144"></a><span id="l10.144">                     observes=&quot;calendar_priority-0_command&quot;/&gt;</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-          &lt;xul:menuitem id=&quot;priority-9-menuitem&quot;</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+      &lt;xul:menuitem id=&quot;priority-9-menuitem&quot;</span>
<a href="#l10.147"></a><span id="l10.147">                     type=&quot;checkbox&quot;</span>
<a href="#l10.148"></a><span id="l10.148">                     label=&quot;&amp;priority.level.low;&quot;</span>
<a href="#l10.149"></a><span id="l10.149">                     accesskey=&quot;&amp;priority.level.low.accesskey;&quot;</span>
<a href="#l10.150"></a><span id="l10.150">                     command=&quot;calendar_priority-9_command&quot;</span>
<a href="#l10.151"></a><span id="l10.151">                     observes=&quot;calendar_priority-9_command&quot;/&gt;</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-          &lt;xul:menuitem id=&quot;priority-5-menuitem&quot;</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+      &lt;xul:menuitem id=&quot;priority-5-menuitem&quot;</span>
<a href="#l10.154"></a><span id="l10.154">                     type=&quot;checkbox&quot;</span>
<a href="#l10.155"></a><span id="l10.155">                     label=&quot;&amp;priority.level.normal;&quot;</span>
<a href="#l10.156"></a><span id="l10.156">                     accesskey=&quot;&amp;priority.level.normal.accesskey;&quot;</span>
<a href="#l10.157"></a><span id="l10.157">                     command=&quot;calendar_priority-5_command&quot;</span>
<a href="#l10.158"></a><span id="l10.158">                     observes=&quot;calendar_priority-5_command&quot;/&gt;</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineminus">-          &lt;xul:menuitem id=&quot;priority-1-menuitem&quot;</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineminus">-                    type=&quot;checkbox&quot;</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineminus">-                    label=&quot;&amp;priority.level.high;&quot;</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineminus">-                    accesskey=&quot;&amp;priority.level.high.accesskey;&quot;</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineminus">-                    command=&quot;calendar_priority-1_command&quot;</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-                    observes=&quot;calendar_priority-1_command&quot;/&gt;</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineminus">-      &lt;children/&gt;                    </span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-     &lt;/content&gt;</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+      &lt;xul:menuitem id=&quot;priority-1-menuitem&quot;</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineplus">+                type=&quot;checkbox&quot;</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+                label=&quot;&amp;priority.level.high;&quot;</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+                accesskey=&quot;&amp;priority.level.high.accesskey;&quot;</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+                command=&quot;calendar_priority-1_command&quot;</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+                observes=&quot;calendar_priority-1_command&quot;/&gt;</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+      &lt;children/&gt;</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l10.175"></a><span id="l10.175">     &lt;implementation&gt;</span>
<a href="#l10.176"></a><span id="l10.176">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineminus">-          this.mType = &quot;priority&quot;;</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineminus">-          this.changeMenuByPropertyName();</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+        this.mType = &quot;priority&quot;;</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+        this.changeMenuByPropertyName();</span>
<a href="#l10.181"></a><span id="l10.181">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l10.182"></a><span id="l10.182">     &lt;/implementation&gt;</span>
<a href="#l10.183"></a><span id="l10.183">    &lt;/binding&gt;</span>
<a href="#l10.184"></a><span id="l10.184"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,23 +1,22 @@</span>
<a href="#l11.4"></a><span id="l11.4"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l11.5"></a><span id="l11.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">---&gt;</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> &lt;!-- Note that this file depends on helper functions in calUtils.js--&gt;</span>
<a href="#l11.12"></a><span id="l11.12"> </span>
<a href="#l11.13"></a><span id="l11.13"> &lt;!DOCTYPE bindings SYSTEM &quot;chrome://global/locale/global.dtd&quot; &gt;</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> &lt;bindings id=&quot;calendar-month-view-bindings&quot;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-  xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-  xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-  xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">-  xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+          xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l11.24"></a><span id="l11.24"> </span>
<a href="#l11.25"></a><span id="l11.25">   &lt;binding id=&quot;calendar-month-day-box-item&quot; extends=&quot;chrome://calendar/content/calendar-view-core.xml#calendar-editable-item&quot;&gt;</span>
<a href="#l11.26"></a><span id="l11.26">     &lt;content mousethrough=&quot;never&quot; tooltip=&quot;itemTooltip&quot;&gt;</span>
<a href="#l11.27"></a><span id="l11.27">       &lt;xul:vbox flex=&quot;1&quot;&gt;</span>
<a href="#l11.28"></a><span id="l11.28">         &lt;xul:hbox&gt;</span>
<a href="#l11.29"></a><span id="l11.29">           &lt;xul:box anonid=&quot;event-container&quot;</span>
<a href="#l11.30"></a><span id="l11.30">                    class=&quot;calendar-color-box&quot;</span>
<a href="#l11.31"></a><span id="l11.31">                    xbl:inherits=&quot;calendar-uri,calendar-id&quot;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineat">@@ -69,49 +68,49 @@</span>
<a href="#l11.33"></a><span id="l11.33">             &lt;/xul:box&gt;</span>
<a href="#l11.34"></a><span id="l11.34">           &lt;/xul:box&gt;</span>
<a href="#l11.35"></a><span id="l11.35">         &lt;/xul:hbox&gt;</span>
<a href="#l11.36"></a><span id="l11.36">       &lt;/xul:vbox&gt;</span>
<a href="#l11.37"></a><span id="l11.37">     &lt;/content&gt;</span>
<a href="#l11.38"></a><span id="l11.38">     &lt;implementation&gt;</span>
<a href="#l11.39"></a><span id="l11.39">       &lt;property name=&quot;occurrence&quot;&gt;</span>
<a href="#l11.40"></a><span id="l11.40">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">-            return this.mOccurrence;</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+          return this.mOccurrence;</span>
<a href="#l11.43"></a><span id="l11.43">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l11.44"></a><span id="l11.44">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l11.45"></a><span id="l11.45">           ASSERT(!this.mOccurrence, &quot;Code changes needed to set the occurrence twice&quot;, true);</span>
<a href="#l11.46"></a><span id="l11.46">           this.mOccurrence = val;</span>
<a href="#l11.47"></a><span id="l11.47">           if (cal.isEvent(val)) {</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-            if (!val.startDate.isDate) {</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-              let label = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-label&quot;);</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-              let formatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-                                        .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-              let timezone = this.calendarView ? this.calendarView.mTimezone</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-                                               : calendarDefaultTimezone();</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-              let parentDate = ensureDateTime(this.parentBox.date);</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-              let startTime = val.startDate.getInTimezone(timezone);</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-              let endTime = val.endDate.getInTimezone(timezone);</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-              let nextDay = parentDate.clone();</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-              nextDay.day++;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-              let comp = endTime.compare(nextDay);</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-              if (startTime.compare(parentDate) == -1) {</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-                if (comp == 1) {</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-                  label.value = &quot;&quot;;</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-                } else if (comp == 0) {</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-                  label.value = &quot;&quot;;</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-                } else {</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-                  label.value = &quot; &quot; + formatter.formatTime(endTime);</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-                }</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-              } else if (comp == 1) {</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-                label.value = &quot; &quot; + formatter.formatTime(startTime);</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-              } else {</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-                label.value = formatter.formatTime(startTime);</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+              if (!val.startDate.isDate) {</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+                  let label = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-label&quot;);</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+                  let formatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+                                            .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+                  let timezone = this.calendarView ? this.calendarView.mTimezone</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+                                                   : calendarDefaultTimezone();</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+                  let parentDate = ensureDateTime(this.parentBox.date);</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+                  let startTime = val.startDate.getInTimezone(timezone);</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+                  let endTime = val.endDate.getInTimezone(timezone);</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+                  let nextDay = parentDate.clone();</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+                  nextDay.day++;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+                  let comp = endTime.compare(nextDay);</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+                  if (startTime.compare(parentDate) == -1) {</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+                      if (comp == 1) {</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+                          label.value = &quot;&quot;;</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+                      } else if (comp == 0) {</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+                          label.value = &quot;&quot;;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+                      } else {</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+                          label.value = &quot; &quot; + formatter.formatTime(endTime);</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+                      }</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+                  } else if (comp == 1) {</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+                      label.value = &quot; &quot; + formatter.formatTime(startTime);</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+                  } else {</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+                      label.value = formatter.formatTime(startTime);</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+                  }</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+                  label.setAttribute(&quot;time&quot;, &quot;true&quot;);</span>
<a href="#l11.98"></a><span id="l11.98">               }</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-              label.setAttribute(&quot;time&quot;, &quot;true&quot;);</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">-            }</span>
<a href="#l11.101"></a><span id="l11.101">           }</span>
<a href="#l11.102"></a><span id="l11.102"> </span>
<a href="#l11.103"></a><span id="l11.103">           this.setEditableLabel();</span>
<a href="#l11.104"></a><span id="l11.104">           this.setCSSClasses();</span>
<a href="#l11.105"></a><span id="l11.105">           return val;</span>
<a href="#l11.106"></a><span id="l11.106">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l11.107"></a><span id="l11.107">       &lt;/property&gt;</span>
<a href="#l11.108"></a><span id="l11.108">     &lt;/implementation&gt;</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineat">@@ -146,95 +145,95 @@</span>
<a href="#l11.110"></a><span id="l11.110">       &lt;property name=&quot;date&quot;</span>
<a href="#l11.111"></a><span id="l11.111">                 onget=&quot;return this.mDate&quot;</span>
<a href="#l11.112"></a><span id="l11.112">                 onset=&quot;this.setDate(val); return val;&quot;/&gt;</span>
<a href="#l11.113"></a><span id="l11.113"> </span>
<a href="#l11.114"></a><span id="l11.114">       &lt;property name=&quot;selected&quot;&gt;</span>
<a href="#l11.115"></a><span id="l11.115">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l11.116"></a><span id="l11.116">           let sel = this.getAttribute(&quot;selected&quot;);</span>
<a href="#l11.117"></a><span id="l11.117">           if (sel &amp;&amp; sel == &quot;true&quot;) {</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineminus">-            return true;</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+              return true;</span>
<a href="#l11.120"></a><span id="l11.120">           }</span>
<a href="#l11.121"></a><span id="l11.121"> </span>
<a href="#l11.122"></a><span id="l11.122">           return false;</span>
<a href="#l11.123"></a><span id="l11.123">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l11.124"></a><span id="l11.124">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l11.125"></a><span id="l11.125">           if (val) {</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-            this.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+              this.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l11.128"></a><span id="l11.128">           } else {</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-            this.removeAttribute(&quot;selected&quot;);</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+              this.removeAttribute(&quot;selected&quot;);</span>
<a href="#l11.131"></a><span id="l11.131">           }</span>
<a href="#l11.132"></a><span id="l11.132">           return val;</span>
<a href="#l11.133"></a><span id="l11.133">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l11.134"></a><span id="l11.134">       &lt;/property&gt;</span>
<a href="#l11.135"></a><span id="l11.135"> </span>
<a href="#l11.136"></a><span id="l11.136">       &lt;property name=&quot;dayitems&quot;&gt;</span>
<a href="#l11.137"></a><span id="l11.137">         &lt;getter&gt;return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;day-items&quot;);&lt;/getter&gt;</span>
<a href="#l11.138"></a><span id="l11.138">       &lt;/property&gt;</span>
<a href="#l11.139"></a><span id="l11.139"> </span>
<a href="#l11.140"></a><span id="l11.140">       &lt;property name=&quot;showMonthLabel&quot;&gt;</span>
<a href="#l11.141"></a><span id="l11.141">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l11.142"></a><span id="l11.142">           return this.mShowMonthLabel;</span>
<a href="#l11.143"></a><span id="l11.143">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l11.144"></a><span id="l11.144">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l11.145"></a><span id="l11.145">           if (this.mShowMonthLabel == val) {</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineminus">-            return val;</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineplus">+              return val;</span>
<a href="#l11.148"></a><span id="l11.148">           }</span>
<a href="#l11.149"></a><span id="l11.149">           this.mShowMonthLabel = val;</span>
<a href="#l11.150"></a><span id="l11.150"> </span>
<a href="#l11.151"></a><span id="l11.151">           if (!this.mDate) {</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineminus">-            return val;</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineplus">+              return val;</span>
<a href="#l11.154"></a><span id="l11.154">           }</span>
<a href="#l11.155"></a><span id="l11.155">           if (val) {</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineminus">-            this.setAttribute(&quot;value&quot;, getDateFormatter().formatDateWithoutYear(this.mDate));</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+              this.setAttribute(&quot;value&quot;, getDateFormatter().formatDateWithoutYear(this.mDate));</span>
<a href="#l11.158"></a><span id="l11.158">           } else {</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineminus">-            this.setAttribute(&quot;value&quot;, this.mDate.day);</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+              this.setAttribute(&quot;value&quot;, this.mDate.day);</span>
<a href="#l11.161"></a><span id="l11.161">           }</span>
<a href="#l11.162"></a><span id="l11.162">           return val;</span>
<a href="#l11.163"></a><span id="l11.163">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l11.164"></a><span id="l11.164">       &lt;/property&gt;</span>
<a href="#l11.165"></a><span id="l11.165"> </span>
<a href="#l11.166"></a><span id="l11.166">       &lt;method name=&quot;setDate&quot;&gt;</span>
<a href="#l11.167"></a><span id="l11.167">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l11.168"></a><span id="l11.168">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.169"></a><span id="l11.169">           if (!aDate) {</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineminus">-            throw Components.results.NS_ERROR_NULL_POINTER;</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+              throw Components.results.NS_ERROR_NULL_POINTER;</span>
<a href="#l11.172"></a><span id="l11.172">           }</span>
<a href="#l11.173"></a><span id="l11.173"> </span>
<a href="#l11.174"></a><span id="l11.174">           // Remove all the old events</span>
<a href="#l11.175"></a><span id="l11.175">           this.mItemHash = {};</span>
<a href="#l11.176"></a><span id="l11.176">           removeChildren(this);</span>
<a href="#l11.177"></a><span id="l11.177"> </span>
<a href="#l11.178"></a><span id="l11.178">           if (this.mDate &amp;&amp; this.mDate.compare(aDate) == 0) {</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineminus">-            return;</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+              return;</span>
<a href="#l11.181"></a><span id="l11.181">           }</span>
<a href="#l11.182"></a><span id="l11.182"> </span>
<a href="#l11.183"></a><span id="l11.183">           this.mDate = aDate;</span>
<a href="#l11.184"></a><span id="l11.184"> </span>
<a href="#l11.185"></a><span id="l11.185">           // Set up DOM attributes for custom CSS coloring.</span>
<a href="#l11.186"></a><span id="l11.186">           let weekTitle = cal.getWeekInfoService().getWeekTitle(aDate);</span>
<a href="#l11.187"></a><span id="l11.187">           this.setAttribute(&quot;year&quot;, aDate.year);</span>
<a href="#l11.188"></a><span id="l11.188">           this.setAttribute(&quot;month&quot;, aDate.month + 1);</span>
<a href="#l11.189"></a><span id="l11.189">           this.setAttribute(&quot;week&quot;, weekTitle);</span>
<a href="#l11.190"></a><span id="l11.190">           this.setAttribute(&quot;day&quot;, aDate.day);</span>
<a href="#l11.191"></a><span id="l11.191"> </span>
<a href="#l11.192"></a><span id="l11.192">           if (this.mShowMonthLabel) {</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineminus">-             let monthName = calGetString(&quot;dateFormat&quot;, &quot;month.&quot; + (aDate.month + 1) + &quot;.Mmm&quot;);</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineminus">-             this.setAttribute(&quot;value&quot;, aDate.day + &quot; &quot; + monthName);</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+              let monthName = calGetString(&quot;dateFormat&quot;, &quot;month.&quot; + (aDate.month + 1) + &quot;.Mmm&quot;);</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+              this.setAttribute(&quot;value&quot;, aDate.day + &quot; &quot; + monthName);</span>
<a href="#l11.197"></a><span id="l11.197">           } else {</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineminus">-             this.setAttribute(&quot;value&quot;, aDate.day);</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+              this.setAttribute(&quot;value&quot;, aDate.day);</span>
<a href="#l11.200"></a><span id="l11.200">           }</span>
<a href="#l11.201"></a><span id="l11.201">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.202"></a><span id="l11.202">       &lt;/method&gt;</span>
<a href="#l11.203"></a><span id="l11.203"> </span>
<a href="#l11.204"></a><span id="l11.204">       &lt;method name=&quot;addItem&quot;&gt;</span>
<a href="#l11.205"></a><span id="l11.205">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l11.206"></a><span id="l11.206">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.207"></a><span id="l11.207">           if (aItem.hashId in this.mItemHash) {</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineminus">-            this.deleteItem(aItem);</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+              this.deleteItem(aItem);</span>
<a href="#l11.210"></a><span id="l11.210">           }</span>
<a href="#l11.211"></a><span id="l11.211"> </span>
<a href="#l11.212"></a><span id="l11.212">           let box = createXULElement(&quot;calendar-month-day-box-item&quot;);</span>
<a href="#l11.213"></a><span id="l11.213">           let context = this.getAttribute(&quot;item-context&quot;) ||</span>
<a href="#l11.214"></a><span id="l11.214">                         this.getAttribute(&quot;context&quot;);</span>
<a href="#l11.215"></a><span id="l11.215">           box.setAttribute(&quot;context&quot;, context);</span>
<a href="#l11.216"></a><span id="l11.216">           box.setAttribute(&quot;calendar-uri&quot;, aItem.calendar.uri.spec);</span>
<a href="#l11.217"></a><span id="l11.217">           box.setAttribute(&quot;calendar-id&quot;, aItem.calendar.id);</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineat">@@ -250,37 +249,37 @@</span>
<a href="#l11.219"></a><span id="l11.219">           return box;</span>
<a href="#l11.220"></a><span id="l11.220">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.221"></a><span id="l11.221">       &lt;/method&gt;</span>
<a href="#l11.222"></a><span id="l11.222"> </span>
<a href="#l11.223"></a><span id="l11.223">       &lt;method name=&quot;selectItem&quot;&gt;</span>
<a href="#l11.224"></a><span id="l11.224">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l11.225"></a><span id="l11.225">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.226"></a><span id="l11.226">           if (aItem.hashId in this.mItemHash) {</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineminus">-            this.mItemHash[aItem.hashId].selected = true;</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineplus">+              this.mItemHash[aItem.hashId].selected = true;</span>
<a href="#l11.229"></a><span id="l11.229">           }</span>
<a href="#l11.230"></a><span id="l11.230">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.231"></a><span id="l11.231">       &lt;/method&gt;</span>
<a href="#l11.232"></a><span id="l11.232"> </span>
<a href="#l11.233"></a><span id="l11.233">       &lt;method name=&quot;unselectItem&quot;&gt;</span>
<a href="#l11.234"></a><span id="l11.234">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l11.235"></a><span id="l11.235">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.236"></a><span id="l11.236">           if (aItem.hashId in this.mItemHash) {</span>
<a href="#l11.237"></a><span id="l11.237" class="difflineminus">-            this.mItemHash[aItem.hashId].selected = false;</span>
<a href="#l11.238"></a><span id="l11.238" class="difflineplus">+              this.mItemHash[aItem.hashId].selected = false;</span>
<a href="#l11.239"></a><span id="l11.239">           }</span>
<a href="#l11.240"></a><span id="l11.240">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.241"></a><span id="l11.241">       &lt;/method&gt;</span>
<a href="#l11.242"></a><span id="l11.242"> </span>
<a href="#l11.243"></a><span id="l11.243">       &lt;method name=&quot;deleteItem&quot;&gt;</span>
<a href="#l11.244"></a><span id="l11.244">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l11.245"></a><span id="l11.245">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.246"></a><span id="l11.246">           if (aItem.hashId in this.mItemHash) {</span>
<a href="#l11.247"></a><span id="l11.247" class="difflineminus">-            let node = this.mItemHash[aItem.hashId];</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineminus">-            node.remove();</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineminus">-            delete this.mItemHash[aItem.hashId];</span>
<a href="#l11.250"></a><span id="l11.250" class="difflineplus">+              let node = this.mItemHash[aItem.hashId];</span>
<a href="#l11.251"></a><span id="l11.251" class="difflineplus">+              node.remove();</span>
<a href="#l11.252"></a><span id="l11.252" class="difflineplus">+              delete this.mItemHash[aItem.hashId];</span>
<a href="#l11.253"></a><span id="l11.253">           }</span>
<a href="#l11.254"></a><span id="l11.254">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.255"></a><span id="l11.255">       &lt;/method&gt;</span>
<a href="#l11.256"></a><span id="l11.256"> </span>
<a href="#l11.257"></a><span id="l11.257">       &lt;method name=&quot;onDropItem&quot;&gt;</span>
<a href="#l11.258"></a><span id="l11.258">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l11.259"></a><span id="l11.259">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.260"></a><span id="l11.260">           // When item's timezone is different than the default one, the</span>
<a href="#l11.261"></a><span id="l11.261" class="difflineat">@@ -299,33 +298,32 @@</span>
<a href="#l11.262"></a><span id="l11.262">               let dayDiff = start.subtractDate(startInDefaultTz);</span>
<a href="#l11.263"></a><span id="l11.263">               // Change the day where to drop the item.</span>
<a href="#l11.264"></a><span id="l11.264">               dayboxDate.addDuration(dayDiff);</span>
<a href="#l11.265"></a><span id="l11.265">           }</span>
<a href="#l11.266"></a><span id="l11.266"> </span>
<a href="#l11.267"></a><span id="l11.267">           return cal.moveItem(aItem, dayboxDate);</span>
<a href="#l11.268"></a><span id="l11.268">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.269"></a><span id="l11.269">       &lt;/method&gt;</span>
<a href="#l11.270"></a><span id="l11.270" class="difflineminus">-</span>
<a href="#l11.271"></a><span id="l11.271">     &lt;/implementation&gt;</span>
<a href="#l11.272"></a><span id="l11.272"> </span>
<a href="#l11.273"></a><span id="l11.273">     &lt;handlers&gt;</span>
<a href="#l11.274"></a><span id="l11.274">       &lt;handler event=&quot;mousedown&quot;&gt;&lt;![CDATA[</span>
<a href="#l11.275"></a><span id="l11.275">         event.stopPropagation();</span>
<a href="#l11.276"></a><span id="l11.276">         if (this.mDate) {</span>
<a href="#l11.277"></a><span id="l11.277" class="difflineminus">-          this.calendarView.selectedDay = this.mDate;</span>
<a href="#l11.278"></a><span id="l11.278" class="difflineplus">+            this.calendarView.selectedDay = this.mDate;</span>
<a href="#l11.279"></a><span id="l11.279">         }</span>
<a href="#l11.280"></a><span id="l11.280">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l11.281"></a><span id="l11.281">       &lt;handler event=&quot;dblclick&quot;&gt;&lt;![CDATA[</span>
<a href="#l11.282"></a><span id="l11.282">         event.stopPropagation();</span>
<a href="#l11.283"></a><span id="l11.283">         this.calendarView.controller.createNewEvent();</span>
<a href="#l11.284"></a><span id="l11.284">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l11.285"></a><span id="l11.285">       &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l11.286"></a><span id="l11.286">         if (!(event.ctrlKey || event.metaKey)) {</span>
<a href="#l11.287"></a><span id="l11.287" class="difflineminus">-          this.calendarView.setSelectedItems(0, []);</span>
<a href="#l11.288"></a><span id="l11.288" class="difflineplus">+            this.calendarView.setSelectedItems(0, []);</span>
<a href="#l11.289"></a><span id="l11.289">         }</span>
<a href="#l11.290"></a><span id="l11.290">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l11.291"></a><span id="l11.291">       &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l11.292"></a><span id="l11.292">         if (getParentNodeOrThisByAttribute(event.originalTarget, &quot;anonid&quot;, &quot;day-label&quot;) == null) {</span>
<a href="#l11.293"></a><span id="l11.293">             if (this.dayitems.scrollHeight &gt; this.dayitems.clientHeight) {</span>
<a href="#l11.294"></a><span id="l11.294">                 event.stopPropagation();</span>
<a href="#l11.295"></a><span id="l11.295">             }</span>
<a href="#l11.296"></a><span id="l11.296">         }</span>
<a href="#l11.297"></a><span id="l11.297" class="difflineat">@@ -407,38 +405,35 @@</span>
<a href="#l11.298"></a><span id="l11.298">               &lt;xul:calendar-month-day-box/&gt;</span>
<a href="#l11.299"></a><span id="l11.299">             &lt;/xul:row&gt;</span>
<a href="#l11.300"></a><span id="l11.300">           &lt;/xul:rows&gt;</span>
<a href="#l11.301"></a><span id="l11.301">         &lt;/xul:grid&gt;</span>
<a href="#l11.302"></a><span id="l11.302">       &lt;/xul:vbox&gt;</span>
<a href="#l11.303"></a><span id="l11.303">     &lt;/content&gt;</span>
<a href="#l11.304"></a><span id="l11.304"> </span>
<a href="#l11.305"></a><span id="l11.305">     &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l11.306"></a><span id="l11.306" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l11.307"></a><span id="l11.307" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l11.308"></a><span id="l11.308" class="difflineplus">+        Components.utils.import(&quot;resource://calendar/modules/calViewUtils.jsm&quot;);</span>
<a href="#l11.309"></a><span id="l11.309"> </span>
<a href="#l11.310"></a><span id="l11.310" class="difflineminus">-      &lt;!-- constructor --&gt;</span>
<a href="#l11.311"></a><span id="l11.311" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l11.312"></a><span id="l11.312" class="difflineminus">-          Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l11.313"></a><span id="l11.313" class="difflineminus">-          Components.utils.import(&quot;resource://calendar/modules/calViewUtils.jsm&quot;);</span>
<a href="#l11.314"></a><span id="l11.314" class="difflineminus">-</span>
<a href="#l11.315"></a><span id="l11.315" class="difflineminus">-          // Set the preference for the default start of the week</span>
<a href="#l11.316"></a><span id="l11.316" class="difflineminus">-          this.weekStartOffset = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l11.317"></a><span id="l11.317" class="difflineplus">+        // Set the preference for the default start of the week</span>
<a href="#l11.318"></a><span id="l11.318" class="difflineplus">+        this.weekStartOffset = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l11.319"></a><span id="l11.319"> </span>
<a href="#l11.320"></a><span id="l11.320" class="difflineminus">-          for (let i = 0; i &lt; 7; i++) {</span>
<a href="#l11.321"></a><span id="l11.321" class="difflineminus">-              let hdr = createXULElement(&quot;calendar-day-label&quot;);</span>
<a href="#l11.322"></a><span id="l11.322" class="difflineminus">-              this.labeldaybox.appendChild(hdr);</span>
<a href="#l11.323"></a><span id="l11.323" class="difflineminus">-              hdr.weekDay = (i + this.mWeekStartOffset) % 7;</span>
<a href="#l11.324"></a><span id="l11.324" class="difflineminus">-              hdr.shortWeekNames = false;</span>
<a href="#l11.325"></a><span id="l11.325" class="difflineminus">-          }</span>
<a href="#l11.326"></a><span id="l11.326" class="difflineplus">+        for (let i = 0; i &lt; 7; i++) {</span>
<a href="#l11.327"></a><span id="l11.327" class="difflineplus">+            let hdr = createXULElement(&quot;calendar-day-label&quot;);</span>
<a href="#l11.328"></a><span id="l11.328" class="difflineplus">+            this.labeldaybox.appendChild(hdr);</span>
<a href="#l11.329"></a><span id="l11.329" class="difflineplus">+            hdr.weekDay = (i + this.mWeekStartOffset) % 7;</span>
<a href="#l11.330"></a><span id="l11.330" class="difflineplus">+            hdr.shortWeekNames = false;</span>
<a href="#l11.331"></a><span id="l11.331" class="difflineplus">+        }</span>
<a href="#l11.332"></a><span id="l11.332"> </span>
<a href="#l11.333"></a><span id="l11.333" class="difflineminus">-          // Set the preference for displaying the week number</span>
<a href="#l11.334"></a><span id="l11.334" class="difflineminus">-          this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l11.335"></a><span id="l11.335" class="difflineplus">+        // Set the preference for displaying the week number</span>
<a href="#l11.336"></a><span id="l11.336" class="difflineplus">+        this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l11.337"></a><span id="l11.337">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l11.338"></a><span id="l11.338"> </span>
<a href="#l11.339"></a><span id="l11.339">       &lt;!-- fields --&gt;</span>
<a href="#l11.340"></a><span id="l11.340" class="difflineminus">-</span>
<a href="#l11.341"></a><span id="l11.341">       &lt;field name=&quot;mDateBoxes&quot;&gt;null&lt;/field&gt;</span>
<a href="#l11.342"></a><span id="l11.342">       &lt;field name=&quot;mSelectedDayBox&quot;&gt;null&lt;/field&gt;</span>
<a href="#l11.343"></a><span id="l11.343"> </span>
<a href="#l11.344"></a><span id="l11.344">       &lt;field name=&quot;mShowDaysOutsideMonth&quot;&gt;true&lt;/field&gt;</span>
<a href="#l11.345"></a><span id="l11.345">       &lt;field name=&quot;mShowFullMonth&quot;&gt;true&lt;/field&gt;</span>
<a href="#l11.346"></a><span id="l11.346">       &lt;field name=&quot;mShowWeekNumber&quot;&gt;true&lt;/field&gt;</span>
<a href="#l11.347"></a><span id="l11.347"> </span>
<a href="#l11.348"></a><span id="l11.348">       &lt;field name=&quot;mClickedTime&quot;&gt;null&lt;/field&gt;</span>
<a href="#l11.349"></a><span id="l11.349" class="difflineat">@@ -493,48 +488,48 @@</span>
<a href="#l11.350"></a><span id="l11.350">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l11.351"></a><span id="l11.351">       &lt;/property&gt;</span>
<a href="#l11.352"></a><span id="l11.352"> </span>
<a href="#l11.353"></a><span id="l11.353">       &lt;method name=&quot;handlePreference&quot;&gt;</span>
<a href="#l11.354"></a><span id="l11.354">         &lt;parameter name=&quot;aSubject&quot;/&gt;</span>
<a href="#l11.355"></a><span id="l11.355">         &lt;parameter name=&quot;aTopic&quot;/&gt;</span>
<a href="#l11.356"></a><span id="l11.356">         &lt;parameter name=&quot;aPreference&quot;/&gt;</span>
<a href="#l11.357"></a><span id="l11.357">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.358"></a><span id="l11.358" class="difflineminus">-           aSubject.QueryInterface(Components.interfaces.nsIPrefBranch);</span>
<a href="#l11.359"></a><span id="l11.359" class="difflineplus">+          aSubject.QueryInterface(Components.interfaces.nsIPrefBranch);</span>
<a href="#l11.360"></a><span id="l11.360"> </span>
<a href="#l11.361"></a><span id="l11.361" class="difflineminus">-           switch (aPreference) {</span>
<a href="#l11.362"></a><span id="l11.362" class="difflineminus">-               case &quot;calendar.previousweeks.inview&quot;:</span>
<a href="#l11.363"></a><span id="l11.363" class="difflineminus">-                   this.updateDaysOffPrefs();</span>
<a href="#l11.364"></a><span id="l11.364" class="difflineminus">-                   this.refreshView();</span>
<a href="#l11.365"></a><span id="l11.365" class="difflineminus">-                   break;</span>
<a href="#l11.366"></a><span id="l11.366" class="difflineplus">+          switch (aPreference) {</span>
<a href="#l11.367"></a><span id="l11.367" class="difflineplus">+              case &quot;calendar.previousweeks.inview&quot;:</span>
<a href="#l11.368"></a><span id="l11.368" class="difflineplus">+                  this.updateDaysOffPrefs();</span>
<a href="#l11.369"></a><span id="l11.369" class="difflineplus">+                  this.refreshView();</span>
<a href="#l11.370"></a><span id="l11.370" class="difflineplus">+                  break;</span>
<a href="#l11.371"></a><span id="l11.371"> </span>
<a href="#l11.372"></a><span id="l11.372" class="difflineminus">-               case &quot;calendar.week.start&quot;:</span>
<a href="#l11.373"></a><span id="l11.373" class="difflineminus">-                   this.weekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l11.374"></a><span id="l11.374" class="difflineminus">-                   // Refresh the view so the settings take effect</span>
<a href="#l11.375"></a><span id="l11.375" class="difflineminus">-                   this.refreshView();</span>
<a href="#l11.376"></a><span id="l11.376" class="difflineminus">-                   break;</span>
<a href="#l11.377"></a><span id="l11.377" class="difflineplus">+              case &quot;calendar.week.start&quot;:</span>
<a href="#l11.378"></a><span id="l11.378" class="difflineplus">+                  this.weekStartOffset = aSubject.getIntPref(aPreference);</span>
<a href="#l11.379"></a><span id="l11.379" class="difflineplus">+                  // Refresh the view so the settings take effect</span>
<a href="#l11.380"></a><span id="l11.380" class="difflineplus">+                  this.refreshView();</span>
<a href="#l11.381"></a><span id="l11.381" class="difflineplus">+                  break;</span>
<a href="#l11.382"></a><span id="l11.382"> </span>
<a href="#l11.383"></a><span id="l11.383" class="difflineminus">-               case &quot;calendar.weeks.inview&quot;:</span>
<a href="#l11.384"></a><span id="l11.384" class="difflineminus">-                   this.weeksInView = aSubject.getIntPref(aPreference);</span>
<a href="#l11.385"></a><span id="l11.385" class="difflineminus">-                   break;</span>
<a href="#l11.386"></a><span id="l11.386" class="difflineplus">+              case &quot;calendar.weeks.inview&quot;:</span>
<a href="#l11.387"></a><span id="l11.387" class="difflineplus">+                  this.weeksInView = aSubject.getIntPref(aPreference);</span>
<a href="#l11.388"></a><span id="l11.388" class="difflineplus">+                  break;</span>
<a href="#l11.389"></a><span id="l11.389"> </span>
<a href="#l11.390"></a><span id="l11.390" class="difflineminus">-               case &quot;calendar.view-minimonth.showWeekNumber&quot;:</span>
<a href="#l11.391"></a><span id="l11.391" class="difflineminus">-                   this.mShowWeekNumber = aSubject.getBoolPref(aPreference);</span>
<a href="#l11.392"></a><span id="l11.392" class="difflineminus">-                   if (this.mShowWeekNumber) {</span>
<a href="#l11.393"></a><span id="l11.393" class="difflineminus">-                       this.refreshView();</span>
<a href="#l11.394"></a><span id="l11.394" class="difflineminus">-                   } else {</span>
<a href="#l11.395"></a><span id="l11.395" class="difflineminus">-                       this.hideWeekNumbers();</span>
<a href="#l11.396"></a><span id="l11.396" class="difflineminus">-                   }</span>
<a href="#l11.397"></a><span id="l11.397" class="difflineminus">-                   break;</span>
<a href="#l11.398"></a><span id="l11.398" class="difflineplus">+              case &quot;calendar.view-minimonth.showWeekNumber&quot;:</span>
<a href="#l11.399"></a><span id="l11.399" class="difflineplus">+                  this.mShowWeekNumber = aSubject.getBoolPref(aPreference);</span>
<a href="#l11.400"></a><span id="l11.400" class="difflineplus">+                  if (this.mShowWeekNumber) {</span>
<a href="#l11.401"></a><span id="l11.401" class="difflineplus">+                      this.refreshView();</span>
<a href="#l11.402"></a><span id="l11.402" class="difflineplus">+                  } else {</span>
<a href="#l11.403"></a><span id="l11.403" class="difflineplus">+                      this.hideWeekNumbers();</span>
<a href="#l11.404"></a><span id="l11.404" class="difflineplus">+                  }</span>
<a href="#l11.405"></a><span id="l11.405" class="difflineplus">+                  break;</span>
<a href="#l11.406"></a><span id="l11.406"> </span>
<a href="#l11.407"></a><span id="l11.407" class="difflineminus">-               default:</span>
<a href="#l11.408"></a><span id="l11.408" class="difflineminus">-                   this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l11.409"></a><span id="l11.409" class="difflineminus">-                   break;</span>
<a href="#l11.410"></a><span id="l11.410" class="difflineminus">-           }</span>
<a href="#l11.411"></a><span id="l11.411" class="difflineminus">-           return;</span>
<a href="#l11.412"></a><span id="l11.412" class="difflineplus">+              default:</span>
<a href="#l11.413"></a><span id="l11.413" class="difflineplus">+                  this.handleCommonPreference(aSubject, aTopic, aPreference);</span>
<a href="#l11.414"></a><span id="l11.414" class="difflineplus">+                  break;</span>
<a href="#l11.415"></a><span id="l11.415" class="difflineplus">+          }</span>
<a href="#l11.416"></a><span id="l11.416" class="difflineplus">+          return;</span>
<a href="#l11.417"></a><span id="l11.417">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.418"></a><span id="l11.418">       &lt;/method&gt;</span>
<a href="#l11.419"></a><span id="l11.419"> </span>
<a href="#l11.420"></a><span id="l11.420">       &lt;method name=&quot;getSelectedItems&quot;&gt;</span>
<a href="#l11.421"></a><span id="l11.421">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l11.422"></a><span id="l11.422">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.423"></a><span id="l11.423">           aCount.value = this.mSelectedItems.length;</span>
<a href="#l11.424"></a><span id="l11.424">           return this.mSelectedItems;</span>
<a href="#l11.425"></a><span id="l11.425" class="difflineat">@@ -575,35 +570,35 @@</span>
<a href="#l11.426"></a><span id="l11.426">       &lt;method name=&quot;centerSelectedItems&quot;&gt;</span>
<a href="#l11.427"></a><span id="l11.427">         &lt;body&gt;</span>
<a href="#l11.428"></a><span id="l11.428">         &lt;/body&gt;</span>
<a href="#l11.429"></a><span id="l11.429">       &lt;/method&gt;</span>
<a href="#l11.430"></a><span id="l11.430"> </span>
<a href="#l11.431"></a><span id="l11.431">       &lt;property name=&quot;selectedDay&quot;&gt;</span>
<a href="#l11.432"></a><span id="l11.432">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l11.433"></a><span id="l11.433">           if (this.mSelectedDayBox) {</span>
<a href="#l11.434"></a><span id="l11.434" class="difflineminus">-            return this.mSelectedDayBox.date.clone();</span>
<a href="#l11.435"></a><span id="l11.435" class="difflineplus">+              return this.mSelectedDayBox.date.clone();</span>
<a href="#l11.436"></a><span id="l11.436">           }</span>
<a href="#l11.437"></a><span id="l11.437"> </span>
<a href="#l11.438"></a><span id="l11.438">           return null;</span>
<a href="#l11.439"></a><span id="l11.439">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l11.440"></a><span id="l11.440">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l11.441"></a><span id="l11.441">           if (this.mSelectedDayBox) {</span>
<a href="#l11.442"></a><span id="l11.442" class="difflineminus">-            this.mSelectedDayBox.selected = false;</span>
<a href="#l11.443"></a><span id="l11.443" class="difflineplus">+              this.mSelectedDayBox.selected = false;</span>
<a href="#l11.444"></a><span id="l11.444">           }</span>
<a href="#l11.445"></a><span id="l11.445"> </span>
<a href="#l11.446"></a><span id="l11.446">           let realVal = val;</span>
<a href="#l11.447"></a><span id="l11.447">           if (!realVal.isDate) {</span>
<a href="#l11.448"></a><span id="l11.448" class="difflineminus">-            realVal = val.clone();</span>
<a href="#l11.449"></a><span id="l11.449" class="difflineminus">-            realVal.isDate = true;</span>
<a href="#l11.450"></a><span id="l11.450" class="difflineplus">+              realVal = val.clone();</span>
<a href="#l11.451"></a><span id="l11.451" class="difflineplus">+              realVal.isDate = true;</span>
<a href="#l11.452"></a><span id="l11.452">           }</span>
<a href="#l11.453"></a><span id="l11.453">           let box = this.findDayBoxForDate(realVal);</span>
<a href="#l11.454"></a><span id="l11.454">           if (box) {</span>
<a href="#l11.455"></a><span id="l11.455" class="difflineminus">-            box.selected = true;</span>
<a href="#l11.456"></a><span id="l11.456" class="difflineminus">-            this.mSelectedDayBox = box;</span>
<a href="#l11.457"></a><span id="l11.457" class="difflineplus">+              box.selected = true;</span>
<a href="#l11.458"></a><span id="l11.458" class="difflineplus">+              this.mSelectedDayBox = box;</span>
<a href="#l11.459"></a><span id="l11.459">           }</span>
<a href="#l11.460"></a><span id="l11.460">           this.fireEvent(&quot;dayselect&quot;, realVal);</span>
<a href="#l11.461"></a><span id="l11.461">           return val;</span>
<a href="#l11.462"></a><span id="l11.462">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l11.463"></a><span id="l11.463">       &lt;/property&gt;</span>
<a href="#l11.464"></a><span id="l11.464"> </span>
<a href="#l11.465"></a><span id="l11.465">       &lt;property name=&quot;selectedDateTime&quot;&gt;</span>
<a href="#l11.466"></a><span id="l11.466">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l11.467"></a><span id="l11.467" class="difflineat">@@ -687,44 +682,44 @@</span>
<a href="#l11.468"></a><span id="l11.468"> </span>
<a href="#l11.469"></a><span id="l11.469">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.470"></a><span id="l11.470">       &lt;/method&gt;</span>
<a href="#l11.471"></a><span id="l11.471"> </span>
<a href="#l11.472"></a><span id="l11.472">       &lt;method name=&quot;getDateList&quot;&gt;</span>
<a href="#l11.473"></a><span id="l11.473">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l11.474"></a><span id="l11.474">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.475"></a><span id="l11.475">           if (!this.mStartDate || !this.mEndDate) {</span>
<a href="#l11.476"></a><span id="l11.476" class="difflineminus">-            aCount.value = 0;</span>
<a href="#l11.477"></a><span id="l11.477" class="difflineminus">-            return [];</span>
<a href="#l11.478"></a><span id="l11.478" class="difflineplus">+              aCount.value = 0;</span>
<a href="#l11.479"></a><span id="l11.479" class="difflineplus">+              return [];</span>
<a href="#l11.480"></a><span id="l11.480">           }</span>
<a href="#l11.481"></a><span id="l11.481"> </span>
<a href="#l11.482"></a><span id="l11.482">           let results = [];</span>
<a href="#l11.483"></a><span id="l11.483">           let curDate = this.mStartDate.clone();</span>
<a href="#l11.484"></a><span id="l11.484">           curDate.isDate = true;</span>
<a href="#l11.485"></a><span id="l11.485"> </span>
<a href="#l11.486"></a><span id="l11.486">           while (curDate.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l11.487"></a><span id="l11.487" class="difflineminus">-            results.push(curDate.clone());</span>
<a href="#l11.488"></a><span id="l11.488" class="difflineminus">-            curDate.day += 1;</span>
<a href="#l11.489"></a><span id="l11.489" class="difflineplus">+              results.push(curDate.clone());</span>
<a href="#l11.490"></a><span id="l11.490" class="difflineplus">+              curDate.day += 1;</span>
<a href="#l11.491"></a><span id="l11.491">           }</span>
<a href="#l11.492"></a><span id="l11.492">           aCount.value = results.length;</span>
<a href="#l11.493"></a><span id="l11.493">           return results;</span>
<a href="#l11.494"></a><span id="l11.494">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.495"></a><span id="l11.495">       &lt;/method&gt;</span>
<a href="#l11.496"></a><span id="l11.496"> </span>
<a href="#l11.497"></a><span id="l11.497">       &lt;!-- public properties and methods --&gt;</span>
<a href="#l11.498"></a><span id="l11.498"> </span>
<a href="#l11.499"></a><span id="l11.499">       &lt;!-- whether to show days outside of the current month --&gt;</span>
<a href="#l11.500"></a><span id="l11.500">       &lt;property name=&quot;showDaysOutsideMonth&quot;&gt;</span>
<a href="#l11.501"></a><span id="l11.501">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l11.502"></a><span id="l11.502">           return this.mShowDaysOutsideMonth;</span>
<a href="#l11.503"></a><span id="l11.503">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l11.504"></a><span id="l11.504">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l11.505"></a><span id="l11.505">           if (this.mShowDaysOutsideMonth != val) {</span>
<a href="#l11.506"></a><span id="l11.506" class="difflineminus">-            this.mShowDaysOutsideMonth = val;</span>
<a href="#l11.507"></a><span id="l11.507" class="difflineminus">-            this.refresh();</span>
<a href="#l11.508"></a><span id="l11.508" class="difflineplus">+              this.mShowDaysOutsideMonth = val;</span>
<a href="#l11.509"></a><span id="l11.509" class="difflineplus">+              this.refresh();</span>
<a href="#l11.510"></a><span id="l11.510">           }</span>
<a href="#l11.511"></a><span id="l11.511">           return val;</span>
<a href="#l11.512"></a><span id="l11.512">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l11.513"></a><span id="l11.513">       &lt;/property&gt;</span>
<a href="#l11.514"></a><span id="l11.514"> </span>
<a href="#l11.515"></a><span id="l11.515">       &lt;!-- private properties and methods --&gt;</span>
<a href="#l11.516"></a><span id="l11.516"> </span>
<a href="#l11.517"></a><span id="l11.517">       &lt;property name=&quot;monthgrid&quot; readonly=&quot;true&quot;</span>
<a href="#l11.518"></a><span id="l11.518" class="difflineat">@@ -732,36 +727,36 @@</span>
<a href="#l11.519"></a><span id="l11.519"> </span>
<a href="#l11.520"></a><span id="l11.520">       &lt;property name=&quot;monthgridrows&quot; readonly=&quot;true&quot;</span>
<a href="#l11.521"></a><span id="l11.521">                 onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'monthgridrows');&quot;/&gt;</span>
<a href="#l11.522"></a><span id="l11.522"> </span>
<a href="#l11.523"></a><span id="l11.523">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l11.524"></a><span id="l11.524">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.525"></a><span id="l11.525">           // Adjust headers based on the starting day of the week, if necessary</span>
<a href="#l11.526"></a><span id="l11.526">           if (this.labeldaybox.firstChild.weekDay != this.weekStartOffset) {</span>
<a href="#l11.527"></a><span id="l11.527" class="difflineminus">-            for (let i = 0; i &lt; this.labeldaybox.childNodes.length; i++) {</span>
<a href="#l11.528"></a><span id="l11.528" class="difflineminus">-              this.labeldaybox.childNodes[i].weekDay = (i + this.weekStartOffset) % 7;</span>
<a href="#l11.529"></a><span id="l11.529" class="difflineminus">-            }</span>
<a href="#l11.530"></a><span id="l11.530" class="difflineplus">+              for (let i = 0; i &lt; this.labeldaybox.childNodes.length; i++) {</span>
<a href="#l11.531"></a><span id="l11.531" class="difflineplus">+                  this.labeldaybox.childNodes[i].weekDay = (i + this.weekStartOffset) % 7;</span>
<a href="#l11.532"></a><span id="l11.532" class="difflineplus">+              }</span>
<a href="#l11.533"></a><span id="l11.533">           }</span>
<a href="#l11.534"></a><span id="l11.534"> </span>
<a href="#l11.535"></a><span id="l11.535">           if (this.mSelectedItems.length) {</span>
<a href="#l11.536"></a><span id="l11.536" class="difflineminus">-            this.mSelectedItems = [];</span>
<a href="#l11.537"></a><span id="l11.537" class="difflineplus">+              this.mSelectedItems = [];</span>
<a href="#l11.538"></a><span id="l11.538">           }</span>
<a href="#l11.539"></a><span id="l11.539"> </span>
<a href="#l11.540"></a><span id="l11.540">           if (!this.mStartDate || !this.mEndDate) {</span>
<a href="#l11.541"></a><span id="l11.541" class="difflineminus">-            throw Components.results.NS_ERROR_FAILURE;</span>
<a href="#l11.542"></a><span id="l11.542" class="difflineplus">+              throw Components.results.NS_ERROR_FAILURE;</span>
<a href="#l11.543"></a><span id="l11.543">           }</span>
<a href="#l11.544"></a><span id="l11.544"> </span>
<a href="#l11.545"></a><span id="l11.545">           // Days that are not in the main month on display are displayed with</span>
<a href="#l11.546"></a><span id="l11.546">           // a gray background.  Unless the month actually starts on a Sunday,</span>
<a href="#l11.547"></a><span id="l11.547">           // this means that mStartDate.month is 1 month less than the main month</span>
<a href="#l11.548"></a><span id="l11.548">           let mainMonth = this.mStartDate.month;</span>
<a href="#l11.549"></a><span id="l11.549">           if (this.mStartDate.day != 1) {</span>
<a href="#l11.550"></a><span id="l11.550" class="difflineminus">-            mainMonth++;</span>
<a href="#l11.551"></a><span id="l11.551" class="difflineminus">-            mainMonth = mainMonth % 12;</span>
<a href="#l11.552"></a><span id="l11.552" class="difflineplus">+              mainMonth++;</span>
<a href="#l11.553"></a><span id="l11.553" class="difflineplus">+              mainMonth = mainMonth % 12;</span>
<a href="#l11.554"></a><span id="l11.554">           }</span>
<a href="#l11.555"></a><span id="l11.555"> </span>
<a href="#l11.556"></a><span id="l11.556">           let dateBoxes = [];</span>
<a href="#l11.557"></a><span id="l11.557">           let today = this.today();</span>
<a href="#l11.558"></a><span id="l11.558"> </span>
<a href="#l11.559"></a><span id="l11.559">           // This gets set to true, telling us to collapse the rest of the rows</span>
<a href="#l11.560"></a><span id="l11.560">           let finished = false;</span>
<a href="#l11.561"></a><span id="l11.561">           let dateList = this.getDateList({});</span>
<a href="#l11.562"></a><span id="l11.562" class="difflineat">@@ -772,111 +767,111 @@</span>
<a href="#l11.563"></a><span id="l11.563"> </span>
<a href="#l11.564"></a><span id="l11.564">           let rows = this.monthgridrows.childNodes;</span>
<a href="#l11.565"></a><span id="l11.565"> </span>
<a href="#l11.566"></a><span id="l11.566">           // Iterate through each monthgridrow and set up the day-boxes that</span>
<a href="#l11.567"></a><span id="l11.567">           // are its child nodes.  Remember, childNodes is not a normal array,</span>
<a href="#l11.568"></a><span id="l11.568">           // so don't use the in operator if you don't want extra properties</span>
<a href="#l11.569"></a><span id="l11.569">           // coming out.</span>
<a href="#l11.570"></a><span id="l11.570">           for (let i = 0; i &lt; rows.length; i++) {</span>
<a href="#l11.571"></a><span id="l11.571" class="difflineminus">-            let row = rows[i];</span>
<a href="#l11.572"></a><span id="l11.572" class="difflineminus">-            // If we've already assigned all of the day-boxes that we need, just</span>
<a href="#l11.573"></a><span id="l11.573" class="difflineminus">-            // collapse the rest of the rows, otherwise expand them if needed.</span>
<a href="#l11.574"></a><span id="l11.574" class="difflineminus">-            if (finished) {</span>
<a href="#l11.575"></a><span id="l11.575" class="difflineminus">-              row.setAttribute(&quot;collapsed&quot;, true);</span>
<a href="#l11.576"></a><span id="l11.576" class="difflineminus">-              continue;</span>
<a href="#l11.577"></a><span id="l11.577" class="difflineminus">-            } else {</span>
<a href="#l11.578"></a><span id="l11.578" class="difflineminus">-              row.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l11.579"></a><span id="l11.579" class="difflineminus">-            }</span>
<a href="#l11.580"></a><span id="l11.580" class="difflineminus">-            for (let j = 0; j &lt; row.childNodes.length; j++) {</span>
<a href="#l11.581"></a><span id="l11.581" class="difflineminus">-              let daybox = row.childNodes[j];</span>
<a href="#l11.582"></a><span id="l11.582" class="difflineminus">-              let date = dateList[dateBoxes.length];</span>
<a href="#l11.583"></a><span id="l11.583" class="difflineplus">+              let row = rows[i];</span>
<a href="#l11.584"></a><span id="l11.584" class="difflineplus">+              // If we've already assigned all of the day-boxes that we need, just</span>
<a href="#l11.585"></a><span id="l11.585" class="difflineplus">+              // collapse the rest of the rows, otherwise expand them if needed.</span>
<a href="#l11.586"></a><span id="l11.586" class="difflineplus">+              if (finished) {</span>
<a href="#l11.587"></a><span id="l11.587" class="difflineplus">+                  row.setAttribute(&quot;collapsed&quot;, true);</span>
<a href="#l11.588"></a><span id="l11.588" class="difflineplus">+                  continue;</span>
<a href="#l11.589"></a><span id="l11.589" class="difflineplus">+              } else {</span>
<a href="#l11.590"></a><span id="l11.590" class="difflineplus">+                  row.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l11.591"></a><span id="l11.591" class="difflineplus">+              }</span>
<a href="#l11.592"></a><span id="l11.592" class="difflineplus">+              for (let j = 0; j &lt; row.childNodes.length; j++) {</span>
<a href="#l11.593"></a><span id="l11.593" class="difflineplus">+                  let daybox = row.childNodes[j];</span>
<a href="#l11.594"></a><span id="l11.594" class="difflineplus">+                  let date = dateList[dateBoxes.length];</span>
<a href="#l11.595"></a><span id="l11.595"> </span>
<a href="#l11.596"></a><span id="l11.596" class="difflineminus">-              // Remove the attribute &quot;relation&quot; for all the column headers.</span>
<a href="#l11.597"></a><span id="l11.597" class="difflineminus">-              // Consider only the first row index otherwise it will be</span>
<a href="#l11.598"></a><span id="l11.598" class="difflineminus">-              // removed again afterwards the correct setting.</span>
<a href="#l11.599"></a><span id="l11.599" class="difflineminus">-              if (i == 0) {</span>
<a href="#l11.600"></a><span id="l11.600" class="difflineminus">-                  this.labeldaybox.childNodes[j].removeAttribute(&quot;relation&quot;);</span>
<a href="#l11.601"></a><span id="l11.601" class="difflineminus">-              }</span>
<a href="#l11.602"></a><span id="l11.602" class="difflineplus">+                  // Remove the attribute &quot;relation&quot; for all the column headers.</span>
<a href="#l11.603"></a><span id="l11.603" class="difflineplus">+                  // Consider only the first row index otherwise it will be</span>
<a href="#l11.604"></a><span id="l11.604" class="difflineplus">+                  // removed again afterwards the correct setting.</span>
<a href="#l11.605"></a><span id="l11.605" class="difflineplus">+                  if (i == 0) {</span>
<a href="#l11.606"></a><span id="l11.606" class="difflineplus">+                      this.labeldaybox.childNodes[j].removeAttribute(&quot;relation&quot;);</span>
<a href="#l11.607"></a><span id="l11.607" class="difflineplus">+                  }</span>
<a href="#l11.608"></a><span id="l11.608"> </span>
<a href="#l11.609"></a><span id="l11.609" class="difflineminus">-              daybox.setAttribute(&quot;context&quot;, this.getAttribute(&quot;context&quot;));</span>
<a href="#l11.610"></a><span id="l11.610" class="difflineminus">-              daybox.setAttribute(&quot;item-context&quot;, this.getAttribute(&quot;item-context&quot;) || this.getAttribute(&quot;context&quot;));</span>
<a href="#l11.611"></a><span id="l11.611" class="difflineplus">+                  daybox.setAttribute(&quot;context&quot;, this.getAttribute(&quot;context&quot;));</span>
<a href="#l11.612"></a><span id="l11.612" class="difflineplus">+                  daybox.setAttribute(&quot;item-context&quot;, this.getAttribute(&quot;item-context&quot;) || this.getAttribute(&quot;context&quot;));</span>
<a href="#l11.613"></a><span id="l11.613"> </span>
<a href="#l11.614"></a><span id="l11.614" class="difflineminus">-              // Set the box-class depending on if this box displays a day in</span>
<a href="#l11.615"></a><span id="l11.615" class="difflineminus">-              // the month being currently shown or not.</span>
<a href="#l11.616"></a><span id="l11.616" class="difflineminus">-              let boxClass;</span>
<a href="#l11.617"></a><span id="l11.617" class="difflineminus">-              if (this.showFullMonth) {</span>
<a href="#l11.618"></a><span id="l11.618" class="difflineminus">-                  boxClass = &quot;calendar-month-day-box-&quot; +</span>
<a href="#l11.619"></a><span id="l11.619" class="difflineminus">-                             (mainMonth == date.month ? &quot;current-month&quot; : &quot;other-month&quot;);</span>
<a href="#l11.620"></a><span id="l11.620" class="difflineminus">-              } else {</span>
<a href="#l11.621"></a><span id="l11.621" class="difflineminus">-                  boxClass = &quot;calendar-month-day-box-current-month&quot;;</span>
<a href="#l11.622"></a><span id="l11.622" class="difflineminus">-              }</span>
<a href="#l11.623"></a><span id="l11.623" class="difflineminus">-              if (this.mDaysOffArray.some(dayOffNum =&gt; dayOffNum == date.weekday)) {</span>
<a href="#l11.624"></a><span id="l11.624" class="difflineminus">-                boxClass = &quot;calendar-month-day-box-day-off &quot; + boxClass;</span>
<a href="#l11.625"></a><span id="l11.625" class="difflineminus">-              }</span>
<a href="#l11.626"></a><span id="l11.626" class="difflineplus">+                  // Set the box-class depending on if this box displays a day in</span>
<a href="#l11.627"></a><span id="l11.627" class="difflineplus">+                  // the month being currently shown or not.</span>
<a href="#l11.628"></a><span id="l11.628" class="difflineplus">+                  let boxClass;</span>
<a href="#l11.629"></a><span id="l11.629" class="difflineplus">+                  if (this.showFullMonth) {</span>
<a href="#l11.630"></a><span id="l11.630" class="difflineplus">+                      boxClass = &quot;calendar-month-day-box-&quot; +</span>
<a href="#l11.631"></a><span id="l11.631" class="difflineplus">+                                 (mainMonth == date.month ? &quot;current-month&quot; : &quot;other-month&quot;);</span>
<a href="#l11.632"></a><span id="l11.632" class="difflineplus">+                  } else {</span>
<a href="#l11.633"></a><span id="l11.633" class="difflineplus">+                      boxClass = &quot;calendar-month-day-box-current-month&quot;;</span>
<a href="#l11.634"></a><span id="l11.634" class="difflineplus">+                  }</span>
<a href="#l11.635"></a><span id="l11.635" class="difflineplus">+                  if (this.mDaysOffArray.some(dayOffNum =&gt; dayOffNum == date.weekday)) {</span>
<a href="#l11.636"></a><span id="l11.636" class="difflineplus">+                      boxClass = &quot;calendar-month-day-box-day-off &quot; + boxClass;</span>
<a href="#l11.637"></a><span id="l11.637" class="difflineplus">+                  }</span>
<a href="#l11.638"></a><span id="l11.638"> </span>
<a href="#l11.639"></a><span id="l11.639" class="difflineminus">-              // Set up date relations</span>
<a href="#l11.640"></a><span id="l11.640" class="difflineminus">-              switch (date.compare(today)) {</span>
<a href="#l11.641"></a><span id="l11.641" class="difflineminus">-                  case -1:</span>
<a href="#l11.642"></a><span id="l11.642" class="difflineminus">-                      daybox.setAttribute(&quot;relation&quot;, &quot;past&quot;);</span>
<a href="#l11.643"></a><span id="l11.643" class="difflineminus">-                      break;</span>
<a href="#l11.644"></a><span id="l11.644" class="difflineminus">-                  case 0:</span>
<a href="#l11.645"></a><span id="l11.645" class="difflineminus">-                      daybox.setAttribute(&quot;relation&quot;, &quot;today&quot;);</span>
<a href="#l11.646"></a><span id="l11.646" class="difflineminus">-                      this.labeldaybox.childNodes[j].setAttribute(&quot;relation&quot;, &quot;today&quot;);</span>
<a href="#l11.647"></a><span id="l11.647" class="difflineminus">-                      break;</span>
<a href="#l11.648"></a><span id="l11.648" class="difflineminus">-                  case 1:</span>
<a href="#l11.649"></a><span id="l11.649" class="difflineminus">-                      daybox.setAttribute(&quot;relation&quot;, &quot;future&quot;);</span>
<a href="#l11.650"></a><span id="l11.650" class="difflineminus">-                      break;</span>
<a href="#l11.651"></a><span id="l11.651" class="difflineminus">-              }</span>
<a href="#l11.652"></a><span id="l11.652" class="difflineminus">-</span>
<a href="#l11.653"></a><span id="l11.653" class="difflineminus">-              // Set up label with the week number in the first day of the row.</span>
<a href="#l11.654"></a><span id="l11.654" class="difflineminus">-              if (this.mShowWeekNumber) {</span>
<a href="#l11.655"></a><span id="l11.655" class="difflineminus">-                let weekLabel = document.getAnonymousElementByAttribute(daybox, &quot;anonid&quot;, &quot;week-label&quot;);</span>
<a href="#l11.656"></a><span id="l11.656" class="difflineminus">-                if (weekLabelColumnPos &lt; 0) {</span>
<a href="#l11.657"></a><span id="l11.657" class="difflineminus">-                  let isDayOff = this.mDaysOffArray.includes((j + this.mWeekStartOffset) % 7);</span>
<a href="#l11.658"></a><span id="l11.658" class="difflineminus">-                  if (this.mDisplayDaysOff || !isDayOff) {</span>
<a href="#l11.659"></a><span id="l11.659" class="difflineminus">-                    weekLabelColumnPos = j;</span>
<a href="#l11.660"></a><span id="l11.660" class="difflineplus">+                  // Set up date relations</span>
<a href="#l11.661"></a><span id="l11.661" class="difflineplus">+                  switch (date.compare(today)) {</span>
<a href="#l11.662"></a><span id="l11.662" class="difflineplus">+                      case -1:</span>
<a href="#l11.663"></a><span id="l11.663" class="difflineplus">+                          daybox.setAttribute(&quot;relation&quot;, &quot;past&quot;);</span>
<a href="#l11.664"></a><span id="l11.664" class="difflineplus">+                          break;</span>
<a href="#l11.665"></a><span id="l11.665" class="difflineplus">+                      case 0:</span>
<a href="#l11.666"></a><span id="l11.666" class="difflineplus">+                          daybox.setAttribute(&quot;relation&quot;, &quot;today&quot;);</span>
<a href="#l11.667"></a><span id="l11.667" class="difflineplus">+                          this.labeldaybox.childNodes[j].setAttribute(&quot;relation&quot;, &quot;today&quot;);</span>
<a href="#l11.668"></a><span id="l11.668" class="difflineplus">+                          break;</span>
<a href="#l11.669"></a><span id="l11.669" class="difflineplus">+                      case 1:</span>
<a href="#l11.670"></a><span id="l11.670" class="difflineplus">+                          daybox.setAttribute(&quot;relation&quot;, &quot;future&quot;);</span>
<a href="#l11.671"></a><span id="l11.671" class="difflineplus">+                          break;</span>
<a href="#l11.672"></a><span id="l11.672">                   }</span>
<a href="#l11.673"></a><span id="l11.673" class="difflineminus">-                }</span>
<a href="#l11.674"></a><span id="l11.674" class="difflineminus">-                // Build and set the label.</span>
<a href="#l11.675"></a><span id="l11.675" class="difflineminus">-                if (j == weekLabelColumnPos) {</span>
<a href="#l11.676"></a><span id="l11.676" class="difflineminus">-                  weekLabel.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l11.677"></a><span id="l11.677" class="difflineminus">-                  let weekNumber = cal.getWeekInfoService().getWeekTitle(date);</span>
<a href="#l11.678"></a><span id="l11.678" class="difflineminus">-                  let weekString = cal.calGetString(&quot;calendar&quot;, &quot;abbreviationOfWeek&quot;, [weekNumber]);</span>
<a href="#l11.679"></a><span id="l11.679" class="difflineminus">-                  weekLabel.value = weekString;</span>
<a href="#l11.680"></a><span id="l11.680" class="difflineminus">-                } else {</span>
<a href="#l11.681"></a><span id="l11.681" class="difflineminus">-                  weekLabel.hidden = true;</span>
<a href="#l11.682"></a><span id="l11.682" class="difflineminus">-                }</span>
<a href="#l11.683"></a><span id="l11.683" class="difflineminus">-              }</span>
<a href="#l11.684"></a><span id="l11.684" class="difflineminus">-</span>
<a href="#l11.685"></a><span id="l11.685" class="difflineminus">-              daybox.setAttribute(&quot;class&quot;, boxClass);</span>
<a href="#l11.686"></a><span id="l11.686"> </span>
<a href="#l11.687"></a><span id="l11.687" class="difflineminus">-              daybox.setDate(date);</span>
<a href="#l11.688"></a><span id="l11.688" class="difflineminus">-              if (date.day == 1 || date.day == date.endOfMonth.day) {</span>
<a href="#l11.689"></a><span id="l11.689" class="difflineminus">-                daybox.showMonthLabel = true;</span>
<a href="#l11.690"></a><span id="l11.690" class="difflineminus">-              } else {</span>
<a href="#l11.691"></a><span id="l11.691" class="difflineminus">-                daybox.showMonthLabel = false;</span>
<a href="#l11.692"></a><span id="l11.692" class="difflineplus">+                  // Set up label with the week number in the first day of the row.</span>
<a href="#l11.693"></a><span id="l11.693" class="difflineplus">+                  if (this.mShowWeekNumber) {</span>
<a href="#l11.694"></a><span id="l11.694" class="difflineplus">+                      let weekLabel = document.getAnonymousElementByAttribute(daybox, &quot;anonid&quot;, &quot;week-label&quot;);</span>
<a href="#l11.695"></a><span id="l11.695" class="difflineplus">+                      if (weekLabelColumnPos &lt; 0) {</span>
<a href="#l11.696"></a><span id="l11.696" class="difflineplus">+                          let isDayOff = this.mDaysOffArray.includes((j + this.mWeekStartOffset) % 7);</span>
<a href="#l11.697"></a><span id="l11.697" class="difflineplus">+                          if (this.mDisplayDaysOff || !isDayOff) {</span>
<a href="#l11.698"></a><span id="l11.698" class="difflineplus">+                              weekLabelColumnPos = j;</span>
<a href="#l11.699"></a><span id="l11.699" class="difflineplus">+                          }</span>
<a href="#l11.700"></a><span id="l11.700" class="difflineplus">+                      }</span>
<a href="#l11.701"></a><span id="l11.701" class="difflineplus">+                      // Build and set the label.</span>
<a href="#l11.702"></a><span id="l11.702" class="difflineplus">+                      if (j == weekLabelColumnPos) {</span>
<a href="#l11.703"></a><span id="l11.703" class="difflineplus">+                          weekLabel.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l11.704"></a><span id="l11.704" class="difflineplus">+                          let weekNumber = cal.getWeekInfoService().getWeekTitle(date);</span>
<a href="#l11.705"></a><span id="l11.705" class="difflineplus">+                          let weekString = cal.calGetString(&quot;calendar&quot;, &quot;abbreviationOfWeek&quot;, [weekNumber]);</span>
<a href="#l11.706"></a><span id="l11.706" class="difflineplus">+                          weekLabel.value = weekString;</span>
<a href="#l11.707"></a><span id="l11.707" class="difflineplus">+                      } else {</span>
<a href="#l11.708"></a><span id="l11.708" class="difflineplus">+                          weekLabel.hidden = true;</span>
<a href="#l11.709"></a><span id="l11.709" class="difflineplus">+                      }</span>
<a href="#l11.710"></a><span id="l11.710" class="difflineplus">+                  }</span>
<a href="#l11.711"></a><span id="l11.711" class="difflineplus">+</span>
<a href="#l11.712"></a><span id="l11.712" class="difflineplus">+                  daybox.setAttribute(&quot;class&quot;, boxClass);</span>
<a href="#l11.713"></a><span id="l11.713" class="difflineplus">+</span>
<a href="#l11.714"></a><span id="l11.714" class="difflineplus">+                  daybox.setDate(date);</span>
<a href="#l11.715"></a><span id="l11.715" class="difflineplus">+                  if (date.day == 1 || date.day == date.endOfMonth.day) {</span>
<a href="#l11.716"></a><span id="l11.716" class="difflineplus">+                      daybox.showMonthLabel = true;</span>
<a href="#l11.717"></a><span id="l11.717" class="difflineplus">+                  } else {</span>
<a href="#l11.718"></a><span id="l11.718" class="difflineplus">+                      daybox.showMonthLabel = false;</span>
<a href="#l11.719"></a><span id="l11.719" class="difflineplus">+                  }</span>
<a href="#l11.720"></a><span id="l11.720" class="difflineplus">+                  daybox.calendarView = this;</span>
<a href="#l11.721"></a><span id="l11.721" class="difflineplus">+                  daybox.date = date;</span>
<a href="#l11.722"></a><span id="l11.722" class="difflineplus">+                  dateBoxes.push(daybox);</span>
<a href="#l11.723"></a><span id="l11.723" class="difflineplus">+</span>
<a href="#l11.724"></a><span id="l11.724" class="difflineplus">+                  // If we've now assigned all of our dates, set this to true so we</span>
<a href="#l11.725"></a><span id="l11.725" class="difflineplus">+                  // know we can just collapse the rest of the rows.</span>
<a href="#l11.726"></a><span id="l11.726" class="difflineplus">+                  if (dateBoxes.length == dateList.length) {</span>
<a href="#l11.727"></a><span id="l11.727" class="difflineplus">+                      finished = true;</span>
<a href="#l11.728"></a><span id="l11.728" class="difflineplus">+                  }</span>
<a href="#l11.729"></a><span id="l11.729">               }</span>
<a href="#l11.730"></a><span id="l11.730" class="difflineminus">-              daybox.calendarView = this;</span>
<a href="#l11.731"></a><span id="l11.731" class="difflineminus">-              daybox.date = date;</span>
<a href="#l11.732"></a><span id="l11.732" class="difflineminus">-              dateBoxes.push(daybox);</span>
<a href="#l11.733"></a><span id="l11.733" class="difflineminus">-</span>
<a href="#l11.734"></a><span id="l11.734" class="difflineminus">-              // If we've now assigned all of our dates, set this to true so we</span>
<a href="#l11.735"></a><span id="l11.735" class="difflineminus">-              // know we can just collapse the rest of the rows.</span>
<a href="#l11.736"></a><span id="l11.736" class="difflineminus">-              if (dateBoxes.length == dateList.length) {</span>
<a href="#l11.737"></a><span id="l11.737" class="difflineminus">-                finished = true;</span>
<a href="#l11.738"></a><span id="l11.738" class="difflineminus">-              }</span>
<a href="#l11.739"></a><span id="l11.739" class="difflineminus">-            }</span>
<a href="#l11.740"></a><span id="l11.740">           }</span>
<a href="#l11.741"></a><span id="l11.741"> </span>
<a href="#l11.742"></a><span id="l11.742">           // If we're not showing a full month, then add a few extra labels to</span>
<a href="#l11.743"></a><span id="l11.743">           // help the user orient themselves in the view.</span>
<a href="#l11.744"></a><span id="l11.744">           if (!this.mShowFullMonth) {</span>
<a href="#l11.745"></a><span id="l11.745" class="difflineminus">-            dateBoxes[0].showMonthLabel = true;</span>
<a href="#l11.746"></a><span id="l11.746" class="difflineminus">-            dateBoxes[dateBoxes.length - 1].showMonthLabel = true;</span>
<a href="#l11.747"></a><span id="l11.747" class="difflineplus">+              dateBoxes[0].showMonthLabel = true;</span>
<a href="#l11.748"></a><span id="l11.748" class="difflineplus">+              dateBoxes[dateBoxes.length - 1].showMonthLabel = true;</span>
<a href="#l11.749"></a><span id="l11.749">           }</span>
<a href="#l11.750"></a><span id="l11.750"> </span>
<a href="#l11.751"></a><span id="l11.751">           // Store these, so that we can access them later</span>
<a href="#l11.752"></a><span id="l11.752">           this.mDateBoxes = dateBoxes;</span>
<a href="#l11.753"></a><span id="l11.753">           this.hideDaysOff();</span>
<a href="#l11.754"></a><span id="l11.754"> </span>
<a href="#l11.755"></a><span id="l11.755">           this.adjustWeekdayLength();</span>
<a href="#l11.756"></a><span id="l11.756"> </span>
<a href="#l11.757"></a><span id="l11.757" class="difflineat">@@ -902,49 +897,49 @@</span>
<a href="#l11.758"></a><span id="l11.758">           this.mToggleStatus = toggleStatus;</span>
<a href="#l11.759"></a><span id="l11.759">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.760"></a><span id="l11.760">       &lt;/method&gt;</span>
<a href="#l11.761"></a><span id="l11.761"> </span>
<a href="#l11.762"></a><span id="l11.762">       &lt;method name=&quot;hideWeekNumbers&quot;&gt;</span>
<a href="#l11.763"></a><span id="l11.763">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.764"></a><span id="l11.764">           let rows = this.monthgridrows.childNodes;</span>
<a href="#l11.765"></a><span id="l11.765">           for (let i = 0; i &lt; rows.length; i++) {</span>
<a href="#l11.766"></a><span id="l11.766" class="difflineminus">-            let row = rows[i];</span>
<a href="#l11.767"></a><span id="l11.767" class="difflineminus">-            for (let j = 0; j &lt; row.childNodes.length; j++) {</span>
<a href="#l11.768"></a><span id="l11.768" class="difflineminus">-              let daybox = row.childNodes[j];</span>
<a href="#l11.769"></a><span id="l11.769" class="difflineminus">-              let weekLabel = document.getAnonymousElementByAttribute(daybox, &quot;anonid&quot;, &quot;week-label&quot;);</span>
<a href="#l11.770"></a><span id="l11.770" class="difflineminus">-              weekLabel.hidden = true;</span>
<a href="#l11.771"></a><span id="l11.771" class="difflineminus">-            }</span>
<a href="#l11.772"></a><span id="l11.772" class="difflineplus">+              let row = rows[i];</span>
<a href="#l11.773"></a><span id="l11.773" class="difflineplus">+              for (let j = 0; j &lt; row.childNodes.length; j++) {</span>
<a href="#l11.774"></a><span id="l11.774" class="difflineplus">+                  let daybox = row.childNodes[j];</span>
<a href="#l11.775"></a><span id="l11.775" class="difflineplus">+                  let weekLabel = document.getAnonymousElementByAttribute(daybox, &quot;anonid&quot;, &quot;week-label&quot;);</span>
<a href="#l11.776"></a><span id="l11.776" class="difflineplus">+                  weekLabel.hidden = true;</span>
<a href="#l11.777"></a><span id="l11.777" class="difflineplus">+              }</span>
<a href="#l11.778"></a><span id="l11.778">           }</span>
<a href="#l11.779"></a><span id="l11.779">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.780"></a><span id="l11.780">       &lt;/method&gt;</span>
<a href="#l11.781"></a><span id="l11.781"> </span>
<a href="#l11.782"></a><span id="l11.782">       &lt;method name=&quot;hideDaysOff&quot;&gt;</span>
<a href="#l11.783"></a><span id="l11.783">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.784"></a><span id="l11.784">           let columns = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;monthgridcolumns&quot;).childNodes;</span>
<a href="#l11.785"></a><span id="l11.785">           let headerkids = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;labeldaybox&quot;).childNodes;</span>
<a href="#l11.786"></a><span id="l11.786">           for (let i = 0; i &lt; columns.length; i++) {</span>
<a href="#l11.787"></a><span id="l11.787" class="difflineminus">-            let dayForColumn = (i + this.mWeekStartOffset) % 7;</span>
<a href="#l11.788"></a><span id="l11.788" class="difflineminus">-            let dayOff = this.mDaysOffArray.includes(dayForColumn);</span>
<a href="#l11.789"></a><span id="l11.789" class="difflineminus">-            columns[i].collapsed = dayOff &amp;&amp; !this.mDisplayDaysOff;</span>
<a href="#l11.790"></a><span id="l11.790" class="difflineminus">-            headerkids[i].collapsed = dayOff &amp;&amp; !this.mDisplayDaysOff;</span>
<a href="#l11.791"></a><span id="l11.791" class="difflineplus">+              let dayForColumn = (i + this.mWeekStartOffset) % 7;</span>
<a href="#l11.792"></a><span id="l11.792" class="difflineplus">+              let dayOff = this.mDaysOffArray.includes(dayForColumn);</span>
<a href="#l11.793"></a><span id="l11.793" class="difflineplus">+              columns[i].collapsed = dayOff &amp;&amp; !this.mDisplayDaysOff;</span>
<a href="#l11.794"></a><span id="l11.794" class="difflineplus">+              headerkids[i].collapsed = dayOff &amp;&amp; !this.mDisplayDaysOff;</span>
<a href="#l11.795"></a><span id="l11.795">           }</span>
<a href="#l11.796"></a><span id="l11.796">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.797"></a><span id="l11.797">       &lt;/method&gt;</span>
<a href="#l11.798"></a><span id="l11.798"> </span>
<a href="#l11.799"></a><span id="l11.799">       &lt;method name=&quot;findDayBoxForDate&quot;&gt;</span>
<a href="#l11.800"></a><span id="l11.800">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l11.801"></a><span id="l11.801">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.802"></a><span id="l11.802">           if (!this.mDateBoxes) {</span>
<a href="#l11.803"></a><span id="l11.803" class="difflineminus">-            return null;</span>
<a href="#l11.804"></a><span id="l11.804" class="difflineplus">+              return null;</span>
<a href="#l11.805"></a><span id="l11.805">           }</span>
<a href="#l11.806"></a><span id="l11.806">           for (let box of this.mDateBoxes) {</span>
<a href="#l11.807"></a><span id="l11.807" class="difflineminus">-            if (box.mDate.compare(aDate) == 0) {</span>
<a href="#l11.808"></a><span id="l11.808" class="difflineminus">-              return box;</span>
<a href="#l11.809"></a><span id="l11.809" class="difflineminus">-            }</span>
<a href="#l11.810"></a><span id="l11.810" class="difflineplus">+              if (box.mDate.compare(aDate) == 0) {</span>
<a href="#l11.811"></a><span id="l11.811" class="difflineplus">+                  return box;</span>
<a href="#l11.812"></a><span id="l11.812" class="difflineplus">+              }</span>
<a href="#l11.813"></a><span id="l11.813">           }</span>
<a href="#l11.814"></a><span id="l11.814">           return null;</span>
<a href="#l11.815"></a><span id="l11.815">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.816"></a><span id="l11.816">       &lt;/method&gt;</span>
<a href="#l11.817"></a><span id="l11.817"> </span>
<a href="#l11.818"></a><span id="l11.818">       &lt;method name=&quot;findDayBoxesForItem&quot;&gt;</span>
<a href="#l11.819"></a><span id="l11.819">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l11.820"></a><span id="l11.820">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.821"></a><span id="l11.821" class="difflineat">@@ -964,47 +959,47 @@</span>
<a href="#l11.822"></a><span id="l11.822">               }</span>
<a href="#l11.823"></a><span id="l11.823">           }</span>
<a href="#l11.824"></a><span id="l11.824"> </span>
<a href="#l11.825"></a><span id="l11.825">           if (!targetDate) {</span>
<a href="#l11.826"></a><span id="l11.826">               return boxes;</span>
<a href="#l11.827"></a><span id="l11.827">           }</span>
<a href="#l11.828"></a><span id="l11.828"> </span>
<a href="#l11.829"></a><span id="l11.829">           if (!finishDate) {</span>
<a href="#l11.830"></a><span id="l11.830" class="difflineminus">-            let maybeBox = this.findDayBoxForDate(targetDate);</span>
<a href="#l11.831"></a><span id="l11.831" class="difflineminus">-            if (maybeBox) {</span>
<a href="#l11.832"></a><span id="l11.832" class="difflineminus">-              boxes.push(maybeBox);</span>
<a href="#l11.833"></a><span id="l11.833" class="difflineminus">-            }</span>
<a href="#l11.834"></a><span id="l11.834" class="difflineminus">-            return boxes;</span>
<a href="#l11.835"></a><span id="l11.835" class="difflineplus">+              let maybeBox = this.findDayBoxForDate(targetDate);</span>
<a href="#l11.836"></a><span id="l11.836" class="difflineplus">+              if (maybeBox) {</span>
<a href="#l11.837"></a><span id="l11.837" class="difflineplus">+                  boxes.push(maybeBox);</span>
<a href="#l11.838"></a><span id="l11.838" class="difflineplus">+              }</span>
<a href="#l11.839"></a><span id="l11.839" class="difflineplus">+              return boxes;</span>
<a href="#l11.840"></a><span id="l11.840">           }</span>
<a href="#l11.841"></a><span id="l11.841"> </span>
<a href="#l11.842"></a><span id="l11.842">           if (!targetDate.isDate) {</span>
<a href="#l11.843"></a><span id="l11.843" class="difflineminus">-            // Reset the time to 00:00, so that we really get all the boxes</span>
<a href="#l11.844"></a><span id="l11.844" class="difflineminus">-            targetDate.hour = 0;</span>
<a href="#l11.845"></a><span id="l11.845" class="difflineminus">-            targetDate.minute = 0;</span>
<a href="#l11.846"></a><span id="l11.846" class="difflineminus">-            targetDate.second = 0;</span>
<a href="#l11.847"></a><span id="l11.847" class="difflineplus">+              // Reset the time to 00:00, so that we really get all the boxes</span>
<a href="#l11.848"></a><span id="l11.848" class="difflineplus">+              targetDate.hour = 0;</span>
<a href="#l11.849"></a><span id="l11.849" class="difflineplus">+              targetDate.minute = 0;</span>
<a href="#l11.850"></a><span id="l11.850" class="difflineplus">+              targetDate.second = 0;</span>
<a href="#l11.851"></a><span id="l11.851">           }</span>
<a href="#l11.852"></a><span id="l11.852"> </span>
<a href="#l11.853"></a><span id="l11.853">           if (targetDate.compare(finishDate) == 0) {</span>
<a href="#l11.854"></a><span id="l11.854">               // We have also to handle zero length events in particular for</span>
<a href="#l11.855"></a><span id="l11.855">               // tasks without entry or due date.</span>
<a href="#l11.856"></a><span id="l11.856">               let box = this.findDayBoxForDate(targetDate);</span>
<a href="#l11.857"></a><span id="l11.857">               if (box) {</span>
<a href="#l11.858"></a><span id="l11.858">                   boxes.push(box);</span>
<a href="#l11.859"></a><span id="l11.859">               }</span>
<a href="#l11.860"></a><span id="l11.860">           }</span>
<a href="#l11.861"></a><span id="l11.861"> </span>
<a href="#l11.862"></a><span id="l11.862">           while (targetDate.compare(finishDate) == -1) {</span>
<a href="#l11.863"></a><span id="l11.863" class="difflineminus">-            let box = this.findDayBoxForDate(targetDate);</span>
<a href="#l11.864"></a><span id="l11.864" class="difflineplus">+              let box = this.findDayBoxForDate(targetDate);</span>
<a href="#l11.865"></a><span id="l11.865"> </span>
<a href="#l11.866"></a><span id="l11.866" class="difflineminus">-            // This might not exist, if the event spans the view start or end</span>
<a href="#l11.867"></a><span id="l11.867" class="difflineminus">-            if (box) {</span>
<a href="#l11.868"></a><span id="l11.868" class="difflineminus">-                boxes.push(box);</span>
<a href="#l11.869"></a><span id="l11.869" class="difflineminus">-            }</span>
<a href="#l11.870"></a><span id="l11.870" class="difflineminus">-            targetDate.day += 1;</span>
<a href="#l11.871"></a><span id="l11.871" class="difflineplus">+              // This might not exist, if the event spans the view start or end</span>
<a href="#l11.872"></a><span id="l11.872" class="difflineplus">+              if (box) {</span>
<a href="#l11.873"></a><span id="l11.873" class="difflineplus">+                  boxes.push(box);</span>
<a href="#l11.874"></a><span id="l11.874" class="difflineplus">+              }</span>
<a href="#l11.875"></a><span id="l11.875" class="difflineplus">+              targetDate.day += 1;</span>
<a href="#l11.876"></a><span id="l11.876">           }</span>
<a href="#l11.877"></a><span id="l11.877"> </span>
<a href="#l11.878"></a><span id="l11.878">           return boxes;</span>
<a href="#l11.879"></a><span id="l11.879"> 	]]&gt;&lt;/body&gt;</span>
<a href="#l11.880"></a><span id="l11.880">       &lt;/method&gt;</span>
<a href="#l11.881"></a><span id="l11.881"> </span>
<a href="#l11.882"></a><span id="l11.882">       &lt;method name=&quot;doAddItem&quot;&gt;</span>
<a href="#l11.883"></a><span id="l11.883">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l11.884"></a><span id="l11.884" class="difflineat">@@ -1047,65 +1042,65 @@</span>
<a href="#l11.885"></a><span id="l11.885">           }</span>
<a href="#l11.886"></a><span id="l11.886">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.887"></a><span id="l11.887">       &lt;/method&gt;</span>
<a href="#l11.888"></a><span id="l11.888"> </span>
<a href="#l11.889"></a><span id="l11.889">       &lt;method name=&quot;deleteItemsFromCalendar&quot;&gt;</span>
<a href="#l11.890"></a><span id="l11.890">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l11.891"></a><span id="l11.891">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.892"></a><span id="l11.892">           if (!this.mDateBoxes) {</span>
<a href="#l11.893"></a><span id="l11.893" class="difflineminus">-            return;</span>
<a href="#l11.894"></a><span id="l11.894" class="difflineplus">+              return;</span>
<a href="#l11.895"></a><span id="l11.895">           }</span>
<a href="#l11.896"></a><span id="l11.896">           for (let box of this.mDateBoxes) {</span>
<a href="#l11.897"></a><span id="l11.897" class="difflineminus">-            for (let id in box.mItemHash) {</span>
<a href="#l11.898"></a><span id="l11.898" class="difflineminus">-              let node = box.mItemHash[id];</span>
<a href="#l11.899"></a><span id="l11.899" class="difflineminus">-              let item = node.item;</span>
<a href="#l11.900"></a><span id="l11.900" class="difflineminus">-              if (item.calendar.id == aCalendar.id) {</span>
<a href="#l11.901"></a><span id="l11.901" class="difflineminus">-                box.deleteItem(item);</span>
<a href="#l11.902"></a><span id="l11.902" class="difflineplus">+              for (let id in box.mItemHash) {</span>
<a href="#l11.903"></a><span id="l11.903" class="difflineplus">+                  let node = box.mItemHash[id];</span>
<a href="#l11.904"></a><span id="l11.904" class="difflineplus">+                  let item = node.item;</span>
<a href="#l11.905"></a><span id="l11.905" class="difflineplus">+                  if (item.calendar.id == aCalendar.id) {</span>
<a href="#l11.906"></a><span id="l11.906" class="difflineplus">+                      box.deleteItem(item);</span>
<a href="#l11.907"></a><span id="l11.907" class="difflineplus">+                  }</span>
<a href="#l11.908"></a><span id="l11.908">               }</span>
<a href="#l11.909"></a><span id="l11.909" class="difflineminus">-            }</span>
<a href="#l11.910"></a><span id="l11.910">           }</span>
<a href="#l11.911"></a><span id="l11.911">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.912"></a><span id="l11.912">       &lt;/method&gt;</span>
<a href="#l11.913"></a><span id="l11.913"> </span>
<a href="#l11.914"></a><span id="l11.914">       &lt;method name=&quot;flashAlarm&quot;&gt;</span>
<a href="#l11.915"></a><span id="l11.915">         &lt;parameter name=&quot;aAlarmItem&quot;/&gt;</span>
<a href="#l11.916"></a><span id="l11.916">         &lt;parameter name=&quot;aStop&quot;/&gt;</span>
<a href="#l11.917"></a><span id="l11.917">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.918"></a><span id="l11.918">           let showIndicator = Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l11.919"></a><span id="l11.919">           let totaltime = Preferences.get(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l11.920"></a><span id="l11.920"> </span>
<a href="#l11.921"></a><span id="l11.921">           if (!aStop &amp;&amp; (!showIndicator || totaltime &lt; 1)) {</span>
<a href="#l11.922"></a><span id="l11.922" class="difflineminus">-            // No need to animate if the indicator should not be shown.</span>
<a href="#l11.923"></a><span id="l11.923" class="difflineminus">-            return;</span>
<a href="#l11.924"></a><span id="l11.924" class="difflineplus">+              // No need to animate if the indicator should not be shown.</span>
<a href="#l11.925"></a><span id="l11.925" class="difflineplus">+              return;</span>
<a href="#l11.926"></a><span id="l11.926">           }</span>
<a href="#l11.927"></a><span id="l11.927"> </span>
<a href="#l11.928"></a><span id="l11.928">           // Make sure the flashing attribute is set or reset on all visible</span>
<a href="#l11.929"></a><span id="l11.929">           // boxes.</span>
<a href="#l11.930"></a><span id="l11.930">           let boxes = this.findDayBoxesForItem(aAlarmItem);</span>
<a href="#l11.931"></a><span id="l11.931">           for (let box of boxes) {</span>
<a href="#l11.932"></a><span id="l11.932" class="difflineminus">-            for (let id in box.mItemHash) {</span>
<a href="#l11.933"></a><span id="l11.933" class="difflineminus">-              let itemData = box.mItemHash[id];</span>
<a href="#l11.934"></a><span id="l11.934" class="difflineminus">-              if (itemData.item.hasSameIds(aAlarmItem)) {</span>
<a href="#l11.935"></a><span id="l11.935" class="difflineminus">-                if (aStop) {</span>
<a href="#l11.936"></a><span id="l11.936" class="difflineminus">-                  itemData.removeAttribute(&quot;flashing&quot;);</span>
<a href="#l11.937"></a><span id="l11.937" class="difflineminus">-                } else {</span>
<a href="#l11.938"></a><span id="l11.938" class="difflineminus">-                  itemData.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l11.939"></a><span id="l11.939" class="difflineminus">-                }</span>
<a href="#l11.940"></a><span id="l11.940" class="difflineplus">+              for (let id in box.mItemHash) {</span>
<a href="#l11.941"></a><span id="l11.941" class="difflineplus">+                  let itemData = box.mItemHash[id];</span>
<a href="#l11.942"></a><span id="l11.942" class="difflineplus">+                  if (itemData.item.hasSameIds(aAlarmItem)) {</span>
<a href="#l11.943"></a><span id="l11.943" class="difflineplus">+                      if (aStop) {</span>
<a href="#l11.944"></a><span id="l11.944" class="difflineplus">+                          itemData.removeAttribute(&quot;flashing&quot;);</span>
<a href="#l11.945"></a><span id="l11.945" class="difflineplus">+                      } else {</span>
<a href="#l11.946"></a><span id="l11.946" class="difflineplus">+                          itemData.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l11.947"></a><span id="l11.947" class="difflineplus">+                      }</span>
<a href="#l11.948"></a><span id="l11.948" class="difflineplus">+                  }</span>
<a href="#l11.949"></a><span id="l11.949">               }</span>
<a href="#l11.950"></a><span id="l11.950" class="difflineminus">-            }</span>
<a href="#l11.951"></a><span id="l11.951">           }</span>
<a href="#l11.952"></a><span id="l11.952"> </span>
<a href="#l11.953"></a><span id="l11.953">           if (aStop) {</span>
<a href="#l11.954"></a><span id="l11.954" class="difflineminus">-            // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l11.955"></a><span id="l11.955" class="difflineminus">-            delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l11.956"></a><span id="l11.956" class="difflineplus">+              // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l11.957"></a><span id="l11.957" class="difflineplus">+              delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l11.958"></a><span id="l11.958">           } else {</span>
<a href="#l11.959"></a><span id="l11.959" class="difflineminus">-            // Set up a timer to stop the flashing after the total time.</span>
<a href="#l11.960"></a><span id="l11.960" class="difflineminus">-            this.mFlashingEvents[aAlarmItem.hashId] = aAlarmItem;</span>
<a href="#l11.961"></a><span id="l11.961" class="difflineminus">-            setTimeout(() =&gt; this.flashAlarm(aAlarmItem, true), totaltime);</span>
<a href="#l11.962"></a><span id="l11.962" class="difflineplus">+              // Set up a timer to stop the flashing after the total time.</span>
<a href="#l11.963"></a><span id="l11.963" class="difflineplus">+              this.mFlashingEvents[aAlarmItem.hashId] = aAlarmItem;</span>
<a href="#l11.964"></a><span id="l11.964" class="difflineplus">+              setTimeout(() =&gt; this.flashAlarm(aAlarmItem, true), totaltime);</span>
<a href="#l11.965"></a><span id="l11.965">           }</span>
<a href="#l11.966"></a><span id="l11.966">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.967"></a><span id="l11.967">       &lt;/method&gt;</span>
<a href="#l11.968"></a><span id="l11.968">     &lt;/implementation&gt;</span>
<a href="#l11.969"></a><span id="l11.969"> </span>
<a href="#l11.970"></a><span id="l11.970">     &lt;handlers&gt;</span>
<a href="#l11.971"></a><span id="l11.971">       &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l11.972"></a><span id="l11.972">         const pixelThreshold = 150;</span>
<a href="#l11.973"></a><span id="l11.973" class="difflineat">@@ -1133,11 +1128,10 @@</span>
<a href="#l11.974"></a><span id="l11.974">             }</span>
<a href="#l11.975"></a><span id="l11.975"> </span>
<a href="#l11.976"></a><span id="l11.976">             if (deltaView != 0) {</span>
<a href="#l11.977"></a><span id="l11.977">                 this.moveView(deltaView);</span>
<a href="#l11.978"></a><span id="l11.978">             }</span>
<a href="#l11.979"></a><span id="l11.979">         }</span>
<a href="#l11.980"></a><span id="l11.980">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l11.981"></a><span id="l11.981">     &lt;/handlers&gt;</span>
<a href="#l11.982"></a><span id="l11.982" class="difflineminus">-</span>
<a href="#l11.983"></a><span id="l11.983">   &lt;/binding&gt;</span>
<a href="#l11.984"></a><span id="l11.984"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,13 +1,12 @@</span>
<a href="#l12.4"></a><span id="l12.4"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l12.5"></a><span id="l12.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineminus">---&gt;</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> &lt;!-- Note that this file depends on helper functions in calUtils.js--&gt;</span>
<a href="#l12.12"></a><span id="l12.12"> </span>
<a href="#l12.13"></a><span id="l12.13"> &lt;!DOCTYPE bindings SYSTEM &quot;chrome://global/locale/global.dtd&quot; &gt;</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15"> &lt;bindings id=&quot;calendar-multiday-view-bindings&quot;</span>
<a href="#l12.16"></a><span id="l12.16">   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l12.17"></a><span id="l12.17">   xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineat">@@ -85,18 +84,18 @@</span>
<a href="#l12.19"></a><span id="l12.19">               this.relayout();</span>
<a href="#l12.20"></a><span id="l12.20">           }</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22">           return ret;</span>
<a href="#l12.23"></a><span id="l12.23">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.24"></a><span id="l12.24">       &lt;/method&gt;</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">       &lt;property name=&quot;pixelsPerMinute&quot;</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-        onget=&quot;return this.mPixPerMin&quot;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-        onset=&quot;if (this.mPixPerMin != val) { this.mPixPerMin = val; this.relayout(); } return val;&quot;/&gt;</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+                onget=&quot;return this.mPixPerMin&quot;</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+                onset=&quot;if (this.mPixPerMin != val) { this.mPixPerMin = val; this.relayout(); } return val;&quot;/&gt;</span>
<a href="#l12.31"></a><span id="l12.31"> </span>
<a href="#l12.32"></a><span id="l12.32">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l12.33"></a><span id="l12.33">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.34"></a><span id="l12.34">           let topbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;topbox&quot;);</span>
<a href="#l12.35"></a><span id="l12.35">           let orient = topbox.getAttribute(&quot;orient&quot;);</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37">           function makeTimeBox(timestr, size) {</span>
<a href="#l12.38"></a><span id="l12.38">               let box = createXULElement(&quot;box&quot;);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineat">@@ -174,24 +173,24 @@</span>
<a href="#l12.40"></a><span id="l12.40">   &lt;/binding&gt;</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42">   &lt;!--</span>
<a href="#l12.43"></a><span id="l12.43">      - A simple gripbar that is displayed at the start and end of an</span>
<a href="#l12.44"></a><span id="l12.44">      - event box.  Needs to handle being dragged and resizing the</span>
<a href="#l12.45"></a><span id="l12.45">      - event, thus changing its start/end time.</span>
<a href="#l12.46"></a><span id="l12.46">     --&gt;</span>
<a href="#l12.47"></a><span id="l12.47">   &lt;binding id=&quot;calendar-event-gripbar&quot;&gt;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-     &lt;content&gt;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-       &lt;xul:box anonid=&quot;thebox&quot;</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-                flex=&quot;1&quot;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-                pack=&quot;center&quot;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-                xbl:inherits=&quot;align=whichside&quot;&gt;</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-         &lt;xul:image xbl:inherits=&quot;class&quot;/&gt;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineminus">-       &lt;/xul:box&gt;</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineminus">-     &lt;/content&gt;</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+    &lt;content&gt;</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+      &lt;xul:box anonid=&quot;thebox&quot;</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+               flex=&quot;1&quot;</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+               pack=&quot;center&quot;</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+               xbl:inherits=&quot;align=whichside&quot;&gt;</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+        &lt;xul:image xbl:inherits=&quot;class&quot;/&gt;</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+      &lt;/xul:box&gt;</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l12.64"></a><span id="l12.64"> </span>
<a href="#l12.65"></a><span id="l12.65">     &lt;implementation&gt;</span>
<a href="#l12.66"></a><span id="l12.66">       &lt;property name=&quot;parentorient&quot;&gt;</span>
<a href="#l12.67"></a><span id="l12.67">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.68"></a><span id="l12.68">           return this.getAttribute(&quot;parentorient&quot;);</span>
<a href="#l12.69"></a><span id="l12.69">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.70"></a><span id="l12.70">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l12.71"></a><span id="l12.71">           let thebox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;thebox&quot;);</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineat">@@ -308,25 +307,25 @@</span>
<a href="#l12.73"></a><span id="l12.73">       &lt;field name=&quot;mSelected&quot;&gt;false&lt;/field&gt;</span>
<a href="#l12.74"></a><span id="l12.74">       &lt;property name=&quot;selected&quot;&gt;</span>
<a href="#l12.75"></a><span id="l12.75">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.76"></a><span id="l12.76">           return this.mSelected;</span>
<a href="#l12.77"></a><span id="l12.77">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.78"></a><span id="l12.78">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l12.79"></a><span id="l12.79">           this.mSelected = val;</span>
<a href="#l12.80"></a><span id="l12.80">           if (this.bgbox &amp;&amp; this.bgbox.hasChildNodes()) {</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineminus">-            let child = this.bgbox.firstChild;</span>
<a href="#l12.82"></a><span id="l12.82" class="difflineminus">-            while (child) {</span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-              if (val) {</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-                child.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineminus">-              } else {</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-                child.removeAttribute(&quot;selected&quot;);</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineplus">+              let child = this.bgbox.firstChild;</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+              while (child) {</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+                  if (val) {</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+                      child.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineplus">+                  } else {</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineplus">+                      child.removeAttribute(&quot;selected&quot;);</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+                  }</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+                  child = child.nextSibling;</span>
<a href="#l12.95"></a><span id="l12.95">               }</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineminus">-              child = child.nextSibling;</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineminus">-            }</span>
<a href="#l12.98"></a><span id="l12.98">           }</span>
<a href="#l12.99"></a><span id="l12.99">           return val;</span>
<a href="#l12.100"></a><span id="l12.100">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l12.101"></a><span id="l12.101">       &lt;/property&gt;</span>
<a href="#l12.102"></a><span id="l12.102"> </span>
<a href="#l12.103"></a><span id="l12.103">       &lt;property name=&quot;date&quot;&gt;</span>
<a href="#l12.104"></a><span id="l12.104">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.105"></a><span id="l12.105">           return this.mDate;</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineat">@@ -341,40 +340,34 @@</span>
<a href="#l12.107"></a><span id="l12.107">               }</span>
<a href="#l12.108"></a><span id="l12.108">           }</span>
<a href="#l12.109"></a><span id="l12.109"> </span>
<a href="#l12.110"></a><span id="l12.110">           return val;</span>
<a href="#l12.111"></a><span id="l12.111">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l12.112"></a><span id="l12.112">       &lt;/property&gt;</span>
<a href="#l12.113"></a><span id="l12.113"> </span>
<a href="#l12.114"></a><span id="l12.114">       &lt;property name=&quot;calendarView&quot;</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-        onget=&quot;return this.mCalendarView;&quot;</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineminus">-        onset=&quot;return (this.mCalendarView = val);&quot; /&gt;</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineminus">-</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineminus">-      &lt;property</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineminus">-        name=&quot;topbox&quot;</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineminus">-        readonly=&quot;true&quot;&gt;</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+                onget=&quot;return this.mCalendarView;&quot;</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+                onset=&quot;return (this.mCalendarView = val);&quot; /&gt;</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+      &lt;property name=&quot;topbox&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.125"></a><span id="l12.125">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.126"></a><span id="l12.126">           return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;topbox&quot;);</span>
<a href="#l12.127"></a><span id="l12.127">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.128"></a><span id="l12.128">       &lt;/property&gt;</span>
<a href="#l12.129"></a><span id="l12.129"> </span>
<a href="#l12.130"></a><span id="l12.130" class="difflineminus">-      &lt;property</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineminus">-        name=&quot;bgbox&quot;</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineminus">-        readonly=&quot;true&quot;&gt;</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+      &lt;property name=&quot;bgbox&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.134"></a><span id="l12.134">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.135"></a><span id="l12.135">           return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;bgbox&quot;);</span>
<a href="#l12.136"></a><span id="l12.136">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.137"></a><span id="l12.137">       &lt;/property&gt;</span>
<a href="#l12.138"></a><span id="l12.138"> </span>
<a href="#l12.139"></a><span id="l12.139">       &lt;field name=&quot;mFgboxes&quot;&gt;null&lt;/field&gt;</span>
<a href="#l12.140"></a><span id="l12.140">       &lt;field name=&quot;mMinDuration&quot;&gt;null&lt;/field&gt;</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-      &lt;property</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineminus">-        name=&quot;fgboxes&quot;</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineminus">-        readonly=&quot;true&quot;&gt;</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineplus">+      &lt;property name=&quot;fgboxes&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.145"></a><span id="l12.145">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.146"></a><span id="l12.146">           if (this.mFgboxes == null) {</span>
<a href="#l12.147"></a><span id="l12.147">               this.mFgboxes = {</span>
<a href="#l12.148"></a><span id="l12.148">                   box: document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;fgbox&quot;),</span>
<a href="#l12.149"></a><span id="l12.149">                   dragbox: document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;fgdragbox&quot;),</span>
<a href="#l12.150"></a><span id="l12.150">                   dragspacer: document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;fgdragspacer&quot;),</span>
<a href="#l12.151"></a><span id="l12.151">                   startlabel: document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;fgdragbox-startlabel&quot;),</span>
<a href="#l12.152"></a><span id="l12.152">                   endlabel: document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;fgdragbox-endlabel&quot;)</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineat">@@ -386,20 +379,17 @@</span>
<a href="#l12.154"></a><span id="l12.154"> </span>
<a href="#l12.155"></a><span id="l12.155">       &lt;property name=&quot;timeIndicatorBox&quot;</span>
<a href="#l12.156"></a><span id="l12.156">         readonly=&quot;true&quot;&gt;</span>
<a href="#l12.157"></a><span id="l12.157">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.158"></a><span id="l12.158">           return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timeIndicatorBox&quot;);</span>
<a href="#l12.159"></a><span id="l12.159">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.160"></a><span id="l12.160">       &lt;/property&gt;</span>
<a href="#l12.161"></a><span id="l12.161"> </span>
<a href="#l12.162"></a><span id="l12.162" class="difflineminus">-      &lt;property</span>
<a href="#l12.163"></a><span id="l12.163" class="difflineminus">-        name=&quot;events&quot;</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-        readonly=&quot;true&quot;</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineminus">-        onget=&quot;return this.methods&quot;/&gt;</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineplus">+      &lt;property name=&quot;events&quot; readonly=&quot;true&quot; onget=&quot;return this.methods&quot;/&gt;</span>
<a href="#l12.167"></a><span id="l12.167"> </span>
<a href="#l12.168"></a><span id="l12.168">       &lt;field name=&quot;mDayOff&quot;&gt;false&lt;/field&gt;</span>
<a href="#l12.169"></a><span id="l12.169">       &lt;property name=&quot;dayOff&quot;&gt;</span>
<a href="#l12.170"></a><span id="l12.170">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.171"></a><span id="l12.171">           return this.mDayOff;</span>
<a href="#l12.172"></a><span id="l12.172">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.173"></a><span id="l12.173">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l12.174"></a><span id="l12.174">           this.mDayOff = val;</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineat">@@ -481,36 +471,36 @@</span>
<a href="#l12.176"></a><span id="l12.176"> </span>
<a href="#l12.177"></a><span id="l12.177">           return ret;</span>
<a href="#l12.178"></a><span id="l12.178">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.179"></a><span id="l12.179">       &lt;/method&gt;</span>
<a href="#l12.180"></a><span id="l12.180"> </span>
<a href="#l12.181"></a><span id="l12.181">       &lt;method name=&quot;internalDeleteEvent&quot;&gt;</span>
<a href="#l12.182"></a><span id="l12.182">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l12.183"></a><span id="l12.183">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineminus">-           let itemIndex = -1;</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineminus">-           let occ;</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineminus">-           for (let i in this.mEventInfos) {</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineminus">-               occ = this.mEventInfos[i].event;</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineminus">-               if (occ.hashId == aOccurrence.hashId) {</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineminus">-                   itemIndex = i;</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineminus">-                   break;</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineminus">-               }</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineminus">-           }</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineminus">-</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineminus">-           if (itemIndex == -1) {</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineminus">-               return false;</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineminus">-           } else {</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineminus">-               delete this.mSelectedItemIds[occ.hashId];</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineminus">-               this.mSelectedChunks = this.mSelectedChunks.filter((item) =&gt; {</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineminus">-                   return !item.occurrence || (item.occurrence.hashId != aOccurrence.hashId);</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineminus">-               });</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineminus">-               this.mEventInfos.splice(itemIndex, 1);</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineminus">-               return true;</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineminus">-           }</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+          let itemIndex = -1;</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineplus">+          let occ;</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineplus">+          for (let i in this.mEventInfos) {</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+              occ = this.mEventInfos[i].event;</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineplus">+              if (occ.hashId == aOccurrence.hashId) {</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineplus">+                  itemIndex = i;</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineplus">+                  break;</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineplus">+              }</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineplus">+          }</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineplus">+</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineplus">+          if (itemIndex == -1) {</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineplus">+              return false;</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineplus">+          } else {</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineplus">+              delete this.mSelectedItemIds[occ.hashId];</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineplus">+              this.mSelectedChunks = this.mSelectedChunks.filter((item) =&gt; {</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineplus">+                  return !item.occurrence || (item.occurrence.hashId != aOccurrence.hashId);</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineplus">+              });</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineplus">+              this.mEventInfos.splice(itemIndex, 1);</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineplus">+              return true;</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineplus">+          }</span>
<a href="#l12.224"></a><span id="l12.224">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.225"></a><span id="l12.225">       &lt;/method&gt;</span>
<a href="#l12.226"></a><span id="l12.226"> </span>
<a href="#l12.227"></a><span id="l12.227">       &lt;method name=&quot;recalculateStartEndMinutes&quot;&gt;</span>
<a href="#l12.228"></a><span id="l12.228">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.229"></a><span id="l12.229">           for (let chunk of this.mEventInfos) {</span>
<a href="#l12.230"></a><span id="l12.230">               let mins = this.getStartEndMinutesForOccurrence(chunk.event);</span>
<a href="#l12.231"></a><span id="l12.231">               chunk.startMinute = mins.start;</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineat">@@ -523,101 +513,101 @@</span>
<a href="#l12.233"></a><span id="l12.233"> </span>
<a href="#l12.234"></a><span id="l12.234">       &lt;!-- This function returns the start and end minutes of the occurrence</span>
<a href="#l12.235"></a><span id="l12.235">            part in the day of this column, moreover, the real start and end</span>
<a href="#l12.236"></a><span id="l12.236">            minutes of the whole occurrence (which could span multiple days)</span>
<a href="#l12.237"></a><span id="l12.237">            relative to the time 0:00 of the day in this column --&gt;</span>
<a href="#l12.238"></a><span id="l12.238">       &lt;method name=&quot;getStartEndMinutesForOccurrence&quot;&gt;</span>
<a href="#l12.239"></a><span id="l12.239">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l12.240"></a><span id="l12.240">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineminus">-           let stdate = aOccurrence.startDate || aOccurrence.entryDate || aOccurrence.dueDate;</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineminus">-           let enddate = aOccurrence.endDate || aOccurrence.dueDate || aOccurrence.entryDate;</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineminus">-</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineminus">-           if (!compareObjects(stdate.timezone, this.mTimezone)) {</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineminus">-               stdate = stdate.getInTimezone(this.mTimezone);</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineminus">-           }</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineminus">-</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineminus">-           if (!compareObjects(enddate.timezone, this.mTimezone)) {</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineminus">-               enddate = enddate.getInTimezone(this.mTimezone);</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineminus">-           }</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineminus">-</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineminus">-           let startHour = stdate.hour;</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineminus">-           let startMinute = stdate.minute;</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineminus">-           let endHour = enddate.hour;</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineminus">-           let endMinute = enddate.minute;</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineminus">-</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineminus">-           // Handle cases where an event begins or ends on a day other than this</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineminus">-           if (stdate.compare(this.mDate) == -1) {</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineminus">-               startHour = 0;</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineminus">-               startMinute = 0;</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineminus">-           }</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineminus">-           if (enddate.compare(this.mDate) == 1) {</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineminus">-               endHour = 24;</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineminus">-               endMinute = 0;</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineminus">-           }</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineminus">-</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineminus">-           // For occurrences that span multiple days, we figure out the real</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineminus">-           // occurrence start and end minutes relative to the date of this</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineminus">-           // column and time 0:00</span>
<a href="#l12.270"></a><span id="l12.270" class="difflineminus">-           let durend = enddate.subtractDate(this.mDate);</span>
<a href="#l12.271"></a><span id="l12.271" class="difflineminus">-           let durstart = stdate.subtractDate(this.mDate);</span>
<a href="#l12.272"></a><span id="l12.272" class="difflineminus">-           // 'durend' is always positive, instead 'durstart' might be negative</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineminus">-           // if the event starts one or more days before the date of this column</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineminus">-           let realStart_ = (durstart.days * 24 + durstart.hours) * 60 + durstart.minutes;</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineminus">-           realStart_ = durstart.isNegative ? -1 * realStart_ : realStart_;</span>
<a href="#l12.276"></a><span id="l12.276" class="difflineminus">-           let realEnd_ = (durend.days * 24 + durend.hours) * 60 + durend.minutes;</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineminus">-</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineminus">-           return {</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineminus">-               start: startHour * 60 + startMinute,</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineminus">-               end: endHour * 60 + endMinute,</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineminus">-               realStart: realStart_,</span>
<a href="#l12.282"></a><span id="l12.282" class="difflineminus">-               realEnd: realEnd_</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineminus">-           };</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineplus">+          let stdate = aOccurrence.startDate || aOccurrence.entryDate || aOccurrence.dueDate;</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineplus">+          let enddate = aOccurrence.endDate || aOccurrence.dueDate || aOccurrence.entryDate;</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineplus">+</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineplus">+          if (!compareObjects(stdate.timezone, this.mTimezone)) {</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineplus">+              stdate = stdate.getInTimezone(this.mTimezone);</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineplus">+          }</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineplus">+</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineplus">+          if (!compareObjects(enddate.timezone, this.mTimezone)) {</span>
<a href="#l12.292"></a><span id="l12.292" class="difflineplus">+              enddate = enddate.getInTimezone(this.mTimezone);</span>
<a href="#l12.293"></a><span id="l12.293" class="difflineplus">+          }</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineplus">+</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineplus">+          let startHour = stdate.hour;</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineplus">+          let startMinute = stdate.minute;</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineplus">+          let endHour = enddate.hour;</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineplus">+          let endMinute = enddate.minute;</span>
<a href="#l12.299"></a><span id="l12.299" class="difflineplus">+</span>
<a href="#l12.300"></a><span id="l12.300" class="difflineplus">+          // Handle cases where an event begins or ends on a day other than this</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineplus">+          if (stdate.compare(this.mDate) == -1) {</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineplus">+              startHour = 0;</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineplus">+              startMinute = 0;</span>
<a href="#l12.304"></a><span id="l12.304" class="difflineplus">+          }</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineplus">+          if (enddate.compare(this.mDate) == 1) {</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineplus">+              endHour = 24;</span>
<a href="#l12.307"></a><span id="l12.307" class="difflineplus">+              endMinute = 0;</span>
<a href="#l12.308"></a><span id="l12.308" class="difflineplus">+          }</span>
<a href="#l12.309"></a><span id="l12.309" class="difflineplus">+</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineplus">+          // For occurrences that span multiple days, we figure out the real</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineplus">+          // occurrence start and end minutes relative to the date of this</span>
<a href="#l12.312"></a><span id="l12.312" class="difflineplus">+          // column and time 0:00</span>
<a href="#l12.313"></a><span id="l12.313" class="difflineplus">+          let durend = enddate.subtractDate(this.mDate);</span>
<a href="#l12.314"></a><span id="l12.314" class="difflineplus">+          let durstart = stdate.subtractDate(this.mDate);</span>
<a href="#l12.315"></a><span id="l12.315" class="difflineplus">+          // 'durend' is always positive, instead 'durstart' might be negative</span>
<a href="#l12.316"></a><span id="l12.316" class="difflineplus">+          // if the event starts one or more days before the date of this column</span>
<a href="#l12.317"></a><span id="l12.317" class="difflineplus">+          let realStart_ = (durstart.days * 24 + durstart.hours) * 60 + durstart.minutes;</span>
<a href="#l12.318"></a><span id="l12.318" class="difflineplus">+          realStart_ = durstart.isNegative ? -1 * realStart_ : realStart_;</span>
<a href="#l12.319"></a><span id="l12.319" class="difflineplus">+          let realEnd_ = (durend.days * 24 + durend.hours) * 60 + durend.minutes;</span>
<a href="#l12.320"></a><span id="l12.320" class="difflineplus">+</span>
<a href="#l12.321"></a><span id="l12.321" class="difflineplus">+          return {</span>
<a href="#l12.322"></a><span id="l12.322" class="difflineplus">+              start: startHour * 60 + startMinute,</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineplus">+              end: endHour * 60 + endMinute,</span>
<a href="#l12.324"></a><span id="l12.324" class="difflineplus">+              realStart: realStart_,</span>
<a href="#l12.325"></a><span id="l12.325" class="difflineplus">+              realEnd: realEnd_</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineplus">+          };</span>
<a href="#l12.327"></a><span id="l12.327">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.328"></a><span id="l12.328">       &lt;/method&gt;</span>
<a href="#l12.329"></a><span id="l12.329"> </span>
<a href="#l12.330"></a><span id="l12.330">       &lt;method name=&quot;createChunk&quot;&gt;</span>
<a href="#l12.331"></a><span id="l12.331">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l12.332"></a><span id="l12.332">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineminus">-           let mins = this.getStartEndMinutesForOccurrence(aOccurrence);</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineminus">-</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineminus">-           let chunk = {</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineminus">-               startMinute: mins.start,</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineminus">-               endMinute: mins.end,</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineminus">-               event: aOccurrence</span>
<a href="#l12.339"></a><span id="l12.339" class="difflineminus">-           };</span>
<a href="#l12.340"></a><span id="l12.340" class="difflineminus">-           return chunk;</span>
<a href="#l12.341"></a><span id="l12.341" class="difflineplus">+          let mins = this.getStartEndMinutesForOccurrence(aOccurrence);</span>
<a href="#l12.342"></a><span id="l12.342" class="difflineplus">+</span>
<a href="#l12.343"></a><span id="l12.343" class="difflineplus">+          let chunk = {</span>
<a href="#l12.344"></a><span id="l12.344" class="difflineplus">+              startMinute: mins.start,</span>
<a href="#l12.345"></a><span id="l12.345" class="difflineplus">+              endMinute: mins.end,</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineplus">+              event: aOccurrence</span>
<a href="#l12.347"></a><span id="l12.347" class="difflineplus">+          };</span>
<a href="#l12.348"></a><span id="l12.348" class="difflineplus">+          return chunk;</span>
<a href="#l12.349"></a><span id="l12.349">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.350"></a><span id="l12.350">       &lt;/method&gt;</span>
<a href="#l12.351"></a><span id="l12.351"> </span>
<a href="#l12.352"></a><span id="l12.352">       &lt;method name=&quot;addEvent&quot;&gt;</span>
<a href="#l12.353"></a><span id="l12.353">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l12.354"></a><span id="l12.354">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.355"></a><span id="l12.355" class="difflineminus">-           this.internalDeleteEvent(aOccurrence);</span>
<a href="#l12.356"></a><span id="l12.356" class="difflineminus">-</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineminus">-           let chunk = this.createChunk(aOccurrence);</span>
<a href="#l12.358"></a><span id="l12.358" class="difflineminus">-           this.mEventInfos.push(chunk);</span>
<a href="#l12.359"></a><span id="l12.359" class="difflineminus">-           if (this.mEventMapTimeout) {</span>
<a href="#l12.360"></a><span id="l12.360" class="difflineminus">-               clearTimeout(this.mEventMapTimeout);</span>
<a href="#l12.361"></a><span id="l12.361" class="difflineminus">-           }</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineminus">-</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineminus">-           if (this.mCreatedNewEvent) {</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineminus">-               this.mEventToEdit = aOccurrence;</span>
<a href="#l12.365"></a><span id="l12.365" class="difflineminus">-           }</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineminus">-</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineminus">-           this.mEventMapTimeout = setTimeout(() =&gt; this.relayout(), 5);</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineplus">+          this.internalDeleteEvent(aOccurrence);</span>
<a href="#l12.369"></a><span id="l12.369" class="difflineplus">+</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineplus">+          let chunk = this.createChunk(aOccurrence);</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineplus">+          this.mEventInfos.push(chunk);</span>
<a href="#l12.372"></a><span id="l12.372" class="difflineplus">+          if (this.mEventMapTimeout) {</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineplus">+              clearTimeout(this.mEventMapTimeout);</span>
<a href="#l12.374"></a><span id="l12.374" class="difflineplus">+          }</span>
<a href="#l12.375"></a><span id="l12.375" class="difflineplus">+</span>
<a href="#l12.376"></a><span id="l12.376" class="difflineplus">+          if (this.mCreatedNewEvent) {</span>
<a href="#l12.377"></a><span id="l12.377" class="difflineplus">+              this.mEventToEdit = aOccurrence;</span>
<a href="#l12.378"></a><span id="l12.378" class="difflineplus">+          }</span>
<a href="#l12.379"></a><span id="l12.379" class="difflineplus">+</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineplus">+          this.mEventMapTimeout = setTimeout(() =&gt; this.relayout(), 5);</span>
<a href="#l12.381"></a><span id="l12.381">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.382"></a><span id="l12.382">       &lt;/method&gt;</span>
<a href="#l12.383"></a><span id="l12.383"> </span>
<a href="#l12.384"></a><span id="l12.384">       &lt;method name=&quot;deleteEvent&quot;&gt;</span>
<a href="#l12.385"></a><span id="l12.385">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l12.386"></a><span id="l12.386">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineminus">-           if (this.internalDeleteEvent(aOccurrence)) {</span>
<a href="#l12.388"></a><span id="l12.388" class="difflineminus">-               this.relayout();</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineminus">-           }</span>
<a href="#l12.390"></a><span id="l12.390" class="difflineplus">+          if (this.internalDeleteEvent(aOccurrence)) {</span>
<a href="#l12.391"></a><span id="l12.391" class="difflineplus">+              this.relayout();</span>
<a href="#l12.392"></a><span id="l12.392" class="difflineplus">+          }</span>
<a href="#l12.393"></a><span id="l12.393">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.394"></a><span id="l12.394">       &lt;/method&gt;</span>
<a href="#l12.395"></a><span id="l12.395"> </span>
<a href="#l12.396"></a><span id="l12.396">       &lt;method name=&quot;clear&quot;&gt;</span>
<a href="#l12.397"></a><span id="l12.397">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.398"></a><span id="l12.398">           while (this.bgbox &amp;&amp; this.bgbox.hasChildNodes()) {</span>
<a href="#l12.399"></a><span id="l12.399">               this.bgbox.lastChild.remove();</span>
<a href="#l12.400"></a><span id="l12.400">           }</span>
<a href="#l12.401"></a><span id="l12.401" class="difflineat">@@ -629,17 +619,16 @@</span>
<a href="#l12.402"></a><span id="l12.402">           }</span>
<a href="#l12.403"></a><span id="l12.403">           this.mHandlersToRemove = [];</span>
<a href="#l12.404"></a><span id="l12.404">           this.mSelectedChunks = [];</span>
<a href="#l12.405"></a><span id="l12.405">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.406"></a><span id="l12.406">       &lt;/method&gt;</span>
<a href="#l12.407"></a><span id="l12.407"> </span>
<a href="#l12.408"></a><span id="l12.408">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l12.409"></a><span id="l12.409">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineminus">-</span>
<a href="#l12.411"></a><span id="l12.411">           if (this.mLayoutBatchCount &gt; 0) {</span>
<a href="#l12.412"></a><span id="l12.412">               return;</span>
<a href="#l12.413"></a><span id="l12.413">           }</span>
<a href="#l12.414"></a><span id="l12.414">           this.clear();</span>
<a href="#l12.415"></a><span id="l12.415"> </span>
<a href="#l12.416"></a><span id="l12.416">           let orient = this.getAttribute(&quot;orient&quot;);</span>
<a href="#l12.417"></a><span id="l12.417">           this.bgbox.setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l12.418"></a><span id="l12.418"> </span>
<a href="#l12.419"></a><span id="l12.419" class="difflineat">@@ -894,19 +883,19 @@</span>
<a href="#l12.420"></a><span id="l12.420">               let start = item.startDate || item.entryDate || item.dueDate;</span>
<a href="#l12.421"></a><span id="l12.421">               start = start.getInTimezone(this.mTimezone);</span>
<a href="#l12.422"></a><span id="l12.422">               aEventInfo.layoutStart = start;</span>
<a href="#l12.423"></a><span id="l12.423">               let end = item.endDate || item.dueDate || item.entryDate;</span>
<a href="#l12.424"></a><span id="l12.424">               end = end.getInTimezone(this.mTimezone);</span>
<a href="#l12.425"></a><span id="l12.425">               let secEnd = start.clone();</span>
<a href="#l12.426"></a><span id="l12.426">               secEnd.addDuration(this.mMinDuration);</span>
<a href="#l12.427"></a><span id="l12.427">               if (secEnd.nativeTime &gt; end.nativeTime) {</span>
<a href="#l12.428"></a><span id="l12.428" class="difflineminus">-                   aEventInfo.layoutEnd = secEnd;</span>
<a href="#l12.429"></a><span id="l12.429" class="difflineplus">+                  aEventInfo.layoutEnd = secEnd;</span>
<a href="#l12.430"></a><span id="l12.430">               } else {</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineminus">-                   aEventInfo.layoutEnd = end;</span>
<a href="#l12.432"></a><span id="l12.432" class="difflineplus">+                  aEventInfo.layoutEnd = end;</span>
<a href="#l12.433"></a><span id="l12.433">               }</span>
<a href="#l12.434"></a><span id="l12.434">               return aEventInfo;</span>
<a href="#l12.435"></a><span id="l12.435">           });</span>
<a href="#l12.436"></a><span id="l12.436">           this.mEventInfos.sort(sortByStart);</span>
<a href="#l12.437"></a><span id="l12.437"> </span>
<a href="#l12.438"></a><span id="l12.438">           // The end time of the last ending event in the entire blob</span>
<a href="#l12.439"></a><span id="l12.439">           let latestItemEnd;</span>
<a href="#l12.440"></a><span id="l12.440"> </span>
<a href="#l12.441"></a><span id="l12.441" class="difflineat">@@ -926,17 +915,17 @@</span>
<a href="#l12.442"></a><span id="l12.442">            */</span>
<a href="#l12.443"></a><span id="l12.443">           for (let i in this.mEventInfos) {</span>
<a href="#l12.444"></a><span id="l12.444">               let curItemInfo = {</span>
<a href="#l12.445"></a><span id="l12.445">                   event: this.mEventInfos[i].event,</span>
<a href="#l12.446"></a><span id="l12.446">                   layoutStart: this.mEventInfos[i].layoutStart,</span>
<a href="#l12.447"></a><span id="l12.447">                   layoutEnd: this.mEventInfos[i].layoutEnd</span>
<a href="#l12.448"></a><span id="l12.448">               };</span>
<a href="#l12.449"></a><span id="l12.449">               if (!latestItemEnd) {</span>
<a href="#l12.450"></a><span id="l12.450" class="difflineminus">-                 latestItemEnd = curItemInfo.layoutEnd;</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineplus">+                  latestItemEnd = curItemInfo.layoutEnd;</span>
<a href="#l12.452"></a><span id="l12.452">               }</span>
<a href="#l12.453"></a><span id="l12.453">               if (currentBlob.length &amp;&amp; latestItemEnd &amp;&amp;</span>
<a href="#l12.454"></a><span id="l12.454">                   curItemInfo.layoutStart.compare(latestItemEnd) != -1) {</span>
<a href="#l12.455"></a><span id="l12.455">                   // We're done with this current blob because item starts</span>
<a href="#l12.456"></a><span id="l12.456">                   // after the last event in the current blob ended.</span>
<a href="#l12.457"></a><span id="l12.457">                   blobs.push({ blob: currentBlob, totalCols: colEndArray.length });</span>
<a href="#l12.458"></a><span id="l12.458"> </span>
<a href="#l12.459"></a><span id="l12.459">                   // Reset our variables</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineat">@@ -1102,16 +1091,17 @@</span>
<a href="#l12.461"></a><span id="l12.461">           // Add the last blob</span>
<a href="#l12.462"></a><span id="l12.462">           blobs.push({</span>
<a href="#l12.463"></a><span id="l12.463">               blob: currentBlob,</span>
<a href="#l12.464"></a><span id="l12.464">               totalCols: colEndArray.length</span>
<a href="#l12.465"></a><span id="l12.465">           });</span>
<a href="#l12.466"></a><span id="l12.466">           return this.setupBoxStructure(blobs);</span>
<a href="#l12.467"></a><span id="l12.467">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.468"></a><span id="l12.468">       &lt;/method&gt;</span>
<a href="#l12.469"></a><span id="l12.469" class="difflineplus">+</span>
<a href="#l12.470"></a><span id="l12.470">       &lt;method name=&quot;setupBoxStructure&quot;&gt;</span>
<a href="#l12.471"></a><span id="l12.471">         &lt;parameter name=&quot;aBlobs&quot;/&gt;</span>
<a href="#l12.472"></a><span id="l12.472">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.473"></a><span id="l12.473">           // This is actually going to end up being a 3-d array</span>
<a href="#l12.474"></a><span id="l12.474">           // 1st dimension: &quot;layers&quot;, sets of columns of events that all</span>
<a href="#l12.475"></a><span id="l12.475">           //                should have equal width*</span>
<a href="#l12.476"></a><span id="l12.476">           // 2nd dimension: &quot;columns&quot;, individual columns of non-conflicting</span>
<a href="#l12.477"></a><span id="l12.477">           //                items</span>
<a href="#l12.478"></a><span id="l12.478" class="difflineat">@@ -1242,38 +1232,38 @@</span>
<a href="#l12.479"></a><span id="l12.479">           return layers;</span>
<a href="#l12.480"></a><span id="l12.480">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.481"></a><span id="l12.481">       &lt;/method&gt;</span>
<a href="#l12.482"></a><span id="l12.482"> </span>
<a href="#l12.483"></a><span id="l12.483">       &lt;method name=&quot;getShadowElements&quot;&gt;</span>
<a href="#l12.484"></a><span id="l12.484">         &lt;parameter name=&quot;aStart&quot;/&gt;</span>
<a href="#l12.485"></a><span id="l12.485">         &lt;parameter name=&quot;aEnd&quot;/&gt;</span>
<a href="#l12.486"></a><span id="l12.486">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.487"></a><span id="l12.487" class="difflineminus">-            // aStart and aEnd are start and end minutes of the occurrence</span>
<a href="#l12.488"></a><span id="l12.488" class="difflineminus">-            // from time 0:00 of the dragging column</span>
<a href="#l12.489"></a><span id="l12.489" class="difflineminus">-            let shadows = 1;</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineminus">-            let offset = 0;</span>
<a href="#l12.491"></a><span id="l12.491" class="difflineminus">-            let startMin;</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineminus">-            if (aStart &lt; 0) {</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineminus">-                shadows += Math.ceil(Math.abs(aStart) / this.mEndMin);</span>
<a href="#l12.494"></a><span id="l12.494" class="difflineminus">-                offset = shadows - 1;</span>
<a href="#l12.495"></a><span id="l12.495" class="difflineminus">-                let reminder = Math.abs(aStart) % this.mEndMin;</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineminus">-                startMin = this.mEndMin - (reminder ? reminder : this.mEndMin);</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineminus">-            } else {</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineminus">-                startMin = aStart;</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineminus">-            }</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineminus">-            shadows += Math.floor(aEnd / this.mEndMin);</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineminus">-</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineminus">-            // return values needed to build the shadows while dragging</span>
<a href="#l12.503"></a><span id="l12.503" class="difflineminus">-            return {</span>
<a href="#l12.504"></a><span id="l12.504" class="difflineminus">-                shadows: shadows,             // number of shadows</span>
<a href="#l12.505"></a><span id="l12.505" class="difflineminus">-                offset: offset,               // Offset first&lt;-&gt;selected shadows</span>
<a href="#l12.506"></a><span id="l12.506" class="difflineminus">-                startMin: startMin,           // First shadow start minute</span>
<a href="#l12.507"></a><span id="l12.507" class="difflineminus">-                endMin: aEnd % this.mEndMin   // Last shadow end minute</span>
<a href="#l12.508"></a><span id="l12.508" class="difflineminus">-            };</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineplus">+          // aStart and aEnd are start and end minutes of the occurrence</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineplus">+          // from time 0:00 of the dragging column</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineplus">+          let shadows = 1;</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineplus">+          let offset = 0;</span>
<a href="#l12.513"></a><span id="l12.513" class="difflineplus">+          let startMin;</span>
<a href="#l12.514"></a><span id="l12.514" class="difflineplus">+          if (aStart &lt; 0) {</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineplus">+              shadows += Math.ceil(Math.abs(aStart) / this.mEndMin);</span>
<a href="#l12.516"></a><span id="l12.516" class="difflineplus">+              offset = shadows - 1;</span>
<a href="#l12.517"></a><span id="l12.517" class="difflineplus">+              let reminder = Math.abs(aStart) % this.mEndMin;</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineplus">+              startMin = this.mEndMin - (reminder ? reminder : this.mEndMin);</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineplus">+          } else {</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineplus">+              startMin = aStart;</span>
<a href="#l12.521"></a><span id="l12.521" class="difflineplus">+          }</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineplus">+          shadows += Math.floor(aEnd / this.mEndMin);</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineplus">+</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineplus">+          // return values needed to build the shadows while dragging</span>
<a href="#l12.525"></a><span id="l12.525" class="difflineplus">+          return {</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineplus">+              shadows: shadows,             // number of shadows</span>
<a href="#l12.527"></a><span id="l12.527" class="difflineplus">+              offset: offset,               // Offset first&lt;-&gt;selected shadows</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineplus">+              startMin: startMin,           // First shadow start minute</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineplus">+              endMin: aEnd % this.mEndMin   // Last shadow end minute</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineplus">+          };</span>
<a href="#l12.531"></a><span id="l12.531">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.532"></a><span id="l12.532">       &lt;/method&gt;</span>
<a href="#l12.533"></a><span id="l12.533"> </span>
<a href="#l12.534"></a><span id="l12.534">       &lt;method name=&quot;firstLastShadowColumns&quot;&gt;</span>
<a href="#l12.535"></a><span id="l12.535">         &lt;parameter name=&quot;aOffset&quot;/&gt;</span>
<a href="#l12.536"></a><span id="l12.536">         &lt;parameter name=&quot;aShadows&quot;/&gt;</span>
<a href="#l12.537"></a><span id="l12.537">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.538"></a><span id="l12.538">           let firstCol = this; // eslint-disable-line consistent-this</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineat">@@ -1405,18 +1395,18 @@</span>
<a href="#l12.540"></a><span id="l12.540">               diffStart = event.clientY - scrollbox.boxObject.y;</span>
<a href="#l12.541"></a><span id="l12.541">               diffEnd = scrollbox.boxObject.y + scrollbox.boxObject.height - event.clientY;</span>
<a href="#l12.542"></a><span id="l12.542">           } else {</span>
<a href="#l12.543"></a><span id="l12.543">               diffStart = event.clientX - scrollbox.boxObject.x;</span>
<a href="#l12.544"></a><span id="l12.544">               diffEnd = scrollbox.boxObject.x + scrollbox.boxObject.width - event.clientX;</span>
<a href="#l12.545"></a><span id="l12.545">           }</span>
<a href="#l12.546"></a><span id="l12.546"> </span>
<a href="#l12.547"></a><span id="l12.547">           const SCROLLZONE = 55;     // Size (pixels) of the top/bottom view where the scroll starts.</span>
<a href="#l12.548"></a><span id="l12.548" class="difflineminus">-          const MAXTIMEOUT = 250,    // Max and min time interval (ms) between</span>
<a href="#l12.549"></a><span id="l12.549" class="difflineminus">-                MINTIMEOUT = 30;     // two consecutive scrolls.</span>
<a href="#l12.550"></a><span id="l12.550" class="difflineplus">+          const MAXTIMEOUT = 250;    // Max and min time interval (ms) between</span>
<a href="#l12.551"></a><span id="l12.551" class="difflineplus">+          const MINTIMEOUT = 30;     // two consecutive scrolls.</span>
<a href="#l12.552"></a><span id="l12.552">           const SCROLLBYHOUR = 0.33; // Part of hour to move for each scroll.</span>
<a href="#l12.553"></a><span id="l12.553">           let insideScrollZone = 0;</span>
<a href="#l12.554"></a><span id="l12.554">           let pxPerHr = event.target.mPixPerMin * 60;</span>
<a href="#l12.555"></a><span id="l12.555">           let scrollBy = Math.floor(pxPerHr * SCROLLBYHOUR);</span>
<a href="#l12.556"></a><span id="l12.556">           if (diffStart &lt; SCROLLZONE) {</span>
<a href="#l12.557"></a><span id="l12.557">               insideScrollZone = SCROLLZONE - diffStart;</span>
<a href="#l12.558"></a><span id="l12.558">               scrollBy *= -1;</span>
<a href="#l12.559"></a><span id="l12.559">           } else if (diffEnd &lt; SCROLLZONE) {</span>
<a href="#l12.560"></a><span id="l12.560" class="difflineat">@@ -1992,23 +1982,22 @@</span>
<a href="#l12.561"></a><span id="l12.561">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.562"></a><span id="l12.562">       &lt;/method&gt;</span>
<a href="#l12.563"></a><span id="l12.563"> </span>
<a href="#l12.564"></a><span id="l12.564">       &lt;method name=&quot;setDayStartEndMinutes&quot;&gt;</span>
<a href="#l12.565"></a><span id="l12.565">         &lt;parameter name=&quot;aDayStartMin&quot;/&gt;</span>
<a href="#l12.566"></a><span id="l12.566">         &lt;parameter name=&quot;aDayEndMin&quot;/&gt;</span>
<a href="#l12.567"></a><span id="l12.567">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.568"></a><span id="l12.568">           if (aDayStartMin &lt; this.mStartMin || aDayStartMin &gt; aDayEndMin ||</span>
<a href="#l12.569"></a><span id="l12.569" class="difflineminus">-            aDayEndMin &gt; this.mEndMin) {</span>
<a href="#l12.570"></a><span id="l12.570" class="difflineminus">-            throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l12.571"></a><span id="l12.571" class="difflineplus">+              aDayEndMin &gt; this.mEndMin) {</span>
<a href="#l12.572"></a><span id="l12.572" class="difflineplus">+              throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l12.573"></a><span id="l12.573">           }</span>
<a href="#l12.574"></a><span id="l12.574" class="difflineminus">-          if (this.mDayStartMin != aDayStartMin ||</span>
<a href="#l12.575"></a><span id="l12.575" class="difflineminus">-              this.mDayEndMin != aDayEndMin) {</span>
<a href="#l12.576"></a><span id="l12.576" class="difflineminus">-            this.mDayStartMin = aDayStartMin;</span>
<a href="#l12.577"></a><span id="l12.577" class="difflineminus">-            this.mDayEndMin = aDayEndMin;</span>
<a href="#l12.578"></a><span id="l12.578" class="difflineplus">+          if (this.mDayStartMin != aDayStartMin || this.mDayEndMin != aDayEndMin) {</span>
<a href="#l12.579"></a><span id="l12.579" class="difflineplus">+              this.mDayStartMin = aDayStartMin;</span>
<a href="#l12.580"></a><span id="l12.580" class="difflineplus">+              this.mDayEndMin = aDayEndMin;</span>
<a href="#l12.581"></a><span id="l12.581">           }</span>
<a href="#l12.582"></a><span id="l12.582">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.583"></a><span id="l12.583">       &lt;/method&gt;</span>
<a href="#l12.584"></a><span id="l12.584"> </span>
<a href="#l12.585"></a><span id="l12.585">       &lt;method name=&quot;getClickedDateTime&quot;&gt;</span>
<a href="#l12.586"></a><span id="l12.586">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l12.587"></a><span id="l12.587">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.588"></a><span id="l12.588">           let newStart = this.date.clone();</span>
<a href="#l12.589"></a><span id="l12.589" class="difflineat">@@ -2036,18 +2025,18 @@</span>
<a href="#l12.590"></a><span id="l12.590">         if (this.calendarView.controller) {</span>
<a href="#l12.591"></a><span id="l12.591">             let newStart = getClickedDateTime(event);</span>
<a href="#l12.592"></a><span id="l12.592">             this.calendarView.controller.createNewEvent(null, newStart, null);</span>
<a href="#l12.593"></a><span id="l12.593">         }</span>
<a href="#l12.594"></a><span id="l12.594">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.595"></a><span id="l12.595"> </span>
<a href="#l12.596"></a><span id="l12.596">       &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l12.597"></a><span id="l12.597">         if (!(event.ctrlKey || event.metaKey)) {</span>
<a href="#l12.598"></a><span id="l12.598" class="difflineminus">-          this.calendarView.setSelectedItems(0, []);</span>
<a href="#l12.599"></a><span id="l12.599" class="difflineminus">-          this.focus();</span>
<a href="#l12.600"></a><span id="l12.600" class="difflineplus">+            this.calendarView.setSelectedItems(0, []);</span>
<a href="#l12.601"></a><span id="l12.601" class="difflineplus">+            this.focus();</span>
<a href="#l12.602"></a><span id="l12.602">         }</span>
<a href="#l12.603"></a><span id="l12.603">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.604"></a><span id="l12.604"> </span>
<a href="#l12.605"></a><span id="l12.605">       &lt;handler event=&quot;click&quot; button=&quot;2&quot;&gt;&lt;![CDATA[</span>
<a href="#l12.606"></a><span id="l12.606">         let newStart = getClickedDateTime(event);</span>
<a href="#l12.607"></a><span id="l12.607">         this.calendarView.selectedDateTime = newStart;</span>
<a href="#l12.608"></a><span id="l12.608">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.609"></a><span id="l12.609"> </span>
<a href="#l12.610"></a><span id="l12.610" class="difflineat">@@ -2106,17 +2095,17 @@</span>
<a href="#l12.611"></a><span id="l12.611">         window.addEventListener(&quot;mouseup&quot;, this.onEventSweepMouseUp, false);</span>
<a href="#l12.612"></a><span id="l12.612">         window.addEventListener(&quot;keypress&quot;, this.onEventSweepKeypress, false);</span>
<a href="#l12.613"></a><span id="l12.613">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.614"></a><span id="l12.614">     &lt;/handlers&gt;</span>
<a href="#l12.615"></a><span id="l12.615">   &lt;/binding&gt;</span>
<a href="#l12.616"></a><span id="l12.616"> </span>
<a href="#l12.617"></a><span id="l12.617">   &lt;binding id=&quot;calendar-header-container&quot; extends=&quot;chrome://calendar/content/widgets/calendar-widgets.xml#dragndropContainer&quot;&gt;</span>
<a href="#l12.618"></a><span id="l12.618">     &lt;content xbl:inherits=&quot;selected&quot; flex=&quot;1&quot; class=&quot;calendar-event-column-header&quot;&gt;</span>
<a href="#l12.619"></a><span id="l12.619" class="difflineminus">-        &lt;children/&gt;</span>
<a href="#l12.620"></a><span id="l12.620" class="difflineplus">+      &lt;children/&gt;</span>
<a href="#l12.621"></a><span id="l12.621">     &lt;/content&gt;</span>
<a href="#l12.622"></a><span id="l12.622"> </span>
<a href="#l12.623"></a><span id="l12.623">     &lt;implementation&gt;</span>
<a href="#l12.624"></a><span id="l12.624">       &lt;field name=&quot;mItemBoxes&quot;&gt;null&lt;/field&gt;</span>
<a href="#l12.625"></a><span id="l12.625">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l12.626"></a><span id="l12.626">         this.mItemBoxes = [];</span>
<a href="#l12.627"></a><span id="l12.627">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l12.628"></a><span id="l12.628"> </span>
<a href="#l12.629"></a><span id="l12.629" class="difflineat">@@ -2143,45 +2132,45 @@</span>
<a href="#l12.630"></a><span id="l12.630">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.631"></a><span id="l12.631">       &lt;/method&gt;</span>
<a href="#l12.632"></a><span id="l12.632"> </span>
<a href="#l12.633"></a><span id="l12.633">       &lt;method name=&quot;addEvent&quot;&gt;</span>
<a href="#l12.634"></a><span id="l12.634">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l12.635"></a><span id="l12.635">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.636"></a><span id="l12.636">           // prevent same items being added</span>
<a href="#l12.637"></a><span id="l12.637">           if (this.mItemBoxes.some(itemBox =&gt; itemBox.occurrence.hashId == aItem.hashId)) {</span>
<a href="#l12.638"></a><span id="l12.638" class="difflineminus">-            return;</span>
<a href="#l12.639"></a><span id="l12.639" class="difflineplus">+              return;</span>
<a href="#l12.640"></a><span id="l12.640">           }</span>
<a href="#l12.641"></a><span id="l12.641"> </span>
<a href="#l12.642"></a><span id="l12.642">           let itemBox = createXULElement(&quot;calendar-editable-item&quot;);</span>
<a href="#l12.643"></a><span id="l12.643">           this.appendChild(itemBox);</span>
<a href="#l12.644"></a><span id="l12.644">           itemBox.calendarView = this.calendarView;</span>
<a href="#l12.645"></a><span id="l12.645">           itemBox.occurrence = aItem;</span>
<a href="#l12.646"></a><span id="l12.646">           let ctxt = this.calendarView.getAttribute(&quot;item-context&quot;) ||</span>
<a href="#l12.647"></a><span id="l12.647">                      this.calendarView.getAttribute(&quot;context&quot;);</span>
<a href="#l12.648"></a><span id="l12.648">           itemBox.setAttribute(&quot;context&quot;, ctxt);</span>
<a href="#l12.649"></a><span id="l12.649"> </span>
<a href="#l12.650"></a><span id="l12.650">           if (aItem.hashId in this.calendarView.mFlashingEvents) {</span>
<a href="#l12.651"></a><span id="l12.651" class="difflineminus">-            itemBox.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l12.652"></a><span id="l12.652" class="difflineplus">+              itemBox.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l12.653"></a><span id="l12.653">           }</span>
<a href="#l12.654"></a><span id="l12.654"> </span>
<a href="#l12.655"></a><span id="l12.655">           this.mItemBoxes.push(itemBox);</span>
<a href="#l12.656"></a><span id="l12.656">           itemBox.parentBox = this;</span>
<a href="#l12.657"></a><span id="l12.657">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.658"></a><span id="l12.658">       &lt;/method&gt;</span>
<a href="#l12.659"></a><span id="l12.659"> </span>
<a href="#l12.660"></a><span id="l12.660">       &lt;method name=&quot;deleteEvent&quot;&gt;</span>
<a href="#l12.661"></a><span id="l12.661">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l12.662"></a><span id="l12.662">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.663"></a><span id="l12.663">           for (let i in this.mItemBoxes) {</span>
<a href="#l12.664"></a><span id="l12.664" class="difflineminus">-            if (this.mItemBoxes[i].occurrence.hashId == aItem.hashId) {</span>
<a href="#l12.665"></a><span id="l12.665" class="difflineminus">-              this.mItemBoxes[i].remove();</span>
<a href="#l12.666"></a><span id="l12.666" class="difflineminus">-              this.mItemBoxes.splice(i, 1);</span>
<a href="#l12.667"></a><span id="l12.667" class="difflineminus">-              break;</span>
<a href="#l12.668"></a><span id="l12.668" class="difflineminus">-            }</span>
<a href="#l12.669"></a><span id="l12.669" class="difflineplus">+              if (this.mItemBoxes[i].occurrence.hashId == aItem.hashId) {</span>
<a href="#l12.670"></a><span id="l12.670" class="difflineplus">+                  this.mItemBoxes[i].remove();</span>
<a href="#l12.671"></a><span id="l12.671" class="difflineplus">+                  this.mItemBoxes.splice(i, 1);</span>
<a href="#l12.672"></a><span id="l12.672" class="difflineplus">+                  break;</span>
<a href="#l12.673"></a><span id="l12.673" class="difflineplus">+              }</span>
<a href="#l12.674"></a><span id="l12.674">           }</span>
<a href="#l12.675"></a><span id="l12.675">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.676"></a><span id="l12.676">       &lt;/method&gt;</span>
<a href="#l12.677"></a><span id="l12.677"> </span>
<a href="#l12.678"></a><span id="l12.678">       &lt;method name=&quot;onDropItem&quot;&gt;</span>
<a href="#l12.679"></a><span id="l12.679">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l12.680"></a><span id="l12.680">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.681"></a><span id="l12.681">          let newItem = cal.moveItem(aItem, this.mDate);</span>
<a href="#l12.682"></a><span id="l12.682" class="difflineat">@@ -2189,45 +2178,45 @@</span>
<a href="#l12.683"></a><span id="l12.683">          return newItem;</span>
<a href="#l12.684"></a><span id="l12.684">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.685"></a><span id="l12.685">       &lt;/method&gt;</span>
<a href="#l12.686"></a><span id="l12.686"> </span>
<a href="#l12.687"></a><span id="l12.687">       &lt;method name=&quot;selectOccurrence&quot;&gt;</span>
<a href="#l12.688"></a><span id="l12.688">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l12.689"></a><span id="l12.689">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.690"></a><span id="l12.690">           for (let itemBox of this.mItemBoxes) {</span>
<a href="#l12.691"></a><span id="l12.691" class="difflineminus">-            if (aItem &amp;&amp; (itemBox.occurrence.hashId == aItem.hashId)) {</span>
<a href="#l12.692"></a><span id="l12.692" class="difflineminus">-              itemBox.selected = true;</span>
<a href="#l12.693"></a><span id="l12.693" class="difflineminus">-            }</span>
<a href="#l12.694"></a><span id="l12.694" class="difflineplus">+              if (aItem &amp;&amp; (itemBox.occurrence.hashId == aItem.hashId)) {</span>
<a href="#l12.695"></a><span id="l12.695" class="difflineplus">+                  itemBox.selected = true;</span>
<a href="#l12.696"></a><span id="l12.696" class="difflineplus">+              }</span>
<a href="#l12.697"></a><span id="l12.697">           }</span>
<a href="#l12.698"></a><span id="l12.698">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.699"></a><span id="l12.699">       &lt;/method&gt;</span>
<a href="#l12.700"></a><span id="l12.700">       &lt;method name=&quot;unselectOccurrence&quot;&gt;</span>
<a href="#l12.701"></a><span id="l12.701">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l12.702"></a><span id="l12.702">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.703"></a><span id="l12.703">           for (let itemBox of this.mItemBoxes) {</span>
<a href="#l12.704"></a><span id="l12.704" class="difflineminus">-            if (aItem &amp;&amp; (itemBox.occurrence.hashId == aItem.hashId)) {</span>
<a href="#l12.705"></a><span id="l12.705" class="difflineminus">-              itemBox.selected = false;</span>
<a href="#l12.706"></a><span id="l12.706" class="difflineminus">-            }</span>
<a href="#l12.707"></a><span id="l12.707" class="difflineplus">+              if (aItem &amp;&amp; (itemBox.occurrence.hashId == aItem.hashId)) {</span>
<a href="#l12.708"></a><span id="l12.708" class="difflineplus">+                  itemBox.selected = false;</span>
<a href="#l12.709"></a><span id="l12.709" class="difflineplus">+              }</span>
<a href="#l12.710"></a><span id="l12.710">           }</span>
<a href="#l12.711"></a><span id="l12.711">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.712"></a><span id="l12.712">       &lt;/method&gt;</span>
<a href="#l12.713"></a><span id="l12.713"> </span>
<a href="#l12.714"></a><span id="l12.714">     &lt;/implementation&gt;</span>
<a href="#l12.715"></a><span id="l12.715"> </span>
<a href="#l12.716"></a><span id="l12.716">     &lt;handlers&gt;</span>
<a href="#l12.717"></a><span id="l12.717">       &lt;handler event=&quot;dblclick&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l12.718"></a><span id="l12.718">         this.calendarView.controller.createNewEvent(null, this.mDate, null, true);</span>
<a href="#l12.719"></a><span id="l12.719">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.720"></a><span id="l12.720">       &lt;handler event=&quot;mousedown&quot;&gt;&lt;![CDATA[</span>
<a href="#l12.721"></a><span id="l12.721">         this.calendarView.selectedDay = this.mDate;</span>
<a href="#l12.722"></a><span id="l12.722">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.723"></a><span id="l12.723">       &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l12.724"></a><span id="l12.724">         if (!(event.ctrlKey || event.metaKey)) {</span>
<a href="#l12.725"></a><span id="l12.725" class="difflineminus">-          this.calendarView.setSelectedItems(0, []);</span>
<a href="#l12.726"></a><span id="l12.726" class="difflineplus">+            this.calendarView.setSelectedItems(0, []);</span>
<a href="#l12.727"></a><span id="l12.727">         }</span>
<a href="#l12.728"></a><span id="l12.728">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.729"></a><span id="l12.729">       &lt;handler event=&quot;click&quot; button=&quot;2&quot;&gt;&lt;![CDATA[</span>
<a href="#l12.730"></a><span id="l12.730">         let newStart = this.calendarView.selectedDay.clone();</span>
<a href="#l12.731"></a><span id="l12.731">         newStart.isDate = true;</span>
<a href="#l12.732"></a><span id="l12.732">         this.calendarView.selectedDateTime = newStart;</span>
<a href="#l12.733"></a><span id="l12.733">         event.stopPropagation();</span>
<a href="#l12.734"></a><span id="l12.734">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l12.735"></a><span id="l12.735" class="difflineat">@@ -2249,73 +2238,73 @@</span>
<a href="#l12.736"></a><span id="l12.736">     &lt;/handlers&gt;</span>
<a href="#l12.737"></a><span id="l12.737">   &lt;/binding&gt;</span>
<a href="#l12.738"></a><span id="l12.738"> </span>
<a href="#l12.739"></a><span id="l12.739">   &lt;!--</span>
<a href="#l12.740"></a><span id="l12.740">      -  An individual event box, to be inserted into a column.</span>
<a href="#l12.741"></a><span id="l12.741">     --&gt;</span>
<a href="#l12.742"></a><span id="l12.742">   &lt;binding id=&quot;calendar-event-box&quot; extends=&quot;chrome://calendar/content/calendar-view-core.xml#calendar-editable-item&quot;&gt;</span>
<a href="#l12.743"></a><span id="l12.743">     &lt;content mousethrough=&quot;never&quot; tooltip=&quot;itemTooltip&quot;&gt;</span>
<a href="#l12.744"></a><span id="l12.744" class="difflineminus">-        &lt;xul:box xbl:inherits=&quot;orient,width,height&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.745"></a><span id="l12.745" class="difflineminus">-          &lt;xul:box anonid=&quot;event-container&quot;</span>
<a href="#l12.746"></a><span id="l12.746" class="difflineminus">-                   class=&quot;calendar-color-box&quot;</span>
<a href="#l12.747"></a><span id="l12.747" class="difflineminus">-                   xbl:inherits=&quot;orient,readonly,flashing,alarm,allday,priority,progress,</span>
<a href="#l12.748"></a><span id="l12.748" class="difflineminus">-                                 status,calendar,categories,calendar-uri,calendar-id,todoType&quot;</span>
<a href="#l12.749"></a><span id="l12.749" class="difflineminus">-                   flex=&quot;1&quot;&gt;</span>
<a href="#l12.750"></a><span id="l12.750" class="difflineminus">-            &lt;xul:box class=&quot;calendar-event-selection&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.751"></a><span id="l12.751" class="difflineminus">-              &lt;xul:stack anonid=&quot;eventbox&quot;</span>
<a href="#l12.752"></a><span id="l12.752" class="difflineminus">-                         align=&quot;stretch&quot;</span>
<a href="#l12.753"></a><span id="l12.753" class="difflineminus">-                         class=&quot;calendar-event-box-container&quot;</span>
<a href="#l12.754"></a><span id="l12.754" class="difflineminus">-                         flex=&quot;1&quot;</span>
<a href="#l12.755"></a><span id="l12.755" class="difflineminus">-                         xbl:inherits=&quot;context,parentorient=orient,readonly,flashing,alarm,allday,priority,progress,status,calendar,categories&quot;&gt;</span>
<a href="#l12.756"></a><span id="l12.756" class="difflineminus">-                &lt;xul:hbox class=&quot;calendar-event-details&quot;</span>
<a href="#l12.757"></a><span id="l12.757" class="difflineminus">-                          anonid=&quot;calendar-event-details&quot;</span>
<a href="#l12.758"></a><span id="l12.758" class="difflineminus">-                          align=&quot;start&quot;&gt;</span>
<a href="#l12.759"></a><span id="l12.759" class="difflineminus">-                  &lt;xul:image anonid=&quot;item-icon&quot;</span>
<a href="#l12.760"></a><span id="l12.760" class="difflineminus">-                             class=&quot;calendar-item-image&quot;</span>
<a href="#l12.761"></a><span id="l12.761" class="difflineminus">-                             xbl:inherits=&quot;progress,allday,itemType,todoType&quot;/&gt;</span>
<a href="#l12.762"></a><span id="l12.762" class="difflineminus">-                  &lt;xul:description anonid=&quot;event-name&quot; class=&quot;calendar-event-details-core&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l12.763"></a><span id="l12.763" class="difflineminus">-                  &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l12.764"></a><span id="l12.764" class="difflineminus">-                               class=&quot;plain calendar-event-details-core calendar-event-name-textbox&quot;</span>
<a href="#l12.765"></a><span id="l12.765" class="difflineminus">-                               flex=&quot;1&quot;</span>
<a href="#l12.766"></a><span id="l12.766" class="difflineminus">-                               hidden=&quot;true&quot;</span>
<a href="#l12.767"></a><span id="l12.767" class="difflineminus">-                               wrap=&quot;true&quot;/&gt;</span>
<a href="#l12.768"></a><span id="l12.768" class="difflineplus">+      &lt;xul:box xbl:inherits=&quot;orient,width,height&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.769"></a><span id="l12.769" class="difflineplus">+        &lt;xul:box anonid=&quot;event-container&quot;</span>
<a href="#l12.770"></a><span id="l12.770" class="difflineplus">+                 class=&quot;calendar-color-box&quot;</span>
<a href="#l12.771"></a><span id="l12.771" class="difflineplus">+                 xbl:inherits=&quot;orient,readonly,flashing,alarm,allday,priority,progress,</span>
<a href="#l12.772"></a><span id="l12.772" class="difflineplus">+                               status,calendar,categories,calendar-uri,calendar-id,todoType&quot;</span>
<a href="#l12.773"></a><span id="l12.773" class="difflineplus">+                 flex=&quot;1&quot;&gt;</span>
<a href="#l12.774"></a><span id="l12.774" class="difflineplus">+          &lt;xul:box class=&quot;calendar-event-selection&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.775"></a><span id="l12.775" class="difflineplus">+            &lt;xul:stack anonid=&quot;eventbox&quot;</span>
<a href="#l12.776"></a><span id="l12.776" class="difflineplus">+                       align=&quot;stretch&quot;</span>
<a href="#l12.777"></a><span id="l12.777" class="difflineplus">+                       class=&quot;calendar-event-box-container&quot;</span>
<a href="#l12.778"></a><span id="l12.778" class="difflineplus">+                       flex=&quot;1&quot;</span>
<a href="#l12.779"></a><span id="l12.779" class="difflineplus">+                       xbl:inherits=&quot;context,parentorient=orient,readonly,flashing,alarm,allday,priority,progress,status,calendar,categories&quot;&gt;</span>
<a href="#l12.780"></a><span id="l12.780" class="difflineplus">+              &lt;xul:hbox class=&quot;calendar-event-details&quot;</span>
<a href="#l12.781"></a><span id="l12.781" class="difflineplus">+                        anonid=&quot;calendar-event-details&quot;</span>
<a href="#l12.782"></a><span id="l12.782" class="difflineplus">+                        align=&quot;start&quot;&gt;</span>
<a href="#l12.783"></a><span id="l12.783" class="difflineplus">+                &lt;xul:image anonid=&quot;item-icon&quot;</span>
<a href="#l12.784"></a><span id="l12.784" class="difflineplus">+                           class=&quot;calendar-item-image&quot;</span>
<a href="#l12.785"></a><span id="l12.785" class="difflineplus">+                           xbl:inherits=&quot;progress,allday,itemType,todoType&quot;/&gt;</span>
<a href="#l12.786"></a><span id="l12.786" class="difflineplus">+                &lt;xul:description anonid=&quot;event-name&quot; class=&quot;calendar-event-details-core&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l12.787"></a><span id="l12.787" class="difflineplus">+                &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l12.788"></a><span id="l12.788" class="difflineplus">+                             class=&quot;plain calendar-event-details-core calendar-event-name-textbox&quot;</span>
<a href="#l12.789"></a><span id="l12.789" class="difflineplus">+                             flex=&quot;1&quot;</span>
<a href="#l12.790"></a><span id="l12.790" class="difflineplus">+                             hidden=&quot;true&quot;</span>
<a href="#l12.791"></a><span id="l12.791" class="difflineplus">+                             wrap=&quot;true&quot;/&gt;</span>
<a href="#l12.792"></a><span id="l12.792" class="difflineplus">+              &lt;/xul:hbox&gt;</span>
<a href="#l12.793"></a><span id="l12.793" class="difflineplus">+              &lt;xul:stack mousethrough=&quot;always&quot;&gt;</span>
<a href="#l12.794"></a><span id="l12.794" class="difflineplus">+                &lt;xul:calendar-category-box anonid=&quot;category-box&quot; xbl:inherits=&quot;categories&quot; pack=&quot;end&quot; /&gt;</span>
<a href="#l12.795"></a><span id="l12.795" class="difflineplus">+                &lt;xul:hbox align=&quot;right&quot;&gt;</span>
<a href="#l12.796"></a><span id="l12.796" class="difflineplus">+                  &lt;xul:hbox anonid=&quot;alarm-icons-box&quot;</span>
<a href="#l12.797"></a><span id="l12.797" class="difflineplus">+                            class=&quot;alarm-icons-box&quot;</span>
<a href="#l12.798"></a><span id="l12.798" class="difflineplus">+                            pack=&quot;end&quot;</span>
<a href="#l12.799"></a><span id="l12.799" class="difflineplus">+                            align=&quot;top&quot;</span>
<a href="#l12.800"></a><span id="l12.800" class="difflineplus">+                            xbl:inherits=&quot;flashing&quot;/&gt;</span>
<a href="#l12.801"></a><span id="l12.801" class="difflineplus">+                  &lt;xul:image anonid=&quot;item-classification-box&quot;</span>
<a href="#l12.802"></a><span id="l12.802" class="difflineplus">+                             class=&quot;item-classification-box&quot;</span>
<a href="#l12.803"></a><span id="l12.803" class="difflineplus">+                             pack=&quot;end&quot;/&gt;</span>
<a href="#l12.804"></a><span id="l12.804">                 &lt;/xul:hbox&gt;</span>
<a href="#l12.805"></a><span id="l12.805" class="difflineminus">-                &lt;xul:stack mousethrough=&quot;always&quot;&gt;</span>
<a href="#l12.806"></a><span id="l12.806" class="difflineminus">-                  &lt;xul:calendar-category-box anonid=&quot;category-box&quot; xbl:inherits=&quot;categories&quot; pack=&quot;end&quot; /&gt;</span>
<a href="#l12.807"></a><span id="l12.807" class="difflineminus">-                  &lt;xul:hbox align=&quot;right&quot;&gt;</span>
<a href="#l12.808"></a><span id="l12.808" class="difflineminus">-                    &lt;xul:hbox anonid=&quot;alarm-icons-box&quot;</span>
<a href="#l12.809"></a><span id="l12.809" class="difflineminus">-                              class=&quot;alarm-icons-box&quot;</span>
<a href="#l12.810"></a><span id="l12.810" class="difflineminus">-                              pack=&quot;end&quot;</span>
<a href="#l12.811"></a><span id="l12.811" class="difflineminus">-                              align=&quot;top&quot;</span>
<a href="#l12.812"></a><span id="l12.812" class="difflineminus">-                              xbl:inherits=&quot;flashing&quot;/&gt;</span>
<a href="#l12.813"></a><span id="l12.813" class="difflineminus">-                    &lt;xul:image anonid=&quot;item-classification-box&quot;</span>
<a href="#l12.814"></a><span id="l12.814" class="difflineminus">-                               class=&quot;item-classification-box&quot;</span>
<a href="#l12.815"></a><span id="l12.815" class="difflineminus">-                               pack=&quot;end&quot;/&gt;</span>
<a href="#l12.816"></a><span id="l12.816" class="difflineminus">-                  &lt;/xul:hbox&gt;</span>
<a href="#l12.817"></a><span id="l12.817" class="difflineminus">-                &lt;/xul:stack&gt;</span>
<a href="#l12.818"></a><span id="l12.818" class="difflineminus">-                &lt;xul:box xbl:inherits=&quot;orient&quot;&gt;</span>
<a href="#l12.819"></a><span id="l12.819" class="difflineminus">-                  &lt;xul:calendar-event-gripbar anonid=&quot;gripbar1&quot;</span>
<a href="#l12.820"></a><span id="l12.820" class="difflineminus">-                                              class=&quot;calendar-event-box-grippy-top&quot;</span>
<a href="#l12.821"></a><span id="l12.821" class="difflineminus">-                                              mousethrough=&quot;never&quot;</span>
<a href="#l12.822"></a><span id="l12.822" class="difflineminus">-                                              whichside=&quot;start&quot;</span>
<a href="#l12.823"></a><span id="l12.823" class="difflineminus">-                                              xbl:inherits=&quot;parentorient=orient&quot;/&gt;</span>
<a href="#l12.824"></a><span id="l12.824" class="difflineminus">-                  &lt;xul:spacer mousethrough=&quot;always&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l12.825"></a><span id="l12.825" class="difflineminus">-                  &lt;xul:calendar-event-gripbar anonid=&quot;gripbar2&quot;</span>
<a href="#l12.826"></a><span id="l12.826" class="difflineminus">-                                              class=&quot;calendar-event-box-grippy-bottom&quot;</span>
<a href="#l12.827"></a><span id="l12.827" class="difflineminus">-                                              mousethrough=&quot;never&quot;</span>
<a href="#l12.828"></a><span id="l12.828" class="difflineminus">-                                              whichside=&quot;end&quot;</span>
<a href="#l12.829"></a><span id="l12.829" class="difflineminus">-                                              xbl:inherits=&quot;parentorient=orient&quot;/&gt;</span>
<a href="#l12.830"></a><span id="l12.830" class="difflineminus">-                &lt;/xul:box&gt;</span>
<a href="#l12.831"></a><span id="l12.831" class="difflineminus">-                &lt;!-- Do not insert anything here, otherwise the event boxes will</span>
<a href="#l12.832"></a><span id="l12.832" class="difflineminus">-                     not be resizable using the gripbars. If you want to insert</span>
<a href="#l12.833"></a><span id="l12.833" class="difflineminus">-                     additional elements, do so above the box with the gripbars. --&gt;</span>
<a href="#l12.834"></a><span id="l12.834">               &lt;/xul:stack&gt;</span>
<a href="#l12.835"></a><span id="l12.835" class="difflineminus">-            &lt;/xul:box&gt;</span>
<a href="#l12.836"></a><span id="l12.836" class="difflineplus">+              &lt;xul:box xbl:inherits=&quot;orient&quot;&gt;</span>
<a href="#l12.837"></a><span id="l12.837" class="difflineplus">+                &lt;xul:calendar-event-gripbar anonid=&quot;gripbar1&quot;</span>
<a href="#l12.838"></a><span id="l12.838" class="difflineplus">+                                            class=&quot;calendar-event-box-grippy-top&quot;</span>
<a href="#l12.839"></a><span id="l12.839" class="difflineplus">+                                            mousethrough=&quot;never&quot;</span>
<a href="#l12.840"></a><span id="l12.840" class="difflineplus">+                                            whichside=&quot;start&quot;</span>
<a href="#l12.841"></a><span id="l12.841" class="difflineplus">+                                            xbl:inherits=&quot;parentorient=orient&quot;/&gt;</span>
<a href="#l12.842"></a><span id="l12.842" class="difflineplus">+                &lt;xul:spacer mousethrough=&quot;always&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l12.843"></a><span id="l12.843" class="difflineplus">+                &lt;xul:calendar-event-gripbar anonid=&quot;gripbar2&quot;</span>
<a href="#l12.844"></a><span id="l12.844" class="difflineplus">+                                            class=&quot;calendar-event-box-grippy-bottom&quot;</span>
<a href="#l12.845"></a><span id="l12.845" class="difflineplus">+                                            mousethrough=&quot;never&quot;</span>
<a href="#l12.846"></a><span id="l12.846" class="difflineplus">+                                            whichside=&quot;end&quot;</span>
<a href="#l12.847"></a><span id="l12.847" class="difflineplus">+                                            xbl:inherits=&quot;parentorient=orient&quot;/&gt;</span>
<a href="#l12.848"></a><span id="l12.848" class="difflineplus">+              &lt;/xul:box&gt;</span>
<a href="#l12.849"></a><span id="l12.849" class="difflineplus">+              &lt;!-- Do not insert anything here, otherwise the event boxes will</span>
<a href="#l12.850"></a><span id="l12.850" class="difflineplus">+                   not be resizable using the gripbars. If you want to insert</span>
<a href="#l12.851"></a><span id="l12.851" class="difflineplus">+                   additional elements, do so above the box with the gripbars. --&gt;</span>
<a href="#l12.852"></a><span id="l12.852" class="difflineplus">+            &lt;/xul:stack&gt;</span>
<a href="#l12.853"></a><span id="l12.853">           &lt;/xul:box&gt;</span>
<a href="#l12.854"></a><span id="l12.854" class="difflineplus">+        &lt;/xul:box&gt;</span>
<a href="#l12.855"></a><span id="l12.855">       &lt;/xul:box&gt;</span>
<a href="#l12.856"></a><span id="l12.856">     &lt;/content&gt;</span>
<a href="#l12.857"></a><span id="l12.857"> </span>
<a href="#l12.858"></a><span id="l12.858">     &lt;implementation&gt;</span>
<a href="#l12.859"></a><span id="l12.859">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l12.860"></a><span id="l12.860">          this.orient = this.getAttribute(&quot;orient&quot;);</span>
<a href="#l12.861"></a><span id="l12.861">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l12.862"></a><span id="l12.862"> </span>
<a href="#l12.863"></a><span id="l12.863" class="difflineat">@@ -2370,44 +2359,44 @@</span>
<a href="#l12.864"></a><span id="l12.864">       &lt;/method&gt;</span>
<a href="#l12.865"></a><span id="l12.865"> </span>
<a href="#l12.866"></a><span id="l12.866">       &lt;property name=&quot;parentColumn&quot;</span>
<a href="#l12.867"></a><span id="l12.867">         onget=&quot;return this.mParentColumn;&quot;</span>
<a href="#l12.868"></a><span id="l12.868">         onset=&quot;return (this.mParentColumn = val);&quot;/&gt;</span>
<a href="#l12.869"></a><span id="l12.869"> </span>
<a href="#l12.870"></a><span id="l12.870">       &lt;property name=&quot;startMinute&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.871"></a><span id="l12.871">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.872"></a><span id="l12.872" class="difflineminus">-            if (!this.mOccurrence) {</span>
<a href="#l12.873"></a><span id="l12.873" class="difflineminus">-                return 0;</span>
<a href="#l12.874"></a><span id="l12.874" class="difflineminus">-            }</span>
<a href="#l12.875"></a><span id="l12.875" class="difflineminus">-            let startDate = this.mOccurrence.startDate || this.mOccurrence.entryDate;</span>
<a href="#l12.876"></a><span id="l12.876" class="difflineminus">-            return startDate.hour * 60 + startDate.minute;</span>
<a href="#l12.877"></a><span id="l12.877" class="difflineplus">+          if (!this.mOccurrence) {</span>
<a href="#l12.878"></a><span id="l12.878" class="difflineplus">+              return 0;</span>
<a href="#l12.879"></a><span id="l12.879" class="difflineplus">+          }</span>
<a href="#l12.880"></a><span id="l12.880" class="difflineplus">+          let startDate = this.mOccurrence.startDate || this.mOccurrence.entryDate;</span>
<a href="#l12.881"></a><span id="l12.881" class="difflineplus">+          return startDate.hour * 60 + startDate.minute;</span>
<a href="#l12.882"></a><span id="l12.882">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.883"></a><span id="l12.883">       &lt;/property&gt;</span>
<a href="#l12.884"></a><span id="l12.884"> </span>
<a href="#l12.885"></a><span id="l12.885">       &lt;property name=&quot;endMinute&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.886"></a><span id="l12.886">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.887"></a><span id="l12.887" class="difflineminus">-            if (!this.mOccurrence) {</span>
<a href="#l12.888"></a><span id="l12.888" class="difflineminus">-                return 0;</span>
<a href="#l12.889"></a><span id="l12.889" class="difflineminus">-            }</span>
<a href="#l12.890"></a><span id="l12.890" class="difflineminus">-            let endDate = this.mOccurrence.endDate || this.mOccurrence.dueDate;</span>
<a href="#l12.891"></a><span id="l12.891" class="difflineminus">-            return endDate.hour * 60 + endDate.minute;</span>
<a href="#l12.892"></a><span id="l12.892" class="difflineplus">+          if (!this.mOccurrence) {</span>
<a href="#l12.893"></a><span id="l12.893" class="difflineplus">+              return 0;</span>
<a href="#l12.894"></a><span id="l12.894" class="difflineplus">+          }</span>
<a href="#l12.895"></a><span id="l12.895" class="difflineplus">+          let endDate = this.mOccurrence.endDate || this.mOccurrence.dueDate;</span>
<a href="#l12.896"></a><span id="l12.896" class="difflineplus">+          return endDate.hour * 60 + endDate.minute;</span>
<a href="#l12.897"></a><span id="l12.897">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.898"></a><span id="l12.898">       &lt;/property&gt;</span>
<a href="#l12.899"></a><span id="l12.899"> </span>
<a href="#l12.900"></a><span id="l12.900">       &lt;method name=&quot;setEditableLabel&quot;&gt;</span>
<a href="#l12.901"></a><span id="l12.901">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.902"></a><span id="l12.902">           let evl = this.eventNameLabel;</span>
<a href="#l12.903"></a><span id="l12.903">           let item = this.mOccurrence;</span>
<a href="#l12.904"></a><span id="l12.904"> </span>
<a href="#l12.905"></a><span id="l12.905">           if (item.title &amp;&amp; item.title != &quot;&quot;) {</span>
<a href="#l12.906"></a><span id="l12.906" class="difflineminus">-            // Use &lt;description&gt; textContent so it can wrap.</span>
<a href="#l12.907"></a><span id="l12.907" class="difflineminus">-            evl.textContent = item.title;</span>
<a href="#l12.908"></a><span id="l12.908" class="difflineplus">+              // Use &lt;description&gt; textContent so it can wrap.</span>
<a href="#l12.909"></a><span id="l12.909" class="difflineplus">+              evl.textContent = item.title;</span>
<a href="#l12.910"></a><span id="l12.910">           } else {</span>
<a href="#l12.911"></a><span id="l12.911" class="difflineminus">-            evl.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l12.912"></a><span id="l12.912" class="difflineplus">+              evl.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l12.913"></a><span id="l12.913">           }</span>
<a href="#l12.914"></a><span id="l12.914"> </span>
<a href="#l12.915"></a><span id="l12.915">           let gripbar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;gripbar1&quot;).boxObject.height;</span>
<a href="#l12.916"></a><span id="l12.916">           let height = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;eventbox&quot;).boxObject.height;</span>
<a href="#l12.917"></a><span id="l12.917">           evl.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + Math.max(0, height-gripbar * 2) + &quot;px&quot;);</span>
<a href="#l12.918"></a><span id="l12.918">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.919"></a><span id="l12.919">       &lt;/method&gt;</span>
<a href="#l12.920"></a><span id="l12.920">     &lt;/implementation&gt;</span>
<a href="#l12.921"></a><span id="l12.921" class="difflineat">@@ -2751,54 +2740,55 @@</span>
<a href="#l12.922"></a><span id="l12.922">       &lt;field name=&quot;mTimeIndicatorInterval&quot;&gt;15&lt;/field&gt;</span>
<a href="#l12.923"></a><span id="l12.923">       &lt;field name=&quot;mModeHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l12.924"></a><span id="l12.924">       &lt;field name=&quot;mTimeIndicatorMinutes&quot;&gt;0&lt;/field&gt;</span>
<a href="#l12.925"></a><span id="l12.925"> </span>
<a href="#l12.926"></a><span id="l12.926">       &lt;method name=&quot;flashAlarm&quot;&gt;</span>
<a href="#l12.927"></a><span id="l12.927">         &lt;parameter name=&quot;aAlarmItem&quot;/&gt;</span>
<a href="#l12.928"></a><span id="l12.928">         &lt;parameter name=&quot;aStop&quot;/&gt;</span>
<a href="#l12.929"></a><span id="l12.929">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.930"></a><span id="l12.930" class="difflineplus">+          // Helper function to save some duplicate code</span>
<a href="#l12.931"></a><span id="l12.931" class="difflineplus">+          function setFlashingAttribute(aBox) {</span>
<a href="#l12.932"></a><span id="l12.932" class="difflineplus">+              if (aStop) {</span>
<a href="#l12.933"></a><span id="l12.933" class="difflineplus">+                  aBox.removeAttribute(&quot;flashing&quot;);</span>
<a href="#l12.934"></a><span id="l12.934" class="difflineplus">+              } else {</span>
<a href="#l12.935"></a><span id="l12.935" class="difflineplus">+                  aBox.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l12.936"></a><span id="l12.936" class="difflineplus">+              }</span>
<a href="#l12.937"></a><span id="l12.937" class="difflineplus">+          }</span>
<a href="#l12.938"></a><span id="l12.938" class="difflineplus">+</span>
<a href="#l12.939"></a><span id="l12.939">           let showIndicator = Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l12.940"></a><span id="l12.940">           let totaltime = Preferences.get(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l12.941"></a><span id="l12.941"> </span>
<a href="#l12.942"></a><span id="l12.942">           if (!aStop &amp;&amp; (!showIndicator || totaltime &lt; 1)) {</span>
<a href="#l12.943"></a><span id="l12.943" class="difflineminus">-            // No need to animate if the indicator should not be shown.</span>
<a href="#l12.944"></a><span id="l12.944" class="difflineminus">-            return;</span>
<a href="#l12.945"></a><span id="l12.945" class="difflineplus">+              // No need to animate if the indicator should not be shown.</span>
<a href="#l12.946"></a><span id="l12.946" class="difflineplus">+              return;</span>
<a href="#l12.947"></a><span id="l12.947">           }</span>
<a href="#l12.948"></a><span id="l12.948"> </span>
<a href="#l12.949"></a><span id="l12.949" class="difflineminus">-          // Helper function to save some duplicate code</span>
<a href="#l12.950"></a><span id="l12.950" class="difflineminus">-          function setFlashingAttribute(aBox) {</span>
<a href="#l12.951"></a><span id="l12.951" class="difflineminus">-            if (aStop) {</span>
<a href="#l12.952"></a><span id="l12.952" class="difflineminus">-              aBox.removeAttribute(&quot;flashing&quot;);</span>
<a href="#l12.953"></a><span id="l12.953" class="difflineminus">-            } else {</span>
<a href="#l12.954"></a><span id="l12.954" class="difflineminus">-              aBox.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l12.955"></a><span id="l12.955" class="difflineminus">-            }</span>
<a href="#l12.956"></a><span id="l12.956" class="difflineminus">-          }</span>
<a href="#l12.957"></a><span id="l12.957"> </span>
<a href="#l12.958"></a><span id="l12.958">           // Make sure the flashing attribute is set or reset on all visible</span>
<a href="#l12.959"></a><span id="l12.959">           // boxes.</span>
<a href="#l12.960"></a><span id="l12.960">           let columns = this.findColumnsForItem(aAlarmItem);</span>
<a href="#l12.961"></a><span id="l12.961">           for (let col of columns) {</span>
<a href="#l12.962"></a><span id="l12.962" class="difflineminus">-            let box = col.column.findChunkForOccurrence(aAlarmItem);</span>
<a href="#l12.963"></a><span id="l12.963" class="difflineminus">-            if (box &amp;&amp; box.eventbox) {</span>
<a href="#l12.964"></a><span id="l12.964" class="difflineminus">-              setFlashingAttribute(box.eventbox);</span>
<a href="#l12.965"></a><span id="l12.965" class="difflineminus">-            }</span>
<a href="#l12.966"></a><span id="l12.966" class="difflineminus">-            box = col.header.findBoxForItem(aAlarmItem);</span>
<a href="#l12.967"></a><span id="l12.967" class="difflineminus">-            if (box) {</span>
<a href="#l12.968"></a><span id="l12.968" class="difflineminus">-              setFlashingAttribute(box);</span>
<a href="#l12.969"></a><span id="l12.969" class="difflineminus">-            }</span>
<a href="#l12.970"></a><span id="l12.970" class="difflineplus">+              let box = col.column.findChunkForOccurrence(aAlarmItem);</span>
<a href="#l12.971"></a><span id="l12.971" class="difflineplus">+              if (box &amp;&amp; box.eventbox) {</span>
<a href="#l12.972"></a><span id="l12.972" class="difflineplus">+                  setFlashingAttribute(box.eventbox);</span>
<a href="#l12.973"></a><span id="l12.973" class="difflineplus">+              }</span>
<a href="#l12.974"></a><span id="l12.974" class="difflineplus">+              box = col.header.findBoxForItem(aAlarmItem);</span>
<a href="#l12.975"></a><span id="l12.975" class="difflineplus">+              if (box) {</span>
<a href="#l12.976"></a><span id="l12.976" class="difflineplus">+                  setFlashingAttribute(box);</span>
<a href="#l12.977"></a><span id="l12.977" class="difflineplus">+              }</span>
<a href="#l12.978"></a><span id="l12.978">           }</span>
<a href="#l12.979"></a><span id="l12.979"> </span>
<a href="#l12.980"></a><span id="l12.980">           if (aStop) {</span>
<a href="#l12.981"></a><span id="l12.981" class="difflineminus">-            // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l12.982"></a><span id="l12.982" class="difflineminus">-            delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l12.983"></a><span id="l12.983" class="difflineplus">+              // We are done flashing, prevent newly created event boxes from flashing.</span>
<a href="#l12.984"></a><span id="l12.984" class="difflineplus">+              delete this.mFlashingEvents[aAlarmItem.hashId];</span>
<a href="#l12.985"></a><span id="l12.985">           } else {</span>
<a href="#l12.986"></a><span id="l12.986" class="difflineminus">-            // Set up a timer to stop the flashing after the total time.</span>
<a href="#l12.987"></a><span id="l12.987" class="difflineminus">-            this.mFlashingEvents[aAlarmItem.hashId] = aAlarmItem;</span>
<a href="#l12.988"></a><span id="l12.988" class="difflineminus">-            setTimeout(() =&gt; this.flashAlarm(aAlarmItem, true), totaltime);</span>
<a href="#l12.989"></a><span id="l12.989" class="difflineplus">+              // Set up a timer to stop the flashing after the total time.</span>
<a href="#l12.990"></a><span id="l12.990" class="difflineplus">+              this.mFlashingEvents[aAlarmItem.hashId] = aAlarmItem;</span>
<a href="#l12.991"></a><span id="l12.991" class="difflineplus">+              setTimeout(() =&gt; this.flashAlarm(aAlarmItem, true), totaltime);</span>
<a href="#l12.992"></a><span id="l12.992">           }</span>
<a href="#l12.993"></a><span id="l12.993">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.994"></a><span id="l12.994">       &lt;/method&gt;</span>
<a href="#l12.995"></a><span id="l12.995"> </span>
<a href="#l12.996"></a><span id="l12.996">       &lt;!-- calICalendarView --&gt;</span>
<a href="#l12.997"></a><span id="l12.997">       &lt;property name=&quot;supportsDisjointDates&quot;</span>
<a href="#l12.998"></a><span id="l12.998">         onget=&quot;return true&quot;/&gt;</span>
<a href="#l12.999"></a><span id="l12.999">       &lt;property name=&quot;hasDisjointDates&quot;</span>
<a href="#l12.1000"></a><span id="l12.1000" class="difflineat">@@ -2846,19 +2836,19 @@</span>
<a href="#l12.1001"></a><span id="l12.1001">                       return;</span>
<a href="#l12.1002"></a><span id="l12.1002">                   }</span>
<a href="#l12.1003"></a><span id="l12.1003">               }</span>
<a href="#l12.1004"></a><span id="l12.1004">           }</span>
<a href="#l12.1005"></a><span id="l12.1005"> </span>
<a href="#l12.1006"></a><span id="l12.1006">           // if we're only showing one date, then continue</span>
<a href="#l12.1007"></a><span id="l12.1007">           // to only show one date; otherwise, show the week.</span>
<a href="#l12.1008"></a><span id="l12.1008">           if (this.numVisibleDates == 1) {</span>
<a href="#l12.1009"></a><span id="l12.1009" class="difflineminus">-            this.setDateRange(aDate, aDate);</span>
<a href="#l12.1010"></a><span id="l12.1010" class="difflineplus">+              this.setDateRange(aDate, aDate);</span>
<a href="#l12.1011"></a><span id="l12.1011">           } else {</span>
<a href="#l12.1012"></a><span id="l12.1012" class="difflineminus">-            this.setDateRange(aDate.startOfWeek, aDate.endOfWeek);</span>
<a href="#l12.1013"></a><span id="l12.1013" class="difflineplus">+              this.setDateRange(aDate.startOfWeek, aDate.endOfWeek);</span>
<a href="#l12.1014"></a><span id="l12.1014">           }</span>
<a href="#l12.1015"></a><span id="l12.1015"> </span>
<a href="#l12.1016"></a><span id="l12.1016">           this.selectedDay = targetDate;</span>
<a href="#l12.1017"></a><span id="l12.1017">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1018"></a><span id="l12.1018">       &lt;/method&gt;</span>
<a href="#l12.1019"></a><span id="l12.1019"> </span>
<a href="#l12.1020"></a><span id="l12.1020">       &lt;method name=&quot;setDateRange&quot;&gt;</span>
<a href="#l12.1021"></a><span id="l12.1021">         &lt;parameter name=&quot;aStartDate&quot;/&gt;</span>
<a href="#l12.1022"></a><span id="l12.1022" class="difflineat">@@ -2912,40 +2902,40 @@</span>
<a href="#l12.1023"></a><span id="l12.1023">               this.refresh();</span>
<a href="#l12.1024"></a><span id="l12.1024">           }</span>
<a href="#l12.1025"></a><span id="l12.1025">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1026"></a><span id="l12.1026">       &lt;/method&gt;</span>
<a href="#l12.1027"></a><span id="l12.1027"> </span>
<a href="#l12.1028"></a><span id="l12.1028">       &lt;method name=&quot;getDateList&quot;&gt;</span>
<a href="#l12.1029"></a><span id="l12.1029">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l12.1030"></a><span id="l12.1030">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1031"></a><span id="l12.1031" class="difflineminus">-           let dates = [];</span>
<a href="#l12.1032"></a><span id="l12.1032" class="difflineminus">-           if (this.mStartDate &amp;&amp; this.mEndDate) {</span>
<a href="#l12.1033"></a><span id="l12.1033" class="difflineminus">-               let date = this.mStartDate.clone();</span>
<a href="#l12.1034"></a><span id="l12.1034" class="difflineminus">-               while (date.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l12.1035"></a><span id="l12.1035" class="difflineminus">-                   dates.push(d.clone());</span>
<a href="#l12.1036"></a><span id="l12.1036" class="difflineminus">-                   date.day += 1;</span>
<a href="#l12.1037"></a><span id="l12.1037" class="difflineminus">-               }</span>
<a href="#l12.1038"></a><span id="l12.1038" class="difflineminus">-           } else if (this.mDateList) {</span>
<a href="#l12.1039"></a><span id="l12.1039" class="difflineminus">-               for (let date of this.mDateList) {</span>
<a href="#l12.1040"></a><span id="l12.1040" class="difflineminus">-                   dates.push(date.clone());</span>
<a href="#l12.1041"></a><span id="l12.1041" class="difflineminus">-               }</span>
<a href="#l12.1042"></a><span id="l12.1042" class="difflineminus">-           }</span>
<a href="#l12.1043"></a><span id="l12.1043" class="difflineminus">-</span>
<a href="#l12.1044"></a><span id="l12.1044" class="difflineminus">-           aCount.value = dates.length;</span>
<a href="#l12.1045"></a><span id="l12.1045" class="difflineminus">-           return dates;</span>
<a href="#l12.1046"></a><span id="l12.1046" class="difflineplus">+          let dates = [];</span>
<a href="#l12.1047"></a><span id="l12.1047" class="difflineplus">+          if (this.mStartDate &amp;&amp; this.mEndDate) {</span>
<a href="#l12.1048"></a><span id="l12.1048" class="difflineplus">+              let date = this.mStartDate.clone();</span>
<a href="#l12.1049"></a><span id="l12.1049" class="difflineplus">+              while (date.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l12.1050"></a><span id="l12.1050" class="difflineplus">+                  dates.push(d.clone());</span>
<a href="#l12.1051"></a><span id="l12.1051" class="difflineplus">+                  date.day += 1;</span>
<a href="#l12.1052"></a><span id="l12.1052" class="difflineplus">+              }</span>
<a href="#l12.1053"></a><span id="l12.1053" class="difflineplus">+          } else if (this.mDateList) {</span>
<a href="#l12.1054"></a><span id="l12.1054" class="difflineplus">+              for (let date of this.mDateList) {</span>
<a href="#l12.1055"></a><span id="l12.1055" class="difflineplus">+                  dates.push(date.clone());</span>
<a href="#l12.1056"></a><span id="l12.1056" class="difflineplus">+              }</span>
<a href="#l12.1057"></a><span id="l12.1057" class="difflineplus">+          }</span>
<a href="#l12.1058"></a><span id="l12.1058" class="difflineplus">+</span>
<a href="#l12.1059"></a><span id="l12.1059" class="difflineplus">+          aCount.value = dates.length;</span>
<a href="#l12.1060"></a><span id="l12.1060" class="difflineplus">+          return dates;</span>
<a href="#l12.1061"></a><span id="l12.1061">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1062"></a><span id="l12.1062">       &lt;/method&gt;</span>
<a href="#l12.1063"></a><span id="l12.1063"> </span>
<a href="#l12.1064"></a><span id="l12.1064">       &lt;property name=&quot;selectedDateTime&quot;&gt;</span>
<a href="#l12.1065"></a><span id="l12.1065">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.1066"></a><span id="l12.1066" class="difflineminus">-            return this.mClickedTime;</span>
<a href="#l12.1067"></a><span id="l12.1067" class="difflineplus">+          return this.mClickedTime;</span>
<a href="#l12.1068"></a><span id="l12.1068">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.1069"></a><span id="l12.1069">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l12.1070"></a><span id="l12.1070" class="difflineminus">-            this.mClickedTime = val;</span>
<a href="#l12.1071"></a><span id="l12.1071" class="difflineplus">+          this.mClickedTime = val;</span>
<a href="#l12.1072"></a><span id="l12.1072">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l12.1073"></a><span id="l12.1073">       &lt;/property&gt;</span>
<a href="#l12.1074"></a><span id="l12.1074"> </span>
<a href="#l12.1075"></a><span id="l12.1075">       &lt;property name=&quot;selectedDay&quot;&gt;</span>
<a href="#l12.1076"></a><span id="l12.1076">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.1077"></a><span id="l12.1077">           let selected;</span>
<a href="#l12.1078"></a><span id="l12.1078">           if (this.numVisibleDates == 1) {</span>
<a href="#l12.1079"></a><span id="l12.1079">               selected = this.mDateColumns[0].date;</span>
<a href="#l12.1080"></a><span id="l12.1080" class="difflineat">@@ -2958,34 +2948,34 @@</span>
<a href="#l12.1081"></a><span id="l12.1081">           // TODO Make sure the selected day is valid</span>
<a href="#l12.1082"></a><span id="l12.1082">           // TODO select now if it is in the range?</span>
<a href="#l12.1083"></a><span id="l12.1083">           return selected;</span>
<a href="#l12.1084"></a><span id="l12.1084">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.1085"></a><span id="l12.1085">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l12.1086"></a><span id="l12.1086">           // ignore if just 1 visible, it's always selected,</span>
<a href="#l12.1087"></a><span id="l12.1087">           // but we don't indicate it</span>
<a href="#l12.1088"></a><span id="l12.1088">           if (this.numVisibleDates == 1) {</span>
<a href="#l12.1089"></a><span id="l12.1089" class="difflineminus">-            this.fireEvent(&quot;dayselect&quot;, val);</span>
<a href="#l12.1090"></a><span id="l12.1090" class="difflineminus">-            return val;</span>
<a href="#l12.1091"></a><span id="l12.1091" class="difflineplus">+              this.fireEvent(&quot;dayselect&quot;, val);</span>
<a href="#l12.1092"></a><span id="l12.1092" class="difflineplus">+              return val;</span>
<a href="#l12.1093"></a><span id="l12.1093">           }</span>
<a href="#l12.1094"></a><span id="l12.1094"> </span>
<a href="#l12.1095"></a><span id="l12.1095">           if (this.mSelectedDayCol) {</span>
<a href="#l12.1096"></a><span id="l12.1096" class="difflineminus">-            this.mSelectedDayCol.column.selected = false;</span>
<a href="#l12.1097"></a><span id="l12.1097" class="difflineminus">-            this.mSelectedDayCol.header.removeAttribute(&quot;selected&quot;);</span>
<a href="#l12.1098"></a><span id="l12.1098" class="difflineplus">+              this.mSelectedDayCol.column.selected = false;</span>
<a href="#l12.1099"></a><span id="l12.1099" class="difflineplus">+              this.mSelectedDayCol.header.removeAttribute(&quot;selected&quot;);</span>
<a href="#l12.1100"></a><span id="l12.1100">           }</span>
<a href="#l12.1101"></a><span id="l12.1101"> </span>
<a href="#l12.1102"></a><span id="l12.1102">           if (val) {</span>
<a href="#l12.1103"></a><span id="l12.1103" class="difflineminus">-            this.mSelectedDayCol = this.findColumnForDate(val);</span>
<a href="#l12.1104"></a><span id="l12.1104" class="difflineminus">-            if (this.mSelectedDayCol) {</span>
<a href="#l12.1105"></a><span id="l12.1105" class="difflineminus">-              this.mSelectedDay = this.mSelectedDayCol.date;</span>
<a href="#l12.1106"></a><span id="l12.1106" class="difflineminus">-              this.mSelectedDayCol.column.selected = true;</span>
<a href="#l12.1107"></a><span id="l12.1107" class="difflineminus">-              this.mSelectedDayCol.header.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l12.1108"></a><span id="l12.1108" class="difflineminus">-            } else {</span>
<a href="#l12.1109"></a><span id="l12.1109" class="difflineminus">-              this.mSelectedDay = val;</span>
<a href="#l12.1110"></a><span id="l12.1110" class="difflineminus">-            }</span>
<a href="#l12.1111"></a><span id="l12.1111" class="difflineplus">+              this.mSelectedDayCol = this.findColumnForDate(val);</span>
<a href="#l12.1112"></a><span id="l12.1112" class="difflineplus">+              if (this.mSelectedDayCol) {</span>
<a href="#l12.1113"></a><span id="l12.1113" class="difflineplus">+                  this.mSelectedDay = this.mSelectedDayCol.date;</span>
<a href="#l12.1114"></a><span id="l12.1114" class="difflineplus">+                  this.mSelectedDayCol.column.selected = true;</span>
<a href="#l12.1115"></a><span id="l12.1115" class="difflineplus">+                  this.mSelectedDayCol.header.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l12.1116"></a><span id="l12.1116" class="difflineplus">+              } else {</span>
<a href="#l12.1117"></a><span id="l12.1117" class="difflineplus">+                  this.mSelectedDay = val;</span>
<a href="#l12.1118"></a><span id="l12.1118" class="difflineplus">+              }</span>
<a href="#l12.1119"></a><span id="l12.1119">           }</span>
<a href="#l12.1120"></a><span id="l12.1120">           this.fireEvent(&quot;dayselect&quot;, val);</span>
<a href="#l12.1121"></a><span id="l12.1121">           return val;</span>
<a href="#l12.1122"></a><span id="l12.1122">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l12.1123"></a><span id="l12.1123">       &lt;/property&gt;</span>
<a href="#l12.1124"></a><span id="l12.1124"> </span>
<a href="#l12.1125"></a><span id="l12.1125">       &lt;method name=&quot;getSelectedItems&quot;&gt;</span>
<a href="#l12.1126"></a><span id="l12.1126">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l12.1127"></a><span id="l12.1127" class="difflineat">@@ -3077,17 +3067,17 @@</span>
<a href="#l12.1128"></a><span id="l12.1128">                   // if just has single datetime, treat as zero duration item</span>
<a href="#l12.1129"></a><span id="l12.1129">                   // (such as task with due datetime or start datetime only)</span>
<a href="#l12.1130"></a><span id="l12.1130">                   occStart = occStart || occEnd;</span>
<a href="#l12.1131"></a><span id="l12.1131">                   occEnd = occEnd || occStart;</span>
<a href="#l12.1132"></a><span id="l12.1132">                   // Now both occStart and occEnd are datetimes.</span>
<a href="#l12.1133"></a><span id="l12.1133"> </span>
<a href="#l12.1134"></a><span id="l12.1134">                   // skip occurrence if all-day: it won't show in time view.</span>
<a href="#l12.1135"></a><span id="l12.1135">                   if (occStart.isDate || occEnd.isDate) {</span>
<a href="#l12.1136"></a><span id="l12.1136" class="difflineminus">-                     continue;</span>
<a href="#l12.1137"></a><span id="l12.1137" class="difflineplus">+                      continue;</span>
<a href="#l12.1138"></a><span id="l12.1138">                   }</span>
<a href="#l12.1139"></a><span id="l12.1139"> </span>
<a href="#l12.1140"></a><span id="l12.1140">                   // Trim dates to view.  (Not mutated so just reuse view dates)</span>
<a href="#l12.1141"></a><span id="l12.1141">                   if (this.startDate.compare(occStart) &gt; 0) {</span>
<a href="#l12.1142"></a><span id="l12.1142">                       occStart = this.startDate;</span>
<a href="#l12.1143"></a><span id="l12.1143">                   }</span>
<a href="#l12.1144"></a><span id="l12.1144">                   if (this.queryEndDate.compare(occEnd) &lt; 0) {</span>
<a href="#l12.1145"></a><span id="l12.1145">                       occEnd = this.queryEndDate;</span>
<a href="#l12.1146"></a><span id="l12.1146" class="difflineat">@@ -3155,39 +3145,44 @@</span>
<a href="#l12.1147"></a><span id="l12.1147">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l12.1148"></a><span id="l12.1148">       &lt;/property&gt;</span>
<a href="#l12.1149"></a><span id="l12.1149"> </span>
<a href="#l12.1150"></a><span id="l12.1150">       &lt;!-- private --&gt;</span>
<a href="#l12.1151"></a><span id="l12.1151"> </span>
<a href="#l12.1152"></a><span id="l12.1152">       &lt;property name=&quot;numVisibleDates&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.1153"></a><span id="l12.1153">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.1154"></a><span id="l12.1154">           if (this.mDateList) {</span>
<a href="#l12.1155"></a><span id="l12.1155" class="difflineminus">-            return this.mDateList.length;</span>
<a href="#l12.1156"></a><span id="l12.1156" class="difflineplus">+              return this.mDateList.length;</span>
<a href="#l12.1157"></a><span id="l12.1157">           }</span>
<a href="#l12.1158"></a><span id="l12.1158"> </span>
<a href="#l12.1159"></a><span id="l12.1159">           let count = 0;</span>
<a href="#l12.1160"></a><span id="l12.1160"> </span>
<a href="#l12.1161"></a><span id="l12.1161">           if (!this.mStartDate || !this.mEndDate) {</span>
<a href="#l12.1162"></a><span id="l12.1162" class="difflineminus">-            // The view has not been initialized, so there are 0 visible dates.</span>
<a href="#l12.1163"></a><span id="l12.1163" class="difflineminus">-            return count;</span>
<a href="#l12.1164"></a><span id="l12.1164" class="difflineplus">+              // The view has not been initialized, so there are 0 visible dates.</span>
<a href="#l12.1165"></a><span id="l12.1165" class="difflineplus">+              return count;</span>
<a href="#l12.1166"></a><span id="l12.1166">           }</span>
<a href="#l12.1167"></a><span id="l12.1167"> </span>
<a href="#l12.1168"></a><span id="l12.1168">           let date = this.mStartDate.clone();</span>
<a href="#l12.1169"></a><span id="l12.1169">           while (date.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l12.1170"></a><span id="l12.1170" class="difflineminus">-            count++;</span>
<a href="#l12.1171"></a><span id="l12.1171" class="difflineminus">-            date.day += 1;</span>
<a href="#l12.1172"></a><span id="l12.1172" class="difflineplus">+              count++;</span>
<a href="#l12.1173"></a><span id="l12.1173" class="difflineplus">+              date.day += 1;</span>
<a href="#l12.1174"></a><span id="l12.1174">           }</span>
<a href="#l12.1175"></a><span id="l12.1175"> </span>
<a href="#l12.1176"></a><span id="l12.1176">           return count;</span>
<a href="#l12.1177"></a><span id="l12.1177">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.1178"></a><span id="l12.1178">       &lt;/property&gt;</span>
<a href="#l12.1179"></a><span id="l12.1179"> </span>
<a href="#l12.1180"></a><span id="l12.1180">       &lt;property name=&quot;orient&quot;&gt;</span>
<a href="#l12.1181"></a><span id="l12.1181" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[return this.getAttribute(&quot;orient&quot;) || &quot;vertical&quot;;]]&gt;&lt;/getter&gt;</span>
<a href="#l12.1182"></a><span id="l12.1182" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[this.setAttribute(&quot;orient&quot;, val); return val;]]&gt;&lt;/setter&gt;</span>
<a href="#l12.1183"></a><span id="l12.1183" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.1184"></a><span id="l12.1184" class="difflineplus">+          return this.getAttribute(&quot;orient&quot;) || &quot;vertical&quot;;</span>
<a href="#l12.1185"></a><span id="l12.1185" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.1186"></a><span id="l12.1186" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l12.1187"></a><span id="l12.1187" class="difflineplus">+          this.setAttribute(&quot;orient&quot;, val);</span>
<a href="#l12.1188"></a><span id="l12.1188" class="difflineplus">+          return val;</span>
<a href="#l12.1189"></a><span id="l12.1189" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l12.1190"></a><span id="l12.1190">       &lt;/property&gt;</span>
<a href="#l12.1191"></a><span id="l12.1191"> </span>
<a href="#l12.1192"></a><span id="l12.1192">       &lt;property name=&quot;timeBarTimeIndicator&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l12.1193"></a><span id="l12.1193">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.1194"></a><span id="l12.1194">           let timebar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timebar&quot;);</span>
<a href="#l12.1195"></a><span id="l12.1195">           return document.getAnonymousElementByAttribute(timebar, &quot;anonid&quot;, &quot;timeIndicatorBoxTimeBar&quot;);</span>
<a href="#l12.1196"></a><span id="l12.1196">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.1197"></a><span id="l12.1197">       &lt;/property&gt;</span>
<a href="#l12.1198"></a><span id="l12.1198" class="difflineat">@@ -3493,41 +3488,41 @@</span>
<a href="#l12.1199"></a><span id="l12.1199">           }</span>
<a href="#l12.1200"></a><span id="l12.1200">           return null;</span>
<a href="#l12.1201"></a><span id="l12.1201">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1202"></a><span id="l12.1202">       &lt;/method&gt;</span>
<a href="#l12.1203"></a><span id="l12.1203"> </span>
<a href="#l12.1204"></a><span id="l12.1204">       &lt;method name=&quot;findDayBoxForDate&quot;&gt;</span>
<a href="#l12.1205"></a><span id="l12.1205">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l12.1206"></a><span id="l12.1206">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1207"></a><span id="l12.1207" class="difflineminus">-            let col = this.findColumnForDate(aDate);</span>
<a href="#l12.1208"></a><span id="l12.1208" class="difflineminus">-            return (col &amp;&amp; col.header);</span>
<a href="#l12.1209"></a><span id="l12.1209" class="difflineplus">+          let col = this.findColumnForDate(aDate);</span>
<a href="#l12.1210"></a><span id="l12.1210" class="difflineplus">+          return (col &amp;&amp; col.header);</span>
<a href="#l12.1211"></a><span id="l12.1211">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1212"></a><span id="l12.1212">       &lt;/method&gt;</span>
<a href="#l12.1213"></a><span id="l12.1213"> </span>
<a href="#l12.1214"></a><span id="l12.1214">       &lt;method name=&quot;selectColumnHeader&quot;&gt;</span>
<a href="#l12.1215"></a><span id="l12.1215">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l12.1216"></a><span id="l12.1216">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1217"></a><span id="l12.1217">           let child = this.labeldaybox.firstChild;</span>
<a href="#l12.1218"></a><span id="l12.1218">           while (child) {</span>
<a href="#l12.1219"></a><span id="l12.1219">               if (child.date.compare(aDate) == 0) {</span>
<a href="#l12.1220"></a><span id="l12.1220">                   child.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l12.1221"></a><span id="l12.1221">               } else {</span>
<a href="#l12.1222"></a><span id="l12.1222">                   child.removeAttribute(&quot;selected&quot;);</span>
<a href="#l12.1223"></a><span id="l12.1223">               }</span>
<a href="#l12.1224"></a><span id="l12.1224">               child = child.nextSibling;</span>
<a href="#l12.1225"></a><span id="l12.1225" class="difflineminus">-            }</span>
<a href="#l12.1226"></a><span id="l12.1226" class="difflineplus">+          }</span>
<a href="#l12.1227"></a><span id="l12.1227">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1228"></a><span id="l12.1228">       &lt;/method&gt;</span>
<a href="#l12.1229"></a><span id="l12.1229"> </span>
<a href="#l12.1230"></a><span id="l12.1230">       &lt;method name=&quot;findColumnsForOccurrences&quot;&gt;</span>
<a href="#l12.1231"></a><span id="l12.1231">         &lt;parameter name=&quot;aOccurrences&quot;/&gt;</span>
<a href="#l12.1232"></a><span id="l12.1232">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1233"></a><span id="l12.1233">           if (!this.mDateColumns || !this.mDateColumns.length) {</span>
<a href="#l12.1234"></a><span id="l12.1234" class="difflineminus">-            return [];</span>
<a href="#l12.1235"></a><span id="l12.1235" class="difflineplus">+              return [];</span>
<a href="#l12.1236"></a><span id="l12.1236">           }</span>
<a href="#l12.1237"></a><span id="l12.1237"> </span>
<a href="#l12.1238"></a><span id="l12.1238">           let occMap = {};</span>
<a href="#l12.1239"></a><span id="l12.1239">           for (let occ of aOccurrences) {</span>
<a href="#l12.1240"></a><span id="l12.1240">               let startDate = occ[calGetStartDateProp(occ)]</span>
<a href="#l12.1241"></a><span id="l12.1241">                               .getInTimezone(this.mStartDate.timezone);</span>
<a href="#l12.1242"></a><span id="l12.1242">               let endDate = occ[calGetEndDateProp(occ)]</span>
<a href="#l12.1243"></a><span id="l12.1243">                               .getInTimezone(this.mEndDate.timezone) || startDate;</span>
<a href="#l12.1244"></a><span id="l12.1244" class="difflineat">@@ -3544,53 +3539,53 @@</span>
<a href="#l12.1245"></a><span id="l12.1245">       &lt;/method&gt;</span>
<a href="#l12.1246"></a><span id="l12.1246"> </span>
<a href="#l12.1247"></a><span id="l12.1247">       &lt;method name=&quot;findColumnsForItem&quot;&gt;</span>
<a href="#l12.1248"></a><span id="l12.1248">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l12.1249"></a><span id="l12.1249">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1250"></a><span id="l12.1250">           let columns = [];</span>
<a href="#l12.1251"></a><span id="l12.1251"> </span>
<a href="#l12.1252"></a><span id="l12.1252">           if (!this.mDateColumns) {</span>
<a href="#l12.1253"></a><span id="l12.1253" class="difflineminus">-            return columns;</span>
<a href="#l12.1254"></a><span id="l12.1254" class="difflineplus">+              return columns;</span>
<a href="#l12.1255"></a><span id="l12.1255">           }</span>
<a href="#l12.1256"></a><span id="l12.1256"> </span>
<a href="#l12.1257"></a><span id="l12.1257">           // Note that these may be dates or datetimes</span>
<a href="#l12.1258"></a><span id="l12.1258">           let startDate = aItem.startDate || aItem.entryDate || aItem.dueDate;</span>
<a href="#l12.1259"></a><span id="l12.1259">           if (!startDate) {</span>
<a href="#l12.1260"></a><span id="l12.1260">               return columns;</span>
<a href="#l12.1261"></a><span id="l12.1261">           }</span>
<a href="#l12.1262"></a><span id="l12.1262">           let timezone = this.mDateColumns[0].date.timezone;</span>
<a href="#l12.1263"></a><span id="l12.1263">           let targetDate = startDate.getInTimezone(timezone);</span>
<a href="#l12.1264"></a><span id="l12.1264">           let finishDate = (aItem.endDate || aItem.dueDate || aItem.entryDate || startDate)</span>
<a href="#l12.1265"></a><span id="l12.1265">                                .getInTimezone(timezone);</span>
<a href="#l12.1266"></a><span id="l12.1266"> </span>
<a href="#l12.1267"></a><span id="l12.1267">           if (!targetDate.isDate) {</span>
<a href="#l12.1268"></a><span id="l12.1268" class="difflineminus">-            // Set the time to 00:00 so that we get all the boxes</span>
<a href="#l12.1269"></a><span id="l12.1269" class="difflineminus">-            targetDate.hour = 0;</span>
<a href="#l12.1270"></a><span id="l12.1270" class="difflineminus">-            targetDate.minute = 0;</span>
<a href="#l12.1271"></a><span id="l12.1271" class="difflineminus">-            targetDate.second = 0;</span>
<a href="#l12.1272"></a><span id="l12.1272" class="difflineplus">+              // Set the time to 00:00 so that we get all the boxes</span>
<a href="#l12.1273"></a><span id="l12.1273" class="difflineplus">+              targetDate.hour = 0;</span>
<a href="#l12.1274"></a><span id="l12.1274" class="difflineplus">+              targetDate.minute = 0;</span>
<a href="#l12.1275"></a><span id="l12.1275" class="difflineplus">+              targetDate.second = 0;</span>
<a href="#l12.1276"></a><span id="l12.1276">           }</span>
<a href="#l12.1277"></a><span id="l12.1277"> </span>
<a href="#l12.1278"></a><span id="l12.1278">           if (targetDate.compare(finishDate) == 0) {</span>
<a href="#l12.1279"></a><span id="l12.1279">               // We have also to handle zero length events in particular for</span>
<a href="#l12.1280"></a><span id="l12.1280">               // tasks without entry or due date.</span>
<a href="#l12.1281"></a><span id="l12.1281">               let col = this.findColumnForDate(targetDate);</span>
<a href="#l12.1282"></a><span id="l12.1282">               if (col) {</span>
<a href="#l12.1283"></a><span id="l12.1283">                   columns.push(col);</span>
<a href="#l12.1284"></a><span id="l12.1284">               }</span>
<a href="#l12.1285"></a><span id="l12.1285">           }</span>
<a href="#l12.1286"></a><span id="l12.1286"> </span>
<a href="#l12.1287"></a><span id="l12.1287">           while (targetDate.compare(finishDate) == -1) {</span>
<a href="#l12.1288"></a><span id="l12.1288" class="difflineminus">-            let col = this.findColumnForDate(targetDate);</span>
<a href="#l12.1289"></a><span id="l12.1289" class="difflineminus">-</span>
<a href="#l12.1290"></a><span id="l12.1290" class="difflineminus">-            // This might not exist if the event spans the view start or end</span>
<a href="#l12.1291"></a><span id="l12.1291" class="difflineminus">-            if (col) {</span>
<a href="#l12.1292"></a><span id="l12.1292" class="difflineminus">-                columns.push(col);</span>
<a href="#l12.1293"></a><span id="l12.1293" class="difflineminus">-            }</span>
<a href="#l12.1294"></a><span id="l12.1294" class="difflineminus">-            targetDate.day += 1;</span>
<a href="#l12.1295"></a><span id="l12.1295" class="difflineplus">+              let col = this.findColumnForDate(targetDate);</span>
<a href="#l12.1296"></a><span id="l12.1296" class="difflineplus">+</span>
<a href="#l12.1297"></a><span id="l12.1297" class="difflineplus">+              // This might not exist if the event spans the view start or end</span>
<a href="#l12.1298"></a><span id="l12.1298" class="difflineplus">+              if (col) {</span>
<a href="#l12.1299"></a><span id="l12.1299" class="difflineplus">+                  columns.push(col);</span>
<a href="#l12.1300"></a><span id="l12.1300" class="difflineplus">+              }</span>
<a href="#l12.1301"></a><span id="l12.1301" class="difflineplus">+              targetDate.day += 1;</span>
<a href="#l12.1302"></a><span id="l12.1302">           }</span>
<a href="#l12.1303"></a><span id="l12.1303"> </span>
<a href="#l12.1304"></a><span id="l12.1304">           return columns;</span>
<a href="#l12.1305"></a><span id="l12.1305">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1306"></a><span id="l12.1306">       &lt;/method&gt;</span>
<a href="#l12.1307"></a><span id="l12.1307"> </span>
<a href="#l12.1308"></a><span id="l12.1308">       &lt;!-- for the given client-coord-system point, return</span>
<a href="#l12.1309"></a><span id="l12.1309">          - the calendar-event-column that contains it.  If</span>
<a href="#l12.1310"></a><span id="l12.1310" class="difflineat">@@ -3717,34 +3712,33 @@</span>
<a href="#l12.1311"></a><span id="l12.1311">               propertyName = &quot;width&quot;;</span>
<a href="#l12.1312"></a><span id="l12.1312">           } else {</span>
<a href="#l12.1313"></a><span id="l12.1313">               propertyName = &quot;height&quot;;</span>
<a href="#l12.1314"></a><span id="l12.1314">           }</span>
<a href="#l12.1315"></a><span id="l12.1315"> </span>
<a href="#l12.1316"></a><span id="l12.1316">           // get the width/height of the scrollbox scrollbar</span>
<a href="#l12.1317"></a><span id="l12.1317">           let scrollbox = document.getAnonymousElementByAttribute(</span>
<a href="#l12.1318"></a><span id="l12.1318">                          this, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l12.1319"></a><span id="l12.1319" class="difflineminus">-          let propertyValue = scrollbox.boxObject.firstChild</span>
<a href="#l12.1320"></a><span id="l12.1320" class="difflineminus">-                              .boxObject[propertyName];</span>
<a href="#l12.1321"></a><span id="l12.1321" class="difflineplus">+          let propertyValue = scrollbox.boxObject.firstChild.boxObject[propertyName];</span>
<a href="#l12.1322"></a><span id="l12.1322">           // Check if we need to show the headerScrollbarSpacer at all</span>
<a href="#l12.1323"></a><span id="l12.1323">           let headerPropertyValue = propertyValue;</span>
<a href="#l12.1324"></a><span id="l12.1324">           let headerDayBox = document.getAnonymousElementByAttribute(</span>
<a href="#l12.1325"></a><span id="l12.1325">                              this, &quot;anonid&quot;, &quot;headerdaybox&quot;);</span>
<a href="#l12.1326"></a><span id="l12.1326">           if (headerDayBox) {</span>
<a href="#l12.1327"></a><span id="l12.1327" class="difflineminus">-            // Only do this when there are multiple days</span>
<a href="#l12.1328"></a><span id="l12.1328" class="difflineminus">-            let headerDayBoxMaxHeight = parseInt(document.defaultView.getComputedStyle(headerDayBox, null)</span>
<a href="#l12.1329"></a><span id="l12.1329" class="difflineminus">-                                                         .getPropertyValue(&quot;max-height&quot;), 10);</span>
<a href="#l12.1330"></a><span id="l12.1330" class="difflineminus">-            if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot; &amp;&amp;</span>
<a href="#l12.1331"></a><span id="l12.1331" class="difflineminus">-                headerDayBox.boxObject.height &gt;= headerDayBoxMaxHeight) {</span>
<a href="#l12.1332"></a><span id="l12.1332" class="difflineminus">-                // If the headerDayBox is just as high as the max-height, then</span>
<a href="#l12.1333"></a><span id="l12.1333" class="difflineminus">-                // there is already a scrollbar and we don't need to show the</span>
<a href="#l12.1334"></a><span id="l12.1334" class="difflineminus">-                // headerScrollbarSpacer. This is only valid for the non-rotated</span>
<a href="#l12.1335"></a><span id="l12.1335" class="difflineminus">-                // view.</span>
<a href="#l12.1336"></a><span id="l12.1336" class="difflineminus">-                headerPropertyValue = 0;</span>
<a href="#l12.1337"></a><span id="l12.1337" class="difflineminus">-            }</span>
<a href="#l12.1338"></a><span id="l12.1338" class="difflineplus">+              // Only do this when there are multiple days</span>
<a href="#l12.1339"></a><span id="l12.1339" class="difflineplus">+              let headerDayBoxMaxHeight = parseInt(document.defaultView.getComputedStyle(headerDayBox, null)</span>
<a href="#l12.1340"></a><span id="l12.1340" class="difflineplus">+                                                           .getPropertyValue(&quot;max-height&quot;), 10);</span>
<a href="#l12.1341"></a><span id="l12.1341" class="difflineplus">+              if (this.getAttribute(&quot;orient&quot;) == &quot;vertical&quot; &amp;&amp;</span>
<a href="#l12.1342"></a><span id="l12.1342" class="difflineplus">+                  headerDayBox.boxObject.height &gt;= headerDayBoxMaxHeight) {</span>
<a href="#l12.1343"></a><span id="l12.1343" class="difflineplus">+                  // If the headerDayBox is just as high as the max-height, then</span>
<a href="#l12.1344"></a><span id="l12.1344" class="difflineplus">+                  // there is already a scrollbar and we don't need to show the</span>
<a href="#l12.1345"></a><span id="l12.1345" class="difflineplus">+                  // headerScrollbarSpacer. This is only valid for the non-rotated</span>
<a href="#l12.1346"></a><span id="l12.1346" class="difflineplus">+                  // view.</span>
<a href="#l12.1347"></a><span id="l12.1347" class="difflineplus">+                  headerPropertyValue = 0;</span>
<a href="#l12.1348"></a><span id="l12.1348" class="difflineplus">+              }</span>
<a href="#l12.1349"></a><span id="l12.1349">           }</span>
<a href="#l12.1350"></a><span id="l12.1350"> </span>
<a href="#l12.1351"></a><span id="l12.1351">           // set the same width/height for the label and header box spacers</span>
<a href="#l12.1352"></a><span id="l12.1352">           let headerScrollBarSpacer = document.getAnonymousElementByAttribute(</span>
<a href="#l12.1353"></a><span id="l12.1353">                                       this, &quot;anonid&quot;, &quot;headerscrollbarspacer&quot;);</span>
<a href="#l12.1354"></a><span id="l12.1354">           headerScrollBarSpacer.setAttribute(propertyName, headerPropertyValue);</span>
<a href="#l12.1355"></a><span id="l12.1355">           let labelScrollBarSpacer = document.getAnonymousElementByAttribute(</span>
<a href="#l12.1356"></a><span id="l12.1356">                                      this, &quot;anonid&quot;, &quot;labelscrollbarspacer&quot;);</span>
<a href="#l12.1357"></a><span id="l12.1357" class="difflineat">@@ -3761,63 +3755,63 @@</span>
<a href="#l12.1358"></a><span id="l12.1358">           // 'aMinute' will be the first minute showed in the view, so it must</span>
<a href="#l12.1359"></a><span id="l12.1359">           // belong to the range 0 &lt;-&gt; (24*60 - minutes_showed_in_the_view) but</span>
<a href="#l12.1360"></a><span id="l12.1360">           // we consider 25 hours instead of 24 to let the view scroll until</span>
<a href="#l12.1361"></a><span id="l12.1361">           // showing events that start just before 0.00</span>
<a href="#l12.1362"></a><span id="l12.1362">           let maxFirstMin = 25 * 60 - Math.round(scrollBoxObject.height / this.mPixPerMin);</span>
<a href="#l12.1363"></a><span id="l12.1363">           aMinute = Math.min(maxFirstMin, Math.max(0, aMinute));</span>
<a href="#l12.1364"></a><span id="l12.1364"> </span>
<a href="#l12.1365"></a><span id="l12.1365">           if (scrollBoxObject &amp;&amp; scrollbox.scrollHeight &gt; 0) {</span>
<a href="#l12.1366"></a><span id="l12.1366" class="difflineminus">-            let x = {}, y = {};</span>
<a href="#l12.1367"></a><span id="l12.1367" class="difflineminus">-            scrollBoxObject.getPosition(x, y);</span>
<a href="#l12.1368"></a><span id="l12.1368" class="difflineminus">-            let pos = Math.round(aMinute * this.mPixPerMin);</span>
<a href="#l12.1369"></a><span id="l12.1369" class="difflineminus">-            if (scrollbox.getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;) {</span>
<a href="#l12.1370"></a><span id="l12.1370" class="difflineminus">-              scrollBoxObject.scrollTo(x.value, pos);</span>
<a href="#l12.1371"></a><span id="l12.1371" class="difflineminus">-            } else {</span>
<a href="#l12.1372"></a><span id="l12.1372" class="difflineminus">-              scrollBoxObject.scrollTo(pos, y.value);</span>
<a href="#l12.1373"></a><span id="l12.1373" class="difflineminus">-            }</span>
<a href="#l12.1374"></a><span id="l12.1374" class="difflineplus">+              let x = {}, y = {};</span>
<a href="#l12.1375"></a><span id="l12.1375" class="difflineplus">+              scrollBoxObject.getPosition(x, y);</span>
<a href="#l12.1376"></a><span id="l12.1376" class="difflineplus">+              let pos = Math.round(aMinute * this.mPixPerMin);</span>
<a href="#l12.1377"></a><span id="l12.1377" class="difflineplus">+              if (scrollbox.getAttribute(&quot;orient&quot;) == &quot;horizontal&quot;) {</span>
<a href="#l12.1378"></a><span id="l12.1378" class="difflineplus">+                  scrollBoxObject.scrollTo(x.value, pos);</span>
<a href="#l12.1379"></a><span id="l12.1379" class="difflineplus">+              } else {</span>
<a href="#l12.1380"></a><span id="l12.1380" class="difflineplus">+                  scrollBoxObject.scrollTo(pos, y.value);</span>
<a href="#l12.1381"></a><span id="l12.1381" class="difflineplus">+              }</span>
<a href="#l12.1382"></a><span id="l12.1382">           }</span>
<a href="#l12.1383"></a><span id="l12.1383"> </span>
<a href="#l12.1384"></a><span id="l12.1384">           // Set the first visible minute in any case, we want to move to the</span>
<a href="#l12.1385"></a><span id="l12.1385">           // right minute as soon as possible if we couldn't do so above.</span>
<a href="#l12.1386"></a><span id="l12.1386">           this.mFirstVisibleMinute = aMinute;</span>
<a href="#l12.1387"></a><span id="l12.1387">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1388"></a><span id="l12.1388">       &lt;/method&gt;</span>
<a href="#l12.1389"></a><span id="l12.1389"> </span>
<a href="#l12.1390"></a><span id="l12.1390">       &lt;method name=&quot;setDayStartEndMinutes&quot;&gt;</span>
<a href="#l12.1391"></a><span id="l12.1391">         &lt;parameter name=&quot;aDayStartMin&quot;/&gt;</span>
<a href="#l12.1392"></a><span id="l12.1392">         &lt;parameter name=&quot;aDayEndMin&quot;/&gt;</span>
<a href="#l12.1393"></a><span id="l12.1393">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1394"></a><span id="l12.1394">           if (aDayStartMin &lt; this.mStartMin || aDayStartMin &gt; aDayEndMin ||</span>
<a href="#l12.1395"></a><span id="l12.1395" class="difflineminus">-            aDayEndMin &gt; this.mEndMin) {</span>
<a href="#l12.1396"></a><span id="l12.1396" class="difflineminus">-            throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l12.1397"></a><span id="l12.1397" class="difflineplus">+              aDayEndMin &gt; this.mEndMin) {</span>
<a href="#l12.1398"></a><span id="l12.1398" class="difflineplus">+              throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l12.1399"></a><span id="l12.1399">           }</span>
<a href="#l12.1400"></a><span id="l12.1400">           if (this.mDayStartMin != aDayStartMin ||</span>
<a href="#l12.1401"></a><span id="l12.1401">               this.mDayEndMin != aDayEndMin) {</span>
<a href="#l12.1402"></a><span id="l12.1402" class="difflineminus">-            this.mDayStartMin = aDayStartMin;</span>
<a href="#l12.1403"></a><span id="l12.1403" class="difflineminus">-            this.mDayEndMin = aDayEndMin;</span>
<a href="#l12.1404"></a><span id="l12.1404" class="difflineminus">-</span>
<a href="#l12.1405"></a><span id="l12.1405" class="difflineminus">-            // Also update on the time-bar</span>
<a href="#l12.1406"></a><span id="l12.1406" class="difflineminus">-            document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timebar&quot;)</span>
<a href="#l12.1407"></a><span id="l12.1407" class="difflineminus">-                    .setDayStartEndHours(this.mDayStartMin / 60,</span>
<a href="#l12.1408"></a><span id="l12.1408" class="difflineminus">-                                         this.mDayEndMin / 60);</span>
<a href="#l12.1409"></a><span id="l12.1409" class="difflineplus">+              this.mDayStartMin = aDayStartMin;</span>
<a href="#l12.1410"></a><span id="l12.1410" class="difflineplus">+              this.mDayEndMin = aDayEndMin;</span>
<a href="#l12.1411"></a><span id="l12.1411" class="difflineplus">+</span>
<a href="#l12.1412"></a><span id="l12.1412" class="difflineplus">+              // Also update on the time-bar</span>
<a href="#l12.1413"></a><span id="l12.1413" class="difflineplus">+              document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timebar&quot;)</span>
<a href="#l12.1414"></a><span id="l12.1414" class="difflineplus">+                      .setDayStartEndHours(this.mDayStartMin / 60,</span>
<a href="#l12.1415"></a><span id="l12.1415" class="difflineplus">+                                           this.mDayEndMin / 60);</span>
<a href="#l12.1416"></a><span id="l12.1416">           }</span>
<a href="#l12.1417"></a><span id="l12.1417"> </span>
<a href="#l12.1418"></a><span id="l12.1418">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1419"></a><span id="l12.1419">       &lt;/method&gt;</span>
<a href="#l12.1420"></a><span id="l12.1420"> </span>
<a href="#l12.1421"></a><span id="l12.1421">       &lt;method name=&quot;setVisibleMinutes&quot;&gt;</span>
<a href="#l12.1422"></a><span id="l12.1422">         &lt;parameter name=&quot;aVisibleMinutes&quot;/&gt;</span>
<a href="#l12.1423"></a><span id="l12.1423">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1424"></a><span id="l12.1424">           if (aVisibleMinutes &lt;= 0 ||</span>
<a href="#l12.1425"></a><span id="l12.1425" class="difflineminus">-            aVisibleMinutes &gt; (this.mEndMin - this.mStartMin)) {</span>
<a href="#l12.1426"></a><span id="l12.1426" class="difflineminus">-            throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l12.1427"></a><span id="l12.1427" class="difflineplus">+              aVisibleMinutes &gt; (this.mEndMin - this.mStartMin)) {</span>
<a href="#l12.1428"></a><span id="l12.1428" class="difflineplus">+              throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l12.1429"></a><span id="l12.1429">           }</span>
<a href="#l12.1430"></a><span id="l12.1430">           if (this.mVisibleMinutes != aVisibleMinutes) {</span>
<a href="#l12.1431"></a><span id="l12.1431" class="difflineminus">-            this.mVisibleMinutes = aVisibleMinutes;</span>
<a href="#l12.1432"></a><span id="l12.1432" class="difflineplus">+              this.mVisibleMinutes = aVisibleMinutes;</span>
<a href="#l12.1433"></a><span id="l12.1433">           }</span>
<a href="#l12.1434"></a><span id="l12.1434">           return this.mVisibleMinutes;</span>
<a href="#l12.1435"></a><span id="l12.1435">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.1436"></a><span id="l12.1436">       &lt;/method&gt;</span>
<a href="#l12.1437"></a><span id="l12.1437"> </span>
<a href="#l12.1438"></a><span id="l12.1438">       &lt;method name=&quot;zoomIn&quot;&gt;</span>
<a href="#l12.1439"></a><span id="l12.1439">         &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l12.1440"></a><span id="l12.1440">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.1441"></a><span id="l12.1441" class="difflineat">@@ -3856,19 +3850,19 @@</span>
<a href="#l12.1442"></a><span id="l12.1442">             if (event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l12.1443"></a><span id="l12.1443">                 if (this.rotated &amp;&amp; event.deltaX != 0) {</span>
<a href="#l12.1444"></a><span id="l12.1444">                     minute += event.deltaX &lt; 0 ? -60 : 60;</span>
<a href="#l12.1445"></a><span id="l12.1445">                 } else if (!this.rotated &amp;&amp; event.deltaY != 0) {</span>
<a href="#l12.1446"></a><span id="l12.1446">                     minute += event.deltaY &lt; 0 ? -60 : 60;</span>
<a href="#l12.1447"></a><span id="l12.1447">                 }</span>
<a href="#l12.1448"></a><span id="l12.1448">             } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l12.1449"></a><span id="l12.1449">                 if (this.rotated &amp;&amp; event.deltaX != 0) {</span>
<a href="#l12.1450"></a><span id="l12.1450" class="difflineminus">-                   minute += Math.ceil(event.deltaX / this.mPixPerMin);</span>
<a href="#l12.1451"></a><span id="l12.1451" class="difflineplus">+                    minute += Math.ceil(event.deltaX / this.mPixPerMin);</span>
<a href="#l12.1452"></a><span id="l12.1452">                 } else if (!this.rotated &amp;&amp; event.deltaY != 0) {</span>
<a href="#l12.1453"></a><span id="l12.1453" class="difflineminus">-                   minute += Math.ceil(event.deltaY / this.mPixPerMin);</span>
<a href="#l12.1454"></a><span id="l12.1454" class="difflineplus">+                    minute += Math.ceil(event.deltaY / this.mPixPerMin);</span>
<a href="#l12.1455"></a><span id="l12.1455">                 }</span>
<a href="#l12.1456"></a><span id="l12.1456">             }</span>
<a href="#l12.1457"></a><span id="l12.1457">             this.scrollToMinute(minute);</span>
<a href="#l12.1458"></a><span id="l12.1458">         }</span>
<a href="#l12.1459"></a><span id="l12.1459"> </span>
<a href="#l12.1460"></a><span id="l12.1460">         // We are taking care of scrolling, so prevent the default</span>
<a href="#l12.1461"></a><span id="l12.1461">         // action in any case.</span>
<a href="#l12.1462"></a><span id="l12.1462">         event.preventDefault();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-statusbar.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-statusbar.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -5,107 +5,107 @@</span>
<a href="#l13.4"></a><span id="l13.4"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> /* exported gCalendarStatusFeedback */</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> /**</span>
<a href="#l13.9"></a><span id="l13.9">  * This code might change soon if we support Thunderbird's activity manager.</span>
<a href="#l13.10"></a><span id="l13.10">  * NOTE: The naming &quot;Meteors&quot; is historical.</span>
<a href="#l13.11"></a><span id="l13.11">  */</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">- let gCalendarStatusFeedback = {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-     mCalendarStep: 0,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-     mCalendarCount: 0,</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-     mWindow: null,</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-     mStatusText: null,</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-     mStatusBar: null,</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineminus">-     mStatusProgressPanel: null,</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-     mThrobber: null,</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-     mProgressMode: Components.interfaces.calIStatusObserver.NO_PROGRESS,</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-     mCurIndex: 0,</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-     mInitialized: false,</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineminus">-     mCalendars: {},</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+var gCalendarStatusFeedback = {</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+    mCalendarStep: 0,</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+    mCalendarCount: 0,</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+    mWindow: null,</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+    mStatusText: null,</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+    mStatusBar: null,</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+    mStatusProgressPanel: null,</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+    mThrobber: null,</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+    mProgressMode: Components.interfaces.calIStatusObserver.NO_PROGRESS,</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+    mCurIndex: 0,</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+    mInitialized: false,</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+    mCalendars: {},</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37">     QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIStatusObserver]),</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-     initialize: function(aWindow) {</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+    initialize: function(aWindow) {</span>
<a href="#l13.41"></a><span id="l13.41">         if (!this.mInitialized) {</span>
<a href="#l13.42"></a><span id="l13.42">             this.mWindow = aWindow;</span>
<a href="#l13.43"></a><span id="l13.43">             this.mStatusText = this.mWindow.document.getElementById(&quot;statusText&quot;);</span>
<a href="#l13.44"></a><span id="l13.44">             this.mStatusBar = this.mWindow.document.getElementById(&quot;statusbar-icon&quot;);</span>
<a href="#l13.45"></a><span id="l13.45">             this.mStatusProgressPanel = this.mWindow.document.getElementById(&quot;statusbar-progresspanel&quot;);</span>
<a href="#l13.46"></a><span id="l13.46">             this.mThrobber = this.mWindow.document.getElementById(&quot;navigator-throbber&quot;);</span>
<a href="#l13.47"></a><span id="l13.47">             this.mInitialized = true;</span>
<a href="#l13.48"></a><span id="l13.48">         }</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-     },</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+    },</span>
<a href="#l13.51"></a><span id="l13.51"> </span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-     showStatusString: function(status) {</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-         this.mStatusText.setAttribute(&quot;label&quot;, status);</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-     },</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+    showStatusString: function(status) {</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+        this.mStatusText.setAttribute(&quot;label&quot;, status);</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+    },</span>
<a href="#l13.58"></a><span id="l13.58"> </span>
<a href="#l13.59"></a><span id="l13.59" class="difflineminus">-     get spinning() {</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineminus">-         return this.mProgressMode;</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-     },</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+    get spinning() {</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+        return this.mProgressMode;</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+    },</span>
<a href="#l13.65"></a><span id="l13.65"> </span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-     startMeteors: function(aProgressMode, aCalendarCount) {</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineminus">-         if (aProgressMode != Components.interfaces.calIStatusObserver.NO_PROGRESS) {</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineminus">-             if (!this.mInitialized) {</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+    startMeteors: function(aProgressMode, aCalendarCount) {</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+        if (aProgressMode != Components.interfaces.calIStatusObserver.NO_PROGRESS) {</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+            if (!this.mInitialized) {</span>
<a href="#l13.72"></a><span id="l13.72">                 Components.utils.reportError(&quot;StatusObserver has not been initialized!&quot;);</span>
<a href="#l13.73"></a><span id="l13.73">                 return;</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineminus">-             }</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineminus">-             this.mCalendars = {};</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineminus">-             this.mCurIndex = 0;</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineminus">-             if (aCalendarCount) {</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineminus">-                 this.mCalendarCount = this.mCalendarCount + aCalendarCount;</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineminus">-                 this.mCalendarStep = Math.trunc(100 / this.mCalendarCount);</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineminus">-             }</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineminus">-             this.mProgressMode = aProgressMode;</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineminus">-             this.mStatusProgressPanel.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineminus">-             if (this.mProgressMode == Components.interfaces.calIStatusObserver.DETERMINED_PROGRESS) {</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineminus">-                 this.mStatusBar.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-                 this.mStatusBar.setAttribute(&quot;mode&quot;, &quot;determined&quot;);</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineminus">-                 this.mStatusBar.value = 0;</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineminus">-                 let commonStatus = calGetString(&quot;calendar&quot;, &quot;gettingCalendarInfoCommon&quot;);</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-                 this.showStatusString(commonStatus);</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-             }</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-             if (this.mThrobber) {</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-                 this.mThrobber.setAttribute(&quot;busy&quot;, true);</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineminus">-             }</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineminus">-         }</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineminus">-     },</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+            }</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+            this.mCalendars = {};</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+            this.mCurIndex = 0;</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+            if (aCalendarCount) {</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+                this.mCalendarCount = this.mCalendarCount + aCalendarCount;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+                this.mCalendarStep = Math.trunc(100 / this.mCalendarCount);</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+            }</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+            this.mProgressMode = aProgressMode;</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+            this.mStatusProgressPanel.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+            if (this.mProgressMode == Components.interfaces.calIStatusObserver.DETERMINED_PROGRESS) {</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+                this.mStatusBar.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+                this.mStatusBar.setAttribute(&quot;mode&quot;, &quot;determined&quot;);</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+                this.mStatusBar.value = 0;</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+                let commonStatus = calGetString(&quot;calendar&quot;, &quot;gettingCalendarInfoCommon&quot;);</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+                this.showStatusString(commonStatus);</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+            }</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+            if (this.mThrobber) {</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+                this.mThrobber.setAttribute(&quot;busy&quot;, true);</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+            }</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+        }</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+    },</span>
<a href="#l13.116"></a><span id="l13.116"> </span>
<a href="#l13.117"></a><span id="l13.117" class="difflineminus">-     stopMeteors: function() {</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineminus">-         if (!this.mInitialized) {</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineplus">+    stopMeteors: function() {</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+        if (!this.mInitialized) {</span>
<a href="#l13.121"></a><span id="l13.121">             return;</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineminus">-         }</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineminus">-         if (this.spinning != Components.interfaces.calIStatusObserver.NO_PROGRESS) {</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineminus">-             this.mProgressMode = Components.interfaces.calIStatusObserver.NO_PROGRESS;</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineminus">-             this.mStatusProgressPanel.collapsed = true;</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineminus">-             this.mStatusBar.setAttribute(&quot;mode&quot;, &quot;normal&quot;);</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineminus">-             this.mStatusBar.value = 0;</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-             this.mCalendarCount = 0;</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-             this.showStatusString(&quot;&quot;);</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-             if (this.mThrobber) {</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineminus">-                 this.mThrobber.setAttribute(&quot;busy&quot;, false);</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineminus">-             }</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-         }</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineminus">-     },</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineplus">+        }</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+        if (this.spinning != Components.interfaces.calIStatusObserver.NO_PROGRESS) {</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+            this.mProgressMode = Components.interfaces.calIStatusObserver.NO_PROGRESS;</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+            this.mStatusProgressPanel.collapsed = true;</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+            this.mStatusBar.setAttribute(&quot;mode&quot;, &quot;normal&quot;);</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+            this.mStatusBar.value = 0;</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+            this.mCalendarCount = 0;</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+            this.showStatusString(&quot;&quot;);</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+            if (this.mThrobber) {</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+                this.mThrobber.setAttribute(&quot;busy&quot;, false);</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineplus">+            }</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineplus">+        }</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+    },</span>
<a href="#l13.148"></a><span id="l13.148"> </span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-     calendarCompleted: function(aCalendar) {</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineminus">-         if (!this.mInitialized) {</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+    calendarCompleted: function(aCalendar) {</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+        if (!this.mInitialized) {</span>
<a href="#l13.153"></a><span id="l13.153">             return;</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineminus">-         }</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineminus">-         if (this.spinning != Components.interfaces.calIStatusObserver.NO_PROGRESS) {</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-             if (this.spinning == Components.interfaces.calIStatusObserver.DETERMINED_PROGRESS) {</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-                 if (!this.mCalendars[aCalendar.id] || this.mCalendars[aCalendar.id] === undefined) {</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-                     this.mCalendars[aCalendar.id] = true;</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-                     this.mStatusBar.value = parseInt(this.mStatusBar.value, 10) + this.mCalendarStep;</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-                     this.mCurIndex++;</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineminus">-                     let curStatus = calGetString(&quot;calendar&quot;, &quot;gettingCalendarInfoDetail&quot;,</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineminus">-                                                  [this.mCurIndex, this.mCalendarCount]);</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineminus">-                     this.showStatusString(curStatus);</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-                 }</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineminus">-             }</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineminus">-             if (this.mThrobber) {</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineminus">-                 this.mThrobber.setAttribute(&quot;busy&quot;, true);</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineminus">-             }</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineminus">-         }</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineminus">-     }</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineminus">- };</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineplus">+        }</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineplus">+        if (this.spinning != Components.interfaces.calIStatusObserver.NO_PROGRESS) {</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineplus">+            if (this.spinning == Components.interfaces.calIStatusObserver.DETERMINED_PROGRESS) {</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineplus">+                if (!this.mCalendars[aCalendar.id] || this.mCalendars[aCalendar.id] === undefined) {</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+                    this.mCalendars[aCalendar.id] = true;</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineplus">+                    this.mStatusBar.value = parseInt(this.mStatusBar.value, 10) + this.mCalendarStep;</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineplus">+                    this.mCurIndex++;</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineplus">+                    let curStatus = calGetString(&quot;calendar&quot;, &quot;gettingCalendarInfoDetail&quot;,</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineplus">+                                                 [this.mCurIndex, this.mCalendarCount]);</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineplus">+                    this.showStatusString(curStatus);</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineplus">+                }</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+            }</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineplus">+            if (this.mThrobber) {</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineplus">+                this.mThrobber.setAttribute(&quot;busy&quot;, true);</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineplus">+            }</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineplus">+        }</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+    }</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -155,22 +155,22 @@ function contextChangeTaskProgress(aEven</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> /**</span>
<a href="#l14.6"></a><span id="l14.6">  * Handler function to change the calendar of the selected tasks. The targeted</span>
<a href="#l14.7"></a><span id="l14.7">  * menuitem must have &quot;calendar&quot; property that implements calICalendar.</span>
<a href="#l14.8"></a><span id="l14.8">  *</span>
<a href="#l14.9"></a><span id="l14.9">  * @param aEvent      The DOM event that triggered this command.</span>
<a href="#l14.10"></a><span id="l14.10">  */</span>
<a href="#l14.11"></a><span id="l14.11"> function contextChangeTaskCalendar(aEvent) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-   startBatchTransaction();</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-   let tasks = getSelectedTasks(aEvent);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-   for (let task of tasks) {</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-       let newTask = task.clone();</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-       newTask.calendar = aEvent.target.calendar;</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-       doTransaction(&quot;modify&quot;, newTask, newTask.calendar, task, null);</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+    startBatchTransaction();</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+    let tasks = getSelectedTasks(aEvent);</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+    for (let task of tasks) {</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+        let newTask = task.clone();</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+        newTask.calendar = aEvent.target.calendar;</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+        doTransaction(&quot;modify&quot;, newTask, newTask.calendar, task, null);</span>
<a href="#l14.24"></a><span id="l14.24">     }</span>
<a href="#l14.25"></a><span id="l14.25">     endBatchTransaction();</span>
<a href="#l14.26"></a><span id="l14.26"> }</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28"> /**</span>
<a href="#l14.29"></a><span id="l14.29">  * Handler function to change the priority of the selected tasks, or of</span>
<a href="#l14.30"></a><span id="l14.30">  * the task loaded in the current tab.</span>
<a href="#l14.31"></a><span id="l14.31">  *</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineat">@@ -234,17 +234,17 @@ function contextPostponeTask(aEvent, aDu</span>
<a href="#l14.33"></a><span id="l14.33">  * @param aEvent        The DOM event that triggered this command.</span>
<a href="#l14.34"></a><span id="l14.34">  * @param initialDate   (optional) The initial date for new task datepickers</span>
<a href="#l14.35"></a><span id="l14.35">  */</span>
<a href="#l14.36"></a><span id="l14.36"> function modifyTaskFromContext(aEvent, initialDate) {</span>
<a href="#l14.37"></a><span id="l14.37">     let tasks = getSelectedTasks(aEvent);</span>
<a href="#l14.38"></a><span id="l14.38">     for (let task of tasks) {</span>
<a href="#l14.39"></a><span id="l14.39">         modifyEventWithDialog(task, null, true, initialDate);</span>
<a href="#l14.40"></a><span id="l14.40">     }</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">- }</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+}</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44"> /**</span>
<a href="#l14.45"></a><span id="l14.45">  *  Delete the current selected item with focus from the task tree</span>
<a href="#l14.46"></a><span id="l14.46">  *</span>
<a href="#l14.47"></a><span id="l14.47">  * @param aEvent          The DOM event that triggered this command.</span>
<a href="#l14.48"></a><span id="l14.48">  * @param aDoNotConfirm   If true, the user will not be asked to delete.</span>
<a href="#l14.49"></a><span id="l14.49">  */</span>
<a href="#l14.50"></a><span id="l14.50"> function deleteToDoCommand(aEvent, aDoNotConfirm) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -4,19 +4,19 @@</span>
<a href="#l15.4"></a><span id="l15.4">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> &lt;!DOCTYPE dialog [</span>
<a href="#l15.7"></a><span id="l15.7">   &lt;!ENTITY % dtd1 SYSTEM &quot;chrome://calendar/locale/global.dtd&quot; &gt; %dtd1;</span>
<a href="#l15.8"></a><span id="l15.8">   &lt;!ENTITY % dtd2 SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot; &gt; %dtd2;</span>
<a href="#l15.9"></a><span id="l15.9"> ]&gt;</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11"> &lt;bindings id=&quot;calendar-task-tree-bindings&quot;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-  xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19">   &lt;binding id=&quot;calendar-task-tree&quot;&gt;</span>
<a href="#l15.20"></a><span id="l15.20">     &lt;resources&gt;</span>
<a href="#l15.21"></a><span id="l15.21">       &lt;stylesheet src=&quot;chrome://calendar/skin/calendar-task-tree.css&quot;/&gt;</span>
<a href="#l15.22"></a><span id="l15.22">     &lt;/resources&gt;</span>
<a href="#l15.23"></a><span id="l15.23">     &lt;content&gt;</span>
<a href="#l15.24"></a><span id="l15.24">       &lt;xul:tree anonid=&quot;calendar-task-tree&quot;</span>
<a href="#l15.25"></a><span id="l15.25">                 class=&quot;calendar-task-tree&quot;</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineat">@@ -151,70 +151,70 @@</span>
<a href="#l15.27"></a><span id="l15.27">         for (let i = 0; i &lt; treecols.length; i++) {</span>
<a href="#l15.28"></a><span id="l15.28">             let content = treecols[i].getAttribute(&quot;itemproperty&quot;);</span>
<a href="#l15.29"></a><span id="l15.29">             if (names.some(element =&gt; element == content)) {</span>
<a href="#l15.30"></a><span id="l15.30">                 treecols[i].removeAttribute(&quot;hidden&quot;);</span>
<a href="#l15.31"></a><span id="l15.31">             } else {</span>
<a href="#l15.32"></a><span id="l15.32">                 treecols[i].setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l15.33"></a><span id="l15.33">             }</span>
<a href="#l15.34"></a><span id="l15.34">             if (ordinals &amp;&amp; ordinals.length &gt; 0) {</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-               treecols[i].ordinal = Number(ordinals.shift());</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+                treecols[i].ordinal = Number(ordinals.shift());</span>
<a href="#l15.37"></a><span id="l15.37">             }</span>
<a href="#l15.38"></a><span id="l15.38">             if (widths &amp;&amp; widths.length &gt; 0) {</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-               treecols[i].width = Number(widths.shift());</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+                treecols[i].width = Number(widths.shift());</span>
<a href="#l15.41"></a><span id="l15.41">             }</span>
<a href="#l15.42"></a><span id="l15.42">             if (sorted &amp;&amp; sorted.length &gt; 0) {</span>
<a href="#l15.43"></a><span id="l15.43">                 if (sorted == content) {</span>
<a href="#l15.44"></a><span id="l15.44">                     this.mTreeView.sortDirection = sortDirection;</span>
<a href="#l15.45"></a><span id="l15.45">                     this.mTreeView.selectedColumn = treecols[i];</span>
<a href="#l15.46"></a><span id="l15.46">                 }</span>
<a href="#l15.47"></a><span id="l15.47">             }</span>
<a href="#l15.48"></a><span id="l15.48">         }</span>
<a href="#l15.49"></a><span id="l15.49">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l15.50"></a><span id="l15.50">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-          Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-          // remove composite calendar observer</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-          let composite = getCompositeCalendar();</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-          composite.removeObserver(this.mTaskTreeObserver);</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+        // remove composite calendar observer</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+        let composite = getCompositeCalendar();</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+        composite.removeObserver(this.mTaskTreeObserver);</span>
<a href="#l15.60"></a><span id="l15.60"> </span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-          // remove the preference observer</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-          let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-          branch.removeObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+        // remove the preference observer</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+        let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+        branch.removeObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l15.67"></a><span id="l15.67"> </span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-          let widths = &quot;&quot;;</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-          let ordinals = &quot;&quot;;</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-          let visible = &quot;&quot;;</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-          let sorted = this.mTreeView.selectedColumn;</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-          let tree = document.getAnonymousNodes(this)[0];</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-          let treecols = tree.getElementsByTagNameNS(tree.namespaceURI, &quot;treecol&quot;);</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-          for (let i = 0; i &lt; treecols.length; i++) {</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-              if (treecols[i].getAttribute(&quot;hidden&quot;) != &quot;true&quot;) {</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineplus">+        let widths = &quot;&quot;;</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineplus">+        let ordinals = &quot;&quot;;</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+        let visible = &quot;&quot;;</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+        let sorted = this.mTreeView.selectedColumn;</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+        let tree = document.getAnonymousNodes(this)[0];</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+        let treecols = tree.getElementsByTagNameNS(tree.namespaceURI, &quot;treecol&quot;);</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+        for (let i = 0; i &lt; treecols.length; i++) {</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+            if (treecols[i].getAttribute(&quot;hidden&quot;) != &quot;true&quot;) {</span>
<a href="#l15.84"></a><span id="l15.84">                 let content = treecols[i].getAttribute(&quot;itemproperty&quot;);</span>
<a href="#l15.85"></a><span id="l15.85">                 visible += visible.length &gt; 0 ? &quot; &quot; + content : content;</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-              }</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineminus">-              if (ordinals.length &gt; 0) {</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-                  ordinals += &quot; &quot;;</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-              }</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineminus">-              ordinals += treecols[i].ordinal;</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-              if (widths.length &gt; 0) {</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineminus">-                  widths += &quot; &quot;;</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineminus">-              }</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-              widths += treecols[i].width || 0;</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineminus">-          }</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-          this.setAttribute(&quot;visible-columns&quot;, visible);</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-          this.setAttribute(&quot;ordinals&quot;, ordinals);</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-          this.setAttribute(&quot;widths&quot;, widths);</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-          if (sorted) {</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-              this.setAttribute(&quot;sort-active&quot;, sorted.getAttribute(&quot;itemproperty&quot;));</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-              this.setAttribute(&quot;sort-direction&quot;, this.mTreeView.sortDirection);</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-          } else {</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-              this.removeAttribute(&quot;sort-active&quot;);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-              this.removeAttribute(&quot;sort-direction&quot;);</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineminus">-          }</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineplus">+            }</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineplus">+            if (ordinals.length &gt; 0) {</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+                ordinals += &quot; &quot;;</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineplus">+            }</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+            ordinals += treecols[i].ordinal;</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineplus">+            if (widths.length &gt; 0) {</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+                widths += &quot; &quot;;</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineplus">+            }</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+            widths += treecols[i].width || 0;</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineplus">+        }</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineplus">+        this.setAttribute(&quot;visible-columns&quot;, visible);</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineplus">+        this.setAttribute(&quot;ordinals&quot;, ordinals);</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineplus">+        this.setAttribute(&quot;widths&quot;, widths);</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineplus">+        if (sorted) {</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineplus">+            this.setAttribute(&quot;sort-active&quot;, sorted.getAttribute(&quot;itemproperty&quot;));</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineplus">+            this.setAttribute(&quot;sort-direction&quot;, this.mTreeView.sortDirection);</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineplus">+        } else {</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+            this.removeAttribute(&quot;sort-active&quot;);</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+            this.removeAttribute(&quot;sort-direction&quot;);</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineplus">+        }</span>
<a href="#l15.126"></a><span id="l15.126">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l15.127"></a><span id="l15.127"> </span>
<a href="#l15.128"></a><span id="l15.128">       &lt;field name=&quot;mTaskArray&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l15.129"></a><span id="l15.129">       &lt;field name=&quot;mHash2Index&quot;&gt;&lt;![CDATA[({})]]&gt;&lt;/field&gt;</span>
<a href="#l15.130"></a><span id="l15.130">       &lt;field name=&quot;mPendingRefreshJobs&quot;&gt;&lt;![CDATA[({})]]&gt;&lt;/field&gt;</span>
<a href="#l15.131"></a><span id="l15.131">       &lt;field name=&quot;mShowCompletedTasks&quot;&gt;true&lt;/field&gt;</span>
<a href="#l15.132"></a><span id="l15.132">       &lt;field name=&quot;mFilter&quot;&gt;null&lt;/field&gt;</span>
<a href="#l15.133"></a><span id="l15.133">       &lt;field name=&quot;mStartDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineat">@@ -630,32 +630,32 @@</span>
<a href="#l15.135"></a><span id="l15.135">           // This method is only called for columns of type other than text.</span>
<a href="#l15.136"></a><span id="l15.136">           setCellValue: function(aRow, aCol, aValue) {</span>
<a href="#l15.137"></a><span id="l15.137">               return null;</span>
<a href="#l15.138"></a><span id="l15.138">           },</span>
<a href="#l15.139"></a><span id="l15.139"> </span>
<a href="#l15.140"></a><span id="l15.140">           // The image path for a given cell. For defining an icon for a cell.</span>
<a href="#l15.141"></a><span id="l15.141">           // If the empty string is returned, the :moz-tree-image pseudoelement will be used.</span>
<a href="#l15.142"></a><span id="l15.142">           getImageSrc: function(aRow, aCol) {</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineminus">-             // Return the empty string in order</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineminus">-             // to use moz-tree-image pseudoelement :</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineminus">-             // it is mandatory to return &quot;&quot; and not false :-(</span>
<a href="#l15.146"></a><span id="l15.146" class="difflineminus">-             return &quot;&quot;;</span>
<a href="#l15.147"></a><span id="l15.147" class="difflineplus">+              // Return the empty string in order</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineplus">+              // to use moz-tree-image pseudoelement :</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineplus">+              // it is mandatory to return &quot;&quot; and not false :-(</span>
<a href="#l15.150"></a><span id="l15.150" class="difflineplus">+              return &quot;&quot;;</span>
<a href="#l15.151"></a><span id="l15.151">           },</span>
<a href="#l15.152"></a><span id="l15.152"> </span>
<a href="#l15.153"></a><span id="l15.153">           // IsEditable is called to ask the view if the cell contents are editable.</span>
<a href="#l15.154"></a><span id="l15.154">           // A value of true will result in the tree popping up a text field when the user</span>
<a href="#l15.155"></a><span id="l15.155">           // tries to inline edit the cell.</span>
<a href="#l15.156"></a><span id="l15.156">           isEditable: function(aRow, aCol) {</span>
<a href="#l15.157"></a><span id="l15.157">               return true;</span>
<a href="#l15.158"></a><span id="l15.158">           },</span>
<a href="#l15.159"></a><span id="l15.159"> </span>
<a href="#l15.160"></a><span id="l15.160">           // Called during initialization to link the view to the front end box object.</span>
<a href="#l15.161"></a><span id="l15.161">           setTree: function(aTreeBox) {</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineminus">-            this.treebox = aTreeBox;</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineplus">+              this.treebox = aTreeBox;</span>
<a href="#l15.164"></a><span id="l15.164">           },</span>
<a href="#l15.165"></a><span id="l15.165"> </span>
<a href="#l15.166"></a><span id="l15.166">           // Methods that can be used to test whether or not a twisty should</span>
<a href="#l15.167"></a><span id="l15.167">           // be drawn, and if so, whether an open or closed twisty should be used.</span>
<a href="#l15.168"></a><span id="l15.168">           isContainer: function(aRow) {</span>
<a href="#l15.169"></a><span id="l15.169">               return false;</span>
<a href="#l15.170"></a><span id="l15.170">           },</span>
<a href="#l15.171"></a><span id="l15.171">           isContainerOpen: function(aRow) {</span>
<a href="#l15.172"></a><span id="l15.172" class="difflineat">@@ -785,23 +785,23 @@</span>
<a href="#l15.173"></a><span id="l15.173">               }</span>
<a href="#l15.174"></a><span id="l15.174">           },</span>
<a href="#l15.175"></a><span id="l15.175"> </span>
<a href="#l15.176"></a><span id="l15.176">           /**</span>
<a href="#l15.177"></a><span id="l15.177">            * Private methods and attributes</span>
<a href="#l15.178"></a><span id="l15.178">            */</span>
<a href="#l15.179"></a><span id="l15.179"> </span>
<a href="#l15.180"></a><span id="l15.180">           _getItemFromEvent: function(event, aCol, aRow) {</span>
<a href="#l15.181"></a><span id="l15.181" class="difflineminus">-            aRow = aRow || {};</span>
<a href="#l15.182"></a><span id="l15.182" class="difflineminus">-            let childElt = {};</span>
<a href="#l15.183"></a><span id="l15.183" class="difflineminus">-            this.treebox.getCellAt(event.clientX, event.clientY, aRow, aCol || {}, childElt);</span>
<a href="#l15.184"></a><span id="l15.184" class="difflineminus">-            if (!childElt.value) {</span>
<a href="#l15.185"></a><span id="l15.185" class="difflineminus">-                return false;</span>
<a href="#l15.186"></a><span id="l15.186" class="difflineminus">-            }</span>
<a href="#l15.187"></a><span id="l15.187" class="difflineminus">-            return aRow &amp;&amp; aRow.value &gt; -1 &amp;&amp; this.binding.mTaskArray[aRow.value];</span>
<a href="#l15.188"></a><span id="l15.188" class="difflineplus">+              aRow = aRow || {};</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineplus">+              let childElt = {};</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineplus">+              this.treebox.getCellAt(event.clientX, event.clientY, aRow, aCol || {}, childElt);</span>
<a href="#l15.191"></a><span id="l15.191" class="difflineplus">+              if (!childElt.value) {</span>
<a href="#l15.192"></a><span id="l15.192" class="difflineplus">+                  return false;</span>
<a href="#l15.193"></a><span id="l15.193" class="difflineplus">+              }</span>
<a href="#l15.194"></a><span id="l15.194" class="difflineplus">+              return aRow &amp;&amp; aRow.value &gt; -1 &amp;&amp; this.binding.mTaskArray[aRow.value];</span>
<a href="#l15.195"></a><span id="l15.195">           },</span>
<a href="#l15.196"></a><span id="l15.196"> </span>
<a href="#l15.197"></a><span id="l15.197">           // Helper function to display datetimes</span>
<a href="#l15.198"></a><span id="l15.198">           _formatDateTime: function(aDateTime) {</span>
<a href="#l15.199"></a><span id="l15.199">               let dateFormatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l15.200"></a><span id="l15.200">                                             .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l15.201"></a><span id="l15.201"> </span>
<a href="#l15.202"></a><span id="l15.202">               // datetime is from todo object, it is not a javascript date</span>
<a href="#l15.203"></a><span id="l15.203" class="difflineat">@@ -963,17 +963,17 @@</span>
<a href="#l15.204"></a><span id="l15.204"> </span>
<a href="#l15.205"></a><span id="l15.205">           refreshJob.execute();</span>
<a href="#l15.206"></a><span id="l15.206">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.207"></a><span id="l15.207">       &lt;/method&gt;</span>
<a href="#l15.208"></a><span id="l15.208"> </span>
<a href="#l15.209"></a><span id="l15.209">       &lt;method name=&quot;selectAll&quot;&gt;</span>
<a href="#l15.210"></a><span id="l15.210">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.211"></a><span id="l15.211">           if (this.mTreeView.selection) {</span>
<a href="#l15.212"></a><span id="l15.212" class="difflineminus">-            this.mTreeView.selection.selectAll();</span>
<a href="#l15.213"></a><span id="l15.213" class="difflineplus">+              this.mTreeView.selection.selectAll();</span>
<a href="#l15.214"></a><span id="l15.214">           }</span>
<a href="#l15.215"></a><span id="l15.215">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.216"></a><span id="l15.216">       &lt;/method&gt;</span>
<a href="#l15.217"></a><span id="l15.217"> </span>
<a href="#l15.218"></a><span id="l15.218">       &lt;!-- Called by event observers to update the display --&gt;</span>
<a href="#l15.219"></a><span id="l15.219">       &lt;method name=&quot;refresh&quot;&gt;</span>
<a href="#l15.220"></a><span id="l15.220">         &lt;parameter name=&quot;aFilter&quot;/&gt;</span>
<a href="#l15.221"></a><span id="l15.221">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.222"></a><span id="l15.222" class="difflineat">@@ -985,27 +985,27 @@</span>
<a href="#l15.223"></a><span id="l15.223">           }</span>
<a href="#l15.224"></a><span id="l15.224">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.225"></a><span id="l15.225">       &lt;/method&gt;</span>
<a href="#l15.226"></a><span id="l15.226"> </span>
<a href="#l15.227"></a><span id="l15.227">       &lt;method name=&quot;onCalendarAdded&quot;&gt;</span>
<a href="#l15.228"></a><span id="l15.228">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l15.229"></a><span id="l15.229">         &lt;parameter name=&quot;aFilter&quot;/&gt;</span>
<a href="#l15.230"></a><span id="l15.230">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.231"></a><span id="l15.231" class="difflineminus">-            if (!aCalendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l15.232"></a><span id="l15.232" class="difflineminus">-                this.refreshFromCalendar(aCalendar, aFilter);</span>
<a href="#l15.233"></a><span id="l15.233" class="difflineminus">-            }</span>
<a href="#l15.234"></a><span id="l15.234" class="difflineplus">+          if (!aCalendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l15.235"></a><span id="l15.235" class="difflineplus">+              this.refreshFromCalendar(aCalendar, aFilter);</span>
<a href="#l15.236"></a><span id="l15.236" class="difflineplus">+          }</span>
<a href="#l15.237"></a><span id="l15.237">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.238"></a><span id="l15.238">       &lt;/method&gt;</span>
<a href="#l15.239"></a><span id="l15.239"> </span>
<a href="#l15.240"></a><span id="l15.240">       &lt;method name=&quot;onCalendarRemoved&quot;&gt;</span>
<a href="#l15.241"></a><span id="l15.241">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l15.242"></a><span id="l15.242">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.243"></a><span id="l15.243" class="difflineminus">-            let tasks = this.mTaskArray.filter(task =&gt; task.calendar.id == aCalendar.id);</span>
<a href="#l15.244"></a><span id="l15.244" class="difflineminus">-            this.mTreeView.removeItems(tasks);</span>
<a href="#l15.245"></a><span id="l15.245" class="difflineplus">+          let tasks = this.mTaskArray.filter(task =&gt; task.calendar.id == aCalendar.id);</span>
<a href="#l15.246"></a><span id="l15.246" class="difflineplus">+          this.mTreeView.removeItems(tasks);</span>
<a href="#l15.247"></a><span id="l15.247">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.248"></a><span id="l15.248">       &lt;/method&gt;</span>
<a href="#l15.249"></a><span id="l15.249"> </span>
<a href="#l15.250"></a><span id="l15.250">       &lt;method name=&quot;sortItems&quot;&gt;</span>
<a href="#l15.251"></a><span id="l15.251">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.252"></a><span id="l15.252">           if (this.mTreeView.selectedColumn) {</span>
<a href="#l15.253"></a><span id="l15.253">               let modifier = (this.mTreeView.sortDirection == &quot;descending&quot; ? -1 : 1);</span>
<a href="#l15.254"></a><span id="l15.254">               let column = this.mTreeView.selectedColumn;</span>
<a href="#l15.255"></a><span id="l15.255" class="difflineat">@@ -1028,97 +1028,96 @@</span>
<a href="#l15.256"></a><span id="l15.256">       &lt;method name=&quot;recreateHashTable&quot;&gt;</span>
<a href="#l15.257"></a><span id="l15.257">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.258"></a><span id="l15.258">           this.mHash2Index = {};</span>
<a href="#l15.259"></a><span id="l15.259">           for (let i = 0; i &lt; this.mTaskArray.length; i++) {</span>
<a href="#l15.260"></a><span id="l15.260">               let item = this.mTaskArray[i];</span>
<a href="#l15.261"></a><span id="l15.261">               this.mHash2Index[item.hashId] = i;</span>
<a href="#l15.262"></a><span id="l15.262">           }</span>
<a href="#l15.263"></a><span id="l15.263">           if (this.mTreeView.treebox) {</span>
<a href="#l15.264"></a><span id="l15.264" class="difflineminus">-            this.mTreeView.treebox.invalidate();</span>
<a href="#l15.265"></a><span id="l15.265" class="difflineplus">+              this.mTreeView.treebox.invalidate();</span>
<a href="#l15.266"></a><span id="l15.266">           }</span>
<a href="#l15.267"></a><span id="l15.267">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.268"></a><span id="l15.268">       &lt;/method&gt;</span>
<a href="#l15.269"></a><span id="l15.269"> </span>
<a href="#l15.270"></a><span id="l15.270">       &lt;method name=&quot;getInitialDate&quot;&gt;</span>
<a href="#l15.271"></a><span id="l15.271">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.272"></a><span id="l15.272">           let initialDate = currentView().selectedDay;</span>
<a href="#l15.273"></a><span id="l15.273">           return initialDate ? initialDate : now();</span>
<a href="#l15.274"></a><span id="l15.274">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.275"></a><span id="l15.275">       &lt;/method&gt;</span>
<a href="#l15.276"></a><span id="l15.276"> </span>
<a href="#l15.277"></a><span id="l15.277">       &lt;method name=&quot;doUpdateFilter&quot;&gt;</span>
<a href="#l15.278"></a><span id="l15.278">         &lt;parameter name=&quot;aFilter&quot;/&gt;</span>
<a href="#l15.279"></a><span id="l15.279">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.280"></a><span id="l15.280" class="difflineminus">-            let needsRefresh = false;</span>
<a href="#l15.281"></a><span id="l15.281" class="difflineminus">-            let oldStart = this.mFilter.mStartDate;</span>
<a href="#l15.282"></a><span id="l15.282" class="difflineminus">-            let oldEnd = this.mFilter.mEndDate;</span>
<a href="#l15.283"></a><span id="l15.283" class="difflineminus">-            let filterText = this.mFilter.filterText || &quot;&quot;;</span>
<a href="#l15.284"></a><span id="l15.284" class="difflineplus">+          let needsRefresh = false;</span>
<a href="#l15.285"></a><span id="l15.285" class="difflineplus">+          let oldStart = this.mFilter.mStartDate;</span>
<a href="#l15.286"></a><span id="l15.286" class="difflineplus">+          let oldEnd = this.mFilter.mEndDate;</span>
<a href="#l15.287"></a><span id="l15.287" class="difflineplus">+          let filterText = this.mFilter.filterText || &quot;&quot;;</span>
<a href="#l15.288"></a><span id="l15.288"> </span>
<a href="#l15.289"></a><span id="l15.289" class="difflineminus">-            if (aFilter) {</span>
<a href="#l15.290"></a><span id="l15.290" class="difflineminus">-                let props = this.mFilter.filterProperties;</span>
<a href="#l15.291"></a><span id="l15.291" class="difflineminus">-                this.mFilter.applyFilter(aFilter);</span>
<a href="#l15.292"></a><span id="l15.292" class="difflineminus">-                needsRefresh = !props || !props.equals(this.mFilter.filterProperties);</span>
<a href="#l15.293"></a><span id="l15.293" class="difflineminus">-            } else {</span>
<a href="#l15.294"></a><span id="l15.294" class="difflineminus">-                this.mFilter.updateFilterDates();</span>
<a href="#l15.295"></a><span id="l15.295" class="difflineminus">-            }</span>
<a href="#l15.296"></a><span id="l15.296" class="difflineplus">+          if (aFilter) {</span>
<a href="#l15.297"></a><span id="l15.297" class="difflineplus">+              let props = this.mFilter.filterProperties;</span>
<a href="#l15.298"></a><span id="l15.298" class="difflineplus">+              this.mFilter.applyFilter(aFilter);</span>
<a href="#l15.299"></a><span id="l15.299" class="difflineplus">+              needsRefresh = !props || !props.equals(this.mFilter.filterProperties);</span>
<a href="#l15.300"></a><span id="l15.300" class="difflineplus">+          } else {</span>
<a href="#l15.301"></a><span id="l15.301" class="difflineplus">+              this.mFilter.updateFilterDates();</span>
<a href="#l15.302"></a><span id="l15.302" class="difflineplus">+          }</span>
<a href="#l15.303"></a><span id="l15.303"> </span>
<a href="#l15.304"></a><span id="l15.304" class="difflineminus">-            if (this.mTextFilterField) {</span>
<a href="#l15.305"></a><span id="l15.305" class="difflineminus">-                let field = document.getElementById(this.mTextFilterField);</span>
<a href="#l15.306"></a><span id="l15.306" class="difflineminus">-                if (field) {</span>
<a href="#l15.307"></a><span id="l15.307" class="difflineminus">-                    this.mFilter.filterText = field.value;</span>
<a href="#l15.308"></a><span id="l15.308" class="difflineminus">-                    needsRefresh = needsRefresh || filterText.toLowerCase() != this.mFilter.filterText.toLowerCase();</span>
<a href="#l15.309"></a><span id="l15.309" class="difflineminus">-                }</span>
<a href="#l15.310"></a><span id="l15.310" class="difflineminus">-            }</span>
<a href="#l15.311"></a><span id="l15.311" class="difflineplus">+          if (this.mTextFilterField) {</span>
<a href="#l15.312"></a><span id="l15.312" class="difflineplus">+              let field = document.getElementById(this.mTextFilterField);</span>
<a href="#l15.313"></a><span id="l15.313" class="difflineplus">+              if (field) {</span>
<a href="#l15.314"></a><span id="l15.314" class="difflineplus">+                  this.mFilter.filterText = field.value;</span>
<a href="#l15.315"></a><span id="l15.315" class="difflineplus">+                  needsRefresh = needsRefresh || filterText.toLowerCase() != this.mFilter.filterText.toLowerCase();</span>
<a href="#l15.316"></a><span id="l15.316" class="difflineplus">+              }</span>
<a href="#l15.317"></a><span id="l15.317" class="difflineplus">+          }</span>
<a href="#l15.318"></a><span id="l15.318"> </span>
<a href="#l15.319"></a><span id="l15.319" class="difflineminus">-            // we only need to refresh the tree if the filter properties or date range changed</span>
<a href="#l15.320"></a><span id="l15.320" class="difflineminus">-            if (needsRefresh ||</span>
<a href="#l15.321"></a><span id="l15.321" class="difflineminus">-                !((!oldStart &amp;&amp; !this.mFilter.mStartDate) ||</span>
<a href="#l15.322"></a><span id="l15.322" class="difflineminus">-                  (oldStart &amp;&amp; this.mFilter.mStartDate &amp;&amp; oldStart.compare(this.mFilter.mStartDate) == 0)) ||</span>
<a href="#l15.323"></a><span id="l15.323" class="difflineminus">-                !((!oldEnd &amp;&amp; !this.mFilter.mEndDate) ||</span>
<a href="#l15.324"></a><span id="l15.324" class="difflineminus">-                  (oldEnd &amp;&amp; this.mFilter.mEndDate &amp;&amp; oldEnd.compare(this.mFilter.mEndDate) == 0))) {</span>
<a href="#l15.325"></a><span id="l15.325" class="difflineminus">-                this.refresh();</span>
<a href="#l15.326"></a><span id="l15.326" class="difflineminus">-            }</span>
<a href="#l15.327"></a><span id="l15.327" class="difflineplus">+          // we only need to refresh the tree if the filter properties or date range changed</span>
<a href="#l15.328"></a><span id="l15.328" class="difflineplus">+          if (needsRefresh ||</span>
<a href="#l15.329"></a><span id="l15.329" class="difflineplus">+              !((!oldStart &amp;&amp; !this.mFilter.mStartDate) ||</span>
<a href="#l15.330"></a><span id="l15.330" class="difflineplus">+                (oldStart &amp;&amp; this.mFilter.mStartDate &amp;&amp; oldStart.compare(this.mFilter.mStartDate) == 0)) ||</span>
<a href="#l15.331"></a><span id="l15.331" class="difflineplus">+              !((!oldEnd &amp;&amp; !this.mFilter.mEndDate) ||</span>
<a href="#l15.332"></a><span id="l15.332" class="difflineplus">+                (oldEnd &amp;&amp; this.mFilter.mEndDate &amp;&amp; oldEnd.compare(this.mFilter.mEndDate) == 0))) {</span>
<a href="#l15.333"></a><span id="l15.333" class="difflineplus">+              this.refresh();</span>
<a href="#l15.334"></a><span id="l15.334" class="difflineplus">+          }</span>
<a href="#l15.335"></a><span id="l15.335">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.336"></a><span id="l15.336">       &lt;/method&gt;</span>
<a href="#l15.337"></a><span id="l15.337"> </span>
<a href="#l15.338"></a><span id="l15.338">       &lt;method name=&quot;updateFilter&quot;&gt;</span>
<a href="#l15.339"></a><span id="l15.339">         &lt;parameter name=&quot;aFilter&quot;/&gt;</span>
<a href="#l15.340"></a><span id="l15.340">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.341"></a><span id="l15.341" class="difflineminus">-            this.doUpdateFilter(aFilter);</span>
<a href="#l15.342"></a><span id="l15.342" class="difflineplus">+          this.doUpdateFilter(aFilter);</span>
<a href="#l15.343"></a><span id="l15.343">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.344"></a><span id="l15.344">       &lt;/method&gt;</span>
<a href="#l15.345"></a><span id="l15.345"> </span>
<a href="#l15.346"></a><span id="l15.346">       &lt;method name=&quot;updateFocus&quot;&gt;</span>
<a href="#l15.347"></a><span id="l15.347">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.348"></a><span id="l15.348" class="difflineminus">-            let tree = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;calendar-task-tree&quot;);</span>
<a href="#l15.349"></a><span id="l15.349" class="difflineminus">-            let menuOpen = false;</span>
<a href="#l15.350"></a><span id="l15.350" class="difflineplus">+          let tree = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;calendar-task-tree&quot;);</span>
<a href="#l15.351"></a><span id="l15.351" class="difflineplus">+          let menuOpen = false;</span>
<a href="#l15.352"></a><span id="l15.352"> </span>
<a href="#l15.353"></a><span id="l15.353" class="difflineminus">-            // we need to consider the tree focused if the context menu is open.</span>
<a href="#l15.354"></a><span id="l15.354" class="difflineminus">-            if (this.hasAttribute(&quot;context&quot;)) {</span>
<a href="#l15.355"></a><span id="l15.355" class="difflineminus">-                let context = document.getElementById(this.getAttribute(&quot;context&quot;));</span>
<a href="#l15.356"></a><span id="l15.356" class="difflineminus">-                if (context &amp;&amp; context.state) {</span>
<a href="#l15.357"></a><span id="l15.357" class="difflineminus">-                    menuOpen = (context.state == &quot;open&quot;) || (context.state == &quot;showing&quot;);</span>
<a href="#l15.358"></a><span id="l15.358" class="difflineminus">-                }</span>
<a href="#l15.359"></a><span id="l15.359" class="difflineminus">-            }</span>
<a href="#l15.360"></a><span id="l15.360" class="difflineplus">+          // we need to consider the tree focused if the context menu is open.</span>
<a href="#l15.361"></a><span id="l15.361" class="difflineplus">+          if (this.hasAttribute(&quot;context&quot;)) {</span>
<a href="#l15.362"></a><span id="l15.362" class="difflineplus">+              let context = document.getElementById(this.getAttribute(&quot;context&quot;));</span>
<a href="#l15.363"></a><span id="l15.363" class="difflineplus">+              if (context &amp;&amp; context.state) {</span>
<a href="#l15.364"></a><span id="l15.364" class="difflineplus">+                  menuOpen = (context.state == &quot;open&quot;) || (context.state == &quot;showing&quot;);</span>
<a href="#l15.365"></a><span id="l15.365" class="difflineplus">+              }</span>
<a href="#l15.366"></a><span id="l15.366" class="difflineplus">+          }</span>
<a href="#l15.367"></a><span id="l15.367"> </span>
<a href="#l15.368"></a><span id="l15.368" class="difflineminus">-            let focused = (document.activeElement == tree) || menuOpen;</span>
<a href="#l15.369"></a><span id="l15.369" class="difflineplus">+          let focused = (document.activeElement == tree) || menuOpen;</span>
<a href="#l15.370"></a><span id="l15.370"> </span>
<a href="#l15.371"></a><span id="l15.371" class="difflineminus">-            calendarController.onSelectionChanged({ detail: focused ? this.selectedTasks : [] });</span>
<a href="#l15.372"></a><span id="l15.372" class="difflineminus">-            calendarController.todo_tasktree_focused = focused;</span>
<a href="#l15.373"></a><span id="l15.373" class="difflineplus">+          calendarController.onSelectionChanged({ detail: focused ? this.selectedTasks : [] });</span>
<a href="#l15.374"></a><span id="l15.374" class="difflineplus">+          calendarController.todo_tasktree_focused = focused;</span>
<a href="#l15.375"></a><span id="l15.375">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.376"></a><span id="l15.376">       &lt;/method&gt;</span>
<a href="#l15.377"></a><span id="l15.377" class="difflineminus">-</span>
<a href="#l15.378"></a><span id="l15.378">     &lt;/implementation&gt;</span>
<a href="#l15.379"></a><span id="l15.379"> </span>
<a href="#l15.380"></a><span id="l15.380">     &lt;handlers&gt;</span>
<a href="#l15.381"></a><span id="l15.381">       &lt;handler event=&quot;select&quot;&gt;&lt;![CDATA[</span>
<a href="#l15.382"></a><span id="l15.382">         this.mTreeView.onSelect(event);</span>
<a href="#l15.383"></a><span id="l15.383">         if (calendarController.todo_tasktree_focused) {</span>
<a href="#l15.384"></a><span id="l15.384" class="difflineminus">-          calendarController.onSelectionChanged({ detail: this.selectedTasks });</span>
<a href="#l15.385"></a><span id="l15.385" class="difflineplus">+            calendarController.onSelectionChanged({ detail: this.selectedTasks });</span>
<a href="#l15.386"></a><span id="l15.386">         }</span>
<a href="#l15.387"></a><span id="l15.387">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l15.388"></a><span id="l15.388">       &lt;handler event=&quot;focus&quot;&gt;&lt;![CDATA[</span>
<a href="#l15.389"></a><span id="l15.389">         this.updateFocus();</span>
<a href="#l15.390"></a><span id="l15.390">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l15.391"></a><span id="l15.391">       &lt;handler event=&quot;blur&quot;&gt;&lt;![CDATA[</span>
<a href="#l15.392"></a><span id="l15.392">         this.updateFocus();</span>
<a href="#l15.393"></a><span id="l15.393">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l15.394"></a><span id="l15.394" class="difflineat">@@ -1138,61 +1137,60 @@</span>
<a href="#l15.395"></a><span id="l15.395">             return;</span>
<a href="#l15.396"></a><span id="l15.396">         }</span>
<a href="#l15.397"></a><span id="l15.397"> </span>
<a href="#l15.398"></a><span id="l15.398">         let tree = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;calendar-task-tree&quot;);</span>
<a href="#l15.399"></a><span id="l15.399"> </span>
<a href="#l15.400"></a><span id="l15.400">         // let's build the drag region</span>
<a href="#l15.401"></a><span id="l15.401">         let region = null;</span>
<a href="#l15.402"></a><span id="l15.402">         try {</span>
<a href="#l15.403"></a><span id="l15.403" class="difflineminus">-          region = Components.classes[&quot;@mozilla.org/gfx/region;1&quot;].createInstance(Components.interfaces.nsIScriptableRegion);</span>
<a href="#l15.404"></a><span id="l15.404" class="difflineminus">-          region.init();</span>
<a href="#l15.405"></a><span id="l15.405" class="difflineminus">-          let treeBox = tree.treeBox;</span>
<a href="#l15.406"></a><span id="l15.406" class="difflineminus">-          let bodyBox = treeBox.treeBody.boxObject;</span>
<a href="#l15.407"></a><span id="l15.407" class="difflineminus">-          let sel = tree.view.selection;</span>
<a href="#l15.408"></a><span id="l15.408" class="difflineplus">+            region = Components.classes[&quot;@mozilla.org/gfx/region;1&quot;].createInstance(Components.interfaces.nsIScriptableRegion);</span>
<a href="#l15.409"></a><span id="l15.409" class="difflineplus">+            region.init();</span>
<a href="#l15.410"></a><span id="l15.410" class="difflineplus">+            let treeBox = tree.treeBox;</span>
<a href="#l15.411"></a><span id="l15.411" class="difflineplus">+            let bodyBox = treeBox.treeBody.boxObject;</span>
<a href="#l15.412"></a><span id="l15.412" class="difflineplus">+            let sel = tree.view.selection;</span>
<a href="#l15.413"></a><span id="l15.413"> </span>
<a href="#l15.414"></a><span id="l15.414" class="difflineminus">-          let rowX = bodyBox.x;</span>
<a href="#l15.415"></a><span id="l15.415" class="difflineminus">-          let rowY = bodyBox.y;</span>
<a href="#l15.416"></a><span id="l15.416" class="difflineminus">-          let rowHeight = treeBox.rowHeight;</span>
<a href="#l15.417"></a><span id="l15.417" class="difflineminus">-          let rowWidth = bodyBox.width;</span>
<a href="#l15.418"></a><span id="l15.418" class="difflineplus">+            let rowX = bodyBox.x;</span>
<a href="#l15.419"></a><span id="l15.419" class="difflineplus">+            let rowY = bodyBox.y;</span>
<a href="#l15.420"></a><span id="l15.420" class="difflineplus">+            let rowHeight = treeBox.rowHeight;</span>
<a href="#l15.421"></a><span id="l15.421" class="difflineplus">+            let rowWidth = bodyBox.width;</span>
<a href="#l15.422"></a><span id="l15.422"> </span>
<a href="#l15.423"></a><span id="l15.423" class="difflineminus">-          // add a rectangle for each visible selected row</span>
<a href="#l15.424"></a><span id="l15.424" class="difflineminus">-          for (let i = treeBox.getFirstVisibleRow(); i &lt;= treeBox.getLastVisibleRow(); i++) {</span>
<a href="#l15.425"></a><span id="l15.425" class="difflineminus">-            if (sel.isSelected(i)) {</span>
<a href="#l15.426"></a><span id="l15.426" class="difflineminus">-              region.unionRect(rowX, rowY, rowWidth, rowHeight);</span>
<a href="#l15.427"></a><span id="l15.427" class="difflineplus">+            // add a rectangle for each visible selected row</span>
<a href="#l15.428"></a><span id="l15.428" class="difflineplus">+            for (let i = treeBox.getFirstVisibleRow(); i &lt;= treeBox.getLastVisibleRow(); i++) {</span>
<a href="#l15.429"></a><span id="l15.429" class="difflineplus">+                if (sel.isSelected(i)) {</span>
<a href="#l15.430"></a><span id="l15.430" class="difflineplus">+                    region.unionRect(rowX, rowY, rowWidth, rowHeight);</span>
<a href="#l15.431"></a><span id="l15.431" class="difflineplus">+                }</span>
<a href="#l15.432"></a><span id="l15.432" class="difflineplus">+                rowY = rowY + rowHeight;</span>
<a href="#l15.433"></a><span id="l15.433">             }</span>
<a href="#l15.434"></a><span id="l15.434" class="difflineminus">-            rowY = rowY + rowHeight;</span>
<a href="#l15.435"></a><span id="l15.435" class="difflineminus">-          }</span>
<a href="#l15.436"></a><span id="l15.436"> </span>
<a href="#l15.437"></a><span id="l15.437" class="difflineminus">-          // and finally, clip the result to be sure we don't spill over...</span>
<a href="#l15.438"></a><span id="l15.438" class="difflineminus">-          if (!region.isEmpty()) {</span>
<a href="#l15.439"></a><span id="l15.439" class="difflineminus">-            region.intersectRect(bodyBox.x, bodyBox.y, bodyBox.width, bodyBox.height);</span>
<a href="#l15.440"></a><span id="l15.440" class="difflineminus">-          }</span>
<a href="#l15.441"></a><span id="l15.441" class="difflineplus">+            // and finally, clip the result to be sure we don't spill over...</span>
<a href="#l15.442"></a><span id="l15.442" class="difflineplus">+            if (!region.isEmpty()) {</span>
<a href="#l15.443"></a><span id="l15.443" class="difflineplus">+                region.intersectRect(bodyBox.x, bodyBox.y, bodyBox.width, bodyBox.height);</span>
<a href="#l15.444"></a><span id="l15.444" class="difflineplus">+            }</span>
<a href="#l15.445"></a><span id="l15.445">         } catch (ex) {</span>
<a href="#l15.446"></a><span id="l15.446" class="difflineminus">-          ASSERT(false, &quot;Error while building selection region: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l15.447"></a><span id="l15.447" class="difflineminus">-          region = null;</span>
<a href="#l15.448"></a><span id="l15.448" class="difflineplus">+            ASSERT(false, &quot;Error while building selection region: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l15.449"></a><span id="l15.449" class="difflineplus">+            region = null;</span>
<a href="#l15.450"></a><span id="l15.450">         }</span>
<a href="#l15.451"></a><span id="l15.451">         invokeEventDragSession(item, event.target);</span>
<a href="#l15.452"></a><span id="l15.452">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l15.453"></a><span id="l15.453">     &lt;/handlers&gt;</span>
<a href="#l15.454"></a><span id="l15.454"> </span>
<a href="#l15.455"></a><span id="l15.455">   &lt;/binding&gt;</span>
<a href="#l15.456"></a><span id="l15.456"> </span>
<a href="#l15.457"></a><span id="l15.457">   &lt;binding id=&quot;calendar-task-tree-todaypane&quot; extends=&quot;chrome://calendar/content/calendar-task-tree.xml#calendar-task-tree&quot;&gt;</span>
<a href="#l15.458"></a><span id="l15.458">     &lt;implementation&gt;</span>
<a href="#l15.459"></a><span id="l15.459">       &lt;method name=&quot;getInitialDate&quot;&gt;</span>
<a href="#l15.460"></a><span id="l15.460" class="difflineminus">-            &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.461"></a><span id="l15.461" class="difflineminus">-              let initialDate = agendaListbox.today ? agendaListbox.today.start : now();</span>
<a href="#l15.462"></a><span id="l15.462" class="difflineminus">-              return initialDate ? initialDate : now();</span>
<a href="#l15.463"></a><span id="l15.463" class="difflineminus">-            ]]&gt;&lt;/body&gt;</span>
<a href="#l15.464"></a><span id="l15.464" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.465"></a><span id="l15.465" class="difflineplus">+          let initialDate = agendaListbox.today ? agendaListbox.today.start : now();</span>
<a href="#l15.466"></a><span id="l15.466" class="difflineplus">+          return initialDate ? initialDate : now();</span>
<a href="#l15.467"></a><span id="l15.467" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.468"></a><span id="l15.468">       &lt;/method&gt;</span>
<a href="#l15.469"></a><span id="l15.469">       &lt;method name=&quot;updateFilter&quot;&gt;</span>
<a href="#l15.470"></a><span id="l15.470">         &lt;parameter name=&quot;aFilter&quot;/&gt;</span>
<a href="#l15.471"></a><span id="l15.471">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.472"></a><span id="l15.472" class="difflineminus">-            this.mFilter.selectedDate = agendaListbox.today &amp;&amp; agendaListbox.today.start ?</span>
<a href="#l15.473"></a><span id="l15.473" class="difflineminus">-                                        agendaListbox.today.start : now();</span>
<a href="#l15.474"></a><span id="l15.474" class="difflineminus">-</span>
<a href="#l15.475"></a><span id="l15.475" class="difflineminus">-            this.doUpdateFilter(aFilter);</span>
<a href="#l15.476"></a><span id="l15.476" class="difflineplus">+          this.mFilter.selectedDate = agendaListbox.today &amp;&amp; agendaListbox.today.start ?</span>
<a href="#l15.477"></a><span id="l15.477" class="difflineplus">+                                      agendaListbox.today.start : now();</span>
<a href="#l15.478"></a><span id="l15.478" class="difflineplus">+          this.doUpdateFilter(aFilter);</span>
<a href="#l15.479"></a><span id="l15.479">         ]]&gt;&lt;/body&gt;</span>
<a href="#l15.480"></a><span id="l15.480">       &lt;/method&gt;</span>
<a href="#l15.481"></a><span id="l15.481">     &lt;/implementation&gt;</span>
<a href="#l15.482"></a><span id="l15.482">   &lt;/binding&gt;</span>
<a href="#l15.483"></a><span id="l15.483"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -32,24 +32,24 @@ var taskDetailsView = {</span>
<a href="#l16.4"></a><span id="l16.4">             displayElement(&quot;calendar-task-details-title-row&quot;, true);</span>
<a href="#l16.5"></a><span id="l16.5">             document.getElementById(&quot;calendar-task-details-title&quot;).textContent =</span>
<a href="#l16.6"></a><span id="l16.6">                 (item.title ? item.title.replace(/\n/g, &quot; &quot;) : &quot;&quot;);</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">             let organizer = item.organizer;</span>
<a href="#l16.9"></a><span id="l16.9">             if (displayElement(&quot;calendar-task-details-organizer-row&quot;, organizer != null)) {</span>
<a href="#l16.10"></a><span id="l16.10">                 let name = organizer.commonName;</span>
<a href="#l16.11"></a><span id="l16.11">                 if (!name || name.length &lt;= 0) {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-                  if (organizer.id &amp;&amp; organizer.id.length) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                      name = organizer.id;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-                      let re = new RegExp(&quot;^mailto:(.*)&quot;, &quot;i&quot;);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-                      let matches = re.exec(name);</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-                      if (matches) {</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-                          name = matches[1];</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-                      }</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-                  }</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+                    if (organizer.id &amp;&amp; organizer.id.length) {</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+                        name = organizer.id;</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+                        let re = new RegExp(&quot;^mailto:(.*)&quot;, &quot;i&quot;);</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+                        let matches = re.exec(name);</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+                        if (matches) {</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+                            name = matches[1];</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+                        }</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+                    }</span>
<a href="#l16.28"></a><span id="l16.28">                 }</span>
<a href="#l16.29"></a><span id="l16.29">                 if (displayElement(&quot;calendar-task-details-organizer-row&quot;, name &amp;&amp; name.length)) {</span>
<a href="#l16.30"></a><span id="l16.30">                     document.getElementById(&quot;calendar-task-details-organizer&quot;).value = name;</span>
<a href="#l16.31"></a><span id="l16.31">                 }</span>
<a href="#l16.32"></a><span id="l16.32">             }</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34">             let priority = 0;</span>
<a href="#l16.35"></a><span id="l16.35">             if (item.calendar.getProperty(&quot;capabilities.priority.supported&quot;) != false) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -50,18 +50,18 @@ function setElementValue(aElement, aNewV</span>
<a href="#l17.4"></a><span id="l17.4">             } catch (e) {</span>
<a href="#l17.5"></a><span id="l17.5">                 cal.ERROR(&quot;setElementValue: aElement.setAttribute couldn't set &quot; +</span>
<a href="#l17.6"></a><span id="l17.6">                 aPropertyName + &quot; from &quot; + (aElement &amp;&amp; aElement.localName) + &quot; to &quot; + aNewValue +</span>
<a href="#l17.7"></a><span id="l17.7">                 &quot; e: &quot; + e + &quot;\n&quot;);</span>
<a href="#l17.8"></a><span id="l17.8">             }</span>
<a href="#l17.9"></a><span id="l17.9">         } else {</span>
<a href="#l17.10"></a><span id="l17.10">             aElement.value = aNewValue;</span>
<a href="#l17.11"></a><span id="l17.11">         }</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-     }</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">- }</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+    }</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+}</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17"> /**</span>
<a href="#l17.18"></a><span id="l17.18">  * Helper function for getting data from the form,</span>
<a href="#l17.19"></a><span id="l17.19">  * Get the value of a property of a XUL element</span>
<a href="#l17.20"></a><span id="l17.20">  *</span>
<a href="#l17.21"></a><span id="l17.21">  * @param aElement      ID of XUL element to set, or the element node itself</span>
<a href="#l17.22"></a><span id="l17.22">  * @param propertyName  OPTIONAL name of property to set, default is &quot;value&quot;,</span>
<a href="#l17.23"></a><span id="l17.23">  *                        use &quot;checked&quot; for radios &amp; checkboxes, &quot;data&quot; for</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineat">@@ -586,17 +586,17 @@ function getOptimalMinimumHeight(aXULEle</span>
<a href="#l17.25"></a><span id="l17.25"> /**</span>
<a href="#l17.26"></a><span id="l17.26">  * Gets the &quot;other&quot; orientation value, i.e if &quot;horizontal&quot; is passed, &quot;vertical&quot;</span>
<a href="#l17.27"></a><span id="l17.27">  * is returned and vice versa.</span>
<a href="#l17.28"></a><span id="l17.28">  *</span>
<a href="#l17.29"></a><span id="l17.29">  * @param aOrientation    The orientation value to turn around.</span>
<a href="#l17.30"></a><span id="l17.30">  * @return                The opposite orientation value.</span>
<a href="#l17.31"></a><span id="l17.31">  */</span>
<a href="#l17.32"></a><span id="l17.32"> function getOtherOrientation(aOrientation) {</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-     return (aOrientation == &quot;horizontal&quot; ? &quot;vertical&quot; : &quot;horizontal&quot;);</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+    return (aOrientation == &quot;horizontal&quot; ? &quot;vertical&quot; : &quot;horizontal&quot;);</span>
<a href="#l17.35"></a><span id="l17.35"> }</span>
<a href="#l17.36"></a><span id="l17.36"> </span>
<a href="#l17.37"></a><span id="l17.37"> /**</span>
<a href="#l17.38"></a><span id="l17.38">  * Setting labels on a menuitem doesn't update the label that is shown when the</span>
<a href="#l17.39"></a><span id="l17.39">  * menuitem is selected. This function takes care by reselecting the item</span>
<a href="#l17.40"></a><span id="l17.40">  *</span>
<a href="#l17.41"></a><span id="l17.41">  * @param aElement  The element to update, or its id as a string</span>
<a href="#l17.42"></a><span id="l17.42">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -107,17 +107,17 @@ var unifinderObserver = {</span>
<a href="#l18.4"></a><span id="l18.4">         switch (aName) {</span>
<a href="#l18.5"></a><span id="l18.5">             case &quot;disabled&quot;:</span>
<a href="#l18.6"></a><span id="l18.6">                 refreshEventTree();</span>
<a href="#l18.7"></a><span id="l18.7">                 break;</span>
<a href="#l18.8"></a><span id="l18.8">         }</span>
<a href="#l18.9"></a><span id="l18.9">     },</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">     onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+        this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l18.14"></a><span id="l18.14">     },</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">     // calICompositeObserver:</span>
<a href="#l18.17"></a><span id="l18.17">     onCalendarAdded: function(aAddedCalendar) {</span>
<a href="#l18.18"></a><span id="l18.18">         if (!aAddedCalendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l18.19"></a><span id="l18.19">             addItemsFromCalendar(aAddedCalendar,</span>
<a href="#l18.20"></a><span id="l18.20">                                  addItemsFromSingleCalendarInternal);</span>
<a href="#l18.21"></a><span id="l18.21">         }</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -338,17 +338,17 @@ function unifinderSelect(event) {</span>
<a href="#l18.23"></a><span id="l18.23"> </span>
<a href="#l18.24"></a><span id="l18.24">     for (let range = 0; range &lt; numRanges; range++) {</span>
<a href="#l18.25"></a><span id="l18.25">         tree.view.selection.getRangeAt(range, start, end);</span>
<a href="#l18.26"></a><span id="l18.26"> </span>
<a href="#l18.27"></a><span id="l18.27">         for (let i = start.value; i &lt;= end.value; i++) {</span>
<a href="#l18.28"></a><span id="l18.28">             try {</span>
<a href="#l18.29"></a><span id="l18.29">                 selectedItems.push(unifinderTreeView.getItemAt(i));</span>
<a href="#l18.30"></a><span id="l18.30">             } catch (e) {</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-               WARN(&quot;Error getting Event from row: &quot; + e + &quot;\n&quot;);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+                WARN(&quot;Error getting Event from row: &quot; + e + &quot;\n&quot;);</span>
<a href="#l18.33"></a><span id="l18.33">             }</span>
<a href="#l18.34"></a><span id="l18.34">         }</span>
<a href="#l18.35"></a><span id="l18.35">     }</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37">     if (selectedItems.length == 1) {</span>
<a href="#l18.38"></a><span id="l18.38">         // Go to the day of the selected item in the current view.</span>
<a href="#l18.39"></a><span id="l18.39">         currentView().goToDay(selectedItems[0].startDate);</span>
<a href="#l18.40"></a><span id="l18.40">     }</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -415,18 +415,18 @@ var unifinderTreeView = {</span>
<a href="#l18.42"></a><span id="l18.42">     /**</span>
<a href="#l18.43"></a><span id="l18.43">      * Sets the currently selected column in the unifinder (used for sorting).</span>
<a href="#l18.44"></a><span id="l18.44">      */</span>
<a href="#l18.45"></a><span id="l18.45">     set selectedColumn(aCol) {</span>
<a href="#l18.46"></a><span id="l18.46">         let tree = document.getElementById(&quot;unifinder-search-results-tree&quot;);</span>
<a href="#l18.47"></a><span id="l18.47">         let treecols = tree.getElementsByTagName(&quot;treecol&quot;);</span>
<a href="#l18.48"></a><span id="l18.48">         for (let col of treecols) {</span>
<a href="#l18.49"></a><span id="l18.49">             if (col.getAttribute(&quot;sortActive&quot;)) {</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-                  col.removeAttribute(&quot;sortActive&quot;);</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-                  col.removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+                col.removeAttribute(&quot;sortActive&quot;);</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+                col.removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l18.54"></a><span id="l18.54">             }</span>
<a href="#l18.55"></a><span id="l18.55">             if (aCol.getAttribute(&quot;itemproperty&quot;) == col.getAttribute(&quot;itemproperty&quot;)) {</span>
<a href="#l18.56"></a><span id="l18.56">                 col.setAttribute(&quot;sortActive&quot;, &quot;true&quot;);</span>
<a href="#l18.57"></a><span id="l18.57">                 col.setAttribute(&quot;sortDirection&quot;, this.sortDirection);</span>
<a href="#l18.58"></a><span id="l18.58">             }</span>
<a href="#l18.59"></a><span id="l18.59">         }</span>
<a href="#l18.60"></a><span id="l18.60">         return (this.mSelectedColumn = aCol);</span>
<a href="#l18.61"></a><span id="l18.61">     },</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineat">@@ -627,18 +627,18 @@ var unifinderTreeView = {</span>
<a href="#l18.63"></a><span id="l18.63">         this.treeElement.removeEventListener(&quot;select&quot;, unifinderSelect, true);</span>
<a href="#l18.64"></a><span id="l18.64">         this.tree.view.selection.selectEventsSuppressed = true;</span>
<a href="#l18.65"></a><span id="l18.65">         this.tree.view.selection.clearSelection();</span>
<a href="#l18.66"></a><span id="l18.66"> </span>
<a href="#l18.67"></a><span id="l18.67">         if (aItemArray &amp;&amp; aItemArray.length == 1) {</span>
<a href="#l18.68"></a><span id="l18.68">             // If only one item is selected, scroll to it</span>
<a href="#l18.69"></a><span id="l18.69">             let rowToScrollTo = this.getItemRow(aItemArray[0]);</span>
<a href="#l18.70"></a><span id="l18.70">             if (rowToScrollTo &gt; -1) {</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-               this.tree.ensureRowIsVisible(rowToScrollTo);</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-               this.tree.view.selection.select(rowToScrollTo);</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineplus">+                this.tree.ensureRowIsVisible(rowToScrollTo);</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineplus">+                this.tree.view.selection.select(rowToScrollTo);</span>
<a href="#l18.75"></a><span id="l18.75">             }</span>
<a href="#l18.76"></a><span id="l18.76">         } else if (aItemArray &amp;&amp; aItemArray.length &gt; 1) {</span>
<a href="#l18.77"></a><span id="l18.77">             // If there is more than one item, just select them all.</span>
<a href="#l18.78"></a><span id="l18.78">             for (let item of aItemArray) {</span>
<a href="#l18.79"></a><span id="l18.79">                 let row = this.getItemRow(item);</span>
<a href="#l18.80"></a><span id="l18.80">                 this.tree.view.selection.rangedSelect(row, row, true);</span>
<a href="#l18.81"></a><span id="l18.81">             }</span>
<a href="#l18.82"></a><span id="l18.82">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,21 +1,20 @@</span>
<a href="#l19.4"></a><span id="l19.4"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l19.5"></a><span id="l19.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.6"></a><span id="l19.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineminus">---&gt;</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11"> &lt;!-- Note that this file depends on helper functions in calUtils.js--&gt;</span>
<a href="#l19.12"></a><span id="l19.12"> </span>
<a href="#l19.13"></a><span id="l19.13"> &lt;bindings id=&quot;calendar-core-view-bindings&quot;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-    xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-    xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-    xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-    xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+          xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l19.22"></a><span id="l19.22"> </span>
<a href="#l19.23"></a><span id="l19.23">   &lt;binding id=&quot;calendar-editable-item&quot;&gt;</span>
<a href="#l19.24"></a><span id="l19.24">     &lt;content mousethrough=&quot;never&quot;</span>
<a href="#l19.25"></a><span id="l19.25">              tooltip=&quot;itemTooltip&quot;</span>
<a href="#l19.26"></a><span id="l19.26">              tabindex=&quot;-1&quot;&gt;</span>
<a href="#l19.27"></a><span id="l19.27">       &lt;xul:vbox flex=&quot;1&quot;&gt;</span>
<a href="#l19.28"></a><span id="l19.28">         &lt;xul:hbox&gt;</span>
<a href="#l19.29"></a><span id="l19.29">           &lt;xul:box anonid=&quot;event-container&quot;</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineat">@@ -62,44 +61,44 @@</span>
<a href="#l19.31"></a><span id="l19.31">             &lt;/xul:box&gt;</span>
<a href="#l19.32"></a><span id="l19.32">           &lt;/xul:box&gt;</span>
<a href="#l19.33"></a><span id="l19.33">         &lt;/xul:hbox&gt;</span>
<a href="#l19.34"></a><span id="l19.34">       &lt;/xul:vbox&gt;</span>
<a href="#l19.35"></a><span id="l19.35">     &lt;/content&gt;</span>
<a href="#l19.36"></a><span id="l19.36"> </span>
<a href="#l19.37"></a><span id="l19.37">     &lt;implementation&gt;</span>
<a href="#l19.38"></a><span id="l19.38">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">-         Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineminus">-         Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-         Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineplus">+        Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+        Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l19.45"></a><span id="l19.45"> </span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-         this.eventNameTextbox.onblur = () =&gt; {</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-             this.stopEditing(true);</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineminus">-         };</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineminus">-         this.eventNameTextbox.onkeypress = (event) =&gt; {</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-             // save on enter</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-             if (event.keyCode == 13) {</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineminus">-                 this.stopEditing(true);</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineminus">-             // abort on escape</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-             } else if (event.keyCode == 27) {</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineminus">-                 this.stopEditing(false);</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineminus">-             }</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-         };</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-         let stopPropagationIfEditing = (event) =&gt; {</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineminus">-           if (this.mEditing) {</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineminus">-             event.stopPropagation();</span>
<a href="#l19.61"></a><span id="l19.61" class="difflineminus">-           }</span>
<a href="#l19.62"></a><span id="l19.62" class="difflineminus">-         };</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-         // while editing, single click positions cursor, so don't propagate.</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineminus">-         this.eventNameTextbox.onclick = stopPropagationIfEditing;</span>
<a href="#l19.65"></a><span id="l19.65" class="difflineminus">-         // while editing, double click selects words, so don't propagate.</span>
<a href="#l19.66"></a><span id="l19.66" class="difflineminus">-         this.eventNameTextbox.ondblclick = stopPropagationIfEditing;</span>
<a href="#l19.67"></a><span id="l19.67" class="difflineminus">-         // while editing, don't propagate mousedown/up (selects calEvent).</span>
<a href="#l19.68"></a><span id="l19.68" class="difflineminus">-         this.eventNameTextbox.onmousedown = stopPropagationIfEditing;</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineminus">-         this.eventNameTextbox.onmouseup = stopPropagationIfEditing;</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineplus">+        this.eventNameTextbox.onblur = () =&gt; {</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+            this.stopEditing(true);</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+        };</span>
<a href="#l19.73"></a><span id="l19.73" class="difflineplus">+        this.eventNameTextbox.onkeypress = (event) =&gt; {</span>
<a href="#l19.74"></a><span id="l19.74" class="difflineplus">+            // save on enter</span>
<a href="#l19.75"></a><span id="l19.75" class="difflineplus">+            if (event.keyCode == 13) {</span>
<a href="#l19.76"></a><span id="l19.76" class="difflineplus">+                this.stopEditing(true);</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineplus">+            // abort on escape</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+            } else if (event.keyCode == 27) {</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineplus">+                this.stopEditing(false);</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineplus">+            }</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+        };</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineplus">+        let stopPropagationIfEditing = (event) =&gt; {</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineplus">+            if (this.mEditing) {</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineplus">+                event.stopPropagation();</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineplus">+            }</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+        };</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+        // while editing, single click positions cursor, so don't propagate.</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineplus">+        this.eventNameTextbox.onclick = stopPropagationIfEditing;</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+        // while editing, double click selects words, so don't propagate.</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineplus">+        this.eventNameTextbox.ondblclick = stopPropagationIfEditing;</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineplus">+        // while editing, don't propagate mousedown/up (selects calEvent).</span>
<a href="#l19.92"></a><span id="l19.92" class="difflineplus">+        this.eventNameTextbox.onmousedown = stopPropagationIfEditing;</span>
<a href="#l19.93"></a><span id="l19.93" class="difflineplus">+        this.eventNameTextbox.onmouseup = stopPropagationIfEditing;</span>
<a href="#l19.94"></a><span id="l19.94">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l19.95"></a><span id="l19.95"> </span>
<a href="#l19.96"></a><span id="l19.96">       &lt;field name=&quot;mOccurrence&quot;&gt;null&lt;/field&gt;</span>
<a href="#l19.97"></a><span id="l19.97">       &lt;field name=&quot;mSelected&quot;&gt;false&lt;/field&gt;</span>
<a href="#l19.98"></a><span id="l19.98">       &lt;field name=&quot;mCalendarView&quot;&gt;null&lt;/field&gt;</span>
<a href="#l19.99"></a><span id="l19.99"> </span>
<a href="#l19.100"></a><span id="l19.100">       &lt;property name=&quot;parentBox&quot;</span>
<a href="#l19.101"></a><span id="l19.101">                 onget=&quot;return this.mParentBox;&quot;</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineat">@@ -158,18 +157,18 @@</span>
<a href="#l19.103"></a><span id="l19.103"> </span>
<a href="#l19.104"></a><span id="l19.104">       &lt;method name=&quot;setCSSClasses&quot;&gt;</span>
<a href="#l19.105"></a><span id="l19.105">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.106"></a><span id="l19.106">           let item = this.mOccurrence;</span>
<a href="#l19.107"></a><span id="l19.107">           this.setAttribute(&quot;calendar-uri&quot;, item.calendar.uri.spec);</span>
<a href="#l19.108"></a><span id="l19.108">           this.setAttribute(&quot;calendar-id&quot;, item.calendar.id);</span>
<a href="#l19.109"></a><span id="l19.109">           let categoriesArray = item.getCategories({});</span>
<a href="#l19.110"></a><span id="l19.110">           if (categoriesArray.length &gt; 0) {</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineminus">-            let cssClassesArray = categoriesArray.map(formatStringForCSSRule);</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineminus">-            this.setAttribute(&quot;categories&quot;, cssClassesArray.join(&quot; &quot;));</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineplus">+              let cssClassesArray = categoriesArray.map(formatStringForCSSRule);</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineplus">+              this.setAttribute(&quot;categories&quot;, cssClassesArray.join(&quot; &quot;));</span>
<a href="#l19.115"></a><span id="l19.115">           }</span>
<a href="#l19.116"></a><span id="l19.116"> </span>
<a href="#l19.117"></a><span id="l19.117">           // Add alarm icons as needed.</span>
<a href="#l19.118"></a><span id="l19.118">           let alarms = item.getAlarms({});</span>
<a href="#l19.119"></a><span id="l19.119">           if (alarms.length &amp;&amp; Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true)) {</span>
<a href="#l19.120"></a><span id="l19.120">               let iconsBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alarm-icons-box&quot;);</span>
<a href="#l19.121"></a><span id="l19.121">               cal.alarms.addReminderImages(iconsBox, alarms);</span>
<a href="#l19.122"></a><span id="l19.122"> </span>
<a href="#l19.123"></a><span id="l19.123" class="difflineat">@@ -258,31 +257,31 @@</span>
<a href="#l19.124"></a><span id="l19.124">           this.eventNameTextbox.value = this.mOriginalTextLabel;</span>
<a href="#l19.125"></a><span id="l19.125">           this.eventNameTextbox.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l19.126"></a><span id="l19.126">           this.eventNameTextbox.select();</span>
<a href="#l19.127"></a><span id="l19.127">         ]]&gt;&lt;/body&gt;</span>
<a href="#l19.128"></a><span id="l19.128">       &lt;/method&gt;</span>
<a href="#l19.129"></a><span id="l19.129">       &lt;method name=&quot;select&quot;&gt;</span>
<a href="#l19.130"></a><span id="l19.130">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l19.131"></a><span id="l19.131">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineminus">-            if (!this.calendarView) {</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineminus">-                return;</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineminus">-            }</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineminus">-            let items = this.calendarView.mSelectedItems.slice();</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineminus">-            if (event.ctrlKey || event.metaKey) {</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineminus">-                if (this.selected) {</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineminus">-                    let pos = items.indexOf(this.mOccurrence);</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineminus">-                    items.splice(pos, 1);</span>
<a href="#l19.140"></a><span id="l19.140" class="difflineminus">-                } else {</span>
<a href="#l19.141"></a><span id="l19.141" class="difflineminus">-                    items.push(this.mOccurrence);</span>
<a href="#l19.142"></a><span id="l19.142" class="difflineminus">-                }</span>
<a href="#l19.143"></a><span id="l19.143" class="difflineminus">-            } else {</span>
<a href="#l19.144"></a><span id="l19.144" class="difflineminus">-                items = [this.mOccurrence];</span>
<a href="#l19.145"></a><span id="l19.145" class="difflineminus">-            }</span>
<a href="#l19.146"></a><span id="l19.146" class="difflineminus">-            this.calendarView.setSelectedItems(items.length, items);</span>
<a href="#l19.147"></a><span id="l19.147" class="difflineplus">+          if (!this.calendarView) {</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineplus">+              return;</span>
<a href="#l19.149"></a><span id="l19.149" class="difflineplus">+          }</span>
<a href="#l19.150"></a><span id="l19.150" class="difflineplus">+          let items = this.calendarView.mSelectedItems.slice();</span>
<a href="#l19.151"></a><span id="l19.151" class="difflineplus">+          if (event.ctrlKey || event.metaKey) {</span>
<a href="#l19.152"></a><span id="l19.152" class="difflineplus">+              if (this.selected) {</span>
<a href="#l19.153"></a><span id="l19.153" class="difflineplus">+                  let pos = items.indexOf(this.mOccurrence);</span>
<a href="#l19.154"></a><span id="l19.154" class="difflineplus">+                  items.splice(pos, 1);</span>
<a href="#l19.155"></a><span id="l19.155" class="difflineplus">+              } else {</span>
<a href="#l19.156"></a><span id="l19.156" class="difflineplus">+                  items.push(this.mOccurrence);</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineplus">+              }</span>
<a href="#l19.158"></a><span id="l19.158" class="difflineplus">+          } else {</span>
<a href="#l19.159"></a><span id="l19.159" class="difflineplus">+              items = [this.mOccurrence];</span>
<a href="#l19.160"></a><span id="l19.160" class="difflineplus">+          }</span>
<a href="#l19.161"></a><span id="l19.161" class="difflineplus">+          this.calendarView.setSelectedItems(items.length, items);</span>
<a href="#l19.162"></a><span id="l19.162">         ]]&gt;&lt;/body&gt;</span>
<a href="#l19.163"></a><span id="l19.163">       &lt;/method&gt;</span>
<a href="#l19.164"></a><span id="l19.164">       &lt;method name=&quot;stopEditing&quot;&gt;</span>
<a href="#l19.165"></a><span id="l19.165">         &lt;parameter name=&quot;saveChanges&quot;/&gt;</span>
<a href="#l19.166"></a><span id="l19.166">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l19.167"></a><span id="l19.167">           if (!this.mEditing) {</span>
<a href="#l19.168"></a><span id="l19.168">               return;</span>
<a href="#l19.169"></a><span id="l19.169">           }</span>
<a href="#l19.170"></a><span id="l19.170" class="difflineat">@@ -304,20 +303,20 @@</span>
<a href="#l19.171"></a><span id="l19.171">           this.eventNameLabel.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l19.172"></a><span id="l19.172">           return;</span>
<a href="#l19.173"></a><span id="l19.173">         ]]&gt;&lt;/body&gt;</span>
<a href="#l19.174"></a><span id="l19.174">       &lt;/method&gt;</span>
<a href="#l19.175"></a><span id="l19.175">     &lt;/implementation&gt;</span>
<a href="#l19.176"></a><span id="l19.176"> </span>
<a href="#l19.177"></a><span id="l19.177">     &lt;handlers&gt;</span>
<a href="#l19.178"></a><span id="l19.178">       &lt;handler event=&quot;contextmenu&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l19.179"></a><span id="l19.179" class="difflineminus">-       // If the middle/right button was used for click just select the item.</span>
<a href="#l19.180"></a><span id="l19.180" class="difflineminus">-       if (!this.selected) {</span>
<a href="#l19.181"></a><span id="l19.181" class="difflineminus">-         this.select(event);</span>
<a href="#l19.182"></a><span id="l19.182" class="difflineminus">-       }</span>
<a href="#l19.183"></a><span id="l19.183" class="difflineplus">+        // If the middle/right button was used for click just select the item.</span>
<a href="#l19.184"></a><span id="l19.184" class="difflineplus">+        if (!this.selected) {</span>
<a href="#l19.185"></a><span id="l19.185" class="difflineplus">+            this.select(event);</span>
<a href="#l19.186"></a><span id="l19.186" class="difflineplus">+        }</span>
<a href="#l19.187"></a><span id="l19.187">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l19.188"></a><span id="l19.188">       &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l19.189"></a><span id="l19.189">         if (this.mEditing) {</span>
<a href="#l19.190"></a><span id="l19.190">             return;</span>
<a href="#l19.191"></a><span id="l19.191">         }</span>
<a href="#l19.192"></a><span id="l19.192"> </span>
<a href="#l19.193"></a><span id="l19.193">         // If the left button was used and the item is already selected</span>
<a href="#l19.194"></a><span id="l19.194">         // and there are no multiple items selected start</span>
<a href="#l19.195"></a><span id="l19.195" class="difflineat">@@ -382,10 +381,9 @@</span>
<a href="#l19.196"></a><span id="l19.196">                 xbl:inherits=&quot;categories&quot;&gt;</span>
<a href="#l19.197"></a><span id="l19.197">         &lt;xul:hbox flex=&quot;1&quot;&gt;</span>
<a href="#l19.198"></a><span id="l19.198">           &lt;xul:image class=&quot;calendar-category-box-gradient&quot; height=&quot;1&quot;/&gt;</span>
<a href="#l19.199"></a><span id="l19.199">         &lt;/xul:hbox&gt;</span>
<a href="#l19.200"></a><span id="l19.200">         &lt;xul:hbox height=&quot;1&quot;/&gt;</span>
<a href="#l19.201"></a><span id="l19.201">       &lt;/xul:vbox&gt;</span>
<a href="#l19.202"></a><span id="l19.202">     &lt;/content&gt;</span>
<a href="#l19.203"></a><span id="l19.203">   &lt;/binding&gt;</span>
<a href="#l19.204"></a><span id="l19.204" class="difflineminus">-</span>
<a href="#l19.205"></a><span id="l19.205"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -214,18 +214,18 @@ function switchToView(aViewType) {</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5">     // Set up the labels and accesskeys for the context menu</span>
<a href="#l20.6"></a><span id="l20.6">     [&quot;calendar-view-context-menu-next&quot;,</span>
<a href="#l20.7"></a><span id="l20.7">      &quot;calendar-view-context-menu-previous&quot;,</span>
<a href="#l20.8"></a><span id="l20.8">      &quot;calendar-go-menu-next&quot;,</span>
<a href="#l20.9"></a><span id="l20.9">      &quot;calendar-go-menu-previous&quot;,</span>
<a href="#l20.10"></a><span id="l20.10">      &quot;appmenu_calendar-go-menu-next&quot;,</span>
<a href="#l20.11"></a><span id="l20.11">      &quot;appmenu_calendar-go-menu-previous&quot;].forEach((x) =&gt; {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-            setupViewNode(x, &quot;label&quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-            setupViewNode(x, &quot;accesskey&quot;);</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+         setupViewNode(x, &quot;label&quot;);</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+         setupViewNode(x, &quot;accesskey&quot;);</span>
<a href="#l20.16"></a><span id="l20.16">      });</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18">     // Set up the labels for the view navigation</span>
<a href="#l20.19"></a><span id="l20.19">     [&quot;previous-view-button&quot;,</span>
<a href="#l20.20"></a><span id="l20.20">      &quot;today-view-button&quot;,</span>
<a href="#l20.21"></a><span id="l20.21">      &quot;next-view-button&quot;].forEach(x =&gt; setupViewNode(x, &quot;tooltiptext&quot;));</span>
<a href="#l20.22"></a><span id="l20.22"> </span>
<a href="#l20.23"></a><span id="l20.23">     try {</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineat">@@ -314,29 +314,29 @@ function scheduleMidnightUpdate(aRefresh</span>
<a href="#l20.25"></a><span id="l20.25">         }</span>
<a href="#l20.26"></a><span id="l20.26">     };</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">     if (gMidnightTimer) {</span>
<a href="#l20.29"></a><span id="l20.29">         gMidnightTimer.cancel();</span>
<a href="#l20.30"></a><span id="l20.30">     } else {</span>
<a href="#l20.31"></a><span id="l20.31">         // Observer for wake after sleep/hibernate/standby to create new timers and refresh UI</span>
<a href="#l20.32"></a><span id="l20.32">         let wakeObserver = {</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-           observe: function(aSubject, aTopic, aData) {</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-               if (aTopic == &quot;wake_notification&quot;) {</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-                   // postpone refresh for another couple of seconds to get netwerk ready:</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-                   if (this.mTimer) {</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-                       this.mTimer.cancel();</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineminus">-                   } else {</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-                       this.mTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineminus">-                                               .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineminus">-                   }</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineminus">-                   this.mTimer.initWithCallback(udCallback, 10 * 1000,</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineminus">-                                                Components.interfaces.nsITimer.TYPE_ONE_SHOT);</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineminus">-               }</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineminus">-           }</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+            observe: function(aSubject, aTopic, aData) {</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+                if (aTopic == &quot;wake_notification&quot;) {</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+                    // postpone refresh for another couple of seconds to get netwerk ready:</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+                    if (this.mTimer) {</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+                        this.mTimer.cancel();</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+                    } else {</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+                        this.mTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+                                                .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+                    }</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+                    this.mTimer.initWithCallback(udCallback, 10 * 1000,</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+                                                 Components.interfaces.nsITimer.TYPE_ONE_SHOT);</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+                }</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+            }</span>
<a href="#l20.59"></a><span id="l20.59">         };</span>
<a href="#l20.60"></a><span id="l20.60"> </span>
<a href="#l20.61"></a><span id="l20.61">         // Add observer</span>
<a href="#l20.62"></a><span id="l20.62">         Services.obs.addObserver(wakeObserver, &quot;wake_notification&quot;, false);</span>
<a href="#l20.63"></a><span id="l20.63"> </span>
<a href="#l20.64"></a><span id="l20.64">         // Remove observer on unload</span>
<a href="#l20.65"></a><span id="l20.65">         window.addEventListener(&quot;unload&quot;, () =&gt; {</span>
<a href="#l20.66"></a><span id="l20.66">             Services.obs.removeObserver(wakeObserver, &quot;wake_notification&quot;);</span>
<a href="#l20.67"></a><span id="l20.67" class="difflineat">@@ -348,26 +348,26 @@ function scheduleMidnightUpdate(aRefresh</span>
<a href="#l20.68"></a><span id="l20.68"> }</span>
<a href="#l20.69"></a><span id="l20.69"> </span>
<a href="#l20.70"></a><span id="l20.70"> /**</span>
<a href="#l20.71"></a><span id="l20.71">  * Retuns a cached copy of the view stylesheet.</span>
<a href="#l20.72"></a><span id="l20.72">  *</span>
<a href="#l20.73"></a><span id="l20.73">  * @return      The view stylesheet object.</span>
<a href="#l20.74"></a><span id="l20.74">  */</span>
<a href="#l20.75"></a><span id="l20.75"> function getViewStyleSheet() {</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-  if (!getViewStyleSheet.sheet) {</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-      const cssUri = &quot;chrome://calendar/content/calendar-view-bindings.css&quot;;</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineminus">-      for (let sheet of document.styleSheets) {</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineminus">-          if (sheet.href == cssUri) {</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineminus">-              getViewStyleSheet.sheet = sheet;</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineminus">-              break;</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineminus">-          }</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineminus">-      }</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineminus">-  }</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineminus">-  return getViewStyleSheet.sheet;</span>
<a href="#l20.86"></a><span id="l20.86" class="difflineplus">+    if (!getViewStyleSheet.sheet) {</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineplus">+        const cssUri = &quot;chrome://calendar/content/calendar-view-bindings.css&quot;;</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineplus">+        for (let sheet of document.styleSheets) {</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineplus">+            if (sheet.href == cssUri) {</span>
<a href="#l20.90"></a><span id="l20.90" class="difflineplus">+                getViewStyleSheet.sheet = sheet;</span>
<a href="#l20.91"></a><span id="l20.91" class="difflineplus">+                break;</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineplus">+            }</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineplus">+        }</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineplus">+    }</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineplus">+    return getViewStyleSheet.sheet;</span>
<a href="#l20.96"></a><span id="l20.96"> }</span>
<a href="#l20.97"></a><span id="l20.97"> </span>
<a href="#l20.98"></a><span id="l20.98"> /**</span>
<a href="#l20.99"></a><span id="l20.99">  * Updates the view stylesheet to contain rules that give all boxes with class</span>
<a href="#l20.100"></a><span id="l20.100">  * .calendar-color-box and an attribute calendar-id=&quot;&lt;id of the calendar&gt;&quot; the</span>
<a href="#l20.101"></a><span id="l20.101">  * background color of the specified calendar.</span>
<a href="#l20.102"></a><span id="l20.102">  *</span>
<a href="#l20.103"></a><span id="l20.103">  * @param aCalendar     The calendar to update the stylesheet for.</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineat">@@ -400,44 +400,44 @@ function updateStyleSheetForViews(aCalen</span>
<a href="#l20.105"></a><span id="l20.105">  * initCategories since branch observers only live as long as the branch object</span>
<a href="#l20.106"></a><span id="l20.106">  * is alive, and out of categoryManagement to avoid cyclic references.</span>
<a href="#l20.107"></a><span id="l20.107">  */</span>
<a href="#l20.108"></a><span id="l20.108"> var categoryPrefBranch;</span>
<a href="#l20.109"></a><span id="l20.109"> var categoryManagement = {</span>
<a href="#l20.110"></a><span id="l20.110">     QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIObserver]),</span>
<a href="#l20.111"></a><span id="l20.111"> </span>
<a href="#l20.112"></a><span id="l20.112">     initCategories: function() {</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineminus">-      categoryPrefBranch = Services.prefs.getBranch(&quot;calendar.category.color.&quot;);</span>
<a href="#l20.114"></a><span id="l20.114" class="difflineminus">-      let categories = categoryPrefBranch.getChildList(&quot;&quot;);</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineplus">+        categoryPrefBranch = Services.prefs.getBranch(&quot;calendar.category.color.&quot;);</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineplus">+        let categories = categoryPrefBranch.getChildList(&quot;&quot;);</span>
<a href="#l20.117"></a><span id="l20.117"> </span>
<a href="#l20.118"></a><span id="l20.118" class="difflineminus">-      // Fix illegally formatted category prefs.</span>
<a href="#l20.119"></a><span id="l20.119" class="difflineminus">-      for (let i in categories) {</span>
<a href="#l20.120"></a><span id="l20.120" class="difflineminus">-          let category = categories[i];</span>
<a href="#l20.121"></a><span id="l20.121" class="difflineminus">-          if (category.search(/[^_0-9a-z-]/) != -1) {</span>
<a href="#l20.122"></a><span id="l20.122" class="difflineminus">-              let categoryFix = formatStringForCSSRule(category);</span>
<a href="#l20.123"></a><span id="l20.123" class="difflineminus">-              if (categoryPrefBranch.prefHasUserValue(categoryFix)) {</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineminus">-                  categories.splice(i, 1); // remove illegal name</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineminus">-              } else {</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineminus">-                  let color = categoryPrefBranch.getCharPref(category);</span>
<a href="#l20.127"></a><span id="l20.127" class="difflineminus">-                  categoryPrefBranch.setCharPref(categoryFix, color);</span>
<a href="#l20.128"></a><span id="l20.128" class="difflineminus">-                  categoryPrefBranch.clearUserPref(category); // not usable</span>
<a href="#l20.129"></a><span id="l20.129" class="difflineminus">-                  categories[i] = categoryFix;  // replace illegal name</span>
<a href="#l20.130"></a><span id="l20.130" class="difflineminus">-              }</span>
<a href="#l20.131"></a><span id="l20.131" class="difflineminus">-          }</span>
<a href="#l20.132"></a><span id="l20.132" class="difflineminus">-      }</span>
<a href="#l20.133"></a><span id="l20.133" class="difflineplus">+        // Fix illegally formatted category prefs.</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineplus">+        for (let i in categories) {</span>
<a href="#l20.135"></a><span id="l20.135" class="difflineplus">+            let category = categories[i];</span>
<a href="#l20.136"></a><span id="l20.136" class="difflineplus">+            if (category.search(/[^_0-9a-z-]/) != -1) {</span>
<a href="#l20.137"></a><span id="l20.137" class="difflineplus">+                let categoryFix = formatStringForCSSRule(category);</span>
<a href="#l20.138"></a><span id="l20.138" class="difflineplus">+                if (categoryPrefBranch.prefHasUserValue(categoryFix)) {</span>
<a href="#l20.139"></a><span id="l20.139" class="difflineplus">+                    categories.splice(i, 1); // remove illegal name</span>
<a href="#l20.140"></a><span id="l20.140" class="difflineplus">+                } else {</span>
<a href="#l20.141"></a><span id="l20.141" class="difflineplus">+                    let color = categoryPrefBranch.getCharPref(category);</span>
<a href="#l20.142"></a><span id="l20.142" class="difflineplus">+                    categoryPrefBranch.setCharPref(categoryFix, color);</span>
<a href="#l20.143"></a><span id="l20.143" class="difflineplus">+                    categoryPrefBranch.clearUserPref(category); // not usable</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineplus">+                    categories[i] = categoryFix;  // replace illegal name</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineplus">+                }</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineplus">+            }</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineplus">+        }</span>
<a href="#l20.148"></a><span id="l20.148"> </span>
<a href="#l20.149"></a><span id="l20.149" class="difflineminus">-      // Add color information to the stylesheets.</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineminus">-      categories.forEach(categoryManagement.updateStyleSheetForCategory,</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineminus">-                         categoryManagement);</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineminus">-      categoryPrefBranch.addObserver(&quot;&quot;, categoryManagement, false);</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineplus">+        // Add color information to the stylesheets.</span>
<a href="#l20.154"></a><span id="l20.154" class="difflineplus">+        categories.forEach(categoryManagement.updateStyleSheetForCategory,</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineplus">+                           categoryManagement);</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineplus">+        categoryPrefBranch.addObserver(&quot;&quot;, categoryManagement, false);</span>
<a href="#l20.157"></a><span id="l20.157">     },</span>
<a href="#l20.158"></a><span id="l20.158"> </span>
<a href="#l20.159"></a><span id="l20.159">     cleanupCategories: function() {</span>
<a href="#l20.160"></a><span id="l20.160" class="difflineminus">-      categoryPrefBranch = Services.prefs.getBranch(&quot;calendar.category.color.&quot;);</span>
<a href="#l20.161"></a><span id="l20.161" class="difflineminus">-      categoryPrefBranch.removeObserver(&quot;&quot;, categoryManagement);</span>
<a href="#l20.162"></a><span id="l20.162" class="difflineplus">+        categoryPrefBranch = Services.prefs.getBranch(&quot;calendar.category.color.&quot;);</span>
<a href="#l20.163"></a><span id="l20.163" class="difflineplus">+        categoryPrefBranch.removeObserver(&quot;&quot;, categoryManagement);</span>
<a href="#l20.164"></a><span id="l20.164">     },</span>
<a href="#l20.165"></a><span id="l20.165"> </span>
<a href="#l20.166"></a><span id="l20.166">     observe: function(aSubject, aTopic, aPrefName) {</span>
<a href="#l20.167"></a><span id="l20.167">         this.updateStyleSheetForCategory(aPrefName);</span>
<a href="#l20.168"></a><span id="l20.168">         // TODO Currently, the only way to find out if categories are removed is</span>
<a href="#l20.169"></a><span id="l20.169">         // to initially grab the calendar.categories.names preference and then</span>
<a href="#l20.170"></a><span id="l20.170">         // observe changes to it. it would be better if we had hooks for this,</span>
<a href="#l20.171"></a><span id="l20.171">         // so we could delete the rule from our style cache and also remove its</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/calendar-views.xml</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.xml</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,289 +1,289 @@</span>
<a href="#l21.4"></a><span id="l21.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l21.5"></a><span id="l21.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineminus">---&gt;</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineminus">-</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12"> &lt;bindings id=&quot;calendar-specific-view-bindings&quot;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-    xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-    xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-    xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-    xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+          xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l21.21"></a><span id="l21.21"> </span>
<a href="#l21.22"></a><span id="l21.22" class="difflineminus">-    &lt;binding id=&quot;calendar-day-view&quot;</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-             extends=&quot;chrome://calendar/content/calendar-multiday-view.xml#calendar-multiday-view&quot;&gt;</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">-            &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-                &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-                    return &quot;day-view-observer&quot;;</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-                ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-            &lt;/property&gt;</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-            &lt;property name=&quot;supportsWorkdaysOnly&quot;</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-                      readonly=&quot;true&quot;</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-                      onget=&quot;return false;&quot;/&gt;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+  &lt;binding id=&quot;calendar-day-view&quot;</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+           extends=&quot;chrome://calendar/content/calendar-multiday-view.xml#calendar-multiday-view&quot;&gt;</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+    &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+      &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+          return &quot;day-view-observer&quot;;</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+      &lt;property name=&quot;supportsWorkdaysOnly&quot;</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+                readonly=&quot;true&quot;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+                onget=&quot;return false;&quot;/&gt;</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-            &lt;!--Public methods--&gt;</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-            &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-                &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-                    if (!aDate) {</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-                        this.refresh();</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineminus">-                        return;</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-                    }</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-                    aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-                    this.setDateRange(aDate, aDate);</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-                    this.selectedDay = aDate;</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">-            &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-                &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineminus">-                    if (aNumber) {</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineminus">-                        let currentDay = this.startDay.clone();</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineminus">-                        currentDay.day += aNumber;</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineminus">-                        this.goToDay(currentDay);</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-                    } else {</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineminus">-                        this.goToDay(now());</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineminus">-                    }</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.70"></a><span id="l21.70" class="difflineminus">-        &lt;/implementation&gt;</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-    &lt;/binding&gt;</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+      &lt;!-- Public methods --&gt;</span>
<a href="#l21.73"></a><span id="l21.73" class="difflineplus">+      &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.74"></a><span id="l21.74" class="difflineplus">+        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+          if (!aDate) {</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+              this.refresh();</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+              return;</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+          }</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+          aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+          this.setDateRange(aDate, aDate);</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+          this.selectedDay = aDate;</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineplus">+      &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineplus">+        &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineplus">+          if (aNumber) {</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+              let currentDay = this.startDay.clone();</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+              currentDay.day += aNumber;</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+              this.goToDay(currentDay);</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineplus">+          } else {</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+              this.goToDay(now());</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineplus">+          }</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l21.98"></a><span id="l21.98" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l21.99"></a><span id="l21.99"> </span>
<a href="#l21.100"></a><span id="l21.100" class="difflineminus">-    &lt;binding id=&quot;calendar-week-view&quot;</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineminus">-             extends=&quot;chrome://calendar/content/calendar-multiday-view.xml#calendar-multiday-view&quot;&gt;</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineminus">-        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.103"></a><span id="l21.103" class="difflineminus">-            &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l21.104"></a><span id="l21.104" class="difflineminus">-                // add a listener for the mode change</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineminus">-                this.mModeHandler = (event) =&gt; {</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineminus">-                    if (event.attrName == &quot;mode&quot;) {</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineminus">-                        this.onModeChanged(event);</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineminus">-                    }</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-                };</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineminus">-                document.getElementById(&quot;modeBroadcaster&quot;).addEventListener(&quot;DOMAttrModified&quot;, this.mModeHandler, true);</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineminus">-            ]]&gt;&lt;/constructor&gt;</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineminus">-            &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineminus">-                document.getElementById(&quot;modeBroadcaster&quot;).removeEventListener(&quot;DOMAttrModified&quot;, this.mModeHandler, true);</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineminus">-            ]]&gt;&lt;/destructor&gt;</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineplus">+  &lt;binding id=&quot;calendar-week-view&quot;</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineplus">+           extends=&quot;chrome://calendar/content/calendar-multiday-view.xml#calendar-multiday-view&quot;&gt;</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+    &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.118"></a><span id="l21.118" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineplus">+        // add a listener for the mode change</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineplus">+        this.mModeHandler = (event) =&gt; {</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineplus">+            if (event.attrName == &quot;mode&quot;) {</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineplus">+                this.onModeChanged(event);</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineplus">+            }</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineplus">+        };</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+        document.getElementById(&quot;modeBroadcaster&quot;).addEventListener(&quot;DOMAttrModified&quot;, this.mModeHandler, true);</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineplus">+      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineplus">+        document.getElementById(&quot;modeBroadcaster&quot;).removeEventListener(&quot;DOMAttrModified&quot;, this.mModeHandler, true);</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineplus">+      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l21.130"></a><span id="l21.130"> </span>
<a href="#l21.131"></a><span id="l21.131" class="difflineminus">-            &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.132"></a><span id="l21.132" class="difflineminus">-                &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineminus">-                    return &quot;week-view-observer&quot;;</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineminus">-                ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineminus">-            &lt;/property&gt;</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineplus">+      &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineplus">+          return &quot;week-view-observer&quot;;</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l21.141"></a><span id="l21.141"> </span>
<a href="#l21.142"></a><span id="l21.142" class="difflineminus">-            &lt;method name=&quot;onModeChanged&quot;&gt;</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineminus">-              &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineminus">-              &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineminus">-                let currentMode = document.getElementById(&quot;modeBroadcaster&quot;).getAttribute(&quot;mode&quot;);</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineminus">-                if (currentMode != &quot;calendar&quot;) {</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineminus">-                    timeIndicator.cancel();</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineminus">-                }</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineminus">-              ]]&gt;&lt;/body&gt;</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.151"></a><span id="l21.151" class="difflineplus">+      &lt;method name=&quot;onModeChanged&quot;&gt;</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineplus">+        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.154"></a><span id="l21.154" class="difflineplus">+          let currentMode = document.getElementById(&quot;modeBroadcaster&quot;).getAttribute(&quot;mode&quot;);</span>
<a href="#l21.155"></a><span id="l21.155" class="difflineplus">+          if (currentMode != &quot;calendar&quot;) {</span>
<a href="#l21.156"></a><span id="l21.156" class="difflineplus">+              timeIndicator.cancel();</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineplus">+          }</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.160"></a><span id="l21.160"> </span>
<a href="#l21.161"></a><span id="l21.161" class="difflineminus">-            &lt;!--Public methods--&gt;</span>
<a href="#l21.162"></a><span id="l21.162" class="difflineminus">-            &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.163"></a><span id="l21.163" class="difflineminus">-                &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.164"></a><span id="l21.164" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.165"></a><span id="l21.165" class="difflineminus">-                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.166"></a><span id="l21.166" class="difflineplus">+      &lt;!--Public methods--&gt;</span>
<a href="#l21.167"></a><span id="l21.167" class="difflineplus">+      &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.168"></a><span id="l21.168" class="difflineplus">+        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.169"></a><span id="l21.169" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.170"></a><span id="l21.170" class="difflineplus">+          this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.171"></a><span id="l21.171"> </span>
<a href="#l21.172"></a><span id="l21.172" class="difflineminus">-                    if (!aDate) {</span>
<a href="#l21.173"></a><span id="l21.173" class="difflineminus">-                        this.refresh();</span>
<a href="#l21.174"></a><span id="l21.174" class="difflineminus">-                        return;</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineminus">-                    }</span>
<a href="#l21.176"></a><span id="l21.176" class="difflineminus">-                    aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.177"></a><span id="l21.177" class="difflineminus">-                    let weekStart = getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l21.178"></a><span id="l21.178" class="difflineminus">-                    let weekEnd = weekStart.clone();</span>
<a href="#l21.179"></a><span id="l21.179" class="difflineminus">-                    weekEnd.day += 6;</span>
<a href="#l21.180"></a><span id="l21.180" class="difflineminus">-                    this.setDateRange(weekStart, weekEnd);</span>
<a href="#l21.181"></a><span id="l21.181" class="difflineminus">-                    this.selectedDay = aDate;</span>
<a href="#l21.182"></a><span id="l21.182" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.183"></a><span id="l21.183" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.184"></a><span id="l21.184" class="difflineminus">-            &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.185"></a><span id="l21.185" class="difflineminus">-                &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.186"></a><span id="l21.186" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.187"></a><span id="l21.187" class="difflineminus">-                    if (aNumber) {</span>
<a href="#l21.188"></a><span id="l21.188" class="difflineminus">-                        let date = this.selectedDay.clone();</span>
<a href="#l21.189"></a><span id="l21.189" class="difflineminus">-                        date.day += 7 * aNumber;</span>
<a href="#l21.190"></a><span id="l21.190" class="difflineminus">-                        this.goToDay(date);</span>
<a href="#l21.191"></a><span id="l21.191" class="difflineminus">-                    } else {</span>
<a href="#l21.192"></a><span id="l21.192" class="difflineminus">-                        this.goToDay(now());</span>
<a href="#l21.193"></a><span id="l21.193" class="difflineminus">-                    }</span>
<a href="#l21.194"></a><span id="l21.194" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.195"></a><span id="l21.195" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.196"></a><span id="l21.196" class="difflineminus">-        &lt;/implementation&gt;</span>
<a href="#l21.197"></a><span id="l21.197" class="difflineminus">-    &lt;/binding&gt;</span>
<a href="#l21.198"></a><span id="l21.198" class="difflineplus">+          if (!aDate) {</span>
<a href="#l21.199"></a><span id="l21.199" class="difflineplus">+              this.refresh();</span>
<a href="#l21.200"></a><span id="l21.200" class="difflineplus">+              return;</span>
<a href="#l21.201"></a><span id="l21.201" class="difflineplus">+          }</span>
<a href="#l21.202"></a><span id="l21.202" class="difflineplus">+          aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.203"></a><span id="l21.203" class="difflineplus">+          let weekStart = cal.getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l21.204"></a><span id="l21.204" class="difflineplus">+          let weekEnd = weekStart.clone();</span>
<a href="#l21.205"></a><span id="l21.205" class="difflineplus">+          weekEnd.day += 6;</span>
<a href="#l21.206"></a><span id="l21.206" class="difflineplus">+          this.setDateRange(weekStart, weekEnd);</span>
<a href="#l21.207"></a><span id="l21.207" class="difflineplus">+          this.selectedDay = aDate;</span>
<a href="#l21.208"></a><span id="l21.208" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.209"></a><span id="l21.209" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.210"></a><span id="l21.210" class="difflineplus">+      &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.211"></a><span id="l21.211" class="difflineplus">+        &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.212"></a><span id="l21.212" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.213"></a><span id="l21.213" class="difflineplus">+          if (aNumber) {</span>
<a href="#l21.214"></a><span id="l21.214" class="difflineplus">+              let date = this.selectedDay.clone();</span>
<a href="#l21.215"></a><span id="l21.215" class="difflineplus">+              date.day += 7 * aNumber;</span>
<a href="#l21.216"></a><span id="l21.216" class="difflineplus">+              this.goToDay(date);</span>
<a href="#l21.217"></a><span id="l21.217" class="difflineplus">+          } else {</span>
<a href="#l21.218"></a><span id="l21.218" class="difflineplus">+              this.goToDay(now());</span>
<a href="#l21.219"></a><span id="l21.219" class="difflineplus">+          }</span>
<a href="#l21.220"></a><span id="l21.220" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.221"></a><span id="l21.221" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.222"></a><span id="l21.222" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l21.223"></a><span id="l21.223" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l21.224"></a><span id="l21.224"> </span>
<a href="#l21.225"></a><span id="l21.225" class="difflineminus">-    &lt;binding id=&quot;calendar-multiweek-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l21.226"></a><span id="l21.226" class="difflineminus">-        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.227"></a><span id="l21.227" class="difflineminus">-	        &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l21.228"></a><span id="l21.228" class="difflineminus">-                Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l21.229"></a><span id="l21.229" class="difflineminus">-                this.mWeeksInView = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l21.230"></a><span id="l21.230" class="difflineminus">-            ]]&gt;&lt;/constructor&gt;</span>
<a href="#l21.231"></a><span id="l21.231" class="difflineplus">+  &lt;binding id=&quot;calendar-multiweek-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l21.232"></a><span id="l21.232" class="difflineplus">+    &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.233"></a><span id="l21.233" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l21.234"></a><span id="l21.234" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l21.235"></a><span id="l21.235" class="difflineplus">+        this.mWeeksInView = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l21.236"></a><span id="l21.236" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l21.237"></a><span id="l21.237"> </span>
<a href="#l21.238"></a><span id="l21.238" class="difflineminus">-            &lt;field name=&quot;mWeeksInView&quot;&gt;4&lt;/field&gt;</span>
<a href="#l21.239"></a><span id="l21.239" class="difflineplus">+      &lt;field name=&quot;mWeeksInView&quot;&gt;4&lt;/field&gt;</span>
<a href="#l21.240"></a><span id="l21.240"> </span>
<a href="#l21.241"></a><span id="l21.241" class="difflineminus">-            &lt;property name=&quot;weeksInView&quot;&gt;</span>
<a href="#l21.242"></a><span id="l21.242" class="difflineminus">-                &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.243"></a><span id="l21.243" class="difflineminus">-                    return this.mWeeksInView;</span>
<a href="#l21.244"></a><span id="l21.244" class="difflineminus">-                ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.245"></a><span id="l21.245" class="difflineminus">-                &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l21.246"></a><span id="l21.246" class="difflineminus">-                    this.mWeeksInView = val;</span>
<a href="#l21.247"></a><span id="l21.247" class="difflineminus">-                    Preferences.set(&quot;calendar.weeks.inview&quot;, Number(val));</span>
<a href="#l21.248"></a><span id="l21.248" class="difflineminus">-                    this.refreshView();</span>
<a href="#l21.249"></a><span id="l21.249" class="difflineminus">-                    return val;</span>
<a href="#l21.250"></a><span id="l21.250" class="difflineminus">-                ]]&gt;&lt;/setter&gt;</span>
<a href="#l21.251"></a><span id="l21.251" class="difflineminus">-            &lt;/property&gt;</span>
<a href="#l21.252"></a><span id="l21.252" class="difflineplus">+      &lt;property name=&quot;weeksInView&quot;&gt;</span>
<a href="#l21.253"></a><span id="l21.253" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.254"></a><span id="l21.254" class="difflineplus">+          return this.mWeeksInView;</span>
<a href="#l21.255"></a><span id="l21.255" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.256"></a><span id="l21.256" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l21.257"></a><span id="l21.257" class="difflineplus">+          this.mWeeksInView = val;</span>
<a href="#l21.258"></a><span id="l21.258" class="difflineplus">+          Preferences.set(&quot;calendar.weeks.inview&quot;, Number(val));</span>
<a href="#l21.259"></a><span id="l21.259" class="difflineplus">+          this.refreshView();</span>
<a href="#l21.260"></a><span id="l21.260" class="difflineplus">+          return val;</span>
<a href="#l21.261"></a><span id="l21.261" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l21.262"></a><span id="l21.262" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l21.263"></a><span id="l21.263"> </span>
<a href="#l21.264"></a><span id="l21.264" class="difflineminus">-            &lt;property name=&quot;supportsZoom&quot; readonly=&quot;true&quot;</span>
<a href="#l21.265"></a><span id="l21.265" class="difflineminus">-                      onget=&quot;return true;&quot;/&gt;</span>
<a href="#l21.266"></a><span id="l21.266" class="difflineplus">+      &lt;property name=&quot;supportsZoom&quot; readonly=&quot;true&quot;</span>
<a href="#l21.267"></a><span id="l21.267" class="difflineplus">+                onget=&quot;return true;&quot;/&gt;</span>
<a href="#l21.268"></a><span id="l21.268"> </span>
<a href="#l21.269"></a><span id="l21.269" class="difflineminus">-            &lt;method name=&quot;zoomIn&quot;&gt;</span>
<a href="#l21.270"></a><span id="l21.270" class="difflineminus">-              &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l21.271"></a><span id="l21.271" class="difflineminus">-              &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.272"></a><span id="l21.272" class="difflineminus">-                let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l21.273"></a><span id="l21.273" class="difflineminus">-                visibleWeeks += (aLevel || 1);</span>
<a href="#l21.274"></a><span id="l21.274" class="difflineplus">+      &lt;method name=&quot;zoomIn&quot;&gt;</span>
<a href="#l21.275"></a><span id="l21.275" class="difflineplus">+        &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l21.276"></a><span id="l21.276" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.277"></a><span id="l21.277" class="difflineplus">+          let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l21.278"></a><span id="l21.278" class="difflineplus">+          visibleWeeks += (aLevel || 1);</span>
<a href="#l21.279"></a><span id="l21.279"> </span>
<a href="#l21.280"></a><span id="l21.280" class="difflineminus">-                Preferences.set(&quot;calendar.weeks.inview&quot;, Math.min(visibleWeeks, 6));</span>
<a href="#l21.281"></a><span id="l21.281" class="difflineminus">-              ]]&gt;&lt;/body&gt;</span>
<a href="#l21.282"></a><span id="l21.282" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.283"></a><span id="l21.283" class="difflineminus">-            &lt;method name=&quot;zoomOut&quot;&gt;</span>
<a href="#l21.284"></a><span id="l21.284" class="difflineminus">-              &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l21.285"></a><span id="l21.285" class="difflineminus">-              &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.286"></a><span id="l21.286" class="difflineminus">-                let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l21.287"></a><span id="l21.287" class="difflineminus">-                visibleWeeks -= (aLevel || 1);</span>
<a href="#l21.288"></a><span id="l21.288" class="difflineplus">+          Preferences.set(&quot;calendar.weeks.inview&quot;, Math.min(visibleWeeks, 6));</span>
<a href="#l21.289"></a><span id="l21.289" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.290"></a><span id="l21.290" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.291"></a><span id="l21.291" class="difflineplus">+</span>
<a href="#l21.292"></a><span id="l21.292" class="difflineplus">+      &lt;method name=&quot;zoomOut&quot;&gt;</span>
<a href="#l21.293"></a><span id="l21.293" class="difflineplus">+        &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l21.294"></a><span id="l21.294" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.295"></a><span id="l21.295" class="difflineplus">+          let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l21.296"></a><span id="l21.296" class="difflineplus">+          visibleWeeks -= aLevel || 1;</span>
<a href="#l21.297"></a><span id="l21.297" class="difflineplus">+</span>
<a href="#l21.298"></a><span id="l21.298" class="difflineplus">+          Preferences.set(&quot;calendar.weeks.inview&quot;, Math.max(visibleWeeks, 2));</span>
<a href="#l21.299"></a><span id="l21.299" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.300"></a><span id="l21.300" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.301"></a><span id="l21.301" class="difflineplus">+</span>
<a href="#l21.302"></a><span id="l21.302" class="difflineplus">+      &lt;method name=&quot;zoomReset&quot;&gt;</span>
<a href="#l21.303"></a><span id="l21.303" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.304"></a><span id="l21.304" class="difflineplus">+          Preferences.set(&quot;calendar.view.visiblehours&quot;, 4);</span>
<a href="#l21.305"></a><span id="l21.305" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.306"></a><span id="l21.306" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.307"></a><span id="l21.307" class="difflineplus">+</span>
<a href="#l21.308"></a><span id="l21.308" class="difflineplus">+      &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.309"></a><span id="l21.309" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.310"></a><span id="l21.310" class="difflineplus">+          return &quot;multiweek-view-observer&quot;;</span>
<a href="#l21.311"></a><span id="l21.311" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.312"></a><span id="l21.312" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l21.313"></a><span id="l21.313"> </span>
<a href="#l21.314"></a><span id="l21.314" class="difflineminus">-                Preferences.set(&quot;calendar.weeks.inview&quot;, Math.max(visibleWeeks, 2));</span>
<a href="#l21.315"></a><span id="l21.315" class="difflineminus">-              ]]&gt;&lt;/body&gt;</span>
<a href="#l21.316"></a><span id="l21.316" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.317"></a><span id="l21.317" class="difflineminus">-            &lt;method name=&quot;zoomReset&quot;&gt;</span>
<a href="#l21.318"></a><span id="l21.318" class="difflineminus">-              &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.319"></a><span id="l21.319" class="difflineminus">-                Preferences.set(&quot;calendar.view.visiblehours&quot;, 4);</span>
<a href="#l21.320"></a><span id="l21.320" class="difflineminus">-              ]]&gt;&lt;/body&gt;</span>
<a href="#l21.321"></a><span id="l21.321" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.322"></a><span id="l21.322" class="difflineplus">+      &lt;!--Public methods--&gt;</span>
<a href="#l21.323"></a><span id="l21.323" class="difflineplus">+      &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.324"></a><span id="l21.324" class="difflineplus">+        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.325"></a><span id="l21.325" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.326"></a><span id="l21.326" class="difflineplus">+          this.showFullMonth = false;</span>
<a href="#l21.327"></a><span id="l21.327" class="difflineplus">+          this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.328"></a><span id="l21.328"> </span>
<a href="#l21.329"></a><span id="l21.329" class="difflineminus">-            &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.330"></a><span id="l21.330" class="difflineminus">-                &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.331"></a><span id="l21.331" class="difflineminus">-                    return &quot;multiweek-view-observer&quot;;</span>
<a href="#l21.332"></a><span id="l21.332" class="difflineminus">-                ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.333"></a><span id="l21.333" class="difflineminus">-            &lt;/property&gt;</span>
<a href="#l21.334"></a><span id="l21.334" class="difflineminus">-</span>
<a href="#l21.335"></a><span id="l21.335" class="difflineminus">-            &lt;!--Public methods--&gt;</span>
<a href="#l21.336"></a><span id="l21.336" class="difflineminus">-            &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.337"></a><span id="l21.337" class="difflineminus">-                &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.338"></a><span id="l21.338" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.339"></a><span id="l21.339" class="difflineminus">-                    this.showFullMonth = false;</span>
<a href="#l21.340"></a><span id="l21.340" class="difflineminus">-                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.341"></a><span id="l21.341" class="difflineplus">+          // If aDate is null it means that only a refresh is needed</span>
<a href="#l21.342"></a><span id="l21.342" class="difflineplus">+          // without changing the start and end of the view.</span>
<a href="#l21.343"></a><span id="l21.343" class="difflineplus">+          if (aDate) {</span>
<a href="#l21.344"></a><span id="l21.344" class="difflineplus">+              aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.345"></a><span id="l21.345" class="difflineplus">+              // Get the first date that should be shown. This is the</span>
<a href="#l21.346"></a><span id="l21.346" class="difflineplus">+              // start of the week of the day that we're centering around</span>
<a href="#l21.347"></a><span id="l21.347" class="difflineplus">+              // adjusted for the day the week starts on and the number</span>
<a href="#l21.348"></a><span id="l21.348" class="difflineplus">+              // of previous weeks we're supposed to display.</span>
<a href="#l21.349"></a><span id="l21.349" class="difflineplus">+              let dayStart = cal.getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l21.350"></a><span id="l21.350" class="difflineplus">+              dayStart -= 7 * Preferences.get(&quot;calendar.previousweeks.inview&quot;, 0);</span>
<a href="#l21.351"></a><span id="l21.351" class="difflineplus">+              // The last day we're supposed to show</span>
<a href="#l21.352"></a><span id="l21.352" class="difflineplus">+              let dayEnd = dayStart.clone();</span>
<a href="#l21.353"></a><span id="l21.353" class="difflineplus">+              dayEnd += (7 * this.mWeeksInView) - 1;</span>
<a href="#l21.354"></a><span id="l21.354" class="difflineplus">+              this.setDateRange(dayStart, dayEnd);</span>
<a href="#l21.355"></a><span id="l21.355" class="difflineplus">+              this.selectedDay = aDate;</span>
<a href="#l21.356"></a><span id="l21.356" class="difflineplus">+          } else {</span>
<a href="#l21.357"></a><span id="l21.357" class="difflineplus">+              this.refresh();</span>
<a href="#l21.358"></a><span id="l21.358" class="difflineplus">+          }</span>
<a href="#l21.359"></a><span id="l21.359" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.360"></a><span id="l21.360" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.361"></a><span id="l21.361"> </span>
<a href="#l21.362"></a><span id="l21.362" class="difflineminus">-                    // If aDate is null it means that only a refresh is needed</span>
<a href="#l21.363"></a><span id="l21.363" class="difflineminus">-                    // without changing the start and end of the view.</span>
<a href="#l21.364"></a><span id="l21.364" class="difflineminus">-                    if (aDate) {</span>
<a href="#l21.365"></a><span id="l21.365" class="difflineminus">-                        aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.366"></a><span id="l21.366" class="difflineminus">-                        // Get the first date that should be shown. This is the</span>
<a href="#l21.367"></a><span id="l21.367" class="difflineminus">-                        // start of the week of the day that we're centering around</span>
<a href="#l21.368"></a><span id="l21.368" class="difflineminus">-                        // adjusted for the day the week starts on and the number</span>
<a href="#l21.369"></a><span id="l21.369" class="difflineminus">-                        // of previous weeks we're supposed to display.</span>
<a href="#l21.370"></a><span id="l21.370" class="difflineminus">-                        let dayStart = getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l21.371"></a><span id="l21.371" class="difflineminus">-                        dayStart.day -= (7 * Preferences.get(&quot;calendar.previousweeks.inview&quot;, 0));</span>
<a href="#l21.372"></a><span id="l21.372" class="difflineminus">-                        // The last day we're supposed to show</span>
<a href="#l21.373"></a><span id="l21.373" class="difflineminus">-                        let dayEnd = dayStart.clone();</span>
<a href="#l21.374"></a><span id="l21.374" class="difflineminus">-                        dayEnd.day += ((7 * this.mWeeksInView) - 1);</span>
<a href="#l21.375"></a><span id="l21.375" class="difflineminus">-                        this.setDateRange(dayStart, dayEnd);</span>
<a href="#l21.376"></a><span id="l21.376" class="difflineminus">-                        this.selectedDay = aDate;</span>
<a href="#l21.377"></a><span id="l21.377" class="difflineminus">-                    } else {</span>
<a href="#l21.378"></a><span id="l21.378" class="difflineminus">-                        this.refresh();</span>
<a href="#l21.379"></a><span id="l21.379" class="difflineminus">-                    }</span>
<a href="#l21.380"></a><span id="l21.380" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.381"></a><span id="l21.381" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.382"></a><span id="l21.382" class="difflineminus">-            &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.383"></a><span id="l21.383" class="difflineminus">-                &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.384"></a><span id="l21.384" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.385"></a><span id="l21.385" class="difflineminus">-                    if (aNumber) {</span>
<a href="#l21.386"></a><span id="l21.386" class="difflineminus">-                        let date = this.startDay.clone();</span>
<a href="#l21.387"></a><span id="l21.387" class="difflineminus">-                        let savedSelectedDay = this.selectedDay.clone();</span>
<a href="#l21.388"></a><span id="l21.388" class="difflineminus">-                        // aNumber only corresponds to the number of weeks to move</span>
<a href="#l21.389"></a><span id="l21.389" class="difflineminus">-                        // make sure to compensate for previous weeks in view too</span>
<a href="#l21.390"></a><span id="l21.390" class="difflineminus">-                        date.day += 7 * (aNumber + Preferences.get(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l21.391"></a><span id="l21.391" class="difflineminus">-                        this.goToDay(date);</span>
<a href="#l21.392"></a><span id="l21.392" class="difflineminus">-                        savedSelectedDay.day += 7 * aNumber;</span>
<a href="#l21.393"></a><span id="l21.393" class="difflineminus">-                        this.selectedDay = savedSelectedDay;</span>
<a href="#l21.394"></a><span id="l21.394" class="difflineminus">-                    } else {</span>
<a href="#l21.395"></a><span id="l21.395" class="difflineminus">-                        let date = now();</span>
<a href="#l21.396"></a><span id="l21.396" class="difflineminus">-                        this.goToDay(date);</span>
<a href="#l21.397"></a><span id="l21.397" class="difflineminus">-                        this.selectedDay = date;</span>
<a href="#l21.398"></a><span id="l21.398" class="difflineminus">-                    }</span>
<a href="#l21.399"></a><span id="l21.399" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.400"></a><span id="l21.400" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.401"></a><span id="l21.401" class="difflineminus">-        &lt;/implementation&gt;</span>
<a href="#l21.402"></a><span id="l21.402" class="difflineminus">-    &lt;/binding&gt;</span>
<a href="#l21.403"></a><span id="l21.403" class="difflineplus">+      &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.404"></a><span id="l21.404" class="difflineplus">+        &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.405"></a><span id="l21.405" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.406"></a><span id="l21.406" class="difflineplus">+          if (aNumber) {</span>
<a href="#l21.407"></a><span id="l21.407" class="difflineplus">+              let date = this.startDay.clone();</span>
<a href="#l21.408"></a><span id="l21.408" class="difflineplus">+              let savedSelectedDay = this.selectedDay.clone();</span>
<a href="#l21.409"></a><span id="l21.409" class="difflineplus">+              // aNumber only corresponds to the number of weeks to move</span>
<a href="#l21.410"></a><span id="l21.410" class="difflineplus">+              // make sure to compensate for previous weeks in view too</span>
<a href="#l21.411"></a><span id="l21.411" class="difflineplus">+              date.day += 7 * (aNumber + Preferences.get(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l21.412"></a><span id="l21.412" class="difflineplus">+              this.goToDay(date);</span>
<a href="#l21.413"></a><span id="l21.413" class="difflineplus">+              savedSelectedDay.day += 7 * aNumber;</span>
<a href="#l21.414"></a><span id="l21.414" class="difflineplus">+              this.selectedDay = savedSelectedDay;</span>
<a href="#l21.415"></a><span id="l21.415" class="difflineplus">+          } else {</span>
<a href="#l21.416"></a><span id="l21.416" class="difflineplus">+              let date = now();</span>
<a href="#l21.417"></a><span id="l21.417" class="difflineplus">+              this.goToDay(date);</span>
<a href="#l21.418"></a><span id="l21.418" class="difflineplus">+              this.selectedDay = date;</span>
<a href="#l21.419"></a><span id="l21.419" class="difflineplus">+          }</span>
<a href="#l21.420"></a><span id="l21.420" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.421"></a><span id="l21.421" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.422"></a><span id="l21.422" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l21.423"></a><span id="l21.423" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l21.424"></a><span id="l21.424"> </span>
<a href="#l21.425"></a><span id="l21.425" class="difflineminus">-    &lt;binding id=&quot;calendar-month-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l21.426"></a><span id="l21.426" class="difflineminus">-        &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.427"></a><span id="l21.427" class="difflineplus">+  &lt;binding id=&quot;calendar-month-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l21.428"></a><span id="l21.428" class="difflineplus">+    &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l21.429"></a><span id="l21.429" class="difflineplus">+      &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.430"></a><span id="l21.430" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.431"></a><span id="l21.431" class="difflineplus">+          return &quot;month-view-observer&quot;;</span>
<a href="#l21.432"></a><span id="l21.432" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.433"></a><span id="l21.433" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l21.434"></a><span id="l21.434"> </span>
<a href="#l21.435"></a><span id="l21.435" class="difflineminus">-            &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l21.436"></a><span id="l21.436" class="difflineminus">-                &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l21.437"></a><span id="l21.437" class="difflineminus">-                    return &quot;month-view-observer&quot;;</span>
<a href="#l21.438"></a><span id="l21.438" class="difflineminus">-                ]]&gt;&lt;/getter&gt;</span>
<a href="#l21.439"></a><span id="l21.439" class="difflineminus">-            &lt;/property&gt;</span>
<a href="#l21.440"></a><span id="l21.440" class="difflineplus">+      &lt;!--Public methods--&gt;</span>
<a href="#l21.441"></a><span id="l21.441" class="difflineplus">+      &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.442"></a><span id="l21.442" class="difflineplus">+        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.443"></a><span id="l21.443" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.444"></a><span id="l21.444" class="difflineplus">+          this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.445"></a><span id="l21.445"> </span>
<a href="#l21.446"></a><span id="l21.446" class="difflineminus">-            &lt;!--Public methods--&gt;</span>
<a href="#l21.447"></a><span id="l21.447" class="difflineminus">-            &lt;method name=&quot;goToDay&quot;&gt;</span>
<a href="#l21.448"></a><span id="l21.448" class="difflineminus">-                &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l21.449"></a><span id="l21.449" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.450"></a><span id="l21.450" class="difflineminus">-                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.451"></a><span id="l21.451" class="difflineplus">+          if (aDate) {</span>
<a href="#l21.452"></a><span id="l21.452" class="difflineplus">+              aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.453"></a><span id="l21.453" class="difflineplus">+          }</span>
<a href="#l21.454"></a><span id="l21.454" class="difflineplus">+          this.showDate(aDate);</span>
<a href="#l21.455"></a><span id="l21.455" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.456"></a><span id="l21.456" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.457"></a><span id="l21.457" class="difflineplus">+      &lt;method name=&quot;getRangeDescription&quot;&gt;</span>
<a href="#l21.458"></a><span id="l21.458" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.459"></a><span id="l21.459" class="difflineplus">+          let monthName = cal.formatMonth(this.rangeStartDate.month + 1,</span>
<a href="#l21.460"></a><span id="l21.460" class="difflineplus">+                                          &quot;calendar&quot;, &quot;monthInYear&quot;);</span>
<a href="#l21.461"></a><span id="l21.461" class="difflineplus">+          return calGetString(&quot;calendar&quot;, &quot;monthInYear&quot;, [monthName, this.rangeStartDate.year]);</span>
<a href="#l21.462"></a><span id="l21.462" class="difflineplus">+         ]]&gt;&lt;/body&gt;</span>
<a href="#l21.463"></a><span id="l21.463" class="difflineplus">+       &lt;/method&gt;</span>
<a href="#l21.464"></a><span id="l21.464" class="difflineplus">+      &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.465"></a><span id="l21.465" class="difflineplus">+        &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.466"></a><span id="l21.466" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.467"></a><span id="l21.467" class="difflineplus">+          let dates = this.getDateList({});</span>
<a href="#l21.468"></a><span id="l21.468" class="difflineplus">+          this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.469"></a><span id="l21.469"> </span>
<a href="#l21.470"></a><span id="l21.470" class="difflineminus">-                    if (aDate) {</span>
<a href="#l21.471"></a><span id="l21.471" class="difflineminus">-                        aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l21.472"></a><span id="l21.472" class="difflineminus">-                    }</span>
<a href="#l21.473"></a><span id="l21.473" class="difflineminus">-                    this.showDate(aDate);</span>
<a href="#l21.474"></a><span id="l21.474" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.475"></a><span id="l21.475" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.476"></a><span id="l21.476" class="difflineminus">-            &lt;method name=&quot;getRangeDescription&quot;&gt;</span>
<a href="#l21.477"></a><span id="l21.477" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.478"></a><span id="l21.478" class="difflineminus">-                    let monthName = cal.formatMonth(this.rangeStartDate.month + 1,</span>
<a href="#l21.479"></a><span id="l21.479" class="difflineminus">-                                                    &quot;calendar&quot;, &quot;monthInYear&quot;);</span>
<a href="#l21.480"></a><span id="l21.480" class="difflineminus">-                    return calGetString(&quot;calendar&quot;, &quot;monthInYear&quot;, [monthName, this.rangeStartDate.year]);</span>
<a href="#l21.481"></a><span id="l21.481" class="difflineminus">-                 ]]&gt;&lt;/body&gt;</span>
<a href="#l21.482"></a><span id="l21.482" class="difflineminus">-             &lt;/method&gt;</span>
<a href="#l21.483"></a><span id="l21.483" class="difflineminus">-            &lt;method name=&quot;moveView&quot;&gt;</span>
<a href="#l21.484"></a><span id="l21.484" class="difflineminus">-                &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l21.485"></a><span id="l21.485" class="difflineminus">-                &lt;body&gt;&lt;![CDATA[</span>
<a href="#l21.486"></a><span id="l21.486" class="difflineminus">-                    let dates = this.getDateList({});</span>
<a href="#l21.487"></a><span id="l21.487" class="difflineminus">-                    this.displayDaysOff = !this.mWorkdaysOnly;</span>
<a href="#l21.488"></a><span id="l21.488" class="difflineplus">+          if (aNumber) {</span>
<a href="#l21.489"></a><span id="l21.489" class="difflineplus">+              // The first few dates in this list are likely in the month</span>
<a href="#l21.490"></a><span id="l21.490" class="difflineplus">+              // prior to the one actually being shown (since the month</span>
<a href="#l21.491"></a><span id="l21.491" class="difflineplus">+              // probably doesn't start on a Sunday).  The 7th item must</span>
<a href="#l21.492"></a><span id="l21.492" class="difflineplus">+              // be in correct month though.</span>
<a href="#l21.493"></a><span id="l21.493" class="difflineplus">+              let date = dates[6].clone();</span>
<a href="#l21.494"></a><span id="l21.494"> </span>
<a href="#l21.495"></a><span id="l21.495" class="difflineminus">-                    if (aNumber) {</span>
<a href="#l21.496"></a><span id="l21.496" class="difflineminus">-                        // The first few dates in this list are likely in the month</span>
<a href="#l21.497"></a><span id="l21.497" class="difflineminus">-                        // prior to the one actually being shown (since the month</span>
<a href="#l21.498"></a><span id="l21.498" class="difflineminus">-                        // probably doesn't start on a Sunday).  The 7th item must</span>
<a href="#l21.499"></a><span id="l21.499" class="difflineminus">-                        // be in correct month though.</span>
<a href="#l21.500"></a><span id="l21.500" class="difflineminus">-                        let date = dates[6].clone();</span>
<a href="#l21.501"></a><span id="l21.501" class="difflineplus">+              date.month += aNumber;</span>
<a href="#l21.502"></a><span id="l21.502" class="difflineplus">+              // Need to store this before we move</span>
<a href="#l21.503"></a><span id="l21.503" class="difflineplus">+              let oldSelectedDay = this.selectedDay;</span>
<a href="#l21.504"></a><span id="l21.504"> </span>
<a href="#l21.505"></a><span id="l21.505" class="difflineminus">-                        date.month += aNumber;</span>
<a href="#l21.506"></a><span id="l21.506" class="difflineminus">-                        // Need to store this before we move</span>
<a href="#l21.507"></a><span id="l21.507" class="difflineminus">-                        let oldSelectedDay = this.selectedDay;</span>
<a href="#l21.508"></a><span id="l21.508" class="difflineminus">-</span>
<a href="#l21.509"></a><span id="l21.509" class="difflineminus">-                        this.goToDay(date);</span>
<a href="#l21.510"></a><span id="l21.510" class="difflineplus">+              this.goToDay(date);</span>
<a href="#l21.511"></a><span id="l21.511"> </span>
<a href="#l21.512"></a><span id="l21.512" class="difflineminus">-                        // Most of the time we want to select the date with the</span>
<a href="#l21.513"></a><span id="l21.513" class="difflineminus">-                        // same day number in the next month</span>
<a href="#l21.514"></a><span id="l21.514" class="difflineminus">-                        let newSelectedDay = oldSelectedDay.clone();</span>
<a href="#l21.515"></a><span id="l21.515" class="difflineminus">-                        newSelectedDay.month += aNumber;</span>
<a href="#l21.516"></a><span id="l21.516" class="difflineminus">-                        // correct for accidental rollover into the next month</span>
<a href="#l21.517"></a><span id="l21.517" class="difflineminus">-                        if ((newSelectedDay.month - aNumber + 12) % 12 != oldSelectedDay.month) {</span>
<a href="#l21.518"></a><span id="l21.518" class="difflineminus">-                            newSelectedDay.month -= 1;</span>
<a href="#l21.519"></a><span id="l21.519" class="difflineminus">-                            newSelectedDay.day = newSelectedDay.endOfMonth.day;</span>
<a href="#l21.520"></a><span id="l21.520" class="difflineminus">-                        }</span>
<a href="#l21.521"></a><span id="l21.521" class="difflineplus">+              // Most of the time we want to select the date with the</span>
<a href="#l21.522"></a><span id="l21.522" class="difflineplus">+              // same day number in the next month</span>
<a href="#l21.523"></a><span id="l21.523" class="difflineplus">+              let newSelectedDay = oldSelectedDay.clone();</span>
<a href="#l21.524"></a><span id="l21.524" class="difflineplus">+              newSelectedDay.month += aNumber;</span>
<a href="#l21.525"></a><span id="l21.525" class="difflineplus">+              // correct for accidental rollover into the next month</span>
<a href="#l21.526"></a><span id="l21.526" class="difflineplus">+              if ((newSelectedDay.month - aNumber + 12) % 12 != oldSelectedDay.month) {</span>
<a href="#l21.527"></a><span id="l21.527" class="difflineplus">+                  newSelectedDay.month -= 1;</span>
<a href="#l21.528"></a><span id="l21.528" class="difflineplus">+                  newSelectedDay.day = newSelectedDay.endOfMonth.day;</span>
<a href="#l21.529"></a><span id="l21.529" class="difflineplus">+              }</span>
<a href="#l21.530"></a><span id="l21.530"> </span>
<a href="#l21.531"></a><span id="l21.531" class="difflineminus">-                        this.selectedDay = newSelectedDay;</span>
<a href="#l21.532"></a><span id="l21.532" class="difflineminus">-                    } else {</span>
<a href="#l21.533"></a><span id="l21.533" class="difflineminus">-                        let date = now();</span>
<a href="#l21.534"></a><span id="l21.534" class="difflineminus">-                        this.goToDay(date);</span>
<a href="#l21.535"></a><span id="l21.535" class="difflineminus">-                        this.selectedDay = date;</span>
<a href="#l21.536"></a><span id="l21.536" class="difflineminus">-                    }</span>
<a href="#l21.537"></a><span id="l21.537" class="difflineminus">-                ]]&gt;&lt;/body&gt;</span>
<a href="#l21.538"></a><span id="l21.538" class="difflineminus">-            &lt;/method&gt;</span>
<a href="#l21.539"></a><span id="l21.539" class="difflineminus">-        &lt;/implementation&gt;</span>
<a href="#l21.540"></a><span id="l21.540" class="difflineminus">-    &lt;/binding&gt;</span>
<a href="#l21.541"></a><span id="l21.541" class="difflineplus">+              this.selectedDay = newSelectedDay;</span>
<a href="#l21.542"></a><span id="l21.542" class="difflineplus">+          } else {</span>
<a href="#l21.543"></a><span id="l21.543" class="difflineplus">+              let date = now();</span>
<a href="#l21.544"></a><span id="l21.544" class="difflineplus">+              this.goToDay(date);</span>
<a href="#l21.545"></a><span id="l21.545" class="difflineplus">+              this.selectedDay = date;</span>
<a href="#l21.546"></a><span id="l21.546" class="difflineplus">+          }</span>
<a href="#l21.547"></a><span id="l21.547" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l21.548"></a><span id="l21.548" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l21.549"></a><span id="l21.549" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l21.550"></a><span id="l21.550" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l21.551"></a><span id="l21.551"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -235,19 +235,19 @@ function matchCustomReminderToMenuitem(r</span>
<a href="#l22.4"></a><span id="l22.4">         // If the time duration for offset is 0, means the reminder is '0 minutes before'</span>
<a href="#l22.5"></a><span id="l22.5">         if (reminder.offset.inSeconds == 0 || reminder.offset.isNegative) {</span>
<a href="#l22.6"></a><span id="l22.6">             origin = &quot;before&quot;;</span>
<a href="#l22.7"></a><span id="l22.7">         } else {</span>
<a href="#l22.8"></a><span id="l22.8">             origin = &quot;after&quot;;</span>
<a href="#l22.9"></a><span id="l22.9">         }</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11">         let unitMap = {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-          days: 86400,</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-          hours: 3600,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-          minutes: 60</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+            days: 86400,</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+            hours: 3600,</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+            minutes: 60</span>
<a href="#l22.18"></a><span id="l22.18">         };</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">         for (let menuitem of reminderPopup.childNodes) {</span>
<a href="#l22.21"></a><span id="l22.21">             if (menuitem.localName == &quot;menuitem&quot; &amp;&amp;</span>
<a href="#l22.22"></a><span id="l22.22">                 menuitem.hasAttribute(&quot;length&quot;) &amp;&amp;</span>
<a href="#l22.23"></a><span id="l22.23">                 menuitem.getAttribute(&quot;origin&quot;) == origin &amp;&amp;</span>
<a href="#l22.24"></a><span id="l22.24">                 menuitem.getAttribute(&quot;relation&quot;) == relation) {</span>
<a href="#l22.25"></a><span id="l22.25">                 let unitMult = unitMap[menuitem.getAttribute(&quot;unit&quot;)] || 1;</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineat">@@ -347,17 +347,17 @@ function saveReminder(item) {</span>
<a href="#l22.27"></a><span id="l22.27">         if (ics in oldAlarmMap) {</span>
<a href="#l22.28"></a><span id="l22.28">             // The new alarm is also in the old set, remember this</span>
<a href="#l22.29"></a><span id="l22.29">             delete oldAlarmMap[ics];</span>
<a href="#l22.30"></a><span id="l22.30">         } else {</span>
<a href="#l22.31"></a><span id="l22.31">             // The new alarm is not in the old set, this means the alarms</span>
<a href="#l22.32"></a><span id="l22.32">             // differ and we can break out.</span>
<a href="#l22.33"></a><span id="l22.33">             oldAlarmMap[ics] = true;</span>
<a href="#l22.34"></a><span id="l22.34">             break;</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">-       }</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+        }</span>
<a href="#l22.37"></a><span id="l22.37">     }</span>
<a href="#l22.38"></a><span id="l22.38"> </span>
<a href="#l22.39"></a><span id="l22.39">     // If the alarms differ, clear the snooze/dismiss properties</span>
<a href="#l22.40"></a><span id="l22.40">     if (Object.keys(oldAlarmMap).length &gt; 0) {</span>
<a href="#l22.41"></a><span id="l22.41">         let cmp = &quot;X-MOZ-SNOOZE-TIME&quot;;</span>
<a href="#l22.42"></a><span id="l22.42"> </span>
<a href="#l22.43"></a><span id="l22.43">         // Recurring item alarms potentially have more snooze props, remove them</span>
<a href="#l22.44"></a><span id="l22.44">         // all.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -788,17 +788,17 @@ function applyCurrentZoomFactor() {</span>
<a href="#l23.4"></a><span id="l23.4"> /**</span>
<a href="#l23.5"></a><span id="l23.5">  * Force the time grid to show 24 hours.</span>
<a href="#l23.6"></a><span id="l23.6">  *</span>
<a href="#l23.7"></a><span id="l23.7">  * @param aValue        If true, the view will be forced to 24 hours.</span>
<a href="#l23.8"></a><span id="l23.8">  * @return              aValue (for chaining)</span>
<a href="#l23.9"></a><span id="l23.9">  */</span>
<a href="#l23.10"></a><span id="l23.10"> function setForce24Hours(aValue) {</span>
<a href="#l23.11"></a><span id="l23.11">     if (gForce24Hours == aValue) {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-      return aValue;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+        return aValue;</span>
<a href="#l23.14"></a><span id="l23.14">     }</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16">     gForce24Hours = aValue;</span>
<a href="#l23.17"></a><span id="l23.17">     initTimeRange();</span>
<a href="#l23.18"></a><span id="l23.18">     let timebar = document.getElementById(&quot;timebar&quot;);</span>
<a href="#l23.19"></a><span id="l23.19">     timebar.force24Hours = gForce24Hours;</span>
<a href="#l23.20"></a><span id="l23.20">     let selectionbar = document.getElementById(&quot;selection-bar&quot;);</span>
<a href="#l23.21"></a><span id="l23.21">     selectionbar.force24Hours = gForce24Hours;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -243,18 +243,18 @@</span>
<a href="#l24.4"></a><span id="l24.4">           }</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">           // trim spaces if any</span>
<a href="#l24.7"></a><span id="l24.7">           inputValue = inputValue.trim();</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9">           // don't set value with null, otherwise autocomplete stops working,</span>
<a href="#l24.10"></a><span id="l24.10">           // but make sure attendee and dirty are set</span>
<a href="#l24.11"></a><span id="l24.11">           if (inputValue.length) {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-	          input.setAttribute(&quot;value&quot;, inputValue);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-	          input.value = inputValue;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+              input.setAttribute(&quot;value&quot;, inputValue);</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+              input.value = inputValue;</span>
<a href="#l24.16"></a><span id="l24.16">           }</span>
<a href="#l24.17"></a><span id="l24.17">           input.attendee = aAttendee;</span>
<a href="#l24.18"></a><span id="l24.18">           input.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">           if (aAttendee) {</span>
<a href="#l24.21"></a><span id="l24.21">               // Set up userType</span>
<a href="#l24.22"></a><span id="l24.22">               setElementValue(userTypeIcon, aAttendee.userType || false, &quot;cutype&quot;);</span>
<a href="#l24.23"></a><span id="l24.23">               this.updateTooltip(userTypeIcon);</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineat">@@ -455,79 +455,79 @@</span>
<a href="#l24.25"></a><span id="l24.25">     &lt;/method&gt;</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27">     &lt;method name=&quot;_findListInAddrBooks&quot;&gt;</span>
<a href="#l24.28"></a><span id="l24.28">         &lt;parameter name=&quot;entryname&quot;/&gt;</span>
<a href="#l24.29"></a><span id="l24.29">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l24.30"></a><span id="l24.30">             let allAddressBooks = MailServices.ab.directories;</span>
<a href="#l24.31"></a><span id="l24.31"> </span>
<a href="#l24.32"></a><span id="l24.32">             while (allAddressBooks.hasMoreElements()) {</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-              let abDir = null;</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-              try {</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-                abDir = allAddressBooks.getNext()</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-                                  .QueryInterface(Components.interfaces.nsIAbDirectory);</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-              } catch (ex) {</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-                cal.WARN(&quot;[eventDialog] Error Encountered&quot; + ex);</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-              }</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+                let abDir = null;</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+                try {</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+                    abDir = allAddressBooks.getNext()</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+                                           .QueryInterface(Components.interfaces.nsIAbDirectory);</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+                } catch (ex) {</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+                    cal.WARN(&quot;[eventDialog] Error Encountered&quot; + ex);</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+                }</span>
<a href="#l24.47"></a><span id="l24.47"> </span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-              if (abDir != null &amp;&amp; abDir.supportsMailingLists) {</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-                let childNodes = abDir.childNodes;</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-                while (childNodes.hasMoreElements()) {</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-                  let dir = null;</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-                  try {</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-                    dir = childNodes.getNext().QueryInterface(Components.interfaces.nsIAbDirectory);</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-                  } catch (ex) {</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-                    cal.WARN(&quot;[eventDialog] Error Encountered&quot; + ex);</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-                  }</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineplus">+                if (abDir != null &amp;&amp; abDir.supportsMailingLists) {</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+                    let childNodes = abDir.childNodes;</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+                    while (childNodes.hasMoreElements()) {</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+                        let dir = null;</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+                        try {</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+                            dir = childNodes.getNext().QueryInterface(Components.interfaces.nsIAbDirectory);</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineplus">+                        } catch (ex) {</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineplus">+                            cal.WARN(&quot;[eventDialog] Error Encountered&quot; + ex);</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineplus">+                        }</span>
<a href="#l24.66"></a><span id="l24.66"> </span>
<a href="#l24.67"></a><span id="l24.67" class="difflineminus">-                  if (dir &amp;&amp; dir.isMailList &amp;&amp; (dir.dirName == entryname)) {</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineminus">-                    return dir;</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-                  }</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+                        if (dir &amp;&amp; dir.isMailList &amp;&amp; (dir.dirName == entryname)) {</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineplus">+                            return dir;</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+                        }</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineplus">+                    }</span>
<a href="#l24.74"></a><span id="l24.74">                 }</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineminus">-              }</span>
<a href="#l24.76"></a><span id="l24.76">             }</span>
<a href="#l24.77"></a><span id="l24.77">             return null;</span>
<a href="#l24.78"></a><span id="l24.78">         ]]&gt;&lt;/body&gt;</span>
<a href="#l24.79"></a><span id="l24.79">     &lt;/method&gt;</span>
<a href="#l24.80"></a><span id="l24.80"> </span>
<a href="#l24.81"></a><span id="l24.81">     &lt;method name=&quot;_getListEntriesInt&quot;&gt;</span>
<a href="#l24.82"></a><span id="l24.82">         &lt;parameter name=&quot;mailingList&quot;/&gt;</span>
<a href="#l24.83"></a><span id="l24.83">         &lt;parameter name=&quot;attendees&quot;/&gt;</span>
<a href="#l24.84"></a><span id="l24.84">         &lt;parameter name=&quot;allListsUri&quot;/&gt;</span>
<a href="#l24.85"></a><span id="l24.85">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l24.86"></a><span id="l24.86">             let addressLists = mailingList.addressLists;</span>
<a href="#l24.87"></a><span id="l24.87">             for (let i = 0; i &lt; addressLists.length; i++) {</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineminus">-              let abCard = addressLists.queryElementAt(i, Components.interfaces.nsIAbCard);</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineminus">-              let thisId = abCard.primaryEmail;</span>
<a href="#l24.90"></a><span id="l24.90" class="difflineminus">-              if (abCard.displayName.length &gt; 0) {</span>
<a href="#l24.91"></a><span id="l24.91" class="difflineminus">-                  let rCn = abCard.displayName;</span>
<a href="#l24.92"></a><span id="l24.92" class="difflineminus">-                  if (rCn.includes(&quot;,&quot;)) {</span>
<a href="#l24.93"></a><span id="l24.93" class="difflineminus">-                      rCn = '&quot;' + rCn + '&quot;';</span>
<a href="#l24.94"></a><span id="l24.94" class="difflineminus">-                  }</span>
<a href="#l24.95"></a><span id="l24.95" class="difflineminus">-                  thisId = rCn + &quot; &lt;&quot; + thisId + &quot;&gt;&quot;;</span>
<a href="#l24.96"></a><span id="l24.96" class="difflineminus">-              }</span>
<a href="#l24.97"></a><span id="l24.97" class="difflineminus">-              if (attendees.some(att =&gt; att == thisId)) {</span>
<a href="#l24.98"></a><span id="l24.98" class="difflineminus">-                continue;</span>
<a href="#l24.99"></a><span id="l24.99" class="difflineminus">-              }</span>
<a href="#l24.100"></a><span id="l24.100" class="difflineplus">+                let abCard = addressLists.queryElementAt(i, Components.interfaces.nsIAbCard);</span>
<a href="#l24.101"></a><span id="l24.101" class="difflineplus">+                let thisId = abCard.primaryEmail;</span>
<a href="#l24.102"></a><span id="l24.102" class="difflineplus">+                if (abCard.displayName.length &gt; 0) {</span>
<a href="#l24.103"></a><span id="l24.103" class="difflineplus">+                    let rCn = abCard.displayName;</span>
<a href="#l24.104"></a><span id="l24.104" class="difflineplus">+                    if (rCn.includes(&quot;,&quot;)) {</span>
<a href="#l24.105"></a><span id="l24.105" class="difflineplus">+                        rCn = '&quot;' + rCn + '&quot;';</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineplus">+                    }</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineplus">+                    thisId = rCn + &quot; &lt;&quot; + thisId + &quot;&gt;&quot;;</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineplus">+                }</span>
<a href="#l24.109"></a><span id="l24.109" class="difflineplus">+                if (attendees.some(att =&gt; att == thisId)) {</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineplus">+                    continue;</span>
<a href="#l24.111"></a><span id="l24.111" class="difflineplus">+                }</span>
<a href="#l24.112"></a><span id="l24.112"> </span>
<a href="#l24.113"></a><span id="l24.113" class="difflineminus">-              if (abCard.displayName.length &gt; 0) {</span>
<a href="#l24.114"></a><span id="l24.114" class="difflineminus">-                let list = this._findListInAddrBooks(abCard.displayName);</span>
<a href="#l24.115"></a><span id="l24.115" class="difflineminus">-                if (list) {</span>
<a href="#l24.116"></a><span id="l24.116" class="difflineminus">-                  if (allListsUri.some(uri =&gt; uri == list.URI)) {</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineminus">-                    continue;</span>
<a href="#l24.118"></a><span id="l24.118" class="difflineminus">-                  }</span>
<a href="#l24.119"></a><span id="l24.119" class="difflineminus">-                  allListsUri.push(list.URI);</span>
<a href="#l24.120"></a><span id="l24.120" class="difflineplus">+                if (abCard.displayName.length &gt; 0) {</span>
<a href="#l24.121"></a><span id="l24.121" class="difflineplus">+                    let list = this._findListInAddrBooks(abCard.displayName);</span>
<a href="#l24.122"></a><span id="l24.122" class="difflineplus">+                    if (list) {</span>
<a href="#l24.123"></a><span id="l24.123" class="difflineplus">+                        if (allListsUri.some(uri =&gt; uri == list.URI)) {</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineplus">+                            continue;</span>
<a href="#l24.125"></a><span id="l24.125" class="difflineplus">+                        }</span>
<a href="#l24.126"></a><span id="l24.126" class="difflineplus">+                        allListsUri.push(list.URI);</span>
<a href="#l24.127"></a><span id="l24.127"> </span>
<a href="#l24.128"></a><span id="l24.128" class="difflineminus">-                  this._getListEntriesInt(list, attendees, allListsUri);</span>
<a href="#l24.129"></a><span id="l24.129" class="difflineplus">+                        this._getListEntriesInt(list, attendees, allListsUri);</span>
<a href="#l24.130"></a><span id="l24.130"> </span>
<a href="#l24.131"></a><span id="l24.131" class="difflineminus">-                  continue;</span>
<a href="#l24.132"></a><span id="l24.132" class="difflineplus">+                        continue;</span>
<a href="#l24.133"></a><span id="l24.133" class="difflineplus">+                    }</span>
<a href="#l24.134"></a><span id="l24.134">                 }</span>
<a href="#l24.135"></a><span id="l24.135" class="difflineminus">-              }</span>
<a href="#l24.136"></a><span id="l24.136"> </span>
<a href="#l24.137"></a><span id="l24.137" class="difflineminus">-              attendees.push(thisId);</span>
<a href="#l24.138"></a><span id="l24.138" class="difflineplus">+                attendees.push(thisId);</span>
<a href="#l24.139"></a><span id="l24.139">             }</span>
<a href="#l24.140"></a><span id="l24.140"> </span>
<a href="#l24.141"></a><span id="l24.141">             return attendees;</span>
<a href="#l24.142"></a><span id="l24.142">           ]]&gt;&lt;/body&gt;</span>
<a href="#l24.143"></a><span id="l24.143">     &lt;/method&gt;</span>
<a href="#l24.144"></a><span id="l24.144"> </span>
<a href="#l24.145"></a><span id="l24.145">     &lt;method name=&quot;_getListEntries&quot;&gt;</span>
<a href="#l24.146"></a><span id="l24.146">         &lt;parameter name=&quot;mailingList&quot;/&gt;</span>
<a href="#l24.147"></a><span id="l24.147" class="difflineat">@@ -572,54 +572,54 @@</span>
<a href="#l24.148"></a><span id="l24.148">             let userTypeIcon = document.getAnonymousElementByAttribute(listitem, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l24.149"></a><span id="l24.149">             userTypeIcon.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l24.150"></a><span id="l24.150">             userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + rowNumber);</span>
<a href="#l24.151"></a><span id="l24.151">             userTypeIcon.setAttribute(&quot;cutype&quot;, newAttendee.userType);</span>
<a href="#l24.152"></a><span id="l24.152">           ]]&gt;&lt;/body&gt;</span>
<a href="#l24.153"></a><span id="l24.153">     &lt;/method&gt;</span>
<a href="#l24.154"></a><span id="l24.154"> </span>
<a href="#l24.155"></a><span id="l24.155">     &lt;method name=&quot;resolvePotentialList&quot;&gt;</span>
<a href="#l24.156"></a><span id="l24.156" class="difflineminus">-        &lt;parameter name=&quot;aInput&quot;/&gt;</span>
<a href="#l24.157"></a><span id="l24.157" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l24.158"></a><span id="l24.158" class="difflineminus">-            let fieldValue = aInput.value;</span>
<a href="#l24.159"></a><span id="l24.159" class="difflineminus">-            if (aInput.id.length &gt; 0 &amp;&amp; fieldValue.length &gt; 0) {</span>
<a href="#l24.160"></a><span id="l24.160" class="difflineminus">-                let mailingList = this._resolveListByName(fieldValue);</span>
<a href="#l24.161"></a><span id="l24.161" class="difflineminus">-                if (mailingList) {</span>
<a href="#l24.162"></a><span id="l24.162" class="difflineminus">-                    let entries = this._getListEntries(mailingList);</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineminus">-                      if (entries.length &gt; 0) {</span>
<a href="#l24.164"></a><span id="l24.164" class="difflineminus">-                          let currentIndex = parseInt(aInput.id.substr(13), 10);</span>
<a href="#l24.165"></a><span id="l24.165" class="difflineminus">-                          let template = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineminus">-                          let currentNode = template.parentNode.childNodes[currentIndex];</span>
<a href="#l24.167"></a><span id="l24.167" class="difflineminus">-                          this._fillListItemWithEntry(currentNode, entries[0], currentIndex);</span>
<a href="#l24.168"></a><span id="l24.168" class="difflineminus">-                          entries.shift();</span>
<a href="#l24.169"></a><span id="l24.169" class="difflineminus">-                          let nextNode = template.parentNode.childNodes[currentIndex + 1];</span>
<a href="#l24.170"></a><span id="l24.170" class="difflineplus">+      &lt;parameter name=&quot;aInput&quot;/&gt;</span>
<a href="#l24.171"></a><span id="l24.171" class="difflineplus">+      &lt;body&gt;&lt;![CDATA[</span>
<a href="#l24.172"></a><span id="l24.172" class="difflineplus">+          let fieldValue = aInput.value;</span>
<a href="#l24.173"></a><span id="l24.173" class="difflineplus">+          if (aInput.id.length &gt; 0 &amp;&amp; fieldValue.length &gt; 0) {</span>
<a href="#l24.174"></a><span id="l24.174" class="difflineplus">+              let mailingList = this._resolveListByName(fieldValue);</span>
<a href="#l24.175"></a><span id="l24.175" class="difflineplus">+              if (mailingList) {</span>
<a href="#l24.176"></a><span id="l24.176" class="difflineplus">+                  let entries = this._getListEntries(mailingList);</span>
<a href="#l24.177"></a><span id="l24.177" class="difflineplus">+                  if (entries.length &gt; 0) {</span>
<a href="#l24.178"></a><span id="l24.178" class="difflineplus">+                      let currentIndex = parseInt(aInput.id.substr(13), 10);</span>
<a href="#l24.179"></a><span id="l24.179" class="difflineplus">+                      let template = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l24.180"></a><span id="l24.180" class="difflineplus">+                      let currentNode = template.parentNode.childNodes[currentIndex];</span>
<a href="#l24.181"></a><span id="l24.181" class="difflineplus">+                      this._fillListItemWithEntry(currentNode, entries[0], currentIndex);</span>
<a href="#l24.182"></a><span id="l24.182" class="difflineplus">+                      entries.shift();</span>
<a href="#l24.183"></a><span id="l24.183" class="difflineplus">+                      let nextNode = template.parentNode.childNodes[currentIndex + 1];</span>
<a href="#l24.184"></a><span id="l24.184" class="difflineplus">+                      currentIndex++;</span>
<a href="#l24.185"></a><span id="l24.185" class="difflineplus">+                      for (let entry of entries) {</span>
<a href="#l24.186"></a><span id="l24.186" class="difflineplus">+                          currentNode = template.cloneNode(true);</span>
<a href="#l24.187"></a><span id="l24.187" class="difflineplus">+                          template.parentNode.insertBefore(currentNode, nextNode);</span>
<a href="#l24.188"></a><span id="l24.188" class="difflineplus">+                          this._fillListItemWithEntry(currentNode, entry, currentIndex);</span>
<a href="#l24.189"></a><span id="l24.189">                           currentIndex++;</span>
<a href="#l24.190"></a><span id="l24.190" class="difflineminus">-                          for (let entry of entries) {</span>
<a href="#l24.191"></a><span id="l24.191" class="difflineminus">-                              currentNode = template.cloneNode(true);</span>
<a href="#l24.192"></a><span id="l24.192" class="difflineminus">-                              template.parentNode.insertBefore(currentNode, nextNode);</span>
<a href="#l24.193"></a><span id="l24.193" class="difflineminus">-                              this._fillListItemWithEntry(currentNode, entry, currentIndex);</span>
<a href="#l24.194"></a><span id="l24.194" class="difflineminus">-                              currentIndex++;</span>
<a href="#l24.195"></a><span id="l24.195" class="difflineminus">-                          }</span>
<a href="#l24.196"></a><span id="l24.196" class="difflineminus">-                          this.mMaxAttendees += entries.length;</span>
<a href="#l24.197"></a><span id="l24.197" class="difflineminus">-                          for (let i = currentIndex; i &lt;= this.mMaxAttendees; i++) {</span>
<a href="#l24.198"></a><span id="l24.198" class="difflineminus">-                              let row = template.parentNode.childNodes[i];</span>
<a href="#l24.199"></a><span id="l24.199" class="difflineminus">-                              let roleStatusIcon = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;rolestatus-icon&quot;);</span>
<a href="#l24.200"></a><span id="l24.200" class="difflineminus">-                              roleStatusIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol1#&quot; + i);</span>
<a href="#l24.201"></a><span id="l24.201" class="difflineplus">+                      }</span>
<a href="#l24.202"></a><span id="l24.202" class="difflineplus">+                      this.mMaxAttendees += entries.length;</span>
<a href="#l24.203"></a><span id="l24.203" class="difflineplus">+                      for (let i = currentIndex; i &lt;= this.mMaxAttendees; i++) {</span>
<a href="#l24.204"></a><span id="l24.204" class="difflineplus">+                          let row = template.parentNode.childNodes[i];</span>
<a href="#l24.205"></a><span id="l24.205" class="difflineplus">+                          let roleStatusIcon = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;rolestatus-icon&quot;);</span>
<a href="#l24.206"></a><span id="l24.206" class="difflineplus">+                          roleStatusIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol1#&quot; + i);</span>
<a href="#l24.207"></a><span id="l24.207"> </span>
<a href="#l24.208"></a><span id="l24.208" class="difflineminus">-                              let userTypeIcon = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l24.209"></a><span id="l24.209" class="difflineminus">-                              userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + i);</span>
<a href="#l24.210"></a><span id="l24.210" class="difflineplus">+                          let userTypeIcon = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l24.211"></a><span id="l24.211" class="difflineplus">+                          userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + i);</span>
<a href="#l24.212"></a><span id="l24.212"> </span>
<a href="#l24.213"></a><span id="l24.213" class="difflineminus">-                              let input = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l24.214"></a><span id="l24.214" class="difflineminus">-                              input.setAttribute(&quot;id&quot;, &quot;attendeeCol3#&quot; + i);</span>
<a href="#l24.215"></a><span id="l24.215" class="difflineminus">-                              input.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l24.216"></a><span id="l24.216" class="difflineminus">-                          }</span>
<a href="#l24.217"></a><span id="l24.217" class="difflineplus">+                          let input = document.getAnonymousElementByAttribute(row, &quot;anonid&quot;, &quot;input&quot;);</span>
<a href="#l24.218"></a><span id="l24.218" class="difflineplus">+                          input.setAttribute(&quot;id&quot;, &quot;attendeeCol3#&quot; + i);</span>
<a href="#l24.219"></a><span id="l24.219" class="difflineplus">+                          input.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l24.220"></a><span id="l24.220">                       }</span>
<a href="#l24.221"></a><span id="l24.221">                   }</span>
<a href="#l24.222"></a><span id="l24.222">               }</span>
<a href="#l24.223"></a><span id="l24.223" class="difflineminus">-            ]]&gt;&lt;/body&gt;</span>
<a href="#l24.224"></a><span id="l24.224" class="difflineplus">+          }</span>
<a href="#l24.225"></a><span id="l24.225" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l24.226"></a><span id="l24.226">       &lt;/method&gt;</span>
<a href="#l24.227"></a><span id="l24.227"> </span>
<a href="#l24.228"></a><span id="l24.228">       &lt;method name=&quot;onModify&quot;&gt;</span>
<a href="#l24.229"></a><span id="l24.229">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l24.230"></a><span id="l24.230">           let list = [];</span>
<a href="#l24.231"></a><span id="l24.231">           for (let i = 1; i &lt;= this.mMaxAttendees; i++) {</span>
<a href="#l24.232"></a><span id="l24.232">               // retrieve the string from the appropriate row</span>
<a href="#l24.233"></a><span id="l24.233">               let input = this.getInputElement(i);</span>
<a href="#l24.234"></a><span id="l24.234" class="difflineat">@@ -652,20 +652,20 @@</span>
<a href="#l24.235"></a><span id="l24.235">       &lt;parameter name=&quot;targetIcon&quot;/&gt;</span>
<a href="#l24.236"></a><span id="l24.236">       &lt;body&gt;&lt;![CDATA[</span>
<a href="#l24.237"></a><span id="l24.237">         // Function setting the tooltip of attendeeicons based on their role</span>
<a href="#l24.238"></a><span id="l24.238">         if (targetIcon.className == &quot;role-icon&quot;) {</span>
<a href="#l24.239"></a><span id="l24.239">             let role = targetIcon.getAttribute(&quot;role&quot;);</span>
<a href="#l24.240"></a><span id="l24.240">             // Set tooltip for rolenames</span>
<a href="#l24.241"></a><span id="l24.241"> </span>
<a href="#l24.242"></a><span id="l24.242">             const roleMap = {</span>
<a href="#l24.243"></a><span id="l24.243" class="difflineminus">-              &quot;REQ-PARTICIPANT&quot;: &quot;required&quot;,</span>
<a href="#l24.244"></a><span id="l24.244" class="difflineminus">-              &quot;OPT-PARTICIPANT&quot;: &quot;optional&quot;,</span>
<a href="#l24.245"></a><span id="l24.245" class="difflineminus">-              &quot;NON-PARTICIPANT&quot;: &quot;nonparticipant&quot;,</span>
<a href="#l24.246"></a><span id="l24.246" class="difflineminus">-              &quot;CHAIR&quot;: &quot;chair&quot;</span>
<a href="#l24.247"></a><span id="l24.247" class="difflineplus">+                &quot;REQ-PARTICIPANT&quot;: &quot;required&quot;,</span>
<a href="#l24.248"></a><span id="l24.248" class="difflineplus">+                &quot;OPT-PARTICIPANT&quot;: &quot;optional&quot;,</span>
<a href="#l24.249"></a><span id="l24.249" class="difflineplus">+                &quot;NON-PARTICIPANT&quot;: &quot;nonparticipant&quot;,</span>
<a href="#l24.250"></a><span id="l24.250" class="difflineplus">+                &quot;CHAIR&quot;: &quot;chair&quot;</span>
<a href="#l24.251"></a><span id="l24.251">             };</span>
<a href="#l24.252"></a><span id="l24.252"> </span>
<a href="#l24.253"></a><span id="l24.253">             let roleNameString = &quot;event.attendee.role.&quot; + (role in roleMap ? roleMap[role] : &quot;unknown&quot;);</span>
<a href="#l24.254"></a><span id="l24.254">             let tooltip = cal.calGetString(&quot;calendar-event-dialog-attendees&quot;,</span>
<a href="#l24.255"></a><span id="l24.255">                                            roleNameString,</span>
<a href="#l24.256"></a><span id="l24.256">                                            role in roleMap ? null : [role]);</span>
<a href="#l24.257"></a><span id="l24.257">             targetIcon.setAttribute(&quot;tooltiptext&quot;, tooltip);</span>
<a href="#l24.258"></a><span id="l24.258">         } else if (targetIcon.className == &quot;usertype-icon&quot;) {</span>
<a href="#l24.259"></a><span id="l24.259" class="difflineat">@@ -865,19 +865,19 @@</span>
<a href="#l24.260"></a><span id="l24.260"> </span>
<a href="#l24.261"></a><span id="l24.261">       &lt;method name=&quot;setFocus&quot;&gt;</span>
<a href="#l24.262"></a><span id="l24.262">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l24.263"></a><span id="l24.263">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l24.264"></a><span id="l24.264">           let self = this;</span>
<a href="#l24.265"></a><span id="l24.265">           let set_focus = function() {</span>
<a href="#l24.266"></a><span id="l24.266">               let node;</span>
<a href="#l24.267"></a><span id="l24.267">               if (typeof aRow == &quot;number&quot;) {</span>
<a href="#l24.268"></a><span id="l24.268" class="difflineminus">-                node = self.getListItem(aRow);</span>
<a href="#l24.269"></a><span id="l24.269" class="difflineplus">+                  node = self.getListItem(aRow);</span>
<a href="#l24.270"></a><span id="l24.270">               } else {</span>
<a href="#l24.271"></a><span id="l24.271" class="difflineminus">-                node = aRow;</span>
<a href="#l24.272"></a><span id="l24.272" class="difflineplus">+                  node = aRow;</span>
<a href="#l24.273"></a><span id="l24.273">               }</span>
<a href="#l24.274"></a><span id="l24.274"> </span>
<a href="#l24.275"></a><span id="l24.275">               // do we need to scroll in order to see the selected row?</span>
<a href="#l24.276"></a><span id="l24.276">               let listbox =</span>
<a href="#l24.277"></a><span id="l24.277">                   document.getAnonymousElementByAttribute(</span>
<a href="#l24.278"></a><span id="l24.278">                       self, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l24.279"></a><span id="l24.279">               let firstVisibleRow = listbox.getIndexOfFirstVisibleRow();</span>
<a href="#l24.280"></a><span id="l24.280">               let numOfVisibleRows = listbox.getNumberOfVisibleRows();</span>
<a href="#l24.281"></a><span id="l24.281" class="difflineat">@@ -1321,19 +1321,19 @@</span>
<a href="#l24.282"></a><span id="l24.282">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l24.283"></a><span id="l24.283">           return this.mEndDate;</span>
<a href="#l24.284"></a><span id="l24.284">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l24.285"></a><span id="l24.285">       &lt;/property&gt;</span>
<a href="#l24.286"></a><span id="l24.286"> </span>
<a href="#l24.287"></a><span id="l24.287">       &lt;property name=&quot;leftdragWidth&quot;&gt;</span>
<a href="#l24.288"></a><span id="l24.288">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l24.289"></a><span id="l24.289">           if (!this.mLeftBox) {</span>
<a href="#l24.290"></a><span id="l24.290" class="difflineminus">-            this.mLeftBox =</span>
<a href="#l24.291"></a><span id="l24.291" class="difflineminus">-                document.getAnonymousElementByAttribute(</span>
<a href="#l24.292"></a><span id="l24.292" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;leftbox&quot;);</span>
<a href="#l24.293"></a><span id="l24.293" class="difflineplus">+              this.mLeftBox =</span>
<a href="#l24.294"></a><span id="l24.294" class="difflineplus">+                  document.getAnonymousElementByAttribute(</span>
<a href="#l24.295"></a><span id="l24.295" class="difflineplus">+                      this, &quot;anonid&quot;, &quot;leftbox&quot;);</span>
<a href="#l24.296"></a><span id="l24.296">           }</span>
<a href="#l24.297"></a><span id="l24.297">           return this.mLeftBox.boxObject.width;</span>
<a href="#l24.298"></a><span id="l24.298">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l24.299"></a><span id="l24.299">       &lt;/property&gt;</span>
<a href="#l24.300"></a><span id="l24.300">       &lt;property name=&quot;rightdragWidth&quot;&gt;</span>
<a href="#l24.301"></a><span id="l24.301">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l24.302"></a><span id="l24.302">           if (!this.mRightBox) {</span>
<a href="#l24.303"></a><span id="l24.303">               this.mRightBox =</span>
<a href="#l24.304"></a><span id="l24.304" class="difflineat">@@ -1595,10 +1595,9 @@</span>
<a href="#l24.305"></a><span id="l24.305">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l24.306"></a><span id="l24.306"> </span>
<a href="#l24.307"></a><span id="l24.307">       &lt;handler event=&quot;mouseup&quot;&gt;&lt;![CDATA[</span>
<a href="#l24.308"></a><span id="l24.308">         this.mDragState = 0;</span>
<a href="#l24.309"></a><span id="l24.309">         window.setCursor(&quot;auto&quot;);</span>
<a href="#l24.310"></a><span id="l24.310">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l24.311"></a><span id="l24.311">     &lt;/handlers&gt;</span>
<a href="#l24.312"></a><span id="l24.312">   &lt;/binding&gt;</span>
<a href="#l24.313"></a><span id="l24.313" class="difflineminus">-</span>
<a href="#l24.314"></a><span id="l24.314"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -298,17 +298,17 @@</span>
<a href="#l25.4"></a><span id="l25.4">           this.initTimeRange();</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">           let template =</span>
<a href="#l25.7"></a><span id="l25.7">               document.getAnonymousElementByAttribute(</span>
<a href="#l25.8"></a><span id="l25.8">                   this, &quot;anonid&quot;, &quot;template&quot;);</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10">           let parent = template.parentNode;</span>
<a href="#l25.11"></a><span id="l25.11">           while (parent.childNodes.length &gt; 1) {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-            parent.lastChild.remove();</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+              parent.lastChild.remove();</span>
<a href="#l25.14"></a><span id="l25.14">           }</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">           template.force24Hours = this.mForce24Hours;</span>
<a href="#l25.17"></a><span id="l25.17">           template.zoomFactor = this.mZoomFactor;</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19">           this.onLoad();</span>
<a href="#l25.20"></a><span id="l25.20"> </span>
<a href="#l25.21"></a><span id="l25.21">           return val;</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -913,47 +913,47 @@</span>
<a href="#l25.23"></a><span id="l25.23">           let duration = aEndTime.subtractDate(aStartTime);</span>
<a href="#l25.24"></a><span id="l25.24">           let newEndTime = newTime.clone();</span>
<a href="#l25.25"></a><span id="l25.25">           newEndTime.addDuration(duration);</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27">           let kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l25.28"></a><span id="l25.28"> </span>
<a href="#l25.29"></a><span id="l25.29">           if (this.mEntries) {</span>
<a href="#l25.30"></a><span id="l25.30">               for (let entry of this.mEntries) {</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-                let rangeStart =</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-                    entry.interval.start.getInTimezone(kDefaultTimezone);</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineminus">-                let rangeEnd =</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-                    entry.interval.end.getInTimezone(kDefaultTimezone);</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+                  let rangeStart =</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+                      entry.interval.start.getInTimezone(kDefaultTimezone);</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+                  let rangeEnd =</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+                      entry.interval.end.getInTimezone(kDefaultTimezone);</span>
<a href="#l25.39"></a><span id="l25.39"> </span>
<a href="#l25.40"></a><span id="l25.40" class="difflineminus">-                let isZeroLength = !newTime.compare(newEndTime);</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineminus">-                if ((isZeroLength &amp;&amp;</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineminus">-                     newTime.compare(rangeStart) &gt;= 0 &amp;&amp;</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineminus">-                     newTime.compare(rangeEnd) &lt; 0) ||</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineminus">-                    (!isZeroLength &amp;&amp;</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineminus">-                     newTime.compare(rangeEnd) &lt; 0 &amp;&amp;</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-                     newEndTime.compare(rangeStart) &gt; 0)) {</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-                    // Current range of event conflicts with another event.</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-                    // we need to find a new time for this event. A trivial approach</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-                    // is to set the new start-time of the event equal to the end-time</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-                    // of the conflict-range. All-day events need to be considered</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineminus">-                    // separately, in which case we skip to the next day.</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineminus">-                    newTime = rangeEnd.clone();</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineminus">-                    if (allDay) {</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineminus">-                        if (!((newTime.hour == 0) &amp;&amp;</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineminus">-                             (newTime.minute == 0) &amp;&amp;</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineminus">-                             (newTime.second == 0))) {</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineminus">-                            newTime.day++;</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineminus">-                            newTime.hour = 0;</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineminus">-                            newTime.minute = 0;</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineminus">-                            newTime.second = 0;</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineminus">-                        }</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineminus">-                    }</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineminus">-                    newEndTime = newTime.clone();</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineminus">-                    newEndTime.addDuration(duration);</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineminus">-                }</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineplus">+                  let isZeroLength = !newTime.compare(newEndTime);</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineplus">+                  if ((isZeroLength &amp;&amp;</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineplus">+                       newTime.compare(rangeStart) &gt;= 0 &amp;&amp;</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+                       newTime.compare(rangeEnd) &lt; 0) ||</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+                      (!isZeroLength &amp;&amp;</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineplus">+                       newTime.compare(rangeEnd) &lt; 0 &amp;&amp;</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineplus">+                       newEndTime.compare(rangeStart) &gt; 0)) {</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineplus">+                      // Current range of event conflicts with another event.</span>
<a href="#l25.74"></a><span id="l25.74" class="difflineplus">+                      // we need to find a new time for this event. A trivial approach</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineplus">+                      // is to set the new start-time of the event equal to the end-time</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineplus">+                      // of the conflict-range. All-day events need to be considered</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineplus">+                      // separately, in which case we skip to the next day.</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+                      newTime = rangeEnd.clone();</span>
<a href="#l25.79"></a><span id="l25.79" class="difflineplus">+                      if (allDay) {</span>
<a href="#l25.80"></a><span id="l25.80" class="difflineplus">+                          if (!((newTime.hour == 0) &amp;&amp;</span>
<a href="#l25.81"></a><span id="l25.81" class="difflineplus">+                               (newTime.minute == 0) &amp;&amp;</span>
<a href="#l25.82"></a><span id="l25.82" class="difflineplus">+                               (newTime.second == 0))) {</span>
<a href="#l25.83"></a><span id="l25.83" class="difflineplus">+                              newTime.day++;</span>
<a href="#l25.84"></a><span id="l25.84" class="difflineplus">+                              newTime.hour = 0;</span>
<a href="#l25.85"></a><span id="l25.85" class="difflineplus">+                              newTime.minute = 0;</span>
<a href="#l25.86"></a><span id="l25.86" class="difflineplus">+                              newTime.second = 0;</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineplus">+                          }</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineplus">+                      }</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineplus">+                      newEndTime = newTime.clone();</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineplus">+                      newEndTime.addDuration(duration);</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineplus">+                  }</span>
<a href="#l25.92"></a><span id="l25.92">               }</span>
<a href="#l25.93"></a><span id="l25.93">           }</span>
<a href="#l25.94"></a><span id="l25.94"> </span>
<a href="#l25.95"></a><span id="l25.95">           return newTime;</span>
<a href="#l25.96"></a><span id="l25.96">         ]]&gt;&lt;/body&gt;</span>
<a href="#l25.97"></a><span id="l25.97">       &lt;/method&gt;</span>
<a href="#l25.98"></a><span id="l25.98"> </span>
<a href="#l25.99"></a><span id="l25.99">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineat">@@ -1344,42 +1344,42 @@</span>
<a href="#l25.101"></a><span id="l25.101">           let recheck;</span>
<a href="#l25.102"></a><span id="l25.102">           do {</span>
<a href="#l25.103"></a><span id="l25.103">               recheck = false;</span>
<a href="#l25.104"></a><span id="l25.104"> </span>
<a href="#l25.105"></a><span id="l25.105">               for (let i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l25.106"></a><span id="l25.106">                   let row = this.getFreeBusyElement(i);</span>
<a href="#l25.107"></a><span id="l25.107">                   let newTime = row.nextSlot(startTime, endTime, allDay);</span>
<a href="#l25.108"></a><span id="l25.108">                   if (newTime) {</span>
<a href="#l25.109"></a><span id="l25.109" class="difflineminus">-                    if (newTime.compare(startTime) != 0) {</span>
<a href="#l25.110"></a><span id="l25.110" class="difflineminus">-                        startTime = newTime;</span>
<a href="#l25.111"></a><span id="l25.111" class="difflineplus">+                      if (newTime.compare(startTime) != 0) {</span>
<a href="#l25.112"></a><span id="l25.112" class="difflineplus">+                          startTime = newTime;</span>
<a href="#l25.113"></a><span id="l25.113"> </span>
<a href="#l25.114"></a><span id="l25.114" class="difflineminus">-                        if (startTime.hour &lt; this.mStartHour) {</span>
<a href="#l25.115"></a><span id="l25.115" class="difflineminus">-                            startTime.hour = this.mStartHour;</span>
<a href="#l25.116"></a><span id="l25.116" class="difflineminus">-                            startTime.minute = 0;</span>
<a href="#l25.117"></a><span id="l25.117" class="difflineminus">-                        }</span>
<a href="#l25.118"></a><span id="l25.118" class="difflineplus">+                          if (startTime.hour &lt; this.mStartHour) {</span>
<a href="#l25.119"></a><span id="l25.119" class="difflineplus">+                              startTime.hour = this.mStartHour;</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineplus">+                              startTime.minute = 0;</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineplus">+                          }</span>
<a href="#l25.122"></a><span id="l25.122"> </span>
<a href="#l25.123"></a><span id="l25.123" class="difflineminus">-                        endTime = startTime.clone();</span>
<a href="#l25.124"></a><span id="l25.124" class="difflineminus">-                        endTime.addDuration(duration);</span>
<a href="#l25.125"></a><span id="l25.125" class="difflineplus">+                          endTime = startTime.clone();</span>
<a href="#l25.126"></a><span id="l25.126" class="difflineplus">+                          endTime.addDuration(duration);</span>
<a href="#l25.127"></a><span id="l25.127"> </span>
<a href="#l25.128"></a><span id="l25.128" class="difflineminus">-                        if (endTime.hour &gt; this.mEndHour) {</span>
<a href="#l25.129"></a><span id="l25.129" class="difflineminus">-                            startTime.day++;</span>
<a href="#l25.130"></a><span id="l25.130" class="difflineminus">-                            startTime.hour = this.mStartHour;</span>
<a href="#l25.131"></a><span id="l25.131" class="difflineminus">-                            startTime.minute = 0;</span>
<a href="#l25.132"></a><span id="l25.132" class="difflineminus">-                            endTime = startTime.clone();</span>
<a href="#l25.133"></a><span id="l25.133" class="difflineminus">-                            endTime.addDuration(duration);</span>
<a href="#l25.134"></a><span id="l25.134" class="difflineminus">-                        }</span>
<a href="#l25.135"></a><span id="l25.135" class="difflineplus">+                          if (endTime.hour &gt; this.mEndHour) {</span>
<a href="#l25.136"></a><span id="l25.136" class="difflineplus">+                              startTime.day++;</span>
<a href="#l25.137"></a><span id="l25.137" class="difflineplus">+                              startTime.hour = this.mStartHour;</span>
<a href="#l25.138"></a><span id="l25.138" class="difflineplus">+                              startTime.minute = 0;</span>
<a href="#l25.139"></a><span id="l25.139" class="difflineplus">+                              endTime = startTime.clone();</span>
<a href="#l25.140"></a><span id="l25.140" class="difflineplus">+                              endTime.addDuration(duration);</span>
<a href="#l25.141"></a><span id="l25.141" class="difflineplus">+                          }</span>
<a href="#l25.142"></a><span id="l25.142"> </span>
<a href="#l25.143"></a><span id="l25.143" class="difflineminus">-                        recheck = true;</span>
<a href="#l25.144"></a><span id="l25.144" class="difflineminus">-                    }</span>
<a href="#l25.145"></a><span id="l25.145" class="difflineminus">-                } else {</span>
<a href="#l25.146"></a><span id="l25.146" class="difflineminus">-                    // A new slot could not be found</span>
<a href="#l25.147"></a><span id="l25.147" class="difflineminus">-                    // and the given time was also invalid.</span>
<a href="#l25.148"></a><span id="l25.148" class="difflineminus">-                    return this.mStartDate.clone();</span>
<a href="#l25.149"></a><span id="l25.149" class="difflineminus">-                }</span>
<a href="#l25.150"></a><span id="l25.150" class="difflineplus">+                          recheck = true;</span>
<a href="#l25.151"></a><span id="l25.151" class="difflineplus">+                      }</span>
<a href="#l25.152"></a><span id="l25.152" class="difflineplus">+                  } else {</span>
<a href="#l25.153"></a><span id="l25.153" class="difflineplus">+                      // A new slot could not be found</span>
<a href="#l25.154"></a><span id="l25.154" class="difflineplus">+                      // and the given time was also invalid.</span>
<a href="#l25.155"></a><span id="l25.155" class="difflineplus">+                      return this.mStartDate.clone();</span>
<a href="#l25.156"></a><span id="l25.156" class="difflineplus">+                  }</span>
<a href="#l25.157"></a><span id="l25.157">               }</span>
<a href="#l25.158"></a><span id="l25.158">           } while (recheck);</span>
<a href="#l25.159"></a><span id="l25.159"> </span>
<a href="#l25.160"></a><span id="l25.160">           // Return the unmodifed startdate of the item</span>
<a href="#l25.161"></a><span id="l25.161">           // in case no possible match was found.</span>
<a href="#l25.162"></a><span id="l25.162">           if (startTime.compare(this.mStartDate) == 0) {</span>
<a href="#l25.163"></a><span id="l25.163">               return this.mStartDate.clone();</span>
<a href="#l25.164"></a><span id="l25.164">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence-preview.xml</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -26,17 +26,16 @@</span>
<a href="#l26.4"></a><span id="l26.4">               &lt;xul:spacer/&gt;</span>
<a href="#l26.5"></a><span id="l26.5">             &lt;/xul:row&gt;</span>
<a href="#l26.6"></a><span id="l26.6">           &lt;/xul:rows&gt;</span>
<a href="#l26.7"></a><span id="l26.7">         &lt;/xul:grid&gt;</span>
<a href="#l26.8"></a><span id="l26.8">       &lt;/xul:box&gt;</span>
<a href="#l26.9"></a><span id="l26.9">     &lt;/content&gt;</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11">     &lt;implementation&gt;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-</span>
<a href="#l26.13"></a><span id="l26.13">       &lt;field name=&quot;mRecurrenceInfo&quot;&gt;null&lt;/field&gt;</span>
<a href="#l26.14"></a><span id="l26.14">       &lt;field name=&quot;mResizeHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l26.15"></a><span id="l26.15">       &lt;field name=&quot;mDateTime&quot;&gt;null&lt;/field&gt;</span>
<a href="#l26.16"></a><span id="l26.16"> </span>
<a href="#l26.17"></a><span id="l26.17">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l26.18"></a><span id="l26.18">         this.mResizeHandler = this.onResize.bind(this);</span>
<a href="#l26.19"></a><span id="l26.19">         window.addEventListener(&quot;resize&quot;, this.mResizeHandler, true);</span>
<a href="#l26.20"></a><span id="l26.20">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineat">@@ -201,42 +200,42 @@</span>
<a href="#l26.22"></a><span id="l26.22">                       let occurrence = null;</span>
<a href="#l26.23"></a><span id="l26.23">                       if (index &lt; dates.length) {</span>
<a href="#l26.24"></a><span id="l26.24">                           occurrence =</span>
<a href="#l26.25"></a><span id="l26.25">                               dates[index++]</span>
<a href="#l26.26"></a><span id="l26.26">                                   .getInTimezone(start.timezone);</span>
<a href="#l26.27"></a><span id="l26.27">                       }</span>
<a href="#l26.28"></a><span id="l26.28">                       let current = start.clone();</span>
<a href="#l26.29"></a><span id="l26.29">                       while (current.compare(end) &lt; 0) {</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-                        let box = minimonth.getBoxForDate(current);</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-                        if (box) {</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-                            if (occurrence &amp;&amp;</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-                                occurrence.day == current.day &amp;&amp;</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-                                occurrence.month == current.month &amp;&amp;</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-                                occurrence.year == current.year) {</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">-                                box.setAttribute(&quot;busy&quot;, 1);</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">-                                if (index &lt; dates.length) {</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-                                    occurrence =</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineminus">-                                        dates[index++]</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineminus">-                                            .getInTimezone(start.timezone);</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-                                    // take into account that the very next occurrence</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-                                    // can happen at the same day as the previous one.</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-                                    if (occurrence.day == current.day &amp;&amp;</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineminus">-                                        occurrence.month == current.month &amp;&amp;</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineminus">-                                        occurrence.year == current.year) {</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineminus">-                                        continue;</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineminus">-                                    }</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineminus">-                                } else {</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineminus">-                                    occurrence = null;</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-                                }</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineminus">-                            } else {</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineminus">-                                box.removeAttribute(&quot;busy&quot;);</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineminus">-                            }</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineminus">-                        }</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineminus">-                        current.day++;</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineplus">+                          let box = minimonth.getBoxForDate(current);</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineplus">+                          if (box) {</span>
<a href="#l26.58"></a><span id="l26.58" class="difflineplus">+                              if (occurrence &amp;&amp;</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineplus">+                                  occurrence.day == current.day &amp;&amp;</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineplus">+                                  occurrence.month == current.month &amp;&amp;</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineplus">+                                  occurrence.year == current.year) {</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+                                  box.setAttribute(&quot;busy&quot;, 1);</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineplus">+                                  if (index &lt; dates.length) {</span>
<a href="#l26.64"></a><span id="l26.64" class="difflineplus">+                                      occurrence =</span>
<a href="#l26.65"></a><span id="l26.65" class="difflineplus">+                                          dates[index++]</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineplus">+                                              .getInTimezone(start.timezone);</span>
<a href="#l26.67"></a><span id="l26.67" class="difflineplus">+                                      // take into account that the very next occurrence</span>
<a href="#l26.68"></a><span id="l26.68" class="difflineplus">+                                      // can happen at the same day as the previous one.</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineplus">+                                      if (occurrence.day == current.day &amp;&amp;</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+                                          occurrence.month == current.month &amp;&amp;</span>
<a href="#l26.71"></a><span id="l26.71" class="difflineplus">+                                          occurrence.year == current.year) {</span>
<a href="#l26.72"></a><span id="l26.72" class="difflineplus">+                                          continue;</span>
<a href="#l26.73"></a><span id="l26.73" class="difflineplus">+                                      }</span>
<a href="#l26.74"></a><span id="l26.74" class="difflineplus">+                                  } else {</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineplus">+                                      occurrence = null;</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineplus">+                                  }</span>
<a href="#l26.77"></a><span id="l26.77" class="difflineplus">+                              } else {</span>
<a href="#l26.78"></a><span id="l26.78" class="difflineplus">+                                  box.removeAttribute(&quot;busy&quot;);</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineplus">+                              }</span>
<a href="#l26.80"></a><span id="l26.80" class="difflineplus">+                          }</span>
<a href="#l26.81"></a><span id="l26.81" class="difflineplus">+                          current.day++;</span>
<a href="#l26.82"></a><span id="l26.82">                       }</span>
<a href="#l26.83"></a><span id="l26.83">                   }</span>
<a href="#l26.84"></a><span id="l26.84">                   start.month++;</span>
<a href="#l26.85"></a><span id="l26.85">                   end.month++;</span>
<a href="#l26.86"></a><span id="l26.86">               }</span>
<a href="#l26.87"></a><span id="l26.87">               row = row.nextSibling;</span>
<a href="#l26.88"></a><span id="l26.88">           }</span>
<a href="#l26.89"></a><span id="l26.89">         ]]&gt;&lt;/body&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -460,17 +460,17 @@ function onChangeCalendar(calendar) {</span>
<a href="#l27.4"></a><span id="l27.4">  * - disable-on-readonly</span>
<a href="#l27.5"></a><span id="l27.5">  *</span>
<a href="#l27.6"></a><span id="l27.6">  * A task without a start time is also considered readonly.</span>
<a href="#l27.7"></a><span id="l27.7">  *</span>
<a href="#l27.8"></a><span id="l27.8">  * @param item        The item to check.</span>
<a href="#l27.9"></a><span id="l27.9">  */</span>
<a href="#l27.10"></a><span id="l27.10"> function disableOrEnable(item) {</span>
<a href="#l27.11"></a><span id="l27.11">     if (item.parentItem != item) {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-       disableRecurrenceFields(&quot;disable-on-occurrence&quot;);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+        disableRecurrenceFields(&quot;disable-on-occurrence&quot;);</span>
<a href="#l27.14"></a><span id="l27.14">     } else if (gIsReadOnly) {</span>
<a href="#l27.15"></a><span id="l27.15">         disableRecurrenceFields(&quot;disable-on-readonly&quot;);</span>
<a href="#l27.16"></a><span id="l27.16">     } else if (isToDo(item) &amp;&amp; !gStartTime) {</span>
<a href="#l27.17"></a><span id="l27.17">         disableRecurrenceFields(&quot;disable-on-readonly&quot;);</span>
<a href="#l27.18"></a><span id="l27.18">     } else {</span>
<a href="#l27.19"></a><span id="l27.19">         enableRecurrenceFields(&quot;disable-on-readonly&quot;);</span>
<a href="#l27.20"></a><span id="l27.20">     }</span>
<a href="#l27.21"></a><span id="l27.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-invitations-list.xml</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-invitations-list.xml</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -65,24 +65,26 @@</span>
<a href="#l28.4"></a><span id="l28.4">     &lt;implementation&gt;</span>
<a href="#l28.5"></a><span id="l28.5">       &lt;!-- fields --&gt;</span>
<a href="#l28.6"></a><span id="l28.6">       &lt;field name=&quot;mDateFormatter&quot;&gt;null&lt;/field&gt;</span>
<a href="#l28.7"></a><span id="l28.7">       &lt;field name=&quot;mCalendarItem&quot;&gt;null&lt;/field&gt;</span>
<a href="#l28.8"></a><span id="l28.8">       &lt;field name=&quot;mInitialParticipationStatus&quot;&gt;null&lt;/field&gt;</span>
<a href="#l28.9"></a><span id="l28.9">       &lt;field name=&quot;mParticipationStatus&quot;&gt;null&lt;/field&gt;</span>
<a href="#l28.10"></a><span id="l28.10"> </span>
<a href="#l28.11"></a><span id="l28.11">       &lt;property name=&quot;mStrings&quot;&gt;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        &lt;getter&gt;return {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-            alldayEvent: &quot;&amp;calendar.invitations.list.alldayevent.text;&quot;,</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-            recurrentEvent: &quot;&amp;calendar.invitations.list.recurrentevent.text;&quot;,</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-            location: &quot;&amp;calendar.invitations.list.location.text;&quot;,</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">-            organizer: &quot;&amp;calendar.invitations.list.organizer.text;&quot;,</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-            attendee: &quot;&amp;calendar.invitations.list.attendee.text;&quot;,</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-            none: &quot;&amp;calendar.invitations.list.none.text;&quot;</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">-        };&lt;/getter&gt;</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+        &lt;getter&gt;</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+          return {</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+              alldayEvent: &quot;&amp;calendar.invitations.list.alldayevent.text;&quot;,</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineplus">+              recurrentEvent: &quot;&amp;calendar.invitations.list.recurrentevent.text;&quot;,</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineplus">+              location: &quot;&amp;calendar.invitations.list.location.text;&quot;,</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineplus">+              organizer: &quot;&amp;calendar.invitations.list.organizer.text;&quot;,</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineplus">+              attendee: &quot;&amp;calendar.invitations.list.attendee.text;&quot;,</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineplus">+              none: &quot;&amp;calendar.invitations.list.none.text;&quot;</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineplus">+          };</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+        &lt;/getter&gt;</span>
<a href="#l28.30"></a><span id="l28.30">       &lt;/property&gt;</span>
<a href="#l28.31"></a><span id="l28.31"> </span>
<a href="#l28.32"></a><span id="l28.32">       &lt;!-- properties --&gt;</span>
<a href="#l28.33"></a><span id="l28.33">       &lt;property name=&quot;calendarItem&quot;&gt;</span>
<a href="#l28.34"></a><span id="l28.34">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l28.35"></a><span id="l28.35">           return this.mCalendarItem;</span>
<a href="#l28.36"></a><span id="l28.36">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l28.37"></a><span id="l28.37">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineat">@@ -119,81 +121,81 @@</span>
<a href="#l28.39"></a><span id="l28.39">         Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l28.40"></a><span id="l28.40">         this.mDateFormatter = getDateFormatter();</span>
<a href="#l28.41"></a><span id="l28.41">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l28.42"></a><span id="l28.42"> </span>
<a href="#l28.43"></a><span id="l28.43">       &lt;!-- methods --&gt;</span>
<a href="#l28.44"></a><span id="l28.44">       &lt;method name=&quot;setCalendarItem&quot;&gt;</span>
<a href="#l28.45"></a><span id="l28.45">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l28.46"></a><span id="l28.46">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l28.47"></a><span id="l28.47" class="difflineminus">-            this.mCalendarItem = aItem;</span>
<a href="#l28.48"></a><span id="l28.48" class="difflineminus">-            this.mInitialParticipationStatus =</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineminus">-                this.getCalendarItemParticipationStatus(aItem);</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-            this.participationStatus = this.mInitialParticipationStatus;</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+          this.mCalendarItem = aItem;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineplus">+          this.mInitialParticipationStatus =</span>
<a href="#l28.53"></a><span id="l28.53" class="difflineplus">+              this.getCalendarItemParticipationStatus(aItem);</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineplus">+          this.participationStatus = this.mInitialParticipationStatus;</span>
<a href="#l28.55"></a><span id="l28.55"> </span>
<a href="#l28.56"></a><span id="l28.56" class="difflineminus">-            let titleLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.57"></a><span id="l28.57" class="difflineminus">-                this, &quot;anonid&quot;, &quot;title&quot;);</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-            titleLabel.setAttribute(&quot;value&quot;, aItem.title);</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineplus">+          let titleLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineplus">+              this, &quot;anonid&quot;, &quot;title&quot;);</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineplus">+          titleLabel.setAttribute(&quot;value&quot;, aItem.title);</span>
<a href="#l28.62"></a><span id="l28.62"> </span>
<a href="#l28.63"></a><span id="l28.63" class="difflineminus">-            let dateLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.64"></a><span id="l28.64" class="difflineminus">-                this, &quot;anonid&quot;, &quot;date&quot;);</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineminus">-            let dateString = this.mDateFormatter.formatItemInterval(aItem);</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineminus">-            if (aItem.startDate.isDate) {</span>
<a href="#l28.67"></a><span id="l28.67" class="difflineminus">-                dateString += &quot;, &quot; + this.mStrings.alldayEvent;</span>
<a href="#l28.68"></a><span id="l28.68" class="difflineminus">-            }</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-            dateLabel.setAttribute(&quot;value&quot;, dateString);</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineplus">+          let dateLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineplus">+              this, &quot;anonid&quot;, &quot;date&quot;);</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineplus">+          let dateString = this.mDateFormatter.formatItemInterval(aItem);</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineplus">+          if (aItem.startDate.isDate) {</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineplus">+              dateString += &quot;, &quot; + this.mStrings.alldayEvent;</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineplus">+          }</span>
<a href="#l28.76"></a><span id="l28.76" class="difflineplus">+          dateLabel.setAttribute(&quot;value&quot;, dateString);</span>
<a href="#l28.77"></a><span id="l28.77"> </span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-            let recurrenceLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineminus">-                this, &quot;anonid&quot;, &quot;recurrence&quot;);</span>
<a href="#l28.80"></a><span id="l28.80" class="difflineminus">-            if (aItem.recurrenceInfo) {</span>
<a href="#l28.81"></a><span id="l28.81" class="difflineminus">-                recurrenceLabel.setAttribute(&quot;value&quot;, this.mStrings.recurrentEvent);</span>
<a href="#l28.82"></a><span id="l28.82" class="difflineminus">-            } else {</span>
<a href="#l28.83"></a><span id="l28.83" class="difflineminus">-                recurrenceLabel.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l28.84"></a><span id="l28.84" class="difflineminus">-                let spacer = document.getAnonymousElementByAttribute(</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-                    this, &quot;anonid&quot;, &quot;spacer&quot;);</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineminus">-                spacer.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l28.87"></a><span id="l28.87" class="difflineminus">-            }</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineplus">+          let recurrenceLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineplus">+              this, &quot;anonid&quot;, &quot;recurrence&quot;);</span>
<a href="#l28.90"></a><span id="l28.90" class="difflineplus">+          if (aItem.recurrenceInfo) {</span>
<a href="#l28.91"></a><span id="l28.91" class="difflineplus">+              recurrenceLabel.setAttribute(&quot;value&quot;, this.mStrings.recurrentEvent);</span>
<a href="#l28.92"></a><span id="l28.92" class="difflineplus">+          } else {</span>
<a href="#l28.93"></a><span id="l28.93" class="difflineplus">+              recurrenceLabel.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l28.94"></a><span id="l28.94" class="difflineplus">+              let spacer = document.getAnonymousElementByAttribute(</span>
<a href="#l28.95"></a><span id="l28.95" class="difflineplus">+                  this, &quot;anonid&quot;, &quot;spacer&quot;);</span>
<a href="#l28.96"></a><span id="l28.96" class="difflineplus">+              spacer.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l28.97"></a><span id="l28.97" class="difflineplus">+          }</span>
<a href="#l28.98"></a><span id="l28.98"> </span>
<a href="#l28.99"></a><span id="l28.99" class="difflineminus">-            let locationLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.100"></a><span id="l28.100" class="difflineminus">-                this, &quot;anonid&quot;, &quot;location&quot;);</span>
<a href="#l28.101"></a><span id="l28.101" class="difflineminus">-            let locationString = this.mStrings.location;</span>
<a href="#l28.102"></a><span id="l28.102" class="difflineminus">-            let locationProperty = aItem.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineminus">-            if (locationProperty &amp;&amp; locationProperty.length &gt; 0) {</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineminus">-                locationString += locationProperty;</span>
<a href="#l28.105"></a><span id="l28.105" class="difflineminus">-            } else {</span>
<a href="#l28.106"></a><span id="l28.106" class="difflineminus">-                locationString += this.mStrings.none;</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-            }</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineminus">-            locationLabel.setAttribute(&quot;value&quot;, locationString);</span>
<a href="#l28.109"></a><span id="l28.109" class="difflineplus">+          let locationLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.110"></a><span id="l28.110" class="difflineplus">+              this, &quot;anonid&quot;, &quot;location&quot;);</span>
<a href="#l28.111"></a><span id="l28.111" class="difflineplus">+          let locationString = this.mStrings.location;</span>
<a href="#l28.112"></a><span id="l28.112" class="difflineplus">+          let locationProperty = aItem.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineplus">+          if (locationProperty &amp;&amp; locationProperty.length &gt; 0) {</span>
<a href="#l28.114"></a><span id="l28.114" class="difflineplus">+              locationString += locationProperty;</span>
<a href="#l28.115"></a><span id="l28.115" class="difflineplus">+          } else {</span>
<a href="#l28.116"></a><span id="l28.116" class="difflineplus">+              locationString += this.mStrings.none;</span>
<a href="#l28.117"></a><span id="l28.117" class="difflineplus">+          }</span>
<a href="#l28.118"></a><span id="l28.118" class="difflineplus">+          locationLabel.setAttribute(&quot;value&quot;, locationString);</span>
<a href="#l28.119"></a><span id="l28.119"> </span>
<a href="#l28.120"></a><span id="l28.120" class="difflineminus">-            let organizerLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.121"></a><span id="l28.121" class="difflineminus">-                this, &quot;anonid&quot;, &quot;organizer&quot;);</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-            let organizerString = this.mStrings.organizer;</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineminus">-            let org = aItem.organizer;</span>
<a href="#l28.124"></a><span id="l28.124" class="difflineminus">-            if (org) {</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-                if (org.commonName &amp;&amp; org.commonName.length &gt; 0) {</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineminus">-                    organizerString += org.commonName;</span>
<a href="#l28.127"></a><span id="l28.127" class="difflineminus">-                } else if (org.id) {</span>
<a href="#l28.128"></a><span id="l28.128" class="difflineminus">-                    organizerString += org.id.replace(/^mailto:/i, &quot;&quot;);</span>
<a href="#l28.129"></a><span id="l28.129" class="difflineminus">-                }</span>
<a href="#l28.130"></a><span id="l28.130" class="difflineminus">-            }</span>
<a href="#l28.131"></a><span id="l28.131" class="difflineminus">-            organizerLabel.setAttribute(&quot;value&quot;, organizerString);</span>
<a href="#l28.132"></a><span id="l28.132" class="difflineplus">+          let organizerLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.133"></a><span id="l28.133" class="difflineplus">+              this, &quot;anonid&quot;, &quot;organizer&quot;);</span>
<a href="#l28.134"></a><span id="l28.134" class="difflineplus">+          let organizerString = this.mStrings.organizer;</span>
<a href="#l28.135"></a><span id="l28.135" class="difflineplus">+          let org = aItem.organizer;</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineplus">+          if (org) {</span>
<a href="#l28.137"></a><span id="l28.137" class="difflineplus">+              if (org.commonName &amp;&amp; org.commonName.length &gt; 0) {</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineplus">+                  organizerString += org.commonName;</span>
<a href="#l28.139"></a><span id="l28.139" class="difflineplus">+              } else if (org.id) {</span>
<a href="#l28.140"></a><span id="l28.140" class="difflineplus">+                  organizerString += org.id.replace(/^mailto:/i, &quot;&quot;);</span>
<a href="#l28.141"></a><span id="l28.141" class="difflineplus">+              }</span>
<a href="#l28.142"></a><span id="l28.142" class="difflineplus">+          }</span>
<a href="#l28.143"></a><span id="l28.143" class="difflineplus">+          organizerLabel.setAttribute(&quot;value&quot;, organizerString);</span>
<a href="#l28.144"></a><span id="l28.144"> </span>
<a href="#l28.145"></a><span id="l28.145" class="difflineminus">-            let attendeeLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.146"></a><span id="l28.146" class="difflineminus">-                this, &quot;anonid&quot;, &quot;attendee&quot;);</span>
<a href="#l28.147"></a><span id="l28.147" class="difflineminus">-            let attendeeString = this.mStrings.attendee;</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineminus">-            let att = cal.getInvitedAttendee(aItem);</span>
<a href="#l28.149"></a><span id="l28.149" class="difflineminus">-            if (att) {</span>
<a href="#l28.150"></a><span id="l28.150" class="difflineminus">-                if (att.commonName &amp;&amp; att.commonName.length &gt; 0) {</span>
<a href="#l28.151"></a><span id="l28.151" class="difflineminus">-                    attendeeString += att.commonName;</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineminus">-                } else if (att.id) {</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineminus">-                    attendeeString += att.id.replace(/^mailto:/i, &quot;&quot;);</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineminus">-                }</span>
<a href="#l28.155"></a><span id="l28.155" class="difflineminus">-            }</span>
<a href="#l28.156"></a><span id="l28.156" class="difflineminus">-            attendeeLabel.setAttribute(&quot;value&quot;, attendeeString);</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineminus">-            this.setAttribute(&quot;itemId&quot;, aItem.hashId);</span>
<a href="#l28.158"></a><span id="l28.158" class="difflineplus">+          let attendeeLabel = document.getAnonymousElementByAttribute(</span>
<a href="#l28.159"></a><span id="l28.159" class="difflineplus">+              this, &quot;anonid&quot;, &quot;attendee&quot;);</span>
<a href="#l28.160"></a><span id="l28.160" class="difflineplus">+          let attendeeString = this.mStrings.attendee;</span>
<a href="#l28.161"></a><span id="l28.161" class="difflineplus">+          let att = cal.getInvitedAttendee(aItem);</span>
<a href="#l28.162"></a><span id="l28.162" class="difflineplus">+          if (att) {</span>
<a href="#l28.163"></a><span id="l28.163" class="difflineplus">+              if (att.commonName &amp;&amp; att.commonName.length &gt; 0) {</span>
<a href="#l28.164"></a><span id="l28.164" class="difflineplus">+                  attendeeString += att.commonName;</span>
<a href="#l28.165"></a><span id="l28.165" class="difflineplus">+              } else if (att.id) {</span>
<a href="#l28.166"></a><span id="l28.166" class="difflineplus">+                  attendeeString += att.id.replace(/^mailto:/i, &quot;&quot;);</span>
<a href="#l28.167"></a><span id="l28.167" class="difflineplus">+              }</span>
<a href="#l28.168"></a><span id="l28.168" class="difflineplus">+          }</span>
<a href="#l28.169"></a><span id="l28.169" class="difflineplus">+          attendeeLabel.setAttribute(&quot;value&quot;, attendeeString);</span>
<a href="#l28.170"></a><span id="l28.170" class="difflineplus">+          this.setAttribute(&quot;itemId&quot;, aItem.hashId);</span>
<a href="#l28.171"></a><span id="l28.171">           ]]&gt;</span>
<a href="#l28.172"></a><span id="l28.172">         &lt;/body&gt;</span>
<a href="#l28.173"></a><span id="l28.173">       &lt;/method&gt;</span>
<a href="#l28.174"></a><span id="l28.174"> </span>
<a href="#l28.175"></a><span id="l28.175">       &lt;method name=&quot;getCalendarItemParticipationStatus&quot;&gt;</span>
<a href="#l28.176"></a><span id="l28.176">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l28.177"></a><span id="l28.177">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l28.178"></a><span id="l28.178">           let att = cal.getInvitedAttendee(aItem);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -197,59 +197,59 @@ function getFilter(settings) {</span>
<a href="#l29.4"></a><span id="l29.4"> </span>
<a href="#l29.5"></a><span id="l29.5"> /**</span>
<a href="#l29.6"></a><span id="l29.6">  * Looks at the selections the user has made (start date, layout, etc.), and</span>
<a href="#l29.7"></a><span id="l29.7">  * updates the HTML in the iframe accordingly. This is also called when a</span>
<a href="#l29.8"></a><span id="l29.8">  * dialog UI element has changed, since we'll want to refresh the preview.</span>
<a href="#l29.9"></a><span id="l29.9">  */</span>
<a href="#l29.10"></a><span id="l29.10"> function refreshHtml(finishFunc) {</span>
<a href="#l29.11"></a><span id="l29.11">     getPrintSettings((settings) =&gt; {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-            document.title = calGetString(&quot;calendar&quot;, &quot;PrintPreviewWindowTitle&quot;, [settings.title]);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+        document.title = calGetString(&quot;calendar&quot;, &quot;PrintPreviewWindowTitle&quot;, [settings.title]);</span>
<a href="#l29.14"></a><span id="l29.14"> </span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-            let printformatter = Components.classes[settings.layoutCId]</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-                                           .createInstance(Components.interfaces.calIPrintFormatter);</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-            let html = &quot;&quot;;</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+        let printformatter = Components.classes[settings.layoutCId]</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+                                       .createInstance(Components.interfaces.calIPrintFormatter);</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+        let html = &quot;&quot;;</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineplus">+        try {</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineplus">+            let pipe = Components.classes[&quot;@mozilla.org/pipe;1&quot;]</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineplus">+                                 .createInstance(Components.interfaces.nsIPipe);</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineplus">+            const PR_UINT32_MAX = 4294967295; // signals &quot;infinite-length&quot;</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineplus">+            pipe.init(true, true, 0, PR_UINT32_MAX, null);</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineplus">+            printformatter.formatToHtml(pipe.outputStream,</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineplus">+                                        settings.start,</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineplus">+                                        settings.end,</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineplus">+                                        settings.eventList.length,</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+                                        settings.eventList,</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+                                        settings.title);</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+            pipe.outputStream.close();</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+            // convert byte-array to UTF-8 string:</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineplus">+            let convStream = Components.classes[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineplus">+                                       .createInstance(Components.interfaces.nsIConverterInputStream);</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineplus">+            convStream.init(pipe.inputStream, &quot;UTF-8&quot;, 0,</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineplus">+                            Components.interfaces.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);</span>
<a href="#l29.38"></a><span id="l29.38">             try {</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineminus">-                let pipe = Components.classes[&quot;@mozilla.org/pipe;1&quot;]</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineminus">-                                     .createInstance(Components.interfaces.nsIPipe);</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineminus">-                const PR_UINT32_MAX = 4294967295; // signals &quot;infinite-length&quot;</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineminus">-                pipe.init(true, true, 0, PR_UINT32_MAX, null);</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-                printformatter.formatToHtml(pipe.outputStream,</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-                                            settings.start,</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-                                            settings.end,</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-                                            settings.eventList.length,</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-                                            settings.eventList,</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-                                            settings.title);</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-                pipe.outputStream.close();</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-                // convert byte-array to UTF-8 string:</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-                let convStream = Components.classes[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-                                           .createInstance(Components.interfaces.nsIConverterInputStream);</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-                convStream.init(pipe.inputStream, &quot;UTF-8&quot;, 0,</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-                                Components.interfaces.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-                try {</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-                    let portion = {};</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-                    while (convStream.readString(-1, portion)) {</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">-                        html += portion.value;</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-                    }</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineminus">-                } finally {</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineminus">-                    convStream.close();</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineplus">+                let portion = {};</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineplus">+                while (convStream.readString(-1, portion)) {</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineplus">+                    html += portion.value;</span>
<a href="#l29.65"></a><span id="l29.65">                 }</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineminus">-            } catch (e) {</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-                Components.utils.reportError(&quot;Calendar print dialog:refreshHtml: &quot; + e);</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineplus">+            } finally {</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineplus">+                convStream.close();</span>
<a href="#l29.70"></a><span id="l29.70">             }</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineplus">+        } catch (e) {</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineplus">+            Components.utils.reportError(&quot;Calendar print dialog:refreshHtml: &quot; + e);</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineplus">+        }</span>
<a href="#l29.74"></a><span id="l29.74"> </span>
<a href="#l29.75"></a><span id="l29.75" class="difflineminus">-            let iframeDoc = document.getElementById(&quot;content&quot;).contentDocument;</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineminus">-            iframeDoc.documentElement.innerHTML = html;</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineminus">-            iframeDoc.title = settings.title;</span>
<a href="#l29.78"></a><span id="l29.78" class="difflineplus">+        let iframeDoc = document.getElementById(&quot;content&quot;).contentDocument;</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineplus">+        iframeDoc.documentElement.innerHTML = html;</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineplus">+        iframeDoc.title = settings.title;</span>
<a href="#l29.81"></a><span id="l29.81"> </span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-            if (finishFunc) {</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineminus">-                finishFunc();</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineminus">-            }</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineplus">+        if (finishFunc) {</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineplus">+            finishFunc();</span>
<a href="#l29.87"></a><span id="l29.87">         }</span>
<a href="#l29.88"></a><span id="l29.88" class="difflineminus">-    );</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineplus">+    }</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineplus">+);</span>
<a href="#l29.91"></a><span id="l29.91"> }</span>
<a href="#l29.92"></a><span id="l29.92"> </span>
<a href="#l29.93"></a><span id="l29.93"> /**</span>
<a href="#l29.94"></a><span id="l29.94">  * This is a nsIWebProgressListener that closes the dialog on completion, makes</span>
<a href="#l29.95"></a><span id="l29.95">  * sure printing works without issues</span>
<a href="#l29.96"></a><span id="l29.96">  */</span>
<a href="#l29.97"></a><span id="l29.97"> var closeOnComplete = {</span>
<a href="#l29.98"></a><span id="l29.98">     onStateChange: function(aProgress, aRequest, aStateFlags, aStatus) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -164,15 +164,15 @@ function initRefreshInterval() {</span>
<a href="#l30.4"></a><span id="l30.4">         }</span>
<a href="#l30.5"></a><span id="l30.5"> </span>
<a href="#l30.6"></a><span id="l30.6">         if (refreshInterval == 0) {</span>
<a href="#l30.7"></a><span id="l30.7">             menulist.selectedItem = document.getElementById(&quot;calendar-refreshInterval-manual&quot;);</span>
<a href="#l30.8"></a><span id="l30.8">             foundValue = true;</span>
<a href="#l30.9"></a><span id="l30.9">         }</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11">         if (!foundValue) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-          // Special menuitem in case the user changed the value in the config editor.</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-          let menuitem = createMenuItem(refreshInterval);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-          separator.parentNode.insertBefore(menuitem, separator.nextSibling);</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-          menulist.selectedItem = menuitem;</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+            // Special menuitem in case the user changed the value in the config editor.</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+            let menuitem = createMenuItem(refreshInterval);</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+            separator.parentNode.insertBefore(menuitem, separator.nextSibling);</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+            menulist.selectedItem = menuitem;</span>
<a href="#l30.20"></a><span id="l30.20">         }</span>
<a href="#l30.21"></a><span id="l30.21">     }</span>
<a href="#l30.22"></a><span id="l30.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -228,30 +228,30 @@ function updateInvitationStatus() {</span>
<a href="#l31.4"></a><span id="l31.4">     }</span>
<a href="#l31.5"></a><span id="l31.5"> }</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7"> /**</span>
<a href="#l31.8"></a><span id="l31.8">  * When the summary dialog is showing an invitation, this function updates the</span>
<a href="#l31.9"></a><span id="l31.9">  * user's invitation status from the value chosen in the dialog.</span>
<a href="#l31.10"></a><span id="l31.10">  */</span>
<a href="#l31.11"></a><span id="l31.11"> function updatePartStat() {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  let statusElement = document.getElementById(&quot;item-participation&quot;);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-  if (window.attendee) {</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-      let item = window.arguments[0];</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-      let aclEntry = item.calendar.aclEntry;</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-      if (aclEntry) {</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-          let userAddresses = aclEntry.getUserAddresses({});</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">-          if (userAddresses.length &gt; 0 &amp;&amp;</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineminus">-              !cal.attendeeMatchesAddresses(window.attendee, userAddresses)) {</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineminus">-              window.attendee.setProperty(&quot;SENT-BY&quot;, &quot;mailto:&quot; + userAddresses[0]);</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">-          }</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineminus">-      }</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+    let statusElement = document.getElementById(&quot;item-participation&quot;);</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineplus">+    if (window.attendee) {</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineplus">+        let item = window.arguments[0];</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineplus">+        let aclEntry = item.calendar.aclEntry;</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineplus">+        if (aclEntry) {</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineplus">+            let userAddresses = aclEntry.getUserAddresses({});</span>
<a href="#l31.29"></a><span id="l31.29" class="difflineplus">+            if (userAddresses.length &gt; 0 &amp;&amp;</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineplus">+                !cal.attendeeMatchesAddresses(window.attendee, userAddresses)) {</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+                window.attendee.setProperty(&quot;SENT-BY&quot;, &quot;mailto:&quot; + userAddresses[0]);</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+            }</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+        }</span>
<a href="#l31.34"></a><span id="l31.34"> </span>
<a href="#l31.35"></a><span id="l31.35" class="difflineminus">-      window.attendee.participationStatus = statusElement.value;</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineminus">-  }</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineplus">+        window.attendee.participationStatus = statusElement.value;</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineplus">+    }</span>
<a href="#l31.39"></a><span id="l31.39"> }</span>
<a href="#l31.40"></a><span id="l31.40"> </span>
<a href="#l31.41"></a><span id="l31.41"> /**</span>
<a href="#l31.42"></a><span id="l31.42">  * Updates the dialog w.r.t recurrence, i.e shows a text describing the item's</span>
<a href="#l31.43"></a><span id="l31.43">  * recurrence)</span>
<a href="#l31.44"></a><span id="l31.44">  */</span>
<a href="#l31.45"></a><span id="l31.45"> function updateRepeatDetails() {</span>
<a href="#l31.46"></a><span id="l31.46">     let args = window.arguments[0];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/content/preferences/categories.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/content/preferences/categories.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -296,17 +296,17 @@ var gCategoriesPane = {</span>
<a href="#l32.4"></a><span id="l32.4"> </span>
<a href="#l32.5"></a><span id="l32.5">     /**</span>
<a href="#l32.6"></a><span id="l32.6">      * Reverts category preferences in case the cancel button is pressed.</span>
<a href="#l32.7"></a><span id="l32.7">      */</span>
<a href="#l32.8"></a><span id="l32.8">     panelOnCancel: function() {</span>
<a href="#l32.9"></a><span id="l32.9">         for (let i = 0; i &lt; parent.backupPrefList.length; i++) {</span>
<a href="#l32.10"></a><span id="l32.10">             if (parent.backupPrefList[i].color == &quot;##NEW&quot;) {</span>
<a href="#l32.11"></a><span id="l32.11">                 try {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-                   categoryPrefBranch.clearUserPref(parent.backupPrefList[i].name);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+                    categoryPrefBranch.clearUserPref(parent.backupPrefList[i].name);</span>
<a href="#l32.14"></a><span id="l32.14">                 } catch (ex) {</span>
<a href="#l32.15"></a><span id="l32.15">                     dump(&quot;Exception caught in 'panelOnCancel': &quot; + ex + &quot;\n&quot;);</span>
<a href="#l32.16"></a><span id="l32.16">                 }</span>
<a href="#l32.17"></a><span id="l32.17">             } else {</span>
<a href="#l32.18"></a><span id="l32.18">                 categoryPrefBranch.setCharPref(parent.backupPrefList[i].name,</span>
<a href="#l32.19"></a><span id="l32.19">                                                parent.backupPrefList[i].color);</span>
<a href="#l32.20"></a><span id="l32.20">             }</span>
<a href="#l32.21"></a><span id="l32.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/content/preferences/editCategory.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/content/preferences/editCategory.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -99,12 +99,12 @@ function clickColor() {</span>
<a href="#l33.4"></a><span id="l33.4">  * Call the function after the given timeout, resetting the timer if delay is</span>
<a href="#l33.5"></a><span id="l33.5">  * called again with the same function.</span>
<a href="#l33.6"></a><span id="l33.6">  *</span>
<a href="#l33.7"></a><span id="l33.7">  * @param timeout   The timeout interval.</span>
<a href="#l33.8"></a><span id="l33.8">  * @param func      The function to call after the timeout.</span>
<a href="#l33.9"></a><span id="l33.9">  */</span>
<a href="#l33.10"></a><span id="l33.10"> function delay(timeout, func) {</span>
<a href="#l33.11"></a><span id="l33.11">     if (func.timer) {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-      clearTimeout(func.timer);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+        clearTimeout(func.timer);</span>
<a href="#l33.14"></a><span id="l33.14">     }</span>
<a href="#l33.15"></a><span id="l33.15">     func.timer = setTimeout(func, timeout);</span>
<a href="#l33.16"></a><span id="l33.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -5,19 +5,19 @@</span>
<a href="#l34.4"></a><span id="l34.4"> </span>
<a href="#l34.5"></a><span id="l34.5"> &lt;!DOCTYPE bindings</span>
<a href="#l34.6"></a><span id="l34.6"> [</span>
<a href="#l34.7"></a><span id="l34.7">   &lt;!ENTITY % dtd1 SYSTEM &quot;chrome://calendar/locale/global.dtd&quot; &gt; %dtd1;</span>
<a href="#l34.8"></a><span id="l34.8">   &lt;!ENTITY % dtd2 SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot; &gt; %dtd2;</span>
<a href="#l34.9"></a><span id="l34.9"> ]&gt;</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11"> &lt;bindings id=&quot;calendar-alarms&quot;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l34.18"></a><span id="l34.18"> </span>
<a href="#l34.19"></a><span id="l34.19">   &lt;binding id=&quot;calendar-alarm-widget&quot; extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l34.20"></a><span id="l34.20">     &lt;resources&gt;</span>
<a href="#l34.21"></a><span id="l34.21">       &lt;stylesheet src=&quot;chrome://global/skin/button.css&quot;/&gt;</span>
<a href="#l34.22"></a><span id="l34.22">       &lt;stylesheet src=&quot;chrome://calendar/skin/calendar-alarm-dialog.css&quot;/&gt;</span>
<a href="#l34.23"></a><span id="l34.23">     &lt;/resources&gt;</span>
<a href="#l34.24"></a><span id="l34.24"> </span>
<a href="#l34.25"></a><span id="l34.25">     &lt;content orient=&quot;horizontal&quot;&gt;</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineat">@@ -242,17 +242,17 @@</span>
<a href="#l34.27"></a><span id="l34.27">       &lt;/xul:hbox&gt;</span>
<a href="#l34.28"></a><span id="l34.28">     &lt;/content&gt;</span>
<a href="#l34.29"></a><span id="l34.29">     &lt;implementation&gt;</span>
<a href="#l34.30"></a><span id="l34.30">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l34.31"></a><span id="l34.31">         Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l34.32"></a><span id="l34.32"> </span>
<a href="#l34.33"></a><span id="l34.33">         let snoozePref = Preferences.get(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l34.34"></a><span id="l34.34">         if (snoozePref &lt;= 0) {</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineminus">-          snoozePref = 5;</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineplus">+            snoozePref = 5;</span>
<a href="#l34.37"></a><span id="l34.37">         }</span>
<a href="#l34.38"></a><span id="l34.38"> </span>
<a href="#l34.39"></a><span id="l34.39">         let unitList = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;snooze-unit-menulist&quot;);</span>
<a href="#l34.40"></a><span id="l34.40">         let unitValue = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;snooze-value-textbox&quot;);</span>
<a href="#l34.41"></a><span id="l34.41"> </span>
<a href="#l34.42"></a><span id="l34.42">         let selectedIndex = 0;</span>
<a href="#l34.43"></a><span id="l34.43">         if ((snoozePref % 60) == 0) {</span>
<a href="#l34.44"></a><span id="l34.44">             snoozePref = snoozePref / 60;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -61,92 +61,92 @@</span>
<a href="#l35.4"></a><span id="l35.4">           // in the compositeCalendar setter.</span>
<a href="#l35.5"></a><span id="l35.5">           throw Components.Exception(&quot;Seting calendars on type='full' is not supported&quot;,</span>
<a href="#l35.6"></a><span id="l35.6">                                      Components.results.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l35.7"></a><span id="l35.7">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l35.8"></a><span id="l35.8">       &lt;/property&gt;</span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10">       &lt;field name=&quot;calMgrObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.11"></a><span id="l35.11">       ({</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-        listTree: this,</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICalendarManagerObserver]),</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+          listTree: this,</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+          QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICalendarManagerObserver]),</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">-        // calICalendarManagerObserver</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-        onCalendarRegistered: function(aCalendar) {</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineminus">-            this.listTree.addCalendar(aCalendar);</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineminus">-            let composite = this.listTree.compositeCalendar;</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineminus">-            let inComposite = aCalendar.getProperty(composite.prefPrefix +</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineminus">-                                                    &quot;-in-composite&quot;);</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineminus">-            if ((inComposite === null) || inComposite) {</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineminus">-                composite.addCalendar(aCalendar);</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">-            }</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">-        },</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+          // calICalendarManagerObserver</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineplus">+          onCalendarRegistered: function(aCalendar) {</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+              this.listTree.addCalendar(aCalendar);</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineplus">+              let composite = this.listTree.compositeCalendar;</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineplus">+              let inComposite = aCalendar.getProperty(composite.prefPrefix +</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+                                                      &quot;-in-composite&quot;);</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+              if ((inComposite === null) || inComposite) {</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+                  composite.addCalendar(aCalendar);</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+              }</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+          },</span>
<a href="#l35.37"></a><span id="l35.37"> </span>
<a href="#l35.38"></a><span id="l35.38" class="difflineminus">-        onCalendarUnregistering: function(aCalendar) {</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineminus">-            this.listTree.removeCalendar(aCalendar);</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineminus">-        },</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineplus">+          onCalendarUnregistering: function(aCalendar) {</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineplus">+              this.listTree.removeCalendar(aCalendar);</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineplus">+          },</span>
<a href="#l35.44"></a><span id="l35.44"> </span>
<a href="#l35.45"></a><span id="l35.45" class="difflineminus">-        onCalendarDeleting: function(aCalendar) {</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineminus">-            // Now that the calendar is unregistered, update the commands to</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineminus">-            // make sure that New Event/Task commands are correctly</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineminus">-            // enabled/disabled.</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineminus">-            document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineminus">-        }</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+          onCalendarDeleting: function(aCalendar) {</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineplus">+              // Now that the calendar is unregistered, update the commands to</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+              // make sure that New Event/Task commands are correctly</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineplus">+              // enabled/disabled.</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+              document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+          }</span>
<a href="#l35.57"></a><span id="l35.57">       })</span>
<a href="#l35.58"></a><span id="l35.58">       ]]&gt;&lt;/field&gt;</span>
<a href="#l35.59"></a><span id="l35.59">       &lt;field name=&quot;compositeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.60"></a><span id="l35.60">       ({</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineminus">-        listTree: this,</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineminus">-        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICompositeObserver,</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineminus">-                                               Components.interfaces.calIObserver]),</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+          listTree: this,</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+          QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICompositeObserver,</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineplus">+                                                 Components.interfaces.calIObserver]),</span>
<a href="#l35.67"></a><span id="l35.67"> </span>
<a href="#l35.68"></a><span id="l35.68" class="difflineminus">-        // calICompositeObserver</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineminus">-        onCalendarAdded: function(aCalendar) {</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineminus">-            // Make sure the checkbox state is updated</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineminus">-            this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineminus">-        },</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineplus">+          // calICompositeObserver</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineplus">+          onCalendarAdded: function(aCalendar) {</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineplus">+              // Make sure the checkbox state is updated</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineplus">+              this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineplus">+          },</span>
<a href="#l35.78"></a><span id="l35.78"> </span>
<a href="#l35.79"></a><span id="l35.79" class="difflineminus">-        onCalendarRemoved: function(aCalendar) {</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineminus">-            // Make sure the checkbox state is updated</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineminus">-            this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.82"></a><span id="l35.82" class="difflineminus">-        },</span>
<a href="#l35.83"></a><span id="l35.83" class="difflineplus">+          onCalendarRemoved: function(aCalendar) {</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineplus">+              // Make sure the checkbox state is updated</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineplus">+              this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.86"></a><span id="l35.86" class="difflineplus">+          },</span>
<a href="#l35.87"></a><span id="l35.87"> </span>
<a href="#l35.88"></a><span id="l35.88" class="difflineminus">-        onDefaultCalendarChanged: function(aCalendar) {</span>
<a href="#l35.89"></a><span id="l35.89" class="difflineminus">-        },</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineplus">+          onDefaultCalendarChanged: function(aCalendar) {</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineplus">+          },</span>
<a href="#l35.92"></a><span id="l35.92"> </span>
<a href="#l35.93"></a><span id="l35.93" class="difflineminus">-        // calIObserver</span>
<a href="#l35.94"></a><span id="l35.94" class="difflineminus">-        onStartBatch: function() { },</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineminus">-        onEndBatch: function() { },</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineminus">-        onLoad: function() { },</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineplus">+          // calIObserver</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineplus">+          onStartBatch: function() { },</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+          onEndBatch: function() { },</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineplus">+          onLoad: function() { },</span>
<a href="#l35.101"></a><span id="l35.101"> </span>
<a href="#l35.102"></a><span id="l35.102" class="difflineminus">-        onAddItem: function(aItem) {</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineminus">-            if (aItem.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineminus">-                this.listTree.ensureCalendarVisible(aItem.calendar);</span>
<a href="#l35.105"></a><span id="l35.105" class="difflineminus">-            }</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineminus">-        },</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineminus">-        onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l35.108"></a><span id="l35.108" class="difflineminus">-            if (aNewItem.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineminus">-                this.listTree.ensureCalendarVisible(aNewItem.calendar);</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineminus">-            }</span>
<a href="#l35.111"></a><span id="l35.111" class="difflineminus">-        },</span>
<a href="#l35.112"></a><span id="l35.112" class="difflineminus">-        onDeleteItem: function(aDeletedItem) { },</span>
<a href="#l35.113"></a><span id="l35.113" class="difflineminus">-        onError: function(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l35.114"></a><span id="l35.114" class="difflineplus">+          onAddItem: function(aItem) {</span>
<a href="#l35.115"></a><span id="l35.115" class="difflineplus">+              if (aItem.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l35.116"></a><span id="l35.116" class="difflineplus">+                  this.listTree.ensureCalendarVisible(aItem.calendar);</span>
<a href="#l35.117"></a><span id="l35.117" class="difflineplus">+              }</span>
<a href="#l35.118"></a><span id="l35.118" class="difflineplus">+          },</span>
<a href="#l35.119"></a><span id="l35.119" class="difflineplus">+          onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l35.120"></a><span id="l35.120" class="difflineplus">+              if (aNewItem.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l35.121"></a><span id="l35.121" class="difflineplus">+                  this.listTree.ensureCalendarVisible(aNewItem.calendar);</span>
<a href="#l35.122"></a><span id="l35.122" class="difflineplus">+              }</span>
<a href="#l35.123"></a><span id="l35.123" class="difflineplus">+          },</span>
<a href="#l35.124"></a><span id="l35.124" class="difflineplus">+          onDeleteItem: function(aDeletedItem) { },</span>
<a href="#l35.125"></a><span id="l35.125" class="difflineplus">+          onError: function(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l35.126"></a><span id="l35.126"> </span>
<a href="#l35.127"></a><span id="l35.127" class="difflineminus">-        onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l35.128"></a><span id="l35.128" class="difflineminus">-            switch (aName) {</span>
<a href="#l35.129"></a><span id="l35.129" class="difflineminus">-                case &quot;disabled&quot;:</span>
<a href="#l35.130"></a><span id="l35.130" class="difflineminus">-                case &quot;readOnly&quot;:</span>
<a href="#l35.131"></a><span id="l35.131" class="difflineminus">-                    calendarUpdateNewItemsCommand();</span>
<a href="#l35.132"></a><span id="l35.132" class="difflineminus">-                    document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l35.133"></a><span id="l35.133" class="difflineminus">-                    break;</span>
<a href="#l35.134"></a><span id="l35.134" class="difflineminus">-            }</span>
<a href="#l35.135"></a><span id="l35.135" class="difflineminus">-        },</span>
<a href="#l35.136"></a><span id="l35.136" class="difflineplus">+          onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l35.137"></a><span id="l35.137" class="difflineplus">+              switch (aName) {</span>
<a href="#l35.138"></a><span id="l35.138" class="difflineplus">+                  case &quot;disabled&quot;:</span>
<a href="#l35.139"></a><span id="l35.139" class="difflineplus">+                  case &quot;readOnly&quot;:</span>
<a href="#l35.140"></a><span id="l35.140" class="difflineplus">+                      calendarUpdateNewItemsCommand();</span>
<a href="#l35.141"></a><span id="l35.141" class="difflineplus">+                      document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l35.142"></a><span id="l35.142" class="difflineplus">+                      break;</span>
<a href="#l35.143"></a><span id="l35.143" class="difflineplus">+              }</span>
<a href="#l35.144"></a><span id="l35.144" class="difflineplus">+          },</span>
<a href="#l35.145"></a><span id="l35.145"> </span>
<a href="#l35.146"></a><span id="l35.146" class="difflineminus">-        onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l35.147"></a><span id="l35.147" class="difflineminus">-        }</span>
<a href="#l35.148"></a><span id="l35.148" class="difflineplus">+          onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l35.149"></a><span id="l35.149" class="difflineplus">+          }</span>
<a href="#l35.150"></a><span id="l35.150">       })</span>
<a href="#l35.151"></a><span id="l35.151">       ]]&gt;&lt;/field&gt;</span>
<a href="#l35.152"></a><span id="l35.152">     &lt;/implementation&gt;</span>
<a href="#l35.153"></a><span id="l35.153">     &lt;handlers&gt;</span>
<a href="#l35.154"></a><span id="l35.154">       &lt;handler event=&quot;dblclick&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.155"></a><span id="l35.155">         let col = {};</span>
<a href="#l35.156"></a><span id="l35.156">         let calendar = this.getCalendarFromEvent(event, col);</span>
<a href="#l35.157"></a><span id="l35.157">         if (event.button != 0 ||</span>
<a href="#l35.158"></a><span id="l35.158" class="difflineat">@@ -245,74 +245,74 @@</span>
<a href="#l35.159"></a><span id="l35.159"> </span>
<a href="#l35.160"></a><span id="l35.160">         if (this.mCompositeCalendar) {</span>
<a href="#l35.161"></a><span id="l35.161">             this.mCompositeCalendar.removeObserver(this.compositeObserver);</span>
<a href="#l35.162"></a><span id="l35.162">         }</span>
<a href="#l35.163"></a><span id="l35.163">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l35.164"></a><span id="l35.164"> </span>
<a href="#l35.165"></a><span id="l35.165">       &lt;field name=&quot;calObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.166"></a><span id="l35.166">       ({</span>
<a href="#l35.167"></a><span id="l35.167" class="difflineminus">-        listTree: this,</span>
<a href="#l35.168"></a><span id="l35.168" class="difflineminus">-        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIObserver]),</span>
<a href="#l35.169"></a><span id="l35.169" class="difflineplus">+          listTree: this,</span>
<a href="#l35.170"></a><span id="l35.170" class="difflineplus">+          QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIObserver]),</span>
<a href="#l35.171"></a><span id="l35.171"> </span>
<a href="#l35.172"></a><span id="l35.172" class="difflineminus">-        // calIObserver. Note that each registered calendar uses this observer</span>
<a href="#l35.173"></a><span id="l35.173" class="difflineminus">-        onStartBatch: function() { },</span>
<a href="#l35.174"></a><span id="l35.174" class="difflineminus">-        onEndBatch: function() { },</span>
<a href="#l35.175"></a><span id="l35.175" class="difflineminus">-        onLoad: function() { },</span>
<a href="#l35.176"></a><span id="l35.176" class="difflineplus">+          // calIObserver. Note that each registered calendar uses this observer</span>
<a href="#l35.177"></a><span id="l35.177" class="difflineplus">+          onStartBatch: function() { },</span>
<a href="#l35.178"></a><span id="l35.178" class="difflineplus">+          onEndBatch: function() { },</span>
<a href="#l35.179"></a><span id="l35.179" class="difflineplus">+          onLoad: function() { },</span>
<a href="#l35.180"></a><span id="l35.180"> </span>
<a href="#l35.181"></a><span id="l35.181" class="difflineminus">-        onAddItem: function(aItem) { },</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineminus">-        onModifyItem: function(aNewItem, aOldItem) { },</span>
<a href="#l35.183"></a><span id="l35.183" class="difflineminus">-        onDeleteItem: function(aDeletedItem) { },</span>
<a href="#l35.184"></a><span id="l35.184" class="difflineminus">-        onError: function(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l35.185"></a><span id="l35.185" class="difflineplus">+          onAddItem: function(aItem) { },</span>
<a href="#l35.186"></a><span id="l35.186" class="difflineplus">+          onModifyItem: function(aNewItem, aOldItem) { },</span>
<a href="#l35.187"></a><span id="l35.187" class="difflineplus">+          onDeleteItem: function(aDeletedItem) { },</span>
<a href="#l35.188"></a><span id="l35.188" class="difflineplus">+          onError: function(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l35.189"></a><span id="l35.189"> </span>
<a href="#l35.190"></a><span id="l35.190" class="difflineminus">-        onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l35.191"></a><span id="l35.191" class="difflineminus">-            switch (aName) {</span>
<a href="#l35.192"></a><span id="l35.192" class="difflineminus">-                case &quot;color&quot;:</span>
<a href="#l35.193"></a><span id="l35.193" class="difflineminus">-                    // TODO See other TODO in this file about updateStyleSheetForViews</span>
<a href="#l35.194"></a><span id="l35.194" class="difflineminus">-                    if (&quot;updateStyleSheetForViews&quot; in window) {</span>
<a href="#l35.195"></a><span id="l35.195" class="difflineminus">-                        updateStyleSheetForViews(aCalendar);</span>
<a href="#l35.196"></a><span id="l35.196" class="difflineminus">-                    }</span>
<a href="#l35.197"></a><span id="l35.197" class="difflineminus">-                    this.listTree.updateCalendarColor(aCalendar);</span>
<a href="#l35.198"></a><span id="l35.198" class="difflineminus">-                    // Fall through, update item in any case</span>
<a href="#l35.199"></a><span id="l35.199" class="difflineminus">-                case &quot;name&quot;:</span>
<a href="#l35.200"></a><span id="l35.200" class="difflineminus">-                case &quot;currentStatus&quot;:</span>
<a href="#l35.201"></a><span id="l35.201" class="difflineminus">-                case &quot;readOnly&quot;:</span>
<a href="#l35.202"></a><span id="l35.202" class="difflineminus">-                case &quot;disabled&quot;:</span>
<a href="#l35.203"></a><span id="l35.203" class="difflineminus">-                    this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.204"></a><span id="l35.204" class="difflineminus">-                    // Fall through, update commands in any cases.</span>
<a href="#l35.205"></a><span id="l35.205" class="difflineminus">-            }</span>
<a href="#l35.206"></a><span id="l35.206" class="difflineminus">-        },</span>
<a href="#l35.207"></a><span id="l35.207" class="difflineplus">+          onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l35.208"></a><span id="l35.208" class="difflineplus">+              switch (aName) {</span>
<a href="#l35.209"></a><span id="l35.209" class="difflineplus">+                  case &quot;color&quot;:</span>
<a href="#l35.210"></a><span id="l35.210" class="difflineplus">+                      // TODO See other TODO in this file about updateStyleSheetForViews</span>
<a href="#l35.211"></a><span id="l35.211" class="difflineplus">+                      if (&quot;updateStyleSheetForViews&quot; in window) {</span>
<a href="#l35.212"></a><span id="l35.212" class="difflineplus">+                          updateStyleSheetForViews(aCalendar);</span>
<a href="#l35.213"></a><span id="l35.213" class="difflineplus">+                      }</span>
<a href="#l35.214"></a><span id="l35.214" class="difflineplus">+                      this.listTree.updateCalendarColor(aCalendar);</span>
<a href="#l35.215"></a><span id="l35.215" class="difflineplus">+                      // Fall through, update item in any case</span>
<a href="#l35.216"></a><span id="l35.216" class="difflineplus">+                  case &quot;name&quot;:</span>
<a href="#l35.217"></a><span id="l35.217" class="difflineplus">+                  case &quot;currentStatus&quot;:</span>
<a href="#l35.218"></a><span id="l35.218" class="difflineplus">+                  case &quot;readOnly&quot;:</span>
<a href="#l35.219"></a><span id="l35.219" class="difflineplus">+                  case &quot;disabled&quot;:</span>
<a href="#l35.220"></a><span id="l35.220" class="difflineplus">+                      this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.221"></a><span id="l35.221" class="difflineplus">+                      // Fall through, update commands in any cases.</span>
<a href="#l35.222"></a><span id="l35.222" class="difflineplus">+              }</span>
<a href="#l35.223"></a><span id="l35.223" class="difflineplus">+          },</span>
<a href="#l35.224"></a><span id="l35.224"> </span>
<a href="#l35.225"></a><span id="l35.225" class="difflineminus">-        onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l35.226"></a><span id="l35.226" class="difflineminus">-            // Since the old value is not used directly in onPropertyChanged,</span>
<a href="#l35.227"></a><span id="l35.227" class="difflineminus">-            // but should not be the same as the value, set it to a different</span>
<a href="#l35.228"></a><span id="l35.228" class="difflineminus">-            // value.</span>
<a href="#l35.229"></a><span id="l35.229" class="difflineminus">-            this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l35.230"></a><span id="l35.230" class="difflineminus">-        }</span>
<a href="#l35.231"></a><span id="l35.231" class="difflineplus">+          onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l35.232"></a><span id="l35.232" class="difflineplus">+              // Since the old value is not used directly in onPropertyChanged,</span>
<a href="#l35.233"></a><span id="l35.233" class="difflineplus">+              // but should not be the same as the value, set it to a different</span>
<a href="#l35.234"></a><span id="l35.234" class="difflineplus">+              // value.</span>
<a href="#l35.235"></a><span id="l35.235" class="difflineplus">+              this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l35.236"></a><span id="l35.236" class="difflineplus">+          }</span>
<a href="#l35.237"></a><span id="l35.237">       })</span>
<a href="#l35.238"></a><span id="l35.238">       ]]&gt;&lt;/field&gt;</span>
<a href="#l35.239"></a><span id="l35.239"> </span>
<a href="#l35.240"></a><span id="l35.240">       &lt;field name=&quot;compositeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.241"></a><span id="l35.241">       ({</span>
<a href="#l35.242"></a><span id="l35.242" class="difflineminus">-        listTree: this,</span>
<a href="#l35.243"></a><span id="l35.243" class="difflineminus">-        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICompositeObserver]),</span>
<a href="#l35.244"></a><span id="l35.244" class="difflineplus">+          listTree: this,</span>
<a href="#l35.245"></a><span id="l35.245" class="difflineplus">+          QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICompositeObserver]),</span>
<a href="#l35.246"></a><span id="l35.246"> </span>
<a href="#l35.247"></a><span id="l35.247" class="difflineminus">-        // calICompositeObserver</span>
<a href="#l35.248"></a><span id="l35.248" class="difflineminus">-        onCalendarAdded: function(aCalendar) {</span>
<a href="#l35.249"></a><span id="l35.249" class="difflineminus">-            // Make sure the checkbox state is updated</span>
<a href="#l35.250"></a><span id="l35.250" class="difflineminus">-            this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.251"></a><span id="l35.251" class="difflineminus">-        },</span>
<a href="#l35.252"></a><span id="l35.252" class="difflineplus">+          // calICompositeObserver</span>
<a href="#l35.253"></a><span id="l35.253" class="difflineplus">+          onCalendarAdded: function(aCalendar) {</span>
<a href="#l35.254"></a><span id="l35.254" class="difflineplus">+              // Make sure the checkbox state is updated</span>
<a href="#l35.255"></a><span id="l35.255" class="difflineplus">+              this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.256"></a><span id="l35.256" class="difflineplus">+          },</span>
<a href="#l35.257"></a><span id="l35.257"> </span>
<a href="#l35.258"></a><span id="l35.258" class="difflineminus">-        onCalendarRemoved: function(aCalendar) {</span>
<a href="#l35.259"></a><span id="l35.259" class="difflineminus">-            // Make sure the checkbox state is updated</span>
<a href="#l35.260"></a><span id="l35.260" class="difflineminus">-            this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.261"></a><span id="l35.261" class="difflineminus">-        },</span>
<a href="#l35.262"></a><span id="l35.262" class="difflineplus">+          onCalendarRemoved: function(aCalendar) {</span>
<a href="#l35.263"></a><span id="l35.263" class="difflineplus">+              // Make sure the checkbox state is updated</span>
<a href="#l35.264"></a><span id="l35.264" class="difflineplus">+              this.listTree.updateCalendar(aCalendar);</span>
<a href="#l35.265"></a><span id="l35.265" class="difflineplus">+          },</span>
<a href="#l35.266"></a><span id="l35.266"> </span>
<a href="#l35.267"></a><span id="l35.267" class="difflineminus">-        onDefaultCalendarChanged: function(aCalendar) {</span>
<a href="#l35.268"></a><span id="l35.268" class="difflineminus">-        }</span>
<a href="#l35.269"></a><span id="l35.269" class="difflineplus">+          onDefaultCalendarChanged: function(aCalendar) {</span>
<a href="#l35.270"></a><span id="l35.270" class="difflineplus">+          }</span>
<a href="#l35.271"></a><span id="l35.271">       })</span>
<a href="#l35.272"></a><span id="l35.272">       ]]&gt;&lt;/field&gt;</span>
<a href="#l35.273"></a><span id="l35.273"> </span>
<a href="#l35.274"></a><span id="l35.274">       &lt;property name=&quot;treechildren&quot;</span>
<a href="#l35.275"></a><span id="l35.275">                 readonly=&quot;true&quot;</span>
<a href="#l35.276"></a><span id="l35.276">                 onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'treechildren')&quot;/&gt;</span>
<a href="#l35.277"></a><span id="l35.277">       &lt;property name=&quot;tree&quot;</span>
<a href="#l35.278"></a><span id="l35.278">                 readonly=&quot;true&quot;</span>
<a href="#l35.279"></a><span id="l35.279" class="difflineat">@@ -324,18 +324,18 @@</span>
<a href="#l35.280"></a><span id="l35.280">           if (!this.mCachedSheet) {</span>
<a href="#l35.281"></a><span id="l35.281">               for (let sheet of document.styleSheets) {</span>
<a href="#l35.282"></a><span id="l35.282">                   if (sheet.href == &quot;chrome://calendar/skin/calendar-management.css&quot;) {</span>
<a href="#l35.283"></a><span id="l35.283">                       this.mCachedSheet = sheet;</span>
<a href="#l35.284"></a><span id="l35.284">                       break;</span>
<a href="#l35.285"></a><span id="l35.285">                   }</span>
<a href="#l35.286"></a><span id="l35.286">               }</span>
<a href="#l35.287"></a><span id="l35.287">               if (!this.mCachedSheet) {</span>
<a href="#l35.288"></a><span id="l35.288" class="difflineminus">-                cal.ERROR(&quot;Could not find calendar-management.css, needs to be added to &quot; +</span>
<a href="#l35.289"></a><span id="l35.289" class="difflineminus">-                          window.document.title + &quot;'s stylesheets&quot;);</span>
<a href="#l35.290"></a><span id="l35.290" class="difflineplus">+                  cal.ERROR(&quot;Could not find calendar-management.css, needs to be added to &quot; +</span>
<a href="#l35.291"></a><span id="l35.291" class="difflineplus">+                            window.document.title + &quot;'s stylesheets&quot;);</span>
<a href="#l35.292"></a><span id="l35.292">               }</span>
<a href="#l35.293"></a><span id="l35.293">           }</span>
<a href="#l35.294"></a><span id="l35.294"> </span>
<a href="#l35.295"></a><span id="l35.295">           return this.mCachedSheet;</span>
<a href="#l35.296"></a><span id="l35.296">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l35.297"></a><span id="l35.297">       &lt;/property&gt;</span>
<a href="#l35.298"></a><span id="l35.298"> </span>
<a href="#l35.299"></a><span id="l35.299">       &lt;property name=&quot;calendars&quot;&gt;</span>
<a href="#l35.300"></a><span id="l35.300" class="difflineat">@@ -403,18 +403,18 @@</span>
<a href="#l35.301"></a><span id="l35.301">               let func = new Function(&quot;event&quot;, handler);</span>
<a href="#l35.302"></a><span id="l35.302">               func(event);</span>
<a href="#l35.303"></a><span id="l35.303">           }</span>
<a href="#l35.304"></a><span id="l35.304">         ]]&gt;&lt;/body&gt;</span>
<a href="#l35.305"></a><span id="l35.305">       &lt;/method&gt;</span>
<a href="#l35.306"></a><span id="l35.306">       &lt;method name=&quot;displayScrollbarSpacer&quot;&gt;</span>
<a href="#l35.307"></a><span id="l35.307">         &lt;parameter name=&quot;aShouldDisplay&quot;/&gt;</span>
<a href="#l35.308"></a><span id="l35.308">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l35.309"></a><span id="l35.309" class="difflineminus">-            let spacer = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;scrollbar-spacer&quot;);</span>
<a href="#l35.310"></a><span id="l35.310" class="difflineminus">-            spacer.collapsed = !aShouldDisplay;</span>
<a href="#l35.311"></a><span id="l35.311" class="difflineplus">+          let spacer = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;scrollbar-spacer&quot;);</span>
<a href="#l35.312"></a><span id="l35.312" class="difflineplus">+          spacer.collapsed = !aShouldDisplay;</span>
<a href="#l35.313"></a><span id="l35.313">         ]]&gt;&lt;/body&gt;</span>
<a href="#l35.314"></a><span id="l35.314">       &lt;/method&gt;</span>
<a href="#l35.315"></a><span id="l35.315"> </span>
<a href="#l35.316"></a><span id="l35.316">       &lt;method name=&quot;ensureCalendarVisible&quot;&gt;</span>
<a href="#l35.317"></a><span id="l35.317">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l35.318"></a><span id="l35.318">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l35.319"></a><span id="l35.319">           this.compositeCalendar.addCalendar(aCalendar);</span>
<a href="#l35.320"></a><span id="l35.320">         ]]&gt;&lt;/body&gt;</span>
<a href="#l35.321"></a><span id="l35.321" class="difflineat">@@ -954,29 +954,29 @@</span>
<a href="#l35.322"></a><span id="l35.322">           this.treebox.invalidateRow(aRow);</span>
<a href="#l35.323"></a><span id="l35.323">           this.mCycleTimer = setTimeout(this.cycleCellCommit.bind(this), 200);</span>
<a href="#l35.324"></a><span id="l35.324">         ]]&gt;&lt;/body&gt;</span>
<a href="#l35.325"></a><span id="l35.325">       &lt;/method&gt;</span>
<a href="#l35.326"></a><span id="l35.326"> </span>
<a href="#l35.327"></a><span id="l35.327">       &lt;method name=&quot;cycleCellCommit&quot;&gt;</span>
<a href="#l35.328"></a><span id="l35.328">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l35.329"></a><span id="l35.329">           let composite = this.compositeCalendar;</span>
<a href="#l35.330"></a><span id="l35.330" class="difflineminus">-              try {</span>
<a href="#l35.331"></a><span id="l35.331" class="difflineminus">-                  composite.startBatch();</span>
<a href="#l35.332"></a><span id="l35.332" class="difflineminus">-                  for (let id in this.mCycleCalendarFlag) {</span>
<a href="#l35.333"></a><span id="l35.333" class="difflineminus">-                      if (composite.getCalendarById(id)) {</span>
<a href="#l35.334"></a><span id="l35.334" class="difflineminus">-                          composite.removeCalendar(this.mCycleCalendarFlag[id]);</span>
<a href="#l35.335"></a><span id="l35.335" class="difflineminus">-                      } else {</span>
<a href="#l35.336"></a><span id="l35.336" class="difflineminus">-                          composite.addCalendar(this.mCycleCalendarFlag[id]);</span>
<a href="#l35.337"></a><span id="l35.337" class="difflineminus">-                      }</span>
<a href="#l35.338"></a><span id="l35.338" class="difflineminus">-                      delete this.mCycleCalendarFlag[id];</span>
<a href="#l35.339"></a><span id="l35.339" class="difflineplus">+          try {</span>
<a href="#l35.340"></a><span id="l35.340" class="difflineplus">+              composite.startBatch();</span>
<a href="#l35.341"></a><span id="l35.341" class="difflineplus">+              for (let id in this.mCycleCalendarFlag) {</span>
<a href="#l35.342"></a><span id="l35.342" class="difflineplus">+                  if (composite.getCalendarById(id)) {</span>
<a href="#l35.343"></a><span id="l35.343" class="difflineplus">+                      composite.removeCalendar(this.mCycleCalendarFlag[id]);</span>
<a href="#l35.344"></a><span id="l35.344" class="difflineplus">+                  } else {</span>
<a href="#l35.345"></a><span id="l35.345" class="difflineplus">+                      composite.addCalendar(this.mCycleCalendarFlag[id]);</span>
<a href="#l35.346"></a><span id="l35.346">                   }</span>
<a href="#l35.347"></a><span id="l35.347" class="difflineminus">-              } finally {</span>
<a href="#l35.348"></a><span id="l35.348" class="difflineminus">-                  composite.endBatch();</span>
<a href="#l35.349"></a><span id="l35.349" class="difflineplus">+                  delete this.mCycleCalendarFlag[id];</span>
<a href="#l35.350"></a><span id="l35.350">               }</span>
<a href="#l35.351"></a><span id="l35.351" class="difflineplus">+          } finally {</span>
<a href="#l35.352"></a><span id="l35.352" class="difflineplus">+              composite.endBatch();</span>
<a href="#l35.353"></a><span id="l35.353" class="difflineplus">+          }</span>
<a href="#l35.354"></a><span id="l35.354">         ]]&gt;&lt;/body&gt;</span>
<a href="#l35.355"></a><span id="l35.355">       &lt;/method&gt;</span>
<a href="#l35.356"></a><span id="l35.356"> </span>
<a href="#l35.357"></a><span id="l35.357">       &lt;method name=&quot;isEditable&quot;&gt;</span>
<a href="#l35.358"></a><span id="l35.358">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l35.359"></a><span id="l35.359">         &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l35.360"></a><span id="l35.360">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l35.361"></a><span id="l35.361">           return false;</span>
<a href="#l35.362"></a><span id="l35.362" class="difflineat">@@ -1034,32 +1034,35 @@</span>
<a href="#l35.363"></a><span id="l35.363">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l35.364"></a><span id="l35.364">         ]]&gt;&lt;/body&gt;</span>
<a href="#l35.365"></a><span id="l35.365">       &lt;/method&gt;</span>
<a href="#l35.366"></a><span id="l35.366">     &lt;/implementation&gt;</span>
<a href="#l35.367"></a><span id="l35.367">     &lt;handlers&gt;</span>
<a href="#l35.368"></a><span id="l35.368">       &lt;handler event=&quot;select&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.369"></a><span id="l35.369">         this.compositeCalendar.defaultCalendar = this.getCalendar(this.tree.currentIndex);</span>
<a href="#l35.370"></a><span id="l35.370">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l35.371"></a><span id="l35.371" class="difflineplus">+</span>
<a href="#l35.372"></a><span id="l35.372">       &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_DELETE&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.373"></a><span id="l35.373">         if (this.writable) {</span>
<a href="#l35.374"></a><span id="l35.374">             promptDeleteCalendar(this.compositeCalendar.defaultCalendar);</span>
<a href="#l35.375"></a><span id="l35.375">             event.preventDefault();</span>
<a href="#l35.376"></a><span id="l35.376">         }</span>
<a href="#l35.377"></a><span id="l35.377">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l35.378"></a><span id="l35.378" class="difflineplus">+</span>
<a href="#l35.379"></a><span id="l35.379">       &lt;!-- use key=&quot; &quot; since keycode=&quot;VK_SPACE&quot; doesn't work --&gt;</span>
<a href="#l35.380"></a><span id="l35.380">       &lt;handler event=&quot;keypress&quot; key=&quot; &quot;&gt;&lt;![CDATA[</span>
<a href="#l35.381"></a><span id="l35.381">         if (this.tree.currentIndex &gt; -1) {</span>
<a href="#l35.382"></a><span id="l35.382">             this.cycleCell(this.tree.currentIndex, this.getColumn(&quot;checkbox-treecol&quot;));</span>
<a href="#l35.383"></a><span id="l35.383">             event.preventDefault();</span>
<a href="#l35.384"></a><span id="l35.384">         }</span>
<a href="#l35.385"></a><span id="l35.385">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l35.386"></a><span id="l35.386" class="difflineplus">+</span>
<a href="#l35.387"></a><span id="l35.387">       &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_DOWN&quot; modifiers=&quot;control&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.388"></a><span id="l35.388">         if (!this.allowDrag) {</span>
<a href="#l35.389"></a><span id="l35.389" class="difflineminus">-          return;</span>
<a href="#l35.390"></a><span id="l35.390" class="difflineplus">+            return;</span>
<a href="#l35.391"></a><span id="l35.391">         }</span>
<a href="#l35.392"></a><span id="l35.392"> </span>
<a href="#l35.393"></a><span id="l35.393">         let idx = this.tree.currentIndex;</span>
<a href="#l35.394"></a><span id="l35.394"> </span>
<a href="#l35.395"></a><span id="l35.395">         if (idx &lt; this.mCalendarList.length - 1) {</span>
<a href="#l35.396"></a><span id="l35.396">             this.mCalendarList.splice(idx + 1, 0, this.mCalendarList.splice(idx, 1)[0]);</span>
<a href="#l35.397"></a><span id="l35.397">             this.treebox.invalidateRange(idx, idx + 1);</span>
<a href="#l35.398"></a><span id="l35.398"> </span>
<a href="#l35.399"></a><span id="l35.399" class="difflineat">@@ -1072,19 +1075,20 @@</span>
<a href="#l35.400"></a><span id="l35.400">             }</span>
<a href="#l35.401"></a><span id="l35.401"> </span>
<a href="#l35.402"></a><span id="l35.402">             // Fire event</span>
<a href="#l35.403"></a><span id="l35.403">             this.sortOrderChanged();</span>
<a href="#l35.404"></a><span id="l35.404">         }</span>
<a href="#l35.405"></a><span id="l35.405">         // Don't call the default &lt;key&gt; handler.</span>
<a href="#l35.406"></a><span id="l35.406">         event.preventDefault();</span>
<a href="#l35.407"></a><span id="l35.407">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l35.408"></a><span id="l35.408" class="difflineplus">+</span>
<a href="#l35.409"></a><span id="l35.409">       &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_UP&quot; modifiers=&quot;control&quot;&gt;&lt;![CDATA[</span>
<a href="#l35.410"></a><span id="l35.410">         if (!this.allowDrag) {</span>
<a href="#l35.411"></a><span id="l35.411" class="difflineminus">-          return;</span>
<a href="#l35.412"></a><span id="l35.412" class="difflineplus">+            return;</span>
<a href="#l35.413"></a><span id="l35.413">         }</span>
<a href="#l35.414"></a><span id="l35.414"> </span>
<a href="#l35.415"></a><span id="l35.415">         let idx = this.tree.currentIndex;</span>
<a href="#l35.416"></a><span id="l35.416">         if (idx &gt; 0) {</span>
<a href="#l35.417"></a><span id="l35.417">             this.mCalendarList.splice(idx - 1, 0, this.mCalendarList.splice(idx, 1)[0]);</span>
<a href="#l35.418"></a><span id="l35.418">             this.treebox.invalidateRange(idx - 1, idx);</span>
<a href="#l35.419"></a><span id="l35.419"> </span>
<a href="#l35.420"></a><span id="l35.420">             if (this.tree.view.selection.isSelected(idx)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-subscriptions-list.xml</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-subscriptions-list.xml</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1,70 +1,60 @@</span>
<a href="#l36.4"></a><span id="l36.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l36.5"></a><span id="l36.5" class="difflineminus">-</span>
<a href="#l36.6"></a><span id="l36.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l36.7"></a><span id="l36.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l36.8"></a><span id="l36.8">    - file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l36.9"></a><span id="l36.9"> --&gt;</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11"> &lt;bindings id=&quot;calendar-subscriptions-list-bindings&quot;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-  xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-  xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-  xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineplus">+          xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l36.20"></a><span id="l36.20"> </span>
<a href="#l36.21"></a><span id="l36.21">   &lt;binding id=&quot;calendar-subscriptions-richlistbox&quot;</span>
<a href="#l36.22"></a><span id="l36.22">            extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistbox&quot;</span>
<a href="#l36.23"></a><span id="l36.23">            xbl:inherits=&quot;flex&quot;&gt;</span>
<a href="#l36.24"></a><span id="l36.24"> </span>
<a href="#l36.25"></a><span id="l36.25">     &lt;implementation&gt;</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineminus">-</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineminus">-      &lt;!-- methods --&gt;</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineminus">-</span>
<a href="#l36.29"></a><span id="l36.29">       &lt;method name=&quot;addCalendar&quot;&gt;</span>
<a href="#l36.30"></a><span id="l36.30">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l36.31"></a><span id="l36.31">         &lt;parameter name=&quot;bSubscribed&quot;/&gt;</span>
<a href="#l36.32"></a><span id="l36.32">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l36.33"></a><span id="l36.33">           let newNode = createXULElement(&quot;calendar-subscriptions-richlistitem&quot;);</span>
<a href="#l36.34"></a><span id="l36.34">           this.appendChild(newNode);</span>
<a href="#l36.35"></a><span id="l36.35">           newNode.setAttribute(&quot;anonid&quot;, &quot;subscriptions-listitem&quot;);</span>
<a href="#l36.36"></a><span id="l36.36">           newNode.calendar = aCalendar;</span>
<a href="#l36.37"></a><span id="l36.37">           newNode.subscribed = bSubscribed;</span>
<a href="#l36.38"></a><span id="l36.38">         ]]&gt;&lt;/body&gt;</span>
<a href="#l36.39"></a><span id="l36.39">       &lt;/method&gt;</span>
<a href="#l36.40"></a><span id="l36.40"> </span>
<a href="#l36.41"></a><span id="l36.41">       &lt;method name=&quot;clear&quot;&gt;</span>
<a href="#l36.42"></a><span id="l36.42">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l36.43"></a><span id="l36.43">           while (this.hasChildNodes()) {</span>
<a href="#l36.44"></a><span id="l36.44" class="difflineminus">-            this.lastChild.remove();</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineplus">+              this.lastChild.remove();</span>
<a href="#l36.46"></a><span id="l36.46">           }</span>
<a href="#l36.47"></a><span id="l36.47">         ]]&gt;&lt;/body&gt;</span>
<a href="#l36.48"></a><span id="l36.48">       &lt;/method&gt;</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineminus">-</span>
<a href="#l36.50"></a><span id="l36.50">     &lt;/implementation&gt;</span>
<a href="#l36.51"></a><span id="l36.51">   &lt;/binding&gt;</span>
<a href="#l36.52"></a><span id="l36.52"> </span>
<a href="#l36.53"></a><span id="l36.53">   &lt;binding id=&quot;calendar-subscriptions-richlistitem&quot;</span>
<a href="#l36.54"></a><span id="l36.54">            extends=&quot;chrome://global/content/bindings/richlistbox.xml#richlistitem&quot;&gt;</span>
<a href="#l36.55"></a><span id="l36.55">     &lt;content&gt;</span>
<a href="#l36.56"></a><span id="l36.56">       &lt;xul:hbox flex=&quot;1&quot;&gt;</span>
<a href="#l36.57"></a><span id="l36.57">         &lt;xul:checkbox anonid=&quot;subscription-checkbox&quot; class=&quot;calendar-subscriptions-richlistitem-checkbox&quot;/&gt;</span>
<a href="#l36.58"></a><span id="l36.58">         &lt;xul:label anonid=&quot;subscription-name&quot; flex=&quot;1&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l36.59"></a><span id="l36.59">       &lt;/xul:hbox&gt;</span>
<a href="#l36.60"></a><span id="l36.60">     &lt;/content&gt;</span>
<a href="#l36.61"></a><span id="l36.61"> </span>
<a href="#l36.62"></a><span id="l36.62">     &lt;implementation&gt;</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineminus">-</span>
<a href="#l36.64"></a><span id="l36.64" class="difflineminus">-      &lt;!-- fields --&gt;</span>
<a href="#l36.65"></a><span id="l36.65" class="difflineminus">-</span>
<a href="#l36.66"></a><span id="l36.66">       &lt;field name=&quot;mCalendar&quot;&gt;null&lt;/field&gt;</span>
<a href="#l36.67"></a><span id="l36.67">       &lt;field name=&quot;mSubscribed&quot;&gt;false&lt;/field&gt;</span>
<a href="#l36.68"></a><span id="l36.68"> </span>
<a href="#l36.69"></a><span id="l36.69" class="difflineminus">-      &lt;!-- properties --&gt;</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineminus">-</span>
<a href="#l36.71"></a><span id="l36.71">       &lt;property name=&quot;calendar&quot;&gt;</span>
<a href="#l36.72"></a><span id="l36.72">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l36.73"></a><span id="l36.73">           return this.mCalendar;</span>
<a href="#l36.74"></a><span id="l36.74">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l36.75"></a><span id="l36.75">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l36.76"></a><span id="l36.76">           this.setCalendar(val);</span>
<a href="#l36.77"></a><span id="l36.77">           return val;</span>
<a href="#l36.78"></a><span id="l36.78">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l36.79"></a><span id="l36.79" class="difflineat">@@ -81,66 +71,59 @@</span>
<a href="#l36.80"></a><span id="l36.80">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l36.81"></a><span id="l36.81">       &lt;/property&gt;</span>
<a href="#l36.82"></a><span id="l36.82"> </span>
<a href="#l36.83"></a><span id="l36.83">       &lt;property name=&quot;checked&quot;&gt;</span>
<a href="#l36.84"></a><span id="l36.84">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l36.85"></a><span id="l36.85">           let checkbox = document.getAnonymousElementByAttribute(</span>
<a href="#l36.86"></a><span id="l36.86">             this, &quot;anonid&quot;, &quot;subscription-checkbox&quot;);</span>
<a href="#l36.87"></a><span id="l36.87">           if (checkbox.getAttribute(&quot;checked&quot;) == &quot;true&quot;) {</span>
<a href="#l36.88"></a><span id="l36.88" class="difflineminus">-            return true;</span>
<a href="#l36.89"></a><span id="l36.89" class="difflineplus">+              return true;</span>
<a href="#l36.90"></a><span id="l36.90">           } else {</span>
<a href="#l36.91"></a><span id="l36.91" class="difflineminus">-            return false;</span>
<a href="#l36.92"></a><span id="l36.92" class="difflineplus">+              return false;</span>
<a href="#l36.93"></a><span id="l36.93">           }</span>
<a href="#l36.94"></a><span id="l36.94">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l36.95"></a><span id="l36.95">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l36.96"></a><span id="l36.96">           let checkbox = document.getAnonymousElementByAttribute(</span>
<a href="#l36.97"></a><span id="l36.97">             this, &quot;anonid&quot;, &quot;subscription-checkbox&quot;);</span>
<a href="#l36.98"></a><span id="l36.98">           if (val) {</span>
<a href="#l36.99"></a><span id="l36.99" class="difflineminus">-            checkbox.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l36.100"></a><span id="l36.100" class="difflineplus">+              checkbox.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l36.101"></a><span id="l36.101">           } else {</span>
<a href="#l36.102"></a><span id="l36.102" class="difflineminus">-            checkbox.removeAttribute(&quot;checked&quot;);</span>
<a href="#l36.103"></a><span id="l36.103" class="difflineplus">+              checkbox.removeAttribute(&quot;checked&quot;);</span>
<a href="#l36.104"></a><span id="l36.104">           }</span>
<a href="#l36.105"></a><span id="l36.105">           return val;</span>
<a href="#l36.106"></a><span id="l36.106">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l36.107"></a><span id="l36.107">       &lt;/property&gt;</span>
<a href="#l36.108"></a><span id="l36.108"> </span>
<a href="#l36.109"></a><span id="l36.109">       &lt;property name=&quot;disabled&quot;&gt;</span>
<a href="#l36.110"></a><span id="l36.110">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l36.111"></a><span id="l36.111">           let checkbox = document.getAnonymousElementByAttribute(</span>
<a href="#l36.112"></a><span id="l36.112">             this, &quot;anonid&quot;, &quot;subscription-checkbox&quot;);</span>
<a href="#l36.113"></a><span id="l36.113">           if (checkbox.getAttribute(&quot;disabled&quot;) == &quot;true&quot;) {</span>
<a href="#l36.114"></a><span id="l36.114" class="difflineminus">-            return true;</span>
<a href="#l36.115"></a><span id="l36.115" class="difflineplus">+              return true;</span>
<a href="#l36.116"></a><span id="l36.116">           } else {</span>
<a href="#l36.117"></a><span id="l36.117" class="difflineminus">-            return false;</span>
<a href="#l36.118"></a><span id="l36.118" class="difflineplus">+              return false;</span>
<a href="#l36.119"></a><span id="l36.119">           }</span>
<a href="#l36.120"></a><span id="l36.120">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l36.121"></a><span id="l36.121">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l36.122"></a><span id="l36.122">           let checkbox = document.getAnonymousElementByAttribute(</span>
<a href="#l36.123"></a><span id="l36.123">             this, &quot;anonid&quot;, &quot;subscription-checkbox&quot;);</span>
<a href="#l36.124"></a><span id="l36.124">           if (val) {</span>
<a href="#l36.125"></a><span id="l36.125" class="difflineminus">-            checkbox.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l36.126"></a><span id="l36.126" class="difflineplus">+              checkbox.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l36.127"></a><span id="l36.127">           } else {</span>
<a href="#l36.128"></a><span id="l36.128" class="difflineminus">-            checkbox.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l36.129"></a><span id="l36.129" class="difflineplus">+              checkbox.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l36.130"></a><span id="l36.130">           }</span>
<a href="#l36.131"></a><span id="l36.131">           return val;</span>
<a href="#l36.132"></a><span id="l36.132">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l36.133"></a><span id="l36.133">       &lt;/property&gt;</span>
<a href="#l36.134"></a><span id="l36.134"> </span>
<a href="#l36.135"></a><span id="l36.135" class="difflineminus">-      &lt;!-- methods --&gt;</span>
<a href="#l36.136"></a><span id="l36.136" class="difflineminus">-</span>
<a href="#l36.137"></a><span id="l36.137">       &lt;method name=&quot;setCalendar&quot;&gt;</span>
<a href="#l36.138"></a><span id="l36.138">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l36.139"></a><span id="l36.139" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l36.140"></a><span id="l36.140" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l36.141"></a><span id="l36.141" class="difflineminus">-            this.mCalendar = aCalendar;</span>
<a href="#l36.142"></a><span id="l36.142" class="difflineminus">-            let label = document.getAnonymousElementByAttribute(</span>
<a href="#l36.143"></a><span id="l36.143" class="difflineminus">-                this, &quot;anonid&quot;, &quot;subscription-name&quot;);</span>
<a href="#l36.144"></a><span id="l36.144" class="difflineminus">-            label.setAttribute(&quot;value&quot;, aCalendar.name);</span>
<a href="#l36.145"></a><span id="l36.145" class="difflineminus">-          ]]&gt;</span>
<a href="#l36.146"></a><span id="l36.146" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l36.147"></a><span id="l36.147" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l36.148"></a><span id="l36.148" class="difflineplus">+          this.mCalendar = aCalendar;</span>
<a href="#l36.149"></a><span id="l36.149" class="difflineplus">+          let label = document.getAnonymousElementByAttribute(</span>
<a href="#l36.150"></a><span id="l36.150" class="difflineplus">+              this, &quot;anonid&quot;, &quot;subscription-name&quot;);</span>
<a href="#l36.151"></a><span id="l36.151" class="difflineplus">+          label.setAttribute(&quot;value&quot;, aCalendar.name);</span>
<a href="#l36.152"></a><span id="l36.152" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l36.153"></a><span id="l36.153">       &lt;/method&gt;</span>
<a href="#l36.154"></a><span id="l36.154" class="difflineminus">-</span>
<a href="#l36.155"></a><span id="l36.155">     &lt;/implementation&gt;</span>
<a href="#l36.156"></a><span id="l36.156" class="difflineminus">-</span>
<a href="#l36.157"></a><span id="l36.157">   &lt;/binding&gt;</span>
<a href="#l36.158"></a><span id="l36.158" class="difflineminus">-</span>
<a href="#l36.159"></a><span id="l36.159"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -20,17 +20,17 @@</span>
<a href="#l37.4"></a><span id="l37.4">         &lt;xul:image class=&quot;menulist-icon&quot; xbl:inherits=&quot;src=image,src&quot;/&gt;</span>
<a href="#l37.5"></a><span id="l37.5">         &lt;xul:label class=&quot;menulist-label&quot; xbl:inherits=&quot;value=label,crop,accesskey&quot; crop=&quot;right&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l37.6"></a><span id="l37.6">       &lt;/xul:hbox&gt;</span>
<a href="#l37.7"></a><span id="l37.7">       &lt;xul:dropmarker class=&quot;menulist-dropmarker&quot; type=&quot;menu&quot; xbl:inherits=&quot;disabled,open&quot;/&gt;</span>
<a href="#l37.8"></a><span id="l37.8">       &lt;children includes=&quot;menupopup|panel&quot;/&gt;</span>
<a href="#l37.9"></a><span id="l37.9">     &lt;/content&gt;</span>
<a href="#l37.10"></a><span id="l37.10">   &lt;/binding&gt;</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-   &lt;binding id=&quot;category-panel&quot; extends=&quot;chrome://global/content/bindings/popup.xml#panel&quot;&gt;</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+  &lt;binding id=&quot;category-panel&quot; extends=&quot;chrome://global/content/bindings/popup.xml#panel&quot;&gt;</span>
<a href="#l37.14"></a><span id="l37.14">     &lt;resources&gt;</span>
<a href="#l37.15"></a><span id="l37.15">       &lt;stylesheet src=&quot;chrome://calendar/skin/widgets/calendar-widgets.css&quot;/&gt;</span>
<a href="#l37.16"></a><span id="l37.16">     &lt;/resources&gt;</span>
<a href="#l37.17"></a><span id="l37.17">     &lt;content&gt;</span>
<a href="#l37.18"></a><span id="l37.18">         &lt;xul:textbox  anonid=&quot;category-textbox&quot;</span>
<a href="#l37.19"></a><span id="l37.19">                       class=&quot;categories-textbox&quot;</span>
<a href="#l37.20"></a><span id="l37.20">                       type=&quot;search&quot;</span>
<a href="#l37.21"></a><span id="l37.21">                       searchbutton=&quot;true&quot;</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineat">@@ -42,138 +42,145 @@</span>
<a href="#l37.23"></a><span id="l37.23">                    onselect=&quot;document.getBindingParent(this).selectCategory()&quot;</span>
<a href="#l37.24"></a><span id="l37.24">                    selType=&quot;multiple&quot;</span>
<a href="#l37.25"></a><span id="l37.25">                    &gt;</span>
<a href="#l37.26"></a><span id="l37.26">         &lt;children/&gt;</span>
<a href="#l37.27"></a><span id="l37.27">       &lt;/xul:listbox&gt;</span>
<a href="#l37.28"></a><span id="l37.28">     &lt;/content&gt;</span>
<a href="#l37.29"></a><span id="l37.29">     &lt;implementation&gt;</span>
<a href="#l37.30"></a><span id="l37.30">       &lt;field name=&quot;_maxCount&quot;&gt;0&lt;/field&gt;</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineplus">+</span>
<a href="#l37.32"></a><span id="l37.32">       &lt;property name=&quot;categories&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l37.33"></a><span id="l37.33">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineminus">-            let categoryListbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;categories-listbox&quot;);</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineminus">-            if (this.maxCount == 1) {</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineminus">-                let selectedItem = categoryListbox.selectedItem;</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineminus">-                return selectedItem ? [selectedItem.getAttribute(&quot;value&quot;)] : [];</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineminus">-            } else {</span>
<a href="#l37.39"></a><span id="l37.39" class="difflineminus">-                let checkedNodes = categoryListbox.getElementsByAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l37.40"></a><span id="l37.40" class="difflineminus">-                let sliceEnd = this.maxCount &gt; 0 ? this.maxCount : checkedNodes.length;</span>
<a href="#l37.41"></a><span id="l37.41" class="difflineminus">-                return Array.slice(checkedNodes, 0, sliceEnd)</span>
<a href="#l37.42"></a><span id="l37.42" class="difflineminus">-                            .map(x =&gt; x.getAttribute(&quot;value&quot;));</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineminus">-            }</span>
<a href="#l37.44"></a><span id="l37.44" class="difflineplus">+          let categoryListbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;categories-listbox&quot;);</span>
<a href="#l37.45"></a><span id="l37.45" class="difflineplus">+          if (this.maxCount == 1) {</span>
<a href="#l37.46"></a><span id="l37.46" class="difflineplus">+              let selectedItem = categoryListbox.selectedItem;</span>
<a href="#l37.47"></a><span id="l37.47" class="difflineplus">+              return selectedItem ? [selectedItem.getAttribute(&quot;value&quot;)] : [];</span>
<a href="#l37.48"></a><span id="l37.48" class="difflineplus">+          } else {</span>
<a href="#l37.49"></a><span id="l37.49" class="difflineplus">+              let checkedNodes = categoryListbox.getElementsByAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l37.50"></a><span id="l37.50" class="difflineplus">+              let sliceEnd = this.maxCount &gt; 0 ? this.maxCount : checkedNodes.length;</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineplus">+              return Array.slice(checkedNodes, 0, sliceEnd)</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineplus">+                          .map(x =&gt; x.getAttribute(&quot;value&quot;));</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineplus">+          }</span>
<a href="#l37.54"></a><span id="l37.54">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l37.55"></a><span id="l37.55">       &lt;/property&gt;</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineplus">+</span>
<a href="#l37.57"></a><span id="l37.57">       &lt;property name=&quot;maxCount&quot;&gt;</span>
<a href="#l37.58"></a><span id="l37.58">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l37.59"></a><span id="l37.59" class="difflineminus">-            return this._maxCount;</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineplus">+          return this._maxCount;</span>
<a href="#l37.61"></a><span id="l37.61">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l37.62"></a><span id="l37.62">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineminus">-            if (this._maxCount != val) {</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineminus">-                this._maxCount = val;</span>
<a href="#l37.65"></a><span id="l37.65" class="difflineminus">-                this.setupSelection();</span>
<a href="#l37.66"></a><span id="l37.66" class="difflineminus">-            }</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineplus">+          if (this._maxCount != val) {</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineplus">+              this._maxCount = val;</span>
<a href="#l37.69"></a><span id="l37.69" class="difflineplus">+              this.setupSelection();</span>
<a href="#l37.70"></a><span id="l37.70" class="difflineplus">+          }</span>
<a href="#l37.71"></a><span id="l37.71">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l37.72"></a><span id="l37.72">       &lt;/property&gt;</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineplus">+</span>
<a href="#l37.74"></a><span id="l37.74">       &lt;method name=&quot;selectCategory&quot;&gt;</span>
<a href="#l37.75"></a><span id="l37.75">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.76"></a><span id="l37.76" class="difflineminus">-            this.setupSelection();</span>
<a href="#l37.77"></a><span id="l37.77" class="difflineminus">-            if (this.maxCount == 1) {</span>
<a href="#l37.78"></a><span id="l37.78" class="difflineminus">-                this.hidePopup();</span>
<a href="#l37.79"></a><span id="l37.79" class="difflineminus">-            }</span>
<a href="#l37.80"></a><span id="l37.80" class="difflineplus">+          this.setupSelection();</span>
<a href="#l37.81"></a><span id="l37.81" class="difflineplus">+          if (this.maxCount == 1) {</span>
<a href="#l37.82"></a><span id="l37.82" class="difflineplus">+              this.hidePopup();</span>
<a href="#l37.83"></a><span id="l37.83" class="difflineplus">+          }</span>
<a href="#l37.84"></a><span id="l37.84">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.85"></a><span id="l37.85">       &lt;/method&gt;</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineplus">+</span>
<a href="#l37.87"></a><span id="l37.87">       &lt;method name=&quot;setupSelection&quot;&gt;</span>
<a href="#l37.88"></a><span id="l37.88">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.89"></a><span id="l37.89" class="difflineminus">-            let categoryListbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;categories-listbox&quot;);</span>
<a href="#l37.90"></a><span id="l37.90" class="difflineminus">-            categoryListbox.setAttribute(&quot;seltype&quot;, this.maxCount == 1 ? &quot;single&quot; : &quot;multiple&quot;);</span>
<a href="#l37.91"></a><span id="l37.91" class="difflineplus">+          let categoryListbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;categories-listbox&quot;);</span>
<a href="#l37.92"></a><span id="l37.92" class="difflineplus">+          categoryListbox.setAttribute(&quot;seltype&quot;, this.maxCount == 1 ? &quot;single&quot; : &quot;multiple&quot;);</span>
<a href="#l37.93"></a><span id="l37.93"> </span>
<a href="#l37.94"></a><span id="l37.94" class="difflineminus">-            if (this.maxCount == 1) {</span>
<a href="#l37.95"></a><span id="l37.95" class="difflineminus">-                for (let node of categoryListbox.childNodes) {</span>
<a href="#l37.96"></a><span id="l37.96" class="difflineminus">-                    // Single selection doesn't have checkboxes</span>
<a href="#l37.97"></a><span id="l37.97" class="difflineminus">-                    node.removeAttribute(&quot;type&quot;);</span>
<a href="#l37.98"></a><span id="l37.98" class="difflineplus">+          if (this.maxCount == 1) {</span>
<a href="#l37.99"></a><span id="l37.99" class="difflineplus">+              for (let node of categoryListbox.childNodes) {</span>
<a href="#l37.100"></a><span id="l37.100" class="difflineplus">+                  // Single selection doesn't have checkboxes</span>
<a href="#l37.101"></a><span id="l37.101" class="difflineplus">+                  node.removeAttribute(&quot;type&quot;);</span>
<a href="#l37.102"></a><span id="l37.102"> </span>
<a href="#l37.103"></a><span id="l37.103" class="difflineminus">-                    // Even though we have single select, these may be checked</span>
<a href="#l37.104"></a><span id="l37.104" class="difflineminus">-                    // in case the user switches between calendars that support</span>
<a href="#l37.105"></a><span id="l37.105" class="difflineminus">-                    // one vs multiple categories. Uncheck the other nodes to</span>
<a href="#l37.106"></a><span id="l37.106" class="difflineminus">-                    // make sure the UX is not weird.</span>
<a href="#l37.107"></a><span id="l37.107" class="difflineminus">-                    setBooleanAttribute(node, &quot;checked&quot;, node == categoryListbox.selectedItem);</span>
<a href="#l37.108"></a><span id="l37.108" class="difflineminus">-                }</span>
<a href="#l37.109"></a><span id="l37.109" class="difflineminus">-            } else {</span>
<a href="#l37.110"></a><span id="l37.110" class="difflineminus">-                let categoryTextbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;category-textbox&quot;);</span>
<a href="#l37.111"></a><span id="l37.111" class="difflineminus">-                let maxCountReached = this.maxCount &gt; 0 &amp;&amp; this.categories.length == this.maxCount;</span>
<a href="#l37.112"></a><span id="l37.112" class="difflineminus">-                setBooleanAttribute(categoryTextbox, &quot;disabled&quot;, maxCountReached);</span>
<a href="#l37.113"></a><span id="l37.113" class="difflineplus">+                  // Even though we have single select, these may be checked</span>
<a href="#l37.114"></a><span id="l37.114" class="difflineplus">+                  // in case the user switches between calendars that support</span>
<a href="#l37.115"></a><span id="l37.115" class="difflineplus">+                  // one vs multiple categories. Uncheck the other nodes to</span>
<a href="#l37.116"></a><span id="l37.116" class="difflineplus">+                  // make sure the UX is not weird.</span>
<a href="#l37.117"></a><span id="l37.117" class="difflineplus">+                  setBooleanAttribute(node, &quot;checked&quot;, node == categoryListbox.selectedItem);</span>
<a href="#l37.118"></a><span id="l37.118" class="difflineplus">+              }</span>
<a href="#l37.119"></a><span id="l37.119" class="difflineplus">+          } else {</span>
<a href="#l37.120"></a><span id="l37.120" class="difflineplus">+              let categoryTextbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;category-textbox&quot;);</span>
<a href="#l37.121"></a><span id="l37.121" class="difflineplus">+              let maxCountReached = this.maxCount &gt; 0 &amp;&amp; this.categories.length == this.maxCount;</span>
<a href="#l37.122"></a><span id="l37.122" class="difflineplus">+              setBooleanAttribute(categoryTextbox, &quot;disabled&quot;, maxCountReached);</span>
<a href="#l37.123"></a><span id="l37.123"> </span>
<a href="#l37.124"></a><span id="l37.124" class="difflineminus">-                for (let node of categoryListbox.childNodes) {</span>
<a href="#l37.125"></a><span id="l37.125" class="difflineminus">-                    // Multiselect has checkboxes</span>
<a href="#l37.126"></a><span id="l37.126" class="difflineminus">-                    node.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l37.127"></a><span id="l37.127" class="difflineplus">+              for (let node of categoryListbox.childNodes) {</span>
<a href="#l37.128"></a><span id="l37.128" class="difflineplus">+                  // Multiselect has checkboxes</span>
<a href="#l37.129"></a><span id="l37.129" class="difflineplus">+                  node.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l37.130"></a><span id="l37.130"> </span>
<a href="#l37.131"></a><span id="l37.131" class="difflineminus">-                    if (maxCountReached &amp;&amp; node.getAttribute(&quot;checked&quot;) != &quot;true&quot;) {</span>
<a href="#l37.132"></a><span id="l37.132" class="difflineminus">-                        // If the maxcount is reached, disable all unchecked items</span>
<a href="#l37.133"></a><span id="l37.133" class="difflineminus">-                        node.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l37.134"></a><span id="l37.134" class="difflineminus">-                    } else if (!maxCountReached) {</span>
<a href="#l37.135"></a><span id="l37.135" class="difflineminus">-                        // If its not reached, remove the disabled attribute</span>
<a href="#l37.136"></a><span id="l37.136" class="difflineminus">-                        node.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l37.137"></a><span id="l37.137" class="difflineminus">-                    }</span>
<a href="#l37.138"></a><span id="l37.138" class="difflineminus">-                }</span>
<a href="#l37.139"></a><span id="l37.139" class="difflineminus">-            }</span>
<a href="#l37.140"></a><span id="l37.140" class="difflineplus">+                  if (maxCountReached &amp;&amp; node.getAttribute(&quot;checked&quot;) != &quot;true&quot;) {</span>
<a href="#l37.141"></a><span id="l37.141" class="difflineplus">+                      // If the maxcount is reached, disable all unchecked items</span>
<a href="#l37.142"></a><span id="l37.142" class="difflineplus">+                      node.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l37.143"></a><span id="l37.143" class="difflineplus">+                  } else if (!maxCountReached) {</span>
<a href="#l37.144"></a><span id="l37.144" class="difflineplus">+                      // If its not reached, remove the disabled attribute</span>
<a href="#l37.145"></a><span id="l37.145" class="difflineplus">+                      node.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l37.146"></a><span id="l37.146" class="difflineplus">+                  }</span>
<a href="#l37.147"></a><span id="l37.147" class="difflineplus">+              }</span>
<a href="#l37.148"></a><span id="l37.148" class="difflineplus">+          }</span>
<a href="#l37.149"></a><span id="l37.149">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.150"></a><span id="l37.150">       &lt;/method&gt;</span>
<a href="#l37.151"></a><span id="l37.151" class="difflineplus">+</span>
<a href="#l37.152"></a><span id="l37.152">       &lt;method name=&quot;insertCategory&quot;&gt;</span>
<a href="#l37.153"></a><span id="l37.153">         &lt;parameter name=&quot;category&quot; /&gt;</span>
<a href="#l37.154"></a><span id="l37.154">         &lt;parameter name=&quot;categories&quot; /&gt;</span>
<a href="#l37.155"></a><span id="l37.155">         &lt;parameter name=&quot;categoryListbox&quot; /&gt;</span>
<a href="#l37.156"></a><span id="l37.156">         &lt;parameter name=&quot;compare&quot; /&gt;</span>
<a href="#l37.157"></a><span id="l37.157">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.158"></a><span id="l37.158" class="difflineminus">-            let newIndex = cal.binaryInsert(categories, category, compare, true);</span>
<a href="#l37.159"></a><span id="l37.159" class="difflineminus">-            let item = categoryListbox.childNodes[Math.min(newIndex, categoryListbox.childNodes.length - 1)];</span>
<a href="#l37.160"></a><span id="l37.160" class="difflineplus">+          let newIndex = cal.binaryInsert(categories, category, compare, true);</span>
<a href="#l37.161"></a><span id="l37.161" class="difflineplus">+          let item = categoryListbox.childNodes[Math.min(newIndex, categoryListbox.childNodes.length - 1)];</span>
<a href="#l37.162"></a><span id="l37.162"> </span>
<a href="#l37.163"></a><span id="l37.163" class="difflineminus">-            if (!item || item.getAttribute(&quot;value&quot;) != category) {</span>
<a href="#l37.164"></a><span id="l37.164" class="difflineminus">-                // The item doesn't exist, insert it at the correct spot.</span>
<a href="#l37.165"></a><span id="l37.165" class="difflineminus">-                item = categoryListbox.insertItemAt(newIndex, category, category);</span>
<a href="#l37.166"></a><span id="l37.166" class="difflineplus">+          if (!item || item.getAttribute(&quot;value&quot;) != category) {</span>
<a href="#l37.167"></a><span id="l37.167" class="difflineplus">+              // The item doesn't exist, insert it at the correct spot.</span>
<a href="#l37.168"></a><span id="l37.168" class="difflineplus">+              item = categoryListbox.insertItemAt(newIndex, category, category);</span>
<a href="#l37.169"></a><span id="l37.169"> </span>
<a href="#l37.170"></a><span id="l37.170" class="difflineminus">-                if (this.maxCount != 1) {</span>
<a href="#l37.171"></a><span id="l37.171" class="difflineminus">-                    item.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l37.172"></a><span id="l37.172" class="difflineminus">-                }</span>
<a href="#l37.173"></a><span id="l37.173" class="difflineminus">-            }</span>
<a href="#l37.174"></a><span id="l37.174" class="difflineplus">+              if (this.maxCount != 1) {</span>
<a href="#l37.175"></a><span id="l37.175" class="difflineplus">+                  item.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l37.176"></a><span id="l37.176" class="difflineplus">+              }</span>
<a href="#l37.177"></a><span id="l37.177" class="difflineplus">+          }</span>
<a href="#l37.178"></a><span id="l37.178"> </span>
<a href="#l37.179"></a><span id="l37.179" class="difflineminus">-            item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l37.180"></a><span id="l37.180" class="difflineminus">-            return item;</span>
<a href="#l37.181"></a><span id="l37.181" class="difflineplus">+          item.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l37.182"></a><span id="l37.182" class="difflineplus">+          return item;</span>
<a href="#l37.183"></a><span id="l37.183">           ]]&gt;&lt;/body&gt;</span>
<a href="#l37.184"></a><span id="l37.184">       &lt;/method&gt;</span>
<a href="#l37.185"></a><span id="l37.185" class="difflineplus">+</span>
<a href="#l37.186"></a><span id="l37.186">       &lt;method name=&quot;addNewCategory&quot;&gt;</span>
<a href="#l37.187"></a><span id="l37.187" class="difflineminus">-      &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.188"></a><span id="l37.188" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.189"></a><span id="l37.189">           let categoryListbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;categories-listbox&quot;);</span>
<a href="#l37.190"></a><span id="l37.190">           let categoryTextbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;category-textbox&quot;);</span>
<a href="#l37.191"></a><span id="l37.191">           let category = categoryTextbox.value;</span>
<a href="#l37.192"></a><span id="l37.192"> </span>
<a href="#l37.193"></a><span id="l37.193">           if (!category) {</span>
<a href="#l37.194"></a><span id="l37.194" class="difflineminus">-            return;</span>
<a href="#l37.195"></a><span id="l37.195" class="difflineplus">+              return;</span>
<a href="#l37.196"></a><span id="l37.196">           }</span>
<a href="#l37.197"></a><span id="l37.197"> </span>
<a href="#l37.198"></a><span id="l37.198">           let localeCollator = cal.createLocaleCollator();</span>
<a href="#l37.199"></a><span id="l37.199">           let compare = localeCollator.compareString.bind(localeCollator, 0);</span>
<a href="#l37.200"></a><span id="l37.200"> </span>
<a href="#l37.201"></a><span id="l37.201">           let children = categoryListbox.childNodes;</span>
<a href="#l37.202"></a><span id="l37.202">           let categories = [];</span>
<a href="#l37.203"></a><span id="l37.203">           for (let i = 0; i &lt; children.length; i++) {</span>
<a href="#l37.204"></a><span id="l37.204" class="difflineminus">-            categories.push(children[i].label);</span>
<a href="#l37.205"></a><span id="l37.205" class="difflineplus">+              categories.push(children[i].label);</span>
<a href="#l37.206"></a><span id="l37.206">           }</span>
<a href="#l37.207"></a><span id="l37.207"> </span>
<a href="#l37.208"></a><span id="l37.208">           let item = this.insertCategory(category, categories, categoryListbox, compare);</span>
<a href="#l37.209"></a><span id="l37.209">           categoryTextbox.value = &quot;&quot;;</span>
<a href="#l37.210"></a><span id="l37.210"> </span>
<a href="#l37.211"></a><span id="l37.211">           if (this.maxCount == 1) {</span>
<a href="#l37.212"></a><span id="l37.212" class="difflineminus">-            categoryListbox.selectedItem = item;</span>
<a href="#l37.213"></a><span id="l37.213" class="difflineplus">+              categoryListbox.selectedItem = item;</span>
<a href="#l37.214"></a><span id="l37.214">           } else {</span>
<a href="#l37.215"></a><span id="l37.215" class="difflineminus">-            this.selectCategory();</span>
<a href="#l37.216"></a><span id="l37.216" class="difflineplus">+              this.selectCategory();</span>
<a href="#l37.217"></a><span id="l37.217">           }</span>
<a href="#l37.218"></a><span id="l37.218"> </span>
<a href="#l37.219"></a><span id="l37.219">           categoryListbox.ensureElementIsVisible(item);</span>
<a href="#l37.220"></a><span id="l37.220">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.221"></a><span id="l37.221" class="difflineminus">-    &lt;/method&gt;</span>
<a href="#l37.222"></a><span id="l37.222" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l37.223"></a><span id="l37.223" class="difflineplus">+</span>
<a href="#l37.224"></a><span id="l37.224">       &lt;method name=&quot;loadItem&quot;&gt;</span>
<a href="#l37.225"></a><span id="l37.225">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l37.226"></a><span id="l37.226">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.227"></a><span id="l37.227">           let categoryListbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;categories-listbox&quot;);</span>
<a href="#l37.228"></a><span id="l37.228">           let categoryList = getPrefCategoriesArray();</span>
<a href="#l37.229"></a><span id="l37.229"> </span>
<a href="#l37.230"></a><span id="l37.230">           cal.sortArrayByLocaleCollator(categoryList);</span>
<a href="#l37.231"></a><span id="l37.231"> </span>
<a href="#l37.232"></a><span id="l37.232" class="difflineat">@@ -186,28 +193,29 @@</span>
<a href="#l37.233"></a><span id="l37.233">           }</span>
<a href="#l37.234"></a><span id="l37.234"> </span>
<a href="#l37.235"></a><span id="l37.235">           if (aItem) {</span>
<a href="#l37.236"></a><span id="l37.236">               let localeCollator = cal.createLocaleCollator();</span>
<a href="#l37.237"></a><span id="l37.237">               let compare = localeCollator.compareString.bind(localeCollator, 0);</span>
<a href="#l37.238"></a><span id="l37.238"> </span>
<a href="#l37.239"></a><span id="l37.239">               // Ensure the item's categories are in the list and they are checked.</span>
<a href="#l37.240"></a><span id="l37.240">               for (let cat of aItem.getCategories({})) {</span>
<a href="#l37.241"></a><span id="l37.241" class="difflineminus">-                this.insertCategory(cat, categoryList, categoryListbox, compare);</span>
<a href="#l37.242"></a><span id="l37.242" class="difflineplus">+                  this.insertCategory(cat, categoryList, categoryListbox, compare);</span>
<a href="#l37.243"></a><span id="l37.243">               }</span>
<a href="#l37.244"></a><span id="l37.244">           }</span>
<a href="#l37.245"></a><span id="l37.245">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.246"></a><span id="l37.246">       &lt;/method&gt;</span>
<a href="#l37.247"></a><span id="l37.247">     &lt;/implementation&gt;</span>
<a href="#l37.248"></a><span id="l37.248">   &lt;/binding&gt;</span>
<a href="#l37.249"></a><span id="l37.249"> </span>
<a href="#l37.250"></a><span id="l37.250">   &lt;binding id=&quot;doubleimage-toolbarbutton&quot; extends=&quot;chrome://global/content/bindings/toolbarbutton.xml#toolbarbutton&quot;&gt;</span>
<a href="#l37.251"></a><span id="l37.251">     &lt;resources&gt;</span>
<a href="#l37.252"></a><span id="l37.252">       &lt;stylesheet src=&quot;chrome://calendar/skin/widgets/calendar-widgets.css&quot;/&gt;</span>
<a href="#l37.253"></a><span id="l37.253">     &lt;/resources&gt;</span>
<a href="#l37.254"></a><span id="l37.254" class="difflineplus">+</span>
<a href="#l37.255"></a><span id="l37.255">     &lt;content&gt;</span>
<a href="#l37.256"></a><span id="l37.256">       &lt;children includes=&quot;observes|template|menupopup|tooltip&quot;/&gt;</span>
<a href="#l37.257"></a><span id="l37.257">       &lt;xul:image class=&quot;toolbarbutton-icon-begin&quot; xbl:inherits=&quot;validate,src-begin=image,toolbarmode,buttonstyle&quot;/&gt;</span>
<a href="#l37.258"></a><span id="l37.258">       &lt;xul:label class=&quot;toolbarbutton-text&quot; crop=&quot;right&quot; flex=&quot;1&quot;</span>
<a href="#l37.259"></a><span id="l37.259">                  xbl:inherits=&quot;value=label,accesskey,crop,toolbarmode,buttonstyle&quot;/&gt;</span>
<a href="#l37.260"></a><span id="l37.260">       &lt;xul:image class=&quot;toolbarbutton-icon-end&quot; xbl:inherits=&quot;validate,src-end=image,toolbarmode,buttonstyle&quot;/&gt;</span>
<a href="#l37.261"></a><span id="l37.261">     &lt;/content&gt;</span>
<a href="#l37.262"></a><span id="l37.262">   &lt;/binding&gt;</span>
<a href="#l37.263"></a><span id="l37.263" class="difflineat">@@ -218,24 +226,26 @@</span>
<a href="#l37.264"></a><span id="l37.264">       &lt;xul:stack pack=&quot;center&quot; align=&quot;end&quot;&gt;</span>
<a href="#l37.265"></a><span id="l37.265">         &lt;xul:image class=&quot;toolbarbutton-icon-begin&quot; xbl:inherits=&quot;validate,src-begin=image,toolbarmode,buttonstyle&quot;/&gt;</span>
<a href="#l37.266"></a><span id="l37.266">         &lt;xul:label anonid=&quot;day-label&quot; class=&quot;toolbarbutton-day-text&quot;/&gt;</span>
<a href="#l37.267"></a><span id="l37.267">       &lt;/xul:stack&gt;</span>
<a href="#l37.268"></a><span id="l37.268">       &lt;xul:label class=&quot;toolbarbutton-text&quot; crop=&quot;right&quot; flex=&quot;1&quot;</span>
<a href="#l37.269"></a><span id="l37.269">                  xbl:inherits=&quot;value=label,accesskey,crop,toolbarmode,buttonstyle&quot;/&gt;</span>
<a href="#l37.270"></a><span id="l37.270">       &lt;xul:image class=&quot;toolbarbutton-icon-end&quot; xbl:inherits=&quot;validate,src-end=image,toolbarmode,buttonstyle&quot;/&gt;</span>
<a href="#l37.271"></a><span id="l37.271">     &lt;/content&gt;</span>
<a href="#l37.272"></a><span id="l37.272" class="difflineplus">+</span>
<a href="#l37.273"></a><span id="l37.273">     &lt;implementation&gt;</span>
<a href="#l37.274"></a><span id="l37.274">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l37.275"></a><span id="l37.275" class="difflineminus">-          this.setUpTodayDate();</span>
<a href="#l37.276"></a><span id="l37.276" class="difflineplus">+        this.setUpTodayDate();</span>
<a href="#l37.277"></a><span id="l37.277">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l37.278"></a><span id="l37.278" class="difflineplus">+</span>
<a href="#l37.279"></a><span id="l37.279">       &lt;method name=&quot;setUpTodayDate&quot;&gt;</span>
<a href="#l37.280"></a><span id="l37.280">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.281"></a><span id="l37.281" class="difflineminus">-            let dayNumber = calGetString(&quot;dateFormat&quot;, &quot;day.&quot; + cal.now().day + &quot;.number&quot;);</span>
<a href="#l37.282"></a><span id="l37.282" class="difflineminus">-            document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;day-label&quot;).value = dayNumber;</span>
<a href="#l37.283"></a><span id="l37.283" class="difflineplus">+          let dayNumber = calGetString(&quot;dateFormat&quot;, &quot;day.&quot; + cal.now().day + &quot;.number&quot;);</span>
<a href="#l37.284"></a><span id="l37.284" class="difflineplus">+          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;day-label&quot;).value = dayNumber;</span>
<a href="#l37.285"></a><span id="l37.285">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.286"></a><span id="l37.286">       &lt;/method&gt;</span>
<a href="#l37.287"></a><span id="l37.287">     &lt;/implementation&gt;</span>
<a href="#l37.288"></a><span id="l37.288">    &lt;/binding&gt;</span>
<a href="#l37.289"></a><span id="l37.289"> </span>
<a href="#l37.290"></a><span id="l37.290">   &lt;!-- this binding directly extends to a checkbox but is visualized as</span>
<a href="#l37.291"></a><span id="l37.291">        a treenode in a treecontrol--&gt;</span>
<a href="#l37.292"></a><span id="l37.292">   &lt;binding id=&quot;treenode-checkbox&quot; extends=&quot;chrome://global/content/bindings/checkbox.xml#checkbox-baseline&quot;&gt;</span>
<a href="#l37.293"></a><span id="l37.293" class="difflineat">@@ -245,21 +255,22 @@</span>
<a href="#l37.294"></a><span id="l37.294">   &lt;/binding&gt;</span>
<a href="#l37.295"></a><span id="l37.295"> </span>
<a href="#l37.296"></a><span id="l37.296">   &lt;!-- this binding directly extends to a xul:box element and automatically</span>
<a href="#l37.297"></a><span id="l37.297">        sets the &quot;orient&quot; attribute to &quot;vertical&quot; thus behaving like a vbox--&gt;</span>
<a href="#l37.298"></a><span id="l37.298">   &lt;binding id=&quot;modevbox&quot; extends=&quot;chrome://calendar/content/widgets/calendar-widgets.xml#modebox&quot;&gt;</span>
<a href="#l37.299"></a><span id="l37.299">     &lt;resources&gt;</span>
<a href="#l37.300"></a><span id="l37.300">       &lt;stylesheet src=&quot;chrome://calendar/skin/widgets/calendar-widgets.css&quot;/&gt;</span>
<a href="#l37.301"></a><span id="l37.301">     &lt;/resources&gt;</span>
<a href="#l37.302"></a><span id="l37.302" class="difflineplus">+</span>
<a href="#l37.303"></a><span id="l37.303">     &lt;implementation&gt;</span>
<a href="#l37.304"></a><span id="l37.304">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l37.305"></a><span id="l37.305" class="difflineminus">-            this.setAttribute(&quot;orient&quot;, &quot;vertical&quot;);</span>
<a href="#l37.306"></a><span id="l37.306" class="difflineplus">+        this.setAttribute(&quot;orient&quot;, &quot;vertical&quot;);</span>
<a href="#l37.307"></a><span id="l37.307">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l37.308"></a><span id="l37.308" class="difflineminus">-      &lt;/implementation&gt;</span>
<a href="#l37.309"></a><span id="l37.309" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l37.310"></a><span id="l37.310">   &lt;/binding&gt;</span>
<a href="#l37.311"></a><span id="l37.311"> </span>
<a href="#l37.312"></a><span id="l37.312">   &lt;!-- this binding directly extends to a xul:box element and automatically</span>
<a href="#l37.313"></a><span id="l37.313">        sets the &quot;orient&quot; attribute to &quot;horizontal&quot; thus behaving like a vbox--&gt;</span>
<a href="#l37.314"></a><span id="l37.314">   &lt;binding id=&quot;modehbox&quot; extends=&quot;chrome://calendar/content/widgets/calendar-widgets.xml#modebox&quot;&gt;</span>
<a href="#l37.315"></a><span id="l37.315">     &lt;resources&gt;</span>
<a href="#l37.316"></a><span id="l37.316">       &lt;stylesheet src=&quot;chrome://calendar/skin/widgets/calendar-widgets.css&quot;/&gt;</span>
<a href="#l37.317"></a><span id="l37.317">     &lt;/resources&gt;</span>
<a href="#l37.318"></a><span id="l37.318" class="difflineat">@@ -291,16 +302,17 @@</span>
<a href="#l37.319"></a><span id="l37.319">     &lt;resources&gt;</span>
<a href="#l37.320"></a><span id="l37.320">       &lt;stylesheet src=&quot;chrome://calendar/skin/widgets/calendar-widgets.css&quot;/&gt;</span>
<a href="#l37.321"></a><span id="l37.321">     &lt;/resources&gt;</span>
<a href="#l37.322"></a><span id="l37.322">     &lt;implementation&gt;</span>
<a href="#l37.323"></a><span id="l37.323">       &lt;field name=&quot;mBroadcaster&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l37.324"></a><span id="l37.324">       &lt;field name=&quot;mModHandler&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l37.325"></a><span id="l37.325">       &lt;field name=&quot;mRefControl&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l37.326"></a><span id="l37.326">       &lt;field name=&quot;mControlHandler&quot;&gt;null&lt;/field&gt;;</span>
<a href="#l37.327"></a><span id="l37.327" class="difflineplus">+</span>
<a href="#l37.328"></a><span id="l37.328">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l37.329"></a><span id="l37.329">         if (this.hasAttribute(&quot;broadcaster&quot;)) {</span>
<a href="#l37.330"></a><span id="l37.330">             this.setAttribute(&quot;broadcaster&quot;, this.getAttribute(&quot;broadcaster&quot;));</span>
<a href="#l37.331"></a><span id="l37.331">         }</span>
<a href="#l37.332"></a><span id="l37.332">         if (this.hasAttribute(&quot;refcontrol&quot;)) {</span>
<a href="#l37.333"></a><span id="l37.333">             this.mRefControl = document.getElementById(this.getAttribute(&quot;refcontrol&quot;));</span>
<a href="#l37.334"></a><span id="l37.334">             if (this.mRefControl &amp;&amp; ((this.mRefControl.localName == &quot;treenode-checkbox&quot;) ||</span>
<a href="#l37.335"></a><span id="l37.335">                                   (this.mRefControl.localName == &quot;checkbox&quot;))) {</span>
<a href="#l37.336"></a><span id="l37.336" class="difflineat">@@ -308,228 +320,228 @@</span>
<a href="#l37.337"></a><span id="l37.337">                     binding: this,</span>
<a href="#l37.338"></a><span id="l37.338">                     handleEvent: function(aEvent, aHandled) {</span>
<a href="#l37.339"></a><span id="l37.339">                         return this.binding.onCheckboxStateChange(aEvent, this.binding);</span>
<a href="#l37.340"></a><span id="l37.340">                     }</span>
<a href="#l37.341"></a><span id="l37.341">                 };</span>
<a href="#l37.342"></a><span id="l37.342">                 this.mRefControl.addEventListener(&quot;CheckboxStateChange&quot;, this.mControlHandler, true);</span>
<a href="#l37.343"></a><span id="l37.343">             }</span>
<a href="#l37.344"></a><span id="l37.344">         }</span>
<a href="#l37.345"></a><span id="l37.345" class="difflineminus">-      ]]&gt;</span>
<a href="#l37.346"></a><span id="l37.346" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l37.347"></a><span id="l37.347" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l37.348"></a><span id="l37.348" class="difflineplus">+</span>
<a href="#l37.349"></a><span id="l37.349">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l37.350"></a><span id="l37.350" class="difflineminus">-          if (this.mBroadcaster) {</span>
<a href="#l37.351"></a><span id="l37.351" class="difflineminus">-              this.mBroadcaster.removeEventListener(&quot;DOMAttrModified&quot;, this.mModHandler, true);</span>
<a href="#l37.352"></a><span id="l37.352" class="difflineminus">-          }</span>
<a href="#l37.353"></a><span id="l37.353" class="difflineminus">-          if (this.mRefControl) {</span>
<a href="#l37.354"></a><span id="l37.354" class="difflineminus">-              this.mRefControl.removeEventListener(&quot;CheckboxStateChange&quot;, this.mControlHandler, true);</span>
<a href="#l37.355"></a><span id="l37.355" class="difflineminus">-          }</span>
<a href="#l37.356"></a><span id="l37.356" class="difflineplus">+        if (this.mBroadcaster) {</span>
<a href="#l37.357"></a><span id="l37.357" class="difflineplus">+            this.mBroadcaster.removeEventListener(&quot;DOMAttrModified&quot;, this.mModHandler, true);</span>
<a href="#l37.358"></a><span id="l37.358" class="difflineplus">+        }</span>
<a href="#l37.359"></a><span id="l37.359" class="difflineplus">+        if (this.mRefControl) {</span>
<a href="#l37.360"></a><span id="l37.360" class="difflineplus">+            this.mRefControl.removeEventListener(&quot;CheckboxStateChange&quot;, this.mControlHandler, true);</span>
<a href="#l37.361"></a><span id="l37.361" class="difflineplus">+        }</span>
<a href="#l37.362"></a><span id="l37.362">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l37.363"></a><span id="l37.363"> </span>
<a href="#l37.364"></a><span id="l37.364">       &lt;property name=&quot;currentMode&quot;&gt;</span>
<a href="#l37.365"></a><span id="l37.365">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l37.366"></a><span id="l37.366" class="difflineminus">-            if (this.mBroadcaster &amp;&amp; this.mBroadcaster.hasAttribute(&quot;mode&quot;)) {</span>
<a href="#l37.367"></a><span id="l37.367" class="difflineminus">-                return this.mBroadcaster.getAttribute(&quot;mode&quot;);</span>
<a href="#l37.368"></a><span id="l37.368" class="difflineminus">-            } else {</span>
<a href="#l37.369"></a><span id="l37.369" class="difflineminus">-                return &quot;&quot;;</span>
<a href="#l37.370"></a><span id="l37.370" class="difflineminus">-            }</span>
<a href="#l37.371"></a><span id="l37.371" class="difflineplus">+          if (this.mBroadcaster &amp;&amp; this.mBroadcaster.hasAttribute(&quot;mode&quot;)) {</span>
<a href="#l37.372"></a><span id="l37.372" class="difflineplus">+              return this.mBroadcaster.getAttribute(&quot;mode&quot;);</span>
<a href="#l37.373"></a><span id="l37.373" class="difflineplus">+          } else {</span>
<a href="#l37.374"></a><span id="l37.374" class="difflineplus">+              return &quot;&quot;;</span>
<a href="#l37.375"></a><span id="l37.375" class="difflineplus">+          }</span>
<a href="#l37.376"></a><span id="l37.376">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l37.377"></a><span id="l37.377">       &lt;/property&gt;</span>
<a href="#l37.378"></a><span id="l37.378"> </span>
<a href="#l37.379"></a><span id="l37.379">       &lt;method name=&quot;isVisible&quot;&gt;</span>
<a href="#l37.380"></a><span id="l37.380">         &lt;parameter name=&quot;aMode&quot;/&gt;</span>
<a href="#l37.381"></a><span id="l37.381">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.382"></a><span id="l37.382" class="difflineminus">-            let lMode = aMode || this.currentMode;</span>
<a href="#l37.383"></a><span id="l37.383" class="difflineminus">-            if (!this.isVisibleInMode(lMode)) {</span>
<a href="#l37.384"></a><span id="l37.384" class="difflineminus">-                return false;</span>
<a href="#l37.385"></a><span id="l37.385" class="difflineminus">-            }</span>
<a href="#l37.386"></a><span id="l37.386" class="difflineminus">-            let collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l37.387"></a><span id="l37.387" class="difflineminus">-            return (!collapsedModes.includes(lMode));</span>
<a href="#l37.388"></a><span id="l37.388" class="difflineplus">+          let lMode = aMode || this.currentMode;</span>
<a href="#l37.389"></a><span id="l37.389" class="difflineplus">+          if (!this.isVisibleInMode(lMode)) {</span>
<a href="#l37.390"></a><span id="l37.390" class="difflineplus">+              return false;</span>
<a href="#l37.391"></a><span id="l37.391" class="difflineplus">+          }</span>
<a href="#l37.392"></a><span id="l37.392" class="difflineplus">+          let collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l37.393"></a><span id="l37.393" class="difflineplus">+          return !collapsedModes.includes(lMode);</span>
<a href="#l37.394"></a><span id="l37.394">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.395"></a><span id="l37.395">       &lt;/method&gt;</span>
<a href="#l37.396"></a><span id="l37.396"> </span>
<a href="#l37.397"></a><span id="l37.397">       &lt;method name=&quot;setModeAttribute&quot;&gt;</span>
<a href="#l37.398"></a><span id="l37.398">         &lt;parameter name=&quot;aModeAttribute&quot;/&gt;</span>
<a href="#l37.399"></a><span id="l37.399">         &lt;parameter name=&quot;aModeValue&quot;/&gt;</span>
<a href="#l37.400"></a><span id="l37.400">         &lt;parameter name=&quot;amode&quot;/&gt;</span>
<a href="#l37.401"></a><span id="l37.401">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.402"></a><span id="l37.402" class="difflineminus">-            if (this.hasAttribute(aModeAttribute)) {</span>
<a href="#l37.403"></a><span id="l37.403" class="difflineminus">-                let lMode = amode || this.currentMode;</span>
<a href="#l37.404"></a><span id="l37.404" class="difflineminus">-                let modeAttributeValues = this.getAttribute(aModeAttribute).split(&quot;,&quot;);</span>
<a href="#l37.405"></a><span id="l37.405" class="difflineminus">-                let modes = this.getAttribute(&quot;mode&quot;).split(&quot;,&quot;);</span>
<a href="#l37.406"></a><span id="l37.406" class="difflineminus">-                modeAttributeValues[modes.indexOf(lMode)] = aModeValue;</span>
<a href="#l37.407"></a><span id="l37.407" class="difflineminus">-                this.setAttribute(aModeAttribute, modeAttributeValues.join(&quot;,&quot;));</span>
<a href="#l37.408"></a><span id="l37.408" class="difflineminus">-            }</span>
<a href="#l37.409"></a><span id="l37.409" class="difflineplus">+          if (this.hasAttribute(aModeAttribute)) {</span>
<a href="#l37.410"></a><span id="l37.410" class="difflineplus">+              let lMode = amode || this.currentMode;</span>
<a href="#l37.411"></a><span id="l37.411" class="difflineplus">+              let modeAttributeValues = this.getAttribute(aModeAttribute).split(&quot;,&quot;);</span>
<a href="#l37.412"></a><span id="l37.412" class="difflineplus">+              let modes = this.getAttribute(&quot;mode&quot;).split(&quot;,&quot;);</span>
<a href="#l37.413"></a><span id="l37.413" class="difflineplus">+              modeAttributeValues[modes.indexOf(lMode)] = aModeValue;</span>
<a href="#l37.414"></a><span id="l37.414" class="difflineplus">+              this.setAttribute(aModeAttribute, modeAttributeValues.join(&quot;,&quot;));</span>
<a href="#l37.415"></a><span id="l37.415" class="difflineplus">+          }</span>
<a href="#l37.416"></a><span id="l37.416">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.417"></a><span id="l37.417">       &lt;/method&gt;</span>
<a href="#l37.418"></a><span id="l37.418"> </span>
<a href="#l37.419"></a><span id="l37.419">       &lt;method name=&quot;getModeAttribute&quot;&gt;</span>
<a href="#l37.420"></a><span id="l37.420">         &lt;parameter name=&quot;aModeAttribute&quot;/&gt;</span>
<a href="#l37.421"></a><span id="l37.421">         &lt;parameter name=&quot;aAttribute&quot;/&gt;</span>
<a href="#l37.422"></a><span id="l37.422">         &lt;parameter name=&quot;amode&quot;/&gt;</span>
<a href="#l37.423"></a><span id="l37.423">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.424"></a><span id="l37.424" class="difflineminus">-            if (this.hasAttribute(aModeAttribute)) {</span>
<a href="#l37.425"></a><span id="l37.425" class="difflineminus">-                let lMode = amode || this.currentMode;</span>
<a href="#l37.426"></a><span id="l37.426" class="difflineminus">-                let modeAttributeValues = this.getAttribute(aModeAttribute).split(&quot;,&quot;);</span>
<a href="#l37.427"></a><span id="l37.427" class="difflineminus">-                let modes = this.getAttribute(&quot;mode&quot;).split(&quot;,&quot;);</span>
<a href="#l37.428"></a><span id="l37.428" class="difflineminus">-                return modeAttributeValues[modes.indexOf(lMode)];</span>
<a href="#l37.429"></a><span id="l37.429" class="difflineminus">-            } else {</span>
<a href="#l37.430"></a><span id="l37.430" class="difflineminus">-                return &quot;&quot;;</span>
<a href="#l37.431"></a><span id="l37.431" class="difflineminus">-            }</span>
<a href="#l37.432"></a><span id="l37.432" class="difflineplus">+          if (this.hasAttribute(aModeAttribute)) {</span>
<a href="#l37.433"></a><span id="l37.433" class="difflineplus">+              let lMode = amode || this.currentMode;</span>
<a href="#l37.434"></a><span id="l37.434" class="difflineplus">+              let modeAttributeValues = this.getAttribute(aModeAttribute).split(&quot;,&quot;);</span>
<a href="#l37.435"></a><span id="l37.435" class="difflineplus">+              let modes = this.getAttribute(&quot;mode&quot;).split(&quot;,&quot;);</span>
<a href="#l37.436"></a><span id="l37.436" class="difflineplus">+              return modeAttributeValues[modes.indexOf(lMode)];</span>
<a href="#l37.437"></a><span id="l37.437" class="difflineplus">+          } else {</span>
<a href="#l37.438"></a><span id="l37.438" class="difflineplus">+              return &quot;&quot;;</span>
<a href="#l37.439"></a><span id="l37.439" class="difflineplus">+          }</span>
<a href="#l37.440"></a><span id="l37.440">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.441"></a><span id="l37.441">       &lt;/method&gt;</span>
<a href="#l37.442"></a><span id="l37.442"> </span>
<a href="#l37.443"></a><span id="l37.443">       &lt;method name=&quot;setVisible&quot;&gt;</span>
<a href="#l37.444"></a><span id="l37.444">         &lt;parameter name=&quot;aVisible&quot;/&gt;</span>
<a href="#l37.445"></a><span id="l37.445">         &lt;parameter name=&quot;aPushModeCollapsedAttribute&quot;/&gt;</span>
<a href="#l37.446"></a><span id="l37.446">         &lt;parameter name=&quot;aNotifyRefControl&quot;/&gt;</span>
<a href="#l37.447"></a><span id="l37.447">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.448"></a><span id="l37.448" class="difflineminus">-            let notifyRefControl = aNotifyRefControl == null || aNotifyRefControl === true;</span>
<a href="#l37.449"></a><span id="l37.449" class="difflineminus">-            let pushModeCollapsedAttribute = aPushModeCollapsedAttribute == null ||</span>
<a href="#l37.450"></a><span id="l37.450" class="difflineminus">-                                             aPushModeCollapsedAttribute === true;</span>
<a href="#l37.451"></a><span id="l37.451" class="difflineminus">-            let collapsedModes = [];</span>
<a href="#l37.452"></a><span id="l37.452" class="difflineminus">-            let modeIndex = -1;</span>
<a href="#l37.453"></a><span id="l37.453" class="difflineminus">-            let display = aVisible;</span>
<a href="#l37.454"></a><span id="l37.454" class="difflineminus">-            let collapsedInMode = false;</span>
<a href="#l37.455"></a><span id="l37.455" class="difflineminus">-            if (this.hasAttribute(&quot;collapsedinmodes&quot;)) {</span>
<a href="#l37.456"></a><span id="l37.456" class="difflineminus">-                collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l37.457"></a><span id="l37.457" class="difflineminus">-                modeIndex = collapsedModes.indexOf(this.currentMode);</span>
<a href="#l37.458"></a><span id="l37.458" class="difflineminus">-                collapsedInMode = (modeIndex &gt; -1);</span>
<a href="#l37.459"></a><span id="l37.459" class="difflineminus">-            }</span>
<a href="#l37.460"></a><span id="l37.460" class="difflineminus">-            if ((aVisible === true) &amp;&amp; (pushModeCollapsedAttribute == false)) {</span>
<a href="#l37.461"></a><span id="l37.461" class="difflineminus">-                display = (aVisible === true) &amp;&amp; (!collapsedInMode);</span>
<a href="#l37.462"></a><span id="l37.462" class="difflineminus">-            }</span>
<a href="#l37.463"></a><span id="l37.463" class="difflineplus">+          let notifyRefControl = aNotifyRefControl == null || aNotifyRefControl === true;</span>
<a href="#l37.464"></a><span id="l37.464" class="difflineplus">+          let pushModeCollapsedAttribute = aPushModeCollapsedAttribute == null ||</span>
<a href="#l37.465"></a><span id="l37.465" class="difflineplus">+                                           aPushModeCollapsedAttribute === true;</span>
<a href="#l37.466"></a><span id="l37.466" class="difflineplus">+          let collapsedModes = [];</span>
<a href="#l37.467"></a><span id="l37.467" class="difflineplus">+          let modeIndex = -1;</span>
<a href="#l37.468"></a><span id="l37.468" class="difflineplus">+          let display = aVisible;</span>
<a href="#l37.469"></a><span id="l37.469" class="difflineplus">+          let collapsedInMode = false;</span>
<a href="#l37.470"></a><span id="l37.470" class="difflineplus">+          if (this.hasAttribute(&quot;collapsedinmodes&quot;)) {</span>
<a href="#l37.471"></a><span id="l37.471" class="difflineplus">+              collapsedModes = this.getAttribute(&quot;collapsedinmodes&quot;).split(&quot;,&quot;);</span>
<a href="#l37.472"></a><span id="l37.472" class="difflineplus">+              modeIndex = collapsedModes.indexOf(this.currentMode);</span>
<a href="#l37.473"></a><span id="l37.473" class="difflineplus">+              collapsedInMode = modeIndex &gt; -1;</span>
<a href="#l37.474"></a><span id="l37.474" class="difflineplus">+          }</span>
<a href="#l37.475"></a><span id="l37.475" class="difflineplus">+          if (aVisible === true &amp;&amp; pushModeCollapsedAttribute == false) {</span>
<a href="#l37.476"></a><span id="l37.476" class="difflineplus">+              display = (aVisible === true) &amp;&amp; (!collapsedInMode);</span>
<a href="#l37.477"></a><span id="l37.477" class="difflineplus">+          }</span>
<a href="#l37.478"></a><span id="l37.478"> </span>
<a href="#l37.479"></a><span id="l37.479" class="difflineminus">-            setBooleanAttribute(this, &quot;collapsed&quot;, !display || !this.isVisibleInMode());</span>
<a href="#l37.480"></a><span id="l37.480" class="difflineminus">-            if (pushModeCollapsedAttribute) {</span>
<a href="#l37.481"></a><span id="l37.481" class="difflineminus">-                if (!display) {</span>
<a href="#l37.482"></a><span id="l37.482" class="difflineminus">-                    if (modeIndex == -1) {</span>
<a href="#l37.483"></a><span id="l37.483" class="difflineminus">-                        collapsedModes.push(this.currentMode);</span>
<a href="#l37.484"></a><span id="l37.484" class="difflineminus">-                        if (this.getAttribute(&quot;collapsedinmodes&quot;) == &quot;,&quot;) {</span>
<a href="#l37.485"></a><span id="l37.485" class="difflineminus">-                            collapsedModes.splice(0, 2);</span>
<a href="#l37.486"></a><span id="l37.486" class="difflineminus">-                        }</span>
<a href="#l37.487"></a><span id="l37.487" class="difflineminus">-                    }</span>
<a href="#l37.488"></a><span id="l37.488" class="difflineminus">-                } else if (modeIndex &gt; -1) {</span>
<a href="#l37.489"></a><span id="l37.489" class="difflineminus">-                    collapsedModes.splice(modeIndex, 1);</span>
<a href="#l37.490"></a><span id="l37.490" class="difflineminus">-                    if (collapsedModes.join(&quot;,&quot;) == &quot;&quot;) {</span>
<a href="#l37.491"></a><span id="l37.491" class="difflineminus">-                        collapsedModes[0] = &quot;,&quot;;</span>
<a href="#l37.492"></a><span id="l37.492" class="difflineminus">-                    }</span>
<a href="#l37.493"></a><span id="l37.493" class="difflineminus">-                }</span>
<a href="#l37.494"></a><span id="l37.494" class="difflineminus">-                this.setAttribute(&quot;collapsedinmodes&quot;, collapsedModes.join(&quot;,&quot;));</span>
<a href="#l37.495"></a><span id="l37.495" class="difflineminus">-                let id = this.getAttribute(&quot;id&quot;);</span>
<a href="#l37.496"></a><span id="l37.496" class="difflineminus">-                if (id) {</span>
<a href="#l37.497"></a><span id="l37.497" class="difflineminus">-                    document.persist(id, &quot;collapsedinmodes&quot;);</span>
<a href="#l37.498"></a><span id="l37.498" class="difflineminus">-                }</span>
<a href="#l37.499"></a><span id="l37.499" class="difflineminus">-            }</span>
<a href="#l37.500"></a><span id="l37.500" class="difflineminus">-            if (notifyRefControl === true) {</span>
<a href="#l37.501"></a><span id="l37.501" class="difflineminus">-                if (this.hasAttribute(&quot;refcontrol&quot;)) {</span>
<a href="#l37.502"></a><span id="l37.502" class="difflineminus">-                    let command = document.getElementById(this.getAttribute(&quot;refcontrol&quot;));</span>
<a href="#l37.503"></a><span id="l37.503" class="difflineminus">-                    if (command) {</span>
<a href="#l37.504"></a><span id="l37.504" class="difflineminus">-                        command.setAttribute(&quot;checked&quot;, display);</span>
<a href="#l37.505"></a><span id="l37.505" class="difflineminus">-                        setBooleanAttribute(command, &quot;disabled&quot;, !this.isVisibleInMode());</span>
<a href="#l37.506"></a><span id="l37.506" class="difflineminus">-                    }</span>
<a href="#l37.507"></a><span id="l37.507" class="difflineminus">-                }</span>
<a href="#l37.508"></a><span id="l37.508" class="difflineminus">-            }</span>
<a href="#l37.509"></a><span id="l37.509" class="difflineplus">+          setBooleanAttribute(this, &quot;collapsed&quot;, !display || !this.isVisibleInMode());</span>
<a href="#l37.510"></a><span id="l37.510" class="difflineplus">+          if (pushModeCollapsedAttribute) {</span>
<a href="#l37.511"></a><span id="l37.511" class="difflineplus">+              if (!display) {</span>
<a href="#l37.512"></a><span id="l37.512" class="difflineplus">+                  if (modeIndex == -1) {</span>
<a href="#l37.513"></a><span id="l37.513" class="difflineplus">+                      collapsedModes.push(this.currentMode);</span>
<a href="#l37.514"></a><span id="l37.514" class="difflineplus">+                      if (this.getAttribute(&quot;collapsedinmodes&quot;) == &quot;,&quot;) {</span>
<a href="#l37.515"></a><span id="l37.515" class="difflineplus">+                          collapsedModes.splice(0, 2);</span>
<a href="#l37.516"></a><span id="l37.516" class="difflineplus">+                      }</span>
<a href="#l37.517"></a><span id="l37.517" class="difflineplus">+                  }</span>
<a href="#l37.518"></a><span id="l37.518" class="difflineplus">+              } else if (modeIndex &gt; -1) {</span>
<a href="#l37.519"></a><span id="l37.519" class="difflineplus">+                  collapsedModes.splice(modeIndex, 1);</span>
<a href="#l37.520"></a><span id="l37.520" class="difflineplus">+                  if (collapsedModes.join(&quot;,&quot;) == &quot;&quot;) {</span>
<a href="#l37.521"></a><span id="l37.521" class="difflineplus">+                      collapsedModes[0] = &quot;,&quot;;</span>
<a href="#l37.522"></a><span id="l37.522" class="difflineplus">+                  }</span>
<a href="#l37.523"></a><span id="l37.523" class="difflineplus">+              }</span>
<a href="#l37.524"></a><span id="l37.524" class="difflineplus">+              this.setAttribute(&quot;collapsedinmodes&quot;, collapsedModes.join(&quot;,&quot;));</span>
<a href="#l37.525"></a><span id="l37.525" class="difflineplus">+              let id = this.getAttribute(&quot;id&quot;);</span>
<a href="#l37.526"></a><span id="l37.526" class="difflineplus">+              if (id) {</span>
<a href="#l37.527"></a><span id="l37.527" class="difflineplus">+                  document.persist(id, &quot;collapsedinmodes&quot;);</span>
<a href="#l37.528"></a><span id="l37.528" class="difflineplus">+              }</span>
<a href="#l37.529"></a><span id="l37.529" class="difflineplus">+          }</span>
<a href="#l37.530"></a><span id="l37.530" class="difflineplus">+          if (notifyRefControl === true) {</span>
<a href="#l37.531"></a><span id="l37.531" class="difflineplus">+              if (this.hasAttribute(&quot;refcontrol&quot;)) {</span>
<a href="#l37.532"></a><span id="l37.532" class="difflineplus">+                  let command = document.getElementById(this.getAttribute(&quot;refcontrol&quot;));</span>
<a href="#l37.533"></a><span id="l37.533" class="difflineplus">+                  if (command) {</span>
<a href="#l37.534"></a><span id="l37.534" class="difflineplus">+                      command.setAttribute(&quot;checked&quot;, display);</span>
<a href="#l37.535"></a><span id="l37.535" class="difflineplus">+                      setBooleanAttribute(command, &quot;disabled&quot;, !this.isVisibleInMode());</span>
<a href="#l37.536"></a><span id="l37.536" class="difflineplus">+                  }</span>
<a href="#l37.537"></a><span id="l37.537" class="difflineplus">+              }</span>
<a href="#l37.538"></a><span id="l37.538" class="difflineplus">+          }</span>
<a href="#l37.539"></a><span id="l37.539">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.540"></a><span id="l37.540">       &lt;/method&gt;</span>
<a href="#l37.541"></a><span id="l37.541"> </span>
<a href="#l37.542"></a><span id="l37.542">       &lt;method name=&quot;isVisibleInMode&quot;&gt;</span>
<a href="#l37.543"></a><span id="l37.543">         &lt;parameter name=&quot;aMode&quot;/&gt;</span>
<a href="#l37.544"></a><span id="l37.544">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.545"></a><span id="l37.545" class="difflineminus">-            let lMode = aMode || this.currentMode;</span>
<a href="#l37.546"></a><span id="l37.546" class="difflineminus">-            let display = true;</span>
<a href="#l37.547"></a><span id="l37.547" class="difflineminus">-            let lModes = [];</span>
<a href="#l37.548"></a><span id="l37.548" class="difflineminus">-            if (this.hasAttribute(&quot;mode&quot;)) {</span>
<a href="#l37.549"></a><span id="l37.549" class="difflineminus">-                let modeString = this.getAttribute(&quot;mode&quot;);</span>
<a href="#l37.550"></a><span id="l37.550" class="difflineminus">-                lModes = modeString.split(&quot;,&quot;);</span>
<a href="#l37.551"></a><span id="l37.551" class="difflineminus">-            }</span>
<a href="#l37.552"></a><span id="l37.552" class="difflineminus">-            if (lModes &amp;&amp; lModes.length &gt; 0) {</span>
<a href="#l37.553"></a><span id="l37.553" class="difflineminus">-                display = lModes.includes(lMode);</span>
<a href="#l37.554"></a><span id="l37.554" class="difflineminus">-            }</span>
<a href="#l37.555"></a><span id="l37.555" class="difflineminus">-            return display;</span>
<a href="#l37.556"></a><span id="l37.556" class="difflineplus">+          let lMode = aMode || this.currentMode;</span>
<a href="#l37.557"></a><span id="l37.557" class="difflineplus">+          let display = true;</span>
<a href="#l37.558"></a><span id="l37.558" class="difflineplus">+          let lModes = [];</span>
<a href="#l37.559"></a><span id="l37.559" class="difflineplus">+          if (this.hasAttribute(&quot;mode&quot;)) {</span>
<a href="#l37.560"></a><span id="l37.560" class="difflineplus">+              let modeString = this.getAttribute(&quot;mode&quot;);</span>
<a href="#l37.561"></a><span id="l37.561" class="difflineplus">+              lModes = modeString.split(&quot;,&quot;);</span>
<a href="#l37.562"></a><span id="l37.562" class="difflineplus">+          }</span>
<a href="#l37.563"></a><span id="l37.563" class="difflineplus">+          if (lModes &amp;&amp; lModes.length &gt; 0) {</span>
<a href="#l37.564"></a><span id="l37.564" class="difflineplus">+              display = lModes.includes(lMode);</span>
<a href="#l37.565"></a><span id="l37.565" class="difflineplus">+          }</span>
<a href="#l37.566"></a><span id="l37.566" class="difflineplus">+          return display;</span>
<a href="#l37.567"></a><span id="l37.567">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.568"></a><span id="l37.568">       &lt;/method&gt;</span>
<a href="#l37.569"></a><span id="l37.569"> </span>
<a href="#l37.570"></a><span id="l37.570">       &lt;method name=&quot;onModeModified&quot;&gt;</span>
<a href="#l37.571"></a><span id="l37.571">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l37.572"></a><span id="l37.572">         &lt;parameter name=&quot;aBinding&quot;/&gt;</span>
<a href="#l37.573"></a><span id="l37.573">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.574"></a><span id="l37.574" class="difflineminus">-            if (aEvent.attrName == &quot;mode&quot;) {</span>
<a href="#l37.575"></a><span id="l37.575" class="difflineminus">-                let display = aBinding.isVisibleInMode(aEvent.newValue);</span>
<a href="#l37.576"></a><span id="l37.576" class="difflineminus">-                aBinding.setVisible(display, false, true);</span>
<a href="#l37.577"></a><span id="l37.577" class="difflineminus">-            }</span>
<a href="#l37.578"></a><span id="l37.578" class="difflineplus">+          if (aEvent.attrName == &quot;mode&quot;) {</span>
<a href="#l37.579"></a><span id="l37.579" class="difflineplus">+              let display = aBinding.isVisibleInMode(aEvent.newValue);</span>
<a href="#l37.580"></a><span id="l37.580" class="difflineplus">+              aBinding.setVisible(display, false, true);</span>
<a href="#l37.581"></a><span id="l37.581" class="difflineplus">+          }</span>
<a href="#l37.582"></a><span id="l37.582">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.583"></a><span id="l37.583">       &lt;/method&gt;</span>
<a href="#l37.584"></a><span id="l37.584"> </span>
<a href="#l37.585"></a><span id="l37.585">       &lt;method name=&quot;togglePane&quot;&gt;</span>
<a href="#l37.586"></a><span id="l37.586">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l37.587"></a><span id="l37.587">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.588"></a><span id="l37.588" class="difflineminus">-            let command = aEvent.target;</span>
<a href="#l37.589"></a><span id="l37.589" class="difflineminus">-            let newValue = (command.getAttribute(&quot;checked&quot;) == &quot;true&quot; ? &quot;false&quot; : &quot;true&quot;);</span>
<a href="#l37.590"></a><span id="l37.590" class="difflineminus">-            command.setAttribute(&quot;checked&quot;, newValue);</span>
<a href="#l37.591"></a><span id="l37.591" class="difflineminus">-            this.setVisible(newValue == &quot;true&quot;, true, true);</span>
<a href="#l37.592"></a><span id="l37.592" class="difflineplus">+          let command = aEvent.target;</span>
<a href="#l37.593"></a><span id="l37.593" class="difflineplus">+          let newValue = (command.getAttribute(&quot;checked&quot;) == &quot;true&quot; ? &quot;false&quot; : &quot;true&quot;);</span>
<a href="#l37.594"></a><span id="l37.594" class="difflineplus">+          command.setAttribute(&quot;checked&quot;, newValue);</span>
<a href="#l37.595"></a><span id="l37.595" class="difflineplus">+          this.setVisible(newValue == &quot;true&quot;, true, true);</span>
<a href="#l37.596"></a><span id="l37.596">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.597"></a><span id="l37.597">       &lt;/method&gt;</span>
<a href="#l37.598"></a><span id="l37.598"> </span>
<a href="#l37.599"></a><span id="l37.599">       &lt;method name=&quot;onCheckboxStateChange&quot;&gt;</span>
<a href="#l37.600"></a><span id="l37.600">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l37.601"></a><span id="l37.601">         &lt;parameter name=&quot;aBinding&quot;/&gt;</span>
<a href="#l37.602"></a><span id="l37.602">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.603"></a><span id="l37.603" class="difflineminus">-            let newValue = aEvent.target.checked;</span>
<a href="#l37.604"></a><span id="l37.604" class="difflineminus">-            this.setVisible(newValue, true, true);</span>
<a href="#l37.605"></a><span id="l37.605" class="difflineplus">+          let newValue = aEvent.target.checked;</span>
<a href="#l37.606"></a><span id="l37.606" class="difflineplus">+          this.setVisible(newValue, true, true);</span>
<a href="#l37.607"></a><span id="l37.607">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.608"></a><span id="l37.608">       &lt;/method&gt;</span>
<a href="#l37.609"></a><span id="l37.609" class="difflineplus">+</span>
<a href="#l37.610"></a><span id="l37.610">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l37.611"></a><span id="l37.611">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l37.612"></a><span id="l37.612">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l37.613"></a><span id="l37.613">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.614"></a><span id="l37.614">           if (aAttr == &quot;broadcaster&quot;) {</span>
<a href="#l37.615"></a><span id="l37.615">               this.mBroadcaster = document.getElementById(aVal);</span>
<a href="#l37.616"></a><span id="l37.616">               if (this.mBroadcaster) {</span>
<a href="#l37.617"></a><span id="l37.617">                   this.mModHandler = {</span>
<a href="#l37.618"></a><span id="l37.618" class="difflineminus">-                  binding: this,</span>
<a href="#l37.619"></a><span id="l37.619" class="difflineminus">-                  handleEvent: function(aEvent, aHandled) {</span>
<a href="#l37.620"></a><span id="l37.620" class="difflineminus">-                      return this.binding.onModeModified(aEvent, this.binding);</span>
<a href="#l37.621"></a><span id="l37.621" class="difflineminus">-                  }</span>
<a href="#l37.622"></a><span id="l37.622" class="difflineminus">-              };</span>
<a href="#l37.623"></a><span id="l37.623" class="difflineminus">-              this.mBroadcaster.addEventListener(&quot;DOMAttrModified&quot;, this.mModHandler, true);</span>
<a href="#l37.624"></a><span id="l37.624" class="difflineminus">-            }</span>
<a href="#l37.625"></a><span id="l37.625" class="difflineplus">+                      binding: this,</span>
<a href="#l37.626"></a><span id="l37.626" class="difflineplus">+                      handleEvent: function(aEvent, aHandled) {</span>
<a href="#l37.627"></a><span id="l37.627" class="difflineplus">+                          return this.binding.onModeModified(aEvent, this.binding);</span>
<a href="#l37.628"></a><span id="l37.628" class="difflineplus">+                      }</span>
<a href="#l37.629"></a><span id="l37.629" class="difflineplus">+                  };</span>
<a href="#l37.630"></a><span id="l37.630" class="difflineplus">+                  this.mBroadcaster.addEventListener(&quot;DOMAttrModified&quot;, this.mModHandler, true);</span>
<a href="#l37.631"></a><span id="l37.631" class="difflineplus">+              }</span>
<a href="#l37.632"></a><span id="l37.632">           }</span>
<a href="#l37.633"></a><span id="l37.633">           return XULElement.prototype.setAttribute.call(this, aAttr, aVal);</span>
<a href="#l37.634"></a><span id="l37.634">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.635"></a><span id="l37.635">       &lt;/method&gt;</span>
<a href="#l37.636"></a><span id="l37.636">     &lt;/implementation&gt;</span>
<a href="#l37.637"></a><span id="l37.637">   &lt;/binding&gt;</span>
<a href="#l37.638"></a><span id="l37.638"> </span>
<a href="#l37.639"></a><span id="l37.639" class="difflineminus">-&lt;!-- This binding may server as a droptarget container for arbitrary items</span>
<a href="#l37.640"></a><span id="l37.640" class="difflineminus">-     it contains methods to add DropShadows. This binding is meant to be used</span>
<a href="#l37.641"></a><span id="l37.641" class="difflineminus">-     as a parent binding. The methods may be overwritten.</span>
<a href="#l37.642"></a><span id="l37.642" class="difflineminus">---&gt;</span>
<a href="#l37.643"></a><span id="l37.643" class="difflineminus">-&lt;binding id=&quot;dragndropContainer&quot;&gt;</span>
<a href="#l37.644"></a><span id="l37.644" class="difflineplus">+  &lt;!-- This binding may server as a droptarget container for arbitrary items</span>
<a href="#l37.645"></a><span id="l37.645" class="difflineplus">+       it contains methods to add DropShadows. This binding is meant to be used</span>
<a href="#l37.646"></a><span id="l37.646" class="difflineplus">+       as a parent binding. The methods may be overwritten. --&gt;</span>
<a href="#l37.647"></a><span id="l37.647" class="difflineplus">+  &lt;binding id=&quot;dragndropContainer&quot;&gt;</span>
<a href="#l37.648"></a><span id="l37.648">     &lt;implementation&gt;</span>
<a href="#l37.649"></a><span id="l37.649">       &lt;field name=&quot;mDropShadows&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l37.650"></a><span id="l37.650">       &lt;field name=&quot;mCalendarView&quot;&gt;null&lt;/field&gt;</span>
<a href="#l37.651"></a><span id="l37.651"> </span>
<a href="#l37.652"></a><span id="l37.652">       &lt;!-- The ViewController that supports the interface 'calICalendarView'--&gt;</span>
<a href="#l37.653"></a><span id="l37.653">       &lt;property name=&quot;calendarView&quot;</span>
<a href="#l37.654"></a><span id="l37.654">                 onget=&quot;return this.mCalendarView;&quot;</span>
<a href="#l37.655"></a><span id="l37.655">                 onset=&quot;return (this.mCalendarView = val);&quot;/&gt;</span>
<a href="#l37.656"></a><span id="l37.656"> </span>
<a href="#l37.657"></a><span id="l37.657" class="difflineminus">-       &lt;!-- method to add individual code e.g to set up the new item during</span>
<a href="#l37.658"></a><span id="l37.658" class="difflineplus">+      &lt;!-- method to add individual code e.g to set up the new item during</span>
<a href="#l37.659"></a><span id="l37.659">        'ondrop' --&gt;</span>
<a href="#l37.660"></a><span id="l37.660">       &lt;method name=&quot;onDropItem&quot;&gt;</span>
<a href="#l37.661"></a><span id="l37.661">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l37.662"></a><span id="l37.662">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.663"></a><span id="l37.663" class="difflineminus">-            // method that may be overridden by derived bindings...</span>
<a href="#l37.664"></a><span id="l37.664" class="difflineplus">+          // method that may be overridden by derived bindings...</span>
<a href="#l37.665"></a><span id="l37.665">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.666"></a><span id="l37.666">       &lt;/method&gt;</span>
<a href="#l37.667"></a><span id="l37.667"> </span>
<a href="#l37.668"></a><span id="l37.668">       &lt;method name=&quot;getDropShadows&quot;&gt;</span>
<a href="#l37.669"></a><span id="l37.669">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.670"></a><span id="l37.670" class="difflineminus">-            return this.mDropShadows;</span>
<a href="#l37.671"></a><span id="l37.671" class="difflineplus">+          return this.mDropShadows;</span>
<a href="#l37.672"></a><span id="l37.672">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.673"></a><span id="l37.673">       &lt;/method&gt;</span>
<a href="#l37.674"></a><span id="l37.674"> </span>
<a href="#l37.675"></a><span id="l37.675">       &lt;!-- Adds the dropshadows to the children of the binding. The dropshadows</span>
<a href="#l37.676"></a><span id="l37.676">            are added at the first position of the children --&gt;</span>
<a href="#l37.677"></a><span id="l37.677">       &lt;method name=&quot;addDropShadows&quot;&gt;</span>
<a href="#l37.678"></a><span id="l37.678">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.679"></a><span id="l37.679">           if (this.mDropShadows) {</span>
<a href="#l37.680"></a><span id="l37.680" class="difflineat">@@ -559,23 +571,23 @@</span>
<a href="#l37.681"></a><span id="l37.681">           }</span>
<a href="#l37.682"></a><span id="l37.682">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.683"></a><span id="l37.683">       &lt;/method&gt;</span>
<a href="#l37.684"></a><span id="l37.684"> </span>
<a href="#l37.685"></a><span id="l37.685">       &lt;!-- removes all dropShadows from the binding. Dropshadows are recognized</span>
<a href="#l37.686"></a><span id="l37.686">            as such by carrying an attribute &quot;dropshadow&quot; --&gt;</span>
<a href="#l37.687"></a><span id="l37.687">       &lt;method name=&quot;removeDropShadows&quot;&gt;</span>
<a href="#l37.688"></a><span id="l37.688">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l37.689"></a><span id="l37.689" class="difflineminus">-            // method that may be overwritten by derived bindings...</span>
<a href="#l37.690"></a><span id="l37.690" class="difflineminus">-            if (this.calendarView.mDropShadows) {</span>
<a href="#l37.691"></a><span id="l37.691" class="difflineminus">-                for (let shadow of this.calendarView.mDropShadows) {</span>
<a href="#l37.692"></a><span id="l37.692" class="difflineminus">-                    cal.removeChildElementsByAttribute(shadow, &quot;class&quot;, &quot;dropshadow&quot;);</span>
<a href="#l37.693"></a><span id="l37.693" class="difflineminus">-                }</span>
<a href="#l37.694"></a><span id="l37.694" class="difflineminus">-            }</span>
<a href="#l37.695"></a><span id="l37.695" class="difflineminus">-            this.calendarView.mDropShadows = null;</span>
<a href="#l37.696"></a><span id="l37.696" class="difflineplus">+          // method that may be overwritten by derived bindings...</span>
<a href="#l37.697"></a><span id="l37.697" class="difflineplus">+          if (this.calendarView.mDropShadows) {</span>
<a href="#l37.698"></a><span id="l37.698" class="difflineplus">+              for (let shadow of this.calendarView.mDropShadows) {</span>
<a href="#l37.699"></a><span id="l37.699" class="difflineplus">+                  cal.removeChildElementsByAttribute(shadow, &quot;class&quot;, &quot;dropshadow&quot;);</span>
<a href="#l37.700"></a><span id="l37.700" class="difflineplus">+              }</span>
<a href="#l37.701"></a><span id="l37.701" class="difflineplus">+          }</span>
<a href="#l37.702"></a><span id="l37.702" class="difflineplus">+          this.calendarView.mDropShadows = null;</span>
<a href="#l37.703"></a><span id="l37.703">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.704"></a><span id="l37.704">       &lt;/method&gt;</span>
<a href="#l37.705"></a><span id="l37.705"> </span>
<a href="#l37.706"></a><span id="l37.706">       &lt;!-- By setting the attribute &quot;dropbox&quot; to &quot;true&quot; or &quot;false&quot; the</span>
<a href="#l37.707"></a><span id="l37.707">            dropshadows are added or removed --&gt;</span>
<a href="#l37.708"></a><span id="l37.708">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l37.709"></a><span id="l37.709">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l37.710"></a><span id="l37.710">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l37.711"></a><span id="l37.711" class="difflineat">@@ -592,122 +604,121 @@</span>
<a href="#l37.712"></a><span id="l37.712">                   } else {</span>
<a href="#l37.713"></a><span id="l37.713">                       this.removeDropShadows();</span>
<a href="#l37.714"></a><span id="l37.714">                   }</span>
<a href="#l37.715"></a><span id="l37.715">               }</span>
<a href="#l37.716"></a><span id="l37.716">           }</span>
<a href="#l37.717"></a><span id="l37.717">           return XULElement.prototype.setAttribute.call(this, aAttr, aVal);</span>
<a href="#l37.718"></a><span id="l37.718">         ]]&gt;&lt;/body&gt;</span>
<a href="#l37.719"></a><span id="l37.719">       &lt;/method&gt;</span>
<a href="#l37.720"></a><span id="l37.720" class="difflineminus">-</span>
<a href="#l37.721"></a><span id="l37.721">     &lt;/implementation&gt;</span>
<a href="#l37.722"></a><span id="l37.722"> </span>
<a href="#l37.723"></a><span id="l37.723">     &lt;handlers&gt;</span>
<a href="#l37.724"></a><span id="l37.724">       &lt;handler event=&quot;dragstart&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l37.725"></a><span id="l37.725" class="difflineminus">-         let draggedDOMNode = event.target;</span>
<a href="#l37.726"></a><span id="l37.726" class="difflineminus">-         if (!draggedDOMNode || draggedDOMNode.parentNode != this) {</span>
<a href="#l37.727"></a><span id="l37.727" class="difflineminus">-             return;</span>
<a href="#l37.728"></a><span id="l37.728" class="difflineminus">-         }</span>
<a href="#l37.729"></a><span id="l37.729" class="difflineminus">-         let item = draggedDOMNode.occurrence.clone();</span>
<a href="#l37.730"></a><span id="l37.730" class="difflineminus">-         let beginMoveDate = draggedDOMNode.mParentBox.date;</span>
<a href="#l37.731"></a><span id="l37.731" class="difflineminus">-         let itemStartDate = (item.startDate || item.entryDate || item.dueDate).getInTimezone(calendarView.mTimezone);</span>
<a href="#l37.732"></a><span id="l37.732" class="difflineminus">-         let itemEndDate = (item.endDate || item.dueDate || item.entryDate).getInTimezone(calendarView.mTimezone);</span>
<a href="#l37.733"></a><span id="l37.733" class="difflineminus">-         let oneMoreDay = (itemEndDate.hour &gt; 0 || itemEndDate.minute &gt; 0);</span>
<a href="#l37.734"></a><span id="l37.734" class="difflineminus">-         itemStartDate.isDate = true;</span>
<a href="#l37.735"></a><span id="l37.735" class="difflineminus">-         itemEndDate.isDate = true;</span>
<a href="#l37.736"></a><span id="l37.736" class="difflineminus">-         let offsetDuration = itemStartDate.subtractDate(beginMoveDate);</span>
<a href="#l37.737"></a><span id="l37.737" class="difflineminus">-         let lenDuration = itemEndDate.subtractDate(itemStartDate);</span>
<a href="#l37.738"></a><span id="l37.738" class="difflineminus">-         let len = lenDuration.weeks * 7 + lenDuration.days;</span>
<a href="#l37.739"></a><span id="l37.739" class="difflineminus">-         this.calendarView.mShadowOffset = offsetDuration;</span>
<a href="#l37.740"></a><span id="l37.740" class="difflineminus">-         this.calendarView.mDropShadowsLength = oneMoreDay ? len + 1 : len;</span>
<a href="#l37.741"></a><span id="l37.741" class="difflineplus">+        let draggedDOMNode = event.target;</span>
<a href="#l37.742"></a><span id="l37.742" class="difflineplus">+        if (!draggedDOMNode || draggedDOMNode.parentNode != this) {</span>
<a href="#l37.743"></a><span id="l37.743" class="difflineplus">+            return;</span>
<a href="#l37.744"></a><span id="l37.744" class="difflineplus">+        }</span>
<a href="#l37.745"></a><span id="l37.745" class="difflineplus">+        let item = draggedDOMNode.occurrence.clone();</span>
<a href="#l37.746"></a><span id="l37.746" class="difflineplus">+        let beginMoveDate = draggedDOMNode.mParentBox.date;</span>
<a href="#l37.747"></a><span id="l37.747" class="difflineplus">+        let itemStartDate = (item.startDate || item.entryDate || item.dueDate).getInTimezone(calendarView.mTimezone);</span>
<a href="#l37.748"></a><span id="l37.748" class="difflineplus">+        let itemEndDate = (item.endDate || item.dueDate || item.entryDate).getInTimezone(calendarView.mTimezone);</span>
<a href="#l37.749"></a><span id="l37.749" class="difflineplus">+        let oneMoreDay = (itemEndDate.hour &gt; 0 || itemEndDate.minute &gt; 0);</span>
<a href="#l37.750"></a><span id="l37.750" class="difflineplus">+        itemStartDate.isDate = true;</span>
<a href="#l37.751"></a><span id="l37.751" class="difflineplus">+        itemEndDate.isDate = true;</span>
<a href="#l37.752"></a><span id="l37.752" class="difflineplus">+        let offsetDuration = itemStartDate.subtractDate(beginMoveDate);</span>
<a href="#l37.753"></a><span id="l37.753" class="difflineplus">+        let lenDuration = itemEndDate.subtractDate(itemStartDate);</span>
<a href="#l37.754"></a><span id="l37.754" class="difflineplus">+        let len = lenDuration.weeks * 7 + lenDuration.days;</span>
<a href="#l37.755"></a><span id="l37.755" class="difflineplus">+        this.calendarView.mShadowOffset = offsetDuration;</span>
<a href="#l37.756"></a><span id="l37.756" class="difflineplus">+        this.calendarView.mDropShadowsLength = oneMoreDay ? len + 1 : len;</span>
<a href="#l37.757"></a><span id="l37.757">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l37.758"></a><span id="l37.758"> </span>
<a href="#l37.759"></a><span id="l37.759">       &lt;handler event=&quot;dragover&quot;&gt;&lt;![CDATA[</span>
<a href="#l37.760"></a><span id="l37.760" class="difflineminus">-         let session = cal.getDragService().getCurrentSession();</span>
<a href="#l37.761"></a><span id="l37.761" class="difflineminus">-         if (!session || !session.sourceNode || !session.sourceNode.sourceObject) {</span>
<a href="#l37.762"></a><span id="l37.762" class="difflineplus">+        let session = cal.getDragService().getCurrentSession();</span>
<a href="#l37.763"></a><span id="l37.763" class="difflineplus">+        if (!session || !session.sourceNode || !session.sourceNode.sourceObject) {</span>
<a href="#l37.764"></a><span id="l37.764">             // No source item? Then this is not for us.</span>
<a href="#l37.765"></a><span id="l37.765">             return;</span>
<a href="#l37.766"></a><span id="l37.766" class="difflineminus">-         }</span>
<a href="#l37.767"></a><span id="l37.767" class="difflineplus">+        }</span>
<a href="#l37.768"></a><span id="l37.768"> </span>
<a href="#l37.769"></a><span id="l37.769" class="difflineminus">-         // We handled the event</span>
<a href="#l37.770"></a><span id="l37.770" class="difflineminus">-         event.preventDefault();</span>
<a href="#l37.771"></a><span id="l37.771" class="difflineplus">+        // We handled the event</span>
<a href="#l37.772"></a><span id="l37.772" class="difflineplus">+        event.preventDefault();</span>
<a href="#l37.773"></a><span id="l37.773">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l37.774"></a><span id="l37.774"> </span>
<a href="#l37.775"></a><span id="l37.775">       &lt;handler event=&quot;dragenter&quot;&gt;&lt;![CDATA[</span>
<a href="#l37.776"></a><span id="l37.776" class="difflineminus">-       if (event.target.localName == this.localName) {</span>
<a href="#l37.777"></a><span id="l37.777" class="difflineminus">-           let session = cal.getDragService().getCurrentSession();</span>
<a href="#l37.778"></a><span id="l37.778" class="difflineminus">-           if (session) {</span>
<a href="#l37.779"></a><span id="l37.779" class="difflineminus">-               if (!session.sourceNode || !session.sourceNode.sourceObject) {</span>
<a href="#l37.780"></a><span id="l37.780" class="difflineminus">-                  // No source item? Then this is not for us.</span>
<a href="#l37.781"></a><span id="l37.781" class="difflineminus">-                  return;</span>
<a href="#l37.782"></a><span id="l37.782" class="difflineminus">-               }</span>
<a href="#l37.783"></a><span id="l37.783" class="difflineplus">+        if (event.target.localName == this.localName) {</span>
<a href="#l37.784"></a><span id="l37.784" class="difflineplus">+            let session = cal.getDragService().getCurrentSession();</span>
<a href="#l37.785"></a><span id="l37.785" class="difflineplus">+            if (session) {</span>
<a href="#l37.786"></a><span id="l37.786" class="difflineplus">+                if (!session.sourceNode || !session.sourceNode.sourceObject) {</span>
<a href="#l37.787"></a><span id="l37.787" class="difflineplus">+                    // No source item? Then this is not for us.</span>
<a href="#l37.788"></a><span id="l37.788" class="difflineplus">+                    return;</span>
<a href="#l37.789"></a><span id="l37.789" class="difflineplus">+                }</span>
<a href="#l37.790"></a><span id="l37.790"> </span>
<a href="#l37.791"></a><span id="l37.791" class="difflineminus">-               // We can drop now, tell the drag service.</span>
<a href="#l37.792"></a><span id="l37.792" class="difflineminus">-               event.preventDefault();</span>
<a href="#l37.793"></a><span id="l37.793" class="difflineplus">+                // We can drop now, tell the drag service.</span>
<a href="#l37.794"></a><span id="l37.794" class="difflineplus">+                event.preventDefault();</span>
<a href="#l37.795"></a><span id="l37.795"> </span>
<a href="#l37.796"></a><span id="l37.796" class="difflineminus">-               if (!this.hasAttribute(&quot;dropbox&quot;) || this.getAttribute(&quot;dropbox&quot;) == &quot;false&quot;) {</span>
<a href="#l37.797"></a><span id="l37.797" class="difflineminus">-                   // As it turned out it was not possible to remove the remaining dropshadows</span>
<a href="#l37.798"></a><span id="l37.798" class="difflineminus">-                   // at the &quot;dragleave&quot; or &quot;dragexit&quot; event, majorly because it was not reliably</span>
<a href="#l37.799"></a><span id="l37.799" class="difflineminus">-                   // fired. As the dragndropcontainer may be anonymous it is further on not</span>
<a href="#l37.800"></a><span id="l37.800" class="difflineminus">-                   // possible to remove the dropshadows by something like</span>
<a href="#l37.801"></a><span id="l37.801" class="difflineminus">-                   // &quot;document.getElementsByAttribute('dropbox').removeDropShadows();&quot;;</span>
<a href="#l37.802"></a><span id="l37.802" class="difflineminus">-                   // So we have to remove them at the currentView(). The restriction of course is</span>
<a href="#l37.803"></a><span id="l37.803" class="difflineminus">-                   // that these containers so far may not be used for drag and drop from/to e.g.</span>
<a href="#l37.804"></a><span id="l37.804" class="difflineminus">-                   // the today-pane.</span>
<a href="#l37.805"></a><span id="l37.805" class="difflineminus">-                   currentView().removeDropShadows();</span>
<a href="#l37.806"></a><span id="l37.806" class="difflineminus">-               }</span>
<a href="#l37.807"></a><span id="l37.807" class="difflineminus">-               this.setAttribute(&quot;dropbox&quot;, &quot;true&quot;);</span>
<a href="#l37.808"></a><span id="l37.808" class="difflineminus">-           }</span>
<a href="#l37.809"></a><span id="l37.809" class="difflineminus">-       }</span>
<a href="#l37.810"></a><span id="l37.810" class="difflineplus">+                if (!this.hasAttribute(&quot;dropbox&quot;) || this.getAttribute(&quot;dropbox&quot;) == &quot;false&quot;) {</span>
<a href="#l37.811"></a><span id="l37.811" class="difflineplus">+                    // As it turned out it was not possible to remove the remaining dropshadows</span>
<a href="#l37.812"></a><span id="l37.812" class="difflineplus">+                    // at the &quot;dragleave&quot; or &quot;dragexit&quot; event, majorly because it was not reliably</span>
<a href="#l37.813"></a><span id="l37.813" class="difflineplus">+                    // fired. As the dragndropcontainer may be anonymous it is further on not</span>
<a href="#l37.814"></a><span id="l37.814" class="difflineplus">+                    // possible to remove the dropshadows by something like</span>
<a href="#l37.815"></a><span id="l37.815" class="difflineplus">+                    // &quot;document.getElementsByAttribute('dropbox').removeDropShadows();&quot;;</span>
<a href="#l37.816"></a><span id="l37.816" class="difflineplus">+                    // So we have to remove them at the currentView(). The restriction of course is</span>
<a href="#l37.817"></a><span id="l37.817" class="difflineplus">+                    // that these containers so far may not be used for drag and drop from/to e.g.</span>
<a href="#l37.818"></a><span id="l37.818" class="difflineplus">+                    // the today-pane.</span>
<a href="#l37.819"></a><span id="l37.819" class="difflineplus">+                    currentView().removeDropShadows();</span>
<a href="#l37.820"></a><span id="l37.820" class="difflineplus">+                }</span>
<a href="#l37.821"></a><span id="l37.821" class="difflineplus">+                this.setAttribute(&quot;dropbox&quot;, &quot;true&quot;);</span>
<a href="#l37.822"></a><span id="l37.822" class="difflineplus">+            }</span>
<a href="#l37.823"></a><span id="l37.823" class="difflineplus">+        }</span>
<a href="#l37.824"></a><span id="l37.824">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l37.825"></a><span id="l37.825"> </span>
<a href="#l37.826"></a><span id="l37.826">       &lt;handler event=&quot;drop&quot;&gt;&lt;![CDATA[</span>
<a href="#l37.827"></a><span id="l37.827" class="difflineminus">-         let session = cal.getDragService().getCurrentSession();</span>
<a href="#l37.828"></a><span id="l37.828" class="difflineminus">-         if (!session || !session.sourceNode || !session.sourceNode.sourceObject) {</span>
<a href="#l37.829"></a><span id="l37.829" class="difflineplus">+        let session = cal.getDragService().getCurrentSession();</span>
<a href="#l37.830"></a><span id="l37.830" class="difflineplus">+        if (!session || !session.sourceNode || !session.sourceNode.sourceObject) {</span>
<a href="#l37.831"></a><span id="l37.831">             // No source node? Not our drag.</span>
<a href="#l37.832"></a><span id="l37.832">             return;</span>
<a href="#l37.833"></a><span id="l37.833" class="difflineminus">-         }</span>
<a href="#l37.834"></a><span id="l37.834" class="difflineminus">-         let item = session.sourceNode.sourceObject.clone();</span>
<a href="#l37.835"></a><span id="l37.835" class="difflineminus">-         this.setAttribute(&quot;dropbox&quot;, &quot;false&quot;);</span>
<a href="#l37.836"></a><span id="l37.836" class="difflineminus">-         let transfer = Components.classes[&quot;@mozilla.org/widget/transferable;1&quot;]</span>
<a href="#l37.837"></a><span id="l37.837" class="difflineminus">-                                  .createInstance(Components.interfaces.nsITransferable);</span>
<a href="#l37.838"></a><span id="l37.838" class="difflineminus">-         transfer.init(null);</span>
<a href="#l37.839"></a><span id="l37.839" class="difflineplus">+        }</span>
<a href="#l37.840"></a><span id="l37.840" class="difflineplus">+        let item = session.sourceNode.sourceObject.clone();</span>
<a href="#l37.841"></a><span id="l37.841" class="difflineplus">+        this.setAttribute(&quot;dropbox&quot;, &quot;false&quot;);</span>
<a href="#l37.842"></a><span id="l37.842" class="difflineplus">+        let transfer = Components.classes[&quot;@mozilla.org/widget/transferable;1&quot;]</span>
<a href="#l37.843"></a><span id="l37.843" class="difflineplus">+                                 .createInstance(Components.interfaces.nsITransferable);</span>
<a href="#l37.844"></a><span id="l37.844" class="difflineplus">+        transfer.init(null);</span>
<a href="#l37.845"></a><span id="l37.845"> </span>
<a href="#l37.846"></a><span id="l37.846" class="difflineminus">-         if (isEvent(item)) {</span>
<a href="#l37.847"></a><span id="l37.847" class="difflineminus">-             transfer.addDataFlavor(&quot;application/x-moz-cal-event&quot;);</span>
<a href="#l37.848"></a><span id="l37.848" class="difflineminus">-         } else {</span>
<a href="#l37.849"></a><span id="l37.849" class="difflineminus">-             transfer.addDataFlavor(&quot;application/x-moz-cal-task&quot;);</span>
<a href="#l37.850"></a><span id="l37.850" class="difflineminus">-         }</span>
<a href="#l37.851"></a><span id="l37.851" class="difflineplus">+        if (isEvent(item)) {</span>
<a href="#l37.852"></a><span id="l37.852" class="difflineplus">+            transfer.addDataFlavor(&quot;application/x-moz-cal-event&quot;);</span>
<a href="#l37.853"></a><span id="l37.853" class="difflineplus">+        } else {</span>
<a href="#l37.854"></a><span id="l37.854" class="difflineplus">+            transfer.addDataFlavor(&quot;application/x-moz-cal-task&quot;);</span>
<a href="#l37.855"></a><span id="l37.855" class="difflineplus">+        }</span>
<a href="#l37.856"></a><span id="l37.856"> </span>
<a href="#l37.857"></a><span id="l37.857" class="difflineminus">-         session.getData(transfer, 0);</span>
<a href="#l37.858"></a><span id="l37.858" class="difflineminus">-         item = session.sourceNode.sourceObject;</span>
<a href="#l37.859"></a><span id="l37.859" class="difflineplus">+        session.getData(transfer, 0);</span>
<a href="#l37.860"></a><span id="l37.860" class="difflineplus">+        item = session.sourceNode.sourceObject;</span>
<a href="#l37.861"></a><span id="l37.861"> </span>
<a href="#l37.862"></a><span id="l37.862" class="difflineminus">-         let newItem = this.onDropItem(item).clone();</span>
<a href="#l37.863"></a><span id="l37.863" class="difflineminus">-         let newStart = newItem.startDate || newItem.entryDate || newItem.dueDate;</span>
<a href="#l37.864"></a><span id="l37.864" class="difflineminus">-         let newEnd = newItem.endDate || newItem.dueDate || newItem.entryDate;</span>
<a href="#l37.865"></a><span id="l37.865" class="difflineminus">-         let offset = this.calendarView.mShadowOffset;</span>
<a href="#l37.866"></a><span id="l37.866" class="difflineminus">-         newStart.addDuration(offset);</span>
<a href="#l37.867"></a><span id="l37.867" class="difflineminus">-         newEnd.addDuration(offset);</span>
<a href="#l37.868"></a><span id="l37.868" class="difflineminus">-         this.calendarView.controller.modifyOccurrence(item, newStart, newEnd);</span>
<a href="#l37.869"></a><span id="l37.869" class="difflineplus">+        let newItem = this.onDropItem(item).clone();</span>
<a href="#l37.870"></a><span id="l37.870" class="difflineplus">+        let newStart = newItem.startDate || newItem.entryDate || newItem.dueDate;</span>
<a href="#l37.871"></a><span id="l37.871" class="difflineplus">+        let newEnd = newItem.endDate || newItem.dueDate || newItem.entryDate;</span>
<a href="#l37.872"></a><span id="l37.872" class="difflineplus">+        let offset = this.calendarView.mShadowOffset;</span>
<a href="#l37.873"></a><span id="l37.873" class="difflineplus">+        newStart.addDuration(offset);</span>
<a href="#l37.874"></a><span id="l37.874" class="difflineplus">+        newEnd.addDuration(offset);</span>
<a href="#l37.875"></a><span id="l37.875" class="difflineplus">+        this.calendarView.controller.modifyOccurrence(item, newStart, newEnd);</span>
<a href="#l37.876"></a><span id="l37.876"> </span>
<a href="#l37.877"></a><span id="l37.877" class="difflineminus">-         // We handled the event</span>
<a href="#l37.878"></a><span id="l37.878" class="difflineminus">-         event.stopPropagation();</span>
<a href="#l37.879"></a><span id="l37.879" class="difflineplus">+        // We handled the event</span>
<a href="#l37.880"></a><span id="l37.880" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l37.881"></a><span id="l37.881">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l37.882"></a><span id="l37.882"> </span>
<a href="#l37.883"></a><span id="l37.883">       &lt;handler event=&quot;dragend&quot;&gt;&lt;![CDATA[</span>
<a href="#l37.884"></a><span id="l37.884" class="difflineminus">-          currentView().removeDropShadows();</span>
<a href="#l37.885"></a><span id="l37.885" class="difflineplus">+        currentView().removeDropShadows();</span>
<a href="#l37.886"></a><span id="l37.886">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l37.887"></a><span id="l37.887" class="difflineminus">-</span>
<a href="#l37.888"></a><span id="l37.888">     &lt;/handlers&gt;</span>
<a href="#l37.889"></a><span id="l37.889">   &lt;/binding&gt;</span>
<a href="#l37.890"></a><span id="l37.890"> </span>
<a href="#l37.891"></a><span id="l37.891">   &lt;binding id=&quot;view-tab&quot; extends=&quot;chrome://global/content/bindings/tabbox.xml#tab&quot;&gt;</span>
<a href="#l37.892"></a><span id="l37.892">     &lt;resources&gt;</span>
<a href="#l37.893"></a><span id="l37.893">       &lt;stylesheet src=&quot;chrome://calendar/skin/widgets/calendar-widgets.css&quot;/&gt;</span>
<a href="#l37.894"></a><span id="l37.894">     &lt;/resources&gt;</span>
<a href="#l37.895"></a><span id="l37.895" class="difflineplus">+</span>
<a href="#l37.896"></a><span id="l37.896">     &lt;content&gt;</span>
<a href="#l37.897"></a><span id="l37.897">       &lt;xul:hbox class=&quot;tab-middle box-inherit&quot; xbl:inherits=&quot;align,dir,pack,orient,selected&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l37.898"></a><span id="l37.898">         &lt;xul:image class=&quot;tab-icon&quot; xbl:inherits=&quot;validate,src=image&quot;/&gt;</span>
<a href="#l37.899"></a><span id="l37.899">         &lt;xul:stack&gt;</span>
<a href="#l37.900"></a><span id="l37.900">           &lt;xul:label class=&quot;tab-text unselected-text&quot;</span>
<a href="#l37.901"></a><span id="l37.901">                      xbl:inherits=&quot;value=label,accesskey,crop,disabled,selected&quot;</span>
<a href="#l37.902"></a><span id="l37.902">                      flex=&quot;1&quot;/&gt;</span>
<a href="#l37.903"></a><span id="l37.903">           &lt;xul:label class=&quot;tab-text selected-text&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,10 +1,9 @@</span>
<a href="#l38.4"></a><span id="l38.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l38.5"></a><span id="l38.5" class="difflineminus">-</span>
<a href="#l38.6"></a><span id="l38.6"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l38.7"></a><span id="l38.7">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l38.8"></a><span id="l38.8">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10"> &lt;!--</span>
<a href="#l38.11"></a><span id="l38.11">    MiniMonth Calendar: day-of-month grid XBL component.</span>
<a href="#l38.12"></a><span id="l38.12">    Displays month name and year above grid of days of month by week rows.</span>
<a href="#l38.13"></a><span id="l38.13">    Arrows move forward or back a month.</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineat">@@ -22,459 +21,466 @@</span>
<a href="#l38.15"></a><span id="l38.15">    Use attributes onpopuplisthidden and onmonthchange for working around</span>
<a href="#l38.16"></a><span id="l38.16">    bugs that occur when minimonth is displayed in a popup (as in datepicker):</span>
<a href="#l38.17"></a><span id="l38.17">      Currently (2005.3)</span>
<a href="#l38.18"></a><span id="l38.18">        whenever a child popup is hidden, the parent popup needs to be reshown.</span>
<a href="#l38.19"></a><span id="l38.19">          Use onpopuplisthidden to reshow parent popop (hidePopup, openPopup).</span>
<a href="#l38.20"></a><span id="l38.20">        When title month or year changes, parent popup may need to be reshown.</span>
<a href="#l38.21"></a><span id="l38.21">          Use onmonthchange to reshow parent popop (hidePopup, openPopup).</span>
<a href="#l38.22"></a><span id="l38.22"> --&gt;</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineplus">+</span>
<a href="#l38.24"></a><span id="l38.24"> &lt;!DOCTYPE bindings</span>
<a href="#l38.25"></a><span id="l38.25"> [</span>
<a href="#l38.26"></a><span id="l38.26">     &lt;!ENTITY % dtd1 SYSTEM &quot;chrome://calendar/locale/global.dtd&quot; &gt; %dtd1;</span>
<a href="#l38.27"></a><span id="l38.27">     &lt;!ENTITY % dtd2 SYSTEM &quot;chrome://global/locale/global.dtd&quot; &gt; %dtd2;</span>
<a href="#l38.28"></a><span id="l38.28"> ]&gt;</span>
<a href="#l38.29"></a><span id="l38.29"> </span>
<a href="#l38.30"></a><span id="l38.30"> &lt;bindings id=&quot;xulMiniMonth&quot;</span>
<a href="#l38.31"></a><span id="l38.31">           xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l38.32"></a><span id="l38.32">           xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l38.33"></a><span id="l38.33">           xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l38.34"></a><span id="l38.34"> </span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-   &lt;binding id=&quot;minimonth-header&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineminus">-     &lt;content class=&quot;minimonth-month-box&quot; align=&quot;center&quot;&gt;</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineminus">-         &lt;xul:deck anonid=&quot;monthheader&quot; xbl:inherits=&quot;selectedIndex=month&quot; class=&quot;minimonth-month-name-readonly&quot;&gt;</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.1.name;&quot;/&gt;</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.2.name;&quot;/&gt;</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.3.name;&quot;/&gt;</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.4.name;&quot;/&gt;</span>
<a href="#l38.42"></a><span id="l38.42" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.5.name;&quot;/&gt;</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.6.name;&quot;/&gt;</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.7.name;&quot;/&gt;</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.8.name;&quot;/&gt;</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.9.name;&quot;/&gt;</span>
<a href="#l38.47"></a><span id="l38.47" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.10.name;&quot;/&gt;</span>
<a href="#l38.48"></a><span id="l38.48" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.11.name;&quot;/&gt;</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-           &lt;xul:text value=&quot;&amp;month.12.name;&quot;/&gt;</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-         &lt;/xul:deck&gt;</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineminus">-         &lt;xul:text anonid=&quot;yearcell&quot; class=&quot;minimonth-year-name-readonly&quot; xbl:inherits=&quot;value=year&quot;/&gt;</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineminus">-         &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l38.53"></a><span id="l38.53" class="difflineminus">-     &lt;/content&gt;</span>
<a href="#l38.54"></a><span id="l38.54" class="difflineminus">-   &lt;/binding&gt;</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineplus">+  &lt;binding id=&quot;minimonth-header&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineplus">+    &lt;content class=&quot;minimonth-month-box&quot; align=&quot;center&quot;&gt;</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineplus">+      &lt;xul:deck anonid=&quot;monthheader&quot; xbl:inherits=&quot;selectedIndex=month&quot; class=&quot;minimonth-month-name-readonly&quot;&gt;</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.1.name;&quot;/&gt;</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.2.name;&quot;/&gt;</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.3.name;&quot;/&gt;</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.4.name;&quot;/&gt;</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.5.name;&quot;/&gt;</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.6.name;&quot;/&gt;</span>
<a href="#l38.64"></a><span id="l38.64" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.7.name;&quot;/&gt;</span>
<a href="#l38.65"></a><span id="l38.65" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.8.name;&quot;/&gt;</span>
<a href="#l38.66"></a><span id="l38.66" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.9.name;&quot;/&gt;</span>
<a href="#l38.67"></a><span id="l38.67" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.10.name;&quot;/&gt;</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.11.name;&quot;/&gt;</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineplus">+        &lt;xul:text value=&quot;&amp;month.12.name;&quot;/&gt;</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineplus">+      &lt;/xul:deck&gt;</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineplus">+      &lt;xul:text anonid=&quot;yearcell&quot; class=&quot;minimonth-year-name-readonly&quot; xbl:inherits=&quot;value=year&quot;/&gt;</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineplus">+      &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l38.74"></a><span id="l38.74" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l38.75"></a><span id="l38.75"> </span>
<a href="#l38.76"></a><span id="l38.76" class="difflineminus">-   &lt;binding id=&quot;active-minimonth-header&quot; extends=&quot;chrome://calendar/content/widgets/minimonth.xml#minimonth-header&quot;&gt;</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineminus">-       &lt;content class=&quot;minimonth-month-box&quot; align=&quot;center&quot;&gt;</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineminus">-         &lt;xul:deck anonid=&quot;monthheader&quot; xbl:inherits=&quot;selectedIndex=month&quot;  class=&quot;minimonth-month-name&quot;&gt;</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.1.name;&quot; oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.2.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.81"></a><span id="l38.81" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.3.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.82"></a><span id="l38.82" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.4.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.83"></a><span id="l38.83" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.5.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.84"></a><span id="l38.84" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.6.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.85"></a><span id="l38.85" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.7.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.86"></a><span id="l38.86" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.8.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.87"></a><span id="l38.87" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.9.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.88"></a><span id="l38.88" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.10.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.89"></a><span id="l38.89" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.11.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.90"></a><span id="l38.90" class="difflineminus">-           &lt;xul:toolbarbutton label=&quot;&amp;month.12.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.91"></a><span id="l38.91" class="difflineminus">-         &lt;/xul:deck&gt;</span>
<a href="#l38.92"></a><span id="l38.92" class="difflineminus">-         &lt;xul:toolbarbutton anonid=&quot;yearcell&quot;</span>
<a href="#l38.93"></a><span id="l38.93" class="difflineminus">-                            class=&quot;minimonth-year-name&quot;</span>
<a href="#l38.94"></a><span id="l38.94" class="difflineminus">-                            oncommand=&quot;showPopupList(event, 'years-popup')&quot;</span>
<a href="#l38.95"></a><span id="l38.95" class="difflineminus">-                            xbl:inherits=&quot;label=year&quot;/&gt;</span>
<a href="#l38.96"></a><span id="l38.96" class="difflineminus">-         &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l38.97"></a><span id="l38.97" class="difflineminus">-         &lt;xul:toolbarbutton anonid=&quot;back-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;-1&quot;</span>
<a href="#l38.98"></a><span id="l38.98" class="difflineminus">-                            oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l38.99"></a><span id="l38.99" class="difflineminus">-                            tooltiptext=&quot;&amp;onemonthbackward.tooltip;&quot;/&gt;</span>
<a href="#l38.100"></a><span id="l38.100" class="difflineminus">-         &lt;xul:toolbarbutton anonid=&quot;today-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;0&quot;</span>
<a href="#l38.101"></a><span id="l38.101" class="difflineminus">-                            oncommand=&quot;this.kMinimonth.value = new Date();&quot;</span>
<a href="#l38.102"></a><span id="l38.102" class="difflineminus">-                            tooltiptext=&quot;&amp;showToday.tooltip;&quot;/&gt;</span>
<a href="#l38.103"></a><span id="l38.103" class="difflineminus">-         &lt;xul:toolbarbutton anonid=&quot;forward-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;1&quot;</span>
<a href="#l38.104"></a><span id="l38.104" class="difflineminus">-                            oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l38.105"></a><span id="l38.105" class="difflineminus">-                            tooltiptext=&quot;&amp;onemonthforward.tooltip;&quot;/&gt;</span>
<a href="#l38.106"></a><span id="l38.106" class="difflineminus">-       &lt;xul:popupset anonid=&quot;minmonth-popupset&quot;&gt;</span>
<a href="#l38.107"></a><span id="l38.107" class="difflineminus">-         &lt;xul:menupopup anonid=&quot;months-popup&quot; position=&quot;after_start&quot;</span>
<a href="#l38.108"></a><span id="l38.108" class="difflineminus">-                        onpopupshowing=&quot;event.stopPropagation();&quot;</span>
<a href="#l38.109"></a><span id="l38.109" class="difflineminus">-                        onpopuphidden=&quot;firePopupListHidden();&quot;&gt;</span>
<a href="#l38.110"></a><span id="l38.110" class="difflineminus">-           &lt;xul:vbox&gt;</span>
<a href="#l38.111"></a><span id="l38.111" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.1.name;&quot; index=&quot;0&quot;/&gt;</span>
<a href="#l38.112"></a><span id="l38.112" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.2.name;&quot; index=&quot;1&quot;/&gt;</span>
<a href="#l38.113"></a><span id="l38.113" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.3.name;&quot; index=&quot;2&quot;/&gt;</span>
<a href="#l38.114"></a><span id="l38.114" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.4.name;&quot; index=&quot;3&quot;/&gt;</span>
<a href="#l38.115"></a><span id="l38.115" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.5.name;&quot; index=&quot;4&quot;/&gt;</span>
<a href="#l38.116"></a><span id="l38.116" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.6.name;&quot; index=&quot;5&quot;/&gt;</span>
<a href="#l38.117"></a><span id="l38.117" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.7.name;&quot; index=&quot;6&quot;/&gt;</span>
<a href="#l38.118"></a><span id="l38.118" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.8.name;&quot; index=&quot;7&quot;/&gt;</span>
<a href="#l38.119"></a><span id="l38.119" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.9.name;&quot; index=&quot;8&quot;/&gt;</span>
<a href="#l38.120"></a><span id="l38.120" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.10.name;&quot; index=&quot;9&quot;/&gt;</span>
<a href="#l38.121"></a><span id="l38.121" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.11.name;&quot; index=&quot;10&quot;/&gt;</span>
<a href="#l38.122"></a><span id="l38.122" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.12.name;&quot; index=&quot;11&quot;/&gt;</span>
<a href="#l38.123"></a><span id="l38.123" class="difflineminus">-           &lt;/xul:vbox&gt;</span>
<a href="#l38.124"></a><span id="l38.124" class="difflineminus">-         &lt;/xul:menupopup&gt;</span>
<a href="#l38.125"></a><span id="l38.125" class="difflineminus">-         &lt;xul:menupopup anonid=&quot;years-popup&quot; position=&quot;after_start&quot;</span>
<a href="#l38.126"></a><span id="l38.126" class="difflineminus">-                        onpopupshowing=&quot;moveYears('reset', 0); event.stopPropagation();&quot;</span>
<a href="#l38.127"></a><span id="l38.127" class="difflineminus">-                        onpopuphidden=&quot;firePopupListHidden();&quot;&gt;</span>
<a href="#l38.128"></a><span id="l38.128" class="difflineminus">-           &lt;xul:vbox&gt;</span>
<a href="#l38.129"></a><span id="l38.129" class="difflineminus">-             &lt;xul:autorepeatbutton class=&quot;autorepeatbutton-up&quot;</span>
<a href="#l38.130"></a><span id="l38.130" class="difflineminus">-                                   orient=&quot;vertical&quot;</span>
<a href="#l38.131"></a><span id="l38.131" class="difflineminus">-                                   oncommand=&quot;moveYears('up', 1);&quot;/&gt;</span>
<a href="#l38.132"></a><span id="l38.132" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.133"></a><span id="l38.133" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.134"></a><span id="l38.134" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.135"></a><span id="l38.135" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.136"></a><span id="l38.136" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.137"></a><span id="l38.137" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.138"></a><span id="l38.138" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.139"></a><span id="l38.139" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.140"></a><span id="l38.140" class="difflineminus">-             &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.141"></a><span id="l38.141" class="difflineminus">-             &lt;xul:autorepeatbutton class=&quot;autorepeatbutton-down&quot;</span>
<a href="#l38.142"></a><span id="l38.142" class="difflineminus">-                                   orient=&quot;vertical&quot;</span>
<a href="#l38.143"></a><span id="l38.143" class="difflineminus">-                                   oncommand=&quot;moveYears('down', 1);&quot;/&gt;</span>
<a href="#l38.144"></a><span id="l38.144" class="difflineminus">-           &lt;/xul:vbox&gt;</span>
<a href="#l38.145"></a><span id="l38.145" class="difflineminus">-         &lt;/xul:menupopup&gt;</span>
<a href="#l38.146"></a><span id="l38.146" class="difflineminus">-       &lt;/xul:popupset&gt;</span>
<a href="#l38.147"></a><span id="l38.147" class="difflineminus">-     &lt;/content&gt;</span>
<a href="#l38.148"></a><span id="l38.148" class="difflineminus">-     &lt;implementation&gt;</span>
<a href="#l38.149"></a><span id="l38.149" class="difflineminus">-       &lt;field name=&quot;kMinimonth&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.150"></a><span id="l38.150" class="difflineminus">-       &lt;field name=&quot;mPopup&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.151"></a><span id="l38.151" class="difflineminus">-       &lt;field name=&quot;mScrollYearsHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.152"></a><span id="l38.152" class="difflineminus">-       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l38.153"></a><span id="l38.153" class="difflineminus">-       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l38.154"></a><span id="l38.154" class="difflineminus">-         this.kMinimonth = getParentNodeOrThis(this, &quot;minimonth&quot;);</span>
<a href="#l38.155"></a><span id="l38.155" class="difflineminus">-         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;back-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l38.156"></a><span id="l38.156" class="difflineminus">-         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;today-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l38.157"></a><span id="l38.157" class="difflineminus">-         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;forward-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l38.158"></a><span id="l38.158" class="difflineplus">+  &lt;binding id=&quot;active-minimonth-header&quot; extends=&quot;chrome://calendar/content/widgets/minimonth.xml#minimonth-header&quot;&gt;</span>
<a href="#l38.159"></a><span id="l38.159" class="difflineplus">+    &lt;content class=&quot;minimonth-month-box&quot; align=&quot;center&quot;&gt;</span>
<a href="#l38.160"></a><span id="l38.160" class="difflineplus">+      &lt;xul:deck anonid=&quot;monthheader&quot; xbl:inherits=&quot;selectedIndex=month&quot;  class=&quot;minimonth-month-name&quot;&gt;</span>
<a href="#l38.161"></a><span id="l38.161" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.1.name;&quot; oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.162"></a><span id="l38.162" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.2.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.163"></a><span id="l38.163" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.3.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.164"></a><span id="l38.164" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.4.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.165"></a><span id="l38.165" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.5.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.166"></a><span id="l38.166" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.6.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.167"></a><span id="l38.167" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.7.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.168"></a><span id="l38.168" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.8.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.169"></a><span id="l38.169" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.9.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.170"></a><span id="l38.170" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.10.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.171"></a><span id="l38.171" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.11.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.172"></a><span id="l38.172" class="difflineplus">+        &lt;xul:toolbarbutton label=&quot;&amp;month.12.name;&quot;  oncommand=&quot;showPopupList(event, 'months-popup')&quot;/&gt;</span>
<a href="#l38.173"></a><span id="l38.173" class="difflineplus">+      &lt;/xul:deck&gt;</span>
<a href="#l38.174"></a><span id="l38.174" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;yearcell&quot;</span>
<a href="#l38.175"></a><span id="l38.175" class="difflineplus">+                         class=&quot;minimonth-year-name&quot;</span>
<a href="#l38.176"></a><span id="l38.176" class="difflineplus">+                         oncommand=&quot;showPopupList(event, 'years-popup')&quot;</span>
<a href="#l38.177"></a><span id="l38.177" class="difflineplus">+                         xbl:inherits=&quot;label=year&quot;/&gt;</span>
<a href="#l38.178"></a><span id="l38.178" class="difflineplus">+      &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l38.179"></a><span id="l38.179" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;back-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;-1&quot;</span>
<a href="#l38.180"></a><span id="l38.180" class="difflineplus">+                         oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l38.181"></a><span id="l38.181" class="difflineplus">+                         tooltiptext=&quot;&amp;onemonthbackward.tooltip;&quot;/&gt;</span>
<a href="#l38.182"></a><span id="l38.182" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;today-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;0&quot;</span>
<a href="#l38.183"></a><span id="l38.183" class="difflineplus">+                         oncommand=&quot;this.kMinimonth.value = new Date();&quot;</span>
<a href="#l38.184"></a><span id="l38.184" class="difflineplus">+                         tooltiptext=&quot;&amp;showToday.tooltip;&quot;/&gt;</span>
<a href="#l38.185"></a><span id="l38.185" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;forward-button&quot; class=&quot;minimonth-nav-btns&quot; dir=&quot;1&quot;</span>
<a href="#l38.186"></a><span id="l38.186" class="difflineplus">+                         oncommand=&quot;this.kMinimonth.advanceMonth(parseInt(this.getAttribute('dir'), 10))&quot;</span>
<a href="#l38.187"></a><span id="l38.187" class="difflineplus">+                         tooltiptext=&quot;&amp;onemonthforward.tooltip;&quot;/&gt;</span>
<a href="#l38.188"></a><span id="l38.188" class="difflineplus">+      &lt;xul:popupset anonid=&quot;minmonth-popupset&quot;&gt;</span>
<a href="#l38.189"></a><span id="l38.189" class="difflineplus">+        &lt;xul:menupopup anonid=&quot;months-popup&quot; position=&quot;after_start&quot;</span>
<a href="#l38.190"></a><span id="l38.190" class="difflineplus">+                       onpopupshowing=&quot;event.stopPropagation();&quot;</span>
<a href="#l38.191"></a><span id="l38.191" class="difflineplus">+                       onpopuphidden=&quot;firePopupListHidden();&quot;&gt;</span>
<a href="#l38.192"></a><span id="l38.192" class="difflineplus">+          &lt;xul:vbox&gt;</span>
<a href="#l38.193"></a><span id="l38.193" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.1.name;&quot; index=&quot;0&quot;/&gt;</span>
<a href="#l38.194"></a><span id="l38.194" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.2.name;&quot; index=&quot;1&quot;/&gt;</span>
<a href="#l38.195"></a><span id="l38.195" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.3.name;&quot; index=&quot;2&quot;/&gt;</span>
<a href="#l38.196"></a><span id="l38.196" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.4.name;&quot; index=&quot;3&quot;/&gt;</span>
<a href="#l38.197"></a><span id="l38.197" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.5.name;&quot; index=&quot;4&quot;/&gt;</span>
<a href="#l38.198"></a><span id="l38.198" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.6.name;&quot; index=&quot;5&quot;/&gt;</span>
<a href="#l38.199"></a><span id="l38.199" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.7.name;&quot; index=&quot;6&quot;/&gt;</span>
<a href="#l38.200"></a><span id="l38.200" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.8.name;&quot; index=&quot;7&quot;/&gt;</span>
<a href="#l38.201"></a><span id="l38.201" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.9.name;&quot; index=&quot;8&quot;/&gt;</span>
<a href="#l38.202"></a><span id="l38.202" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.10.name;&quot; index=&quot;9&quot;/&gt;</span>
<a href="#l38.203"></a><span id="l38.203" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.11.name;&quot; index=&quot;10&quot;/&gt;</span>
<a href="#l38.204"></a><span id="l38.204" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot; value=&quot;&amp;month.12.name;&quot; index=&quot;11&quot;/&gt;</span>
<a href="#l38.205"></a><span id="l38.205" class="difflineplus">+          &lt;/xul:vbox&gt;</span>
<a href="#l38.206"></a><span id="l38.206" class="difflineplus">+        &lt;/xul:menupopup&gt;</span>
<a href="#l38.207"></a><span id="l38.207" class="difflineplus">+        &lt;xul:menupopup anonid=&quot;years-popup&quot; position=&quot;after_start&quot;</span>
<a href="#l38.208"></a><span id="l38.208" class="difflineplus">+                       onpopupshowing=&quot;moveYears('reset', 0); event.stopPropagation();&quot;</span>
<a href="#l38.209"></a><span id="l38.209" class="difflineplus">+                       onpopuphidden=&quot;firePopupListHidden();&quot;&gt;</span>
<a href="#l38.210"></a><span id="l38.210" class="difflineplus">+          &lt;xul:vbox&gt;</span>
<a href="#l38.211"></a><span id="l38.211" class="difflineplus">+            &lt;xul:autorepeatbutton class=&quot;autorepeatbutton-up&quot;</span>
<a href="#l38.212"></a><span id="l38.212" class="difflineplus">+                                  orient=&quot;vertical&quot;</span>
<a href="#l38.213"></a><span id="l38.213" class="difflineplus">+                                  oncommand=&quot;moveYears('up', 1);&quot;/&gt;</span>
<a href="#l38.214"></a><span id="l38.214" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.215"></a><span id="l38.215" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.216"></a><span id="l38.216" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.217"></a><span id="l38.217" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.218"></a><span id="l38.218" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.219"></a><span id="l38.219" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.220"></a><span id="l38.220" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.221"></a><span id="l38.221" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.222"></a><span id="l38.222" class="difflineplus">+            &lt;xul:text class=&quot;minimonth-list&quot;/&gt;</span>
<a href="#l38.223"></a><span id="l38.223" class="difflineplus">+            &lt;xul:autorepeatbutton class=&quot;autorepeatbutton-down&quot;</span>
<a href="#l38.224"></a><span id="l38.224" class="difflineplus">+                                  orient=&quot;vertical&quot;</span>
<a href="#l38.225"></a><span id="l38.225" class="difflineplus">+                                  oncommand=&quot;moveYears('down', 1);&quot;/&gt;</span>
<a href="#l38.226"></a><span id="l38.226" class="difflineplus">+          &lt;/xul:vbox&gt;</span>
<a href="#l38.227"></a><span id="l38.227" class="difflineplus">+        &lt;/xul:menupopup&gt;</span>
<a href="#l38.228"></a><span id="l38.228" class="difflineplus">+      &lt;/xul:popupset&gt;</span>
<a href="#l38.229"></a><span id="l38.229" class="difflineplus">+    &lt;/content&gt;</span>
<a href="#l38.230"></a><span id="l38.230" class="difflineplus">+    &lt;implementation&gt;</span>
<a href="#l38.231"></a><span id="l38.231" class="difflineplus">+      &lt;field name=&quot;kMinimonth&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.232"></a><span id="l38.232" class="difflineplus">+      &lt;field name=&quot;mPopup&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.233"></a><span id="l38.233" class="difflineplus">+      &lt;field name=&quot;mScrollYearsHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.234"></a><span id="l38.234" class="difflineplus">+      &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l38.235"></a><span id="l38.235" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l38.236"></a><span id="l38.236" class="difflineplus">+        this.kMinimonth = getParentNodeOrThis(this, &quot;minimonth&quot;);</span>
<a href="#l38.237"></a><span id="l38.237" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;back-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l38.238"></a><span id="l38.238" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;today-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l38.239"></a><span id="l38.239" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;forward-button&quot;).kMinimonth = this.kMinimonth;</span>
<a href="#l38.240"></a><span id="l38.240"> </span>
<a href="#l38.241"></a><span id="l38.241" class="difflineminus">-         this.mScrollYearsHandler = this.scrollYears.bind(this);</span>
<a href="#l38.242"></a><span id="l38.242" class="difflineminus">-         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;)</span>
<a href="#l38.243"></a><span id="l38.243" class="difflineminus">-                 .addEventListener(&quot;wheel&quot;, this.mScrollYearsHandler, true);</span>
<a href="#l38.244"></a><span id="l38.244" class="difflineminus">-       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l38.245"></a><span id="l38.245" class="difflineminus">-       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l38.246"></a><span id="l38.246" class="difflineminus">-         document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;)</span>
<a href="#l38.247"></a><span id="l38.247" class="difflineminus">-                 .removeEventListener(&quot;wheel&quot;, this.mScrollYearsHandler, true);</span>
<a href="#l38.248"></a><span id="l38.248" class="difflineminus">-         this.mScrollYearsHandler = null;</span>
<a href="#l38.249"></a><span id="l38.249" class="difflineminus">-       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l38.250"></a><span id="l38.250" class="difflineplus">+        this.mScrollYearsHandler = this.scrollYears.bind(this);</span>
<a href="#l38.251"></a><span id="l38.251" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;)</span>
<a href="#l38.252"></a><span id="l38.252" class="difflineplus">+                .addEventListener(&quot;wheel&quot;, this.mScrollYearsHandler, true);</span>
<a href="#l38.253"></a><span id="l38.253" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l38.254"></a><span id="l38.254" class="difflineplus">+</span>
<a href="#l38.255"></a><span id="l38.255" class="difflineplus">+      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l38.256"></a><span id="l38.256" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;)</span>
<a href="#l38.257"></a><span id="l38.257" class="difflineplus">+                .removeEventListener(&quot;wheel&quot;, this.mScrollYearsHandler, true);</span>
<a href="#l38.258"></a><span id="l38.258" class="difflineplus">+        this.mScrollYearsHandler = null;</span>
<a href="#l38.259"></a><span id="l38.259" class="difflineplus">+      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l38.260"></a><span id="l38.260"> </span>
<a href="#l38.261"></a><span id="l38.261" class="difflineminus">-       &lt;method name=&quot;showPopupList&quot;&gt;</span>
<a href="#l38.262"></a><span id="l38.262" class="difflineminus">-         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l38.263"></a><span id="l38.263" class="difflineminus">-         &lt;parameter name=&quot;aPopupAnonId&quot;/&gt;</span>
<a href="#l38.264"></a><span id="l38.264" class="difflineminus">-          &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.265"></a><span id="l38.265" class="difflineminus">-           // Close open popups (if any), to prevent linux crashes</span>
<a href="#l38.266"></a><span id="l38.266" class="difflineminus">-           if (this.mPopup) {</span>
<a href="#l38.267"></a><span id="l38.267" class="difflineminus">-               this.mPopup.hidePopup();</span>
<a href="#l38.268"></a><span id="l38.268" class="difflineminus">-           }</span>
<a href="#l38.269"></a><span id="l38.269" class="difflineminus">-           this.mPopup = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, aPopupAnonId);</span>
<a href="#l38.270"></a><span id="l38.270" class="difflineminus">-           this.mPopup.openPopup(aEvent.target, &quot;after_start&quot;);</span>
<a href="#l38.271"></a><span id="l38.271" class="difflineminus">-         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.272"></a><span id="l38.272" class="difflineminus">-       &lt;/method&gt;</span>
<a href="#l38.273"></a><span id="l38.273" class="difflineplus">+      &lt;method name=&quot;showPopupList&quot;&gt;</span>
<a href="#l38.274"></a><span id="l38.274" class="difflineplus">+        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l38.275"></a><span id="l38.275" class="difflineplus">+        &lt;parameter name=&quot;aPopupAnonId&quot;/&gt;</span>
<a href="#l38.276"></a><span id="l38.276" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.277"></a><span id="l38.277" class="difflineplus">+          // Close open popups (if any), to prevent linux crashes</span>
<a href="#l38.278"></a><span id="l38.278" class="difflineplus">+          if (this.mPopup) {</span>
<a href="#l38.279"></a><span id="l38.279" class="difflineplus">+              this.mPopup.hidePopup();</span>
<a href="#l38.280"></a><span id="l38.280" class="difflineplus">+          }</span>
<a href="#l38.281"></a><span id="l38.281" class="difflineplus">+          this.mPopup = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, aPopupAnonId);</span>
<a href="#l38.282"></a><span id="l38.282" class="difflineplus">+          this.mPopup.openPopup(aEvent.target, &quot;after_start&quot;);</span>
<a href="#l38.283"></a><span id="l38.283" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.284"></a><span id="l38.284" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l38.285"></a><span id="l38.285" class="difflineplus">+</span>
<a href="#l38.286"></a><span id="l38.286" class="difflineplus">+      &lt;method name=&quot;hidePopupList&quot;&gt;</span>
<a href="#l38.287"></a><span id="l38.287" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.288"></a><span id="l38.288" class="difflineplus">+          // Close open popups (if any)</span>
<a href="#l38.289"></a><span id="l38.289" class="difflineplus">+          let popup = this.mPopup;</span>
<a href="#l38.290"></a><span id="l38.290" class="difflineplus">+          this.mPopup = null;</span>
<a href="#l38.291"></a><span id="l38.291" class="difflineplus">+          if (popup) {</span>
<a href="#l38.292"></a><span id="l38.292" class="difflineplus">+              popup.hidePopup();</span>
<a href="#l38.293"></a><span id="l38.293" class="difflineplus">+          }</span>
<a href="#l38.294"></a><span id="l38.294" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.295"></a><span id="l38.295" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l38.296"></a><span id="l38.296"> </span>
<a href="#l38.297"></a><span id="l38.297" class="difflineminus">-       &lt;method name=&quot;hidePopupList&quot;&gt;</span>
<a href="#l38.298"></a><span id="l38.298" class="difflineminus">-         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.299"></a><span id="l38.299" class="difflineminus">-           // Close open popups (if any)</span>
<a href="#l38.300"></a><span id="l38.300" class="difflineminus">-           let popup = this.mPopup;</span>
<a href="#l38.301"></a><span id="l38.301" class="difflineminus">-           this.mPopup = null;</span>
<a href="#l38.302"></a><span id="l38.302" class="difflineminus">-           if (popup) {</span>
<a href="#l38.303"></a><span id="l38.303" class="difflineminus">-               popup.hidePopup();</span>
<a href="#l38.304"></a><span id="l38.304" class="difflineminus">-           }</span>
<a href="#l38.305"></a><span id="l38.305" class="difflineminus">-         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.306"></a><span id="l38.306" class="difflineminus">-       &lt;/method&gt;</span>
<a href="#l38.307"></a><span id="l38.307" class="difflineminus">-       &lt;method name=&quot;firePopupListHidden&quot;&gt;</span>
<a href="#l38.308"></a><span id="l38.308" class="difflineminus">-         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.309"></a><span id="l38.309" class="difflineminus">-           if (this.mPopup) {</span>
<a href="#l38.310"></a><span id="l38.310" class="difflineminus">-               this.mPopup = null;</span>
<a href="#l38.311"></a><span id="l38.311" class="difflineminus">-               this.kMinimonth.fireEvent(&quot;popuplisthidden&quot;);</span>
<a href="#l38.312"></a><span id="l38.312" class="difflineminus">-           }</span>
<a href="#l38.313"></a><span id="l38.313" class="difflineminus">-         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.314"></a><span id="l38.314" class="difflineminus">-       &lt;/method&gt;</span>
<a href="#l38.315"></a><span id="l38.315" class="difflineminus">-       &lt;method name=&quot;updateMonthPopup&quot;&gt;</span>
<a href="#l38.316"></a><span id="l38.316" class="difflineminus">-         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.317"></a><span id="l38.317" class="difflineminus">-         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.318"></a><span id="l38.318" class="difflineminus">-           let months = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;months-popup&quot;).firstChild.childNodes;</span>
<a href="#l38.319"></a><span id="l38.319" class="difflineminus">-           let month = aDate.getMonth();</span>
<a href="#l38.320"></a><span id="l38.320" class="difflineminus">-           for (let i = 0; i &lt; months.length; i++) {</span>
<a href="#l38.321"></a><span id="l38.321" class="difflineminus">-               months[i].setAttribute(&quot;current&quot;, i == month ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l38.322"></a><span id="l38.322" class="difflineminus">-           }</span>
<a href="#l38.323"></a><span id="l38.323" class="difflineminus">-         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.324"></a><span id="l38.324" class="difflineminus">-       &lt;/method&gt;</span>
<a href="#l38.325"></a><span id="l38.325" class="difflineminus">-       &lt;method name=&quot;updateYearPopup&quot;&gt;</span>
<a href="#l38.326"></a><span id="l38.326" class="difflineminus">-         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.327"></a><span id="l38.327" class="difflineminus">-         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.328"></a><span id="l38.328" class="difflineminus">-           let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).firstChild.childNodes;</span>
<a href="#l38.329"></a><span id="l38.329" class="difflineminus">-           let year = new Date(aDate);</span>
<a href="#l38.330"></a><span id="l38.330" class="difflineminus">-           let compFullYear = aDate.getFullYear();</span>
<a href="#l38.331"></a><span id="l38.331" class="difflineminus">-           year.setFullYear(Math.max(1, compFullYear - Math.trunc(years.length / 2) + 1));</span>
<a href="#l38.332"></a><span id="l38.332" class="difflineminus">-           for (let i = 1; i &lt; years.length - 1; i++) {</span>
<a href="#l38.333"></a><span id="l38.333" class="difflineminus">-               let curfullYear = year.getFullYear();</span>
<a href="#l38.334"></a><span id="l38.334" class="difflineminus">-               years[i].setAttribute(&quot;value&quot;, curfullYear);</span>
<a href="#l38.335"></a><span id="l38.335" class="difflineminus">-               years[i].setAttribute(&quot;current&quot;, curfullYear == compFullYear ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l38.336"></a><span id="l38.336" class="difflineminus">-               year.setFullYear(curfullYear + 1);</span>
<a href="#l38.337"></a><span id="l38.337" class="difflineminus">-           }</span>
<a href="#l38.338"></a><span id="l38.338" class="difflineminus">-         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.339"></a><span id="l38.339" class="difflineminus">-       &lt;/method&gt;</span>
<a href="#l38.340"></a><span id="l38.340" class="difflineplus">+      &lt;method name=&quot;firePopupListHidden&quot;&gt;</span>
<a href="#l38.341"></a><span id="l38.341" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.342"></a><span id="l38.342" class="difflineplus">+          if (this.mPopup) {</span>
<a href="#l38.343"></a><span id="l38.343" class="difflineplus">+              this.mPopup = null;</span>
<a href="#l38.344"></a><span id="l38.344" class="difflineplus">+              this.kMinimonth.fireEvent(&quot;popuplisthidden&quot;);</span>
<a href="#l38.345"></a><span id="l38.345" class="difflineplus">+          }</span>
<a href="#l38.346"></a><span id="l38.346" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.347"></a><span id="l38.347" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l38.348"></a><span id="l38.348" class="difflineplus">+</span>
<a href="#l38.349"></a><span id="l38.349" class="difflineplus">+      &lt;method name=&quot;updateMonthPopup&quot;&gt;</span>
<a href="#l38.350"></a><span id="l38.350" class="difflineplus">+        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.351"></a><span id="l38.351" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.352"></a><span id="l38.352" class="difflineplus">+          let months = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;months-popup&quot;).firstChild.childNodes;</span>
<a href="#l38.353"></a><span id="l38.353" class="difflineplus">+          let month = aDate.getMonth();</span>
<a href="#l38.354"></a><span id="l38.354" class="difflineplus">+          for (let i = 0; i &lt; months.length; i++) {</span>
<a href="#l38.355"></a><span id="l38.355" class="difflineplus">+              months[i].setAttribute(&quot;current&quot;, i == month ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l38.356"></a><span id="l38.356" class="difflineplus">+          }</span>
<a href="#l38.357"></a><span id="l38.357" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.358"></a><span id="l38.358" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l38.359"></a><span id="l38.359" class="difflineplus">+</span>
<a href="#l38.360"></a><span id="l38.360" class="difflineplus">+      &lt;method name=&quot;updateYearPopup&quot;&gt;</span>
<a href="#l38.361"></a><span id="l38.361" class="difflineplus">+        &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.362"></a><span id="l38.362" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.363"></a><span id="l38.363" class="difflineplus">+          let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).firstChild.childNodes;</span>
<a href="#l38.364"></a><span id="l38.364" class="difflineplus">+          let year = new Date(aDate);</span>
<a href="#l38.365"></a><span id="l38.365" class="difflineplus">+          let compFullYear = aDate.getFullYear();</span>
<a href="#l38.366"></a><span id="l38.366" class="difflineplus">+          year.setFullYear(Math.max(1, compFullYear - Math.trunc(years.length / 2) + 1));</span>
<a href="#l38.367"></a><span id="l38.367" class="difflineplus">+          for (let i = 1; i &lt; years.length - 1; i++) {</span>
<a href="#l38.368"></a><span id="l38.368" class="difflineplus">+              let curfullYear = year.getFullYear();</span>
<a href="#l38.369"></a><span id="l38.369" class="difflineplus">+              years[i].setAttribute(&quot;value&quot;, curfullYear);</span>
<a href="#l38.370"></a><span id="l38.370" class="difflineplus">+              years[i].setAttribute(&quot;current&quot;, curfullYear == compFullYear ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l38.371"></a><span id="l38.371" class="difflineplus">+              year.setFullYear(curfullYear + 1);</span>
<a href="#l38.372"></a><span id="l38.372" class="difflineplus">+          }</span>
<a href="#l38.373"></a><span id="l38.373" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.374"></a><span id="l38.374" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l38.375"></a><span id="l38.375"> </span>
<a href="#l38.376"></a><span id="l38.376" class="difflineminus">-       &lt;method name=&quot;scrollYears&quot;&gt;</span>
<a href="#l38.377"></a><span id="l38.377" class="difflineminus">-         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l38.378"></a><span id="l38.378" class="difflineminus">-         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.379"></a><span id="l38.379" class="difflineminus">-           let yearPopup = getParentNodeOrThis(event.target, &quot;menupopup&quot;);</span>
<a href="#l38.380"></a><span id="l38.380" class="difflineminus">-           const pixelThreshold = 75;</span>
<a href="#l38.381"></a><span id="l38.381" class="difflineminus">-           if (yearPopup) {</span>
<a href="#l38.382"></a><span id="l38.382" class="difflineminus">-               let monthList = yearPopup.getElementsByAttribute(&quot;class&quot;, &quot;minimonth-list&quot;);</span>
<a href="#l38.383"></a><span id="l38.383" class="difflineminus">-               if (monthList &amp;&amp; monthList.length &gt; 0) {</span>
<a href="#l38.384"></a><span id="l38.384" class="difflineminus">-                   if (event.deltaMode == event.DOM_DELTA_PAGE) {</span>
<a href="#l38.385"></a><span id="l38.385" class="difflineminus">-                     let dir = (event.deltaY &gt; 0 ? &quot;up&quot; : &quot;down&quot;);</span>
<a href="#l38.386"></a><span id="l38.386" class="difflineminus">-                     this.moveYears(dir, Math.abs(event.deltaY) * monthList.length);</span>
<a href="#l38.387"></a><span id="l38.387" class="difflineminus">-                   } else if (event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l38.388"></a><span id="l38.388" class="difflineminus">-                     let dir = (event.deltaY &gt; 0 ? &quot;up&quot; : &quot;down&quot;);</span>
<a href="#l38.389"></a><span id="l38.389" class="difflineminus">-                     this.moveYears(dir, 1);</span>
<a href="#l38.390"></a><span id="l38.390" class="difflineminus">-                   } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l38.391"></a><span id="l38.391" class="difflineminus">-                     this.mPixelScrollDelta += event.deltaY;</span>
<a href="#l38.392"></a><span id="l38.392" class="difflineminus">-                     if (this.mPixelScrollDelta &gt; pixelThreshold) {</span>
<a href="#l38.393"></a><span id="l38.393" class="difflineminus">-                        this.moveYears(&quot;down&quot;, 1);</span>
<a href="#l38.394"></a><span id="l38.394" class="difflineminus">-                        this.mPixelScrollDelta = 0;</span>
<a href="#l38.395"></a><span id="l38.395" class="difflineminus">-                     } else if (this.mPixelScrollDelta &lt; -pixelThreshold) {</span>
<a href="#l38.396"></a><span id="l38.396" class="difflineminus">-                        this.moveYears(&quot;up&quot;, 1);</span>
<a href="#l38.397"></a><span id="l38.397" class="difflineminus">-                        this.mPixelScrollDelta = 0;</span>
<a href="#l38.398"></a><span id="l38.398" class="difflineminus">-                     }</span>
<a href="#l38.399"></a><span id="l38.399" class="difflineminus">-                   }</span>
<a href="#l38.400"></a><span id="l38.400" class="difflineplus">+      &lt;method name=&quot;scrollYears&quot;&gt;</span>
<a href="#l38.401"></a><span id="l38.401" class="difflineplus">+        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l38.402"></a><span id="l38.402" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.403"></a><span id="l38.403" class="difflineplus">+          let yearPopup = getParentNodeOrThis(event.target, &quot;menupopup&quot;);</span>
<a href="#l38.404"></a><span id="l38.404" class="difflineplus">+          const pixelThreshold = 75;</span>
<a href="#l38.405"></a><span id="l38.405" class="difflineplus">+          if (yearPopup) {</span>
<a href="#l38.406"></a><span id="l38.406" class="difflineplus">+              let monthList = yearPopup.getElementsByAttribute(&quot;class&quot;, &quot;minimonth-list&quot;);</span>
<a href="#l38.407"></a><span id="l38.407" class="difflineplus">+              if (monthList &amp;&amp; monthList.length &gt; 0) {</span>
<a href="#l38.408"></a><span id="l38.408" class="difflineplus">+                  if (event.deltaMode == event.DOM_DELTA_PAGE) {</span>
<a href="#l38.409"></a><span id="l38.409" class="difflineplus">+                      let dir = event.deltaY &gt; 0 ? &quot;up&quot; : &quot;down&quot;;</span>
<a href="#l38.410"></a><span id="l38.410" class="difflineplus">+                      this.moveYears(dir, Math.abs(event.deltaY) * monthList.length);</span>
<a href="#l38.411"></a><span id="l38.411" class="difflineplus">+                  } else if (event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l38.412"></a><span id="l38.412" class="difflineplus">+                      let dir = event.deltaY &gt; 0 ? &quot;up&quot; : &quot;down&quot;;</span>
<a href="#l38.413"></a><span id="l38.413" class="difflineplus">+                      this.moveYears(dir, 1);</span>
<a href="#l38.414"></a><span id="l38.414" class="difflineplus">+                  } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l38.415"></a><span id="l38.415" class="difflineplus">+                      this.mPixelScrollDelta += event.deltaY;</span>
<a href="#l38.416"></a><span id="l38.416" class="difflineplus">+                      if (this.mPixelScrollDelta &gt; pixelThreshold) {</span>
<a href="#l38.417"></a><span id="l38.417" class="difflineplus">+                          this.moveYears(&quot;down&quot;, 1);</span>
<a href="#l38.418"></a><span id="l38.418" class="difflineplus">+                          this.mPixelScrollDelta = 0;</span>
<a href="#l38.419"></a><span id="l38.419" class="difflineplus">+                      } else if (this.mPixelScrollDelta &lt; -pixelThreshold) {</span>
<a href="#l38.420"></a><span id="l38.420" class="difflineplus">+                          this.moveYears(&quot;up&quot;, 1);</span>
<a href="#l38.421"></a><span id="l38.421" class="difflineplus">+                          this.mPixelScrollDelta = 0;</span>
<a href="#l38.422"></a><span id="l38.422" class="difflineplus">+                      }</span>
<a href="#l38.423"></a><span id="l38.423" class="difflineplus">+                  }</span>
<a href="#l38.424"></a><span id="l38.424"> </span>
<a href="#l38.425"></a><span id="l38.425" class="difflineminus">-                   event.stopPropagation();</span>
<a href="#l38.426"></a><span id="l38.426" class="difflineminus">-                   event.preventDefault();</span>
<a href="#l38.427"></a><span id="l38.427" class="difflineminus">-               }</span>
<a href="#l38.428"></a><span id="l38.428" class="difflineminus">-           }</span>
<a href="#l38.429"></a><span id="l38.429" class="difflineminus">-         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.430"></a><span id="l38.430" class="difflineminus">-       &lt;/method&gt;</span>
<a href="#l38.431"></a><span id="l38.431" class="difflineplus">+                  event.stopPropagation();</span>
<a href="#l38.432"></a><span id="l38.432" class="difflineplus">+                  event.preventDefault();</span>
<a href="#l38.433"></a><span id="l38.433" class="difflineplus">+              }</span>
<a href="#l38.434"></a><span id="l38.434" class="difflineplus">+          }</span>
<a href="#l38.435"></a><span id="l38.435" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.436"></a><span id="l38.436" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l38.437"></a><span id="l38.437"> </span>
<a href="#l38.438"></a><span id="l38.438" class="difflineminus">-       &lt;method name=&quot;moveYears&quot;&gt;</span>
<a href="#l38.439"></a><span id="l38.439" class="difflineminus">-         &lt;parameter name=&quot;direction&quot;/&gt;</span>
<a href="#l38.440"></a><span id="l38.440" class="difflineminus">-         &lt;parameter name=&quot;scrollOffset&quot;/&gt;</span>
<a href="#l38.441"></a><span id="l38.441" class="difflineminus">-         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.442"></a><span id="l38.442" class="difflineminus">-           // Update the year popup</span>
<a href="#l38.443"></a><span id="l38.443" class="difflineminus">-           let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).firstChild.childNodes;</span>
<a href="#l38.444"></a><span id="l38.444" class="difflineminus">-           let current = this.getAttribute(&quot;year&quot;);</span>
<a href="#l38.445"></a><span id="l38.445" class="difflineminus">-           let offset;</span>
<a href="#l38.446"></a><span id="l38.446" class="difflineminus">-           switch (direction) {</span>
<a href="#l38.447"></a><span id="l38.447" class="difflineminus">-               case &quot;reset&quot;: {</span>
<a href="#l38.448"></a><span id="l38.448" class="difflineminus">-                   let middleyear = years[Math.floor(years.length / 2)].getAttribute(&quot;value&quot;);</span>
<a href="#l38.449"></a><span id="l38.449" class="difflineminus">-                   if (current &lt;= (years.length / 2)) {</span>
<a href="#l38.450"></a><span id="l38.450" class="difflineminus">-                       offset = 1 - years[1].getAttribute(&quot;value&quot;);</span>
<a href="#l38.451"></a><span id="l38.451" class="difflineminus">-                   } else {</span>
<a href="#l38.452"></a><span id="l38.452" class="difflineminus">-                       offset = current - middleyear;</span>
<a href="#l38.453"></a><span id="l38.453" class="difflineminus">-                   }</span>
<a href="#l38.454"></a><span id="l38.454" class="difflineminus">-                   break;</span>
<a href="#l38.455"></a><span id="l38.455" class="difflineminus">-               }</span>
<a href="#l38.456"></a><span id="l38.456" class="difflineminus">-               case &quot;up&quot;: {</span>
<a href="#l38.457"></a><span id="l38.457" class="difflineminus">-                   offset = -Math.abs(scrollOffset) || -1;</span>
<a href="#l38.458"></a><span id="l38.458" class="difflineminus">-                   break;</span>
<a href="#l38.459"></a><span id="l38.459" class="difflineminus">-               }</span>
<a href="#l38.460"></a><span id="l38.460" class="difflineminus">-               case &quot;down&quot;: {</span>
<a href="#l38.461"></a><span id="l38.461" class="difflineminus">-                   offset = Math.abs(scrollOffset) || 1;</span>
<a href="#l38.462"></a><span id="l38.462" class="difflineminus">-                   break;</span>
<a href="#l38.463"></a><span id="l38.463" class="difflineminus">-               }</span>
<a href="#l38.464"></a><span id="l38.464" class="difflineminus">-           }</span>
<a href="#l38.465"></a><span id="l38.465" class="difflineplus">+      &lt;method name=&quot;moveYears&quot;&gt;</span>
<a href="#l38.466"></a><span id="l38.466" class="difflineplus">+        &lt;parameter name=&quot;direction&quot;/&gt;</span>
<a href="#l38.467"></a><span id="l38.467" class="difflineplus">+        &lt;parameter name=&quot;scrollOffset&quot;/&gt;</span>
<a href="#l38.468"></a><span id="l38.468" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.469"></a><span id="l38.469" class="difflineplus">+          // Update the year popup</span>
<a href="#l38.470"></a><span id="l38.470" class="difflineplus">+          let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).firstChild.childNodes;</span>
<a href="#l38.471"></a><span id="l38.471" class="difflineplus">+          let current = this.getAttribute(&quot;year&quot;);</span>
<a href="#l38.472"></a><span id="l38.472" class="difflineplus">+          let offset;</span>
<a href="#l38.473"></a><span id="l38.473" class="difflineplus">+          switch (direction) {</span>
<a href="#l38.474"></a><span id="l38.474" class="difflineplus">+              case &quot;reset&quot;: {</span>
<a href="#l38.475"></a><span id="l38.475" class="difflineplus">+                  let middleyear = years[Math.floor(years.length / 2)].getAttribute(&quot;value&quot;);</span>
<a href="#l38.476"></a><span id="l38.476" class="difflineplus">+                  if (current &lt;= (years.length / 2)) {</span>
<a href="#l38.477"></a><span id="l38.477" class="difflineplus">+                      offset = 1 - years[1].getAttribute(&quot;value&quot;);</span>
<a href="#l38.478"></a><span id="l38.478" class="difflineplus">+                  } else {</span>
<a href="#l38.479"></a><span id="l38.479" class="difflineplus">+                      offset = current - middleyear;</span>
<a href="#l38.480"></a><span id="l38.480" class="difflineplus">+                  }</span>
<a href="#l38.481"></a><span id="l38.481" class="difflineplus">+                  break;</span>
<a href="#l38.482"></a><span id="l38.482" class="difflineplus">+              }</span>
<a href="#l38.483"></a><span id="l38.483" class="difflineplus">+              case &quot;up&quot;: {</span>
<a href="#l38.484"></a><span id="l38.484" class="difflineplus">+                  offset = -Math.abs(scrollOffset) || -1;</span>
<a href="#l38.485"></a><span id="l38.485" class="difflineplus">+                  break;</span>
<a href="#l38.486"></a><span id="l38.486" class="difflineplus">+              }</span>
<a href="#l38.487"></a><span id="l38.487" class="difflineplus">+              case &quot;down&quot;: {</span>
<a href="#l38.488"></a><span id="l38.488" class="difflineplus">+                  offset = Math.abs(scrollOffset) || 1;</span>
<a href="#l38.489"></a><span id="l38.489" class="difflineplus">+                  break;</span>
<a href="#l38.490"></a><span id="l38.490" class="difflineplus">+              }</span>
<a href="#l38.491"></a><span id="l38.491" class="difflineplus">+          }</span>
<a href="#l38.492"></a><span id="l38.492"> </span>
<a href="#l38.493"></a><span id="l38.493" class="difflineminus">-           // Disable the up arrow when we get to the year 1.</span>
<a href="#l38.494"></a><span id="l38.494" class="difflineminus">-           years[0].disabled = (parseInt(years[1].getAttribute(&quot;value&quot;), 10) + offset &lt; 2);</span>
<a href="#l38.495"></a><span id="l38.495" class="difflineplus">+          // Disable the up arrow when we get to the year 1.</span>
<a href="#l38.496"></a><span id="l38.496" class="difflineplus">+          years[0].disabled = parseInt(years[1].getAttribute(&quot;value&quot;), 10) + offset &lt; 2;</span>
<a href="#l38.497"></a><span id="l38.497"> </span>
<a href="#l38.498"></a><span id="l38.498" class="difflineminus">-           if (!offset) {</span>
<a href="#l38.499"></a><span id="l38.499" class="difflineminus">-               // No need to loop through when the offset is zero.</span>
<a href="#l38.500"></a><span id="l38.500" class="difflineminus">-               return;</span>
<a href="#l38.501"></a><span id="l38.501" class="difflineminus">-           }</span>
<a href="#l38.502"></a><span id="l38.502" class="difflineplus">+          if (!offset) {</span>
<a href="#l38.503"></a><span id="l38.503" class="difflineplus">+              // No need to loop through when the offset is zero.</span>
<a href="#l38.504"></a><span id="l38.504" class="difflineplus">+              return;</span>
<a href="#l38.505"></a><span id="l38.505" class="difflineplus">+          }</span>
<a href="#l38.506"></a><span id="l38.506"> </span>
<a href="#l38.507"></a><span id="l38.507" class="difflineminus">-           // Go through all visible years and set the new value. Be sure to</span>
<a href="#l38.508"></a><span id="l38.508" class="difflineminus">-           // skip the autorepeatbuttons.</span>
<a href="#l38.509"></a><span id="l38.509" class="difflineminus">-           for (let i = 1; i &lt; years.length - 1; i++) {</span>
<a href="#l38.510"></a><span id="l38.510" class="difflineminus">-               let value = parseInt(years[i].getAttribute(&quot;value&quot;), 10) + offset;</span>
<a href="#l38.511"></a><span id="l38.511" class="difflineminus">-               years[i].setAttribute(&quot;value&quot;, value);</span>
<a href="#l38.512"></a><span id="l38.512" class="difflineminus">-               years[i].setAttribute(&quot;current&quot;, value == current ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l38.513"></a><span id="l38.513" class="difflineminus">-           }</span>
<a href="#l38.514"></a><span id="l38.514" class="difflineminus">-         ]]&gt; &lt;/body&gt;</span>
<a href="#l38.515"></a><span id="l38.515" class="difflineminus">-       &lt;/method&gt;</span>
<a href="#l38.516"></a><span id="l38.516" class="difflineplus">+          // Go through all visible years and set the new value. Be sure to</span>
<a href="#l38.517"></a><span id="l38.517" class="difflineplus">+          // skip the autorepeatbuttons.</span>
<a href="#l38.518"></a><span id="l38.518" class="difflineplus">+          for (let i = 1; i &lt; years.length - 1; i++) {</span>
<a href="#l38.519"></a><span id="l38.519" class="difflineplus">+              let value = parseInt(years[i].getAttribute(&quot;value&quot;), 10) + offset;</span>
<a href="#l38.520"></a><span id="l38.520" class="difflineplus">+              years[i].setAttribute(&quot;value&quot;, value);</span>
<a href="#l38.521"></a><span id="l38.521" class="difflineplus">+              years[i].setAttribute(&quot;current&quot;, value == current ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l38.522"></a><span id="l38.522" class="difflineplus">+          }</span>
<a href="#l38.523"></a><span id="l38.523" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.524"></a><span id="l38.524" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l38.525"></a><span id="l38.525">     &lt;/implementation&gt;</span>
<a href="#l38.526"></a><span id="l38.526" class="difflineminus">-    &lt;!-- ::::::::::::::::: HANDLERS ::::::::::::::::::::::::: --&gt;</span>
<a href="#l38.527"></a><span id="l38.527" class="difflineplus">+</span>
<a href="#l38.528"></a><span id="l38.528">     &lt;handlers&gt;</span>
<a href="#l38.529"></a><span id="l38.529">       &lt;handler event=&quot;bindingattached&quot; action=&quot;this.initialize();&quot;/&gt;</span>
<a href="#l38.530"></a><span id="l38.530" class="difflineplus">+</span>
<a href="#l38.531"></a><span id="l38.531">       &lt;!-- handle click from nested months popup and years popup --&gt;</span>
<a href="#l38.532"></a><span id="l38.532" class="difflineminus">-      &lt;handler event=&quot;click&quot;&gt;</span>
<a href="#l38.533"></a><span id="l38.533" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l38.534"></a><span id="l38.534" class="difflineminus">-          let element = event.originalTarget;</span>
<a href="#l38.535"></a><span id="l38.535" class="difflineminus">-          let popup = getParentNodeOrThis(element, &quot;menupopup&quot;);</span>
<a href="#l38.536"></a><span id="l38.536" class="difflineminus">-          if (popup) {</span>
<a href="#l38.537"></a><span id="l38.537" class="difflineminus">-              let anonid = popup.getAttribute(&quot;anonid&quot;);</span>
<a href="#l38.538"></a><span id="l38.538" class="difflineminus">-              switch (anonid) {</span>
<a href="#l38.539"></a><span id="l38.539" class="difflineminus">-                  case &quot;months-popup&quot;: {</span>
<a href="#l38.540"></a><span id="l38.540" class="difflineminus">-                      this.hidePopupList();</span>
<a href="#l38.541"></a><span id="l38.541" class="difflineminus">-                      this.kMinimonth.switchMonth(element.getAttribute(&quot;index&quot;));</span>
<a href="#l38.542"></a><span id="l38.542" class="difflineminus">-                      break;</span>
<a href="#l38.543"></a><span id="l38.543" class="difflineminus">-                  }</span>
<a href="#l38.544"></a><span id="l38.544" class="difflineminus">-                  case &quot;years-popup&quot;: {</span>
<a href="#l38.545"></a><span id="l38.545" class="difflineminus">-                      this.hidePopupList();</span>
<a href="#l38.546"></a><span id="l38.546" class="difflineminus">-                      let value = element.getAttribute(&quot;value&quot;);</span>
<a href="#l38.547"></a><span id="l38.547" class="difflineminus">-                      if (value) {</span>
<a href="#l38.548"></a><span id="l38.548" class="difflineminus">-                          this.kMinimonth.switchYear(value);</span>
<a href="#l38.549"></a><span id="l38.549" class="difflineminus">-                      }</span>
<a href="#l38.550"></a><span id="l38.550" class="difflineminus">-                      break;</span>
<a href="#l38.551"></a><span id="l38.551" class="difflineminus">-                  }</span>
<a href="#l38.552"></a><span id="l38.552" class="difflineminus">-              }</span>
<a href="#l38.553"></a><span id="l38.553" class="difflineminus">-          }</span>
<a href="#l38.554"></a><span id="l38.554" class="difflineminus">-        ]]&gt;</span>
<a href="#l38.555"></a><span id="l38.555" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l38.556"></a><span id="l38.556" class="difflineplus">+      &lt;handler event=&quot;click&quot;&gt;&lt;![CDATA[</span>
<a href="#l38.557"></a><span id="l38.557" class="difflineplus">+        let element = event.originalTarget;</span>
<a href="#l38.558"></a><span id="l38.558" class="difflineplus">+        let popup = getParentNodeOrThis(element, &quot;menupopup&quot;);</span>
<a href="#l38.559"></a><span id="l38.559" class="difflineplus">+        if (popup) {</span>
<a href="#l38.560"></a><span id="l38.560" class="difflineplus">+            let anonid = popup.getAttribute(&quot;anonid&quot;);</span>
<a href="#l38.561"></a><span id="l38.561" class="difflineplus">+            switch (anonid) {</span>
<a href="#l38.562"></a><span id="l38.562" class="difflineplus">+                case &quot;months-popup&quot;: {</span>
<a href="#l38.563"></a><span id="l38.563" class="difflineplus">+                    this.hidePopupList();</span>
<a href="#l38.564"></a><span id="l38.564" class="difflineplus">+                    this.kMinimonth.switchMonth(element.getAttribute(&quot;index&quot;));</span>
<a href="#l38.565"></a><span id="l38.565" class="difflineplus">+                    break;</span>
<a href="#l38.566"></a><span id="l38.566" class="difflineplus">+                }</span>
<a href="#l38.567"></a><span id="l38.567" class="difflineplus">+                case &quot;years-popup&quot;: {</span>
<a href="#l38.568"></a><span id="l38.568" class="difflineplus">+                    this.hidePopupList();</span>
<a href="#l38.569"></a><span id="l38.569" class="difflineplus">+                    let value = element.getAttribute(&quot;value&quot;);</span>
<a href="#l38.570"></a><span id="l38.570" class="difflineplus">+                    if (value) {</span>
<a href="#l38.571"></a><span id="l38.571" class="difflineplus">+                        this.kMinimonth.switchYear(value);</span>
<a href="#l38.572"></a><span id="l38.572" class="difflineplus">+                    }</span>
<a href="#l38.573"></a><span id="l38.573" class="difflineplus">+                    break;</span>
<a href="#l38.574"></a><span id="l38.574" class="difflineplus">+                }</span>
<a href="#l38.575"></a><span id="l38.575" class="difflineplus">+            }</span>
<a href="#l38.576"></a><span id="l38.576" class="difflineplus">+        }</span>
<a href="#l38.577"></a><span id="l38.577" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l38.578"></a><span id="l38.578">     &lt;/handlers&gt;</span>
<a href="#l38.579"></a><span id="l38.579">   &lt;/binding&gt;</span>
<a href="#l38.580"></a><span id="l38.580"> </span>
<a href="#l38.581"></a><span id="l38.581">   &lt;binding id=&quot;minimonth&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l38.582"></a><span id="l38.582">     &lt;resources&gt;</span>
<a href="#l38.583"></a><span id="l38.583">       &lt;stylesheet src=&quot;chrome://calendar-common/skin/widgets/minimonth.css&quot;/&gt;</span>
<a href="#l38.584"></a><span id="l38.584">     &lt;/resources&gt;</span>
<a href="#l38.585"></a><span id="l38.585" class="difflineplus">+</span>
<a href="#l38.586"></a><span id="l38.586">     &lt;content orient=&quot;vertical&quot; xbl:inherits=&quot;onchange,onmonthchange,onpopuplisthidden,readonly&quot;&gt;</span>
<a href="#l38.587"></a><span id="l38.587" class="difflineminus">-        &lt;xul:minimonth-header anonid=&quot;minimonth-header&quot; xbl:inherits=&quot;readonly,month,year&quot;/&gt;</span>
<a href="#l38.588"></a><span id="l38.588" class="difflineminus">-        &lt;xul:vbox anonid=&quot;minimonth-calendar&quot; class=&quot;minimonth-cal-box&quot;&gt;</span>
<a href="#l38.589"></a><span id="l38.589" class="difflineminus">-          &lt;xul:hbox class=&quot;minimonth-row-head&quot; anonid=&quot;minimonth-row-header&quot; equalsize=&quot;always&quot;&gt;</span>
<a href="#l38.590"></a><span id="l38.590" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.591"></a><span id="l38.591" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.592"></a><span id="l38.592" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.593"></a><span id="l38.593" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.594"></a><span id="l38.594" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.595"></a><span id="l38.595" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.596"></a><span id="l38.596" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.597"></a><span id="l38.597" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.598"></a><span id="l38.598" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l38.599"></a><span id="l38.599" class="difflineminus">-          &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.600"></a><span id="l38.600" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.601"></a><span id="l38.601" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.602"></a><span id="l38.602" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.603"></a><span id="l38.603" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.604"></a><span id="l38.604" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.605"></a><span id="l38.605" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.606"></a><span id="l38.606" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.607"></a><span id="l38.607" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.608"></a><span id="l38.608" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l38.609"></a><span id="l38.609" class="difflineminus">-          &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.610"></a><span id="l38.610" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.611"></a><span id="l38.611" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.612"></a><span id="l38.612" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.613"></a><span id="l38.613" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.614"></a><span id="l38.614" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.615"></a><span id="l38.615" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.616"></a><span id="l38.616" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.617"></a><span id="l38.617" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.618"></a><span id="l38.618" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l38.619"></a><span id="l38.619" class="difflineminus">-          &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.620"></a><span id="l38.620" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.621"></a><span id="l38.621" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.622"></a><span id="l38.622" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.623"></a><span id="l38.623" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.624"></a><span id="l38.624" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.625"></a><span id="l38.625" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.626"></a><span id="l38.626" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.627"></a><span id="l38.627" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.628"></a><span id="l38.628" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l38.629"></a><span id="l38.629" class="difflineminus">-          &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.630"></a><span id="l38.630" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.631"></a><span id="l38.631" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.632"></a><span id="l38.632" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.633"></a><span id="l38.633" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.634"></a><span id="l38.634" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.635"></a><span id="l38.635" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.636"></a><span id="l38.636" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.637"></a><span id="l38.637" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.638"></a><span id="l38.638" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l38.639"></a><span id="l38.639" class="difflineminus">-          &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.640"></a><span id="l38.640" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.641"></a><span id="l38.641" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.642"></a><span id="l38.642" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.643"></a><span id="l38.643" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.644"></a><span id="l38.644" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.645"></a><span id="l38.645" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.646"></a><span id="l38.646" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.647"></a><span id="l38.647" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.648"></a><span id="l38.648" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l38.649"></a><span id="l38.649" class="difflineminus">-          &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.650"></a><span id="l38.650" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.651"></a><span id="l38.651" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.652"></a><span id="l38.652" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.653"></a><span id="l38.653" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.654"></a><span id="l38.654" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.655"></a><span id="l38.655" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.656"></a><span id="l38.656" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.657"></a><span id="l38.657" class="difflineminus">-            &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.658"></a><span id="l38.658" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l38.659"></a><span id="l38.659" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l38.660"></a><span id="l38.660" class="difflineplus">+      &lt;xul:minimonth-header anonid=&quot;minimonth-header&quot; xbl:inherits=&quot;readonly,month,year&quot;/&gt;</span>
<a href="#l38.661"></a><span id="l38.661" class="difflineplus">+      &lt;xul:vbox anonid=&quot;minimonth-calendar&quot; class=&quot;minimonth-cal-box&quot;&gt;</span>
<a href="#l38.662"></a><span id="l38.662" class="difflineplus">+        &lt;xul:hbox class=&quot;minimonth-row-head&quot; anonid=&quot;minimonth-row-header&quot; equalsize=&quot;always&quot;&gt;</span>
<a href="#l38.663"></a><span id="l38.663" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.664"></a><span id="l38.664" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.665"></a><span id="l38.665" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.666"></a><span id="l38.666" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.667"></a><span id="l38.667" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.668"></a><span id="l38.668" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.669"></a><span id="l38.669" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.670"></a><span id="l38.670" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-row-header&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.671"></a><span id="l38.671" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l38.672"></a><span id="l38.672" class="difflineplus">+        &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.673"></a><span id="l38.673" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.674"></a><span id="l38.674" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.675"></a><span id="l38.675" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.676"></a><span id="l38.676" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.677"></a><span id="l38.677" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.678"></a><span id="l38.678" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.679"></a><span id="l38.679" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.680"></a><span id="l38.680" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.681"></a><span id="l38.681" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l38.682"></a><span id="l38.682" class="difflineplus">+        &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.683"></a><span id="l38.683" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.684"></a><span id="l38.684" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.685"></a><span id="l38.685" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.686"></a><span id="l38.686" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.687"></a><span id="l38.687" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.688"></a><span id="l38.688" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.689"></a><span id="l38.689" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.690"></a><span id="l38.690" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.691"></a><span id="l38.691" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l38.692"></a><span id="l38.692" class="difflineplus">+        &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.693"></a><span id="l38.693" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.694"></a><span id="l38.694" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.695"></a><span id="l38.695" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.696"></a><span id="l38.696" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.697"></a><span id="l38.697" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.698"></a><span id="l38.698" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.699"></a><span id="l38.699" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.700"></a><span id="l38.700" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.701"></a><span id="l38.701" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l38.702"></a><span id="l38.702" class="difflineplus">+        &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.703"></a><span id="l38.703" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.704"></a><span id="l38.704" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.705"></a><span id="l38.705" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.706"></a><span id="l38.706" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.707"></a><span id="l38.707" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.708"></a><span id="l38.708" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.709"></a><span id="l38.709" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.710"></a><span id="l38.710" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.711"></a><span id="l38.711" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l38.712"></a><span id="l38.712" class="difflineplus">+        &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.713"></a><span id="l38.713" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.714"></a><span id="l38.714" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.715"></a><span id="l38.715" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.716"></a><span id="l38.716" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.717"></a><span id="l38.717" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.718"></a><span id="l38.718" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.719"></a><span id="l38.719" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.720"></a><span id="l38.720" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.721"></a><span id="l38.721" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l38.722"></a><span id="l38.722" class="difflineplus">+        &lt;xul:hbox class=&quot;minimonth-row-body&quot; equalsize=&quot;always&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l38.723"></a><span id="l38.723" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-week&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.724"></a><span id="l38.724" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.725"></a><span id="l38.725" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.726"></a><span id="l38.726" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.727"></a><span id="l38.727" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.728"></a><span id="l38.728" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.729"></a><span id="l38.729" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.730"></a><span id="l38.730" class="difflineplus">+          &lt;xul:text class=&quot;minimonth-day&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l38.731"></a><span id="l38.731" class="difflineplus">+        &lt;/xul:hbox&gt;</span>
<a href="#l38.732"></a><span id="l38.732" class="difflineplus">+      &lt;/xul:vbox&gt;</span>
<a href="#l38.733"></a><span id="l38.733">     &lt;/content&gt;</span>
<a href="#l38.734"></a><span id="l38.734"> </span>
<a href="#l38.735"></a><span id="l38.735" class="difflineminus">-    &lt;!-- ::::::::::::::::: INTERFACE ::::::::::::::::::::::::: --&gt;</span>
<a href="#l38.736"></a><span id="l38.736">     &lt;implementation implements=&quot;calICompositeObserver calIOperationListener nsIObserver&quot; &gt;</span>
<a href="#l38.737"></a><span id="l38.737">       &lt;property name=&quot;value&quot;</span>
<a href="#l38.738"></a><span id="l38.738">                 onget=&quot;return this.mValue&quot;</span>
<a href="#l38.739"></a><span id="l38.739">                 onset=&quot;this.update(val)&quot;/&gt;</span>
<a href="#l38.740"></a><span id="l38.740"> </span>
<a href="#l38.741"></a><span id="l38.741">       &lt;property name=&quot;extra&quot;</span>
<a href="#l38.742"></a><span id="l38.742">                 onget=&quot;return this.mExtraDate&quot;</span>
<a href="#l38.743"></a><span id="l38.743">                 onset=&quot;this.mExtraDate = val&quot;/&gt;</span>
<a href="#l38.744"></a><span id="l38.744"> </span>
<a href="#l38.745"></a><span id="l38.745">        &lt;!--returns the first (inclusive) date of the minimonth as a calIDateTime object--&gt;</span>
<a href="#l38.746"></a><span id="l38.746">       &lt;property name=&quot;firstDate&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l38.747"></a><span id="l38.747">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l38.748"></a><span id="l38.748" class="difflineminus">-            let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l38.749"></a><span id="l38.749" class="difflineminus">-            let date = calbox.childNodes[1].firstChild.nextSibling.date;</span>
<a href="#l38.750"></a><span id="l38.750" class="difflineminus">-            return cal.jsDateToDateTime(date);</span>
<a href="#l38.751"></a><span id="l38.751" class="difflineplus">+          let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l38.752"></a><span id="l38.752" class="difflineplus">+          let date = calbox.childNodes[1].firstChild.nextSibling.date;</span>
<a href="#l38.753"></a><span id="l38.753" class="difflineplus">+          return cal.jsDateToDateTime(date);</span>
<a href="#l38.754"></a><span id="l38.754">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l38.755"></a><span id="l38.755">       &lt;/property&gt;</span>
<a href="#l38.756"></a><span id="l38.756"> </span>
<a href="#l38.757"></a><span id="l38.757">        &lt;!--returns the last (exclusive) date of the minimonth as a calIDateTime object--&gt;</span>
<a href="#l38.758"></a><span id="l38.758">       &lt;property name=&quot;lastDate&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l38.759"></a><span id="l38.759">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l38.760"></a><span id="l38.760" class="difflineminus">-            let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l38.761"></a><span id="l38.761" class="difflineminus">-            let date = calbox.lastChild.lastChild.date;</span>
<a href="#l38.762"></a><span id="l38.762" class="difflineminus">-            let lastDateTime = cal.jsDateToDateTime(date);</span>
<a href="#l38.763"></a><span id="l38.763" class="difflineminus">-            lastDateTime.day = lastDateTime.day + 1;</span>
<a href="#l38.764"></a><span id="l38.764" class="difflineminus">-            return lastDateTime;</span>
<a href="#l38.765"></a><span id="l38.765" class="difflineplus">+          let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l38.766"></a><span id="l38.766" class="difflineplus">+          let date = calbox.lastChild.lastChild.date;</span>
<a href="#l38.767"></a><span id="l38.767" class="difflineplus">+          let lastDateTime = cal.jsDateToDateTime(date);</span>
<a href="#l38.768"></a><span id="l38.768" class="difflineplus">+          lastDateTime.day = lastDateTime.day + 1;</span>
<a href="#l38.769"></a><span id="l38.769" class="difflineplus">+          return lastDateTime;</span>
<a href="#l38.770"></a><span id="l38.770">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l38.771"></a><span id="l38.771">       &lt;/property&gt;</span>
<a href="#l38.772"></a><span id="l38.772" class="difflineplus">+</span>
<a href="#l38.773"></a><span id="l38.773">       &lt;field name=&quot;mDaymap&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.774"></a><span id="l38.774">       &lt;field name=&quot;mValue&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.775"></a><span id="l38.775">       &lt;field name=&quot;mEditorDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.776"></a><span id="l38.776">       &lt;field name=&quot;mExtraDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l38.777"></a><span id="l38.777">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l38.778"></a><span id="l38.778">       &lt;field name=&quot;mIsReadOnly&quot;&gt;false&lt;/field&gt;</span>
<a href="#l38.779"></a><span id="l38.779">       &lt;field name=&quot;mObservesComposite&quot;&gt;false&lt;/field&gt;</span>
<a href="#l38.780"></a><span id="l38.780">       &lt;field name=&quot;mShowWeekNumber&quot;&gt;true&lt;/field&gt;</span>
<a href="#l38.781"></a><span id="l38.781" class="difflineplus">+</span>
<a href="#l38.782"></a><span id="l38.782">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l38.783"></a><span id="l38.783" class="difflineminus">-          Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l38.784"></a><span id="l38.784" class="difflineminus">-          Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l38.785"></a><span id="l38.785" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l38.786"></a><span id="l38.786" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l38.787"></a><span id="l38.787"> </span>
<a href="#l38.788"></a><span id="l38.788" class="difflineminus">-          this.mToday = false;</span>
<a href="#l38.789"></a><span id="l38.789" class="difflineminus">-          this.mSelected = false;</span>
<a href="#l38.790"></a><span id="l38.790" class="difflineminus">-          this.mExtra = false;</span>
<a href="#l38.791"></a><span id="l38.791" class="difflineminus">-          this.mValue = new Date(); // Default to &quot;today&quot;</span>
<a href="#l38.792"></a><span id="l38.792" class="difflineminus">-          // save references for convenience</span>
<a href="#l38.793"></a><span id="l38.793" class="difflineminus">-          if (this.hasAttribute(&quot;readonly&quot;)) {</span>
<a href="#l38.794"></a><span id="l38.794" class="difflineminus">-              this.mIsReadOnly = this.getAttribute(&quot;readonly&quot;) == &quot;true&quot;;</span>
<a href="#l38.795"></a><span id="l38.795" class="difflineminus">-          }</span>
<a href="#l38.796"></a><span id="l38.796" class="difflineminus">-          this.refreshDisplay();</span>
<a href="#l38.797"></a><span id="l38.797" class="difflineminus">-          if (this.hasAttribute(&quot;freebusy&quot;)) {</span>
<a href="#l38.798"></a><span id="l38.798" class="difflineminus">-              this._setFreeBusy(this.getAttribute(&quot;freebusy&quot;) == &quot;true&quot;);</span>
<a href="#l38.799"></a><span id="l38.799" class="difflineminus">-          }</span>
<a href="#l38.800"></a><span id="l38.800" class="difflineminus">-          this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l38.801"></a><span id="l38.801" class="difflineplus">+        this.mToday = false;</span>
<a href="#l38.802"></a><span id="l38.802" class="difflineplus">+        this.mSelected = false;</span>
<a href="#l38.803"></a><span id="l38.803" class="difflineplus">+        this.mExtra = false;</span>
<a href="#l38.804"></a><span id="l38.804" class="difflineplus">+        this.mValue = new Date(); // Default to &quot;today&quot;</span>
<a href="#l38.805"></a><span id="l38.805" class="difflineplus">+        // save references for convenience</span>
<a href="#l38.806"></a><span id="l38.806" class="difflineplus">+        if (this.hasAttribute(&quot;readonly&quot;)) {</span>
<a href="#l38.807"></a><span id="l38.807" class="difflineplus">+            this.mIsReadOnly = this.getAttribute(&quot;readonly&quot;) == &quot;true&quot;;</span>
<a href="#l38.808"></a><span id="l38.808" class="difflineplus">+        }</span>
<a href="#l38.809"></a><span id="l38.809" class="difflineplus">+        this.refreshDisplay();</span>
<a href="#l38.810"></a><span id="l38.810" class="difflineplus">+        if (this.hasAttribute(&quot;freebusy&quot;)) {</span>
<a href="#l38.811"></a><span id="l38.811" class="difflineplus">+            this._setFreeBusy(this.getAttribute(&quot;freebusy&quot;) == &quot;true&quot;);</span>
<a href="#l38.812"></a><span id="l38.812" class="difflineplus">+        }</span>
<a href="#l38.813"></a><span id="l38.813" class="difflineplus">+        this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l38.814"></a><span id="l38.814"> </span>
<a href="#l38.815"></a><span id="l38.815" class="difflineminus">-          // Add pref observer</span>
<a href="#l38.816"></a><span id="l38.816" class="difflineminus">-          let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l38.817"></a><span id="l38.817" class="difflineminus">-          branch.addObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l38.818"></a><span id="l38.818" class="difflineplus">+        // Add pref observer</span>
<a href="#l38.819"></a><span id="l38.819" class="difflineplus">+        let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l38.820"></a><span id="l38.820" class="difflineplus">+        branch.addObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l38.821"></a><span id="l38.821">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l38.822"></a><span id="l38.822" class="difflineplus">+</span>
<a href="#l38.823"></a><span id="l38.823">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l38.824"></a><span id="l38.824" class="difflineminus">-          Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l38.825"></a><span id="l38.825" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l38.826"></a><span id="l38.826"> </span>
<a href="#l38.827"></a><span id="l38.827" class="difflineminus">-          if (this.mObservesComposite == true) {</span>
<a href="#l38.828"></a><span id="l38.828" class="difflineminus">-              getCompositeCalendar().removeObserver(this);</span>
<a href="#l38.829"></a><span id="l38.829" class="difflineminus">-          }</span>
<a href="#l38.830"></a><span id="l38.830" class="difflineplus">+        if (this.mObservesComposite == true) {</span>
<a href="#l38.831"></a><span id="l38.831" class="difflineplus">+            getCompositeCalendar().removeObserver(this);</span>
<a href="#l38.832"></a><span id="l38.832" class="difflineplus">+        }</span>
<a href="#l38.833"></a><span id="l38.833"> </span>
<a href="#l38.834"></a><span id="l38.834" class="difflineminus">-          // Remove pref observer</span>
<a href="#l38.835"></a><span id="l38.835" class="difflineminus">-          let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l38.836"></a><span id="l38.836" class="difflineminus">-          branch.removeObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l38.837"></a><span id="l38.837" class="difflineplus">+        // Remove pref observer</span>
<a href="#l38.838"></a><span id="l38.838" class="difflineplus">+        let branch = Services.prefs.getBranch(&quot;&quot;);</span>
<a href="#l38.839"></a><span id="l38.839" class="difflineplus">+        branch.removeObserver(&quot;calendar.&quot;, this, false);</span>
<a href="#l38.840"></a><span id="l38.840">       ]]&gt;&lt;/destructor&gt;</span>
<a href="#l38.841"></a><span id="l38.841"> </span>
<a href="#l38.842"></a><span id="l38.842" class="difflineminus">-     &lt;!-- calIOperationListener methods --&gt;</span>
<a href="#l38.843"></a><span id="l38.843" class="difflineplus">+      &lt;!-- calIOperationListener methods --&gt;</span>
<a href="#l38.844"></a><span id="l38.844">       &lt;method name=&quot;onOperationComplete&quot;&gt;</span>
<a href="#l38.845"></a><span id="l38.845">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.846"></a><span id="l38.846">         &lt;parameter name=&quot;aStatus&quot;/&gt;</span>
<a href="#l38.847"></a><span id="l38.847">         &lt;parameter name=&quot;aOperationType&quot;/&gt;</span>
<a href="#l38.848"></a><span id="l38.848">         &lt;parameter name=&quot;aId&quot;/&gt;</span>
<a href="#l38.849"></a><span id="l38.849">         &lt;parameter name=&quot;aDetail&quot;/&gt;</span>
<a href="#l38.850"></a><span id="l38.850">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.851"></a><span id="l38.851">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.852"></a><span id="l38.852" class="difflineat">@@ -483,22 +489,22 @@</span>
<a href="#l38.853"></a><span id="l38.853">       &lt;method name=&quot;onGetResult&quot;&gt;</span>
<a href="#l38.854"></a><span id="l38.854">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.855"></a><span id="l38.855">         &lt;parameter name=&quot;aStatus&quot;/&gt;</span>
<a href="#l38.856"></a><span id="l38.856">         &lt;parameter name=&quot;aItemType&quot;/&gt;</span>
<a href="#l38.857"></a><span id="l38.857">         &lt;parameter name=&quot;aDetail&quot;/&gt;</span>
<a href="#l38.858"></a><span id="l38.858">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l38.859"></a><span id="l38.859">         &lt;parameter name=&quot;aItems&quot;/&gt;</span>
<a href="#l38.860"></a><span id="l38.860">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.861"></a><span id="l38.861" class="difflineminus">-            if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l38.862"></a><span id="l38.862" class="difflineminus">-                return;</span>
<a href="#l38.863"></a><span id="l38.863" class="difflineminus">-            }</span>
<a href="#l38.864"></a><span id="l38.864" class="difflineminus">-            for (let item of aItems) {</span>
<a href="#l38.865"></a><span id="l38.865" class="difflineminus">-                this.setBusyDaysForOccurrence(item, true);</span>
<a href="#l38.866"></a><span id="l38.866" class="difflineminus">-            }</span>
<a href="#l38.867"></a><span id="l38.867" class="difflineplus">+          if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l38.868"></a><span id="l38.868" class="difflineplus">+              return;</span>
<a href="#l38.869"></a><span id="l38.869" class="difflineplus">+          }</span>
<a href="#l38.870"></a><span id="l38.870" class="difflineplus">+          for (let item of aItems) {</span>
<a href="#l38.871"></a><span id="l38.871" class="difflineplus">+              this.setBusyDaysForOccurrence(item, true);</span>
<a href="#l38.872"></a><span id="l38.872" class="difflineplus">+          }</span>
<a href="#l38.873"></a><span id="l38.873">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.874"></a><span id="l38.874">       &lt;/method&gt;</span>
<a href="#l38.875"></a><span id="l38.875"> </span>
<a href="#l38.876"></a><span id="l38.876">       &lt;method name=&quot;setBusyDaysForItem&quot;&gt;</span>
<a href="#l38.877"></a><span id="l38.877">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l38.878"></a><span id="l38.878">         &lt;parameter name=&quot;aState&quot;/&gt;</span>
<a href="#l38.879"></a><span id="l38.879">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.880"></a><span id="l38.880">           let items = [aItem];</span>
<a href="#l38.881"></a><span id="l38.881" class="difflineat">@@ -563,49 +569,49 @@</span>
<a href="#l38.882"></a><span id="l38.882">           this.updateBoxBusy(aBox, boxBusy);</span>
<a href="#l38.883"></a><span id="l38.883">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.884"></a><span id="l38.884">       &lt;/method&gt;</span>
<a href="#l38.885"></a><span id="l38.885"> </span>
<a href="#l38.886"></a><span id="l38.886">       &lt;method name=&quot;setBusyDaysForOccurrence&quot;&gt;</span>
<a href="#l38.887"></a><span id="l38.887">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l38.888"></a><span id="l38.888">         &lt;parameter name=&quot;aState&quot;/&gt;</span>
<a href="#l38.889"></a><span id="l38.889">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.890"></a><span id="l38.890" class="difflineminus">-        if (aOccurrence.getProperty(&quot;TRANSP&quot;) == &quot;TRANSPARENT&quot;) {</span>
<a href="#l38.891"></a><span id="l38.891" class="difflineminus">-          // Skip transparent events</span>
<a href="#l38.892"></a><span id="l38.892" class="difflineminus">-          return;</span>
<a href="#l38.893"></a><span id="l38.893" class="difflineminus">-        }</span>
<a href="#l38.894"></a><span id="l38.894" class="difflineminus">-        let start = aOccurrence[calGetStartDateProp(aOccurrence)] || aOccurrence.dueDate;</span>
<a href="#l38.895"></a><span id="l38.895" class="difflineminus">-        let end = aOccurrence[calGetEndDateProp(aOccurrence)] || start;</span>
<a href="#l38.896"></a><span id="l38.896" class="difflineminus">-        if (!start) {</span>
<a href="#l38.897"></a><span id="l38.897" class="difflineminus">-            return;</span>
<a href="#l38.898"></a><span id="l38.898" class="difflineminus">-        }</span>
<a href="#l38.899"></a><span id="l38.899" class="difflineplus">+          if (aOccurrence.getProperty(&quot;TRANSP&quot;) == &quot;TRANSPARENT&quot;) {</span>
<a href="#l38.900"></a><span id="l38.900" class="difflineplus">+              // Skip transparent events</span>
<a href="#l38.901"></a><span id="l38.901" class="difflineplus">+              return;</span>
<a href="#l38.902"></a><span id="l38.902" class="difflineplus">+          }</span>
<a href="#l38.903"></a><span id="l38.903" class="difflineplus">+          let start = aOccurrence[calGetStartDateProp(aOccurrence)] || aOccurrence.dueDate;</span>
<a href="#l38.904"></a><span id="l38.904" class="difflineplus">+          let end = aOccurrence[calGetEndDateProp(aOccurrence)] || start;</span>
<a href="#l38.905"></a><span id="l38.905" class="difflineplus">+          if (!start) {</span>
<a href="#l38.906"></a><span id="l38.906" class="difflineplus">+              return;</span>
<a href="#l38.907"></a><span id="l38.907" class="difflineplus">+          }</span>
<a href="#l38.908"></a><span id="l38.908"> </span>
<a href="#l38.909"></a><span id="l38.909" class="difflineminus">-        // We need to compare with midnight of the current day, so reset the</span>
<a href="#l38.910"></a><span id="l38.910" class="difflineminus">-        // time here.</span>
<a href="#l38.911"></a><span id="l38.911" class="difflineminus">-        let current = start.clone().getInTimezone(cal.calendarDefaultTimezone());</span>
<a href="#l38.912"></a><span id="l38.912" class="difflineminus">-        current.hour = 0;</span>
<a href="#l38.913"></a><span id="l38.913" class="difflineminus">-        current.minute = 0;</span>
<a href="#l38.914"></a><span id="l38.914" class="difflineminus">-        current.second = 0;</span>
<a href="#l38.915"></a><span id="l38.915" class="difflineplus">+          // We need to compare with midnight of the current day, so reset the</span>
<a href="#l38.916"></a><span id="l38.916" class="difflineplus">+          // time here.</span>
<a href="#l38.917"></a><span id="l38.917" class="difflineplus">+          let current = start.clone().getInTimezone(cal.calendarDefaultTimezone());</span>
<a href="#l38.918"></a><span id="l38.918" class="difflineplus">+          current.hour = 0;</span>
<a href="#l38.919"></a><span id="l38.919" class="difflineplus">+          current.minute = 0;</span>
<a href="#l38.920"></a><span id="l38.920" class="difflineplus">+          current.second = 0;</span>
<a href="#l38.921"></a><span id="l38.921"> </span>
<a href="#l38.922"></a><span id="l38.922" class="difflineminus">-        // Cache the result so the compare isn't called in each iteration.</span>
<a href="#l38.923"></a><span id="l38.923" class="difflineminus">-        let compareResult = (start.compare(end) == 0 ? 1 : 0);</span>
<a href="#l38.924"></a><span id="l38.924" class="difflineplus">+          // Cache the result so the compare isn't called in each iteration.</span>
<a href="#l38.925"></a><span id="l38.925" class="difflineplus">+          let compareResult = (start.compare(end) == 0 ? 1 : 0);</span>
<a href="#l38.926"></a><span id="l38.926"> </span>
<a href="#l38.927"></a><span id="l38.927" class="difflineminus">-        // Setup the busy days.</span>
<a href="#l38.928"></a><span id="l38.928" class="difflineminus">-        while (current.compare(end) &lt; compareResult) {</span>
<a href="#l38.929"></a><span id="l38.929" class="difflineminus">-            let box = this.getBoxForDate(current);</span>
<a href="#l38.930"></a><span id="l38.930" class="difflineminus">-            if (box) {</span>
<a href="#l38.931"></a><span id="l38.931" class="difflineminus">-                let busyCalendars = this.parseBoxBusy(box);</span>
<a href="#l38.932"></a><span id="l38.932" class="difflineminus">-                if (!busyCalendars[aOccurrence.calendar.id]) {</span>
<a href="#l38.933"></a><span id="l38.933" class="difflineminus">-                    busyCalendars[aOccurrence.calendar.id] = 0;</span>
<a href="#l38.934"></a><span id="l38.934" class="difflineminus">-                }</span>
<a href="#l38.935"></a><span id="l38.935" class="difflineminus">-                busyCalendars[aOccurrence.calendar.id] += (aState ? 1 : -1);</span>
<a href="#l38.936"></a><span id="l38.936" class="difflineminus">-                this.updateBoxBusy(box, busyCalendars);</span>
<a href="#l38.937"></a><span id="l38.937" class="difflineminus">-            }</span>
<a href="#l38.938"></a><span id="l38.938" class="difflineminus">-            current.day++;</span>
<a href="#l38.939"></a><span id="l38.939" class="difflineminus">-        }</span>
<a href="#l38.940"></a><span id="l38.940" class="difflineplus">+          // Setup the busy days.</span>
<a href="#l38.941"></a><span id="l38.941" class="difflineplus">+          while (current.compare(end) &lt; compareResult) {</span>
<a href="#l38.942"></a><span id="l38.942" class="difflineplus">+              let box = this.getBoxForDate(current);</span>
<a href="#l38.943"></a><span id="l38.943" class="difflineplus">+              if (box) {</span>
<a href="#l38.944"></a><span id="l38.944" class="difflineplus">+                  let busyCalendars = this.parseBoxBusy(box);</span>
<a href="#l38.945"></a><span id="l38.945" class="difflineplus">+                  if (!busyCalendars[aOccurrence.calendar.id]) {</span>
<a href="#l38.946"></a><span id="l38.946" class="difflineplus">+                      busyCalendars[aOccurrence.calendar.id] = 0;</span>
<a href="#l38.947"></a><span id="l38.947" class="difflineplus">+                  }</span>
<a href="#l38.948"></a><span id="l38.948" class="difflineplus">+                  busyCalendars[aOccurrence.calendar.id] += (aState ? 1 : -1);</span>
<a href="#l38.949"></a><span id="l38.949" class="difflineplus">+                  this.updateBoxBusy(box, busyCalendars);</span>
<a href="#l38.950"></a><span id="l38.950" class="difflineplus">+              }</span>
<a href="#l38.951"></a><span id="l38.951" class="difflineplus">+              current.day++;</span>
<a href="#l38.952"></a><span id="l38.952" class="difflineplus">+          }</span>
<a href="#l38.953"></a><span id="l38.953">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.954"></a><span id="l38.954">       &lt;/method&gt;</span>
<a href="#l38.955"></a><span id="l38.955"> </span>
<a href="#l38.956"></a><span id="l38.956">        &lt;!--calIObserver methods --&gt;</span>
<a href="#l38.957"></a><span id="l38.957">       &lt;method name=&quot;onStartBatch&quot;&gt;</span>
<a href="#l38.958"></a><span id="l38.958">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.959"></a><span id="l38.959">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.960"></a><span id="l38.960">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.961"></a><span id="l38.961" class="difflineat">@@ -621,33 +627,33 @@</span>
<a href="#l38.962"></a><span id="l38.962">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.963"></a><span id="l38.963">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.964"></a><span id="l38.964">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.965"></a><span id="l38.965">       &lt;/method&gt;</span>
<a href="#l38.966"></a><span id="l38.966"> </span>
<a href="#l38.967"></a><span id="l38.967">       &lt;method name=&quot;onAddItem&quot;&gt;</span>
<a href="#l38.968"></a><span id="l38.968">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l38.969"></a><span id="l38.969">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.970"></a><span id="l38.970" class="difflineminus">-            this.setBusyDaysForItem(aItem, true);</span>
<a href="#l38.971"></a><span id="l38.971" class="difflineplus">+          this.setBusyDaysForItem(aItem, true);</span>
<a href="#l38.972"></a><span id="l38.972">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.973"></a><span id="l38.973">       &lt;/method&gt;</span>
<a href="#l38.974"></a><span id="l38.974"> </span>
<a href="#l38.975"></a><span id="l38.975">       &lt;method name=&quot;onDeleteItem&quot;&gt;</span>
<a href="#l38.976"></a><span id="l38.976">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l38.977"></a><span id="l38.977">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.978"></a><span id="l38.978" class="difflineminus">-            this.setBusyDaysForItem(aItem, false);</span>
<a href="#l38.979"></a><span id="l38.979" class="difflineplus">+          this.setBusyDaysForItem(aItem, false);</span>
<a href="#l38.980"></a><span id="l38.980">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.981"></a><span id="l38.981">       &lt;/method&gt;</span>
<a href="#l38.982"></a><span id="l38.982"> </span>
<a href="#l38.983"></a><span id="l38.983">       &lt;method name=&quot;onModifyItem&quot;&gt;</span>
<a href="#l38.984"></a><span id="l38.984">         &lt;parameter name=&quot;aNewItem&quot;/&gt;</span>
<a href="#l38.985"></a><span id="l38.985">         &lt;parameter name=&quot;aOldItem&quot;/&gt;</span>
<a href="#l38.986"></a><span id="l38.986">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.987"></a><span id="l38.987" class="difflineminus">-            this.setBusyDaysForItem(aOldItem, false);</span>
<a href="#l38.988"></a><span id="l38.988" class="difflineminus">-            this.setBusyDaysForItem(aNewItem, true);</span>
<a href="#l38.989"></a><span id="l38.989" class="difflineplus">+          this.setBusyDaysForItem(aOldItem, false);</span>
<a href="#l38.990"></a><span id="l38.990" class="difflineplus">+          this.setBusyDaysForItem(aNewItem, true);</span>
<a href="#l38.991"></a><span id="l38.991">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.992"></a><span id="l38.992">       &lt;/method&gt;</span>
<a href="#l38.993"></a><span id="l38.993"> </span>
<a href="#l38.994"></a><span id="l38.994">       &lt;method name=&quot;onError&quot;&gt;</span>
<a href="#l38.995"></a><span id="l38.995">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.996"></a><span id="l38.996">         &lt;parameter name=&quot;aErrNo&quot;/&gt;</span>
<a href="#l38.997"></a><span id="l38.997">         &lt;parameter name=&quot;aMessage&quot;/&gt;</span>
<a href="#l38.998"></a><span id="l38.998">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.999"></a><span id="l38.999" class="difflineat">@@ -655,46 +661,47 @@</span>
<a href="#l38.1000"></a><span id="l38.1000">       &lt;/method&gt;</span>
<a href="#l38.1001"></a><span id="l38.1001"> </span>
<a href="#l38.1002"></a><span id="l38.1002">       &lt;method name=&quot;onPropertyChanged&quot;&gt;</span>
<a href="#l38.1003"></a><span id="l38.1003">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.1004"></a><span id="l38.1004">         &lt;parameter name=&quot;aName&quot;/&gt;</span>
<a href="#l38.1005"></a><span id="l38.1005">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l38.1006"></a><span id="l38.1006">         &lt;parameter name=&quot;aOldValue&quot;/&gt;</span>
<a href="#l38.1007"></a><span id="l38.1007">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1008"></a><span id="l38.1008" class="difflineminus">-            switch (aName) {</span>
<a href="#l38.1009"></a><span id="l38.1009" class="difflineminus">-                case &quot;disabled&quot;:</span>
<a href="#l38.1010"></a><span id="l38.1010" class="difflineminus">-                    this.resetAttributesForDate();</span>
<a href="#l38.1011"></a><span id="l38.1011" class="difflineminus">-                    this.getItems();</span>
<a href="#l38.1012"></a><span id="l38.1012" class="difflineminus">-                    break;</span>
<a href="#l38.1013"></a><span id="l38.1013" class="difflineminus">-            }</span>
<a href="#l38.1014"></a><span id="l38.1014" class="difflineplus">+          switch (aName) {</span>
<a href="#l38.1015"></a><span id="l38.1015" class="difflineplus">+              case &quot;disabled&quot;:</span>
<a href="#l38.1016"></a><span id="l38.1016" class="difflineplus">+                  this.resetAttributesForDate();</span>
<a href="#l38.1017"></a><span id="l38.1017" class="difflineplus">+                  this.getItems();</span>
<a href="#l38.1018"></a><span id="l38.1018" class="difflineplus">+                  break;</span>
<a href="#l38.1019"></a><span id="l38.1019" class="difflineplus">+          }</span>
<a href="#l38.1020"></a><span id="l38.1020">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1021"></a><span id="l38.1021">       &lt;/method&gt;</span>
<a href="#l38.1022"></a><span id="l38.1022"> </span>
<a href="#l38.1023"></a><span id="l38.1023">       &lt;method name=&quot;onPropertyDeleting&quot;&gt;</span>
<a href="#l38.1024"></a><span id="l38.1024">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.1025"></a><span id="l38.1025">         &lt;parameter name=&quot;aName&quot;/&gt;</span>
<a href="#l38.1026"></a><span id="l38.1026">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1027"></a><span id="l38.1027" class="difflineminus">-            this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l38.1028"></a><span id="l38.1028" class="difflineplus">+          this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l38.1029"></a><span id="l38.1029">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1030"></a><span id="l38.1030">       &lt;/method&gt;</span>
<a href="#l38.1031"></a><span id="l38.1031"> </span>
<a href="#l38.1032"></a><span id="l38.1032">        &lt;!-- calICompositeObserver methods --&gt;</span>
<a href="#l38.1033"></a><span id="l38.1033">       &lt;method name=&quot;onCalendarAdded&quot;&gt;</span>
<a href="#l38.1034"></a><span id="l38.1034">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.1035"></a><span id="l38.1035">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1036"></a><span id="l38.1036">             this.getItems(aCalendar);</span>
<a href="#l38.1037"></a><span id="l38.1037">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1038"></a><span id="l38.1038">       &lt;/method&gt;</span>
<a href="#l38.1039"></a><span id="l38.1039" class="difflineplus">+</span>
<a href="#l38.1040"></a><span id="l38.1040">       &lt;method name=&quot;onCalendarRemoved&quot;&gt;</span>
<a href="#l38.1041"></a><span id="l38.1041">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.1042"></a><span id="l38.1042">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1043"></a><span id="l38.1043" class="difflineminus">-            for (let day in this.mDayMap) {</span>
<a href="#l38.1044"></a><span id="l38.1044" class="difflineminus">-                this.removeCalendarFromBoxBusy(this.mDayMap[day], aCalendar);</span>
<a href="#l38.1045"></a><span id="l38.1045" class="difflineminus">-            }</span>
<a href="#l38.1046"></a><span id="l38.1046" class="difflineplus">+          for (let day in this.mDayMap) {</span>
<a href="#l38.1047"></a><span id="l38.1047" class="difflineplus">+              this.removeCalendarFromBoxBusy(this.mDayMap[day], aCalendar);</span>
<a href="#l38.1048"></a><span id="l38.1048" class="difflineplus">+          }</span>
<a href="#l38.1049"></a><span id="l38.1049">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1050"></a><span id="l38.1050">       &lt;/method&gt;</span>
<a href="#l38.1051"></a><span id="l38.1051"> </span>
<a href="#l38.1052"></a><span id="l38.1052">       &lt;method name=&quot;onDefaultCalendarChanged&quot;&gt;</span>
<a href="#l38.1053"></a><span id="l38.1053">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.1054"></a><span id="l38.1054">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1055"></a><span id="l38.1055">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1056"></a><span id="l38.1056">       &lt;/method&gt;</span>
<a href="#l38.1057"></a><span id="l38.1057" class="difflineat">@@ -721,16 +728,17 @@</span>
<a href="#l38.1058"></a><span id="l38.1058">           this.mShowWeekNumber = Preferences.get(&quot;calendar.view-minimonth.showWeekNumber&quot;, true);</span>
<a href="#l38.1059"></a><span id="l38.1059">           if (!this.mValue) {</span>
<a href="#l38.1060"></a><span id="l38.1060">               this.mValue = new Date();</span>
<a href="#l38.1061"></a><span id="l38.1061">           }</span>
<a href="#l38.1062"></a><span id="l38.1062">           this.setHeader();</span>
<a href="#l38.1063"></a><span id="l38.1063">           this.showMonth(this.mValue);</span>
<a href="#l38.1064"></a><span id="l38.1064">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1065"></a><span id="l38.1065">       &lt;/method&gt;</span>
<a href="#l38.1066"></a><span id="l38.1066" class="difflineplus">+</span>
<a href="#l38.1067"></a><span id="l38.1067">       &lt;method name=&quot;setHeader&quot;&gt;</span>
<a href="#l38.1068"></a><span id="l38.1068">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1069"></a><span id="l38.1069">           // Reset the headers</span>
<a href="#l38.1070"></a><span id="l38.1070">           let header = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-row-header&quot;);</span>
<a href="#l38.1071"></a><span id="l38.1071">           let dayList = new Array(7);</span>
<a href="#l38.1072"></a><span id="l38.1072">           let tempDate = new Date();</span>
<a href="#l38.1073"></a><span id="l38.1073">           let i, j;</span>
<a href="#l38.1074"></a><span id="l38.1074">           let useOSFormat;</span>
<a href="#l38.1075"></a><span id="l38.1075" class="difflineat">@@ -789,229 +797,235 @@</span>
<a href="#l38.1076"></a><span id="l38.1076">           }</span>
<a href="#l38.1077"></a><span id="l38.1077"> </span>
<a href="#l38.1078"></a><span id="l38.1078">           setBooleanAttribute(header.childNodes[0], &quot;hidden&quot;, !this.mShowWeekNumber);</span>
<a href="#l38.1079"></a><span id="l38.1079">           for (let column = 1; column &lt; header.childNodes.length; column++) {</span>
<a href="#l38.1080"></a><span id="l38.1080">               header.childNodes[column].setAttribute(&quot;value&quot;, dayList[column - 1]);</span>
<a href="#l38.1081"></a><span id="l38.1081">           }</span>
<a href="#l38.1082"></a><span id="l38.1082">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1083"></a><span id="l38.1083">       &lt;/method&gt;</span>
<a href="#l38.1084"></a><span id="l38.1084" class="difflineplus">+</span>
<a href="#l38.1085"></a><span id="l38.1085">       &lt;method name=&quot;showMonth&quot;&gt;</span>
<a href="#l38.1086"></a><span id="l38.1086">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.1087"></a><span id="l38.1087">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1088"></a><span id="l38.1088" class="difflineminus">-            // Use mExtraDate if aDate is null.</span>
<a href="#l38.1089"></a><span id="l38.1089" class="difflineminus">-            aDate = new Date(aDate || this.mExtraDate);</span>
<a href="#l38.1090"></a><span id="l38.1090" class="difflineplus">+          // Use mExtraDate if aDate is null.</span>
<a href="#l38.1091"></a><span id="l38.1091" class="difflineplus">+          aDate = new Date(aDate || this.mExtraDate);</span>
<a href="#l38.1092"></a><span id="l38.1092"> </span>
<a href="#l38.1093"></a><span id="l38.1093" class="difflineminus">-            aDate.setDate(1);</span>
<a href="#l38.1094"></a><span id="l38.1094" class="difflineminus">-            // We set the hour and minute to something highly unlikely to be the</span>
<a href="#l38.1095"></a><span id="l38.1095" class="difflineminus">-            // exact change point of DST, so timezones like America/Sao Paulo</span>
<a href="#l38.1096"></a><span id="l38.1096" class="difflineminus">-            // don't display some days twice.</span>
<a href="#l38.1097"></a><span id="l38.1097" class="difflineminus">-            aDate.setHours(12);</span>
<a href="#l38.1098"></a><span id="l38.1098" class="difflineminus">-            aDate.setMinutes(34);</span>
<a href="#l38.1099"></a><span id="l38.1099" class="difflineminus">-            aDate.setSeconds(0);</span>
<a href="#l38.1100"></a><span id="l38.1100" class="difflineminus">-            aDate.setMilliseconds(0);</span>
<a href="#l38.1101"></a><span id="l38.1101" class="difflineminus">-            // Don't fire onmonthchange event upon initialization</span>
<a href="#l38.1102"></a><span id="l38.1102" class="difflineminus">-            let monthChanged = this.mEditorDate &amp;&amp; (this.mEditorDate.valueOf() != aDate.valueOf());</span>
<a href="#l38.1103"></a><span id="l38.1103" class="difflineminus">-            this.mEditorDate = aDate; // only place mEditorDate is set.</span>
<a href="#l38.1104"></a><span id="l38.1104" class="difflineplus">+          aDate.setDate(1);</span>
<a href="#l38.1105"></a><span id="l38.1105" class="difflineplus">+          // We set the hour and minute to something highly unlikely to be the</span>
<a href="#l38.1106"></a><span id="l38.1106" class="difflineplus">+          // exact change point of DST, so timezones like America/Sao Paulo</span>
<a href="#l38.1107"></a><span id="l38.1107" class="difflineplus">+          // don't display some days twice.</span>
<a href="#l38.1108"></a><span id="l38.1108" class="difflineplus">+          aDate.setHours(12);</span>
<a href="#l38.1109"></a><span id="l38.1109" class="difflineplus">+          aDate.setMinutes(34);</span>
<a href="#l38.1110"></a><span id="l38.1110" class="difflineplus">+          aDate.setSeconds(0);</span>
<a href="#l38.1111"></a><span id="l38.1111" class="difflineplus">+          aDate.setMilliseconds(0);</span>
<a href="#l38.1112"></a><span id="l38.1112" class="difflineplus">+          // Don't fire onmonthchange event upon initialization</span>
<a href="#l38.1113"></a><span id="l38.1113" class="difflineplus">+          let monthChanged = this.mEditorDate &amp;&amp; (this.mEditorDate.valueOf() != aDate.valueOf());</span>
<a href="#l38.1114"></a><span id="l38.1114" class="difflineplus">+          this.mEditorDate = aDate; // only place mEditorDate is set.</span>
<a href="#l38.1115"></a><span id="l38.1115"> </span>
<a href="#l38.1116"></a><span id="l38.1116" class="difflineminus">-            if (this.mToday) {</span>
<a href="#l38.1117"></a><span id="l38.1117" class="difflineplus">+          if (this.mToday) {</span>
<a href="#l38.1118"></a><span id="l38.1118">               this.mToday.removeAttribute(&quot;today&quot;);</span>
<a href="#l38.1119"></a><span id="l38.1119">               this.mToday = null;</span>
<a href="#l38.1120"></a><span id="l38.1120" class="difflineminus">-            }</span>
<a href="#l38.1121"></a><span id="l38.1121" class="difflineplus">+          }</span>
<a href="#l38.1122"></a><span id="l38.1122"> </span>
<a href="#l38.1123"></a><span id="l38.1123" class="difflineminus">-            if (this.mSelected) {</span>
<a href="#l38.1124"></a><span id="l38.1124" class="difflineplus">+          if (this.mSelected) {</span>
<a href="#l38.1125"></a><span id="l38.1125">               this.mSelected.removeAttribute(&quot;selected&quot;);</span>
<a href="#l38.1126"></a><span id="l38.1126">               this.mSelected = null;</span>
<a href="#l38.1127"></a><span id="l38.1127" class="difflineminus">-            }</span>
<a href="#l38.1128"></a><span id="l38.1128" class="difflineplus">+          }</span>
<a href="#l38.1129"></a><span id="l38.1129"> </span>
<a href="#l38.1130"></a><span id="l38.1130" class="difflineminus">-            if (this.mExtra) {</span>
<a href="#l38.1131"></a><span id="l38.1131" class="difflineplus">+          if (this.mExtra) {</span>
<a href="#l38.1132"></a><span id="l38.1132">               this.mExtra.removeAttribute(&quot;extra&quot;);</span>
<a href="#l38.1133"></a><span id="l38.1133">               this.mExtra = null;</span>
<a href="#l38.1134"></a><span id="l38.1134" class="difflineminus">-            }</span>
<a href="#l38.1135"></a><span id="l38.1135" class="difflineplus">+          }</span>
<a href="#l38.1136"></a><span id="l38.1136"> </span>
<a href="#l38.1137"></a><span id="l38.1137" class="difflineminus">-            // Update the month and year title</span>
<a href="#l38.1138"></a><span id="l38.1138" class="difflineminus">-            this.setAttribute(&quot;month&quot;, aDate.getMonth());</span>
<a href="#l38.1139"></a><span id="l38.1139" class="difflineminus">-            this.setAttribute(&quot;year&quot;, aDate.getFullYear());</span>
<a href="#l38.1140"></a><span id="l38.1140" class="difflineminus">-            if (!this.mIsReadOnly) {</span>
<a href="#l38.1141"></a><span id="l38.1141" class="difflineminus">-                // Update the month popup</span>
<a href="#l38.1142"></a><span id="l38.1142" class="difflineminus">-                let header = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-header&quot;);</span>
<a href="#l38.1143"></a><span id="l38.1143" class="difflineminus">-                header.updateYearPopup(aDate);</span>
<a href="#l38.1144"></a><span id="l38.1144" class="difflineminus">-                header.updateMonthPopup(aDate);</span>
<a href="#l38.1145"></a><span id="l38.1145" class="difflineminus">-            }</span>
<a href="#l38.1146"></a><span id="l38.1146" class="difflineminus">-            // Update the calendar</span>
<a href="#l38.1147"></a><span id="l38.1147" class="difflineminus">-            let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l38.1148"></a><span id="l38.1148" class="difflineminus">-            let date = this._getStartDate(aDate);</span>
<a href="#l38.1149"></a><span id="l38.1149" class="difflineplus">+          // Update the month and year title</span>
<a href="#l38.1150"></a><span id="l38.1150" class="difflineplus">+          this.setAttribute(&quot;month&quot;, aDate.getMonth());</span>
<a href="#l38.1151"></a><span id="l38.1151" class="difflineplus">+          this.setAttribute(&quot;year&quot;, aDate.getFullYear());</span>
<a href="#l38.1152"></a><span id="l38.1152" class="difflineplus">+          if (!this.mIsReadOnly) {</span>
<a href="#l38.1153"></a><span id="l38.1153" class="difflineplus">+              // Update the month popup</span>
<a href="#l38.1154"></a><span id="l38.1154" class="difflineplus">+              let header = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-header&quot;);</span>
<a href="#l38.1155"></a><span id="l38.1155" class="difflineplus">+              header.updateYearPopup(aDate);</span>
<a href="#l38.1156"></a><span id="l38.1156" class="difflineplus">+              header.updateMonthPopup(aDate);</span>
<a href="#l38.1157"></a><span id="l38.1157" class="difflineplus">+          }</span>
<a href="#l38.1158"></a><span id="l38.1158" class="difflineplus">+          // Update the calendar</span>
<a href="#l38.1159"></a><span id="l38.1159" class="difflineplus">+          let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l38.1160"></a><span id="l38.1160" class="difflineplus">+          let date = this._getStartDate(aDate);</span>
<a href="#l38.1161"></a><span id="l38.1161"> </span>
<a href="#l38.1162"></a><span id="l38.1162" class="difflineminus">-            // get today's date</span>
<a href="#l38.1163"></a><span id="l38.1163" class="difflineminus">-            let today = new Date();</span>
<a href="#l38.1164"></a><span id="l38.1164" class="difflineplus">+          // get today's date</span>
<a href="#l38.1165"></a><span id="l38.1165" class="difflineplus">+          let today = new Date();</span>
<a href="#l38.1166"></a><span id="l38.1166"> </span>
<a href="#l38.1167"></a><span id="l38.1167" class="difflineminus">-            this.mDayMap = {};</span>
<a href="#l38.1168"></a><span id="l38.1168" class="difflineminus">-            for (let k = 1; k &lt; calbox.childNodes.length; k++) {</span>
<a href="#l38.1169"></a><span id="l38.1169" class="difflineminus">-                let row = calbox.childNodes[k];</span>
<a href="#l38.1170"></a><span id="l38.1170" class="difflineplus">+          this.mDayMap = {};</span>
<a href="#l38.1171"></a><span id="l38.1171" class="difflineplus">+          for (let k = 1; k &lt; calbox.childNodes.length; k++) {</span>
<a href="#l38.1172"></a><span id="l38.1172" class="difflineplus">+              let row = calbox.childNodes[k];</span>
<a href="#l38.1173"></a><span id="l38.1173"> </span>
<a href="#l38.1174"></a><span id="l38.1174" class="difflineminus">-                // Set the week number.</span>
<a href="#l38.1175"></a><span id="l38.1175" class="difflineminus">-                let firstElement = row.childNodes[0];</span>
<a href="#l38.1176"></a><span id="l38.1176" class="difflineminus">-                setBooleanAttribute(firstElement, &quot;hidden&quot;, !this.mShowWeekNumber);</span>
<a href="#l38.1177"></a><span id="l38.1177" class="difflineminus">-                if (this.mShowWeekNumber) {</span>
<a href="#l38.1178"></a><span id="l38.1178" class="difflineminus">-                    let weekNumber = cal.getWeekInfoService().getWeekTitle(cal.jsDateToDateTime(date));</span>
<a href="#l38.1179"></a><span id="l38.1179" class="difflineminus">-                    firstElement.setAttribute(&quot;value&quot;, weekNumber);</span>
<a href="#l38.1180"></a><span id="l38.1180" class="difflineminus">-                }</span>
<a href="#l38.1181"></a><span id="l38.1181" class="difflineplus">+              // Set the week number.</span>
<a href="#l38.1182"></a><span id="l38.1182" class="difflineplus">+              let firstElement = row.childNodes[0];</span>
<a href="#l38.1183"></a><span id="l38.1183" class="difflineplus">+              setBooleanAttribute(firstElement, &quot;hidden&quot;, !this.mShowWeekNumber);</span>
<a href="#l38.1184"></a><span id="l38.1184" class="difflineplus">+              if (this.mShowWeekNumber) {</span>
<a href="#l38.1185"></a><span id="l38.1185" class="difflineplus">+                  let weekNumber = cal.getWeekInfoService().getWeekTitle(cal.jsDateToDateTime(date));</span>
<a href="#l38.1186"></a><span id="l38.1186" class="difflineplus">+                  firstElement.setAttribute(&quot;value&quot;, weekNumber);</span>
<a href="#l38.1187"></a><span id="l38.1187" class="difflineplus">+              }</span>
<a href="#l38.1188"></a><span id="l38.1188"> </span>
<a href="#l38.1189"></a><span id="l38.1189" class="difflineminus">-                for (let i = 1; i &lt; 8; i++) {</span>
<a href="#l38.1190"></a><span id="l38.1190" class="difflineminus">-                    let day = row.childNodes[i];</span>
<a href="#l38.1191"></a><span id="l38.1191" class="difflineminus">-                    let ymd = date.getFullYear() + &quot;-&quot; +</span>
<a href="#l38.1192"></a><span id="l38.1192" class="difflineminus">-                              date.getMonth() + &quot;-&quot; +</span>
<a href="#l38.1193"></a><span id="l38.1193" class="difflineminus">-                              date.getDate();</span>
<a href="#l38.1194"></a><span id="l38.1194" class="difflineminus">-                    this.mDayMap[ymd] = day;</span>
<a href="#l38.1195"></a><span id="l38.1195" class="difflineplus">+              for (let i = 1; i &lt; 8; i++) {</span>
<a href="#l38.1196"></a><span id="l38.1196" class="difflineplus">+                  let day = row.childNodes[i];</span>
<a href="#l38.1197"></a><span id="l38.1197" class="difflineplus">+                  let ymd = date.getFullYear() + &quot;-&quot; +</span>
<a href="#l38.1198"></a><span id="l38.1198" class="difflineplus">+                            date.getMonth() + &quot;-&quot; +</span>
<a href="#l38.1199"></a><span id="l38.1199" class="difflineplus">+                            date.getDate();</span>
<a href="#l38.1200"></a><span id="l38.1200" class="difflineplus">+                  this.mDayMap[ymd] = day;</span>
<a href="#l38.1201"></a><span id="l38.1201"> </span>
<a href="#l38.1202"></a><span id="l38.1202" class="difflineminus">-                    if (!this.mIsReadOnly) {</span>
<a href="#l38.1203"></a><span id="l38.1203" class="difflineminus">-                        day.setAttribute(&quot;interactive&quot;, &quot;true&quot;);</span>
<a href="#l38.1204"></a><span id="l38.1204" class="difflineminus">-                    }</span>
<a href="#l38.1205"></a><span id="l38.1205" class="difflineplus">+                  if (!this.mIsReadOnly) {</span>
<a href="#l38.1206"></a><span id="l38.1206" class="difflineplus">+                      day.setAttribute(&quot;interactive&quot;, &quot;true&quot;);</span>
<a href="#l38.1207"></a><span id="l38.1207" class="difflineplus">+                  }</span>
<a href="#l38.1208"></a><span id="l38.1208"> </span>
<a href="#l38.1209"></a><span id="l38.1209" class="difflineminus">-                    if (aDate.getMonth() == date.getMonth()) {</span>
<a href="#l38.1210"></a><span id="l38.1210" class="difflineminus">-                        day.removeAttribute(&quot;othermonth&quot;);</span>
<a href="#l38.1211"></a><span id="l38.1211" class="difflineminus">-                    } else {</span>
<a href="#l38.1212"></a><span id="l38.1212" class="difflineminus">-                        day.setAttribute(&quot;othermonth&quot;, &quot;true&quot;);</span>
<a href="#l38.1213"></a><span id="l38.1213" class="difflineminus">-                    }</span>
<a href="#l38.1214"></a><span id="l38.1214" class="difflineplus">+                  if (aDate.getMonth() == date.getMonth()) {</span>
<a href="#l38.1215"></a><span id="l38.1215" class="difflineplus">+                      day.removeAttribute(&quot;othermonth&quot;);</span>
<a href="#l38.1216"></a><span id="l38.1216" class="difflineplus">+                  } else {</span>
<a href="#l38.1217"></a><span id="l38.1217" class="difflineplus">+                      day.setAttribute(&quot;othermonth&quot;, &quot;true&quot;);</span>
<a href="#l38.1218"></a><span id="l38.1218" class="difflineplus">+                  }</span>
<a href="#l38.1219"></a><span id="l38.1219"> </span>
<a href="#l38.1220"></a><span id="l38.1220" class="difflineminus">-                    // highlight today</span>
<a href="#l38.1221"></a><span id="l38.1221" class="difflineminus">-                    if (this._sameDay(today, date)) {</span>
<a href="#l38.1222"></a><span id="l38.1222" class="difflineminus">-                        this.mToday = day;</span>
<a href="#l38.1223"></a><span id="l38.1223" class="difflineminus">-                        day.setAttribute(&quot;today&quot;, &quot;true&quot;);</span>
<a href="#l38.1224"></a><span id="l38.1224" class="difflineminus">-                    }</span>
<a href="#l38.1225"></a><span id="l38.1225" class="difflineplus">+                  // highlight today</span>
<a href="#l38.1226"></a><span id="l38.1226" class="difflineplus">+                  if (this._sameDay(today, date)) {</span>
<a href="#l38.1227"></a><span id="l38.1227" class="difflineplus">+                      this.mToday = day;</span>
<a href="#l38.1228"></a><span id="l38.1228" class="difflineplus">+                      day.setAttribute(&quot;today&quot;, &quot;true&quot;);</span>
<a href="#l38.1229"></a><span id="l38.1229" class="difflineplus">+                  }</span>
<a href="#l38.1230"></a><span id="l38.1230"> </span>
<a href="#l38.1231"></a><span id="l38.1231" class="difflineminus">-                    // highlight the current date</span>
<a href="#l38.1232"></a><span id="l38.1232" class="difflineminus">-                    let val = this.value;</span>
<a href="#l38.1233"></a><span id="l38.1233" class="difflineminus">-                    if (this._sameDay(val, date)) {</span>
<a href="#l38.1234"></a><span id="l38.1234" class="difflineminus">-                        this.mSelected = day;</span>
<a href="#l38.1235"></a><span id="l38.1235" class="difflineminus">-                        day.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l38.1236"></a><span id="l38.1236" class="difflineminus">-                    }</span>
<a href="#l38.1237"></a><span id="l38.1237" class="difflineplus">+                  // highlight the current date</span>
<a href="#l38.1238"></a><span id="l38.1238" class="difflineplus">+                  let val = this.value;</span>
<a href="#l38.1239"></a><span id="l38.1239" class="difflineplus">+                  if (this._sameDay(val, date)) {</span>
<a href="#l38.1240"></a><span id="l38.1240" class="difflineplus">+                      this.mSelected = day;</span>
<a href="#l38.1241"></a><span id="l38.1241" class="difflineplus">+                      day.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l38.1242"></a><span id="l38.1242" class="difflineplus">+                  }</span>
<a href="#l38.1243"></a><span id="l38.1243"> </span>
<a href="#l38.1244"></a><span id="l38.1244" class="difflineminus">-                    // highlight the extra date</span>
<a href="#l38.1245"></a><span id="l38.1245" class="difflineminus">-                    if (this._sameDay(this.mExtraDate, date)) {</span>
<a href="#l38.1246"></a><span id="l38.1246" class="difflineminus">-                        this.mExtra = day;</span>
<a href="#l38.1247"></a><span id="l38.1247" class="difflineminus">-                        day.setAttribute(&quot;extra&quot;, &quot;true&quot;);</span>
<a href="#l38.1248"></a><span id="l38.1248" class="difflineminus">-                    }</span>
<a href="#l38.1249"></a><span id="l38.1249" class="difflineplus">+                  // highlight the extra date</span>
<a href="#l38.1250"></a><span id="l38.1250" class="difflineplus">+                  if (this._sameDay(this.mExtraDate, date)) {</span>
<a href="#l38.1251"></a><span id="l38.1251" class="difflineplus">+                      this.mExtra = day;</span>
<a href="#l38.1252"></a><span id="l38.1252" class="difflineplus">+                      day.setAttribute(&quot;extra&quot;, &quot;true&quot;);</span>
<a href="#l38.1253"></a><span id="l38.1253" class="difflineplus">+                  }</span>
<a href="#l38.1254"></a><span id="l38.1254"> </span>
<a href="#l38.1255"></a><span id="l38.1255" class="difflineminus">-                    day.date = new Date(date);</span>
<a href="#l38.1256"></a><span id="l38.1256" class="difflineminus">-                    day.minimonthParent = this;</span>
<a href="#l38.1257"></a><span id="l38.1257" class="difflineminus">-                    day.setAttribute(&quot;value&quot;, date.getDate());</span>
<a href="#l38.1258"></a><span id="l38.1258" class="difflineminus">-                    date.setDate(date.getDate() + 1);</span>
<a href="#l38.1259"></a><span id="l38.1259" class="difflineplus">+                  day.date = new Date(date);</span>
<a href="#l38.1260"></a><span id="l38.1260" class="difflineplus">+                  day.minimonthParent = this;</span>
<a href="#l38.1261"></a><span id="l38.1261" class="difflineplus">+                  day.setAttribute(&quot;value&quot;, date.getDate());</span>
<a href="#l38.1262"></a><span id="l38.1262" class="difflineplus">+                  date.setDate(date.getDate() + 1);</span>
<a href="#l38.1263"></a><span id="l38.1263"> </span>
<a href="#l38.1264"></a><span id="l38.1264" class="difflineminus">-                    if (monthChanged) {</span>
<a href="#l38.1265"></a><span id="l38.1265" class="difflineminus">-                        this.resetAttributesForDate(day.date);</span>
<a href="#l38.1266"></a><span id="l38.1266" class="difflineminus">-                    }</span>
<a href="#l38.1267"></a><span id="l38.1267" class="difflineminus">-                }</span>
<a href="#l38.1268"></a><span id="l38.1268" class="difflineminus">-            }</span>
<a href="#l38.1269"></a><span id="l38.1269" class="difflineplus">+                  if (monthChanged) {</span>
<a href="#l38.1270"></a><span id="l38.1270" class="difflineplus">+                      this.resetAttributesForDate(day.date);</span>
<a href="#l38.1271"></a><span id="l38.1271" class="difflineplus">+                  }</span>
<a href="#l38.1272"></a><span id="l38.1272" class="difflineplus">+              }</span>
<a href="#l38.1273"></a><span id="l38.1273" class="difflineplus">+          }</span>
<a href="#l38.1274"></a><span id="l38.1274"> </span>
<a href="#l38.1275"></a><span id="l38.1275" class="difflineminus">-            if (monthChanged) {</span>
<a href="#l38.1276"></a><span id="l38.1276" class="difflineminus">-                this.fireEvent(&quot;monthchange&quot;);</span>
<a href="#l38.1277"></a><span id="l38.1277" class="difflineminus">-            }</span>
<a href="#l38.1278"></a><span id="l38.1278" class="difflineplus">+          if (monthChanged) {</span>
<a href="#l38.1279"></a><span id="l38.1279" class="difflineplus">+              this.fireEvent(&quot;monthchange&quot;);</span>
<a href="#l38.1280"></a><span id="l38.1280" class="difflineplus">+          }</span>
<a href="#l38.1281"></a><span id="l38.1281"> </span>
<a href="#l38.1282"></a><span id="l38.1282" class="difflineminus">-            if (this.getAttribute(&quot;freebusy&quot;) == &quot;true&quot;) {</span>
<a href="#l38.1283"></a><span id="l38.1283" class="difflineminus">-                this.getItems();</span>
<a href="#l38.1284"></a><span id="l38.1284" class="difflineminus">-            }</span>
<a href="#l38.1285"></a><span id="l38.1285" class="difflineplus">+          if (this.getAttribute(&quot;freebusy&quot;) == &quot;true&quot;) {</span>
<a href="#l38.1286"></a><span id="l38.1286" class="difflineplus">+              this.getItems();</span>
<a href="#l38.1287"></a><span id="l38.1287" class="difflineplus">+          }</span>
<a href="#l38.1288"></a><span id="l38.1288">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1289"></a><span id="l38.1289">       &lt;/method&gt;</span>
<a href="#l38.1290"></a><span id="l38.1290" class="difflineplus">+</span>
<a href="#l38.1291"></a><span id="l38.1291">       &lt;!--Attention - duplicate!!!!--&gt;</span>
<a href="#l38.1292"></a><span id="l38.1292">       &lt;method name=&quot;fireEvent&quot;&gt;</span>
<a href="#l38.1293"></a><span id="l38.1293">         &lt;parameter name=&quot;aEventName&quot;/&gt;</span>
<a href="#l38.1294"></a><span id="l38.1294">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1295"></a><span id="l38.1295" class="difflineminus">-            let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l38.1296"></a><span id="l38.1296" class="difflineminus">-            event.initEvent(aEventName, true, true);</span>
<a href="#l38.1297"></a><span id="l38.1297" class="difflineminus">-            this.dispatchEvent(event);</span>
<a href="#l38.1298"></a><span id="l38.1298" class="difflineplus">+          let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l38.1299"></a><span id="l38.1299" class="difflineplus">+          event.initEvent(aEventName, true, true);</span>
<a href="#l38.1300"></a><span id="l38.1300" class="difflineplus">+          this.dispatchEvent(event);</span>
<a href="#l38.1301"></a><span id="l38.1301">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1302"></a><span id="l38.1302">       &lt;/method&gt;</span>
<a href="#l38.1303"></a><span id="l38.1303"> </span>
<a href="#l38.1304"></a><span id="l38.1304">       &lt;method name=&quot;getBoxForDate&quot;&gt;</span>
<a href="#l38.1305"></a><span id="l38.1305">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.1306"></a><span id="l38.1306">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1307"></a><span id="l38.1307" class="difflineminus">-            // aDate is a calIDateTime</span>
<a href="#l38.1308"></a><span id="l38.1308" class="difflineminus">-            let ymd = [aDate.year, aDate.month, aDate.day].join(&quot;-&quot;);</span>
<a href="#l38.1309"></a><span id="l38.1309" class="difflineminus">-            return (ymd in this.mDayMap ? this.mDayMap[ymd] : null);</span>
<a href="#l38.1310"></a><span id="l38.1310" class="difflineplus">+          // aDate is a calIDateTime</span>
<a href="#l38.1311"></a><span id="l38.1311" class="difflineplus">+          let ymd = [aDate.year, aDate.month, aDate.day].join(&quot;-&quot;);</span>
<a href="#l38.1312"></a><span id="l38.1312" class="difflineplus">+          return (ymd in this.mDayMap ? this.mDayMap[ymd] : null);</span>
<a href="#l38.1313"></a><span id="l38.1313">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1314"></a><span id="l38.1314">       &lt;/method&gt;</span>
<a href="#l38.1315"></a><span id="l38.1315"> </span>
<a href="#l38.1316"></a><span id="l38.1316">       &lt;method name=&quot;resetAttributesForDate&quot;&gt;</span>
<a href="#l38.1317"></a><span id="l38.1317">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.1318"></a><span id="l38.1318">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1319"></a><span id="l38.1319" class="difflineminus">-            function removeForBox(aBox) {</span>
<a href="#l38.1320"></a><span id="l38.1320" class="difflineplus">+          function removeForBox(aBox) {</span>
<a href="#l38.1321"></a><span id="l38.1321">               let allowedAttributes = 0;</span>
<a href="#l38.1322"></a><span id="l38.1322">               while (aBox.attributes.length &gt; allowedAttributes) {</span>
<a href="#l38.1323"></a><span id="l38.1323" class="difflineminus">-                switch (aBox.attributes[allowedAttributes].nodeName) {</span>
<a href="#l38.1324"></a><span id="l38.1324" class="difflineminus">-                  case &quot;selected&quot;:</span>
<a href="#l38.1325"></a><span id="l38.1325" class="difflineminus">-                  case &quot;othermonth&quot;:</span>
<a href="#l38.1326"></a><span id="l38.1326" class="difflineminus">-                  case &quot;today&quot;:</span>
<a href="#l38.1327"></a><span id="l38.1327" class="difflineminus">-                  case &quot;extra&quot;:</span>
<a href="#l38.1328"></a><span id="l38.1328" class="difflineminus">-                  case &quot;interactive&quot;:</span>
<a href="#l38.1329"></a><span id="l38.1329" class="difflineminus">-                  case &quot;value&quot;:</span>
<a href="#l38.1330"></a><span id="l38.1330" class="difflineminus">-                  case &quot;class&quot;:</span>
<a href="#l38.1331"></a><span id="l38.1331" class="difflineminus">-                  case &quot;flex&quot;:</span>
<a href="#l38.1332"></a><span id="l38.1332" class="difflineminus">-                    allowedAttributes++;</span>
<a href="#l38.1333"></a><span id="l38.1333" class="difflineminus">-                    break;</span>
<a href="#l38.1334"></a><span id="l38.1334" class="difflineminus">-                  default:</span>
<a href="#l38.1335"></a><span id="l38.1335" class="difflineminus">-                    aBox.removeAttribute(aBox.attributes[allowedAttributes].nodeName);</span>
<a href="#l38.1336"></a><span id="l38.1336" class="difflineminus">-                    break;</span>
<a href="#l38.1337"></a><span id="l38.1337" class="difflineminus">-                }</span>
<a href="#l38.1338"></a><span id="l38.1338" class="difflineplus">+                  switch (aBox.attributes[allowedAttributes].nodeName) {</span>
<a href="#l38.1339"></a><span id="l38.1339" class="difflineplus">+                      case &quot;selected&quot;:</span>
<a href="#l38.1340"></a><span id="l38.1340" class="difflineplus">+                      case &quot;othermonth&quot;:</span>
<a href="#l38.1341"></a><span id="l38.1341" class="difflineplus">+                      case &quot;today&quot;:</span>
<a href="#l38.1342"></a><span id="l38.1342" class="difflineplus">+                      case &quot;extra&quot;:</span>
<a href="#l38.1343"></a><span id="l38.1343" class="difflineplus">+                      case &quot;interactive&quot;:</span>
<a href="#l38.1344"></a><span id="l38.1344" class="difflineplus">+                      case &quot;value&quot;:</span>
<a href="#l38.1345"></a><span id="l38.1345" class="difflineplus">+                      case &quot;class&quot;:</span>
<a href="#l38.1346"></a><span id="l38.1346" class="difflineplus">+                      case &quot;flex&quot;:</span>
<a href="#l38.1347"></a><span id="l38.1347" class="difflineplus">+                          allowedAttributes++;</span>
<a href="#l38.1348"></a><span id="l38.1348" class="difflineplus">+                          break;</span>
<a href="#l38.1349"></a><span id="l38.1349" class="difflineplus">+                      default:</span>
<a href="#l38.1350"></a><span id="l38.1350" class="difflineplus">+                          aBox.removeAttribute(aBox.attributes[allowedAttributes].nodeName);</span>
<a href="#l38.1351"></a><span id="l38.1351" class="difflineplus">+                          break;</span>
<a href="#l38.1352"></a><span id="l38.1352" class="difflineplus">+                  }</span>
<a href="#l38.1353"></a><span id="l38.1353">               }</span>
<a href="#l38.1354"></a><span id="l38.1354" class="difflineminus">-            }</span>
<a href="#l38.1355"></a><span id="l38.1355" class="difflineplus">+          }</span>
<a href="#l38.1356"></a><span id="l38.1356"> </span>
<a href="#l38.1357"></a><span id="l38.1357" class="difflineminus">-            if (aDate) {</span>
<a href="#l38.1358"></a><span id="l38.1358" class="difflineplus">+          if (aDate) {</span>
<a href="#l38.1359"></a><span id="l38.1359">               let box = this.getBoxForDate(cal.jsDateToDateTime(aDate, cal.calendarDefaultTimezone()));</span>
<a href="#l38.1360"></a><span id="l38.1360">               if (box) {</span>
<a href="#l38.1361"></a><span id="l38.1361">                   removeForBox(box);</span>
<a href="#l38.1362"></a><span id="l38.1362">               }</span>
<a href="#l38.1363"></a><span id="l38.1363" class="difflineminus">-            } else {</span>
<a href="#l38.1364"></a><span id="l38.1364" class="difflineplus">+          } else {</span>
<a href="#l38.1365"></a><span id="l38.1365">               let calbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-calendar&quot;);</span>
<a href="#l38.1366"></a><span id="l38.1366">               for (let k = 1; k &lt; calbox.childNodes.length; k++) {</span>
<a href="#l38.1367"></a><span id="l38.1367" class="difflineminus">-                for (let i = 1; i &lt; 8; i++) {</span>
<a href="#l38.1368"></a><span id="l38.1368" class="difflineminus">-                    removeForBox(calbox.childNodes[k].childNodes[i]);</span>
<a href="#l38.1369"></a><span id="l38.1369" class="difflineminus">-                }</span>
<a href="#l38.1370"></a><span id="l38.1370" class="difflineplus">+                  for (let i = 1; i &lt; 8; i++) {</span>
<a href="#l38.1371"></a><span id="l38.1371" class="difflineplus">+                      removeForBox(calbox.childNodes[k].childNodes[i]);</span>
<a href="#l38.1372"></a><span id="l38.1372" class="difflineplus">+                  }</span>
<a href="#l38.1373"></a><span id="l38.1373">               }</span>
<a href="#l38.1374"></a><span id="l38.1374" class="difflineminus">-            }</span>
<a href="#l38.1375"></a><span id="l38.1375" class="difflineminus">-          ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1376"></a><span id="l38.1376" class="difflineplus">+          }</span>
<a href="#l38.1377"></a><span id="l38.1377" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1378"></a><span id="l38.1378">       &lt;/method&gt;</span>
<a href="#l38.1379"></a><span id="l38.1379" class="difflineplus">+</span>
<a href="#l38.1380"></a><span id="l38.1380">       &lt;method name=&quot;_setFreeBusy&quot;&gt;</span>
<a href="#l38.1381"></a><span id="l38.1381">         &lt;parameter name=&quot;aFreeBusy&quot;/&gt;</span>
<a href="#l38.1382"></a><span id="l38.1382">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1383"></a><span id="l38.1383" class="difflineminus">-            if (aFreeBusy == true) {</span>
<a href="#l38.1384"></a><span id="l38.1384" class="difflineminus">-                if (this.mObservesComposite == false) {</span>
<a href="#l38.1385"></a><span id="l38.1385" class="difflineminus">-                    getCompositeCalendar().addObserver(this);</span>
<a href="#l38.1386"></a><span id="l38.1386" class="difflineminus">-                    this.mObservesComposite = true;</span>
<a href="#l38.1387"></a><span id="l38.1387" class="difflineminus">-                    this.getItems();</span>
<a href="#l38.1388"></a><span id="l38.1388" class="difflineminus">-                 }</span>
<a href="#l38.1389"></a><span id="l38.1389" class="difflineminus">-            } else if (this.mObservesComposite == true) {</span>
<a href="#l38.1390"></a><span id="l38.1390" class="difflineminus">-                getCompositeCalendar().removeObserver(this);</span>
<a href="#l38.1391"></a><span id="l38.1391" class="difflineminus">-                this.mObservesComposite = false;</span>
<a href="#l38.1392"></a><span id="l38.1392" class="difflineminus">-            }</span>
<a href="#l38.1393"></a><span id="l38.1393" class="difflineplus">+          if (aFreeBusy == true) {</span>
<a href="#l38.1394"></a><span id="l38.1394" class="difflineplus">+              if (this.mObservesComposite == false) {</span>
<a href="#l38.1395"></a><span id="l38.1395" class="difflineplus">+                  getCompositeCalendar().addObserver(this);</span>
<a href="#l38.1396"></a><span id="l38.1396" class="difflineplus">+                  this.mObservesComposite = true;</span>
<a href="#l38.1397"></a><span id="l38.1397" class="difflineplus">+                  this.getItems();</span>
<a href="#l38.1398"></a><span id="l38.1398" class="difflineplus">+              }</span>
<a href="#l38.1399"></a><span id="l38.1399" class="difflineplus">+          } else if (this.mObservesComposite == true) {</span>
<a href="#l38.1400"></a><span id="l38.1400" class="difflineplus">+              getCompositeCalendar().removeObserver(this);</span>
<a href="#l38.1401"></a><span id="l38.1401" class="difflineplus">+              this.mObservesComposite = false;</span>
<a href="#l38.1402"></a><span id="l38.1402" class="difflineplus">+          }</span>
<a href="#l38.1403"></a><span id="l38.1403">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1404"></a><span id="l38.1404">       &lt;/method&gt;</span>
<a href="#l38.1405"></a><span id="l38.1405" class="difflineplus">+</span>
<a href="#l38.1406"></a><span id="l38.1406">       &lt;method name=&quot;removeAttribute&quot;&gt;</span>
<a href="#l38.1407"></a><span id="l38.1407">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l38.1408"></a><span id="l38.1408">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1409"></a><span id="l38.1409">           if (aAttr == &quot;freebusy&quot;) {</span>
<a href="#l38.1410"></a><span id="l38.1410">               this._setFreeBusy(false);</span>
<a href="#l38.1411"></a><span id="l38.1411">           }</span>
<a href="#l38.1412"></a><span id="l38.1412">           // this should be done using lookupMethod(), see bug 286629</span>
<a href="#l38.1413"></a><span id="l38.1413">           let ret = XULElement.prototype.removeAttribute.call(this, aAttr);</span>
<a href="#l38.1414"></a><span id="l38.1414">           return ret;</span>
<a href="#l38.1415"></a><span id="l38.1415">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1416"></a><span id="l38.1416">       &lt;/method&gt;</span>
<a href="#l38.1417"></a><span id="l38.1417" class="difflineplus">+</span>
<a href="#l38.1418"></a><span id="l38.1418">       &lt;method name=&quot;setAttribute&quot;&gt;</span>
<a href="#l38.1419"></a><span id="l38.1419">         &lt;parameter name=&quot;aAttr&quot;/&gt;</span>
<a href="#l38.1420"></a><span id="l38.1420">         &lt;parameter name=&quot;aVal&quot;/&gt;</span>
<a href="#l38.1421"></a><span id="l38.1421">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1422"></a><span id="l38.1422">           if (aAttr == &quot;freebusy&quot;) {</span>
<a href="#l38.1423"></a><span id="l38.1423">               this._setFreeBusy(aVal == &quot;true&quot;);</span>
<a href="#l38.1424"></a><span id="l38.1424">           }</span>
<a href="#l38.1425"></a><span id="l38.1425">           // this should be done using lookupMethod(), see bug 286629</span>
<a href="#l38.1426"></a><span id="l38.1426">           let ret = XULElement.prototype.setAttribute.call(this, aAttr, aVal);</span>
<a href="#l38.1427"></a><span id="l38.1427">           return ret;</span>
<a href="#l38.1428"></a><span id="l38.1428">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1429"></a><span id="l38.1429">       &lt;/method&gt;</span>
<a href="#l38.1430"></a><span id="l38.1430" class="difflineplus">+</span>
<a href="#l38.1431"></a><span id="l38.1431">       &lt;method name=&quot;getItems&quot;&gt;</span>
<a href="#l38.1432"></a><span id="l38.1432">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l38.1433"></a><span id="l38.1433">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1434"></a><span id="l38.1434">           // The minimonth automatically clears extra styles on a month change.</span>
<a href="#l38.1435"></a><span id="l38.1435">           // Therefore we only need to fill the minimonth with new info.</span>
<a href="#l38.1436"></a><span id="l38.1436"> </span>
<a href="#l38.1437"></a><span id="l38.1437">           let calendar = aCalendar || getCompositeCalendar();</span>
<a href="#l38.1438"></a><span id="l38.1438">           let filter = calendar.ITEM_FILTER_COMPLETED_ALL |</span>
<a href="#l38.1439"></a><span id="l38.1439" class="difflineat">@@ -1025,95 +1039,95 @@</span>
<a href="#l38.1440"></a><span id="l38.1440">                             this.lastDate,</span>
<a href="#l38.1441"></a><span id="l38.1441">                             this);</span>
<a href="#l38.1442"></a><span id="l38.1442">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1443"></a><span id="l38.1443">       &lt;/method&gt;</span>
<a href="#l38.1444"></a><span id="l38.1444"> </span>
<a href="#l38.1445"></a><span id="l38.1445">       &lt;method name=&quot;onSelectDay&quot;&gt;</span>
<a href="#l38.1446"></a><span id="l38.1446">         &lt;parameter name=&quot;aDayBox&quot;/&gt;</span>
<a href="#l38.1447"></a><span id="l38.1447">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1448"></a><span id="l38.1448" class="difflineminus">-            if (this.mIsReadOnly) {</span>
<a href="#l38.1449"></a><span id="l38.1449" class="difflineminus">-               return;</span>
<a href="#l38.1450"></a><span id="l38.1450" class="difflineminus">-            }</span>
<a href="#l38.1451"></a><span id="l38.1451" class="difflineminus">-            if (this.mSelected) {</span>
<a href="#l38.1452"></a><span id="l38.1452" class="difflineplus">+          if (this.mIsReadOnly) {</span>
<a href="#l38.1453"></a><span id="l38.1453" class="difflineplus">+              return;</span>
<a href="#l38.1454"></a><span id="l38.1454" class="difflineplus">+          }</span>
<a href="#l38.1455"></a><span id="l38.1455" class="difflineplus">+          if (this.mSelected) {</span>
<a href="#l38.1456"></a><span id="l38.1456">               this.mSelected.removeAttribute(&quot;selected&quot;);</span>
<a href="#l38.1457"></a><span id="l38.1457" class="difflineminus">-            }</span>
<a href="#l38.1458"></a><span id="l38.1458" class="difflineminus">-            this.mSelected = aDayBox;</span>
<a href="#l38.1459"></a><span id="l38.1459" class="difflineminus">-            this.value = aDayBox.date;</span>
<a href="#l38.1460"></a><span id="l38.1460" class="difflineminus">-            this.fireEvent(&quot;select&quot;);</span>
<a href="#l38.1461"></a><span id="l38.1461" class="difflineminus">-          ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1462"></a><span id="l38.1462" class="difflineplus">+          }</span>
<a href="#l38.1463"></a><span id="l38.1463" class="difflineplus">+          this.mSelected = aDayBox;</span>
<a href="#l38.1464"></a><span id="l38.1464" class="difflineplus">+          this.value = aDayBox.date;</span>
<a href="#l38.1465"></a><span id="l38.1465" class="difflineplus">+          this.fireEvent(&quot;select&quot;);</span>
<a href="#l38.1466"></a><span id="l38.1466" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1467"></a><span id="l38.1467">       &lt;/method&gt;</span>
<a href="#l38.1468"></a><span id="l38.1468"> </span>
<a href="#l38.1469"></a><span id="l38.1469">       &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l38.1470"></a><span id="l38.1470">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l38.1471"></a><span id="l38.1471">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1472"></a><span id="l38.1472">           this.mValue = aValue;</span>
<a href="#l38.1473"></a><span id="l38.1473">           if (this.mValue) {</span>
<a href="#l38.1474"></a><span id="l38.1474" class="difflineminus">-            this.fireEvent(&quot;change&quot;);</span>
<a href="#l38.1475"></a><span id="l38.1475" class="difflineplus">+              this.fireEvent(&quot;change&quot;);</span>
<a href="#l38.1476"></a><span id="l38.1476">           }</span>
<a href="#l38.1477"></a><span id="l38.1477">           this.showMonth(aValue);</span>
<a href="#l38.1478"></a><span id="l38.1478">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1479"></a><span id="l38.1479">       &lt;/method&gt;</span>
<a href="#l38.1480"></a><span id="l38.1480"> </span>
<a href="#l38.1481"></a><span id="l38.1481">       &lt;method name=&quot;hidePopupList&quot;&gt;</span>
<a href="#l38.1482"></a><span id="l38.1482">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1483"></a><span id="l38.1483">           if (!this.mIsReadOnly) {</span>
<a href="#l38.1484"></a><span id="l38.1484" class="difflineminus">-             let header = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-header&quot;);</span>
<a href="#l38.1485"></a><span id="l38.1485" class="difflineminus">-             header.hidePopupList();</span>
<a href="#l38.1486"></a><span id="l38.1486" class="difflineplus">+              let header = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;minimonth-header&quot;);</span>
<a href="#l38.1487"></a><span id="l38.1487" class="difflineplus">+              header.hidePopupList();</span>
<a href="#l38.1488"></a><span id="l38.1488">           }</span>
<a href="#l38.1489"></a><span id="l38.1489">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1490"></a><span id="l38.1490">       &lt;/method&gt;</span>
<a href="#l38.1491"></a><span id="l38.1491"> </span>
<a href="#l38.1492"></a><span id="l38.1492">       &lt;method name=&quot;switchMonth&quot;&gt;</span>
<a href="#l38.1493"></a><span id="l38.1493">         &lt;parameter name=&quot;aMonth&quot;/&gt;</span>
<a href="#l38.1494"></a><span id="l38.1494">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1495"></a><span id="l38.1495" class="difflineminus">-            let newMonth = new Date(this.mEditorDate);</span>
<a href="#l38.1496"></a><span id="l38.1496" class="difflineminus">-            newMonth.setMonth(aMonth);</span>
<a href="#l38.1497"></a><span id="l38.1497" class="difflineminus">-            this.showMonth(newMonth);</span>
<a href="#l38.1498"></a><span id="l38.1498" class="difflineplus">+          let newMonth = new Date(this.mEditorDate);</span>
<a href="#l38.1499"></a><span id="l38.1499" class="difflineplus">+          newMonth.setMonth(aMonth);</span>
<a href="#l38.1500"></a><span id="l38.1500" class="difflineplus">+          this.showMonth(newMonth);</span>
<a href="#l38.1501"></a><span id="l38.1501">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1502"></a><span id="l38.1502">       &lt;/method&gt;</span>
<a href="#l38.1503"></a><span id="l38.1503"> </span>
<a href="#l38.1504"></a><span id="l38.1504">       &lt;method name=&quot;switchYear&quot;&gt;</span>
<a href="#l38.1505"></a><span id="l38.1505">         &lt;parameter name=&quot;aYear&quot;/&gt;</span>
<a href="#l38.1506"></a><span id="l38.1506">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1507"></a><span id="l38.1507" class="difflineminus">-            let newMonth = new Date(this.mEditorDate);</span>
<a href="#l38.1508"></a><span id="l38.1508" class="difflineminus">-            newMonth.setFullYear(aYear);</span>
<a href="#l38.1509"></a><span id="l38.1509" class="difflineminus">-            this.showMonth(newMonth);</span>
<a href="#l38.1510"></a><span id="l38.1510" class="difflineplus">+          let newMonth = new Date(this.mEditorDate);</span>
<a href="#l38.1511"></a><span id="l38.1511" class="difflineplus">+          newMonth.setFullYear(aYear);</span>
<a href="#l38.1512"></a><span id="l38.1512" class="difflineplus">+          this.showMonth(newMonth);</span>
<a href="#l38.1513"></a><span id="l38.1513">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1514"></a><span id="l38.1514">       &lt;/method&gt;</span>
<a href="#l38.1515"></a><span id="l38.1515"> </span>
<a href="#l38.1516"></a><span id="l38.1516">       &lt;method name=&quot;selectDate&quot;&gt;</span>
<a href="#l38.1517"></a><span id="l38.1517">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l38.1518"></a><span id="l38.1518">         &lt;parameter name=&quot;aMainDate&quot;/&gt;</span>
<a href="#l38.1519"></a><span id="l38.1519">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1520"></a><span id="l38.1520" class="difflineminus">-            if (!aMainDate || (aDate &lt; this._getStartDate(aMainDate) || aDate &gt; this._getEndDate(aMainDate))) {</span>
<a href="#l38.1521"></a><span id="l38.1521" class="difflineminus">-                aMainDate = new Date(aDate);</span>
<a href="#l38.1522"></a><span id="l38.1522" class="difflineminus">-                aMainDate.setDate(1);</span>
<a href="#l38.1523"></a><span id="l38.1523" class="difflineminus">-            }</span>
<a href="#l38.1524"></a><span id="l38.1524" class="difflineminus">-            // note, that aMainDate and this.mEditorDate refer to the first day</span>
<a href="#l38.1525"></a><span id="l38.1525" class="difflineminus">-            // of the corresponding month</span>
<a href="#l38.1526"></a><span id="l38.1526" class="difflineminus">-            let sameMonth = this._sameDay(aMainDate, this.mEditorDate);</span>
<a href="#l38.1527"></a><span id="l38.1527" class="difflineminus">-            let sameDate = this._sameDay(aDate, this.mValue);</span>
<a href="#l38.1528"></a><span id="l38.1528" class="difflineminus">-            if (!sameMonth &amp;&amp; !sameDate) {</span>
<a href="#l38.1529"></a><span id="l38.1529" class="difflineminus">-                // change month and select day</span>
<a href="#l38.1530"></a><span id="l38.1530" class="difflineminus">-                this.mValue = aDate;</span>
<a href="#l38.1531"></a><span id="l38.1531" class="difflineminus">-                this.showMonth(aMainDate);</span>
<a href="#l38.1532"></a><span id="l38.1532" class="difflineminus">-            } else if (!sameMonth) {</span>
<a href="#l38.1533"></a><span id="l38.1533" class="difflineminus">-                // change month only</span>
<a href="#l38.1534"></a><span id="l38.1534" class="difflineminus">-                this.showMonth(aMainDate);</span>
<a href="#l38.1535"></a><span id="l38.1535" class="difflineminus">-            } else if (!sameDate) {</span>
<a href="#l38.1536"></a><span id="l38.1536" class="difflineminus">-                // select day only</span>
<a href="#l38.1537"></a><span id="l38.1537" class="difflineminus">-                let day = this.getBoxForDate(cal.jsDateToDateTime(aDate, cal.calendarDefaultTimezone()));</span>
<a href="#l38.1538"></a><span id="l38.1538" class="difflineminus">-                if (this.mSelected) {</span>
<a href="#l38.1539"></a><span id="l38.1539" class="difflineminus">-                    this.mSelected.removeAttribute(&quot;selected&quot;);</span>
<a href="#l38.1540"></a><span id="l38.1540" class="difflineminus">-                }</span>
<a href="#l38.1541"></a><span id="l38.1541" class="difflineminus">-                this.mSelected = day;</span>
<a href="#l38.1542"></a><span id="l38.1542" class="difflineminus">-                day.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l38.1543"></a><span id="l38.1543" class="difflineminus">-                this.mValue = aDate;</span>
<a href="#l38.1544"></a><span id="l38.1544" class="difflineminus">-            }</span>
<a href="#l38.1545"></a><span id="l38.1545" class="difflineplus">+          if (!aMainDate || aDate &lt; this._getStartDate(aMainDate) || aDate &gt; this._getEndDate(aMainDate)) {</span>
<a href="#l38.1546"></a><span id="l38.1546" class="difflineplus">+              aMainDate = new Date(aDate);</span>
<a href="#l38.1547"></a><span id="l38.1547" class="difflineplus">+              aMainDate.setDate(1);</span>
<a href="#l38.1548"></a><span id="l38.1548" class="difflineplus">+          }</span>
<a href="#l38.1549"></a><span id="l38.1549" class="difflineplus">+          // note, that aMainDate and this.mEditorDate refer to the first day</span>
<a href="#l38.1550"></a><span id="l38.1550" class="difflineplus">+          // of the corresponding month</span>
<a href="#l38.1551"></a><span id="l38.1551" class="difflineplus">+          let sameMonth = this._sameDay(aMainDate, this.mEditorDate);</span>
<a href="#l38.1552"></a><span id="l38.1552" class="difflineplus">+          let sameDate = this._sameDay(aDate, this.mValue);</span>
<a href="#l38.1553"></a><span id="l38.1553" class="difflineplus">+          if (!sameMonth &amp;&amp; !sameDate) {</span>
<a href="#l38.1554"></a><span id="l38.1554" class="difflineplus">+              // change month and select day</span>
<a href="#l38.1555"></a><span id="l38.1555" class="difflineplus">+              this.mValue = aDate;</span>
<a href="#l38.1556"></a><span id="l38.1556" class="difflineplus">+              this.showMonth(aMainDate);</span>
<a href="#l38.1557"></a><span id="l38.1557" class="difflineplus">+          } else if (!sameMonth) {</span>
<a href="#l38.1558"></a><span id="l38.1558" class="difflineplus">+              // change month only</span>
<a href="#l38.1559"></a><span id="l38.1559" class="difflineplus">+              this.showMonth(aMainDate);</span>
<a href="#l38.1560"></a><span id="l38.1560" class="difflineplus">+          } else if (!sameDate) {</span>
<a href="#l38.1561"></a><span id="l38.1561" class="difflineplus">+              // select day only</span>
<a href="#l38.1562"></a><span id="l38.1562" class="difflineplus">+              let day = this.getBoxForDate(cal.jsDateToDateTime(aDate, cal.calendarDefaultTimezone()));</span>
<a href="#l38.1563"></a><span id="l38.1563" class="difflineplus">+              if (this.mSelected) {</span>
<a href="#l38.1564"></a><span id="l38.1564" class="difflineplus">+                  this.mSelected.removeAttribute(&quot;selected&quot;);</span>
<a href="#l38.1565"></a><span id="l38.1565" class="difflineplus">+              }</span>
<a href="#l38.1566"></a><span id="l38.1566" class="difflineplus">+              this.mSelected = day;</span>
<a href="#l38.1567"></a><span id="l38.1567" class="difflineplus">+              day.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l38.1568"></a><span id="l38.1568" class="difflineplus">+              this.mValue = aDate;</span>
<a href="#l38.1569"></a><span id="l38.1569" class="difflineplus">+          }</span>
<a href="#l38.1570"></a><span id="l38.1570">          ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1571"></a><span id="l38.1571">       &lt;/method&gt;</span>
<a href="#l38.1572"></a><span id="l38.1572"> </span>
<a href="#l38.1573"></a><span id="l38.1573">       &lt;method name=&quot;_getStartDate&quot;&gt;</span>
<a href="#l38.1574"></a><span id="l38.1574">         &lt;parameter name=&quot;aMainDate&quot;/&gt;</span>
<a href="#l38.1575"></a><span id="l38.1575">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1576"></a><span id="l38.1576">           let date = new Date(aMainDate);</span>
<a href="#l38.1577"></a><span id="l38.1577">           let firstWeekday = (7 + aMainDate.getDay() - this.weekStart) % 7;</span>
<a href="#l38.1578"></a><span id="l38.1578" class="difflineat">@@ -1136,64 +1150,64 @@</span>
<a href="#l38.1579"></a><span id="l38.1579">       &lt;method name=&quot;_sameDay&quot;&gt;</span>
<a href="#l38.1580"></a><span id="l38.1580">         &lt;parameter name=&quot;aDate1&quot;/&gt;</span>
<a href="#l38.1581"></a><span id="l38.1581">         &lt;parameter name=&quot;aDate2&quot;/&gt;</span>
<a href="#l38.1582"></a><span id="l38.1582">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1583"></a><span id="l38.1583">           if (aDate1 &amp;&amp; aDate2 &amp;&amp;</span>
<a href="#l38.1584"></a><span id="l38.1584">              (aDate1.getDate() == aDate2.getDate()) &amp;&amp;</span>
<a href="#l38.1585"></a><span id="l38.1585">              (aDate1.getMonth() == aDate2.getMonth()) &amp;&amp;</span>
<a href="#l38.1586"></a><span id="l38.1586">              (aDate1.getFullYear() == aDate2.getFullYear())) {</span>
<a href="#l38.1587"></a><span id="l38.1587" class="difflineminus">-             return true;</span>
<a href="#l38.1588"></a><span id="l38.1588" class="difflineplus">+              return true;</span>
<a href="#l38.1589"></a><span id="l38.1589">           }</span>
<a href="#l38.1590"></a><span id="l38.1590">           return false;</span>
<a href="#l38.1591"></a><span id="l38.1591">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1592"></a><span id="l38.1592">       &lt;/method&gt;</span>
<a href="#l38.1593"></a><span id="l38.1593" class="difflineplus">+</span>
<a href="#l38.1594"></a><span id="l38.1594">       &lt;method name=&quot;advanceMonth&quot;&gt;</span>
<a href="#l38.1595"></a><span id="l38.1595">         &lt;parameter name=&quot;aDir&quot;/&gt;</span>
<a href="#l38.1596"></a><span id="l38.1596">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l38.1597"></a><span id="l38.1597">           let advEditorDate = new Date(this.mEditorDate); // at 1st of month</span>
<a href="#l38.1598"></a><span id="l38.1598">           let advMonth = this.mEditorDate.getMonth() + aDir;</span>
<a href="#l38.1599"></a><span id="l38.1599">           advEditorDate.setMonth(advMonth);</span>
<a href="#l38.1600"></a><span id="l38.1600">           this.showMonth(advEditorDate);</span>
<a href="#l38.1601"></a><span id="l38.1601">         ]]&gt;&lt;/body&gt;</span>
<a href="#l38.1602"></a><span id="l38.1602">       &lt;/method&gt;</span>
<a href="#l38.1603"></a><span id="l38.1603">     &lt;/implementation&gt;</span>
<a href="#l38.1604"></a><span id="l38.1604" class="difflineplus">+</span>
<a href="#l38.1605"></a><span id="l38.1605">     &lt;handlers&gt;</span>
<a href="#l38.1606"></a><span id="l38.1606" class="difflineminus">-      &lt;handler event=&quot;wheel&quot;&gt;</span>
<a href="#l38.1607"></a><span id="l38.1607" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l38.1608"></a><span id="l38.1608" class="difflineminus">-          const pixelThreshold = 150;</span>
<a href="#l38.1609"></a><span id="l38.1609" class="difflineminus">-          let deltaView = 0;</span>
<a href="#l38.1610"></a><span id="l38.1610" class="difflineminus">-          if (this.mIsReadOnly) {</span>
<a href="#l38.1611"></a><span id="l38.1611" class="difflineplus">+      &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l38.1612"></a><span id="l38.1612" class="difflineplus">+        const pixelThreshold = 150;</span>
<a href="#l38.1613"></a><span id="l38.1613" class="difflineplus">+        let deltaView = 0;</span>
<a href="#l38.1614"></a><span id="l38.1614" class="difflineplus">+        if (this.mIsReadOnly) {</span>
<a href="#l38.1615"></a><span id="l38.1615">             // No scrolling on readonly months</span>
<a href="#l38.1616"></a><span id="l38.1616">             return;</span>
<a href="#l38.1617"></a><span id="l38.1617" class="difflineminus">-          }</span>
<a href="#l38.1618"></a><span id="l38.1618" class="difflineminus">-          if (event.deltaMode == event.DOM_DELTA_LINE ||</span>
<a href="#l38.1619"></a><span id="l38.1619" class="difflineminus">-              event.deltaMode == event.DOM_DELTA_PAGE) {</span>
<a href="#l38.1620"></a><span id="l38.1620" class="difflineminus">-              if (event.deltaY != 0) {</span>
<a href="#l38.1621"></a><span id="l38.1621" class="difflineminus">-                  deltaView = event.deltaY &gt; 0 ? 1 : -1;</span>
<a href="#l38.1622"></a><span id="l38.1622" class="difflineminus">-              }</span>
<a href="#l38.1623"></a><span id="l38.1623" class="difflineminus">-          } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l38.1624"></a><span id="l38.1624" class="difflineminus">-              this.mPixelScrollDelta += event.deltaY;</span>
<a href="#l38.1625"></a><span id="l38.1625" class="difflineminus">-              if (this.mPixelScrollDelta &gt; pixelThreshold) {</span>
<a href="#l38.1626"></a><span id="l38.1626" class="difflineminus">-                  deltaView = 1;</span>
<a href="#l38.1627"></a><span id="l38.1627" class="difflineminus">-                  this.mPixelScrollDelta = 0;</span>
<a href="#l38.1628"></a><span id="l38.1628" class="difflineminus">-              } else if (this.mPixelScrollDelta &lt; -pixelThreshold) {</span>
<a href="#l38.1629"></a><span id="l38.1629" class="difflineminus">-                  deltaView = -1;</span>
<a href="#l38.1630"></a><span id="l38.1630" class="difflineminus">-                  this.mPixelScrollDelta = 0;</span>
<a href="#l38.1631"></a><span id="l38.1631" class="difflineminus">-              }</span>
<a href="#l38.1632"></a><span id="l38.1632" class="difflineminus">-          }</span>
<a href="#l38.1633"></a><span id="l38.1633" class="difflineplus">+        }</span>
<a href="#l38.1634"></a><span id="l38.1634" class="difflineplus">+        if (event.deltaMode == event.DOM_DELTA_LINE ||</span>
<a href="#l38.1635"></a><span id="l38.1635" class="difflineplus">+            event.deltaMode == event.DOM_DELTA_PAGE) {</span>
<a href="#l38.1636"></a><span id="l38.1636" class="difflineplus">+            if (event.deltaY != 0) {</span>
<a href="#l38.1637"></a><span id="l38.1637" class="difflineplus">+                deltaView = event.deltaY &gt; 0 ? 1 : -1;</span>
<a href="#l38.1638"></a><span id="l38.1638" class="difflineplus">+            }</span>
<a href="#l38.1639"></a><span id="l38.1639" class="difflineplus">+        } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l38.1640"></a><span id="l38.1640" class="difflineplus">+            this.mPixelScrollDelta += event.deltaY;</span>
<a href="#l38.1641"></a><span id="l38.1641" class="difflineplus">+            if (this.mPixelScrollDelta &gt; pixelThreshold) {</span>
<a href="#l38.1642"></a><span id="l38.1642" class="difflineplus">+                deltaView = 1;</span>
<a href="#l38.1643"></a><span id="l38.1643" class="difflineplus">+                this.mPixelScrollDelta = 0;</span>
<a href="#l38.1644"></a><span id="l38.1644" class="difflineplus">+            } else if (this.mPixelScrollDelta &lt; -pixelThreshold) {</span>
<a href="#l38.1645"></a><span id="l38.1645" class="difflineplus">+                deltaView = -1;</span>
<a href="#l38.1646"></a><span id="l38.1646" class="difflineplus">+                this.mPixelScrollDelta = 0;</span>
<a href="#l38.1647"></a><span id="l38.1647" class="difflineplus">+            }</span>
<a href="#l38.1648"></a><span id="l38.1648" class="difflineplus">+        }</span>
<a href="#l38.1649"></a><span id="l38.1649"> </span>
<a href="#l38.1650"></a><span id="l38.1650" class="difflineminus">-          if (deltaView != 0) {</span>
<a href="#l38.1651"></a><span id="l38.1651" class="difflineminus">-              this.advanceMonth(deltaView);</span>
<a href="#l38.1652"></a><span id="l38.1652" class="difflineminus">-          }</span>
<a href="#l38.1653"></a><span id="l38.1653" class="difflineplus">+        if (deltaView != 0) {</span>
<a href="#l38.1654"></a><span id="l38.1654" class="difflineplus">+            this.advanceMonth(deltaView);</span>
<a href="#l38.1655"></a><span id="l38.1655" class="difflineplus">+        }</span>
<a href="#l38.1656"></a><span id="l38.1656"> </span>
<a href="#l38.1657"></a><span id="l38.1657" class="difflineminus">-          event.stopPropagation();</span>
<a href="#l38.1658"></a><span id="l38.1658" class="difflineminus">-          event.preventDefault();</span>
<a href="#l38.1659"></a><span id="l38.1659" class="difflineminus">-        ]]&gt;</span>
<a href="#l38.1660"></a><span id="l38.1660" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l38.1661"></a><span id="l38.1661" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l38.1662"></a><span id="l38.1662" class="difflineplus">+        event.preventDefault();</span>
<a href="#l38.1663"></a><span id="l38.1663" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l38.1664"></a><span id="l38.1664">     &lt;/handlers&gt;</span>
<a href="#l38.1665"></a><span id="l38.1665">   &lt;/binding&gt;</span>
<a href="#l38.1666"></a><span id="l38.1666"> </span>
<a href="#l38.1667"></a><span id="l38.1667">   &lt;binding id=&quot;minimonth-day&quot; extends=&quot;xul:text&quot;&gt;</span>
<a href="#l38.1668"></a><span id="l38.1668">     &lt;handlers&gt;</span>
<a href="#l38.1669"></a><span id="l38.1669">       &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l38.1670"></a><span id="l38.1670">         if (this.minimonthParent.getAttribute(&quot;readonly&quot;) != &quot;true&quot;) {</span>
<a href="#l38.1671"></a><span id="l38.1671">             this.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/base/modules/calExtract.jsm</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/base/modules/calExtract.jsm</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -705,19 +705,19 @@ Extractor.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4">             for (let inner = 0; inner &lt; this.collected.length; inner++) {</span>
<a href="#l39.5"></a><span id="l39.5">                 // included but not exactly the same</span>
<a href="#l39.6"></a><span id="l39.6">                 if (outer != inner &amp;&amp;</span>
<a href="#l39.7"></a><span id="l39.7">                     this.collected[outer].start &amp;&amp; this.collected[outer].end &amp;&amp;</span>
<a href="#l39.8"></a><span id="l39.8">                     this.collected[inner].start &amp;&amp; this.collected[inner].end &amp;&amp;</span>
<a href="#l39.9"></a><span id="l39.9">                     this.collected[inner].start &gt;= this.collected[outer].start &amp;&amp;</span>
<a href="#l39.10"></a><span id="l39.10">                     this.collected[inner].end &lt;= this.collected[outer].end &amp;&amp;</span>
<a href="#l39.11"></a><span id="l39.11">                     !(this.collected[inner].start == this.collected[outer].start &amp;&amp;</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-                        this.collected[inner].end == this.collected[outer].end)) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-                        cal.LOG(&quot;[calExtract] &quot; + this.collected[outer].str + &quot; found as well, disgarding &quot; + this.collected[inner].str);</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineminus">-                        this.collected[inner].relation = &quot;notadatetime&quot;;</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineplus">+                      this.collected[inner].end == this.collected[outer].end)) {</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+                    cal.LOG(&quot;[calExtract] &quot; + this.collected[outer].str + &quot; found as well, disgarding &quot; + this.collected[inner].str);</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineplus">+                    this.collected[inner].relation = &quot;notadatetime&quot;;</span>
<a href="#l39.18"></a><span id="l39.18">                 }</span>
<a href="#l39.19"></a><span id="l39.19">             }</span>
<a href="#l39.20"></a><span id="l39.20">         }</span>
<a href="#l39.21"></a><span id="l39.21">     },</span>
<a href="#l39.22"></a><span id="l39.22"> </span>
<a href="#l39.23"></a><span id="l39.23">     markSelected: function(sel, title) {</span>
<a href="#l39.24"></a><span id="l39.24">         if (sel.rangeCount &gt; 0) {</span>
<a href="#l39.25"></a><span id="l39.25">             // mark the ones to not use</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/base/modules/calHashedArray.jsm</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/base/modules/calHashedArray.jsm</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -108,22 +108,22 @@ cal.HashedArray.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">         delete this.mHash[this.hashAccessor(this.mArray[index])];</span>
<a href="#l40.5"></a><span id="l40.5">         this.mArray.splice(index, 1);</span>
<a href="#l40.6"></a><span id="l40.6">         this.reindex(index);</span>
<a href="#l40.7"></a><span id="l40.7">     },</span>
<a href="#l40.8"></a><span id="l40.8"> </span>
<a href="#l40.9"></a><span id="l40.9">     /**</span>
<a href="#l40.10"></a><span id="l40.10">      * Clear the whole array, removing all items. This also resets batch mode.</span>
<a href="#l40.11"></a><span id="l40.11">      */</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-     clear: function() {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+    clear: function() {</span>
<a href="#l40.14"></a><span id="l40.14">         this.mHash = {};</span>
<a href="#l40.15"></a><span id="l40.15">         this.mArray = [];</span>
<a href="#l40.16"></a><span id="l40.16">         this.mFirstDirty = -1;</span>
<a href="#l40.17"></a><span id="l40.17">         this.mBatch = 0;</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineminus">-     },</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineplus">+    },</span>
<a href="#l40.20"></a><span id="l40.20"> </span>
<a href="#l40.21"></a><span id="l40.21">     /**</span>
<a href="#l40.22"></a><span id="l40.22">      * Add the item to the array</span>
<a href="#l40.23"></a><span id="l40.23">      *</span>
<a href="#l40.24"></a><span id="l40.24">      * @param item          The item to add.</span>
<a href="#l40.25"></a><span id="l40.25">      * @return              The index of the added item.</span>
<a href="#l40.26"></a><span id="l40.26">      */</span>
<a href="#l40.27"></a><span id="l40.27">     addItem: function(item) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -14,17 +14,17 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l41.4"></a><span id="l41.4">  */</span>
<a href="#l41.5"></a><span id="l41.5"> this.EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l41.6"></a><span id="l41.6"> cal.itip = {</span>
<a href="#l41.7"></a><span id="l41.7">     /**</span>
<a href="#l41.8"></a><span id="l41.8">      * Gets the sequence/revision number, either of the passed item or</span>
<a href="#l41.9"></a><span id="l41.9">      * the last received one of an attendee; see</span>
<a href="#l41.10"></a><span id="l41.10">      * &lt;http://tools.ietf.org/html/draft-desruisseaux-caldav-sched-04#section-7.1&gt;.</span>
<a href="#l41.11"></a><span id="l41.11">      */</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-     getSequence: function(item) {</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+    getSequence: function(item) {</span>
<a href="#l41.14"></a><span id="l41.14">         let seq = null;</span>
<a href="#l41.15"></a><span id="l41.15"> </span>
<a href="#l41.16"></a><span id="l41.16">         let wrappedItem = cal.wrapInstance(item, Components.interfaces.calIAttendee);</span>
<a href="#l41.17"></a><span id="l41.17">         if (wrappedItem) {</span>
<a href="#l41.18"></a><span id="l41.18">             seq = wrappedItem.getProperty(&quot;RECEIVED-SEQUENCE&quot;);</span>
<a href="#l41.19"></a><span id="l41.19">         } else if (item) {</span>
<a href="#l41.20"></a><span id="l41.20">             // Unless the below is standardized, we store the last original</span>
<a href="#l41.21"></a><span id="l41.21">             // REQUEST/PUBLISH SEQUENCE in X-MOZ-RECEIVED-SEQUENCE to test against it</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineat">@@ -1094,21 +1094,21 @@ ItipOpListener.prototype = {</span>
<a href="#l41.23"></a><span id="l41.23">  * Add a parameter SCHEDULE-AGENT=CLIENT to the item before it is</span>
<a href="#l41.24"></a><span id="l41.24">  * created or updated so that the providers knows scheduling will</span>
<a href="#l41.25"></a><span id="l41.25">  * be handled by the client.</span>
<a href="#l41.26"></a><span id="l41.26">  *</span>
<a href="#l41.27"></a><span id="l41.27">  * @param item item about to be added or updated</span>
<a href="#l41.28"></a><span id="l41.28">  * @param calendar calendar into which the item is about to be added or updated</span>
<a href="#l41.29"></a><span id="l41.29">  */</span>
<a href="#l41.30"></a><span id="l41.30"> function addScheduleAgentClient(item, calendar) {</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-     if (calendar.getProperty(&quot;capabilities.autoschedule.supported&quot;) === true) {</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineminus">-          if (item.organizer) {</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineminus">-             item.organizer.setProperty(&quot;SCHEDULE-AGENT&quot;, &quot;CLIENT&quot;);</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineminus">-          }</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineminus">-     }</span>
<a href="#l41.36"></a><span id="l41.36" class="difflineplus">+    if (calendar.getProperty(&quot;capabilities.autoschedule.supported&quot;) === true) {</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineplus">+        if (item.organizer) {</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineplus">+            item.organizer.setProperty(&quot;SCHEDULE-AGENT&quot;, &quot;CLIENT&quot;);</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineplus">+        }</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineplus">+    }</span>
<a href="#l41.41"></a><span id="l41.41"> }</span>
<a href="#l41.42"></a><span id="l41.42"> </span>
<a href="#l41.43"></a><span id="l41.43"> var ItipItemFinderFactory = {</span>
<a href="#l41.44"></a><span id="l41.44">     /**  Map to save finder instances for given ids */</span>
<a href="#l41.45"></a><span id="l41.45">     _findMap: {},</span>
<a href="#l41.46"></a><span id="l41.46"> </span>
<a href="#l41.47"></a><span id="l41.47">     /**</span>
<a href="#l41.48"></a><span id="l41.48">      * Create an item finder and track its progress. Be sure to clean up the</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineat">@@ -1305,74 +1305,74 @@ ItipItemFinder.prototype = {</span>
<a href="#l41.50"></a><span id="l41.50">                                         let action = function(opListener) {</span>
<a href="#l41.51"></a><span id="l41.51">                                             return newItem.calendar.modifyItem(newItem, item, opListener);</span>
<a href="#l41.52"></a><span id="l41.52">                                         };</span>
<a href="#l41.53"></a><span id="l41.53">                                         actionMethod = method + &quot;:UPDATE&quot;;</span>
<a href="#l41.54"></a><span id="l41.54">                                         operations.push(action);</span>
<a href="#l41.55"></a><span id="l41.55">                                     }</span>
<a href="#l41.56"></a><span id="l41.56">                                     break;</span>
<a href="#l41.57"></a><span id="l41.57">                                 case &quot;REQUEST&quot;: {</span>
<a href="#l41.58"></a><span id="l41.58" class="difflineminus">-                                        let newItem = updateItem(item, itipItemItem);</span>
<a href="#l41.59"></a><span id="l41.59" class="difflineminus">-                                        let att = cal.getInvitedAttendee(newItem);</span>
<a href="#l41.60"></a><span id="l41.60" class="difflineminus">-                                        if (!att) { // fall back to using configured organizer</span>
<a href="#l41.61"></a><span id="l41.61" class="difflineminus">-                                            att = createOrganizer(newItem.calendar);</span>
<a href="#l41.62"></a><span id="l41.62" class="difflineminus">-                                            if (att) {</span>
<a href="#l41.63"></a><span id="l41.63" class="difflineminus">-                                                att.isOrganizer = false;</span>
<a href="#l41.64"></a><span id="l41.64" class="difflineminus">-                                            }</span>
<a href="#l41.65"></a><span id="l41.65" class="difflineplus">+                                    let newItem = updateItem(item, itipItemItem);</span>
<a href="#l41.66"></a><span id="l41.66" class="difflineplus">+                                    let att = cal.getInvitedAttendee(newItem);</span>
<a href="#l41.67"></a><span id="l41.67" class="difflineplus">+                                    if (!att) { // fall back to using configured organizer</span>
<a href="#l41.68"></a><span id="l41.68" class="difflineplus">+                                        att = createOrganizer(newItem.calendar);</span>
<a href="#l41.69"></a><span id="l41.69" class="difflineplus">+                                        if (att) {</span>
<a href="#l41.70"></a><span id="l41.70" class="difflineplus">+                                            att.isOrganizer = false;</span>
<a href="#l41.71"></a><span id="l41.71">                                         }</span>
<a href="#l41.72"></a><span id="l41.72" class="difflineminus">-                                        if (att) {</span>
<a href="#l41.73"></a><span id="l41.73" class="difflineminus">-                                            let firstFoundItem = this.mFoundItems[0];</span>
<a href="#l41.74"></a><span id="l41.74" class="difflineminus">-                                            // again, fall back to using configured organizer if not found</span>
<a href="#l41.75"></a><span id="l41.75" class="difflineminus">-                                            let foundAttendee = firstFoundItem.getAttendeeById(att.id) || att;</span>
<a href="#l41.76"></a><span id="l41.76" class="difflineplus">+                                    }</span>
<a href="#l41.77"></a><span id="l41.77" class="difflineplus">+                                    if (att) {</span>
<a href="#l41.78"></a><span id="l41.78" class="difflineplus">+                                        let firstFoundItem = this.mFoundItems[0];</span>
<a href="#l41.79"></a><span id="l41.79" class="difflineplus">+                                        // again, fall back to using configured organizer if not found</span>
<a href="#l41.80"></a><span id="l41.80" class="difflineplus">+                                        let foundAttendee = firstFoundItem.getAttendeeById(att.id) || att;</span>
<a href="#l41.81"></a><span id="l41.81"> </span>
<a href="#l41.82"></a><span id="l41.82" class="difflineminus">-                                            // If the the user hasn't responded to the invitation yet and we</span>
<a href="#l41.83"></a><span id="l41.83" class="difflineminus">-                                            // are viewing the current representation of the item, show the</span>
<a href="#l41.84"></a><span id="l41.84" class="difflineminus">-                                            // accept/decline buttons. This means newer events will show the</span>
<a href="#l41.85"></a><span id="l41.85" class="difflineminus">-                                            // &quot;Update&quot; button and older events will show the &quot;already</span>
<a href="#l41.86"></a><span id="l41.86" class="difflineminus">-                                            // processed&quot; text.</span>
<a href="#l41.87"></a><span id="l41.87" class="difflineminus">-                                            if (foundAttendee.participationStatus == &quot;NEEDS-ACTION&quot; &amp;&amp;</span>
<a href="#l41.88"></a><span id="l41.88" class="difflineminus">-                                                (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l41.89"></a><span id="l41.89" class="difflineminus">-                                                 cal.itip.compare(itipItemItem, item) == 0)) {</span>
<a href="#l41.90"></a><span id="l41.90" class="difflineminus">-                                                actionMethod = &quot;REQUEST:NEEDS-ACTION&quot;;</span>
<a href="#l41.91"></a><span id="l41.91" class="difflineminus">-                                                operations.push((opListener, partStat) =&gt; {</span>
<a href="#l41.92"></a><span id="l41.92" class="difflineminus">-                                                    let changedItem = firstFoundItem.clone();</span>
<a href="#l41.93"></a><span id="l41.93" class="difflineminus">-                                                    changedItem.removeAttendee(foundAttendee);</span>
<a href="#l41.94"></a><span id="l41.94" class="difflineminus">-                                                    foundAttendee = foundAttendee.clone();</span>
<a href="#l41.95"></a><span id="l41.95" class="difflineminus">-                                                    if (partStat) {</span>
<a href="#l41.96"></a><span id="l41.96" class="difflineminus">-                                                        foundAttendee.participationStatus = partStat;</span>
<a href="#l41.97"></a><span id="l41.97" class="difflineminus">-                                                    }</span>
<a href="#l41.98"></a><span id="l41.98" class="difflineminus">-                                                    changedItem.addAttendee(foundAttendee);</span>
<a href="#l41.99"></a><span id="l41.99" class="difflineplus">+                                        // If the the user hasn't responded to the invitation yet and we</span>
<a href="#l41.100"></a><span id="l41.100" class="difflineplus">+                                        // are viewing the current representation of the item, show the</span>
<a href="#l41.101"></a><span id="l41.101" class="difflineplus">+                                        // accept/decline buttons. This means newer events will show the</span>
<a href="#l41.102"></a><span id="l41.102" class="difflineplus">+                                        // &quot;Update&quot; button and older events will show the &quot;already</span>
<a href="#l41.103"></a><span id="l41.103" class="difflineplus">+                                        // processed&quot; text.</span>
<a href="#l41.104"></a><span id="l41.104" class="difflineplus">+                                        if (foundAttendee.participationStatus == &quot;NEEDS-ACTION&quot; &amp;&amp;</span>
<a href="#l41.105"></a><span id="l41.105" class="difflineplus">+                                            (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l41.106"></a><span id="l41.106" class="difflineplus">+                                             cal.itip.compare(itipItemItem, item) == 0)) {</span>
<a href="#l41.107"></a><span id="l41.107" class="difflineplus">+                                            actionMethod = &quot;REQUEST:NEEDS-ACTION&quot;;</span>
<a href="#l41.108"></a><span id="l41.108" class="difflineplus">+                                            operations.push((opListener, partStat) =&gt; {</span>
<a href="#l41.109"></a><span id="l41.109" class="difflineplus">+                                                let changedItem = firstFoundItem.clone();</span>
<a href="#l41.110"></a><span id="l41.110" class="difflineplus">+                                                changedItem.removeAttendee(foundAttendee);</span>
<a href="#l41.111"></a><span id="l41.111" class="difflineplus">+                                                foundAttendee = foundAttendee.clone();</span>
<a href="#l41.112"></a><span id="l41.112" class="difflineplus">+                                                if (partStat) {</span>
<a href="#l41.113"></a><span id="l41.113" class="difflineplus">+                                                    foundAttendee.participationStatus = partStat;</span>
<a href="#l41.114"></a><span id="l41.114" class="difflineplus">+                                                }</span>
<a href="#l41.115"></a><span id="l41.115" class="difflineplus">+                                                changedItem.addAttendee(foundAttendee);</span>
<a href="#l41.116"></a><span id="l41.116"> </span>
<a href="#l41.117"></a><span id="l41.117" class="difflineminus">-                                                    return changedItem.calendar.modifyItem(</span>
<a href="#l41.118"></a><span id="l41.118" class="difflineminus">-                                                        changedItem, firstFoundItem, new ItipOpListener(opListener, firstFoundItem));</span>
<a href="#l41.119"></a><span id="l41.119" class="difflineminus">-                                                });</span>
<a href="#l41.120"></a><span id="l41.120" class="difflineminus">-                                            } else if (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l41.121"></a><span id="l41.121" class="difflineminus">-                                                       cal.itip.compare(itipItemItem, item) &gt; 0) {</span>
<a href="#l41.122"></a><span id="l41.122" class="difflineminus">-                                                addScheduleAgentClient(newItem, item.calendar);</span>
<a href="#l41.123"></a><span id="l41.123" class="difflineplus">+                                                return changedItem.calendar.modifyItem(</span>
<a href="#l41.124"></a><span id="l41.124" class="difflineplus">+                                                    changedItem, firstFoundItem, new ItipOpListener(opListener, firstFoundItem));</span>
<a href="#l41.125"></a><span id="l41.125" class="difflineplus">+                                            });</span>
<a href="#l41.126"></a><span id="l41.126" class="difflineplus">+                                        } else if (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l41.127"></a><span id="l41.127" class="difflineplus">+                                                   cal.itip.compare(itipItemItem, item) &gt; 0) {</span>
<a href="#l41.128"></a><span id="l41.128" class="difflineplus">+                                            addScheduleAgentClient(newItem, item.calendar);</span>
<a href="#l41.129"></a><span id="l41.129"> </span>
<a href="#l41.130"></a><span id="l41.130" class="difflineminus">-                                                let isMinorUpdate = (cal.itip.getSequence(newItem) ==</span>
<a href="#l41.131"></a><span id="l41.131" class="difflineminus">-                                                                     cal.itip.getSequence(item));</span>
<a href="#l41.132"></a><span id="l41.132" class="difflineminus">-                                                actionMethod = (isMinorUpdate ? method + &quot;:UPDATE-MINOR&quot;</span>
<a href="#l41.133"></a><span id="l41.133" class="difflineminus">-                                                                              : method + &quot;:UPDATE&quot;);</span>
<a href="#l41.134"></a><span id="l41.134" class="difflineminus">-                                                operations.push((opListener, partStat) =&gt; {</span>
<a href="#l41.135"></a><span id="l41.135" class="difflineminus">-                                                    if (!partStat) { // keep PARTSTAT</span>
<a href="#l41.136"></a><span id="l41.136" class="difflineminus">-                                                        let att_ = cal.getInvitedAttendee(item);</span>
<a href="#l41.137"></a><span id="l41.137" class="difflineminus">-                                                        partStat = (att_ ? att_.participationStatus : &quot;NEEDS-ACTION&quot;);</span>
<a href="#l41.138"></a><span id="l41.138" class="difflineminus">-                                                    }</span>
<a href="#l41.139"></a><span id="l41.139" class="difflineminus">-                                                    newItem.removeAttendee(att);</span>
<a href="#l41.140"></a><span id="l41.140" class="difflineminus">-                                                    att = att.clone();</span>
<a href="#l41.141"></a><span id="l41.141" class="difflineminus">-                                                    att.participationStatus = partStat;</span>
<a href="#l41.142"></a><span id="l41.142" class="difflineminus">-                                                    newItem.addAttendee(att);</span>
<a href="#l41.143"></a><span id="l41.143" class="difflineminus">-                                                    return newItem.calendar.modifyItem(</span>
<a href="#l41.144"></a><span id="l41.144" class="difflineminus">-                                                        newItem, item, new ItipOpListener(opListener, item));</span>
<a href="#l41.145"></a><span id="l41.145" class="difflineminus">-                                                });</span>
<a href="#l41.146"></a><span id="l41.146" class="difflineminus">-                                            }</span>
<a href="#l41.147"></a><span id="l41.147" class="difflineplus">+                                            let isMinorUpdate = cal.itip.getSequence(newItem) ==</span>
<a href="#l41.148"></a><span id="l41.148" class="difflineplus">+                                                                cal.itip.getSequence(item);</span>
<a href="#l41.149"></a><span id="l41.149" class="difflineplus">+                                            actionMethod = (isMinorUpdate ? method + &quot;:UPDATE-MINOR&quot;</span>
<a href="#l41.150"></a><span id="l41.150" class="difflineplus">+                                                                          : method + &quot;:UPDATE&quot;);</span>
<a href="#l41.151"></a><span id="l41.151" class="difflineplus">+                                            operations.push((opListener, partStat) =&gt; {</span>
<a href="#l41.152"></a><span id="l41.152" class="difflineplus">+                                                if (!partStat) { // keep PARTSTAT</span>
<a href="#l41.153"></a><span id="l41.153" class="difflineplus">+                                                    let att_ = cal.getInvitedAttendee(item);</span>
<a href="#l41.154"></a><span id="l41.154" class="difflineplus">+                                                    partStat = att_ ? att_.participationStatus : &quot;NEEDS-ACTION&quot;;</span>
<a href="#l41.155"></a><span id="l41.155" class="difflineplus">+                                                }</span>
<a href="#l41.156"></a><span id="l41.156" class="difflineplus">+                                                newItem.removeAttendee(att);</span>
<a href="#l41.157"></a><span id="l41.157" class="difflineplus">+                                                att = att.clone();</span>
<a href="#l41.158"></a><span id="l41.158" class="difflineplus">+                                                att.participationStatus = partStat;</span>
<a href="#l41.159"></a><span id="l41.159" class="difflineplus">+                                                newItem.addAttendee(att);</span>
<a href="#l41.160"></a><span id="l41.160" class="difflineplus">+                                                return newItem.calendar.modifyItem(</span>
<a href="#l41.161"></a><span id="l41.161" class="difflineplus">+                                                    newItem, item, new ItipOpListener(opListener, item));</span>
<a href="#l41.162"></a><span id="l41.162" class="difflineplus">+                                            });</span>
<a href="#l41.163"></a><span id="l41.163">                                         }</span>
<a href="#l41.164"></a><span id="l41.164">                                     }</span>
<a href="#l41.165"></a><span id="l41.165">                                     break;</span>
<a href="#l41.166"></a><span id="l41.166" class="difflineplus">+                                }</span>
<a href="#l41.167"></a><span id="l41.167">                                 case &quot;REPLY&quot;: {</span>
<a href="#l41.168"></a><span id="l41.168">                                     let attendees = itipItemItem.getAttendees({});</span>
<a href="#l41.169"></a><span id="l41.169">                                     cal.ASSERT(attendees.length == 1, &quot;invalid number of attendees in REPLY!&quot;);</span>
<a href="#l41.170"></a><span id="l41.170">                                     if (attendees.length &gt; 0 &amp;&amp;</span>
<a href="#l41.171"></a><span id="l41.171">                                         (item.calendar.getProperty(&quot;itip.disableRevisionChecks&quot;) ||</span>
<a href="#l41.172"></a><span id="l41.172">                                          (cal.itip.compare(itipItemItem, item.getAttendeeById(attendees[0].id)) &gt; 0))) {</span>
<a href="#l41.173"></a><span id="l41.173">                                         // accepts REPLYs from previously uninvited attendees:</span>
<a href="#l41.174"></a><span id="l41.174">                                         let newItem = item.clone();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -157,20 +157,20 @@ cal.BadCertHandler.prototype = {</span>
<a href="#l42.4"></a><span id="l42.4">         // do this on a timer so that the modal window doesn't block the</span>
<a href="#l42.5"></a><span id="l42.5">         // network request.</span>
<a href="#l42.6"></a><span id="l42.6">         let calWindow = cal.getCalendarWindow();</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8">         let timerCallback = {</span>
<a href="#l42.9"></a><span id="l42.9">             thisProvider: this.thisProvider,</span>
<a href="#l42.10"></a><span id="l42.10">             notify: function(timer) {</span>
<a href="#l42.11"></a><span id="l42.11">                 let params = {</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-                  exceptionAdded: false,</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-                  sslStatus: status,</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineminus">-                  prefetchCert: true,</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineminus">-                  location: targetSite</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+                    exceptionAdded: false,</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+                    sslStatus: status,</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+                    prefetchCert: true,</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+                    location: targetSite</span>
<a href="#l42.20"></a><span id="l42.20">                 };</span>
<a href="#l42.21"></a><span id="l42.21">                 calWindow.openDialog(&quot;chrome://pippki/content/exceptionDialog.xul&quot;,</span>
<a href="#l42.22"></a><span id="l42.22">                                      &quot;&quot;,</span>
<a href="#l42.23"></a><span id="l42.23">                                      &quot;chrome,centerscreen,modal&quot;,</span>
<a href="#l42.24"></a><span id="l42.24">                                      params);</span>
<a href="#l42.25"></a><span id="l42.25">                 if (this.thisProvider.canRefresh &amp;&amp;</span>
<a href="#l42.26"></a><span id="l42.26">                     params.exceptionAdded) {</span>
<a href="#l42.27"></a><span id="l42.27">                     // Refresh the provider if the</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineat">@@ -369,17 +369,17 @@ cal.fromRFC3339 = function(aStr, aTimezo</span>
<a href="#l42.29"></a><span id="l42.29">                     return dateTime;</span>
<a href="#l42.30"></a><span id="l42.30">                 }</span>
<a href="#l42.31"></a><span id="l42.31">             }</span>
<a href="#l42.32"></a><span id="l42.32">             // We are still here: no timezone was found</span>
<a href="#l42.33"></a><span id="l42.33">             dateTime.timezone = cal.UTC();</span>
<a href="#l42.34"></a><span id="l42.34">             if (!dateTime.isDate) {</span>
<a href="#l42.35"></a><span id="l42.35">                 dateTime.hour += (matches[11] == &quot;-&quot; ? -1 : 1) * matches[12];</span>
<a href="#l42.36"></a><span id="l42.36">                 dateTime.minute += (matches[11] == &quot;-&quot; ? -1 : 1) * matches[13];</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineminus">-             }</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineplus">+            }</span>
<a href="#l42.39"></a><span id="l42.39">         }</span>
<a href="#l42.40"></a><span id="l42.40">     }</span>
<a href="#l42.41"></a><span id="l42.41">     return dateTime;</span>
<a href="#l42.42"></a><span id="l42.42"> };</span>
<a href="#l42.43"></a><span id="l42.43"> </span>
<a href="#l42.44"></a><span id="l42.44"> /**</span>
<a href="#l42.45"></a><span id="l42.45">  * toRFC3339</span>
<a href="#l42.46"></a><span id="l42.46">  * Convert a calIDateTime to a RFC3339 compliant Date string</span>
<a href="#l42.47"></a><span id="l42.47" class="difflineat">@@ -447,21 +447,21 @@ cal.ObserverBag = function(iid) {</span>
<a href="#l42.48"></a><span id="l42.48"> };</span>
<a href="#l42.49"></a><span id="l42.49"> cal.ObserverBag.prototype = {</span>
<a href="#l42.50"></a><span id="l42.50">     __proto__: cal.calListenerBag.prototype,</span>
<a href="#l42.51"></a><span id="l42.51"> </span>
<a href="#l42.52"></a><span id="l42.52">     mBatchCount: 0,</span>
<a href="#l42.53"></a><span id="l42.53">     notify: function(func, args) {</span>
<a href="#l42.54"></a><span id="l42.54">         switch (func) {</span>
<a href="#l42.55"></a><span id="l42.55">             case &quot;onStartBatch&quot;:</span>
<a href="#l42.56"></a><span id="l42.56" class="difflineminus">-                 ++this.mBatchCount;</span>
<a href="#l42.57"></a><span id="l42.57" class="difflineminus">-                 break;</span>
<a href="#l42.58"></a><span id="l42.58" class="difflineplus">+                ++this.mBatchCount;</span>
<a href="#l42.59"></a><span id="l42.59" class="difflineplus">+                break;</span>
<a href="#l42.60"></a><span id="l42.60">             case &quot;onEndBatch&quot;:</span>
<a href="#l42.61"></a><span id="l42.61" class="difflineminus">-                 --this.mBatchCount;</span>
<a href="#l42.62"></a><span id="l42.62" class="difflineminus">-                 break;</span>
<a href="#l42.63"></a><span id="l42.63" class="difflineplus">+                --this.mBatchCount;</span>
<a href="#l42.64"></a><span id="l42.64" class="difflineplus">+                break;</span>
<a href="#l42.65"></a><span id="l42.65">         }</span>
<a href="#l42.66"></a><span id="l42.66">         return this.__proto__.__proto__.notify.apply(this, arguments);</span>
<a href="#l42.67"></a><span id="l42.67">     },</span>
<a href="#l42.68"></a><span id="l42.68"> </span>
<a href="#l42.69"></a><span id="l42.69">     add: function(iface) {</span>
<a href="#l42.70"></a><span id="l42.70">         if (this.__proto__.__proto__.add.apply(this, arguments) &amp;&amp; (this.mBatchCount &gt; 0)) {</span>
<a href="#l42.71"></a><span id="l42.71">             // Replay batch notifications, because the onEndBatch notifications are yet to come.</span>
<a href="#l42.72"></a><span id="l42.72">             // We may think about doing the reverse on remove, though I currently see no need:</span>
<a href="#l42.73"></a><span id="l42.73" class="difflineat">@@ -681,17 +681,17 @@ cal.ProviderBase.prototype = {</span>
<a href="#l42.74"></a><span id="l42.74">     },</span>
<a href="#l42.75"></a><span id="l42.75"> </span>
<a href="#l42.76"></a><span id="l42.76">     // nsIVariant getProperty(in AUTF8String aName);</span>
<a href="#l42.77"></a><span id="l42.77">     getProperty: function(aName) {</span>
<a href="#l42.78"></a><span id="l42.78">         switch (aName) {</span>
<a href="#l42.79"></a><span id="l42.79">             case &quot;itip.transport&quot;: // iTIP/iMIP default:</span>
<a href="#l42.80"></a><span id="l42.80">                 return cal.getImipTransport(this);</span>
<a href="#l42.81"></a><span id="l42.81">             case &quot;itip.notify-replies&quot;: // iTIP/iMIP default:</span>
<a href="#l42.82"></a><span id="l42.82" class="difflineminus">-                 return Preferences.get(&quot;calendar.itip.notify-replies&quot;, false);</span>
<a href="#l42.83"></a><span id="l42.83" class="difflineplus">+                return Preferences.get(&quot;calendar.itip.notify-replies&quot;, false);</span>
<a href="#l42.84"></a><span id="l42.84">             // temporary hack to get the uncached calendar instance:</span>
<a href="#l42.85"></a><span id="l42.85">             case &quot;cache.uncachedCalendar&quot;:</span>
<a href="#l42.86"></a><span id="l42.86">                 return this;</span>
<a href="#l42.87"></a><span id="l42.87">         }</span>
<a href="#l42.88"></a><span id="l42.88"> </span>
<a href="#l42.89"></a><span id="l42.89">         let ret = this.mProperties[aName];</span>
<a href="#l42.90"></a><span id="l42.90">         if (ret === undefined) {</span>
<a href="#l42.91"></a><span id="l42.91">             ret = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -143,24 +143,27 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l43.4"></a><span id="l43.4">                                 }</span>
<a href="#l43.5"></a><span id="l43.5">                                 weekdaysString_every += getRString(pluralWeekday(&quot;repeatDetailsDay&quot; + byday[i])) + &quot;, &quot;;</span>
<a href="#l43.6"></a><span id="l43.6">                             } else {</span>
<a href="#l43.7"></a><span id="l43.7">                                 if (day_position(byday[i]) &lt; -1 || day_position(byday[i]) &gt; 5) {</span>
<a href="#l43.8"></a><span id="l43.8">                                     // We support only weekdays with -1 as negative</span>
<a href="#l43.9"></a><span id="l43.9">                                     // position ('THE LAST ...').</span>
<a href="#l43.10"></a><span id="l43.10">                                     return null;</span>
<a href="#l43.11"></a><span id="l43.11">                                 }</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-                                if (byday.some((element) =&gt; {</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-                                                return (day_position(element) == 0 &amp;&amp;</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineminus">-                                                        day_of_week(byday[i]) == day_of_week(element));</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineminus">-                                                })) {</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineplus">+</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineplus">+                                let duplicateWeekday = byday.some((element) =&gt; {</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+                                    return (day_position(element) == 0 &amp;&amp;</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+                                            day_of_week(byday[i]) == day_of_week(element));</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineplus">+                                });</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineplus">+                                if (duplicateWeekday) {</span>
<a href="#l43.22"></a><span id="l43.22">                                     // Prevent to build strings such as for example:</span>
<a href="#l43.23"></a><span id="l43.23">                                     // &quot;every Monday and the second Monday...&quot;.</span>
<a href="#l43.24"></a><span id="l43.24">                                     continue;</span>
<a href="#l43.25"></a><span id="l43.25">                                 }</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineplus">+</span>
<a href="#l43.27"></a><span id="l43.27">                                 let ordinalString = &quot;repeatOrdinal&quot; + day_position(byday[i]);</span>
<a href="#l43.28"></a><span id="l43.28">                                 let dayString = &quot;repeatDetailsDay&quot; + day_of_week(byday[i]);</span>
<a href="#l43.29"></a><span id="l43.29">                                 ordinalString = nounClass(dayString, ordinalString);</span>
<a href="#l43.30"></a><span id="l43.30">                                 ordinalString = getRString(ordinalString);</span>
<a href="#l43.31"></a><span id="l43.31">                                 dayString = getRString(dayString);</span>
<a href="#l43.32"></a><span id="l43.32">                                 let stringOrdinalWeekday = getRString(&quot;ordinalWeekdayOrder&quot;,</span>
<a href="#l43.33"></a><span id="l43.33">                                                                       [ordinalString, dayString]);</span>
<a href="#l43.34"></a><span id="l43.34">                                 weekdaysString_position += stringOrdinalWeekday + &quot;, &quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -459,183 +459,183 @@ var cal = {</span>
<a href="#l44.4"></a><span id="l44.4">         }</span>
<a href="#l44.5"></a><span id="l44.5">         return transp;</span>
<a href="#l44.6"></a><span id="l44.6">     },</span>
<a href="#l44.7"></a><span id="l44.7"> </span>
<a href="#l44.8"></a><span id="l44.8">     // The below functions will move to some different place once the</span>
<a href="#l44.9"></a><span id="l44.9">     // unifinder tress are consolidated.</span>
<a href="#l44.10"></a><span id="l44.10"> </span>
<a href="#l44.11"></a><span id="l44.11">     compareNativeTime: function(a, b) {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-      if (a &lt; b) {</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-        return -1;</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineminus">-      } else if (a &gt; b) {</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineminus">-        return 1;</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineminus">-      } else {</span>
<a href="#l44.17"></a><span id="l44.17" class="difflineminus">-        return 0;</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineminus">-      }</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineplus">+        if (a &lt; b) {</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineplus">+            return -1;</span>
<a href="#l44.21"></a><span id="l44.21" class="difflineplus">+        } else if (a &gt; b) {</span>
<a href="#l44.22"></a><span id="l44.22" class="difflineplus">+            return 1;</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineplus">+        } else {</span>
<a href="#l44.24"></a><span id="l44.24" class="difflineplus">+            return 0;</span>
<a href="#l44.25"></a><span id="l44.25" class="difflineplus">+        }</span>
<a href="#l44.26"></a><span id="l44.26">     },</span>
<a href="#l44.27"></a><span id="l44.27"> </span>
<a href="#l44.28"></a><span id="l44.28">     compareNativeTimeFilledAsc: function(a, b) {</span>
<a href="#l44.29"></a><span id="l44.29" class="difflineminus">-      if (a == b) {</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineminus">-        return 0;</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">-      }</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineplus">+        if (a == b) {</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+            return 0;</span>
<a href="#l44.34"></a><span id="l44.34" class="difflineplus">+        }</span>
<a href="#l44.35"></a><span id="l44.35"> </span>
<a href="#l44.36"></a><span id="l44.36" class="difflineminus">-      // In this filter, a zero time (not set) is always at the end.</span>
<a href="#l44.37"></a><span id="l44.37" class="difflineminus">-      if (a == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.38"></a><span id="l44.38" class="difflineminus">-        return 1;</span>
<a href="#l44.39"></a><span id="l44.39" class="difflineminus">-      }</span>
<a href="#l44.40"></a><span id="l44.40" class="difflineminus">-      if (b == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.41"></a><span id="l44.41" class="difflineminus">-        return -1;</span>
<a href="#l44.42"></a><span id="l44.42" class="difflineminus">-      }</span>
<a href="#l44.43"></a><span id="l44.43" class="difflineplus">+        // In this filter, a zero time (not set) is always at the end.</span>
<a href="#l44.44"></a><span id="l44.44" class="difflineplus">+        if (a == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.45"></a><span id="l44.45" class="difflineplus">+            return 1;</span>
<a href="#l44.46"></a><span id="l44.46" class="difflineplus">+        }</span>
<a href="#l44.47"></a><span id="l44.47" class="difflineplus">+        if (b == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.48"></a><span id="l44.48" class="difflineplus">+            return -1;</span>
<a href="#l44.49"></a><span id="l44.49" class="difflineplus">+        }</span>
<a href="#l44.50"></a><span id="l44.50"> </span>
<a href="#l44.51"></a><span id="l44.51" class="difflineminus">-      return (a &lt; b ? -1 : 1);</span>
<a href="#l44.52"></a><span id="l44.52" class="difflineplus">+        return (a &lt; b ? -1 : 1);</span>
<a href="#l44.53"></a><span id="l44.53">     },</span>
<a href="#l44.54"></a><span id="l44.54"> </span>
<a href="#l44.55"></a><span id="l44.55">     compareNativeTimeFilledDesc: function(a, b) {</span>
<a href="#l44.56"></a><span id="l44.56" class="difflineminus">-      if (a == b) {</span>
<a href="#l44.57"></a><span id="l44.57" class="difflineminus">-        return 0;</span>
<a href="#l44.58"></a><span id="l44.58" class="difflineminus">-      }</span>
<a href="#l44.59"></a><span id="l44.59" class="difflineplus">+        if (a == b) {</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineplus">+            return 0;</span>
<a href="#l44.61"></a><span id="l44.61" class="difflineplus">+        }</span>
<a href="#l44.62"></a><span id="l44.62"> </span>
<a href="#l44.63"></a><span id="l44.63" class="difflineminus">-      // In this filter, a zero time (not set) is always at the end.</span>
<a href="#l44.64"></a><span id="l44.64" class="difflineminus">-      if (a == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.65"></a><span id="l44.65" class="difflineminus">-        return 1;</span>
<a href="#l44.66"></a><span id="l44.66" class="difflineminus">-      }</span>
<a href="#l44.67"></a><span id="l44.67" class="difflineminus">-      if (b == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.68"></a><span id="l44.68" class="difflineminus">-        return -1;</span>
<a href="#l44.69"></a><span id="l44.69" class="difflineminus">-      }</span>
<a href="#l44.70"></a><span id="l44.70" class="difflineplus">+        // In this filter, a zero time (not set) is always at the end.</span>
<a href="#l44.71"></a><span id="l44.71" class="difflineplus">+        if (a == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.72"></a><span id="l44.72" class="difflineplus">+            return 1;</span>
<a href="#l44.73"></a><span id="l44.73" class="difflineplus">+        }</span>
<a href="#l44.74"></a><span id="l44.74" class="difflineplus">+        if (b == -62168601600000000) { // value for (0000/00/00 00:00:00)</span>
<a href="#l44.75"></a><span id="l44.75" class="difflineplus">+            return -1;</span>
<a href="#l44.76"></a><span id="l44.76" class="difflineplus">+        }</span>
<a href="#l44.77"></a><span id="l44.77"> </span>
<a href="#l44.78"></a><span id="l44.78" class="difflineminus">-      return (a &lt; b ? 1 : -1);</span>
<a href="#l44.79"></a><span id="l44.79" class="difflineplus">+        return (a &lt; b ? 1 : -1);</span>
<a href="#l44.80"></a><span id="l44.80">     },</span>
<a href="#l44.81"></a><span id="l44.81"> </span>
<a href="#l44.82"></a><span id="l44.82">     compareNumber: function(a, b) {</span>
<a href="#l44.83"></a><span id="l44.83" class="difflineminus">-      a = Number(a);</span>
<a href="#l44.84"></a><span id="l44.84" class="difflineminus">-      b = Number(b);</span>
<a href="#l44.85"></a><span id="l44.85" class="difflineminus">-      if (a &lt; b) {</span>
<a href="#l44.86"></a><span id="l44.86" class="difflineminus">-        return -1;</span>
<a href="#l44.87"></a><span id="l44.87" class="difflineminus">-      } else if (a &gt; b) {</span>
<a href="#l44.88"></a><span id="l44.88" class="difflineminus">-        return 1;</span>
<a href="#l44.89"></a><span id="l44.89" class="difflineminus">-      } else {</span>
<a href="#l44.90"></a><span id="l44.90" class="difflineminus">-        return 0;</span>
<a href="#l44.91"></a><span id="l44.91" class="difflineminus">-      }</span>
<a href="#l44.92"></a><span id="l44.92" class="difflineplus">+        a = Number(a);</span>
<a href="#l44.93"></a><span id="l44.93" class="difflineplus">+        b = Number(b);</span>
<a href="#l44.94"></a><span id="l44.94" class="difflineplus">+        if (a &lt; b) {</span>
<a href="#l44.95"></a><span id="l44.95" class="difflineplus">+            return -1;</span>
<a href="#l44.96"></a><span id="l44.96" class="difflineplus">+        } else if (a &gt; b) {</span>
<a href="#l44.97"></a><span id="l44.97" class="difflineplus">+            return 1;</span>
<a href="#l44.98"></a><span id="l44.98" class="difflineplus">+        } else {</span>
<a href="#l44.99"></a><span id="l44.99" class="difflineplus">+            return 0;</span>
<a href="#l44.100"></a><span id="l44.100" class="difflineplus">+        }</span>
<a href="#l44.101"></a><span id="l44.101">     },</span>
<a href="#l44.102"></a><span id="l44.102"> </span>
<a href="#l44.103"></a><span id="l44.103">     sortEntryComparer: function(sortType, modifier) {</span>
<a href="#l44.104"></a><span id="l44.104" class="difflineminus">-      switch (sortType) {</span>
<a href="#l44.105"></a><span id="l44.105" class="difflineminus">-        case &quot;number&quot;:</span>
<a href="#l44.106"></a><span id="l44.106" class="difflineminus">-          return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.107"></a><span id="l44.107" class="difflineminus">-            let nsA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.108"></a><span id="l44.108" class="difflineminus">-            let nsB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.109"></a><span id="l44.109" class="difflineminus">-            return cal.compareNumber(nsA, nsB) * modifier;</span>
<a href="#l44.110"></a><span id="l44.110" class="difflineminus">-          };</span>
<a href="#l44.111"></a><span id="l44.111" class="difflineminus">-        case &quot;date&quot;:</span>
<a href="#l44.112"></a><span id="l44.112" class="difflineminus">-          return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.113"></a><span id="l44.113" class="difflineminus">-            let nsA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.114"></a><span id="l44.114" class="difflineminus">-            let nsB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.115"></a><span id="l44.115" class="difflineminus">-            return cal.compareNativeTime(nsA, nsB) * modifier;</span>
<a href="#l44.116"></a><span id="l44.116" class="difflineminus">-          };</span>
<a href="#l44.117"></a><span id="l44.117" class="difflineminus">-        case &quot;date_filled&quot;:</span>
<a href="#l44.118"></a><span id="l44.118" class="difflineminus">-          return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.119"></a><span id="l44.119" class="difflineminus">-            let nsA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.120"></a><span id="l44.120" class="difflineminus">-            let nsB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.121"></a><span id="l44.121" class="difflineminus">-            if (modifier == 1) {</span>
<a href="#l44.122"></a><span id="l44.122" class="difflineminus">-              return cal.compareNativeTimeFilledAsc(nsA, nsB);</span>
<a href="#l44.123"></a><span id="l44.123" class="difflineminus">-            } else {</span>
<a href="#l44.124"></a><span id="l44.124" class="difflineminus">-              return cal.compareNativeTimeFilledDesc(nsA, nsB);</span>
<a href="#l44.125"></a><span id="l44.125" class="difflineminus">-            }</span>
<a href="#l44.126"></a><span id="l44.126" class="difflineminus">-          };</span>
<a href="#l44.127"></a><span id="l44.127" class="difflineminus">-        case &quot;string&quot;:</span>
<a href="#l44.128"></a><span id="l44.128" class="difflineminus">-          return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.129"></a><span id="l44.129" class="difflineminus">-            let seA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.130"></a><span id="l44.130" class="difflineminus">-            let seB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.131"></a><span id="l44.131" class="difflineminus">-            if (seA.length == 0 || seB.length == 0) {</span>
<a href="#l44.132"></a><span id="l44.132" class="difflineminus">-              // sort empty values to end (so when users first sort by a</span>
<a href="#l44.133"></a><span id="l44.133" class="difflineminus">-              // column, they can see and find the desired values in that</span>
<a href="#l44.134"></a><span id="l44.134" class="difflineminus">-              // column without scrolling past all the empty values).</span>
<a href="#l44.135"></a><span id="l44.135" class="difflineminus">-              return -(seA.length - seB.length) * modifier;</span>
<a href="#l44.136"></a><span id="l44.136" class="difflineminus">-            }</span>
<a href="#l44.137"></a><span id="l44.137" class="difflineminus">-            let collator = cal.createLocaleCollator();</span>
<a href="#l44.138"></a><span id="l44.138" class="difflineminus">-            let comparison = collator.compareString(0, seA, seB);</span>
<a href="#l44.139"></a><span id="l44.139" class="difflineminus">-            return comparison * modifier;</span>
<a href="#l44.140"></a><span id="l44.140" class="difflineminus">-          };</span>
<a href="#l44.141"></a><span id="l44.141" class="difflineminus">-        default:</span>
<a href="#l44.142"></a><span id="l44.142" class="difflineminus">-          return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.143"></a><span id="l44.143" class="difflineminus">-            return 0;</span>
<a href="#l44.144"></a><span id="l44.144" class="difflineminus">-          };</span>
<a href="#l44.145"></a><span id="l44.145" class="difflineminus">-      }</span>
<a href="#l44.146"></a><span id="l44.146" class="difflineplus">+        switch (sortType) {</span>
<a href="#l44.147"></a><span id="l44.147" class="difflineplus">+            case &quot;number&quot;:</span>
<a href="#l44.148"></a><span id="l44.148" class="difflineplus">+                return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.149"></a><span id="l44.149" class="difflineplus">+                    let nsA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.150"></a><span id="l44.150" class="difflineplus">+                    let nsB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.151"></a><span id="l44.151" class="difflineplus">+                    return cal.compareNumber(nsA, nsB) * modifier;</span>
<a href="#l44.152"></a><span id="l44.152" class="difflineplus">+                };</span>
<a href="#l44.153"></a><span id="l44.153" class="difflineplus">+            case &quot;date&quot;:</span>
<a href="#l44.154"></a><span id="l44.154" class="difflineplus">+                return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.155"></a><span id="l44.155" class="difflineplus">+                    let nsA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.156"></a><span id="l44.156" class="difflineplus">+                    let nsB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.157"></a><span id="l44.157" class="difflineplus">+                    return cal.compareNativeTime(nsA, nsB) * modifier;</span>
<a href="#l44.158"></a><span id="l44.158" class="difflineplus">+                };</span>
<a href="#l44.159"></a><span id="l44.159" class="difflineplus">+            case &quot;date_filled&quot;:</span>
<a href="#l44.160"></a><span id="l44.160" class="difflineplus">+                return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.161"></a><span id="l44.161" class="difflineplus">+                    let nsA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.162"></a><span id="l44.162" class="difflineplus">+                    let nsB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.163"></a><span id="l44.163" class="difflineplus">+                    if (modifier == 1) {</span>
<a href="#l44.164"></a><span id="l44.164" class="difflineplus">+                        return cal.compareNativeTimeFilledAsc(nsA, nsB);</span>
<a href="#l44.165"></a><span id="l44.165" class="difflineplus">+                    } else {</span>
<a href="#l44.166"></a><span id="l44.166" class="difflineplus">+                        return cal.compareNativeTimeFilledDesc(nsA, nsB);</span>
<a href="#l44.167"></a><span id="l44.167" class="difflineplus">+                    }</span>
<a href="#l44.168"></a><span id="l44.168" class="difflineplus">+                };</span>
<a href="#l44.169"></a><span id="l44.169" class="difflineplus">+            case &quot;string&quot;:</span>
<a href="#l44.170"></a><span id="l44.170" class="difflineplus">+                return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.171"></a><span id="l44.171" class="difflineplus">+                    let seA = cal.sortEntryKey(sortEntryA);</span>
<a href="#l44.172"></a><span id="l44.172" class="difflineplus">+                    let seB = cal.sortEntryKey(sortEntryB);</span>
<a href="#l44.173"></a><span id="l44.173" class="difflineplus">+                    if (seA.length == 0 || seB.length == 0) {</span>
<a href="#l44.174"></a><span id="l44.174" class="difflineplus">+                        // sort empty values to end (so when users first sort by a</span>
<a href="#l44.175"></a><span id="l44.175" class="difflineplus">+                        // column, they can see and find the desired values in that</span>
<a href="#l44.176"></a><span id="l44.176" class="difflineplus">+                        // column without scrolling past all the empty values).</span>
<a href="#l44.177"></a><span id="l44.177" class="difflineplus">+                        return -(seA.length - seB.length) * modifier;</span>
<a href="#l44.178"></a><span id="l44.178" class="difflineplus">+                    }</span>
<a href="#l44.179"></a><span id="l44.179" class="difflineplus">+                    let collator = cal.createLocaleCollator();</span>
<a href="#l44.180"></a><span id="l44.180" class="difflineplus">+                    let comparison = collator.compareString(0, seA, seB);</span>
<a href="#l44.181"></a><span id="l44.181" class="difflineplus">+                    return comparison * modifier;</span>
<a href="#l44.182"></a><span id="l44.182" class="difflineplus">+                };</span>
<a href="#l44.183"></a><span id="l44.183" class="difflineplus">+            default:</span>
<a href="#l44.184"></a><span id="l44.184" class="difflineplus">+                return function(sortEntryA, sortEntryB) {</span>
<a href="#l44.185"></a><span id="l44.185" class="difflineplus">+                    return 0;</span>
<a href="#l44.186"></a><span id="l44.186" class="difflineplus">+                };</span>
<a href="#l44.187"></a><span id="l44.187" class="difflineplus">+        }</span>
<a href="#l44.188"></a><span id="l44.188">     },</span>
<a href="#l44.189"></a><span id="l44.189"> </span>
<a href="#l44.190"></a><span id="l44.190">     getItemSortKey: function(aItem, aKey, aStartTime) {</span>
<a href="#l44.191"></a><span id="l44.191" class="difflineminus">-      switch (aKey) {</span>
<a href="#l44.192"></a><span id="l44.192" class="difflineminus">-        case &quot;priority&quot;:</span>
<a href="#l44.193"></a><span id="l44.193" class="difflineminus">-          return aItem.priority || 5;</span>
<a href="#l44.194"></a><span id="l44.194" class="difflineplus">+        switch (aKey) {</span>
<a href="#l44.195"></a><span id="l44.195" class="difflineplus">+            case &quot;priority&quot;:</span>
<a href="#l44.196"></a><span id="l44.196" class="difflineplus">+                return aItem.priority || 5;</span>
<a href="#l44.197"></a><span id="l44.197"> </span>
<a href="#l44.198"></a><span id="l44.198" class="difflineminus">-        case &quot;title&quot;:</span>
<a href="#l44.199"></a><span id="l44.199" class="difflineminus">-          return aItem.title || &quot;&quot;;</span>
<a href="#l44.200"></a><span id="l44.200" class="difflineplus">+            case &quot;title&quot;:</span>
<a href="#l44.201"></a><span id="l44.201" class="difflineplus">+                return aItem.title || &quot;&quot;;</span>
<a href="#l44.202"></a><span id="l44.202"> </span>
<a href="#l44.203"></a><span id="l44.203" class="difflineminus">-        case &quot;entryDate&quot;:</span>
<a href="#l44.204"></a><span id="l44.204" class="difflineminus">-            return cal.nativeTime(aItem.entryDate);</span>
<a href="#l44.205"></a><span id="l44.205" class="difflineplus">+            case &quot;entryDate&quot;:</span>
<a href="#l44.206"></a><span id="l44.206" class="difflineplus">+                return cal.nativeTime(aItem.entryDate);</span>
<a href="#l44.207"></a><span id="l44.207"> </span>
<a href="#l44.208"></a><span id="l44.208" class="difflineminus">-        case &quot;startDate&quot;:</span>
<a href="#l44.209"></a><span id="l44.209" class="difflineminus">-            return cal.nativeTime(aItem.startDate);</span>
<a href="#l44.210"></a><span id="l44.210" class="difflineplus">+            case &quot;startDate&quot;:</span>
<a href="#l44.211"></a><span id="l44.211" class="difflineplus">+                return cal.nativeTime(aItem.startDate);</span>
<a href="#l44.212"></a><span id="l44.212"> </span>
<a href="#l44.213"></a><span id="l44.213" class="difflineminus">-        case &quot;dueDate&quot;:</span>
<a href="#l44.214"></a><span id="l44.214" class="difflineminus">-          return cal.nativeTime(aItem.dueDate);</span>
<a href="#l44.215"></a><span id="l44.215" class="difflineplus">+            case &quot;dueDate&quot;:</span>
<a href="#l44.216"></a><span id="l44.216" class="difflineplus">+                return cal.nativeTime(aItem.dueDate);</span>
<a href="#l44.217"></a><span id="l44.217"> </span>
<a href="#l44.218"></a><span id="l44.218" class="difflineminus">-        case &quot;endDate&quot;:</span>
<a href="#l44.219"></a><span id="l44.219" class="difflineminus">-          return cal.nativeTime(aItem.endDate);</span>
<a href="#l44.220"></a><span id="l44.220" class="difflineplus">+            case &quot;endDate&quot;:</span>
<a href="#l44.221"></a><span id="l44.221" class="difflineplus">+                return cal.nativeTime(aItem.endDate);</span>
<a href="#l44.222"></a><span id="l44.222"> </span>
<a href="#l44.223"></a><span id="l44.223" class="difflineminus">-        case &quot;completedDate&quot;:</span>
<a href="#l44.224"></a><span id="l44.224" class="difflineminus">-          return cal.nativeTime(aItem.completedDate);</span>
<a href="#l44.225"></a><span id="l44.225" class="difflineplus">+            case &quot;completedDate&quot;:</span>
<a href="#l44.226"></a><span id="l44.226" class="difflineplus">+                return cal.nativeTime(aItem.completedDate);</span>
<a href="#l44.227"></a><span id="l44.227"> </span>
<a href="#l44.228"></a><span id="l44.228" class="difflineminus">-        case &quot;percentComplete&quot;:</span>
<a href="#l44.229"></a><span id="l44.229" class="difflineminus">-          return aItem.percentComplete;</span>
<a href="#l44.230"></a><span id="l44.230" class="difflineplus">+            case &quot;percentComplete&quot;:</span>
<a href="#l44.231"></a><span id="l44.231" class="difflineplus">+                return aItem.percentComplete;</span>
<a href="#l44.232"></a><span id="l44.232"> </span>
<a href="#l44.233"></a><span id="l44.233" class="difflineminus">-        case &quot;categories&quot;:</span>
<a href="#l44.234"></a><span id="l44.234" class="difflineminus">-          return aItem.getCategories({}).join(&quot;, &quot;);</span>
<a href="#l44.235"></a><span id="l44.235" class="difflineplus">+            case &quot;categories&quot;:</span>
<a href="#l44.236"></a><span id="l44.236" class="difflineplus">+                return aItem.getCategories({}).join(&quot;, &quot;);</span>
<a href="#l44.237"></a><span id="l44.237"> </span>
<a href="#l44.238"></a><span id="l44.238" class="difflineminus">-        case &quot;location&quot;:</span>
<a href="#l44.239"></a><span id="l44.239" class="difflineminus">-          return aItem.getProperty(&quot;LOCATION&quot;) || &quot;&quot;;</span>
<a href="#l44.240"></a><span id="l44.240" class="difflineplus">+            case &quot;location&quot;:</span>
<a href="#l44.241"></a><span id="l44.241" class="difflineplus">+                return aItem.getProperty(&quot;LOCATION&quot;) || &quot;&quot;;</span>
<a href="#l44.242"></a><span id="l44.242"> </span>
<a href="#l44.243"></a><span id="l44.243" class="difflineminus">-        case &quot;status&quot;:</span>
<a href="#l44.244"></a><span id="l44.244" class="difflineminus">-          if (cal.isToDo(aItem)) {</span>
<a href="#l44.245"></a><span id="l44.245" class="difflineminus">-            return [&quot;NEEDS-ACTION&quot;, &quot;IN-PROCESS&quot;, &quot;COMPLETED&quot;, &quot;CANCELLED&quot;].indexOf(aItem.status);</span>
<a href="#l44.246"></a><span id="l44.246" class="difflineminus">-          } else {</span>
<a href="#l44.247"></a><span id="l44.247" class="difflineminus">-            return [&quot;TENTATIVE&quot;, &quot;CONFIRMED&quot;, &quot;CANCELLED&quot;].indexOf(aItem.status);</span>
<a href="#l44.248"></a><span id="l44.248" class="difflineminus">-          }</span>
<a href="#l44.249"></a><span id="l44.249" class="difflineminus">-        case &quot;calendar&quot;:</span>
<a href="#l44.250"></a><span id="l44.250" class="difflineminus">-          return aItem.calendar.name || &quot;&quot;;</span>
<a href="#l44.251"></a><span id="l44.251" class="difflineplus">+            case &quot;status&quot;:</span>
<a href="#l44.252"></a><span id="l44.252" class="difflineplus">+                if (cal.isToDo(aItem)) {</span>
<a href="#l44.253"></a><span id="l44.253" class="difflineplus">+                    return [&quot;NEEDS-ACTION&quot;, &quot;IN-PROCESS&quot;, &quot;COMPLETED&quot;, &quot;CANCELLED&quot;].indexOf(aItem.status);</span>
<a href="#l44.254"></a><span id="l44.254" class="difflineplus">+                } else {</span>
<a href="#l44.255"></a><span id="l44.255" class="difflineplus">+                    return [&quot;TENTATIVE&quot;, &quot;CONFIRMED&quot;, &quot;CANCELLED&quot;].indexOf(aItem.status);</span>
<a href="#l44.256"></a><span id="l44.256" class="difflineplus">+                }</span>
<a href="#l44.257"></a><span id="l44.257" class="difflineplus">+            case &quot;calendar&quot;:</span>
<a href="#l44.258"></a><span id="l44.258" class="difflineplus">+                return aItem.calendar.name || &quot;&quot;;</span>
<a href="#l44.259"></a><span id="l44.259"> </span>
<a href="#l44.260"></a><span id="l44.260" class="difflineminus">-        default:</span>
<a href="#l44.261"></a><span id="l44.261" class="difflineminus">-          return null;</span>
<a href="#l44.262"></a><span id="l44.262" class="difflineminus">-      }</span>
<a href="#l44.263"></a><span id="l44.263" class="difflineplus">+            default:</span>
<a href="#l44.264"></a><span id="l44.264" class="difflineplus">+                return null;</span>
<a href="#l44.265"></a><span id="l44.265" class="difflineplus">+        }</span>
<a href="#l44.266"></a><span id="l44.266">     },</span>
<a href="#l44.267"></a><span id="l44.267"> </span>
<a href="#l44.268"></a><span id="l44.268">     getSortTypeForSortKey: function(aSortKey) {</span>
<a href="#l44.269"></a><span id="l44.269" class="difflineminus">-      switch (aSortKey) {</span>
<a href="#l44.270"></a><span id="l44.270" class="difflineminus">-        case &quot;title&quot;:</span>
<a href="#l44.271"></a><span id="l44.271" class="difflineminus">-        case &quot;categories&quot;:</span>
<a href="#l44.272"></a><span id="l44.272" class="difflineminus">-        case &quot;location&quot;:</span>
<a href="#l44.273"></a><span id="l44.273" class="difflineminus">-        case &quot;calendar&quot;:</span>
<a href="#l44.274"></a><span id="l44.274" class="difflineminus">-          return &quot;string&quot;;</span>
<a href="#l44.275"></a><span id="l44.275" class="difflineplus">+        switch (aSortKey) {</span>
<a href="#l44.276"></a><span id="l44.276" class="difflineplus">+            case &quot;title&quot;:</span>
<a href="#l44.277"></a><span id="l44.277" class="difflineplus">+            case &quot;categories&quot;:</span>
<a href="#l44.278"></a><span id="l44.278" class="difflineplus">+            case &quot;location&quot;:</span>
<a href="#l44.279"></a><span id="l44.279" class="difflineplus">+            case &quot;calendar&quot;:</span>
<a href="#l44.280"></a><span id="l44.280" class="difflineplus">+                return &quot;string&quot;;</span>
<a href="#l44.281"></a><span id="l44.281"> </span>
<a href="#l44.282"></a><span id="l44.282" class="difflineminus">-        // All dates use &quot;date_filled&quot;</span>
<a href="#l44.283"></a><span id="l44.283" class="difflineminus">-        case &quot;completedDate&quot;:</span>
<a href="#l44.284"></a><span id="l44.284" class="difflineminus">-        case &quot;startDate&quot;:</span>
<a href="#l44.285"></a><span id="l44.285" class="difflineminus">-        case &quot;endDate&quot;:</span>
<a href="#l44.286"></a><span id="l44.286" class="difflineminus">-        case &quot;dueDate&quot;:</span>
<a href="#l44.287"></a><span id="l44.287" class="difflineminus">-        case &quot;entryDate&quot;:</span>
<a href="#l44.288"></a><span id="l44.288" class="difflineminus">-          return &quot;date_filled&quot;;</span>
<a href="#l44.289"></a><span id="l44.289" class="difflineplus">+            // All dates use &quot;date_filled&quot;</span>
<a href="#l44.290"></a><span id="l44.290" class="difflineplus">+            case &quot;completedDate&quot;:</span>
<a href="#l44.291"></a><span id="l44.291" class="difflineplus">+            case &quot;startDate&quot;:</span>
<a href="#l44.292"></a><span id="l44.292" class="difflineplus">+            case &quot;endDate&quot;:</span>
<a href="#l44.293"></a><span id="l44.293" class="difflineplus">+            case &quot;dueDate&quot;:</span>
<a href="#l44.294"></a><span id="l44.294" class="difflineplus">+            case &quot;entryDate&quot;:</span>
<a href="#l44.295"></a><span id="l44.295" class="difflineplus">+                return &quot;date_filled&quot;;</span>
<a href="#l44.296"></a><span id="l44.296"> </span>
<a href="#l44.297"></a><span id="l44.297" class="difflineminus">-        case &quot;priority&quot;:</span>
<a href="#l44.298"></a><span id="l44.298" class="difflineminus">-        case &quot;percentComplete&quot;:</span>
<a href="#l44.299"></a><span id="l44.299" class="difflineminus">-        case &quot;status&quot;:</span>
<a href="#l44.300"></a><span id="l44.300" class="difflineminus">-          return &quot;number&quot;;</span>
<a href="#l44.301"></a><span id="l44.301" class="difflineminus">-        default:</span>
<a href="#l44.302"></a><span id="l44.302" class="difflineminus">-          return &quot;unknown&quot;;</span>
<a href="#l44.303"></a><span id="l44.303" class="difflineminus">-      }</span>
<a href="#l44.304"></a><span id="l44.304" class="difflineplus">+            case &quot;priority&quot;:</span>
<a href="#l44.305"></a><span id="l44.305" class="difflineplus">+            case &quot;percentComplete&quot;:</span>
<a href="#l44.306"></a><span id="l44.306" class="difflineplus">+            case &quot;status&quot;:</span>
<a href="#l44.307"></a><span id="l44.307" class="difflineplus">+                return &quot;number&quot;;</span>
<a href="#l44.308"></a><span id="l44.308" class="difflineplus">+            default:</span>
<a href="#l44.309"></a><span id="l44.309" class="difflineplus">+                return &quot;unknown&quot;;</span>
<a href="#l44.310"></a><span id="l44.310" class="difflineplus">+        }</span>
<a href="#l44.311"></a><span id="l44.311">     },</span>
<a href="#l44.312"></a><span id="l44.312"> </span>
<a href="#l44.313"></a><span id="l44.313">     nativeTimeOrNow: function(calDateTime, sortStartedTime) {</span>
<a href="#l44.314"></a><span id="l44.314">         // Treat null/0 as 'now' when sort started, so incomplete tasks stay current.</span>
<a href="#l44.315"></a><span id="l44.315">         // Time is computed once per sort (just before sort) so sort is stable.</span>
<a href="#l44.316"></a><span id="l44.316">         if (calDateTime == null) {</span>
<a href="#l44.317"></a><span id="l44.317">             return sortStartedTime.nativeTime;</span>
<a href="#l44.318"></a><span id="l44.318">         }</span>
<a href="#l44.319"></a><span id="l44.319" class="difflineat">@@ -709,17 +709,17 @@ var cal = {</span>
<a href="#l44.320"></a><span id="l44.320">     sortEntryKey: function(sortEntry) {</span>
<a href="#l44.321"></a><span id="l44.321">         return sortEntry.mSortKey;</span>
<a href="#l44.322"></a><span id="l44.322">     },</span>
<a href="#l44.323"></a><span id="l44.323"> </span>
<a href="#l44.324"></a><span id="l44.324">     createLocaleCollator: function() {</span>
<a href="#l44.325"></a><span id="l44.325">         return Components.classes[&quot;@mozilla.org/intl/collation-factory;1&quot;]</span>
<a href="#l44.326"></a><span id="l44.326">                          .getService(Components.interfaces.nsICollationFactory)</span>
<a href="#l44.327"></a><span id="l44.327">                          .CreateCollation(Services.locale.getApplicationLocale());</span>
<a href="#l44.328"></a><span id="l44.328" class="difflineminus">-     },</span>
<a href="#l44.329"></a><span id="l44.329" class="difflineplus">+    },</span>
<a href="#l44.330"></a><span id="l44.330"> </span>
<a href="#l44.331"></a><span id="l44.331">     /**</span>
<a href="#l44.332"></a><span id="l44.332">      * Sort an array of strings according to the current locale.</span>
<a href="#l44.333"></a><span id="l44.333">      * Modifies aStringArray, returning it sorted.</span>
<a href="#l44.334"></a><span id="l44.334">      */</span>
<a href="#l44.335"></a><span id="l44.335">     sortArrayByLocaleCollator: function(aStringArray) {</span>
<a href="#l44.336"></a><span id="l44.336">         let localeCollator = cal.createLocaleCollator();</span>
<a href="#l44.337"></a><span id="l44.337">         function compare(a, b) { return localeCollator.compareString(0, a, b); }</span>
<a href="#l44.338"></a><span id="l44.338" class="difflineat">@@ -785,24 +785,24 @@ var cal = {</span>
<a href="#l44.339"></a><span id="l44.339">      * @return              The modified item</span>
<a href="#l44.340"></a><span id="l44.340">      */</span>
<a href="#l44.341"></a><span id="l44.341">     setItemToAllDay: function(aItem, aIsDate) {</span>
<a href="#l44.342"></a><span id="l44.342">         let start = aItem[calGetStartDateProp(aItem)];</span>
<a href="#l44.343"></a><span id="l44.343">         let end = aItem[calGetEndDateProp(aItem)];</span>
<a href="#l44.344"></a><span id="l44.344">         if (start || end) {</span>
<a href="#l44.345"></a><span id="l44.345">             let item = aItem.clone();</span>
<a href="#l44.346"></a><span id="l44.346">             if (start &amp;&amp; (start.isDate != aIsDate)) {</span>
<a href="#l44.347"></a><span id="l44.347" class="difflineminus">-               start = start.clone();</span>
<a href="#l44.348"></a><span id="l44.348" class="difflineminus">-               start.isDate = aIsDate;</span>
<a href="#l44.349"></a><span id="l44.349" class="difflineminus">-               item[calGetStartDateProp(item)] = start;</span>
<a href="#l44.350"></a><span id="l44.350" class="difflineplus">+                start = start.clone();</span>
<a href="#l44.351"></a><span id="l44.351" class="difflineplus">+                start.isDate = aIsDate;</span>
<a href="#l44.352"></a><span id="l44.352" class="difflineplus">+                item[calGetStartDateProp(item)] = start;</span>
<a href="#l44.353"></a><span id="l44.353">             }</span>
<a href="#l44.354"></a><span id="l44.354">             if (end &amp;&amp; (end.isDate != aIsDate)) {</span>
<a href="#l44.355"></a><span id="l44.355" class="difflineminus">-               end = end.clone();</span>
<a href="#l44.356"></a><span id="l44.356" class="difflineminus">-               end.isDate = aIsDate;</span>
<a href="#l44.357"></a><span id="l44.357" class="difflineminus">-               item[calGetEndDateProp(item)] = end;</span>
<a href="#l44.358"></a><span id="l44.358" class="difflineplus">+                end = end.clone();</span>
<a href="#l44.359"></a><span id="l44.359" class="difflineplus">+                end.isDate = aIsDate;</span>
<a href="#l44.360"></a><span id="l44.360" class="difflineplus">+                item[calGetEndDateProp(item)] = end;</span>
<a href="#l44.361"></a><span id="l44.361">             }</span>
<a href="#l44.362"></a><span id="l44.362">             return item;</span>
<a href="#l44.363"></a><span id="l44.363">         } else {</span>
<a href="#l44.364"></a><span id="l44.364">             return aItem;</span>
<a href="#l44.365"></a><span id="l44.365">         }</span>
<a href="#l44.366"></a><span id="l44.366">     },</span>
<a href="#l44.367"></a><span id="l44.367"> </span>
<a href="#l44.368"></a><span id="l44.368">     /**</span>
<a href="#l44.369"></a><span id="l44.369" class="difflineat">@@ -836,17 +836,17 @@ var cal = {</span>
<a href="#l44.370"></a><span id="l44.370">      * @param aAttribute    The value of the attribute</span>
<a href="#l44.371"></a><span id="l44.371">      */</span>
<a href="#l44.372"></a><span id="l44.372">     removeChildElementsByAttribute: function(aParentNode, aAttribute, aValue) {</span>
<a href="#l44.373"></a><span id="l44.373">         let childNode = aParentNode.lastChild;</span>
<a href="#l44.374"></a><span id="l44.374">         while (childNode) {</span>
<a href="#l44.375"></a><span id="l44.375">             let prevChildNode = childNode.previousSibling;</span>
<a href="#l44.376"></a><span id="l44.376">             if (!aAttribute || aAttribute === undefined) {</span>
<a href="#l44.377"></a><span id="l44.377">                 childNode.remove();</span>
<a href="#l44.378"></a><span id="l44.378" class="difflineminus">-             } else if (!aValue || aValue === undefined) {</span>
<a href="#l44.379"></a><span id="l44.379" class="difflineplus">+            } else if (!aValue || aValue === undefined) {</span>
<a href="#l44.380"></a><span id="l44.380">                 childNode.remove();</span>
<a href="#l44.381"></a><span id="l44.381">             } else if (childNode &amp;&amp; childNode.hasAttribute(aAttribute) &amp;&amp;</span>
<a href="#l44.382"></a><span id="l44.382">                        childNode.getAttribute(aAttribute) == aValue) {</span>
<a href="#l44.383"></a><span id="l44.383">                 childNode.remove();</span>
<a href="#l44.384"></a><span id="l44.384">             }</span>
<a href="#l44.385"></a><span id="l44.385">             childNode = prevChildNode;</span>
<a href="#l44.386"></a><span id="l44.386">         }</span>
<a href="#l44.387"></a><span id="l44.387">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -433,17 +433,17 @@ calAlarmService.prototype = {</span>
<a href="#l45.4"></a><span id="l45.4">             }</span>
<a href="#l45.5"></a><span id="l45.5">         };</span>
<a href="#l45.6"></a><span id="l45.6"> </span>
<a href="#l45.7"></a><span id="l45.7">         let timer = newTimerWithCallback(alarmTimerCallback, aTimeout, false);</span>
<a href="#l45.8"></a><span id="l45.8">         this.mTimerMap[aItem.calendar.id][aItem.hashId][aAlarm.icalString] = timer;</span>
<a href="#l45.9"></a><span id="l45.9">     },</span>
<a href="#l45.10"></a><span id="l45.10"> </span>
<a href="#l45.11"></a><span id="l45.11">     removeTimer: function(aItem, aAlarm) {</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-            /* Is the calendar in the timer map */</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+        /* Is the calendar in the timer map */</span>
<a href="#l45.14"></a><span id="l45.14">         if (aItem.calendar.id in this.mTimerMap &amp;&amp;</span>
<a href="#l45.15"></a><span id="l45.15">             /* ...and is the item in the calendar map */</span>
<a href="#l45.16"></a><span id="l45.16">             aItem.hashId in this.mTimerMap[aItem.calendar.id] &amp;&amp;</span>
<a href="#l45.17"></a><span id="l45.17">             /* ...and is the alarm in the item map ? */</span>
<a href="#l45.18"></a><span id="l45.18">             aAlarm.icalString in this.mTimerMap[aItem.calendar.id][aItem.hashId]) {</span>
<a href="#l45.19"></a><span id="l45.19">             // First cancel the existing timer</span>
<a href="#l45.20"></a><span id="l45.20">             let timer = this.mTimerMap[aItem.calendar.id][aItem.hashId][aAlarm.icalString];</span>
<a href="#l45.21"></a><span id="l45.21">             timer.cancel();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/base/src/calApplicationUtils.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/base/src/calApplicationUtils.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -9,35 +9,35 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l46.4"></a><span id="l46.4"> /**</span>
<a href="#l46.5"></a><span id="l46.5">  * Launch the given url (string) in the external browser. If an event is passed,</span>
<a href="#l46.6"></a><span id="l46.6">  * then this is only done on left click and the event propagation is stopped.</span>
<a href="#l46.7"></a><span id="l46.7">  *</span>
<a href="#l46.8"></a><span id="l46.8">  * @param url       The URL to open, as a string</span>
<a href="#l46.9"></a><span id="l46.9">  * @param event     (optional) The event that caused the URL to open</span>
<a href="#l46.10"></a><span id="l46.10">  */</span>
<a href="#l46.11"></a><span id="l46.11"> function launchBrowser(url, event) {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  // Bail out if there is no url set, or an event was passed without left-click</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">-  if (!url || (event &amp;&amp; event.button != 0)) {</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">-    return;</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">-  }</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineplus">+    // Bail out if there is no url set, or an event was passed without left-click</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineplus">+    if (!url || (event &amp;&amp; event.button != 0)) {</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineplus">+        return;</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineplus">+    }</span>
<a href="#l46.20"></a><span id="l46.20"> </span>
<a href="#l46.21"></a><span id="l46.21" class="difflineminus">-  // 0. Prevent people from trying to launch URLs such as javascript:foo();</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineminus">-  //    by only allowing URLs starting with http or https.</span>
<a href="#l46.23"></a><span id="l46.23" class="difflineminus">-  // XXX: We likely will want to do this using nsIURLs in the future to</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineminus">-  //      prevent sneaky nasty escaping issues, but this is fine for now.</span>
<a href="#l46.25"></a><span id="l46.25" class="difflineminus">-  if (!url.startsWith(&quot;http&quot;)) {</span>
<a href="#l46.26"></a><span id="l46.26" class="difflineminus">-    Components.utils.reportError(&quot;launchBrowser: &quot; +</span>
<a href="#l46.27"></a><span id="l46.27" class="difflineminus">-                                 &quot;Invalid URL provided: &quot; + url +</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineminus">-                                 &quot; Only http:// and https:// URLs are valid.&quot;);</span>
<a href="#l46.29"></a><span id="l46.29" class="difflineminus">-    return;</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">-  }</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineplus">+    // 0. Prevent people from trying to launch URLs such as javascript:foo();</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+    //    by only allowing URLs starting with http or https.</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineplus">+    // XXX: We likely will want to do this using nsIURLs in the future to</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineplus">+    //      prevent sneaky nasty escaping issues, but this is fine for now.</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineplus">+    if (!url.startsWith(&quot;http&quot;)) {</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineplus">+        Components.utils.reportError(&quot;launchBrowser: &quot; +</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineplus">+                                     &quot;Invalid URL provided: &quot; + url +</span>
<a href="#l46.38"></a><span id="l46.38" class="difflineplus">+                                     &quot; Only http:// and https:// URLs are valid.&quot;);</span>
<a href="#l46.39"></a><span id="l46.39" class="difflineplus">+        return;</span>
<a href="#l46.40"></a><span id="l46.40" class="difflineplus">+    }</span>
<a href="#l46.41"></a><span id="l46.41"> </span>
<a href="#l46.42"></a><span id="l46.42" class="difflineminus">-  Components.classes[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l46.43"></a><span id="l46.43" class="difflineminus">-            .getService(Components.interfaces.nsIExternalProtocolService)</span>
<a href="#l46.44"></a><span id="l46.44" class="difflineminus">-            .loadUrl(Services.io.newURI(url, null, null));</span>
<a href="#l46.45"></a><span id="l46.45" class="difflineplus">+    Components.classes[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l46.46"></a><span id="l46.46" class="difflineplus">+              .getService(Components.interfaces.nsIExternalProtocolService)</span>
<a href="#l46.47"></a><span id="l46.47" class="difflineplus">+              .loadUrl(Services.io.newURI(url, null, null));</span>
<a href="#l46.48"></a><span id="l46.48"> </span>
<a href="#l46.49"></a><span id="l46.49" class="difflineminus">-  // Make sure that any default click handlers don't do anything, we have taken</span>
<a href="#l46.50"></a><span id="l46.50" class="difflineminus">-  // care of all processing</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineminus">-  if (event) {</span>
<a href="#l46.52"></a><span id="l46.52" class="difflineminus">-      event.stopPropagation();</span>
<a href="#l46.53"></a><span id="l46.53" class="difflineminus">-      event.preventDefault();</span>
<a href="#l46.54"></a><span id="l46.54" class="difflineminus">-  }</span>
<a href="#l46.55"></a><span id="l46.55" class="difflineplus">+    // Make sure that any default click handlers don't do anything, we have taken</span>
<a href="#l46.56"></a><span id="l46.56" class="difflineplus">+    // care of all processing</span>
<a href="#l46.57"></a><span id="l46.57" class="difflineplus">+    if (event) {</span>
<a href="#l46.58"></a><span id="l46.58" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l46.59"></a><span id="l46.59" class="difflineplus">+        event.preventDefault();</span>
<a href="#l46.60"></a><span id="l46.60" class="difflineplus">+    }</span>
<a href="#l46.61"></a><span id="l46.61"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -880,18 +880,17 @@ calMgrCalendarObserver.prototype = {</span>
<a href="#l47.4"></a><span id="l47.4">                 &quot;refreshInterval&quot;,</span>
<a href="#l47.5"></a><span id="l47.5">                 &quot;suppressAlarms&quot;,</span>
<a href="#l47.6"></a><span id="l47.6">                 &quot;calendar-main-in-composite&quot;,</span>
<a href="#l47.7"></a><span id="l47.7">                 &quot;calendar-main-default&quot;,</span>
<a href="#l47.8"></a><span id="l47.8">                 &quot;readOnly&quot;,</span>
<a href="#l47.9"></a><span id="l47.9">                 &quot;imip.identity.key&quot;</span>
<a href="#l47.10"></a><span id="l47.10">             ];</span>
<a href="#l47.11"></a><span id="l47.11">             for (let prop of propsToCopy) {</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-              newCal.setProperty(prop,</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">-                                 aCalendar.getProperty(prop));</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineplus">+                newCal.setProperty(prop, aCalendar.getProperty(prop));</span>
<a href="#l47.15"></a><span id="l47.15">             }</span>
<a href="#l47.16"></a><span id="l47.16"> </span>
<a href="#l47.17"></a><span id="l47.17">             if (initialSortOrderPos != null) {</span>
<a href="#l47.18"></a><span id="l47.18">                 newCal.setProperty(&quot;initialSortOrderPos&quot;,</span>
<a href="#l47.19"></a><span id="l47.19">                                    initialSortOrderPos);</span>
<a href="#l47.20"></a><span id="l47.20">             }</span>
<a href="#l47.21"></a><span id="l47.21">             this.calMgr.registerCalendar(newCal);</span>
<a href="#l47.22"></a><span id="l47.22">         } else if (aCalendar.wrappedJSObject instanceof calCachedCalendar) {</span>
<a href="#l47.23"></a><span id="l47.23" class="difflineat">@@ -942,19 +941,19 @@ calMgrCalendarObserver.prototype = {</span>
<a href="#l47.24"></a><span id="l47.24">                 message = props.GetStringFromName(&quot;utf8DecodeError&quot;);</span>
<a href="#l47.25"></a><span id="l47.25">                 break;</span>
<a href="#l47.26"></a><span id="l47.26">             case calIErrors.ICS_MALFORMEDDATA:</span>
<a href="#l47.27"></a><span id="l47.27">                 message = props.GetStringFromName(&quot;icsMalformedError&quot;);</span>
<a href="#l47.28"></a><span id="l47.28">                 break;</span>
<a href="#l47.29"></a><span id="l47.29">             case calIErrors.MODIFICATION_FAILED:</span>
<a href="#l47.30"></a><span id="l47.30">                 errMsg = calGetString(&quot;calendar&quot;, &quot;errorWriting&quot;, [aCalendar.name]);</span>
<a href="#l47.31"></a><span id="l47.31">                 // falls through</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-             default:</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineplus">+            default:</span>
<a href="#l47.34"></a><span id="l47.34">                 message = aMessage;</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineminus">-         }</span>
<a href="#l47.36"></a><span id="l47.36" class="difflineplus">+        }</span>
<a href="#l47.37"></a><span id="l47.37"> </span>
<a href="#l47.38"></a><span id="l47.38"> </span>
<a href="#l47.39"></a><span id="l47.39">         paramBlock.SetString(0, errMsg);</span>
<a href="#l47.40"></a><span id="l47.40">         paramBlock.SetString(1, errCode);</span>
<a href="#l47.41"></a><span id="l47.41">         paramBlock.SetString(2, message);</span>
<a href="#l47.42"></a><span id="l47.42"> </span>
<a href="#l47.43"></a><span id="l47.43">         this.storedReadOnly = this.calendar.readOnly;</span>
<a href="#l47.44"></a><span id="l47.44">         let errorCode = calGetString(&quot;calendar&quot;, &quot;errorCode&quot;, [errCode]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/base/src/calDeletedItems.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/base/src/calDeletedItems.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -12,19 +12,19 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l48.4"></a><span id="l48.4">  * This is (currently) not a real trashcan. Only ids and time deleted is stored.</span>
<a href="#l48.5"></a><span id="l48.5">  * Note also that the code doesn't strictly check the calendar of the item,</span>
<a href="#l48.6"></a><span id="l48.6">  * except when a calendar id is passed to getDeletedDate.</span>
<a href="#l48.7"></a><span id="l48.7">  */</span>
<a href="#l48.8"></a><span id="l48.8"> function calDeletedItems() {</span>
<a href="#l48.9"></a><span id="l48.9">     this.wrappedJSObject = this;</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11">     this.completedNotifier = {</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-      handleResult: function() {},</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">-      handleError: function() {},</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineminus">-      handleCompletion: function() {},</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineplus">+        handleResult: function() {},</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineplus">+        handleError: function() {},</span>
<a href="#l48.17"></a><span id="l48.17" class="difflineplus">+        handleCompletion: function() {},</span>
<a href="#l48.18"></a><span id="l48.18">     };</span>
<a href="#l48.19"></a><span id="l48.19"> }</span>
<a href="#l48.20"></a><span id="l48.20"> </span>
<a href="#l48.21"></a><span id="l48.21"> var calDeletedItemsClassID = Components.ID(&quot;{8e6799af-e7e9-4e6c-9a82-a2413e86d8c3}&quot;);</span>
<a href="#l48.22"></a><span id="l48.22"> var calDeletedItemsInterfaces = [</span>
<a href="#l48.23"></a><span id="l48.23">     Components.interfaces.calIDeletedItems,</span>
<a href="#l48.24"></a><span id="l48.24">     Components.interfaces.nsIObserver,</span>
<a href="#l48.25"></a><span id="l48.25">     Components.interfaces.calIObserver</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -768,17 +768,17 @@ calFilter.prototype = {</span>
<a href="#l49.4"></a><span id="l49.4">         let start = cal.now();</span>
<a href="#l49.5"></a><span id="l49.5"> </span>
<a href="#l49.6"></a><span id="l49.6">         // If the base item matches the filter, we need to check each future occurrence.</span>
<a href="#l49.7"></a><span id="l49.7">         // Otherwise, we only need to check the exceptions.</span>
<a href="#l49.8"></a><span id="l49.8">         if (this.isItemInFilters(aItem)) {</span>
<a href="#l49.9"></a><span id="l49.9">             while (count++ &lt; this.mMaxIterations) {</span>
<a href="#l49.10"></a><span id="l49.10">                 let next = aItem.recurrenceInfo.getNextOccurrence(start);</span>
<a href="#l49.11"></a><span id="l49.11">                 if (!next) {</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-                   // there are no more occurrences</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+                    // there are no more occurrences</span>
<a href="#l49.14"></a><span id="l49.14">                     return null;</span>
<a href="#l49.15"></a><span id="l49.15">                 }</span>
<a href="#l49.16"></a><span id="l49.16">                 if (this.isItemInFilters(next)) {</span>
<a href="#l49.17"></a><span id="l49.17">                     return next;</span>
<a href="#l49.18"></a><span id="l49.18">                 }</span>
<a href="#l49.19"></a><span id="l49.19">                 start = next.startDate || next.entryDate;</span>
<a href="#l49.20"></a><span id="l49.20">             }</span>
<a href="#l49.21"></a><span id="l49.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/base/src/calIcsSerializer.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/base/src/calIcsSerializer.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -25,21 +25,21 @@ calIcsSerializer.prototype = {</span>
<a href="#l50.4"></a><span id="l50.4"> </span>
<a href="#l50.5"></a><span id="l50.5">     addItems: function(aItems, aCount) {</span>
<a href="#l50.6"></a><span id="l50.6">         if (aCount &gt; 0) {</span>
<a href="#l50.7"></a><span id="l50.7">             this.mItems = this.mItems.concat(aItems);</span>
<a href="#l50.8"></a><span id="l50.8">         }</span>
<a href="#l50.9"></a><span id="l50.9">     },</span>
<a href="#l50.10"></a><span id="l50.10"> </span>
<a href="#l50.11"></a><span id="l50.11">     addProperty: function(aProperty) {</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-       this.mProperties.push(aProperty);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+        this.mProperties.push(aProperty);</span>
<a href="#l50.14"></a><span id="l50.14">     },</span>
<a href="#l50.15"></a><span id="l50.15"> </span>
<a href="#l50.16"></a><span id="l50.16">     addComponent: function(aComponent) {</span>
<a href="#l50.17"></a><span id="l50.17" class="difflineminus">-       this.mComponents.push(aComponent);</span>
<a href="#l50.18"></a><span id="l50.18" class="difflineplus">+        this.mComponents.push(aComponent);</span>
<a href="#l50.19"></a><span id="l50.19">     },</span>
<a href="#l50.20"></a><span id="l50.20"> </span>
<a href="#l50.21"></a><span id="l50.21">     serializeToString: function() {</span>
<a href="#l50.22"></a><span id="l50.22">         let calComp = this.getIcalComponent();</span>
<a href="#l50.23"></a><span id="l50.23">         return calComp.serializeToICS();</span>
<a href="#l50.24"></a><span id="l50.24">     },</span>
<a href="#l50.25"></a><span id="l50.25"> </span>
<a href="#l50.26"></a><span id="l50.26">     serializeToInputStream: function(aStream) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -222,17 +222,17 @@ calItemBase.prototype = {</span>
<a href="#l51.4"></a><span id="l51.4">         if (this.mAlarmLastAck) {</span>
<a href="#l51.5"></a><span id="l51.5">             this.mAlarmLastAck.makeImmutable();</span>
<a href="#l51.6"></a><span id="l51.6">         }</span>
<a href="#l51.7"></a><span id="l51.7"> </span>
<a href="#l51.8"></a><span id="l51.8">         this.ensureNotDirty();</span>
<a href="#l51.9"></a><span id="l51.9">         this.mImmutable = true;</span>
<a href="#l51.10"></a><span id="l51.10">     },</span>
<a href="#l51.11"></a><span id="l51.11"> </span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-     // boolean hasSameIds(in calIItemBase aItem);</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    // boolean hasSameIds(in calIItemBase aItem);</span>
<a href="#l51.14"></a><span id="l51.14">     hasSameIds: function(that) {</span>
<a href="#l51.15"></a><span id="l51.15">         return that &amp;&amp; this.id == that.id &amp;&amp;</span>
<a href="#l51.16"></a><span id="l51.16">                (this.recurrenceId == that.recurrenceId || // both null</span>
<a href="#l51.17"></a><span id="l51.17">                 (this.recurrenceId &amp;&amp; that.recurrenceId &amp;&amp;</span>
<a href="#l51.18"></a><span id="l51.18">                  this.recurrenceId.compare(that.recurrenceId) == 0));</span>
<a href="#l51.19"></a><span id="l51.19">     },</span>
<a href="#l51.20"></a><span id="l51.20"> </span>
<a href="#l51.21"></a><span id="l51.21">     // calIItemBase clone();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/base/src/calItipItem.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/base/src/calItipItem.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -80,17 +80,17 @@ calItipItem.prototype = {</span>
<a href="#l52.4"></a><span id="l52.4">     },</span>
<a href="#l52.5"></a><span id="l52.5"> </span>
<a href="#l52.6"></a><span id="l52.6">     mLocalStatus: null,</span>
<a href="#l52.7"></a><span id="l52.7">     get localStatus() {</span>
<a href="#l52.8"></a><span id="l52.8">         return this.mLocalStatus;</span>
<a href="#l52.9"></a><span id="l52.9">     },</span>
<a href="#l52.10"></a><span id="l52.10">     set localStatus(aValue) {</span>
<a href="#l52.11"></a><span id="l52.11">         return (this.mLocalStatus = aValue);</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-     },</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+    },</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15">     mItemList: {},</span>
<a href="#l52.16"></a><span id="l52.16"> </span>
<a href="#l52.17"></a><span id="l52.17">     init: function(aIcalString) {</span>
<a href="#l52.18"></a><span id="l52.18">         let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l52.19"></a><span id="l52.19">                                .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l52.20"></a><span id="l52.20">         parser.parseString(aIcalString, null);</span>
<a href="#l52.21"></a><span id="l52.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/base/src/calProtocolHandler.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/base/src/calProtocolHandler.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -34,17 +34,17 @@ calProtocolHandler.prototype = {</span>
<a href="#l53.4"></a><span id="l53.4">         let uri = Components.classes[&quot;@mozilla.org/network/standard-url;1&quot;]</span>
<a href="#l53.5"></a><span id="l53.5">                             .createInstance(Components.interfaces.nsIStandardURL);</span>
<a href="#l53.6"></a><span id="l53.6">         uri.init(Components.interfaces.nsIStandardURL.URLTYPE_STANDARD,</span>
<a href="#l53.7"></a><span id="l53.7">                  this.mHttpProtocol.defaultPort, aSpec, anOriginalCharset, aBaseURI);</span>
<a href="#l53.8"></a><span id="l53.8">         return uri;</span>
<a href="#l53.9"></a><span id="l53.9">     },</span>
<a href="#l53.10"></a><span id="l53.10"> </span>
<a href="#l53.11"></a><span id="l53.11">     newChannel: function(aUri) {</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-      return this.newChannel2(aUri, null);</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+        return this.newChannel2(aUri, null);</span>
<a href="#l53.14"></a><span id="l53.14">     },</span>
<a href="#l53.15"></a><span id="l53.15"> </span>
<a href="#l53.16"></a><span id="l53.16">     newChannel2: function(aUri, aLoadInfo) {</span>
<a href="#l53.17"></a><span id="l53.17">         // make sure to clone the uri, because we are about to change</span>
<a href="#l53.18"></a><span id="l53.18">         // it, and we don't want to change the original uri.</span>
<a href="#l53.19"></a><span id="l53.19">         let uri = aUri.clone();</span>
<a href="#l53.20"></a><span id="l53.20">         uri.scheme = this.mHttpProtocol.scheme;</span>
<a href="#l53.21"></a><span id="l53.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -662,39 +662,39 @@ function guessSystemTimezone() {</span>
<a href="#l54.4"></a><span id="l54.4">             }</span>
<a href="#l54.5"></a><span id="l54.5">         }</span>
<a href="#l54.6"></a><span id="l54.6"> </span>
<a href="#l54.7"></a><span id="l54.7">         // check how well OS tz matches tz defined in our version of zoneinfo db</span>
<a href="#l54.8"></a><span id="l54.8">         if (zoneInfoIdFromOSUserTimeZone != null) {</span>
<a href="#l54.9"></a><span id="l54.9">             let tzId = zoneInfoIdFromOSUserTimeZone;</span>
<a href="#l54.10"></a><span id="l54.10">             let score = checkTZ(tzId);</span>
<a href="#l54.11"></a><span id="l54.11">             switch (score) {</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-            case 0:</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineminus">-                // Did not match.</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineminus">-                // Maybe OS or Application is old, and the timezone changed.</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineminus">-                // Or maybe user turned off DST in Date/Time control panel.</span>
<a href="#l54.16"></a><span id="l54.16" class="difflineminus">-                // Will look for a better matching tz, or fallback to floating.</span>
<a href="#l54.17"></a><span id="l54.17" class="difflineminus">-                // (Match OS so alarms go off at time indicated by OS clock.)</span>
<a href="#l54.18"></a><span id="l54.18" class="difflineminus">-                cal.WARN(calProperties.formatStringFromName(</span>
<a href="#l54.19"></a><span id="l54.19" class="difflineminus">-                         &quot;WarningOSTZNoMatch&quot;, [osUserTimeZone, zoneInfoIdFromOSUserTimeZone], 2));</span>
<a href="#l54.20"></a><span id="l54.20" class="difflineminus">-                break;</span>
<a href="#l54.21"></a><span id="l54.21" class="difflineminus">-            case 1: case 2:</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineminus">-                // inexact match: OS TZ and our ZoneInfo TZ matched imperfectly.</span>
<a href="#l54.23"></a><span id="l54.23" class="difflineminus">-                // Will keep looking, will use tzId unless another is better.</span>
<a href="#l54.24"></a><span id="l54.24" class="difflineminus">-                // (maybe OS TZ has changed to match a nearby TZ, so maybe</span>
<a href="#l54.25"></a><span id="l54.25" class="difflineminus">-                // another ZoneInfo TZ matches it better).</span>
<a href="#l54.26"></a><span id="l54.26" class="difflineminus">-                probableTZId = tzId;</span>
<a href="#l54.27"></a><span id="l54.27" class="difflineminus">-                probableTZScore = score;</span>
<a href="#l54.28"></a><span id="l54.28" class="difflineminus">-                probableTZSource = calProperties.formatStringFromName(</span>
<a href="#l54.29"></a><span id="l54.29" class="difflineminus">-                    &quot;TZFromOS&quot;, [osUserTimeZone], 1);</span>
<a href="#l54.30"></a><span id="l54.30" class="difflineplus">+                case 0:</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineplus">+                    // Did not match.</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+                    // Maybe OS or Application is old, and the timezone changed.</span>
<a href="#l54.33"></a><span id="l54.33" class="difflineplus">+                    // Or maybe user turned off DST in Date/Time control panel.</span>
<a href="#l54.34"></a><span id="l54.34" class="difflineplus">+                    // Will look for a better matching tz, or fallback to floating.</span>
<a href="#l54.35"></a><span id="l54.35" class="difflineplus">+                    // (Match OS so alarms go off at time indicated by OS clock.)</span>
<a href="#l54.36"></a><span id="l54.36" class="difflineplus">+                    cal.WARN(calProperties.formatStringFromName(</span>
<a href="#l54.37"></a><span id="l54.37" class="difflineplus">+                             &quot;WarningOSTZNoMatch&quot;, [osUserTimeZone, zoneInfoIdFromOSUserTimeZone], 2));</span>
<a href="#l54.38"></a><span id="l54.38" class="difflineplus">+                    break;</span>
<a href="#l54.39"></a><span id="l54.39" class="difflineplus">+                case 1: case 2:</span>
<a href="#l54.40"></a><span id="l54.40" class="difflineplus">+                    // inexact match: OS TZ and our ZoneInfo TZ matched imperfectly.</span>
<a href="#l54.41"></a><span id="l54.41" class="difflineplus">+                    // Will keep looking, will use tzId unless another is better.</span>
<a href="#l54.42"></a><span id="l54.42" class="difflineplus">+                    // (maybe OS TZ has changed to match a nearby TZ, so maybe</span>
<a href="#l54.43"></a><span id="l54.43" class="difflineplus">+                    // another ZoneInfo TZ matches it better).</span>
<a href="#l54.44"></a><span id="l54.44" class="difflineplus">+                    probableTZId = tzId;</span>
<a href="#l54.45"></a><span id="l54.45" class="difflineplus">+                    probableTZScore = score;</span>
<a href="#l54.46"></a><span id="l54.46" class="difflineplus">+                    probableTZSource = calProperties.formatStringFromName(</span>
<a href="#l54.47"></a><span id="l54.47" class="difflineplus">+                        &quot;TZFromOS&quot;, [osUserTimeZone], 1);</span>
<a href="#l54.48"></a><span id="l54.48"> </span>
<a href="#l54.49"></a><span id="l54.49" class="difflineminus">-                break;</span>
<a href="#l54.50"></a><span id="l54.50" class="difflineminus">-            case 3:</span>
<a href="#l54.51"></a><span id="l54.51" class="difflineminus">-                // exact match</span>
<a href="#l54.52"></a><span id="l54.52" class="difflineminus">-                return tzId;</span>
<a href="#l54.53"></a><span id="l54.53" class="difflineplus">+                    break;</span>
<a href="#l54.54"></a><span id="l54.54" class="difflineplus">+                case 3:</span>
<a href="#l54.55"></a><span id="l54.55" class="difflineplus">+                    // exact match</span>
<a href="#l54.56"></a><span id="l54.56" class="difflineplus">+                    return tzId;</span>
<a href="#l54.57"></a><span id="l54.57">             }</span>
<a href="#l54.58"></a><span id="l54.58">         }</span>
<a href="#l54.59"></a><span id="l54.59">     } catch (ex) {</span>
<a href="#l54.60"></a><span id="l54.60">         // zoneInfo id given was not recognized by our ZoneInfo database</span>
<a href="#l54.61"></a><span id="l54.61">         let errParams = [zoneInfoIdFromOSUserTimeZone || osUserTimeZone];</span>
<a href="#l54.62"></a><span id="l54.62">         let errMsg = calProperties.formatStringFromName(&quot;SkippingOSTimezone&quot;, errParams, 1);</span>
<a href="#l54.63"></a><span id="l54.63">         Components.utils.reportError(errMsg + &quot; &quot; + ex);</span>
<a href="#l54.64"></a><span id="l54.64">     }</span>
<a href="#l54.65"></a><span id="l54.65" class="difflineat">@@ -707,27 +707,27 @@ function guessSystemTimezone() {</span>
<a href="#l54.66"></a><span id="l54.66">             calProperties.GetStringFromName(&quot;likelyTimezone&quot;);</span>
<a href="#l54.67"></a><span id="l54.67">         const bundleTZIds = bundleTZString.split(/\s*,\s*/);</span>
<a href="#l54.68"></a><span id="l54.68">         for (let bareTZId of bundleTZIds) {</span>
<a href="#l54.69"></a><span id="l54.69">             let tzId = bareTZId;</span>
<a href="#l54.70"></a><span id="l54.70">             try {</span>
<a href="#l54.71"></a><span id="l54.71">                 let score = checkTZ(tzId);</span>
<a href="#l54.72"></a><span id="l54.72"> </span>
<a href="#l54.73"></a><span id="l54.73">                 switch (score) {</span>
<a href="#l54.74"></a><span id="l54.74" class="difflineminus">-                case 0:</span>
<a href="#l54.75"></a><span id="l54.75" class="difflineminus">-                    break;</span>
<a href="#l54.76"></a><span id="l54.76" class="difflineminus">-                case 1: case 2:</span>
<a href="#l54.77"></a><span id="l54.77" class="difflineminus">-                    if (score &gt; probableTZScore) {</span>
<a href="#l54.78"></a><span id="l54.78" class="difflineminus">-                        probableTZId = tzId;</span>
<a href="#l54.79"></a><span id="l54.79" class="difflineminus">-                        probableTZScore = score;</span>
<a href="#l54.80"></a><span id="l54.80" class="difflineminus">-                        probableTZSource = calProperties.GetStringFromName(&quot;TZFromLocale&quot;);</span>
<a href="#l54.81"></a><span id="l54.81" class="difflineminus">-                    }</span>
<a href="#l54.82"></a><span id="l54.82" class="difflineminus">-                    break;</span>
<a href="#l54.83"></a><span id="l54.83" class="difflineminus">-                case 3:</span>
<a href="#l54.84"></a><span id="l54.84" class="difflineminus">-                    return tzId;</span>
<a href="#l54.85"></a><span id="l54.85" class="difflineplus">+                    case 0:</span>
<a href="#l54.86"></a><span id="l54.86" class="difflineplus">+                        break;</span>
<a href="#l54.87"></a><span id="l54.87" class="difflineplus">+                    case 1: case 2:</span>
<a href="#l54.88"></a><span id="l54.88" class="difflineplus">+                        if (score &gt; probableTZScore) {</span>
<a href="#l54.89"></a><span id="l54.89" class="difflineplus">+                            probableTZId = tzId;</span>
<a href="#l54.90"></a><span id="l54.90" class="difflineplus">+                            probableTZScore = score;</span>
<a href="#l54.91"></a><span id="l54.91" class="difflineplus">+                            probableTZSource = calProperties.GetStringFromName(&quot;TZFromLocale&quot;);</span>
<a href="#l54.92"></a><span id="l54.92" class="difflineplus">+                        }</span>
<a href="#l54.93"></a><span id="l54.93" class="difflineplus">+                        break;</span>
<a href="#l54.94"></a><span id="l54.94" class="difflineplus">+                    case 3:</span>
<a href="#l54.95"></a><span id="l54.95" class="difflineplus">+                        return tzId;</span>
<a href="#l54.96"></a><span id="l54.96">                 }</span>
<a href="#l54.97"></a><span id="l54.97">             } catch (ex) {</span>
<a href="#l54.98"></a><span id="l54.98">                 let errMsg = calProperties.formatStringFromName(</span>
<a href="#l54.99"></a><span id="l54.99">                     &quot;SkippingLocaleTimezone&quot;, [bareTZId], 1);</span>
<a href="#l54.100"></a><span id="l54.100">                 Components.utils.reportError(errMsg + &quot; &quot; + ex);</span>
<a href="#l54.101"></a><span id="l54.101">             }</span>
<a href="#l54.102"></a><span id="l54.102">         }</span>
<a href="#l54.103"></a><span id="l54.103">     } catch (ex) { // Oh well, this didn't work, next option...</span>
<a href="#l54.104"></a><span id="l54.104" class="difflineat">@@ -736,26 +736,26 @@ function guessSystemTimezone() {</span>
<a href="#l54.105"></a><span id="l54.105"> </span>
<a href="#l54.106"></a><span id="l54.106">     // Third, try all known timezones.</span>
<a href="#l54.107"></a><span id="l54.107">     const tzIDs = tzSvc.timezoneIds;</span>
<a href="#l54.108"></a><span id="l54.108">     while (tzIDs.hasMore()) {</span>
<a href="#l54.109"></a><span id="l54.109">         let tzId = tzIDs.getNext();</span>
<a href="#l54.110"></a><span id="l54.110">         try {</span>
<a href="#l54.111"></a><span id="l54.111">             let score = checkTZ(tzId);</span>
<a href="#l54.112"></a><span id="l54.112">             switch (score) {</span>
<a href="#l54.113"></a><span id="l54.113" class="difflineminus">-            case 0: break;</span>
<a href="#l54.114"></a><span id="l54.114" class="difflineminus">-            case 1: case 2:</span>
<a href="#l54.115"></a><span id="l54.115" class="difflineminus">-                if (score &gt; probableTZScore) {</span>
<a href="#l54.116"></a><span id="l54.116" class="difflineminus">-                    probableTZId = tzId;</span>
<a href="#l54.117"></a><span id="l54.117" class="difflineminus">-                    probableTZScore = score;</span>
<a href="#l54.118"></a><span id="l54.118" class="difflineminus">-                    probableTZSource = calProperties.GetStringFromName(&quot;TZFromKnownTimezones&quot;);</span>
<a href="#l54.119"></a><span id="l54.119" class="difflineminus">-                }</span>
<a href="#l54.120"></a><span id="l54.120" class="difflineminus">-                break;</span>
<a href="#l54.121"></a><span id="l54.121" class="difflineminus">-            case 3:</span>
<a href="#l54.122"></a><span id="l54.122" class="difflineminus">-                return tzId;</span>
<a href="#l54.123"></a><span id="l54.123" class="difflineplus">+                case 0: break;</span>
<a href="#l54.124"></a><span id="l54.124" class="difflineplus">+                case 1: case 2:</span>
<a href="#l54.125"></a><span id="l54.125" class="difflineplus">+                    if (score &gt; probableTZScore) {</span>
<a href="#l54.126"></a><span id="l54.126" class="difflineplus">+                        probableTZId = tzId;</span>
<a href="#l54.127"></a><span id="l54.127" class="difflineplus">+                        probableTZScore = score;</span>
<a href="#l54.128"></a><span id="l54.128" class="difflineplus">+                        probableTZSource = calProperties.GetStringFromName(&quot;TZFromKnownTimezones&quot;);</span>
<a href="#l54.129"></a><span id="l54.129" class="difflineplus">+                    }</span>
<a href="#l54.130"></a><span id="l54.130" class="difflineplus">+                    break;</span>
<a href="#l54.131"></a><span id="l54.131" class="difflineplus">+                case 3:</span>
<a href="#l54.132"></a><span id="l54.132" class="difflineplus">+                    return tzId;</span>
<a href="#l54.133"></a><span id="l54.133">             }</span>
<a href="#l54.134"></a><span id="l54.134">         } catch (ex) { // bug if ics service doesn't recognize own tzid!</span>
<a href="#l54.135"></a><span id="l54.135">             let msg = &quot;ics-service doesn't recognize own tzid: &quot; + tzId + &quot;\n&quot; + ex;</span>
<a href="#l54.136"></a><span id="l54.136">             Components.utils.reportError(msg);</span>
<a href="#l54.137"></a><span id="l54.137">         }</span>
<a href="#l54.138"></a><span id="l54.138">     }</span>
<a href="#l54.139"></a><span id="l54.139"> </span>
<a href="#l54.140"></a><span id="l54.140">     // If reach here, there were no score=3 matches, so Warn in console.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -1357,17 +1357,17 @@ calOperationGroup.prototype = {</span>
<a href="#l55.4"></a><span id="l55.4">     }</span>
<a href="#l55.5"></a><span id="l55.5"> };</span>
<a href="#l55.6"></a><span id="l55.6"> </span>
<a href="#l55.7"></a><span id="l55.7"> function sameDay(date1, date2) {</span>
<a href="#l55.8"></a><span id="l55.8">     if (date1 &amp;&amp; date2) {</span>
<a href="#l55.9"></a><span id="l55.9">         if ((date1.day == date2.day) &amp;&amp;</span>
<a href="#l55.10"></a><span id="l55.10">             (date1.month == date2.month) &amp;&amp;</span>
<a href="#l55.11"></a><span id="l55.11">             (date1.year == date2.year)) {</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-              return true;</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+            return true;</span>
<a href="#l55.14"></a><span id="l55.14">         }</span>
<a href="#l55.15"></a><span id="l55.15">     }</span>
<a href="#l55.16"></a><span id="l55.16">     return false;</span>
<a href="#l55.17"></a><span id="l55.17"> }</span>
<a href="#l55.18"></a><span id="l55.18"> </span>
<a href="#l55.19"></a><span id="l55.19"> /**</span>
<a href="#l55.20"></a><span id="l55.20">  * Centralized funtions for accessing prodid and version</span>
<a href="#l55.21"></a><span id="l55.21">  */</span>
<a href="#l55.22"></a><span id="l55.22" class="difflineat">@@ -1407,35 +1407,35 @@ function calSetProdidVersion(aIcalCompon</span>
<a href="#l55.23"></a><span id="l55.23">  * applies a value to all children of a Menu. If the respective childnodes define</span>
<a href="#l55.24"></a><span id="l55.24">  * a command the value is applied to the attribute of thecommand of the childnode</span>
<a href="#l55.25"></a><span id="l55.25">  *</span>
<a href="#l55.26"></a><span id="l55.26">  * @param aElement The parentnode of the elements</span>
<a href="#l55.27"></a><span id="l55.27">  * @param aAttributeName The name of the attribute</span>
<a href="#l55.28"></a><span id="l55.28">  * @param aValue The value of the attribute</span>
<a href="#l55.29"></a><span id="l55.29">  */</span>
<a href="#l55.30"></a><span id="l55.30"> function applyAttributeToMenuChildren(aElement, aAttributeName, aValue) {</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineminus">-   let sibling = aElement.firstChild;</span>
<a href="#l55.32"></a><span id="l55.32" class="difflineminus">-   do {</span>
<a href="#l55.33"></a><span id="l55.33" class="difflineminus">-       if (sibling) {</span>
<a href="#l55.34"></a><span id="l55.34" class="difflineminus">-           let domObject = sibling;</span>
<a href="#l55.35"></a><span id="l55.35" class="difflineminus">-           let commandName = null;</span>
<a href="#l55.36"></a><span id="l55.36" class="difflineminus">-           if (sibling.hasAttribute(&quot;command&quot;)) {</span>
<a href="#l55.37"></a><span id="l55.37" class="difflineminus">-               commandName = sibling.getAttribute(&quot;command&quot;);</span>
<a href="#l55.38"></a><span id="l55.38" class="difflineminus">-           }</span>
<a href="#l55.39"></a><span id="l55.39" class="difflineminus">-           if (commandName) {</span>
<a href="#l55.40"></a><span id="l55.40" class="difflineminus">-               let command = document.getElementById(commandName);</span>
<a href="#l55.41"></a><span id="l55.41" class="difflineminus">-               if (command) {</span>
<a href="#l55.42"></a><span id="l55.42" class="difflineminus">-                   domObject = command;</span>
<a href="#l55.43"></a><span id="l55.43" class="difflineminus">-               }</span>
<a href="#l55.44"></a><span id="l55.44" class="difflineminus">-           }</span>
<a href="#l55.45"></a><span id="l55.45" class="difflineminus">-           domObject.setAttribute(aAttributeName, aValue);</span>
<a href="#l55.46"></a><span id="l55.46" class="difflineminus">-       sibling = sibling.nextSibling;</span>
<a href="#l55.47"></a><span id="l55.47" class="difflineminus">-       }</span>
<a href="#l55.48"></a><span id="l55.48" class="difflineplus">+    let sibling = aElement.firstChild;</span>
<a href="#l55.49"></a><span id="l55.49" class="difflineplus">+    do {</span>
<a href="#l55.50"></a><span id="l55.50" class="difflineplus">+        if (sibling) {</span>
<a href="#l55.51"></a><span id="l55.51" class="difflineplus">+            let domObject = sibling;</span>
<a href="#l55.52"></a><span id="l55.52" class="difflineplus">+            let commandName = null;</span>
<a href="#l55.53"></a><span id="l55.53" class="difflineplus">+            if (sibling.hasAttribute(&quot;command&quot;)) {</span>
<a href="#l55.54"></a><span id="l55.54" class="difflineplus">+                commandName = sibling.getAttribute(&quot;command&quot;);</span>
<a href="#l55.55"></a><span id="l55.55" class="difflineplus">+            }</span>
<a href="#l55.56"></a><span id="l55.56" class="difflineplus">+            if (commandName) {</span>
<a href="#l55.57"></a><span id="l55.57" class="difflineplus">+                let command = document.getElementById(commandName);</span>
<a href="#l55.58"></a><span id="l55.58" class="difflineplus">+                if (command) {</span>
<a href="#l55.59"></a><span id="l55.59" class="difflineplus">+                    domObject = command;</span>
<a href="#l55.60"></a><span id="l55.60" class="difflineplus">+                }</span>
<a href="#l55.61"></a><span id="l55.61" class="difflineplus">+            }</span>
<a href="#l55.62"></a><span id="l55.62" class="difflineplus">+            domObject.setAttribute(aAttributeName, aValue);</span>
<a href="#l55.63"></a><span id="l55.63" class="difflineplus">+            sibling = sibling.nextSibling;</span>
<a href="#l55.64"></a><span id="l55.64" class="difflineplus">+        }</span>
<a href="#l55.65"></a><span id="l55.65">     } while (sibling);</span>
<a href="#l55.66"></a><span id="l55.66" class="difflineminus">-  }</span>
<a href="#l55.67"></a><span id="l55.67" class="difflineplus">+}</span>
<a href="#l55.68"></a><span id="l55.68"> </span>
<a href="#l55.69"></a><span id="l55.69"> </span>
<a href="#l55.70"></a><span id="l55.70"> /**</span>
<a href="#l55.71"></a><span id="l55.71">  * compares the value of a property of an array of objects and returns</span>
<a href="#l55.72"></a><span id="l55.72">  * true or false if it is same or not among all array members</span>
<a href="#l55.73"></a><span id="l55.73">  *</span>
<a href="#l55.74"></a><span id="l55.74">  * @param aObjects An Array of Objects to inspect</span>
<a href="#l55.75"></a><span id="l55.75">  * @param aProperty Name the name of the Property of which the value is compared</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -393,18 +393,18 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l56.4"></a><span id="l56.4"> </span>
<a href="#l56.5"></a><span id="l56.5">         if (timepart &amp;&amp; aLocale.timeAmPmIndex &amp;&amp;</span>
<a href="#l56.6"></a><span id="l56.6">             timepart[aLocale.timeAmPmIndex] != aLocale.timePmString) {</span>
<a href="#l56.7"></a><span id="l56.7">             // AM</span>
<a href="#l56.8"></a><span id="l56.8">             if (date.hour == 12) {</span>
<a href="#l56.9"></a><span id="l56.9">                 date.hour = 0;</span>
<a href="#l56.10"></a><span id="l56.10">             }</span>
<a href="#l56.11"></a><span id="l56.11">         } else if (date.hour &lt; 12) {</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-           // PM</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineminus">-           date.hour += 12;</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineplus">+            // PM</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineplus">+            date.hour += 12;</span>
<a href="#l56.16"></a><span id="l56.16">         }</span>
<a href="#l56.17"></a><span id="l56.17">         return date;</span>
<a href="#l56.18"></a><span id="l56.18">     },</span>
<a href="#l56.19"></a><span id="l56.19"> </span>
<a href="#l56.20"></a><span id="l56.20">     parseTextField: function(aTextField) {</span>
<a href="#l56.21"></a><span id="l56.21">         return aTextField ? aTextField.replace(/&quot;&quot;/g, &quot;\&quot;&quot;) : &quot;&quot;;</span>
<a href="#l56.22"></a><span id="l56.22">     }</span>
<a href="#l56.23"></a><span id="l56.23"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -12,17 +12,17 @@ var ITIP_HANDLER_PROTOCOL = &quot;moz-cal-han</span>
<a href="#l57.4"></a><span id="l57.4"> var NS_ERROR_WONT_HANDLE_CONTENT = 0x805d0001;</span>
<a href="#l57.5"></a><span id="l57.5"> </span>
<a href="#l57.6"></a><span id="l57.6"> </span>
<a href="#l57.7"></a><span id="l57.7"> function NYI() {</span>
<a href="#l57.8"></a><span id="l57.8">     throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l57.9"></a><span id="l57.9"> }</span>
<a href="#l57.10"></a><span id="l57.10"> </span>
<a href="#l57.11"></a><span id="l57.11"> function ItipChannel(URI) {</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-   this.URI = this.originalURI = URI;</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+    this.URI = this.originalURI = URI;</span>
<a href="#l57.14"></a><span id="l57.14"> }</span>
<a href="#l57.15"></a><span id="l57.15"> var ItipChannelClassID = Components.ID(&quot;{643e0328-36f6-411d-a107-16238dff9cd7}&quot;);</span>
<a href="#l57.16"></a><span id="l57.16"> var ItipChannelInterfaces = [</span>
<a href="#l57.17"></a><span id="l57.17">     Components.interfaces.nsIChannel,</span>
<a href="#l57.18"></a><span id="l57.18">     Components.interfaces.nsIRequest</span>
<a href="#l57.19"></a><span id="l57.19"> ];</span>
<a href="#l57.20"></a><span id="l57.20"> ItipChannel.prototype = {</span>
<a href="#l57.21"></a><span id="l57.21">     classID: ItipChannelClassID,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/lightning/content/html-item-editing/react-code.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/lightning/content/html-item-editing/react-code.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -17,24 +17,21 @@ var Tabstrip = React.createClass({</span>
<a href="#l58.4"></a><span id="l58.4">     render: function() {</span>
<a href="#l58.5"></a><span id="l58.5">         return React.DOM.ul(</span>
<a href="#l58.6"></a><span id="l58.6">             { id: &quot;tabstrip&quot; },</span>
<a href="#l58.7"></a><span id="l58.7">             this.props.tabs.map((tab, index) =&gt; {</span>
<a href="#l58.8"></a><span id="l58.8">                 let style = (this.props.activeTab == index) ? &quot;activeTab&quot; : &quot;&quot;;</span>
<a href="#l58.9"></a><span id="l58.9">                 // The bind() method makes the index</span>
<a href="#l58.10"></a><span id="l58.10">                 // available to the handleChange function:</span>
<a href="#l58.11"></a><span id="l58.11">                 return React.DOM.li({</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-                        className: style + &quot; tab&quot;,</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-                        key: &quot;tabkey&quot; + index,</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineminus">-                        onClick: this.handleChange.bind(this, index)</span>
<a href="#l58.15"></a><span id="l58.15" class="difflineminus">-                    },</span>
<a href="#l58.16"></a><span id="l58.16" class="difflineminus">-                    tab</span>
<a href="#l58.17"></a><span id="l58.17" class="difflineminus">-                    );</span>
<a href="#l58.18"></a><span id="l58.18" class="difflineminus">-                }</span>
<a href="#l58.19"></a><span id="l58.19" class="difflineminus">-            )</span>
<a href="#l58.20"></a><span id="l58.20" class="difflineplus">+                    className: style + &quot; tab&quot;,</span>
<a href="#l58.21"></a><span id="l58.21" class="difflineplus">+                    key: &quot;tabkey&quot; + index,</span>
<a href="#l58.22"></a><span id="l58.22" class="difflineplus">+                    onClick: this.handleChange.bind(this, index)</span>
<a href="#l58.23"></a><span id="l58.23" class="difflineplus">+                }, tab);</span>
<a href="#l58.24"></a><span id="l58.24" class="difflineplus">+            })</span>
<a href="#l58.25"></a><span id="l58.25">         );</span>
<a href="#l58.26"></a><span id="l58.26">     }</span>
<a href="#l58.27"></a><span id="l58.27"> });</span>
<a href="#l58.28"></a><span id="l58.28"> </span>
<a href="#l58.29"></a><span id="l58.29"> var TextField = React.createClass({</span>
<a href="#l58.30"></a><span id="l58.30">     handleChange: function(event) {</span>
<a href="#l58.31"></a><span id="l58.31">         this.props.onInput(this.props.keyprop, event.target.value);</span>
<a href="#l58.32"></a><span id="l58.32">     },</span>
<a href="#l58.33"></a><span id="l58.33" class="difflineat">@@ -81,30 +78,25 @@ var Checkbox = React.createClass({</span>
<a href="#l58.34"></a><span id="l58.34"> var Dropdown = React.createClass({</span>
<a href="#l58.35"></a><span id="l58.35">     handleChange: function(event) {</span>
<a href="#l58.36"></a><span id="l58.36">         this.props.onInput(this.props.keyprop, event.target.value);</span>
<a href="#l58.37"></a><span id="l58.37">     },</span>
<a href="#l58.38"></a><span id="l58.38">     render: function() {</span>
<a href="#l58.39"></a><span id="l58.39">         return React.DOM.select({</span>
<a href="#l58.40"></a><span id="l58.40">             value: this.props.value,</span>
<a href="#l58.41"></a><span id="l58.41">             onChange: this.handleChange</span>
<a href="#l58.42"></a><span id="l58.42" class="difflineminus">-            },</span>
<a href="#l58.43"></a><span id="l58.43" class="difflineminus">-            this.props.options.map((option, index) =&gt; {</span>
<a href="#l58.44"></a><span id="l58.44" class="difflineminus">-                return React.DOM.option({</span>
<a href="#l58.45"></a><span id="l58.45" class="difflineminus">-                        // could use option[0] here instead of index...</span>
<a href="#l58.46"></a><span id="l58.46" class="difflineminus">-                        key: this.props.keyprop + &quot;Option&quot; + index,</span>
<a href="#l58.47"></a><span id="l58.47" class="difflineminus">-                        onChange: this.handleChange,</span>
<a href="#l58.48"></a><span id="l58.48" class="difflineminus">-                        value: option[0],</span>
<a href="#l58.49"></a><span id="l58.49" class="difflineminus">-                        disabled: this.props.disabled || false</span>
<a href="#l58.50"></a><span id="l58.50" class="difflineminus">-                    },</span>
<a href="#l58.51"></a><span id="l58.51" class="difflineminus">-                    option[1]</span>
<a href="#l58.52"></a><span id="l58.52" class="difflineminus">-                    );</span>
<a href="#l58.53"></a><span id="l58.53" class="difflineminus">-                }</span>
<a href="#l58.54"></a><span id="l58.54" class="difflineminus">-            )</span>
<a href="#l58.55"></a><span id="l58.55" class="difflineminus">-        );</span>
<a href="#l58.56"></a><span id="l58.56" class="difflineplus">+        }, this.props.options.map((option, index) =&gt; {</span>
<a href="#l58.57"></a><span id="l58.57" class="difflineplus">+            return React.DOM.option({</span>
<a href="#l58.58"></a><span id="l58.58" class="difflineplus">+                // could use option[0] here instead of index...</span>
<a href="#l58.59"></a><span id="l58.59" class="difflineplus">+                key: this.props.keyprop + &quot;Option&quot; + index,</span>
<a href="#l58.60"></a><span id="l58.60" class="difflineplus">+                onChange: this.handleChange,</span>
<a href="#l58.61"></a><span id="l58.61" class="difflineplus">+                value: option[0],</span>
<a href="#l58.62"></a><span id="l58.62" class="difflineplus">+                disabled: this.props.disabled || false</span>
<a href="#l58.63"></a><span id="l58.63" class="difflineplus">+            }, option[1]);</span>
<a href="#l58.64"></a><span id="l58.64" class="difflineplus">+        }));</span>
<a href="#l58.65"></a><span id="l58.65">     }</span>
<a href="#l58.66"></a><span id="l58.66"> });</span>
<a href="#l58.67"></a><span id="l58.67"> </span>
<a href="#l58.68"></a><span id="l58.68"> var Link = React.createClass({</span>
<a href="#l58.69"></a><span id="l58.69">     handleClick: function() {</span>
<a href="#l58.70"></a><span id="l58.70">         this.props.onInput(this.props.value);</span>
<a href="#l58.71"></a><span id="l58.71">     },</span>
<a href="#l58.72"></a><span id="l58.72">     render: function() {</span>
<a href="#l58.73"></a><span id="l58.73" class="difflineat">@@ -528,34 +520,28 @@ var TopComponent = React.createClass({</span>
<a href="#l58.74"></a><span id="l58.74">                     showTimeAsDiv</span>
<a href="#l58.75"></a><span id="l58.75">                 )</span>
<a href="#l58.76"></a><span id="l58.76">             );</span>
<a href="#l58.77"></a><span id="l58.77">         } else {</span>
<a href="#l58.78"></a><span id="l58.78">             // narrowview</span>
<a href="#l58.79"></a><span id="l58.79">             let tabpanelChildren = [</span>
<a href="#l58.80"></a><span id="l58.80">                 descriptionDiv,</span>
<a href="#l58.81"></a><span id="l58.81">                 React.DOM.div({</span>
<a href="#l58.82"></a><span id="l58.82" class="difflineminus">-                        className: &quot;wrapper&quot;,</span>
<a href="#l58.83"></a><span id="l58.83" class="difflineminus">-                        style: { flexDirection: &quot;column&quot; },</span>
<a href="#l58.84"></a><span id="l58.84" class="difflineminus">-                    },</span>
<a href="#l58.85"></a><span id="l58.85" class="difflineminus">-                    statusDiv,</span>
<a href="#l58.86"></a><span id="l58.86" class="difflineminus">-                    priorityDiv,</span>
<a href="#l58.87"></a><span id="l58.87" class="difflineminus">-                    showTimeAsDiv</span>
<a href="#l58.88"></a><span id="l58.88" class="difflineminus">-                ),</span>
<a href="#l58.89"></a><span id="l58.89" class="difflineplus">+                    className: &quot;wrapper&quot;,</span>
<a href="#l58.90"></a><span id="l58.90" class="difflineplus">+                    style: { flexDirection: &quot;column&quot; },</span>
<a href="#l58.91"></a><span id="l58.91" class="difflineplus">+                }, statusDiv, priorityDiv, showTimeAsDiv),</span>
<a href="#l58.92"></a><span id="l58.92">                 remindersDiv,</span>
<a href="#l58.93"></a><span id="l58.93">                 attachmentsDiv,</span>
<a href="#l58.94"></a><span id="l58.94">                 attendeesDiv</span>
<a href="#l58.95"></a><span id="l58.95">             ];</span>
<a href="#l58.96"></a><span id="l58.96">             let tabpanels = this.props.tabs.map((elem, index) =&gt; {</span>
<a href="#l58.97"></a><span id="l58.97">                 return React.DOM.div({</span>
<a href="#l58.98"></a><span id="l58.98" class="difflineminus">-                        className: &quot;box tabpanel &quot; + (this.state.activeTab == index ? &quot;&quot; : &quot;hidden&quot;),</span>
<a href="#l58.99"></a><span id="l58.99" class="difflineminus">-                        key: &quot;tabpanelkey &quot; + index</span>
<a href="#l58.100"></a><span id="l58.100" class="difflineminus">-                    },</span>
<a href="#l58.101"></a><span id="l58.101" class="difflineminus">-                    tabpanelChildren[index]</span>
<a href="#l58.102"></a><span id="l58.102" class="difflineminus">-                );</span>
<a href="#l58.103"></a><span id="l58.103" class="difflineplus">+                    className: &quot;box tabpanel &quot; + (this.state.activeTab == index ? &quot;&quot; : &quot;hidden&quot;),</span>
<a href="#l58.104"></a><span id="l58.104" class="difflineplus">+                    key: &quot;tabpanelkey &quot; + index</span>
<a href="#l58.105"></a><span id="l58.105" class="difflineplus">+                }, tabpanelChildren[index]);</span>
<a href="#l58.106"></a><span id="l58.106">             });</span>
<a href="#l58.107"></a><span id="l58.107">             return React.DOM.div({ id: &quot;topwrapper&quot; },</span>
<a href="#l58.108"></a><span id="l58.108">                 React.DOM.div({ className: &quot;wrapper&quot; },</span>
<a href="#l58.109"></a><span id="l58.109">                     titleDiv,</span>
<a href="#l58.110"></a><span id="l58.110">                     locationDiv,</span>
<a href="#l58.111"></a><span id="l58.111">                     startDiv,</span>
<a href="#l58.112"></a><span id="l58.112">                     endDiv,</span>
<a href="#l58.113"></a><span id="l58.113">                     allDayDiv,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/lightning/content/imip-bar.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/lightning/content/imip-bar.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -19,17 +19,17 @@ var ltnImipBar = {</span>
<a href="#l59.4"></a><span id="l59.4">     itipItem: null,</span>
<a href="#l59.5"></a><span id="l59.5">     foundItems: null,</span>
<a href="#l59.6"></a><span id="l59.6">     msgOverlay: null,</span>
<a href="#l59.7"></a><span id="l59.7"> </span>
<a href="#l59.8"></a><span id="l59.8">     /**</span>
<a href="#l59.9"></a><span id="l59.9">      * Thunderbird Message listener interface, hide the bar before we begin</span>
<a href="#l59.10"></a><span id="l59.10">      */</span>
<a href="#l59.11"></a><span id="l59.11">     onStartHeaders: function() {</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-      ltnImipBar.resetBar();</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+        ltnImipBar.resetBar();</span>
<a href="#l59.14"></a><span id="l59.14">     },</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16">     /**</span>
<a href="#l59.17"></a><span id="l59.17">      * Thunderbird Message listener interface</span>
<a href="#l59.18"></a><span id="l59.18">      */</span>
<a href="#l59.19"></a><span id="l59.19">     onEndHeaders: function() {</span>
<a href="#l59.20"></a><span id="l59.20"> </span>
<a href="#l59.21"></a><span id="l59.21">     },</span>
<a href="#l59.22"></a><span id="l59.22" class="difflineat">@@ -165,18 +165,18 @@ var ltnImipBar = {</span>
<a href="#l59.23"></a><span id="l59.23">                 button.hidden = true;</span>
<a href="#l59.24"></a><span id="l59.24">             } else if (button.type == &quot;menu-button&quot;) {</span>
<a href="#l59.25"></a><span id="l59.25">                 if (items.length == 0 ||</span>
<a href="#l59.26"></a><span id="l59.26">                     (items.length == 1 &amp;&amp;</span>
<a href="#l59.27"></a><span id="l59.27">                      button.hasAttribute(&quot;oncommand&quot;) &amp;&amp;</span>
<a href="#l59.28"></a><span id="l59.28">                      items[0].hasAttribute(&quot;oncommand&quot;) &amp;&amp;</span>
<a href="#l59.29"></a><span id="l59.29">                      button.getAttribute(&quot;oncommand&quot;)</span>
<a href="#l59.30"></a><span id="l59.30">                            .endsWith(items[0].getAttribute(&quot;oncommand&quot;)))) {</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineminus">-                   // convert to simple button</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineminus">-                   button.removeAttribute(&quot;type&quot;);</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineplus">+                    // convert to simple button</span>
<a href="#l59.34"></a><span id="l59.34" class="difflineplus">+                    button.removeAttribute(&quot;type&quot;);</span>
<a href="#l59.35"></a><span id="l59.35">                 }</span>
<a href="#l59.36"></a><span id="l59.36">             }</span>
<a href="#l59.37"></a><span id="l59.37">         }</span>
<a href="#l59.38"></a><span id="l59.38">     },</span>
<a href="#l59.39"></a><span id="l59.39"> </span>
<a href="#l59.40"></a><span id="l59.40">     /**</span>
<a href="#l59.41"></a><span id="l59.41">      * This is our callback function that is called each time the itip bar UI needs updating.</span>
<a href="#l59.42"></a><span id="l59.42">      * NOTE: This function is called without a valid this-context!</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -55,25 +55,25 @@ var gConfig = {</span>
<a href="#l60.4"></a><span id="l60.4">     percentComplete: 0</span>
<a href="#l60.5"></a><span id="l60.5"> };</span>
<a href="#l60.6"></a><span id="l60.6"> // The following variables are set by the load handler function of the</span>
<a href="#l60.7"></a><span id="l60.7"> // parent context, so that they are already set before iframe content load:</span>
<a href="#l60.8"></a><span id="l60.8"> //   - gTimezoneEnabled</span>
<a href="#l60.9"></a><span id="l60.9"> //   - gShowLink</span>
<a href="#l60.10"></a><span id="l60.10"> </span>
<a href="#l60.11"></a><span id="l60.11"> var eventDialogQuitObserver = {</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-  observe: function(aSubject, aTopic, aData) {</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-    // Check whether or not we want to veto the quit request (unless another</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineminus">-    // observer already did.</span>
<a href="#l60.15"></a><span id="l60.15" class="difflineminus">-    if (aTopic == &quot;quit-application-requested&quot; &amp;&amp;</span>
<a href="#l60.16"></a><span id="l60.16" class="difflineminus">-        (aSubject instanceof Components.interfaces.nsISupportsPRBool) &amp;&amp;</span>
<a href="#l60.17"></a><span id="l60.17" class="difflineminus">-        !aSubject.data) {</span>
<a href="#l60.18"></a><span id="l60.18" class="difflineminus">-      aSubject.data = !onCancel();</span>
<a href="#l60.19"></a><span id="l60.19" class="difflineplus">+    observe: function(aSubject, aTopic, aData) {</span>
<a href="#l60.20"></a><span id="l60.20" class="difflineplus">+        // Check whether or not we want to veto the quit request (unless another</span>
<a href="#l60.21"></a><span id="l60.21" class="difflineplus">+        // observer already did.</span>
<a href="#l60.22"></a><span id="l60.22" class="difflineplus">+        if (aTopic == &quot;quit-application-requested&quot; &amp;&amp;</span>
<a href="#l60.23"></a><span id="l60.23" class="difflineplus">+            (aSubject instanceof Components.interfaces.nsISupportsPRBool) &amp;&amp;</span>
<a href="#l60.24"></a><span id="l60.24" class="difflineplus">+            !aSubject.data) {</span>
<a href="#l60.25"></a><span id="l60.25" class="difflineplus">+            aSubject.data = !onCancel();</span>
<a href="#l60.26"></a><span id="l60.26" class="difflineplus">+        }</span>
<a href="#l60.27"></a><span id="l60.27">     }</span>
<a href="#l60.28"></a><span id="l60.28" class="difflineminus">-  }</span>
<a href="#l60.29"></a><span id="l60.29"> };</span>
<a href="#l60.30"></a><span id="l60.30"> </span>
<a href="#l60.31"></a><span id="l60.31"> var eventDialogCalendarObserver = {</span>
<a href="#l60.32"></a><span id="l60.32">     target: null,</span>
<a href="#l60.33"></a><span id="l60.33">     isObserving: false,</span>
<a href="#l60.34"></a><span id="l60.34"> </span>
<a href="#l60.35"></a><span id="l60.35">     onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l60.36"></a><span id="l60.36">         if (this.isObserving &amp;&amp; &quot;calendarItem&quot; in window &amp;&amp;</span>
<a href="#l60.37"></a><span id="l60.37" class="difflineat">@@ -2694,35 +2694,35 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l60.38"></a><span id="l60.38">         }</span>
<a href="#l60.39"></a><span id="l60.39"> </span>
<a href="#l60.40"></a><span id="l60.40">         repeatDeck.selectedIndex = 0;</span>
<a href="#l60.41"></a><span id="l60.41"> </span>
<a href="#l60.42"></a><span id="l60.42">         let recRule = createRecurrenceRule();</span>
<a href="#l60.43"></a><span id="l60.43">         recRule.interval = 1;</span>
<a href="#l60.44"></a><span id="l60.44">         switch (repeatValue) {</span>
<a href="#l60.45"></a><span id="l60.45">             case &quot;daily&quot;:</span>
<a href="#l60.46"></a><span id="l60.46" class="difflineminus">-              recRule.type = &quot;DAILY&quot;;</span>
<a href="#l60.47"></a><span id="l60.47" class="difflineminus">-              break;</span>
<a href="#l60.48"></a><span id="l60.48" class="difflineplus">+                recRule.type = &quot;DAILY&quot;;</span>
<a href="#l60.49"></a><span id="l60.49" class="difflineplus">+                break;</span>
<a href="#l60.50"></a><span id="l60.50">             case &quot;weekly&quot;:</span>
<a href="#l60.51"></a><span id="l60.51" class="difflineminus">-              recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l60.52"></a><span id="l60.52" class="difflineminus">-              break;</span>
<a href="#l60.53"></a><span id="l60.53" class="difflineplus">+                recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l60.54"></a><span id="l60.54" class="difflineplus">+                break;</span>
<a href="#l60.55"></a><span id="l60.55">             case &quot;every.weekday&quot;:</span>
<a href="#l60.56"></a><span id="l60.56" class="difflineminus">-              recRule.type = &quot;DAILY&quot;;</span>
<a href="#l60.57"></a><span id="l60.57" class="difflineminus">-              recRule.setComponent(&quot;BYDAY&quot;, onDays.length, [2, 3, 4, 5, 6]);</span>
<a href="#l60.58"></a><span id="l60.58" class="difflineminus">-              break;</span>
<a href="#l60.59"></a><span id="l60.59" class="difflineplus">+                recRule.type = &quot;DAILY&quot;;</span>
<a href="#l60.60"></a><span id="l60.60" class="difflineplus">+                recRule.setComponent(&quot;BYDAY&quot;, onDays.length, [2, 3, 4, 5, 6]);</span>
<a href="#l60.61"></a><span id="l60.61" class="difflineplus">+                break;</span>
<a href="#l60.62"></a><span id="l60.62">             case &quot;bi.weekly&quot;:</span>
<a href="#l60.63"></a><span id="l60.63" class="difflineminus">-              recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l60.64"></a><span id="l60.64" class="difflineminus">-              recRule.interval = 2;</span>
<a href="#l60.65"></a><span id="l60.65" class="difflineminus">-              break;</span>
<a href="#l60.66"></a><span id="l60.66" class="difflineplus">+                recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l60.67"></a><span id="l60.67" class="difflineplus">+                recRule.interval = 2;</span>
<a href="#l60.68"></a><span id="l60.68" class="difflineplus">+                break;</span>
<a href="#l60.69"></a><span id="l60.69">             case &quot;monthly&quot;:</span>
<a href="#l60.70"></a><span id="l60.70" class="difflineminus">-              recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l60.71"></a><span id="l60.71" class="difflineminus">-              break;</span>
<a href="#l60.72"></a><span id="l60.72" class="difflineplus">+                recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l60.73"></a><span id="l60.73" class="difflineplus">+                break;</span>
<a href="#l60.74"></a><span id="l60.74">             case &quot;yearly&quot;:</span>
<a href="#l60.75"></a><span id="l60.75" class="difflineminus">-              recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l60.76"></a><span id="l60.76" class="difflineminus">-              break;</span>
<a href="#l60.77"></a><span id="l60.77" class="difflineplus">+                recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l60.78"></a><span id="l60.78" class="difflineplus">+                break;</span>
<a href="#l60.79"></a><span id="l60.79">         }</span>
<a href="#l60.80"></a><span id="l60.80"> </span>
<a href="#l60.81"></a><span id="l60.81">         setUpEntrydateForTask(item);</span>
<a href="#l60.82"></a><span id="l60.82">         updateUntildateRecRule(recRule);</span>
<a href="#l60.83"></a><span id="l60.83"> </span>
<a href="#l60.84"></a><span id="l60.84">         recurrenceInfo.insertRecurrenceItemAt(recRule, 0);</span>
<a href="#l60.85"></a><span id="l60.85">         window.recurrenceInfo = recurrenceInfo;</span>
<a href="#l60.86"></a><span id="l60.86"> </span>
<a href="#l60.87"></a><span id="l60.87" class="difflineat">@@ -2799,99 +2799,99 @@ function updateUntildateRecRule(recRule)</span>
<a href="#l60.88"></a><span id="l60.88">  * Updates the UI controls related to a task's completion status.</span>
<a href="#l60.89"></a><span id="l60.89">  *</span>
<a href="#l60.90"></a><span id="l60.90">  * @param {string} aStatus       The item's completion status or a string</span>
<a href="#l60.91"></a><span id="l60.91">  *                               that allows to identify a change in the</span>
<a href="#l60.92"></a><span id="l60.92">  *                               percent-complete's textbox.</span>
<a href="#l60.93"></a><span id="l60.93">  * @param {Date} aCompletedDate  The item's completed date (as a JSDate).</span>
<a href="#l60.94"></a><span id="l60.94">  */</span>
<a href="#l60.95"></a><span id="l60.95"> function updateToDoStatus(aStatus, aCompletedDate=null) {</span>
<a href="#l60.96"></a><span id="l60.96" class="difflineminus">-  // RFC2445 doesn't support completedDates without the todo's status</span>
<a href="#l60.97"></a><span id="l60.97" class="difflineminus">-  // being &quot;COMPLETED&quot;, however twiddling the status menulist shouldn't</span>
<a href="#l60.98"></a><span id="l60.98" class="difflineminus">-  // destroy that information at this point (in case you change status</span>
<a href="#l60.99"></a><span id="l60.99" class="difflineminus">-  // back to COMPLETED). When we go to store this VTODO as .ics the</span>
<a href="#l60.100"></a><span id="l60.100" class="difflineminus">-  // date will get lost.</span>
<a href="#l60.101"></a><span id="l60.101" class="difflineminus">-</span>
<a href="#l60.102"></a><span id="l60.102" class="difflineminus">-  // remember the original values</span>
<a href="#l60.103"></a><span id="l60.103" class="difflineminus">-  let oldPercentComplete = parseInt(getElementValue(&quot;percent-complete-textbox&quot;), 10);</span>
<a href="#l60.104"></a><span id="l60.104" class="difflineminus">-  let oldCompletedDate = getElementValue(&quot;completed-date-picker&quot;);</span>
<a href="#l60.105"></a><span id="l60.105" class="difflineminus">-</span>
<a href="#l60.106"></a><span id="l60.106" class="difflineminus">-  // If the percent completed has changed to 100 or from 100 to another</span>
<a href="#l60.107"></a><span id="l60.107" class="difflineminus">-  // value, the status must change.</span>
<a href="#l60.108"></a><span id="l60.108" class="difflineminus">-  if (aStatus == &quot;percent-changed&quot;) {</span>
<a href="#l60.109"></a><span id="l60.109" class="difflineminus">-      let selectedIndex = document.getElementById(&quot;todo-status&quot;).selectedIndex;</span>
<a href="#l60.110"></a><span id="l60.110" class="difflineminus">-      let menuItemCompleted = selectedIndex == 3;</span>
<a href="#l60.111"></a><span id="l60.111" class="difflineminus">-      let menuItemNotSpecified = selectedIndex == 0;</span>
<a href="#l60.112"></a><span id="l60.112" class="difflineminus">-      if (oldPercentComplete == 100) {</span>
<a href="#l60.113"></a><span id="l60.113" class="difflineminus">-          aStatus = &quot;COMPLETED&quot;;</span>
<a href="#l60.114"></a><span id="l60.114" class="difflineminus">-      } else if (menuItemCompleted || menuItemNotSpecified) {</span>
<a href="#l60.115"></a><span id="l60.115" class="difflineminus">-          aStatus = &quot;IN-PROCESS&quot;;</span>
<a href="#l60.116"></a><span id="l60.116" class="difflineminus">-      }</span>
<a href="#l60.117"></a><span id="l60.117" class="difflineminus">-  }</span>
<a href="#l60.118"></a><span id="l60.118" class="difflineminus">-</span>
<a href="#l60.119"></a><span id="l60.119" class="difflineminus">-  switch (aStatus) {</span>
<a href="#l60.120"></a><span id="l60.120" class="difflineminus">-      case null:</span>
<a href="#l60.121"></a><span id="l60.121" class="difflineminus">-      case &quot;&quot;:</span>
<a href="#l60.122"></a><span id="l60.122" class="difflineminus">-      case &quot;NONE&quot;:</span>
<a href="#l60.123"></a><span id="l60.123" class="difflineminus">-          oldPercentComplete = 0;</span>
<a href="#l60.124"></a><span id="l60.124" class="difflineminus">-          document.getElementById(&quot;todo-status&quot;).selectedIndex = 0;</span>
<a href="#l60.125"></a><span id="l60.125" class="difflineminus">-          disableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.126"></a><span id="l60.126" class="difflineminus">-          disableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.127"></a><span id="l60.127" class="difflineminus">-          break;</span>
<a href="#l60.128"></a><span id="l60.128" class="difflineminus">-      case &quot;CANCELLED&quot;:</span>
<a href="#l60.129"></a><span id="l60.129" class="difflineminus">-          document.getElementById(&quot;todo-status&quot;).selectedIndex = 4;</span>
<a href="#l60.130"></a><span id="l60.130" class="difflineminus">-          disableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.131"></a><span id="l60.131" class="difflineminus">-          disableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.132"></a><span id="l60.132" class="difflineminus">-          break;</span>
<a href="#l60.133"></a><span id="l60.133" class="difflineminus">-      case &quot;COMPLETED&quot;:</span>
<a href="#l60.134"></a><span id="l60.134" class="difflineminus">-          document.getElementById(&quot;todo-status&quot;).selectedIndex = 3;</span>
<a href="#l60.135"></a><span id="l60.135" class="difflineminus">-          enableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.136"></a><span id="l60.136" class="difflineminus">-          enableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.137"></a><span id="l60.137" class="difflineminus">-          // if there is no aCompletedDate, set it to the previous value</span>
<a href="#l60.138"></a><span id="l60.138" class="difflineminus">-          if (!aCompletedDate) {</span>
<a href="#l60.139"></a><span id="l60.139" class="difflineminus">-              aCompletedDate = oldCompletedDate;</span>
<a href="#l60.140"></a><span id="l60.140" class="difflineminus">-          }</span>
<a href="#l60.141"></a><span id="l60.141" class="difflineminus">-          break;</span>
<a href="#l60.142"></a><span id="l60.142" class="difflineminus">-      case &quot;IN-PROCESS&quot;:</span>
<a href="#l60.143"></a><span id="l60.143" class="difflineminus">-          document.getElementById(&quot;todo-status&quot;).selectedIndex = 2;</span>
<a href="#l60.144"></a><span id="l60.144" class="difflineminus">-          disableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.145"></a><span id="l60.145" class="difflineminus">-          enableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.146"></a><span id="l60.146" class="difflineminus">-          enableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.147"></a><span id="l60.147" class="difflineminus">-          break;</span>
<a href="#l60.148"></a><span id="l60.148" class="difflineminus">-      case &quot;NEEDS-ACTION&quot;:</span>
<a href="#l60.149"></a><span id="l60.149" class="difflineminus">-          document.getElementById(&quot;todo-status&quot;).selectedIndex = 1;</span>
<a href="#l60.150"></a><span id="l60.150" class="difflineminus">-          enableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.151"></a><span id="l60.151" class="difflineminus">-          enableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.152"></a><span id="l60.152" class="difflineminus">-          break;</span>
<a href="#l60.153"></a><span id="l60.153" class="difflineminus">-  }</span>
<a href="#l60.154"></a><span id="l60.154" class="difflineminus">-</span>
<a href="#l60.155"></a><span id="l60.155" class="difflineminus">-  let newPercentComplete;</span>
<a href="#l60.156"></a><span id="l60.156" class="difflineminus">-  if ((aStatus == &quot;IN-PROCESS&quot; || aStatus == &quot;NEEDS-ACTION&quot;) &amp;&amp;</span>
<a href="#l60.157"></a><span id="l60.157" class="difflineminus">-      oldPercentComplete == 100) {</span>
<a href="#l60.158"></a><span id="l60.158" class="difflineminus">-      newPercentComplete = 0;</span>
<a href="#l60.159"></a><span id="l60.159" class="difflineminus">-      setElementValue(&quot;completed-date-picker&quot;, oldCompletedDate);</span>
<a href="#l60.160"></a><span id="l60.160" class="difflineminus">-      disableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.161"></a><span id="l60.161" class="difflineminus">-  } else if (aStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l60.162"></a><span id="l60.162" class="difflineminus">-      newPercentComplete = 100;</span>
<a href="#l60.163"></a><span id="l60.163" class="difflineminus">-      setElementValue(&quot;completed-date-picker&quot;, aCompletedDate);</span>
<a href="#l60.164"></a><span id="l60.164" class="difflineminus">-      enableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.165"></a><span id="l60.165" class="difflineminus">-  } else {</span>
<a href="#l60.166"></a><span id="l60.166" class="difflineminus">-      newPercentComplete = oldPercentComplete;</span>
<a href="#l60.167"></a><span id="l60.167" class="difflineminus">-      setElementValue(&quot;completed-date-picker&quot;, oldCompletedDate);</span>
<a href="#l60.168"></a><span id="l60.168" class="difflineminus">-      disableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.169"></a><span id="l60.169" class="difflineminus">-  }</span>
<a href="#l60.170"></a><span id="l60.170" class="difflineminus">-</span>
<a href="#l60.171"></a><span id="l60.171" class="difflineminus">-  gConfig.percentComplete = newPercentComplete;</span>
<a href="#l60.172"></a><span id="l60.172" class="difflineminus">-  setElementValue(&quot;percent-complete-textbox&quot;, newPercentComplete);</span>
<a href="#l60.173"></a><span id="l60.173" class="difflineminus">-  if (gInTab) {</span>
<a href="#l60.174"></a><span id="l60.174" class="difflineminus">-      sendMessage({</span>
<a href="#l60.175"></a><span id="l60.175" class="difflineminus">-          command: &quot;updateConfigState&quot;,</span>
<a href="#l60.176"></a><span id="l60.176" class="difflineminus">-          argument: { percentComplete: newPercentComplete }</span>
<a href="#l60.177"></a><span id="l60.177" class="difflineminus">-      });</span>
<a href="#l60.178"></a><span id="l60.178" class="difflineminus">-  }</span>
<a href="#l60.179"></a><span id="l60.179" class="difflineplus">+    // RFC2445 doesn't support completedDates without the todo's status</span>
<a href="#l60.180"></a><span id="l60.180" class="difflineplus">+    // being &quot;COMPLETED&quot;, however twiddling the status menulist shouldn't</span>
<a href="#l60.181"></a><span id="l60.181" class="difflineplus">+    // destroy that information at this point (in case you change status</span>
<a href="#l60.182"></a><span id="l60.182" class="difflineplus">+    // back to COMPLETED). When we go to store this VTODO as .ics the</span>
<a href="#l60.183"></a><span id="l60.183" class="difflineplus">+    // date will get lost.</span>
<a href="#l60.184"></a><span id="l60.184" class="difflineplus">+</span>
<a href="#l60.185"></a><span id="l60.185" class="difflineplus">+    // remember the original values</span>
<a href="#l60.186"></a><span id="l60.186" class="difflineplus">+    let oldPercentComplete = parseInt(getElementValue(&quot;percent-complete-textbox&quot;), 10);</span>
<a href="#l60.187"></a><span id="l60.187" class="difflineplus">+    let oldCompletedDate = getElementValue(&quot;completed-date-picker&quot;);</span>
<a href="#l60.188"></a><span id="l60.188" class="difflineplus">+</span>
<a href="#l60.189"></a><span id="l60.189" class="difflineplus">+    // If the percent completed has changed to 100 or from 100 to another</span>
<a href="#l60.190"></a><span id="l60.190" class="difflineplus">+    // value, the status must change.</span>
<a href="#l60.191"></a><span id="l60.191" class="difflineplus">+    if (aStatus == &quot;percent-changed&quot;) {</span>
<a href="#l60.192"></a><span id="l60.192" class="difflineplus">+        let selectedIndex = document.getElementById(&quot;todo-status&quot;).selectedIndex;</span>
<a href="#l60.193"></a><span id="l60.193" class="difflineplus">+        let menuItemCompleted = selectedIndex == 3;</span>
<a href="#l60.194"></a><span id="l60.194" class="difflineplus">+        let menuItemNotSpecified = selectedIndex == 0;</span>
<a href="#l60.195"></a><span id="l60.195" class="difflineplus">+        if (oldPercentComplete == 100) {</span>
<a href="#l60.196"></a><span id="l60.196" class="difflineplus">+            aStatus = &quot;COMPLETED&quot;;</span>
<a href="#l60.197"></a><span id="l60.197" class="difflineplus">+        } else if (menuItemCompleted || menuItemNotSpecified) {</span>
<a href="#l60.198"></a><span id="l60.198" class="difflineplus">+            aStatus = &quot;IN-PROCESS&quot;;</span>
<a href="#l60.199"></a><span id="l60.199" class="difflineplus">+        }</span>
<a href="#l60.200"></a><span id="l60.200" class="difflineplus">+    }</span>
<a href="#l60.201"></a><span id="l60.201" class="difflineplus">+</span>
<a href="#l60.202"></a><span id="l60.202" class="difflineplus">+    switch (aStatus) {</span>
<a href="#l60.203"></a><span id="l60.203" class="difflineplus">+        case null:</span>
<a href="#l60.204"></a><span id="l60.204" class="difflineplus">+        case &quot;&quot;:</span>
<a href="#l60.205"></a><span id="l60.205" class="difflineplus">+        case &quot;NONE&quot;:</span>
<a href="#l60.206"></a><span id="l60.206" class="difflineplus">+            oldPercentComplete = 0;</span>
<a href="#l60.207"></a><span id="l60.207" class="difflineplus">+            document.getElementById(&quot;todo-status&quot;).selectedIndex = 0;</span>
<a href="#l60.208"></a><span id="l60.208" class="difflineplus">+            disableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.209"></a><span id="l60.209" class="difflineplus">+            disableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.210"></a><span id="l60.210" class="difflineplus">+            break;</span>
<a href="#l60.211"></a><span id="l60.211" class="difflineplus">+        case &quot;CANCELLED&quot;:</span>
<a href="#l60.212"></a><span id="l60.212" class="difflineplus">+            document.getElementById(&quot;todo-status&quot;).selectedIndex = 4;</span>
<a href="#l60.213"></a><span id="l60.213" class="difflineplus">+            disableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.214"></a><span id="l60.214" class="difflineplus">+            disableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.215"></a><span id="l60.215" class="difflineplus">+            break;</span>
<a href="#l60.216"></a><span id="l60.216" class="difflineplus">+        case &quot;COMPLETED&quot;:</span>
<a href="#l60.217"></a><span id="l60.217" class="difflineplus">+            document.getElementById(&quot;todo-status&quot;).selectedIndex = 3;</span>
<a href="#l60.218"></a><span id="l60.218" class="difflineplus">+            enableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.219"></a><span id="l60.219" class="difflineplus">+            enableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.220"></a><span id="l60.220" class="difflineplus">+            // if there is no aCompletedDate, set it to the previous value</span>
<a href="#l60.221"></a><span id="l60.221" class="difflineplus">+            if (!aCompletedDate) {</span>
<a href="#l60.222"></a><span id="l60.222" class="difflineplus">+                aCompletedDate = oldCompletedDate;</span>
<a href="#l60.223"></a><span id="l60.223" class="difflineplus">+            }</span>
<a href="#l60.224"></a><span id="l60.224" class="difflineplus">+            break;</span>
<a href="#l60.225"></a><span id="l60.225" class="difflineplus">+        case &quot;IN-PROCESS&quot;:</span>
<a href="#l60.226"></a><span id="l60.226" class="difflineplus">+            document.getElementById(&quot;todo-status&quot;).selectedIndex = 2;</span>
<a href="#l60.227"></a><span id="l60.227" class="difflineplus">+            disableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.228"></a><span id="l60.228" class="difflineplus">+            enableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.229"></a><span id="l60.229" class="difflineplus">+            enableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.230"></a><span id="l60.230" class="difflineplus">+            break;</span>
<a href="#l60.231"></a><span id="l60.231" class="difflineplus">+        case &quot;NEEDS-ACTION&quot;:</span>
<a href="#l60.232"></a><span id="l60.232" class="difflineplus">+            document.getElementById(&quot;todo-status&quot;).selectedIndex = 1;</span>
<a href="#l60.233"></a><span id="l60.233" class="difflineplus">+            enableElement(&quot;percent-complete-textbox&quot;);</span>
<a href="#l60.234"></a><span id="l60.234" class="difflineplus">+            enableElement(&quot;percent-complete-label&quot;);</span>
<a href="#l60.235"></a><span id="l60.235" class="difflineplus">+            break;</span>
<a href="#l60.236"></a><span id="l60.236" class="difflineplus">+    }</span>
<a href="#l60.237"></a><span id="l60.237" class="difflineplus">+</span>
<a href="#l60.238"></a><span id="l60.238" class="difflineplus">+    let newPercentComplete;</span>
<a href="#l60.239"></a><span id="l60.239" class="difflineplus">+    if ((aStatus == &quot;IN-PROCESS&quot; || aStatus == &quot;NEEDS-ACTION&quot;) &amp;&amp;</span>
<a href="#l60.240"></a><span id="l60.240" class="difflineplus">+        oldPercentComplete == 100) {</span>
<a href="#l60.241"></a><span id="l60.241" class="difflineplus">+        newPercentComplete = 0;</span>
<a href="#l60.242"></a><span id="l60.242" class="difflineplus">+        setElementValue(&quot;completed-date-picker&quot;, oldCompletedDate);</span>
<a href="#l60.243"></a><span id="l60.243" class="difflineplus">+        disableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.244"></a><span id="l60.244" class="difflineplus">+    } else if (aStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l60.245"></a><span id="l60.245" class="difflineplus">+        newPercentComplete = 100;</span>
<a href="#l60.246"></a><span id="l60.246" class="difflineplus">+        setElementValue(&quot;completed-date-picker&quot;, aCompletedDate);</span>
<a href="#l60.247"></a><span id="l60.247" class="difflineplus">+        enableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.248"></a><span id="l60.248" class="difflineplus">+    } else {</span>
<a href="#l60.249"></a><span id="l60.249" class="difflineplus">+        newPercentComplete = oldPercentComplete;</span>
<a href="#l60.250"></a><span id="l60.250" class="difflineplus">+        setElementValue(&quot;completed-date-picker&quot;, oldCompletedDate);</span>
<a href="#l60.251"></a><span id="l60.251" class="difflineplus">+        disableElement(&quot;completed-date-picker&quot;);</span>
<a href="#l60.252"></a><span id="l60.252" class="difflineplus">+    }</span>
<a href="#l60.253"></a><span id="l60.253" class="difflineplus">+</span>
<a href="#l60.254"></a><span id="l60.254" class="difflineplus">+    gConfig.percentComplete = newPercentComplete;</span>
<a href="#l60.255"></a><span id="l60.255" class="difflineplus">+    setElementValue(&quot;percent-complete-textbox&quot;, newPercentComplete);</span>
<a href="#l60.256"></a><span id="l60.256" class="difflineplus">+    if (gInTab) {</span>
<a href="#l60.257"></a><span id="l60.257" class="difflineplus">+        sendMessage({</span>
<a href="#l60.258"></a><span id="l60.258" class="difflineplus">+            command: &quot;updateConfigState&quot;,</span>
<a href="#l60.259"></a><span id="l60.259" class="difflineplus">+            argument: { percentComplete: newPercentComplete }</span>
<a href="#l60.260"></a><span id="l60.260" class="difflineplus">+        });</span>
<a href="#l60.261"></a><span id="l60.261" class="difflineplus">+    }</span>
<a href="#l60.262"></a><span id="l60.262"> }</span>
<a href="#l60.263"></a><span id="l60.263"> </span>
<a href="#l60.264"></a><span id="l60.264"> /**</span>
<a href="#l60.265"></a><span id="l60.265">  * Saves all dialog controls back to the item.</span>
<a href="#l60.266"></a><span id="l60.266">  *</span>
<a href="#l60.267"></a><span id="l60.267">  * @return      a copy of the original item with changes made.</span>
<a href="#l60.268"></a><span id="l60.268">  */</span>
<a href="#l60.269"></a><span id="l60.269"> function saveItem() {</span>
<a href="#l60.270"></a><span id="l60.270" class="difflineat">@@ -2911,17 +2911,17 @@ function saveItem() {</span>
<a href="#l60.271"></a><span id="l60.271">     // serialize the item</span>
<a href="#l60.272"></a><span id="l60.272">     saveDialog(item);</span>
<a href="#l60.273"></a><span id="l60.273"> </span>
<a href="#l60.274"></a><span id="l60.274">     item.organizer = window.organizer;</span>
<a href="#l60.275"></a><span id="l60.275"> </span>
<a href="#l60.276"></a><span id="l60.276">     item.removeAllAttendees();</span>
<a href="#l60.277"></a><span id="l60.277">     if (window.attendees &amp;&amp; (window.attendees.length &gt; 0)) {</span>
<a href="#l60.278"></a><span id="l60.278">         for (let attendee of window.attendees) {</span>
<a href="#l60.279"></a><span id="l60.279" class="difflineminus">-           item.addAttendee(attendee);</span>
<a href="#l60.280"></a><span id="l60.280" class="difflineplus">+            item.addAttendee(attendee);</span>
<a href="#l60.281"></a><span id="l60.281">         }</span>
<a href="#l60.282"></a><span id="l60.282"> </span>
<a href="#l60.283"></a><span id="l60.283">         let notifyCheckbox = document.getElementById(&quot;notify-attendees-checkbox&quot;);</span>
<a href="#l60.284"></a><span id="l60.284">         if (notifyCheckbox.disabled) {</span>
<a href="#l60.285"></a><span id="l60.285">             item.deleteProperty(&quot;X-MOZ-SEND-INVITATIONS&quot;);</span>
<a href="#l60.286"></a><span id="l60.286">         } else {</span>
<a href="#l60.287"></a><span id="l60.287">             item.setProperty(&quot;X-MOZ-SEND-INVITATIONS&quot;, notifyCheckbox.checked ? &quot;TRUE&quot; : &quot;FALSE&quot;);</span>
<a href="#l60.288"></a><span id="l60.288">         }</span>
<a href="#l60.289"></a><span id="l60.289" class="difflineat">@@ -3120,17 +3120,17 @@ editStartTimezone.complete = function(da</span>
<a href="#l60.290"></a><span id="l60.290">     let equalTimezones = false;</span>
<a href="#l60.291"></a><span id="l60.291">     if (gStartTimezone &amp;&amp; gEndTimezone) {</span>
<a href="#l60.292"></a><span id="l60.292">         if (gStartTimezone == gEndTimezone) {</span>
<a href="#l60.293"></a><span id="l60.293">             equalTimezones = true;</span>
<a href="#l60.294"></a><span id="l60.294">         }</span>
<a href="#l60.295"></a><span id="l60.295">     }</span>
<a href="#l60.296"></a><span id="l60.296">     gStartTimezone = datetime.timezone;</span>
<a href="#l60.297"></a><span id="l60.297">     if (equalTimezones) {</span>
<a href="#l60.298"></a><span id="l60.298" class="difflineminus">-      gEndTimezone = datetime.timezone;</span>
<a href="#l60.299"></a><span id="l60.299" class="difflineplus">+        gEndTimezone = datetime.timezone;</span>
<a href="#l60.300"></a><span id="l60.300">     }</span>
<a href="#l60.301"></a><span id="l60.301">     updateDateTime();</span>
<a href="#l60.302"></a><span id="l60.302"> };</span>
<a href="#l60.303"></a><span id="l60.303"> </span>
<a href="#l60.304"></a><span id="l60.304"> /**</span>
<a href="#l60.305"></a><span id="l60.305">  * Prompts the user to change the end timezone.</span>
<a href="#l60.306"></a><span id="l60.306">  */</span>
<a href="#l60.307"></a><span id="l60.307"> function editEndTimezone() {</span>
<a href="#l60.308"></a><span id="l60.308" class="difflineat">@@ -3258,78 +3258,78 @@ function updateDateTime() {</span>
<a href="#l60.309"></a><span id="l60.309">     gIgnoreUpdate = true;</span>
<a href="#l60.310"></a><span id="l60.310"> </span>
<a href="#l60.311"></a><span id="l60.311">     let item = window.calendarItem;</span>
<a href="#l60.312"></a><span id="l60.312">     // Convert to default timezone if the timezone option</span>
<a href="#l60.313"></a><span id="l60.313">     // is *not* checked, otherwise keep the specific timezone</span>
<a href="#l60.314"></a><span id="l60.314">     // and display the labels in order to modify the timezone.</span>
<a href="#l60.315"></a><span id="l60.315">     if (gTimezonesEnabled) {</span>
<a href="#l60.316"></a><span id="l60.316">         if (isEvent(item)) {</span>
<a href="#l60.317"></a><span id="l60.317" class="difflineminus">-          let startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l60.318"></a><span id="l60.318" class="difflineminus">-          let endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l60.319"></a><span id="l60.319" class="difflineminus">-</span>
<a href="#l60.320"></a><span id="l60.320" class="difflineminus">-          setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l60.321"></a><span id="l60.321" class="difflineminus">-</span>
<a href="#l60.322"></a><span id="l60.322" class="difflineminus">-          // In the case where the timezones are different but</span>
<a href="#l60.323"></a><span id="l60.323" class="difflineminus">-          // the timezone of the endtime is &quot;UTC&quot;, we convert</span>
<a href="#l60.324"></a><span id="l60.324" class="difflineminus">-          // the endtime into the timezone of the starttime.</span>
<a href="#l60.325"></a><span id="l60.325" class="difflineminus">-          if (startTime &amp;&amp; endTime) {</span>
<a href="#l60.326"></a><span id="l60.326" class="difflineminus">-            if (!compareObjects(startTime.timezone, endTime.timezone)) {</span>
<a href="#l60.327"></a><span id="l60.327" class="difflineminus">-              if (endTime.timezone.isUTC) {</span>
<a href="#l60.328"></a><span id="l60.328" class="difflineminus">-                endTime = endTime.getInTimezone(startTime.timezone);</span>
<a href="#l60.329"></a><span id="l60.329" class="difflineminus">-              }</span>
<a href="#l60.330"></a><span id="l60.330" class="difflineplus">+            let startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l60.331"></a><span id="l60.331" class="difflineplus">+            let endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l60.332"></a><span id="l60.332" class="difflineplus">+</span>
<a href="#l60.333"></a><span id="l60.333" class="difflineplus">+            setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l60.334"></a><span id="l60.334" class="difflineplus">+</span>
<a href="#l60.335"></a><span id="l60.335" class="difflineplus">+            // In the case where the timezones are different but</span>
<a href="#l60.336"></a><span id="l60.336" class="difflineplus">+            // the timezone of the endtime is &quot;UTC&quot;, we convert</span>
<a href="#l60.337"></a><span id="l60.337" class="difflineplus">+            // the endtime into the timezone of the starttime.</span>
<a href="#l60.338"></a><span id="l60.338" class="difflineplus">+            if (startTime &amp;&amp; endTime) {</span>
<a href="#l60.339"></a><span id="l60.339" class="difflineplus">+                if (!compareObjects(startTime.timezone, endTime.timezone)) {</span>
<a href="#l60.340"></a><span id="l60.340" class="difflineplus">+                    if (endTime.timezone.isUTC) {</span>
<a href="#l60.341"></a><span id="l60.341" class="difflineplus">+                        endTime = endTime.getInTimezone(startTime.timezone);</span>
<a href="#l60.342"></a><span id="l60.342" class="difflineplus">+                    }</span>
<a href="#l60.343"></a><span id="l60.343" class="difflineplus">+                }</span>
<a href="#l60.344"></a><span id="l60.344">             }</span>
<a href="#l60.345"></a><span id="l60.345" class="difflineminus">-          }</span>
<a href="#l60.346"></a><span id="l60.346" class="difflineminus">-</span>
<a href="#l60.347"></a><span id="l60.347" class="difflineminus">-          // before feeding the date/time value into the control we need</span>
<a href="#l60.348"></a><span id="l60.348" class="difflineminus">-          // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l60.349"></a><span id="l60.349" class="difflineminus">-          // automatic conversion back into the OS timezone.</span>
<a href="#l60.350"></a><span id="l60.350" class="difflineminus">-          startTime.timezone = floating();</span>
<a href="#l60.351"></a><span id="l60.351" class="difflineminus">-          endTime.timezone = floating();</span>
<a href="#l60.352"></a><span id="l60.352" class="difflineminus">-</span>
<a href="#l60.353"></a><span id="l60.353" class="difflineminus">-          setElementValue(&quot;event-starttime&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.354"></a><span id="l60.354" class="difflineminus">-          setElementValue(&quot;event-endtime&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.355"></a><span id="l60.355" class="difflineplus">+</span>
<a href="#l60.356"></a><span id="l60.356" class="difflineplus">+            // before feeding the date/time value into the control we need</span>
<a href="#l60.357"></a><span id="l60.357" class="difflineplus">+            // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l60.358"></a><span id="l60.358" class="difflineplus">+            // automatic conversion back into the OS timezone.</span>
<a href="#l60.359"></a><span id="l60.359" class="difflineplus">+            startTime.timezone = floating();</span>
<a href="#l60.360"></a><span id="l60.360" class="difflineplus">+            endTime.timezone = floating();</span>
<a href="#l60.361"></a><span id="l60.361" class="difflineplus">+</span>
<a href="#l60.362"></a><span id="l60.362" class="difflineplus">+            setElementValue(&quot;event-starttime&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.363"></a><span id="l60.363" class="difflineplus">+            setElementValue(&quot;event-endtime&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.364"></a><span id="l60.364">         }</span>
<a href="#l60.365"></a><span id="l60.365"> </span>
<a href="#l60.366"></a><span id="l60.366">         if (isToDo(item)) {</span>
<a href="#l60.367"></a><span id="l60.367" class="difflineminus">-          let startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l60.368"></a><span id="l60.368" class="difflineminus">-          let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l60.369"></a><span id="l60.369" class="difflineminus">-          let hasEntryDate = (startTime != null);</span>
<a href="#l60.370"></a><span id="l60.370" class="difflineminus">-          let hasDueDate = (endTime != null);</span>
<a href="#l60.371"></a><span id="l60.371" class="difflineminus">-</span>
<a href="#l60.372"></a><span id="l60.372" class="difflineminus">-          if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l60.373"></a><span id="l60.373" class="difflineminus">-              setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l60.374"></a><span id="l60.374" class="difflineminus">-              startTime.timezone = floating();</span>
<a href="#l60.375"></a><span id="l60.375" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.376"></a><span id="l60.376" class="difflineminus">-</span>
<a href="#l60.377"></a><span id="l60.377" class="difflineminus">-              setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l60.378"></a><span id="l60.378" class="difflineminus">-              endTime.timezone = floating();</span>
<a href="#l60.379"></a><span id="l60.379" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.380"></a><span id="l60.380" class="difflineminus">-          } else if (hasEntryDate) {</span>
<a href="#l60.381"></a><span id="l60.381" class="difflineminus">-              setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l60.382"></a><span id="l60.382" class="difflineminus">-              startTime.timezone = floating();</span>
<a href="#l60.383"></a><span id="l60.383" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.384"></a><span id="l60.384" class="difflineminus">-</span>
<a href="#l60.385"></a><span id="l60.385" class="difflineminus">-              startTime.timezone = floating();</span>
<a href="#l60.386"></a><span id="l60.386" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.387"></a><span id="l60.387" class="difflineminus">-          } else if (hasDueDate) {</span>
<a href="#l60.388"></a><span id="l60.388" class="difflineminus">-              endTime.timezone = floating();</span>
<a href="#l60.389"></a><span id="l60.389" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.390"></a><span id="l60.390" class="difflineminus">-</span>
<a href="#l60.391"></a><span id="l60.391" class="difflineminus">-              setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l60.392"></a><span id="l60.392" class="difflineminus">-              endTime.timezone = floating();</span>
<a href="#l60.393"></a><span id="l60.393" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.394"></a><span id="l60.394" class="difflineminus">-          } else {</span>
<a href="#l60.395"></a><span id="l60.395" class="difflineminus">-              startTime = window.initialStartDateValue;</span>
<a href="#l60.396"></a><span id="l60.396" class="difflineminus">-              startTime.timezone = floating();</span>
<a href="#l60.397"></a><span id="l60.397" class="difflineminus">-              endTime = startTime.clone();</span>
<a href="#l60.398"></a><span id="l60.398" class="difflineminus">-</span>
<a href="#l60.399"></a><span id="l60.399" class="difflineminus">-              setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.400"></a><span id="l60.400" class="difflineminus">-              setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.401"></a><span id="l60.401" class="difflineminus">-          }</span>
<a href="#l60.402"></a><span id="l60.402" class="difflineplus">+            let startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l60.403"></a><span id="l60.403" class="difflineplus">+            let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l60.404"></a><span id="l60.404" class="difflineplus">+            let hasEntryDate = (startTime != null);</span>
<a href="#l60.405"></a><span id="l60.405" class="difflineplus">+            let hasDueDate = (endTime != null);</span>
<a href="#l60.406"></a><span id="l60.406" class="difflineplus">+</span>
<a href="#l60.407"></a><span id="l60.407" class="difflineplus">+            if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l60.408"></a><span id="l60.408" class="difflineplus">+                setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l60.409"></a><span id="l60.409" class="difflineplus">+                startTime.timezone = floating();</span>
<a href="#l60.410"></a><span id="l60.410" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.411"></a><span id="l60.411" class="difflineplus">+</span>
<a href="#l60.412"></a><span id="l60.412" class="difflineplus">+                setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l60.413"></a><span id="l60.413" class="difflineplus">+                endTime.timezone = floating();</span>
<a href="#l60.414"></a><span id="l60.414" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.415"></a><span id="l60.415" class="difflineplus">+            } else if (hasEntryDate) {</span>
<a href="#l60.416"></a><span id="l60.416" class="difflineplus">+                setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l60.417"></a><span id="l60.417" class="difflineplus">+                startTime.timezone = floating();</span>
<a href="#l60.418"></a><span id="l60.418" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.419"></a><span id="l60.419" class="difflineplus">+</span>
<a href="#l60.420"></a><span id="l60.420" class="difflineplus">+                startTime.timezone = floating();</span>
<a href="#l60.421"></a><span id="l60.421" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.422"></a><span id="l60.422" class="difflineplus">+            } else if (hasDueDate) {</span>
<a href="#l60.423"></a><span id="l60.423" class="difflineplus">+                endTime.timezone = floating();</span>
<a href="#l60.424"></a><span id="l60.424" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.425"></a><span id="l60.425" class="difflineplus">+</span>
<a href="#l60.426"></a><span id="l60.426" class="difflineplus">+                setElementValue(&quot;todo-has-duedate&quot;, hasDueDate, &quot;checked&quot;);</span>
<a href="#l60.427"></a><span id="l60.427" class="difflineplus">+                endTime.timezone = floating();</span>
<a href="#l60.428"></a><span id="l60.428" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.429"></a><span id="l60.429" class="difflineplus">+            } else {</span>
<a href="#l60.430"></a><span id="l60.430" class="difflineplus">+                startTime = window.initialStartDateValue;</span>
<a href="#l60.431"></a><span id="l60.431" class="difflineplus">+                startTime.timezone = floating();</span>
<a href="#l60.432"></a><span id="l60.432" class="difflineplus">+                endTime = startTime.clone();</span>
<a href="#l60.433"></a><span id="l60.433" class="difflineplus">+</span>
<a href="#l60.434"></a><span id="l60.434" class="difflineplus">+                setElementValue(&quot;todo-entrydate&quot;, cal.dateTimeToJsDate(startTime));</span>
<a href="#l60.435"></a><span id="l60.435" class="difflineplus">+                setElementValue(&quot;todo-duedate&quot;, cal.dateTimeToJsDate(endTime));</span>
<a href="#l60.436"></a><span id="l60.436" class="difflineplus">+            }</span>
<a href="#l60.437"></a><span id="l60.437">         }</span>
<a href="#l60.438"></a><span id="l60.438">     } else {</span>
<a href="#l60.439"></a><span id="l60.439">         let kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l60.440"></a><span id="l60.440"> </span>
<a href="#l60.441"></a><span id="l60.441">         if (isEvent(item)) {</span>
<a href="#l60.442"></a><span id="l60.442">             let startTime = gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l60.443"></a><span id="l60.443">             let endTime = gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l60.444"></a><span id="l60.444">             setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l60.445"></a><span id="l60.445" class="difflineat">@@ -3515,19 +3515,19 @@ function updateItemURL(aShow, aUrl) {</span>
<a href="#l60.446"></a><span id="l60.446">     let separator = document.getElementById(&quot;event-grid-link-separator&quot;);</span>
<a href="#l60.447"></a><span id="l60.447">     if (separator) {</span>
<a href="#l60.448"></a><span id="l60.448">         setElementValue(&quot;event-grid-link-separator&quot;, !aShow &amp;&amp; &quot;true&quot;, &quot;hidden&quot;);</span>
<a href="#l60.449"></a><span id="l60.449">     }</span>
<a href="#l60.450"></a><span id="l60.450"> </span>
<a href="#l60.451"></a><span id="l60.451">     // Set the url for the link</span>
<a href="#l60.452"></a><span id="l60.452">     if (aShow &amp;&amp; aUrl.length) {</span>
<a href="#l60.453"></a><span id="l60.453">         setTimeout(() =&gt; {</span>
<a href="#l60.454"></a><span id="l60.454" class="difflineminus">-          // HACK the url-link doesn't crop when setting the value in onLoad</span>
<a href="#l60.455"></a><span id="l60.455" class="difflineminus">-          setElementValue(&quot;url-link&quot;, aUrl);</span>
<a href="#l60.456"></a><span id="l60.456" class="difflineminus">-          setElementValue(&quot;url-link&quot;, aUrl, &quot;href&quot;);</span>
<a href="#l60.457"></a><span id="l60.457" class="difflineplus">+            // HACK the url-link doesn't crop when setting the value in onLoad</span>
<a href="#l60.458"></a><span id="l60.458" class="difflineplus">+            setElementValue(&quot;url-link&quot;, aUrl);</span>
<a href="#l60.459"></a><span id="l60.459" class="difflineplus">+            setElementValue(&quot;url-link&quot;, aUrl, &quot;href&quot;);</span>
<a href="#l60.460"></a><span id="l60.460">         }, 0);</span>
<a href="#l60.461"></a><span id="l60.461">     }</span>
<a href="#l60.462"></a><span id="l60.462"> }</span>
<a href="#l60.463"></a><span id="l60.463"> </span>
<a href="#l60.464"></a><span id="l60.464"> </span>
<a href="#l60.465"></a><span id="l60.465"> /**</span>
<a href="#l60.466"></a><span id="l60.466">  * This function updates dialog controls related to attendees.</span>
<a href="#l60.467"></a><span id="l60.467">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -36,121 +36,122 @@ var calendarTabMonitor = {</span>
<a href="#l61.4"></a><span id="l61.4">             aOldTab.mode.name == &quot;task&quot;) {</span>
<a href="#l61.5"></a><span id="l61.5">             calendarController.updateCommands();</span>
<a href="#l61.6"></a><span id="l61.6">             calendarController2.updateCommands();</span>
<a href="#l61.7"></a><span id="l61.7">         }</span>
<a href="#l61.8"></a><span id="l61.8">     }</span>
<a href="#l61.9"></a><span id="l61.9"> };</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11"> var calendarTabType = {</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  name: &quot;calendar&quot;,</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineminus">-  panelId: &quot;calendarTabPanel&quot;,</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineminus">-  modes: {</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineminus">-    calendar: {</span>
<a href="#l61.16"></a><span id="l61.16" class="difflineminus">-      type: &quot;calendar&quot;,</span>
<a href="#l61.17"></a><span id="l61.17" class="difflineminus">-      maxTabs: 1,</span>
<a href="#l61.18"></a><span id="l61.18" class="difflineminus">-      openTab: function(aTab, aArgs) {</span>
<a href="#l61.19"></a><span id="l61.19" class="difflineminus">-        aTab.title = aArgs.title;</span>
<a href="#l61.20"></a><span id="l61.20" class="difflineminus">-        if (!(&quot;background&quot; in aArgs) || !aArgs.background) {</span>
<a href="#l61.21"></a><span id="l61.21" class="difflineminus">-            // Only do calendar mode switching if the tab is opened in</span>
<a href="#l61.22"></a><span id="l61.22" class="difflineminus">-            // foreground.</span>
<a href="#l61.23"></a><span id="l61.23" class="difflineminus">-            ltnSwitch2Calendar();</span>
<a href="#l61.24"></a><span id="l61.24" class="difflineminus">-        }</span>
<a href="#l61.25"></a><span id="l61.25" class="difflineminus">-      },</span>
<a href="#l61.26"></a><span id="l61.26" class="difflineplus">+    name: &quot;calendar&quot;,</span>
<a href="#l61.27"></a><span id="l61.27" class="difflineplus">+    panelId: &quot;calendarTabPanel&quot;,</span>
<a href="#l61.28"></a><span id="l61.28" class="difflineplus">+    modes: {</span>
<a href="#l61.29"></a><span id="l61.29" class="difflineplus">+        calendar: {</span>
<a href="#l61.30"></a><span id="l61.30" class="difflineplus">+            type: &quot;calendar&quot;,</span>
<a href="#l61.31"></a><span id="l61.31" class="difflineplus">+            maxTabs: 1,</span>
<a href="#l61.32"></a><span id="l61.32" class="difflineplus">+            openTab: function(aTab, aArgs) {</span>
<a href="#l61.33"></a><span id="l61.33" class="difflineplus">+                aTab.title = aArgs.title;</span>
<a href="#l61.34"></a><span id="l61.34" class="difflineplus">+                if (!(&quot;background&quot; in aArgs) || !aArgs.background) {</span>
<a href="#l61.35"></a><span id="l61.35" class="difflineplus">+                    // Only do calendar mode switching if the tab is opened in</span>
<a href="#l61.36"></a><span id="l61.36" class="difflineplus">+                    // foreground.</span>
<a href="#l61.37"></a><span id="l61.37" class="difflineplus">+                    ltnSwitch2Calendar();</span>
<a href="#l61.38"></a><span id="l61.38" class="difflineplus">+                }</span>
<a href="#l61.39"></a><span id="l61.39" class="difflineplus">+            },</span>
<a href="#l61.40"></a><span id="l61.40" class="difflineplus">+</span>
<a href="#l61.41"></a><span id="l61.41" class="difflineplus">+            showTab: function(aTab) {</span>
<a href="#l61.42"></a><span id="l61.42" class="difflineplus">+                ltnSwitch2Calendar();</span>
<a href="#l61.43"></a><span id="l61.43" class="difflineplus">+            },</span>
<a href="#l61.44"></a><span id="l61.44" class="difflineplus">+            closeTab: function(aTab) {</span>
<a href="#l61.45"></a><span id="l61.45" class="difflineplus">+                if (gCurrentMode == &quot;calendar&quot;) {</span>
<a href="#l61.46"></a><span id="l61.46" class="difflineplus">+                    // Only revert menu hacks if closing the active tab, otherwise we</span>
<a href="#l61.47"></a><span id="l61.47" class="difflineplus">+                    // would switch to mail mode even if in task mode and closing the</span>
<a href="#l61.48"></a><span id="l61.48" class="difflineplus">+                    // calendar tab.</span>
<a href="#l61.49"></a><span id="l61.49" class="difflineplus">+                    ltnSwitch2Mail();</span>
<a href="#l61.50"></a><span id="l61.50" class="difflineplus">+                }</span>
<a href="#l61.51"></a><span id="l61.51" class="difflineplus">+            },</span>
<a href="#l61.52"></a><span id="l61.52" class="difflineplus">+</span>
<a href="#l61.53"></a><span id="l61.53" class="difflineplus">+            persistTab: function(aTab) {</span>
<a href="#l61.54"></a><span id="l61.54" class="difflineplus">+                let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l61.55"></a><span id="l61.55" class="difflineplus">+                return {</span>
<a href="#l61.56"></a><span id="l61.56" class="difflineplus">+                    // Since we do strange tab switching logic in ltnSwitch2Calendar,</span>
<a href="#l61.57"></a><span id="l61.57" class="difflineplus">+                    // we should store the current tab state ourselves.</span>
<a href="#l61.58"></a><span id="l61.58" class="difflineplus">+                    background: (aTab != tabmail.currentTabInfo)</span>
<a href="#l61.59"></a><span id="l61.59" class="difflineplus">+                };</span>
<a href="#l61.60"></a><span id="l61.60" class="difflineplus">+            },</span>
<a href="#l61.61"></a><span id="l61.61" class="difflineplus">+</span>
<a href="#l61.62"></a><span id="l61.62" class="difflineplus">+            restoreTab: function(aTabmail, aState) {</span>
<a href="#l61.63"></a><span id="l61.63" class="difflineplus">+                aState.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleCalendar&quot;);</span>
<a href="#l61.64"></a><span id="l61.64" class="difflineplus">+                aTabmail.openTab(&quot;calendar&quot;, aState);</span>
<a href="#l61.65"></a><span id="l61.65" class="difflineplus">+            },</span>
<a href="#l61.66"></a><span id="l61.66" class="difflineplus">+</span>
<a href="#l61.67"></a><span id="l61.67" class="difflineplus">+            onTitleChanged: function(aTab) {</span>
<a href="#l61.68"></a><span id="l61.68" class="difflineplus">+                aTab.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleCalendar&quot;);</span>
<a href="#l61.69"></a><span id="l61.69" class="difflineplus">+            },</span>
<a href="#l61.70"></a><span id="l61.70"> </span>
<a href="#l61.71"></a><span id="l61.71" class="difflineminus">-      showTab: function(aTab) {</span>
<a href="#l61.72"></a><span id="l61.72" class="difflineminus">-        ltnSwitch2Calendar();</span>
<a href="#l61.73"></a><span id="l61.73" class="difflineminus">-      },</span>
<a href="#l61.74"></a><span id="l61.74" class="difflineminus">-      closeTab: function(aTab) {</span>
<a href="#l61.75"></a><span id="l61.75" class="difflineminus">-        if (gCurrentMode == &quot;calendar&quot;) {</span>
<a href="#l61.76"></a><span id="l61.76" class="difflineminus">-          // Only revert menu hacks if closing the active tab, otherwise we</span>
<a href="#l61.77"></a><span id="l61.77" class="difflineminus">-          // would switch to mail mode even if in task mode and closing the</span>
<a href="#l61.78"></a><span id="l61.78" class="difflineminus">-          // calendar tab.</span>
<a href="#l61.79"></a><span id="l61.79" class="difflineminus">-          ltnSwitch2Mail();</span>
<a href="#l61.80"></a><span id="l61.80" class="difflineplus">+            supportsCommand: (aCommand, aTab) =&gt; calendarController2.supportsCommand(aCommand),</span>
<a href="#l61.81"></a><span id="l61.81" class="difflineplus">+            isCommandEnabled: (aCommand, aTab) =&gt; calendarController2.isCommandEnabled(aCommand),</span>
<a href="#l61.82"></a><span id="l61.82" class="difflineplus">+            doCommand: (aCommand, aTab) =&gt; calendarController2.doCommand(aCommand),</span>
<a href="#l61.83"></a><span id="l61.83" class="difflineplus">+            onEvent: (aEvent, aTab) =&gt; calendarController2.onEvent(aEvent)</span>
<a href="#l61.84"></a><span id="l61.84" class="difflineplus">+        },</span>
<a href="#l61.85"></a><span id="l61.85" class="difflineplus">+</span>
<a href="#l61.86"></a><span id="l61.86" class="difflineplus">+        tasks: {</span>
<a href="#l61.87"></a><span id="l61.87" class="difflineplus">+            type: &quot;tasks&quot;,</span>
<a href="#l61.88"></a><span id="l61.88" class="difflineplus">+            maxTabs: 1,</span>
<a href="#l61.89"></a><span id="l61.89" class="difflineplus">+            openTab: function(aTab, aArgs) {</span>
<a href="#l61.90"></a><span id="l61.90" class="difflineplus">+                aTab.title = aArgs.title;</span>
<a href="#l61.91"></a><span id="l61.91" class="difflineplus">+                if (!(&quot;background&quot; in aArgs) || !aArgs.background) {</span>
<a href="#l61.92"></a><span id="l61.92" class="difflineplus">+                    ltnSwitch2Task();</span>
<a href="#l61.93"></a><span id="l61.93" class="difflineplus">+                }</span>
<a href="#l61.94"></a><span id="l61.94" class="difflineplus">+            },</span>
<a href="#l61.95"></a><span id="l61.95" class="difflineplus">+            showTab: function(aTab) {</span>
<a href="#l61.96"></a><span id="l61.96" class="difflineplus">+                ltnSwitch2Task();</span>
<a href="#l61.97"></a><span id="l61.97" class="difflineplus">+            },</span>
<a href="#l61.98"></a><span id="l61.98" class="difflineplus">+            closeTab: function(aTab) {</span>
<a href="#l61.99"></a><span id="l61.99" class="difflineplus">+                if (gCurrentMode == &quot;task&quot;) {</span>
<a href="#l61.100"></a><span id="l61.100" class="difflineplus">+                    // Only revert menu hacks if closing the active tab, otherwise we</span>
<a href="#l61.101"></a><span id="l61.101" class="difflineplus">+                    // would switch to mail mode even if in calendar mode and closing the</span>
<a href="#l61.102"></a><span id="l61.102" class="difflineplus">+                    // tasks tab.</span>
<a href="#l61.103"></a><span id="l61.103" class="difflineplus">+                    ltnSwitch2Mail();</span>
<a href="#l61.104"></a><span id="l61.104" class="difflineplus">+                }</span>
<a href="#l61.105"></a><span id="l61.105" class="difflineplus">+            },</span>
<a href="#l61.106"></a><span id="l61.106" class="difflineplus">+</span>
<a href="#l61.107"></a><span id="l61.107" class="difflineplus">+            persistTab: function(aTab) {</span>
<a href="#l61.108"></a><span id="l61.108" class="difflineplus">+                let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l61.109"></a><span id="l61.109" class="difflineplus">+                return {</span>
<a href="#l61.110"></a><span id="l61.110" class="difflineplus">+                    // Since we do strange tab switching logic in ltnSwitch2Task,</span>
<a href="#l61.111"></a><span id="l61.111" class="difflineplus">+                    // we should store the current tab state ourselves.</span>
<a href="#l61.112"></a><span id="l61.112" class="difflineplus">+                    background: (aTab != tabmail.currentTabInfo)</span>
<a href="#l61.113"></a><span id="l61.113" class="difflineplus">+                };</span>
<a href="#l61.114"></a><span id="l61.114" class="difflineplus">+            },</span>
<a href="#l61.115"></a><span id="l61.115" class="difflineplus">+</span>
<a href="#l61.116"></a><span id="l61.116" class="difflineplus">+            restoreTab: function(aTabmail, aState) {</span>
<a href="#l61.117"></a><span id="l61.117" class="difflineplus">+                aState.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleTasks&quot;);</span>
<a href="#l61.118"></a><span id="l61.118" class="difflineplus">+                aTabmail.openTab(&quot;tasks&quot;, aState);</span>
<a href="#l61.119"></a><span id="l61.119" class="difflineplus">+            },</span>
<a href="#l61.120"></a><span id="l61.120" class="difflineplus">+</span>
<a href="#l61.121"></a><span id="l61.121" class="difflineplus">+            onTitleChanged: function(aTab) {</span>
<a href="#l61.122"></a><span id="l61.122" class="difflineplus">+                aTab.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleTasks&quot;);</span>
<a href="#l61.123"></a><span id="l61.123" class="difflineplus">+            },</span>
<a href="#l61.124"></a><span id="l61.124" class="difflineplus">+</span>
<a href="#l61.125"></a><span id="l61.125" class="difflineplus">+            supportsCommand: (aCommand, aTab) =&gt; calendarController2.supportsCommand(aCommand),</span>
<a href="#l61.126"></a><span id="l61.126" class="difflineplus">+            isCommandEnabled: (aCommand, aTab) =&gt; calendarController2.isCommandEnabled(aCommand),</span>
<a href="#l61.127"></a><span id="l61.127" class="difflineplus">+            doCommand: (aCommand, aTab) =&gt; calendarController2.doCommand(aCommand),</span>
<a href="#l61.128"></a><span id="l61.128" class="difflineplus">+            onEvent: (aEvent, aTab) =&gt; calendarController2.onEvent(aEvent)</span>
<a href="#l61.129"></a><span id="l61.129">         }</span>
<a href="#l61.130"></a><span id="l61.130" class="difflineminus">-      },</span>
<a href="#l61.131"></a><span id="l61.131" class="difflineminus">-</span>
<a href="#l61.132"></a><span id="l61.132" class="difflineminus">-      persistTab: function(aTab) {</span>
<a href="#l61.133"></a><span id="l61.133" class="difflineminus">-        let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l61.134"></a><span id="l61.134" class="difflineminus">-        return {</span>
<a href="#l61.135"></a><span id="l61.135" class="difflineminus">-            // Since we do strange tab switching logic in ltnSwitch2Calendar,</span>
<a href="#l61.136"></a><span id="l61.136" class="difflineminus">-            // we should store the current tab state ourselves.</span>
<a href="#l61.137"></a><span id="l61.137" class="difflineminus">-            background: (aTab != tabmail.currentTabInfo)</span>
<a href="#l61.138"></a><span id="l61.138" class="difflineminus">-        };</span>
<a href="#l61.139"></a><span id="l61.139" class="difflineminus">-      },</span>
<a href="#l61.140"></a><span id="l61.140" class="difflineminus">-</span>
<a href="#l61.141"></a><span id="l61.141" class="difflineminus">-      restoreTab: function(aTabmail, aState) {</span>
<a href="#l61.142"></a><span id="l61.142" class="difflineminus">-        aState.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleCalendar&quot;);</span>
<a href="#l61.143"></a><span id="l61.143" class="difflineminus">-        aTabmail.openTab(&quot;calendar&quot;, aState);</span>
<a href="#l61.144"></a><span id="l61.144" class="difflineminus">-      },</span>
<a href="#l61.145"></a><span id="l61.145" class="difflineminus">-</span>
<a href="#l61.146"></a><span id="l61.146" class="difflineminus">-      onTitleChanged: function(aTab) {</span>
<a href="#l61.147"></a><span id="l61.147" class="difflineminus">-        aTab.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleCalendar&quot;);</span>
<a href="#l61.148"></a><span id="l61.148" class="difflineminus">-      },</span>
<a href="#l61.149"></a><span id="l61.149" class="difflineminus">-</span>
<a href="#l61.150"></a><span id="l61.150" class="difflineminus">-      supportsCommand: (aCommand, aTab) =&gt; calendarController2.supportsCommand(aCommand),</span>
<a href="#l61.151"></a><span id="l61.151" class="difflineminus">-      isCommandEnabled: (aCommand, aTab) =&gt; calendarController2.isCommandEnabled(aCommand),</span>
<a href="#l61.152"></a><span id="l61.152" class="difflineminus">-      doCommand: (aCommand, aTab) =&gt; calendarController2.doCommand(aCommand),</span>
<a href="#l61.153"></a><span id="l61.153" class="difflineminus">-      onEvent: (aEvent, aTab) =&gt; calendarController2.onEvent(aEvent)</span>
<a href="#l61.154"></a><span id="l61.154">     },</span>
<a href="#l61.155"></a><span id="l61.155"> </span>
<a href="#l61.156"></a><span id="l61.156" class="difflineminus">-    tasks: {</span>
<a href="#l61.157"></a><span id="l61.157" class="difflineminus">-      type: &quot;tasks&quot;,</span>
<a href="#l61.158"></a><span id="l61.158" class="difflineminus">-      maxTabs: 1,</span>
<a href="#l61.159"></a><span id="l61.159" class="difflineminus">-      openTab: function(aTab, aArgs) {</span>
<a href="#l61.160"></a><span id="l61.160" class="difflineminus">-        aTab.title = aArgs.title;</span>
<a href="#l61.161"></a><span id="l61.161" class="difflineminus">-        if (!(&quot;background&quot; in aArgs) || !aArgs.background) {</span>
<a href="#l61.162"></a><span id="l61.162" class="difflineminus">-            ltnSwitch2Task();</span>
<a href="#l61.163"></a><span id="l61.163" class="difflineminus">-        }</span>
<a href="#l61.164"></a><span id="l61.164" class="difflineminus">-      },</span>
<a href="#l61.165"></a><span id="l61.165" class="difflineminus">-      showTab: function(aTab) {</span>
<a href="#l61.166"></a><span id="l61.166" class="difflineminus">-        ltnSwitch2Task();</span>
<a href="#l61.167"></a><span id="l61.167" class="difflineminus">-      },</span>
<a href="#l61.168"></a><span id="l61.168" class="difflineminus">-      closeTab: function(aTab) {</span>
<a href="#l61.169"></a><span id="l61.169" class="difflineminus">-        if (gCurrentMode == &quot;task&quot;) {</span>
<a href="#l61.170"></a><span id="l61.170" class="difflineminus">-          // Only revert menu hacks if closing the active tab, otherwise we</span>
<a href="#l61.171"></a><span id="l61.171" class="difflineminus">-          // would switch to mail mode even if in calendar mode and closing the</span>
<a href="#l61.172"></a><span id="l61.172" class="difflineminus">-          // tasks tab.</span>
<a href="#l61.173"></a><span id="l61.173" class="difflineminus">-          ltnSwitch2Mail();</span>
<a href="#l61.174"></a><span id="l61.174" class="difflineminus">-        }</span>
<a href="#l61.175"></a><span id="l61.175" class="difflineminus">-      },</span>
<a href="#l61.176"></a><span id="l61.176" class="difflineminus">-</span>
<a href="#l61.177"></a><span id="l61.177" class="difflineminus">-      persistTab: function(aTab) {</span>
<a href="#l61.178"></a><span id="l61.178" class="difflineminus">-        let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l61.179"></a><span id="l61.179" class="difflineminus">-        return {</span>
<a href="#l61.180"></a><span id="l61.180" class="difflineminus">-            // Since we do strange tab switching logic in ltnSwitch2Task,</span>
<a href="#l61.181"></a><span id="l61.181" class="difflineminus">-            // we should store the current tab state ourselves.</span>
<a href="#l61.182"></a><span id="l61.182" class="difflineminus">-            background: (aTab != tabmail.currentTabInfo)</span>
<a href="#l61.183"></a><span id="l61.183" class="difflineminus">-        };</span>
<a href="#l61.184"></a><span id="l61.184" class="difflineminus">-      },</span>
<a href="#l61.185"></a><span id="l61.185" class="difflineminus">-</span>
<a href="#l61.186"></a><span id="l61.186" class="difflineminus">-      restoreTab: function(aTabmail, aState) {</span>
<a href="#l61.187"></a><span id="l61.187" class="difflineminus">-        aState.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleTasks&quot;);</span>
<a href="#l61.188"></a><span id="l61.188" class="difflineminus">-        aTabmail.openTab(&quot;tasks&quot;, aState);</span>
<a href="#l61.189"></a><span id="l61.189" class="difflineminus">-      },</span>
<a href="#l61.190"></a><span id="l61.190" class="difflineminus">-</span>
<a href="#l61.191"></a><span id="l61.191" class="difflineminus">-      onTitleChanged: function(aTab) {</span>
<a href="#l61.192"></a><span id="l61.192" class="difflineminus">-        aTab.title = ltnGetString(&quot;lightning&quot;, &quot;tabTitleTasks&quot;);</span>
<a href="#l61.193"></a><span id="l61.193" class="difflineminus">-      },</span>
<a href="#l61.194"></a><span id="l61.194" class="difflineminus">-</span>
<a href="#l61.195"></a><span id="l61.195" class="difflineminus">-      supportsCommand: (aCommand, aTab) =&gt; calendarController2.supportsCommand(aCommand),</span>
<a href="#l61.196"></a><span id="l61.196" class="difflineminus">-      isCommandEnabled: (aCommand, aTab) =&gt; calendarController2.isCommandEnabled(aCommand),</span>
<a href="#l61.197"></a><span id="l61.197" class="difflineminus">-      doCommand: (aCommand, aTab) =&gt; calendarController2.doCommand(aCommand),</span>
<a href="#l61.198"></a><span id="l61.198" class="difflineminus">-      onEvent: (aEvent, aTab) =&gt; calendarController2.onEvent(aEvent)</span>
<a href="#l61.199"></a><span id="l61.199" class="difflineplus">+    /**</span>
<a href="#l61.200"></a><span id="l61.200" class="difflineplus">+     * Because calendar does some direct menu manipulation, we need to</span>
<a href="#l61.201"></a><span id="l61.201" class="difflineplus">+     * change to the mail mode to clean up after those hacks.</span>
<a href="#l61.202"></a><span id="l61.202" class="difflineplus">+     *</span>
<a href="#l61.203"></a><span id="l61.203" class="difflineplus">+     * @param {Object} aTab  A tab info object</span>
<a href="#l61.204"></a><span id="l61.204" class="difflineplus">+     */</span>
<a href="#l61.205"></a><span id="l61.205" class="difflineplus">+    saveTabState: function(aTab) {</span>
<a href="#l61.206"></a><span id="l61.206" class="difflineplus">+        ltnSwitch2Mail();</span>
<a href="#l61.207"></a><span id="l61.207">     }</span>
<a href="#l61.208"></a><span id="l61.208" class="difflineminus">-  },</span>
<a href="#l61.209"></a><span id="l61.209" class="difflineminus">-  /**</span>
<a href="#l61.210"></a><span id="l61.210" class="difflineminus">-   * Because calendar does some direct menu manipulation, we need to</span>
<a href="#l61.211"></a><span id="l61.211" class="difflineminus">-   * change to the mail mode to clean up after those hacks.</span>
<a href="#l61.212"></a><span id="l61.212" class="difflineminus">-   *</span>
<a href="#l61.213"></a><span id="l61.213" class="difflineminus">-   * @param {Object} aTab  A tab info object</span>
<a href="#l61.214"></a><span id="l61.214" class="difflineminus">-   */</span>
<a href="#l61.215"></a><span id="l61.215" class="difflineminus">-  saveTabState: function(aTab) {</span>
<a href="#l61.216"></a><span id="l61.216" class="difflineminus">-    ltnSwitch2Mail();</span>
<a href="#l61.217"></a><span id="l61.217" class="difflineminus">-  }</span>
<a href="#l61.218"></a><span id="l61.218"> };</span>
<a href="#l61.219"></a><span id="l61.219"> </span>
<a href="#l61.220"></a><span id="l61.220"> /**</span>
<a href="#l61.221"></a><span id="l61.221">  * For details about tab info objects and the tabmail interface see:</span>
<a href="#l61.222"></a><span id="l61.222">  * comm-central/mail/base/content/mailTabs.js</span>
<a href="#l61.223"></a><span id="l61.223">  * comm-central/mail/base/content/tabmail.xml</span>
<a href="#l61.224"></a><span id="l61.224">  */</span>
<a href="#l61.225"></a><span id="l61.225"> var calendarItemTabType = {</span>
<a href="#l61.226"></a><span id="l61.226" class="difflineat">@@ -380,18 +381,18 @@ function ltnOnLoad(event) {</span>
<a href="#l61.227"></a><span id="l61.227"> </span>
<a href="#l61.228"></a><span id="l61.228">     let filter = document.getElementById(&quot;task-tree-filtergroup&quot;);</span>
<a href="#l61.229"></a><span id="l61.229">     filter.value = filter.value || &quot;all&quot;;</span>
<a href="#l61.230"></a><span id="l61.230">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l61.231"></a><span id="l61.231">     document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l61.232"></a><span id="l61.232"> </span>
<a href="#l61.233"></a><span id="l61.233">     let mailContextPopup = document.getElementById(&quot;mailContext&quot;);</span>
<a href="#l61.234"></a><span id="l61.234">     if (mailContextPopup) {</span>
<a href="#l61.235"></a><span id="l61.235" class="difflineminus">-      mailContextPopup.addEventListener(&quot;popupshowing&quot;,</span>
<a href="#l61.236"></a><span id="l61.236" class="difflineminus">-                                        gCalSetupMailContext.popup, false);</span>
<a href="#l61.237"></a><span id="l61.237" class="difflineplus">+        mailContextPopup.addEventListener(&quot;popupshowing&quot;,</span>
<a href="#l61.238"></a><span id="l61.238" class="difflineplus">+                                          gCalSetupMailContext.popup, false);</span>
<a href="#l61.239"></a><span id="l61.239">     }</span>
<a href="#l61.240"></a><span id="l61.240"> </span>
<a href="#l61.241"></a><span id="l61.241">     // Setup customizeDone handlers for our toolbars</span>
<a href="#l61.242"></a><span id="l61.242">     let toolbox = document.getElementById(&quot;calendar-toolbox&quot;);</span>
<a href="#l61.243"></a><span id="l61.243">     toolbox.customizeDone = function(aEvent) {</span>
<a href="#l61.244"></a><span id="l61.244">         MailToolboxCustomizeDone(aEvent, &quot;CustomizeCalendarToolbar&quot;);</span>
<a href="#l61.245"></a><span id="l61.245">     };</span>
<a href="#l61.246"></a><span id="l61.246">     toolbox = document.getElementById(&quot;task-toolbox&quot;);</span>
<a href="#l61.247"></a><span id="l61.247" class="difflineat">@@ -457,38 +458,38 @@ function ltnIntegrationNotification() {</span>
<a href="#l61.248"></a><span id="l61.248">     };</span>
<a href="#l61.249"></a><span id="l61.249">     let cbOptOut = function(aNotificationBar, aButton) {</span>
<a href="#l61.250"></a><span id="l61.250">         Preferences.set(kNotify, false);</span>
<a href="#l61.251"></a><span id="l61.251">         Preferences.set(kOptOut, true);</span>
<a href="#l61.252"></a><span id="l61.252">         AddonManager.getAddonByID(kLightningGuuid, cbRemoveLightning);</span>
<a href="#l61.253"></a><span id="l61.253">         // let the user know that removal will be applied after restart</span>
<a href="#l61.254"></a><span id="l61.254">         let restartLabel = ltnGetString(&quot;lightning&quot;, &quot;integrationRestartLabel&quot;, [ltnBrand, appBrand]);</span>
<a href="#l61.255"></a><span id="l61.255">         let button = [{</span>
<a href="#l61.256"></a><span id="l61.256" class="difflineminus">-             label:     ltnGetString(&quot;lightning&quot;, &quot;integrationUndoButton&quot;),</span>
<a href="#l61.257"></a><span id="l61.257" class="difflineminus">-             accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationUndoAccessKey&quot;),</span>
<a href="#l61.258"></a><span id="l61.258" class="difflineminus">-             popup:     null,</span>
<a href="#l61.259"></a><span id="l61.259" class="difflineminus">-             callback:  cbUndoOptOut</span>
<a href="#l61.260"></a><span id="l61.260" class="difflineminus">-         }, {</span>
<a href="#l61.261"></a><span id="l61.261" class="difflineminus">-             label:     ltnGetString(&quot;lightning&quot;, &quot;integrationRestartButton&quot;),</span>
<a href="#l61.262"></a><span id="l61.262" class="difflineminus">-             accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationRestartAccessKey&quot;),</span>
<a href="#l61.263"></a><span id="l61.263" class="difflineminus">-             popup:     null,</span>
<a href="#l61.264"></a><span id="l61.264" class="difflineminus">-             callback:  cbRestartNow</span>
<a href="#l61.265"></a><span id="l61.265" class="difflineminus">-         }];</span>
<a href="#l61.266"></a><span id="l61.266" class="difflineminus">-         notifyBox.appendNotification(restartLabel,</span>
<a href="#l61.267"></a><span id="l61.267" class="difflineminus">-                                      &quot;restart-required&quot;,</span>
<a href="#l61.268"></a><span id="l61.268" class="difflineminus">-                                      null,</span>
<a href="#l61.269"></a><span id="l61.269" class="difflineminus">-                                      notifyBox.PRIORITY_INFO_MEDIUM,</span>
<a href="#l61.270"></a><span id="l61.270" class="difflineminus">-                                      button);</span>
<a href="#l61.271"></a><span id="l61.271" class="difflineplus">+            label:     ltnGetString(&quot;lightning&quot;, &quot;integrationUndoButton&quot;),</span>
<a href="#l61.272"></a><span id="l61.272" class="difflineplus">+            accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationUndoAccessKey&quot;),</span>
<a href="#l61.273"></a><span id="l61.273" class="difflineplus">+            popup:     null,</span>
<a href="#l61.274"></a><span id="l61.274" class="difflineplus">+            callback:  cbUndoOptOut</span>
<a href="#l61.275"></a><span id="l61.275" class="difflineplus">+        }, {</span>
<a href="#l61.276"></a><span id="l61.276" class="difflineplus">+            label:     ltnGetString(&quot;lightning&quot;, &quot;integrationRestartButton&quot;),</span>
<a href="#l61.277"></a><span id="l61.277" class="difflineplus">+            accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationRestartAccessKey&quot;),</span>
<a href="#l61.278"></a><span id="l61.278" class="difflineplus">+            popup:     null,</span>
<a href="#l61.279"></a><span id="l61.279" class="difflineplus">+            callback:  cbRestartNow</span>
<a href="#l61.280"></a><span id="l61.280" class="difflineplus">+        }];</span>
<a href="#l61.281"></a><span id="l61.281" class="difflineplus">+        notifyBox.appendNotification(restartLabel,</span>
<a href="#l61.282"></a><span id="l61.282" class="difflineplus">+                                     &quot;restart-required&quot;,</span>
<a href="#l61.283"></a><span id="l61.283" class="difflineplus">+                                     null,</span>
<a href="#l61.284"></a><span id="l61.284" class="difflineplus">+                                     notifyBox.PRIORITY_INFO_MEDIUM,</span>
<a href="#l61.285"></a><span id="l61.285" class="difflineplus">+                                     button);</span>
<a href="#l61.286"></a><span id="l61.286">     };</span>
<a href="#l61.287"></a><span id="l61.287"> </span>
<a href="#l61.288"></a><span id="l61.288">     let buttons = [{</span>
<a href="#l61.289"></a><span id="l61.289" class="difflineminus">-         label:     ltnGetString(&quot;lightning&quot;, &quot;integrationLearnMoreButton&quot;),</span>
<a href="#l61.290"></a><span id="l61.290" class="difflineminus">-         accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationLearnMoreAccessKey&quot;),</span>
<a href="#l61.291"></a><span id="l61.291" class="difflineminus">-         popup:     null,</span>
<a href="#l61.292"></a><span id="l61.292" class="difflineminus">-         callback:  cbLearnMore</span>
<a href="#l61.293"></a><span id="l61.293" class="difflineplus">+        label:     ltnGetString(&quot;lightning&quot;, &quot;integrationLearnMoreButton&quot;),</span>
<a href="#l61.294"></a><span id="l61.294" class="difflineplus">+        accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationLearnMoreAccessKey&quot;),</span>
<a href="#l61.295"></a><span id="l61.295" class="difflineplus">+        popup:     null,</span>
<a href="#l61.296"></a><span id="l61.296" class="difflineplus">+        callback:  cbLearnMore</span>
<a href="#l61.297"></a><span id="l61.297">     }, {</span>
<a href="#l61.298"></a><span id="l61.298">         label:     ltnGetString(&quot;lightning&quot;, &quot;integrationOptOutButton&quot;),</span>
<a href="#l61.299"></a><span id="l61.299">         accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationOptOutAccessKey&quot;),</span>
<a href="#l61.300"></a><span id="l61.300">         popup:     null,</span>
<a href="#l61.301"></a><span id="l61.301">         callback:  cbOptOut</span>
<a href="#l61.302"></a><span id="l61.302">     }, {</span>
<a href="#l61.303"></a><span id="l61.303">         label:     ltnGetString(&quot;lightning&quot;, &quot;integrationKeepItButton&quot;),</span>
<a href="#l61.304"></a><span id="l61.304">         accessKey: ltnGetString(&quot;lightning&quot;, &quot;integrationKeepItAccessKey&quot;),</span>
<a href="#l61.305"></a><span id="l61.305" class="difflineat">@@ -543,20 +544,20 @@ function refreshUIBits() {</span>
<a href="#l61.306"></a><span id="l61.306">         // Refresh the current view and just allow the refresh for the others</span>
<a href="#l61.307"></a><span id="l61.307">         // views when will be displayed.</span>
<a href="#l61.308"></a><span id="l61.308">         let currView = currentView();</span>
<a href="#l61.309"></a><span id="l61.309">         currView.goToDay();</span>
<a href="#l61.310"></a><span id="l61.310">         [&quot;day-view&quot;,</span>
<a href="#l61.311"></a><span id="l61.311">          &quot;week-view&quot;,</span>
<a href="#l61.312"></a><span id="l61.312">          &quot;multiweek-view&quot;,</span>
<a href="#l61.313"></a><span id="l61.313">          &quot;month-view&quot;].forEach((view) =&gt; {</span>
<a href="#l61.314"></a><span id="l61.314" class="difflineminus">-            if (view != currView.id) {</span>
<a href="#l61.315"></a><span id="l61.315" class="difflineminus">-                document.getElementById(view).mToggleStatus = -1;</span>
<a href="#l61.316"></a><span id="l61.316" class="difflineminus">-            }</span>
<a href="#l61.317"></a><span id="l61.317" class="difflineminus">-        });</span>
<a href="#l61.318"></a><span id="l61.318" class="difflineplus">+             if (view != currView.id) {</span>
<a href="#l61.319"></a><span id="l61.319" class="difflineplus">+                 document.getElementById(view).mToggleStatus = -1;</span>
<a href="#l61.320"></a><span id="l61.320" class="difflineplus">+             }</span>
<a href="#l61.321"></a><span id="l61.321" class="difflineplus">+         });</span>
<a href="#l61.322"></a><span id="l61.322"> </span>
<a href="#l61.323"></a><span id="l61.323">         if (!TodayPane.showsToday()) {</span>
<a href="#l61.324"></a><span id="l61.324">             TodayPane.setDay(now());</span>
<a href="#l61.325"></a><span id="l61.325">         }</span>
<a href="#l61.326"></a><span id="l61.326"> </span>
<a href="#l61.327"></a><span id="l61.327">         // update the unifinder</span>
<a href="#l61.328"></a><span id="l61.328">         refreshEventTree();</span>
<a href="#l61.329"></a><span id="l61.329"> </span>
<a href="#l61.330"></a><span id="l61.330" class="difflineat">@@ -713,65 +714,65 @@ function openInvitationsDialog() {</span>
<a href="#l61.331"></a><span id="l61.331">  */</span>
<a href="#l61.332"></a><span id="l61.332"> var gCurrentMode = &quot;mail&quot;;</span>
<a href="#l61.333"></a><span id="l61.333"> </span>
<a href="#l61.334"></a><span id="l61.334"> /**</span>
<a href="#l61.335"></a><span id="l61.335">  * ltnSwitch2Mail() switches to the mail mode</span>
<a href="#l61.336"></a><span id="l61.336">  */</span>
<a href="#l61.337"></a><span id="l61.337"> </span>
<a href="#l61.338"></a><span id="l61.338"> function ltnSwitch2Mail() {</span>
<a href="#l61.339"></a><span id="l61.339" class="difflineminus">-  if (gCurrentMode != &quot;mail&quot;) {</span>
<a href="#l61.340"></a><span id="l61.340" class="difflineminus">-    gCurrentMode = &quot;mail&quot;;</span>
<a href="#l61.341"></a><span id="l61.341" class="difflineminus">-    document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l61.342"></a><span id="l61.342" class="difflineplus">+    if (gCurrentMode != &quot;mail&quot;) {</span>
<a href="#l61.343"></a><span id="l61.343" class="difflineplus">+        gCurrentMode = &quot;mail&quot;;</span>
<a href="#l61.344"></a><span id="l61.344" class="difflineplus">+        document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l61.345"></a><span id="l61.345"> </span>
<a href="#l61.346"></a><span id="l61.346" class="difflineminus">-    document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l61.347"></a><span id="l61.347" class="difflineminus">-    window.setCursor(&quot;auto&quot;);</span>
<a href="#l61.348"></a><span id="l61.348" class="difflineminus">-  }</span>
<a href="#l61.349"></a><span id="l61.349" class="difflineplus">+        document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l61.350"></a><span id="l61.350" class="difflineplus">+        window.setCursor(&quot;auto&quot;);</span>
<a href="#l61.351"></a><span id="l61.351" class="difflineplus">+    }</span>
<a href="#l61.352"></a><span id="l61.352"> }</span>
<a href="#l61.353"></a><span id="l61.353"> </span>
<a href="#l61.354"></a><span id="l61.354"> /**</span>
<a href="#l61.355"></a><span id="l61.355">  * ltnSwitch2Calendar() switches to the calendar mode</span>
<a href="#l61.356"></a><span id="l61.356">  */</span>
<a href="#l61.357"></a><span id="l61.357"> </span>
<a href="#l61.358"></a><span id="l61.358"> function ltnSwitch2Calendar() {</span>
<a href="#l61.359"></a><span id="l61.359" class="difflineminus">-  if (gCurrentMode != &quot;calendar&quot;) {</span>
<a href="#l61.360"></a><span id="l61.360" class="difflineminus">-    gCurrentMode = &quot;calendar&quot;;</span>
<a href="#l61.361"></a><span id="l61.361" class="difflineminus">-    document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l61.362"></a><span id="l61.362" class="difflineplus">+    if (gCurrentMode != &quot;calendar&quot;) {</span>
<a href="#l61.363"></a><span id="l61.363" class="difflineplus">+        gCurrentMode = &quot;calendar&quot;;</span>
<a href="#l61.364"></a><span id="l61.364" class="difflineplus">+        document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l61.365"></a><span id="l61.365"> </span>
<a href="#l61.366"></a><span id="l61.366" class="difflineminus">-    // display the calendar panel on the display deck</span>
<a href="#l61.367"></a><span id="l61.367" class="difflineminus">-    let deck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l61.368"></a><span id="l61.368" class="difflineminus">-    deck.selectedPanel = document.getElementById(&quot;calendar-view-box&quot;);</span>
<a href="#l61.369"></a><span id="l61.369" class="difflineplus">+        // display the calendar panel on the display deck</span>
<a href="#l61.370"></a><span id="l61.370" class="difflineplus">+        let deck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l61.371"></a><span id="l61.371" class="difflineplus">+        deck.selectedPanel = document.getElementById(&quot;calendar-view-box&quot;);</span>
<a href="#l61.372"></a><span id="l61.372"> </span>
<a href="#l61.373"></a><span id="l61.373" class="difflineminus">-    // show the last displayed type of calendar view</span>
<a href="#l61.374"></a><span id="l61.374" class="difflineminus">-    switchToView(gLastShownCalendarView);</span>
<a href="#l61.375"></a><span id="l61.375" class="difflineplus">+        // show the last displayed type of calendar view</span>
<a href="#l61.376"></a><span id="l61.376" class="difflineplus">+        switchToView(gLastShownCalendarView);</span>
<a href="#l61.377"></a><span id="l61.377"> </span>
<a href="#l61.378"></a><span id="l61.378" class="difflineminus">-    document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l61.379"></a><span id="l61.379" class="difflineminus">-    window.setCursor(&quot;auto&quot;);</span>
<a href="#l61.380"></a><span id="l61.380" class="difflineplus">+        document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l61.381"></a><span id="l61.381" class="difflineplus">+        window.setCursor(&quot;auto&quot;);</span>
<a href="#l61.382"></a><span id="l61.382"> </span>
<a href="#l61.383"></a><span id="l61.383" class="difflineminus">-    // make sure the view is sized correctly</span>
<a href="#l61.384"></a><span id="l61.384" class="difflineminus">-    onCalendarViewResize();</span>
<a href="#l61.385"></a><span id="l61.385" class="difflineminus">-  }</span>
<a href="#l61.386"></a><span id="l61.386" class="difflineplus">+        // make sure the view is sized correctly</span>
<a href="#l61.387"></a><span id="l61.387" class="difflineplus">+        onCalendarViewResize();</span>
<a href="#l61.388"></a><span id="l61.388" class="difflineplus">+    }</span>
<a href="#l61.389"></a><span id="l61.389"> }</span>
<a href="#l61.390"></a><span id="l61.390"> </span>
<a href="#l61.391"></a><span id="l61.391"> /**</span>
<a href="#l61.392"></a><span id="l61.392">  * ltnSwitch2Task() switches to the task mode</span>
<a href="#l61.393"></a><span id="l61.393">  */</span>
<a href="#l61.394"></a><span id="l61.394"> </span>
<a href="#l61.395"></a><span id="l61.395"> function ltnSwitch2Task() {</span>
<a href="#l61.396"></a><span id="l61.396" class="difflineminus">-  if (gCurrentMode != &quot;task&quot;) {</span>
<a href="#l61.397"></a><span id="l61.397" class="difflineminus">-    gCurrentMode = &quot;task&quot;;</span>
<a href="#l61.398"></a><span id="l61.398" class="difflineminus">-    document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l61.399"></a><span id="l61.399" class="difflineplus">+    if (gCurrentMode != &quot;task&quot;) {</span>
<a href="#l61.400"></a><span id="l61.400" class="difflineplus">+        gCurrentMode = &quot;task&quot;;</span>
<a href="#l61.401"></a><span id="l61.401" class="difflineplus">+        document.getElementById(&quot;modeBroadcaster&quot;).setAttribute(&quot;mode&quot;, gCurrentMode);</span>
<a href="#l61.402"></a><span id="l61.402"> </span>
<a href="#l61.403"></a><span id="l61.403" class="difflineminus">-    // display the task panel on the display deck</span>
<a href="#l61.404"></a><span id="l61.404" class="difflineminus">-    let deck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l61.405"></a><span id="l61.405" class="difflineminus">-    deck.selectedPanel = document.getElementById(&quot;calendar-task-box&quot;);</span>
<a href="#l61.406"></a><span id="l61.406" class="difflineplus">+        // display the task panel on the display deck</span>
<a href="#l61.407"></a><span id="l61.407" class="difflineplus">+        let deck = document.getElementById(&quot;calendarDisplayDeck&quot;);</span>
<a href="#l61.408"></a><span id="l61.408" class="difflineplus">+        deck.selectedPanel = document.getElementById(&quot;calendar-task-box&quot;);</span>
<a href="#l61.409"></a><span id="l61.409"> </span>
<a href="#l61.410"></a><span id="l61.410" class="difflineminus">-    document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l61.411"></a><span id="l61.411" class="difflineminus">-    window.setCursor(&quot;auto&quot;);</span>
<a href="#l61.412"></a><span id="l61.412" class="difflineminus">-  }</span>
<a href="#l61.413"></a><span id="l61.413" class="difflineplus">+        document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l61.414"></a><span id="l61.414" class="difflineplus">+        window.setCursor(&quot;auto&quot;);</span>
<a href="#l61.415"></a><span id="l61.415" class="difflineplus">+    }</span>
<a href="#l61.416"></a><span id="l61.416"> }</span>
<a href="#l61.417"></a><span id="l61.417"> </span>
<a href="#l61.418"></a><span id="l61.418"> var gCalSetupMailContext = {</span>
<a href="#l61.419"></a><span id="l61.419">     popup: function() {</span>
<a href="#l61.420"></a><span id="l61.420">         let hasSelection = (gFolderDisplay.selectedMessage != null);</span>
<a href="#l61.421"></a><span id="l61.421">         // Disable the convert menu altogether.</span>
<a href="#l61.422"></a><span id="l61.422">         setElementValue(&quot;mailContext-calendar-convert-menu&quot;,</span>
<a href="#l61.423"></a><span id="l61.423">                         !hasSelection &amp;&amp; &quot;true&quot;, &quot;hidden&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/lightning/content/suite-overlay-sidebar.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/lightning/content/suite-overlay-sidebar.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -1,44 +1,47 @@</span>
<a href="#l62.4"></a><span id="l62.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l62.5"></a><span id="l62.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l62.6"></a><span id="l62.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l62.9"></a><span id="l62.9"> </span>
<a href="#l62.10"></a><span id="l62.10"> var ltnSuiteUtils = {</span>
<a href="#l62.11"></a><span id="l62.11"> </span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  addStartupObserver: function() {</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineminus">-    Services.obs.addObserver(this.startupObserver, &quot;lightning-startup-done&quot;, false);</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineminus">-    Services.obs.addObserver(this.startupObserver, &quot;calendar-taskview-startup-done&quot;,</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineminus">-                    false);</span>
<a href="#l62.16"></a><span id="l62.16" class="difflineminus">-  },</span>
<a href="#l62.17"></a><span id="l62.17" class="difflineplus">+    addStartupObserver: function() {</span>
<a href="#l62.18"></a><span id="l62.18" class="difflineplus">+        Services.obs.addObserver(this.startupObserver, &quot;lightning-startup-done&quot;, false);</span>
<a href="#l62.19"></a><span id="l62.19" class="difflineplus">+        Services.obs.addObserver(this.startupObserver, &quot;calendar-taskview-startup-done&quot;,</span>
<a href="#l62.20"></a><span id="l62.20" class="difflineplus">+                        false);</span>
<a href="#l62.21"></a><span id="l62.21" class="difflineplus">+    },</span>
<a href="#l62.22"></a><span id="l62.22"> </span>
<a href="#l62.23"></a><span id="l62.23" class="difflineminus">-  startupObserver: {</span>
<a href="#l62.24"></a><span id="l62.24" class="difflineminus">-    observe: function(subject, topic, state) {</span>
<a href="#l62.25"></a><span id="l62.25" class="difflineminus">-      if (topic != &quot;lightning-startup-done&quot; &amp;&amp;</span>
<a href="#l62.26"></a><span id="l62.26" class="difflineminus">-          topic != &quot;calendar-taskview-startup-done&quot;) {</span>
<a href="#l62.27"></a><span id="l62.27" class="difflineminus">-        return;</span>
<a href="#l62.28"></a><span id="l62.28" class="difflineminus">-      }</span>
<a href="#l62.29"></a><span id="l62.29" class="difflineplus">+    startupObserver: {</span>
<a href="#l62.30"></a><span id="l62.30" class="difflineplus">+        observe: function(subject, topic, state) {</span>
<a href="#l62.31"></a><span id="l62.31" class="difflineplus">+            if (topic != &quot;lightning-startup-done&quot; &amp;&amp;</span>
<a href="#l62.32"></a><span id="l62.32" class="difflineplus">+                topic != &quot;calendar-taskview-startup-done&quot;) {</span>
<a href="#l62.33"></a><span id="l62.33" class="difflineplus">+                return;</span>
<a href="#l62.34"></a><span id="l62.34" class="difflineplus">+            }</span>
<a href="#l62.35"></a><span id="l62.35"> </span>
<a href="#l62.36"></a><span id="l62.36" class="difflineminus">-      [[&quot;CustomizeTaskActionsToolbar&quot;, &quot;task-actions-toolbox&quot;],</span>
<a href="#l62.37"></a><span id="l62.37" class="difflineminus">-       [&quot;CustomizeCalendarToolbar&quot;, &quot;calendar-toolbox&quot;],</span>
<a href="#l62.38"></a><span id="l62.38" class="difflineminus">-       [&quot;CustomizeTaskToolbar&quot;, &quot;task-toolbox&quot;]].forEach((eIDs) =&gt; {</span>
<a href="#l62.39"></a><span id="l62.39" class="difflineminus">-        let [itemID, toolboxID] = eIDs;</span>
<a href="#l62.40"></a><span id="l62.40" class="difflineminus">-        let item = document.getElementById(itemID);</span>
<a href="#l62.41"></a><span id="l62.41" class="difflineminus">-        let toolbox = document.getElementById(toolboxID);</span>
<a href="#l62.42"></a><span id="l62.42" class="difflineminus">-        toolbox.customizeInit = function() {</span>
<a href="#l62.43"></a><span id="l62.43" class="difflineminus">-          item.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l62.44"></a><span id="l62.44" class="difflineminus">-          toolboxCustomizeInit(&quot;mail-menubar&quot;);</span>
<a href="#l62.45"></a><span id="l62.45" class="difflineminus">-        };</span>
<a href="#l62.46"></a><span id="l62.46" class="difflineminus">-        toolbox.customizeDone = function(aToolboxChanged) {</span>
<a href="#l62.47"></a><span id="l62.47" class="difflineminus">-          item.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l62.48"></a><span id="l62.48" class="difflineminus">-          toolboxCustomizeDone(&quot;mail-menubar&quot;, toolbox, aToolboxChanged);</span>
<a href="#l62.49"></a><span id="l62.49" class="difflineminus">-        };</span>
<a href="#l62.50"></a><span id="l62.50" class="difflineminus">-        toolbox.customizeChange = function(aEvent) {</span>
<a href="#l62.51"></a><span id="l62.51" class="difflineminus">-          toolboxCustomizeChange(toolbox, aEvent);</span>
<a href="#l62.52"></a><span id="l62.52" class="difflineminus">-        };</span>
<a href="#l62.53"></a><span id="l62.53" class="difflineminus">-      });</span>
<a href="#l62.54"></a><span id="l62.54" class="difflineplus">+            const ids = [</span>
<a href="#l62.55"></a><span id="l62.55" class="difflineplus">+                [&quot;CustomizeTaskActionsToolbar&quot;, &quot;task-actions-toolbox&quot;],</span>
<a href="#l62.56"></a><span id="l62.56" class="difflineplus">+                [&quot;CustomizeCalendarToolbar&quot;, &quot;calendar-toolbox&quot;],</span>
<a href="#l62.57"></a><span id="l62.57" class="difflineplus">+                [&quot;CustomizeTaskToolbar&quot;, &quot;task-toolbox&quot;]</span>
<a href="#l62.58"></a><span id="l62.58" class="difflineplus">+            ];</span>
<a href="#l62.59"></a><span id="l62.59" class="difflineplus">+</span>
<a href="#l62.60"></a><span id="l62.60" class="difflineplus">+            ids.forEach(([itemID, toolboxID]) =&gt; {</span>
<a href="#l62.61"></a><span id="l62.61" class="difflineplus">+                let item = document.getElementById(itemID);</span>
<a href="#l62.62"></a><span id="l62.62" class="difflineplus">+                let toolbox = document.getElementById(toolboxID);</span>
<a href="#l62.63"></a><span id="l62.63" class="difflineplus">+                toolbox.customizeInit = function() {</span>
<a href="#l62.64"></a><span id="l62.64" class="difflineplus">+                    item.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l62.65"></a><span id="l62.65" class="difflineplus">+                    toolboxCustomizeInit(&quot;mail-menubar&quot;);</span>
<a href="#l62.66"></a><span id="l62.66" class="difflineplus">+                };</span>
<a href="#l62.67"></a><span id="l62.67" class="difflineplus">+                toolbox.customizeDone = function(aToolboxChanged) {</span>
<a href="#l62.68"></a><span id="l62.68" class="difflineplus">+                    item.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l62.69"></a><span id="l62.69" class="difflineplus">+                    toolboxCustomizeDone(&quot;mail-menubar&quot;, toolbox, aToolboxChanged);</span>
<a href="#l62.70"></a><span id="l62.70" class="difflineplus">+                };</span>
<a href="#l62.71"></a><span id="l62.71" class="difflineplus">+                toolbox.customizeChange = function(aEvent) {</span>
<a href="#l62.72"></a><span id="l62.72" class="difflineplus">+                    toolboxCustomizeChange(toolbox, aEvent);</span>
<a href="#l62.73"></a><span id="l62.73" class="difflineplus">+                };</span>
<a href="#l62.74"></a><span id="l62.74" class="difflineplus">+            });</span>
<a href="#l62.75"></a><span id="l62.75" class="difflineplus">+        }</span>
<a href="#l62.76"></a><span id="l62.76">     }</span>
<a href="#l62.77"></a><span id="l62.77" class="difflineminus">-  }</span>
<a href="#l62.78"></a><span id="l62.78"> };</span>
<a href="#l62.79"></a><span id="l62.79"> </span>
<a href="#l62.80"></a><span id="l62.80"> ltnSuiteUtils.addStartupObserver();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -779,18 +779,18 @@ calDavCalendar.prototype = {</span>
<a href="#l63.4"></a><span id="l63.4">                 let request = aLoader.request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l63.5"></a><span id="l63.5">                 let listenerStatus = Components.results.NS_OK;</span>
<a href="#l63.6"></a><span id="l63.6">                 let listenerDetail = aNewItem;</span>
<a href="#l63.7"></a><span id="l63.7">                 let responseStatus;</span>
<a href="#l63.8"></a><span id="l63.8">                 try {</span>
<a href="#l63.9"></a><span id="l63.9">                     responseStatus = request.responseStatus;</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11">                     if (self.verboseLogging()) {</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-                       let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineminus">-                       cal.LOG(&quot;CalDAV: recv: &quot; + (str || &quot;&quot;));</span>
<a href="#l63.14"></a><span id="l63.14" class="difflineplus">+                        let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineplus">+                        cal.LOG(&quot;CalDAV: recv: &quot; + (str || &quot;&quot;));</span>
<a href="#l63.16"></a><span id="l63.16">                     }</span>
<a href="#l63.17"></a><span id="l63.17">                 } catch (ex) {</span>
<a href="#l63.18"></a><span id="l63.18">                     listenerStatus = ex.result;</span>
<a href="#l63.19"></a><span id="l63.19">                     listenerDetail = &quot;Request Failed: &quot; + ex.message;</span>
<a href="#l63.20"></a><span id="l63.20">                     cal.LOG(&quot;CalDAV: Request error during add: &quot; + ex);</span>
<a href="#l63.21"></a><span id="l63.21">                 }</span>
<a href="#l63.22"></a><span id="l63.22"> </span>
<a href="#l63.23"></a><span id="l63.23">                 if (responseStatus == 204 || responseStatus == 201 || responseStatus == 200) {</span>
<a href="#l63.24"></a><span id="l63.24" class="difflineat">@@ -1215,45 +1215,45 @@ calDavCalendar.prototype = {</span>
<a href="#l63.25"></a><span id="l63.25">     /**</span>
<a href="#l63.26"></a><span id="l63.26">      * Notifies the caller that a get request has failed.</span>
<a href="#l63.27"></a><span id="l63.27">      *</span>
<a href="#l63.28"></a><span id="l63.28">      * @param errorMsg           Error message</span>
<a href="#l63.29"></a><span id="l63.29">      * @param aListener          (optional) Listener of the request</span>
<a href="#l63.30"></a><span id="l63.30">      * @param aChangeLogListener (optional)Listener for cached calendars</span>
<a href="#l63.31"></a><span id="l63.31">      */</span>
<a href="#l63.32"></a><span id="l63.32">     notifyGetFailed: function(errorMsg, aListener, aChangeLogListener) {</span>
<a href="#l63.33"></a><span id="l63.33" class="difflineminus">-         cal.WARN(&quot;CalDAV: Get failed: &quot; + errorMsg);</span>
<a href="#l63.34"></a><span id="l63.34" class="difflineplus">+        cal.WARN(&quot;CalDAV: Get failed: &quot; + errorMsg);</span>
<a href="#l63.35"></a><span id="l63.35"> </span>
<a href="#l63.36"></a><span id="l63.36" class="difflineminus">-         // Notify changelog listener</span>
<a href="#l63.37"></a><span id="l63.37" class="difflineminus">-         if (this.isCached &amp;&amp; aChangeLogListener) {</span>
<a href="#l63.38"></a><span id="l63.38" class="difflineminus">-             aChangeLogListener.onResult({ status: Components.results.NS_ERROR_FAILURE },</span>
<a href="#l63.39"></a><span id="l63.39" class="difflineminus">-                                         Components.results.NS_ERROR_FAILURE);</span>
<a href="#l63.40"></a><span id="l63.40" class="difflineminus">-         }</span>
<a href="#l63.41"></a><span id="l63.41" class="difflineplus">+        // Notify changelog listener</span>
<a href="#l63.42"></a><span id="l63.42" class="difflineplus">+        if (this.isCached &amp;&amp; aChangeLogListener) {</span>
<a href="#l63.43"></a><span id="l63.43" class="difflineplus">+            aChangeLogListener.onResult({ status: Components.results.NS_ERROR_FAILURE },</span>
<a href="#l63.44"></a><span id="l63.44" class="difflineplus">+                                        Components.results.NS_ERROR_FAILURE);</span>
<a href="#l63.45"></a><span id="l63.45" class="difflineplus">+        }</span>
<a href="#l63.46"></a><span id="l63.46"> </span>
<a href="#l63.47"></a><span id="l63.47" class="difflineminus">-         // Notify operation listener</span>
<a href="#l63.48"></a><span id="l63.48" class="difflineminus">-         this.notifyOperationComplete(aListener,</span>
<a href="#l63.49"></a><span id="l63.49" class="difflineminus">-                                      Components.results.NS_ERROR_FAILURE,</span>
<a href="#l63.50"></a><span id="l63.50" class="difflineminus">-                                      cIOL.GET,</span>
<a href="#l63.51"></a><span id="l63.51" class="difflineminus">-                                      null,</span>
<a href="#l63.52"></a><span id="l63.52" class="difflineminus">-                                      errorMsg);</span>
<a href="#l63.53"></a><span id="l63.53" class="difflineminus">-         // If an error occurrs here, we also need to unqueue the</span>
<a href="#l63.54"></a><span id="l63.54" class="difflineminus">-         // requests previously queued.</span>
<a href="#l63.55"></a><span id="l63.55" class="difflineminus">-         while (this.mQueuedQueries.length) {</span>
<a href="#l63.56"></a><span id="l63.56" class="difflineminus">-             let [, , , , listener] = this.mQueuedQueries.pop();</span>
<a href="#l63.57"></a><span id="l63.57" class="difflineminus">-             try {</span>
<a href="#l63.58"></a><span id="l63.58" class="difflineminus">-                 listener.onOperationComplete(this.superCalendar,</span>
<a href="#l63.59"></a><span id="l63.59" class="difflineminus">-                                              Components.results.NS_ERROR_FAILURE,</span>
<a href="#l63.60"></a><span id="l63.60" class="difflineminus">-                                              cIOL.GET,</span>
<a href="#l63.61"></a><span id="l63.61" class="difflineminus">-                                              null,</span>
<a href="#l63.62"></a><span id="l63.62" class="difflineminus">-                                              errorMsg);</span>
<a href="#l63.63"></a><span id="l63.63" class="difflineminus">-             } catch (e) {</span>
<a href="#l63.64"></a><span id="l63.64" class="difflineminus">-                 cal.ERROR(e);</span>
<a href="#l63.65"></a><span id="l63.65" class="difflineminus">-             }</span>
<a href="#l63.66"></a><span id="l63.66" class="difflineminus">-         }</span>
<a href="#l63.67"></a><span id="l63.67" class="difflineminus">-     },</span>
<a href="#l63.68"></a><span id="l63.68" class="difflineplus">+        // Notify operation listener</span>
<a href="#l63.69"></a><span id="l63.69" class="difflineplus">+        this.notifyOperationComplete(aListener,</span>
<a href="#l63.70"></a><span id="l63.70" class="difflineplus">+                                     Components.results.NS_ERROR_FAILURE,</span>
<a href="#l63.71"></a><span id="l63.71" class="difflineplus">+                                     cIOL.GET,</span>
<a href="#l63.72"></a><span id="l63.72" class="difflineplus">+                                     null,</span>
<a href="#l63.73"></a><span id="l63.73" class="difflineplus">+                                     errorMsg);</span>
<a href="#l63.74"></a><span id="l63.74" class="difflineplus">+        // If an error occurrs here, we also need to unqueue the</span>
<a href="#l63.75"></a><span id="l63.75" class="difflineplus">+        // requests previously queued.</span>
<a href="#l63.76"></a><span id="l63.76" class="difflineplus">+        while (this.mQueuedQueries.length) {</span>
<a href="#l63.77"></a><span id="l63.77" class="difflineplus">+            let [, , , , listener] = this.mQueuedQueries.pop();</span>
<a href="#l63.78"></a><span id="l63.78" class="difflineplus">+            try {</span>
<a href="#l63.79"></a><span id="l63.79" class="difflineplus">+                listener.onOperationComplete(this.superCalendar,</span>
<a href="#l63.80"></a><span id="l63.80" class="difflineplus">+                                             Components.results.NS_ERROR_FAILURE,</span>
<a href="#l63.81"></a><span id="l63.81" class="difflineplus">+                                             cIOL.GET,</span>
<a href="#l63.82"></a><span id="l63.82" class="difflineplus">+                                             null,</span>
<a href="#l63.83"></a><span id="l63.83" class="difflineplus">+                                             errorMsg);</span>
<a href="#l63.84"></a><span id="l63.84" class="difflineplus">+            } catch (e) {</span>
<a href="#l63.85"></a><span id="l63.85" class="difflineplus">+                cal.ERROR(e);</span>
<a href="#l63.86"></a><span id="l63.86" class="difflineplus">+            }</span>
<a href="#l63.87"></a><span id="l63.87" class="difflineplus">+        }</span>
<a href="#l63.88"></a><span id="l63.88" class="difflineplus">+    },</span>
<a href="#l63.89"></a><span id="l63.89"> </span>
<a href="#l63.90"></a><span id="l63.90">     /**</span>
<a href="#l63.91"></a><span id="l63.91">      * Retrieves a specific item from the CalDAV store.</span>
<a href="#l63.92"></a><span id="l63.92">      * Use when an outdated copy of the item is in hand.</span>
<a href="#l63.93"></a><span id="l63.93">      *</span>
<a href="#l63.94"></a><span id="l63.94">      * @param aItem       item to fetch</span>
<a href="#l63.95"></a><span id="l63.95">      * @param aListener   listener for method completion</span>
<a href="#l63.96"></a><span id="l63.96">      */</span>
<a href="#l63.97"></a><span id="l63.97" class="difflineat">@@ -1355,19 +1355,19 @@ calDavCalendar.prototype = {</span>
<a href="#l63.98"></a><span id="l63.98">             // we can't risk several calendars doing this simultaneously so</span>
<a href="#l63.99"></a><span id="l63.99">             // we'll force the renegotiation in a sync query, using OPTIONS to keep</span>
<a href="#l63.100"></a><span id="l63.100">             // it quick</span>
<a href="#l63.101"></a><span id="l63.101">             let headchannel = cal.prepHttpChannel(this.makeUri(), null, null, this);</span>
<a href="#l63.102"></a><span id="l63.102">             headchannel.requestMethod = &quot;OPTIONS&quot;;</span>
<a href="#l63.103"></a><span id="l63.103">             headchannel.open();</span>
<a href="#l63.104"></a><span id="l63.104">             headchannel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l63.105"></a><span id="l63.105">             try {</span>
<a href="#l63.106"></a><span id="l63.106" class="difflineminus">-              if (headchannel.responseStatus != 200) {</span>
<a href="#l63.107"></a><span id="l63.107" class="difflineminus">-                throw &quot;OPTIONS returned unexpected status code: &quot; + headchannel.responseStatus;</span>
<a href="#l63.108"></a><span id="l63.108" class="difflineminus">-              }</span>
<a href="#l63.109"></a><span id="l63.109" class="difflineplus">+                if (headchannel.responseStatus != 200) {</span>
<a href="#l63.110"></a><span id="l63.110" class="difflineplus">+                    throw &quot;OPTIONS returned unexpected status code: &quot; + headchannel.responseStatus;</span>
<a href="#l63.111"></a><span id="l63.111" class="difflineplus">+                }</span>
<a href="#l63.112"></a><span id="l63.112">             } catch (e) {</span>
<a href="#l63.113"></a><span id="l63.113">                 cal.WARN(&quot;CalDAV: Exception: &quot; + e);</span>
<a href="#l63.114"></a><span id="l63.114">                 notifyListener(Components.results.NS_ERROR_FAILURE);</span>
<a href="#l63.115"></a><span id="l63.115">             }</span>
<a href="#l63.116"></a><span id="l63.116">         }</span>
<a href="#l63.117"></a><span id="l63.117"> </span>
<a href="#l63.118"></a><span id="l63.118">         // Call getUpdatedItems right away if its the first refresh</span>
<a href="#l63.119"></a><span id="l63.119">         // *OR* if webdav Sync is enabled (It is redundant to send a request</span>
<a href="#l63.120"></a><span id="l63.120" class="difflineat">@@ -1387,18 +1387,17 @@ calDavCalendar.prototype = {</span>
<a href="#l63.121"></a><span id="l63.121">               &quot;&lt;/D:prop&gt;&quot; +</span>
<a href="#l63.122"></a><span id="l63.122">             &quot;&lt;/D:propfind&gt;&quot;;</span>
<a href="#l63.123"></a><span id="l63.123"> </span>
<a href="#l63.124"></a><span id="l63.124">         if (this.verboseLogging()) {</span>
<a href="#l63.125"></a><span id="l63.125">             cal.LOG(&quot;CalDAV: send(&quot; + this.makeUri().spec + &quot;): &quot; + queryXml);</span>
<a href="#l63.126"></a><span id="l63.126">         }</span>
<a href="#l63.127"></a><span id="l63.127"> </span>
<a href="#l63.128"></a><span id="l63.128">         let streamListener = {};</span>
<a href="#l63.129"></a><span id="l63.129" class="difflineminus">-        streamListener.onStreamComplete =</span>
<a href="#l63.130"></a><span id="l63.130" class="difflineminus">-            function(aLoader, aContext, aStatus, aResultLength, aResult) {</span>
<a href="#l63.131"></a><span id="l63.131" class="difflineplus">+        streamListener.onStreamComplete = function(aLoader, aContext, aStatus, aResultLength, aResult) {</span>
<a href="#l63.132"></a><span id="l63.132">             let request = aLoader.request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l63.133"></a><span id="l63.133">             try {</span>
<a href="#l63.134"></a><span id="l63.134">                 cal.LOG(&quot;CalDAV: Status &quot; + request.responseStatus +</span>
<a href="#l63.135"></a><span id="l63.135">                         &quot; checking ctag for calendar &quot; + self.name);</span>
<a href="#l63.136"></a><span id="l63.136">             } catch (ex) {</span>
<a href="#l63.137"></a><span id="l63.137">                 cal.LOG(&quot;CalDAV: Error without status on checking ctag for calendar &quot; +</span>
<a href="#l63.138"></a><span id="l63.138">                         self.name);</span>
<a href="#l63.139"></a><span id="l63.139">                 notifyListener(Components.results.NS_OK);</span>
<a href="#l63.140"></a><span id="l63.140" class="difflineat">@@ -1410,17 +1409,17 @@ calDavCalendar.prototype = {</span>
<a href="#l63.141"></a><span id="l63.141">                         &quot; due to 404&quot;);</span>
<a href="#l63.142"></a><span id="l63.142">                 notifyListener(Components.results.NS_ERROR_FAILURE);</span>
<a href="#l63.143"></a><span id="l63.143">                 return;</span>
<a href="#l63.144"></a><span id="l63.144">             } else if (request.responseStatus == 207 &amp;&amp; self.mDisabled) {</span>
<a href="#l63.145"></a><span id="l63.145">                 // Looks like the calendar is there again, check its resource</span>
<a href="#l63.146"></a><span id="l63.146">                 // type first.</span>
<a href="#l63.147"></a><span id="l63.147">                 self.setupAuthentication(aChangeLogListener);</span>
<a href="#l63.148"></a><span id="l63.148">                 return;</span>
<a href="#l63.149"></a><span id="l63.149" class="difflineminus">-             }</span>
<a href="#l63.150"></a><span id="l63.150" class="difflineplus">+            }</span>
<a href="#l63.151"></a><span id="l63.151"> </span>
<a href="#l63.152"></a><span id="l63.152">             let str = cal.convertByteArray(aResult, aResultLength);</span>
<a href="#l63.153"></a><span id="l63.153">             if (!str) {</span>
<a href="#l63.154"></a><span id="l63.154">                 cal.LOG(&quot;CalDAV: Failed to get ctag from server for calendar &quot; +</span>
<a href="#l63.155"></a><span id="l63.155">                         self.name);</span>
<a href="#l63.156"></a><span id="l63.156">             } else if (self.verboseLogging()) {</span>
<a href="#l63.157"></a><span id="l63.157">                 cal.LOG(&quot;CalDAV: recv: &quot; + str);</span>
<a href="#l63.158"></a><span id="l63.158">             }</span>
<a href="#l63.159"></a><span id="l63.159" class="difflineat">@@ -2558,17 +2557,17 @@ calDavCalendar.prototype = {</span>
<a href="#l63.160"></a><span id="l63.160">     extractPathFromSpec: function(aSpec) {</span>
<a href="#l63.161"></a><span id="l63.161">         // The parsed array should look like this:</span>
<a href="#l63.162"></a><span id="l63.162">         // a[0] = full string</span>
<a href="#l63.163"></a><span id="l63.163">         // a[1] = scheme</span>
<a href="#l63.164"></a><span id="l63.164">         // a[2] = everything between the scheme and the start of the path</span>
<a href="#l63.165"></a><span id="l63.165">         // a[3] = extracted path</span>
<a href="#l63.166"></a><span id="l63.166">         let a = aSpec.match(&quot;(https?)(://[^/]*)([^#?]*)&quot;);</span>
<a href="#l63.167"></a><span id="l63.167">         if (a &amp;&amp; a[3]) {</span>
<a href="#l63.168"></a><span id="l63.168" class="difflineminus">-          return a[3];</span>
<a href="#l63.169"></a><span id="l63.169" class="difflineplus">+            return a[3];</span>
<a href="#l63.170"></a><span id="l63.170">         }</span>
<a href="#l63.171"></a><span id="l63.171">         cal.WARN(&quot;CalDAV: Spec could not be parsed, returning as-is: &quot; + aSpec);</span>
<a href="#l63.172"></a><span id="l63.172">         return aSpec;</span>
<a href="#l63.173"></a><span id="l63.173">     },</span>
<a href="#l63.174"></a><span id="l63.174">     /**</span>
<a href="#l63.175"></a><span id="l63.175">      * This is called to create an encoded path from a unencoded path OR</span>
<a href="#l63.176"></a><span id="l63.176">      * encoded full url</span>
<a href="#l63.177"></a><span id="l63.177">      *</span>
<a href="#l63.178"></a><span id="l63.178" class="difflineat">@@ -2893,17 +2892,17 @@ calDavCalendar.prototype = {</span>
<a href="#l63.179"></a><span id="l63.179">                 if (hdrValue) {</span>
<a href="#l63.180"></a><span id="l63.180">                     aNewChannel.setRequestHeader(aHdr, hdrValue, false);</span>
<a href="#l63.181"></a><span id="l63.181">                 }</span>
<a href="#l63.182"></a><span id="l63.182">             } catch (e) {</span>
<a href="#l63.183"></a><span id="l63.183">                 if (e.code != Components.results.NS_ERROR_NOT_AVAILIBLE) {</span>
<a href="#l63.184"></a><span id="l63.184">                     // The header could possibly not be availible, ignore that</span>
<a href="#l63.185"></a><span id="l63.185">                     // case but throw otherwise</span>
<a href="#l63.186"></a><span id="l63.186">                     throw e;</span>
<a href="#l63.187"></a><span id="l63.187" class="difflineminus">-               }</span>
<a href="#l63.188"></a><span id="l63.188" class="difflineplus">+                }</span>
<a href="#l63.189"></a><span id="l63.189">             }</span>
<a href="#l63.190"></a><span id="l63.190">         }</span>
<a href="#l63.191"></a><span id="l63.191"> </span>
<a href="#l63.192"></a><span id="l63.192">         // If any other header is used, it should be added here. We might want</span>
<a href="#l63.193"></a><span id="l63.193">         // to just copy all headers over to the new channel.</span>
<a href="#l63.194"></a><span id="l63.194">         copyHeader(&quot;Depth&quot;);</span>
<a href="#l63.195"></a><span id="l63.195">         copyHeader(&quot;Originator&quot;);</span>
<a href="#l63.196"></a><span id="l63.196">         copyHeader(&quot;Recipient&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -538,21 +538,21 @@ webDavSyncHandler.prototype = {</span>
<a href="#l64.4"></a><span id="l64.4">                 let resp = this.currentResponse;</span>
<a href="#l64.5"></a><span id="l64.5">                 if (resp.href &amp;&amp; resp.href.length) {</span>
<a href="#l64.6"></a><span id="l64.6">                     resp.href = this.calendar.ensureDecodedPath(resp.href);</span>
<a href="#l64.7"></a><span id="l64.7">                 }</span>
<a href="#l64.8"></a><span id="l64.8"> </span>
<a href="#l64.9"></a><span id="l64.9">                 if ((!resp.getcontenttype || resp.getcontenttype == &quot;text/plain&quot;) &amp;&amp;</span>
<a href="#l64.10"></a><span id="l64.10">                     resp.href &amp;&amp;</span>
<a href="#l64.11"></a><span id="l64.11">                     resp.href.endsWith(&quot;.ics&quot;)) {</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-                  // If there is no content-type (iCloud) or text/plain was passed</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineminus">-                  // (iCal Server) for the resource but its name ends with &quot;.ics&quot;</span>
<a href="#l64.14"></a><span id="l64.14" class="difflineminus">-                  // assume the content type to be text/calendar. Apple</span>
<a href="#l64.15"></a><span id="l64.15" class="difflineminus">-                  // iCloud/iCal Server interoperability fix.</span>
<a href="#l64.16"></a><span id="l64.16" class="difflineminus">-                  resp.getcontenttype = &quot;text/calendar&quot;;</span>
<a href="#l64.17"></a><span id="l64.17" class="difflineplus">+                    // If there is no content-type (iCloud) or text/plain was passed</span>
<a href="#l64.18"></a><span id="l64.18" class="difflineplus">+                    // (iCal Server) for the resource but its name ends with &quot;.ics&quot;</span>
<a href="#l64.19"></a><span id="l64.19" class="difflineplus">+                    // assume the content type to be text/calendar. Apple</span>
<a href="#l64.20"></a><span id="l64.20" class="difflineplus">+                    // iCloud/iCal Server interoperability fix.</span>
<a href="#l64.21"></a><span id="l64.21" class="difflineplus">+                    resp.getcontenttype = &quot;text/calendar&quot;;</span>
<a href="#l64.22"></a><span id="l64.22">                 }</span>
<a href="#l64.23"></a><span id="l64.23"> </span>
<a href="#l64.24"></a><span id="l64.24">                 // Deleted item</span>
<a href="#l64.25"></a><span id="l64.25">                 if (resp.href &amp;&amp; resp.href.length &amp;&amp;</span>
<a href="#l64.26"></a><span id="l64.26">                     resp.status &amp;&amp;</span>
<a href="#l64.27"></a><span id="l64.27">                     resp.status.length &amp;&amp;</span>
<a href="#l64.28"></a><span id="l64.28">                     resp.status.indexOf(&quot; 404&quot;) &gt; 0) {</span>
<a href="#l64.29"></a><span id="l64.29">                     if (this.calendar.mHrefIndex[resp.href]) {</span>
<a href="#l64.30"></a><span id="l64.30" class="difflineat">@@ -765,17 +765,17 @@ multigetSyncHandler.prototype = {</span>
<a href="#l64.31"></a><span id="l64.31">             this.calendar.superCalendar.endBatch();</span>
<a href="#l64.32"></a><span id="l64.32">             this.calendar.notifyGetFailed(&quot;multiget error&quot;, this.listener, this.changeLogListener);</span>
<a href="#l64.33"></a><span id="l64.33">             return;</span>
<a href="#l64.34"></a><span id="l64.34">         }</span>
<a href="#l64.35"></a><span id="l64.35">         if (this.itemsNeedFetching.length == 0) {</span>
<a href="#l64.36"></a><span id="l64.36">             if (this.newSyncToken) {</span>
<a href="#l64.37"></a><span id="l64.37">                 this.calendar.mWebdavSyncToken = this.newSyncToken;</span>
<a href="#l64.38"></a><span id="l64.38">                 this.calendar.saveCalendarProperties();</span>
<a href="#l64.39"></a><span id="l64.39" class="difflineminus">-              cal.LOG(&quot;CalDAV: New webdav-sync Token: &quot; + this.calendar.mWebdavSyncToken);</span>
<a href="#l64.40"></a><span id="l64.40" class="difflineplus">+                cal.LOG(&quot;CalDAV: New webdav-sync Token: &quot; + this.calendar.mWebdavSyncToken);</span>
<a href="#l64.41"></a><span id="l64.41">             }</span>
<a href="#l64.42"></a><span id="l64.42"> </span>
<a href="#l64.43"></a><span id="l64.43">             if (this.additionalSyncNeeded) {</span>
<a href="#l64.44"></a><span id="l64.44">                 setTimeout(() =&gt; {</span>
<a href="#l64.45"></a><span id="l64.45">                     let wds = new webDavSyncHandler(this.calendar,</span>
<a href="#l64.46"></a><span id="l64.46">                                                     this.baseUri,</span>
<a href="#l64.47"></a><span id="l64.47">                                                     this.changeLogListener);</span>
<a href="#l64.48"></a><span id="l64.48">                     wds.doWebDAVSync();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -118,17 +118,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l65.4"></a><span id="l65.4"> </span>
<a href="#l65.5"></a><span id="l65.5">     mCalendars: null,</span>
<a href="#l65.6"></a><span id="l65.6">     mDefaultCalendar: null,</span>
<a href="#l65.7"></a><span id="l65.7">     mPrefPrefix: null,</span>
<a href="#l65.8"></a><span id="l65.8">     mDefaultPref: null,</span>
<a href="#l65.9"></a><span id="l65.9">     mActivePref: null,</span>
<a href="#l65.10"></a><span id="l65.10"> </span>
<a href="#l65.11"></a><span id="l65.11">     get enabledCalendars() {</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-      return this.mCalendars.filter(e =&gt; !e.getProperty(&quot;disabled&quot;));</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+        return this.mCalendars.filter(e =&gt; !e.getProperty(&quot;disabled&quot;));</span>
<a href="#l65.14"></a><span id="l65.14">     },</span>
<a href="#l65.15"></a><span id="l65.15"> </span>
<a href="#l65.16"></a><span id="l65.16">     set prefPrefix(aPrefPrefix) {</span>
<a href="#l65.17"></a><span id="l65.17">         if (this.mPrefPrefix) {</span>
<a href="#l65.18"></a><span id="l65.18">             for (let calendar of this.mCalendars) {</span>
<a href="#l65.19"></a><span id="l65.19">                 this.removeCalendar(calendar);</span>
<a href="#l65.20"></a><span id="l65.20">             }</span>
<a href="#l65.21"></a><span id="l65.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-list-tree.xml</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-list-tree.xml</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -56,65 +56,69 @@</span>
<a href="#l66.4"></a><span id="l66.4">                           context=&quot;_child&quot;</span>
<a href="#l66.5"></a><span id="l66.5">                           ondragstart=&quot;onDragStart(event);&quot;</span>
<a href="#l66.6"></a><span id="l66.6">                           onoverflow=&quot;displayScrollbarSpacer(true)&quot;</span>
<a href="#l66.7"></a><span id="l66.7">                           onunderflow=&quot;displayScrollbarSpacer(false)&quot;&gt;</span>
<a href="#l66.8"></a><span id="l66.8">           &lt;children includes=&quot;tooltip|menupopup&quot;/&gt;</span>
<a href="#l66.9"></a><span id="l66.9">         &lt;/xul:treechildren&gt;</span>
<a href="#l66.10"></a><span id="l66.10">       &lt;/xul:tree&gt;</span>
<a href="#l66.11"></a><span id="l66.11">     &lt;/content&gt;</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineplus">+</span>
<a href="#l66.13"></a><span id="l66.13">     &lt;implementation&gt;</span>
<a href="#l66.14"></a><span id="l66.14">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l66.15"></a><span id="l66.15">         this.tree.view = this;</span>
<a href="#l66.16"></a><span id="l66.16">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l66.17"></a><span id="l66.17" class="difflineplus">+</span>
<a href="#l66.18"></a><span id="l66.18">       &lt;property name=&quot;mockCalendarHeader&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l66.19"></a><span id="l66.19">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l66.20"></a><span id="l66.20">           let calmgr = cal.getCalendarManager();</span>
<a href="#l66.21"></a><span id="l66.21">           let uri = &quot;dummy://calendar&quot;;</span>
<a href="#l66.22"></a><span id="l66.22">           let mem = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(uri, null, null));</span>
<a href="#l66.23"></a><span id="l66.23">           mem.setProperty(&quot;disabled&quot;, true);</span>
<a href="#l66.24"></a><span id="l66.24">           mem.name = &quot;Calendars&quot;;</span>
<a href="#l66.25"></a><span id="l66.25">           mem.id = cal.getUUID();</span>
<a href="#l66.26"></a><span id="l66.26">           return mem;</span>
<a href="#l66.27"></a><span id="l66.27">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l66.28"></a><span id="l66.28">       &lt;/property&gt;</span>
<a href="#l66.29"></a><span id="l66.29" class="difflineplus">+</span>
<a href="#l66.30"></a><span id="l66.30">       &lt;property name=&quot;mockTaskHeader&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l66.31"></a><span id="l66.31">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l66.32"></a><span id="l66.32">           let calmgr = cal.getCalendarManager();</span>
<a href="#l66.33"></a><span id="l66.33">           let uri = &quot;dummy://tasks&quot;;</span>
<a href="#l66.34"></a><span id="l66.34">           let mem = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(uri, null, null));</span>
<a href="#l66.35"></a><span id="l66.35">           mem.setProperty(&quot;disabled&quot;, true);</span>
<a href="#l66.36"></a><span id="l66.36">           mem.name = &quot;Task Lists&quot;;</span>
<a href="#l66.37"></a><span id="l66.37">           mem.id = cal.getUUID();</span>
<a href="#l66.38"></a><span id="l66.38">           return mem;</span>
<a href="#l66.39"></a><span id="l66.39">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l66.40"></a><span id="l66.40">       &lt;/property&gt;</span>
<a href="#l66.41"></a><span id="l66.41" class="difflineplus">+</span>
<a href="#l66.42"></a><span id="l66.42">       &lt;field name=&quot;mCalendarHeaderIndex&quot;&gt;0&lt;/field&gt;</span>
<a href="#l66.43"></a><span id="l66.43">       &lt;field name=&quot;mTasksHeaderIndex&quot;&gt;0&lt;/field&gt;</span>
<a href="#l66.44"></a><span id="l66.44"> </span>
<a href="#l66.45"></a><span id="l66.45">       &lt;field name=&quot;QueryInterface&quot;&gt;XPCOMUtils.generateQI([Components.interfaces.nsITreeView])&lt;/field&gt;</span>
<a href="#l66.46"></a><span id="l66.46"> </span>
<a href="#l66.47"></a><span id="l66.47">       &lt;property name=&quot;calendars&quot;&gt;</span>
<a href="#l66.48"></a><span id="l66.48">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l66.49"></a><span id="l66.49">           return this.mCalendarList;</span>
<a href="#l66.50"></a><span id="l66.50">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l66.51"></a><span id="l66.51">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l66.52"></a><span id="l66.52" class="difflineminus">-            for (let i = 0; i &lt; val.length; i++) {</span>
<a href="#l66.53"></a><span id="l66.53" class="difflineminus">-                let calendar = val[i];</span>
<a href="#l66.54"></a><span id="l66.54" class="difflineminus">-                let spec = calendar.uri.spec;</span>
<a href="#l66.55"></a><span id="l66.55" class="difflineminus">-                if (calendar.type == &quot;memory&quot;) {</span>
<a href="#l66.56"></a><span id="l66.56" class="difflineminus">-                    if (spec == &quot;dummy://calendar&quot;) {</span>
<a href="#l66.57"></a><span id="l66.57" class="difflineminus">-                        this.mCalendarHeaderIndex = i;</span>
<a href="#l66.58"></a><span id="l66.58" class="difflineminus">-                    } else if (spec == &quot;dummy://tasks&quot;) {</span>
<a href="#l66.59"></a><span id="l66.59" class="difflineminus">-                        this.mTasksHeaderIndex = i;</span>
<a href="#l66.60"></a><span id="l66.60" class="difflineminus">-                    }</span>
<a href="#l66.61"></a><span id="l66.61" class="difflineminus">-                }</span>
<a href="#l66.62"></a><span id="l66.62" class="difflineminus">-                this.addCalendar(calendar);</span>
<a href="#l66.63"></a><span id="l66.63" class="difflineminus">-            }</span>
<a href="#l66.64"></a><span id="l66.64" class="difflineminus">-            return this.mCalendarList;</span>
<a href="#l66.65"></a><span id="l66.65" class="difflineplus">+          for (let i = 0; i &lt; val.length; i++) {</span>
<a href="#l66.66"></a><span id="l66.66" class="difflineplus">+              let calendar = val[i];</span>
<a href="#l66.67"></a><span id="l66.67" class="difflineplus">+              let spec = calendar.uri.spec;</span>
<a href="#l66.68"></a><span id="l66.68" class="difflineplus">+              if (calendar.type == &quot;memory&quot;) {</span>
<a href="#l66.69"></a><span id="l66.69" class="difflineplus">+                  if (spec == &quot;dummy://calendar&quot;) {</span>
<a href="#l66.70"></a><span id="l66.70" class="difflineplus">+                      this.mCalendarHeaderIndex = i;</span>
<a href="#l66.71"></a><span id="l66.71" class="difflineplus">+                  } else if (spec == &quot;dummy://tasks&quot;) {</span>
<a href="#l66.72"></a><span id="l66.72" class="difflineplus">+                      this.mTasksHeaderIndex = i;</span>
<a href="#l66.73"></a><span id="l66.73" class="difflineplus">+                  }</span>
<a href="#l66.74"></a><span id="l66.74" class="difflineplus">+              }</span>
<a href="#l66.75"></a><span id="l66.75" class="difflineplus">+              this.addCalendar(calendar);</span>
<a href="#l66.76"></a><span id="l66.76" class="difflineplus">+          }</span>
<a href="#l66.77"></a><span id="l66.77" class="difflineplus">+          return this.mCalendarList;</span>
<a href="#l66.78"></a><span id="l66.78">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l66.79"></a><span id="l66.79">       &lt;/property&gt;</span>
<a href="#l66.80"></a><span id="l66.80"> </span>
<a href="#l66.81"></a><span id="l66.81">       &lt;method name=&quot;removeCalendar&quot;&gt;</span>
<a href="#l66.82"></a><span id="l66.82">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l66.83"></a><span id="l66.83">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l66.84"></a><span id="l66.84">           let index = this.findIndexById(aCalendar.id);</span>
<a href="#l66.85"></a><span id="l66.85">           if (index &lt; this.mCalendarHeaderIndex) {</span>
<a href="#l66.86"></a><span id="l66.86" class="difflineat">@@ -152,20 +156,20 @@</span>
<a href="#l66.87"></a><span id="l66.87"> </span>
<a href="#l66.88"></a><span id="l66.88">           return props;</span>
<a href="#l66.89"></a><span id="l66.89">         ]]&gt;&lt;/body&gt;</span>
<a href="#l66.90"></a><span id="l66.90">       &lt;/method&gt;</span>
<a href="#l66.91"></a><span id="l66.91"> </span>
<a href="#l66.92"></a><span id="l66.92">       &lt;method name=&quot;isContainerEmpty&quot;&gt;</span>
<a href="#l66.93"></a><span id="l66.93">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l66.94"></a><span id="l66.94">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l66.95"></a><span id="l66.95" class="difflineminus">-         return ((aRow == this.mCalendarHeaderIndex &amp;&amp;</span>
<a href="#l66.96"></a><span id="l66.96" class="difflineplus">+          return (aRow == this.mCalendarHeaderIndex &amp;&amp;</span>
<a href="#l66.97"></a><span id="l66.97">                   aRow + 1 == this.mTasksHeaderIndex) ||</span>
<a href="#l66.98"></a><span id="l66.98">                  (aRow == this.mTasksHeaderIndex &amp;&amp;</span>
<a href="#l66.99"></a><span id="l66.99" class="difflineminus">-                  aRow == this.mCalendarList.lengh));</span>
<a href="#l66.100"></a><span id="l66.100" class="difflineplus">+                  aRow == this.mCalendarList.lengh);</span>
<a href="#l66.101"></a><span id="l66.101">         ]]&gt;&lt;/body&gt;</span>
<a href="#l66.102"></a><span id="l66.102">       &lt;/method&gt;</span>
<a href="#l66.103"></a><span id="l66.103"> </span>
<a href="#l66.104"></a><span id="l66.104">       &lt;method name=&quot;isContainer&quot;&gt;</span>
<a href="#l66.105"></a><span id="l66.105">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l66.106"></a><span id="l66.106">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l66.107"></a><span id="l66.107">           let calendar = this.getCalendar(aRow);</span>
<a href="#l66.108"></a><span id="l66.108">           return (calendar.type == &quot;memory&quot; &amp;&amp; calendar.uri.schemeIs(&quot;dummy&quot;));</span>
<a href="#l66.109"></a><span id="l66.109" class="difflineat">@@ -202,16 +206,17 @@</span>
<a href="#l66.110"></a><span id="l66.110">           } else if (aRow == this.mTasksHeaderIndex) {</span>
<a href="#l66.111"></a><span id="l66.111">               return false;</span>
<a href="#l66.112"></a><span id="l66.112">           } else {</span>
<a href="#l66.113"></a><span id="l66.113">               return aAfterIndex != this.mCalendarHeaderIndex - 1 &amp;&amp;</span>
<a href="#l66.114"></a><span id="l66.114">                      aAfterIndex != this.mTasksHeaderIndex - 1;</span>
<a href="#l66.115"></a><span id="l66.115">           }</span>
<a href="#l66.116"></a><span id="l66.116">         ]]&gt;&lt;/body&gt;</span>
<a href="#l66.117"></a><span id="l66.117">       &lt;/method&gt;</span>
<a href="#l66.118"></a><span id="l66.118" class="difflineplus">+</span>
<a href="#l66.119"></a><span id="l66.119">       &lt;method name=&quot;cycleCell&quot;&gt;</span>
<a href="#l66.120"></a><span id="l66.120">         &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l66.121"></a><span id="l66.121">         &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l66.122"></a><span id="l66.122">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l66.123"></a><span id="l66.123">           let calendar = this.getCalendar(aRow);</span>
<a href="#l66.124"></a><span id="l66.124">           let composite = this.compositeCalendar;</span>
<a href="#l66.125"></a><span id="l66.125">           if (composite.getCalendarById(calendar.id)) {</span>
<a href="#l66.126"></a><span id="l66.126">               composite.removeCalendar(calendar);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -222,17 +222,17 @@ calICSCalendar.prototype = {</span>
<a href="#l67.4"></a><span id="l67.4">             // no need to process further, we can use the previous data</span>
<a href="#l67.5"></a><span id="l67.5">             // HACK Sorry, but offline support requires the items to be signaled</span>
<a href="#l67.6"></a><span id="l67.6">             // even if nothing has changed (especially at startup)</span>
<a href="#l67.7"></a><span id="l67.7">             this.mObserver.onLoad(this);</span>
<a href="#l67.8"></a><span id="l67.8">             this.unlock();</span>
<a href="#l67.9"></a><span id="l67.9">             return;</span>
<a href="#l67.10"></a><span id="l67.10">         }</span>
<a href="#l67.11"></a><span id="l67.11"> </span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-         // Clear any existing events if there was no result</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+        // Clear any existing events if there was no result</span>
<a href="#l67.14"></a><span id="l67.14">         if (!resultLength) {</span>
<a href="#l67.15"></a><span id="l67.15">             this.createMemoryCalendar();</span>
<a href="#l67.16"></a><span id="l67.16">             this.mMemoryCalendar.addObserver(this.mObserver);</span>
<a href="#l67.17"></a><span id="l67.17">             this.mObserver.onLoad(this);</span>
<a href="#l67.18"></a><span id="l67.18">             this.unlock();</span>
<a href="#l67.19"></a><span id="l67.19">             return;</span>
<a href="#l67.20"></a><span id="l67.20">         }</span>
<a href="#l67.21"></a><span id="l67.21"> </span>
<a href="#l67.22"></a><span id="l67.22" class="difflineat">@@ -304,18 +304,17 @@ calICSCalendar.prototype = {</span>
<a href="#l67.23"></a><span id="l67.23">             this.unlock(calIErrors.MODIFICATION_FAILED);</span>
<a href="#l67.24"></a><span id="l67.24">             throw exc;</span>
<a href="#l67.25"></a><span id="l67.25">         }</span>
<a href="#l67.26"></a><span id="l67.26">     },</span>
<a href="#l67.27"></a><span id="l67.27"> </span>
<a href="#l67.28"></a><span id="l67.28">     doWriteICS: function() {</span>
<a href="#l67.29"></a><span id="l67.29">         cal.LOG(&quot;[calICSCalendar] Writing ICS File &quot; + this.uri.spec);</span>
<a href="#l67.30"></a><span id="l67.30">         let self = this;</span>
<a href="#l67.31"></a><span id="l67.31" class="difflineminus">-        let listener =</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineminus">-        {</span>
<a href="#l67.33"></a><span id="l67.33" class="difflineplus">+        let listener = {</span>
<a href="#l67.34"></a><span id="l67.34">             serializer: null,</span>
<a href="#l67.35"></a><span id="l67.35">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l67.36"></a><span id="l67.36">             onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l67.37"></a><span id="l67.37">                 let inLastWindowClosingSurvivalArea = false;</span>
<a href="#l67.38"></a><span id="l67.38">                 try {</span>
<a href="#l67.39"></a><span id="l67.39">                     // All events are returned. Now set up a channel and a</span>
<a href="#l67.40"></a><span id="l67.40">                     // streamloader to upload.  onStopRequest will be called</span>
<a href="#l67.41"></a><span id="l67.41">                     // once the write has finished</span>
<a href="#l67.42"></a><span id="l67.42" class="difflineat">@@ -396,23 +395,23 @@ calICSCalendar.prototype = {</span>
<a href="#l67.43"></a><span id="l67.43">         this.mMemoryCalendar.getItems(calICalendar.ITEM_FILTER_TYPE_ALL | calICalendar.ITEM_FILTER_COMPLETED_ALL,</span>
<a href="#l67.44"></a><span id="l67.44">                                       0, null, null, listener);</span>
<a href="#l67.45"></a><span id="l67.45">     },</span>
<a href="#l67.46"></a><span id="l67.46"> </span>
<a href="#l67.47"></a><span id="l67.47">     // nsIStreamListener impl</span>
<a href="#l67.48"></a><span id="l67.48">     // For after publishing. Do error checks here</span>
<a href="#l67.49"></a><span id="l67.49">     onStartRequest: function(request, ctxt) {},</span>
<a href="#l67.50"></a><span id="l67.50">     onDataAvailable: function(request, ctxt, inStream, sourceOffset, count) {</span>
<a href="#l67.51"></a><span id="l67.51" class="difflineminus">-         // All data must be consumed. For an upload channel, there is</span>
<a href="#l67.52"></a><span id="l67.52" class="difflineminus">-         // no meaningfull data. So it gets read and then ignored</span>
<a href="#l67.53"></a><span id="l67.53" class="difflineminus">-         let scriptableInputStream =</span>
<a href="#l67.54"></a><span id="l67.54" class="difflineminus">-             Components.classes[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l67.55"></a><span id="l67.55" class="difflineminus">-                       .createInstance(Components.interfaces.nsIScriptableInputStream);</span>
<a href="#l67.56"></a><span id="l67.56" class="difflineminus">-         scriptableInputStream.init(inStream);</span>
<a href="#l67.57"></a><span id="l67.57" class="difflineminus">-         scriptableInputStream.read(-1);</span>
<a href="#l67.58"></a><span id="l67.58" class="difflineplus">+        // All data must be consumed. For an upload channel, there is</span>
<a href="#l67.59"></a><span id="l67.59" class="difflineplus">+        // no meaningfull data. So it gets read and then ignored</span>
<a href="#l67.60"></a><span id="l67.60" class="difflineplus">+        let scriptableInputStream =</span>
<a href="#l67.61"></a><span id="l67.61" class="difflineplus">+            Components.classes[&quot;@mozilla.org/scriptableinputstream;1&quot;]</span>
<a href="#l67.62"></a><span id="l67.62" class="difflineplus">+                      .createInstance(Components.interfaces.nsIScriptableInputStream);</span>
<a href="#l67.63"></a><span id="l67.63" class="difflineplus">+        scriptableInputStream.init(inStream);</span>
<a href="#l67.64"></a><span id="l67.64" class="difflineplus">+        scriptableInputStream.read(-1);</span>
<a href="#l67.65"></a><span id="l67.65">     },</span>
<a href="#l67.66"></a><span id="l67.66">     onStopRequest: function(request, ctxt, status, errorMsg) {</span>
<a href="#l67.67"></a><span id="l67.67">         ctxt = ctxt.wrappedJSObject;</span>
<a href="#l67.68"></a><span id="l67.68">         let httpChannel;</span>
<a href="#l67.69"></a><span id="l67.69">         let requestSucceeded = false;</span>
<a href="#l67.70"></a><span id="l67.70">         try {</span>
<a href="#l67.71"></a><span id="l67.71">             httpChannel = request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l67.72"></a><span id="l67.72">             requestSucceeded = httpChannel.requestSucceeded;</span>
<a href="#l67.73"></a><span id="l67.73" class="difflineat">@@ -1086,17 +1085,17 @@ fileHooks.prototype = {</span>
<a href="#l67.74"></a><span id="l67.74">             if (this.mtime == newMtime &amp;&amp; !aForceRefresh) {</span>
<a href="#l67.75"></a><span id="l67.75">                 return false;</span>
<a href="#l67.76"></a><span id="l67.76">             } else {</span>
<a href="#l67.77"></a><span id="l67.77">                 this.mtime = newMtime;</span>
<a href="#l67.78"></a><span id="l67.78">                 return true;</span>
<a href="#l67.79"></a><span id="l67.79">             }</span>
<a href="#l67.80"></a><span id="l67.80">         } else {</span>
<a href="#l67.81"></a><span id="l67.81">             this.mtime = filechannel.file.lastModifiedTime;</span>
<a href="#l67.82"></a><span id="l67.82" class="difflineminus">-        return true;</span>
<a href="#l67.83"></a><span id="l67.83" class="difflineplus">+            return true;</span>
<a href="#l67.84"></a><span id="l67.84">         }</span>
<a href="#l67.85"></a><span id="l67.85">     },</span>
<a href="#l67.86"></a><span id="l67.86"> </span>
<a href="#l67.87"></a><span id="l67.87">     onBeforePut: function(aChannel) {</span>
<a href="#l67.88"></a><span id="l67.88">         let filechannel = aChannel.QueryInterface(Components.interfaces.nsIFileChannel);</span>
<a href="#l67.89"></a><span id="l67.89">         if (this.mtime &amp;&amp; this.mtime != filechannel.file.lastModifiedTime) {</span>
<a href="#l67.90"></a><span id="l67.90">             return false;</span>
<a href="#l67.91"></a><span id="l67.91">         } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -224,17 +224,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l68.4"></a><span id="l68.4">             aOldItem = aOldItem.parentItem;</span>
<a href="#l68.5"></a><span id="l68.5">             let storedOldItem = this.mItems[aOldItem.id];</span>
<a href="#l68.6"></a><span id="l68.6"> </span>
<a href="#l68.7"></a><span id="l68.7">             // compareItems is not suitable here. See bug 418805.</span>
<a href="#l68.8"></a><span id="l68.8">             // Cannot compare here due to bug 380060</span>
<a href="#l68.9"></a><span id="l68.9">             if (!cal.compareItemContent(storedOldItem, aOldItem)) {</span>
<a href="#l68.10"></a><span id="l68.10">                 return reportError(&quot;old item mismatch in modifyItem. storedId:&quot; + storedOldItem.icalComponent + &quot; old item:&quot; + aOldItem.icalComponent);</span>
<a href="#l68.11"></a><span id="l68.11">             }</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-           // offline bug</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+            // offline bug</span>
<a href="#l68.14"></a><span id="l68.14"> </span>
<a href="#l68.15"></a><span id="l68.15">             if (aOldItem.generation != storedOldItem.generation) {</span>
<a href="#l68.16"></a><span id="l68.16">                 return reportError(&quot;generation mismatch in modifyItem&quot;);</span>
<a href="#l68.17"></a><span id="l68.17">             }</span>
<a href="#l68.18"></a><span id="l68.18"> </span>
<a href="#l68.19"></a><span id="l68.19">             if (aOldItem.generation == modifiedItem.generation) { // has been cloned and modified</span>
<a href="#l68.20"></a><span id="l68.20">                 // Only take care of incrementing the generation if relaxed mode is</span>
<a href="#l68.21"></a><span id="l68.21">                 // off. Users of relaxed mode need to take care of this themselves.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -73,17 +73,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l69.4"></a><span id="l69.4">         aCalendar = aCalendar.wrappedJSObject;</span>
<a href="#l69.5"></a><span id="l69.5"> </span>
<a href="#l69.6"></a><span id="l69.6">         if (this.mDeleteEventExtras) {</span>
<a href="#l69.7"></a><span id="l69.7">             for (let stmt of this.mDeleteEventExtras) {</span>
<a href="#l69.8"></a><span id="l69.8">                 try {</span>
<a href="#l69.9"></a><span id="l69.9">                     this.prepareStatement(stmt);</span>
<a href="#l69.10"></a><span id="l69.10">                     stmt.executeStep();</span>
<a href="#l69.11"></a><span id="l69.11">                 } finally {</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-                stmt.reset();</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+                    stmt.reset();</span>
<a href="#l69.14"></a><span id="l69.14">                 }</span>
<a href="#l69.15"></a><span id="l69.15">             }</span>
<a href="#l69.16"></a><span id="l69.16">         }</span>
<a href="#l69.17"></a><span id="l69.17"> </span>
<a href="#l69.18"></a><span id="l69.18">         if (this.mDeleteTodoExtras) {</span>
<a href="#l69.19"></a><span id="l69.19">             for (let stmt of this.mDeleteTodoExtras) {</span>
<a href="#l69.20"></a><span id="l69.20">                 try {</span>
<a href="#l69.21"></a><span id="l69.21">                     this.prepareStatement(stmt);</span>
<a href="#l69.22"></a><span id="l69.22" class="difflineat">@@ -942,18 +942,18 @@ calStorageCalendar.prototype = {</span>
<a href="#l69.23"></a><span id="l69.23"> </span>
<a href="#l69.24"></a><span id="l69.24">     getItemOfflineFlag: function(aItem, aListener) {</span>
<a href="#l69.25"></a><span id="l69.25">         let flag = null;</span>
<a href="#l69.26"></a><span id="l69.26">         if (aItem) {</span>
<a href="#l69.27"></a><span id="l69.27">             let aID = aItem.id;</span>
<a href="#l69.28"></a><span id="l69.28">             let self = this;</span>
<a href="#l69.29"></a><span id="l69.29">             let listener = {</span>
<a href="#l69.30"></a><span id="l69.30">                 handleResult: function(aResultSet) {</span>
<a href="#l69.31"></a><span id="l69.31" class="difflineminus">-                        let row = aResultSet.getNextRow();</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineminus">-                        flag = row.getResultByName(&quot;offline_journal&quot;) || null;</span>
<a href="#l69.33"></a><span id="l69.33" class="difflineplus">+                    let row = aResultSet.getNextRow();</span>
<a href="#l69.34"></a><span id="l69.34" class="difflineplus">+                    flag = row.getResultByName(&quot;offline_journal&quot;) || null;</span>
<a href="#l69.35"></a><span id="l69.35">                 },</span>
<a href="#l69.36"></a><span id="l69.36">                 handleError: function(aError) {</span>
<a href="#l69.37"></a><span id="l69.37">                     self.logError(&quot;Error getting offline flag&quot;, aError);</span>
<a href="#l69.38"></a><span id="l69.38">                     aListener.onOperationComplete(self, Components.results.NS_ERROR_FAILURE,</span>
<a href="#l69.39"></a><span id="l69.39">                                                   Components.interfaces.calIOperationListener.GET, aItem.id, aItem);</span>
<a href="#l69.40"></a><span id="l69.40">                 },</span>
<a href="#l69.41"></a><span id="l69.41">                 handleCompletion: function(aReason) {</span>
<a href="#l69.42"></a><span id="l69.42">                     aListener.onOperationComplete(self, Components.results.NS_OK,</span>
<a href="#l69.43"></a><span id="l69.43" class="difflineat">@@ -2401,32 +2401,32 @@ calStorageCalendar.prototype = {</span>
<a href="#l69.44"></a><span id="l69.44">      *</span>
<a href="#l69.45"></a><span id="l69.45">      * @param message           Error message to log.</span>
<a href="#l69.46"></a><span id="l69.46">      * @param exception         Exception that caused the error.</span>
<a href="#l69.47"></a><span id="l69.47">      */</span>
<a href="#l69.48"></a><span id="l69.48">     logError: function(message, exception) {</span>
<a href="#l69.49"></a><span id="l69.49">         let logMessage = &quot;Message: &quot; + message;</span>
<a href="#l69.50"></a><span id="l69.50">         if (this.mDB) {</span>
<a href="#l69.51"></a><span id="l69.51">             if (this.mDB.connectionReady) {</span>
<a href="#l69.52"></a><span id="l69.52" class="difflineminus">-              logMessage += &quot;\nConnection Ready: &quot; + this.mDB.connectionReady;</span>
<a href="#l69.53"></a><span id="l69.53" class="difflineplus">+                logMessage += &quot;\nConnection Ready: &quot; + this.mDB.connectionReady;</span>
<a href="#l69.54"></a><span id="l69.54">             }</span>
<a href="#l69.55"></a><span id="l69.55">             if (this.mDB.lastError) {</span>
<a href="#l69.56"></a><span id="l69.56" class="difflineminus">-              logMessage += &quot;\nLast DB Error Number: &quot; + this.mDB.lastError;</span>
<a href="#l69.57"></a><span id="l69.57" class="difflineplus">+                logMessage += &quot;\nLast DB Error Number: &quot; + this.mDB.lastError;</span>
<a href="#l69.58"></a><span id="l69.58">             }</span>
<a href="#l69.59"></a><span id="l69.59">             if (this.mDB.lastErrorString) {</span>
<a href="#l69.60"></a><span id="l69.60" class="difflineminus">-              logMessage += &quot;\nLast DB Error Message: &quot; + this.mDB.lastErrorString;</span>
<a href="#l69.61"></a><span id="l69.61" class="difflineplus">+                logMessage += &quot;\nLast DB Error Message: &quot; + this.mDB.lastErrorString;</span>
<a href="#l69.62"></a><span id="l69.62">             }</span>
<a href="#l69.63"></a><span id="l69.63">             if (this.mDB.databaseFile) {</span>
<a href="#l69.64"></a><span id="l69.64" class="difflineminus">-              logMessage += &quot;\nDatabase File: &quot; + this.mDB.databaseFile.path;</span>
<a href="#l69.65"></a><span id="l69.65" class="difflineplus">+                logMessage += &quot;\nDatabase File: &quot; + this.mDB.databaseFile.path;</span>
<a href="#l69.66"></a><span id="l69.66">             }</span>
<a href="#l69.67"></a><span id="l69.67">             if (this.mDB.lastInsertRowId) {</span>
<a href="#l69.68"></a><span id="l69.68" class="difflineminus">-              logMessage += &quot;\nLast Insert Row Id: &quot; + this.mDB.lastInsertRowId;</span>
<a href="#l69.69"></a><span id="l69.69" class="difflineplus">+                logMessage += &quot;\nLast Insert Row Id: &quot; + this.mDB.lastInsertRowId;</span>
<a href="#l69.70"></a><span id="l69.70">             }</span>
<a href="#l69.71"></a><span id="l69.71">             if (this.mDB.transactionInProgress) {</span>
<a href="#l69.72"></a><span id="l69.72" class="difflineminus">-              logMessage += &quot;\nTransaction In Progress: &quot; + this.mDB.transactionInProgress;</span>
<a href="#l69.73"></a><span id="l69.73" class="difflineplus">+                logMessage += &quot;\nTransaction In Progress: &quot; + this.mDB.transactionInProgress;</span>
<a href="#l69.74"></a><span id="l69.74">             }</span>
<a href="#l69.75"></a><span id="l69.75">         }</span>
<a href="#l69.76"></a><span id="l69.76"> </span>
<a href="#l69.77"></a><span id="l69.77">         if (this.mLastStatement) {</span>
<a href="#l69.78"></a><span id="l69.78">             logMessage += &quot;\nLast DB Statement: &quot; + this.mLastStatement;</span>
<a href="#l69.79"></a><span id="l69.79">             if (this.mLastStatement.params) {</span>
<a href="#l69.80"></a><span id="l69.80">                 for (let param in this.mLastStatement.params) {</span>
<a href="#l69.81"></a><span id="l69.81">                     logMessage += &quot;\nLast Statement param [&quot; + param + &quot;]: &quot; + this.mLastStatement.params[param];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -639,91 +639,91 @@ var upgrade = {};</span>
<a href="#l70.4"></a><span id="l70.4">  *</span>
<a href="#l70.5"></a><span id="l70.5">  * No bug - new recurrence system. exceptions supported now, along with</span>
<a href="#l70.6"></a><span id="l70.6">  * everything else ical can throw at us. I hope.</span>
<a href="#l70.7"></a><span id="l70.7">  * p=vlad</span>
<a href="#l70.8"></a><span id="l70.8">  */</span>
<a href="#l70.9"></a><span id="l70.9"> upgrade.v2 = upgrade.v1 = function(db, version) { // eslint-disable-line id-length</span>
<a href="#l70.10"></a><span id="l70.10">     LOGdb(db, &quot;Storage: Upgrading to v1/v2&quot;);</span>
<a href="#l70.11"></a><span id="l70.11">     let tblData = {</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-      cal_calendar_schema_version: { version: &quot;INTEGER&quot; },</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+        cal_calendar_schema_version: { version: &quot;INTEGER&quot; },</span>
<a href="#l70.14"></a><span id="l70.14"> </span>
<a href="#l70.15"></a><span id="l70.15" class="difflineminus">-    /* While this table is in v1, actually keeping it in the sql object will</span>
<a href="#l70.16"></a><span id="l70.16" class="difflineminus">-     * cause problems when migrating from storage.sdb to local.sqlite. There,</span>
<a href="#l70.17"></a><span id="l70.17" class="difflineminus">-     * all tables from storage.sdb will be moved to local.sqlite and so starting</span>
<a href="#l70.18"></a><span id="l70.18" class="difflineminus">-     * sunbird again afterwards causes a borked upgrade since its missing tables</span>
<a href="#l70.19"></a><span id="l70.19" class="difflineminus">-     * it expects.</span>
<a href="#l70.20"></a><span id="l70.20" class="difflineminus">-     *</span>
<a href="#l70.21"></a><span id="l70.21" class="difflineminus">-     *  cal_calendars: {</span>
<a href="#l70.22"></a><span id="l70.22" class="difflineminus">-     *   id:  &quot;INTEGER PRIMARY KEY&quot;,</span>
<a href="#l70.23"></a><span id="l70.23" class="difflineminus">-     *   name: &quot;STRING&quot;</span>
<a href="#l70.24"></a><span id="l70.24" class="difflineminus">-     * },</span>
<a href="#l70.25"></a><span id="l70.25" class="difflineminus">-     */</span>
<a href="#l70.26"></a><span id="l70.26" class="difflineplus">+        /* While this table is in v1, actually keeping it in the sql object will</span>
<a href="#l70.27"></a><span id="l70.27" class="difflineplus">+         * cause problems when migrating from storage.sdb to local.sqlite. There,</span>
<a href="#l70.28"></a><span id="l70.28" class="difflineplus">+         * all tables from storage.sdb will be moved to local.sqlite and so starting</span>
<a href="#l70.29"></a><span id="l70.29" class="difflineplus">+         * sunbird again afterwards causes a borked upgrade since its missing tables</span>
<a href="#l70.30"></a><span id="l70.30" class="difflineplus">+         * it expects.</span>
<a href="#l70.31"></a><span id="l70.31" class="difflineplus">+         *</span>
<a href="#l70.32"></a><span id="l70.32" class="difflineplus">+         *  cal_calendars: {</span>
<a href="#l70.33"></a><span id="l70.33" class="difflineplus">+         *   id:  &quot;INTEGER PRIMARY KEY&quot;,</span>
<a href="#l70.34"></a><span id="l70.34" class="difflineplus">+         *   name: &quot;STRING&quot;</span>
<a href="#l70.35"></a><span id="l70.35" class="difflineplus">+         * },</span>
<a href="#l70.36"></a><span id="l70.36" class="difflineplus">+         */</span>
<a href="#l70.37"></a><span id="l70.37"> </span>
<a href="#l70.38"></a><span id="l70.38" class="difflineminus">-      cal_items: {</span>
<a href="#l70.39"></a><span id="l70.39" class="difflineminus">-        cal_id: &quot;INTEGER&quot;,</span>
<a href="#l70.40"></a><span id="l70.40" class="difflineminus">-        item_type: &quot;INTEGER&quot;,</span>
<a href="#l70.41"></a><span id="l70.41" class="difflineminus">-        id: &quot;STRING&quot;,</span>
<a href="#l70.42"></a><span id="l70.42" class="difflineminus">-        time_created: &quot;INTEGER&quot;,</span>
<a href="#l70.43"></a><span id="l70.43" class="difflineminus">-        last_modified: &quot;INTEGER&quot;,</span>
<a href="#l70.44"></a><span id="l70.44" class="difflineminus">-        title: &quot;STRING&quot;,</span>
<a href="#l70.45"></a><span id="l70.45" class="difflineminus">-        priority: &quot;INTEGER&quot;,</span>
<a href="#l70.46"></a><span id="l70.46" class="difflineminus">-        privacy: &quot;STRING&quot;,</span>
<a href="#l70.47"></a><span id="l70.47" class="difflineminus">-        ical_status: &quot;STRING&quot;,</span>
<a href="#l70.48"></a><span id="l70.48" class="difflineminus">-        flags: &quot;INTEGER&quot;,</span>
<a href="#l70.49"></a><span id="l70.49" class="difflineminus">-        event_start: &quot;INTEGER&quot;,</span>
<a href="#l70.50"></a><span id="l70.50" class="difflineminus">-        event_end: &quot;INTEGER&quot;,</span>
<a href="#l70.51"></a><span id="l70.51" class="difflineminus">-        event_stamp: &quot;INTEGER&quot;,</span>
<a href="#l70.52"></a><span id="l70.52" class="difflineminus">-        todo_entry: &quot;INTEGER&quot;,</span>
<a href="#l70.53"></a><span id="l70.53" class="difflineminus">-        todo_due: &quot;INTEGER&quot;,</span>
<a href="#l70.54"></a><span id="l70.54" class="difflineminus">-        todo_completed: &quot;INTEGER&quot;,</span>
<a href="#l70.55"></a><span id="l70.55" class="difflineminus">-        todo_complete: &quot;INTEGER&quot;,</span>
<a href="#l70.56"></a><span id="l70.56" class="difflineminus">-        alarm_id: &quot;INTEGER&quot;</span>
<a href="#l70.57"></a><span id="l70.57" class="difflineminus">-      },</span>
<a href="#l70.58"></a><span id="l70.58" class="difflineplus">+        cal_items: {</span>
<a href="#l70.59"></a><span id="l70.59" class="difflineplus">+            cal_id: &quot;INTEGER&quot;,</span>
<a href="#l70.60"></a><span id="l70.60" class="difflineplus">+            item_type: &quot;INTEGER&quot;,</span>
<a href="#l70.61"></a><span id="l70.61" class="difflineplus">+            id: &quot;STRING&quot;,</span>
<a href="#l70.62"></a><span id="l70.62" class="difflineplus">+            time_created: &quot;INTEGER&quot;,</span>
<a href="#l70.63"></a><span id="l70.63" class="difflineplus">+            last_modified: &quot;INTEGER&quot;,</span>
<a href="#l70.64"></a><span id="l70.64" class="difflineplus">+            title: &quot;STRING&quot;,</span>
<a href="#l70.65"></a><span id="l70.65" class="difflineplus">+            priority: &quot;INTEGER&quot;,</span>
<a href="#l70.66"></a><span id="l70.66" class="difflineplus">+            privacy: &quot;STRING&quot;,</span>
<a href="#l70.67"></a><span id="l70.67" class="difflineplus">+            ical_status: &quot;STRING&quot;,</span>
<a href="#l70.68"></a><span id="l70.68" class="difflineplus">+            flags: &quot;INTEGER&quot;,</span>
<a href="#l70.69"></a><span id="l70.69" class="difflineplus">+            event_start: &quot;INTEGER&quot;,</span>
<a href="#l70.70"></a><span id="l70.70" class="difflineplus">+            event_end: &quot;INTEGER&quot;,</span>
<a href="#l70.71"></a><span id="l70.71" class="difflineplus">+            event_stamp: &quot;INTEGER&quot;,</span>
<a href="#l70.72"></a><span id="l70.72" class="difflineplus">+            todo_entry: &quot;INTEGER&quot;,</span>
<a href="#l70.73"></a><span id="l70.73" class="difflineplus">+            todo_due: &quot;INTEGER&quot;,</span>
<a href="#l70.74"></a><span id="l70.74" class="difflineplus">+            todo_completed: &quot;INTEGER&quot;,</span>
<a href="#l70.75"></a><span id="l70.75" class="difflineplus">+            todo_complete: &quot;INTEGER&quot;,</span>
<a href="#l70.76"></a><span id="l70.76" class="difflineplus">+            alarm_id: &quot;INTEGER&quot;</span>
<a href="#l70.77"></a><span id="l70.77" class="difflineplus">+        },</span>
<a href="#l70.78"></a><span id="l70.78"> </span>
<a href="#l70.79"></a><span id="l70.79" class="difflineminus">-      cal_attendees: {</span>
<a href="#l70.80"></a><span id="l70.80" class="difflineminus">-        item_id: &quot;STRING&quot;,</span>
<a href="#l70.81"></a><span id="l70.81" class="difflineminus">-        attendee_id: &quot;STRING&quot;,</span>
<a href="#l70.82"></a><span id="l70.82" class="difflineminus">-        common_name: &quot;STRING&quot;,</span>
<a href="#l70.83"></a><span id="l70.83" class="difflineminus">-        rsvp: &quot;INTEGER&quot;,</span>
<a href="#l70.84"></a><span id="l70.84" class="difflineminus">-        role: &quot;STRING&quot;,</span>
<a href="#l70.85"></a><span id="l70.85" class="difflineminus">-        status: &quot;STRING&quot;,</span>
<a href="#l70.86"></a><span id="l70.86" class="difflineminus">-        type: &quot;STRING&quot;</span>
<a href="#l70.87"></a><span id="l70.87" class="difflineminus">-      },</span>
<a href="#l70.88"></a><span id="l70.88" class="difflineplus">+        cal_attendees: {</span>
<a href="#l70.89"></a><span id="l70.89" class="difflineplus">+            item_id: &quot;STRING&quot;,</span>
<a href="#l70.90"></a><span id="l70.90" class="difflineplus">+            attendee_id: &quot;STRING&quot;,</span>
<a href="#l70.91"></a><span id="l70.91" class="difflineplus">+            common_name: &quot;STRING&quot;,</span>
<a href="#l70.92"></a><span id="l70.92" class="difflineplus">+            rsvp: &quot;INTEGER&quot;,</span>
<a href="#l70.93"></a><span id="l70.93" class="difflineplus">+            role: &quot;STRING&quot;,</span>
<a href="#l70.94"></a><span id="l70.94" class="difflineplus">+            status: &quot;STRING&quot;,</span>
<a href="#l70.95"></a><span id="l70.95" class="difflineplus">+            type: &quot;STRING&quot;</span>
<a href="#l70.96"></a><span id="l70.96" class="difflineplus">+        },</span>
<a href="#l70.97"></a><span id="l70.97"> </span>
<a href="#l70.98"></a><span id="l70.98" class="difflineminus">-      cal_alarms: {</span>
<a href="#l70.99"></a><span id="l70.99" class="difflineminus">-        id: &quot;INTEGER PRIMARY KEY&quot;,</span>
<a href="#l70.100"></a><span id="l70.100" class="difflineminus">-        alarm_data: &quot;BLOB&quot;</span>
<a href="#l70.101"></a><span id="l70.101" class="difflineminus">-      },</span>
<a href="#l70.102"></a><span id="l70.102" class="difflineplus">+        cal_alarms: {</span>
<a href="#l70.103"></a><span id="l70.103" class="difflineplus">+            id: &quot;INTEGER PRIMARY KEY&quot;,</span>
<a href="#l70.104"></a><span id="l70.104" class="difflineplus">+            alarm_data: &quot;BLOB&quot;</span>
<a href="#l70.105"></a><span id="l70.105" class="difflineplus">+        },</span>
<a href="#l70.106"></a><span id="l70.106"> </span>
<a href="#l70.107"></a><span id="l70.107" class="difflineminus">-      cal_recurrence: {</span>
<a href="#l70.108"></a><span id="l70.108" class="difflineminus">-        item_id: &quot;STRING&quot;,</span>
<a href="#l70.109"></a><span id="l70.109" class="difflineminus">-        recur_type: &quot;INTEGER&quot;,</span>
<a href="#l70.110"></a><span id="l70.110" class="difflineminus">-        recur_index: &quot;INTEGER&quot;,</span>
<a href="#l70.111"></a><span id="l70.111" class="difflineminus">-        is_negative: &quot;BOOLEAN&quot;,</span>
<a href="#l70.112"></a><span id="l70.112" class="difflineminus">-        dates: &quot;STRING&quot;,</span>
<a href="#l70.113"></a><span id="l70.113" class="difflineminus">-        end_date: &quot;INTEGER&quot;,</span>
<a href="#l70.114"></a><span id="l70.114" class="difflineminus">-        count: &quot;INTEGER&quot;,</span>
<a href="#l70.115"></a><span id="l70.115" class="difflineminus">-        interval: &quot;INTEGER&quot;,</span>
<a href="#l70.116"></a><span id="l70.116" class="difflineminus">-        second: &quot;STRING&quot;,</span>
<a href="#l70.117"></a><span id="l70.117" class="difflineminus">-        minute: &quot;STRING&quot;,</span>
<a href="#l70.118"></a><span id="l70.118" class="difflineminus">-        hour: &quot;STRING&quot;,</span>
<a href="#l70.119"></a><span id="l70.119" class="difflineminus">-        day: &quot;STRING&quot;,</span>
<a href="#l70.120"></a><span id="l70.120" class="difflineminus">-        monthday: &quot;STRING&quot;,</span>
<a href="#l70.121"></a><span id="l70.121" class="difflineminus">-        yearday: &quot;STRING&quot;,</span>
<a href="#l70.122"></a><span id="l70.122" class="difflineminus">-        weekno: &quot;STRING&quot;,</span>
<a href="#l70.123"></a><span id="l70.123" class="difflineminus">-        month: &quot;STRING&quot;,</span>
<a href="#l70.124"></a><span id="l70.124" class="difflineminus">-        setpos: &quot;STRING&quot;</span>
<a href="#l70.125"></a><span id="l70.125" class="difflineminus">-      },</span>
<a href="#l70.126"></a><span id="l70.126" class="difflineplus">+        cal_recurrence: {</span>
<a href="#l70.127"></a><span id="l70.127" class="difflineplus">+            item_id: &quot;STRING&quot;,</span>
<a href="#l70.128"></a><span id="l70.128" class="difflineplus">+            recur_type: &quot;INTEGER&quot;,</span>
<a href="#l70.129"></a><span id="l70.129" class="difflineplus">+            recur_index: &quot;INTEGER&quot;,</span>
<a href="#l70.130"></a><span id="l70.130" class="difflineplus">+            is_negative: &quot;BOOLEAN&quot;,</span>
<a href="#l70.131"></a><span id="l70.131" class="difflineplus">+            dates: &quot;STRING&quot;,</span>
<a href="#l70.132"></a><span id="l70.132" class="difflineplus">+            end_date: &quot;INTEGER&quot;,</span>
<a href="#l70.133"></a><span id="l70.133" class="difflineplus">+            count: &quot;INTEGER&quot;,</span>
<a href="#l70.134"></a><span id="l70.134" class="difflineplus">+            interval: &quot;INTEGER&quot;,</span>
<a href="#l70.135"></a><span id="l70.135" class="difflineplus">+            second: &quot;STRING&quot;,</span>
<a href="#l70.136"></a><span id="l70.136" class="difflineplus">+            minute: &quot;STRING&quot;,</span>
<a href="#l70.137"></a><span id="l70.137" class="difflineplus">+            hour: &quot;STRING&quot;,</span>
<a href="#l70.138"></a><span id="l70.138" class="difflineplus">+            day: &quot;STRING&quot;,</span>
<a href="#l70.139"></a><span id="l70.139" class="difflineplus">+            monthday: &quot;STRING&quot;,</span>
<a href="#l70.140"></a><span id="l70.140" class="difflineplus">+            yearday: &quot;STRING&quot;,</span>
<a href="#l70.141"></a><span id="l70.141" class="difflineplus">+            weekno: &quot;STRING&quot;,</span>
<a href="#l70.142"></a><span id="l70.142" class="difflineplus">+            month: &quot;STRING&quot;,</span>
<a href="#l70.143"></a><span id="l70.143" class="difflineplus">+            setpos: &quot;STRING&quot;</span>
<a href="#l70.144"></a><span id="l70.144" class="difflineplus">+        },</span>
<a href="#l70.145"></a><span id="l70.145"> </span>
<a href="#l70.146"></a><span id="l70.146" class="difflineminus">-      cal_properties: {</span>
<a href="#l70.147"></a><span id="l70.147" class="difflineminus">-        item_id: &quot;STRING&quot;,</span>
<a href="#l70.148"></a><span id="l70.148" class="difflineminus">-        key: &quot;STRING&quot;,</span>
<a href="#l70.149"></a><span id="l70.149" class="difflineminus">-        value: &quot;BLOB&quot;</span>
<a href="#l70.150"></a><span id="l70.150" class="difflineminus">-      }</span>
<a href="#l70.151"></a><span id="l70.151" class="difflineplus">+        cal_properties: {</span>
<a href="#l70.152"></a><span id="l70.152" class="difflineplus">+            item_id: &quot;STRING&quot;,</span>
<a href="#l70.153"></a><span id="l70.153" class="difflineplus">+            key: &quot;STRING&quot;,</span>
<a href="#l70.154"></a><span id="l70.154" class="difflineplus">+            value: &quot;BLOB&quot;</span>
<a href="#l70.155"></a><span id="l70.155" class="difflineplus">+        }</span>
<a href="#l70.156"></a><span id="l70.156">     };</span>
<a href="#l70.157"></a><span id="l70.157"> </span>
<a href="#l70.158"></a><span id="l70.158">     for (let tbl in tblData) {</span>
<a href="#l70.159"></a><span id="l70.159">         executeSimpleSQL(db, &quot;DROP TABLE IF EXISTS &quot; + tbl);</span>
<a href="#l70.160"></a><span id="l70.160">     }</span>
<a href="#l70.161"></a><span id="l70.161">     return tblData;</span>
<a href="#l70.162"></a><span id="l70.162"> };</span>
<a href="#l70.163"></a><span id="l70.163"> </span>
<a href="#l70.164"></a><span id="l70.164" class="difflineat">@@ -1391,17 +1391,17 @@ upgrade.v21 = function(db, version) {</span>
<a href="#l70.165"></a><span id="l70.165">                             &quot;            hour, day, monthday, yearday, weekno, month,&quot; +</span>
<a href="#l70.166"></a><span id="l70.166">                             &quot;            setpos&quot; +</span>
<a href="#l70.167"></a><span id="l70.167">                             // ... from the recurrence table ...</span>
<a href="#l70.168"></a><span id="l70.168">                             &quot;       FROM cal_recurrence AS router &quot; +</span>
<a href="#l70.169"></a><span id="l70.169">                             // ... but only on fields that are x-datesets ...</span>
<a href="#l70.170"></a><span id="l70.170">                             '      WHERE recur_type = &quot;x-dateset&quot; ' +</span>
<a href="#l70.171"></a><span id="l70.171">                             // ... and are not already empty.</span>
<a href="#l70.172"></a><span id="l70.172">                             '        AND dates != &quot;&quot;';</span>
<a href="#l70.173"></a><span id="l70.173" class="difflineminus">-                            dump(insertSQL + &quot;\n&quot;);</span>
<a href="#l70.174"></a><span id="l70.174" class="difflineplus">+            dump(insertSQL + &quot;\n&quot;);</span>
<a href="#l70.175"></a><span id="l70.175"> </span>
<a href="#l70.176"></a><span id="l70.176">             // Now we need to remove the first segment from the dates field</span>
<a href="#l70.177"></a><span id="l70.177">             let updateSQL = &quot;UPDATE cal_recurrence&quot; +</span>
<a href="#l70.178"></a><span id="l70.178">                             '   SET dates = SUBSTR(dates, LENGTH(dates) - LENGTH(LTRIM(dates, REPLACE(dates, &quot;,&quot;, &quot;&quot;))) + 2)' +</span>
<a href="#l70.179"></a><span id="l70.179">                             ' WHERE recur_type = &quot;x-dateset&quot;' +</span>
<a href="#l70.180"></a><span id="l70.180">                             '   AND dates != &quot;&quot;';</span>
<a href="#l70.181"></a><span id="l70.181"> </span>
<a href="#l70.182"></a><span id="l70.182">             // Create the statements</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -129,19 +129,20 @@ calWcapCalendar.prototype = {</span>
<a href="#l71.4"></a><span id="l71.4">                 return this.ownerId;</span>
<a href="#l71.5"></a><span id="l71.5">             case &quot;organizerCN&quot;:</span>
<a href="#l71.6"></a><span id="l71.6">                 return this.getCalendarProperties(&quot;X-S1CS-CALPROPS-COMMON-NAME&quot;);</span>
<a href="#l71.7"></a><span id="l71.7">             case &quot;itip.disableRevisionChecks&quot;:</span>
<a href="#l71.8"></a><span id="l71.8">                 return true;</span>
<a href="#l71.9"></a><span id="l71.9">             case &quot;capabilities.timezones.floating.supported&quot;:</span>
<a href="#l71.10"></a><span id="l71.10">             case &quot;capabilities.timezones.UTC.supported&quot;:</span>
<a href="#l71.11"></a><span id="l71.11">             case &quot;capabilities.attachments.supported&quot;:</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-            case &quot;capabilities.alarms.popup.supported&quot;: // CS cannot store X-props reliably</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineminus">-                                                        // (thus writing X-MOZ stamps etc is not possible).</span>
<a href="#l71.14"></a><span id="l71.14" class="difflineminus">-                                                        // Popup alarms not available no matter what; wtf.</span>
<a href="#l71.15"></a><span id="l71.15" class="difflineplus">+            case &quot;capabilities.alarms.popup.supported&quot;:</span>
<a href="#l71.16"></a><span id="l71.16" class="difflineplus">+                // CS cannot store X-props reliably</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineplus">+                // (thus writing X-MOZ stamps etc is not possible).</span>
<a href="#l71.18"></a><span id="l71.18" class="difflineplus">+                // Popup alarms not available no matter what; wtf.</span>
<a href="#l71.19"></a><span id="l71.19">                 return false;</span>
<a href="#l71.20"></a><span id="l71.20">             case &quot;capabilities.alarms.actionValues&quot;:</span>
<a href="#l71.21"></a><span id="l71.21">                 return [&quot;EMAIL&quot;];</span>
<a href="#l71.22"></a><span id="l71.22">             case &quot;capabilities.alarms.maxCount&quot;:</span>
<a href="#l71.23"></a><span id="l71.23">                 return 1;</span>
<a href="#l71.24"></a><span id="l71.24">         }</span>
<a href="#l71.25"></a><span id="l71.25"> </span>
<a href="#l71.26"></a><span id="l71.26">         let value = this.__proto__.__proto__.getProperty.apply(this, arguments);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -1094,32 +1094,32 @@ function getItemFilterParams(itemFilter)</span>
<a href="#l72.4"></a><span id="l72.4">             params += &quot;&amp;component-type=todo&quot;;</span>
<a href="#l72.5"></a><span id="l72.5">             break;</span>
<a href="#l72.6"></a><span id="l72.6">         case calICalendar.ITEM_FILTER_TYPE_EVENT:</span>
<a href="#l72.7"></a><span id="l72.7">             params += &quot;&amp;component-type=event&quot;;</span>
<a href="#l72.8"></a><span id="l72.8">             break;</span>
<a href="#l72.9"></a><span id="l72.9">     }</span>
<a href="#l72.10"></a><span id="l72.10"> </span>
<a href="#l72.11"></a><span id="l72.11">     let compstate = &quot;&quot;;</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-//     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REPLY_DECLINED)</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineminus">-//         compstate += &quot;;REPLY-DECLINED&quot;;</span>
<a href="#l72.14"></a><span id="l72.14" class="difflineminus">-//     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REPLY_ACCEPTED)</span>
<a href="#l72.15"></a><span id="l72.15" class="difflineminus">-//         compstate += &quot;;REPLY-ACCEPTED&quot;;</span>
<a href="#l72.16"></a><span id="l72.16" class="difflineminus">-//     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_COMPLETED)</span>
<a href="#l72.17"></a><span id="l72.17" class="difflineminus">-//         compstate += &quot;;REQUEST-COMPLETED&quot;;</span>
<a href="#l72.18"></a><span id="l72.18" class="difflineplus">+    //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REPLY_DECLINED)</span>
<a href="#l72.19"></a><span id="l72.19" class="difflineplus">+    //         compstate += &quot;;REPLY-DECLINED&quot;;</span>
<a href="#l72.20"></a><span id="l72.20" class="difflineplus">+    //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REPLY_ACCEPTED)</span>
<a href="#l72.21"></a><span id="l72.21" class="difflineplus">+    //         compstate += &quot;;REPLY-ACCEPTED&quot;;</span>
<a href="#l72.22"></a><span id="l72.22" class="difflineplus">+    //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_COMPLETED)</span>
<a href="#l72.23"></a><span id="l72.23" class="difflineplus">+    //         compstate += &quot;;REQUEST-COMPLETED&quot;;</span>
<a href="#l72.24"></a><span id="l72.24">     if (itemFilter &amp; calICalendar.ITEM_FILTER_REQUEST_NEEDS_ACTION) {</span>
<a href="#l72.25"></a><span id="l72.25">         compstate += &quot;;REQUEST-NEEDS-ACTION&quot;;</span>
<a href="#l72.26"></a><span id="l72.26">     }</span>
<a href="#l72.27"></a><span id="l72.27" class="difflineminus">-//     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_NEEDSNOACTION) {</span>
<a href="#l72.28"></a><span id="l72.28" class="difflineminus">-//         compstate += &quot;;REQUEST-NEEDSNOACTION&quot;;</span>
<a href="#l72.29"></a><span id="l72.29" class="difflineminus">-//     }</span>
<a href="#l72.30"></a><span id="l72.30" class="difflineminus">-//     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_PENDING)</span>
<a href="#l72.31"></a><span id="l72.31" class="difflineminus">-//         compstate += &quot;;REQUEST-PENDING&quot;;</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineminus">-//     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_WAITFORREPLY)</span>
<a href="#l72.33"></a><span id="l72.33" class="difflineminus">-//         compstate += &quot;;REQUEST-WAITFORREPLY&quot;;</span>
<a href="#l72.34"></a><span id="l72.34" class="difflineplus">+    //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_NEEDSNOACTION) {</span>
<a href="#l72.35"></a><span id="l72.35" class="difflineplus">+    //         compstate += &quot;;REQUEST-NEEDSNOACTION&quot;;</span>
<a href="#l72.36"></a><span id="l72.36" class="difflineplus">+    //     }</span>
<a href="#l72.37"></a><span id="l72.37" class="difflineplus">+    //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_PENDING)</span>
<a href="#l72.38"></a><span id="l72.38" class="difflineplus">+    //         compstate += &quot;;REQUEST-PENDING&quot;;</span>
<a href="#l72.39"></a><span id="l72.39" class="difflineplus">+    //     if (itemFilter &amp; calIWcapCalendar.ITEM_FILTER_REQUEST_WAITFORREPLY)</span>
<a href="#l72.40"></a><span id="l72.40" class="difflineplus">+    //         compstate += &quot;;REQUEST-WAITFORREPLY&quot;;</span>
<a href="#l72.41"></a><span id="l72.41">     if (compstate.length &gt; 0) {</span>
<a href="#l72.42"></a><span id="l72.42">         params += &quot;&amp;compstate=&quot; + compstate.substr(1);</span>
<a href="#l72.43"></a><span id="l72.43">     }</span>
<a href="#l72.44"></a><span id="l72.44">     return params;</span>
<a href="#l72.45"></a><span id="l72.45"> }</span>
<a href="#l72.46"></a><span id="l72.46"> </span>
<a href="#l72.47"></a><span id="l72.47"> calWcapCalendar.prototype.getItems = function(itemFilter, maxResults, rangeStart, rangeEnd, listener) {</span>
<a href="#l72.48"></a><span id="l72.48">     rangeStart = ensureDateTime(rangeStart);</span>
<a href="#l72.49"></a><span id="l72.49" class="difflineat">@@ -1344,18 +1344,19 @@ calWcapCalendar.prototype.replayChangesO</span>
<a href="#l72.50"></a><span id="l72.50">                     // don't delete anything that has been touched by lastmods:</span>
<a href="#l72.51"></a><span id="l72.51">                     if (modifiedIds[item.id]) {</span>
<a href="#l72.52"></a><span id="l72.52">                         log(&quot;replayChangesOn(): skipping deletion of &quot; + item.id, this);</span>
<a href="#l72.53"></a><span id="l72.53">                     } else if (isParent(item)) {</span>
<a href="#l72.54"></a><span id="l72.54">                         log(&quot;replayChangesOn(): deleted item &quot; + item.id, this);</span>
<a href="#l72.55"></a><span id="l72.55">                         if (this.offlineStorage) {</span>
<a href="#l72.56"></a><span id="l72.56">                             this.offlineStorage.deleteItem(item, writeListener);</span>
<a href="#l72.57"></a><span id="l72.57">                         }</span>
<a href="#l72.58"></a><span id="l72.58" class="difflineminus">-                    } else { // modify parent instead of</span>
<a href="#l72.59"></a><span id="l72.59" class="difflineminus">-                             // straight-forward deleteItem(). WTF.</span>
<a href="#l72.60"></a><span id="l72.60" class="difflineplus">+                    } else {</span>
<a href="#l72.61"></a><span id="l72.61" class="difflineplus">+                        // modify parent instead of</span>
<a href="#l72.62"></a><span id="l72.62" class="difflineplus">+                        // straight-forward deleteItem(). WTF.</span>
<a href="#l72.63"></a><span id="l72.63">                         let parent = item.parentItem.clone();</span>
<a href="#l72.64"></a><span id="l72.64">                         parent.recurrenceInfo.removeOccurrenceAt(item.recurrenceId);</span>
<a href="#l72.65"></a><span id="l72.65">                         log(&quot;replayChangesOn(): modified parent &quot; + parent.id, this);</span>
<a href="#l72.66"></a><span id="l72.66">                         if (this.offlineStorage) {</span>
<a href="#l72.67"></a><span id="l72.67">                             this.offlineStorage.modifyItem(parent, item, writeListener);</span>
<a href="#l72.68"></a><span id="l72.68">                         }</span>
<a href="#l72.69"></a><span id="l72.69">                     }</span>
<a href="#l72.70"></a><span id="l72.70">                 }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapErrors.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapErrors.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -96,17 +96,17 @@ var g_nsNetErrorCodes = [</span>
<a href="#l73.4"></a><span id="l73.4">     /* NS_ERROR_UNKNOWN_HOST */ generateNetFailure(30),</span>
<a href="#l73.5"></a><span id="l73.5">     &quot;The lookup of a hostname failed. This generally refers to the hostname from the URL being loaded.&quot;,</span>
<a href="#l73.6"></a><span id="l73.6">     /* NS_ERROR_UNKNOWN_PROXY_HOST */ generateNetFailure(42),</span>
<a href="#l73.7"></a><span id="l73.7">     &quot;The lookup of a proxy hostname failed.&quot;,</span>
<a href="#l73.8"></a><span id="l73.8">     /* NS_ERROR_UNKNOWN_SOCKET_TYPE */ generateNetFailure(51),</span>
<a href="#l73.9"></a><span id="l73.9">     &quot;The specified socket type does not exist.&quot;,</span>
<a href="#l73.10"></a><span id="l73.10">     /* NS_ERROR_SOCKET_CREATE_FAILED */ generateNetFailure(52),</span>
<a href="#l73.11"></a><span id="l73.11">     &quot;The specified socket type could not be created.&quot;</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-    ];</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+];</span>
<a href="#l73.14"></a><span id="l73.14"> </span>
<a href="#l73.15"></a><span id="l73.15"> function netErrorToString(rc) {</span>
<a href="#l73.16"></a><span id="l73.16">     if (!isNaN(rc) &amp;&amp; getErrorModule(rc) == NS_ERROR_MODULE_NETWORK) {</span>
<a href="#l73.17"></a><span id="l73.17">         let i = 0;</span>
<a href="#l73.18"></a><span id="l73.18">         while (i &lt; g_nsNetErrorCodes.length) {</span>
<a href="#l73.19"></a><span id="l73.19">             // however rc is kept unsigned, our generated code signed,</span>
<a href="#l73.20"></a><span id="l73.20">             // so == won't work here:</span>
<a href="#l73.21"></a><span id="l73.21">             if ((g_nsNetErrorCodes[i] ^ rc) == 0) {</span>
<a href="#l73.22"></a><span id="l73.22" class="difflineat">@@ -237,17 +237,17 @@ var g_wcapErrorCodes = [</span>
<a href="#l73.23"></a><span id="l73.23">     /* 11001 */ calIWcapErrors.WCAP_CDWP_ERR_CANNOT_CONNECT, &quot;Cannot connect to back-end server. Back-end machine might be down or DWP server is not up and running.&quot;,</span>
<a href="#l73.24"></a><span id="l73.24">     /* 11002 */ calIWcapErrors.WCAP_CDWP_ERR_CANNOT_RESOLVE_CALENDAR, &quot;Front-end can't resolve calendar to a particular back-end server.&quot;,</span>
<a href="#l73.25"></a><span id="l73.25">     /* 11003 */ calIWcapErrors.WCAP_CDWP_ERR_BAD_DATA, &quot;Bad data received from DWP connection. This is a generic formatting error. Check all DWP servers. One might be down.&quot;,</span>
<a href="#l73.26"></a><span id="l73.26">     /* 11004 */ calIWcapErrors.WCAP_CDWP_ERR_DWPHOST_CTX_DOES_NOT_EXIST, &quot;For the back-end host, context doesn't exist in the context table.&quot;,</span>
<a href="#l73.27"></a><span id="l73.27">     /* 11005 */ calIWcapErrors.WCAP_CDWP_ERR_HOSTNAME_NOT_RESOLVABLE, &quot;DNS or NIS files, or hostname resolver is not set up properly or machine does not exist.&quot;,</span>
<a href="#l73.28"></a><span id="l73.28">     /* 11006 */ calIWcapErrors.WCAP_CDWP_ERR_NO_DATA, &quot;No data was received from reading the calendar properties from the DWP connection.&quot;,</span>
<a href="#l73.29"></a><span id="l73.29">     /* 11007 */ calIWcapErrors.WCAP_CDWP_ERR_AUTH_FAILED, &quot;DWP authentication failed.&quot;,</span>
<a href="#l73.30"></a><span id="l73.30">     /* 11008 */ calIWcapErrors.WCAP_CDWP_ERR_CHECKVERSION_FAILED, &quot;DWP version check failed.&quot;</span>
<a href="#l73.31"></a><span id="l73.31" class="difflineminus">-    ];</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+];</span>
<a href="#l73.33"></a><span id="l73.33"> </span>
<a href="#l73.34"></a><span id="l73.34"> function wcapErrorToString(rc) {</span>
<a href="#l73.35"></a><span id="l73.35">     if (isNaN(rc)) {</span>
<a href="#l73.36"></a><span id="l73.36">         throw new Components.Exception(&quot;No known WCAP error code: &quot; + rc.toString(0x10), NS_ERROR_INVALID_ARG);</span>
<a href="#l73.37"></a><span id="l73.37">     }</span>
<a href="#l73.38"></a><span id="l73.38">     if (rc == calIWcapErrors.WCAP_NO_ERRNO) {</span>
<a href="#l73.39"></a><span id="l73.39">         return &quot;No WCAP errno (missing X-NSCP-WCAP-ERRNO).&quot;;</span>
<a href="#l73.40"></a><span id="l73.40">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -419,18 +419,19 @@ calWcapSession.prototype = {</span>
<a href="#l74.4"></a><span id="l74.4">                             icalRootComp = stringToIcal(this, str);</span>
<a href="#l74.5"></a><span id="l74.5">                         } catch (exc) {</span>
<a href="#l74.6"></a><span id="l74.6">                             err = exc;</span>
<a href="#l74.7"></a><span id="l74.7">                         }</span>
<a href="#l74.8"></a><span id="l74.8">                     }</span>
<a href="#l74.9"></a><span id="l74.9">                     if (err) {</span>
<a href="#l74.10"></a><span id="l74.10">                         if (checkErrorCode(err, calIErrors.OPERATION_CANCELLED)) {</span>
<a href="#l74.11"></a><span id="l74.11">                             throw err;</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-                        } else { // soft error; request denied etc.</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineminus">-                                 // map into localized message:</span>
<a href="#l74.14"></a><span id="l74.14" class="difflineplus">+                        } else {</span>
<a href="#l74.15"></a><span id="l74.15" class="difflineplus">+                            // soft error; request denied etc.</span>
<a href="#l74.16"></a><span id="l74.16" class="difflineplus">+                            // map into localized message:</span>
<a href="#l74.17"></a><span id="l74.17">                             throw new Components.Exception(cal.calGetString(&quot;wcap&quot;, &quot;accessingServerFailedError.text&quot;,</span>
<a href="#l74.18"></a><span id="l74.18">                                                                             [this.sessionUri.hostPort]),</span>
<a href="#l74.19"></a><span id="l74.19">                                                            calIWcapErrors.WCAP_LOGIN_FAILED);</span>
<a href="#l74.20"></a><span id="l74.20">                         }</span>
<a href="#l74.21"></a><span id="l74.21">                     }</span>
<a href="#l74.22"></a><span id="l74.22">                     let prop = icalRootComp.getFirstProperty(&quot;X-NSCP-WCAPVERSION&quot;);</span>
<a href="#l74.23"></a><span id="l74.23">                     if (!prop) {</span>
<a href="#l74.24"></a><span id="l74.24">                         throw new Components.Exception(&quot;missing X-NSCP-WCAPVERSION!&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/calendar/resources/content/calendarCreation.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/calendar/resources/content/calendarCreation.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -240,10 +240,10 @@ function parseUri(aUri) {</span>
<a href="#l75.4"></a><span id="l75.4">     return [errorConstants.SUCCESS, uri];</span>
<a href="#l75.5"></a><span id="l75.5"> }</span>
<a href="#l75.6"></a><span id="l75.6"> </span>
<a href="#l75.7"></a><span id="l75.7"> /**</span>
<a href="#l75.8"></a><span id="l75.8">  * Disables the back button, in case we are far enough that its not possible to</span>
<a href="#l75.9"></a><span id="l75.9">  * undo.</span>
<a href="#l75.10"></a><span id="l75.10">  */</span>
<a href="#l75.11"></a><span id="l75.11"> function setCanRewindFalse() {</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-   document.getElementById(&quot;calendar-wizard&quot;).canRewind = false;</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+    document.getElementById(&quot;calendar-wizard&quot;).canRewind = false;</span>
<a href="#l75.14"></a><span id="l75.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -32,16 +32,17 @@</span>
<a href="#l76.4"></a><span id="l76.4">     &lt;content&gt;</span>
<a href="#l76.5"></a><span id="l76.5">       &lt;xul:hbox flex=&quot;1&quot;&gt;</span>
<a href="#l76.6"></a><span id="l76.6">         &lt;xul:textbox anonid=&quot;date-textbox&quot; flex=&quot;1&quot;</span>
<a href="#l76.7"></a><span id="l76.7">                      onfocus=&quot;this.select();&quot;</span>
<a href="#l76.8"></a><span id="l76.8">                      onkeypress=&quot;if (event.keyCode == Components.interfaces.nsIDOMKeyEvent.DOM_VK_RETURN) fireGoEvent();&quot;/&gt;</span>
<a href="#l76.9"></a><span id="l76.9">         &lt;xul:button anonid=&quot;date-go-button&quot; oncommand=&quot;fireGoEvent()&quot;/&gt;</span>
<a href="#l76.10"></a><span id="l76.10">       &lt;/xul:hbox&gt;</span>
<a href="#l76.11"></a><span id="l76.11">     &lt;/content&gt;</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineplus">+</span>
<a href="#l76.13"></a><span id="l76.13">     &lt;implementation&gt;</span>
<a href="#l76.14"></a><span id="l76.14">       &lt;field name=&quot;mRelativeDates&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l76.15"></a><span id="l76.15">       &lt;field name=&quot;mDayNames&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l76.16"></a><span id="l76.16">       &lt;field name=&quot;mRelationWords&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l76.17"></a><span id="l76.17">       &lt;field name=&quot;mMonthLongNames&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l76.18"></a><span id="l76.18">       &lt;field name=&quot;mMonthShortNames&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l76.19"></a><span id="l76.19"> </span>
<a href="#l76.20"></a><span id="l76.20">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l76.21"></a><span id="l76.21" class="difflineat">@@ -49,22 +50,22 @@</span>
<a href="#l76.22"></a><span id="l76.22">         let goButton = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-go-button&quot;);</span>
<a href="#l76.23"></a><span id="l76.23">         goButton.setAttribute(&quot;label&quot;, calGetString(&quot;calendar&quot;, &quot;go&quot;));</span>
<a href="#l76.24"></a><span id="l76.24">         // Load the stuff we're going to use to parse written dates</span>
<a href="#l76.25"></a><span id="l76.25">         this.mRelativeDates = [</span>
<a href="#l76.26"></a><span id="l76.26">             { word: cal.calGetString(&quot;calendar&quot;, &quot;today&quot;).toLowerCase(), offset: 0 },</span>
<a href="#l76.27"></a><span id="l76.27">             { word: cal.calGetString(&quot;calendar&quot;, &quot;yesterday&quot;).toLowerCase(), offset: -1 },</span>
<a href="#l76.28"></a><span id="l76.28">             { word: cal.calGetString(&quot;calendar&quot;, &quot;tomorrow&quot;).toLowerCase(), offset: 1 }];</span>
<a href="#l76.29"></a><span id="l76.29">         for (let i = 1; i &lt;= 7; i++) {</span>
<a href="#l76.30"></a><span id="l76.30" class="difflineminus">-          this.mDayNames.push(calGetString(&quot;dateFormat&quot;, &quot;day.&quot; + i + &quot;.name&quot;).toLowerCase());</span>
<a href="#l76.31"></a><span id="l76.31" class="difflineplus">+            this.mDayNames.push(calGetString(&quot;dateFormat&quot;, &quot;day.&quot; + i + &quot;.name&quot;).toLowerCase());</span>
<a href="#l76.32"></a><span id="l76.32">         }</span>
<a href="#l76.33"></a><span id="l76.33"> </span>
<a href="#l76.34"></a><span id="l76.34">         for (let i = 1; i &lt;= 12; i++) {</span>
<a href="#l76.35"></a><span id="l76.35" class="difflineminus">-          this.mMonthLongNames.push(calGetString(&quot;dateFormat&quot;, &quot;month.&quot; + i + &quot;.name&quot;).toLowerCase());</span>
<a href="#l76.36"></a><span id="l76.36" class="difflineminus">-          this.mMonthShortNames.push(calGetString(&quot;dateFormat&quot;, &quot;month.&quot; + i + &quot;.Mmm&quot;).toLowerCase());</span>
<a href="#l76.37"></a><span id="l76.37" class="difflineplus">+            this.mMonthLongNames.push(calGetString(&quot;dateFormat&quot;, &quot;month.&quot; + i + &quot;.name&quot;).toLowerCase());</span>
<a href="#l76.38"></a><span id="l76.38" class="difflineplus">+            this.mMonthShortNames.push(calGetString(&quot;dateFormat&quot;, &quot;month.&quot; + i + &quot;.Mmm&quot;).toLowerCase());</span>
<a href="#l76.39"></a><span id="l76.39">         }</span>
<a href="#l76.40"></a><span id="l76.40"> </span>
<a href="#l76.41"></a><span id="l76.41">         // note that some languages have different conjugations of</span>
<a href="#l76.42"></a><span id="l76.42">         // next/last depending on the day</span>
<a href="#l76.43"></a><span id="l76.43">         this.mRelationWords = [</span>
<a href="#l76.44"></a><span id="l76.44">             { word: cal.calGetString(&quot;calendar&quot;, &quot;last1&quot;), offset: -1 },</span>
<a href="#l76.45"></a><span id="l76.45">             { word: cal.calGetString(&quot;calendar&quot;, &quot;last2&quot;), offset: -1 },</span>
<a href="#l76.46"></a><span id="l76.46">             { word: cal.calGetString(&quot;calendar&quot;, &quot;next1&quot;), offset: 0 },</span>
<a href="#l76.47"></a><span id="l76.47" class="difflineat">@@ -75,150 +76,149 @@</span>
<a href="#l76.48"></a><span id="l76.48">         text.value = calGetString(&quot;calendar&quot;, &quot;today&quot;);</span>
<a href="#l76.49"></a><span id="l76.49">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l76.50"></a><span id="l76.50"> </span>
<a href="#l76.51"></a><span id="l76.51">       &lt;property name=&quot;value&quot;&gt;</span>
<a href="#l76.52"></a><span id="l76.52">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l76.53"></a><span id="l76.53">           return this.mValue;</span>
<a href="#l76.54"></a><span id="l76.54">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l76.55"></a><span id="l76.55">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l76.56"></a><span id="l76.56" class="difflineminus">-         let text = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-textbox&quot;);</span>
<a href="#l76.57"></a><span id="l76.57" class="difflineplus">+          let text = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-textbox&quot;);</span>
<a href="#l76.58"></a><span id="l76.58">           try {</span>
<a href="#l76.59"></a><span id="l76.59" class="difflineminus">-            text.value = this.formatDate(val);</span>
<a href="#l76.60"></a><span id="l76.60" class="difflineplus">+              text.value = this.formatDate(val);</span>
<a href="#l76.61"></a><span id="l76.61">           } catch (ex) {</span>
<a href="#l76.62"></a><span id="l76.62" class="difflineminus">-            // Don't fail if date formatting fails.</span>
<a href="#l76.63"></a><span id="l76.63" class="difflineplus">+              // Don't fail if date formatting fails.</span>
<a href="#l76.64"></a><span id="l76.64">           }</span>
<a href="#l76.65"></a><span id="l76.65">           return val;</span>
<a href="#l76.66"></a><span id="l76.66">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l76.67"></a><span id="l76.67">       &lt;/property&gt;</span>
<a href="#l76.68"></a><span id="l76.68"> </span>
<a href="#l76.69"></a><span id="l76.69">       &lt;method name=&quot;fireGoEvent&quot;&gt;</span>
<a href="#l76.70"></a><span id="l76.70">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.71"></a><span id="l76.71">           let text = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-textbox&quot;);</span>
<a href="#l76.72"></a><span id="l76.72">           let date = this.parseLanguageDate(text.value);</span>
<a href="#l76.73"></a><span id="l76.73">           if (!date) {</span>
<a href="#l76.74"></a><span id="l76.74" class="difflineminus">-            date = this.parseDateTime(text.value);</span>
<a href="#l76.75"></a><span id="l76.75" class="difflineplus">+              date = this.parseDateTime(text.value);</span>
<a href="#l76.76"></a><span id="l76.76">           }</span>
<a href="#l76.77"></a><span id="l76.77">           let prettyDate;</span>
<a href="#l76.78"></a><span id="l76.78">           if (date) {</span>
<a href="#l76.79"></a><span id="l76.79" class="difflineminus">-            // format fails if year &lt;= 1600 on win2k, so try format first.</span>
<a href="#l76.80"></a><span id="l76.80" class="difflineminus">-            try {</span>
<a href="#l76.81"></a><span id="l76.81" class="difflineminus">-              prettyDate = this.formatDate(date);</span>
<a href="#l76.82"></a><span id="l76.82" class="difflineminus">-            } catch (ex) {</span>
<a href="#l76.83"></a><span id="l76.83" class="difflineminus">-              // Don't fail if date formatting fails.</span>
<a href="#l76.84"></a><span id="l76.84" class="difflineminus">-            }</span>
<a href="#l76.85"></a><span id="l76.85" class="difflineplus">+              // format fails if year &lt;= 1600 on win2k, so try format first.</span>
<a href="#l76.86"></a><span id="l76.86" class="difflineplus">+              try {</span>
<a href="#l76.87"></a><span id="l76.87" class="difflineplus">+                  prettyDate = this.formatDate(date);</span>
<a href="#l76.88"></a><span id="l76.88" class="difflineplus">+              } catch (ex) {</span>
<a href="#l76.89"></a><span id="l76.89" class="difflineplus">+                  // Don't fail if date formatting fails.</span>
<a href="#l76.90"></a><span id="l76.90" class="difflineplus">+              }</span>
<a href="#l76.91"></a><span id="l76.91">           }</span>
<a href="#l76.92"></a><span id="l76.92">           if (date &amp;&amp; prettyDate) {</span>
<a href="#l76.93"></a><span id="l76.93" class="difflineminus">-            this.mValue = date;</span>
<a href="#l76.94"></a><span id="l76.94" class="difflineminus">-            text.value = prettyDate;</span>
<a href="#l76.95"></a><span id="l76.95" class="difflineminus">-            this.fireEvent(&quot;command&quot;, date);</span>
<a href="#l76.96"></a><span id="l76.96" class="difflineminus">-            return;</span>
<a href="#l76.97"></a><span id="l76.97" class="difflineplus">+              this.mValue = date;</span>
<a href="#l76.98"></a><span id="l76.98" class="difflineplus">+              text.value = prettyDate;</span>
<a href="#l76.99"></a><span id="l76.99" class="difflineplus">+              this.fireEvent(&quot;command&quot;, date);</span>
<a href="#l76.100"></a><span id="l76.100" class="difflineplus">+              return;</span>
<a href="#l76.101"></a><span id="l76.101">           }</span>
<a href="#l76.102"></a><span id="l76.102">         ]]&gt;&lt;/body&gt;</span>
<a href="#l76.103"></a><span id="l76.103">       &lt;/method&gt;</span>
<a href="#l76.104"></a><span id="l76.104"> </span>
<a href="#l76.105"></a><span id="l76.105">       &lt;!-- This function will take written (with words) dates and, if</span>
<a href="#l76.106"></a><span id="l76.106">          - possible, return a Date() object described by the words.  Note</span>
<a href="#l76.107"></a><span id="l76.107">          - that this function will not parse explicit dates, like 1/1/06,</span>
<a href="#l76.108"></a><span id="l76.108">          - you should use parseDateTime for that.</span>
<a href="#l76.109"></a><span id="l76.109">         --&gt;</span>
<a href="#l76.110"></a><span id="l76.110">       &lt;method name=&quot;parseLanguageDate&quot;&gt;</span>
<a href="#l76.111"></a><span id="l76.111">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.112"></a><span id="l76.112">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.113"></a><span id="l76.113" class="difflineminus">-           if (!aValue) {</span>
<a href="#l76.114"></a><span id="l76.114" class="difflineminus">-             return null;</span>
<a href="#l76.115"></a><span id="l76.115" class="difflineminus">-           }</span>
<a href="#l76.116"></a><span id="l76.116" class="difflineminus">-           let val = aValue.toLowerCase();</span>
<a href="#l76.117"></a><span id="l76.117" class="difflineminus">-           // Look for the easy ones like today, tomorrow, etc</span>
<a href="#l76.118"></a><span id="l76.118" class="difflineminus">-           for (let rel of this.mRelativeDates) {</span>
<a href="#l76.119"></a><span id="l76.119" class="difflineminus">-             if (val == rel.word) {</span>
<a href="#l76.120"></a><span id="l76.120" class="difflineminus">-               let now = new Date();</span>
<a href="#l76.121"></a><span id="l76.121" class="difflineminus">-               now.setDate(now.getDate() + rel.offset);</span>
<a href="#l76.122"></a><span id="l76.122" class="difflineminus">-               return now;</span>
<a href="#l76.123"></a><span id="l76.123" class="difflineminus">-             }</span>
<a href="#l76.124"></a><span id="l76.124" class="difflineminus">-           }</span>
<a href="#l76.125"></a><span id="l76.125" class="difflineplus">+          if (!aValue) {</span>
<a href="#l76.126"></a><span id="l76.126" class="difflineplus">+              return null;</span>
<a href="#l76.127"></a><span id="l76.127" class="difflineplus">+          }</span>
<a href="#l76.128"></a><span id="l76.128" class="difflineplus">+          let val = aValue.toLowerCase();</span>
<a href="#l76.129"></a><span id="l76.129" class="difflineplus">+          // Look for the easy ones like today, tomorrow, etc</span>
<a href="#l76.130"></a><span id="l76.130" class="difflineplus">+          for (let rel of this.mRelativeDates) {</span>
<a href="#l76.131"></a><span id="l76.131" class="difflineplus">+              if (val == rel.word) {</span>
<a href="#l76.132"></a><span id="l76.132" class="difflineplus">+                  let now = new Date();</span>
<a href="#l76.133"></a><span id="l76.133" class="difflineplus">+                  now.setDate(now.getDate() + rel.offset);</span>
<a href="#l76.134"></a><span id="l76.134" class="difflineplus">+                  return now;</span>
<a href="#l76.135"></a><span id="l76.135" class="difflineplus">+              }</span>
<a href="#l76.136"></a><span id="l76.136" class="difflineplus">+          }</span>
<a href="#l76.137"></a><span id="l76.137"> </span>
<a href="#l76.138"></a><span id="l76.138" class="difflineminus">-           let self = this;</span>
<a href="#l76.139"></a><span id="l76.139" class="difflineplus">+          let self = this;</span>
<a href="#l76.140"></a><span id="l76.140"> </span>
<a href="#l76.141"></a><span id="l76.141" class="difflineminus">-           // Takes a written day of the week and returns a js-date</span>
<a href="#l76.142"></a><span id="l76.142" class="difflineminus">-           // corresponding to the nearest day in the future that is</span>
<a href="#l76.143"></a><span id="l76.143" class="difflineminus">-           // that day of the week</span>
<a href="#l76.144"></a><span id="l76.144" class="difflineminus">-           function getDateForDay(aWord) {</span>
<a href="#l76.145"></a><span id="l76.145" class="difflineminus">-             for (let i in self.mDayNames) {</span>
<a href="#l76.146"></a><span id="l76.146" class="difflineminus">-               if (aWord != self.mDayNames[i]) {</span>
<a href="#l76.147"></a><span id="l76.147" class="difflineminus">-                 continue;</span>
<a href="#l76.148"></a><span id="l76.148" class="difflineminus">-               }</span>
<a href="#l76.149"></a><span id="l76.149" class="difflineminus">-               // Figure out what day of the week today is.</span>
<a href="#l76.150"></a><span id="l76.150" class="difflineminus">-               let today = cal.now();</span>
<a href="#l76.151"></a><span id="l76.151" class="difflineplus">+          // Takes a written day of the week and returns a js-date</span>
<a href="#l76.152"></a><span id="l76.152" class="difflineplus">+          // corresponding to the nearest day in the future that is</span>
<a href="#l76.153"></a><span id="l76.153" class="difflineplus">+          // that day of the week</span>
<a href="#l76.154"></a><span id="l76.154" class="difflineplus">+          function getDateForDay(aWord) {</span>
<a href="#l76.155"></a><span id="l76.155" class="difflineplus">+              for (let i in self.mDayNames) {</span>
<a href="#l76.156"></a><span id="l76.156" class="difflineplus">+                  if (aWord != self.mDayNames[i]) {</span>
<a href="#l76.157"></a><span id="l76.157" class="difflineplus">+                      continue;</span>
<a href="#l76.158"></a><span id="l76.158" class="difflineplus">+                  }</span>
<a href="#l76.159"></a><span id="l76.159" class="difflineplus">+                  // Figure out what day of the week today is.</span>
<a href="#l76.160"></a><span id="l76.160" class="difflineplus">+                  let today = cal.now();</span>
<a href="#l76.161"></a><span id="l76.161"> </span>
<a href="#l76.162"></a><span id="l76.162" class="difflineminus">-               // i-weekday gets the offset. Add 7 to ensure that the %</span>
<a href="#l76.163"></a><span id="l76.163" class="difflineminus">-               // operation stays positive.</span>
<a href="#l76.164"></a><span id="l76.164" class="difflineminus">-               let offset = (i - today.weekday + 7) % 7;</span>
<a href="#l76.165"></a><span id="l76.165" class="difflineminus">-               today.day = today.day + offset;</span>
<a href="#l76.166"></a><span id="l76.166" class="difflineminus">-               return cal.dateTimeToJsDate(today);</span>
<a href="#l76.167"></a><span id="l76.167" class="difflineminus">-             }</span>
<a href="#l76.168"></a><span id="l76.168" class="difflineminus">-             return null;</span>
<a href="#l76.169"></a><span id="l76.169" class="difflineminus">-           }</span>
<a href="#l76.170"></a><span id="l76.170" class="difflineplus">+                  // i-weekday gets the offset. Add 7 to ensure that the %</span>
<a href="#l76.171"></a><span id="l76.171" class="difflineplus">+                  // operation stays positive.</span>
<a href="#l76.172"></a><span id="l76.172" class="difflineplus">+                  let offset = (i - today.weekday + 7) % 7;</span>
<a href="#l76.173"></a><span id="l76.173" class="difflineplus">+                  today.day = today.day + offset;</span>
<a href="#l76.174"></a><span id="l76.174" class="difflineplus">+                  return cal.dateTimeToJsDate(today);</span>
<a href="#l76.175"></a><span id="l76.175" class="difflineplus">+              }</span>
<a href="#l76.176"></a><span id="l76.176" class="difflineplus">+              return null;</span>
<a href="#l76.177"></a><span id="l76.177" class="difflineplus">+          }</span>
<a href="#l76.178"></a><span id="l76.178"> </span>
<a href="#l76.179"></a><span id="l76.179" class="difflineminus">-           // Remove commas</span>
<a href="#l76.180"></a><span id="l76.180" class="difflineminus">-           val = val.replace(&quot;,&quot;, &quot;&quot;);</span>
<a href="#l76.181"></a><span id="l76.181" class="difflineplus">+          // Remove commas</span>
<a href="#l76.182"></a><span id="l76.182" class="difflineplus">+          val = val.replace(&quot;,&quot;, &quot;&quot;);</span>
<a href="#l76.183"></a><span id="l76.183"> </span>
<a href="#l76.184"></a><span id="l76.184" class="difflineminus">-           if (!val.includes(&quot; &quot;)) {</span>
<a href="#l76.185"></a><span id="l76.185" class="difflineminus">-             // Just a single word, or a single date.</span>
<a href="#l76.186"></a><span id="l76.186" class="difflineminus">-             return getDateForDay(val);</span>
<a href="#l76.187"></a><span id="l76.187" class="difflineminus">-           }</span>
<a href="#l76.188"></a><span id="l76.188" class="difflineplus">+          if (!val.includes(&quot; &quot;)) {</span>
<a href="#l76.189"></a><span id="l76.189" class="difflineplus">+              // Just a single word, or a single date.</span>
<a href="#l76.190"></a><span id="l76.190" class="difflineplus">+              return getDateForDay(val);</span>
<a href="#l76.191"></a><span id="l76.191" class="difflineplus">+          }</span>
<a href="#l76.192"></a><span id="l76.192"> </span>
<a href="#l76.193"></a><span id="l76.193" class="difflineminus">-           // Replace month names with numbers</span>
<a href="#l76.194"></a><span id="l76.194" class="difflineminus">-           for (let i in this.mMonthLongNames) {</span>
<a href="#l76.195"></a><span id="l76.195" class="difflineminus">-             if (val.includes(this.mMonthLongNames[i])) {</span>
<a href="#l76.196"></a><span id="l76.196" class="difflineminus">-               let newVal = val.replace(this.mMonthLongNames[i], Number(i) + 1);</span>
<a href="#l76.197"></a><span id="l76.197" class="difflineminus">-               newVal = newVal.replace(&quot; &quot;, &quot;/&quot;);</span>
<a href="#l76.198"></a><span id="l76.198" class="difflineminus">-               return this.parseDateTime(newVal);</span>
<a href="#l76.199"></a><span id="l76.199" class="difflineminus">-             }</span>
<a href="#l76.200"></a><span id="l76.200" class="difflineplus">+          // Replace month names with numbers</span>
<a href="#l76.201"></a><span id="l76.201" class="difflineplus">+          for (let i in this.mMonthLongNames) {</span>
<a href="#l76.202"></a><span id="l76.202" class="difflineplus">+              if (val.includes(this.mMonthLongNames[i])) {</span>
<a href="#l76.203"></a><span id="l76.203" class="difflineplus">+                  let newVal = val.replace(this.mMonthLongNames[i], Number(i) + 1);</span>
<a href="#l76.204"></a><span id="l76.204" class="difflineplus">+                  newVal = newVal.replace(&quot; &quot;, &quot;/&quot;);</span>
<a href="#l76.205"></a><span id="l76.205" class="difflineplus">+                  return this.parseDateTime(newVal);</span>
<a href="#l76.206"></a><span id="l76.206" class="difflineplus">+              }</span>
<a href="#l76.207"></a><span id="l76.207">           }</span>
<a href="#l76.208"></a><span id="l76.208"> </span>
<a href="#l76.209"></a><span id="l76.209">           // Same for short month names</span>
<a href="#l76.210"></a><span id="l76.210" class="difflineminus">-           for (let i in this.mMonthShortNames) {</span>
<a href="#l76.211"></a><span id="l76.211" class="difflineminus">-             if (val.includes(this.mMonthShortNames[i])) {</span>
<a href="#l76.212"></a><span id="l76.212" class="difflineminus">-               let newVal = val.replace(this.mMonthShortNames[i], Number(i) + 1);</span>
<a href="#l76.213"></a><span id="l76.213" class="difflineminus">-               newVal = newVal.replace(&quot; &quot;, &quot;/&quot;);</span>
<a href="#l76.214"></a><span id="l76.214" class="difflineminus">-               return this.parseDateTime(newVal);</span>
<a href="#l76.215"></a><span id="l76.215" class="difflineminus">-             }</span>
<a href="#l76.216"></a><span id="l76.216" class="difflineplus">+          for (let i in this.mMonthShortNames) {</span>
<a href="#l76.217"></a><span id="l76.217" class="difflineplus">+              if (val.includes(this.mMonthShortNames[i])) {</span>
<a href="#l76.218"></a><span id="l76.218" class="difflineplus">+                  let newVal = val.replace(this.mMonthShortNames[i], Number(i) + 1);</span>
<a href="#l76.219"></a><span id="l76.219" class="difflineplus">+                  newVal = newVal.replace(&quot; &quot;, &quot;/&quot;);</span>
<a href="#l76.220"></a><span id="l76.220" class="difflineplus">+                  return this.parseDateTime(newVal);</span>
<a href="#l76.221"></a><span id="l76.221" class="difflineplus">+              }</span>
<a href="#l76.222"></a><span id="l76.222">           }</span>
<a href="#l76.223"></a><span id="l76.223"> </span>
<a href="#l76.224"></a><span id="l76.224">           // Now for the cool 'next' and 'last'</span>
<a href="#l76.225"></a><span id="l76.225">           let words = val.split(&quot; &quot;);</span>
<a href="#l76.226"></a><span id="l76.226">           let offset, day;</span>
<a href="#l76.227"></a><span id="l76.227">           for (let word of words) {</span>
<a href="#l76.228"></a><span id="l76.228" class="difflineminus">-            for (let rel of this.mRelationWords) {</span>
<a href="#l76.229"></a><span id="l76.229" class="difflineminus">-              if (word == rel.word) {</span>
<a href="#l76.230"></a><span id="l76.230" class="difflineminus">-                offset = rel.offset;</span>
<a href="#l76.231"></a><span id="l76.231" class="difflineminus">-                break;</span>
<a href="#l76.232"></a><span id="l76.232" class="difflineplus">+              for (let rel of this.mRelationWords) {</span>
<a href="#l76.233"></a><span id="l76.233" class="difflineplus">+                  if (word == rel.word) {</span>
<a href="#l76.234"></a><span id="l76.234" class="difflineplus">+                      offset = rel.offset;</span>
<a href="#l76.235"></a><span id="l76.235" class="difflineplus">+                      break;</span>
<a href="#l76.236"></a><span id="l76.236" class="difflineplus">+                  }</span>
<a href="#l76.237"></a><span id="l76.237">               }</span>
<a href="#l76.238"></a><span id="l76.238" class="difflineminus">-            }</span>
<a href="#l76.239"></a><span id="l76.239" class="difflineminus">-            for (let i in this.mDayNames) {</span>
<a href="#l76.240"></a><span id="l76.240" class="difflineminus">-              if (word == this.mDayNames[i]) {</span>
<a href="#l76.241"></a><span id="l76.241" class="difflineminus">-                day = getDateForDay(word);</span>
<a href="#l76.242"></a><span id="l76.242" class="difflineminus">-                break;</span>
<a href="#l76.243"></a><span id="l76.243" class="difflineplus">+              for (let i in this.mDayNames) {</span>
<a href="#l76.244"></a><span id="l76.244" class="difflineplus">+                  if (word == this.mDayNames[i]) {</span>
<a href="#l76.245"></a><span id="l76.245" class="difflineplus">+                      day = getDateForDay(word);</span>
<a href="#l76.246"></a><span id="l76.246" class="difflineplus">+                      break;</span>
<a href="#l76.247"></a><span id="l76.247" class="difflineplus">+                  }</span>
<a href="#l76.248"></a><span id="l76.248">               }</span>
<a href="#l76.249"></a><span id="l76.249" class="difflineminus">-            }</span>
<a href="#l76.250"></a><span id="l76.250">           }</span>
<a href="#l76.251"></a><span id="l76.251"> </span>
<a href="#l76.252"></a><span id="l76.252">           if (day &amp;&amp; offset != undefined) {</span>
<a href="#l76.253"></a><span id="l76.253" class="difflineminus">-            day.setDate(day.getDate() + (7 * offset));</span>
<a href="#l76.254"></a><span id="l76.254" class="difflineminus">-            return day;</span>
<a href="#l76.255"></a><span id="l76.255" class="difflineplus">+              day.setDate(day.getDate() + (7 * offset));</span>
<a href="#l76.256"></a><span id="l76.256" class="difflineplus">+              return day;</span>
<a href="#l76.257"></a><span id="l76.257">           }</span>
<a href="#l76.258"></a><span id="l76.258">           return null;</span>
<a href="#l76.259"></a><span id="l76.259">         ]]&gt;&lt;/body&gt;</span>
<a href="#l76.260"></a><span id="l76.260">       &lt;/method&gt;</span>
<a href="#l76.261"></a><span id="l76.261">     &lt;/implementation&gt;</span>
<a href="#l76.262"></a><span id="l76.262">   &lt;/binding&gt;</span>
<a href="#l76.263"></a><span id="l76.263"> </span>
<a href="#l76.264"></a><span id="l76.264">   &lt;binding id=&quot;datepicker&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker-base&quot;&gt;</span>
<a href="#l76.265"></a><span id="l76.265" class="difflineminus">-    &lt;!-- ::::::::::::::::: CONTENT ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.266"></a><span id="l76.266">     &lt;!-- Desired behavior: when user is done editing the date field</span>
<a href="#l76.267"></a><span id="l76.267">          and either leaves the field (onblur) or closes the dialog</span>
<a href="#l76.268"></a><span id="l76.268">          (13 is enter/return key), parse the date and redisplay it</span>
<a href="#l76.269"></a><span id="l76.269">          in the date field using the current format to verify</span>
<a href="#l76.270"></a><span id="l76.270">          whether the date was parsed correctly.</span>
<a href="#l76.271"></a><span id="l76.271">          This cannot be done with textbox oninput, so use a workaround.</span>
<a href="#l76.272"></a><span id="l76.272">          This was done with textbox onkeypress=&quot;parseTextBoxDate(true)&quot;</span>
<a href="#l76.273"></a><span id="l76.273">          and onblur=&quot;parseTextBoxDate(true)&quot; which worked in Moz1.6, but</span>
<a href="#l76.274"></a><span id="l76.274" class="difflineat">@@ -249,158 +249,138 @@</span>
<a href="#l76.275"></a><span id="l76.275">                          onpopupshowing=&quot;this.parentNode.kDatePicker.onPopup();&quot;</span>
<a href="#l76.276"></a><span id="l76.276">                          onpopuphiding=&quot;this.firstChild.hidePopupList();&quot;&gt;</span>
<a href="#l76.277"></a><span id="l76.277">             &lt;xul:minimonth/&gt;</span>
<a href="#l76.278"></a><span id="l76.278">           &lt;/xul:menupopup&gt;</span>
<a href="#l76.279"></a><span id="l76.279">         &lt;/xul:menulist&gt;</span>
<a href="#l76.280"></a><span id="l76.280">       &lt;/xul:hbox&gt;</span>
<a href="#l76.281"></a><span id="l76.281">     &lt;/content&gt;</span>
<a href="#l76.282"></a><span id="l76.282"> </span>
<a href="#l76.283"></a><span id="l76.283" class="difflineminus">-    &lt;!-- ::::::::::::::::: INTERFACE ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.284"></a><span id="l76.284">     &lt;implementation&gt;</span>
<a href="#l76.285"></a><span id="l76.285" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l76.286"></a><span id="l76.286" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.287"></a><span id="l76.287" class="difflineminus">-          let hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l76.288"></a><span id="l76.288" class="difflineminus">-          this.kTextBox = hbox.firstChild;</span>
<a href="#l76.289"></a><span id="l76.289" class="difflineminus">-</span>
<a href="#l76.290"></a><span id="l76.290" class="difflineminus">-          let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l76.291"></a><span id="l76.291" class="difflineminus">-          if (val) {</span>
<a href="#l76.292"></a><span id="l76.292" class="difflineminus">-            this.value = new Date(val); // setting value property calls update</span>
<a href="#l76.293"></a><span id="l76.293" class="difflineminus">-          } else {</span>
<a href="#l76.294"></a><span id="l76.294" class="difflineminus">-            this.value = new Date();</span>
<a href="#l76.295"></a><span id="l76.295" class="difflineminus">-          }</span>
<a href="#l76.296"></a><span id="l76.296" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l76.297"></a><span id="l76.297" class="difflineplus">+        let hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l76.298"></a><span id="l76.298" class="difflineplus">+        this.kTextBox = hbox.firstChild;</span>
<a href="#l76.299"></a><span id="l76.299"> </span>
<a href="#l76.300"></a><span id="l76.300" class="difflineminus">-          this.kTextBox.kDatePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l76.301"></a><span id="l76.301" class="difflineminus">-          this.kTextBox.menupopup.kDatePicker = this;</span>
<a href="#l76.302"></a><span id="l76.302" class="difflineminus">-          this.kMinimonth = this.kTextBox.menupopup.firstChild;</span>
<a href="#l76.303"></a><span id="l76.303" class="difflineminus">-          this.mInPopup = false;</span>
<a href="#l76.304"></a><span id="l76.304" class="difflineminus">-          this.kMinimonth.addEventListener(&quot;select&quot;, this.clickDate, false);</span>
<a href="#l76.305"></a><span id="l76.305" class="difflineplus">+        let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l76.306"></a><span id="l76.306" class="difflineplus">+        if (val) {</span>
<a href="#l76.307"></a><span id="l76.307" class="difflineplus">+            this.value = new Date(val); // setting value property calls update</span>
<a href="#l76.308"></a><span id="l76.308" class="difflineplus">+        } else {</span>
<a href="#l76.309"></a><span id="l76.309" class="difflineplus">+            this.value = new Date();</span>
<a href="#l76.310"></a><span id="l76.310" class="difflineplus">+        }</span>
<a href="#l76.311"></a><span id="l76.311"> </span>
<a href="#l76.312"></a><span id="l76.312" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.313"></a><span id="l76.313" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l76.314"></a><span id="l76.314" class="difflineplus">+        this.kTextBox.kDatePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l76.315"></a><span id="l76.315" class="difflineplus">+        this.kTextBox.menupopup.kDatePicker = this;</span>
<a href="#l76.316"></a><span id="l76.316" class="difflineplus">+        this.kMinimonth = this.kTextBox.menupopup.firstChild;</span>
<a href="#l76.317"></a><span id="l76.317" class="difflineplus">+        this.mInPopup = false;</span>
<a href="#l76.318"></a><span id="l76.318" class="difflineplus">+        this.kMinimonth.addEventListener(&quot;select&quot;, this.clickDate, false);</span>
<a href="#l76.319"></a><span id="l76.319" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l76.320"></a><span id="l76.320"> </span>
<a href="#l76.321"></a><span id="l76.321" class="difflineminus">-      &lt;destructor&gt;</span>
<a href="#l76.322"></a><span id="l76.322" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.323"></a><span id="l76.323" class="difflineplus">+      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l76.324"></a><span id="l76.324">           this.kMinimonth.removeEventListener(&quot;select&quot;, this.clickDate, false);</span>
<a href="#l76.325"></a><span id="l76.325" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.326"></a><span id="l76.326" class="difflineminus">-      &lt;/destructor&gt;</span>
<a href="#l76.327"></a><span id="l76.327" class="difflineplus">+      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l76.328"></a><span id="l76.328"> </span>
<a href="#l76.329"></a><span id="l76.329">       &lt;!-- This property will be overlayed in some extended binding --&gt;</span>
<a href="#l76.330"></a><span id="l76.330">       &lt;property name=&quot;valueValid&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l76.331"></a><span id="l76.331">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l76.332"></a><span id="l76.332">             return (this.mValue != null);</span>
<a href="#l76.333"></a><span id="l76.333" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.334"></a><span id="l76.334" class="difflineminus">-        &lt;/getter&gt;</span>
<a href="#l76.335"></a><span id="l76.335" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l76.336"></a><span id="l76.336">       &lt;/property&gt;</span>
<a href="#l76.337"></a><span id="l76.337"> </span>
<a href="#l76.338"></a><span id="l76.338">       &lt;property name=&quot;extraDate&quot;</span>
<a href="#l76.339"></a><span id="l76.339" class="difflineminus">-          onget=&quot;return this.kMinimonth.extra&quot;</span>
<a href="#l76.340"></a><span id="l76.340" class="difflineminus">-          onset=&quot;this.kMinimonth.extra = val&quot;/&gt;</span>
<a href="#l76.341"></a><span id="l76.341" class="difflineplus">+                onget=&quot;return this.kMinimonth.extra&quot;</span>
<a href="#l76.342"></a><span id="l76.342" class="difflineplus">+                onset=&quot;this.kMinimonth.extra = val&quot;/&gt;</span>
<a href="#l76.343"></a><span id="l76.343"> </span>
<a href="#l76.344"></a><span id="l76.344">       &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l76.345"></a><span id="l76.345">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.346"></a><span id="l76.346">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l76.347"></a><span id="l76.347" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.348"></a><span id="l76.348" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.349"></a><span id="l76.349" class="difflineminus">-            if (aValue != null) {</span>
<a href="#l76.350"></a><span id="l76.350" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.351"></a><span id="l76.351" class="difflineplus">+          if (aValue != null) {</span>
<a href="#l76.352"></a><span id="l76.352">               // format fails if year &lt;= 1600 on win2k, so try format first.</span>
<a href="#l76.353"></a><span id="l76.353">               let formattedValue = null;</span>
<a href="#l76.354"></a><span id="l76.354">               try {</span>
<a href="#l76.355"></a><span id="l76.355" class="difflineminus">-                formattedValue = this.formatDate(aValue);</span>
<a href="#l76.356"></a><span id="l76.356" class="difflineplus">+                  formattedValue = this.formatDate(aValue);</span>
<a href="#l76.357"></a><span id="l76.357">               } catch (ex) {</span>
<a href="#l76.358"></a><span id="l76.358" class="difflineminus">-                // formattedValue is checked for a value below</span>
<a href="#l76.359"></a><span id="l76.359" class="difflineplus">+                  // formattedValue is checked for a value below</span>
<a href="#l76.360"></a><span id="l76.360">               }</span>
<a href="#l76.361"></a><span id="l76.361"> </span>
<a href="#l76.362"></a><span id="l76.362">               if (formattedValue) {</span>
<a href="#l76.363"></a><span id="l76.363" class="difflineminus">-                // format succeeded, safe to set value</span>
<a href="#l76.364"></a><span id="l76.364" class="difflineminus">-                let dateChanged = true;</span>
<a href="#l76.365"></a><span id="l76.365" class="difflineminus">-                if (this.valueValid) {</span>
<a href="#l76.366"></a><span id="l76.366" class="difflineminus">-                  dateChanged = (this.mValue.getDate() != aValue.getDate()) ||</span>
<a href="#l76.367"></a><span id="l76.367" class="difflineminus">-                                (this.mValue.getMonth() != aValue.getMonth()) ||</span>
<a href="#l76.368"></a><span id="l76.368" class="difflineminus">-                                (this.mValue.getFullYear() != aValue.getFullYear());</span>
<a href="#l76.369"></a><span id="l76.369" class="difflineminus">-                }</span>
<a href="#l76.370"></a><span id="l76.370" class="difflineminus">-                this.mValue = aValue;</span>
<a href="#l76.371"></a><span id="l76.371" class="difflineminus">-                this.kTextBox.value = formattedValue;</span>
<a href="#l76.372"></a><span id="l76.372" class="difflineminus">-                if (aRefresh &amp;&amp; dateChanged) {</span>
<a href="#l76.373"></a><span id="l76.373" class="difflineminus">-                  this.fireEvent(&quot;change&quot;);</span>
<a href="#l76.374"></a><span id="l76.374" class="difflineminus">-                }</span>
<a href="#l76.375"></a><span id="l76.375" class="difflineplus">+                  // format succeeded, safe to set value</span>
<a href="#l76.376"></a><span id="l76.376" class="difflineplus">+                  let dateChanged = true;</span>
<a href="#l76.377"></a><span id="l76.377" class="difflineplus">+                  if (this.valueValid) {</span>
<a href="#l76.378"></a><span id="l76.378" class="difflineplus">+                      dateChanged = this.mValue.getDate() != aValue.getDate() ||</span>
<a href="#l76.379"></a><span id="l76.379" class="difflineplus">+                                    this.mValue.getMonth() != aValue.getMonth() ||</span>
<a href="#l76.380"></a><span id="l76.380" class="difflineplus">+                                    this.mValue.getFullYear() != aValue.getFullYear();</span>
<a href="#l76.381"></a><span id="l76.381" class="difflineplus">+                  }</span>
<a href="#l76.382"></a><span id="l76.382" class="difflineplus">+                  this.mValue = aValue;</span>
<a href="#l76.383"></a><span id="l76.383" class="difflineplus">+                  this.kTextBox.value = formattedValue;</span>
<a href="#l76.384"></a><span id="l76.384" class="difflineplus">+                  if (aRefresh &amp;&amp; dateChanged) {</span>
<a href="#l76.385"></a><span id="l76.385" class="difflineplus">+                      this.fireEvent(&quot;change&quot;);</span>
<a href="#l76.386"></a><span id="l76.386" class="difflineplus">+                  }</span>
<a href="#l76.387"></a><span id="l76.387">               }</span>
<a href="#l76.388"></a><span id="l76.388" class="difflineminus">-            } else if (this.mValue) {</span>
<a href="#l76.389"></a><span id="l76.389" class="difflineplus">+          } else if (this.mValue) {</span>
<a href="#l76.390"></a><span id="l76.390">               // invalid date, revert to previous date</span>
<a href="#l76.391"></a><span id="l76.391">               // set textBox.value property, not attribute</span>
<a href="#l76.392"></a><span id="l76.392">               this.kTextBox.value = this.formatDate(this.mValue);</span>
<a href="#l76.393"></a><span id="l76.393" class="difflineminus">-            }</span>
<a href="#l76.394"></a><span id="l76.394" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.395"></a><span id="l76.395" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.396"></a><span id="l76.396" class="difflineplus">+          }</span>
<a href="#l76.397"></a><span id="l76.397" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.398"></a><span id="l76.398">       &lt;/method&gt;</span>
<a href="#l76.399"></a><span id="l76.399"> </span>
<a href="#l76.400"></a><span id="l76.400">       &lt;method name=&quot;onPopup&quot;&gt;</span>
<a href="#l76.401"></a><span id="l76.401" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.402"></a><span id="l76.402" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.403"></a><span id="l76.403" class="difflineminus">-            this.mInPopup = true;</span>
<a href="#l76.404"></a><span id="l76.404" class="difflineminus">-            this.kMinimonth.update(this.mValue);</span>
<a href="#l76.405"></a><span id="l76.405" class="difflineminus">-            this.mInPopup = false;</span>
<a href="#l76.406"></a><span id="l76.406" class="difflineminus">-            // select all to remove cursor since can't type while popped-up</span>
<a href="#l76.407"></a><span id="l76.407" class="difflineminus">-            this.select();</span>
<a href="#l76.408"></a><span id="l76.408" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.409"></a><span id="l76.409" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.410"></a><span id="l76.410" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.411"></a><span id="l76.411" class="difflineplus">+          this.mInPopup = true;</span>
<a href="#l76.412"></a><span id="l76.412" class="difflineplus">+          this.kMinimonth.update(this.mValue);</span>
<a href="#l76.413"></a><span id="l76.413" class="difflineplus">+          this.mInPopup = false;</span>
<a href="#l76.414"></a><span id="l76.414" class="difflineplus">+          // select all to remove cursor since can't type while popped-up</span>
<a href="#l76.415"></a><span id="l76.415" class="difflineplus">+          this.select();</span>
<a href="#l76.416"></a><span id="l76.416" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.417"></a><span id="l76.417">       &lt;/method&gt;</span>
<a href="#l76.418"></a><span id="l76.418"> </span>
<a href="#l76.419"></a><span id="l76.419">       &lt;method name=&quot;parseTextBoxDate&quot;&gt;</span>
<a href="#l76.420"></a><span id="l76.420">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l76.421"></a><span id="l76.421">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l76.422"></a><span id="l76.422" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.423"></a><span id="l76.423" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.424"></a><span id="l76.424" class="difflineminus">-            // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l76.425"></a><span id="l76.425" class="difflineminus">-            // fired inside the update method.</span>
<a href="#l76.426"></a><span id="l76.426" class="difflineminus">-            if (aEvent) {</span>
<a href="#l76.427"></a><span id="l76.427" class="difflineminus">-                aEvent.stopPropagation();</span>
<a href="#l76.428"></a><span id="l76.428" class="difflineminus">-            }</span>
<a href="#l76.429"></a><span id="l76.429" class="difflineminus">-            this.update(this.parseDateTime(this.kTextBox.value), aRefresh);</span>
<a href="#l76.430"></a><span id="l76.430" class="difflineminus">-            this.lastDateParseIncludedTime = false;</span>
<a href="#l76.431"></a><span id="l76.431" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.432"></a><span id="l76.432" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.433"></a><span id="l76.433" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.434"></a><span id="l76.434" class="difflineplus">+          // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l76.435"></a><span id="l76.435" class="difflineplus">+          // fired inside the update method.</span>
<a href="#l76.436"></a><span id="l76.436" class="difflineplus">+          if (aEvent) {</span>
<a href="#l76.437"></a><span id="l76.437" class="difflineplus">+              aEvent.stopPropagation();</span>
<a href="#l76.438"></a><span id="l76.438" class="difflineplus">+          }</span>
<a href="#l76.439"></a><span id="l76.439" class="difflineplus">+          this.update(this.parseDateTime(this.kTextBox.value), aRefresh);</span>
<a href="#l76.440"></a><span id="l76.440" class="difflineplus">+          this.lastDateParseIncludedTime = false;</span>
<a href="#l76.441"></a><span id="l76.441" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.442"></a><span id="l76.442">       &lt;/method&gt;</span>
<a href="#l76.443"></a><span id="l76.443"> </span>
<a href="#l76.444"></a><span id="l76.444">       &lt;method name=&quot;select&quot;&gt;</span>
<a href="#l76.445"></a><span id="l76.445" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.446"></a><span id="l76.446" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.447"></a><span id="l76.447" class="difflineminus">-            // select all in text box</span>
<a href="#l76.448"></a><span id="l76.448" class="difflineminus">-            this.kTextBox.select();</span>
<a href="#l76.449"></a><span id="l76.449" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.450"></a><span id="l76.450" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.451"></a><span id="l76.451" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.452"></a><span id="l76.452" class="difflineplus">+          // select all in text box</span>
<a href="#l76.453"></a><span id="l76.453" class="difflineplus">+          this.kTextBox.select();</span>
<a href="#l76.454"></a><span id="l76.454" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.455"></a><span id="l76.455">       &lt;/method&gt;</span>
<a href="#l76.456"></a><span id="l76.456"> </span>
<a href="#l76.457"></a><span id="l76.457">       &lt;method name=&quot;clickDate&quot;&gt;</span>
<a href="#l76.458"></a><span id="l76.458">         &lt;parameter name=&quot;aEvent&quot; /&gt;</span>
<a href="#l76.459"></a><span id="l76.459" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.460"></a><span id="l76.460" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.461"></a><span id="l76.461" class="difflineminus">-            let datepicker = aEvent.target.parentNode.parentNode.kDatePicker;</span>
<a href="#l76.462"></a><span id="l76.462" class="difflineminus">-            if (!datepicker.mInPopup) {</span>
<a href="#l76.463"></a><span id="l76.463" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.464"></a><span id="l76.464" class="difflineplus">+          let datepicker = aEvent.target.parentNode.parentNode.kDatePicker;</span>
<a href="#l76.465"></a><span id="l76.465" class="difflineplus">+          if (!datepicker.mInPopup) {</span>
<a href="#l76.466"></a><span id="l76.466">               // aEvent.target is the minimonth</span>
<a href="#l76.467"></a><span id="l76.467">               datepicker.update(new Date(aEvent.target.value), true);</span>
<a href="#l76.468"></a><span id="l76.468">               // select changed value so no cursor appears (can't type to it).</span>
<a href="#l76.469"></a><span id="l76.469">               datepicker.select();</span>
<a href="#l76.470"></a><span id="l76.470">               aEvent.target.parentNode.hidePopup();</span>
<a href="#l76.471"></a><span id="l76.471" class="difflineminus">-            }</span>
<a href="#l76.472"></a><span id="l76.472" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.473"></a><span id="l76.473" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.474"></a><span id="l76.474" class="difflineplus">+          }</span>
<a href="#l76.475"></a><span id="l76.475" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.476"></a><span id="l76.476">       &lt;/method&gt;</span>
<a href="#l76.477"></a><span id="l76.477"> </span>
<a href="#l76.478"></a><span id="l76.478">       &lt;/implementation&gt;</span>
<a href="#l76.479"></a><span id="l76.479"> </span>
<a href="#l76.480"></a><span id="l76.480" class="difflineminus">-      &lt;!-- ::::::::::::::::: HANDLERS ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.481"></a><span id="l76.481">       &lt;handlers&gt;</span>
<a href="#l76.482"></a><span id="l76.482">           &lt;handler event=&quot;bindingattached&quot; action=&quot;this.initialize();&quot;/&gt;</span>
<a href="#l76.483"></a><span id="l76.483"> </span>
<a href="#l76.484"></a><span id="l76.484" class="difflineminus">-          &lt;handler event=&quot;blur&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l76.485"></a><span id="l76.485" class="difflineminus">-            &lt;![CDATA[</span>
<a href="#l76.486"></a><span id="l76.486" class="difflineminus">-              this.parseTextBoxDate(true);</span>
<a href="#l76.487"></a><span id="l76.487" class="difflineminus">-            ]]&gt;</span>
<a href="#l76.488"></a><span id="l76.488" class="difflineminus">-          &lt;/handler&gt;</span>
<a href="#l76.489"></a><span id="l76.489" class="difflineplus">+          &lt;handler event=&quot;blur&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l76.490"></a><span id="l76.490" class="difflineplus">+            this.parseTextBoxDate(true);</span>
<a href="#l76.491"></a><span id="l76.491" class="difflineplus">+          ]]&gt;&lt;/handler&gt;</span>
<a href="#l76.492"></a><span id="l76.492">       &lt;/handlers&gt;</span>
<a href="#l76.493"></a><span id="l76.493"> </span>
<a href="#l76.494"></a><span id="l76.494">   &lt;/binding&gt;</span>
<a href="#l76.495"></a><span id="l76.495"> </span>
<a href="#l76.496"></a><span id="l76.496">   &lt;binding id=&quot;datepicker-forever&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datepicker&quot;&gt;</span>
<a href="#l76.497"></a><span id="l76.497">     &lt;content&gt;</span>
<a href="#l76.498"></a><span id="l76.498">       &lt;xul:hbox flex=&quot;1&quot; id=&quot;hbox&quot; class=&quot;datepicker-box-class&quot;&gt;</span>
<a href="#l76.499"></a><span id="l76.499">         &lt;xul:menulist anonid=&quot;foreverMenulist&quot; editable=&quot;true&quot; sizetopopup=&quot;false&quot;</span>
<a href="#l76.500"></a><span id="l76.500" class="difflineat">@@ -420,124 +400,106 @@</span>
<a href="#l76.501"></a><span id="l76.501">           &lt;/xul:menupopup&gt;</span>
<a href="#l76.502"></a><span id="l76.502">         &lt;/xul:menulist&gt;</span>
<a href="#l76.503"></a><span id="l76.503">       &lt;/xul:hbox&gt;</span>
<a href="#l76.504"></a><span id="l76.504">     &lt;/content&gt;</span>
<a href="#l76.505"></a><span id="l76.505"> </span>
<a href="#l76.506"></a><span id="l76.506">     &lt;implementation&gt;</span>
<a href="#l76.507"></a><span id="l76.507">       &lt;field name=&quot;mForeverStr&quot;&gt;null&lt;/field&gt;</span>
<a href="#l76.508"></a><span id="l76.508"> </span>
<a href="#l76.509"></a><span id="l76.509" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l76.510"></a><span id="l76.510" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.511"></a><span id="l76.511" class="difflineminus">-          this.mForeverStr = calGetString(&quot;calendar-event-dialog&quot;, &quot;eventRecurrenceForeverLabel&quot;);</span>
<a href="#l76.512"></a><span id="l76.512" class="difflineminus">-          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;menuitemForever&quot;)</span>
<a href="#l76.513"></a><span id="l76.513" class="difflineminus">-              .setAttribute(&quot;label&quot;, this.mForeverStr);</span>
<a href="#l76.514"></a><span id="l76.514" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.515"></a><span id="l76.515" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l76.516"></a><span id="l76.516" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l76.517"></a><span id="l76.517" class="difflineplus">+        this.mForeverStr = calGetString(&quot;calendar-event-dialog&quot;, &quot;eventRecurrenceForeverLabel&quot;);</span>
<a href="#l76.518"></a><span id="l76.518" class="difflineplus">+        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;menuitemForever&quot;)</span>
<a href="#l76.519"></a><span id="l76.519" class="difflineplus">+                .setAttribute(&quot;label&quot;, this.mForeverStr);</span>
<a href="#l76.520"></a><span id="l76.520" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l76.521"></a><span id="l76.521"> </span>
<a href="#l76.522"></a><span id="l76.522">       &lt;method name=&quot;parseTextBoxDate&quot;&gt;</span>
<a href="#l76.523"></a><span id="l76.523">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l76.524"></a><span id="l76.524">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l76.525"></a><span id="l76.525" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.526"></a><span id="l76.526" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.527"></a><span id="l76.527" class="difflineminus">-            if (this.kTextBox.value.toLowerCase() == this.mForeverStr.toLowerCase()) {</span>
<a href="#l76.528"></a><span id="l76.528" class="difflineminus">-                this.mValue = &quot;forever&quot;;</span>
<a href="#l76.529"></a><span id="l76.529" class="difflineminus">-                this.kTextBox.value = this.mForeverStr;</span>
<a href="#l76.530"></a><span id="l76.530" class="difflineminus">-            } else {</span>
<a href="#l76.531"></a><span id="l76.531" class="difflineminus">-                // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l76.532"></a><span id="l76.532" class="difflineminus">-                // fired inside the update method.</span>
<a href="#l76.533"></a><span id="l76.533" class="difflineminus">-                if (aEvent) {</span>
<a href="#l76.534"></a><span id="l76.534" class="difflineminus">-                    aEvent.stopPropagation();</span>
<a href="#l76.535"></a><span id="l76.535" class="difflineminus">-                }</span>
<a href="#l76.536"></a><span id="l76.536" class="difflineminus">-                let date = this.parseDateTime(this.kTextBox.value);</span>
<a href="#l76.537"></a><span id="l76.537" class="difflineminus">-                if (date) {</span>
<a href="#l76.538"></a><span id="l76.538" class="difflineminus">-                    this.update(date, aRefresh);</span>
<a href="#l76.539"></a><span id="l76.539" class="difflineminus">-                } else {</span>
<a href="#l76.540"></a><span id="l76.540" class="difflineminus">-                    // Invalid date, revert to previous date.</span>
<a href="#l76.541"></a><span id="l76.541" class="difflineminus">-                    this.kTextBox.value = this.mValue == &quot;forever&quot; ? this.mForeverStr</span>
<a href="#l76.542"></a><span id="l76.542" class="difflineminus">-                                                                   : this.formatDate(this.mValue);</span>
<a href="#l76.543"></a><span id="l76.543" class="difflineminus">-                }</span>
<a href="#l76.544"></a><span id="l76.544" class="difflineminus">-                this.lastDateParseIncludedTime = false;</span>
<a href="#l76.545"></a><span id="l76.545" class="difflineminus">-            }</span>
<a href="#l76.546"></a><span id="l76.546" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.547"></a><span id="l76.547" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.548"></a><span id="l76.548" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.549"></a><span id="l76.549" class="difflineplus">+          if (this.kTextBox.value.toLowerCase() == this.mForeverStr.toLowerCase()) {</span>
<a href="#l76.550"></a><span id="l76.550" class="difflineplus">+              this.mValue = &quot;forever&quot;;</span>
<a href="#l76.551"></a><span id="l76.551" class="difflineplus">+              this.kTextBox.value = this.mForeverStr;</span>
<a href="#l76.552"></a><span id="l76.552" class="difflineplus">+          } else {</span>
<a href="#l76.553"></a><span id="l76.553" class="difflineplus">+              // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l76.554"></a><span id="l76.554" class="difflineplus">+              // fired inside the update method.</span>
<a href="#l76.555"></a><span id="l76.555" class="difflineplus">+              if (aEvent) {</span>
<a href="#l76.556"></a><span id="l76.556" class="difflineplus">+                  aEvent.stopPropagation();</span>
<a href="#l76.557"></a><span id="l76.557" class="difflineplus">+              }</span>
<a href="#l76.558"></a><span id="l76.558" class="difflineplus">+              let date = this.parseDateTime(this.kTextBox.value);</span>
<a href="#l76.559"></a><span id="l76.559" class="difflineplus">+              if (date) {</span>
<a href="#l76.560"></a><span id="l76.560" class="difflineplus">+                  this.update(date, aRefresh);</span>
<a href="#l76.561"></a><span id="l76.561" class="difflineplus">+              } else {</span>
<a href="#l76.562"></a><span id="l76.562" class="difflineplus">+                  // Invalid date, revert to previous date.</span>
<a href="#l76.563"></a><span id="l76.563" class="difflineplus">+                  this.kTextBox.value = this.mValue == &quot;forever&quot; ? this.mForeverStr</span>
<a href="#l76.564"></a><span id="l76.564" class="difflineplus">+                                                                 : this.formatDate(this.mValue);</span>
<a href="#l76.565"></a><span id="l76.565" class="difflineplus">+              }</span>
<a href="#l76.566"></a><span id="l76.566" class="difflineplus">+              this.lastDateParseIncludedTime = false;</span>
<a href="#l76.567"></a><span id="l76.567" class="difflineplus">+          }</span>
<a href="#l76.568"></a><span id="l76.568" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.569"></a><span id="l76.569">       &lt;/method&gt;</span>
<a href="#l76.570"></a><span id="l76.570"> </span>
<a href="#l76.571"></a><span id="l76.571">       &lt;method name=&quot;onMenuitemForever&quot;&gt;</span>
<a href="#l76.572"></a><span id="l76.572" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.573"></a><span id="l76.573" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.574"></a><span id="l76.574" class="difflineminus">-            if (this.kTextBox.value.toLowerCase() == this.mForeverStr.toLowerCase()) {</span>
<a href="#l76.575"></a><span id="l76.575" class="difflineminus">-                this.mValue = &quot;forever&quot;;</span>
<a href="#l76.576"></a><span id="l76.576" class="difflineminus">-            }</span>
<a href="#l76.577"></a><span id="l76.577" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.578"></a><span id="l76.578" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.579"></a><span id="l76.579" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.580"></a><span id="l76.580" class="difflineplus">+          if (this.kTextBox.value.toLowerCase() == this.mForeverStr.toLowerCase()) {</span>
<a href="#l76.581"></a><span id="l76.581" class="difflineplus">+              this.mValue = &quot;forever&quot;;</span>
<a href="#l76.582"></a><span id="l76.582" class="difflineplus">+          }</span>
<a href="#l76.583"></a><span id="l76.583" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.584"></a><span id="l76.584">       &lt;/method&gt;</span>
<a href="#l76.585"></a><span id="l76.585"> </span>
<a href="#l76.586"></a><span id="l76.586">       &lt;property name=&quot;value&quot;&gt;</span>
<a href="#l76.587"></a><span id="l76.587" class="difflineminus">-        &lt;getter&gt;</span>
<a href="#l76.588"></a><span id="l76.588" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.589"></a><span id="l76.589" class="difflineminus">-            return this.mValue;</span>
<a href="#l76.590"></a><span id="l76.590" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.591"></a><span id="l76.591" class="difflineminus">-        &lt;/getter&gt;</span>
<a href="#l76.592"></a><span id="l76.592" class="difflineminus">-        &lt;setter&gt;</span>
<a href="#l76.593"></a><span id="l76.593" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.594"></a><span id="l76.594" class="difflineminus">-            if (val == &quot;forever&quot;) {</span>
<a href="#l76.595"></a><span id="l76.595" class="difflineminus">-                document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;foreverMenulist&quot;).selectedIndex = 1;</span>
<a href="#l76.596"></a><span id="l76.596" class="difflineminus">-                this.mValue = &quot;forever&quot;;</span>
<a href="#l76.597"></a><span id="l76.597" class="difflineminus">-                this.kTextBox.value = this.mForeverStr;</span>
<a href="#l76.598"></a><span id="l76.598" class="difflineminus">-            } else {</span>
<a href="#l76.599"></a><span id="l76.599" class="difflineminus">-                this.update(val, false);</span>
<a href="#l76.600"></a><span id="l76.600" class="difflineminus">-            }</span>
<a href="#l76.601"></a><span id="l76.601" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.602"></a><span id="l76.602" class="difflineminus">-        &lt;/setter&gt;</span>
<a href="#l76.603"></a><span id="l76.603" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l76.604"></a><span id="l76.604" class="difflineplus">+          return this.mValue;</span>
<a href="#l76.605"></a><span id="l76.605" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l76.606"></a><span id="l76.606" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l76.607"></a><span id="l76.607" class="difflineplus">+          if (val == &quot;forever&quot;) {</span>
<a href="#l76.608"></a><span id="l76.608" class="difflineplus">+              document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;foreverMenulist&quot;).selectedIndex = 1;</span>
<a href="#l76.609"></a><span id="l76.609" class="difflineplus">+              this.mValue = &quot;forever&quot;;</span>
<a href="#l76.610"></a><span id="l76.610" class="difflineplus">+              this.kTextBox.value = this.mForeverStr;</span>
<a href="#l76.611"></a><span id="l76.611" class="difflineplus">+          } else {</span>
<a href="#l76.612"></a><span id="l76.612" class="difflineplus">+              this.update(val, false);</span>
<a href="#l76.613"></a><span id="l76.613" class="difflineplus">+          }</span>
<a href="#l76.614"></a><span id="l76.614" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l76.615"></a><span id="l76.615">       &lt;/property&gt;</span>
<a href="#l76.616"></a><span id="l76.616"> </span>
<a href="#l76.617"></a><span id="l76.617">       &lt;property name=&quot;menuitemForever&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l76.618"></a><span id="l76.618" class="difflineminus">-        &lt;getter&gt;</span>
<a href="#l76.619"></a><span id="l76.619" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.620"></a><span id="l76.620" class="difflineminus">-            return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;menuitemForever&quot;);</span>
<a href="#l76.621"></a><span id="l76.621" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.622"></a><span id="l76.622" class="difflineminus">-        &lt;/getter&gt;</span>
<a href="#l76.623"></a><span id="l76.623" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l76.624"></a><span id="l76.624" class="difflineplus">+          return document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;menuitemForever&quot;);</span>
<a href="#l76.625"></a><span id="l76.625" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l76.626"></a><span id="l76.626">       &lt;/property&gt;</span>
<a href="#l76.627"></a><span id="l76.627"> </span>
<a href="#l76.628"></a><span id="l76.628">       &lt;method name=&quot;onPopup&quot;&gt;</span>
<a href="#l76.629"></a><span id="l76.629">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l76.630"></a><span id="l76.630" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.631"></a><span id="l76.631" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.632"></a><span id="l76.632" class="difflineminus">-            // avoid reinitializing during reshow, for bugs 273914 &amp; 278877 workaround</span>
<a href="#l76.633"></a><span id="l76.633" class="difflineminus">-            if (!this.mIsReshowing) {</span>
<a href="#l76.634"></a><span id="l76.634" class="difflineminus">-                this.mInPopup = true;</span>
<a href="#l76.635"></a><span id="l76.635" class="difflineminus">-                if (this.mValue == &quot;forever&quot;) {</span>
<a href="#l76.636"></a><span id="l76.636" class="difflineminus">-                    this.kMinimonth.update(null);</span>
<a href="#l76.637"></a><span id="l76.637" class="difflineminus">-                    this.menuitemForever.setAttribute(&quot;highlight&quot;, &quot;true&quot;);</span>
<a href="#l76.638"></a><span id="l76.638" class="difflineminus">-                } else {</span>
<a href="#l76.639"></a><span id="l76.639" class="difflineminus">-                    this.kMinimonth.update(this.mValue);</span>
<a href="#l76.640"></a><span id="l76.640" class="difflineminus">-                    this.menuitemForever.removeAttribute(&quot;highlight&quot;);</span>
<a href="#l76.641"></a><span id="l76.641" class="difflineminus">-                }</span>
<a href="#l76.642"></a><span id="l76.642" class="difflineminus">-                this.mInPopup = false;</span>
<a href="#l76.643"></a><span id="l76.643" class="difflineminus">-                // select all to remove cursor since can't type while popped-up</span>
<a href="#l76.644"></a><span id="l76.644" class="difflineminus">-                this.select();</span>
<a href="#l76.645"></a><span id="l76.645" class="difflineminus">-            }</span>
<a href="#l76.646"></a><span id="l76.646" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.647"></a><span id="l76.647" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.648"></a><span id="l76.648" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.649"></a><span id="l76.649" class="difflineplus">+          // avoid reinitializing during reshow, for bugs 273914 &amp; 278877 workaround</span>
<a href="#l76.650"></a><span id="l76.650" class="difflineplus">+          if (!this.mIsReshowing) {</span>
<a href="#l76.651"></a><span id="l76.651" class="difflineplus">+              this.mInPopup = true;</span>
<a href="#l76.652"></a><span id="l76.652" class="difflineplus">+              if (this.mValue == &quot;forever&quot;) {</span>
<a href="#l76.653"></a><span id="l76.653" class="difflineplus">+                  this.kMinimonth.update(null);</span>
<a href="#l76.654"></a><span id="l76.654" class="difflineplus">+                  this.menuitemForever.setAttribute(&quot;highlight&quot;, &quot;true&quot;);</span>
<a href="#l76.655"></a><span id="l76.655" class="difflineplus">+              } else {</span>
<a href="#l76.656"></a><span id="l76.656" class="difflineplus">+                  this.kMinimonth.update(this.mValue);</span>
<a href="#l76.657"></a><span id="l76.657" class="difflineplus">+                  this.menuitemForever.removeAttribute(&quot;highlight&quot;);</span>
<a href="#l76.658"></a><span id="l76.658" class="difflineplus">+              }</span>
<a href="#l76.659"></a><span id="l76.659" class="difflineplus">+              this.mInPopup = false;</span>
<a href="#l76.660"></a><span id="l76.660" class="difflineplus">+              // select all to remove cursor since can't type while popped-up</span>
<a href="#l76.661"></a><span id="l76.661" class="difflineplus">+              this.select();</span>
<a href="#l76.662"></a><span id="l76.662" class="difflineplus">+          }</span>
<a href="#l76.663"></a><span id="l76.663" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.664"></a><span id="l76.664">       &lt;/method&gt;</span>
<a href="#l76.665"></a><span id="l76.665"> </span>
<a href="#l76.666"></a><span id="l76.666">       &lt;property name=&quot;valueValid&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l76.667"></a><span id="l76.667" class="difflineminus">-        &lt;getter&gt;</span>
<a href="#l76.668"></a><span id="l76.668" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.669"></a><span id="l76.669" class="difflineminus">-            return (this.mValue != null &amp;&amp; this.mValue != &quot;forever&quot;);</span>
<a href="#l76.670"></a><span id="l76.670" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.671"></a><span id="l76.671" class="difflineminus">-        &lt;/getter&gt;</span>
<a href="#l76.672"></a><span id="l76.672" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l76.673"></a><span id="l76.673" class="difflineplus">+          return (this.mValue != null &amp;&amp; this.mValue != &quot;forever&quot;);</span>
<a href="#l76.674"></a><span id="l76.674" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l76.675"></a><span id="l76.675">       &lt;/property&gt;</span>
<a href="#l76.676"></a><span id="l76.676" class="difflineminus">-</span>
<a href="#l76.677"></a><span id="l76.677">     &lt;/implementation&gt;</span>
<a href="#l76.678"></a><span id="l76.678">   &lt;/binding&gt;</span>
<a href="#l76.679"></a><span id="l76.679"> </span>
<a href="#l76.680"></a><span id="l76.680">   &lt;binding id=&quot;timepicker&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker-base&quot;&gt;</span>
<a href="#l76.681"></a><span id="l76.681" class="difflineminus">-    &lt;!-- ::::::::::::::::: CONTENT ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.682"></a><span id="l76.682">     &lt;!-- Desired behavior: when user is done editing the time field</span>
<a href="#l76.683"></a><span id="l76.683">          and either leaves the field (onblur) or closes the dialog</span>
<a href="#l76.684"></a><span id="l76.684">          (13 is enter/return key), parse the time and redisplay it</span>
<a href="#l76.685"></a><span id="l76.685">          in the time field using the current format to verify</span>
<a href="#l76.686"></a><span id="l76.686">          whether the time was parsed correctly.</span>
<a href="#l76.687"></a><span id="l76.687">          This cannot be done with textbox oninput, so use a workaround.</span>
<a href="#l76.688"></a><span id="l76.688">          This was done with textbox onkeypress=&quot;parseTextBoxTime(true)&quot;</span>
<a href="#l76.689"></a><span id="l76.689">          and onblur=&quot;parseTextBoxTime(true)&quot; which worked in Moz1.6, but</span>
<a href="#l76.690"></a><span id="l76.690" class="difflineat">@@ -565,154 +527,137 @@</span>
<a href="#l76.691"></a><span id="l76.691">                          onpopupshowing=&quot;onPopup(this)&quot;</span>
<a href="#l76.692"></a><span id="l76.692">                          onpopuphiding=&quot;onHide(this)&quot;&gt;</span>
<a href="#l76.693"></a><span id="l76.693">             &lt;xul:timepicker-grids anonid=&quot;timepickerGrids&quot;/&gt;</span>
<a href="#l76.694"></a><span id="l76.694">           &lt;/xul:menupopup&gt;</span>
<a href="#l76.695"></a><span id="l76.695">         &lt;/xul:menulist&gt;</span>
<a href="#l76.696"></a><span id="l76.696">       &lt;/xul:hbox&gt;</span>
<a href="#l76.697"></a><span id="l76.697">     &lt;/content&gt;</span>
<a href="#l76.698"></a><span id="l76.698"> </span>
<a href="#l76.699"></a><span id="l76.699" class="difflineminus">-    &lt;!-- ::::::::::::::::: INTERFACE ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.700"></a><span id="l76.700">     &lt;implementation&gt;</span>
<a href="#l76.701"></a><span id="l76.701" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l76.702"></a><span id="l76.702" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.703"></a><span id="l76.703" class="difflineminus">-          let hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l76.704"></a><span id="l76.704" class="difflineminus">-          this.kTextBox = hbox.childNodes[0];</span>
<a href="#l76.705"></a><span id="l76.705" class="difflineminus">-          this.kTextBox.kTimePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l76.706"></a><span id="l76.706" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l76.707"></a><span id="l76.707" class="difflineplus">+        let hbox = document.getAnonymousNodes(this)[0];</span>
<a href="#l76.708"></a><span id="l76.708" class="difflineplus">+        this.kTextBox = hbox.childNodes[0];</span>
<a href="#l76.709"></a><span id="l76.709" class="difflineplus">+        this.kTextBox.kTimePicker = this; // enable call back to method in Moz1.7</span>
<a href="#l76.710"></a><span id="l76.710"> </span>
<a href="#l76.711"></a><span id="l76.711" class="difflineminus">-          let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l76.712"></a><span id="l76.712" class="difflineminus">-          if (val) {</span>
<a href="#l76.713"></a><span id="l76.713" class="difflineplus">+        let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l76.714"></a><span id="l76.714" class="difflineplus">+        if (val) {</span>
<a href="#l76.715"></a><span id="l76.715">             this.value = new Date(val);</span>
<a href="#l76.716"></a><span id="l76.716" class="difflineminus">-          } else {</span>
<a href="#l76.717"></a><span id="l76.717" class="difflineplus">+        } else {</span>
<a href="#l76.718"></a><span id="l76.718">             this.value = new Date();</span>
<a href="#l76.719"></a><span id="l76.719" class="difflineminus">-          }</span>
<a href="#l76.720"></a><span id="l76.720" class="difflineplus">+        }</span>
<a href="#l76.721"></a><span id="l76.721"> </span>
<a href="#l76.722"></a><span id="l76.722" class="difflineminus">-          // Change the grids in the timepicker-grids for 12-hours time format.</span>
<a href="#l76.723"></a><span id="l76.723" class="difflineminus">-          if (this.ampmIndex) {</span>
<a href="#l76.724"></a><span id="l76.724" class="difflineplus">+        // Change the grids in the timepicker-grids for 12-hours time format.</span>
<a href="#l76.725"></a><span id="l76.725" class="difflineplus">+        if (this.ampmIndex) {</span>
<a href="#l76.726"></a><span id="l76.726">             // Find the locale strings for the AM/PM prefix/suffix.</span>
<a href="#l76.727"></a><span id="l76.727">             let amTime = new Date(2000, 0, 1, 6, 12, 34);</span>
<a href="#l76.728"></a><span id="l76.728">             let pmTime = new Date(2000, 0, 1, 18, 12, 34);</span>
<a href="#l76.729"></a><span id="l76.729">             amTime = amTime.toLocaleFormat(this.kTimeFormatString);</span>
<a href="#l76.730"></a><span id="l76.730">             pmTime = pmTime.toLocaleFormat(this.kTimeFormatString);</span>
<a href="#l76.731"></a><span id="l76.731">             let amLabel = this.parseTimeRegExp.exec(amTime)[this.ampmIndex] || &quot;AM&quot;;</span>
<a href="#l76.732"></a><span id="l76.732">             let pmLabel = this.parseTimeRegExp.exec(pmTime)[this.ampmIndex] || &quot;PM&quot;;</span>
<a href="#l76.733"></a><span id="l76.733"> </span>
<a href="#l76.734"></a><span id="l76.734">             document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timepickerGrids&quot;)</span>
<a href="#l76.735"></a><span id="l76.735">                     .changeTo12HoursFormat(amLabel, pmLabel);</span>
<a href="#l76.736"></a><span id="l76.736" class="difflineminus">-          }</span>
<a href="#l76.737"></a><span id="l76.737" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.738"></a><span id="l76.738" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l76.739"></a><span id="l76.739" class="difflineplus">+        }</span>
<a href="#l76.740"></a><span id="l76.740" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l76.741"></a><span id="l76.741"> </span>
<a href="#l76.742"></a><span id="l76.742">       &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l76.743"></a><span id="l76.743">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.744"></a><span id="l76.744">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l76.745"></a><span id="l76.745" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.746"></a><span id="l76.746" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.747"></a><span id="l76.747" class="difflineminus">-            let timeChanged = false;</span>
<a href="#l76.748"></a><span id="l76.748" class="difflineminus">-            if (aValue != null) {</span>
<a href="#l76.749"></a><span id="l76.749" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.750"></a><span id="l76.750" class="difflineplus">+          let timeChanged = false;</span>
<a href="#l76.751"></a><span id="l76.751" class="difflineplus">+          if (aValue != null) {</span>
<a href="#l76.752"></a><span id="l76.752">               if (this.mValue) {</span>
<a href="#l76.753"></a><span id="l76.753" class="difflineminus">-                timeChanged = this.mValue.getHours() != aValue.getHours() ||</span>
<a href="#l76.754"></a><span id="l76.754" class="difflineminus">-                              this.mValue.getMinutes() != aValue.getMinutes();</span>
<a href="#l76.755"></a><span id="l76.755" class="difflineplus">+                  timeChanged = this.mValue.getHours() != aValue.getHours() ||</span>
<a href="#l76.756"></a><span id="l76.756" class="difflineplus">+                                this.mValue.getMinutes() != aValue.getMinutes();</span>
<a href="#l76.757"></a><span id="l76.757">               }</span>
<a href="#l76.758"></a><span id="l76.758">               this.mValue = aValue;</span>
<a href="#l76.759"></a><span id="l76.759" class="difflineminus">-            }</span>
<a href="#l76.760"></a><span id="l76.760" class="difflineminus">-            // set textBox.value property, not attribute</span>
<a href="#l76.761"></a><span id="l76.761" class="difflineminus">-            this.kTextBox.value = this.formatTime(this.mValue);</span>
<a href="#l76.762"></a><span id="l76.762" class="difflineplus">+          }</span>
<a href="#l76.763"></a><span id="l76.763" class="difflineplus">+          // set textBox.value property, not attribute</span>
<a href="#l76.764"></a><span id="l76.764" class="difflineplus">+          this.kTextBox.value = this.formatTime(this.mValue);</span>
<a href="#l76.765"></a><span id="l76.765"> </span>
<a href="#l76.766"></a><span id="l76.766" class="difflineminus">-            if (aValue != null &amp;&amp; aRefresh &amp;&amp; timeChanged) {</span>
<a href="#l76.767"></a><span id="l76.767" class="difflineplus">+          if (aValue != null &amp;&amp; aRefresh &amp;&amp; timeChanged) {</span>
<a href="#l76.768"></a><span id="l76.768">               let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l76.769"></a><span id="l76.769">               event.initEvent(&quot;change&quot;, true, true);</span>
<a href="#l76.770"></a><span id="l76.770">               this.dispatchEvent(event);</span>
<a href="#l76.771"></a><span id="l76.771" class="difflineminus">-            }</span>
<a href="#l76.772"></a><span id="l76.772" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.773"></a><span id="l76.773" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.774"></a><span id="l76.774" class="difflineplus">+          }</span>
<a href="#l76.775"></a><span id="l76.775" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.776"></a><span id="l76.776">       &lt;/method&gt;</span>
<a href="#l76.777"></a><span id="l76.777"> </span>
<a href="#l76.778"></a><span id="l76.778">       &lt;method name=&quot;parseTextBoxTime&quot;&gt;</span>
<a href="#l76.779"></a><span id="l76.779">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l76.780"></a><span id="l76.780">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l76.781"></a><span id="l76.781" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.782"></a><span id="l76.782" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.783"></a><span id="l76.783" class="difflineminus">-            // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l76.784"></a><span id="l76.784" class="difflineminus">-            // fired inside the update method.</span>
<a href="#l76.785"></a><span id="l76.785" class="difflineminus">-            if (aEvent) {</span>
<a href="#l76.786"></a><span id="l76.786" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.787"></a><span id="l76.787" class="difflineplus">+          // Stop the &quot;change&quot; event propagation. It will be properly</span>
<a href="#l76.788"></a><span id="l76.788" class="difflineplus">+          // fired inside the update method.</span>
<a href="#l76.789"></a><span id="l76.789" class="difflineplus">+          if (aEvent) {</span>
<a href="#l76.790"></a><span id="l76.790">               aEvent.stopPropagation();</span>
<a href="#l76.791"></a><span id="l76.791" class="difflineminus">-            }</span>
<a href="#l76.792"></a><span id="l76.792" class="difflineminus">-            let time = this.parseTime(this.kTextBox.value);</span>
<a href="#l76.793"></a><span id="l76.793" class="difflineminus">-            this.update(time, aRefresh);</span>
<a href="#l76.794"></a><span id="l76.794" class="difflineminus">-            return time;</span>
<a href="#l76.795"></a><span id="l76.795" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.796"></a><span id="l76.796" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.797"></a><span id="l76.797" class="difflineplus">+          }</span>
<a href="#l76.798"></a><span id="l76.798" class="difflineplus">+          let time = this.parseTime(this.kTextBox.value);</span>
<a href="#l76.799"></a><span id="l76.799" class="difflineplus">+          this.update(time, aRefresh);</span>
<a href="#l76.800"></a><span id="l76.800" class="difflineplus">+          return time;</span>
<a href="#l76.801"></a><span id="l76.801" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.802"></a><span id="l76.802">       &lt;/method&gt;</span>
<a href="#l76.803"></a><span id="l76.803"> </span>
<a href="#l76.804"></a><span id="l76.804">       &lt;method name=&quot;onPopup&quot;&gt;</span>
<a href="#l76.805"></a><span id="l76.805">         &lt;parameter name=&quot;aPopup&quot; /&gt;</span>
<a href="#l76.806"></a><span id="l76.806" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.807"></a><span id="l76.807" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.808"></a><span id="l76.808" class="difflineminus">-            // select all to remove cursor since can't type while popped-up</span>
<a href="#l76.809"></a><span id="l76.809" class="difflineminus">-            this.select();</span>
<a href="#l76.810"></a><span id="l76.810" class="difflineminus">-            let timePickerGrid = aPopup.childNodes[0];</span>
<a href="#l76.811"></a><span id="l76.811" class="difflineminus">-            timePickerGrid.onPopupShowing(this, aPopup);</span>
<a href="#l76.812"></a><span id="l76.812" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.813"></a><span id="l76.813" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.814"></a><span id="l76.814" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.815"></a><span id="l76.815" class="difflineplus">+          // select all to remove cursor since can't type while popped-up</span>
<a href="#l76.816"></a><span id="l76.816" class="difflineplus">+          this.select();</span>
<a href="#l76.817"></a><span id="l76.817" class="difflineplus">+          let timePickerGrid = aPopup.childNodes[0];</span>
<a href="#l76.818"></a><span id="l76.818" class="difflineplus">+          timePickerGrid.onPopupShowing(this, aPopup);</span>
<a href="#l76.819"></a><span id="l76.819" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.820"></a><span id="l76.820">       &lt;/method&gt;</span>
<a href="#l76.821"></a><span id="l76.821"> </span>
<a href="#l76.822"></a><span id="l76.822">       &lt;method name=&quot;onHide&quot;&gt;</span>
<a href="#l76.823"></a><span id="l76.823">         &lt;parameter name=&quot;aPopup&quot;/&gt;</span>
<a href="#l76.824"></a><span id="l76.824" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.825"></a><span id="l76.825" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.826"></a><span id="l76.826" class="difflineminus">-            // This is the timepicker grid.  Why aren't we using anonid?</span>
<a href="#l76.827"></a><span id="l76.827" class="difflineminus">-            aPopup.childNodes[0].onPopupHiding();</span>
<a href="#l76.828"></a><span id="l76.828" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.829"></a><span id="l76.829" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.830"></a><span id="l76.830" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.831"></a><span id="l76.831" class="difflineplus">+          // This is the timepicker grid.  Why aren't we using anonid?</span>
<a href="#l76.832"></a><span id="l76.832" class="difflineplus">+          aPopup.childNodes[0].onPopupHiding();</span>
<a href="#l76.833"></a><span id="l76.833" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.834"></a><span id="l76.834">       &lt;/method&gt;</span>
<a href="#l76.835"></a><span id="l76.835"> </span>
<a href="#l76.836"></a><span id="l76.836">       &lt;method name=&quot;select&quot;&gt;</span>
<a href="#l76.837"></a><span id="l76.837" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.838"></a><span id="l76.838" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.839"></a><span id="l76.839" class="difflineminus">-            // select all in text box</span>
<a href="#l76.840"></a><span id="l76.840" class="difflineminus">-            this.kTextBox.select();</span>
<a href="#l76.841"></a><span id="l76.841" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.842"></a><span id="l76.842" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.843"></a><span id="l76.843" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.844"></a><span id="l76.844" class="difflineplus">+          // select all in text box</span>
<a href="#l76.845"></a><span id="l76.845" class="difflineplus">+          this.kTextBox.select();</span>
<a href="#l76.846"></a><span id="l76.846" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.847"></a><span id="l76.847">       &lt;/method&gt;</span>
<a href="#l76.848"></a><span id="l76.848"> </span>
<a href="#l76.849"></a><span id="l76.849">     &lt;/implementation&gt;</span>
<a href="#l76.850"></a><span id="l76.850"> </span>
<a href="#l76.851"></a><span id="l76.851" class="difflineminus">-    &lt;!-- ::::::::::::::::: HANDLERS ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.852"></a><span id="l76.852" class="difflineminus">-</span>
<a href="#l76.853"></a><span id="l76.853">     &lt;handlers&gt;</span>
<a href="#l76.854"></a><span id="l76.854">       &lt;handler event=&quot;bindingattached&quot; action=&quot;this.initialize();&quot;/&gt;</span>
<a href="#l76.855"></a><span id="l76.855" class="difflineminus">-      &lt;handler event=&quot;blur&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l76.856"></a><span id="l76.856" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.857"></a><span id="l76.857" class="difflineminus">-          this.parseTextBoxTime(true);</span>
<a href="#l76.858"></a><span id="l76.858" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.859"></a><span id="l76.859" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l76.860"></a><span id="l76.860" class="difflineplus">+      &lt;handler event=&quot;blur&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l76.861"></a><span id="l76.861" class="difflineplus">+        this.parseTextBoxTime(true);</span>
<a href="#l76.862"></a><span id="l76.862" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l76.863"></a><span id="l76.863">     &lt;/handlers&gt;</span>
<a href="#l76.864"></a><span id="l76.864" class="difflineminus">-</span>
<a href="#l76.865"></a><span id="l76.865">   &lt;/binding&gt;</span>
<a href="#l76.866"></a><span id="l76.866"> </span>
<a href="#l76.867"></a><span id="l76.867">   &lt;binding id=&quot;timepicker-hour&quot;&gt;</span>
<a href="#l76.868"></a><span id="l76.868">     &lt;content&gt;</span>
<a href="#l76.869"></a><span id="l76.869">       &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l76.870"></a><span id="l76.870">       &lt;xul:vbox anonid=&quot;hourbox&quot;</span>
<a href="#l76.871"></a><span id="l76.871">                 onclick=&quot;clickHour(this.parentNode, this.parentNode.getAttribute('value'))&quot;</span>
<a href="#l76.872"></a><span id="l76.872">                 ondblclick=&quot;doubleClickHour(this.parentNode, this.parentNode.getAttribute('value'))&quot;&gt;</span>
<a href="#l76.873"></a><span id="l76.873">         &lt;xul:box&gt;</span>
<a href="#l76.874"></a><span id="l76.874">           &lt;xul:label class=&quot;time-picker-hour-label&quot; anonid=&quot;hourlabel&quot; xbl:inherits=&quot;value=label,selected&quot;/&gt;</span>
<a href="#l76.875"></a><span id="l76.875">         &lt;/xul:box&gt;</span>
<a href="#l76.876"></a><span id="l76.876">         &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l76.877"></a><span id="l76.877">       &lt;/xul:vbox&gt;</span>
<a href="#l76.878"></a><span id="l76.878">       &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l76.879"></a><span id="l76.879">     &lt;/content&gt;</span>
<a href="#l76.880"></a><span id="l76.880" class="difflineplus">+</span>
<a href="#l76.881"></a><span id="l76.881">     &lt;implementation&gt;</span>
<a href="#l76.882"></a><span id="l76.882">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l76.883"></a><span id="l76.883">     &lt;/implementation&gt;</span>
<a href="#l76.884"></a><span id="l76.884" class="difflineplus">+</span>
<a href="#l76.885"></a><span id="l76.885">     &lt;handlers&gt;</span>
<a href="#l76.886"></a><span id="l76.886" class="difflineminus">-      &lt;handler event=&quot;wheel&quot;&gt;</span>
<a href="#l76.887"></a><span id="l76.887" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.888"></a><span id="l76.888" class="difflineplus">+      &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l76.889"></a><span id="l76.889">         const pixelThreshold = 50;</span>
<a href="#l76.890"></a><span id="l76.890">         let deltaView = 0;</span>
<a href="#l76.891"></a><span id="l76.891"> </span>
<a href="#l76.892"></a><span id="l76.892">         if (event.deltaMode == event.DOM_DELTA_PAGE ||</span>
<a href="#l76.893"></a><span id="l76.893">             event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l76.894"></a><span id="l76.894">             // Line/Page scrolling is usually vertical</span>
<a href="#l76.895"></a><span id="l76.895">             if (event.deltaY) {</span>
<a href="#l76.896"></a><span id="l76.896">                 deltaView = event.deltaY &lt; 0 ? -1 : 1;</span>
<a href="#l76.897"></a><span id="l76.897" class="difflineat">@@ -730,38 +675,38 @@</span>
<a href="#l76.898"></a><span id="l76.898">         }</span>
<a href="#l76.899"></a><span id="l76.899"> </span>
<a href="#l76.900"></a><span id="l76.900">         if (deltaView != 0) {</span>
<a href="#l76.901"></a><span id="l76.901">             moveHours(deltaView);</span>
<a href="#l76.902"></a><span id="l76.902">         }</span>
<a href="#l76.903"></a><span id="l76.903"> </span>
<a href="#l76.904"></a><span id="l76.904">         event.stopPropagation();</span>
<a href="#l76.905"></a><span id="l76.905">         event.preventDefault();</span>
<a href="#l76.906"></a><span id="l76.906" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.907"></a><span id="l76.907" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l76.908"></a><span id="l76.908" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l76.909"></a><span id="l76.909">     &lt;/handlers&gt;</span>
<a href="#l76.910"></a><span id="l76.910">   &lt;/binding&gt;</span>
<a href="#l76.911"></a><span id="l76.911"> </span>
<a href="#l76.912"></a><span id="l76.912">   &lt;binding id=&quot;timepicker-minute&quot;&gt;</span>
<a href="#l76.913"></a><span id="l76.913">     &lt;content&gt;</span>
<a href="#l76.914"></a><span id="l76.914">       &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l76.915"></a><span id="l76.915">       &lt;xul:vbox anonid=&quot;minutebox&quot;</span>
<a href="#l76.916"></a><span id="l76.916">                 onclick=&quot;clickMinute(this.parentNode, this.parentNode.getAttribute('value'))&quot;&gt;</span>
<a href="#l76.917"></a><span id="l76.917">         &lt;xul:box&gt;</span>
<a href="#l76.918"></a><span id="l76.918">           &lt;xul:label class=&quot;time-picker-minute-label&quot; anonid=&quot;minutelabel&quot; xbl:inherits=&quot;value=label,selected&quot;/&gt;</span>
<a href="#l76.919"></a><span id="l76.919">         &lt;/xul:box&gt;</span>
<a href="#l76.920"></a><span id="l76.920">       &lt;/xul:vbox&gt;</span>
<a href="#l76.921"></a><span id="l76.921">       &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l76.922"></a><span id="l76.922">     &lt;/content&gt;</span>
<a href="#l76.923"></a><span id="l76.923" class="difflineplus">+</span>
<a href="#l76.924"></a><span id="l76.924">     &lt;implementation&gt;</span>
<a href="#l76.925"></a><span id="l76.925">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l76.926"></a><span id="l76.926">     &lt;/implementation&gt;</span>
<a href="#l76.927"></a><span id="l76.927" class="difflineplus">+</span>
<a href="#l76.928"></a><span id="l76.928">     &lt;handlers&gt;</span>
<a href="#l76.929"></a><span id="l76.929" class="difflineminus">-      &lt;handler event=&quot;wheel&quot;&gt;</span>
<a href="#l76.930"></a><span id="l76.930" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.931"></a><span id="l76.931" class="difflineplus">+      &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l76.932"></a><span id="l76.932">         const pixelThreshold = 50;</span>
<a href="#l76.933"></a><span id="l76.933">         let deltaView = 0;</span>
<a href="#l76.934"></a><span id="l76.934"> </span>
<a href="#l76.935"></a><span id="l76.935">         if (event.deltaMode == event.DOM_DELTA_PAGE ||</span>
<a href="#l76.936"></a><span id="l76.936">             event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l76.937"></a><span id="l76.937">             // Line/Page scrolling is usually vertical</span>
<a href="#l76.938"></a><span id="l76.938">             if (event.deltaY) {</span>
<a href="#l76.939"></a><span id="l76.939">                 deltaView = event.deltaY &lt; 0 ? -1 : 1;</span>
<a href="#l76.940"></a><span id="l76.940" class="difflineat">@@ -779,29 +724,26 @@</span>
<a href="#l76.941"></a><span id="l76.941">         }</span>
<a href="#l76.942"></a><span id="l76.942"> </span>
<a href="#l76.943"></a><span id="l76.943">         if (deltaView != 0) {</span>
<a href="#l76.944"></a><span id="l76.944">             moveMinutes(deltaView);</span>
<a href="#l76.945"></a><span id="l76.945">         }</span>
<a href="#l76.946"></a><span id="l76.946"> </span>
<a href="#l76.947"></a><span id="l76.947">         event.stopPropagation();</span>
<a href="#l76.948"></a><span id="l76.948">         event.preventDefault();</span>
<a href="#l76.949"></a><span id="l76.949" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.950"></a><span id="l76.950" class="difflineminus">-      &lt;/handler&gt;</span>
<a href="#l76.951"></a><span id="l76.951" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l76.952"></a><span id="l76.952">     &lt;/handlers&gt;</span>
<a href="#l76.953"></a><span id="l76.953">   &lt;/binding&gt;</span>
<a href="#l76.954"></a><span id="l76.954"> </span>
<a href="#l76.955"></a><span id="l76.955">   &lt;binding id=&quot;timepicker-grids&quot; extends=&quot;xul:box&quot;&gt;</span>
<a href="#l76.956"></a><span id="l76.956">     &lt;resources&gt;</span>
<a href="#l76.957"></a><span id="l76.957">       &lt;stylesheet src=&quot;chrome://lightning-common/skin/datetimepickers.css&quot;/&gt;</span>
<a href="#l76.958"></a><span id="l76.958">     &lt;/resources&gt;</span>
<a href="#l76.959"></a><span id="l76.959"> </span>
<a href="#l76.960"></a><span id="l76.960" class="difflineminus">-    &lt;!-- ::::::::::::::::: CONTENT ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.961"></a><span id="l76.961">     &lt;content&gt;</span>
<a href="#l76.962"></a><span id="l76.962" class="difflineminus">-      &lt;!-- Box to hold time picker internals --&gt;</span>
<a href="#l76.963"></a><span id="l76.963">       &lt;vbox anonid=&quot;time-picker-grids&quot;</span>
<a href="#l76.964"></a><span id="l76.964">             xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l76.965"></a><span id="l76.965">         &lt;!-- Hour Grid --&gt;</span>
<a href="#l76.966"></a><span id="l76.966">         &lt;grid anonid=&quot;time-picker-hour-grid&quot; format12hours=&quot;false&quot;&gt;</span>
<a href="#l76.967"></a><span id="l76.967">           &lt;columns&gt;</span>
<a href="#l76.968"></a><span id="l76.968">             &lt;column class=&quot;time-picker-hour-column-class&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l76.969"></a><span id="l76.969">             &lt;column class=&quot;time-picker-hour-column-class&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l76.970"></a><span id="l76.970">             &lt;column class=&quot;time-picker-hour-column-class&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l76.971"></a><span id="l76.971" class="difflineat">@@ -1084,607 +1026,552 @@</span>
<a href="#l76.972"></a><span id="l76.972">           &lt;hbox class=&quot;time-picker-minutes-bottom&quot;&gt;</span>
<a href="#l76.973"></a><span id="l76.973">             &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l76.974"></a><span id="l76.974">             &lt;label class=&quot;time-picker-more-control-label&quot; value=&quot;&amp;laquo;&quot; onclick=&quot;clickLess()&quot;/&gt;</span>
<a href="#l76.975"></a><span id="l76.975">           &lt;/hbox&gt;</span>
<a href="#l76.976"></a><span id="l76.976">         &lt;/vbox&gt; &lt;!-- One  Minute Grid Box --&gt;</span>
<a href="#l76.977"></a><span id="l76.977">       &lt;/vbox&gt; &lt;!-- Box to hold time picker internals --&gt;</span>
<a href="#l76.978"></a><span id="l76.978">     &lt;/content&gt;</span>
<a href="#l76.979"></a><span id="l76.979"> </span>
<a href="#l76.980"></a><span id="l76.980" class="difflineminus">-    &lt;!-- ::::::::::::::::: INTERFACE ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.981"></a><span id="l76.981">     &lt;implementation&gt;</span>
<a href="#l76.982"></a><span id="l76.982" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l76.983"></a><span id="l76.983" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.984"></a><span id="l76.984" class="difflineminus">-          // set by onPopupShowing</span>
<a href="#l76.985"></a><span id="l76.985" class="difflineminus">-          this.mPicker = null;</span>
<a href="#l76.986"></a><span id="l76.986" class="difflineminus">-          this.mPopup = null;</span>
<a href="#l76.987"></a><span id="l76.987" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l76.988"></a><span id="l76.988" class="difflineplus">+        // set by onPopupShowing</span>
<a href="#l76.989"></a><span id="l76.989" class="difflineplus">+        this.mPicker = null;</span>
<a href="#l76.990"></a><span id="l76.990" class="difflineplus">+        this.mPopup = null;</span>
<a href="#l76.991"></a><span id="l76.991"> </span>
<a href="#l76.992"></a><span id="l76.992" class="difflineminus">-          // The currently selected time</span>
<a href="#l76.993"></a><span id="l76.993" class="difflineminus">-          this.mSelectedTime = new Date();</span>
<a href="#l76.994"></a><span id="l76.994" class="difflineminus">-          // The selected hour and selected minute items</span>
<a href="#l76.995"></a><span id="l76.995" class="difflineminus">-          this.mSelectedHourItem = null;</span>
<a href="#l76.996"></a><span id="l76.996" class="difflineminus">-          this.mSelectedMinuteItem = null;</span>
<a href="#l76.997"></a><span id="l76.997" class="difflineminus">-          // constants use to specify one and five minute view</span>
<a href="#l76.998"></a><span id="l76.998" class="difflineminus">-          this.kMINUTE_VIEW_FIVE = 5;</span>
<a href="#l76.999"></a><span id="l76.999" class="difflineminus">-          this.kMINUTE_VIEW_ONE = 1;</span>
<a href="#l76.1000"></a><span id="l76.1000" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.1001"></a><span id="l76.1001" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l76.1002"></a><span id="l76.1002" class="difflineplus">+        // The currently selected time</span>
<a href="#l76.1003"></a><span id="l76.1003" class="difflineplus">+        this.mSelectedTime = new Date();</span>
<a href="#l76.1004"></a><span id="l76.1004" class="difflineplus">+        // The selected hour and selected minute items</span>
<a href="#l76.1005"></a><span id="l76.1005" class="difflineplus">+        this.mSelectedHourItem = null;</span>
<a href="#l76.1006"></a><span id="l76.1006" class="difflineplus">+        this.mSelectedMinuteItem = null;</span>
<a href="#l76.1007"></a><span id="l76.1007" class="difflineplus">+        // constants use to specify one and five minute view</span>
<a href="#l76.1008"></a><span id="l76.1008" class="difflineplus">+        this.kMINUTE_VIEW_FIVE = 5;</span>
<a href="#l76.1009"></a><span id="l76.1009" class="difflineplus">+        this.kMINUTE_VIEW_ONE = 1;</span>
<a href="#l76.1010"></a><span id="l76.1010" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l76.1011"></a><span id="l76.1011"> </span>
<a href="#l76.1012"></a><span id="l76.1012">       &lt;!-- Set up the picker, called when the popup pops --&gt;</span>
<a href="#l76.1013"></a><span id="l76.1013">       &lt;method name=&quot;onPopupShowing&quot;&gt;</span>
<a href="#l76.1014"></a><span id="l76.1014">         &lt;parameter name=&quot;aPicker&quot;/&gt;</span>
<a href="#l76.1015"></a><span id="l76.1015">         &lt;parameter name=&quot;aPopup&quot;/&gt;</span>
<a href="#l76.1016"></a><span id="l76.1016" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1017"></a><span id="l76.1017" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1018"></a><span id="l76.1018" class="difflineminus">-            this.mPicker = aPicker;</span>
<a href="#l76.1019"></a><span id="l76.1019" class="difflineminus">-            this.mPopup = aPopup;</span>
<a href="#l76.1020"></a><span id="l76.1020" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1021"></a><span id="l76.1021" class="difflineplus">+          this.mPicker = aPicker;</span>
<a href="#l76.1022"></a><span id="l76.1022" class="difflineplus">+          this.mPopup = aPopup;</span>
<a href="#l76.1023"></a><span id="l76.1023"> </span>
<a href="#l76.1024"></a><span id="l76.1024" class="difflineminus">-            // if there is a Date object in the popup item's</span>
<a href="#l76.1025"></a><span id="l76.1025" class="difflineminus">-            // value attribute, use it, otherwise use Now.</span>
<a href="#l76.1026"></a><span id="l76.1026" class="difflineminus">-            let inputTime = this.mPicker.value;</span>
<a href="#l76.1027"></a><span id="l76.1027" class="difflineminus">-            if (inputTime) {</span>
<a href="#l76.1028"></a><span id="l76.1028" class="difflineplus">+          // if there is a Date object in the popup item's</span>
<a href="#l76.1029"></a><span id="l76.1029" class="difflineplus">+          // value attribute, use it, otherwise use Now.</span>
<a href="#l76.1030"></a><span id="l76.1030" class="difflineplus">+          let inputTime = this.mPicker.value;</span>
<a href="#l76.1031"></a><span id="l76.1031" class="difflineplus">+          if (inputTime) {</span>
<a href="#l76.1032"></a><span id="l76.1032">               this.mSelectedTime = new Date(inputTime);</span>
<a href="#l76.1033"></a><span id="l76.1033" class="difflineminus">-            } else {</span>
<a href="#l76.1034"></a><span id="l76.1034" class="difflineplus">+          } else {</span>
<a href="#l76.1035"></a><span id="l76.1035">               this.mSelectedTime = new Date();</span>
<a href="#l76.1036"></a><span id="l76.1036" class="difflineminus">-            }</span>
<a href="#l76.1037"></a><span id="l76.1037" class="difflineplus">+          }</span>
<a href="#l76.1038"></a><span id="l76.1038"> </span>
<a href="#l76.1039"></a><span id="l76.1039" class="difflineminus">-            // select the hour item</span>
<a href="#l76.1040"></a><span id="l76.1040" class="difflineminus">-            let hours24 = this.mSelectedTime.getHours();</span>
<a href="#l76.1041"></a><span id="l76.1041" class="difflineminus">-            let hourItemId = &quot;time-picker-hour-box-&quot; + hours24;</span>
<a href="#l76.1042"></a><span id="l76.1042" class="difflineminus">-            let hourItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, hourItemId);</span>
<a href="#l76.1043"></a><span id="l76.1043" class="difflineminus">-            this.selectHourItem(hourItem);</span>
<a href="#l76.1044"></a><span id="l76.1044" class="difflineplus">+          // select the hour item</span>
<a href="#l76.1045"></a><span id="l76.1045" class="difflineplus">+          let hours24 = this.mSelectedTime.getHours();</span>
<a href="#l76.1046"></a><span id="l76.1046" class="difflineplus">+          let hourItemId = &quot;time-picker-hour-box-&quot; + hours24;</span>
<a href="#l76.1047"></a><span id="l76.1047" class="difflineplus">+          let hourItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, hourItemId);</span>
<a href="#l76.1048"></a><span id="l76.1048" class="difflineplus">+          this.selectHourItem(hourItem);</span>
<a href="#l76.1049"></a><span id="l76.1049"> </span>
<a href="#l76.1050"></a><span id="l76.1050" class="difflineminus">-            // Show the five minute view if we are an even five minutes,</span>
<a href="#l76.1051"></a><span id="l76.1051" class="difflineminus">-            // otherwise one minute view</span>
<a href="#l76.1052"></a><span id="l76.1052" class="difflineminus">-            let minutesByFive = this.calcNearestFiveMinutes(this.mSelectedTime);</span>
<a href="#l76.1053"></a><span id="l76.1053" class="difflineplus">+          // Show the five minute view if we are an even five minutes,</span>
<a href="#l76.1054"></a><span id="l76.1054" class="difflineplus">+          // otherwise one minute view</span>
<a href="#l76.1055"></a><span id="l76.1055" class="difflineplus">+          let minutesByFive = this.calcNearestFiveMinutes(this.mSelectedTime);</span>
<a href="#l76.1056"></a><span id="l76.1056"> </span>
<a href="#l76.1057"></a><span id="l76.1057" class="difflineminus">-            if (minutesByFive == this.mSelectedTime.getMinutes()) {</span>
<a href="#l76.1058"></a><span id="l76.1058" class="difflineplus">+          if (minutesByFive == this.mSelectedTime.getMinutes()) {</span>
<a href="#l76.1059"></a><span id="l76.1059">               this.clickLess();</span>
<a href="#l76.1060"></a><span id="l76.1060" class="difflineminus">-            } else {</span>
<a href="#l76.1061"></a><span id="l76.1061" class="difflineplus">+          } else {</span>
<a href="#l76.1062"></a><span id="l76.1062">               this.clickMore();</span>
<a href="#l76.1063"></a><span id="l76.1063" class="difflineminus">-            }</span>
<a href="#l76.1064"></a><span id="l76.1064" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1065"></a><span id="l76.1065" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1066"></a><span id="l76.1066" class="difflineplus">+          }</span>
<a href="#l76.1067"></a><span id="l76.1067" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1068"></a><span id="l76.1068">       &lt;/method&gt;</span>
<a href="#l76.1069"></a><span id="l76.1069"> </span>
<a href="#l76.1070"></a><span id="l76.1070">       &lt;method name=&quot;onPopupHiding&quot;&gt;</span>
<a href="#l76.1071"></a><span id="l76.1071" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1072"></a><span id="l76.1072" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1073"></a><span id="l76.1073" class="difflineminus">-            if (this.hasChanged) {</span>
<a href="#l76.1074"></a><span id="l76.1074" class="difflineminus">-                this.timeSelected();</span>
<a href="#l76.1075"></a><span id="l76.1075" class="difflineminus">-            }</span>
<a href="#l76.1076"></a><span id="l76.1076" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1077"></a><span id="l76.1077" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1078"></a><span id="l76.1078" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1079"></a><span id="l76.1079" class="difflineplus">+          if (this.hasChanged) {</span>
<a href="#l76.1080"></a><span id="l76.1080" class="difflineplus">+              this.timeSelected();</span>
<a href="#l76.1081"></a><span id="l76.1081" class="difflineplus">+          }</span>
<a href="#l76.1082"></a><span id="l76.1082" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1083"></a><span id="l76.1083">       &lt;/method&gt;</span>
<a href="#l76.1084"></a><span id="l76.1084"> </span>
<a href="#l76.1085"></a><span id="l76.1085">       &lt;!-- Called when the more tab is clicked, and possibly at startup --&gt;</span>
<a href="#l76.1086"></a><span id="l76.1086">       &lt;method name=&quot;clickMore&quot;&gt;</span>
<a href="#l76.1087"></a><span id="l76.1087" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1088"></a><span id="l76.1088" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1089"></a><span id="l76.1089" class="difflineminus">-            // switch to one minute view</span>
<a href="#l76.1090"></a><span id="l76.1090" class="difflineminus">-            this.switchMinuteView(this.kMINUTE_VIEW_ONE);</span>
<a href="#l76.1091"></a><span id="l76.1091" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1092"></a><span id="l76.1092" class="difflineplus">+          // switch to one minute view</span>
<a href="#l76.1093"></a><span id="l76.1093" class="difflineplus">+          this.switchMinuteView(this.kMINUTE_VIEW_ONE);</span>
<a href="#l76.1094"></a><span id="l76.1094"> </span>
<a href="#l76.1095"></a><span id="l76.1095" class="difflineminus">-            // select minute box corresponding to the time</span>
<a href="#l76.1096"></a><span id="l76.1096" class="difflineminus">-            let minutes = this.mSelectedTime.getMinutes();</span>
<a href="#l76.1097"></a><span id="l76.1097" class="difflineminus">-            let oneMinuteItemId = &quot;time-picker-one-minute-box-&quot; + minutes;</span>
<a href="#l76.1098"></a><span id="l76.1098" class="difflineminus">-            let oneMinuteItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, oneMinuteItemId);</span>
<a href="#l76.1099"></a><span id="l76.1099" class="difflineminus">-            this.selectMinuteItem(oneMinuteItem);</span>
<a href="#l76.1100"></a><span id="l76.1100" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1101"></a><span id="l76.1101" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1102"></a><span id="l76.1102" class="difflineplus">+          // select minute box corresponding to the time</span>
<a href="#l76.1103"></a><span id="l76.1103" class="difflineplus">+          let minutes = this.mSelectedTime.getMinutes();</span>
<a href="#l76.1104"></a><span id="l76.1104" class="difflineplus">+          let oneMinuteItemId = &quot;time-picker-one-minute-box-&quot; + minutes;</span>
<a href="#l76.1105"></a><span id="l76.1105" class="difflineplus">+          let oneMinuteItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, oneMinuteItemId);</span>
<a href="#l76.1106"></a><span id="l76.1106" class="difflineplus">+          this.selectMinuteItem(oneMinuteItem);</span>
<a href="#l76.1107"></a><span id="l76.1107" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1108"></a><span id="l76.1108">       &lt;/method&gt;</span>
<a href="#l76.1109"></a><span id="l76.1109"> </span>
<a href="#l76.1110"></a><span id="l76.1110">       &lt;!-- Called when the less tab is clicked, and possibly at startup --&gt;</span>
<a href="#l76.1111"></a><span id="l76.1111">       &lt;method name=&quot;clickLess&quot;&gt;</span>
<a href="#l76.1112"></a><span id="l76.1112" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1113"></a><span id="l76.1113" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1114"></a><span id="l76.1114" class="difflineminus">-            // switch to five minute view</span>
<a href="#l76.1115"></a><span id="l76.1115" class="difflineminus">-            this.switchMinuteView(this.kMINUTE_VIEW_FIVE);</span>
<a href="#l76.1116"></a><span id="l76.1116" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1117"></a><span id="l76.1117" class="difflineplus">+          // switch to five minute view</span>
<a href="#l76.1118"></a><span id="l76.1118" class="difflineplus">+          this.switchMinuteView(this.kMINUTE_VIEW_FIVE);</span>
<a href="#l76.1119"></a><span id="l76.1119"> </span>
<a href="#l76.1120"></a><span id="l76.1120" class="difflineminus">-            // select closest five minute box,</span>
<a href="#l76.1121"></a><span id="l76.1121" class="difflineminus">-            // BUT leave the selected time at what may NOT be an even five minutes</span>
<a href="#l76.1122"></a><span id="l76.1122" class="difflineminus">-            // So that If they click more again the proper non-even-five minute</span>
<a href="#l76.1123"></a><span id="l76.1123" class="difflineminus">-            // box will be selected</span>
<a href="#l76.1124"></a><span id="l76.1124" class="difflineminus">-            let minutesByFive = this.calcNearestFiveMinutes(this.mSelectedTime);</span>
<a href="#l76.1125"></a><span id="l76.1125" class="difflineminus">-            let fiveMinuteItemId = &quot;time-picker-five-minute-box-&quot; + minutesByFive;</span>
<a href="#l76.1126"></a><span id="l76.1126" class="difflineminus">-            let fiveMinuteItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, fiveMinuteItemId);</span>
<a href="#l76.1127"></a><span id="l76.1127" class="difflineminus">-            this.selectMinuteItem(fiveMinuteItem);</span>
<a href="#l76.1128"></a><span id="l76.1128" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1129"></a><span id="l76.1129" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1130"></a><span id="l76.1130" class="difflineplus">+          // select closest five minute box,</span>
<a href="#l76.1131"></a><span id="l76.1131" class="difflineplus">+          // BUT leave the selected time at what may NOT be an even five minutes</span>
<a href="#l76.1132"></a><span id="l76.1132" class="difflineplus">+          // So that If they click more again the proper non-even-five minute</span>
<a href="#l76.1133"></a><span id="l76.1133" class="difflineplus">+          // box will be selected</span>
<a href="#l76.1134"></a><span id="l76.1134" class="difflineplus">+          let minutesByFive = this.calcNearestFiveMinutes(this.mSelectedTime);</span>
<a href="#l76.1135"></a><span id="l76.1135" class="difflineplus">+          let fiveMinuteItemId = &quot;time-picker-five-minute-box-&quot; + minutesByFive;</span>
<a href="#l76.1136"></a><span id="l76.1136" class="difflineplus">+          let fiveMinuteItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, fiveMinuteItemId);</span>
<a href="#l76.1137"></a><span id="l76.1137" class="difflineplus">+          this.selectMinuteItem(fiveMinuteItem);</span>
<a href="#l76.1138"></a><span id="l76.1138" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1139"></a><span id="l76.1139">       &lt;/method&gt;</span>
<a href="#l76.1140"></a><span id="l76.1140"> </span>
<a href="#l76.1141"></a><span id="l76.1141">       &lt;!-- Called when one of the hour boxes is clicked --&gt;</span>
<a href="#l76.1142"></a><span id="l76.1142">       &lt;method name=&quot;clickHour&quot;&gt;</span>
<a href="#l76.1143"></a><span id="l76.1143">         &lt;parameter name=&quot;hourItem&quot;/&gt;</span>
<a href="#l76.1144"></a><span id="l76.1144">         &lt;parameter name=&quot;hourNumber&quot;/&gt;</span>
<a href="#l76.1145"></a><span id="l76.1145" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1146"></a><span id="l76.1146" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1147"></a><span id="l76.1147" class="difflineminus">-            // select the item</span>
<a href="#l76.1148"></a><span id="l76.1148" class="difflineminus">-            this.selectHourItem(hourItem);</span>
<a href="#l76.1149"></a><span id="l76.1149" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1150"></a><span id="l76.1150" class="difflineplus">+          // select the item</span>
<a href="#l76.1151"></a><span id="l76.1151" class="difflineplus">+          this.selectHourItem(hourItem);</span>
<a href="#l76.1152"></a><span id="l76.1152"> </span>
<a href="#l76.1153"></a><span id="l76.1153" class="difflineminus">-            // Change the hour in the selected time.</span>
<a href="#l76.1154"></a><span id="l76.1154" class="difflineminus">-            this.mSelectedTime.setHours(hourNumber);</span>
<a href="#l76.1155"></a><span id="l76.1155" class="difflineplus">+          // Change the hour in the selected time.</span>
<a href="#l76.1156"></a><span id="l76.1156" class="difflineplus">+          this.mSelectedTime.setHours(hourNumber);</span>
<a href="#l76.1157"></a><span id="l76.1157"> </span>
<a href="#l76.1158"></a><span id="l76.1158" class="difflineminus">-            this.hasChanged = true;</span>
<a href="#l76.1159"></a><span id="l76.1159" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1160"></a><span id="l76.1160" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1161"></a><span id="l76.1161" class="difflineplus">+          this.hasChanged = true;</span>
<a href="#l76.1162"></a><span id="l76.1162" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1163"></a><span id="l76.1163">       &lt;/method&gt;</span>
<a href="#l76.1164"></a><span id="l76.1164"> </span>
<a href="#l76.1165"></a><span id="l76.1165">       &lt;!-- Called when one of the hour boxes is double clicked</span>
<a href="#l76.1166"></a><span id="l76.1166">            Sets the time to the selected hour, on the hour, and closes the popup --&gt;</span>
<a href="#l76.1167"></a><span id="l76.1167">       &lt;method name=&quot;doubleClickHour&quot;&gt;</span>
<a href="#l76.1168"></a><span id="l76.1168">         &lt;parameter name=&quot;hourItem&quot;/&gt;</span>
<a href="#l76.1169"></a><span id="l76.1169">         &lt;parameter name=&quot;hourNumber&quot;/&gt;</span>
<a href="#l76.1170"></a><span id="l76.1170" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1171"></a><span id="l76.1171" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1172"></a><span id="l76.1172" class="difflineminus">-            // set the minutes to :00</span>
<a href="#l76.1173"></a><span id="l76.1173" class="difflineminus">-            this.mSelectedTime.setMinutes(0);</span>
<a href="#l76.1174"></a><span id="l76.1174" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1175"></a><span id="l76.1175" class="difflineplus">+          // set the minutes to :00</span>
<a href="#l76.1176"></a><span id="l76.1176" class="difflineplus">+          this.mSelectedTime.setMinutes(0);</span>
<a href="#l76.1177"></a><span id="l76.1177"> </span>
<a href="#l76.1178"></a><span id="l76.1178" class="difflineminus">-            // remove the popup grid</span>
<a href="#l76.1179"></a><span id="l76.1179" class="difflineminus">-            this.mPopup.hidePopup();</span>
<a href="#l76.1180"></a><span id="l76.1180" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1181"></a><span id="l76.1181" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1182"></a><span id="l76.1182" class="difflineplus">+          // remove the popup grid</span>
<a href="#l76.1183"></a><span id="l76.1183" class="difflineplus">+          this.mPopup.hidePopup();</span>
<a href="#l76.1184"></a><span id="l76.1184" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1185"></a><span id="l76.1185">       &lt;/method&gt;</span>
<a href="#l76.1186"></a><span id="l76.1186"> </span>
<a href="#l76.1187"></a><span id="l76.1187">       &lt;!-- Called when one of the minute boxes is clicked,</span>
<a href="#l76.1188"></a><span id="l76.1188">            Calls the client's onchange and Closes the popup --&gt;</span>
<a href="#l76.1189"></a><span id="l76.1189">       &lt;method name=&quot;clickMinute&quot;&gt;</span>
<a href="#l76.1190"></a><span id="l76.1190">         &lt;parameter name=&quot;minuteItem&quot;/&gt;</span>
<a href="#l76.1191"></a><span id="l76.1191">         &lt;parameter name=&quot;minuteNumber&quot;/&gt;</span>
<a href="#l76.1192"></a><span id="l76.1192" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1193"></a><span id="l76.1193" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1194"></a><span id="l76.1194" class="difflineminus">-            // set the minutes in the selected time</span>
<a href="#l76.1195"></a><span id="l76.1195" class="difflineminus">-            this.mSelectedTime.setMinutes(minuteNumber);</span>
<a href="#l76.1196"></a><span id="l76.1196" class="difflineminus">-            this.selectMinuteItem(minuteItem);</span>
<a href="#l76.1197"></a><span id="l76.1197" class="difflineminus">-            this.hasChanged = true;</span>
<a href="#l76.1198"></a><span id="l76.1198" class="difflineminus">-            // remove the popup grid</span>
<a href="#l76.1199"></a><span id="l76.1199" class="difflineminus">-            this.mPopup.hidePopup();</span>
<a href="#l76.1200"></a><span id="l76.1200" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1201"></a><span id="l76.1201" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1202"></a><span id="l76.1202" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1203"></a><span id="l76.1203" class="difflineplus">+          // set the minutes in the selected time</span>
<a href="#l76.1204"></a><span id="l76.1204" class="difflineplus">+          this.mSelectedTime.setMinutes(minuteNumber);</span>
<a href="#l76.1205"></a><span id="l76.1205" class="difflineplus">+          this.selectMinuteItem(minuteItem);</span>
<a href="#l76.1206"></a><span id="l76.1206" class="difflineplus">+          this.hasChanged = true;</span>
<a href="#l76.1207"></a><span id="l76.1207" class="difflineplus">+          // remove the popup grid</span>
<a href="#l76.1208"></a><span id="l76.1208" class="difflineplus">+          this.mPopup.hidePopup();</span>
<a href="#l76.1209"></a><span id="l76.1209" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1210"></a><span id="l76.1210">       &lt;/method&gt;</span>
<a href="#l76.1211"></a><span id="l76.1211"> </span>
<a href="#l76.1212"></a><span id="l76.1212">       &lt;!-- Called by clickMinute when one of the minute boxes is clicked,</span>
<a href="#l76.1213"></a><span id="l76.1213">            Sets the value property and calls the client's onchange. --&gt;</span>
<a href="#l76.1214"></a><span id="l76.1214">       &lt;method name=&quot;timeSelected&quot;&gt;</span>
<a href="#l76.1215"></a><span id="l76.1215" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1216"></a><span id="l76.1216" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1217"></a><span id="l76.1217" class="difflineminus">-            // Copy picked time to avoid problems changing Date object in place</span>
<a href="#l76.1218"></a><span id="l76.1218" class="difflineminus">-            let pickedTime = new Date(this.mSelectedTime);</span>
<a href="#l76.1219"></a><span id="l76.1219" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1220"></a><span id="l76.1220" class="difflineplus">+          // Copy picked time to avoid problems changing Date object in place</span>
<a href="#l76.1221"></a><span id="l76.1221" class="difflineplus">+          let pickedTime = new Date(this.mSelectedTime);</span>
<a href="#l76.1222"></a><span id="l76.1222"> </span>
<a href="#l76.1223"></a><span id="l76.1223" class="difflineminus">-            // put the picked time in the value property, and update</span>
<a href="#l76.1224"></a><span id="l76.1224" class="difflineminus">-            this.mPicker.update(pickedTime, true);</span>
<a href="#l76.1225"></a><span id="l76.1225" class="difflineminus">-            // select changed value so no cursor appears (can't type to it).</span>
<a href="#l76.1226"></a><span id="l76.1226" class="difflineminus">-            this.mPicker.select();</span>
<a href="#l76.1227"></a><span id="l76.1227" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1228"></a><span id="l76.1228" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1229"></a><span id="l76.1229" class="difflineplus">+          // put the picked time in the value property, and update</span>
<a href="#l76.1230"></a><span id="l76.1230" class="difflineplus">+          this.mPicker.update(pickedTime, true);</span>
<a href="#l76.1231"></a><span id="l76.1231" class="difflineplus">+          // select changed value so no cursor appears (can't type to it).</span>
<a href="#l76.1232"></a><span id="l76.1232" class="difflineplus">+          this.mPicker.select();</span>
<a href="#l76.1233"></a><span id="l76.1233" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1234"></a><span id="l76.1234">       &lt;/method&gt;</span>
<a href="#l76.1235"></a><span id="l76.1235"> </span>
<a href="#l76.1236"></a><span id="l76.1236">       &lt;!-- Helper function to switch between &quot;one&quot; and &quot;five&quot; minute views --&gt;</span>
<a href="#l76.1237"></a><span id="l76.1237">       &lt;method name=&quot;switchMinuteView&quot;&gt;</span>
<a href="#l76.1238"></a><span id="l76.1238">         &lt;parameter name=&quot;view&quot;/&gt;</span>
<a href="#l76.1239"></a><span id="l76.1239" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1240"></a><span id="l76.1240" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1241"></a><span id="l76.1241" class="difflineminus">-            let fiveMinuteBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-five-minute-grid-box&quot;);</span>
<a href="#l76.1242"></a><span id="l76.1242" class="difflineminus">-            let oneMinuteBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-one-minute-grid-box&quot;);</span>
<a href="#l76.1243"></a><span id="l76.1243" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1244"></a><span id="l76.1244" class="difflineplus">+          let fiveMinuteBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-five-minute-grid-box&quot;);</span>
<a href="#l76.1245"></a><span id="l76.1245" class="difflineplus">+          let oneMinuteBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-one-minute-grid-box&quot;);</span>
<a href="#l76.1246"></a><span id="l76.1246"> </span>
<a href="#l76.1247"></a><span id="l76.1247" class="difflineminus">-            if (view == this.kMINUTE_VIEW_ONE) {</span>
<a href="#l76.1248"></a><span id="l76.1248" class="difflineplus">+          if (view == this.kMINUTE_VIEW_ONE) {</span>
<a href="#l76.1249"></a><span id="l76.1249">               fiveMinuteBox.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l76.1250"></a><span id="l76.1250">               oneMinuteBox.setAttribute(&quot;hidden&quot;, false);</span>
<a href="#l76.1251"></a><span id="l76.1251" class="difflineminus">-            } else {</span>
<a href="#l76.1252"></a><span id="l76.1252" class="difflineplus">+          } else {</span>
<a href="#l76.1253"></a><span id="l76.1253">               fiveMinuteBox.setAttribute(&quot;hidden&quot;, false);</span>
<a href="#l76.1254"></a><span id="l76.1254">               oneMinuteBox.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l76.1255"></a><span id="l76.1255" class="difflineminus">-            }</span>
<a href="#l76.1256"></a><span id="l76.1256" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1257"></a><span id="l76.1257" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1258"></a><span id="l76.1258" class="difflineplus">+          }</span>
<a href="#l76.1259"></a><span id="l76.1259" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1260"></a><span id="l76.1260">       &lt;/method&gt;</span>
<a href="#l76.1261"></a><span id="l76.1261"> </span>
<a href="#l76.1262"></a><span id="l76.1262">       &lt;!-- Helper function to select an hour item --&gt;</span>
<a href="#l76.1263"></a><span id="l76.1263">       &lt;method name=&quot;selectHourItem&quot;&gt;</span>
<a href="#l76.1264"></a><span id="l76.1264">         &lt;parameter name=&quot;hourItem&quot;/&gt;</span>
<a href="#l76.1265"></a><span id="l76.1265" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1266"></a><span id="l76.1266" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1267"></a><span id="l76.1267" class="difflineminus">-            // clear old selection, if there is one</span>
<a href="#l76.1268"></a><span id="l76.1268" class="difflineminus">-            if (this.mSelectedHourItem != null) {</span>
<a href="#l76.1269"></a><span id="l76.1269" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1270"></a><span id="l76.1270" class="difflineplus">+          // clear old selection, if there is one</span>
<a href="#l76.1271"></a><span id="l76.1271" class="difflineplus">+          if (this.mSelectedHourItem != null) {</span>
<a href="#l76.1272"></a><span id="l76.1272">               this.mSelectedHourItem.removeAttribute(&quot;selected&quot;);</span>
<a href="#l76.1273"></a><span id="l76.1273" class="difflineminus">-            }</span>
<a href="#l76.1274"></a><span id="l76.1274" class="difflineminus">-            // set selected attribute, to cause the selected style to apply</span>
<a href="#l76.1275"></a><span id="l76.1275" class="difflineminus">-            hourItem.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l76.1276"></a><span id="l76.1276" class="difflineminus">-            // remember the selected item so we can deselect it</span>
<a href="#l76.1277"></a><span id="l76.1277" class="difflineminus">-            this.mSelectedHourItem = hourItem;</span>
<a href="#l76.1278"></a><span id="l76.1278" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1279"></a><span id="l76.1279" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1280"></a><span id="l76.1280" class="difflineplus">+          }</span>
<a href="#l76.1281"></a><span id="l76.1281" class="difflineplus">+          // set selected attribute, to cause the selected style to apply</span>
<a href="#l76.1282"></a><span id="l76.1282" class="difflineplus">+          hourItem.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l76.1283"></a><span id="l76.1283" class="difflineplus">+          // remember the selected item so we can deselect it</span>
<a href="#l76.1284"></a><span id="l76.1284" class="difflineplus">+          this.mSelectedHourItem = hourItem;</span>
<a href="#l76.1285"></a><span id="l76.1285" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1286"></a><span id="l76.1286">       &lt;/method&gt;</span>
<a href="#l76.1287"></a><span id="l76.1287"> </span>
<a href="#l76.1288"></a><span id="l76.1288">       &lt;!-- Helper function to select an minute item --&gt;</span>
<a href="#l76.1289"></a><span id="l76.1289">       &lt;method name=&quot;selectMinuteItem&quot;&gt;</span>
<a href="#l76.1290"></a><span id="l76.1290">         &lt;parameter name=&quot;minuteItem&quot;/&gt;</span>
<a href="#l76.1291"></a><span id="l76.1291" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1292"></a><span id="l76.1292" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1293"></a><span id="l76.1293" class="difflineminus">-            // clear old selection, if there is one</span>
<a href="#l76.1294"></a><span id="l76.1294" class="difflineminus">-            if (this.mSelectedMinuteItem != null) {</span>
<a href="#l76.1295"></a><span id="l76.1295" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1296"></a><span id="l76.1296" class="difflineplus">+          // clear old selection, if there is one</span>
<a href="#l76.1297"></a><span id="l76.1297" class="difflineplus">+          if (this.mSelectedMinuteItem != null) {</span>
<a href="#l76.1298"></a><span id="l76.1298">               this.mSelectedMinuteItem.removeAttribute(&quot;selected&quot;);</span>
<a href="#l76.1299"></a><span id="l76.1299" class="difflineminus">-            }</span>
<a href="#l76.1300"></a><span id="l76.1300" class="difflineminus">-            // set selected attribute, to cause the selected style to apply</span>
<a href="#l76.1301"></a><span id="l76.1301" class="difflineminus">-            minuteItem.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l76.1302"></a><span id="l76.1302" class="difflineminus">-            // remember the selected item so we can deselect it</span>
<a href="#l76.1303"></a><span id="l76.1303" class="difflineminus">-            this.mSelectedMinuteItem = minuteItem;</span>
<a href="#l76.1304"></a><span id="l76.1304" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1305"></a><span id="l76.1305" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1306"></a><span id="l76.1306" class="difflineplus">+          }</span>
<a href="#l76.1307"></a><span id="l76.1307" class="difflineplus">+          // set selected attribute, to cause the selected style to apply</span>
<a href="#l76.1308"></a><span id="l76.1308" class="difflineplus">+          minuteItem.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l76.1309"></a><span id="l76.1309" class="difflineplus">+          // remember the selected item so we can deselect it</span>
<a href="#l76.1310"></a><span id="l76.1310" class="difflineplus">+          this.mSelectedMinuteItem = minuteItem;</span>
<a href="#l76.1311"></a><span id="l76.1311" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1312"></a><span id="l76.1312">       &lt;/method&gt;</span>
<a href="#l76.1313"></a><span id="l76.1313" class="difflineplus">+</span>
<a href="#l76.1314"></a><span id="l76.1314">       &lt;method name=&quot;moveMinutes&quot;&gt;</span>
<a href="#l76.1315"></a><span id="l76.1315">         &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l76.1316"></a><span id="l76.1316" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1317"></a><span id="l76.1317" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1318"></a><span id="l76.1318" class="difflineminus">-            if (!this.mSelectedTime) {</span>
<a href="#l76.1319"></a><span id="l76.1319" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1320"></a><span id="l76.1320" class="difflineplus">+          if (!this.mSelectedTime) {</span>
<a href="#l76.1321"></a><span id="l76.1321">               return;</span>
<a href="#l76.1322"></a><span id="l76.1322" class="difflineminus">-            }</span>
<a href="#l76.1323"></a><span id="l76.1323" class="difflineplus">+          }</span>
<a href="#l76.1324"></a><span id="l76.1324" class="difflineplus">+</span>
<a href="#l76.1325"></a><span id="l76.1325" class="difflineplus">+          let idPrefix = &quot;time-picker-one-minute-box-&quot;;</span>
<a href="#l76.1326"></a><span id="l76.1326"> </span>
<a href="#l76.1327"></a><span id="l76.1327" class="difflineminus">-            let idPrefix = &quot;time-picker-one-minute-box-&quot;;</span>
<a href="#l76.1328"></a><span id="l76.1328" class="difflineplus">+          // Everything above assumes that we are showing the one-minute-grid,</span>
<a href="#l76.1329"></a><span id="l76.1329" class="difflineplus">+          // If not, we need to do these corrections;</span>
<a href="#l76.1330"></a><span id="l76.1330" class="difflineplus">+          let fiveMinuteBox = document.getAnonymousElementByAttribute(</span>
<a href="#l76.1331"></a><span id="l76.1331" class="difflineplus">+                              this, &quot;anonid&quot;, &quot;time-picker-five-minute-grid-box&quot;);</span>
<a href="#l76.1332"></a><span id="l76.1332"> </span>
<a href="#l76.1333"></a><span id="l76.1333" class="difflineminus">-            // Everything above assumes that we are showing the one-minute-grid,</span>
<a href="#l76.1334"></a><span id="l76.1334" class="difflineminus">-            // If not, we need to do these corrections;</span>
<a href="#l76.1335"></a><span id="l76.1335" class="difflineminus">-            let fiveMinuteBox = document.getAnonymousElementByAttribute(</span>
<a href="#l76.1336"></a><span id="l76.1336" class="difflineminus">-                                this, &quot;anonid&quot;, &quot;time-picker-five-minute-grid-box&quot;);</span>
<a href="#l76.1337"></a><span id="l76.1337" class="difflineminus">-</span>
<a href="#l76.1338"></a><span id="l76.1338" class="difflineminus">-            if (fiveMinuteBox.getAttribute(&quot;hidden&quot;) == &quot;false&quot;) {</span>
<a href="#l76.1339"></a><span id="l76.1339" class="difflineplus">+          if (fiveMinuteBox.getAttribute(&quot;hidden&quot;) == &quot;false&quot;) {</span>
<a href="#l76.1340"></a><span id="l76.1340">               aNumber *= 5;</span>
<a href="#l76.1341"></a><span id="l76.1341">               idPrefix = &quot;time-picker-five-minute-box-&quot;;</span>
<a href="#l76.1342"></a><span id="l76.1342"> </span>
<a href="#l76.1343"></a><span id="l76.1343">               // If the detailed view was shown before, then mSelectedTime.getMinutes</span>
<a href="#l76.1344"></a><span id="l76.1344">               // might not be a multiple of 5.</span>
<a href="#l76.1345"></a><span id="l76.1345">               this.mSelectedTime.setMinutes(this.calcNearestFiveMinutes(this.mSelectedTime));</span>
<a href="#l76.1346"></a><span id="l76.1346" class="difflineminus">-            }</span>
<a href="#l76.1347"></a><span id="l76.1347" class="difflineplus">+          }</span>
<a href="#l76.1348"></a><span id="l76.1348"> </span>
<a href="#l76.1349"></a><span id="l76.1349" class="difflineminus">-            let newMinutes = this.mSelectedTime.getMinutes() + aNumber;</span>
<a href="#l76.1350"></a><span id="l76.1350" class="difflineplus">+          let newMinutes = this.mSelectedTime.getMinutes() + aNumber;</span>
<a href="#l76.1351"></a><span id="l76.1351"> </span>
<a href="#l76.1352"></a><span id="l76.1352" class="difflineminus">-            // Handle rollover cases</span>
<a href="#l76.1353"></a><span id="l76.1353" class="difflineminus">-            if (newMinutes &lt; 0) {</span>
<a href="#l76.1354"></a><span id="l76.1354" class="difflineminus">-                newMinutes += 60;</span>
<a href="#l76.1355"></a><span id="l76.1355" class="difflineminus">-            }</span>
<a href="#l76.1356"></a><span id="l76.1356" class="difflineminus">-            if (newMinutes &gt; 59) {</span>
<a href="#l76.1357"></a><span id="l76.1357" class="difflineminus">-                newMinutes -= 60;</span>
<a href="#l76.1358"></a><span id="l76.1358" class="difflineminus">-            }</span>
<a href="#l76.1359"></a><span id="l76.1359" class="difflineplus">+          // Handle rollover cases</span>
<a href="#l76.1360"></a><span id="l76.1360" class="difflineplus">+          if (newMinutes &lt; 0) {</span>
<a href="#l76.1361"></a><span id="l76.1361" class="difflineplus">+              newMinutes += 60;</span>
<a href="#l76.1362"></a><span id="l76.1362" class="difflineplus">+          }</span>
<a href="#l76.1363"></a><span id="l76.1363" class="difflineplus">+          if (newMinutes &gt; 59) {</span>
<a href="#l76.1364"></a><span id="l76.1364" class="difflineplus">+              newMinutes -= 60;</span>
<a href="#l76.1365"></a><span id="l76.1365" class="difflineplus">+          }</span>
<a href="#l76.1366"></a><span id="l76.1366"> </span>
<a href="#l76.1367"></a><span id="l76.1367" class="difflineminus">-            this.mSelectedTime.setMinutes(newMinutes);</span>
<a href="#l76.1368"></a><span id="l76.1368" class="difflineplus">+          this.mSelectedTime.setMinutes(newMinutes);</span>
<a href="#l76.1369"></a><span id="l76.1369"> </span>
<a href="#l76.1370"></a><span id="l76.1370" class="difflineminus">-            let minuteItemId = idPrefix + this.mSelectedTime.getMinutes();</span>
<a href="#l76.1371"></a><span id="l76.1371" class="difflineminus">-            let minuteItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, minuteItemId);</span>
<a href="#l76.1372"></a><span id="l76.1372" class="difflineplus">+          let minuteItemId = idPrefix + this.mSelectedTime.getMinutes();</span>
<a href="#l76.1373"></a><span id="l76.1373" class="difflineplus">+          let minuteItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, minuteItemId);</span>
<a href="#l76.1374"></a><span id="l76.1374"> </span>
<a href="#l76.1375"></a><span id="l76.1375" class="difflineminus">-            this.selectMinuteItem(minuteItem);</span>
<a href="#l76.1376"></a><span id="l76.1376" class="difflineminus">-            this.mPicker.kTextBox.value = this.mPicker.formatTime(this.mSelectedTime);</span>
<a href="#l76.1377"></a><span id="l76.1377" class="difflineminus">-            this.hasChanged = true;</span>
<a href="#l76.1378"></a><span id="l76.1378" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1379"></a><span id="l76.1379" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1380"></a><span id="l76.1380" class="difflineplus">+          this.selectMinuteItem(minuteItem);</span>
<a href="#l76.1381"></a><span id="l76.1381" class="difflineplus">+          this.mPicker.kTextBox.value = this.mPicker.formatTime(this.mSelectedTime);</span>
<a href="#l76.1382"></a><span id="l76.1382" class="difflineplus">+          this.hasChanged = true;</span>
<a href="#l76.1383"></a><span id="l76.1383" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1384"></a><span id="l76.1384">       &lt;/method&gt;</span>
<a href="#l76.1385"></a><span id="l76.1385" class="difflineplus">+</span>
<a href="#l76.1386"></a><span id="l76.1386">       &lt;method name=&quot;moveHours&quot;&gt;</span>
<a href="#l76.1387"></a><span id="l76.1387">         &lt;parameter name=&quot;aNumber&quot;/&gt;</span>
<a href="#l76.1388"></a><span id="l76.1388" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1389"></a><span id="l76.1389" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1390"></a><span id="l76.1390" class="difflineminus">-            if (!this.mSelectedTime) {</span>
<a href="#l76.1391"></a><span id="l76.1391" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1392"></a><span id="l76.1392" class="difflineplus">+          if (!this.mSelectedTime) {</span>
<a href="#l76.1393"></a><span id="l76.1393">               return;</span>
<a href="#l76.1394"></a><span id="l76.1394" class="difflineminus">-            }</span>
<a href="#l76.1395"></a><span id="l76.1395" class="difflineplus">+          }</span>
<a href="#l76.1396"></a><span id="l76.1396"> </span>
<a href="#l76.1397"></a><span id="l76.1397" class="difflineminus">-            let newHours = this.mSelectedTime.getHours() + aNumber;</span>
<a href="#l76.1398"></a><span id="l76.1398" class="difflineplus">+          let newHours = this.mSelectedTime.getHours() + aNumber;</span>
<a href="#l76.1399"></a><span id="l76.1399"> </span>
<a href="#l76.1400"></a><span id="l76.1400" class="difflineminus">-            // Handle rollover cases</span>
<a href="#l76.1401"></a><span id="l76.1401" class="difflineminus">-            if (newHours &lt; 0) {</span>
<a href="#l76.1402"></a><span id="l76.1402" class="difflineminus">-                newHours += 24;</span>
<a href="#l76.1403"></a><span id="l76.1403" class="difflineminus">-            }</span>
<a href="#l76.1404"></a><span id="l76.1404" class="difflineminus">-            if (newHours &gt; 23) {</span>
<a href="#l76.1405"></a><span id="l76.1405" class="difflineminus">-                newHours -= 24;</span>
<a href="#l76.1406"></a><span id="l76.1406" class="difflineminus">-            }</span>
<a href="#l76.1407"></a><span id="l76.1407" class="difflineplus">+          // Handle rollover cases</span>
<a href="#l76.1408"></a><span id="l76.1408" class="difflineplus">+          if (newHours &lt; 0) {</span>
<a href="#l76.1409"></a><span id="l76.1409" class="difflineplus">+              newHours += 24;</span>
<a href="#l76.1410"></a><span id="l76.1410" class="difflineplus">+          }</span>
<a href="#l76.1411"></a><span id="l76.1411" class="difflineplus">+          if (newHours &gt; 23) {</span>
<a href="#l76.1412"></a><span id="l76.1412" class="difflineplus">+              newHours -= 24;</span>
<a href="#l76.1413"></a><span id="l76.1413" class="difflineplus">+          }</span>
<a href="#l76.1414"></a><span id="l76.1414"> </span>
<a href="#l76.1415"></a><span id="l76.1415" class="difflineminus">-            this.mSelectedTime.setHours(newHours);</span>
<a href="#l76.1416"></a><span id="l76.1416" class="difflineplus">+          this.mSelectedTime.setHours(newHours);</span>
<a href="#l76.1417"></a><span id="l76.1417"> </span>
<a href="#l76.1418"></a><span id="l76.1418" class="difflineminus">-            let hourItemId = &quot;time-picker-hour-box-&quot; + this.mSelectedTime.getHours();</span>
<a href="#l76.1419"></a><span id="l76.1419" class="difflineminus">-            let hourItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, hourItemId);</span>
<a href="#l76.1420"></a><span id="l76.1420" class="difflineplus">+          let hourItemId = &quot;time-picker-hour-box-&quot; + this.mSelectedTime.getHours();</span>
<a href="#l76.1421"></a><span id="l76.1421" class="difflineplus">+          let hourItem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, hourItemId);</span>
<a href="#l76.1422"></a><span id="l76.1422"> </span>
<a href="#l76.1423"></a><span id="l76.1423" class="difflineminus">-            this.selectHourItem(hourItem);</span>
<a href="#l76.1424"></a><span id="l76.1424" class="difflineminus">-            this.mPicker.kTextBox.value = this.mPicker.formatTime(this.mSelectedTime);</span>
<a href="#l76.1425"></a><span id="l76.1425" class="difflineminus">-            this.hasChanged = true;</span>
<a href="#l76.1426"></a><span id="l76.1426" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1427"></a><span id="l76.1427" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1428"></a><span id="l76.1428" class="difflineplus">+          this.selectHourItem(hourItem);</span>
<a href="#l76.1429"></a><span id="l76.1429" class="difflineplus">+          this.mPicker.kTextBox.value = this.mPicker.formatTime(this.mSelectedTime);</span>
<a href="#l76.1430"></a><span id="l76.1430" class="difflineplus">+          this.hasChanged = true;</span>
<a href="#l76.1431"></a><span id="l76.1431" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1432"></a><span id="l76.1432">       &lt;/method&gt;</span>
<a href="#l76.1433"></a><span id="l76.1433"> </span>
<a href="#l76.1434"></a><span id="l76.1434">       &lt;!-- Helper function to calulate the nearest even five minutes --&gt;</span>
<a href="#l76.1435"></a><span id="l76.1435">       &lt;method name=&quot;calcNearestFiveMinutes&quot;&gt;</span>
<a href="#l76.1436"></a><span id="l76.1436">         &lt;parameter name=&quot;time&quot;/&gt;</span>
<a href="#l76.1437"></a><span id="l76.1437" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1438"></a><span id="l76.1438" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1439"></a><span id="l76.1439" class="difflineminus">-            let minutes = time.getMinutes();</span>
<a href="#l76.1440"></a><span id="l76.1440" class="difflineminus">-            let minutesByFive = Math.round(minutes / 5) * 5;</span>
<a href="#l76.1441"></a><span id="l76.1441" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1442"></a><span id="l76.1442" class="difflineplus">+          let minutes = time.getMinutes();</span>
<a href="#l76.1443"></a><span id="l76.1443" class="difflineplus">+          let minutesByFive = Math.round(minutes / 5) * 5;</span>
<a href="#l76.1444"></a><span id="l76.1444"> </span>
<a href="#l76.1445"></a><span id="l76.1445" class="difflineminus">-            if (minutesByFive &gt; 59) {</span>
<a href="#l76.1446"></a><span id="l76.1446" class="difflineplus">+          if (minutesByFive &gt; 59) {</span>
<a href="#l76.1447"></a><span id="l76.1447">               minutesByFive = 55;</span>
<a href="#l76.1448"></a><span id="l76.1448" class="difflineminus">-            }</span>
<a href="#l76.1449"></a><span id="l76.1449" class="difflineminus">-            return minutesByFive;</span>
<a href="#l76.1450"></a><span id="l76.1450" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1451"></a><span id="l76.1451" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1452"></a><span id="l76.1452" class="difflineplus">+          }</span>
<a href="#l76.1453"></a><span id="l76.1453" class="difflineplus">+          return minutesByFive;</span>
<a href="#l76.1454"></a><span id="l76.1454" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1455"></a><span id="l76.1455">       &lt;/method&gt;</span>
<a href="#l76.1456"></a><span id="l76.1456"> </span>
<a href="#l76.1457"></a><span id="l76.1457">       &lt;method name=&quot;changeTo12HoursFormat&quot;&gt;</span>
<a href="#l76.1458"></a><span id="l76.1458">         &lt;parameter name=&quot;aAmLabel&quot;/&gt;</span>
<a href="#l76.1459"></a><span id="l76.1459">         &lt;parameter name=&quot;aPmLabel&quot;/&gt;</span>
<a href="#l76.1460"></a><span id="l76.1460" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1461"></a><span id="l76.1461" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1462"></a><span id="l76.1462" class="difflineminus">-            let amLabelBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;amLabelBox&quot;);</span>
<a href="#l76.1463"></a><span id="l76.1463" class="difflineminus">-            amLabelBox.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l76.1464"></a><span id="l76.1464" class="difflineminus">-            amLabelBox.firstChild.setAttribute(&quot;value&quot;, aAmLabel);</span>
<a href="#l76.1465"></a><span id="l76.1465" class="difflineminus">-            let pmLabelBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;pmLabelBox&quot;);</span>
<a href="#l76.1466"></a><span id="l76.1466" class="difflineminus">-            pmLabelBox.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l76.1467"></a><span id="l76.1467" class="difflineminus">-            pmLabelBox.firstChild.setAttribute(&quot;value&quot;, aPmLabel);</span>
<a href="#l76.1468"></a><span id="l76.1468" class="difflineminus">-            document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-hour-box-0&quot;)</span>
<a href="#l76.1469"></a><span id="l76.1469" class="difflineminus">-                    .setAttribute(&quot;label&quot;, &quot;12&quot;);</span>
<a href="#l76.1470"></a><span id="l76.1470" class="difflineminus">-            for (let i = 13; i &lt; 24; i++) {</span>
<a href="#l76.1471"></a><span id="l76.1471" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1472"></a><span id="l76.1472" class="difflineplus">+          let amLabelBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;amLabelBox&quot;);</span>
<a href="#l76.1473"></a><span id="l76.1473" class="difflineplus">+          amLabelBox.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l76.1474"></a><span id="l76.1474" class="difflineplus">+          amLabelBox.firstChild.setAttribute(&quot;value&quot;, aAmLabel);</span>
<a href="#l76.1475"></a><span id="l76.1475" class="difflineplus">+          let pmLabelBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;pmLabelBox&quot;);</span>
<a href="#l76.1476"></a><span id="l76.1476" class="difflineplus">+          pmLabelBox.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l76.1477"></a><span id="l76.1477" class="difflineplus">+          pmLabelBox.firstChild.setAttribute(&quot;value&quot;, aPmLabel);</span>
<a href="#l76.1478"></a><span id="l76.1478" class="difflineplus">+          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-hour-box-0&quot;)</span>
<a href="#l76.1479"></a><span id="l76.1479" class="difflineplus">+                  .setAttribute(&quot;label&quot;, &quot;12&quot;);</span>
<a href="#l76.1480"></a><span id="l76.1480" class="difflineplus">+          for (let i = 13; i &lt; 24; i++) {</span>
<a href="#l76.1481"></a><span id="l76.1481">               document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-hour-box-&quot; + i)</span>
<a href="#l76.1482"></a><span id="l76.1482">                       .setAttribute(&quot;label&quot;, i - 12);</span>
<a href="#l76.1483"></a><span id="l76.1483" class="difflineminus">-            }</span>
<a href="#l76.1484"></a><span id="l76.1484" class="difflineminus">-            document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-hour-grid&quot;)</span>
<a href="#l76.1485"></a><span id="l76.1485" class="difflineminus">-                    .setAttribute(&quot;format12hours&quot;, &quot;true&quot;);</span>
<a href="#l76.1486"></a><span id="l76.1486" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1487"></a><span id="l76.1487" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1488"></a><span id="l76.1488" class="difflineplus">+          }</span>
<a href="#l76.1489"></a><span id="l76.1489" class="difflineplus">+          document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker-hour-grid&quot;)</span>
<a href="#l76.1490"></a><span id="l76.1490" class="difflineplus">+                  .setAttribute(&quot;format12hours&quot;, &quot;true&quot;);</span>
<a href="#l76.1491"></a><span id="l76.1491" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1492"></a><span id="l76.1492">       &lt;/method&gt;</span>
<a href="#l76.1493"></a><span id="l76.1493">     &lt;/implementation&gt;</span>
<a href="#l76.1494"></a><span id="l76.1494"> </span>
<a href="#l76.1495"></a><span id="l76.1495" class="difflineminus">-    &lt;!-- ::::::::::::::::: HANDLERS ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.1496"></a><span id="l76.1496" class="difflineminus">-</span>
<a href="#l76.1497"></a><span id="l76.1497">     &lt;handlers&gt;</span>
<a href="#l76.1498"></a><span id="l76.1498">       &lt;handler event=&quot;bindingattached&quot; action=&quot;this.initialize();&quot;/&gt;</span>
<a href="#l76.1499"></a><span id="l76.1499">     &lt;/handlers&gt;</span>
<a href="#l76.1500"></a><span id="l76.1500" class="difflineminus">-</span>
<a href="#l76.1501"></a><span id="l76.1501">   &lt;/binding&gt;</span>
<a href="#l76.1502"></a><span id="l76.1502"> </span>
<a href="#l76.1503"></a><span id="l76.1503">   &lt;binding id=&quot;datetimepicker&quot; extends=&quot;chrome://calendar/content/datetimepickers/datetimepickers.xml#datetimepicker-base&quot;</span>
<a href="#l76.1504"></a><span id="l76.1504">            inherits=&quot;value,onchange,disabled,datepickerdisabled,timepickerdisabled&quot;&gt;</span>
<a href="#l76.1505"></a><span id="l76.1505" class="difflineminus">-    &lt;!-- ::::::::::::::::: CONTENT ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.1506"></a><span id="l76.1506">     &lt;!-- onchange was simply &quot;onDatePick()&quot; in Moz1.6, but stopped working in Moz1.7</span>
<a href="#l76.1507"></a><span id="l76.1507">          so had to add navigation by parents. --&gt;</span>
<a href="#l76.1508"></a><span id="l76.1508">     &lt;content&gt;</span>
<a href="#l76.1509"></a><span id="l76.1509">       &lt;xul:hbox flex=&quot;1&quot; anonid=&quot;hbox&quot;&gt;</span>
<a href="#l76.1510"></a><span id="l76.1510">         &lt;xul:datepicker anonid=&quot;date-picker&quot;</span>
<a href="#l76.1511"></a><span id="l76.1511">                         onchange=&quot;this.parentNode.parentNode.onDatePick();&quot;</span>
<a href="#l76.1512"></a><span id="l76.1512">                         xbl:inherits=&quot;value,disabled,disabled=datepickerdisabled&quot;/&gt;</span>
<a href="#l76.1513"></a><span id="l76.1513">         &lt;xul:timepicker anonid=&quot;time-picker&quot;</span>
<a href="#l76.1514"></a><span id="l76.1514">                         onchange=&quot;this.parentNode.parentNode.onTimePick();&quot;</span>
<a href="#l76.1515"></a><span id="l76.1515">                         xbl:inherits=&quot;value,disabled,disabled=timepickerdisabled&quot;/&gt;</span>
<a href="#l76.1516"></a><span id="l76.1516">       &lt;/xul:hbox&gt;</span>
<a href="#l76.1517"></a><span id="l76.1517">     &lt;/content&gt;</span>
<a href="#l76.1518"></a><span id="l76.1518"> </span>
<a href="#l76.1519"></a><span id="l76.1519" class="difflineminus">-    &lt;!-- ::::::::::::::::: INTERFACE ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.1520"></a><span id="l76.1520">     &lt;implementation&gt;</span>
<a href="#l76.1521"></a><span id="l76.1521">       &lt;property name=&quot;datepickerdisabled&quot;</span>
<a href="#l76.1522"></a><span id="l76.1522">                 onset=&quot;if (val) this.kDatePicker.setAttribute('disabled', 'true');</span>
<a href="#l76.1523"></a><span id="l76.1523">                        else this.kDatePicker.removeAttribute('disabled');&quot;</span>
<a href="#l76.1524"></a><span id="l76.1524">                 onget=&quot;return this.kDatePicker.getAttribute('disabled')=='true';&quot;/&gt;</span>
<a href="#l76.1525"></a><span id="l76.1525"> </span>
<a href="#l76.1526"></a><span id="l76.1526">       &lt;!-- timepicker may be disabled alone for all day events --&gt;</span>
<a href="#l76.1527"></a><span id="l76.1527">       &lt;property name=&quot;timepickerdisabled&quot;</span>
<a href="#l76.1528"></a><span id="l76.1528">                 onset=&quot;if (val) this.kTimePicker.setAttribute('disabled', 'true');</span>
<a href="#l76.1529"></a><span id="l76.1529">                        else this.kTimePicker.removeAttribute('disabled');&quot;</span>
<a href="#l76.1530"></a><span id="l76.1530">                 onget=&quot;return this.kTimePicker.getAttribute('disabled')=='true';&quot;/&gt;</span>
<a href="#l76.1531"></a><span id="l76.1531"> </span>
<a href="#l76.1532"></a><span id="l76.1532" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l76.1533"></a><span id="l76.1533" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.1534"></a><span id="l76.1534" class="difflineminus">-          this.kDatePicker =</span>
<a href="#l76.1535"></a><span id="l76.1535" class="difflineminus">-      document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-picker&quot;);</span>
<a href="#l76.1536"></a><span id="l76.1536" class="difflineminus">-          this.kTimePicker =</span>
<a href="#l76.1537"></a><span id="l76.1537" class="difflineminus">-      document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker&quot;);</span>
<a href="#l76.1538"></a><span id="l76.1538" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l76.1539"></a><span id="l76.1539" class="difflineplus">+        this.kDatePicker =</span>
<a href="#l76.1540"></a><span id="l76.1540" class="difflineplus">+            document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;date-picker&quot;);</span>
<a href="#l76.1541"></a><span id="l76.1541" class="difflineplus">+        this.kTimePicker =</span>
<a href="#l76.1542"></a><span id="l76.1542" class="difflineplus">+            document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;time-picker&quot;);</span>
<a href="#l76.1543"></a><span id="l76.1543"> </span>
<a href="#l76.1544"></a><span id="l76.1544" class="difflineminus">-          let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l76.1545"></a><span id="l76.1545" class="difflineminus">-          this.mValue = (val ? new Date(val)</span>
<a href="#l76.1546"></a><span id="l76.1546" class="difflineminus">-                             : new Date());</span>
<a href="#l76.1547"></a><span id="l76.1547" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.1548"></a><span id="l76.1548" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l76.1549"></a><span id="l76.1549" class="difflineplus">+        let val = this.getAttribute(&quot;value&quot;);</span>
<a href="#l76.1550"></a><span id="l76.1550" class="difflineplus">+        this.mValue = (val ? new Date(val)</span>
<a href="#l76.1551"></a><span id="l76.1551" class="difflineplus">+                           : new Date());</span>
<a href="#l76.1552"></a><span id="l76.1552" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l76.1553"></a><span id="l76.1553"> </span>
<a href="#l76.1554"></a><span id="l76.1554">       &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l76.1555"></a><span id="l76.1555">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.1556"></a><span id="l76.1556">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l76.1557"></a><span id="l76.1557" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1558"></a><span id="l76.1558" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1559"></a><span id="l76.1559" class="difflineminus">-            if (aValue != null) {</span>
<a href="#l76.1560"></a><span id="l76.1560" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1561"></a><span id="l76.1561" class="difflineplus">+          if (aValue != null) {</span>
<a href="#l76.1562"></a><span id="l76.1562">               this.mValue = aValue;</span>
<a href="#l76.1563"></a><span id="l76.1563" class="difflineminus">-            }</span>
<a href="#l76.1564"></a><span id="l76.1564" class="difflineminus">-            // set textBox.value property, not attribute</span>
<a href="#l76.1565"></a><span id="l76.1565" class="difflineminus">-            this.kDatePicker.update(this.mValue, aRefresh);</span>
<a href="#l76.1566"></a><span id="l76.1566" class="difflineminus">-            this.kTimePicker.update(this.mValue, aRefresh);</span>
<a href="#l76.1567"></a><span id="l76.1567" class="difflineminus">-            if (aRefresh) {</span>
<a href="#l76.1568"></a><span id="l76.1568" class="difflineplus">+          }</span>
<a href="#l76.1569"></a><span id="l76.1569" class="difflineplus">+          // set textBox.value property, not attribute</span>
<a href="#l76.1570"></a><span id="l76.1570" class="difflineplus">+          this.kDatePicker.update(this.mValue, aRefresh);</span>
<a href="#l76.1571"></a><span id="l76.1571" class="difflineplus">+          this.kTimePicker.update(this.mValue, aRefresh);</span>
<a href="#l76.1572"></a><span id="l76.1572" class="difflineplus">+          if (aRefresh) {</span>
<a href="#l76.1573"></a><span id="l76.1573">               this.fireEvent(&quot;change&quot;);</span>
<a href="#l76.1574"></a><span id="l76.1574" class="difflineminus">-            }</span>
<a href="#l76.1575"></a><span id="l76.1575" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1576"></a><span id="l76.1576" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1577"></a><span id="l76.1577" class="difflineplus">+          }</span>
<a href="#l76.1578"></a><span id="l76.1578" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1579"></a><span id="l76.1579">       &lt;/method&gt;</span>
<a href="#l76.1580"></a><span id="l76.1580"> </span>
<a href="#l76.1581"></a><span id="l76.1581">       &lt;!-- Date was changed by gui: update value. --&gt;</span>
<a href="#l76.1582"></a><span id="l76.1582">       &lt;method name=&quot;onDatePick&quot;&gt;</span>
<a href="#l76.1583"></a><span id="l76.1583" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1584"></a><span id="l76.1584" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1585"></a><span id="l76.1585" class="difflineminus">-            let tempTime;</span>
<a href="#l76.1586"></a><span id="l76.1586" class="difflineminus">-            if (this.kDatePicker.lastDateParseIncludedTime) {</span>
<a href="#l76.1587"></a><span id="l76.1587" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1588"></a><span id="l76.1588" class="difflineplus">+          let tempTime;</span>
<a href="#l76.1589"></a><span id="l76.1589" class="difflineplus">+          if (this.kDatePicker.lastDateParseIncludedTime) {</span>
<a href="#l76.1590"></a><span id="l76.1590">               tempTime = new Date(this.kDatePicker.value);</span>
<a href="#l76.1591"></a><span id="l76.1591" class="difflineminus">-            } else {</span>
<a href="#l76.1592"></a><span id="l76.1592" class="difflineplus">+          } else {</span>
<a href="#l76.1593"></a><span id="l76.1593">               tempTime = new Date(this.mValue);</span>
<a href="#l76.1594"></a><span id="l76.1594" class="difflineminus">-            }</span>
<a href="#l76.1595"></a><span id="l76.1595" class="difflineminus">-            let newDate = new Date(this.kDatePicker.value);</span>
<a href="#l76.1596"></a><span id="l76.1596" class="difflineminus">-            // Note: create new date because setting month and date of month in</span>
<a href="#l76.1597"></a><span id="l76.1597" class="difflineminus">-            // either order can lead to unexpected results (month may be advanced</span>
<a href="#l76.1598"></a><span id="l76.1598" class="difflineminus">-            // automatically if day of month is temporarily out of range).</span>
<a href="#l76.1599"></a><span id="l76.1599" class="difflineminus">-            let dateTime = new Date(newDate.getFullYear(),</span>
<a href="#l76.1600"></a><span id="l76.1600" class="difflineminus">-                                    newDate.getMonth(),</span>
<a href="#l76.1601"></a><span id="l76.1601" class="difflineminus">-                                    newDate.getDate(),</span>
<a href="#l76.1602"></a><span id="l76.1602" class="difflineminus">-                                    tempTime.getHours(),</span>
<a href="#l76.1603"></a><span id="l76.1603" class="difflineminus">-                                    tempTime.getMinutes(),</span>
<a href="#l76.1604"></a><span id="l76.1604" class="difflineminus">-                                    tempTime.getSeconds());</span>
<a href="#l76.1605"></a><span id="l76.1605" class="difflineminus">-            this.mValue = dateTime;</span>
<a href="#l76.1606"></a><span id="l76.1606" class="difflineminus">-            this.kTimePicker.update(dateTime, false);</span>
<a href="#l76.1607"></a><span id="l76.1607" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1608"></a><span id="l76.1608" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1609"></a><span id="l76.1609" class="difflineplus">+          }</span>
<a href="#l76.1610"></a><span id="l76.1610" class="difflineplus">+          let newDate = new Date(this.kDatePicker.value);</span>
<a href="#l76.1611"></a><span id="l76.1611" class="difflineplus">+          // Note: create new date because setting month and date of month in</span>
<a href="#l76.1612"></a><span id="l76.1612" class="difflineplus">+          // either order can lead to unexpected results (month may be advanced</span>
<a href="#l76.1613"></a><span id="l76.1613" class="difflineplus">+          // automatically if day of month is temporarily out of range).</span>
<a href="#l76.1614"></a><span id="l76.1614" class="difflineplus">+          let dateTime = new Date(newDate.getFullYear(),</span>
<a href="#l76.1615"></a><span id="l76.1615" class="difflineplus">+                                  newDate.getMonth(),</span>
<a href="#l76.1616"></a><span id="l76.1616" class="difflineplus">+                                  newDate.getDate(),</span>
<a href="#l76.1617"></a><span id="l76.1617" class="difflineplus">+                                  tempTime.getHours(),</span>
<a href="#l76.1618"></a><span id="l76.1618" class="difflineplus">+                                  tempTime.getMinutes(),</span>
<a href="#l76.1619"></a><span id="l76.1619" class="difflineplus">+                                  tempTime.getSeconds());</span>
<a href="#l76.1620"></a><span id="l76.1620" class="difflineplus">+          this.mValue = dateTime;</span>
<a href="#l76.1621"></a><span id="l76.1621" class="difflineplus">+          this.kTimePicker.update(dateTime, false);</span>
<a href="#l76.1622"></a><span id="l76.1622" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1623"></a><span id="l76.1623">       &lt;/method&gt;</span>
<a href="#l76.1624"></a><span id="l76.1624"> </span>
<a href="#l76.1625"></a><span id="l76.1625">       &lt;!-- Time was changed by gui: update value --&gt;</span>
<a href="#l76.1626"></a><span id="l76.1626">       &lt;method name=&quot;onTimePick&quot;&gt;</span>
<a href="#l76.1627"></a><span id="l76.1627" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1628"></a><span id="l76.1628" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1629"></a><span id="l76.1629" class="difflineminus">-            let dateTime = new Date(this.mValue);</span>
<a href="#l76.1630"></a><span id="l76.1630" class="difflineminus">-            let newTime = this.kTimePicker.value;</span>
<a href="#l76.1631"></a><span id="l76.1631" class="difflineminus">-            dateTime.setHours(newTime.getHours());</span>
<a href="#l76.1632"></a><span id="l76.1632" class="difflineminus">-            dateTime.setMinutes(newTime.getMinutes());</span>
<a href="#l76.1633"></a><span id="l76.1633" class="difflineminus">-            dateTime.setSeconds(newTime.getSeconds());</span>
<a href="#l76.1634"></a><span id="l76.1634" class="difflineminus">-            this.mValue = dateTime;</span>
<a href="#l76.1635"></a><span id="l76.1635" class="difflineminus">-            this.kDatePicker.update(dateTime, false);</span>
<a href="#l76.1636"></a><span id="l76.1636" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1637"></a><span id="l76.1637" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1638"></a><span id="l76.1638" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1639"></a><span id="l76.1639" class="difflineplus">+          let dateTime = new Date(this.mValue);</span>
<a href="#l76.1640"></a><span id="l76.1640" class="difflineplus">+          let newTime = this.kTimePicker.value;</span>
<a href="#l76.1641"></a><span id="l76.1641" class="difflineplus">+          dateTime.setHours(newTime.getHours());</span>
<a href="#l76.1642"></a><span id="l76.1642" class="difflineplus">+          dateTime.setMinutes(newTime.getMinutes());</span>
<a href="#l76.1643"></a><span id="l76.1643" class="difflineplus">+          dateTime.setSeconds(newTime.getSeconds());</span>
<a href="#l76.1644"></a><span id="l76.1644" class="difflineplus">+          this.mValue = dateTime;</span>
<a href="#l76.1645"></a><span id="l76.1645" class="difflineplus">+          this.kDatePicker.update(dateTime, false);</span>
<a href="#l76.1646"></a><span id="l76.1646" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1647"></a><span id="l76.1647">       &lt;/method&gt;</span>
<a href="#l76.1648"></a><span id="l76.1648" class="difflineminus">-</span>
<a href="#l76.1649"></a><span id="l76.1649">     &lt;/implementation&gt;</span>
<a href="#l76.1650"></a><span id="l76.1650"> </span>
<a href="#l76.1651"></a><span id="l76.1651" class="difflineminus">-    &lt;!-- ::::::::::::::::: HANDLERS ::::::::::::::::::::::::: --&gt;</span>
<a href="#l76.1652"></a><span id="l76.1652" class="difflineminus">-</span>
<a href="#l76.1653"></a><span id="l76.1653">     &lt;handlers&gt;</span>
<a href="#l76.1654"></a><span id="l76.1654">       &lt;handler event=&quot;bindingattached&quot; action=&quot;this.initialize();&quot;/&gt;</span>
<a href="#l76.1655"></a><span id="l76.1655">     &lt;/handlers&gt;</span>
<a href="#l76.1656"></a><span id="l76.1656"> </span>
<a href="#l76.1657"></a><span id="l76.1657">   &lt;/binding&gt;</span>
<a href="#l76.1658"></a><span id="l76.1658"> </span>
<a href="#l76.1659"></a><span id="l76.1659">   &lt;binding id=&quot;datetimepicker-base&quot; extends=&quot;chrome://global/content/bindings/general.xml#basecontrol&quot;</span>
<a href="#l76.1660"></a><span id="l76.1660">            inherits=&quot;value,onchange&quot;&gt;</span>
<a href="#l76.1661"></a><span id="l76.1661">     &lt;resources&gt;</span>
<a href="#l76.1662"></a><span id="l76.1662">       &lt;stylesheet src=&quot;chrome://lightning-common/skin/datetimepickers.css&quot;/&gt;</span>
<a href="#l76.1663"></a><span id="l76.1663">     &lt;/resources&gt;</span>
<a href="#l76.1664"></a><span id="l76.1664">     &lt;implementation&gt;</span>
<a href="#l76.1665"></a><span id="l76.1665" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l76.1666"></a><span id="l76.1666" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l76.1667"></a><span id="l76.1667" class="difflineminus">-          this.initDateFormat();</span>
<a href="#l76.1668"></a><span id="l76.1668" class="difflineminus">-          this.initTimeFormat();</span>
<a href="#l76.1669"></a><span id="l76.1669" class="difflineminus">-        ]]&gt;</span>
<a href="#l76.1670"></a><span id="l76.1670" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l76.1671"></a><span id="l76.1671" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l76.1672"></a><span id="l76.1672" class="difflineplus">+        this.initDateFormat();</span>
<a href="#l76.1673"></a><span id="l76.1673" class="difflineplus">+        this.initTimeFormat();</span>
<a href="#l76.1674"></a><span id="l76.1674" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l76.1675"></a><span id="l76.1675"> </span>
<a href="#l76.1676"></a><span id="l76.1676">       &lt;property name=&quot;value&quot;</span>
<a href="#l76.1677"></a><span id="l76.1677">                 onget=&quot;return this.mValue&quot;</span>
<a href="#l76.1678"></a><span id="l76.1678">                 onset=&quot;this.update(val, false)&quot;/&gt;</span>
<a href="#l76.1679"></a><span id="l76.1679"> </span>
<a href="#l76.1680"></a><span id="l76.1680">       &lt;property name=&quot;lastDateParseIncludedTime&quot;</span>
<a href="#l76.1681"></a><span id="l76.1681">                 onget=&quot;return this.mLastDateParseIncludedTime;&quot;</span>
<a href="#l76.1682"></a><span id="l76.1682">                 onset=&quot;this.mLastDateParseIncludedTime = val;&quot; /&gt;</span>
<a href="#l76.1683"></a><span id="l76.1683"> </span>
<a href="#l76.1684"></a><span id="l76.1684">       &lt;method name=&quot;update&quot;&gt;</span>
<a href="#l76.1685"></a><span id="l76.1685">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.1686"></a><span id="l76.1686">         &lt;parameter name=&quot;aRefresh&quot;/&gt;</span>
<a href="#l76.1687"></a><span id="l76.1687" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1688"></a><span id="l76.1688" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1689"></a><span id="l76.1689" class="difflineminus">-            if (aValue != null) {</span>
<a href="#l76.1690"></a><span id="l76.1690" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1691"></a><span id="l76.1691" class="difflineplus">+          if (aValue != null) {</span>
<a href="#l76.1692"></a><span id="l76.1692">               this.mValue = aValue;</span>
<a href="#l76.1693"></a><span id="l76.1693" class="difflineminus">-            }</span>
<a href="#l76.1694"></a><span id="l76.1694" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1695"></a><span id="l76.1695" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1696"></a><span id="l76.1696" class="difflineplus">+          }</span>
<a href="#l76.1697"></a><span id="l76.1697" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1698"></a><span id="l76.1698">       &lt;/method&gt;</span>
<a href="#l76.1699"></a><span id="l76.1699"> </span>
<a href="#l76.1700"></a><span id="l76.1700">       &lt;method name=&quot;fireEvent&quot;&gt;</span>
<a href="#l76.1701"></a><span id="l76.1701">         &lt;parameter name=&quot;aEventName&quot;/&gt;</span>
<a href="#l76.1702"></a><span id="l76.1702">         &lt;parameter name=&quot;aDetail&quot;/&gt;</span>
<a href="#l76.1703"></a><span id="l76.1703" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1704"></a><span id="l76.1704" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1705"></a><span id="l76.1705" class="difflineminus">-            let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l76.1706"></a><span id="l76.1706" class="difflineminus">-            event.initEvent(aEventName, true, true);</span>
<a href="#l76.1707"></a><span id="l76.1707" class="difflineminus">-            event.detail = aDetail;</span>
<a href="#l76.1708"></a><span id="l76.1708" class="difflineminus">-            this.dispatchEvent(event);</span>
<a href="#l76.1709"></a><span id="l76.1709" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1710"></a><span id="l76.1710" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1711"></a><span id="l76.1711" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1712"></a><span id="l76.1712" class="difflineplus">+          let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l76.1713"></a><span id="l76.1713" class="difflineplus">+          event.initEvent(aEventName, true, true);</span>
<a href="#l76.1714"></a><span id="l76.1714" class="difflineplus">+          event.detail = aDetail;</span>
<a href="#l76.1715"></a><span id="l76.1715" class="difflineplus">+          this.dispatchEvent(event);</span>
<a href="#l76.1716"></a><span id="l76.1716" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1717"></a><span id="l76.1717">       &lt;/method&gt;</span>
<a href="#l76.1718"></a><span id="l76.1718"> </span>
<a href="#l76.1719"></a><span id="l76.1719">       &lt;!-- Parameter aValue may be a date or a date time. Dates are</span>
<a href="#l76.1720"></a><span id="l76.1720">            read according to locale/OS setting (d-m-y or m-d-y or ...).</span>
<a href="#l76.1721"></a><span id="l76.1721">            (see initDateFormat). Uses parseTime() for times.</span>
<a href="#l76.1722"></a><span id="l76.1722">       --&gt;</span>
<a href="#l76.1723"></a><span id="l76.1723">       &lt;method name=&quot;parseDateTime&quot;&gt;</span>
<a href="#l76.1724"></a><span id="l76.1724">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.1725"></a><span id="l76.1725" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1726"></a><span id="l76.1726" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1727"></a><span id="l76.1727" class="difflineminus">-            this.mLastDateParseIncludedTime = false;</span>
<a href="#l76.1728"></a><span id="l76.1728" class="difflineminus">-            let tempDate = null;</span>
<a href="#l76.1729"></a><span id="l76.1729" class="difflineminus">-            if (!this.probeSucceeded) {</span>
<a href="#l76.1730"></a><span id="l76.1730" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1731"></a><span id="l76.1731" class="difflineplus">+          this.mLastDateParseIncludedTime = false;</span>
<a href="#l76.1732"></a><span id="l76.1732" class="difflineplus">+          let tempDate = null;</span>
<a href="#l76.1733"></a><span id="l76.1733" class="difflineplus">+          if (!this.probeSucceeded) {</span>
<a href="#l76.1734"></a><span id="l76.1734">               return null; // avoid errors accessing uninitialized data.</span>
<a href="#l76.1735"></a><span id="l76.1735" class="difflineminus">-            }</span>
<a href="#l76.1736"></a><span id="l76.1736" class="difflineplus">+          }</span>
<a href="#l76.1737"></a><span id="l76.1737"> </span>
<a href="#l76.1738"></a><span id="l76.1738" class="difflineminus">-            let year = Number.MIN_VALUE;</span>
<a href="#l76.1739"></a><span id="l76.1739" class="difflineminus">-            let month = -1;</span>
<a href="#l76.1740"></a><span id="l76.1740" class="difflineminus">-            let day = -1;</span>
<a href="#l76.1741"></a><span id="l76.1741" class="difflineminus">-            let timeString = null;</span>
<a href="#l76.1742"></a><span id="l76.1742" class="difflineplus">+          let year = Number.MIN_VALUE;</span>
<a href="#l76.1743"></a><span id="l76.1743" class="difflineplus">+          let month = -1;</span>
<a href="#l76.1744"></a><span id="l76.1744" class="difflineplus">+          let day = -1;</span>
<a href="#l76.1745"></a><span id="l76.1745" class="difflineplus">+          let timeString = null;</span>
<a href="#l76.1746"></a><span id="l76.1746"> </span>
<a href="#l76.1747"></a><span id="l76.1747" class="difflineminus">-            if (this.alphaMonths == null) {</span>
<a href="#l76.1748"></a><span id="l76.1748" class="difflineplus">+          if (this.alphaMonths == null) {</span>
<a href="#l76.1749"></a><span id="l76.1749">               // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l76.1750"></a><span id="l76.1750">               // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l76.1751"></a><span id="l76.1751">               // which do not match \w, esp. in CJK locales.)</span>
<a href="#l76.1752"></a><span id="l76.1752">               // (.*)? binds to null if no suffix.</span>
<a href="#l76.1753"></a><span id="l76.1753">               let parseNumShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)(.*)?$/;</span>
<a href="#l76.1754"></a><span id="l76.1754">               let dateNumbersArray = parseNumShortDateRegex.exec(aValue);</span>
<a href="#l76.1755"></a><span id="l76.1755">               if (dateNumbersArray != null) {</span>
<a href="#l76.1756"></a><span id="l76.1756" class="difflineminus">-                year = Number(dateNumbersArray[this.yearIndex]);</span>
<a href="#l76.1757"></a><span id="l76.1757" class="difflineminus">-                month = Number(dateNumbersArray[this.monthIndex]) - 1; // 0-based</span>
<a href="#l76.1758"></a><span id="l76.1758" class="difflineminus">-                day = Number(dateNumbersArray[this.dayIndex]);</span>
<a href="#l76.1759"></a><span id="l76.1759" class="difflineminus">-                timeString = dateNumbersArray[4];</span>
<a href="#l76.1760"></a><span id="l76.1760" class="difflineplus">+                  year = Number(dateNumbersArray[this.yearIndex]);</span>
<a href="#l76.1761"></a><span id="l76.1761" class="difflineplus">+                  month = Number(dateNumbersArray[this.monthIndex]) - 1; // 0-based</span>
<a href="#l76.1762"></a><span id="l76.1762" class="difflineplus">+                  day = Number(dateNumbersArray[this.dayIndex]);</span>
<a href="#l76.1763"></a><span id="l76.1763" class="difflineplus">+                  timeString = dateNumbersArray[4];</span>
<a href="#l76.1764"></a><span id="l76.1764">               }</span>
<a href="#l76.1765"></a><span id="l76.1765" class="difflineminus">-            } else {</span>
<a href="#l76.1766"></a><span id="l76.1766" class="difflineplus">+          } else {</span>
<a href="#l76.1767"></a><span id="l76.1767">               // SHORT DATE WITH ALPHABETIC MONTH, such as &quot;dd MMM yy&quot; or &quot;MMMM dd, yyyy&quot;</span>
<a href="#l76.1768"></a><span id="l76.1768">               // (\d+|[^\d\W]) is digits or letters, not both together.</span>
<a href="#l76.1769"></a><span id="l76.1769">               // Allows 31dec1999 (no delimiters between parts) if OS does (w2k does not).</span>
<a href="#l76.1770"></a><span id="l76.1770">               // Allows Dec 31, 1999 (comma and space between parts)</span>
<a href="#l76.1771"></a><span id="l76.1771">               // (Only accepts ASCII month names; JavaScript RegExp does not have an</span>
<a href="#l76.1772"></a><span id="l76.1772">               // easy way to describe unicode letters short of a HUGE character range</span>
<a href="#l76.1773"></a><span id="l76.1773">               // regexp derived from the Alphabetic ranges in</span>
<a href="#l76.1774"></a><span id="l76.1774">               // http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt)</span>
<a href="#l76.1775"></a><span id="l76.1775">               // (.*)? binds to null if no suffix.</span>
<a href="#l76.1776"></a><span id="l76.1776">               let parseAlphShortDateRegex = /^\s*(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)(.*)?$/;</span>
<a href="#l76.1777"></a><span id="l76.1777">               let datePartsArray = parseAlphShortDateRegex.exec(aValue);</span>
<a href="#l76.1778"></a><span id="l76.1778">               if (datePartsArray != null) {</span>
<a href="#l76.1779"></a><span id="l76.1779" class="difflineminus">-                year = Number(datePartsArray[this.yearIndex]);</span>
<a href="#l76.1780"></a><span id="l76.1780" class="difflineminus">-                let monthString = datePartsArray[this.monthIndex].toUpperCase();</span>
<a href="#l76.1781"></a><span id="l76.1781" class="difflineminus">-                for (let monthIdx = 0; monthIdx &lt; this.alphaMonths.length; monthIdx++) {</span>
<a href="#l76.1782"></a><span id="l76.1782" class="difflineminus">-                  if (monthString == this.alphaMonths[monthIdx]) {</span>
<a href="#l76.1783"></a><span id="l76.1783" class="difflineminus">-                    month = monthIdx;</span>
<a href="#l76.1784"></a><span id="l76.1784" class="difflineminus">-                    break;</span>
<a href="#l76.1785"></a><span id="l76.1785" class="difflineplus">+                  year = Number(datePartsArray[this.yearIndex]);</span>
<a href="#l76.1786"></a><span id="l76.1786" class="difflineplus">+                  let monthString = datePartsArray[this.monthIndex].toUpperCase();</span>
<a href="#l76.1787"></a><span id="l76.1787" class="difflineplus">+                  for (let monthIdx = 0; monthIdx &lt; this.alphaMonths.length; monthIdx++) {</span>
<a href="#l76.1788"></a><span id="l76.1788" class="difflineplus">+                      if (monthString == this.alphaMonths[monthIdx]) {</span>
<a href="#l76.1789"></a><span id="l76.1789" class="difflineplus">+                          month = monthIdx;</span>
<a href="#l76.1790"></a><span id="l76.1790" class="difflineplus">+                          break;</span>
<a href="#l76.1791"></a><span id="l76.1791" class="difflineplus">+                      }</span>
<a href="#l76.1792"></a><span id="l76.1792">                   }</span>
<a href="#l76.1793"></a><span id="l76.1793" class="difflineminus">-                }</span>
<a href="#l76.1794"></a><span id="l76.1794" class="difflineminus">-                day = Number(datePartsArray[this.dayIndex]);</span>
<a href="#l76.1795"></a><span id="l76.1795" class="difflineminus">-                timeString = datePartsArray[4];</span>
<a href="#l76.1796"></a><span id="l76.1796" class="difflineplus">+                  day = Number(datePartsArray[this.dayIndex]);</span>
<a href="#l76.1797"></a><span id="l76.1797" class="difflineplus">+                  timeString = datePartsArray[4];</span>
<a href="#l76.1798"></a><span id="l76.1798">               }</span>
<a href="#l76.1799"></a><span id="l76.1799" class="difflineminus">-            }</span>
<a href="#l76.1800"></a><span id="l76.1800" class="difflineminus">-            if (year != Number.MIN_VALUE &amp;&amp; month != -1 &amp;&amp; day != -1) {</span>
<a href="#l76.1801"></a><span id="l76.1801" class="difflineplus">+          }</span>
<a href="#l76.1802"></a><span id="l76.1802" class="difflineplus">+          if (year != Number.MIN_VALUE &amp;&amp; month != -1 &amp;&amp; day != -1) {</span>
<a href="#l76.1803"></a><span id="l76.1803">               // year, month, day successfully parsed</span>
<a href="#l76.1804"></a><span id="l76.1804">               if (year &gt;= 0 &amp;&amp; year &lt; 100) {</span>
<a href="#l76.1805"></a><span id="l76.1805" class="difflineminus">-                // If 0 &lt;= year &lt; 100, treat as 2-digit year (like formatDate):</span>
<a href="#l76.1806"></a><span id="l76.1806" class="difflineminus">-                //   parse year as up to 30 years in future or 69 years in past.</span>
<a href="#l76.1807"></a><span id="l76.1807" class="difflineminus">-                //   (Covers 30-year mortgage and most working people's birthdate.)</span>
<a href="#l76.1808"></a><span id="l76.1808" class="difflineminus">-                // otherwise will be treated as four digit year.</span>
<a href="#l76.1809"></a><span id="l76.1809" class="difflineminus">-                let currentYear = new Date().getFullYear();</span>
<a href="#l76.1810"></a><span id="l76.1810" class="difflineminus">-                let currentCentury = currentYear - currentYear % 100;</span>
<a href="#l76.1811"></a><span id="l76.1811" class="difflineminus">-                year = currentCentury + year;</span>
<a href="#l76.1812"></a><span id="l76.1812" class="difflineminus">-                if (year &lt; currentYear - 69) {</span>
<a href="#l76.1813"></a><span id="l76.1813" class="difflineminus">-                  year += 100;</span>
<a href="#l76.1814"></a><span id="l76.1814" class="difflineminus">-                }</span>
<a href="#l76.1815"></a><span id="l76.1815" class="difflineminus">-                if (year &gt; currentYear + 30) {</span>
<a href="#l76.1816"></a><span id="l76.1816" class="difflineminus">-                  year -= 100;</span>
<a href="#l76.1817"></a><span id="l76.1817" class="difflineminus">-                }</span>
<a href="#l76.1818"></a><span id="l76.1818" class="difflineplus">+                  // If 0 &lt;= year &lt; 100, treat as 2-digit year (like formatDate):</span>
<a href="#l76.1819"></a><span id="l76.1819" class="difflineplus">+                  //   parse year as up to 30 years in future or 69 years in past.</span>
<a href="#l76.1820"></a><span id="l76.1820" class="difflineplus">+                  //   (Covers 30-year mortgage and most working people's birthdate.)</span>
<a href="#l76.1821"></a><span id="l76.1821" class="difflineplus">+                  // otherwise will be treated as four digit year.</span>
<a href="#l76.1822"></a><span id="l76.1822" class="difflineplus">+                  let currentYear = new Date().getFullYear();</span>
<a href="#l76.1823"></a><span id="l76.1823" class="difflineplus">+                  let currentCentury = currentYear - currentYear % 100;</span>
<a href="#l76.1824"></a><span id="l76.1824" class="difflineplus">+                  year = currentCentury + year;</span>
<a href="#l76.1825"></a><span id="l76.1825" class="difflineplus">+                  if (year &lt; currentYear - 69) {</span>
<a href="#l76.1826"></a><span id="l76.1826" class="difflineplus">+                      year += 100;</span>
<a href="#l76.1827"></a><span id="l76.1827" class="difflineplus">+                  }</span>
<a href="#l76.1828"></a><span id="l76.1828" class="difflineplus">+                  if (year &gt; currentYear + 30) {</span>
<a href="#l76.1829"></a><span id="l76.1829" class="difflineplus">+                      year -= 100;</span>
<a href="#l76.1830"></a><span id="l76.1830" class="difflineplus">+                  }</span>
<a href="#l76.1831"></a><span id="l76.1831">               }</span>
<a href="#l76.1832"></a><span id="l76.1832">               // if time is also present, parse it</span>
<a href="#l76.1833"></a><span id="l76.1833">               let hours = 0;</span>
<a href="#l76.1834"></a><span id="l76.1834">               let minutes = 0;</span>
<a href="#l76.1835"></a><span id="l76.1835">               let seconds = 0;</span>
<a href="#l76.1836"></a><span id="l76.1836">               if (timeString != null) {</span>
<a href="#l76.1837"></a><span id="l76.1837" class="difflineminus">-                let time = this.parseTime(timeString);</span>
<a href="#l76.1838"></a><span id="l76.1838" class="difflineminus">-                if (time != null) {</span>
<a href="#l76.1839"></a><span id="l76.1839" class="difflineminus">-                  hours = time.getHours();</span>
<a href="#l76.1840"></a><span id="l76.1840" class="difflineminus">-                  minutes = time.getMinutes();</span>
<a href="#l76.1841"></a><span id="l76.1841" class="difflineminus">-                  seconds = time.getSeconds();</span>
<a href="#l76.1842"></a><span id="l76.1842" class="difflineminus">-                  this.mLastDateParseIncludedTime = true;</span>
<a href="#l76.1843"></a><span id="l76.1843" class="difflineminus">-                }</span>
<a href="#l76.1844"></a><span id="l76.1844" class="difflineplus">+                  let time = this.parseTime(timeString);</span>
<a href="#l76.1845"></a><span id="l76.1845" class="difflineplus">+                  if (time != null) {</span>
<a href="#l76.1846"></a><span id="l76.1846" class="difflineplus">+                      hours = time.getHours();</span>
<a href="#l76.1847"></a><span id="l76.1847" class="difflineplus">+                      minutes = time.getMinutes();</span>
<a href="#l76.1848"></a><span id="l76.1848" class="difflineplus">+                      seconds = time.getSeconds();</span>
<a href="#l76.1849"></a><span id="l76.1849" class="difflineplus">+                      this.mLastDateParseIncludedTime = true;</span>
<a href="#l76.1850"></a><span id="l76.1850" class="difflineplus">+                  }</span>
<a href="#l76.1851"></a><span id="l76.1851">               }</span>
<a href="#l76.1852"></a><span id="l76.1852">               tempDate = new Date(year, month, day, hours, minutes, seconds, 0);</span>
<a href="#l76.1853"></a><span id="l76.1853" class="difflineminus">-            } // else did not match regex, not a valid date</span>
<a href="#l76.1854"></a><span id="l76.1854" class="difflineminus">-            return tempDate;</span>
<a href="#l76.1855"></a><span id="l76.1855" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1856"></a><span id="l76.1856" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1857"></a><span id="l76.1857" class="difflineplus">+          } // else did not match regex, not a valid date</span>
<a href="#l76.1858"></a><span id="l76.1858" class="difflineplus">+          return tempDate;</span>
<a href="#l76.1859"></a><span id="l76.1859" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1860"></a><span id="l76.1860">       &lt;/method&gt;</span>
<a href="#l76.1861"></a><span id="l76.1861"> </span>
<a href="#l76.1862"></a><span id="l76.1862">       &lt;!-- Parse a variety of time formats so that cut and paste is likely to work.</span>
<a href="#l76.1863"></a><span id="l76.1863">            separator:            ':'         '.'        ' '        symbol        none</span>
<a href="#l76.1864"></a><span id="l76.1864">                                  &quot;12:34:56&quot;  &quot;12.34.56&quot; &quot;12 34 56&quot; &quot;12h34m56s&quot;   &quot;123456&quot;</span>
<a href="#l76.1865"></a><span id="l76.1865">            seconds optional:     &quot;02:34&quot;     &quot;02.34&quot;    &quot;02 34&quot;    &quot;02h34m&quot;      &quot;0234&quot;</span>
<a href="#l76.1866"></a><span id="l76.1866">            minutes optional:     &quot;12&quot;        &quot;12&quot;       &quot;12&quot;       &quot;12h&quot;         &quot;12&quot;</span>
<a href="#l76.1867"></a><span id="l76.1867">            1st hr digit optional:&quot;9:34&quot;      &quot; 9.34&quot;     &quot;9 34&quot;     &quot;9H34M&quot;       &quot;934am&quot;</span>
<a href="#l76.1868"></a><span id="l76.1868" class="difflineat">@@ -1693,318 +1580,304 @@</span>
<a href="#l76.1869"></a><span id="l76.1869">            am/pm prefix          &quot;a.m. 02:34&quot;&quot;pm02.34&quot;  &quot;A M 02 34&quot; &quot;P.M. 02H34M&quot; &quot;pm0234&quot;</span>
<a href="#l76.1870"></a><span id="l76.1870">            am/pm cyrillic        &quot;02:34\u0430.\u043c.&quot;  &quot;02 34 \u0420 \u041c&quot;</span>
<a href="#l76.1871"></a><span id="l76.1871">            am/pm arabic          &quot;\u063502:34&quot; (RTL 02:34a) &quot;\u0645 02.34&quot; (RTL 02.34 p)</span>
<a href="#l76.1872"></a><span id="l76.1872">            above/below noon      &quot;\u4e0a\u534802:34&quot;    &quot;\u4e0b\u5348 02 34&quot;</span>
<a href="#l76.1873"></a><span id="l76.1873">            noon before/after     &quot;\u5348\u524d02:34&quot;    &quot;\u5348\u5f8c 02 34&quot;</span>
<a href="#l76.1874"></a><span id="l76.1874">       --&gt;</span>
<a href="#l76.1875"></a><span id="l76.1875">       &lt;method name=&quot;parseTime&quot;&gt;</span>
<a href="#l76.1876"></a><span id="l76.1876">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.1877"></a><span id="l76.1877" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.1878"></a><span id="l76.1878" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.1879"></a><span id="l76.1879" class="difflineminus">-            try {</span>
<a href="#l76.1880"></a><span id="l76.1880" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.1881"></a><span id="l76.1881" class="difflineplus">+          try {</span>
<a href="#l76.1882"></a><span id="l76.1882">               let noon = calGetString(&quot;dateFormat&quot;, &quot;noon&quot;);</span>
<a href="#l76.1883"></a><span id="l76.1883">               if (aValue.toLowerCase() == noon.toLowerCase()) {</span>
<a href="#l76.1884"></a><span id="l76.1884" class="difflineminus">-                return new Date(0, 0, 0, 12, 0, 0, 0);</span>
<a href="#l76.1885"></a><span id="l76.1885" class="difflineplus">+                  return new Date(0, 0, 0, 12, 0, 0, 0);</span>
<a href="#l76.1886"></a><span id="l76.1886">               }</span>
<a href="#l76.1887"></a><span id="l76.1887"> </span>
<a href="#l76.1888"></a><span id="l76.1888">               let midnight = calGetString(&quot;dateFormat&quot;, &quot;midnight&quot;);</span>
<a href="#l76.1889"></a><span id="l76.1889">               if (aValue.toLowerCase() == midnight.toLowerCase()) {</span>
<a href="#l76.1890"></a><span id="l76.1890" class="difflineminus">-                return new Date(0, 0, 0, 0, 0, 0, 0);</span>
<a href="#l76.1891"></a><span id="l76.1891" class="difflineplus">+                  return new Date(0, 0, 0, 0, 0, 0, 0);</span>
<a href="#l76.1892"></a><span id="l76.1892">               }</span>
<a href="#l76.1893"></a><span id="l76.1893" class="difflineminus">-            } catch (ex) {</span>
<a href="#l76.1894"></a><span id="l76.1894" class="difflineplus">+          } catch (ex) {</span>
<a href="#l76.1895"></a><span id="l76.1895">               // Try/catch this, since some people are apparently</span>
<a href="#l76.1896"></a><span id="l76.1896">               // interested in using the datepicker in remote apps, where</span>
<a href="#l76.1897"></a><span id="l76.1897">               // calGetString wouldn't exist</span>
<a href="#l76.1898"></a><span id="l76.1898" class="difflineminus">-            }</span>
<a href="#l76.1899"></a><span id="l76.1899" class="difflineplus">+          }</span>
<a href="#l76.1900"></a><span id="l76.1900"> </span>
<a href="#l76.1901"></a><span id="l76.1901" class="difflineminus">-            let time = null;</span>
<a href="#l76.1902"></a><span id="l76.1902" class="difflineminus">-            let timePartsArray = this.parseTimeRegExp.exec(aValue);</span>
<a href="#l76.1903"></a><span id="l76.1903" class="difflineminus">-            const PRE_INDEX = 1, HR_INDEX = 2, MIN_INDEX = 4, SEC_INDEX = 6, POST_INDEX = 8;</span>
<a href="#l76.1904"></a><span id="l76.1904" class="difflineplus">+          let time = null;</span>
<a href="#l76.1905"></a><span id="l76.1905" class="difflineplus">+          let timePartsArray = this.parseTimeRegExp.exec(aValue);</span>
<a href="#l76.1906"></a><span id="l76.1906" class="difflineplus">+          const PRE_INDEX = 1, HR_INDEX = 2, MIN_INDEX = 4, SEC_INDEX = 6, POST_INDEX = 8;</span>
<a href="#l76.1907"></a><span id="l76.1907"> </span>
<a href="#l76.1908"></a><span id="l76.1908" class="difflineminus">-            if (timePartsArray != null) {</span>
<a href="#l76.1909"></a><span id="l76.1909" class="difflineplus">+          if (timePartsArray != null) {</span>
<a href="#l76.1910"></a><span id="l76.1910">               let hoursString = timePartsArray[HR_INDEX];</span>
<a href="#l76.1911"></a><span id="l76.1911">               let hours = Number(hoursString);</span>
<a href="#l76.1912"></a><span id="l76.1912">               if (!(hours &gt;= 0 &amp;&amp; hours &lt; 24)) {</span>
<a href="#l76.1913"></a><span id="l76.1913" class="difflineminus">-                return null;</span>
<a href="#l76.1914"></a><span id="l76.1914" class="difflineplus">+                  return null;</span>
<a href="#l76.1915"></a><span id="l76.1915">               }</span>
<a href="#l76.1916"></a><span id="l76.1916"> </span>
<a href="#l76.1917"></a><span id="l76.1917">               let minutesString = timePartsArray[MIN_INDEX];</span>
<a href="#l76.1918"></a><span id="l76.1918">               let minutes = (minutesString == null ? 0 : Number(minutesString));</span>
<a href="#l76.1919"></a><span id="l76.1919">               if (!(minutes &gt;= 0 &amp;&amp; minutes &lt; 60)) {</span>
<a href="#l76.1920"></a><span id="l76.1920" class="difflineminus">-                return null;</span>
<a href="#l76.1921"></a><span id="l76.1921" class="difflineplus">+                  return null;</span>
<a href="#l76.1922"></a><span id="l76.1922">               }</span>
<a href="#l76.1923"></a><span id="l76.1923"> </span>
<a href="#l76.1924"></a><span id="l76.1924">               let secondsString = timePartsArray[SEC_INDEX];</span>
<a href="#l76.1925"></a><span id="l76.1925">               let seconds = (secondsString == null ? 0 : Number(secondsString));</span>
<a href="#l76.1926"></a><span id="l76.1926">               if (!(seconds &gt;= 0 &amp;&amp; seconds &lt; 60)) {</span>
<a href="#l76.1927"></a><span id="l76.1927" class="difflineminus">-                return null;</span>
<a href="#l76.1928"></a><span id="l76.1928" class="difflineplus">+                  return null;</span>
<a href="#l76.1929"></a><span id="l76.1929">               }</span>
<a href="#l76.1930"></a><span id="l76.1930"> </span>
<a href="#l76.1931"></a><span id="l76.1931">               let ampmCode = null;</span>
<a href="#l76.1932"></a><span id="l76.1932">               if (timePartsArray[PRE_INDEX] || timePartsArray[POST_INDEX]) {</span>
<a href="#l76.1933"></a><span id="l76.1933" class="difflineminus">-                if (this.ampmIndex &amp;&amp; timePartsArray[this.ampmIndex]) {</span>
<a href="#l76.1934"></a><span id="l76.1934" class="difflineminus">-                  // try current format order first</span>
<a href="#l76.1935"></a><span id="l76.1935" class="difflineminus">-                  let ampmString = timePartsArray[this.ampmIndex];</span>
<a href="#l76.1936"></a><span id="l76.1936" class="difflineminus">-                  if (this.amRegExp.test(ampmString)) {</span>
<a href="#l76.1937"></a><span id="l76.1937" class="difflineminus">-                    ampmCode = &quot;AM&quot;;</span>
<a href="#l76.1938"></a><span id="l76.1938" class="difflineminus">-                  } else if (this.pmRegExp.test(ampmString)) {</span>
<a href="#l76.1939"></a><span id="l76.1939" class="difflineminus">-                    ampmCode = &quot;PM&quot;;</span>
<a href="#l76.1940"></a><span id="l76.1940" class="difflineplus">+                  if (this.ampmIndex &amp;&amp; timePartsArray[this.ampmIndex]) {</span>
<a href="#l76.1941"></a><span id="l76.1941" class="difflineplus">+                      // try current format order first</span>
<a href="#l76.1942"></a><span id="l76.1942" class="difflineplus">+                      let ampmString = timePartsArray[this.ampmIndex];</span>
<a href="#l76.1943"></a><span id="l76.1943" class="difflineplus">+                      if (this.amRegExp.test(ampmString)) {</span>
<a href="#l76.1944"></a><span id="l76.1944" class="difflineplus">+                          ampmCode = &quot;AM&quot;;</span>
<a href="#l76.1945"></a><span id="l76.1945" class="difflineplus">+                      } else if (this.pmRegExp.test(ampmString)) {</span>
<a href="#l76.1946"></a><span id="l76.1946" class="difflineplus">+                          ampmCode = &quot;PM&quot;;</span>
<a href="#l76.1947"></a><span id="l76.1947" class="difflineplus">+                      }</span>
<a href="#l76.1948"></a><span id="l76.1948">                   }</span>
<a href="#l76.1949"></a><span id="l76.1949" class="difflineminus">-                }</span>
<a href="#l76.1950"></a><span id="l76.1950" class="difflineminus">-                if (ampmCode == null) { // not yet found</span>
<a href="#l76.1951"></a><span id="l76.1951" class="difflineminus">-                  // try any format order</span>
<a href="#l76.1952"></a><span id="l76.1952" class="difflineminus">-                  let preString = timePartsArray[PRE_INDEX];</span>
<a href="#l76.1953"></a><span id="l76.1953" class="difflineminus">-                  let postString = timePartsArray[POST_INDEX];</span>
<a href="#l76.1954"></a><span id="l76.1954" class="difflineminus">-                  if ((preString &amp;&amp; this.amRegExp.test(preString)) ||</span>
<a href="#l76.1955"></a><span id="l76.1955" class="difflineminus">-                      (postString &amp;&amp; this.amRegExp.test(postString))) {</span>
<a href="#l76.1956"></a><span id="l76.1956" class="difflineminus">-                    ampmCode = &quot;AM&quot;;</span>
<a href="#l76.1957"></a><span id="l76.1957" class="difflineminus">-                  } else if ((preString &amp;&amp; this.pmRegExp.test(preString)) ||</span>
<a href="#l76.1958"></a><span id="l76.1958" class="difflineminus">-                             (postString &amp;&amp; this.pmRegExp.test(postString))) {</span>
<a href="#l76.1959"></a><span id="l76.1959" class="difflineminus">-                    ampmCode = &quot;PM&quot;;</span>
<a href="#l76.1960"></a><span id="l76.1960" class="difflineminus">-                  } // else no match, ignore and treat as 24hour time.</span>
<a href="#l76.1961"></a><span id="l76.1961" class="difflineminus">-                }</span>
<a href="#l76.1962"></a><span id="l76.1962" class="difflineplus">+                  if (ampmCode == null) { // not yet found</span>
<a href="#l76.1963"></a><span id="l76.1963" class="difflineplus">+                      // try any format order</span>
<a href="#l76.1964"></a><span id="l76.1964" class="difflineplus">+                      let preString = timePartsArray[PRE_INDEX];</span>
<a href="#l76.1965"></a><span id="l76.1965" class="difflineplus">+                      let postString = timePartsArray[POST_INDEX];</span>
<a href="#l76.1966"></a><span id="l76.1966" class="difflineplus">+                      if ((preString &amp;&amp; this.amRegExp.test(preString)) ||</span>
<a href="#l76.1967"></a><span id="l76.1967" class="difflineplus">+                          (postString &amp;&amp; this.amRegExp.test(postString))) {</span>
<a href="#l76.1968"></a><span id="l76.1968" class="difflineplus">+                          ampmCode = &quot;AM&quot;;</span>
<a href="#l76.1969"></a><span id="l76.1969" class="difflineplus">+                      } else if ((preString &amp;&amp; this.pmRegExp.test(preString)) ||</span>
<a href="#l76.1970"></a><span id="l76.1970" class="difflineplus">+                                 (postString &amp;&amp; this.pmRegExp.test(postString))) {</span>
<a href="#l76.1971"></a><span id="l76.1971" class="difflineplus">+                          ampmCode = &quot;PM&quot;;</span>
<a href="#l76.1972"></a><span id="l76.1972" class="difflineplus">+                      } // else no match, ignore and treat as 24hour time.</span>
<a href="#l76.1973"></a><span id="l76.1973" class="difflineplus">+                  }</span>
<a href="#l76.1974"></a><span id="l76.1974">               }</span>
<a href="#l76.1975"></a><span id="l76.1975">               if (ampmCode == &quot;AM&quot;) {</span>
<a href="#l76.1976"></a><span id="l76.1976" class="difflineminus">-                if (hours == 12) {</span>
<a href="#l76.1977"></a><span id="l76.1977" class="difflineminus">-                  hours = 0;</span>
<a href="#l76.1978"></a><span id="l76.1978" class="difflineminus">-                }</span>
<a href="#l76.1979"></a><span id="l76.1979" class="difflineplus">+                  if (hours == 12) {</span>
<a href="#l76.1980"></a><span id="l76.1980" class="difflineplus">+                      hours = 0;</span>
<a href="#l76.1981"></a><span id="l76.1981" class="difflineplus">+                  }</span>
<a href="#l76.1982"></a><span id="l76.1982">               } else if (ampmCode == &quot;PM&quot;) {</span>
<a href="#l76.1983"></a><span id="l76.1983" class="difflineminus">-                if (hours &lt; 12) {</span>
<a href="#l76.1984"></a><span id="l76.1984" class="difflineminus">-                  hours += 12;</span>
<a href="#l76.1985"></a><span id="l76.1985" class="difflineminus">-                }</span>
<a href="#l76.1986"></a><span id="l76.1986" class="difflineplus">+                  if (hours &lt; 12) {</span>
<a href="#l76.1987"></a><span id="l76.1987" class="difflineplus">+                      hours += 12;</span>
<a href="#l76.1988"></a><span id="l76.1988" class="difflineplus">+                  }</span>
<a href="#l76.1989"></a><span id="l76.1989">               }</span>
<a href="#l76.1990"></a><span id="l76.1990">               time = new Date(0, 0, 0, hours, minutes, seconds, 0);</span>
<a href="#l76.1991"></a><span id="l76.1991" class="difflineminus">-            }  // else did not match regex, not valid time</span>
<a href="#l76.1992"></a><span id="l76.1992" class="difflineminus">-            return time;</span>
<a href="#l76.1993"></a><span id="l76.1993" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.1994"></a><span id="l76.1994" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.1995"></a><span id="l76.1995" class="difflineplus">+          }  // else did not match regex, not valid time</span>
<a href="#l76.1996"></a><span id="l76.1996" class="difflineplus">+          return time;</span>
<a href="#l76.1997"></a><span id="l76.1997" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.1998"></a><span id="l76.1998">       &lt;/method&gt;</span>
<a href="#l76.1999"></a><span id="l76.1999"> </span>
<a href="#l76.2000"></a><span id="l76.2000">       &lt;method name=&quot;initDateFormat&quot;&gt;</span>
<a href="#l76.2001"></a><span id="l76.2001" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.2002"></a><span id="l76.2002" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.2003"></a><span id="l76.2003" class="difflineminus">-            // probe the dateformat</span>
<a href="#l76.2004"></a><span id="l76.2004" class="difflineminus">-            this.yearIndex = -1;</span>
<a href="#l76.2005"></a><span id="l76.2005" class="difflineminus">-            this.monthIndex = -1;</span>
<a href="#l76.2006"></a><span id="l76.2006" class="difflineminus">-            this.dayIndex = -1;</span>
<a href="#l76.2007"></a><span id="l76.2007" class="difflineminus">-            this.twoDigitYear = false;</span>
<a href="#l76.2008"></a><span id="l76.2008" class="difflineminus">-            this.alphaMonths = null;</span>
<a href="#l76.2009"></a><span id="l76.2009" class="difflineminus">-            this.probeSucceeded = false;</span>
<a href="#l76.2010"></a><span id="l76.2010" class="difflineminus">-            this.mLastDateParseIncludedTime = false;</span>
<a href="#l76.2011"></a><span id="l76.2011" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.2012"></a><span id="l76.2012" class="difflineplus">+          // probe the dateformat</span>
<a href="#l76.2013"></a><span id="l76.2013" class="difflineplus">+          this.yearIndex = -1;</span>
<a href="#l76.2014"></a><span id="l76.2014" class="difflineplus">+          this.monthIndex = -1;</span>
<a href="#l76.2015"></a><span id="l76.2015" class="difflineplus">+          this.dayIndex = -1;</span>
<a href="#l76.2016"></a><span id="l76.2016" class="difflineplus">+          this.twoDigitYear = false;</span>
<a href="#l76.2017"></a><span id="l76.2017" class="difflineplus">+          this.alphaMonths = null;</span>
<a href="#l76.2018"></a><span id="l76.2018" class="difflineplus">+          this.probeSucceeded = false;</span>
<a href="#l76.2019"></a><span id="l76.2019" class="difflineplus">+          this.mLastDateParseIncludedTime = false;</span>
<a href="#l76.2020"></a><span id="l76.2020"> </span>
<a href="#l76.2021"></a><span id="l76.2021" class="difflineminus">-            // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l76.2022"></a><span id="l76.2022" class="difflineminus">-            // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l76.2023"></a><span id="l76.2023" class="difflineminus">-            // which do not match \w, esp. in CJK locales.)</span>
<a href="#l76.2024"></a><span id="l76.2024" class="difflineminus">-            this.parseShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)\D?$/;</span>
<a href="#l76.2025"></a><span id="l76.2025" class="difflineminus">-            let probeDate = new Date(2002, 2, 4); // month is 0-based</span>
<a href="#l76.2026"></a><span id="l76.2026" class="difflineminus">-            let probeString = this.formatDate(probeDate);</span>
<a href="#l76.2027"></a><span id="l76.2027" class="difflineminus">-            let probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l76.2028"></a><span id="l76.2028" class="difflineminus">-            if (probeArray) {</span>
<a href="#l76.2029"></a><span id="l76.2029" class="difflineplus">+          // SHORT NUMERIC DATE, such as 2002-03-04, 4/3/2002, or CE2002Y03M04D.</span>
<a href="#l76.2030"></a><span id="l76.2030" class="difflineplus">+          // Made of digits &amp; nonDigits.  (Nondigits may be unicode letters</span>
<a href="#l76.2031"></a><span id="l76.2031" class="difflineplus">+          // which do not match \w, esp. in CJK locales.)</span>
<a href="#l76.2032"></a><span id="l76.2032" class="difflineplus">+          this.parseShortDateRegex = /^\D*(\d+)\D+(\d+)\D+(\d+)\D?$/;</span>
<a href="#l76.2033"></a><span id="l76.2033" class="difflineplus">+          let probeDate = new Date(2002, 2, 4); // month is 0-based</span>
<a href="#l76.2034"></a><span id="l76.2034" class="difflineplus">+          let probeString = this.formatDate(probeDate);</span>
<a href="#l76.2035"></a><span id="l76.2035" class="difflineplus">+          let probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l76.2036"></a><span id="l76.2036" class="difflineplus">+          if (probeArray) {</span>
<a href="#l76.2037"></a><span id="l76.2037">               // Numeric month format</span>
<a href="#l76.2038"></a><span id="l76.2038">               for (let i = 1; i &lt;= 3; i++) {</span>
<a href="#l76.2039"></a><span id="l76.2039" class="difflineminus">-                switch (Number(probeArray[i])) {</span>
<a href="#l76.2040"></a><span id="l76.2040" class="difflineminus">-                  case 2: this.twoDigitYear = true; // falls through</span>
<a href="#l76.2041"></a><span id="l76.2041" class="difflineminus">-                  case 2002: this.yearIndex = i; break;</span>
<a href="#l76.2042"></a><span id="l76.2042" class="difflineminus">-                  case 3: this.monthIndex = i; break;</span>
<a href="#l76.2043"></a><span id="l76.2043" class="difflineminus">-                  case 4: this.dayIndex = i; break;</span>
<a href="#l76.2044"></a><span id="l76.2044" class="difflineminus">-                }</span>
<a href="#l76.2045"></a><span id="l76.2045" class="difflineplus">+                  switch (Number(probeArray[i])) {</span>
<a href="#l76.2046"></a><span id="l76.2046" class="difflineplus">+                      case 2: this.twoDigitYear = true; // falls through</span>
<a href="#l76.2047"></a><span id="l76.2047" class="difflineplus">+                      case 2002: this.yearIndex = i; break;</span>
<a href="#l76.2048"></a><span id="l76.2048" class="difflineplus">+                      case 3: this.monthIndex = i; break;</span>
<a href="#l76.2049"></a><span id="l76.2049" class="difflineplus">+                      case 4: this.dayIndex = i; break;</span>
<a href="#l76.2050"></a><span id="l76.2050" class="difflineplus">+                  }</span>
<a href="#l76.2051"></a><span id="l76.2051">               }</span>
<a href="#l76.2052"></a><span id="l76.2052">               // All three indexes are set (not -1) at this point.</span>
<a href="#l76.2053"></a><span id="l76.2053">               this.probeSucceeded = true;</span>
<a href="#l76.2054"></a><span id="l76.2054" class="difflineminus">-            } else {</span>
<a href="#l76.2055"></a><span id="l76.2055" class="difflineplus">+          } else {</span>
<a href="#l76.2056"></a><span id="l76.2056">               // SHORT DATE WITH ALPHABETIC MONTH, such as &quot;dd MMM yy&quot; or &quot;MMMM dd, yyyy&quot;</span>
<a href="#l76.2057"></a><span id="l76.2057">               // (\d+|[^\d\W]) is digits or letters, not both together.</span>
<a href="#l76.2058"></a><span id="l76.2058">               // Allows 31dec1999 (no delimiters between parts) if OS does (w2k does not).</span>
<a href="#l76.2059"></a><span id="l76.2059">               // Allows Dec 31, 1999 (comma and space between parts)</span>
<a href="#l76.2060"></a><span id="l76.2060">               // (Only accepts ASCII month names; JavaScript RegExp does not have an</span>
<a href="#l76.2061"></a><span id="l76.2061">               // easy way to describe unicode letters short of a HUGE character range</span>
<a href="#l76.2062"></a><span id="l76.2062">               // regexp derived from the Alphabetic ranges in</span>
<a href="#l76.2063"></a><span id="l76.2063">               // http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt)</span>
<a href="#l76.2064"></a><span id="l76.2064">               this.parseShortDateRegex = /^\s*(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)\W{0,2}(\d+|[^\d\W]+)\s*$/;</span>
<a href="#l76.2065"></a><span id="l76.2065">               probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l76.2066"></a><span id="l76.2066">               if (probeArray != null) {</span>
<a href="#l76.2067"></a><span id="l76.2067" class="difflineminus">-                for (let j = 1; j &lt;= 3; j++) {</span>
<a href="#l76.2068"></a><span id="l76.2068" class="difflineminus">-                  switch (Number(probeArray[j])) {</span>
<a href="#l76.2069"></a><span id="l76.2069" class="difflineminus">-                    case 2: this.twoDigitYear = true; // falls through</span>
<a href="#l76.2070"></a><span id="l76.2070" class="difflineminus">-                    case 2002: this.yearIndex = j; break;</span>
<a href="#l76.2071"></a><span id="l76.2071" class="difflineminus">-                    case 4: this.dayIndex = j; break;</span>
<a href="#l76.2072"></a><span id="l76.2072" class="difflineminus">-                    default: this.monthIndex = j; break;</span>
<a href="#l76.2073"></a><span id="l76.2073" class="difflineplus">+                  for (let j = 1; j &lt;= 3; j++) {</span>
<a href="#l76.2074"></a><span id="l76.2074" class="difflineplus">+                      switch (Number(probeArray[j])) {</span>
<a href="#l76.2075"></a><span id="l76.2075" class="difflineplus">+                          case 2: this.twoDigitYear = true; // falls through</span>
<a href="#l76.2076"></a><span id="l76.2076" class="difflineplus">+                          case 2002: this.yearIndex = j; break;</span>
<a href="#l76.2077"></a><span id="l76.2077" class="difflineplus">+                          case 4: this.dayIndex = j; break;</span>
<a href="#l76.2078"></a><span id="l76.2078" class="difflineplus">+                          default: this.monthIndex = j; break;</span>
<a href="#l76.2079"></a><span id="l76.2079" class="difflineplus">+                      }</span>
<a href="#l76.2080"></a><span id="l76.2080">                   }</span>
<a href="#l76.2081"></a><span id="l76.2081" class="difflineminus">-                }</span>
<a href="#l76.2082"></a><span id="l76.2082" class="difflineminus">-                if (this.yearIndex != -1 &amp;&amp; this.dayIndex != -1 &amp;&amp; this.monthIndex != -1) {</span>
<a href="#l76.2083"></a><span id="l76.2083" class="difflineminus">-                  this.probeSucceeded = true;</span>
<a href="#l76.2084"></a><span id="l76.2084" class="difflineminus">-                  // Fill this.alphaMonths with month names.</span>
<a href="#l76.2085"></a><span id="l76.2085" class="difflineminus">-                  this.alphaMonths = new Array(12);</span>
<a href="#l76.2086"></a><span id="l76.2086" class="difflineminus">-                  for (let monthIdx = 0; monthIdx &lt; 12; monthIdx++) {</span>
<a href="#l76.2087"></a><span id="l76.2087" class="difflineminus">-                    probeDate.setMonth(monthIdx);</span>
<a href="#l76.2088"></a><span id="l76.2088" class="difflineminus">-                    probeString = this.formatDate(probeDate);</span>
<a href="#l76.2089"></a><span id="l76.2089" class="difflineminus">-                    probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l76.2090"></a><span id="l76.2090" class="difflineminus">-                    if (probeArray) {</span>
<a href="#l76.2091"></a><span id="l76.2091" class="difflineminus">-                      this.alphaMonths[monthIdx] = probeArray[this.monthIndex].toUpperCase();</span>
<a href="#l76.2092"></a><span id="l76.2092" class="difflineminus">-                    } else {</span>
<a href="#l76.2093"></a><span id="l76.2093" class="difflineminus">-                      this.probeSucceeded = false;</span>
<a href="#l76.2094"></a><span id="l76.2094" class="difflineminus">-                    }</span>
<a href="#l76.2095"></a><span id="l76.2095" class="difflineplus">+                  if (this.yearIndex != -1 &amp;&amp; this.dayIndex != -1 &amp;&amp; this.monthIndex != -1) {</span>
<a href="#l76.2096"></a><span id="l76.2096" class="difflineplus">+                      this.probeSucceeded = true;</span>
<a href="#l76.2097"></a><span id="l76.2097" class="difflineplus">+                      // Fill this.alphaMonths with month names.</span>
<a href="#l76.2098"></a><span id="l76.2098" class="difflineplus">+                      this.alphaMonths = new Array(12);</span>
<a href="#l76.2099"></a><span id="l76.2099" class="difflineplus">+                      for (let monthIdx = 0; monthIdx &lt; 12; monthIdx++) {</span>
<a href="#l76.2100"></a><span id="l76.2100" class="difflineplus">+                          probeDate.setMonth(monthIdx);</span>
<a href="#l76.2101"></a><span id="l76.2101" class="difflineplus">+                          probeString = this.formatDate(probeDate);</span>
<a href="#l76.2102"></a><span id="l76.2102" class="difflineplus">+                          probeArray = this.parseShortDateRegex.exec(probeString);</span>
<a href="#l76.2103"></a><span id="l76.2103" class="difflineplus">+                          if (probeArray) {</span>
<a href="#l76.2104"></a><span id="l76.2104" class="difflineplus">+                              this.alphaMonths[monthIdx] = probeArray[this.monthIndex].toUpperCase();</span>
<a href="#l76.2105"></a><span id="l76.2105" class="difflineplus">+                          } else {</span>
<a href="#l76.2106"></a><span id="l76.2106" class="difflineplus">+                              this.probeSucceeded = false;</span>
<a href="#l76.2107"></a><span id="l76.2107" class="difflineplus">+                          }</span>
<a href="#l76.2108"></a><span id="l76.2108" class="difflineplus">+                      }</span>
<a href="#l76.2109"></a><span id="l76.2109">                   }</span>
<a href="#l76.2110"></a><span id="l76.2110" class="difflineminus">-                }</span>
<a href="#l76.2111"></a><span id="l76.2111">               }</span>
<a href="#l76.2112"></a><span id="l76.2112" class="difflineminus">-            }</span>
<a href="#l76.2113"></a><span id="l76.2113" class="difflineminus">-            if (!this.probeSucceeded) {</span>
<a href="#l76.2114"></a><span id="l76.2114" class="difflineplus">+          }</span>
<a href="#l76.2115"></a><span id="l76.2115" class="difflineplus">+          if (!this.probeSucceeded) {</span>
<a href="#l76.2116"></a><span id="l76.2116">               dump(&quot;\nOperating system short date format is not recognized: &quot; + probeString + &quot;\n&quot;);</span>
<a href="#l76.2117"></a><span id="l76.2117" class="difflineminus">-            }</span>
<a href="#l76.2118"></a><span id="l76.2118" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.2119"></a><span id="l76.2119" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.2120"></a><span id="l76.2120" class="difflineplus">+          }</span>
<a href="#l76.2121"></a><span id="l76.2121" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.2122"></a><span id="l76.2122">       &lt;/method&gt;</span>
<a href="#l76.2123"></a><span id="l76.2123"> </span>
<a href="#l76.2124"></a><span id="l76.2124">       &lt;!-- Time format in 24-hour format or 12-hour format with am/pm string.</span>
<a href="#l76.2125"></a><span id="l76.2125">            Should match formats</span>
<a href="#l76.2126"></a><span id="l76.2126">                 HH:mm,       H:mm,       HH:mm:ss,       H:mm:ss</span>
<a href="#l76.2127"></a><span id="l76.2127">                 hh:mm tt,    h:mm tt,    hh:mm:ss tt,    h:mm:ss tt</span>
<a href="#l76.2128"></a><span id="l76.2128">              tt hh:mm,    tt h:mm,    tt hh:mm:ss,    tt h:mm:ss</span>
<a href="#l76.2129"></a><span id="l76.2129">            where</span>
<a href="#l76.2130"></a><span id="l76.2130">            HH is 24 hour digits, with leading 0.  H is 24 hour digits, no leading 0.</span>
<a href="#l76.2131"></a><span id="l76.2131">            hh is 12 hour digits, with leading 0.  h is 12 hour digits, no leading 0.</span>
<a href="#l76.2132"></a><span id="l76.2132">            mm and ss are is minutes and seconds digits, with leading 0.</span>
<a href="#l76.2133"></a><span id="l76.2133">            tt is localized AM or PM string.</span>
<a href="#l76.2134"></a><span id="l76.2134">            ':' may be ':' or a units marker such as 'h', 'm', or 's' in  15h12m00s</span>
<a href="#l76.2135"></a><span id="l76.2135">            or may be omitted as in 151200.</span>
<a href="#l76.2136"></a><span id="l76.2136">       --&gt;</span>
<a href="#l76.2137"></a><span id="l76.2137">       &lt;method name=&quot;initTimeFormat&quot;&gt;</span>
<a href="#l76.2138"></a><span id="l76.2138" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.2139"></a><span id="l76.2139" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.2140"></a><span id="l76.2140" class="difflineminus">-            // probe the Time format</span>
<a href="#l76.2141"></a><span id="l76.2141" class="difflineminus">-            this.ampmIndex = null;</span>
<a href="#l76.2142"></a><span id="l76.2142" class="difflineminus">-            // Digits         HR       sep      MIN     sep      SEC     sep</span>
<a href="#l76.2143"></a><span id="l76.2143" class="difflineminus">-            //   Index:       2        3        4       5        6       7</span>
<a href="#l76.2144"></a><span id="l76.2144" class="difflineminus">-            let digitsExpr = &quot;(\\d?\\d)(\\D)?(?:(\\d\\d)(\\D)?(?:(\\d\\d)(\\D)?)?)?&quot;;</span>
<a href="#l76.2145"></a><span id="l76.2145" class="difflineminus">-            // any letters or '.': non-digit alphanumeric, period (a.m.), or space (P M)</span>
<a href="#l76.2146"></a><span id="l76.2146" class="difflineminus">-            let anyAmPmExpr = &quot;(?:[^\\d\\W]|[. ])+&quot;;</span>
<a href="#l76.2147"></a><span id="l76.2147" class="difflineminus">-            // digitsExpr has 6 captures, so index of first ampmExpr is 1, of last is 8.</span>
<a href="#l76.2148"></a><span id="l76.2148" class="difflineminus">-            let probeTimeRegExp =</span>
<a href="#l76.2149"></a><span id="l76.2149" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.2150"></a><span id="l76.2150" class="difflineplus">+          // probe the Time format</span>
<a href="#l76.2151"></a><span id="l76.2151" class="difflineplus">+          this.ampmIndex = null;</span>
<a href="#l76.2152"></a><span id="l76.2152" class="difflineplus">+          // Digits         HR       sep      MIN     sep      SEC     sep</span>
<a href="#l76.2153"></a><span id="l76.2153" class="difflineplus">+          //   Index:       2        3        4       5        6       7</span>
<a href="#l76.2154"></a><span id="l76.2154" class="difflineplus">+          let digitsExpr = &quot;(\\d?\\d)(\\D)?(?:(\\d\\d)(\\D)?(?:(\\d\\d)(\\D)?)?)?&quot;;</span>
<a href="#l76.2155"></a><span id="l76.2155" class="difflineplus">+          // any letters or '.': non-digit alphanumeric, period (a.m.), or space (P M)</span>
<a href="#l76.2156"></a><span id="l76.2156" class="difflineplus">+          let anyAmPmExpr = &quot;(?:[^\\d\\W]|[. ])+&quot;;</span>
<a href="#l76.2157"></a><span id="l76.2157" class="difflineplus">+          // digitsExpr has 6 captures, so index of first ampmExpr is 1, of last is 8.</span>
<a href="#l76.2158"></a><span id="l76.2158" class="difflineplus">+          let probeTimeRegExp =</span>
<a href="#l76.2159"></a><span id="l76.2159">               new RegExp(&quot;^(&quot; + anyAmPmExpr + &quot;)?\\s?&quot; + digitsExpr + &quot;(&quot; + anyAmPmExpr + &quot;)?\\s*$&quot;);</span>
<a href="#l76.2160"></a><span id="l76.2160" class="difflineminus">-            const PRE_INDEX = 1, HR_INDEX = 2, MIN_INDEX = 4, SEC_INDEX = 6, POST_INDEX = 8; // eslint-disable-line no-unused-vars</span>
<a href="#l76.2161"></a><span id="l76.2161" class="difflineminus">-            let amProbeTime = new Date(2000, 0, 1, 6, 12, 34);</span>
<a href="#l76.2162"></a><span id="l76.2162" class="difflineminus">-            let amProbeString = amProbeTime.toLocaleFormat(&quot;%X&quot;);</span>
<a href="#l76.2163"></a><span id="l76.2163" class="difflineminus">-            let pmProbeTime = new Date(2000, 0, 1, 18, 12, 34);</span>
<a href="#l76.2164"></a><span id="l76.2164" class="difflineminus">-            let pmProbeString = pmProbeTime.toLocaleFormat(&quot;%X&quot;);</span>
<a href="#l76.2165"></a><span id="l76.2165" class="difflineminus">-            let amFormatExpr = null, pmFormatExpr = null;</span>
<a href="#l76.2166"></a><span id="l76.2166" class="difflineminus">-            if (amProbeString != pmProbeString) {</span>
<a href="#l76.2167"></a><span id="l76.2167" class="difflineplus">+          const PRE_INDEX = 1, HR_INDEX = 2, MIN_INDEX = 4, SEC_INDEX = 6, POST_INDEX = 8; // eslint-disable-line no-unused-vars</span>
<a href="#l76.2168"></a><span id="l76.2168" class="difflineplus">+          let amProbeTime = new Date(2000, 0, 1, 6, 12, 34);</span>
<a href="#l76.2169"></a><span id="l76.2169" class="difflineplus">+          let amProbeString = amProbeTime.toLocaleFormat(&quot;%X&quot;);</span>
<a href="#l76.2170"></a><span id="l76.2170" class="difflineplus">+          let pmProbeTime = new Date(2000, 0, 1, 18, 12, 34);</span>
<a href="#l76.2171"></a><span id="l76.2171" class="difflineplus">+          let pmProbeString = pmProbeTime.toLocaleFormat(&quot;%X&quot;);</span>
<a href="#l76.2172"></a><span id="l76.2172" class="difflineplus">+          let amFormatExpr = null, pmFormatExpr = null;</span>
<a href="#l76.2173"></a><span id="l76.2173" class="difflineplus">+          if (amProbeString != pmProbeString) {</span>
<a href="#l76.2174"></a><span id="l76.2174">               let amProbeArray = probeTimeRegExp.exec(amProbeString);</span>
<a href="#l76.2175"></a><span id="l76.2175">               let pmProbeArray = probeTimeRegExp.exec(pmProbeString);</span>
<a href="#l76.2176"></a><span id="l76.2176">               if (amProbeArray != null &amp;&amp; pmProbeArray != null) {</span>
<a href="#l76.2177"></a><span id="l76.2177" class="difflineminus">-                if (amProbeArray[PRE_INDEX] &amp;&amp; pmProbeArray[PRE_INDEX] &amp;&amp;</span>
<a href="#l76.2178"></a><span id="l76.2178" class="difflineminus">-                    amProbeArray[PRE_INDEX] != pmProbeArray[PRE_INDEX]) {</span>
<a href="#l76.2179"></a><span id="l76.2179" class="difflineminus">-                  this.ampmIndex = PRE_INDEX;</span>
<a href="#l76.2180"></a><span id="l76.2180" class="difflineminus">-                } else if (amProbeArray[POST_INDEX] &amp;&amp; pmProbeArray[POST_INDEX]) {</span>
<a href="#l76.2181"></a><span id="l76.2181" class="difflineminus">-                  if (amProbeArray[POST_INDEX] == pmProbeArray[POST_INDEX]) {</span>
<a href="#l76.2182"></a><span id="l76.2182" class="difflineminus">-                    // check if need to append previous character,</span>
<a href="#l76.2183"></a><span id="l76.2183" class="difflineminus">-                    // captured by the optional separator pattern after seconds digits,</span>
<a href="#l76.2184"></a><span id="l76.2184" class="difflineminus">-                    // or after minutes if no seconds, or after hours if no minutes.</span>
<a href="#l76.2185"></a><span id="l76.2185" class="difflineminus">-                    for (let k = SEC_INDEX; k &gt;= HR_INDEX; k -= 2) {</span>
<a href="#l76.2186"></a><span id="l76.2186" class="difflineminus">-                      let nextSepI = k + 1;</span>
<a href="#l76.2187"></a><span id="l76.2187" class="difflineminus">-                      let nextDigitsI = k + 2;</span>
<a href="#l76.2188"></a><span id="l76.2188" class="difflineminus">-                      if ((k == SEC_INDEX ||</span>
<a href="#l76.2189"></a><span id="l76.2189" class="difflineminus">-                           (!amProbeArray[nextDigitsI] &amp;&amp; !pmProbeArray[nextDigitsI])) &amp;&amp;</span>
<a href="#l76.2190"></a><span id="l76.2190" class="difflineminus">-                          amProbeArray[nextSepI] &amp;&amp; pmProbeArray[nextSepI] &amp;&amp;</span>
<a href="#l76.2191"></a><span id="l76.2191" class="difflineminus">-                          amProbeArray[nextSepI] != pmProbeArray[nextSepI]) {</span>
<a href="#l76.2192"></a><span id="l76.2192" class="difflineminus">-                        amProbeArray[POST_INDEX] =</span>
<a href="#l76.2193"></a><span id="l76.2193" class="difflineminus">-                          amProbeArray[nextSepI] + amProbeArray[POST_INDEX];</span>
<a href="#l76.2194"></a><span id="l76.2194" class="difflineminus">-                        pmProbeArray[POST_INDEX] =</span>
<a href="#l76.2195"></a><span id="l76.2195" class="difflineminus">-                          pmProbeArray[nextSepI] + pmProbeArray[POST_INDEX];</span>
<a href="#l76.2196"></a><span id="l76.2196" class="difflineminus">-                        this.ampmIndex = POST_INDEX;</span>
<a href="#l76.2197"></a><span id="l76.2197" class="difflineminus">-                        break;</span>
<a href="#l76.2198"></a><span id="l76.2198" class="difflineplus">+                  if (amProbeArray[PRE_INDEX] &amp;&amp; pmProbeArray[PRE_INDEX] &amp;&amp;</span>
<a href="#l76.2199"></a><span id="l76.2199" class="difflineplus">+                      amProbeArray[PRE_INDEX] != pmProbeArray[PRE_INDEX]) {</span>
<a href="#l76.2200"></a><span id="l76.2200" class="difflineplus">+                      this.ampmIndex = PRE_INDEX;</span>
<a href="#l76.2201"></a><span id="l76.2201" class="difflineplus">+                  } else if (amProbeArray[POST_INDEX] &amp;&amp; pmProbeArray[POST_INDEX]) {</span>
<a href="#l76.2202"></a><span id="l76.2202" class="difflineplus">+                      if (amProbeArray[POST_INDEX] == pmProbeArray[POST_INDEX]) {</span>
<a href="#l76.2203"></a><span id="l76.2203" class="difflineplus">+                          // check if need to append previous character,</span>
<a href="#l76.2204"></a><span id="l76.2204" class="difflineplus">+                          // captured by the optional separator pattern after seconds digits,</span>
<a href="#l76.2205"></a><span id="l76.2205" class="difflineplus">+                          // or after minutes if no seconds, or after hours if no minutes.</span>
<a href="#l76.2206"></a><span id="l76.2206" class="difflineplus">+                          for (let k = SEC_INDEX; k &gt;= HR_INDEX; k -= 2) {</span>
<a href="#l76.2207"></a><span id="l76.2207" class="difflineplus">+                              let nextSepI = k + 1;</span>
<a href="#l76.2208"></a><span id="l76.2208" class="difflineplus">+                              let nextDigitsI = k + 2;</span>
<a href="#l76.2209"></a><span id="l76.2209" class="difflineplus">+                              if ((k == SEC_INDEX ||</span>
<a href="#l76.2210"></a><span id="l76.2210" class="difflineplus">+                                   (!amProbeArray[nextDigitsI] &amp;&amp; !pmProbeArray[nextDigitsI])) &amp;&amp;</span>
<a href="#l76.2211"></a><span id="l76.2211" class="difflineplus">+                                  amProbeArray[nextSepI] &amp;&amp; pmProbeArray[nextSepI] &amp;&amp;</span>
<a href="#l76.2212"></a><span id="l76.2212" class="difflineplus">+                                  amProbeArray[nextSepI] != pmProbeArray[nextSepI]) {</span>
<a href="#l76.2213"></a><span id="l76.2213" class="difflineplus">+                                  amProbeArray[POST_INDEX] =</span>
<a href="#l76.2214"></a><span id="l76.2214" class="difflineplus">+                                    amProbeArray[nextSepI] + amProbeArray[POST_INDEX];</span>
<a href="#l76.2215"></a><span id="l76.2215" class="difflineplus">+                                  pmProbeArray[POST_INDEX] =</span>
<a href="#l76.2216"></a><span id="l76.2216" class="difflineplus">+                                    pmProbeArray[nextSepI] + pmProbeArray[POST_INDEX];</span>
<a href="#l76.2217"></a><span id="l76.2217" class="difflineplus">+                                  this.ampmIndex = POST_INDEX;</span>
<a href="#l76.2218"></a><span id="l76.2218" class="difflineplus">+                                  break;</span>
<a href="#l76.2219"></a><span id="l76.2219" class="difflineplus">+                              }</span>
<a href="#l76.2220"></a><span id="l76.2220" class="difflineplus">+                          }</span>
<a href="#l76.2221"></a><span id="l76.2221" class="difflineplus">+                      } else {</span>
<a href="#l76.2222"></a><span id="l76.2222" class="difflineplus">+                          this.ampmIndex = POST_INDEX;</span>
<a href="#l76.2223"></a><span id="l76.2223">                       }</span>
<a href="#l76.2224"></a><span id="l76.2224" class="difflineminus">-                    }</span>
<a href="#l76.2225"></a><span id="l76.2225" class="difflineminus">-                  } else {</span>
<a href="#l76.2226"></a><span id="l76.2226" class="difflineminus">-                    this.ampmIndex = POST_INDEX;</span>
<a href="#l76.2227"></a><span id="l76.2227">                   }</span>
<a href="#l76.2228"></a><span id="l76.2228" class="difflineminus">-                }</span>
<a href="#l76.2229"></a><span id="l76.2229" class="difflineminus">-                if (this.ampmIndex) {</span>
<a href="#l76.2230"></a><span id="l76.2230" class="difflineminus">-                  let makeFormatRegExp = function(string) {</span>
<a href="#l76.2231"></a><span id="l76.2231" class="difflineminus">-                    // make expr to accept either as provided, lowercased, or uppercased</span>
<a href="#l76.2232"></a><span id="l76.2232" class="difflineminus">-                    let regExp = string.replace(/(\W)/g, &quot;[$1]&quot;); // escape punctuation</span>
<a href="#l76.2233"></a><span id="l76.2233" class="difflineminus">-                    let lowercased = string.toLowerCase();</span>
<a href="#l76.2234"></a><span id="l76.2234" class="difflineminus">-                    if (string != lowercased) {</span>
<a href="#l76.2235"></a><span id="l76.2235" class="difflineminus">-                      regExp += &quot;|&quot; + lowercased;</span>
<a href="#l76.2236"></a><span id="l76.2236" class="difflineminus">-                    }</span>
<a href="#l76.2237"></a><span id="l76.2237" class="difflineminus">-                    let uppercased = string.toUpperCase();</span>
<a href="#l76.2238"></a><span id="l76.2238" class="difflineminus">-                    if (string != uppercased) {</span>
<a href="#l76.2239"></a><span id="l76.2239" class="difflineminus">-                      regExp += &quot;|&quot; + uppercased;</span>
<a href="#l76.2240"></a><span id="l76.2240" class="difflineminus">-                    }</span>
<a href="#l76.2241"></a><span id="l76.2241" class="difflineminus">-                    return regExp;</span>
<a href="#l76.2242"></a><span id="l76.2242" class="difflineminus">-                  };</span>
<a href="#l76.2243"></a><span id="l76.2243" class="difflineminus">-                  amFormatExpr = makeFormatRegExp(amProbeArray[this.ampmIndex]);</span>
<a href="#l76.2244"></a><span id="l76.2244" class="difflineminus">-                  pmFormatExpr = makeFormatRegExp(pmProbeArray[this.ampmIndex]);</span>
<a href="#l76.2245"></a><span id="l76.2245" class="difflineminus">-                }</span>
<a href="#l76.2246"></a><span id="l76.2246" class="difflineplus">+                  if (this.ampmIndex) {</span>
<a href="#l76.2247"></a><span id="l76.2247" class="difflineplus">+                      let makeFormatRegExp = function(string) {</span>
<a href="#l76.2248"></a><span id="l76.2248" class="difflineplus">+                          // make expr to accept either as provided, lowercased, or uppercased</span>
<a href="#l76.2249"></a><span id="l76.2249" class="difflineplus">+                          let regExp = string.replace(/(\W)/g, &quot;[$1]&quot;); // escape punctuation</span>
<a href="#l76.2250"></a><span id="l76.2250" class="difflineplus">+                          let lowercased = string.toLowerCase();</span>
<a href="#l76.2251"></a><span id="l76.2251" class="difflineplus">+                          if (string != lowercased) {</span>
<a href="#l76.2252"></a><span id="l76.2252" class="difflineplus">+                              regExp += &quot;|&quot; + lowercased;</span>
<a href="#l76.2253"></a><span id="l76.2253" class="difflineplus">+                          }</span>
<a href="#l76.2254"></a><span id="l76.2254" class="difflineplus">+                          let uppercased = string.toUpperCase();</span>
<a href="#l76.2255"></a><span id="l76.2255" class="difflineplus">+                          if (string != uppercased) {</span>
<a href="#l76.2256"></a><span id="l76.2256" class="difflineplus">+                              regExp += &quot;|&quot; + uppercased;</span>
<a href="#l76.2257"></a><span id="l76.2257" class="difflineplus">+                          }</span>
<a href="#l76.2258"></a><span id="l76.2258" class="difflineplus">+                          return regExp;</span>
<a href="#l76.2259"></a><span id="l76.2259" class="difflineplus">+                      };</span>
<a href="#l76.2260"></a><span id="l76.2260" class="difflineplus">+                      amFormatExpr = makeFormatRegExp(amProbeArray[this.ampmIndex]);</span>
<a href="#l76.2261"></a><span id="l76.2261" class="difflineplus">+                      pmFormatExpr = makeFormatRegExp(pmProbeArray[this.ampmIndex]);</span>
<a href="#l76.2262"></a><span id="l76.2262" class="difflineplus">+                  }</span>
<a href="#l76.2263"></a><span id="l76.2263">               }</span>
<a href="#l76.2264"></a><span id="l76.2264" class="difflineminus">-            }</span>
<a href="#l76.2265"></a><span id="l76.2265" class="difflineminus">-            // International formats ([roman, cyrillic]|arabic|chinese/kanji characters)</span>
<a href="#l76.2266"></a><span id="l76.2266" class="difflineminus">-            // covering languages of U.N. (en,fr,sp,ru,ar,zh) and G8 (en,fr,de,it,ru,ja).</span>
<a href="#l76.2267"></a><span id="l76.2267" class="difflineminus">-            // See examples at parseTimeOfDay.</span>
<a href="#l76.2268"></a><span id="l76.2268" class="difflineminus">-            let amExpr =</span>
<a href="#l76.2269"></a><span id="l76.2269" class="difflineplus">+          }</span>
<a href="#l76.2270"></a><span id="l76.2270" class="difflineplus">+          // International formats ([roman, cyrillic]|arabic|chinese/kanji characters)</span>
<a href="#l76.2271"></a><span id="l76.2271" class="difflineplus">+          // covering languages of U.N. (en,fr,sp,ru,ar,zh) and G8 (en,fr,de,it,ru,ja).</span>
<a href="#l76.2272"></a><span id="l76.2272" class="difflineplus">+          // See examples at parseTimeOfDay.</span>
<a href="#l76.2273"></a><span id="l76.2273" class="difflineplus">+          let amExpr =</span>
<a href="#l76.2274"></a><span id="l76.2274">               &quot;[Aa\u0410\u0430][. ]?[Mm\u041c\u043c][. ]?|\u0635|\u4e0a\u5348|\u5348\u524d&quot;;</span>
<a href="#l76.2275"></a><span id="l76.2275" class="difflineminus">-            let pmExpr =</span>
<a href="#l76.2276"></a><span id="l76.2276" class="difflineplus">+          let pmExpr =</span>
<a href="#l76.2277"></a><span id="l76.2277">               &quot;[Pp\u0420\u0440][. ]?[Mm\u041c\u043c][. ]?|\u0645|\u4e0b\u5348|\u5348\u5f8c&quot;;</span>
<a href="#l76.2278"></a><span id="l76.2278" class="difflineminus">-            if (this.ampmIndex) {</span>
<a href="#l76.2279"></a><span id="l76.2279" class="difflineplus">+          if (this.ampmIndex) {</span>
<a href="#l76.2280"></a><span id="l76.2280">               amExpr = amFormatExpr + &quot;|&quot; + amExpr;</span>
<a href="#l76.2281"></a><span id="l76.2281">               pmExpr = pmFormatExpr + &quot;|&quot; + pmExpr;</span>
<a href="#l76.2282"></a><span id="l76.2282" class="difflineminus">-            }</span>
<a href="#l76.2283"></a><span id="l76.2283" class="difflineminus">-            let ampmExpr = amExpr + &quot;|&quot; + pmExpr;</span>
<a href="#l76.2284"></a><span id="l76.2284" class="difflineminus">-            // Must build am/pm formats into parse time regexp so that it can</span>
<a href="#l76.2285"></a><span id="l76.2285" class="difflineminus">-            // match them without mistaking the initial char for an optional divider.</span>
<a href="#l76.2286"></a><span id="l76.2286" class="difflineminus">-            // (For example, want to be able to parse both &quot;12:34pm&quot; and</span>
<a href="#l76.2287"></a><span id="l76.2287" class="difflineminus">-            // &quot;12H34M56Spm&quot; for any characters H,M,S and any language's &quot;pm&quot;.</span>
<a href="#l76.2288"></a><span id="l76.2288" class="difflineminus">-            // The character between the last digit and the &quot;pm&quot; is optional.</span>
<a href="#l76.2289"></a><span id="l76.2289" class="difflineminus">-            // Must recogize &quot;pm&quot; directly, otherwise in &quot;12:34pm&quot; the &quot;S&quot; pattern</span>
<a href="#l76.2290"></a><span id="l76.2290" class="difflineminus">-            // matches the &quot;p&quot; character so only &quot;m&quot; is matched as ampm suffix.)</span>
<a href="#l76.2291"></a><span id="l76.2291" class="difflineminus">-            //</span>
<a href="#l76.2292"></a><span id="l76.2292" class="difflineminus">-            // digitsExpr has 6 captures, so index of first ampmExpr is 1, of last is 8.</span>
<a href="#l76.2293"></a><span id="l76.2293" class="difflineminus">-            this.parseTimeRegExp =</span>
<a href="#l76.2294"></a><span id="l76.2294" class="difflineplus">+          }</span>
<a href="#l76.2295"></a><span id="l76.2295" class="difflineplus">+          let ampmExpr = amExpr + &quot;|&quot; + pmExpr;</span>
<a href="#l76.2296"></a><span id="l76.2296" class="difflineplus">+          // Must build am/pm formats into parse time regexp so that it can</span>
<a href="#l76.2297"></a><span id="l76.2297" class="difflineplus">+          // match them without mistaking the initial char for an optional divider.</span>
<a href="#l76.2298"></a><span id="l76.2298" class="difflineplus">+          // (For example, want to be able to parse both &quot;12:34pm&quot; and</span>
<a href="#l76.2299"></a><span id="l76.2299" class="difflineplus">+          // &quot;12H34M56Spm&quot; for any characters H,M,S and any language's &quot;pm&quot;.</span>
<a href="#l76.2300"></a><span id="l76.2300" class="difflineplus">+          // The character between the last digit and the &quot;pm&quot; is optional.</span>
<a href="#l76.2301"></a><span id="l76.2301" class="difflineplus">+          // Must recogize &quot;pm&quot; directly, otherwise in &quot;12:34pm&quot; the &quot;S&quot; pattern</span>
<a href="#l76.2302"></a><span id="l76.2302" class="difflineplus">+          // matches the &quot;p&quot; character so only &quot;m&quot; is matched as ampm suffix.)</span>
<a href="#l76.2303"></a><span id="l76.2303" class="difflineplus">+          //</span>
<a href="#l76.2304"></a><span id="l76.2304" class="difflineplus">+          // digitsExpr has 6 captures, so index of first ampmExpr is 1, of last is 8.</span>
<a href="#l76.2305"></a><span id="l76.2305" class="difflineplus">+          this.parseTimeRegExp =</span>
<a href="#l76.2306"></a><span id="l76.2306">               new RegExp(&quot;(&quot; + ampmExpr + &quot;)?\\s?&quot; + digitsExpr + &quot;(&quot; + ampmExpr + &quot;)?\\s*$&quot;);</span>
<a href="#l76.2307"></a><span id="l76.2307" class="difflineminus">-            this.amRegExp = new RegExp(&quot;^(?:&quot; + amExpr + &quot;)$&quot;);</span>
<a href="#l76.2308"></a><span id="l76.2308" class="difflineminus">-            this.pmRegExp = new RegExp(&quot;^(?:&quot; + pmExpr + &quot;)$&quot;);</span>
<a href="#l76.2309"></a><span id="l76.2309" class="difflineminus">-            // build time display format that mimics &quot;%x&quot; format without seconds</span>
<a href="#l76.2310"></a><span id="l76.2310" class="difflineminus">-            let ampmSep = (pmProbeString.includes(&quot; &quot;) ? &quot; &quot; : &quot;&quot;);</span>
<a href="#l76.2311"></a><span id="l76.2311" class="difflineminus">-            if (this.ampmIndex == PRE_INDEX) {</span>
<a href="#l76.2312"></a><span id="l76.2312" class="difflineplus">+          this.amRegExp = new RegExp(&quot;^(?:&quot; + amExpr + &quot;)$&quot;);</span>
<a href="#l76.2313"></a><span id="l76.2313" class="difflineplus">+          this.pmRegExp = new RegExp(&quot;^(?:&quot; + pmExpr + &quot;)$&quot;);</span>
<a href="#l76.2314"></a><span id="l76.2314" class="difflineplus">+          // build time display format that mimics &quot;%x&quot; format without seconds</span>
<a href="#l76.2315"></a><span id="l76.2315" class="difflineplus">+          let ampmSep = (pmProbeString.includes(&quot; &quot;) ? &quot; &quot; : &quot;&quot;);</span>
<a href="#l76.2316"></a><span id="l76.2316" class="difflineplus">+          if (this.ampmIndex == PRE_INDEX) {</span>
<a href="#l76.2317"></a><span id="l76.2317">               this.kTimeFormatString = &quot;%p&quot; + ampmSep + &quot;%I:%M&quot;;</span>
<a href="#l76.2318"></a><span id="l76.2318" class="difflineminus">-            } else if (this.ampmIndex == POST_INDEX) {</span>
<a href="#l76.2319"></a><span id="l76.2319" class="difflineplus">+          } else if (this.ampmIndex == POST_INDEX) {</span>
<a href="#l76.2320"></a><span id="l76.2320">               this.kTimeFormatString = &quot;%I:%M&quot; + ampmSep + &quot;%p&quot;;</span>
<a href="#l76.2321"></a><span id="l76.2321" class="difflineminus">-            } else {</span>
<a href="#l76.2322"></a><span id="l76.2322" class="difflineplus">+          } else {</span>
<a href="#l76.2323"></a><span id="l76.2323">               this.kTimeFormatString = &quot;%H:%M&quot;;</span>
<a href="#l76.2324"></a><span id="l76.2324" class="difflineminus">-            }</span>
<a href="#l76.2325"></a><span id="l76.2325" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.2326"></a><span id="l76.2326" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.2327"></a><span id="l76.2327" class="difflineplus">+          }</span>
<a href="#l76.2328"></a><span id="l76.2328" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.2329"></a><span id="l76.2329">       &lt;/method&gt;</span>
<a href="#l76.2330"></a><span id="l76.2330"> </span>
<a href="#l76.2331"></a><span id="l76.2331">       &lt;method name=&quot;formatDate&quot;&gt;</span>
<a href="#l76.2332"></a><span id="l76.2332">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l76.2333"></a><span id="l76.2333" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.2334"></a><span id="l76.2334" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.2335"></a><span id="l76.2335" class="difflineminus">-            // workaround for bugs 354073/327869:</span>
<a href="#l76.2336"></a><span id="l76.2336" class="difflineminus">-            // aDate.toLocaleFormat(&quot;%x&quot;) exits application</span>
<a href="#l76.2337"></a><span id="l76.2337" class="difflineminus">-            // if year before 1900 (e.g., typo) on MSWindows (due to MS bug).</span>
<a href="#l76.2338"></a><span id="l76.2338" class="difflineminus">-            let nsIScriptableDateFormat =</span>
<a href="#l76.2339"></a><span id="l76.2339" class="difflineminus">-              Components.interfaces.nsIScriptableDateFormat;</span>
<a href="#l76.2340"></a><span id="l76.2340" class="difflineminus">-            let dateService =</span>
<a href="#l76.2341"></a><span id="l76.2341" class="difflineminus">-              Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l76.2342"></a><span id="l76.2342" class="difflineminus">-                        .getService(nsIScriptableDateFormat);</span>
<a href="#l76.2343"></a><span id="l76.2343" class="difflineminus">-            return dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l76.2344"></a><span id="l76.2344" class="difflineminus">-                                          aDate.getFullYear(),</span>
<a href="#l76.2345"></a><span id="l76.2345" class="difflineminus">-                                          aDate.getMonth() + 1,</span>
<a href="#l76.2346"></a><span id="l76.2346" class="difflineminus">-                                          aDate.getDate());</span>
<a href="#l76.2347"></a><span id="l76.2347" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.2348"></a><span id="l76.2348" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.2349"></a><span id="l76.2349" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.2350"></a><span id="l76.2350" class="difflineplus">+          // workaround for bugs 354073/327869:</span>
<a href="#l76.2351"></a><span id="l76.2351" class="difflineplus">+          // aDate.toLocaleFormat(&quot;%x&quot;) exits application</span>
<a href="#l76.2352"></a><span id="l76.2352" class="difflineplus">+          // if year before 1900 (e.g., typo) on MSWindows (due to MS bug).</span>
<a href="#l76.2353"></a><span id="l76.2353" class="difflineplus">+          let nsIScriptableDateFormat = Components.interfaces.nsIScriptableDateFormat;</span>
<a href="#l76.2354"></a><span id="l76.2354" class="difflineplus">+          let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l76.2355"></a><span id="l76.2355" class="difflineplus">+                                      .getService(nsIScriptableDateFormat);</span>
<a href="#l76.2356"></a><span id="l76.2356" class="difflineplus">+          return dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l76.2357"></a><span id="l76.2357" class="difflineplus">+                                        aDate.getFullYear(),</span>
<a href="#l76.2358"></a><span id="l76.2358" class="difflineplus">+                                        aDate.getMonth() + 1,</span>
<a href="#l76.2359"></a><span id="l76.2359" class="difflineplus">+                                        aDate.getDate());</span>
<a href="#l76.2360"></a><span id="l76.2360" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.2361"></a><span id="l76.2361">       &lt;/method&gt;</span>
<a href="#l76.2362"></a><span id="l76.2362"> </span>
<a href="#l76.2363"></a><span id="l76.2363">       &lt;method name=&quot;formatTime&quot;&gt;</span>
<a href="#l76.2364"></a><span id="l76.2364">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l76.2365"></a><span id="l76.2365" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l76.2366"></a><span id="l76.2366" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l76.2367"></a><span id="l76.2367" class="difflineminus">-            // remove leading zero in hours before colon in xx01:23pmxx</span>
<a href="#l76.2368"></a><span id="l76.2368" class="difflineminus">-            return aValue.toLocaleFormat(this.kTimeFormatString).replace(/0(\d):/, &quot;$1:&quot;);</span>
<a href="#l76.2369"></a><span id="l76.2369" class="difflineminus">-          ]]&gt;</span>
<a href="#l76.2370"></a><span id="l76.2370" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l76.2371"></a><span id="l76.2371" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l76.2372"></a><span id="l76.2372" class="difflineplus">+          // remove leading zero in hours before colon in xx01:23pmxx</span>
<a href="#l76.2373"></a><span id="l76.2373" class="difflineplus">+          return aValue.toLocaleFormat(this.kTimeFormatString).replace(/0(\d):/, &quot;$1:&quot;);</span>
<a href="#l76.2374"></a><span id="l76.2374" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l76.2375"></a><span id="l76.2375">       &lt;/method&gt;</span>
<a href="#l76.2376"></a><span id="l76.2376">     &lt;/implementation&gt;</span>
<a href="#l76.2377"></a><span id="l76.2377">   &lt;/binding&gt;</span>
<a href="#l76.2378"></a><span id="l76.2378" class="difflineminus">-</span>
<a href="#l76.2379"></a><span id="l76.2379"> &lt;/bindings&gt;</span>
<a href="#l76.2380"></a><span id="l76.2380" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -16,23 +16,23 @@</span>
<a href="#l77.4"></a><span id="l77.4"> /** PUBLIC</span>
<a href="#l77.5"></a><span id="l77.5">  *</span>
<a href="#l77.6"></a><span id="l77.6">  *  This changes the mouseover preview based on the start and end dates</span>
<a href="#l77.7"></a><span id="l77.7">  *  of an occurrence of a (one-time or recurring) calEvent or calToDo.</span>
<a href="#l77.8"></a><span id="l77.8">  *  Used by all grid views.</span>
<a href="#l77.9"></a><span id="l77.9">  */</span>
<a href="#l77.10"></a><span id="l77.10"> </span>
<a href="#l77.11"></a><span id="l77.11"> function onMouseOverItem(occurrenceBoxMouseEvent) {</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-  if (&quot;occurrence&quot; in occurrenceBoxMouseEvent.currentTarget) {</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineminus">-    // occurrence of repeating event or todo</span>
<a href="#l77.14"></a><span id="l77.14" class="difflineminus">-      let occurrence = occurrenceBoxMouseEvent.currentTarget.occurrence;</span>
<a href="#l77.15"></a><span id="l77.15" class="difflineminus">-      const toolTip = document.getElementById(&quot;itemTooltip&quot;);</span>
<a href="#l77.16"></a><span id="l77.16" class="difflineminus">-      return showToolTip(toolTip, occurrence);</span>
<a href="#l77.17"></a><span id="l77.17" class="difflineminus">-  }</span>
<a href="#l77.18"></a><span id="l77.18" class="difflineminus">-  return false;</span>
<a href="#l77.19"></a><span id="l77.19" class="difflineplus">+    if (&quot;occurrence&quot; in occurrenceBoxMouseEvent.currentTarget) {</span>
<a href="#l77.20"></a><span id="l77.20" class="difflineplus">+        // occurrence of repeating event or todo</span>
<a href="#l77.21"></a><span id="l77.21" class="difflineplus">+        let occurrence = occurrenceBoxMouseEvent.currentTarget.occurrence;</span>
<a href="#l77.22"></a><span id="l77.22" class="difflineplus">+        const toolTip = document.getElementById(&quot;itemTooltip&quot;);</span>
<a href="#l77.23"></a><span id="l77.23" class="difflineplus">+        return showToolTip(toolTip, occurrence);</span>
<a href="#l77.24"></a><span id="l77.24" class="difflineplus">+    }</span>
<a href="#l77.25"></a><span id="l77.25" class="difflineplus">+    return false;</span>
<a href="#l77.26"></a><span id="l77.26"> }</span>
<a href="#l77.27"></a><span id="l77.27"> </span>
<a href="#l77.28"></a><span id="l77.28"> function showToolTip(aToolTip, aItem) {</span>
<a href="#l77.29"></a><span id="l77.29">     if (aItem) {</span>
<a href="#l77.30"></a><span id="l77.30">         let holderBox;</span>
<a href="#l77.31"></a><span id="l77.31">         if (isEvent(aItem)) {</span>
<a href="#l77.32"></a><span id="l77.32">             holderBox = getPreviewForEvent(aItem);</span>
<a href="#l77.33"></a><span id="l77.33">         } else if (isToDo(aItem)) {</span>
<a href="#l77.34"></a><span id="l77.34" class="difflineat">@@ -46,299 +46,299 @@ function showToolTip(aToolTip, aItem) {</span>
<a href="#l77.35"></a><span id="l77.35">     }</span>
<a href="#l77.36"></a><span id="l77.36">     return false;</span>
<a href="#l77.37"></a><span id="l77.37"> }</span>
<a href="#l77.38"></a><span id="l77.38"> </span>
<a href="#l77.39"></a><span id="l77.39"> /**</span>
<a href="#l77.40"></a><span id="l77.40">  *  Called when a user hovers over a todo element and the text for the mouse over is changed.</span>
<a href="#l77.41"></a><span id="l77.41">  */</span>
<a href="#l77.42"></a><span id="l77.42"> function getPreviewForTask(toDoItem) {</span>
<a href="#l77.43"></a><span id="l77.43" class="difflineminus">-  if (toDoItem) {</span>
<a href="#l77.44"></a><span id="l77.44" class="difflineminus">-    const vbox = document.createElement(&quot;vbox&quot;);</span>
<a href="#l77.45"></a><span id="l77.45" class="difflineminus">-    vbox.setAttribute(&quot;class&quot;, &quot;tooltipBox&quot;);</span>
<a href="#l77.46"></a><span id="l77.46" class="difflineminus">-    // tooltip appears above or below pointer, so may have as little as</span>
<a href="#l77.47"></a><span id="l77.47" class="difflineminus">-    // one half the screen height available (avoid top going off screen).</span>
<a href="#l77.48"></a><span id="l77.48" class="difflineminus">-    vbox.maxHeight = Math.floor(screen.height / 2);</span>
<a href="#l77.49"></a><span id="l77.49" class="difflineminus">-    boxInitializeHeaderGrid(vbox);</span>
<a href="#l77.50"></a><span id="l77.50" class="difflineplus">+    if (toDoItem) {</span>
<a href="#l77.51"></a><span id="l77.51" class="difflineplus">+        const vbox = document.createElement(&quot;vbox&quot;);</span>
<a href="#l77.52"></a><span id="l77.52" class="difflineplus">+        vbox.setAttribute(&quot;class&quot;, &quot;tooltipBox&quot;);</span>
<a href="#l77.53"></a><span id="l77.53" class="difflineplus">+        // tooltip appears above or below pointer, so may have as little as</span>
<a href="#l77.54"></a><span id="l77.54" class="difflineplus">+        // one half the screen height available (avoid top going off screen).</span>
<a href="#l77.55"></a><span id="l77.55" class="difflineplus">+        vbox.maxHeight = Math.floor(screen.height / 2);</span>
<a href="#l77.56"></a><span id="l77.56" class="difflineplus">+        boxInitializeHeaderGrid(vbox);</span>
<a href="#l77.57"></a><span id="l77.57"> </span>
<a href="#l77.58"></a><span id="l77.58" class="difflineminus">-    let hasHeader = false;</span>
<a href="#l77.59"></a><span id="l77.59" class="difflineplus">+        let hasHeader = false;</span>
<a href="#l77.60"></a><span id="l77.60"> </span>
<a href="#l77.61"></a><span id="l77.61" class="difflineminus">-    if (toDoItem.title) {</span>
<a href="#l77.62"></a><span id="l77.62" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipTitle&quot;, toDoItem.title);</span>
<a href="#l77.63"></a><span id="l77.63" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.64"></a><span id="l77.64" class="difflineminus">-    }</span>
<a href="#l77.65"></a><span id="l77.65" class="difflineplus">+        if (toDoItem.title) {</span>
<a href="#l77.66"></a><span id="l77.66" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipTitle&quot;, toDoItem.title);</span>
<a href="#l77.67"></a><span id="l77.67" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.68"></a><span id="l77.68" class="difflineplus">+        }</span>
<a href="#l77.69"></a><span id="l77.69"> </span>
<a href="#l77.70"></a><span id="l77.70" class="difflineminus">-    let location = toDoItem.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l77.71"></a><span id="l77.71" class="difflineminus">-    if (location) {</span>
<a href="#l77.72"></a><span id="l77.72" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipLocation&quot;, location);</span>
<a href="#l77.73"></a><span id="l77.73" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.74"></a><span id="l77.74" class="difflineminus">-    }</span>
<a href="#l77.75"></a><span id="l77.75" class="difflineplus">+        let location = toDoItem.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l77.76"></a><span id="l77.76" class="difflineplus">+        if (location) {</span>
<a href="#l77.77"></a><span id="l77.77" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipLocation&quot;, location);</span>
<a href="#l77.78"></a><span id="l77.78" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.79"></a><span id="l77.79" class="difflineplus">+        }</span>
<a href="#l77.80"></a><span id="l77.80"> </span>
<a href="#l77.81"></a><span id="l77.81" class="difflineminus">-    // First try to get calendar name appearing in tooltip</span>
<a href="#l77.82"></a><span id="l77.82" class="difflineminus">-    if (toDoItem.calendar.name) {</span>
<a href="#l77.83"></a><span id="l77.83" class="difflineminus">-      let calendarNameString = toDoItem.calendar.name;</span>
<a href="#l77.84"></a><span id="l77.84" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipCalName&quot;, calendarNameString);</span>
<a href="#l77.85"></a><span id="l77.85" class="difflineminus">-    }</span>
<a href="#l77.86"></a><span id="l77.86" class="difflineplus">+        // First try to get calendar name appearing in tooltip</span>
<a href="#l77.87"></a><span id="l77.87" class="difflineplus">+        if (toDoItem.calendar.name) {</span>
<a href="#l77.88"></a><span id="l77.88" class="difflineplus">+            let calendarNameString = toDoItem.calendar.name;</span>
<a href="#l77.89"></a><span id="l77.89" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipCalName&quot;, calendarNameString);</span>
<a href="#l77.90"></a><span id="l77.90" class="difflineplus">+        }</span>
<a href="#l77.91"></a><span id="l77.91"> </span>
<a href="#l77.92"></a><span id="l77.92" class="difflineminus">-    if (toDoItem.entryDate &amp;&amp; toDoItem.entryDate.isValid) {</span>
<a href="#l77.93"></a><span id="l77.93" class="difflineminus">-      boxAppendLabeledDateTime(vbox, &quot;tooltipStart&quot;, toDoItem.entryDate);</span>
<a href="#l77.94"></a><span id="l77.94" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.95"></a><span id="l77.95" class="difflineminus">-    }</span>
<a href="#l77.96"></a><span id="l77.96" class="difflineplus">+        if (toDoItem.entryDate &amp;&amp; toDoItem.entryDate.isValid) {</span>
<a href="#l77.97"></a><span id="l77.97" class="difflineplus">+            boxAppendLabeledDateTime(vbox, &quot;tooltipStart&quot;, toDoItem.entryDate);</span>
<a href="#l77.98"></a><span id="l77.98" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.99"></a><span id="l77.99" class="difflineplus">+        }</span>
<a href="#l77.100"></a><span id="l77.100"> </span>
<a href="#l77.101"></a><span id="l77.101" class="difflineminus">-    if (toDoItem.dueDate &amp;&amp; toDoItem.dueDate.isValid) {</span>
<a href="#l77.102"></a><span id="l77.102" class="difflineminus">-      boxAppendLabeledDateTime(vbox, &quot;tooltipDue&quot;, toDoItem.dueDate);</span>
<a href="#l77.103"></a><span id="l77.103" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.104"></a><span id="l77.104" class="difflineminus">-    }</span>
<a href="#l77.105"></a><span id="l77.105" class="difflineplus">+        if (toDoItem.dueDate &amp;&amp; toDoItem.dueDate.isValid) {</span>
<a href="#l77.106"></a><span id="l77.106" class="difflineplus">+            boxAppendLabeledDateTime(vbox, &quot;tooltipDue&quot;, toDoItem.dueDate);</span>
<a href="#l77.107"></a><span id="l77.107" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.108"></a><span id="l77.108" class="difflineplus">+        }</span>
<a href="#l77.109"></a><span id="l77.109"> </span>
<a href="#l77.110"></a><span id="l77.110" class="difflineminus">-    if (toDoItem.priority &amp;&amp; toDoItem.priority != 0) {</span>
<a href="#l77.111"></a><span id="l77.111" class="difflineminus">-      let priorityInteger = parseInt(toDoItem.priority, 10);</span>
<a href="#l77.112"></a><span id="l77.112" class="difflineminus">-      let priorityString;</span>
<a href="#l77.113"></a><span id="l77.113" class="difflineplus">+        if (toDoItem.priority &amp;&amp; toDoItem.priority != 0) {</span>
<a href="#l77.114"></a><span id="l77.114" class="difflineplus">+            let priorityInteger = parseInt(toDoItem.priority, 10);</span>
<a href="#l77.115"></a><span id="l77.115" class="difflineplus">+            let priorityString;</span>
<a href="#l77.116"></a><span id="l77.116"> </span>
<a href="#l77.117"></a><span id="l77.117" class="difflineminus">-      // These cut-offs should match calendar-event-dialog.js</span>
<a href="#l77.118"></a><span id="l77.118" class="difflineminus">-      if (priorityInteger &gt;= 1 &amp;&amp; priorityInteger &lt;= 4) {</span>
<a href="#l77.119"></a><span id="l77.119" class="difflineminus">-           priorityString = calGetString(&quot;calendar&quot;, &quot;highPriority&quot;); // high priority</span>
<a href="#l77.120"></a><span id="l77.120" class="difflineminus">-      } else if (priorityInteger == 5) {</span>
<a href="#l77.121"></a><span id="l77.121" class="difflineminus">-          priorityString = calGetString(&quot;calendar&quot;, &quot;normalPriority&quot;); // normal priority</span>
<a href="#l77.122"></a><span id="l77.122" class="difflineminus">-      } else {</span>
<a href="#l77.123"></a><span id="l77.123" class="difflineminus">-          priorityString = calGetString(&quot;calendar&quot;, &quot;lowPriority&quot;); // low priority</span>
<a href="#l77.124"></a><span id="l77.124" class="difflineminus">-      }</span>
<a href="#l77.125"></a><span id="l77.125" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipPriority&quot;, priorityString);</span>
<a href="#l77.126"></a><span id="l77.126" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.127"></a><span id="l77.127" class="difflineminus">-    }</span>
<a href="#l77.128"></a><span id="l77.128" class="difflineplus">+            // These cut-offs should match calendar-event-dialog.js</span>
<a href="#l77.129"></a><span id="l77.129" class="difflineplus">+            if (priorityInteger &gt;= 1 &amp;&amp; priorityInteger &lt;= 4) {</span>
<a href="#l77.130"></a><span id="l77.130" class="difflineplus">+                priorityString = calGetString(&quot;calendar&quot;, &quot;highPriority&quot;); // high priority</span>
<a href="#l77.131"></a><span id="l77.131" class="difflineplus">+            } else if (priorityInteger == 5) {</span>
<a href="#l77.132"></a><span id="l77.132" class="difflineplus">+                priorityString = calGetString(&quot;calendar&quot;, &quot;normalPriority&quot;); // normal priority</span>
<a href="#l77.133"></a><span id="l77.133" class="difflineplus">+            } else {</span>
<a href="#l77.134"></a><span id="l77.134" class="difflineplus">+                priorityString = calGetString(&quot;calendar&quot;, &quot;lowPriority&quot;); // low priority</span>
<a href="#l77.135"></a><span id="l77.135" class="difflineplus">+            }</span>
<a href="#l77.136"></a><span id="l77.136" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipPriority&quot;, priorityString);</span>
<a href="#l77.137"></a><span id="l77.137" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.138"></a><span id="l77.138" class="difflineplus">+        }</span>
<a href="#l77.139"></a><span id="l77.139"> </span>
<a href="#l77.140"></a><span id="l77.140" class="difflineminus">-    if (toDoItem.status &amp;&amp; toDoItem.status != &quot;NONE&quot;) {</span>
<a href="#l77.141"></a><span id="l77.141" class="difflineminus">-      let status = getToDoStatusString(toDoItem);</span>
<a href="#l77.142"></a><span id="l77.142" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipStatus&quot;, status);</span>
<a href="#l77.143"></a><span id="l77.143" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.144"></a><span id="l77.144" class="difflineminus">-    }</span>
<a href="#l77.145"></a><span id="l77.145" class="difflineplus">+        if (toDoItem.status &amp;&amp; toDoItem.status != &quot;NONE&quot;) {</span>
<a href="#l77.146"></a><span id="l77.146" class="difflineplus">+            let status = getToDoStatusString(toDoItem);</span>
<a href="#l77.147"></a><span id="l77.147" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipStatus&quot;, status);</span>
<a href="#l77.148"></a><span id="l77.148" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.149"></a><span id="l77.149" class="difflineplus">+        }</span>
<a href="#l77.150"></a><span id="l77.150"> </span>
<a href="#l77.151"></a><span id="l77.151" class="difflineminus">-    if (toDoItem.status != null &amp;&amp; toDoItem.percentComplete != 0 &amp;&amp; toDoItem.percentComplete != 100) {</span>
<a href="#l77.152"></a><span id="l77.152" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipPercent&quot;, String(toDoItem.percentComplete) + &quot;%&quot;);</span>
<a href="#l77.153"></a><span id="l77.153" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.154"></a><span id="l77.154" class="difflineminus">-    } else if (toDoItem.percentComplete == 100) {</span>
<a href="#l77.155"></a><span id="l77.155" class="difflineminus">-      if (toDoItem.completedDate == null) {</span>
<a href="#l77.156"></a><span id="l77.156" class="difflineminus">-        boxAppendLabeledText(vbox, &quot;tooltipPercent&quot;, &quot;100%&quot;);</span>
<a href="#l77.157"></a><span id="l77.157" class="difflineminus">-      } else {</span>
<a href="#l77.158"></a><span id="l77.158" class="difflineminus">-        boxAppendLabeledDateTime(vbox, &quot;tooltipCompleted&quot;, toDoItem.completedDate);</span>
<a href="#l77.159"></a><span id="l77.159" class="difflineminus">-      }</span>
<a href="#l77.160"></a><span id="l77.160" class="difflineminus">-      hasHeader = true;</span>
<a href="#l77.161"></a><span id="l77.161" class="difflineminus">-    }</span>
<a href="#l77.162"></a><span id="l77.162" class="difflineplus">+        if (toDoItem.status != null &amp;&amp; toDoItem.percentComplete != 0 &amp;&amp; toDoItem.percentComplete != 100) {</span>
<a href="#l77.163"></a><span id="l77.163" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipPercent&quot;, String(toDoItem.percentComplete) + &quot;%&quot;);</span>
<a href="#l77.164"></a><span id="l77.164" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.165"></a><span id="l77.165" class="difflineplus">+        } else if (toDoItem.percentComplete == 100) {</span>
<a href="#l77.166"></a><span id="l77.166" class="difflineplus">+            if (toDoItem.completedDate == null) {</span>
<a href="#l77.167"></a><span id="l77.167" class="difflineplus">+                boxAppendLabeledText(vbox, &quot;tooltipPercent&quot;, &quot;100%&quot;);</span>
<a href="#l77.168"></a><span id="l77.168" class="difflineplus">+            } else {</span>
<a href="#l77.169"></a><span id="l77.169" class="difflineplus">+                boxAppendLabeledDateTime(vbox, &quot;tooltipCompleted&quot;, toDoItem.completedDate);</span>
<a href="#l77.170"></a><span id="l77.170" class="difflineplus">+            }</span>
<a href="#l77.171"></a><span id="l77.171" class="difflineplus">+            hasHeader = true;</span>
<a href="#l77.172"></a><span id="l77.172" class="difflineplus">+        }</span>
<a href="#l77.173"></a><span id="l77.173"> </span>
<a href="#l77.174"></a><span id="l77.174" class="difflineminus">-    let description = toDoItem.getProperty(&quot;DESCRIPTION&quot;);</span>
<a href="#l77.175"></a><span id="l77.175" class="difflineminus">-    if (description) {</span>
<a href="#l77.176"></a><span id="l77.176" class="difflineminus">-      // display wrapped description lines like body of message below headers</span>
<a href="#l77.177"></a><span id="l77.177" class="difflineminus">-      if (hasHeader) {</span>
<a href="#l77.178"></a><span id="l77.178" class="difflineminus">-        boxAppendBodySeparator(vbox);</span>
<a href="#l77.179"></a><span id="l77.179" class="difflineminus">-      }</span>
<a href="#l77.180"></a><span id="l77.180" class="difflineminus">-      boxAppendBody(vbox, description);</span>
<a href="#l77.181"></a><span id="l77.181" class="difflineplus">+        let description = toDoItem.getProperty(&quot;DESCRIPTION&quot;);</span>
<a href="#l77.182"></a><span id="l77.182" class="difflineplus">+        if (description) {</span>
<a href="#l77.183"></a><span id="l77.183" class="difflineplus">+            // display wrapped description lines like body of message below headers</span>
<a href="#l77.184"></a><span id="l77.184" class="difflineplus">+            if (hasHeader) {</span>
<a href="#l77.185"></a><span id="l77.185" class="difflineplus">+                boxAppendBodySeparator(vbox);</span>
<a href="#l77.186"></a><span id="l77.186" class="difflineplus">+            }</span>
<a href="#l77.187"></a><span id="l77.187" class="difflineplus">+            boxAppendBody(vbox, description);</span>
<a href="#l77.188"></a><span id="l77.188" class="difflineplus">+        }</span>
<a href="#l77.189"></a><span id="l77.189" class="difflineplus">+</span>
<a href="#l77.190"></a><span id="l77.190" class="difflineplus">+        return vbox;</span>
<a href="#l77.191"></a><span id="l77.191" class="difflineplus">+    } else {</span>
<a href="#l77.192"></a><span id="l77.192" class="difflineplus">+        return null;</span>
<a href="#l77.193"></a><span id="l77.193">     }</span>
<a href="#l77.194"></a><span id="l77.194" class="difflineminus">-</span>
<a href="#l77.195"></a><span id="l77.195" class="difflineminus">-    return vbox;</span>
<a href="#l77.196"></a><span id="l77.196" class="difflineminus">-  } else {</span>
<a href="#l77.197"></a><span id="l77.197" class="difflineminus">-    return null;</span>
<a href="#l77.198"></a><span id="l77.198" class="difflineminus">-  }</span>
<a href="#l77.199"></a><span id="l77.199"> }</span>
<a href="#l77.200"></a><span id="l77.200"> </span>
<a href="#l77.201"></a><span id="l77.201"> /**</span>
<a href="#l77.202"></a><span id="l77.202">  *  Called when mouse moves over a different, or</span>
<a href="#l77.203"></a><span id="l77.203">  *  when mouse moves over event in event list.</span>
<a href="#l77.204"></a><span id="l77.204">  *  The instStartDate is date of instance displayed at event box</span>
<a href="#l77.205"></a><span id="l77.205">  *  (recurring or multiday events may be displayed by more than one event box</span>
<a href="#l77.206"></a><span id="l77.206">  *  for different days), or null if should compute next instance from now.</span>
<a href="#l77.207"></a><span id="l77.207">  */</span>
<a href="#l77.208"></a><span id="l77.208"> function getPreviewForEvent(aEvent) {</span>
<a href="#l77.209"></a><span id="l77.209" class="difflineminus">-  let event = aEvent;</span>
<a href="#l77.210"></a><span id="l77.210" class="difflineminus">-  const vbox = document.createElement(&quot;vbox&quot;);</span>
<a href="#l77.211"></a><span id="l77.211" class="difflineminus">-  vbox.setAttribute(&quot;class&quot;, &quot;tooltipBox&quot;);</span>
<a href="#l77.212"></a><span id="l77.212" class="difflineminus">-  // tooltip appears above or below pointer, so may have as little as</span>
<a href="#l77.213"></a><span id="l77.213" class="difflineminus">-  // one half the screen height available (avoid top going off screen).</span>
<a href="#l77.214"></a><span id="l77.214" class="difflineminus">-  vbox.maxHeight = Math.floor(screen.height / 2);</span>
<a href="#l77.215"></a><span id="l77.215" class="difflineminus">-  boxInitializeHeaderGrid(vbox);</span>
<a href="#l77.216"></a><span id="l77.216" class="difflineplus">+    let event = aEvent;</span>
<a href="#l77.217"></a><span id="l77.217" class="difflineplus">+    const vbox = document.createElement(&quot;vbox&quot;);</span>
<a href="#l77.218"></a><span id="l77.218" class="difflineplus">+    vbox.setAttribute(&quot;class&quot;, &quot;tooltipBox&quot;);</span>
<a href="#l77.219"></a><span id="l77.219" class="difflineplus">+    // tooltip appears above or below pointer, so may have as little as</span>
<a href="#l77.220"></a><span id="l77.220" class="difflineplus">+    // one half the screen height available (avoid top going off screen).</span>
<a href="#l77.221"></a><span id="l77.221" class="difflineplus">+    vbox.maxHeight = Math.floor(screen.height / 2);</span>
<a href="#l77.222"></a><span id="l77.222" class="difflineplus">+    boxInitializeHeaderGrid(vbox);</span>
<a href="#l77.223"></a><span id="l77.223"> </span>
<a href="#l77.224"></a><span id="l77.224" class="difflineminus">-  if (event) {</span>
<a href="#l77.225"></a><span id="l77.225" class="difflineminus">-    if (event.title) {</span>
<a href="#l77.226"></a><span id="l77.226" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipTitle&quot;, aEvent.title);</span>
<a href="#l77.227"></a><span id="l77.227" class="difflineminus">-    }</span>
<a href="#l77.228"></a><span id="l77.228" class="difflineplus">+    if (event) {</span>
<a href="#l77.229"></a><span id="l77.229" class="difflineplus">+        if (event.title) {</span>
<a href="#l77.230"></a><span id="l77.230" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipTitle&quot;, aEvent.title);</span>
<a href="#l77.231"></a><span id="l77.231" class="difflineplus">+        }</span>
<a href="#l77.232"></a><span id="l77.232"> </span>
<a href="#l77.233"></a><span id="l77.233" class="difflineminus">-    let location = event.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l77.234"></a><span id="l77.234" class="difflineminus">-    if (location) {</span>
<a href="#l77.235"></a><span id="l77.235" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipLocation&quot;, location);</span>
<a href="#l77.236"></a><span id="l77.236" class="difflineminus">-    }</span>
<a href="#l77.237"></a><span id="l77.237" class="difflineminus">-    if (!(event.startDate &amp;&amp; event.endDate)) {</span>
<a href="#l77.238"></a><span id="l77.238" class="difflineminus">-        // Event may be recurrent event.   If no displayed instance specified,</span>
<a href="#l77.239"></a><span id="l77.239" class="difflineminus">-        // use next instance, or previous instance if no next instance.</span>
<a href="#l77.240"></a><span id="l77.240" class="difflineminus">-        event = getCurrentNextOrPreviousRecurrence(event);</span>
<a href="#l77.241"></a><span id="l77.241" class="difflineminus">-    }</span>
<a href="#l77.242"></a><span id="l77.242" class="difflineminus">-    boxAppendLabeledDateTimeInterval(vbox, &quot;tooltipDate&quot;, event);</span>
<a href="#l77.243"></a><span id="l77.243" class="difflineplus">+        let location = event.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l77.244"></a><span id="l77.244" class="difflineplus">+        if (location) {</span>
<a href="#l77.245"></a><span id="l77.245" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipLocation&quot;, location);</span>
<a href="#l77.246"></a><span id="l77.246" class="difflineplus">+        }</span>
<a href="#l77.247"></a><span id="l77.247" class="difflineplus">+        if (!(event.startDate &amp;&amp; event.endDate)) {</span>
<a href="#l77.248"></a><span id="l77.248" class="difflineplus">+            // Event may be recurrent event.   If no displayed instance specified,</span>
<a href="#l77.249"></a><span id="l77.249" class="difflineplus">+            // use next instance, or previous instance if no next instance.</span>
<a href="#l77.250"></a><span id="l77.250" class="difflineplus">+            event = getCurrentNextOrPreviousRecurrence(event);</span>
<a href="#l77.251"></a><span id="l77.251" class="difflineplus">+        }</span>
<a href="#l77.252"></a><span id="l77.252" class="difflineplus">+        boxAppendLabeledDateTimeInterval(vbox, &quot;tooltipDate&quot;, event);</span>
<a href="#l77.253"></a><span id="l77.253"> </span>
<a href="#l77.254"></a><span id="l77.254" class="difflineminus">-    // First try to get calendar name appearing in tooltip</span>
<a href="#l77.255"></a><span id="l77.255" class="difflineminus">-    if (event.calendar.name) {</span>
<a href="#l77.256"></a><span id="l77.256" class="difflineminus">-      let calendarNameString = event.calendar.name;</span>
<a href="#l77.257"></a><span id="l77.257" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipCalName&quot;, calendarNameString);</span>
<a href="#l77.258"></a><span id="l77.258" class="difflineminus">-    }</span>
<a href="#l77.259"></a><span id="l77.259" class="difflineplus">+        // First try to get calendar name appearing in tooltip</span>
<a href="#l77.260"></a><span id="l77.260" class="difflineplus">+        if (event.calendar.name) {</span>
<a href="#l77.261"></a><span id="l77.261" class="difflineplus">+            let calendarNameString = event.calendar.name;</span>
<a href="#l77.262"></a><span id="l77.262" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipCalName&quot;, calendarNameString);</span>
<a href="#l77.263"></a><span id="l77.263" class="difflineplus">+        }</span>
<a href="#l77.264"></a><span id="l77.264"> </span>
<a href="#l77.265"></a><span id="l77.265" class="difflineminus">-    if (event.status &amp;&amp; event.status != &quot;NONE&quot;) {</span>
<a href="#l77.266"></a><span id="l77.266" class="difflineminus">-      let statusString = getEventStatusString(event);</span>
<a href="#l77.267"></a><span id="l77.267" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipStatus&quot;, statusString);</span>
<a href="#l77.268"></a><span id="l77.268" class="difflineminus">-    }</span>
<a href="#l77.269"></a><span id="l77.269" class="difflineplus">+        if (event.status &amp;&amp; event.status != &quot;NONE&quot;) {</span>
<a href="#l77.270"></a><span id="l77.270" class="difflineplus">+            let statusString = getEventStatusString(event);</span>
<a href="#l77.271"></a><span id="l77.271" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipStatus&quot;, statusString);</span>
<a href="#l77.272"></a><span id="l77.272" class="difflineplus">+        }</span>
<a href="#l77.273"></a><span id="l77.273"> </span>
<a href="#l77.274"></a><span id="l77.274" class="difflineminus">-    if (event.organizer &amp;&amp; event.getAttendees({}).length &gt; 0) {</span>
<a href="#l77.275"></a><span id="l77.275" class="difflineminus">-      let organizer = event.organizer;</span>
<a href="#l77.276"></a><span id="l77.276" class="difflineminus">-      boxAppendLabeledText(vbox, &quot;tooltipOrganizer&quot;, organizer);</span>
<a href="#l77.277"></a><span id="l77.277" class="difflineminus">-    }</span>
<a href="#l77.278"></a><span id="l77.278" class="difflineplus">+        if (event.organizer &amp;&amp; event.getAttendees({}).length &gt; 0) {</span>
<a href="#l77.279"></a><span id="l77.279" class="difflineplus">+            let organizer = event.organizer;</span>
<a href="#l77.280"></a><span id="l77.280" class="difflineplus">+            boxAppendLabeledText(vbox, &quot;tooltipOrganizer&quot;, organizer);</span>
<a href="#l77.281"></a><span id="l77.281" class="difflineplus">+        }</span>
<a href="#l77.282"></a><span id="l77.282"> </span>
<a href="#l77.283"></a><span id="l77.283" class="difflineminus">-    let description = event.getProperty(&quot;DESCRIPTION&quot;);</span>
<a href="#l77.284"></a><span id="l77.284" class="difflineminus">-    if (description) {</span>
<a href="#l77.285"></a><span id="l77.285" class="difflineminus">-      boxAppendBodySeparator(vbox);</span>
<a href="#l77.286"></a><span id="l77.286" class="difflineminus">-      // display wrapped description lines, like body of message below headers</span>
<a href="#l77.287"></a><span id="l77.287" class="difflineminus">-      boxAppendBody(vbox, description);</span>
<a href="#l77.288"></a><span id="l77.288" class="difflineplus">+        let description = event.getProperty(&quot;DESCRIPTION&quot;);</span>
<a href="#l77.289"></a><span id="l77.289" class="difflineplus">+        if (description) {</span>
<a href="#l77.290"></a><span id="l77.290" class="difflineplus">+            boxAppendBodySeparator(vbox);</span>
<a href="#l77.291"></a><span id="l77.291" class="difflineplus">+            // display wrapped description lines, like body of message below headers</span>
<a href="#l77.292"></a><span id="l77.292" class="difflineplus">+            boxAppendBody(vbox, description);</span>
<a href="#l77.293"></a><span id="l77.293" class="difflineplus">+        }</span>
<a href="#l77.294"></a><span id="l77.294" class="difflineplus">+        return vbox;</span>
<a href="#l77.295"></a><span id="l77.295" class="difflineplus">+    } else {</span>
<a href="#l77.296"></a><span id="l77.296" class="difflineplus">+        return null;</span>
<a href="#l77.297"></a><span id="l77.297">     }</span>
<a href="#l77.298"></a><span id="l77.298" class="difflineminus">-    return vbox;</span>
<a href="#l77.299"></a><span id="l77.299" class="difflineminus">-  } else {</span>
<a href="#l77.300"></a><span id="l77.300" class="difflineminus">-      return null;</span>
<a href="#l77.301"></a><span id="l77.301" class="difflineminus">-  }</span>
<a href="#l77.302"></a><span id="l77.302"> }</span>
<a href="#l77.303"></a><span id="l77.303"> </span>
<a href="#l77.304"></a><span id="l77.304"> </span>
<a href="#l77.305"></a><span id="l77.305"> /** String for event status: (none), Tentative, Confirmed, or Cancelled **/</span>
<a href="#l77.306"></a><span id="l77.306"> function getEventStatusString(calendarEvent) {</span>
<a href="#l77.307"></a><span id="l77.307" class="difflineminus">-  switch (calendarEvent.status) {</span>
<a href="#l77.308"></a><span id="l77.308" class="difflineminus">-    // Event status value keywords are specified in RFC2445sec4.8.1.11</span>
<a href="#l77.309"></a><span id="l77.309" class="difflineminus">-    case &quot;TENTATIVE&quot;:</span>
<a href="#l77.310"></a><span id="l77.310" class="difflineminus">-      return calGetString(&quot;calendar&quot;, &quot;statusTentative&quot;);</span>
<a href="#l77.311"></a><span id="l77.311" class="difflineminus">-    case &quot;CONFIRMED&quot;:</span>
<a href="#l77.312"></a><span id="l77.312" class="difflineminus">-      return calGetString(&quot;calendar&quot;, &quot;statusConfirmed&quot;);</span>
<a href="#l77.313"></a><span id="l77.313" class="difflineminus">-    case &quot;CANCELLED&quot;:</span>
<a href="#l77.314"></a><span id="l77.314" class="difflineminus">-      return calGetString(&quot;calendar&quot;, &quot;eventStatusCancelled&quot;);</span>
<a href="#l77.315"></a><span id="l77.315" class="difflineminus">-     default:</span>
<a href="#l77.316"></a><span id="l77.316" class="difflineminus">-        return &quot;&quot;;</span>
<a href="#l77.317"></a><span id="l77.317" class="difflineminus">-  }</span>
<a href="#l77.318"></a><span id="l77.318" class="difflineplus">+    switch (calendarEvent.status) {</span>
<a href="#l77.319"></a><span id="l77.319" class="difflineplus">+        // Event status value keywords are specified in RFC2445sec4.8.1.11</span>
<a href="#l77.320"></a><span id="l77.320" class="difflineplus">+        case &quot;TENTATIVE&quot;:</span>
<a href="#l77.321"></a><span id="l77.321" class="difflineplus">+            return calGetString(&quot;calendar&quot;, &quot;statusTentative&quot;);</span>
<a href="#l77.322"></a><span id="l77.322" class="difflineplus">+        case &quot;CONFIRMED&quot;:</span>
<a href="#l77.323"></a><span id="l77.323" class="difflineplus">+            return calGetString(&quot;calendar&quot;, &quot;statusConfirmed&quot;);</span>
<a href="#l77.324"></a><span id="l77.324" class="difflineplus">+        case &quot;CANCELLED&quot;:</span>
<a href="#l77.325"></a><span id="l77.325" class="difflineplus">+            return calGetString(&quot;calendar&quot;, &quot;eventStatusCancelled&quot;);</span>
<a href="#l77.326"></a><span id="l77.326" class="difflineplus">+        default:</span>
<a href="#l77.327"></a><span id="l77.327" class="difflineplus">+            return &quot;&quot;;</span>
<a href="#l77.328"></a><span id="l77.328" class="difflineplus">+    }</span>
<a href="#l77.329"></a><span id="l77.329"> }</span>
<a href="#l77.330"></a><span id="l77.330"> </span>
<a href="#l77.331"></a><span id="l77.331"> /** String for todo status: (none), NeedsAction, InProcess, Cancelled, or Completed **/</span>
<a href="#l77.332"></a><span id="l77.332"> function getToDoStatusString(iCalToDo) {</span>
<a href="#l77.333"></a><span id="l77.333" class="difflineminus">-  switch (iCalToDo.status) {</span>
<a href="#l77.334"></a><span id="l77.334" class="difflineminus">-    // Todo status keywords are specified in RFC2445sec4.8.1.11</span>
<a href="#l77.335"></a><span id="l77.335" class="difflineminus">-    case &quot;NEEDS-ACTION&quot;:</span>
<a href="#l77.336"></a><span id="l77.336" class="difflineminus">-      return calGetString(&quot;calendar&quot;, &quot;statusNeedsAction&quot;);</span>
<a href="#l77.337"></a><span id="l77.337" class="difflineminus">-    case &quot;IN-PROCESS&quot;:</span>
<a href="#l77.338"></a><span id="l77.338" class="difflineminus">-      return calGetString(&quot;calendar&quot;, &quot;statusInProcess&quot;);</span>
<a href="#l77.339"></a><span id="l77.339" class="difflineminus">-    case &quot;CANCELLED&quot;:</span>
<a href="#l77.340"></a><span id="l77.340" class="difflineminus">-      return calGetString(&quot;calendar&quot;, &quot;todoStatusCancelled&quot;);</span>
<a href="#l77.341"></a><span id="l77.341" class="difflineminus">-    case &quot;COMPLETED&quot;:</span>
<a href="#l77.342"></a><span id="l77.342" class="difflineminus">-      return calGetString(&quot;calendar&quot;, &quot;statusCompleted&quot;);</span>
<a href="#l77.343"></a><span id="l77.343" class="difflineminus">-     default:</span>
<a href="#l77.344"></a><span id="l77.344" class="difflineminus">-        return &quot;&quot;;</span>
<a href="#l77.345"></a><span id="l77.345" class="difflineminus">-  }</span>
<a href="#l77.346"></a><span id="l77.346" class="difflineplus">+    switch (iCalToDo.status) {</span>
<a href="#l77.347"></a><span id="l77.347" class="difflineplus">+        // Todo status keywords are specified in RFC2445sec4.8.1.11</span>
<a href="#l77.348"></a><span id="l77.348" class="difflineplus">+        case &quot;NEEDS-ACTION&quot;:</span>
<a href="#l77.349"></a><span id="l77.349" class="difflineplus">+            return calGetString(&quot;calendar&quot;, &quot;statusNeedsAction&quot;);</span>
<a href="#l77.350"></a><span id="l77.350" class="difflineplus">+        case &quot;IN-PROCESS&quot;:</span>
<a href="#l77.351"></a><span id="l77.351" class="difflineplus">+            return calGetString(&quot;calendar&quot;, &quot;statusInProcess&quot;);</span>
<a href="#l77.352"></a><span id="l77.352" class="difflineplus">+        case &quot;CANCELLED&quot;:</span>
<a href="#l77.353"></a><span id="l77.353" class="difflineplus">+            return calGetString(&quot;calendar&quot;, &quot;todoStatusCancelled&quot;);</span>
<a href="#l77.354"></a><span id="l77.354" class="difflineplus">+        case &quot;COMPLETED&quot;:</span>
<a href="#l77.355"></a><span id="l77.355" class="difflineplus">+            return calGetString(&quot;calendar&quot;, &quot;statusCompleted&quot;);</span>
<a href="#l77.356"></a><span id="l77.356" class="difflineplus">+        default:</span>
<a href="#l77.357"></a><span id="l77.357" class="difflineplus">+            return &quot;&quot;;</span>
<a href="#l77.358"></a><span id="l77.358" class="difflineplus">+    }</span>
<a href="#l77.359"></a><span id="l77.359"> }</span>
<a href="#l77.360"></a><span id="l77.360"> </span>
<a href="#l77.361"></a><span id="l77.361"> /**</span>
<a href="#l77.362"></a><span id="l77.362">  * PRIVATE: Append a separator, a thin space between header and body.</span>
<a href="#l77.363"></a><span id="l77.363">  *</span>
<a href="#l77.364"></a><span id="l77.364">  * @param vbox      box to which to append separator.</span>
<a href="#l77.365"></a><span id="l77.365">  */</span>
<a href="#l77.366"></a><span id="l77.366"> function boxAppendBodySeparator(vbox) {</span>
<a href="#l77.367"></a><span id="l77.367" class="difflineminus">-  const separator = document.createElement(&quot;separator&quot;);</span>
<a href="#l77.368"></a><span id="l77.368" class="difflineminus">-  separator.setAttribute(&quot;class&quot;, &quot;tooltipBodySeparator&quot;);</span>
<a href="#l77.369"></a><span id="l77.369" class="difflineminus">-  vbox.appendChild(separator);</span>
<a href="#l77.370"></a><span id="l77.370" class="difflineplus">+    const separator = document.createElement(&quot;separator&quot;);</span>
<a href="#l77.371"></a><span id="l77.371" class="difflineplus">+    separator.setAttribute(&quot;class&quot;, &quot;tooltipBodySeparator&quot;);</span>
<a href="#l77.372"></a><span id="l77.372" class="difflineplus">+    vbox.appendChild(separator);</span>
<a href="#l77.373"></a><span id="l77.373"> }</span>
<a href="#l77.374"></a><span id="l77.374"> </span>
<a href="#l77.375"></a><span id="l77.375"> /**</span>
<a href="#l77.376"></a><span id="l77.376">  * PRIVATE: Append description to box for body text.  Text may contain</span>
<a href="#l77.377"></a><span id="l77.377">  * paragraphs; line indent and line breaks will be preserved by CSS.</span>
<a href="#l77.378"></a><span id="l77.378">  * @param box           box to which to append body</span>
<a href="#l77.379"></a><span id="l77.379">  * @param textString    text of body</span>
<a href="#l77.380"></a><span id="l77.380">  */</span>
<a href="#l77.381"></a><span id="l77.381"> function boxAppendBody(box, textString) {</span>
<a href="#l77.382"></a><span id="l77.382" class="difflineminus">-  let textNode = document.createTextNode(textString);</span>
<a href="#l77.383"></a><span id="l77.383" class="difflineminus">-  let xulDescription = document.createElement(&quot;description&quot;);</span>
<a href="#l77.384"></a><span id="l77.384" class="difflineminus">-  xulDescription.setAttribute(&quot;class&quot;, &quot;tooltipBody&quot;);</span>
<a href="#l77.385"></a><span id="l77.385" class="difflineminus">-  xulDescription.appendChild(textNode);</span>
<a href="#l77.386"></a><span id="l77.386" class="difflineminus">-  box.appendChild(xulDescription);</span>
<a href="#l77.387"></a><span id="l77.387" class="difflineplus">+    let textNode = document.createTextNode(textString);</span>
<a href="#l77.388"></a><span id="l77.388" class="difflineplus">+    let xulDescription = document.createElement(&quot;description&quot;);</span>
<a href="#l77.389"></a><span id="l77.389" class="difflineplus">+    xulDescription.setAttribute(&quot;class&quot;, &quot;tooltipBody&quot;);</span>
<a href="#l77.390"></a><span id="l77.390" class="difflineplus">+    xulDescription.appendChild(textNode);</span>
<a href="#l77.391"></a><span id="l77.391" class="difflineplus">+    box.appendChild(xulDescription);</span>
<a href="#l77.392"></a><span id="l77.392"> }</span>
<a href="#l77.393"></a><span id="l77.393"> </span>
<a href="#l77.394"></a><span id="l77.394"> /**</span>
<a href="#l77.395"></a><span id="l77.395">  * PRIVATE: Use dateFormatter to format date and time,</span>
<a href="#l77.396"></a><span id="l77.396">  * and to header grid append a row containing localized Label: date.</span>
<a href="#l77.397"></a><span id="l77.397">  */</span>
<a href="#l77.398"></a><span id="l77.398"> function boxAppendLabeledDateTime(box, labelProperty, date) {</span>
<a href="#l77.399"></a><span id="l77.399" class="difflineminus">-  date = date.getInTimezone(calendarDefaultTimezone());</span>
<a href="#l77.400"></a><span id="l77.400" class="difflineminus">-  let formattedDateTime = getDateFormatter().formatDateTime(date);</span>
<a href="#l77.401"></a><span id="l77.401" class="difflineminus">-  boxAppendLabeledText(box, labelProperty, formattedDateTime);</span>
<a href="#l77.402"></a><span id="l77.402" class="difflineplus">+    date = date.getInTimezone(calendarDefaultTimezone());</span>
<a href="#l77.403"></a><span id="l77.403" class="difflineplus">+    let formattedDateTime = getDateFormatter().formatDateTime(date);</span>
<a href="#l77.404"></a><span id="l77.404" class="difflineplus">+    boxAppendLabeledText(box, labelProperty, formattedDateTime);</span>
<a href="#l77.405"></a><span id="l77.405"> }</span>
<a href="#l77.406"></a><span id="l77.406"> </span>
<a href="#l77.407"></a><span id="l77.407"> /**</span>
<a href="#l77.408"></a><span id="l77.408">  * PRIVATE: Use dateFormatter to format date and time interval,</span>
<a href="#l77.409"></a><span id="l77.409">  * and to header grid append a row containing localized Label: interval.</span>
<a href="#l77.410"></a><span id="l77.410">  * @param box               contains header grid.</span>
<a href="#l77.411"></a><span id="l77.411">  * @param labelProperty     name of property for localized field label.</span>
<a href="#l77.412"></a><span id="l77.412">  * @param item              the event or task</span>
<a href="#l77.413"></a><span id="l77.413">  */</span>
<a href="#l77.414"></a><span id="l77.414"> function boxAppendLabeledDateTimeInterval(box, labelProperty, item) {</span>
<a href="#l77.415"></a><span id="l77.415" class="difflineminus">-  let dateString = getDateFormatter().formatItemInterval(item);</span>
<a href="#l77.416"></a><span id="l77.416" class="difflineminus">-  boxAppendLabeledText(box, labelProperty, dateString);</span>
<a href="#l77.417"></a><span id="l77.417" class="difflineplus">+    let dateString = getDateFormatter().formatItemInterval(item);</span>
<a href="#l77.418"></a><span id="l77.418" class="difflineplus">+    boxAppendLabeledText(box, labelProperty, dateString);</span>
<a href="#l77.419"></a><span id="l77.419"> }</span>
<a href="#l77.420"></a><span id="l77.420"> </span>
<a href="#l77.421"></a><span id="l77.421"> /**</span>
<a href="#l77.422"></a><span id="l77.422">  * PRIVATE: create empty 2-column grid for header fields,</span>
<a href="#l77.423"></a><span id="l77.423">  * and append it to box.</span>
<a href="#l77.424"></a><span id="l77.424">  */</span>
<a href="#l77.425"></a><span id="l77.425"> function boxInitializeHeaderGrid(box) {</span>
<a href="#l77.426"></a><span id="l77.426" class="difflineminus">-  let grid = document.createElement(&quot;grid&quot;);</span>
<a href="#l77.427"></a><span id="l77.427" class="difflineminus">-  grid.setAttribute(&quot;class&quot;, &quot;tooltipHeaderGrid&quot;);</span>
<a href="#l77.428"></a><span id="l77.428" class="difflineminus">-  let rows;</span>
<a href="#l77.429"></a><span id="l77.429" class="difflineminus">-  {</span>
<a href="#l77.430"></a><span id="l77.430" class="difflineminus">-    let columns = document.createElement(&quot;columns&quot;);</span>
<a href="#l77.431"></a><span id="l77.431" class="difflineplus">+    let grid = document.createElement(&quot;grid&quot;);</span>
<a href="#l77.432"></a><span id="l77.432" class="difflineplus">+    grid.setAttribute(&quot;class&quot;, &quot;tooltipHeaderGrid&quot;);</span>
<a href="#l77.433"></a><span id="l77.433" class="difflineplus">+    let rows;</span>
<a href="#l77.434"></a><span id="l77.434">     {</span>
<a href="#l77.435"></a><span id="l77.435" class="difflineminus">-      let labelColumn = document.createElement(&quot;column&quot;);</span>
<a href="#l77.436"></a><span id="l77.436" class="difflineminus">-      labelColumn.setAttribute(&quot;class&quot;, &quot;tooltipLabelColumn&quot;);</span>
<a href="#l77.437"></a><span id="l77.437" class="difflineminus">-      columns.appendChild(labelColumn);</span>
<a href="#l77.438"></a><span id="l77.438" class="difflineminus">-      let valueColumn = document.createElement(&quot;column&quot;);</span>
<a href="#l77.439"></a><span id="l77.439" class="difflineminus">-      valueColumn.setAttribute(&quot;class&quot;, &quot;tooltipValueColumn&quot;);</span>
<a href="#l77.440"></a><span id="l77.440" class="difflineminus">-      columns.appendChild(valueColumn);</span>
<a href="#l77.441"></a><span id="l77.441" class="difflineplus">+        let columns = document.createElement(&quot;columns&quot;);</span>
<a href="#l77.442"></a><span id="l77.442" class="difflineplus">+        {</span>
<a href="#l77.443"></a><span id="l77.443" class="difflineplus">+            let labelColumn = document.createElement(&quot;column&quot;);</span>
<a href="#l77.444"></a><span id="l77.444" class="difflineplus">+            labelColumn.setAttribute(&quot;class&quot;, &quot;tooltipLabelColumn&quot;);</span>
<a href="#l77.445"></a><span id="l77.445" class="difflineplus">+            columns.appendChild(labelColumn);</span>
<a href="#l77.446"></a><span id="l77.446" class="difflineplus">+            let valueColumn = document.createElement(&quot;column&quot;);</span>
<a href="#l77.447"></a><span id="l77.447" class="difflineplus">+            valueColumn.setAttribute(&quot;class&quot;, &quot;tooltipValueColumn&quot;);</span>
<a href="#l77.448"></a><span id="l77.448" class="difflineplus">+            columns.appendChild(valueColumn);</span>
<a href="#l77.449"></a><span id="l77.449" class="difflineplus">+        }</span>
<a href="#l77.450"></a><span id="l77.450" class="difflineplus">+        grid.appendChild(columns);</span>
<a href="#l77.451"></a><span id="l77.451" class="difflineplus">+        rows = document.createElement(&quot;rows&quot;);</span>
<a href="#l77.452"></a><span id="l77.452" class="difflineplus">+        grid.appendChild(rows);</span>
<a href="#l77.453"></a><span id="l77.453">     }</span>
<a href="#l77.454"></a><span id="l77.454" class="difflineminus">-    grid.appendChild(columns);</span>
<a href="#l77.455"></a><span id="l77.455" class="difflineminus">-    rows = document.createElement(&quot;rows&quot;);</span>
<a href="#l77.456"></a><span id="l77.456" class="difflineminus">-    grid.appendChild(rows);</span>
<a href="#l77.457"></a><span id="l77.457" class="difflineminus">-  }</span>
<a href="#l77.458"></a><span id="l77.458" class="difflineminus">-  box.appendChild(grid);</span>
<a href="#l77.459"></a><span id="l77.459" class="difflineplus">+    box.appendChild(grid);</span>
<a href="#l77.460"></a><span id="l77.460"> }</span>
<a href="#l77.461"></a><span id="l77.461"> </span>
<a href="#l77.462"></a><span id="l77.462"> /**</span>
<a href="#l77.463"></a><span id="l77.463">  * PRIVATE: To headers grid, append a row containing Label: value,</span>
<a href="#l77.464"></a><span id="l77.464">  * where label is localized text for labelProperty.</span>
<a href="#l77.465"></a><span id="l77.465">  * @param box               box containing headers grid</span>
<a href="#l77.466"></a><span id="l77.466">  * @param labelProperty     name of property for localized name of header</span>
<a href="#l77.467"></a><span id="l77.467">  * @param textString        value of header field.</span>
<a href="#l77.468"></a><span id="l77.468">  */</span>
<a href="#l77.469"></a><span id="l77.469"> function boxAppendLabeledText(box, labelProperty, textString) {</span>
<a href="#l77.470"></a><span id="l77.470" class="difflineminus">-  let labelText = calGetString(&quot;calendar&quot;, labelProperty);</span>
<a href="#l77.471"></a><span id="l77.471" class="difflineminus">-  let rows = box.getElementsByTagNameNS(box.namespaceURI, &quot;rows&quot;)[0];</span>
<a href="#l77.472"></a><span id="l77.472" class="difflineminus">-  let row = document.createElement(&quot;row&quot;);</span>
<a href="#l77.473"></a><span id="l77.473" class="difflineplus">+    let labelText = calGetString(&quot;calendar&quot;, labelProperty);</span>
<a href="#l77.474"></a><span id="l77.474" class="difflineplus">+    let rows = box.getElementsByTagNameNS(box.namespaceURI, &quot;rows&quot;)[0];</span>
<a href="#l77.475"></a><span id="l77.475" class="difflineplus">+    let row = document.createElement(&quot;row&quot;);</span>
<a href="#l77.476"></a><span id="l77.476"> </span>
<a href="#l77.477"></a><span id="l77.477" class="difflineminus">-  row.appendChild(createTooltipHeaderLabel(labelText));</span>
<a href="#l77.478"></a><span id="l77.478" class="difflineminus">-  row.appendChild(createTooltipHeaderDescription(textString));</span>
<a href="#l77.479"></a><span id="l77.479" class="difflineplus">+    row.appendChild(createTooltipHeaderLabel(labelText));</span>
<a href="#l77.480"></a><span id="l77.480" class="difflineplus">+    row.appendChild(createTooltipHeaderDescription(textString));</span>
<a href="#l77.481"></a><span id="l77.481"> </span>
<a href="#l77.482"></a><span id="l77.482" class="difflineminus">-  rows.appendChild(row);</span>
<a href="#l77.483"></a><span id="l77.483" class="difflineplus">+    rows.appendChild(row);</span>
<a href="#l77.484"></a><span id="l77.484"> }</span>
<a href="#l77.485"></a><span id="l77.485"> </span>
<a href="#l77.486"></a><span id="l77.486"> /** PRIVATE: create element for field label (for header grid). **/</span>
<a href="#l77.487"></a><span id="l77.487"> function createTooltipHeaderLabel(text) {</span>
<a href="#l77.488"></a><span id="l77.488" class="difflineminus">-  let label = document.createElement(&quot;label&quot;);</span>
<a href="#l77.489"></a><span id="l77.489" class="difflineminus">-  label.setAttribute(&quot;class&quot;, &quot;tooltipHeaderLabel&quot;);</span>
<a href="#l77.490"></a><span id="l77.490" class="difflineminus">-  label.appendChild(document.createTextNode(text));</span>
<a href="#l77.491"></a><span id="l77.491" class="difflineminus">-  return label;</span>
<a href="#l77.492"></a><span id="l77.492" class="difflineplus">+    let label = document.createElement(&quot;label&quot;);</span>
<a href="#l77.493"></a><span id="l77.493" class="difflineplus">+    label.setAttribute(&quot;class&quot;, &quot;tooltipHeaderLabel&quot;);</span>
<a href="#l77.494"></a><span id="l77.494" class="difflineplus">+    label.appendChild(document.createTextNode(text));</span>
<a href="#l77.495"></a><span id="l77.495" class="difflineplus">+    return label;</span>
<a href="#l77.496"></a><span id="l77.496"> }</span>
<a href="#l77.497"></a><span id="l77.497"> </span>
<a href="#l77.498"></a><span id="l77.498"> /** PRIVATE: create element for field value (for header grid). **/</span>
<a href="#l77.499"></a><span id="l77.499"> function createTooltipHeaderDescription(text) {</span>
<a href="#l77.500"></a><span id="l77.500" class="difflineminus">-  let label = document.createElement(&quot;description&quot;);</span>
<a href="#l77.501"></a><span id="l77.501" class="difflineminus">-  label.setAttribute(&quot;class&quot;, &quot;tooltipHeaderDescription&quot;);</span>
<a href="#l77.502"></a><span id="l77.502" class="difflineminus">-  label.appendChild(document.createTextNode(text));</span>
<a href="#l77.503"></a><span id="l77.503" class="difflineminus">-  return label;</span>
<a href="#l77.504"></a><span id="l77.504" class="difflineplus">+    let label = document.createElement(&quot;description&quot;);</span>
<a href="#l77.505"></a><span id="l77.505" class="difflineplus">+    label.setAttribute(&quot;class&quot;, &quot;tooltipHeaderDescription&quot;);</span>
<a href="#l77.506"></a><span id="l77.506" class="difflineplus">+    label.appendChild(document.createTextNode(text));</span>
<a href="#l77.507"></a><span id="l77.507" class="difflineplus">+    return label;</span>
<a href="#l77.508"></a><span id="l77.508"> }</span>
<a href="#l77.509"></a><span id="l77.509"> </span>
<a href="#l77.510"></a><span id="l77.510"> /**</span>
<a href="#l77.511"></a><span id="l77.511">  * If now is during an occurrence, return the occurrence.</span>
<a href="#l77.512"></a><span id="l77.512">  * Else if now is before an occurrence, return the next occurrence.</span>
<a href="#l77.513"></a><span id="l77.513">  * Otherwise return the previous occurrence.</span>
<a href="#l77.514"></a><span id="l77.514">  */</span>
<a href="#l77.515"></a><span id="l77.515"> function getCurrentNextOrPreviousRecurrence(calendarEvent) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -10,22 +10,22 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l78.4"></a><span id="l78.4"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l78.5"></a><span id="l78.5"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l78.6"></a><span id="l78.6"> </span>
<a href="#l78.7"></a><span id="l78.7"> /**</span>
<a href="#l78.8"></a><span id="l78.8">  * publishCalendarData</span>
<a href="#l78.9"></a><span id="l78.9">  * Show publish dialog, ask for URL and publish all selected items.</span>
<a href="#l78.10"></a><span id="l78.10">  */</span>
<a href="#l78.11"></a><span id="l78.11"> function publishCalendarData() {</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-   let args = {};</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+    let args = {};</span>
<a href="#l78.14"></a><span id="l78.14"> </span>
<a href="#l78.15"></a><span id="l78.15" class="difflineminus">-   args.onOk = self.publishCalendarDataDialogResponse;</span>
<a href="#l78.16"></a><span id="l78.16" class="difflineplus">+    args.onOk = self.publishCalendarDataDialogResponse;</span>
<a href="#l78.17"></a><span id="l78.17"> </span>
<a href="#l78.18"></a><span id="l78.18" class="difflineminus">-   openDialog(&quot;chrome://calendar/content/publishDialog.xul&quot;, &quot;caPublishEvents&quot;,</span>
<a href="#l78.19"></a><span id="l78.19" class="difflineminus">-              &quot;chrome,titlebar,modal,resizable&quot;, args);</span>
<a href="#l78.20"></a><span id="l78.20" class="difflineplus">+    openDialog(&quot;chrome://calendar/content/publishDialog.xul&quot;, &quot;caPublishEvents&quot;,</span>
<a href="#l78.21"></a><span id="l78.21" class="difflineplus">+               &quot;chrome,titlebar,modal,resizable&quot;, args);</span>
<a href="#l78.22"></a><span id="l78.22"> }</span>
<a href="#l78.23"></a><span id="l78.23"> </span>
<a href="#l78.24"></a><span id="l78.24"> /**</span>
<a href="#l78.25"></a><span id="l78.25">  * publishCalendarDataDialogResponse</span>
<a href="#l78.26"></a><span id="l78.26">  * Callback method for publishCalendarData() that is called when the user</span>
<a href="#l78.27"></a><span id="l78.27">  * presses the OK button in the publish dialog.</span>
<a href="#l78.28"></a><span id="l78.28">  */</span>
<a href="#l78.29"></a><span id="l78.29"> function publishCalendarDataDialogResponse(CalendarPublishObject, aProgressDialog) {</span>
<a href="#l78.30"></a><span id="l78.30" class="difflineat">@@ -181,18 +181,17 @@ function publishItemArray(aItemArray, aP</span>
<a href="#l78.31"></a><span id="l78.31">     } catch (e) {</span>
<a href="#l78.32"></a><span id="l78.32">         let props = Services.strings.createBundle(&quot;chrome://calendar/locale/calendar.properties&quot;);</span>
<a href="#l78.33"></a><span id="l78.33">         Services.prompt.alert(null, calGetString(&quot;calendar&quot;, &quot;genericErrorTitle&quot;),</span>
<a href="#l78.34"></a><span id="l78.34">                               props.formatStringFromName(&quot;otherPutError&quot;, [e.message], 1));</span>
<a href="#l78.35"></a><span id="l78.35">     }</span>
<a href="#l78.36"></a><span id="l78.36"> }</span>
<a href="#l78.37"></a><span id="l78.37"> </span>
<a href="#l78.38"></a><span id="l78.38"> </span>
<a href="#l78.39"></a><span id="l78.39" class="difflineminus">-var notificationCallbacks =</span>
<a href="#l78.40"></a><span id="l78.40" class="difflineminus">-{</span>
<a href="#l78.41"></a><span id="l78.41" class="difflineplus">+var notificationCallbacks = {</span>
<a href="#l78.42"></a><span id="l78.42">     // nsIInterfaceRequestor interface</span>
<a href="#l78.43"></a><span id="l78.43">     getInterface: function(iid, instance) {</span>
<a href="#l78.44"></a><span id="l78.44">         if (iid.equals(Components.interfaces.nsIAuthPrompt)) {</span>
<a href="#l78.45"></a><span id="l78.45">             // use the window watcher service to get a nsIAuthPrompt impl</span>
<a href="#l78.46"></a><span id="l78.46">             return Services.ww.getNewAuthPrompter(null);</span>
<a href="#l78.47"></a><span id="l78.47">         }</span>
<a href="#l78.48"></a><span id="l78.48"> </span>
<a href="#l78.49"></a><span id="l78.49">         throw Components.results.NS_ERROR_NO_INTERFACE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/calendar/resources/content/publishDialog.js</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/calendar/resources/content/publishDialog.js</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -6,61 +6,61 @@</span>
<a href="#l79.4"></a><span id="l79.4"> </span>
<a href="#l79.5"></a><span id="l79.5"> var gOnOkFunction;   // function to be called when user clicks OK</span>
<a href="#l79.6"></a><span id="l79.6"> var gPublishObject;</span>
<a href="#l79.7"></a><span id="l79.7"> </span>
<a href="#l79.8"></a><span id="l79.8"> /**</span>
<a href="#l79.9"></a><span id="l79.9"> *   Called when the dialog is loaded.</span>
<a href="#l79.10"></a><span id="l79.10"> */</span>
<a href="#l79.11"></a><span id="l79.11"> function loadCalendarPublishDialog() {</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-   // Get arguments, see description at top of file</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineplus">+    // Get arguments, see description at top of file</span>
<a href="#l79.14"></a><span id="l79.14"> </span>
<a href="#l79.15"></a><span id="l79.15" class="difflineminus">-   let args = window.arguments[0];</span>
<a href="#l79.16"></a><span id="l79.16" class="difflineplus">+    let args = window.arguments[0];</span>
<a href="#l79.17"></a><span id="l79.17"> </span>
<a href="#l79.18"></a><span id="l79.18" class="difflineminus">-   gOnOkFunction = args.onOk;</span>
<a href="#l79.19"></a><span id="l79.19" class="difflineplus">+    gOnOkFunction = args.onOk;</span>
<a href="#l79.20"></a><span id="l79.20"> </span>
<a href="#l79.21"></a><span id="l79.21" class="difflineminus">-   if (args.publishObject) {</span>
<a href="#l79.22"></a><span id="l79.22" class="difflineminus">-      gPublishObject = args.publishObject;</span>
<a href="#l79.23"></a><span id="l79.23" class="difflineminus">-      if (args.publishObject.remotePath) {</span>
<a href="#l79.24"></a><span id="l79.24" class="difflineminus">-          document.getElementById(&quot;publish-remotePath-textbox&quot;).value = args.publishObject.remotePath;</span>
<a href="#l79.25"></a><span id="l79.25" class="difflineminus">-      }</span>
<a href="#l79.26"></a><span id="l79.26" class="difflineminus">-   } else {</span>
<a href="#l79.27"></a><span id="l79.27" class="difflineminus">-      gPublishObject = {};</span>
<a href="#l79.28"></a><span id="l79.28" class="difflineminus">-   }</span>
<a href="#l79.29"></a><span id="l79.29" class="difflineminus">-   document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).setAttribute(&quot;label&quot;, publishButtonLabel);</span>
<a href="#l79.30"></a><span id="l79.30" class="difflineplus">+    if (args.publishObject) {</span>
<a href="#l79.31"></a><span id="l79.31" class="difflineplus">+        gPublishObject = args.publishObject;</span>
<a href="#l79.32"></a><span id="l79.32" class="difflineplus">+        if (args.publishObject.remotePath) {</span>
<a href="#l79.33"></a><span id="l79.33" class="difflineplus">+            document.getElementById(&quot;publish-remotePath-textbox&quot;).value = args.publishObject.remotePath;</span>
<a href="#l79.34"></a><span id="l79.34" class="difflineplus">+        }</span>
<a href="#l79.35"></a><span id="l79.35" class="difflineplus">+    } else {</span>
<a href="#l79.36"></a><span id="l79.36" class="difflineplus">+        gPublishObject = {};</span>
<a href="#l79.37"></a><span id="l79.37" class="difflineplus">+    }</span>
<a href="#l79.38"></a><span id="l79.38" class="difflineplus">+    document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).setAttribute(&quot;label&quot;, publishButtonLabel);</span>
<a href="#l79.39"></a><span id="l79.39"> </span>
<a href="#l79.40"></a><span id="l79.40" class="difflineminus">-   checkURLField();</span>
<a href="#l79.41"></a><span id="l79.41" class="difflineplus">+    checkURLField();</span>
<a href="#l79.42"></a><span id="l79.42"> </span>
<a href="#l79.43"></a><span id="l79.43" class="difflineminus">-   let firstFocus = document.getElementById(&quot;publish-remotePath-textbox&quot;);</span>
<a href="#l79.44"></a><span id="l79.44" class="difflineminus">-   firstFocus.focus();</span>
<a href="#l79.45"></a><span id="l79.45" class="difflineplus">+    let firstFocus = document.getElementById(&quot;publish-remotePath-textbox&quot;);</span>
<a href="#l79.46"></a><span id="l79.46" class="difflineplus">+    firstFocus.focus();</span>
<a href="#l79.47"></a><span id="l79.47"> }</span>
<a href="#l79.48"></a><span id="l79.48"> </span>
<a href="#l79.49"></a><span id="l79.49"> /**</span>
<a href="#l79.50"></a><span id="l79.50"> *   Called when the OK button is clicked.</span>
<a href="#l79.51"></a><span id="l79.51"> */</span>
<a href="#l79.52"></a><span id="l79.52"> function onOKCommand() {</span>
<a href="#l79.53"></a><span id="l79.53" class="difflineminus">-   gPublishObject.remotePath = document.getElementById(&quot;publish-remotePath-textbox&quot;).value;</span>
<a href="#l79.54"></a><span id="l79.54" class="difflineplus">+    gPublishObject.remotePath = document.getElementById(&quot;publish-remotePath-textbox&quot;).value;</span>
<a href="#l79.55"></a><span id="l79.55"> </span>
<a href="#l79.56"></a><span id="l79.56" class="difflineminus">-   // call caller's on OK function</span>
<a href="#l79.57"></a><span id="l79.57" class="difflineminus">-   gOnOkFunction(gPublishObject, progressDialog);</span>
<a href="#l79.58"></a><span id="l79.58" class="difflineminus">-   document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).setAttribute(&quot;label&quot;, closeButtonLabel);</span>
<a href="#l79.59"></a><span id="l79.59" class="difflineminus">-   document.getElementById(&quot;calendar-publishwindow&quot;).setAttribute(&quot;ondialogaccept&quot;, &quot;closeDialog()&quot;);</span>
<a href="#l79.60"></a><span id="l79.60" class="difflineminus">-   return false;</span>
<a href="#l79.61"></a><span id="l79.61" class="difflineplus">+    // call caller's on OK function</span>
<a href="#l79.62"></a><span id="l79.62" class="difflineplus">+    gOnOkFunction(gPublishObject, progressDialog);</span>
<a href="#l79.63"></a><span id="l79.63" class="difflineplus">+    document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).setAttribute(&quot;label&quot;, closeButtonLabel);</span>
<a href="#l79.64"></a><span id="l79.64" class="difflineplus">+    document.getElementById(&quot;calendar-publishwindow&quot;).setAttribute(&quot;ondialogaccept&quot;, &quot;closeDialog()&quot;);</span>
<a href="#l79.65"></a><span id="l79.65" class="difflineplus">+    return false;</span>
<a href="#l79.66"></a><span id="l79.66"> }</span>
<a href="#l79.67"></a><span id="l79.67"> </span>
<a href="#l79.68"></a><span id="l79.68"> function checkURLField() {</span>
<a href="#l79.69"></a><span id="l79.69" class="difflineminus">-   if (document.getElementById(&quot;publish-remotePath-textbox&quot;).value.length == 0) {</span>
<a href="#l79.70"></a><span id="l79.70" class="difflineminus">-      document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l79.71"></a><span id="l79.71" class="difflineminus">-   } else {</span>
<a href="#l79.72"></a><span id="l79.72" class="difflineminus">-      document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l79.73"></a><span id="l79.73" class="difflineminus">-   }</span>
<a href="#l79.74"></a><span id="l79.74" class="difflineplus">+    if (document.getElementById(&quot;publish-remotePath-textbox&quot;).value.length == 0) {</span>
<a href="#l79.75"></a><span id="l79.75" class="difflineplus">+        document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l79.76"></a><span id="l79.76" class="difflineplus">+    } else {</span>
<a href="#l79.77"></a><span id="l79.77" class="difflineplus">+        document.getElementById(&quot;calendar-publishwindow&quot;).getButton(&quot;accept&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l79.78"></a><span id="l79.78" class="difflineplus">+    }</span>
<a href="#l79.79"></a><span id="l79.79"> }</span>
<a href="#l79.80"></a><span id="l79.80"> </span>
<a href="#l79.81"></a><span id="l79.81"> function closeDialog() {</span>
<a href="#l79.82"></a><span id="l79.82" class="difflineminus">-   self.close();</span>
<a href="#l79.83"></a><span id="l79.83" class="difflineplus">+    self.close();</span>
<a href="#l79.84"></a><span id="l79.84"> }</span>
<a href="#l79.85"></a><span id="l79.85"> </span>
<a href="#l79.86"></a><span id="l79.86"> var progressDialog = {</span>
<a href="#l79.87"></a><span id="l79.87">     onStartUpload: function() {</span>
<a href="#l79.88"></a><span id="l79.88">         document.getElementById(&quot;publish-progressmeter&quot;).setAttribute(&quot;mode&quot;, &quot;undetermined&quot;);</span>
<a href="#l79.89"></a><span id="l79.89">     },</span>
<a href="#l79.90"></a><span id="l79.90"> </span>
<a href="#l79.91"></a><span id="l79.91">     onStopUpload: function() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialog.js</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -10,259 +10,259 @@ var sleep = 500;</span>
<a href="#l80.4"></a><span id="l80.4"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l80.5"></a><span id="l80.5"> var title = &quot;Event&quot;;</span>
<a href="#l80.6"></a><span id="l80.6"> var location = &quot;Location&quot;;</span>
<a href="#l80.7"></a><span id="l80.7"> var desc = &quot;Event Decription&quot;;</span>
<a href="#l80.8"></a><span id="l80.8"> var attendee = &quot;foo@bar.com&quot;;</span>
<a href="#l80.9"></a><span id="l80.9"> var url = &quot;http://mozilla.org&quot;;</span>
<a href="#l80.10"></a><span id="l80.10"> </span>
<a href="#l80.11"></a><span id="l80.11"> var setupModule = function(module) {</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l80.13"></a><span id="l80.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l80.14"></a><span id="l80.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l80.15"></a><span id="l80.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l80.16"></a><span id="l80.16"> };</span>
<a href="#l80.17"></a><span id="l80.17"> </span>
<a href="#l80.18"></a><span id="l80.18"> var testEventDialog = function() {</span>
<a href="#l80.19"></a><span id="l80.19" class="difflineminus">-  // paths</span>
<a href="#l80.20"></a><span id="l80.20" class="difflineminus">-  let monthView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l80.21"></a><span id="l80.21" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l80.22"></a><span id="l80.22" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l80.23"></a><span id="l80.23" class="difflineminus">-  let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l80.24"></a><span id="l80.24" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l80.25"></a><span id="l80.25" class="difflineminus">-    'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l80.26"></a><span id="l80.26" class="difflineminus">-  let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l80.27"></a><span id="l80.27" class="difflineplus">+    // paths</span>
<a href="#l80.28"></a><span id="l80.28" class="difflineplus">+    let monthView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l80.29"></a><span id="l80.29" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l80.30"></a><span id="l80.30" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l80.31"></a><span id="l80.31" class="difflineplus">+    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l80.32"></a><span id="l80.32" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l80.33"></a><span id="l80.33" class="difflineplus">+      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l80.34"></a><span id="l80.34" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l80.35"></a><span id="l80.35"> </span>
<a href="#l80.36"></a><span id="l80.36" class="difflineminus">-  let eventBox = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l80.37"></a><span id="l80.37" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/' +</span>
<a href="#l80.38"></a><span id="l80.38" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l80.39"></a><span id="l80.39" class="difflineminus">-    '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l80.40"></a><span id="l80.40" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l80.41"></a><span id="l80.41" class="difflineplus">+    let eventBox = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l80.42"></a><span id="l80.42" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/' +</span>
<a href="#l80.43"></a><span id="l80.43" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l80.44"></a><span id="l80.44" class="difflineplus">+      '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l80.45"></a><span id="l80.45" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l80.46"></a><span id="l80.46"> </span>
<a href="#l80.47"></a><span id="l80.47" class="difflineminus">-  // open month view</span>
<a href="#l80.48"></a><span id="l80.48" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l80.49"></a><span id="l80.49" class="difflineminus">-  controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l80.50"></a><span id="l80.50" class="difflineplus">+    // open month view</span>
<a href="#l80.51"></a><span id="l80.51" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l80.52"></a><span id="l80.52" class="difflineplus">+    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l80.53"></a><span id="l80.53"> </span>
<a href="#l80.54"></a><span id="l80.54" class="difflineminus">-  // pick year</span>
<a href="#l80.55"></a><span id="l80.55" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.56"></a><span id="l80.56" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l80.57"></a><span id="l80.57" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.58"></a><span id="l80.58" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l80.59"></a><span id="l80.59" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l80.60"></a><span id="l80.60" class="difflineplus">+    // pick year</span>
<a href="#l80.61"></a><span id="l80.61" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.62"></a><span id="l80.62" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l80.63"></a><span id="l80.63" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.64"></a><span id="l80.64" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l80.65"></a><span id="l80.65" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l80.66"></a><span id="l80.66"> </span>
<a href="#l80.67"></a><span id="l80.67" class="difflineminus">-  // pick month</span>
<a href="#l80.68"></a><span id="l80.68" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.69"></a><span id="l80.69" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l80.70"></a><span id="l80.70" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.71"></a><span id="l80.71" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l80.72"></a><span id="l80.72" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l80.73"></a><span id="l80.73" class="difflineplus">+    // pick month</span>
<a href="#l80.74"></a><span id="l80.74" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.75"></a><span id="l80.75" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l80.76"></a><span id="l80.76" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.77"></a><span id="l80.77" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l80.78"></a><span id="l80.78" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l80.79"></a><span id="l80.79"> </span>
<a href="#l80.80"></a><span id="l80.80" class="difflineminus">-  // pick day</span>
<a href="#l80.81"></a><span id="l80.81" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.82"></a><span id="l80.82" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l80.83"></a><span id="l80.83" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l80.84"></a><span id="l80.84" class="difflineplus">+    // pick day</span>
<a href="#l80.85"></a><span id="l80.85" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l80.86"></a><span id="l80.86" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l80.87"></a><span id="l80.87" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l80.88"></a><span id="l80.88"> </span>
<a href="#l80.89"></a><span id="l80.89" class="difflineminus">-  // create new event</span>
<a href="#l80.90"></a><span id="l80.90" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l80.91"></a><span id="l80.91" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l80.92"></a><span id="l80.92" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l80.93"></a><span id="l80.93" class="difflineplus">+    // create new event</span>
<a href="#l80.94"></a><span id="l80.94" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnNewEvent&quot;);</span>
<a href="#l80.95"></a><span id="l80.95" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l80.96"></a><span id="l80.96" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l80.97"></a><span id="l80.97"> </span>
<a href="#l80.98"></a><span id="l80.98" class="difflineminus">-  // check that the start time is correct</span>
<a href="#l80.99"></a><span id="l80.99" class="difflineminus">-  // next full hour except last hour hour of the day</span>
<a href="#l80.100"></a><span id="l80.100" class="difflineminus">-  let now = new Date();</span>
<a href="#l80.101"></a><span id="l80.101" class="difflineminus">-  let hour = now.getHours();</span>
<a href="#l80.102"></a><span id="l80.102" class="difflineminus">-  let startHour = (hour == 23) ? hour : (hour + 1) % 24;</span>
<a href="#l80.103"></a><span id="l80.103" class="difflineminus">-  let ampm = &quot;&quot;;</span>
<a href="#l80.104"></a><span id="l80.104" class="difflineminus">-  if (now.toLocaleTimeString().match(/AM|PM/)) {</span>
<a href="#l80.105"></a><span id="l80.105" class="difflineminus">-    ampm = (hour &gt;= 12 ? &quot; PM&quot; : &quot; AM&quot;);</span>
<a href="#l80.106"></a><span id="l80.106" class="difflineminus">-    startHour = startHour % 12;</span>
<a href="#l80.107"></a><span id="l80.107" class="difflineminus">-    if (startHour == 0) {</span>
<a href="#l80.108"></a><span id="l80.108" class="difflineminus">-      startHour = 12;</span>
<a href="#l80.109"></a><span id="l80.109" class="difflineplus">+    // check that the start time is correct</span>
<a href="#l80.110"></a><span id="l80.110" class="difflineplus">+    // next full hour except last hour hour of the day</span>
<a href="#l80.111"></a><span id="l80.111" class="difflineplus">+    let now = new Date();</span>
<a href="#l80.112"></a><span id="l80.112" class="difflineplus">+    let hour = now.getHours();</span>
<a href="#l80.113"></a><span id="l80.113" class="difflineplus">+    let startHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l80.114"></a><span id="l80.114" class="difflineplus">+    let ampm = &quot;&quot;;</span>
<a href="#l80.115"></a><span id="l80.115" class="difflineplus">+    if (now.toLocaleTimeString().match(/AM|PM/)) {</span>
<a href="#l80.116"></a><span id="l80.116" class="difflineplus">+        ampm = (hour &gt;= 12 ? &quot; PM&quot; : &quot; AM&quot;);</span>
<a href="#l80.117"></a><span id="l80.117" class="difflineplus">+        startHour = startHour % 12;</span>
<a href="#l80.118"></a><span id="l80.118" class="difflineplus">+        if (startHour == 0) {</span>
<a href="#l80.119"></a><span id="l80.119" class="difflineplus">+            startHour = 12;</span>
<a href="#l80.120"></a><span id="l80.120" class="difflineplus">+        }</span>
<a href="#l80.121"></a><span id="l80.121">     }</span>
<a href="#l80.122"></a><span id="l80.122" class="difflineminus">-  }</span>
<a href="#l80.123"></a><span id="l80.123"> </span>
<a href="#l80.124"></a><span id="l80.124" class="difflineminus">-  let startTime = startHour + &quot;:00&quot; + ampm;</span>
<a href="#l80.125"></a><span id="l80.125" class="difflineminus">-  let endTime = ((startHour + 1) % 24) + &quot;:00&quot; + ampm;</span>
<a href="#l80.126"></a><span id="l80.126" class="difflineminus">-  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.127"></a><span id="l80.127" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l80.128"></a><span id="l80.128" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l80.129"></a><span id="l80.129" class="difflineminus">-    'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/id(&quot;timepicker-text&quot;)/' +</span>
<a href="#l80.130"></a><span id="l80.130" class="difflineminus">-    'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l80.131"></a><span id="l80.131" class="difflineminus">-    );</span>
<a href="#l80.132"></a><span id="l80.132" class="difflineminus">-  event.waitForElement(startTimeInput);</span>
<a href="#l80.133"></a><span id="l80.133" class="difflineminus">-  event.assertValue(startTimeInput, startTime);</span>
<a href="#l80.134"></a><span id="l80.134" class="difflineplus">+    let startTime = startHour + &quot;:00&quot; + ampm;</span>
<a href="#l80.135"></a><span id="l80.135" class="difflineplus">+    let endTime = ((startHour + 1) % 24) + &quot;:00&quot; + ampm;</span>
<a href="#l80.136"></a><span id="l80.136" class="difflineplus">+    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.137"></a><span id="l80.137" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l80.138"></a><span id="l80.138" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l80.139"></a><span id="l80.139" class="difflineplus">+      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/id(&quot;timepicker-text&quot;)/' +</span>
<a href="#l80.140"></a><span id="l80.140" class="difflineplus">+      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l80.141"></a><span id="l80.141" class="difflineplus">+      );</span>
<a href="#l80.142"></a><span id="l80.142" class="difflineplus">+    event.waitForElement(startTimeInput);</span>
<a href="#l80.143"></a><span id="l80.143" class="difflineplus">+    event.assertValue(startTimeInput, startTime);</span>
<a href="#l80.144"></a><span id="l80.144"> </span>
<a href="#l80.145"></a><span id="l80.145" class="difflineminus">-  // check selected calendar</span>
<a href="#l80.146"></a><span id="l80.146" class="difflineminus">-  event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.147"></a><span id="l80.147" class="difflineminus">-    'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/' +</span>
<a href="#l80.148"></a><span id="l80.148" class="difflineminus">-    '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l80.149"></a><span id="l80.149" class="difflineplus">+    // check selected calendar</span>
<a href="#l80.150"></a><span id="l80.150" class="difflineplus">+    event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.151"></a><span id="l80.151" class="difflineplus">+      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/' +</span>
<a href="#l80.152"></a><span id="l80.152" class="difflineplus">+      '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l80.153"></a><span id="l80.153"> </span>
<a href="#l80.154"></a><span id="l80.154" class="difflineminus">-  // fill in name, location, description</span>
<a href="#l80.155"></a><span id="l80.155" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.156"></a><span id="l80.156" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l80.157"></a><span id="l80.157" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l80.158"></a><span id="l80.158" class="difflineminus">-    title);</span>
<a href="#l80.159"></a><span id="l80.159" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.160"></a><span id="l80.160" class="difflineminus">-    'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l80.161"></a><span id="l80.161" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'), location);</span>
<a href="#l80.162"></a><span id="l80.162" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.163"></a><span id="l80.163" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l80.164"></a><span id="l80.164" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l80.165"></a><span id="l80.165" class="difflineminus">-    desc);</span>
<a href="#l80.166"></a><span id="l80.166" class="difflineplus">+    // fill in name, location, description</span>
<a href="#l80.167"></a><span id="l80.167" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.168"></a><span id="l80.168" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l80.169"></a><span id="l80.169" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l80.170"></a><span id="l80.170" class="difflineplus">+      title);</span>
<a href="#l80.171"></a><span id="l80.171" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.172"></a><span id="l80.172" class="difflineplus">+      'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l80.173"></a><span id="l80.173" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'), location);</span>
<a href="#l80.174"></a><span id="l80.174" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.175"></a><span id="l80.175" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l80.176"></a><span id="l80.176" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l80.177"></a><span id="l80.177" class="difflineplus">+      desc);</span>
<a href="#l80.178"></a><span id="l80.178"> </span>
<a href="#l80.179"></a><span id="l80.179" class="difflineminus">-  // set category</span>
<a href="#l80.180"></a><span id="l80.180" class="difflineminus">-  let categories = utils.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l80.181"></a><span id="l80.181" class="difflineminus">-  let category = categories.split(&quot;,&quot;)[4]; // pick 4th value in a comma-separated list</span>
<a href="#l80.182"></a><span id="l80.182" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), null, category);</span>
<a href="#l80.183"></a><span id="l80.183" class="difflineplus">+    // set category</span>
<a href="#l80.184"></a><span id="l80.184" class="difflineplus">+    let categories = utils.getProperty(&quot;chrome://calendar/locale/categories.properties&quot;, &quot;categories2&quot;);</span>
<a href="#l80.185"></a><span id="l80.185" class="difflineplus">+    let category = categories.split(&quot;,&quot;)[4]; // pick 4th value in a comma-separated list</span>
<a href="#l80.186"></a><span id="l80.186" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), null, category);</span>
<a href="#l80.187"></a><span id="l80.187"> </span>
<a href="#l80.188"></a><span id="l80.188" class="difflineminus">-  // repeat daily</span>
<a href="#l80.189"></a><span id="l80.189" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;repeat-daily-menuitem&quot;));</span>
<a href="#l80.190"></a><span id="l80.190" class="difflineplus">+    // repeat daily</span>
<a href="#l80.191"></a><span id="l80.191" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;repeat-daily-menuitem&quot;));</span>
<a href="#l80.192"></a><span id="l80.192"> </span>
<a href="#l80.193"></a><span id="l80.193" class="difflineminus">-  // add reminder</span>
<a href="#l80.194"></a><span id="l80.194" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l80.195"></a><span id="l80.195" class="difflineplus">+    // add reminder</span>
<a href="#l80.196"></a><span id="l80.196" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;reminder-5minutes-menuitem&quot;));</span>
<a href="#l80.197"></a><span id="l80.197"> </span>
<a href="#l80.198"></a><span id="l80.198" class="difflineminus">-  // add an attendee and verify added</span>
<a href="#l80.199"></a><span id="l80.199" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l80.200"></a><span id="l80.200" class="difflineminus">-  dialog.start(handleAttendees);</span>
<a href="#l80.201"></a><span id="l80.201" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-attendees&quot;));</span>
<a href="#l80.202"></a><span id="l80.202" class="difflineminus">-  event.assertValue(new elementslib.ID(event.window.document, &quot;attendee-list&quot;),</span>
<a href="#l80.203"></a><span id="l80.203" class="difflineminus">-    attendee);</span>
<a href="#l80.204"></a><span id="l80.204" class="difflineplus">+    // add an attendee and verify added</span>
<a href="#l80.205"></a><span id="l80.205" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l80.206"></a><span id="l80.206" class="difflineplus">+    dialog.start(handleAttendees);</span>
<a href="#l80.207"></a><span id="l80.207" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-attendees&quot;));</span>
<a href="#l80.208"></a><span id="l80.208" class="difflineplus">+    event.assertValue(new elementslib.ID(event.window.document, &quot;attendee-list&quot;),</span>
<a href="#l80.209"></a><span id="l80.209" class="difflineplus">+      attendee);</span>
<a href="#l80.210"></a><span id="l80.210"> </span>
<a href="#l80.211"></a><span id="l80.211" class="difflineminus">-  // make it private and verify label visible</span>
<a href="#l80.212"></a><span id="l80.212" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-privacy&quot;));</span>
<a href="#l80.213"></a><span id="l80.213" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l80.214"></a><span id="l80.214" class="difflineminus">-  let label = new elementslib.ID(event.window.document, &quot;status-privacy-private-box&quot;);</span>
<a href="#l80.215"></a><span id="l80.215" class="difflineminus">-  event.assertJS(event.window.getComputedStyle(label.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l80.216"></a><span id="l80.216" class="difflineplus">+    // make it private and verify label visible</span>
<a href="#l80.217"></a><span id="l80.217" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-privacy&quot;));</span>
<a href="#l80.218"></a><span id="l80.218" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;event-privacy-private-menuitem&quot;));</span>
<a href="#l80.219"></a><span id="l80.219" class="difflineplus">+    let label = new elementslib.ID(event.window.document, &quot;status-privacy-private-box&quot;);</span>
<a href="#l80.220"></a><span id="l80.220" class="difflineplus">+    event.assertJS(event.window.getComputedStyle(label.getNode(), null).getPropertyValue(&quot;visibility&quot;) == &quot;visible&quot;);</span>
<a href="#l80.221"></a><span id="l80.221"> </span>
<a href="#l80.222"></a><span id="l80.222" class="difflineminus">-  // add attachment and verify added</span>
<a href="#l80.223"></a><span id="l80.223" class="difflineminus">-  calUtils.handleAddingAttachment(event, url);</span>
<a href="#l80.224"></a><span id="l80.224" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-url&quot;));</span>
<a href="#l80.225"></a><span id="l80.225" class="difflineminus">-  event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.226"></a><span id="l80.226" class="difflineminus">-    'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}'));</span>
<a href="#l80.227"></a><span id="l80.227" class="difflineplus">+    // add attachment and verify added</span>
<a href="#l80.228"></a><span id="l80.228" class="difflineplus">+    calUtils.handleAddingAttachment(event, url);</span>
<a href="#l80.229"></a><span id="l80.229" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-url&quot;));</span>
<a href="#l80.230"></a><span id="l80.230" class="difflineplus">+    event.assertNode(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l80.231"></a><span id="l80.231" class="difflineplus">+      'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;mozilla.org&quot;}'));</span>
<a href="#l80.232"></a><span id="l80.232"> </span>
<a href="#l80.233"></a><span id="l80.233" class="difflineminus">-  // save</span>
<a href="#l80.234"></a><span id="l80.234" class="difflineminus">-  calUtils.acceptSendingNotificationMail(event);</span>
<a href="#l80.235"></a><span id="l80.235" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l80.236"></a><span id="l80.236" class="difflineplus">+    // save</span>
<a href="#l80.237"></a><span id="l80.237" class="difflineplus">+    calUtils.acceptSendingNotificationMail(event);</span>
<a href="#l80.238"></a><span id="l80.238" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l80.239"></a><span id="l80.239"> </span>
<a href="#l80.240"></a><span id="l80.240" class="difflineminus">-  // catch and dismiss alarm</span>
<a href="#l80.241"></a><span id="l80.241" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0, sleep);</span>
<a href="#l80.242"></a><span id="l80.242" class="difflineminus">-  let alarm = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;)[0]);</span>
<a href="#l80.243"></a><span id="l80.243" class="difflineminus">-  // dismiss all button, label in .dtd file, bug #504635</span>
<a href="#l80.244"></a><span id="l80.244" class="difflineminus">-  alarm.waitThenClick(new elementslib.Lookup(alarm.window.document, '/id(&quot;calendar-alarm-dialog&quot;)/' +</span>
<a href="#l80.245"></a><span id="l80.245" class="difflineminus">-    'id(&quot;alarm-actionbar&quot;)/[1]'));</span>
<a href="#l80.246"></a><span id="l80.246" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0, sleep);</span>
<a href="#l80.247"></a><span id="l80.247" class="difflineplus">+    // catch and dismiss alarm</span>
<a href="#l80.248"></a><span id="l80.248" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length &gt; 0, sleep);</span>
<a href="#l80.249"></a><span id="l80.249" class="difflineplus">+    let alarm = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;)[0]);</span>
<a href="#l80.250"></a><span id="l80.250" class="difflineplus">+    // dismiss all button, label in .dtd file, bug #504635</span>
<a href="#l80.251"></a><span id="l80.251" class="difflineplus">+    alarm.waitThenClick(new elementslib.Lookup(alarm.window.document, '/id(&quot;calendar-alarm-dialog&quot;)/' +</span>
<a href="#l80.252"></a><span id="l80.252" class="difflineplus">+      'id(&quot;alarm-actionbar&quot;)/[1]'));</span>
<a href="#l80.253"></a><span id="l80.253" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:AlarmWindow&quot;).length == 0, sleep);</span>
<a href="#l80.254"></a><span id="l80.254"> </span>
<a href="#l80.255"></a><span id="l80.255" class="difflineminus">-  // verify event and alarm icon visible every day of the month and check tooltip</span>
<a href="#l80.256"></a><span id="l80.256" class="difflineminus">-  // 1st January is Thursday so there's three days to check in the first row</span>
<a href="#l80.257"></a><span id="l80.257" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.258"></a><span id="l80.258" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l80.259"></a><span id="l80.259" class="difflineminus">-  checkIcon(eventBox, &quot;0&quot;, &quot;4&quot;);</span>
<a href="#l80.260"></a><span id="l80.260" class="difflineminus">-  checkTooltip(monthView, &quot;0&quot;, &quot;4&quot;, &quot;1&quot;, startTime, endTime);</span>
<a href="#l80.261"></a><span id="l80.261" class="difflineplus">+    // verify event and alarm icon visible every day of the month and check tooltip</span>
<a href="#l80.262"></a><span id="l80.262" class="difflineplus">+    // 1st January is Thursday so there's three days to check in the first row</span>
<a href="#l80.263"></a><span id="l80.263" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.264"></a><span id="l80.264" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l80.265"></a><span id="l80.265" class="difflineplus">+    checkIcon(eventBox, &quot;0&quot;, &quot;4&quot;);</span>
<a href="#l80.266"></a><span id="l80.266" class="difflineplus">+    checkTooltip(monthView, &quot;0&quot;, &quot;4&quot;, &quot;1&quot;, startTime, endTime);</span>
<a href="#l80.267"></a><span id="l80.267"> </span>
<a href="#l80.268"></a><span id="l80.268" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.269"></a><span id="l80.269" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.270"></a><span id="l80.270" class="difflineminus">-  checkIcon(eventBox, &quot;0&quot;, &quot;5&quot;);</span>
<a href="#l80.271"></a><span id="l80.271" class="difflineminus">-  checkTooltip(monthView, &quot;0&quot;, &quot;5&quot;, &quot;2&quot;, startTime, endTime);</span>
<a href="#l80.272"></a><span id="l80.272" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.273"></a><span id="l80.273" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.274"></a><span id="l80.274" class="difflineplus">+    checkIcon(eventBox, &quot;0&quot;, &quot;5&quot;);</span>
<a href="#l80.275"></a><span id="l80.275" class="difflineplus">+    checkTooltip(monthView, &quot;0&quot;, &quot;5&quot;, &quot;2&quot;, startTime, endTime);</span>
<a href="#l80.276"></a><span id="l80.276"> </span>
<a href="#l80.277"></a><span id="l80.277" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.278"></a><span id="l80.278" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.279"></a><span id="l80.279" class="difflineminus">-  checkIcon(eventBox, &quot;0&quot;, &quot;6&quot;);</span>
<a href="#l80.280"></a><span id="l80.280" class="difflineminus">-  checkTooltip(monthView, &quot;0&quot;, &quot;6&quot;, &quot;3&quot;, startTime, endTime);</span>
<a href="#l80.281"></a><span id="l80.281" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.282"></a><span id="l80.282" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.283"></a><span id="l80.283" class="difflineplus">+    checkIcon(eventBox, &quot;0&quot;, &quot;6&quot;);</span>
<a href="#l80.284"></a><span id="l80.284" class="difflineplus">+    checkTooltip(monthView, &quot;0&quot;, &quot;6&quot;, &quot;3&quot;, startTime, endTime);</span>
<a href="#l80.285"></a><span id="l80.285"> </span>
<a href="#l80.286"></a><span id="l80.286" class="difflineminus">-  // 31st of January is Saturday so there's four more full rows to check</span>
<a href="#l80.287"></a><span id="l80.287" class="difflineminus">-  let date = 4;</span>
<a href="#l80.288"></a><span id="l80.288" class="difflineminus">-  for (row = 1; row &lt; 5; row++) {</span>
<a href="#l80.289"></a><span id="l80.289" class="difflineminus">-    for (col = 0; col &lt; 7; col++) {</span>
<a href="#l80.290"></a><span id="l80.290" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.291"></a><span id="l80.291" class="difflineminus">-          eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.292"></a><span id="l80.292" class="difflineminus">-        checkIcon(eventBox, row, col);</span>
<a href="#l80.293"></a><span id="l80.293" class="difflineminus">-        checkTooltip(monthView, row, col, date, startTime, endTime);</span>
<a href="#l80.294"></a><span id="l80.294" class="difflineminus">-        date++;</span>
<a href="#l80.295"></a><span id="l80.295" class="difflineplus">+    // 31st of January is Saturday so there's four more full rows to check</span>
<a href="#l80.296"></a><span id="l80.296" class="difflineplus">+    let date = 4;</span>
<a href="#l80.297"></a><span id="l80.297" class="difflineplus">+    for (row = 1; row &lt; 5; row++) {</span>
<a href="#l80.298"></a><span id="l80.298" class="difflineplus">+        for (col = 0; col &lt; 7; col++) {</span>
<a href="#l80.299"></a><span id="l80.299" class="difflineplus">+            controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.300"></a><span id="l80.300" class="difflineplus">+              eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.301"></a><span id="l80.301" class="difflineplus">+            checkIcon(eventBox, row, col);</span>
<a href="#l80.302"></a><span id="l80.302" class="difflineplus">+            checkTooltip(monthView, row, col, date, startTime, endTime);</span>
<a href="#l80.303"></a><span id="l80.303" class="difflineplus">+            date++;</span>
<a href="#l80.304"></a><span id="l80.304" class="difflineplus">+        }</span>
<a href="#l80.305"></a><span id="l80.305">     }</span>
<a href="#l80.306"></a><span id="l80.306" class="difflineminus">-  }</span>
<a href="#l80.307"></a><span id="l80.307"> </span>
<a href="#l80.308"></a><span id="l80.308" class="difflineminus">-  // delete and verify deleted 2nd Jan</span>
<a href="#l80.309"></a><span id="l80.309" class="difflineminus">-  calUtils.handleOccurrenceDeletion(controller);</span>
<a href="#l80.310"></a><span id="l80.310" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.311"></a><span id="l80.311" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.312"></a><span id="l80.312" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l80.313"></a><span id="l80.313" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l80.314"></a><span id="l80.314" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.315"></a><span id="l80.315" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.316"></a><span id="l80.316" class="difflineplus">+    // delete and verify deleted 2nd Jan</span>
<a href="#l80.317"></a><span id="l80.317" class="difflineplus">+    calUtils.handleOccurrenceDeletion(controller);</span>
<a href="#l80.318"></a><span id="l80.318" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.319"></a><span id="l80.319" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.320"></a><span id="l80.320" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l80.321"></a><span id="l80.321" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l80.322"></a><span id="l80.322" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.323"></a><span id="l80.323" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.324"></a><span id="l80.324"> </span>
<a href="#l80.325"></a><span id="l80.325" class="difflineminus">-  // verify all others still exist</span>
<a href="#l80.326"></a><span id="l80.326" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.327"></a><span id="l80.327" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l80.328"></a><span id="l80.328" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.329"></a><span id="l80.329" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.330"></a><span id="l80.330" class="difflineplus">+    // verify all others still exist</span>
<a href="#l80.331"></a><span id="l80.331" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.332"></a><span id="l80.332" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l80.333"></a><span id="l80.333" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.334"></a><span id="l80.334" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.335"></a><span id="l80.335"> </span>
<a href="#l80.336"></a><span id="l80.336" class="difflineminus">-  for (row = 1; row &lt; 5; row++) {</span>
<a href="#l80.337"></a><span id="l80.337" class="difflineminus">-    for (col = 0; col &lt; 7; col++) {</span>
<a href="#l80.338"></a><span id="l80.338" class="difflineminus">-        controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.339"></a><span id="l80.339" class="difflineminus">-          eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.340"></a><span id="l80.340" class="difflineplus">+    for (row = 1; row &lt; 5; row++) {</span>
<a href="#l80.341"></a><span id="l80.341" class="difflineplus">+        for (col = 0; col &lt; 7; col++) {</span>
<a href="#l80.342"></a><span id="l80.342" class="difflineplus">+            controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.343"></a><span id="l80.343" class="difflineplus">+              eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.344"></a><span id="l80.344" class="difflineplus">+        }</span>
<a href="#l80.345"></a><span id="l80.345">     }</span>
<a href="#l80.346"></a><span id="l80.346" class="difflineminus">-  }</span>
<a href="#l80.347"></a><span id="l80.347"> </span>
<a href="#l80.348"></a><span id="l80.348" class="difflineminus">-  // delete series by deleting 3rd January and confirming to delete all</span>
<a href="#l80.349"></a><span id="l80.349" class="difflineminus">-  calUtils.handleParentDeletion(controller);</span>
<a href="#l80.350"></a><span id="l80.350" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.351"></a><span id="l80.351" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.352"></a><span id="l80.352" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l80.353"></a><span id="l80.353" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l80.354"></a><span id="l80.354" class="difflineplus">+    // delete series by deleting 3rd January and confirming to delete all</span>
<a href="#l80.355"></a><span id="l80.355" class="difflineplus">+    calUtils.handleParentDeletion(controller);</span>
<a href="#l80.356"></a><span id="l80.356" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.357"></a><span id="l80.357" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.358"></a><span id="l80.358" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l80.359"></a><span id="l80.359" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l80.360"></a><span id="l80.360"> </span>
<a href="#l80.361"></a><span id="l80.361" class="difflineminus">-  // verify all deleted</span>
<a href="#l80.362"></a><span id="l80.362" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.363"></a><span id="l80.363" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l80.364"></a><span id="l80.364" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.365"></a><span id="l80.365" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.366"></a><span id="l80.366" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.367"></a><span id="l80.367" class="difflineminus">-    eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.368"></a><span id="l80.368" class="difflineplus">+    // verify all deleted</span>
<a href="#l80.369"></a><span id="l80.369" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.370"></a><span id="l80.370" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;4&quot;)));</span>
<a href="#l80.371"></a><span id="l80.371" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.372"></a><span id="l80.372" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;5&quot;)));</span>
<a href="#l80.373"></a><span id="l80.373" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.374"></a><span id="l80.374" class="difflineplus">+      eventBox.replace(&quot;rowNumber&quot;, &quot;0&quot;).replace(&quot;columnNumber&quot;, &quot;6&quot;)));</span>
<a href="#l80.375"></a><span id="l80.375"> </span>
<a href="#l80.376"></a><span id="l80.376" class="difflineminus">-  for (row = 1; row &lt; 5; row++) {</span>
<a href="#l80.377"></a><span id="l80.377" class="difflineminus">-    for (col = 0; col &lt; 7; col++) {</span>
<a href="#l80.378"></a><span id="l80.378" class="difflineminus">-        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.379"></a><span id="l80.379" class="difflineminus">-          eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.380"></a><span id="l80.380" class="difflineplus">+    for (row = 1; row &lt; 5; row++) {</span>
<a href="#l80.381"></a><span id="l80.381" class="difflineplus">+        for (col = 0; col &lt; 7; col++) {</span>
<a href="#l80.382"></a><span id="l80.382" class="difflineplus">+            controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.383"></a><span id="l80.383" class="difflineplus">+              eventBox.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.384"></a><span id="l80.384" class="difflineplus">+        }</span>
<a href="#l80.385"></a><span id="l80.385">     }</span>
<a href="#l80.386"></a><span id="l80.386" class="difflineminus">-  }</span>
<a href="#l80.387"></a><span id="l80.387"> };</span>
<a href="#l80.388"></a><span id="l80.388"> </span>
<a href="#l80.389"></a><span id="l80.389"> function handleAttendees(attendees) {</span>
<a href="#l80.390"></a><span id="l80.390" class="difflineminus">-  let input = new elementslib.Lookup(attendees.window.document,</span>
<a href="#l80.391"></a><span id="l80.391" class="difflineminus">-    '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/' +</span>
<a href="#l80.392"></a><span id="l80.392" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/' +</span>
<a href="#l80.393"></a><span id="l80.393" class="difflineminus">-    'anon({&quot;class&quot;:&quot;autocomplete-textbox-container&quot;})/' +</span>
<a href="#l80.394"></a><span id="l80.394" class="difflineminus">-    '{&quot;class&quot;:&quot;textbox-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l80.395"></a><span id="l80.395" class="difflineminus">-  attendees.waitForElement(input);</span>
<a href="#l80.396"></a><span id="l80.396" class="difflineminus">-  attendees.type(input, attendee);</span>
<a href="#l80.397"></a><span id="l80.397" class="difflineminus">-  attendees.click(new elementslib.Lookup(attendees.window.document,</span>
<a href="#l80.398"></a><span id="l80.398" class="difflineminus">-    '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l80.399"></a><span id="l80.399" class="difflineplus">+    let input = new elementslib.Lookup(attendees.window.document,</span>
<a href="#l80.400"></a><span id="l80.400" class="difflineplus">+      '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/[6]/[0]/id(&quot;attendees-list&quot;)/' +</span>
<a href="#l80.401"></a><span id="l80.401" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;listbox&quot;})/[1]/[1]/anon({&quot;anonid&quot;:&quot;input&quot;})/' +</span>
<a href="#l80.402"></a><span id="l80.402" class="difflineplus">+      'anon({&quot;class&quot;:&quot;autocomplete-textbox-container&quot;})/' +</span>
<a href="#l80.403"></a><span id="l80.403" class="difflineplus">+      '{&quot;class&quot;:&quot;textbox-input-box&quot;}/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l80.404"></a><span id="l80.404" class="difflineplus">+    attendees.waitForElement(input);</span>
<a href="#l80.405"></a><span id="l80.405" class="difflineplus">+    attendees.type(input, attendee);</span>
<a href="#l80.406"></a><span id="l80.406" class="difflineplus">+    attendees.click(new elementslib.Lookup(attendees.window.document,</span>
<a href="#l80.407"></a><span id="l80.407" class="difflineplus">+      '/id(&quot;calendar-event-dialog-attendees-v2&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l80.408"></a><span id="l80.408"> }</span>
<a href="#l80.409"></a><span id="l80.409"> </span>
<a href="#l80.410"></a><span id="l80.410"> function checkIcon(eventBox, row, col) {</span>
<a href="#l80.411"></a><span id="l80.411" class="difflineminus">-  let icon = new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.412"></a><span id="l80.412" class="difflineminus">-    (eventBox + '/anon({&quot;anonid&quot;:&quot;category-box-stack&quot;})/anon({&quot;align&quot;: &quot;right&quot;})/anon({&quot;class&quot;:&quot;alarm-icons-box&quot;})/anon({&quot;class&quot;: &quot;reminder-icon&quot;})')</span>
<a href="#l80.413"></a><span id="l80.413" class="difflineminus">-    .replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col));</span>
<a href="#l80.414"></a><span id="l80.414" class="difflineminus">-  controller.assertJS(icon.getNode().getAttribute(&quot;value&quot;) == &quot;DISPLAY&quot;);</span>
<a href="#l80.415"></a><span id="l80.415" class="difflineplus">+    let icon = new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.416"></a><span id="l80.416" class="difflineplus">+      (eventBox + '/anon({&quot;anonid&quot;:&quot;category-box-stack&quot;})/anon({&quot;align&quot;: &quot;right&quot;})/anon({&quot;class&quot;:&quot;alarm-icons-box&quot;})/anon({&quot;class&quot;: &quot;reminder-icon&quot;})')</span>
<a href="#l80.417"></a><span id="l80.417" class="difflineplus">+      .replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col));</span>
<a href="#l80.418"></a><span id="l80.418" class="difflineplus">+    controller.assertJS(icon.getNode().getAttribute(&quot;value&quot;) == &quot;DISPLAY&quot;);</span>
<a href="#l80.419"></a><span id="l80.419"> }</span>
<a href="#l80.420"></a><span id="l80.420"> </span>
<a href="#l80.421"></a><span id="l80.421"> function checkTooltip(monthView, row, col, date, startTime, endTime) {</span>
<a href="#l80.422"></a><span id="l80.422" class="difflineminus">-  let mouseOverItem = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l80.423"></a><span id="l80.423" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/' +</span>
<a href="#l80.424"></a><span id="l80.424" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l80.425"></a><span id="l80.425" class="difflineminus">-  controller.mouseOver(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.426"></a><span id="l80.426" class="difflineminus">-          mouseOverItem.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.427"></a><span id="l80.427" class="difflineplus">+    let mouseOverItem = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l80.428"></a><span id="l80.428" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[rowNumber]/[columnNumber]/' +</span>
<a href="#l80.429"></a><span id="l80.429" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l80.430"></a><span id="l80.430" class="difflineplus">+    controller.mouseOver(new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.431"></a><span id="l80.431" class="difflineplus">+            mouseOverItem.replace(&quot;rowNumber&quot;, row).replace(&quot;columnNumber&quot;, col)));</span>
<a href="#l80.432"></a><span id="l80.432"> </span>
<a href="#l80.433"></a><span id="l80.433" class="difflineminus">-  // check title</span>
<a href="#l80.434"></a><span id="l80.434" class="difflineminus">-  let eventName = new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.435"></a><span id="l80.435" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/' +</span>
<a href="#l80.436"></a><span id="l80.436" class="difflineminus">-    '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[0]/[1]');</span>
<a href="#l80.437"></a><span id="l80.437" class="difflineminus">-  controller.assertJS(eventName.getNode().textContent == title);</span>
<a href="#l80.438"></a><span id="l80.438" class="difflineplus">+    // check title</span>
<a href="#l80.439"></a><span id="l80.439" class="difflineplus">+    let eventName = new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.440"></a><span id="l80.440" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/' +</span>
<a href="#l80.441"></a><span id="l80.441" class="difflineplus">+      '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[0]/[1]');</span>
<a href="#l80.442"></a><span id="l80.442" class="difflineplus">+    controller.assertJS(eventName.getNode().textContent == title);</span>
<a href="#l80.443"></a><span id="l80.443"> </span>
<a href="#l80.444"></a><span id="l80.444" class="difflineminus">-  // check date and time</span>
<a href="#l80.445"></a><span id="l80.445" class="difflineminus">-  // date-time string contains strings formatted in operating system language so check numeric values only</span>
<a href="#l80.446"></a><span id="l80.446" class="difflineminus">-  let dateTime = new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.447"></a><span id="l80.447" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/' +</span>
<a href="#l80.448"></a><span id="l80.448" class="difflineminus">-    '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[2]/[1]').getNode().textContent;</span>
<a href="#l80.449"></a><span id="l80.449" class="difflineminus">-  controller.assertJS(dateTime.includes(date) &amp;&amp; dateTime.includes(startTime) &amp;&amp;</span>
<a href="#l80.450"></a><span id="l80.450" class="difflineminus">-    dateTime.includes(endTime));</span>
<a href="#l80.451"></a><span id="l80.451" class="difflineplus">+    // check date and time</span>
<a href="#l80.452"></a><span id="l80.452" class="difflineplus">+    // date-time string contains strings formatted in operating system language so check numeric values only</span>
<a href="#l80.453"></a><span id="l80.453" class="difflineplus">+    let dateTime = new elementslib.Lookup(controller.window.document,</span>
<a href="#l80.454"></a><span id="l80.454" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;itemTooltip&quot;)/' +</span>
<a href="#l80.455"></a><span id="l80.455" class="difflineplus">+      '{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/[1]/[2]/[1]').getNode().textContent;</span>
<a href="#l80.456"></a><span id="l80.456" class="difflineplus">+    controller.assertJS(dateTime.includes(date) &amp;&amp; dateTime.includes(startTime) &amp;&amp;</span>
<a href="#l80.457"></a><span id="l80.457" class="difflineplus">+      dateTime.includes(endTime));</span>
<a href="#l80.458"></a><span id="l80.458"> }</span>
<a href="#l80.459"></a><span id="l80.459"> </span>
<a href="#l80.460"></a><span id="l80.460"> var teardownTest = function(module) {</span>
<a href="#l80.461"></a><span id="l80.461" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l80.462"></a><span id="l80.462" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l80.463"></a><span id="l80.463"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testEventDialogModificationPrompt.js</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -49,136 +49,136 @@ var data = [{</span>
<a href="#l81.4"></a><span id="l81.4"> }];</span>
<a href="#l81.5"></a><span id="l81.5"> var newlines = [{ title: &quot;title&quot;, description: &quot;  test spaces  &quot; },</span>
<a href="#l81.6"></a><span id="l81.6">                 { title: &quot;title&quot;, description: &quot;\ntest newline\n&quot; },</span>
<a href="#l81.7"></a><span id="l81.7">                 { title: &quot;title&quot;, description: &quot;\rtest \\r\r&quot; },</span>
<a href="#l81.8"></a><span id="l81.8">                 { title: &quot;title&quot;, description: &quot;\r\ntest \\r\\n\r\n&quot; },</span>
<a href="#l81.9"></a><span id="l81.9">                 { title: &quot;title&quot;, description: &quot;\ttest \\t\t&quot; }];</span>
<a href="#l81.10"></a><span id="l81.10"> </span>
<a href="#l81.11"></a><span id="l81.11"> var setupModule = function(module) {</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l81.14"></a><span id="l81.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l81.15"></a><span id="l81.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l81.16"></a><span id="l81.16"> </span>
<a href="#l81.17"></a><span id="l81.17" class="difflineminus">-  let categories = prefs.preferences.getPref(&quot;calendar.categories.names&quot;, &quot;string&quot;).split(&quot;,&quot;);</span>
<a href="#l81.18"></a><span id="l81.18" class="difflineminus">-  data[0].category = categories[0];</span>
<a href="#l81.19"></a><span id="l81.19" class="difflineminus">-  data[1].category = categories[1];</span>
<a href="#l81.20"></a><span id="l81.20" class="difflineplus">+    let categories = prefs.preferences.getPref(&quot;calendar.categories.names&quot;, &quot;string&quot;).split(&quot;,&quot;);</span>
<a href="#l81.21"></a><span id="l81.21" class="difflineplus">+    data[0].category = categories[0];</span>
<a href="#l81.22"></a><span id="l81.22" class="difflineplus">+    data[1].category = categories[1];</span>
<a href="#l81.23"></a><span id="l81.23"> };</span>
<a href="#l81.24"></a><span id="l81.24"> </span>
<a href="#l81.25"></a><span id="l81.25"> // Test that closing an event dialog with no changes does not prompt for save</span>
<a href="#l81.26"></a><span id="l81.26"> var testEventDialogModificationPrompt = function() {</span>
<a href="#l81.27"></a><span id="l81.27" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l81.28"></a><span id="l81.28" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l81.29"></a><span id="l81.29" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l81.30"></a><span id="l81.30" class="difflineminus">-</span>
<a href="#l81.31"></a><span id="l81.31" class="difflineminus">-  // create new event</span>
<a href="#l81.32"></a><span id="l81.32" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.33"></a><span id="l81.33" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l81.34"></a><span id="l81.34" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.35"></a><span id="l81.35" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.36"></a><span id="l81.36" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.37"></a><span id="l81.37" class="difflineminus">-</span>
<a href="#l81.38"></a><span id="l81.38" class="difflineminus">-  // enter first set of data</span>
<a href="#l81.39"></a><span id="l81.39" class="difflineminus">-  calUtils.setData(event, data[0]);</span>
<a href="#l81.40"></a><span id="l81.40" class="difflineminus">-</span>
<a href="#l81.41"></a><span id="l81.41" class="difflineminus">-  // save</span>
<a href="#l81.42"></a><span id="l81.42" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l81.43"></a><span id="l81.43" class="difflineminus">-</span>
<a href="#l81.44"></a><span id="l81.44" class="difflineminus">-  // open, but change nothing</span>
<a href="#l81.45"></a><span id="l81.45" class="difflineminus">-  let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.46"></a><span id="l81.46" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l81.47"></a><span id="l81.47" class="difflineminus">-    '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l81.48"></a><span id="l81.48" class="difflineminus">-  controller.waitForElement(eventBox);</span>
<a href="#l81.49"></a><span id="l81.49" class="difflineminus">-  controller.doubleClick(eventBox);</span>
<a href="#l81.50"></a><span id="l81.50" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.51"></a><span id="l81.51" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.52"></a><span id="l81.52" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.53"></a><span id="l81.53" class="difflineminus">-</span>
<a href="#l81.54"></a><span id="l81.54" class="difflineminus">-  // modal dialog setup</span>
<a href="#l81.55"></a><span id="l81.55" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l81.56"></a><span id="l81.56" class="difflineminus">-  dialog.start(handleSavePrompt);</span>
<a href="#l81.57"></a><span id="l81.57" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l81.58"></a><span id="l81.58" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l81.59"></a><span id="l81.59" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l81.60"></a><span id="l81.60"> </span>
<a href="#l81.61"></a><span id="l81.61" class="difflineminus">-  // escape the event window, there should be no prompt to save event</span>
<a href="#l81.62"></a><span id="l81.62" class="difflineminus">-  event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l81.63"></a><span id="l81.63" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l81.64"></a><span id="l81.64" class="difflineminus">-  dialog.stop();</span>
<a href="#l81.65"></a><span id="l81.65" class="difflineminus">-</span>
<a href="#l81.66"></a><span id="l81.66" class="difflineminus">-  // open</span>
<a href="#l81.67"></a><span id="l81.67" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.68"></a><span id="l81.68" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l81.69"></a><span id="l81.69" class="difflineminus">-    '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l81.70"></a><span id="l81.70" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.71"></a><span id="l81.71" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.72"></a><span id="l81.72" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.73"></a><span id="l81.73" class="difflineminus">-</span>
<a href="#l81.74"></a><span id="l81.74" class="difflineminus">-  // change all values</span>
<a href="#l81.75"></a><span id="l81.75" class="difflineminus">-  calUtils.setData(event, data[1]);</span>
<a href="#l81.76"></a><span id="l81.76" class="difflineminus">-</span>
<a href="#l81.77"></a><span id="l81.77" class="difflineminus">-  // edit all values back to original</span>
<a href="#l81.78"></a><span id="l81.78" class="difflineminus">-  calUtils.setData(event, data[0]);</span>
<a href="#l81.79"></a><span id="l81.79" class="difflineminus">-</span>
<a href="#l81.80"></a><span id="l81.80" class="difflineminus">-  // this is set up after data entry because otherwise it tries to handle attachment dialog</span>
<a href="#l81.81"></a><span id="l81.81" class="difflineminus">-  dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l81.82"></a><span id="l81.82" class="difflineminus">-  dialog.start(handleSavePrompt);</span>
<a href="#l81.83"></a><span id="l81.83" class="difflineminus">-</span>
<a href="#l81.84"></a><span id="l81.84" class="difflineminus">-  // escape the event window, there should be no prompt to save event</span>
<a href="#l81.85"></a><span id="l81.85" class="difflineminus">-  event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l81.86"></a><span id="l81.86" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l81.87"></a><span id="l81.87" class="difflineminus">-  dialog.stop();</span>
<a href="#l81.88"></a><span id="l81.88" class="difflineminus">-</span>
<a href="#l81.89"></a><span id="l81.89" class="difflineminus">-  // delete event</span>
<a href="#l81.90"></a><span id="l81.90" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.91"></a><span id="l81.91" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l81.92"></a><span id="l81.92" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l81.93"></a><span id="l81.93" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l81.94"></a><span id="l81.94" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.95"></a><span id="l81.95" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l81.96"></a><span id="l81.96" class="difflineminus">-</span>
<a href="#l81.97"></a><span id="l81.97" class="difflineminus">-  for (let i = 0; i &lt; newlines.length; i++) {</span>
<a href="#l81.98"></a><span id="l81.98" class="difflineminus">-    // test set i</span>
<a href="#l81.99"></a><span id="l81.99" class="difflineplus">+    // create new event</span>
<a href="#l81.100"></a><span id="l81.100">     controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.101"></a><span id="l81.101">       calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l81.102"></a><span id="l81.102">     controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.103"></a><span id="l81.103" class="difflineminus">-    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.104"></a><span id="l81.104" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.105"></a><span id="l81.105">       .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.106"></a><span id="l81.106" class="difflineminus">-    calUtils.setData(event, newlines[i]);</span>
<a href="#l81.107"></a><span id="l81.107" class="difflineplus">+</span>
<a href="#l81.108"></a><span id="l81.108" class="difflineplus">+    // enter first set of data</span>
<a href="#l81.109"></a><span id="l81.109" class="difflineplus">+    calUtils.setData(event, data[0]);</span>
<a href="#l81.110"></a><span id="l81.110" class="difflineplus">+</span>
<a href="#l81.111"></a><span id="l81.111" class="difflineplus">+    // save</span>
<a href="#l81.112"></a><span id="l81.112">     event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l81.113"></a><span id="l81.113"> </span>
<a href="#l81.114"></a><span id="l81.114" class="difflineminus">-    // open and close</span>
<a href="#l81.115"></a><span id="l81.115" class="difflineminus">-    eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.116"></a><span id="l81.116" class="difflineplus">+    // open, but change nothing</span>
<a href="#l81.117"></a><span id="l81.117" class="difflineplus">+    let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.118"></a><span id="l81.118">       calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l81.119"></a><span id="l81.119">       '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l81.120"></a><span id="l81.120">     controller.waitForElement(eventBox);</span>
<a href="#l81.121"></a><span id="l81.121">     controller.doubleClick(eventBox);</span>
<a href="#l81.122"></a><span id="l81.122">     controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.123"></a><span id="l81.123">     event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.124"></a><span id="l81.124">       .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.125"></a><span id="l81.125" class="difflineminus">-    dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l81.126"></a><span id="l81.126" class="difflineplus">+</span>
<a href="#l81.127"></a><span id="l81.127" class="difflineplus">+    // modal dialog setup</span>
<a href="#l81.128"></a><span id="l81.128" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l81.129"></a><span id="l81.129">     dialog.start(handleSavePrompt);</span>
<a href="#l81.130"></a><span id="l81.130" class="difflineplus">+</span>
<a href="#l81.131"></a><span id="l81.131" class="difflineplus">+    // escape the event window, there should be no prompt to save event</span>
<a href="#l81.132"></a><span id="l81.132">     event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l81.133"></a><span id="l81.133">     controller.sleep(sleep);</span>
<a href="#l81.134"></a><span id="l81.134">     dialog.stop();</span>
<a href="#l81.135"></a><span id="l81.135"> </span>
<a href="#l81.136"></a><span id="l81.136" class="difflineminus">-    // delete it</span>
<a href="#l81.137"></a><span id="l81.137" class="difflineminus">-    // XXX somehow the event is selected at this point, this didn't use to be the case</span>
<a href="#l81.138"></a><span id="l81.138" class="difflineminus">-    // and can't be reproduced manually</span>
<a href="#l81.139"></a><span id="l81.139" class="difflineplus">+    // open</span>
<a href="#l81.140"></a><span id="l81.140" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.141"></a><span id="l81.141" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l81.142"></a><span id="l81.142" class="difflineplus">+      '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}'));</span>
<a href="#l81.143"></a><span id="l81.143" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.144"></a><span id="l81.144" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.145"></a><span id="l81.145" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.146"></a><span id="l81.146" class="difflineplus">+</span>
<a href="#l81.147"></a><span id="l81.147" class="difflineplus">+    // change all values</span>
<a href="#l81.148"></a><span id="l81.148" class="difflineplus">+    calUtils.setData(event, data[1]);</span>
<a href="#l81.149"></a><span id="l81.149" class="difflineplus">+</span>
<a href="#l81.150"></a><span id="l81.150" class="difflineplus">+    // edit all values back to original</span>
<a href="#l81.151"></a><span id="l81.151" class="difflineplus">+    calUtils.setData(event, data[0]);</span>
<a href="#l81.152"></a><span id="l81.152" class="difflineplus">+</span>
<a href="#l81.153"></a><span id="l81.153" class="difflineplus">+    // this is set up after data entry because otherwise it tries to handle attachment dialog</span>
<a href="#l81.154"></a><span id="l81.154" class="difflineplus">+    dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l81.155"></a><span id="l81.155" class="difflineplus">+    dialog.start(handleSavePrompt);</span>
<a href="#l81.156"></a><span id="l81.156" class="difflineplus">+</span>
<a href="#l81.157"></a><span id="l81.157" class="difflineplus">+    // escape the event window, there should be no prompt to save event</span>
<a href="#l81.158"></a><span id="l81.158" class="difflineplus">+    event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l81.159"></a><span id="l81.159" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l81.160"></a><span id="l81.160" class="difflineplus">+    dialog.stop();</span>
<a href="#l81.161"></a><span id="l81.161" class="difflineplus">+</span>
<a href="#l81.162"></a><span id="l81.162" class="difflineplus">+    // delete event</span>
<a href="#l81.163"></a><span id="l81.163" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.164"></a><span id="l81.164" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l81.165"></a><span id="l81.165">     controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l81.166"></a><span id="l81.166">       &quot;VK_DELETE&quot;, {});</span>
<a href="#l81.167"></a><span id="l81.167">     controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.168"></a><span id="l81.168">       calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l81.169"></a><span id="l81.169" class="difflineminus">-  }</span>
<a href="#l81.170"></a><span id="l81.170" class="difflineplus">+</span>
<a href="#l81.171"></a><span id="l81.171" class="difflineplus">+    for (let i = 0; i &lt; newlines.length; i++) {</span>
<a href="#l81.172"></a><span id="l81.172" class="difflineplus">+        // test set i</span>
<a href="#l81.173"></a><span id="l81.173" class="difflineplus">+        controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.174"></a><span id="l81.174" class="difflineplus">+          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)), 1, 1);</span>
<a href="#l81.175"></a><span id="l81.175" class="difflineplus">+        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.176"></a><span id="l81.176" class="difflineplus">+        event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.177"></a><span id="l81.177" class="difflineplus">+          .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.178"></a><span id="l81.178" class="difflineplus">+        calUtils.setData(event, newlines[i]);</span>
<a href="#l81.179"></a><span id="l81.179" class="difflineplus">+        event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l81.180"></a><span id="l81.180" class="difflineplus">+</span>
<a href="#l81.181"></a><span id="l81.181" class="difflineplus">+        // open and close</span>
<a href="#l81.182"></a><span id="l81.182" class="difflineplus">+        eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.183"></a><span id="l81.183" class="difflineplus">+          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l81.184"></a><span id="l81.184" class="difflineplus">+          '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;}');</span>
<a href="#l81.185"></a><span id="l81.185" class="difflineplus">+        controller.waitForElement(eventBox);</span>
<a href="#l81.186"></a><span id="l81.186" class="difflineplus">+        controller.doubleClick(eventBox);</span>
<a href="#l81.187"></a><span id="l81.187" class="difflineplus">+        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l81.188"></a><span id="l81.188" class="difflineplus">+        event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l81.189"></a><span id="l81.189" class="difflineplus">+          .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l81.190"></a><span id="l81.190" class="difflineplus">+        dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l81.191"></a><span id="l81.191" class="difflineplus">+        dialog.start(handleSavePrompt);</span>
<a href="#l81.192"></a><span id="l81.192" class="difflineplus">+        event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l81.193"></a><span id="l81.193" class="difflineplus">+        controller.sleep(sleep);</span>
<a href="#l81.194"></a><span id="l81.194" class="difflineplus">+        dialog.stop();</span>
<a href="#l81.195"></a><span id="l81.195" class="difflineplus">+</span>
<a href="#l81.196"></a><span id="l81.196" class="difflineplus">+        // delete it</span>
<a href="#l81.197"></a><span id="l81.197" class="difflineplus">+        // XXX somehow the event is selected at this point, this didn't use to be the case</span>
<a href="#l81.198"></a><span id="l81.198" class="difflineplus">+        // and can't be reproduced manually</span>
<a href="#l81.199"></a><span id="l81.199" class="difflineplus">+        controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l81.200"></a><span id="l81.200" class="difflineplus">+          &quot;VK_DELETE&quot;, {});</span>
<a href="#l81.201"></a><span id="l81.201" class="difflineplus">+        controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.202"></a><span id="l81.202" class="difflineplus">+          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8)));</span>
<a href="#l81.203"></a><span id="l81.203" class="difflineplus">+    }</span>
<a href="#l81.204"></a><span id="l81.204"> };</span>
<a href="#l81.205"></a><span id="l81.205"> </span>
<a href="#l81.206"></a><span id="l81.206"> var teardownTest = function(module) {</span>
<a href="#l81.207"></a><span id="l81.207" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l81.208"></a><span id="l81.208" class="difflineminus">-  if (pass != undefined &amp;&amp; pass == false) {</span>
<a href="#l81.209"></a><span id="l81.209" class="difflineminus">-    controller.assertJS('&quot;Prompt appeared&quot; == &quot;Prompt didn\'t appear.&quot;');</span>
<a href="#l81.210"></a><span id="l81.210" class="difflineminus">-  }</span>
<a href="#l81.211"></a><span id="l81.211" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l81.212"></a><span id="l81.212" class="difflineplus">+    if (pass != undefined &amp;&amp; pass == false) {</span>
<a href="#l81.213"></a><span id="l81.213" class="difflineplus">+        controller.assertJS('&quot;Prompt appeared&quot; == &quot;Prompt didn\'t appear.&quot;');</span>
<a href="#l81.214"></a><span id="l81.214" class="difflineplus">+    }</span>
<a href="#l81.215"></a><span id="l81.215"> };</span>
<a href="#l81.216"></a><span id="l81.216"> </span>
<a href="#l81.217"></a><span id="l81.217"> function handleSavePrompt(controller) {</span>
<a href="#l81.218"></a><span id="l81.218" class="difflineminus">-  // unexpected prompt, thus the test has already failed</span>
<a href="#l81.219"></a><span id="l81.219" class="difflineminus">-  // can't trigger a failure though, because the following click wouldn't be executed</span>
<a href="#l81.220"></a><span id="l81.220" class="difflineminus">-  // so remembering it</span>
<a href="#l81.221"></a><span id="l81.221" class="difflineminus">-  pass = false;</span>
<a href="#l81.222"></a><span id="l81.222" class="difflineminus">-  // application close is blocked without it</span>
<a href="#l81.223"></a><span id="l81.223" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.224"></a><span id="l81.224" class="difflineminus">-    '/id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;extra1&quot;}'));</span>
<a href="#l81.225"></a><span id="l81.225" class="difflineplus">+    // unexpected prompt, thus the test has already failed</span>
<a href="#l81.226"></a><span id="l81.226" class="difflineplus">+    // can't trigger a failure though, because the following click wouldn't be executed</span>
<a href="#l81.227"></a><span id="l81.227" class="difflineplus">+    // so remembering it</span>
<a href="#l81.228"></a><span id="l81.228" class="difflineplus">+    pass = false;</span>
<a href="#l81.229"></a><span id="l81.229" class="difflineplus">+    // application close is blocked without it</span>
<a href="#l81.230"></a><span id="l81.230" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l81.231"></a><span id="l81.231" class="difflineplus">+      '/id(&quot;commonDialog&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;extra1&quot;}'));</span>
<a href="#l81.232"></a><span id="l81.232"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -6,81 +6,81 @@ var calUtils = require(&quot;../shared-module</span>
<a href="#l82.4"></a><span id="l82.4"> var prefs = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l82.5"></a><span id="l82.5"> </span>
<a href="#l82.6"></a><span id="l82.6"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l82.7"></a><span id="l82.7"> </span>
<a href="#l82.8"></a><span id="l82.8"> var sleep = 500;</span>
<a href="#l82.9"></a><span id="l82.9"> var UTF8string = &quot;&quot;;</span>
<a href="#l82.10"></a><span id="l82.10"> </span>
<a href="#l82.11"></a><span id="l82.11"> var setupModule = function(module) {</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineminus">-  calUtils.createCalendar(controller, UTF8string);</span>
<a href="#l82.14"></a><span id="l82.14" class="difflineminus">-  Preferences.set(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l82.15"></a><span id="l82.15" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l82.16"></a><span id="l82.16" class="difflineplus">+    calUtils.createCalendar(controller, UTF8string);</span>
<a href="#l82.17"></a><span id="l82.17" class="difflineplus">+    Preferences.set(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l82.18"></a><span id="l82.18"> };</span>
<a href="#l82.19"></a><span id="l82.19"> </span>
<a href="#l82.20"></a><span id="l82.20"> var testUTF8 = function() {</span>
<a href="#l82.21"></a><span id="l82.21" class="difflineminus">-  let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l82.22"></a><span id="l82.22" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l82.23"></a><span id="l82.23"> </span>
<a href="#l82.24"></a><span id="l82.24" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l82.25"></a><span id="l82.25" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l82.26"></a><span id="l82.26" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l82.27"></a><span id="l82.27" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l82.28"></a><span id="l82.28"> </span>
<a href="#l82.29"></a><span id="l82.29" class="difflineminus">-  // create new event</span>
<a href="#l82.30"></a><span id="l82.30" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l82.31"></a><span id="l82.31" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)));</span>
<a href="#l82.32"></a><span id="l82.32" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l82.33"></a><span id="l82.33" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l82.34"></a><span id="l82.34" class="difflineplus">+    // create new event</span>
<a href="#l82.35"></a><span id="l82.35" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l82.36"></a><span id="l82.36" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, 8)));</span>
<a href="#l82.37"></a><span id="l82.37" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l82.38"></a><span id="l82.38" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l82.39"></a><span id="l82.39"> </span>
<a href="#l82.40"></a><span id="l82.40" class="difflineminus">-  // fill in name, location, description</span>
<a href="#l82.41"></a><span id="l82.41" class="difflineminus">-  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.42"></a><span id="l82.42" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.43"></a><span id="l82.43" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l82.44"></a><span id="l82.44" class="difflineminus">-  event.waitForElement(titleTextBox);</span>
<a href="#l82.45"></a><span id="l82.45" class="difflineminus">-  event.type(titleTextBox, UTF8string);</span>
<a href="#l82.46"></a><span id="l82.46" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.47"></a><span id="l82.47" class="difflineminus">-    'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.48"></a><span id="l82.48" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.49"></a><span id="l82.49" class="difflineminus">-    UTF8string);</span>
<a href="#l82.50"></a><span id="l82.50" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.51"></a><span id="l82.51" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l82.52"></a><span id="l82.52" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.53"></a><span id="l82.53" class="difflineminus">-    UTF8string);</span>
<a href="#l82.54"></a><span id="l82.54" class="difflineplus">+    // fill in name, location, description</span>
<a href="#l82.55"></a><span id="l82.55" class="difflineplus">+    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.56"></a><span id="l82.56" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.57"></a><span id="l82.57" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l82.58"></a><span id="l82.58" class="difflineplus">+    event.waitForElement(titleTextBox);</span>
<a href="#l82.59"></a><span id="l82.59" class="difflineplus">+    event.type(titleTextBox, UTF8string);</span>
<a href="#l82.60"></a><span id="l82.60" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.61"></a><span id="l82.61" class="difflineplus">+      'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.62"></a><span id="l82.62" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.63"></a><span id="l82.63" class="difflineplus">+      UTF8string);</span>
<a href="#l82.64"></a><span id="l82.64" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.65"></a><span id="l82.65" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l82.66"></a><span id="l82.66" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.67"></a><span id="l82.67" class="difflineplus">+      UTF8string);</span>
<a href="#l82.68"></a><span id="l82.68"> </span>
<a href="#l82.69"></a><span id="l82.69" class="difflineminus">-  // select category</span>
<a href="#l82.70"></a><span id="l82.70" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l82.71"></a><span id="l82.71" class="difflineminus">-    UTF8string);</span>
<a href="#l82.72"></a><span id="l82.72" class="difflineplus">+    // select category</span>
<a href="#l82.73"></a><span id="l82.73" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l82.74"></a><span id="l82.74" class="difflineplus">+      UTF8string);</span>
<a href="#l82.75"></a><span id="l82.75"> </span>
<a href="#l82.76"></a><span id="l82.76" class="difflineminus">-  // save</span>
<a href="#l82.77"></a><span id="l82.77" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l82.78"></a><span id="l82.78" class="difflineplus">+    // save</span>
<a href="#l82.79"></a><span id="l82.79" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l82.80"></a><span id="l82.80"> </span>
<a href="#l82.81"></a><span id="l82.81" class="difflineminus">-  // open</span>
<a href="#l82.82"></a><span id="l82.82" class="difflineminus">-  let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l82.83"></a><span id="l82.83" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l82.84"></a><span id="l82.84" class="difflineminus">-    '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + UTF8string.toLowerCase() + '&quot;}');</span>
<a href="#l82.85"></a><span id="l82.85" class="difflineminus">-  controller.waitForElement(eventBox);</span>
<a href="#l82.86"></a><span id="l82.86" class="difflineminus">-  controller.doubleClick(eventBox);</span>
<a href="#l82.87"></a><span id="l82.87" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l82.88"></a><span id="l82.88" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l82.89"></a><span id="l82.89" class="difflineplus">+    // open</span>
<a href="#l82.90"></a><span id="l82.90" class="difflineplus">+    let eventBox = new elementslib.Lookup(controller.window.document,</span>
<a href="#l82.91"></a><span id="l82.91" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, 8) +</span>
<a href="#l82.92"></a><span id="l82.92" class="difflineplus">+      '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + UTF8string.toLowerCase() + '&quot;}');</span>
<a href="#l82.93"></a><span id="l82.93" class="difflineplus">+    controller.waitForElement(eventBox);</span>
<a href="#l82.94"></a><span id="l82.94" class="difflineplus">+    controller.doubleClick(eventBox);</span>
<a href="#l82.95"></a><span id="l82.95" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l82.96"></a><span id="l82.96" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l82.97"></a><span id="l82.97"> </span>
<a href="#l82.98"></a><span id="l82.98" class="difflineminus">-  // check values</span>
<a href="#l82.99"></a><span id="l82.99" class="difflineminus">-  titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.100"></a><span id="l82.100" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.101"></a><span id="l82.101" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l82.102"></a><span id="l82.102" class="difflineminus">-  event.waitForElement(titleTextBox);</span>
<a href="#l82.103"></a><span id="l82.103" class="difflineminus">-  event.assertValue(titleTextBox, UTF8string);</span>
<a href="#l82.104"></a><span id="l82.104" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.105"></a><span id="l82.105" class="difflineminus">-    'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.106"></a><span id="l82.106" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.107"></a><span id="l82.107" class="difflineminus">-    UTF8string);</span>
<a href="#l82.108"></a><span id="l82.108" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.109"></a><span id="l82.109" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l82.110"></a><span id="l82.110" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.111"></a><span id="l82.111" class="difflineminus">-    UTF8string);</span>
<a href="#l82.112"></a><span id="l82.112" class="difflineminus">-  event.assertValue(new elementslib.ID(event.window.document, &quot;item-categories&quot;),</span>
<a href="#l82.113"></a><span id="l82.113" class="difflineminus">-    UTF8string);</span>
<a href="#l82.114"></a><span id="l82.114" class="difflineplus">+    // check values</span>
<a href="#l82.115"></a><span id="l82.115" class="difflineplus">+    titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.116"></a><span id="l82.116" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.117"></a><span id="l82.117" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l82.118"></a><span id="l82.118" class="difflineplus">+    event.waitForElement(titleTextBox);</span>
<a href="#l82.119"></a><span id="l82.119" class="difflineplus">+    event.assertValue(titleTextBox, UTF8string);</span>
<a href="#l82.120"></a><span id="l82.120" class="difflineplus">+    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.121"></a><span id="l82.121" class="difflineplus">+      'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l82.122"></a><span id="l82.122" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.123"></a><span id="l82.123" class="difflineplus">+      UTF8string);</span>
<a href="#l82.124"></a><span id="l82.124" class="difflineplus">+    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l82.125"></a><span id="l82.125" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l82.126"></a><span id="l82.126" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l82.127"></a><span id="l82.127" class="difflineplus">+      UTF8string);</span>
<a href="#l82.128"></a><span id="l82.128" class="difflineplus">+    event.assertValue(new elementslib.ID(event.window.document, &quot;item-categories&quot;),</span>
<a href="#l82.129"></a><span id="l82.129" class="difflineplus">+      UTF8string);</span>
<a href="#l82.130"></a><span id="l82.130"> </span>
<a href="#l82.131"></a><span id="l82.131" class="difflineminus">-  // escape the event window</span>
<a href="#l82.132"></a><span id="l82.132" class="difflineminus">-  event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l82.133"></a><span id="l82.133" class="difflineplus">+    // escape the event window</span>
<a href="#l82.134"></a><span id="l82.134" class="difflineplus">+    event.keypress(undefined, &quot;VK_ESCAPE&quot;, {});</span>
<a href="#l82.135"></a><span id="l82.135"> };</span>
<a href="#l82.136"></a><span id="l82.136"> </span>
<a href="#l82.137"></a><span id="l82.137"> var teardownTest = function(module) {</span>
<a href="#l82.138"></a><span id="l82.138" class="difflineminus">-  calUtils.deleteCalendars(controller, UTF8string);</span>
<a href="#l82.139"></a><span id="l82.139" class="difflineminus">-  prefs.preferences.clearUserPref(&quot;calendar.categories.names&quot;);</span>
<a href="#l82.140"></a><span id="l82.140" class="difflineplus">+    calUtils.deleteCalendars(controller, UTF8string);</span>
<a href="#l82.141"></a><span id="l82.141" class="difflineplus">+    prefs.preferences.clearUserPref(&quot;calendar.categories.names&quot;);</span>
<a href="#l82.142"></a><span id="l82.142"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testAnnualRecurrence.js</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -5,80 +5,80 @@</span>
<a href="#l83.4"></a><span id="l83.4"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l83.5"></a><span id="l83.5"> </span>
<a href="#l83.6"></a><span id="l83.6"> var sleep = 500;</span>
<a href="#l83.7"></a><span id="l83.7"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l83.8"></a><span id="l83.8"> var startYear = 1950;</span>
<a href="#l83.9"></a><span id="l83.9"> var epoch = 1970;</span>
<a href="#l83.10"></a><span id="l83.10"> </span>
<a href="#l83.11"></a><span id="l83.11"> var setupModule = function(module) {</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l83.14"></a><span id="l83.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l83.15"></a><span id="l83.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l83.16"></a><span id="l83.16"> };</span>
<a href="#l83.17"></a><span id="l83.17"> </span>
<a href="#l83.18"></a><span id="l83.18"> var testAnnualRecurrence = function() {</span>
<a href="#l83.19"></a><span id="l83.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l83.20"></a><span id="l83.20" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l83.21"></a><span id="l83.21" class="difflineplus">+</span>
<a href="#l83.22"></a><span id="l83.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l83.23"></a><span id="l83.23" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l83.24"></a><span id="l83.24" class="difflineplus">+</span>
<a href="#l83.25"></a><span id="l83.25" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l83.26"></a><span id="l83.26" class="difflineplus">+    calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l83.27"></a><span id="l83.27"> </span>
<a href="#l83.28"></a><span id="l83.28" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l83.29"></a><span id="l83.29" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l83.30"></a><span id="l83.30" class="difflineplus">+    // create yearly recurring all-day event</span>
<a href="#l83.31"></a><span id="l83.31" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l83.32"></a><span id="l83.32" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l83.33"></a><span id="l83.33" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l83.34"></a><span id="l83.34" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l83.35"></a><span id="l83.35" class="difflineplus">+                   .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l83.36"></a><span id="l83.36" class="difflineplus">+    event.sleep(sleep);</span>
<a href="#l83.37"></a><span id="l83.37" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l83.38"></a><span id="l83.38" class="difflineplus">+      &quot;yearly&quot;);</span>
<a href="#l83.39"></a><span id="l83.39" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l83.40"></a><span id="l83.40" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l83.41"></a><span id="l83.41"> </span>
<a href="#l83.42"></a><span id="l83.42" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l83.43"></a><span id="l83.43" class="difflineminus">-  calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l83.44"></a><span id="l83.44" class="difflineplus">+    let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l83.45"></a><span id="l83.45" class="difflineplus">+    let box = &quot;&quot;;</span>
<a href="#l83.46"></a><span id="l83.46" class="difflineplus">+    for (let i = 0; i &lt; checkYears.length; i++) {</span>
<a href="#l83.47"></a><span id="l83.47" class="difflineplus">+        calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l83.48"></a><span id="l83.48" class="difflineplus">+        let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l83.49"></a><span id="l83.49" class="difflineplus">+        let column = date.getDay() + 1;</span>
<a href="#l83.50"></a><span id="l83.50"> </span>
<a href="#l83.51"></a><span id="l83.51" class="difflineminus">-  // create yearly recurring all-day event</span>
<a href="#l83.52"></a><span id="l83.52" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l83.53"></a><span id="l83.53" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l83.54"></a><span id="l83.54" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l83.55"></a><span id="l83.55" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l83.56"></a><span id="l83.56" class="difflineminus">-                 .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l83.57"></a><span id="l83.57" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l83.58"></a><span id="l83.58" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l83.59"></a><span id="l83.59" class="difflineminus">-    &quot;yearly&quot;);</span>
<a href="#l83.60"></a><span id="l83.60" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l83.61"></a><span id="l83.61" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l83.62"></a><span id="l83.62" class="difflineplus">+        // day view</span>
<a href="#l83.63"></a><span id="l83.63" class="difflineplus">+        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l83.64"></a><span id="l83.64" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l83.65"></a><span id="l83.65" class="difflineplus">+          eventPath;</span>
<a href="#l83.66"></a><span id="l83.66" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.67"></a><span id="l83.67" class="difflineplus">+</span>
<a href="#l83.68"></a><span id="l83.68" class="difflineplus">+        // week view</span>
<a href="#l83.69"></a><span id="l83.69" class="difflineplus">+        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l83.70"></a><span id="l83.70" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined) +</span>
<a href="#l83.71"></a><span id="l83.71" class="difflineplus">+          eventPath;</span>
<a href="#l83.72"></a><span id="l83.72" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.73"></a><span id="l83.73"> </span>
<a href="#l83.74"></a><span id="l83.74" class="difflineminus">-  let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l83.75"></a><span id="l83.75" class="difflineminus">-  let box = &quot;&quot;;</span>
<a href="#l83.76"></a><span id="l83.76" class="difflineminus">-  for (let i = 0; i &lt; checkYears.length; i++) {</span>
<a href="#l83.77"></a><span id="l83.77" class="difflineminus">-    calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l83.78"></a><span id="l83.78" class="difflineminus">-    let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l83.79"></a><span id="l83.79" class="difflineminus">-    let column = date.getDay() + 1;</span>
<a href="#l83.80"></a><span id="l83.80" class="difflineplus">+        // multiweek view</span>
<a href="#l83.81"></a><span id="l83.81" class="difflineplus">+        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l83.82"></a><span id="l83.82" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l83.83"></a><span id="l83.83" class="difflineplus">+          eventPath;</span>
<a href="#l83.84"></a><span id="l83.84" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.85"></a><span id="l83.85"> </span>
<a href="#l83.86"></a><span id="l83.86" class="difflineminus">-    // day view</span>
<a href="#l83.87"></a><span id="l83.87" class="difflineplus">+        // month view</span>
<a href="#l83.88"></a><span id="l83.88" class="difflineplus">+        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l83.89"></a><span id="l83.89" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l83.90"></a><span id="l83.90" class="difflineplus">+          eventPath;</span>
<a href="#l83.91"></a><span id="l83.91" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.92"></a><span id="l83.92" class="difflineplus">+    }</span>
<a href="#l83.93"></a><span id="l83.93" class="difflineplus">+</span>
<a href="#l83.94"></a><span id="l83.94" class="difflineplus">+    // delete event</span>
<a href="#l83.95"></a><span id="l83.95" class="difflineplus">+    calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l83.96"></a><span id="l83.96">     calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l83.97"></a><span id="l83.97">     box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l83.98"></a><span id="l83.98">       eventPath;</span>
<a href="#l83.99"></a><span id="l83.99" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.100"></a><span id="l83.100" class="difflineminus">-</span>
<a href="#l83.101"></a><span id="l83.101" class="difflineminus">-    // week view</span>
<a href="#l83.102"></a><span id="l83.102" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l83.103"></a><span id="l83.103" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined) +</span>
<a href="#l83.104"></a><span id="l83.104" class="difflineminus">-      eventPath;</span>
<a href="#l83.105"></a><span id="l83.105" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.106"></a><span id="l83.106" class="difflineminus">-</span>
<a href="#l83.107"></a><span id="l83.107" class="difflineminus">-    // multiweek view</span>
<a href="#l83.108"></a><span id="l83.108" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l83.109"></a><span id="l83.109" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l83.110"></a><span id="l83.110" class="difflineminus">-      eventPath;</span>
<a href="#l83.111"></a><span id="l83.111" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.112"></a><span id="l83.112" class="difflineminus">-</span>
<a href="#l83.113"></a><span id="l83.113" class="difflineminus">-    // month view</span>
<a href="#l83.114"></a><span id="l83.114" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l83.115"></a><span id="l83.115" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l83.116"></a><span id="l83.116" class="difflineminus">-      eventPath;</span>
<a href="#l83.117"></a><span id="l83.117" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.118"></a><span id="l83.118" class="difflineminus">-  }</span>
<a href="#l83.119"></a><span id="l83.119" class="difflineminus">-</span>
<a href="#l83.120"></a><span id="l83.120" class="difflineminus">-  // delete event</span>
<a href="#l83.121"></a><span id="l83.121" class="difflineminus">-  calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l83.122"></a><span id="l83.122" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l83.123"></a><span id="l83.123" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l83.124"></a><span id="l83.124" class="difflineminus">-    eventPath;</span>
<a href="#l83.125"></a><span id="l83.125" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l83.126"></a><span id="l83.126" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.127"></a><span id="l83.127" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l83.128"></a><span id="l83.128" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l83.129"></a><span id="l83.129" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.130"></a><span id="l83.130" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l83.131"></a><span id="l83.131" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.132"></a><span id="l83.132" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l83.133"></a><span id="l83.133" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l83.134"></a><span id="l83.134" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l83.135"></a><span id="l83.135"> };</span>
<a href="#l83.136"></a><span id="l83.136"> </span>
<a href="#l83.137"></a><span id="l83.137"> var teardownTest = function(module) {</span>
<a href="#l83.138"></a><span id="l83.138" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l83.139"></a><span id="l83.139" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l83.140"></a><span id="l83.140"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testBiweeklyRecurrence.js</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -4,103 +4,103 @@</span>
<a href="#l84.4"></a><span id="l84.4"> </span>
<a href="#l84.5"></a><span id="l84.5"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l84.6"></a><span id="l84.6"> </span>
<a href="#l84.7"></a><span id="l84.7"> var sleep = 500;</span>
<a href="#l84.8"></a><span id="l84.8"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l84.9"></a><span id="l84.9"> var hour = 8;</span>
<a href="#l84.10"></a><span id="l84.10"> </span>
<a href="#l84.11"></a><span id="l84.11"> var setupModule = function(module) {</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l84.14"></a><span id="l84.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l84.15"></a><span id="l84.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l84.16"></a><span id="l84.16"> };</span>
<a href="#l84.17"></a><span id="l84.17"> </span>
<a href="#l84.18"></a><span id="l84.18"> var testBiweeklyRecurrence = function() {</span>
<a href="#l84.19"></a><span id="l84.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l84.20"></a><span id="l84.20" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l84.21"></a><span id="l84.21" class="difflineplus">+</span>
<a href="#l84.22"></a><span id="l84.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l84.23"></a><span id="l84.23" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l84.24"></a><span id="l84.24" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.25"></a><span id="l84.25"> </span>
<a href="#l84.26"></a><span id="l84.26" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l84.27"></a><span id="l84.27" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l84.28"></a><span id="l84.28" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.29"></a><span id="l84.29" class="difflineplus">+    // create biweekly event</span>
<a href="#l84.30"></a><span id="l84.30" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l84.31"></a><span id="l84.31" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l84.32"></a><span id="l84.32" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l84.33"></a><span id="l84.33" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l84.34"></a><span id="l84.34"> </span>
<a href="#l84.35"></a><span id="l84.35" class="difflineminus">-  // create biweekly event</span>
<a href="#l84.36"></a><span id="l84.36" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l84.37"></a><span id="l84.37" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l84.38"></a><span id="l84.38" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l84.39"></a><span id="l84.39" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l84.40"></a><span id="l84.40" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l84.41"></a><span id="l84.41" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l84.42"></a><span id="l84.42" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l84.43"></a><span id="l84.43" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l84.44"></a><span id="l84.44" class="difflineplus">+</span>
<a href="#l84.45"></a><span id="l84.45" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l84.46"></a><span id="l84.46" class="difflineplus">+      eventPath;</span>
<a href="#l84.47"></a><span id="l84.47"> </span>
<a href="#l84.48"></a><span id="l84.48" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l84.49"></a><span id="l84.49" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l84.50"></a><span id="l84.50" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l84.51"></a><span id="l84.51" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l84.52"></a><span id="l84.52" class="difflineplus">+    // check day view</span>
<a href="#l84.53"></a><span id="l84.53" class="difflineplus">+    for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l84.54"></a><span id="l84.54" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.55"></a><span id="l84.55" class="difflineplus">+        calUtils.forward(controller, 14);</span>
<a href="#l84.56"></a><span id="l84.56" class="difflineplus">+    }</span>
<a href="#l84.57"></a><span id="l84.57"> </span>
<a href="#l84.58"></a><span id="l84.58" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l84.59"></a><span id="l84.59" class="difflineminus">-    eventPath;</span>
<a href="#l84.60"></a><span id="l84.60" class="difflineplus">+    // check week view</span>
<a href="#l84.61"></a><span id="l84.61" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l84.62"></a><span id="l84.62" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.63"></a><span id="l84.63"> </span>
<a href="#l84.64"></a><span id="l84.64" class="difflineminus">-  // check day view</span>
<a href="#l84.65"></a><span id="l84.65" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l84.66"></a><span id="l84.66" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.67"></a><span id="l84.67" class="difflineminus">-    calUtils.forward(controller, 14);</span>
<a href="#l84.68"></a><span id="l84.68" class="difflineminus">-  }</span>
<a href="#l84.69"></a><span id="l84.69" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l84.70"></a><span id="l84.70" class="difflineplus">+      eventPath;</span>
<a href="#l84.71"></a><span id="l84.71" class="difflineplus">+    for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l84.72"></a><span id="l84.72" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.73"></a><span id="l84.73" class="difflineplus">+        calUtils.forward(controller, 2);</span>
<a href="#l84.74"></a><span id="l84.74" class="difflineplus">+    }</span>
<a href="#l84.75"></a><span id="l84.75"> </span>
<a href="#l84.76"></a><span id="l84.76" class="difflineminus">-  // check week view</span>
<a href="#l84.77"></a><span id="l84.77" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l84.78"></a><span id="l84.78" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.79"></a><span id="l84.79" class="difflineplus">+    // check multiweek view</span>
<a href="#l84.80"></a><span id="l84.80" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l84.81"></a><span id="l84.81" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.82"></a><span id="l84.82"> </span>
<a href="#l84.83"></a><span id="l84.83" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l84.84"></a><span id="l84.84" class="difflineminus">-    eventPath;</span>
<a href="#l84.85"></a><span id="l84.85" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l84.86"></a><span id="l84.86" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.87"></a><span id="l84.87" class="difflineminus">-    calUtils.forward(controller, 2);</span>
<a href="#l84.88"></a><span id="l84.88" class="difflineminus">-  }</span>
<a href="#l84.89"></a><span id="l84.89" class="difflineplus">+    // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l84.90"></a><span id="l84.90" class="difflineplus">+    for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l84.91"></a><span id="l84.91" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l84.92"></a><span id="l84.92" class="difflineplus">+          undefined) + eventPath;</span>
<a href="#l84.93"></a><span id="l84.93" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.94"></a><span id="l84.94" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l84.95"></a><span id="l84.95" class="difflineplus">+          undefined) + eventPath;</span>
<a href="#l84.96"></a><span id="l84.96" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.97"></a><span id="l84.97" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l84.98"></a><span id="l84.98" class="difflineplus">+    }</span>
<a href="#l84.99"></a><span id="l84.99"> </span>
<a href="#l84.100"></a><span id="l84.100" class="difflineminus">-  // check multiweek view</span>
<a href="#l84.101"></a><span id="l84.101" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l84.102"></a><span id="l84.102" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.103"></a><span id="l84.103" class="difflineplus">+    // check month view</span>
<a href="#l84.104"></a><span id="l84.104" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l84.105"></a><span id="l84.105" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.106"></a><span id="l84.106"> </span>
<a href="#l84.107"></a><span id="l84.107" class="difflineminus">-  // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l84.108"></a><span id="l84.108" class="difflineminus">-  for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l84.109"></a><span id="l84.109" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l84.110"></a><span id="l84.110" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l84.111"></a><span id="l84.111" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.112"></a><span id="l84.112" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l84.113"></a><span id="l84.113" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l84.114"></a><span id="l84.114" class="difflineplus">+    // January</span>
<a href="#l84.115"></a><span id="l84.115" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined) +</span>
<a href="#l84.116"></a><span id="l84.116" class="difflineplus">+      eventPath;</span>
<a href="#l84.117"></a><span id="l84.117">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.118"></a><span id="l84.118">     calUtils.forward(controller, 1);</span>
<a href="#l84.119"></a><span id="l84.119" class="difflineminus">-  }</span>
<a href="#l84.120"></a><span id="l84.120"> </span>
<a href="#l84.121"></a><span id="l84.121" class="difflineminus">-  // check month view</span>
<a href="#l84.122"></a><span id="l84.122" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l84.123"></a><span id="l84.123" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l84.124"></a><span id="l84.124" class="difflineminus">-</span>
<a href="#l84.125"></a><span id="l84.125" class="difflineminus">-  // January</span>
<a href="#l84.126"></a><span id="l84.126" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined) +</span>
<a href="#l84.127"></a><span id="l84.127" class="difflineminus">-    eventPath;</span>
<a href="#l84.128"></a><span id="l84.128" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.129"></a><span id="l84.129" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l84.130"></a><span id="l84.130" class="difflineplus">+    // February</span>
<a href="#l84.131"></a><span id="l84.131" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l84.132"></a><span id="l84.132" class="difflineplus">+      eventPath;</span>
<a href="#l84.133"></a><span id="l84.133" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.134"></a><span id="l84.134" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l84.135"></a><span id="l84.135" class="difflineplus">+      eventPath;</span>
<a href="#l84.136"></a><span id="l84.136" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.137"></a><span id="l84.137" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l84.138"></a><span id="l84.138"> </span>
<a href="#l84.139"></a><span id="l84.139" class="difflineminus">-  // February</span>
<a href="#l84.140"></a><span id="l84.140" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l84.141"></a><span id="l84.141" class="difflineminus">-    eventPath;</span>
<a href="#l84.142"></a><span id="l84.142" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.143"></a><span id="l84.143" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l84.144"></a><span id="l84.144" class="difflineminus">-    eventPath;</span>
<a href="#l84.145"></a><span id="l84.145" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.146"></a><span id="l84.146" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l84.147"></a><span id="l84.147" class="difflineplus">+    // March</span>
<a href="#l84.148"></a><span id="l84.148" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l84.149"></a><span id="l84.149" class="difflineplus">+      eventPath;</span>
<a href="#l84.150"></a><span id="l84.150" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.151"></a><span id="l84.151" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l84.152"></a><span id="l84.152" class="difflineplus">+      eventPath;</span>
<a href="#l84.153"></a><span id="l84.153" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.154"></a><span id="l84.154"> </span>
<a href="#l84.155"></a><span id="l84.155" class="difflineminus">-  // March</span>
<a href="#l84.156"></a><span id="l84.156" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l84.157"></a><span id="l84.157" class="difflineminus">-    eventPath;</span>
<a href="#l84.158"></a><span id="l84.158" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.159"></a><span id="l84.159" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l84.160"></a><span id="l84.160" class="difflineminus">-    eventPath;</span>
<a href="#l84.161"></a><span id="l84.161" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.162"></a><span id="l84.162" class="difflineminus">-</span>
<a href="#l84.163"></a><span id="l84.163" class="difflineminus">-  // delete event</span>
<a href="#l84.164"></a><span id="l84.164" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.165"></a><span id="l84.165" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l84.166"></a><span id="l84.166" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l84.167"></a><span id="l84.167" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l84.168"></a><span id="l84.168" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.169"></a><span id="l84.169" class="difflineplus">+    // delete event</span>
<a href="#l84.170"></a><span id="l84.170" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.171"></a><span id="l84.171" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l84.172"></a><span id="l84.172" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l84.173"></a><span id="l84.173" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l84.174"></a><span id="l84.174" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l84.175"></a><span id="l84.175"> };</span>
<a href="#l84.176"></a><span id="l84.176"> </span>
<a href="#l84.177"></a><span id="l84.177"> var teardownTest = function(module) {</span>
<a href="#l84.178"></a><span id="l84.178" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l84.179"></a><span id="l84.179" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l84.180"></a><span id="l84.180"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -4,202 +4,202 @@</span>
<a href="#l85.4"></a><span id="l85.4"> </span>
<a href="#l85.5"></a><span id="l85.5"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l85.6"></a><span id="l85.6"> </span>
<a href="#l85.7"></a><span id="l85.7"> var sleep = 500;</span>
<a href="#l85.8"></a><span id="l85.8"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l85.9"></a><span id="l85.9"> var hour = 8;</span>
<a href="#l85.10"></a><span id="l85.10"> </span>
<a href="#l85.11"></a><span id="l85.11"> var setupModule = function(module) {</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l85.14"></a><span id="l85.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l85.15"></a><span id="l85.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l85.16"></a><span id="l85.16"> };</span>
<a href="#l85.17"></a><span id="l85.17"> </span>
<a href="#l85.18"></a><span id="l85.18"> var testDailyRecurrence = function() {</span>
<a href="#l85.19"></a><span id="l85.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l85.20"></a><span id="l85.20" class="difflineminus">-</span>
<a href="#l85.21"></a><span id="l85.21" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l85.22"></a><span id="l85.22" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l85.23"></a><span id="l85.23" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.24"></a><span id="l85.24" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l85.25"></a><span id="l85.25"> </span>
<a href="#l85.26"></a><span id="l85.26" class="difflineminus">-  // create daily event</span>
<a href="#l85.27"></a><span id="l85.27" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l85.28"></a><span id="l85.28" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l85.29"></a><span id="l85.29" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l85.30"></a><span id="l85.30" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l85.31"></a><span id="l85.31" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l85.32"></a><span id="l85.32" class="difflineminus">-</span>
<a href="#l85.33"></a><span id="l85.33" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l85.34"></a><span id="l85.34" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l85.35"></a><span id="l85.35" class="difflineminus">-    &quot;daily&quot;);</span>
<a href="#l85.36"></a><span id="l85.36" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l85.37"></a><span id="l85.37" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l85.38"></a><span id="l85.38" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l85.39"></a><span id="l85.39" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.40"></a><span id="l85.40"> </span>
<a href="#l85.41"></a><span id="l85.41" class="difflineminus">-  // check day view for 7 days</span>
<a href="#l85.42"></a><span id="l85.42" class="difflineminus">-  let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined) +</span>
<a href="#l85.43"></a><span id="l85.43" class="difflineminus">-    eventPath;</span>
<a href="#l85.44"></a><span id="l85.44" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l85.45"></a><span id="l85.45" class="difflineminus">-</span>
<a href="#l85.46"></a><span id="l85.46" class="difflineminus">-  for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l85.47"></a><span id="l85.47" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l85.48"></a><span id="l85.48" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l85.49"></a><span id="l85.49" class="difflineminus">-  }</span>
<a href="#l85.50"></a><span id="l85.50" class="difflineplus">+    // create daily event</span>
<a href="#l85.51"></a><span id="l85.51" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l85.52"></a><span id="l85.52" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l85.53"></a><span id="l85.53" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l85.54"></a><span id="l85.54" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l85.55"></a><span id="l85.55" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l85.56"></a><span id="l85.56"> </span>
<a href="#l85.57"></a><span id="l85.57" class="difflineminus">-  // check week view for 2 weeks</span>
<a href="#l85.58"></a><span id="l85.58" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l85.59"></a><span id="l85.59" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.60"></a><span id="l85.60" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l85.61"></a><span id="l85.61" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l85.62"></a><span id="l85.62" class="difflineplus">+      &quot;daily&quot;);</span>
<a href="#l85.63"></a><span id="l85.63" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l85.64"></a><span id="l85.64"> </span>
<a href="#l85.65"></a><span id="l85.65" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l85.66"></a><span id="l85.66" class="difflineminus">-    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l85.67"></a><span id="l85.67" class="difflineminus">-      eventPath;</span>
<a href="#l85.68"></a><span id="l85.68" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l85.69"></a><span id="l85.69" class="difflineminus">-  }</span>
<a href="#l85.70"></a><span id="l85.70" class="difflineminus">-</span>
<a href="#l85.71"></a><span id="l85.71" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l85.72"></a><span id="l85.72" class="difflineminus">-</span>
<a href="#l85.73"></a><span id="l85.73" class="difflineminus">-  for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l85.74"></a><span id="l85.74" class="difflineminus">-    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour) +</span>
<a href="#l85.75"></a><span id="l85.75" class="difflineplus">+    // check day view for 7 days</span>
<a href="#l85.76"></a><span id="l85.76" class="difflineplus">+    let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined) +</span>
<a href="#l85.77"></a><span id="l85.77">       eventPath;</span>
<a href="#l85.78"></a><span id="l85.78" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l85.79"></a><span id="l85.79" class="difflineminus">-  }</span>
<a href="#l85.80"></a><span id="l85.80" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l85.81"></a><span id="l85.81"> </span>
<a href="#l85.82"></a><span id="l85.82" class="difflineminus">-  // check multiweek view for 4 weeks</span>
<a href="#l85.83"></a><span id="l85.83" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l85.84"></a><span id="l85.84" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.85"></a><span id="l85.85" class="difflineplus">+    for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l85.86"></a><span id="l85.86" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l85.87"></a><span id="l85.87" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l85.88"></a><span id="l85.88" class="difflineplus">+    }</span>
<a href="#l85.89"></a><span id="l85.89" class="difflineplus">+</span>
<a href="#l85.90"></a><span id="l85.90" class="difflineplus">+    // check week view for 2 weeks</span>
<a href="#l85.91"></a><span id="l85.91" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l85.92"></a><span id="l85.92" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.93"></a><span id="l85.93"> </span>
<a href="#l85.94"></a><span id="l85.94" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l85.95"></a><span id="l85.95" class="difflineminus">-    let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l85.96"></a><span id="l85.96" class="difflineminus">-      eventPath;</span>
<a href="#l85.97"></a><span id="l85.97" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l85.98"></a><span id="l85.98" class="difflineminus">-  }</span>
<a href="#l85.99"></a><span id="l85.99" class="difflineplus">+    for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l85.100"></a><span id="l85.100" class="difflineplus">+        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l85.101"></a><span id="l85.101" class="difflineplus">+          eventPath;</span>
<a href="#l85.102"></a><span id="l85.102" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l85.103"></a><span id="l85.103" class="difflineplus">+    }</span>
<a href="#l85.104"></a><span id="l85.104" class="difflineplus">+</span>
<a href="#l85.105"></a><span id="l85.105" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l85.106"></a><span id="l85.106"> </span>
<a href="#l85.107"></a><span id="l85.107" class="difflineminus">-  for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l85.108"></a><span id="l85.108">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l85.109"></a><span id="l85.109" class="difflineminus">-      let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour) +</span>
<a href="#l85.110"></a><span id="l85.110" class="difflineminus">-        eventPath;</span>
<a href="#l85.111"></a><span id="l85.111" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l85.112"></a><span id="l85.112" class="difflineplus">+        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour) +</span>
<a href="#l85.113"></a><span id="l85.113" class="difflineplus">+          eventPath;</span>
<a href="#l85.114"></a><span id="l85.114" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l85.115"></a><span id="l85.115">     }</span>
<a href="#l85.116"></a><span id="l85.116" class="difflineminus">-  }</span>
<a href="#l85.117"></a><span id="l85.117" class="difflineplus">+</span>
<a href="#l85.118"></a><span id="l85.118" class="difflineplus">+    // check multiweek view for 4 weeks</span>
<a href="#l85.119"></a><span id="l85.119" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l85.120"></a><span id="l85.120" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.121"></a><span id="l85.121"> </span>
<a href="#l85.122"></a><span id="l85.122" class="difflineminus">-  // check month view for all 5 weeks</span>
<a href="#l85.123"></a><span id="l85.123" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l85.124"></a><span id="l85.124" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.125"></a><span id="l85.125" class="difflineplus">+    for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l85.126"></a><span id="l85.126" class="difflineplus">+        let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l85.127"></a><span id="l85.127" class="difflineplus">+          eventPath;</span>
<a href="#l85.128"></a><span id="l85.128" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l85.129"></a><span id="l85.129" class="difflineplus">+    }</span>
<a href="#l85.130"></a><span id="l85.130"> </span>
<a href="#l85.131"></a><span id="l85.131" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l85.132"></a><span id="l85.132" class="difflineminus">-    let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined) +</span>
<a href="#l85.133"></a><span id="l85.133" class="difflineminus">-      eventPath;</span>
<a href="#l85.134"></a><span id="l85.134" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l85.135"></a><span id="l85.135" class="difflineminus">-  }</span>
<a href="#l85.136"></a><span id="l85.136" class="difflineplus">+    for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l85.137"></a><span id="l85.137" class="difflineplus">+        for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l85.138"></a><span id="l85.138" class="difflineplus">+            let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour) +</span>
<a href="#l85.139"></a><span id="l85.139" class="difflineplus">+              eventPath;</span>
<a href="#l85.140"></a><span id="l85.140" class="difflineplus">+            controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l85.141"></a><span id="l85.141" class="difflineplus">+        }</span>
<a href="#l85.142"></a><span id="l85.142" class="difflineplus">+    }</span>
<a href="#l85.143"></a><span id="l85.143" class="difflineplus">+</span>
<a href="#l85.144"></a><span id="l85.144" class="difflineplus">+    // check month view for all 5 weeks</span>
<a href="#l85.145"></a><span id="l85.145" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l85.146"></a><span id="l85.146" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.147"></a><span id="l85.147"> </span>
<a href="#l85.148"></a><span id="l85.148" class="difflineminus">-  for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l85.149"></a><span id="l85.149" class="difflineminus">-    for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l85.150"></a><span id="l85.150" class="difflineminus">-      let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined) +</span>
<a href="#l85.151"></a><span id="l85.151" class="difflineminus">-        eventPath;</span>
<a href="#l85.152"></a><span id="l85.152" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l85.153"></a><span id="l85.153" class="difflineplus">+    for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l85.154"></a><span id="l85.154" class="difflineplus">+        let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined) +</span>
<a href="#l85.155"></a><span id="l85.155" class="difflineplus">+          eventPath;</span>
<a href="#l85.156"></a><span id="l85.156" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l85.157"></a><span id="l85.157">     }</span>
<a href="#l85.158"></a><span id="l85.158" class="difflineminus">-  }</span>
<a href="#l85.159"></a><span id="l85.159"> </span>
<a href="#l85.160"></a><span id="l85.160" class="difflineminus">-  // delete 3rd January occurrence</span>
<a href="#l85.161"></a><span id="l85.161" class="difflineminus">-  let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l85.162"></a><span id="l85.162" class="difflineminus">-    eventPath;</span>
<a href="#l85.163"></a><span id="l85.163" class="difflineminus">-  calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l85.164"></a><span id="l85.164" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.165"></a><span id="l85.165" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l85.166"></a><span id="l85.166" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l85.167"></a><span id="l85.167" class="difflineplus">+    for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l85.168"></a><span id="l85.168" class="difflineplus">+        for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l85.169"></a><span id="l85.169" class="difflineplus">+            let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined) +</span>
<a href="#l85.170"></a><span id="l85.170" class="difflineplus">+              eventPath;</span>
<a href="#l85.171"></a><span id="l85.171" class="difflineplus">+            controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l85.172"></a><span id="l85.172" class="difflineplus">+        }</span>
<a href="#l85.173"></a><span id="l85.173" class="difflineplus">+    }</span>
<a href="#l85.174"></a><span id="l85.174" class="difflineplus">+</span>
<a href="#l85.175"></a><span id="l85.175" class="difflineplus">+    // delete 3rd January occurrence</span>
<a href="#l85.176"></a><span id="l85.176" class="difflineplus">+    let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l85.177"></a><span id="l85.177" class="difflineplus">+      eventPath;</span>
<a href="#l85.178"></a><span id="l85.178" class="difflineplus">+    calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l85.179"></a><span id="l85.179" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.180"></a><span id="l85.180" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l85.181"></a><span id="l85.181" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l85.182"></a><span id="l85.182"> </span>
<a href="#l85.183"></a><span id="l85.183" class="difflineminus">-  // verify in all views</span>
<a href="#l85.184"></a><span id="l85.184" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.185"></a><span id="l85.185" class="difflineplus">+    // verify in all views</span>
<a href="#l85.186"></a><span id="l85.186" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.187"></a><span id="l85.187"> </span>
<a href="#l85.188"></a><span id="l85.188" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l85.189"></a><span id="l85.189" class="difflineminus">-  saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l85.190"></a><span id="l85.190" class="difflineminus">-    eventPath;</span>
<a href="#l85.191"></a><span id="l85.191" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.192"></a><span id="l85.192" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l85.193"></a><span id="l85.193" class="difflineplus">+    saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l85.194"></a><span id="l85.194" class="difflineplus">+      eventPath;</span>
<a href="#l85.195"></a><span id="l85.195" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.196"></a><span id="l85.196"> </span>
<a href="#l85.197"></a><span id="l85.197" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l85.198"></a><span id="l85.198" class="difflineminus">-  saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l85.199"></a><span id="l85.199" class="difflineminus">-    eventPath;</span>
<a href="#l85.200"></a><span id="l85.200" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.201"></a><span id="l85.201" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l85.202"></a><span id="l85.202" class="difflineplus">+    saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l85.203"></a><span id="l85.203" class="difflineplus">+      eventPath;</span>
<a href="#l85.204"></a><span id="l85.204" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.205"></a><span id="l85.205"> </span>
<a href="#l85.206"></a><span id="l85.206" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l85.207"></a><span id="l85.207" class="difflineminus">-  saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l85.208"></a><span id="l85.208" class="difflineminus">-    eventPath;</span>
<a href="#l85.209"></a><span id="l85.209" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.210"></a><span id="l85.210" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l85.211"></a><span id="l85.211" class="difflineplus">+    saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l85.212"></a><span id="l85.212" class="difflineplus">+      eventPath;</span>
<a href="#l85.213"></a><span id="l85.213" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l85.214"></a><span id="l85.214"> </span>
<a href="#l85.215"></a><span id="l85.215" class="difflineminus">-  // go to previous day to edit event to occur only on weekdays</span>
<a href="#l85.216"></a><span id="l85.216" class="difflineminus">-  calUtils.back(controller, 1);</span>
<a href="#l85.217"></a><span id="l85.217" class="difflineplus">+    // go to previous day to edit event to occur only on weekdays</span>
<a href="#l85.218"></a><span id="l85.218" class="difflineplus">+    calUtils.back(controller, 1);</span>
<a href="#l85.219"></a><span id="l85.219"> </span>
<a href="#l85.220"></a><span id="l85.220" class="difflineminus">-  calUtils.handleParentModification(controller, false);</span>
<a href="#l85.221"></a><span id="l85.221" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l85.222"></a><span id="l85.222" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l85.223"></a><span id="l85.223" class="difflineminus">-      eventPath));</span>
<a href="#l85.224"></a><span id="l85.224" class="difflineplus">+    calUtils.handleParentModification(controller, false);</span>
<a href="#l85.225"></a><span id="l85.225" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l85.226"></a><span id="l85.226" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l85.227"></a><span id="l85.227" class="difflineplus">+        eventPath));</span>
<a href="#l85.228"></a><span id="l85.228"> </span>
<a href="#l85.229"></a><span id="l85.229" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l85.230"></a><span id="l85.230" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l85.231"></a><span id="l85.231" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l85.232"></a><span id="l85.232" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l85.233"></a><span id="l85.233" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l85.234"></a><span id="l85.234" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l85.235"></a><span id="l85.235"> </span>
<a href="#l85.236"></a><span id="l85.236" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l85.237"></a><span id="l85.237" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l85.238"></a><span id="l85.238" class="difflineminus">-    &quot;every.weekday&quot;);</span>
<a href="#l85.239"></a><span id="l85.239" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l85.240"></a><span id="l85.240" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l85.241"></a><span id="l85.241" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l85.242"></a><span id="l85.242" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l85.243"></a><span id="l85.243" class="difflineplus">+      &quot;every.weekday&quot;);</span>
<a href="#l85.244"></a><span id="l85.244" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l85.245"></a><span id="l85.245" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l85.246"></a><span id="l85.246"> </span>
<a href="#l85.247"></a><span id="l85.247" class="difflineminus">-  // check day view for 7 days</span>
<a href="#l85.248"></a><span id="l85.248" class="difflineminus">-  let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l85.249"></a><span id="l85.249" class="difflineminus">-    eventPath;</span>
<a href="#l85.250"></a><span id="l85.250" class="difflineminus">-  let dates = [[2009, 1, 3],</span>
<a href="#l85.251"></a><span id="l85.251" class="difflineminus">-               [2009, 1, 4]];</span>
<a href="#l85.252"></a><span id="l85.252" class="difflineminus">-  for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l85.253"></a><span id="l85.253" class="difflineminus">-    calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l85.254"></a><span id="l85.254" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l85.255"></a><span id="l85.255" class="difflineminus">-  }</span>
<a href="#l85.256"></a><span id="l85.256" class="difflineplus">+    // check day view for 7 days</span>
<a href="#l85.257"></a><span id="l85.257" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l85.258"></a><span id="l85.258" class="difflineplus">+      eventPath;</span>
<a href="#l85.259"></a><span id="l85.259" class="difflineplus">+    let dates = [[2009, 1, 3],</span>
<a href="#l85.260"></a><span id="l85.260" class="difflineplus">+                 [2009, 1, 4]];</span>
<a href="#l85.261"></a><span id="l85.261" class="difflineplus">+    for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l85.262"></a><span id="l85.262" class="difflineplus">+        calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l85.263"></a><span id="l85.263" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l85.264"></a><span id="l85.264" class="difflineplus">+    }</span>
<a href="#l85.265"></a><span id="l85.265"> </span>
<a href="#l85.266"></a><span id="l85.266" class="difflineminus">-  // check week view for 2 weeks</span>
<a href="#l85.267"></a><span id="l85.267" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l85.268"></a><span id="l85.268" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.269"></a><span id="l85.269" class="difflineplus">+    // check week view for 2 weeks</span>
<a href="#l85.270"></a><span id="l85.270" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l85.271"></a><span id="l85.271" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.272"></a><span id="l85.272" class="difflineplus">+</span>
<a href="#l85.273"></a><span id="l85.273" class="difflineplus">+    for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l85.274"></a><span id="l85.274" class="difflineplus">+        let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l85.275"></a><span id="l85.275" class="difflineplus">+          eventPath;</span>
<a href="#l85.276"></a><span id="l85.276" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l85.277"></a><span id="l85.277" class="difflineplus">+        weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l85.278"></a><span id="l85.278" class="difflineplus">+          eventPath;</span>
<a href="#l85.279"></a><span id="l85.279" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l85.280"></a><span id="l85.280" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l85.281"></a><span id="l85.281" class="difflineplus">+    }</span>
<a href="#l85.282"></a><span id="l85.282" class="difflineplus">+</span>
<a href="#l85.283"></a><span id="l85.283" class="difflineplus">+    // check multiweek view for 4 weeks</span>
<a href="#l85.284"></a><span id="l85.284" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l85.285"></a><span id="l85.285" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.286"></a><span id="l85.286"> </span>
<a href="#l85.287"></a><span id="l85.287" class="difflineminus">-  for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l85.288"></a><span id="l85.288" class="difflineminus">-    let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l85.289"></a><span id="l85.289" class="difflineminus">-      eventPath;</span>
<a href="#l85.290"></a><span id="l85.290" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l85.291"></a><span id="l85.291" class="difflineminus">-    weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l85.292"></a><span id="l85.292" class="difflineminus">-      eventPath;</span>
<a href="#l85.293"></a><span id="l85.293" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l85.294"></a><span id="l85.294" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l85.295"></a><span id="l85.295" class="difflineminus">-  }</span>
<a href="#l85.296"></a><span id="l85.296" class="difflineplus">+    for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l85.297"></a><span id="l85.297" class="difflineplus">+        let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l85.298"></a><span id="l85.298" class="difflineplus">+          eventPath;</span>
<a href="#l85.299"></a><span id="l85.299" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l85.300"></a><span id="l85.300" class="difflineplus">+        mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l85.301"></a><span id="l85.301" class="difflineplus">+          eventPath;</span>
<a href="#l85.302"></a><span id="l85.302" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l85.303"></a><span id="l85.303" class="difflineplus">+    }</span>
<a href="#l85.304"></a><span id="l85.304"> </span>
<a href="#l85.305"></a><span id="l85.305" class="difflineminus">-  // check multiweek view for 4 weeks</span>
<a href="#l85.306"></a><span id="l85.306" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l85.307"></a><span id="l85.307" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.308"></a><span id="l85.308" class="difflineplus">+    // check month view for all 5 weeks</span>
<a href="#l85.309"></a><span id="l85.309" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l85.310"></a><span id="l85.310" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.311"></a><span id="l85.311"> </span>
<a href="#l85.312"></a><span id="l85.312" class="difflineminus">-  for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l85.313"></a><span id="l85.313" class="difflineminus">-    let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l85.314"></a><span id="l85.314" class="difflineminus">-      eventPath;</span>
<a href="#l85.315"></a><span id="l85.315" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l85.316"></a><span id="l85.316" class="difflineminus">-    mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l85.317"></a><span id="l85.317" class="difflineplus">+    for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l85.318"></a><span id="l85.318" class="difflineplus">+        let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l85.319"></a><span id="l85.319" class="difflineplus">+          eventPath;</span>
<a href="#l85.320"></a><span id="l85.320" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l85.321"></a><span id="l85.321" class="difflineplus">+        mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l85.322"></a><span id="l85.322" class="difflineplus">+          eventPath;</span>
<a href="#l85.323"></a><span id="l85.323" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l85.324"></a><span id="l85.324" class="difflineplus">+    }</span>
<a href="#l85.325"></a><span id="l85.325" class="difflineplus">+</span>
<a href="#l85.326"></a><span id="l85.326" class="difflineplus">+    // delete event</span>
<a href="#l85.327"></a><span id="l85.327" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined) +</span>
<a href="#l85.328"></a><span id="l85.328">       eventPath;</span>
<a href="#l85.329"></a><span id="l85.329" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l85.330"></a><span id="l85.330" class="difflineminus">-  }</span>
<a href="#l85.331"></a><span id="l85.331" class="difflineminus">-</span>
<a href="#l85.332"></a><span id="l85.332" class="difflineminus">-  // check month view for all 5 weeks</span>
<a href="#l85.333"></a><span id="l85.333" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l85.334"></a><span id="l85.334" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l85.335"></a><span id="l85.335" class="difflineminus">-</span>
<a href="#l85.336"></a><span id="l85.336" class="difflineminus">-  for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l85.337"></a><span id="l85.337" class="difflineminus">-    let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l85.338"></a><span id="l85.338" class="difflineminus">-      eventPath;</span>
<a href="#l85.339"></a><span id="l85.339" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l85.340"></a><span id="l85.340" class="difflineminus">-    mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l85.341"></a><span id="l85.341" class="difflineminus">-      eventPath;</span>
<a href="#l85.342"></a><span id="l85.342" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l85.343"></a><span id="l85.343" class="difflineminus">-  }</span>
<a href="#l85.344"></a><span id="l85.344" class="difflineminus">-</span>
<a href="#l85.345"></a><span id="l85.345" class="difflineminus">-  // delete event</span>
<a href="#l85.346"></a><span id="l85.346" class="difflineminus">-  day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined) +</span>
<a href="#l85.347"></a><span id="l85.347" class="difflineminus">-    eventPath;</span>
<a href="#l85.348"></a><span id="l85.348" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l85.349"></a><span id="l85.349" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l85.350"></a><span id="l85.350" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l85.351"></a><span id="l85.351" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l85.352"></a><span id="l85.352" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l85.353"></a><span id="l85.353" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l85.354"></a><span id="l85.354" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l85.355"></a><span id="l85.355" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l85.356"></a><span id="l85.356" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l85.357"></a><span id="l85.357" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l85.358"></a><span id="l85.358"> };</span>
<a href="#l85.359"></a><span id="l85.359"> </span>
<a href="#l85.360"></a><span id="l85.360"> var teardownTest = function(module) {</span>
<a href="#l85.361"></a><span id="l85.361" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l85.362"></a><span id="l85.362" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l85.363"></a><span id="l85.363"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testLastDayOfMonthRecurrence.js</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -5,120 +5,120 @@</span>
<a href="#l86.4"></a><span id="l86.4"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l86.5"></a><span id="l86.5"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l86.6"></a><span id="l86.6"> </span>
<a href="#l86.7"></a><span id="l86.7"> var sleep = 500;</span>
<a href="#l86.8"></a><span id="l86.8"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l86.9"></a><span id="l86.9"> var hour = 8;</span>
<a href="#l86.10"></a><span id="l86.10"> </span>
<a href="#l86.11"></a><span id="l86.11"> var setupModule = function(module) {</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l86.13"></a><span id="l86.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l86.14"></a><span id="l86.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l86.15"></a><span id="l86.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l86.16"></a><span id="l86.16"> };</span>
<a href="#l86.17"></a><span id="l86.17"> </span>
<a href="#l86.18"></a><span id="l86.18"> var testLastDayOfMonthRecurrence = function() {</span>
<a href="#l86.19"></a><span id="l86.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l86.20"></a><span id="l86.20" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l86.21"></a><span id="l86.21" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l86.22"></a><span id="l86.22" class="difflineminus">-  calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l86.23"></a><span id="l86.23" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l86.24"></a><span id="l86.24" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l86.25"></a><span id="l86.25" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l86.26"></a><span id="l86.26" class="difflineplus">+    calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l86.27"></a><span id="l86.27"> </span>
<a href="#l86.28"></a><span id="l86.28" class="difflineminus">-  // create monthly recurring event</span>
<a href="#l86.29"></a><span id="l86.29" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l86.30"></a><span id="l86.30" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l86.31"></a><span id="l86.31" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l86.32"></a><span id="l86.32" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l86.33"></a><span id="l86.33" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l86.34"></a><span id="l86.34" class="difflineplus">+    // create monthly recurring event</span>
<a href="#l86.35"></a><span id="l86.35" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l86.36"></a><span id="l86.36" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l86.37"></a><span id="l86.37" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l86.38"></a><span id="l86.38" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l86.39"></a><span id="l86.39" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l86.40"></a><span id="l86.40"> </span>
<a href="#l86.41"></a><span id="l86.41" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l86.42"></a><span id="l86.42" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l86.43"></a><span id="l86.43" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l86.44"></a><span id="l86.44" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l86.45"></a><span id="l86.45" class="difflineminus">-    &quot;custom&quot;);</span>
<a href="#l86.46"></a><span id="l86.46" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l86.47"></a><span id="l86.47" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l86.48"></a><span id="l86.48" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l86.49"></a><span id="l86.49" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l86.50"></a><span id="l86.50" class="difflineplus">+      &quot;custom&quot;);</span>
<a href="#l86.51"></a><span id="l86.51"> </span>
<a href="#l86.52"></a><span id="l86.52" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l86.53"></a><span id="l86.53" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l86.54"></a><span id="l86.54" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l86.55"></a><span id="l86.55" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l86.56"></a><span id="l86.56"> </span>
<a href="#l86.57"></a><span id="l86.57" class="difflineminus">-  //                        date     correct row in month view</span>
<a href="#l86.58"></a><span id="l86.58" class="difflineminus">-  let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l86.59"></a><span id="l86.59" class="difflineminus">-                      [2008, 2, 29, 5],</span>
<a href="#l86.60"></a><span id="l86.60" class="difflineminus">-                      [2008, 3, 31, 6],</span>
<a href="#l86.61"></a><span id="l86.61" class="difflineminus">-                      [2008, 4, 30, 5],</span>
<a href="#l86.62"></a><span id="l86.62" class="difflineminus">-                      [2008, 5, 31, 5],</span>
<a href="#l86.63"></a><span id="l86.63" class="difflineminus">-                      [2008, 6, 30, 5],</span>
<a href="#l86.64"></a><span id="l86.64" class="difflineminus">-                      [2008, 7, 31, 5],</span>
<a href="#l86.65"></a><span id="l86.65" class="difflineminus">-                      [2008, 8, 31, 6],</span>
<a href="#l86.66"></a><span id="l86.66" class="difflineminus">-                      [2008, 9, 30, 5],</span>
<a href="#l86.67"></a><span id="l86.67" class="difflineminus">-                      [2008, 10, 31, 5],</span>
<a href="#l86.68"></a><span id="l86.68" class="difflineminus">-                      [2008, 11, 30, 6],</span>
<a href="#l86.69"></a><span id="l86.69" class="difflineminus">-                      [2008, 12, 31, 5],</span>
<a href="#l86.70"></a><span id="l86.70" class="difflineminus">-                      [2009, 1, 31, 5],</span>
<a href="#l86.71"></a><span id="l86.71" class="difflineminus">-                      [2009, 2, 28, 4],</span>
<a href="#l86.72"></a><span id="l86.72" class="difflineminus">-                      [2009, 3, 31, 5]];</span>
<a href="#l86.73"></a><span id="l86.73" class="difflineminus">-  let box = &quot;&quot;;</span>
<a href="#l86.74"></a><span id="l86.74" class="difflineplus">+    //                        date     correct row in month view</span>
<a href="#l86.75"></a><span id="l86.75" class="difflineplus">+    let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l86.76"></a><span id="l86.76" class="difflineplus">+                        [2008, 2, 29, 5],</span>
<a href="#l86.77"></a><span id="l86.77" class="difflineplus">+                        [2008, 3, 31, 6],</span>
<a href="#l86.78"></a><span id="l86.78" class="difflineplus">+                        [2008, 4, 30, 5],</span>
<a href="#l86.79"></a><span id="l86.79" class="difflineplus">+                        [2008, 5, 31, 5],</span>
<a href="#l86.80"></a><span id="l86.80" class="difflineplus">+                        [2008, 6, 30, 5],</span>
<a href="#l86.81"></a><span id="l86.81" class="difflineplus">+                        [2008, 7, 31, 5],</span>
<a href="#l86.82"></a><span id="l86.82" class="difflineplus">+                        [2008, 8, 31, 6],</span>
<a href="#l86.83"></a><span id="l86.83" class="difflineplus">+                        [2008, 9, 30, 5],</span>
<a href="#l86.84"></a><span id="l86.84" class="difflineplus">+                        [2008, 10, 31, 5],</span>
<a href="#l86.85"></a><span id="l86.85" class="difflineplus">+                        [2008, 11, 30, 6],</span>
<a href="#l86.86"></a><span id="l86.86" class="difflineplus">+                        [2008, 12, 31, 5],</span>
<a href="#l86.87"></a><span id="l86.87" class="difflineplus">+                        [2009, 1, 31, 5],</span>
<a href="#l86.88"></a><span id="l86.88" class="difflineplus">+                        [2009, 2, 28, 4],</span>
<a href="#l86.89"></a><span id="l86.89" class="difflineplus">+                        [2009, 3, 31, 5]];</span>
<a href="#l86.90"></a><span id="l86.90" class="difflineplus">+    let box = &quot;&quot;;</span>
<a href="#l86.91"></a><span id="l86.91"> </span>
<a href="#l86.92"></a><span id="l86.92" class="difflineminus">-  // check all dates</span>
<a href="#l86.93"></a><span id="l86.93" class="difflineminus">-  for (let i = 0; i &lt; checkingData.length; i++) {</span>
<a href="#l86.94"></a><span id="l86.94" class="difflineminus">-    calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l86.95"></a><span id="l86.95" class="difflineplus">+    // check all dates</span>
<a href="#l86.96"></a><span id="l86.96" class="difflineplus">+    for (let i = 0; i &lt; checkingData.length; i++) {</span>
<a href="#l86.97"></a><span id="l86.97" class="difflineplus">+        calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l86.98"></a><span id="l86.98"> </span>
<a href="#l86.99"></a><span id="l86.99" class="difflineminus">-    // day view</span>
<a href="#l86.100"></a><span id="l86.100" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l86.101"></a><span id="l86.101" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l86.102"></a><span id="l86.102" class="difflineminus">-      eventPath;</span>
<a href="#l86.103"></a><span id="l86.103" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.104"></a><span id="l86.104" class="difflineplus">+        // day view</span>
<a href="#l86.105"></a><span id="l86.105" class="difflineplus">+        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l86.106"></a><span id="l86.106" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l86.107"></a><span id="l86.107" class="difflineplus">+          eventPath;</span>
<a href="#l86.108"></a><span id="l86.108" class="difflineplus">+        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.109"></a><span id="l86.109"> </span>
<a href="#l86.110"></a><span id="l86.110" class="difflineminus">-    // week view</span>
<a href="#l86.111"></a><span id="l86.111" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l86.112"></a><span id="l86.112" class="difflineminus">-    let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l86.113"></a><span id="l86.113" class="difflineminus">-    let column = date.getDay() + 1;</span>
<a href="#l86.114"></a><span id="l86.114" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour) +</span>
<a href="#l86.115"></a><span id="l86.115" class="difflineminus">-      eventPath;</span>
<a href="#l86.116"></a><span id="l86.116" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.117"></a><span id="l86.117" class="difflineplus">+        // week view</span>
<a href="#l86.118"></a><span id="l86.118" class="difflineplus">+        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l86.119"></a><span id="l86.119" class="difflineplus">+        let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l86.120"></a><span id="l86.120" class="difflineplus">+        let column = date.getDay() + 1;</span>
<a href="#l86.121"></a><span id="l86.121" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour) +</span>
<a href="#l86.122"></a><span id="l86.122" class="difflineplus">+          eventPath;</span>
<a href="#l86.123"></a><span id="l86.123" class="difflineplus">+        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.124"></a><span id="l86.124"> </span>
<a href="#l86.125"></a><span id="l86.125" class="difflineminus">-    // multiweek view</span>
<a href="#l86.126"></a><span id="l86.126" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l86.127"></a><span id="l86.127" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined) +</span>
<a href="#l86.128"></a><span id="l86.128" class="difflineminus">-      eventPath;</span>
<a href="#l86.129"></a><span id="l86.129" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.130"></a><span id="l86.130" class="difflineplus">+        // multiweek view</span>
<a href="#l86.131"></a><span id="l86.131" class="difflineplus">+        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l86.132"></a><span id="l86.132" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined) +</span>
<a href="#l86.133"></a><span id="l86.133" class="difflineplus">+          eventPath;</span>
<a href="#l86.134"></a><span id="l86.134" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.135"></a><span id="l86.135"> </span>
<a href="#l86.136"></a><span id="l86.136" class="difflineminus">-    // month view</span>
<a href="#l86.137"></a><span id="l86.137" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l86.138"></a><span id="l86.138" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l86.139"></a><span id="l86.139" class="difflineminus">-      column, undefined) + eventPath;</span>
<a href="#l86.140"></a><span id="l86.140" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.141"></a><span id="l86.141" class="difflineminus">-  }</span>
<a href="#l86.142"></a><span id="l86.142" class="difflineplus">+        // month view</span>
<a href="#l86.143"></a><span id="l86.143" class="difflineplus">+        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l86.144"></a><span id="l86.144" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l86.145"></a><span id="l86.145" class="difflineplus">+          column, undefined) + eventPath;</span>
<a href="#l86.146"></a><span id="l86.146" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.147"></a><span id="l86.147" class="difflineplus">+    }</span>
<a href="#l86.148"></a><span id="l86.148"> </span>
<a href="#l86.149"></a><span id="l86.149" class="difflineminus">-  // delete event</span>
<a href="#l86.150"></a><span id="l86.150" class="difflineminus">-  calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l86.151"></a><span id="l86.151" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l86.152"></a><span id="l86.152" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l86.153"></a><span id="l86.153" class="difflineminus">-    undefined, 1, hour) + eventPath;</span>
<a href="#l86.154"></a><span id="l86.154" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l86.155"></a><span id="l86.155" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.156"></a><span id="l86.156" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l86.157"></a><span id="l86.157" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l86.158"></a><span id="l86.158" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.159"></a><span id="l86.159" class="difflineplus">+    // delete event</span>
<a href="#l86.160"></a><span id="l86.160" class="difflineplus">+    calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l86.161"></a><span id="l86.161" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l86.162"></a><span id="l86.162" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l86.163"></a><span id="l86.163" class="difflineplus">+      undefined, 1, hour) + eventPath;</span>
<a href="#l86.164"></a><span id="l86.164" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l86.165"></a><span id="l86.165" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.166"></a><span id="l86.166" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l86.167"></a><span id="l86.167" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l86.168"></a><span id="l86.168" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l86.169"></a><span id="l86.169"> };</span>
<a href="#l86.170"></a><span id="l86.170"> </span>
<a href="#l86.171"></a><span id="l86.171"> function setRecurrence(recurrence) {</span>
<a href="#l86.172"></a><span id="l86.172" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l86.173"></a><span id="l86.173" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l86.174"></a><span id="l86.174"> </span>
<a href="#l86.175"></a><span id="l86.175" class="difflineminus">-  // monthly</span>
<a href="#l86.176"></a><span id="l86.176" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l86.177"></a><span id="l86.177" class="difflineminus">-    undefined, &quot;2&quot;);</span>
<a href="#l86.178"></a><span id="l86.178" class="difflineplus">+    // monthly</span>
<a href="#l86.179"></a><span id="l86.179" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l86.180"></a><span id="l86.180" class="difflineplus">+      undefined, &quot;2&quot;);</span>
<a href="#l86.181"></a><span id="l86.181"> </span>
<a href="#l86.182"></a><span id="l86.182" class="difflineminus">-  // last day of month</span>
<a href="#l86.183"></a><span id="l86.183" class="difflineminus">-  recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l86.184"></a><span id="l86.184" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l86.185"></a><span id="l86.185" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l86.186"></a><span id="l86.186" class="difflineminus">-    undefined, &quot;-1&quot;);</span>
<a href="#l86.187"></a><span id="l86.187" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l86.188"></a><span id="l86.188" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l86.189"></a><span id="l86.189" class="difflineminus">-    undefined, &quot;-1&quot;);</span>
<a href="#l86.190"></a><span id="l86.190" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l86.191"></a><span id="l86.191" class="difflineplus">+    // last day of month</span>
<a href="#l86.192"></a><span id="l86.192" class="difflineplus">+    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l86.193"></a><span id="l86.193" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l86.194"></a><span id="l86.194" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l86.195"></a><span id="l86.195" class="difflineplus">+      undefined, &quot;-1&quot;);</span>
<a href="#l86.196"></a><span id="l86.196" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l86.197"></a><span id="l86.197" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l86.198"></a><span id="l86.198" class="difflineplus">+      undefined, &quot;-1&quot;);</span>
<a href="#l86.199"></a><span id="l86.199" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l86.200"></a><span id="l86.200"> </span>
<a href="#l86.201"></a><span id="l86.201" class="difflineminus">-  // close dialog</span>
<a href="#l86.202"></a><span id="l86.202" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l86.203"></a><span id="l86.203" class="difflineminus">-    '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l86.204"></a><span id="l86.204" class="difflineplus">+    // close dialog</span>
<a href="#l86.205"></a><span id="l86.205" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l86.206"></a><span id="l86.206" class="difflineplus">+      '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l86.207"></a><span id="l86.207"> }</span>
<a href="#l86.208"></a><span id="l86.208"> </span>
<a href="#l86.209"></a><span id="l86.209"> var teardownTest = function(module) {</span>
<a href="#l86.210"></a><span id="l86.210" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l86.211"></a><span id="l86.211" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l86.212"></a><span id="l86.212"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyNRecurrence.js</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -7,139 +7,139 @@ var modalDialog = require(&quot;../shared-mod</span>
<a href="#l87.4"></a><span id="l87.4"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l87.5"></a><span id="l87.5"> </span>
<a href="#l87.6"></a><span id="l87.6"> var sleep = 500;</span>
<a href="#l87.7"></a><span id="l87.7"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l87.8"></a><span id="l87.8"> var hour = 8;</span>
<a href="#l87.9"></a><span id="l87.9"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l87.10"></a><span id="l87.10"> </span>
<a href="#l87.11"></a><span id="l87.11"> var setupModule = function(module) {</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l87.14"></a><span id="l87.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l87.15"></a><span id="l87.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l87.16"></a><span id="l87.16"> };</span>
<a href="#l87.17"></a><span id="l87.17"> </span>
<a href="#l87.18"></a><span id="l87.18"> var testWeeklyNRecurrence = function() {</span>
<a href="#l87.19"></a><span id="l87.19" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l87.20"></a><span id="l87.20" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l87.21"></a><span id="l87.21" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l87.22"></a><span id="l87.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l87.23"></a><span id="l87.23" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l87.24"></a><span id="l87.24" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l87.25"></a><span id="l87.25"> </span>
<a href="#l87.26"></a><span id="l87.26" class="difflineminus">-  // create weekly recurring event</span>
<a href="#l87.27"></a><span id="l87.27" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l87.28"></a><span id="l87.28" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l87.29"></a><span id="l87.29" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l87.30"></a><span id="l87.30" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l87.31"></a><span id="l87.31" class="difflineplus">+    // create weekly recurring event</span>
<a href="#l87.32"></a><span id="l87.32" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l87.33"></a><span id="l87.33" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l87.34"></a><span id="l87.34" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l87.35"></a><span id="l87.35" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l87.36"></a><span id="l87.36"> </span>
<a href="#l87.37"></a><span id="l87.37" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l87.38"></a><span id="l87.38" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l87.39"></a><span id="l87.39" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l87.40"></a><span id="l87.40" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l87.41"></a><span id="l87.41" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l87.42"></a><span id="l87.42" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l87.43"></a><span id="l87.43" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l87.44"></a><span id="l87.44" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l87.45"></a><span id="l87.45"> </span>
<a href="#l87.46"></a><span id="l87.46" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l87.47"></a><span id="l87.47" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l87.48"></a><span id="l87.48"> </span>
<a href="#l87.49"></a><span id="l87.49" class="difflineminus">-  // check day view</span>
<a href="#l87.50"></a><span id="l87.50" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l87.51"></a><span id="l87.51" class="difflineminus">-    eventPath;</span>
<a href="#l87.52"></a><span id="l87.52" class="difflineplus">+    // check day view</span>
<a href="#l87.53"></a><span id="l87.53" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l87.54"></a><span id="l87.54" class="difflineplus">+      eventPath;</span>
<a href="#l87.55"></a><span id="l87.55"> </span>
<a href="#l87.56"></a><span id="l87.56" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l87.57"></a><span id="l87.57" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l87.58"></a><span id="l87.58" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.59"></a><span id="l87.59" class="difflineplus">+    // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l87.60"></a><span id="l87.60" class="difflineplus">+    for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l87.61"></a><span id="l87.61" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.62"></a><span id="l87.62" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l87.63"></a><span id="l87.63" class="difflineplus">+    }</span>
<a href="#l87.64"></a><span id="l87.64" class="difflineplus">+</span>
<a href="#l87.65"></a><span id="l87.65" class="difflineplus">+    // Saturday</span>
<a href="#l87.66"></a><span id="l87.66">     calUtils.forward(controller, 1);</span>
<a href="#l87.67"></a><span id="l87.67" class="difflineminus">-  }</span>
<a href="#l87.68"></a><span id="l87.68" class="difflineminus">-</span>
<a href="#l87.69"></a><span id="l87.69" class="difflineminus">-  // Saturday</span>
<a href="#l87.70"></a><span id="l87.70" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l87.71"></a><span id="l87.71" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.72"></a><span id="l87.72" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.73"></a><span id="l87.73"> </span>
<a href="#l87.74"></a><span id="l87.74" class="difflineminus">-  // check week view</span>
<a href="#l87.75"></a><span id="l87.75" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l87.76"></a><span id="l87.76" class="difflineplus">+    // check week view</span>
<a href="#l87.77"></a><span id="l87.77" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l87.78"></a><span id="l87.78"> </span>
<a href="#l87.79"></a><span id="l87.79" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l87.80"></a><span id="l87.80" class="difflineminus">-  for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l87.81"></a><span id="l87.81" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour) +</span>
<a href="#l87.82"></a><span id="l87.82" class="difflineplus">+    // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l87.83"></a><span id="l87.83" class="difflineplus">+    for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l87.84"></a><span id="l87.84" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour) +</span>
<a href="#l87.85"></a><span id="l87.85" class="difflineplus">+          eventPath;</span>
<a href="#l87.86"></a><span id="l87.86" class="difflineplus">+        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.87"></a><span id="l87.87" class="difflineplus">+    }</span>
<a href="#l87.88"></a><span id="l87.88" class="difflineplus">+</span>
<a href="#l87.89"></a><span id="l87.89" class="difflineplus">+    // Saturday</span>
<a href="#l87.90"></a><span id="l87.90" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l87.91"></a><span id="l87.91">       eventPath;</span>
<a href="#l87.92"></a><span id="l87.92" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.93"></a><span id="l87.93" class="difflineminus">-  }</span>
<a href="#l87.94"></a><span id="l87.94" class="difflineminus">-</span>
<a href="#l87.95"></a><span id="l87.95" class="difflineminus">-  // Saturday</span>
<a href="#l87.96"></a><span id="l87.96" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l87.97"></a><span id="l87.97" class="difflineminus">-    eventPath;</span>
<a href="#l87.98"></a><span id="l87.98" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.99"></a><span id="l87.99" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.100"></a><span id="l87.100"> </span>
<a href="#l87.101"></a><span id="l87.101" class="difflineminus">-  // check multiweek view</span>
<a href="#l87.102"></a><span id="l87.102" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l87.103"></a><span id="l87.103" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l87.104"></a><span id="l87.104" class="difflineplus">+    // check multiweek view</span>
<a href="#l87.105"></a><span id="l87.105" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l87.106"></a><span id="l87.106" class="difflineplus">+    checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l87.107"></a><span id="l87.107"> </span>
<a href="#l87.108"></a><span id="l87.108" class="difflineminus">-  // check month view</span>
<a href="#l87.109"></a><span id="l87.109" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l87.110"></a><span id="l87.110" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l87.111"></a><span id="l87.111" class="difflineplus">+    // check month view</span>
<a href="#l87.112"></a><span id="l87.112" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l87.113"></a><span id="l87.113" class="difflineplus">+    checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l87.114"></a><span id="l87.114"> </span>
<a href="#l87.115"></a><span id="l87.115" class="difflineminus">-  // delete event</span>
<a href="#l87.116"></a><span id="l87.116" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour) +</span>
<a href="#l87.117"></a><span id="l87.117" class="difflineminus">-    eventPath;</span>
<a href="#l87.118"></a><span id="l87.118" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.119"></a><span id="l87.119" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l87.120"></a><span id="l87.120" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l87.121"></a><span id="l87.121" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l87.122"></a><span id="l87.122" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.123"></a><span id="l87.123" class="difflineplus">+    // delete event</span>
<a href="#l87.124"></a><span id="l87.124" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour) +</span>
<a href="#l87.125"></a><span id="l87.125" class="difflineplus">+      eventPath;</span>
<a href="#l87.126"></a><span id="l87.126" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.127"></a><span id="l87.127" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l87.128"></a><span id="l87.128" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l87.129"></a><span id="l87.129" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l87.130"></a><span id="l87.130" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.131"></a><span id="l87.131"> };</span>
<a href="#l87.132"></a><span id="l87.132"> </span>
<a href="#l87.133"></a><span id="l87.133"> function setRecurrence(recurrence) {</span>
<a href="#l87.134"></a><span id="l87.134" class="difflineminus">-  // weekly</span>
<a href="#l87.135"></a><span id="l87.135" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l87.136"></a><span id="l87.136" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l87.137"></a><span id="l87.137" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l87.138"></a><span id="l87.138" class="difflineplus">+    // weekly</span>
<a href="#l87.139"></a><span id="l87.139" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l87.140"></a><span id="l87.140" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l87.141"></a><span id="l87.141" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l87.142"></a><span id="l87.142"> </span>
<a href="#l87.143"></a><span id="l87.143" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l87.144"></a><span id="l87.144" class="difflineminus">-  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l87.145"></a><span id="l87.145" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l87.146"></a><span id="l87.146" class="difflineminus">-  let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l87.147"></a><span id="l87.147" class="difflineminus">-  let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l87.148"></a><span id="l87.148" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l87.149"></a><span id="l87.149" class="difflineplus">+    let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l87.150"></a><span id="l87.150" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l87.151"></a><span id="l87.151" class="difflineplus">+    let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l87.152"></a><span id="l87.152" class="difflineplus">+    let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l87.153"></a><span id="l87.153"> </span>
<a href="#l87.154"></a><span id="l87.154" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l87.155"></a><span id="l87.155" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l87.156"></a><span id="l87.156" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l87.157"></a><span id="l87.157" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l87.158"></a><span id="l87.158" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l87.159"></a><span id="l87.159" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l87.160"></a><span id="l87.160"> </span>
<a href="#l87.161"></a><span id="l87.161" class="difflineminus">-  // starting from Monday so it should be checked</span>
<a href="#l87.162"></a><span id="l87.162" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l87.163"></a><span id="l87.163" class="difflineminus">-  // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l87.164"></a><span id="l87.164" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l87.165"></a><span id="l87.165" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l87.166"></a><span id="l87.166" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l87.167"></a><span id="l87.167" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l87.168"></a><span id="l87.168" class="difflineplus">+    // starting from Monday so it should be checked</span>
<a href="#l87.169"></a><span id="l87.169" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l87.170"></a><span id="l87.170" class="difflineplus">+    // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l87.171"></a><span id="l87.171" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l87.172"></a><span id="l87.172" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l87.173"></a><span id="l87.173" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l87.174"></a><span id="l87.174" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l87.175"></a><span id="l87.175"> </span>
<a href="#l87.176"></a><span id="l87.176" class="difflineminus">-  // set number of occurrences</span>
<a href="#l87.177"></a><span id="l87.177" class="difflineminus">-  recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l87.178"></a><span id="l87.178" class="difflineminus">-  let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l87.179"></a><span id="l87.179" class="difflineminus">-    'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/' +</span>
<a href="#l87.180"></a><span id="l87.180" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l87.181"></a><span id="l87.181" class="difflineminus">-  // replace previous number</span>
<a href="#l87.182"></a><span id="l87.182" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l87.183"></a><span id="l87.183" class="difflineminus">-  recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l87.184"></a><span id="l87.184" class="difflineplus">+    // set number of occurrences</span>
<a href="#l87.185"></a><span id="l87.185" class="difflineplus">+    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l87.186"></a><span id="l87.186" class="difflineplus">+    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l87.187"></a><span id="l87.187" class="difflineplus">+      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/' +</span>
<a href="#l87.188"></a><span id="l87.188" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l87.189"></a><span id="l87.189" class="difflineplus">+    // replace previous number</span>
<a href="#l87.190"></a><span id="l87.190" class="difflineplus">+    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l87.191"></a><span id="l87.191" class="difflineplus">+    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l87.192"></a><span id="l87.192"> </span>
<a href="#l87.193"></a><span id="l87.193" class="difflineminus">-  // close dialog</span>
<a href="#l87.194"></a><span id="l87.194" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l87.195"></a><span id="l87.195" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l87.196"></a><span id="l87.196" class="difflineplus">+    // close dialog</span>
<a href="#l87.197"></a><span id="l87.197" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l87.198"></a><span id="l87.198" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l87.199"></a><span id="l87.199"> }</span>
<a href="#l87.200"></a><span id="l87.200"> </span>
<a href="#l87.201"></a><span id="l87.201"> function checkMultiWeekView(view) {</span>
<a href="#l87.202"></a><span id="l87.202" class="difflineminus">-  let week = 1;</span>
<a href="#l87.203"></a><span id="l87.203" class="difflineplus">+    let week = 1;</span>
<a href="#l87.204"></a><span id="l87.204"> </span>
<a href="#l87.205"></a><span id="l87.205" class="difflineminus">-  // in month view event starts from 2nd row</span>
<a href="#l87.206"></a><span id="l87.206" class="difflineminus">-  if (view == &quot;month&quot;) {</span>
<a href="#l87.207"></a><span id="l87.207" class="difflineminus">-    week++;</span>
<a href="#l87.208"></a><span id="l87.208" class="difflineminus">-  }</span>
<a href="#l87.209"></a><span id="l87.209" class="difflineplus">+    // in month view event starts from 2nd row</span>
<a href="#l87.210"></a><span id="l87.210" class="difflineplus">+    if (view == &quot;month&quot;) {</span>
<a href="#l87.211"></a><span id="l87.211" class="difflineplus">+        week++;</span>
<a href="#l87.212"></a><span id="l87.212" class="difflineplus">+    }</span>
<a href="#l87.213"></a><span id="l87.213"> </span>
<a href="#l87.214"></a><span id="l87.214" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l87.215"></a><span id="l87.215" class="difflineminus">-  for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l87.216"></a><span id="l87.216" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined) +</span>
<a href="#l87.217"></a><span id="l87.217" class="difflineplus">+    // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l87.218"></a><span id="l87.218" class="difflineplus">+    for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l87.219"></a><span id="l87.219" class="difflineplus">+        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined) +</span>
<a href="#l87.220"></a><span id="l87.220" class="difflineplus">+          eventPath;</span>
<a href="#l87.221"></a><span id="l87.221" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.222"></a><span id="l87.222" class="difflineplus">+    }</span>
<a href="#l87.223"></a><span id="l87.223" class="difflineplus">+</span>
<a href="#l87.224"></a><span id="l87.224" class="difflineplus">+    // Saturday</span>
<a href="#l87.225"></a><span id="l87.225" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined) +</span>
<a href="#l87.226"></a><span id="l87.226">       eventPath;</span>
<a href="#l87.227"></a><span id="l87.227" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.228"></a><span id="l87.228" class="difflineminus">-  }</span>
<a href="#l87.229"></a><span id="l87.229" class="difflineminus">-</span>
<a href="#l87.230"></a><span id="l87.230" class="difflineminus">-  // Saturday</span>
<a href="#l87.231"></a><span id="l87.231" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined) +</span>
<a href="#l87.232"></a><span id="l87.232" class="difflineminus">-    eventPath;</span>
<a href="#l87.233"></a><span id="l87.233" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.234"></a><span id="l87.234" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l87.235"></a><span id="l87.235"> }</span>
<a href="#l87.236"></a><span id="l87.236"> </span>
<a href="#l87.237"></a><span id="l87.237"> var teardownTest = function(module) {</span>
<a href="#l87.238"></a><span id="l87.238" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l87.239"></a><span id="l87.239" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l87.240"></a><span id="l87.240"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -9,180 +9,180 @@ var utils = require(&quot;../shared-modules/u</span>
<a href="#l88.4"></a><span id="l88.4"> var sleep = 500;</span>
<a href="#l88.5"></a><span id="l88.5"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l88.6"></a><span id="l88.6"> var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l88.7"></a><span id="l88.7"> </span>
<a href="#l88.8"></a><span id="l88.8"> var hour = 8;</span>
<a href="#l88.9"></a><span id="l88.9"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l88.10"></a><span id="l88.10"> </span>
<a href="#l88.11"></a><span id="l88.11"> var setupModule = function(module) {</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l88.13"></a><span id="l88.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l88.14"></a><span id="l88.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l88.15"></a><span id="l88.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l88.16"></a><span id="l88.16"> };</span>
<a href="#l88.17"></a><span id="l88.17"> </span>
<a href="#l88.18"></a><span id="l88.18"> var testWeeklyUntilRecurrence = function() {</span>
<a href="#l88.19"></a><span id="l88.19" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l88.20"></a><span id="l88.20" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l88.21"></a><span id="l88.21" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l88.22"></a><span id="l88.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l88.23"></a><span id="l88.23" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l88.24"></a><span id="l88.24" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l88.25"></a><span id="l88.25"> </span>
<a href="#l88.26"></a><span id="l88.26" class="difflineminus">-  // create weekly recurring event</span>
<a href="#l88.27"></a><span id="l88.27" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l88.28"></a><span id="l88.28" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l88.29"></a><span id="l88.29" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l88.30"></a><span id="l88.30" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l88.31"></a><span id="l88.31" class="difflineplus">+    // create weekly recurring event</span>
<a href="#l88.32"></a><span id="l88.32" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l88.33"></a><span id="l88.33" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l88.34"></a><span id="l88.34" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l88.35"></a><span id="l88.35" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l88.36"></a><span id="l88.36" class="difflineplus">+</span>
<a href="#l88.37"></a><span id="l88.37" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l88.38"></a><span id="l88.38" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l88.39"></a><span id="l88.39" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l88.40"></a><span id="l88.40" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l88.41"></a><span id="l88.41" class="difflineplus">+</span>
<a href="#l88.42"></a><span id="l88.42" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l88.43"></a><span id="l88.43" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l88.44"></a><span id="l88.44"> </span>
<a href="#l88.45"></a><span id="l88.45" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l88.46"></a><span id="l88.46" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l88.47"></a><span id="l88.47" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l88.48"></a><span id="l88.48" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l88.49"></a><span id="l88.49" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l88.50"></a><span id="l88.50" class="difflineplus">+      eventPath;</span>
<a href="#l88.51"></a><span id="l88.51"> </span>
<a href="#l88.52"></a><span id="l88.52" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l88.53"></a><span id="l88.53" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l88.54"></a><span id="l88.54" class="difflineplus">+    // check day view</span>
<a href="#l88.55"></a><span id="l88.55" class="difflineplus">+    for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l88.56"></a><span id="l88.56" class="difflineplus">+        // Monday</span>
<a href="#l88.57"></a><span id="l88.57" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.58"></a><span id="l88.58" class="difflineplus">+        calUtils.forward(controller, 2);</span>
<a href="#l88.59"></a><span id="l88.59" class="difflineplus">+        // Wednesday</span>
<a href="#l88.60"></a><span id="l88.60" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.61"></a><span id="l88.61" class="difflineplus">+        calUtils.forward(controller, 2);</span>
<a href="#l88.62"></a><span id="l88.62" class="difflineplus">+        // Friday</span>
<a href="#l88.63"></a><span id="l88.63" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.64"></a><span id="l88.64" class="difflineplus">+        calUtils.forward(controller, 3);</span>
<a href="#l88.65"></a><span id="l88.65" class="difflineplus">+    }</span>
<a href="#l88.66"></a><span id="l88.66"> </span>
<a href="#l88.67"></a><span id="l88.67" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l88.68"></a><span id="l88.68" class="difflineminus">-    eventPath;</span>
<a href="#l88.69"></a><span id="l88.69" class="difflineminus">-</span>
<a href="#l88.70"></a><span id="l88.70" class="difflineminus">-  // check day view</span>
<a href="#l88.71"></a><span id="l88.71" class="difflineminus">-  for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l88.72"></a><span id="l88.72" class="difflineminus">-    // Monday</span>
<a href="#l88.73"></a><span id="l88.73" class="difflineplus">+    // Monday, last occurrence</span>
<a href="#l88.74"></a><span id="l88.74">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.75"></a><span id="l88.75">     calUtils.forward(controller, 2);</span>
<a href="#l88.76"></a><span id="l88.76">     // Wednesday</span>
<a href="#l88.77"></a><span id="l88.77" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.78"></a><span id="l88.78" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.79"></a><span id="l88.79">     calUtils.forward(controller, 2);</span>
<a href="#l88.80"></a><span id="l88.80" class="difflineminus">-    // Friday</span>
<a href="#l88.81"></a><span id="l88.81" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.82"></a><span id="l88.82" class="difflineminus">-    calUtils.forward(controller, 3);</span>
<a href="#l88.83"></a><span id="l88.83" class="difflineminus">-  }</span>
<a href="#l88.84"></a><span id="l88.84"> </span>
<a href="#l88.85"></a><span id="l88.85" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l88.86"></a><span id="l88.86" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.87"></a><span id="l88.87" class="difflineminus">-  calUtils.forward(controller, 2);</span>
<a href="#l88.88"></a><span id="l88.88" class="difflineminus">-  // Wednesday</span>
<a href="#l88.89"></a><span id="l88.89" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.90"></a><span id="l88.90" class="difflineminus">-  calUtils.forward(controller, 2);</span>
<a href="#l88.91"></a><span id="l88.91" class="difflineplus">+    // check week view</span>
<a href="#l88.92"></a><span id="l88.92" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l88.93"></a><span id="l88.93" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l88.94"></a><span id="l88.94" class="difflineplus">+    for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l88.95"></a><span id="l88.95" class="difflineplus">+        // Monday</span>
<a href="#l88.96"></a><span id="l88.96" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l88.97"></a><span id="l88.97" class="difflineplus">+          eventPath;</span>
<a href="#l88.98"></a><span id="l88.98" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.99"></a><span id="l88.99" class="difflineplus">+        // Wednesday</span>
<a href="#l88.100"></a><span id="l88.100" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l88.101"></a><span id="l88.101" class="difflineplus">+          eventPath;</span>
<a href="#l88.102"></a><span id="l88.102" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.103"></a><span id="l88.103" class="difflineplus">+        // Friday</span>
<a href="#l88.104"></a><span id="l88.104" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour) +</span>
<a href="#l88.105"></a><span id="l88.105" class="difflineplus">+          eventPath;</span>
<a href="#l88.106"></a><span id="l88.106" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.107"></a><span id="l88.107"> </span>
<a href="#l88.108"></a><span id="l88.108" class="difflineminus">-  // check week view</span>
<a href="#l88.109"></a><span id="l88.109" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l88.110"></a><span id="l88.110" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l88.111"></a><span id="l88.111" class="difflineminus">-  for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l88.112"></a><span id="l88.112" class="difflineminus">-    // Monday</span>
<a href="#l88.113"></a><span id="l88.113" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l88.114"></a><span id="l88.114" class="difflineplus">+    }</span>
<a href="#l88.115"></a><span id="l88.115" class="difflineplus">+</span>
<a href="#l88.116"></a><span id="l88.116" class="difflineplus">+    // Monday, last occurrence</span>
<a href="#l88.117"></a><span id="l88.117">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l88.118"></a><span id="l88.118">       eventPath;</span>
<a href="#l88.119"></a><span id="l88.119">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.120"></a><span id="l88.120">     // Wednesday</span>
<a href="#l88.121"></a><span id="l88.121">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l88.122"></a><span id="l88.122">       eventPath;</span>
<a href="#l88.123"></a><span id="l88.123" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.124"></a><span id="l88.124" class="difflineminus">-    // Friday</span>
<a href="#l88.125"></a><span id="l88.125" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour) +</span>
<a href="#l88.126"></a><span id="l88.126" class="difflineminus">-      eventPath;</span>
<a href="#l88.127"></a><span id="l88.127" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.128"></a><span id="l88.128" class="difflineminus">-</span>
<a href="#l88.129"></a><span id="l88.129" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l88.130"></a><span id="l88.130" class="difflineminus">-  }</span>
<a href="#l88.131"></a><span id="l88.131" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.132"></a><span id="l88.132"> </span>
<a href="#l88.133"></a><span id="l88.133" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l88.134"></a><span id="l88.134" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l88.135"></a><span id="l88.135" class="difflineminus">-    eventPath;</span>
<a href="#l88.136"></a><span id="l88.136" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.137"></a><span id="l88.137" class="difflineminus">-  // Wednesday</span>
<a href="#l88.138"></a><span id="l88.138" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l88.139"></a><span id="l88.139" class="difflineminus">-    eventPath;</span>
<a href="#l88.140"></a><span id="l88.140" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.141"></a><span id="l88.141" class="difflineplus">+    // check multiweek view</span>
<a href="#l88.142"></a><span id="l88.142" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l88.143"></a><span id="l88.143" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l88.144"></a><span id="l88.144" class="difflineplus">+    checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l88.145"></a><span id="l88.145"> </span>
<a href="#l88.146"></a><span id="l88.146" class="difflineminus">-  // check multiweek view</span>
<a href="#l88.147"></a><span id="l88.147" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l88.148"></a><span id="l88.148" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l88.149"></a><span id="l88.149" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l88.150"></a><span id="l88.150" class="difflineplus">+    // check month view</span>
<a href="#l88.151"></a><span id="l88.151" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l88.152"></a><span id="l88.152" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l88.153"></a><span id="l88.153" class="difflineplus">+    checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l88.154"></a><span id="l88.154"> </span>
<a href="#l88.155"></a><span id="l88.155" class="difflineminus">-  // check month view</span>
<a href="#l88.156"></a><span id="l88.156" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l88.157"></a><span id="l88.157" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l88.158"></a><span id="l88.158" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l88.159"></a><span id="l88.159" class="difflineminus">-</span>
<a href="#l88.160"></a><span id="l88.160" class="difflineminus">-  // delete event</span>
<a href="#l88.161"></a><span id="l88.161" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined) +</span>
<a href="#l88.162"></a><span id="l88.162" class="difflineminus">-    eventPath;</span>
<a href="#l88.163"></a><span id="l88.163" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.164"></a><span id="l88.164" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l88.165"></a><span id="l88.165" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l88.166"></a><span id="l88.166" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l88.167"></a><span id="l88.167" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.168"></a><span id="l88.168" class="difflineplus">+    // delete event</span>
<a href="#l88.169"></a><span id="l88.169" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined) +</span>
<a href="#l88.170"></a><span id="l88.170" class="difflineplus">+      eventPath;</span>
<a href="#l88.171"></a><span id="l88.171" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.172"></a><span id="l88.172" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l88.173"></a><span id="l88.173" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l88.174"></a><span id="l88.174" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l88.175"></a><span id="l88.175" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.176"></a><span id="l88.176"> };</span>
<a href="#l88.177"></a><span id="l88.177"> </span>
<a href="#l88.178"></a><span id="l88.178"> function setRecurrence(recurrence) {</span>
<a href="#l88.179"></a><span id="l88.179" class="difflineminus">-  // weekly</span>
<a href="#l88.180"></a><span id="l88.180" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l88.181"></a><span id="l88.181" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l88.182"></a><span id="l88.182" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l88.183"></a><span id="l88.183" class="difflineplus">+    // weekly</span>
<a href="#l88.184"></a><span id="l88.184" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l88.185"></a><span id="l88.185" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l88.186"></a><span id="l88.186" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l88.187"></a><span id="l88.187"> </span>
<a href="#l88.188"></a><span id="l88.188" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l88.189"></a><span id="l88.189" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l88.190"></a><span id="l88.190" class="difflineminus">-  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l88.191"></a><span id="l88.191" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l88.192"></a><span id="l88.192" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l88.193"></a><span id="l88.193" class="difflineplus">+    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l88.194"></a><span id="l88.194"> </span>
<a href="#l88.195"></a><span id="l88.195" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l88.196"></a><span id="l88.196" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l88.197"></a><span id="l88.197" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l88.198"></a><span id="l88.198" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l88.199"></a><span id="l88.199" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l88.200"></a><span id="l88.200" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l88.201"></a><span id="l88.201"> </span>
<a href="#l88.202"></a><span id="l88.202" class="difflineminus">-  // starting from Monday so it should be checked</span>
<a href="#l88.203"></a><span id="l88.203" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l88.204"></a><span id="l88.204" class="difflineminus">-  // check Wednesday and Friday too</span>
<a href="#l88.205"></a><span id="l88.205" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l88.206"></a><span id="l88.206" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l88.207"></a><span id="l88.207" class="difflineplus">+    // starting from Monday so it should be checked</span>
<a href="#l88.208"></a><span id="l88.208" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l88.209"></a><span id="l88.209" class="difflineplus">+    // check Wednesday and Friday too</span>
<a href="#l88.210"></a><span id="l88.210" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l88.211"></a><span id="l88.211" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l88.212"></a><span id="l88.212"> </span>
<a href="#l88.213"></a><span id="l88.213" class="difflineminus">-  // set until date</span>
<a href="#l88.214"></a><span id="l88.214" class="difflineminus">-  recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l88.215"></a><span id="l88.215" class="difflineminus">-  let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l88.216"></a><span id="l88.216" class="difflineminus">-    'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/' +</span>
<a href="#l88.217"></a><span id="l88.217" class="difflineminus">-    'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l88.218"></a><span id="l88.218" class="difflineminus">-    'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l88.219"></a><span id="l88.219" class="difflineminus">-  // delete previous date</span>
<a href="#l88.220"></a><span id="l88.220" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l88.221"></a><span id="l88.221" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l88.222"></a><span id="l88.222" class="difflineplus">+    // set until date</span>
<a href="#l88.223"></a><span id="l88.223" class="difflineplus">+    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l88.224"></a><span id="l88.224" class="difflineplus">+    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l88.225"></a><span id="l88.225" class="difflineplus">+      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/' +</span>
<a href="#l88.226"></a><span id="l88.226" class="difflineplus">+      'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l88.227"></a><span id="l88.227" class="difflineplus">+      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l88.228"></a><span id="l88.228" class="difflineplus">+    // delete previous date</span>
<a href="#l88.229"></a><span id="l88.229" class="difflineplus">+    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l88.230"></a><span id="l88.230" class="difflineplus">+    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l88.231"></a><span id="l88.231"> </span>
<a href="#l88.232"></a><span id="l88.232" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l88.233"></a><span id="l88.233" class="difflineminus">-                     .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l88.234"></a><span id="l88.234" class="difflineminus">-  let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l88.235"></a><span id="l88.235" class="difflineminus">-                                             endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l88.236"></a><span id="l88.236" class="difflineminus">-  recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l88.237"></a><span id="l88.237" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l88.238"></a><span id="l88.238" class="difflineplus">+                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l88.239"></a><span id="l88.239" class="difflineplus">+    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l88.240"></a><span id="l88.240" class="difflineplus">+                                               endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l88.241"></a><span id="l88.241" class="difflineplus">+    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l88.242"></a><span id="l88.242"> </span>
<a href="#l88.243"></a><span id="l88.243" class="difflineminus">-  // close dialog</span>
<a href="#l88.244"></a><span id="l88.244" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l88.245"></a><span id="l88.245" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l88.246"></a><span id="l88.246" class="difflineplus">+    // close dialog</span>
<a href="#l88.247"></a><span id="l88.247" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l88.248"></a><span id="l88.248" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l88.249"></a><span id="l88.249"> }</span>
<a href="#l88.250"></a><span id="l88.250"> </span>
<a href="#l88.251"></a><span id="l88.251"> function checkMultiWeekView(view) {</span>
<a href="#l88.252"></a><span id="l88.252" class="difflineminus">-  let startWeek = 1;</span>
<a href="#l88.253"></a><span id="l88.253" class="difflineplus">+    let startWeek = 1;</span>
<a href="#l88.254"></a><span id="l88.254" class="difflineplus">+</span>
<a href="#l88.255"></a><span id="l88.255" class="difflineplus">+    // in month view event starts from 2nd row</span>
<a href="#l88.256"></a><span id="l88.256" class="difflineplus">+    if (view == &quot;month&quot;) {</span>
<a href="#l88.257"></a><span id="l88.257" class="difflineplus">+        startWeek++;</span>
<a href="#l88.258"></a><span id="l88.258" class="difflineplus">+    }</span>
<a href="#l88.259"></a><span id="l88.259"> </span>
<a href="#l88.260"></a><span id="l88.260" class="difflineminus">-  // in month view event starts from 2nd row</span>
<a href="#l88.261"></a><span id="l88.261" class="difflineminus">-  if (view == &quot;month&quot;) {</span>
<a href="#l88.262"></a><span id="l88.262" class="difflineminus">-    startWeek++;</span>
<a href="#l88.263"></a><span id="l88.263" class="difflineminus">-  }</span>
<a href="#l88.264"></a><span id="l88.264" class="difflineplus">+    for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l88.265"></a><span id="l88.265" class="difflineplus">+        // Monday</span>
<a href="#l88.266"></a><span id="l88.266" class="difflineplus">+        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined) +</span>
<a href="#l88.267"></a><span id="l88.267" class="difflineplus">+          eventPath;</span>
<a href="#l88.268"></a><span id="l88.268" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.269"></a><span id="l88.269" class="difflineplus">+        // Wednesday</span>
<a href="#l88.270"></a><span id="l88.270" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined) +</span>
<a href="#l88.271"></a><span id="l88.271" class="difflineplus">+          eventPath;</span>
<a href="#l88.272"></a><span id="l88.272" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.273"></a><span id="l88.273" class="difflineplus">+        // Friday</span>
<a href="#l88.274"></a><span id="l88.274" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined) +</span>
<a href="#l88.275"></a><span id="l88.275" class="difflineplus">+          eventPath;</span>
<a href="#l88.276"></a><span id="l88.276" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.277"></a><span id="l88.277" class="difflineplus">+    }</span>
<a href="#l88.278"></a><span id="l88.278"> </span>
<a href="#l88.279"></a><span id="l88.279" class="difflineminus">-  for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l88.280"></a><span id="l88.280" class="difflineminus">-    // Monday</span>
<a href="#l88.281"></a><span id="l88.281" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined) +</span>
<a href="#l88.282"></a><span id="l88.282" class="difflineminus">-      eventPath;</span>
<a href="#l88.283"></a><span id="l88.283" class="difflineplus">+    // Monday, last occurrence</span>
<a href="#l88.284"></a><span id="l88.284" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l88.285"></a><span id="l88.285" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l88.286"></a><span id="l88.286">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.287"></a><span id="l88.287">     // Wednesday</span>
<a href="#l88.288"></a><span id="l88.288" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined) +</span>
<a href="#l88.289"></a><span id="l88.289" class="difflineminus">-      eventPath;</span>
<a href="#l88.290"></a><span id="l88.290" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.291"></a><span id="l88.291" class="difflineminus">-    // Friday</span>
<a href="#l88.292"></a><span id="l88.292" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined) +</span>
<a href="#l88.293"></a><span id="l88.293" class="difflineminus">-      eventPath;</span>
<a href="#l88.294"></a><span id="l88.294" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.295"></a><span id="l88.295" class="difflineminus">-  }</span>
<a href="#l88.296"></a><span id="l88.296" class="difflineminus">-</span>
<a href="#l88.297"></a><span id="l88.297" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l88.298"></a><span id="l88.298" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l88.299"></a><span id="l88.299" class="difflineminus">-    undefined) + eventPath;</span>
<a href="#l88.300"></a><span id="l88.300" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.301"></a><span id="l88.301" class="difflineminus">-  // Wednesday</span>
<a href="#l88.302"></a><span id="l88.302" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l88.303"></a><span id="l88.303" class="difflineminus">-    undefined) + eventPath;</span>
<a href="#l88.304"></a><span id="l88.304" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.305"></a><span id="l88.305" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l88.306"></a><span id="l88.306" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l88.307"></a><span id="l88.307" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l88.308"></a><span id="l88.308"> }</span>
<a href="#l88.309"></a><span id="l88.309"> </span>
<a href="#l88.310"></a><span id="l88.310"> var teardownTest = function(module) {</span>
<a href="#l88.311"></a><span id="l88.311" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l88.312"></a><span id="l88.312" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l88.313"></a><span id="l88.313"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -8,290 +8,290 @@ var utils = require(&quot;../shared-modules/u</span>
<a href="#l89.4"></a><span id="l89.4"> </span>
<a href="#l89.5"></a><span id="l89.5"> var sleep = 500;</span>
<a href="#l89.6"></a><span id="l89.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l89.7"></a><span id="l89.7"> var hour = 8;</span>
<a href="#l89.8"></a><span id="l89.8"> var startDate = new Date(2009, 0, 6);</span>
<a href="#l89.9"></a><span id="l89.9"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l89.10"></a><span id="l89.10"> </span>
<a href="#l89.11"></a><span id="l89.11"> var setupModule = function(module) {</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l89.14"></a><span id="l89.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l89.15"></a><span id="l89.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l89.16"></a><span id="l89.16"> };</span>
<a href="#l89.17"></a><span id="l89.17"> </span>
<a href="#l89.18"></a><span id="l89.18"> var testWeeklyWithExceptionRecurrence = function() {</span>
<a href="#l89.19"></a><span id="l89.19" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l89.20"></a><span id="l89.20" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l89.21"></a><span id="l89.21" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.22"></a><span id="l89.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l89.23"></a><span id="l89.23" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l89.24"></a><span id="l89.24" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.25"></a><span id="l89.25"> </span>
<a href="#l89.26"></a><span id="l89.26" class="difflineminus">-  // create weekly recurring event</span>
<a href="#l89.27"></a><span id="l89.27" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.28"></a><span id="l89.28" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l89.29"></a><span id="l89.29" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l89.30"></a><span id="l89.30" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l89.31"></a><span id="l89.31" class="difflineplus">+    // create weekly recurring event</span>
<a href="#l89.32"></a><span id="l89.32" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.33"></a><span id="l89.33" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l89.34"></a><span id="l89.34" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l89.35"></a><span id="l89.35" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l89.36"></a><span id="l89.36"> </span>
<a href="#l89.37"></a><span id="l89.37" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l89.38"></a><span id="l89.38" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l89.39"></a><span id="l89.39" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l89.40"></a><span id="l89.40" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l89.41"></a><span id="l89.41" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l89.42"></a><span id="l89.42" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l89.43"></a><span id="l89.43" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l89.44"></a><span id="l89.44" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l89.45"></a><span id="l89.45"> </span>
<a href="#l89.46"></a><span id="l89.46" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l89.47"></a><span id="l89.47" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l89.48"></a><span id="l89.48" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l89.49"></a><span id="l89.49" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l89.50"></a><span id="l89.50"> </span>
<a href="#l89.51"></a><span id="l89.51" class="difflineminus">-  // move 5th January occurrence to 6th January</span>
<a href="#l89.52"></a><span id="l89.52" class="difflineminus">-  calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l89.53"></a><span id="l89.53" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.54"></a><span id="l89.54" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.55"></a><span id="l89.55" class="difflineminus">-      eventPath));</span>
<a href="#l89.56"></a><span id="l89.56" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l89.57"></a><span id="l89.57" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l89.58"></a><span id="l89.58" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l89.59"></a><span id="l89.59" class="difflineplus">+    // move 5th January occurrence to 6th January</span>
<a href="#l89.60"></a><span id="l89.60" class="difflineplus">+    calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l89.61"></a><span id="l89.61" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.62"></a><span id="l89.62" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.63"></a><span id="l89.63" class="difflineplus">+        eventPath));</span>
<a href="#l89.64"></a><span id="l89.64" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l89.65"></a><span id="l89.65" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l89.66"></a><span id="l89.66" class="difflineplus">+    event.sleep(sleep);</span>
<a href="#l89.67"></a><span id="l89.67"> </span>
<a href="#l89.68"></a><span id="l89.68" class="difflineminus">-  let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l89.69"></a><span id="l89.69" class="difflineminus">-    'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/' +</span>
<a href="#l89.70"></a><span id="l89.70" class="difflineminus">-    'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l89.71"></a><span id="l89.71" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l89.72"></a><span id="l89.72" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l89.73"></a><span id="l89.73" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l89.74"></a><span id="l89.74" class="difflineminus">-  let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l89.75"></a><span id="l89.75" class="difflineminus">-    'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/' +</span>
<a href="#l89.76"></a><span id="l89.76" class="difflineminus">-    'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l89.77"></a><span id="l89.77" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l89.78"></a><span id="l89.78" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l89.79"></a><span id="l89.79" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l89.80"></a><span id="l89.80" class="difflineplus">+    let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l89.81"></a><span id="l89.81" class="difflineplus">+      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/' +</span>
<a href="#l89.82"></a><span id="l89.82" class="difflineplus">+      'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l89.83"></a><span id="l89.83" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l89.84"></a><span id="l89.84" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l89.85"></a><span id="l89.85" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l89.86"></a><span id="l89.86" class="difflineplus">+    let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l89.87"></a><span id="l89.87" class="difflineplus">+      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/' +</span>
<a href="#l89.88"></a><span id="l89.88" class="difflineplus">+      'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l89.89"></a><span id="l89.89" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l89.90"></a><span id="l89.90" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l89.91"></a><span id="l89.91" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l89.92"></a><span id="l89.92"> </span>
<a href="#l89.93"></a><span id="l89.93" class="difflineminus">-  event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l89.94"></a><span id="l89.94" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l89.95"></a><span id="l89.95" class="difflineminus">-                     .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l89.96"></a><span id="l89.96" class="difflineminus">-  let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l89.97"></a><span id="l89.97" class="difflineminus">-                                             startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l89.98"></a><span id="l89.98" class="difflineminus">-  event.type(startDateInput, startDateString);</span>
<a href="#l89.99"></a><span id="l89.99" class="difflineminus">-  // applies startdate change</span>
<a href="#l89.100"></a><span id="l89.100" class="difflineminus">-  event.click(endDateInput);</span>
<a href="#l89.101"></a><span id="l89.101" class="difflineplus">+    event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l89.102"></a><span id="l89.102" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l89.103"></a><span id="l89.103" class="difflineplus">+                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l89.104"></a><span id="l89.104" class="difflineplus">+    let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l89.105"></a><span id="l89.105" class="difflineplus">+                                               startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l89.106"></a><span id="l89.106" class="difflineplus">+    event.type(startDateInput, startDateString);</span>
<a href="#l89.107"></a><span id="l89.107" class="difflineplus">+    // applies startdate change</span>
<a href="#l89.108"></a><span id="l89.108" class="difflineplus">+    event.click(endDateInput);</span>
<a href="#l89.109"></a><span id="l89.109"> </span>
<a href="#l89.110"></a><span id="l89.110" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l89.111"></a><span id="l89.111" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l89.112"></a><span id="l89.112" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l89.113"></a><span id="l89.113" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l89.114"></a><span id="l89.114"> </span>
<a href="#l89.115"></a><span id="l89.115" class="difflineminus">-  // change recurrence rule</span>
<a href="#l89.116"></a><span id="l89.116" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l89.117"></a><span id="l89.117" class="difflineminus">-  calUtils.handleParentModification(controller, false);</span>
<a href="#l89.118"></a><span id="l89.118" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.119"></a><span id="l89.119" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.120"></a><span id="l89.120" class="difflineminus">-      eventPath));</span>
<a href="#l89.121"></a><span id="l89.121" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l89.122"></a><span id="l89.122" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l89.123"></a><span id="l89.123" class="difflineplus">+    // change recurrence rule</span>
<a href="#l89.124"></a><span id="l89.124" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l89.125"></a><span id="l89.125" class="difflineplus">+    calUtils.handleParentModification(controller, false);</span>
<a href="#l89.126"></a><span id="l89.126" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.127"></a><span id="l89.127" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.128"></a><span id="l89.128" class="difflineplus">+        eventPath));</span>
<a href="#l89.129"></a><span id="l89.129" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l89.130"></a><span id="l89.130" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l89.131"></a><span id="l89.131"> </span>
<a href="#l89.132"></a><span id="l89.132" class="difflineminus">-  dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l89.133"></a><span id="l89.133" class="difflineminus">-  dialog.start(changeRecurrence);</span>
<a href="#l89.134"></a><span id="l89.134" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l89.135"></a><span id="l89.135" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l89.136"></a><span id="l89.136" class="difflineplus">+    dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l89.137"></a><span id="l89.137" class="difflineplus">+    dialog.start(changeRecurrence);</span>
<a href="#l89.138"></a><span id="l89.138" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l89.139"></a><span id="l89.139" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l89.140"></a><span id="l89.140"> </span>
<a href="#l89.141"></a><span id="l89.141" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l89.142"></a><span id="l89.142" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l89.143"></a><span id="l89.143" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l89.144"></a><span id="l89.144" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l89.145"></a><span id="l89.145"> </span>
<a href="#l89.146"></a><span id="l89.146" class="difflineminus">-  // check two weeks</span>
<a href="#l89.147"></a><span id="l89.147" class="difflineminus">-  // day view</span>
<a href="#l89.148"></a><span id="l89.148" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l89.149"></a><span id="l89.149" class="difflineminus">-  let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.150"></a><span id="l89.150" class="difflineminus">-    eventPath;</span>
<a href="#l89.151"></a><span id="l89.151" class="difflineplus">+    // check two weeks</span>
<a href="#l89.152"></a><span id="l89.152" class="difflineplus">+    // day view</span>
<a href="#l89.153"></a><span id="l89.153" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l89.154"></a><span id="l89.154" class="difflineplus">+    let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.155"></a><span id="l89.155" class="difflineplus">+      eventPath;</span>
<a href="#l89.156"></a><span id="l89.156"> </span>
<a href="#l89.157"></a><span id="l89.157" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.158"></a><span id="l89.158" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.159"></a><span id="l89.159" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.160"></a><span id="l89.160" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.161"></a><span id="l89.161"> </span>
<a href="#l89.162"></a><span id="l89.162" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.163"></a><span id="l89.163" class="difflineminus">-  let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l89.164"></a><span id="l89.164" class="difflineminus">-    'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l89.165"></a><span id="l89.165" class="difflineminus">-    'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l89.166"></a><span id="l89.166" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l89.167"></a><span id="l89.167" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l89.168"></a><span id="l89.168" class="difflineminus">-  // assert exactly two</span>
<a href="#l89.169"></a><span id="l89.169" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.170"></a><span id="l89.170" class="difflineminus">-    tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l89.171"></a><span id="l89.171" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.172"></a><span id="l89.172" class="difflineminus">-    tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l89.173"></a><span id="l89.173" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.174"></a><span id="l89.174" class="difflineminus">-    tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l89.175"></a><span id="l89.175" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.176"></a><span id="l89.176" class="difflineplus">+    let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l89.177"></a><span id="l89.177" class="difflineplus">+      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l89.178"></a><span id="l89.178" class="difflineplus">+      'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l89.179"></a><span id="l89.179" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l89.180"></a><span id="l89.180" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l89.181"></a><span id="l89.181" class="difflineplus">+    // assert exactly two</span>
<a href="#l89.182"></a><span id="l89.182" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.183"></a><span id="l89.183" class="difflineplus">+      tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l89.184"></a><span id="l89.184" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.185"></a><span id="l89.185" class="difflineplus">+      tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l89.186"></a><span id="l89.186" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.187"></a><span id="l89.187" class="difflineplus">+      tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l89.188"></a><span id="l89.188"> </span>
<a href="#l89.189"></a><span id="l89.189" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.190"></a><span id="l89.190" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.191"></a><span id="l89.191" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.192"></a><span id="l89.192" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.193"></a><span id="l89.193" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.194"></a><span id="l89.194" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.195"></a><span id="l89.195" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.196"></a><span id="l89.196" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.197"></a><span id="l89.197" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.198"></a><span id="l89.198" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.199"></a><span id="l89.199" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.200"></a><span id="l89.200" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.201"></a><span id="l89.201" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.202"></a><span id="l89.202" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.203"></a><span id="l89.203" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.204"></a><span id="l89.204" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.205"></a><span id="l89.205" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.206"></a><span id="l89.206" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.207"></a><span id="l89.207" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.208"></a><span id="l89.208" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.209"></a><span id="l89.209"> </span>
<a href="#l89.210"></a><span id="l89.210" class="difflineminus">-  // next week</span>
<a href="#l89.211"></a><span id="l89.211" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.212"></a><span id="l89.212" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.213"></a><span id="l89.213" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.214"></a><span id="l89.214" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.215"></a><span id="l89.215" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.216"></a><span id="l89.216" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.217"></a><span id="l89.217" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.218"></a><span id="l89.218" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.219"></a><span id="l89.219" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.220"></a><span id="l89.220" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.221"></a><span id="l89.221" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.222"></a><span id="l89.222" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.223"></a><span id="l89.223" class="difflineplus">+    // next week</span>
<a href="#l89.224"></a><span id="l89.224" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.225"></a><span id="l89.225" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.226"></a><span id="l89.226" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.227"></a><span id="l89.227" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.228"></a><span id="l89.228" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.229"></a><span id="l89.229" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.230"></a><span id="l89.230" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.231"></a><span id="l89.231" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.232"></a><span id="l89.232" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.233"></a><span id="l89.233" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.234"></a><span id="l89.234" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.235"></a><span id="l89.235" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.236"></a><span id="l89.236"> </span>
<a href="#l89.237"></a><span id="l89.237" class="difflineminus">-  // week view</span>
<a href="#l89.238"></a><span id="l89.238" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l89.239"></a><span id="l89.239" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.240"></a><span id="l89.240" class="difflineplus">+    // week view</span>
<a href="#l89.241"></a><span id="l89.241" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l89.242"></a><span id="l89.242" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.243"></a><span id="l89.243"> </span>
<a href="#l89.244"></a><span id="l89.244" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l89.245"></a><span id="l89.245" class="difflineminus">-    eventPath;</span>
<a href="#l89.246"></a><span id="l89.246" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.247"></a><span id="l89.247" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l89.248"></a><span id="l89.248" class="difflineplus">+      eventPath;</span>
<a href="#l89.249"></a><span id="l89.249" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.250"></a><span id="l89.250"> </span>
<a href="#l89.251"></a><span id="l89.251" class="difflineminus">-  tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l89.252"></a><span id="l89.252" class="difflineminus">-    'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l89.253"></a><span id="l89.253" class="difflineminus">-    'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l89.254"></a><span id="l89.254" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l89.255"></a><span id="l89.255" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l89.256"></a><span id="l89.256" class="difflineminus">-  // assert exactly two</span>
<a href="#l89.257"></a><span id="l89.257" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.258"></a><span id="l89.258" class="difflineminus">-    tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l89.259"></a><span id="l89.259" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.260"></a><span id="l89.260" class="difflineminus">-    tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l89.261"></a><span id="l89.261" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.262"></a><span id="l89.262" class="difflineminus">-    tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l89.263"></a><span id="l89.263" class="difflineplus">+    tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l89.264"></a><span id="l89.264" class="difflineplus">+      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l89.265"></a><span id="l89.265" class="difflineplus">+      'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l89.266"></a><span id="l89.266" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l89.267"></a><span id="l89.267" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l89.268"></a><span id="l89.268" class="difflineplus">+    // assert exactly two</span>
<a href="#l89.269"></a><span id="l89.269" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.270"></a><span id="l89.270" class="difflineplus">+      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l89.271"></a><span id="l89.271" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.272"></a><span id="l89.272" class="difflineplus">+      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l89.273"></a><span id="l89.273" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l89.274"></a><span id="l89.274" class="difflineplus">+      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l89.275"></a><span id="l89.275"> </span>
<a href="#l89.276"></a><span id="l89.276" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l89.277"></a><span id="l89.277" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.278"></a><span id="l89.278" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l89.279"></a><span id="l89.279" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.280"></a><span id="l89.280" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l89.281"></a><span id="l89.281" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.282"></a><span id="l89.282" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l89.283"></a><span id="l89.283" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.284"></a><span id="l89.284" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l89.285"></a><span id="l89.285" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.286"></a><span id="l89.286" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l89.287"></a><span id="l89.287" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.288"></a><span id="l89.288" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l89.289"></a><span id="l89.289" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.290"></a><span id="l89.290" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l89.291"></a><span id="l89.291" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.292"></a><span id="l89.292"> </span>
<a href="#l89.293"></a><span id="l89.293" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l89.294"></a><span id="l89.294" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l89.295"></a><span id="l89.295" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.296"></a><span id="l89.296" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l89.297"></a><span id="l89.297" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.298"></a><span id="l89.298" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l89.299"></a><span id="l89.299" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.300"></a><span id="l89.300" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l89.301"></a><span id="l89.301" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.302"></a><span id="l89.302" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l89.303"></a><span id="l89.303" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.304"></a><span id="l89.304" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l89.305"></a><span id="l89.305" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.306"></a><span id="l89.306" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l89.307"></a><span id="l89.307" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.308"></a><span id="l89.308" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l89.309"></a><span id="l89.309" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l89.310"></a><span id="l89.310" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.311"></a><span id="l89.311" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l89.312"></a><span id="l89.312" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.313"></a><span id="l89.313" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l89.314"></a><span id="l89.314" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.315"></a><span id="l89.315" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l89.316"></a><span id="l89.316" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.317"></a><span id="l89.317" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l89.318"></a><span id="l89.318" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.319"></a><span id="l89.319" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l89.320"></a><span id="l89.320" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.321"></a><span id="l89.321" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l89.322"></a><span id="l89.322" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.323"></a><span id="l89.323"> </span>
<a href="#l89.324"></a><span id="l89.324" class="difflineminus">-  // multiweek view</span>
<a href="#l89.325"></a><span id="l89.325" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l89.326"></a><span id="l89.326" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.327"></a><span id="l89.327" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l89.328"></a><span id="l89.328" class="difflineplus">+    // multiweek view</span>
<a href="#l89.329"></a><span id="l89.329" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l89.330"></a><span id="l89.330" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l89.331"></a><span id="l89.331" class="difflineplus">+    checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l89.332"></a><span id="l89.332"> </span>
<a href="#l89.333"></a><span id="l89.333" class="difflineminus">-  // month view</span>
<a href="#l89.334"></a><span id="l89.334" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l89.335"></a><span id="l89.335" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l89.336"></a><span id="l89.336" class="difflineplus">+    // month view</span>
<a href="#l89.337"></a><span id="l89.337" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l89.338"></a><span id="l89.338" class="difflineplus">+    checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l89.339"></a><span id="l89.339"> </span>
<a href="#l89.340"></a><span id="l89.340" class="difflineminus">-  // delete event</span>
<a href="#l89.341"></a><span id="l89.341" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l89.342"></a><span id="l89.342" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l89.343"></a><span id="l89.343" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.344"></a><span id="l89.344" class="difflineminus">-    eventPath;</span>
<a href="#l89.345"></a><span id="l89.345" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.346"></a><span id="l89.346" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l89.347"></a><span id="l89.347" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l89.348"></a><span id="l89.348" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l89.349"></a><span id="l89.349" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.350"></a><span id="l89.350" class="difflineplus">+    // delete event</span>
<a href="#l89.351"></a><span id="l89.351" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l89.352"></a><span id="l89.352" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l89.353"></a><span id="l89.353" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l89.354"></a><span id="l89.354" class="difflineplus">+      eventPath;</span>
<a href="#l89.355"></a><span id="l89.355" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.356"></a><span id="l89.356" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l89.357"></a><span id="l89.357" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l89.358"></a><span id="l89.358" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l89.359"></a><span id="l89.359" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l89.360"></a><span id="l89.360"> };</span>
<a href="#l89.361"></a><span id="l89.361"> </span>
<a href="#l89.362"></a><span id="l89.362"> function setRecurrence(recurrence) {</span>
<a href="#l89.363"></a><span id="l89.363" class="difflineminus">-  // weekly</span>
<a href="#l89.364"></a><span id="l89.364" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l89.365"></a><span id="l89.365" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l89.366"></a><span id="l89.366" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l89.367"></a><span id="l89.367" class="difflineplus">+    // weekly</span>
<a href="#l89.368"></a><span id="l89.368" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l89.369"></a><span id="l89.369" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l89.370"></a><span id="l89.370" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l89.371"></a><span id="l89.371"> </span>
<a href="#l89.372"></a><span id="l89.372" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l89.373"></a><span id="l89.373" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l89.374"></a><span id="l89.374" class="difflineminus">-  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l89.375"></a><span id="l89.375" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l89.376"></a><span id="l89.376" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l89.377"></a><span id="l89.377" class="difflineplus">+    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l89.378"></a><span id="l89.378"> </span>
<a href="#l89.379"></a><span id="l89.379" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l89.380"></a><span id="l89.380" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l89.381"></a><span id="l89.381" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l89.382"></a><span id="l89.382" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l89.383"></a><span id="l89.383" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l89.384"></a><span id="l89.384" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l89.385"></a><span id="l89.385"> </span>
<a href="#l89.386"></a><span id="l89.386" class="difflineminus">-  // starting from Monday so it should be checked</span>
<a href="#l89.387"></a><span id="l89.387" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l89.388"></a><span id="l89.388" class="difflineminus">-  // check Wednesday and Friday too</span>
<a href="#l89.389"></a><span id="l89.389" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l89.390"></a><span id="l89.390" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l89.391"></a><span id="l89.391" class="difflineplus">+    // starting from Monday so it should be checked</span>
<a href="#l89.392"></a><span id="l89.392" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l89.393"></a><span id="l89.393" class="difflineplus">+    // check Wednesday and Friday too</span>
<a href="#l89.394"></a><span id="l89.394" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l89.395"></a><span id="l89.395" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l89.396"></a><span id="l89.396"> </span>
<a href="#l89.397"></a><span id="l89.397" class="difflineminus">-  // close dialog</span>
<a href="#l89.398"></a><span id="l89.398" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l89.399"></a><span id="l89.399" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l89.400"></a><span id="l89.400" class="difflineplus">+    // close dialog</span>
<a href="#l89.401"></a><span id="l89.401" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l89.402"></a><span id="l89.402" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l89.403"></a><span id="l89.403"> }</span>
<a href="#l89.404"></a><span id="l89.404"> </span>
<a href="#l89.405"></a><span id="l89.405"> function changeRecurrence(recurrence) {</span>
<a href="#l89.406"></a><span id="l89.406" class="difflineminus">-  // weekly</span>
<a href="#l89.407"></a><span id="l89.407" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l89.408"></a><span id="l89.408" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l89.409"></a><span id="l89.409" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l89.410"></a><span id="l89.410" class="difflineplus">+    // weekly</span>
<a href="#l89.411"></a><span id="l89.411" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l89.412"></a><span id="l89.412" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l89.413"></a><span id="l89.413" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l89.414"></a><span id="l89.414"> </span>
<a href="#l89.415"></a><span id="l89.415" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l89.416"></a><span id="l89.416" class="difflineminus">-  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l89.417"></a><span id="l89.417" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l89.418"></a><span id="l89.418" class="difflineminus">-  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l89.419"></a><span id="l89.419" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l89.420"></a><span id="l89.420" class="difflineplus">+    let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l89.421"></a><span id="l89.421" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l89.422"></a><span id="l89.422" class="difflineplus">+    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l89.423"></a><span id="l89.423"> </span>
<a href="#l89.424"></a><span id="l89.424" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l89.425"></a><span id="l89.425" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l89.426"></a><span id="l89.426" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l89.427"></a><span id="l89.427" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l89.428"></a><span id="l89.428" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l89.429"></a><span id="l89.429" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l89.430"></a><span id="l89.430"> </span>
<a href="#l89.431"></a><span id="l89.431" class="difflineminus">-  // check old rule</span>
<a href="#l89.432"></a><span id="l89.432" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l89.433"></a><span id="l89.433" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l89.434"></a><span id="l89.434" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l89.435"></a><span id="l89.435" class="difflineplus">+    // check old rule</span>
<a href="#l89.436"></a><span id="l89.436" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l89.437"></a><span id="l89.437" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l89.438"></a><span id="l89.438" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l89.439"></a><span id="l89.439"> </span>
<a href="#l89.440"></a><span id="l89.440" class="difflineminus">-  // check Tuesday</span>
<a href="#l89.441"></a><span id="l89.441" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l89.442"></a><span id="l89.442" class="difflineplus">+    // check Tuesday</span>
<a href="#l89.443"></a><span id="l89.443" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l89.444"></a><span id="l89.444"> </span>
<a href="#l89.445"></a><span id="l89.445" class="difflineminus">-  // close dialog</span>
<a href="#l89.446"></a><span id="l89.446" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l89.447"></a><span id="l89.447" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l89.448"></a><span id="l89.448" class="difflineplus">+    // close dialog</span>
<a href="#l89.449"></a><span id="l89.449" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l89.450"></a><span id="l89.450" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l89.451"></a><span id="l89.451"> }</span>
<a href="#l89.452"></a><span id="l89.452"> </span>
<a href="#l89.453"></a><span id="l89.453"> function checkMultiWeekView(view) {</span>
<a href="#l89.454"></a><span id="l89.454" class="difflineminus">-  let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l89.455"></a><span id="l89.455" class="difflineplus">+    let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l89.456"></a><span id="l89.456"> </span>
<a href="#l89.457"></a><span id="l89.457" class="difflineminus">-  let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l89.458"></a><span id="l89.458" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.459"></a><span id="l89.459" class="difflineminus">-  // assert exactly two</span>
<a href="#l89.460"></a><span id="l89.460" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l89.461"></a><span id="l89.461" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[0]&quot;));</span>
<a href="#l89.462"></a><span id="l89.462" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l89.463"></a><span id="l89.463" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[1]&quot;));</span>
<a href="#l89.464"></a><span id="l89.464" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l89.465"></a><span id="l89.465" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + &quot;/[2]&quot;));</span>
<a href="#l89.466"></a><span id="l89.466" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l89.467"></a><span id="l89.467" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.468"></a><span id="l89.468" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l89.469"></a><span id="l89.469" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.470"></a><span id="l89.470" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l89.471"></a><span id="l89.471" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.472"></a><span id="l89.472" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l89.473"></a><span id="l89.473" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.474"></a><span id="l89.474" class="difflineplus">+    let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l89.475"></a><span id="l89.475" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.476"></a><span id="l89.476" class="difflineplus">+    // assert exactly two</span>
<a href="#l89.477"></a><span id="l89.477" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l89.478"></a><span id="l89.478" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[0]&quot;));</span>
<a href="#l89.479"></a><span id="l89.479" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l89.480"></a><span id="l89.480" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[1]&quot;));</span>
<a href="#l89.481"></a><span id="l89.481" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l89.482"></a><span id="l89.482" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + &quot;/[2]&quot;));</span>
<a href="#l89.483"></a><span id="l89.483" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l89.484"></a><span id="l89.484" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.485"></a><span id="l89.485" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l89.486"></a><span id="l89.486" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.487"></a><span id="l89.487" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l89.488"></a><span id="l89.488" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.489"></a><span id="l89.489" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l89.490"></a><span id="l89.490" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.491"></a><span id="l89.491"> </span>
<a href="#l89.492"></a><span id="l89.492" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l89.493"></a><span id="l89.493" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.494"></a><span id="l89.494" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l89.495"></a><span id="l89.495" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.496"></a><span id="l89.496" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l89.497"></a><span id="l89.497" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.498"></a><span id="l89.498" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l89.499"></a><span id="l89.499" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.500"></a><span id="l89.500" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l89.501"></a><span id="l89.501" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.502"></a><span id="l89.502" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l89.503"></a><span id="l89.503" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.504"></a><span id="l89.504" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l89.505"></a><span id="l89.505" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.506"></a><span id="l89.506" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l89.507"></a><span id="l89.507" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.508"></a><span id="l89.508" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l89.509"></a><span id="l89.509" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.510"></a><span id="l89.510" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l89.511"></a><span id="l89.511" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.512"></a><span id="l89.512" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l89.513"></a><span id="l89.513" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.514"></a><span id="l89.514" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l89.515"></a><span id="l89.515" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.516"></a><span id="l89.516" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l89.517"></a><span id="l89.517" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.518"></a><span id="l89.518" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l89.519"></a><span id="l89.519" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l89.520"></a><span id="l89.520"> }</span>
<a href="#l89.521"></a><span id="l89.521"> </span>
<a href="#l89.522"></a><span id="l89.522"> var teardownTest = function(module) {</span>
<a href="#l89.523"></a><span id="l89.523" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l89.524"></a><span id="l89.524" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l89.525"></a><span id="l89.525"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testAnnualRecurrence.js</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -5,92 +5,92 @@</span>
<a href="#l90.4"></a><span id="l90.4"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l90.5"></a><span id="l90.5"> </span>
<a href="#l90.6"></a><span id="l90.6"> var sleep = 500;</span>
<a href="#l90.7"></a><span id="l90.7"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l90.8"></a><span id="l90.8"> var startYear = 1950;</span>
<a href="#l90.9"></a><span id="l90.9"> var epoch = 1970;</span>
<a href="#l90.10"></a><span id="l90.10"> </span>
<a href="#l90.11"></a><span id="l90.11"> var setupModule = function(module) {</span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l90.14"></a><span id="l90.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l90.15"></a><span id="l90.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l90.16"></a><span id="l90.16"> };</span>
<a href="#l90.17"></a><span id="l90.17"> </span>
<a href="#l90.18"></a><span id="l90.18"> var testAnnualRecurrence = function() {</span>
<a href="#l90.19"></a><span id="l90.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l90.20"></a><span id="l90.20" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l90.21"></a><span id="l90.21"> </span>
<a href="#l90.22"></a><span id="l90.22" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l90.23"></a><span id="l90.23" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l90.24"></a><span id="l90.24" class="difflineminus">-  calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l90.25"></a><span id="l90.25" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l90.26"></a><span id="l90.26" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l90.27"></a><span id="l90.27" class="difflineplus">+    calUtils.goToDate(controller, startYear, 1, 1);</span>
<a href="#l90.28"></a><span id="l90.28"> </span>
<a href="#l90.29"></a><span id="l90.29" class="difflineminus">-  // rotate view</span>
<a href="#l90.30"></a><span id="l90.30" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l90.31"></a><span id="l90.31" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l90.32"></a><span id="l90.32" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l90.33"></a><span id="l90.33" class="difflineminus">-    return view.orient == &quot;horizontal&quot;;</span>
<a href="#l90.34"></a><span id="l90.34" class="difflineminus">-  });</span>
<a href="#l90.35"></a><span id="l90.35" class="difflineplus">+    // rotate view</span>
<a href="#l90.36"></a><span id="l90.36" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l90.37"></a><span id="l90.37" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l90.38"></a><span id="l90.38" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l90.39"></a><span id="l90.39" class="difflineplus">+        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l90.40"></a><span id="l90.40" class="difflineplus">+    });</span>
<a href="#l90.41"></a><span id="l90.41" class="difflineplus">+</span>
<a href="#l90.42"></a><span id="l90.42" class="difflineplus">+    // create yearly recurring all-day event</span>
<a href="#l90.43"></a><span id="l90.43" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l90.44"></a><span id="l90.44" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l90.45"></a><span id="l90.45" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l90.46"></a><span id="l90.46" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l90.47"></a><span id="l90.47" class="difflineplus">+                   .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l90.48"></a><span id="l90.48" class="difflineplus">+    event.sleep(sleep);</span>
<a href="#l90.49"></a><span id="l90.49" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l90.50"></a><span id="l90.50" class="difflineplus">+      &quot;yearly&quot;);</span>
<a href="#l90.51"></a><span id="l90.51" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l90.52"></a><span id="l90.52" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l90.53"></a><span id="l90.53"> </span>
<a href="#l90.54"></a><span id="l90.54" class="difflineminus">-  // create yearly recurring all-day event</span>
<a href="#l90.55"></a><span id="l90.55" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l90.56"></a><span id="l90.56" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined)));</span>
<a href="#l90.57"></a><span id="l90.57" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l90.58"></a><span id="l90.58" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l90.59"></a><span id="l90.59" class="difflineminus">-                 .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l90.60"></a><span id="l90.60" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l90.61"></a><span id="l90.61" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l90.62"></a><span id="l90.62" class="difflineminus">-    &quot;yearly&quot;);</span>
<a href="#l90.63"></a><span id="l90.63" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l90.64"></a><span id="l90.64" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l90.65"></a><span id="l90.65" class="difflineplus">+    let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l90.66"></a><span id="l90.66" class="difflineplus">+    let box = &quot;&quot;;</span>
<a href="#l90.67"></a><span id="l90.67" class="difflineplus">+    for (let i = 0; i &lt; checkYears.length; i++) {</span>
<a href="#l90.68"></a><span id="l90.68" class="difflineplus">+        calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l90.69"></a><span id="l90.69" class="difflineplus">+        let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l90.70"></a><span id="l90.70" class="difflineplus">+        let column = date.getDay() + 1;</span>
<a href="#l90.71"></a><span id="l90.71" class="difflineplus">+</span>
<a href="#l90.72"></a><span id="l90.72" class="difflineplus">+        // day view</span>
<a href="#l90.73"></a><span id="l90.73" class="difflineplus">+        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l90.74"></a><span id="l90.74" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l90.75"></a><span id="l90.75" class="difflineplus">+          eventPath;</span>
<a href="#l90.76"></a><span id="l90.76" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.77"></a><span id="l90.77"> </span>
<a href="#l90.78"></a><span id="l90.78" class="difflineminus">-  let checkYears = [startYear, startYear + 1, epoch - 1, epoch, epoch + 1];</span>
<a href="#l90.79"></a><span id="l90.79" class="difflineminus">-  let box = &quot;&quot;;</span>
<a href="#l90.80"></a><span id="l90.80" class="difflineminus">-  for (let i = 0; i &lt; checkYears.length; i++) {</span>
<a href="#l90.81"></a><span id="l90.81" class="difflineminus">-    calUtils.goToDate(controller, checkYears[i], 1, 1);</span>
<a href="#l90.82"></a><span id="l90.82" class="difflineminus">-    let date = new Date(checkYears[i], 0, 1);</span>
<a href="#l90.83"></a><span id="l90.83" class="difflineminus">-    let column = date.getDay() + 1;</span>
<a href="#l90.84"></a><span id="l90.84" class="difflineplus">+        // week view</span>
<a href="#l90.85"></a><span id="l90.85" class="difflineplus">+        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l90.86"></a><span id="l90.86" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined) +</span>
<a href="#l90.87"></a><span id="l90.87" class="difflineplus">+          eventPath;</span>
<a href="#l90.88"></a><span id="l90.88" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.89"></a><span id="l90.89"> </span>
<a href="#l90.90"></a><span id="l90.90" class="difflineminus">-    // day view</span>
<a href="#l90.91"></a><span id="l90.91" class="difflineplus">+        // multiweek view</span>
<a href="#l90.92"></a><span id="l90.92" class="difflineplus">+        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l90.93"></a><span id="l90.93" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l90.94"></a><span id="l90.94" class="difflineplus">+          eventPath;</span>
<a href="#l90.95"></a><span id="l90.95" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.96"></a><span id="l90.96" class="difflineplus">+</span>
<a href="#l90.97"></a><span id="l90.97" class="difflineplus">+        // month view</span>
<a href="#l90.98"></a><span id="l90.98" class="difflineplus">+        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l90.99"></a><span id="l90.99" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l90.100"></a><span id="l90.100" class="difflineplus">+          eventPath;</span>
<a href="#l90.101"></a><span id="l90.101" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.102"></a><span id="l90.102" class="difflineplus">+    }</span>
<a href="#l90.103"></a><span id="l90.103" class="difflineplus">+</span>
<a href="#l90.104"></a><span id="l90.104" class="difflineplus">+    // delete event</span>
<a href="#l90.105"></a><span id="l90.105" class="difflineplus">+    calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l90.106"></a><span id="l90.106">     calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l90.107"></a><span id="l90.107">     box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l90.108"></a><span id="l90.108">       eventPath;</span>
<a href="#l90.109"></a><span id="l90.109" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.110"></a><span id="l90.110" class="difflineminus">-</span>
<a href="#l90.111"></a><span id="l90.111" class="difflineminus">-    // week view</span>
<a href="#l90.112"></a><span id="l90.112" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l90.113"></a><span id="l90.113" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.ALLDAY, undefined, column, undefined) +</span>
<a href="#l90.114"></a><span id="l90.114" class="difflineminus">-      eventPath;</span>
<a href="#l90.115"></a><span id="l90.115" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.116"></a><span id="l90.116" class="difflineminus">-</span>
<a href="#l90.117"></a><span id="l90.117" class="difflineminus">-    // multiweek view</span>
<a href="#l90.118"></a><span id="l90.118" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l90.119"></a><span id="l90.119" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l90.120"></a><span id="l90.120" class="difflineminus">-      eventPath;</span>
<a href="#l90.121"></a><span id="l90.121" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.122"></a><span id="l90.122" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l90.123"></a><span id="l90.123" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.124"></a><span id="l90.124" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l90.125"></a><span id="l90.125" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l90.126"></a><span id="l90.126" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.127"></a><span id="l90.127"> </span>
<a href="#l90.128"></a><span id="l90.128" class="difflineminus">-    // month view</span>
<a href="#l90.129"></a><span id="l90.129" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l90.130"></a><span id="l90.130" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.ALLDAY, 1, column, undefined) +</span>
<a href="#l90.131"></a><span id="l90.131" class="difflineminus">-      eventPath;</span>
<a href="#l90.132"></a><span id="l90.132" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.133"></a><span id="l90.133" class="difflineminus">-  }</span>
<a href="#l90.134"></a><span id="l90.134" class="difflineminus">-</span>
<a href="#l90.135"></a><span id="l90.135" class="difflineminus">-  // delete event</span>
<a href="#l90.136"></a><span id="l90.136" class="difflineminus">-  calUtils.goToDate(controller, checkYears[0], 1, 1);</span>
<a href="#l90.137"></a><span id="l90.137" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l90.138"></a><span id="l90.138" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.ALLDAY, undefined, 1, undefined) +</span>
<a href="#l90.139"></a><span id="l90.139" class="difflineminus">-    eventPath;</span>
<a href="#l90.140"></a><span id="l90.140" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l90.141"></a><span id="l90.141" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.142"></a><span id="l90.142" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l90.143"></a><span id="l90.143" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l90.144"></a><span id="l90.144" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l90.145"></a><span id="l90.145" class="difflineminus">-</span>
<a href="#l90.146"></a><span id="l90.146" class="difflineminus">-  // reset view</span>
<a href="#l90.147"></a><span id="l90.147" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l90.148"></a><span id="l90.148" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l90.149"></a><span id="l90.149" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l90.150"></a><span id="l90.150" class="difflineminus">-    return view.orient == &quot;vertical&quot;;</span>
<a href="#l90.151"></a><span id="l90.151" class="difflineminus">-  });</span>
<a href="#l90.152"></a><span id="l90.152" class="difflineplus">+    // reset view</span>
<a href="#l90.153"></a><span id="l90.153" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l90.154"></a><span id="l90.154" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l90.155"></a><span id="l90.155" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l90.156"></a><span id="l90.156" class="difflineplus">+        return view.orient == &quot;vertical&quot;;</span>
<a href="#l90.157"></a><span id="l90.157" class="difflineplus">+    });</span>
<a href="#l90.158"></a><span id="l90.158"> };</span>
<a href="#l90.159"></a><span id="l90.159"> </span>
<a href="#l90.160"></a><span id="l90.160"> var teardownTest = function(module) {</span>
<a href="#l90.161"></a><span id="l90.161" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l90.162"></a><span id="l90.162" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l90.163"></a><span id="l90.163"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testBiweeklyRecurrence.js</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -4,118 +4,118 @@</span>
<a href="#l91.4"></a><span id="l91.4"> </span>
<a href="#l91.5"></a><span id="l91.5"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l91.6"></a><span id="l91.6"> </span>
<a href="#l91.7"></a><span id="l91.7"> var sleep = 500;</span>
<a href="#l91.8"></a><span id="l91.8"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l91.9"></a><span id="l91.9"> var hour = 8;</span>
<a href="#l91.10"></a><span id="l91.10"> </span>
<a href="#l91.11"></a><span id="l91.11"> var setupModule = function(module) {</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l91.13"></a><span id="l91.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l91.14"></a><span id="l91.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l91.15"></a><span id="l91.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l91.16"></a><span id="l91.16"> };</span>
<a href="#l91.17"></a><span id="l91.17"> </span>
<a href="#l91.18"></a><span id="l91.18"> var testBiweeklyRecurrence = function() {</span>
<a href="#l91.19"></a><span id="l91.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l91.20"></a><span id="l91.20" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l91.21"></a><span id="l91.21"> </span>
<a href="#l91.22"></a><span id="l91.22" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l91.23"></a><span id="l91.23" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l91.24"></a><span id="l91.24" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.25"></a><span id="l91.25" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l91.26"></a><span id="l91.26" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l91.27"></a><span id="l91.27" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.28"></a><span id="l91.28"> </span>
<a href="#l91.29"></a><span id="l91.29" class="difflineminus">-  // rotate view</span>
<a href="#l91.30"></a><span id="l91.30" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l91.31"></a><span id="l91.31" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l91.32"></a><span id="l91.32" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l91.33"></a><span id="l91.33" class="difflineminus">-    return view.orient == &quot;horizontal&quot;;</span>
<a href="#l91.34"></a><span id="l91.34" class="difflineminus">-  });</span>
<a href="#l91.35"></a><span id="l91.35" class="difflineplus">+    // rotate view</span>
<a href="#l91.36"></a><span id="l91.36" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l91.37"></a><span id="l91.37" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l91.38"></a><span id="l91.38" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l91.39"></a><span id="l91.39" class="difflineplus">+        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l91.40"></a><span id="l91.40" class="difflineplus">+    });</span>
<a href="#l91.41"></a><span id="l91.41"> </span>
<a href="#l91.42"></a><span id="l91.42" class="difflineminus">-  // create biweekly event</span>
<a href="#l91.43"></a><span id="l91.43" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l91.44"></a><span id="l91.44" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l91.45"></a><span id="l91.45" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l91.46"></a><span id="l91.46" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l91.47"></a><span id="l91.47" class="difflineplus">+    // create biweekly event</span>
<a href="#l91.48"></a><span id="l91.48" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l91.49"></a><span id="l91.49" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l91.50"></a><span id="l91.50" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l91.51"></a><span id="l91.51" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l91.52"></a><span id="l91.52"> </span>
<a href="#l91.53"></a><span id="l91.53" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l91.54"></a><span id="l91.54" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l91.55"></a><span id="l91.55" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l91.56"></a><span id="l91.56" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l91.57"></a><span id="l91.57" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l91.58"></a><span id="l91.58" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;bi.weekly&quot;);</span>
<a href="#l91.59"></a><span id="l91.59" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l91.60"></a><span id="l91.60" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l91.61"></a><span id="l91.61"> </span>
<a href="#l91.62"></a><span id="l91.62" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l91.63"></a><span id="l91.63" class="difflineminus">-    eventPath;</span>
<a href="#l91.64"></a><span id="l91.64" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l91.65"></a><span id="l91.65" class="difflineplus">+      eventPath;</span>
<a href="#l91.66"></a><span id="l91.66" class="difflineplus">+</span>
<a href="#l91.67"></a><span id="l91.67" class="difflineplus">+    // check day view</span>
<a href="#l91.68"></a><span id="l91.68" class="difflineplus">+    for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l91.69"></a><span id="l91.69" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.70"></a><span id="l91.70" class="difflineplus">+        calUtils.forward(controller, 14);</span>
<a href="#l91.71"></a><span id="l91.71" class="difflineplus">+    }</span>
<a href="#l91.72"></a><span id="l91.72"> </span>
<a href="#l91.73"></a><span id="l91.73" class="difflineminus">-  // check day view</span>
<a href="#l91.74"></a><span id="l91.74" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l91.75"></a><span id="l91.75" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.76"></a><span id="l91.76" class="difflineminus">-    calUtils.forward(controller, 14);</span>
<a href="#l91.77"></a><span id="l91.77" class="difflineminus">-  }</span>
<a href="#l91.78"></a><span id="l91.78" class="difflineplus">+    // check week view</span>
<a href="#l91.79"></a><span id="l91.79" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l91.80"></a><span id="l91.80" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.81"></a><span id="l91.81"> </span>
<a href="#l91.82"></a><span id="l91.82" class="difflineminus">-  // check week view</span>
<a href="#l91.83"></a><span id="l91.83" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l91.84"></a><span id="l91.84" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.85"></a><span id="l91.85" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l91.86"></a><span id="l91.86" class="difflineplus">+      eventPath;</span>
<a href="#l91.87"></a><span id="l91.87" class="difflineplus">+    for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l91.88"></a><span id="l91.88" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.89"></a><span id="l91.89" class="difflineplus">+        calUtils.forward(2);</span>
<a href="#l91.90"></a><span id="l91.90" class="difflineplus">+    }</span>
<a href="#l91.91"></a><span id="l91.91" class="difflineplus">+</span>
<a href="#l91.92"></a><span id="l91.92" class="difflineplus">+    // check multiweek view</span>
<a href="#l91.93"></a><span id="l91.93" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l91.94"></a><span id="l91.94" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.95"></a><span id="l91.95"> </span>
<a href="#l91.96"></a><span id="l91.96" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l91.97"></a><span id="l91.97" class="difflineminus">-    eventPath;</span>
<a href="#l91.98"></a><span id="l91.98" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l91.99"></a><span id="l91.99" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.100"></a><span id="l91.100" class="difflineminus">-    calUtils.forward(2);</span>
<a href="#l91.101"></a><span id="l91.101" class="difflineminus">-  }</span>
<a href="#l91.102"></a><span id="l91.102" class="difflineplus">+    // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l91.103"></a><span id="l91.103" class="difflineplus">+    for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l91.104"></a><span id="l91.104" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l91.105"></a><span id="l91.105" class="difflineplus">+          undefined) + eventPath;</span>
<a href="#l91.106"></a><span id="l91.106" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.107"></a><span id="l91.107" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l91.108"></a><span id="l91.108" class="difflineplus">+          undefined) + eventPath;</span>
<a href="#l91.109"></a><span id="l91.109" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.110"></a><span id="l91.110" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l91.111"></a><span id="l91.111" class="difflineplus">+    }</span>
<a href="#l91.112"></a><span id="l91.112"> </span>
<a href="#l91.113"></a><span id="l91.113" class="difflineminus">-  // check multiweek view</span>
<a href="#l91.114"></a><span id="l91.114" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l91.115"></a><span id="l91.115" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.116"></a><span id="l91.116" class="difflineplus">+    // check month view</span>
<a href="#l91.117"></a><span id="l91.117" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l91.118"></a><span id="l91.118" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.119"></a><span id="l91.119"> </span>
<a href="#l91.120"></a><span id="l91.120" class="difflineminus">-  // always two occurrences in view, 1st and 3rd or 2nd and 4th week</span>
<a href="#l91.121"></a><span id="l91.121" class="difflineminus">-  for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l91.122"></a><span id="l91.122" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 1, 7,</span>
<a href="#l91.123"></a><span id="l91.123" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l91.124"></a><span id="l91.124" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.125"></a><span id="l91.125" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i % 2 + 3, 7,</span>
<a href="#l91.126"></a><span id="l91.126" class="difflineminus">-      undefined) + eventPath;</span>
<a href="#l91.127"></a><span id="l91.127" class="difflineplus">+    // January</span>
<a href="#l91.128"></a><span id="l91.128" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined) +</span>
<a href="#l91.129"></a><span id="l91.129" class="difflineplus">+      eventPath;</span>
<a href="#l91.130"></a><span id="l91.130">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.131"></a><span id="l91.131">     calUtils.forward(controller, 1);</span>
<a href="#l91.132"></a><span id="l91.132" class="difflineminus">-  }</span>
<a href="#l91.133"></a><span id="l91.133"> </span>
<a href="#l91.134"></a><span id="l91.134" class="difflineminus">-  // check month view</span>
<a href="#l91.135"></a><span id="l91.135" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l91.136"></a><span id="l91.136" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 31);</span>
<a href="#l91.137"></a><span id="l91.137" class="difflineminus">-</span>
<a href="#l91.138"></a><span id="l91.138" class="difflineminus">-  // January</span>
<a href="#l91.139"></a><span id="l91.139" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 5, 7, undefined) +</span>
<a href="#l91.140"></a><span id="l91.140" class="difflineminus">-    eventPath;</span>
<a href="#l91.141"></a><span id="l91.141" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.142"></a><span id="l91.142" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l91.143"></a><span id="l91.143" class="difflineminus">-</span>
<a href="#l91.144"></a><span id="l91.144" class="difflineminus">-  // February</span>
<a href="#l91.145"></a><span id="l91.145" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l91.146"></a><span id="l91.146" class="difflineminus">-    eventPath;</span>
<a href="#l91.147"></a><span id="l91.147" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.148"></a><span id="l91.148" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l91.149"></a><span id="l91.149" class="difflineminus">-    eventPath;</span>
<a href="#l91.150"></a><span id="l91.150" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.151"></a><span id="l91.151" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l91.152"></a><span id="l91.152" class="difflineplus">+    // February</span>
<a href="#l91.153"></a><span id="l91.153" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l91.154"></a><span id="l91.154" class="difflineplus">+      eventPath;</span>
<a href="#l91.155"></a><span id="l91.155" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.156"></a><span id="l91.156" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l91.157"></a><span id="l91.157" class="difflineplus">+      eventPath;</span>
<a href="#l91.158"></a><span id="l91.158" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.159"></a><span id="l91.159" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l91.160"></a><span id="l91.160"> </span>
<a href="#l91.161"></a><span id="l91.161" class="difflineminus">-  // March</span>
<a href="#l91.162"></a><span id="l91.162" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l91.163"></a><span id="l91.163" class="difflineminus">-    eventPath;</span>
<a href="#l91.164"></a><span id="l91.164" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.165"></a><span id="l91.165" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l91.166"></a><span id="l91.166" class="difflineminus">-    eventPath;</span>
<a href="#l91.167"></a><span id="l91.167" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.168"></a><span id="l91.168" class="difflineplus">+    // March</span>
<a href="#l91.169"></a><span id="l91.169" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 7, undefined) +</span>
<a href="#l91.170"></a><span id="l91.170" class="difflineplus">+      eventPath;</span>
<a href="#l91.171"></a><span id="l91.171" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.172"></a><span id="l91.172" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 4, 7, undefined) +</span>
<a href="#l91.173"></a><span id="l91.173" class="difflineplus">+      eventPath;</span>
<a href="#l91.174"></a><span id="l91.174" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.175"></a><span id="l91.175"> </span>
<a href="#l91.176"></a><span id="l91.176" class="difflineminus">-  // delete event</span>
<a href="#l91.177"></a><span id="l91.177" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.178"></a><span id="l91.178" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l91.179"></a><span id="l91.179" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l91.180"></a><span id="l91.180" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l91.181"></a><span id="l91.181" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.182"></a><span id="l91.182" class="difflineplus">+    // delete event</span>
<a href="#l91.183"></a><span id="l91.183" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.184"></a><span id="l91.184" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l91.185"></a><span id="l91.185" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l91.186"></a><span id="l91.186" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l91.187"></a><span id="l91.187" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l91.188"></a><span id="l91.188"> </span>
<a href="#l91.189"></a><span id="l91.189" class="difflineminus">-  // reset view</span>
<a href="#l91.190"></a><span id="l91.190" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l91.191"></a><span id="l91.191" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l91.192"></a><span id="l91.192" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l91.193"></a><span id="l91.193" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l91.194"></a><span id="l91.194" class="difflineminus">-    return view.orient == &quot;vertical&quot;;</span>
<a href="#l91.195"></a><span id="l91.195" class="difflineminus">-  });</span>
<a href="#l91.196"></a><span id="l91.196" class="difflineplus">+    // reset view</span>
<a href="#l91.197"></a><span id="l91.197" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l91.198"></a><span id="l91.198" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l91.199"></a><span id="l91.199" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l91.200"></a><span id="l91.200" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l91.201"></a><span id="l91.201" class="difflineplus">+        return view.orient == &quot;vertical&quot;;</span>
<a href="#l91.202"></a><span id="l91.202" class="difflineplus">+    });</span>
<a href="#l91.203"></a><span id="l91.203"> };</span>
<a href="#l91.204"></a><span id="l91.204"> </span>
<a href="#l91.205"></a><span id="l91.205"> var teardownTest = function(module) {</span>
<a href="#l91.206"></a><span id="l91.206" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l91.207"></a><span id="l91.207" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l91.208"></a><span id="l91.208"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -4,217 +4,217 @@</span>
<a href="#l92.4"></a><span id="l92.4"> </span>
<a href="#l92.5"></a><span id="l92.5"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l92.6"></a><span id="l92.6"> </span>
<a href="#l92.7"></a><span id="l92.7"> var sleep = 500;</span>
<a href="#l92.8"></a><span id="l92.8"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l92.9"></a><span id="l92.9"> var hour = 8;</span>
<a href="#l92.10"></a><span id="l92.10"> </span>
<a href="#l92.11"></a><span id="l92.11"> var setupModule = function(module) {</span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l92.14"></a><span id="l92.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l92.15"></a><span id="l92.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l92.16"></a><span id="l92.16"> };</span>
<a href="#l92.17"></a><span id="l92.17"> </span>
<a href="#l92.18"></a><span id="l92.18"> var testDailyRecurrence = function() {</span>
<a href="#l92.19"></a><span id="l92.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l92.20"></a><span id="l92.20" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l92.21"></a><span id="l92.21"> </span>
<a href="#l92.22"></a><span id="l92.22" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l92.23"></a><span id="l92.23" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l92.24"></a><span id="l92.24" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.25"></a><span id="l92.25" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l92.26"></a><span id="l92.26" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l92.27"></a><span id="l92.27" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.28"></a><span id="l92.28"> </span>
<a href="#l92.29"></a><span id="l92.29" class="difflineminus">-  // rotate view</span>
<a href="#l92.30"></a><span id="l92.30" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l92.31"></a><span id="l92.31" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l92.32"></a><span id="l92.32" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l92.33"></a><span id="l92.33" class="difflineminus">-    return view.orient == &quot;horizontal&quot;;</span>
<a href="#l92.34"></a><span id="l92.34" class="difflineminus">-  });</span>
<a href="#l92.35"></a><span id="l92.35" class="difflineminus">-</span>
<a href="#l92.36"></a><span id="l92.36" class="difflineminus">-  // create daily event</span>
<a href="#l92.37"></a><span id="l92.37" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l92.38"></a><span id="l92.38" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l92.39"></a><span id="l92.39" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l92.40"></a><span id="l92.40" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l92.41"></a><span id="l92.41" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l92.42"></a><span id="l92.42" class="difflineminus">-</span>
<a href="#l92.43"></a><span id="l92.43" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l92.44"></a><span id="l92.44" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l92.45"></a><span id="l92.45" class="difflineminus">-    &quot;daily&quot;);</span>
<a href="#l92.46"></a><span id="l92.46" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l92.47"></a><span id="l92.47" class="difflineplus">+    // rotate view</span>
<a href="#l92.48"></a><span id="l92.48" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l92.49"></a><span id="l92.49" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l92.50"></a><span id="l92.50" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l92.51"></a><span id="l92.51" class="difflineplus">+        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l92.52"></a><span id="l92.52" class="difflineplus">+    });</span>
<a href="#l92.53"></a><span id="l92.53"> </span>
<a href="#l92.54"></a><span id="l92.54" class="difflineminus">-  // check day view for 7 days</span>
<a href="#l92.55"></a><span id="l92.55" class="difflineminus">-  let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined) +</span>
<a href="#l92.56"></a><span id="l92.56" class="difflineminus">-    eventPath;</span>
<a href="#l92.57"></a><span id="l92.57" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l92.58"></a><span id="l92.58" class="difflineminus">-</span>
<a href="#l92.59"></a><span id="l92.59" class="difflineminus">-  for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l92.60"></a><span id="l92.60" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l92.61"></a><span id="l92.61" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l92.62"></a><span id="l92.62" class="difflineminus">-  }</span>
<a href="#l92.63"></a><span id="l92.63" class="difflineplus">+    // create daily event</span>
<a href="#l92.64"></a><span id="l92.64" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l92.65"></a><span id="l92.65" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l92.66"></a><span id="l92.66" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l92.67"></a><span id="l92.67" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l92.68"></a><span id="l92.68" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l92.69"></a><span id="l92.69"> </span>
<a href="#l92.70"></a><span id="l92.70" class="difflineminus">-  // check week view for 2 weeks</span>
<a href="#l92.71"></a><span id="l92.71" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l92.72"></a><span id="l92.72" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.73"></a><span id="l92.73" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l92.74"></a><span id="l92.74" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l92.75"></a><span id="l92.75" class="difflineplus">+      &quot;daily&quot;);</span>
<a href="#l92.76"></a><span id="l92.76" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l92.77"></a><span id="l92.77"> </span>
<a href="#l92.78"></a><span id="l92.78" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l92.79"></a><span id="l92.79" class="difflineminus">-    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l92.80"></a><span id="l92.80" class="difflineminus">-      eventPath;</span>
<a href="#l92.81"></a><span id="l92.81" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l92.82"></a><span id="l92.82" class="difflineminus">-  }</span>
<a href="#l92.83"></a><span id="l92.83" class="difflineminus">-</span>
<a href="#l92.84"></a><span id="l92.84" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l92.85"></a><span id="l92.85" class="difflineminus">-</span>
<a href="#l92.86"></a><span id="l92.86" class="difflineminus">-  for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l92.87"></a><span id="l92.87" class="difflineminus">-    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour) +</span>
<a href="#l92.88"></a><span id="l92.88" class="difflineplus">+    // check day view for 7 days</span>
<a href="#l92.89"></a><span id="l92.89" class="difflineplus">+    let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined) +</span>
<a href="#l92.90"></a><span id="l92.90">       eventPath;</span>
<a href="#l92.91"></a><span id="l92.91" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l92.92"></a><span id="l92.92" class="difflineminus">-  }</span>
<a href="#l92.93"></a><span id="l92.93" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l92.94"></a><span id="l92.94" class="difflineplus">+</span>
<a href="#l92.95"></a><span id="l92.95" class="difflineplus">+    for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l92.96"></a><span id="l92.96" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l92.97"></a><span id="l92.97" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l92.98"></a><span id="l92.98" class="difflineplus">+    }</span>
<a href="#l92.99"></a><span id="l92.99"> </span>
<a href="#l92.100"></a><span id="l92.100" class="difflineminus">-  // check multiweek view for 4 weeks</span>
<a href="#l92.101"></a><span id="l92.101" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l92.102"></a><span id="l92.102" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.103"></a><span id="l92.103" class="difflineplus">+    // check week view for 2 weeks</span>
<a href="#l92.104"></a><span id="l92.104" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l92.105"></a><span id="l92.105" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.106"></a><span id="l92.106" class="difflineplus">+</span>
<a href="#l92.107"></a><span id="l92.107" class="difflineplus">+    for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l92.108"></a><span id="l92.108" class="difflineplus">+        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l92.109"></a><span id="l92.109" class="difflineplus">+          eventPath;</span>
<a href="#l92.110"></a><span id="l92.110" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l92.111"></a><span id="l92.111" class="difflineplus">+    }</span>
<a href="#l92.112"></a><span id="l92.112"> </span>
<a href="#l92.113"></a><span id="l92.113" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l92.114"></a><span id="l92.114" class="difflineminus">-    let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l92.115"></a><span id="l92.115" class="difflineminus">-      eventPath;</span>
<a href="#l92.116"></a><span id="l92.116" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l92.117"></a><span id="l92.117" class="difflineminus">-  }</span>
<a href="#l92.118"></a><span id="l92.118" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l92.119"></a><span id="l92.119"> </span>
<a href="#l92.120"></a><span id="l92.120" class="difflineminus">-  for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l92.121"></a><span id="l92.121">     for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l92.122"></a><span id="l92.122" class="difflineminus">-      let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour) +</span>
<a href="#l92.123"></a><span id="l92.123" class="difflineminus">-        eventPath;</span>
<a href="#l92.124"></a><span id="l92.124" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l92.125"></a><span id="l92.125" class="difflineplus">+        let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour) +</span>
<a href="#l92.126"></a><span id="l92.126" class="difflineplus">+          eventPath;</span>
<a href="#l92.127"></a><span id="l92.127" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l92.128"></a><span id="l92.128">     }</span>
<a href="#l92.129"></a><span id="l92.129" class="difflineminus">-  }</span>
<a href="#l92.130"></a><span id="l92.130" class="difflineplus">+</span>
<a href="#l92.131"></a><span id="l92.131" class="difflineplus">+    // check multiweek view for 4 weeks</span>
<a href="#l92.132"></a><span id="l92.132" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l92.133"></a><span id="l92.133" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.134"></a><span id="l92.134"> </span>
<a href="#l92.135"></a><span id="l92.135" class="difflineminus">-  // check month view for all 5 weeks</span>
<a href="#l92.136"></a><span id="l92.136" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l92.137"></a><span id="l92.137" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.138"></a><span id="l92.138" class="difflineplus">+    for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l92.139"></a><span id="l92.139" class="difflineplus">+        let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour) +</span>
<a href="#l92.140"></a><span id="l92.140" class="difflineplus">+          eventPath;</span>
<a href="#l92.141"></a><span id="l92.141" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l92.142"></a><span id="l92.142" class="difflineplus">+    }</span>
<a href="#l92.143"></a><span id="l92.143"> </span>
<a href="#l92.144"></a><span id="l92.144" class="difflineminus">-  for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l92.145"></a><span id="l92.145" class="difflineminus">-    let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined) +</span>
<a href="#l92.146"></a><span id="l92.146" class="difflineminus">-      eventPath;</span>
<a href="#l92.147"></a><span id="l92.147" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l92.148"></a><span id="l92.148" class="difflineminus">-  }</span>
<a href="#l92.149"></a><span id="l92.149" class="difflineplus">+    for (let week = 2; week &lt;= 4; week++) {</span>
<a href="#l92.150"></a><span id="l92.150" class="difflineplus">+        for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l92.151"></a><span id="l92.151" class="difflineplus">+            let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour) +</span>
<a href="#l92.152"></a><span id="l92.152" class="difflineplus">+              eventPath;</span>
<a href="#l92.153"></a><span id="l92.153" class="difflineplus">+            controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l92.154"></a><span id="l92.154" class="difflineplus">+        }</span>
<a href="#l92.155"></a><span id="l92.155" class="difflineplus">+    }</span>
<a href="#l92.156"></a><span id="l92.156"> </span>
<a href="#l92.157"></a><span id="l92.157" class="difflineminus">-  for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l92.158"></a><span id="l92.158" class="difflineminus">-    for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l92.159"></a><span id="l92.159" class="difflineminus">-      let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined) +</span>
<a href="#l92.160"></a><span id="l92.160" class="difflineminus">-        eventPath;</span>
<a href="#l92.161"></a><span id="l92.161" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l92.162"></a><span id="l92.162" class="difflineplus">+    // check month view for all 5 weeks</span>
<a href="#l92.163"></a><span id="l92.163" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l92.164"></a><span id="l92.164" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.165"></a><span id="l92.165" class="difflineplus">+</span>
<a href="#l92.166"></a><span id="l92.166" class="difflineplus">+    for (let day = 5; day &lt;= 7; day++) {</span>
<a href="#l92.167"></a><span id="l92.167" class="difflineplus">+        let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined) +</span>
<a href="#l92.168"></a><span id="l92.168" class="difflineplus">+          eventPath;</span>
<a href="#l92.169"></a><span id="l92.169" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l92.170"></a><span id="l92.170">     }</span>
<a href="#l92.171"></a><span id="l92.171" class="difflineminus">-  }</span>
<a href="#l92.172"></a><span id="l92.172" class="difflineplus">+</span>
<a href="#l92.173"></a><span id="l92.173" class="difflineplus">+    for (let week = 2; week &lt;= 5; week++) {</span>
<a href="#l92.174"></a><span id="l92.174" class="difflineplus">+        for (let day = 1; day &lt;= 7; day++) {</span>
<a href="#l92.175"></a><span id="l92.175" class="difflineplus">+            let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined) +</span>
<a href="#l92.176"></a><span id="l92.176" class="difflineplus">+              eventPath;</span>
<a href="#l92.177"></a><span id="l92.177" class="difflineplus">+            controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l92.178"></a><span id="l92.178" class="difflineplus">+        }</span>
<a href="#l92.179"></a><span id="l92.179" class="difflineplus">+    }</span>
<a href="#l92.180"></a><span id="l92.180"> </span>
<a href="#l92.181"></a><span id="l92.181" class="difflineminus">-  // delete 3rd January occurrence</span>
<a href="#l92.182"></a><span id="l92.182" class="difflineminus">-  let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l92.183"></a><span id="l92.183" class="difflineminus">-    eventPath;</span>
<a href="#l92.184"></a><span id="l92.184" class="difflineminus">-  calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l92.185"></a><span id="l92.185" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.186"></a><span id="l92.186" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l92.187"></a><span id="l92.187" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l92.188"></a><span id="l92.188" class="difflineplus">+    // delete 3rd January occurrence</span>
<a href="#l92.189"></a><span id="l92.189" class="difflineplus">+    let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l92.190"></a><span id="l92.190" class="difflineplus">+      eventPath;</span>
<a href="#l92.191"></a><span id="l92.191" class="difflineplus">+    calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l92.192"></a><span id="l92.192" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.193"></a><span id="l92.193" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l92.194"></a><span id="l92.194" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l92.195"></a><span id="l92.195"> </span>
<a href="#l92.196"></a><span id="l92.196" class="difflineminus">-  // verify in all views</span>
<a href="#l92.197"></a><span id="l92.197" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.198"></a><span id="l92.198" class="difflineplus">+    // verify in all views</span>
<a href="#l92.199"></a><span id="l92.199" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.200"></a><span id="l92.200"> </span>
<a href="#l92.201"></a><span id="l92.201" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l92.202"></a><span id="l92.202" class="difflineminus">-  saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l92.203"></a><span id="l92.203" class="difflineminus">-    eventPath;</span>
<a href="#l92.204"></a><span id="l92.204" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.205"></a><span id="l92.205" class="difflineminus">-</span>
<a href="#l92.206"></a><span id="l92.206" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l92.207"></a><span id="l92.207" class="difflineminus">-  saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l92.208"></a><span id="l92.208" class="difflineminus">-    eventPath;</span>
<a href="#l92.209"></a><span id="l92.209" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.210"></a><span id="l92.210" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l92.211"></a><span id="l92.211" class="difflineplus">+    saturday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, 7, undefined) +</span>
<a href="#l92.212"></a><span id="l92.212" class="difflineplus">+      eventPath;</span>
<a href="#l92.213"></a><span id="l92.213" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.214"></a><span id="l92.214"> </span>
<a href="#l92.215"></a><span id="l92.215" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l92.216"></a><span id="l92.216" class="difflineminus">-  saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l92.217"></a><span id="l92.217" class="difflineminus">-    eventPath;</span>
<a href="#l92.218"></a><span id="l92.218" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.219"></a><span id="l92.219" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l92.220"></a><span id="l92.220" class="difflineplus">+    saturday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l92.221"></a><span id="l92.221" class="difflineplus">+      eventPath;</span>
<a href="#l92.222"></a><span id="l92.222" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.223"></a><span id="l92.223"> </span>
<a href="#l92.224"></a><span id="l92.224" class="difflineminus">-  // go to previous day to edit event to occur only on weekdays</span>
<a href="#l92.225"></a><span id="l92.225" class="difflineminus">-  calUtils.back(controller, 1);</span>
<a href="#l92.226"></a><span id="l92.226" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l92.227"></a><span id="l92.227" class="difflineplus">+    saturday = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l92.228"></a><span id="l92.228" class="difflineplus">+      eventPath;</span>
<a href="#l92.229"></a><span id="l92.229" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l92.230"></a><span id="l92.230"> </span>
<a href="#l92.231"></a><span id="l92.231" class="difflineminus">-  calUtils.handleParentModification(controller, false);</span>
<a href="#l92.232"></a><span id="l92.232" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l92.233"></a><span id="l92.233" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l92.234"></a><span id="l92.234" class="difflineminus">-      eventPath));</span>
<a href="#l92.235"></a><span id="l92.235" class="difflineplus">+    // go to previous day to edit event to occur only on weekdays</span>
<a href="#l92.236"></a><span id="l92.236" class="difflineplus">+    calUtils.back(controller, 1);</span>
<a href="#l92.237"></a><span id="l92.237"> </span>
<a href="#l92.238"></a><span id="l92.238" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l92.239"></a><span id="l92.239" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l92.240"></a><span id="l92.240" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l92.241"></a><span id="l92.241" class="difflineplus">+    calUtils.handleParentModification(controller, false);</span>
<a href="#l92.242"></a><span id="l92.242" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l92.243"></a><span id="l92.243" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l92.244"></a><span id="l92.244" class="difflineplus">+        eventPath));</span>
<a href="#l92.245"></a><span id="l92.245"> </span>
<a href="#l92.246"></a><span id="l92.246" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l92.247"></a><span id="l92.247" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l92.248"></a><span id="l92.248" class="difflineminus">-    &quot;every.weekday&quot;);</span>
<a href="#l92.249"></a><span id="l92.249" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l92.250"></a><span id="l92.250" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l92.251"></a><span id="l92.251" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l92.252"></a><span id="l92.252" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l92.253"></a><span id="l92.253" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l92.254"></a><span id="l92.254"> </span>
<a href="#l92.255"></a><span id="l92.255" class="difflineminus">-  // check day view for 7 days</span>
<a href="#l92.256"></a><span id="l92.256" class="difflineminus">-  let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l92.257"></a><span id="l92.257" class="difflineminus">-    eventPath;</span>
<a href="#l92.258"></a><span id="l92.258" class="difflineminus">-  let dates = [[2009, 1, 3],</span>
<a href="#l92.259"></a><span id="l92.259" class="difflineminus">-               [2009, 1, 4]];</span>
<a href="#l92.260"></a><span id="l92.260" class="difflineminus">-  for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l92.261"></a><span id="l92.261" class="difflineminus">-    calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l92.262"></a><span id="l92.262" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l92.263"></a><span id="l92.263" class="difflineminus">-  }</span>
<a href="#l92.264"></a><span id="l92.264" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l92.265"></a><span id="l92.265" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l92.266"></a><span id="l92.266" class="difflineplus">+      &quot;every.weekday&quot;);</span>
<a href="#l92.267"></a><span id="l92.267" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l92.268"></a><span id="l92.268" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l92.269"></a><span id="l92.269"> </span>
<a href="#l92.270"></a><span id="l92.270" class="difflineminus">-  // check week view for 2 weeks</span>
<a href="#l92.271"></a><span id="l92.271" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l92.272"></a><span id="l92.272" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.273"></a><span id="l92.273" class="difflineminus">-</span>
<a href="#l92.274"></a><span id="l92.274" class="difflineminus">-  for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l92.275"></a><span id="l92.275" class="difflineminus">-    let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l92.276"></a><span id="l92.276" class="difflineplus">+    // check day view for 7 days</span>
<a href="#l92.277"></a><span id="l92.277" class="difflineplus">+    let day = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l92.278"></a><span id="l92.278">       eventPath;</span>
<a href="#l92.279"></a><span id="l92.279" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l92.280"></a><span id="l92.280" class="difflineminus">-    weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l92.281"></a><span id="l92.281" class="difflineminus">-      eventPath;</span>
<a href="#l92.282"></a><span id="l92.282" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l92.283"></a><span id="l92.283" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l92.284"></a><span id="l92.284" class="difflineminus">-  }</span>
<a href="#l92.285"></a><span id="l92.285" class="difflineplus">+    let dates = [[2009, 1, 3],</span>
<a href="#l92.286"></a><span id="l92.286" class="difflineplus">+                 [2009, 1, 4]];</span>
<a href="#l92.287"></a><span id="l92.287" class="difflineplus">+    for (let i = 0; i &lt; dates.length; i++) {</span>
<a href="#l92.288"></a><span id="l92.288" class="difflineplus">+        calUtils.goToDate(controller, dates[i][0], dates[i][1], dates[i][2]);</span>
<a href="#l92.289"></a><span id="l92.289" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l92.290"></a><span id="l92.290" class="difflineplus">+    }</span>
<a href="#l92.291"></a><span id="l92.291"> </span>
<a href="#l92.292"></a><span id="l92.292" class="difflineminus">-  // check multiweek view for 4 weeks</span>
<a href="#l92.293"></a><span id="l92.293" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l92.294"></a><span id="l92.294" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.295"></a><span id="l92.295" class="difflineplus">+    // check week view for 2 weeks</span>
<a href="#l92.296"></a><span id="l92.296" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l92.297"></a><span id="l92.297" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.298"></a><span id="l92.298"> </span>
<a href="#l92.299"></a><span id="l92.299" class="difflineminus">-  for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l92.300"></a><span id="l92.300" class="difflineminus">-    let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l92.301"></a><span id="l92.301" class="difflineminus">-      eventPath;</span>
<a href="#l92.302"></a><span id="l92.302" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l92.303"></a><span id="l92.303" class="difflineminus">-    mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l92.304"></a><span id="l92.304" class="difflineminus">-      eventPath;</span>
<a href="#l92.305"></a><span id="l92.305" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l92.306"></a><span id="l92.306" class="difflineminus">-  }</span>
<a href="#l92.307"></a><span id="l92.307" class="difflineplus">+    for (let i = 0; i &lt;= 1; i++) {</span>
<a href="#l92.308"></a><span id="l92.308" class="difflineplus">+        let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined) +</span>
<a href="#l92.309"></a><span id="l92.309" class="difflineplus">+          eventPath;</span>
<a href="#l92.310"></a><span id="l92.310" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l92.311"></a><span id="l92.311" class="difflineplus">+        weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined) +</span>
<a href="#l92.312"></a><span id="l92.312" class="difflineplus">+          eventPath;</span>
<a href="#l92.313"></a><span id="l92.313" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l92.314"></a><span id="l92.314" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l92.315"></a><span id="l92.315" class="difflineplus">+    }</span>
<a href="#l92.316"></a><span id="l92.316"> </span>
<a href="#l92.317"></a><span id="l92.317" class="difflineminus">-  // check month view for all 5 weeks</span>
<a href="#l92.318"></a><span id="l92.318" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l92.319"></a><span id="l92.319" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.320"></a><span id="l92.320" class="difflineplus">+    // check multiweek view for 4 weeks</span>
<a href="#l92.321"></a><span id="l92.321" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l92.322"></a><span id="l92.322" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.323"></a><span id="l92.323"> </span>
<a href="#l92.324"></a><span id="l92.324" class="difflineminus">-  for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l92.325"></a><span id="l92.325" class="difflineminus">-    let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l92.326"></a><span id="l92.326" class="difflineminus">-      eventPath;</span>
<a href="#l92.327"></a><span id="l92.327" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l92.328"></a><span id="l92.328" class="difflineminus">-    mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l92.329"></a><span id="l92.329" class="difflineminus">-      eventPath;</span>
<a href="#l92.330"></a><span id="l92.330" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l92.331"></a><span id="l92.331" class="difflineminus">-  }</span>
<a href="#l92.332"></a><span id="l92.332" class="difflineplus">+    for (let i = 1; i &lt;= 4; i++) {</span>
<a href="#l92.333"></a><span id="l92.333" class="difflineplus">+        let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l92.334"></a><span id="l92.334" class="difflineplus">+          eventPath;</span>
<a href="#l92.335"></a><span id="l92.335" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l92.336"></a><span id="l92.336" class="difflineplus">+        mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l92.337"></a><span id="l92.337" class="difflineplus">+          eventPath;</span>
<a href="#l92.338"></a><span id="l92.338" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l92.339"></a><span id="l92.339" class="difflineplus">+    }</span>
<a href="#l92.340"></a><span id="l92.340" class="difflineplus">+</span>
<a href="#l92.341"></a><span id="l92.341" class="difflineplus">+    // check month view for all 5 weeks</span>
<a href="#l92.342"></a><span id="l92.342" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l92.343"></a><span id="l92.343" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l92.344"></a><span id="l92.344"> </span>
<a href="#l92.345"></a><span id="l92.345" class="difflineminus">-  // delete event</span>
<a href="#l92.346"></a><span id="l92.346" class="difflineminus">-  day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined) +</span>
<a href="#l92.347"></a><span id="l92.347" class="difflineminus">-    eventPath;</span>
<a href="#l92.348"></a><span id="l92.348" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l92.349"></a><span id="l92.349" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l92.350"></a><span id="l92.350" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l92.351"></a><span id="l92.351" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l92.352"></a><span id="l92.352" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l92.353"></a><span id="l92.353" class="difflineplus">+    for (let i = 1; i &lt;= 5; i++) {</span>
<a href="#l92.354"></a><span id="l92.354" class="difflineplus">+        let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined) +</span>
<a href="#l92.355"></a><span id="l92.355" class="difflineplus">+          eventPath;</span>
<a href="#l92.356"></a><span id="l92.356" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l92.357"></a><span id="l92.357" class="difflineplus">+        mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined) +</span>
<a href="#l92.358"></a><span id="l92.358" class="difflineplus">+          eventPath;</span>
<a href="#l92.359"></a><span id="l92.359" class="difflineplus">+        controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l92.360"></a><span id="l92.360" class="difflineplus">+    }</span>
<a href="#l92.361"></a><span id="l92.361"> </span>
<a href="#l92.362"></a><span id="l92.362" class="difflineminus">-  // reset view</span>
<a href="#l92.363"></a><span id="l92.363" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l92.364"></a><span id="l92.364" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l92.365"></a><span id="l92.365" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l92.366"></a><span id="l92.366" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l92.367"></a><span id="l92.367" class="difflineminus">-    return view.orient == &quot;vertical&quot;;</span>
<a href="#l92.368"></a><span id="l92.368" class="difflineminus">-  });</span>
<a href="#l92.369"></a><span id="l92.369" class="difflineplus">+    // delete event</span>
<a href="#l92.370"></a><span id="l92.370" class="difflineplus">+    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined) +</span>
<a href="#l92.371"></a><span id="l92.371" class="difflineplus">+      eventPath;</span>
<a href="#l92.372"></a><span id="l92.372" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l92.373"></a><span id="l92.373" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l92.374"></a><span id="l92.374" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l92.375"></a><span id="l92.375" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l92.376"></a><span id="l92.376" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l92.377"></a><span id="l92.377" class="difflineplus">+</span>
<a href="#l92.378"></a><span id="l92.378" class="difflineplus">+    // reset view</span>
<a href="#l92.379"></a><span id="l92.379" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l92.380"></a><span id="l92.380" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l92.381"></a><span id="l92.381" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l92.382"></a><span id="l92.382" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l92.383"></a><span id="l92.383" class="difflineplus">+        return view.orient == &quot;vertical&quot;;</span>
<a href="#l92.384"></a><span id="l92.384" class="difflineplus">+    });</span>
<a href="#l92.385"></a><span id="l92.385"> };</span>
<a href="#l92.386"></a><span id="l92.386"> </span>
<a href="#l92.387"></a><span id="l92.387"> var teardownTest = function(module) {</span>
<a href="#l92.388"></a><span id="l92.388" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l92.389"></a><span id="l92.389" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l92.390"></a><span id="l92.390"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testLastDayOfMonthRecurrence.js</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -5,135 +5,135 @@</span>
<a href="#l93.4"></a><span id="l93.4"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l93.5"></a><span id="l93.5"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l93.6"></a><span id="l93.6"> </span>
<a href="#l93.7"></a><span id="l93.7"> var sleep = 500;</span>
<a href="#l93.8"></a><span id="l93.8"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l93.9"></a><span id="l93.9"> var hour = 8;</span>
<a href="#l93.10"></a><span id="l93.10"> </span>
<a href="#l93.11"></a><span id="l93.11"> var setupModule = function(module) {</span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l93.13"></a><span id="l93.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l93.14"></a><span id="l93.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l93.15"></a><span id="l93.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l93.16"></a><span id="l93.16"> };</span>
<a href="#l93.17"></a><span id="l93.17"> </span>
<a href="#l93.18"></a><span id="l93.18"> var testLastDayOfMonthRecurrence = function() {</span>
<a href="#l93.19"></a><span id="l93.19" class="difflineminus">-  let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l93.20"></a><span id="l93.20" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l93.21"></a><span id="l93.21" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l93.22"></a><span id="l93.22" class="difflineminus">-  calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l93.23"></a><span id="l93.23" class="difflineplus">+    let eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l93.24"></a><span id="l93.24" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l93.25"></a><span id="l93.25" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l93.26"></a><span id="l93.26" class="difflineplus">+    calUtils.goToDate(controller, 2008, 1, 31); // start with a leap year</span>
<a href="#l93.27"></a><span id="l93.27"> </span>
<a href="#l93.28"></a><span id="l93.28" class="difflineminus">-  // rotate view</span>
<a href="#l93.29"></a><span id="l93.29" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l93.30"></a><span id="l93.30" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l93.31"></a><span id="l93.31" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l93.32"></a><span id="l93.32" class="difflineminus">-    return view.orient == &quot;horizontal&quot;;</span>
<a href="#l93.33"></a><span id="l93.33" class="difflineminus">-  });</span>
<a href="#l93.34"></a><span id="l93.34" class="difflineplus">+    // rotate view</span>
<a href="#l93.35"></a><span id="l93.35" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l93.36"></a><span id="l93.36" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l93.37"></a><span id="l93.37" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l93.38"></a><span id="l93.38" class="difflineplus">+        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l93.39"></a><span id="l93.39" class="difflineplus">+    });</span>
<a href="#l93.40"></a><span id="l93.40"> </span>
<a href="#l93.41"></a><span id="l93.41" class="difflineminus">-  // create monthly recurring event</span>
<a href="#l93.42"></a><span id="l93.42" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l93.43"></a><span id="l93.43" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l93.44"></a><span id="l93.44" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l93.45"></a><span id="l93.45" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l93.46"></a><span id="l93.46" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l93.47"></a><span id="l93.47" class="difflineplus">+    // create monthly recurring event</span>
<a href="#l93.48"></a><span id="l93.48" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l93.49"></a><span id="l93.49" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l93.50"></a><span id="l93.50" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l93.51"></a><span id="l93.51" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l93.52"></a><span id="l93.52" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l93.53"></a><span id="l93.53"> </span>
<a href="#l93.54"></a><span id="l93.54" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l93.55"></a><span id="l93.55" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l93.56"></a><span id="l93.56" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l93.57"></a><span id="l93.57" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l93.58"></a><span id="l93.58" class="difflineminus">-    &quot;custom&quot;);</span>
<a href="#l93.59"></a><span id="l93.59" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l93.60"></a><span id="l93.60" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l93.61"></a><span id="l93.61" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l93.62"></a><span id="l93.62" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l93.63"></a><span id="l93.63" class="difflineplus">+      &quot;custom&quot;);</span>
<a href="#l93.64"></a><span id="l93.64"> </span>
<a href="#l93.65"></a><span id="l93.65" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l93.66"></a><span id="l93.66" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l93.67"></a><span id="l93.67" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l93.68"></a><span id="l93.68" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l93.69"></a><span id="l93.69"> </span>
<a href="#l93.70"></a><span id="l93.70" class="difflineminus">-  //                      date      correct row in month view</span>
<a href="#l93.71"></a><span id="l93.71" class="difflineminus">-  //                   vvvvvvvvvvv  v</span>
<a href="#l93.72"></a><span id="l93.72" class="difflineminus">-  let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l93.73"></a><span id="l93.73" class="difflineminus">-                      [2008, 2, 29, 5],</span>
<a href="#l93.74"></a><span id="l93.74" class="difflineminus">-                      [2008, 3, 31, 6],</span>
<a href="#l93.75"></a><span id="l93.75" class="difflineminus">-                      [2008, 4, 30, 5],</span>
<a href="#l93.76"></a><span id="l93.76" class="difflineminus">-                      [2008, 5, 31, 5],</span>
<a href="#l93.77"></a><span id="l93.77" class="difflineminus">-                      [2008, 6, 30, 5],</span>
<a href="#l93.78"></a><span id="l93.78" class="difflineminus">-                      [2008, 7, 31, 5],</span>
<a href="#l93.79"></a><span id="l93.79" class="difflineminus">-                      [2008, 8, 31, 6],</span>
<a href="#l93.80"></a><span id="l93.80" class="difflineminus">-                      [2008, 9, 30, 5],</span>
<a href="#l93.81"></a><span id="l93.81" class="difflineminus">-                      [2008, 10, 31, 5],</span>
<a href="#l93.82"></a><span id="l93.82" class="difflineminus">-                      [2008, 11, 30, 6],</span>
<a href="#l93.83"></a><span id="l93.83" class="difflineminus">-                      [2008, 12, 31, 5],</span>
<a href="#l93.84"></a><span id="l93.84" class="difflineminus">-                      [2009, 1, 31, 5],</span>
<a href="#l93.85"></a><span id="l93.85" class="difflineminus">-                      [2009, 2, 28, 4],</span>
<a href="#l93.86"></a><span id="l93.86" class="difflineminus">-                      [2009, 3, 31, 5]];</span>
<a href="#l93.87"></a><span id="l93.87" class="difflineminus">-  let box = &quot;&quot;;</span>
<a href="#l93.88"></a><span id="l93.88" class="difflineplus">+    //                      date      correct row in month view</span>
<a href="#l93.89"></a><span id="l93.89" class="difflineplus">+    //                   vvvvvvvvvvv  v</span>
<a href="#l93.90"></a><span id="l93.90" class="difflineplus">+    let checkingData = [[2008, 1, 31, 5],</span>
<a href="#l93.91"></a><span id="l93.91" class="difflineplus">+                        [2008, 2, 29, 5],</span>
<a href="#l93.92"></a><span id="l93.92" class="difflineplus">+                        [2008, 3, 31, 6],</span>
<a href="#l93.93"></a><span id="l93.93" class="difflineplus">+                        [2008, 4, 30, 5],</span>
<a href="#l93.94"></a><span id="l93.94" class="difflineplus">+                        [2008, 5, 31, 5],</span>
<a href="#l93.95"></a><span id="l93.95" class="difflineplus">+                        [2008, 6, 30, 5],</span>
<a href="#l93.96"></a><span id="l93.96" class="difflineplus">+                        [2008, 7, 31, 5],</span>
<a href="#l93.97"></a><span id="l93.97" class="difflineplus">+                        [2008, 8, 31, 6],</span>
<a href="#l93.98"></a><span id="l93.98" class="difflineplus">+                        [2008, 9, 30, 5],</span>
<a href="#l93.99"></a><span id="l93.99" class="difflineplus">+                        [2008, 10, 31, 5],</span>
<a href="#l93.100"></a><span id="l93.100" class="difflineplus">+                        [2008, 11, 30, 6],</span>
<a href="#l93.101"></a><span id="l93.101" class="difflineplus">+                        [2008, 12, 31, 5],</span>
<a href="#l93.102"></a><span id="l93.102" class="difflineplus">+                        [2009, 1, 31, 5],</span>
<a href="#l93.103"></a><span id="l93.103" class="difflineplus">+                        [2009, 2, 28, 4],</span>
<a href="#l93.104"></a><span id="l93.104" class="difflineplus">+                        [2009, 3, 31, 5]];</span>
<a href="#l93.105"></a><span id="l93.105" class="difflineplus">+    let box = &quot;&quot;;</span>
<a href="#l93.106"></a><span id="l93.106"> </span>
<a href="#l93.107"></a><span id="l93.107" class="difflineminus">-  // check all dates</span>
<a href="#l93.108"></a><span id="l93.108" class="difflineminus">-  for (let i = 0; i &lt; checkingData.length; i++) {</span>
<a href="#l93.109"></a><span id="l93.109" class="difflineminus">-    calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l93.110"></a><span id="l93.110" class="difflineplus">+    // check all dates</span>
<a href="#l93.111"></a><span id="l93.111" class="difflineplus">+    for (let i = 0; i &lt; checkingData.length; i++) {</span>
<a href="#l93.112"></a><span id="l93.112" class="difflineplus">+        calUtils.goToDate(controller, checkingData[i][0], checkingData[i][1], checkingData[i][2]);</span>
<a href="#l93.113"></a><span id="l93.113"> </span>
<a href="#l93.114"></a><span id="l93.114" class="difflineminus">-    // day view</span>
<a href="#l93.115"></a><span id="l93.115" class="difflineminus">-    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l93.116"></a><span id="l93.116" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l93.117"></a><span id="l93.117" class="difflineminus">-      eventPath;</span>
<a href="#l93.118"></a><span id="l93.118" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.119"></a><span id="l93.119" class="difflineplus">+        // day view</span>
<a href="#l93.120"></a><span id="l93.120" class="difflineplus">+        calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l93.121"></a><span id="l93.121" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l93.122"></a><span id="l93.122" class="difflineplus">+          eventPath;</span>
<a href="#l93.123"></a><span id="l93.123" class="difflineplus">+        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.124"></a><span id="l93.124"> </span>
<a href="#l93.125"></a><span id="l93.125" class="difflineminus">-    // week view</span>
<a href="#l93.126"></a><span id="l93.126" class="difflineminus">-    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l93.127"></a><span id="l93.127" class="difflineminus">-    let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l93.128"></a><span id="l93.128" class="difflineminus">-    let column = date.getDay() + 1;</span>
<a href="#l93.129"></a><span id="l93.129" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour) +</span>
<a href="#l93.130"></a><span id="l93.130" class="difflineminus">-      eventPath;</span>
<a href="#l93.131"></a><span id="l93.131" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.132"></a><span id="l93.132" class="difflineplus">+        // week view</span>
<a href="#l93.133"></a><span id="l93.133" class="difflineplus">+        calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l93.134"></a><span id="l93.134" class="difflineplus">+        let date = new Date(checkingData[i][0], checkingData[i][1] - 1, checkingData[i][2]);</span>
<a href="#l93.135"></a><span id="l93.135" class="difflineplus">+        let column = date.getDay() + 1;</span>
<a href="#l93.136"></a><span id="l93.136" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, column, hour) +</span>
<a href="#l93.137"></a><span id="l93.137" class="difflineplus">+          eventPath;</span>
<a href="#l93.138"></a><span id="l93.138" class="difflineplus">+        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.139"></a><span id="l93.139"> </span>
<a href="#l93.140"></a><span id="l93.140" class="difflineminus">-    // multiweek view</span>
<a href="#l93.141"></a><span id="l93.141" class="difflineminus">-    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l93.142"></a><span id="l93.142" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined) +</span>
<a href="#l93.143"></a><span id="l93.143" class="difflineminus">-      eventPath;</span>
<a href="#l93.144"></a><span id="l93.144" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.145"></a><span id="l93.145" class="difflineplus">+        // multiweek view</span>
<a href="#l93.146"></a><span id="l93.146" class="difflineplus">+        calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l93.147"></a><span id="l93.147" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, column, undefined) +</span>
<a href="#l93.148"></a><span id="l93.148" class="difflineplus">+          eventPath;</span>
<a href="#l93.149"></a><span id="l93.149" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.150"></a><span id="l93.150"> </span>
<a href="#l93.151"></a><span id="l93.151" class="difflineminus">-    // month view</span>
<a href="#l93.152"></a><span id="l93.152" class="difflineminus">-    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l93.153"></a><span id="l93.153" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l93.154"></a><span id="l93.154" class="difflineminus">-      column, undefined) + eventPath;</span>
<a href="#l93.155"></a><span id="l93.155" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.156"></a><span id="l93.156" class="difflineminus">-  }</span>
<a href="#l93.157"></a><span id="l93.157" class="difflineplus">+        // month view</span>
<a href="#l93.158"></a><span id="l93.158" class="difflineplus">+        calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l93.159"></a><span id="l93.159" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, checkingData[i][3],</span>
<a href="#l93.160"></a><span id="l93.160" class="difflineplus">+          column, undefined) + eventPath;</span>
<a href="#l93.161"></a><span id="l93.161" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.162"></a><span id="l93.162" class="difflineplus">+    }</span>
<a href="#l93.163"></a><span id="l93.163"> </span>
<a href="#l93.164"></a><span id="l93.164" class="difflineminus">-  // delete event</span>
<a href="#l93.165"></a><span id="l93.165" class="difflineminus">-  calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l93.166"></a><span id="l93.166" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l93.167"></a><span id="l93.167" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l93.168"></a><span id="l93.168" class="difflineminus">-    undefined, 1, hour) + eventPath;</span>
<a href="#l93.169"></a><span id="l93.169" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l93.170"></a><span id="l93.170" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.171"></a><span id="l93.171" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l93.172"></a><span id="l93.172" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l93.173"></a><span id="l93.173" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.174"></a><span id="l93.174" class="difflineplus">+    // delete event</span>
<a href="#l93.175"></a><span id="l93.175" class="difflineplus">+    calUtils.goToDate(controller, checkingData[0][0], checkingData[0][1], checkingData[0][2]);</span>
<a href="#l93.176"></a><span id="l93.176" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l93.177"></a><span id="l93.177" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX,</span>
<a href="#l93.178"></a><span id="l93.178" class="difflineplus">+      undefined, 1, hour) + eventPath;</span>
<a href="#l93.179"></a><span id="l93.179" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l93.180"></a><span id="l93.180" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.181"></a><span id="l93.181" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l93.182"></a><span id="l93.182" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l93.183"></a><span id="l93.183" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l93.184"></a><span id="l93.184"> </span>
<a href="#l93.185"></a><span id="l93.185" class="difflineminus">-  // reset view</span>
<a href="#l93.186"></a><span id="l93.186" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l93.187"></a><span id="l93.187" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l93.188"></a><span id="l93.188" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l93.189"></a><span id="l93.189" class="difflineminus">-    return view.orient == &quot;vertical&quot;;</span>
<a href="#l93.190"></a><span id="l93.190" class="difflineminus">-  });</span>
<a href="#l93.191"></a><span id="l93.191" class="difflineplus">+    // reset view</span>
<a href="#l93.192"></a><span id="l93.192" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l93.193"></a><span id="l93.193" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l93.194"></a><span id="l93.194" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l93.195"></a><span id="l93.195" class="difflineplus">+        return view.orient == &quot;vertical&quot;;</span>
<a href="#l93.196"></a><span id="l93.196" class="difflineplus">+    });</span>
<a href="#l93.197"></a><span id="l93.197"> };</span>
<a href="#l93.198"></a><span id="l93.198"> </span>
<a href="#l93.199"></a><span id="l93.199"> function setRecurrence(recurrence) {</span>
<a href="#l93.200"></a><span id="l93.200" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l93.201"></a><span id="l93.201" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l93.202"></a><span id="l93.202"> </span>
<a href="#l93.203"></a><span id="l93.203" class="difflineminus">-  // monthly</span>
<a href="#l93.204"></a><span id="l93.204" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l93.205"></a><span id="l93.205" class="difflineminus">-    undefined, &quot;2&quot;);</span>
<a href="#l93.206"></a><span id="l93.206" class="difflineplus">+    // monthly</span>
<a href="#l93.207"></a><span id="l93.207" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined,</span>
<a href="#l93.208"></a><span id="l93.208" class="difflineplus">+      undefined, &quot;2&quot;);</span>
<a href="#l93.209"></a><span id="l93.209"> </span>
<a href="#l93.210"></a><span id="l93.210" class="difflineminus">-  // last day of month</span>
<a href="#l93.211"></a><span id="l93.211" class="difflineminus">-  recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l93.212"></a><span id="l93.212" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l93.213"></a><span id="l93.213" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l93.214"></a><span id="l93.214" class="difflineminus">-    undefined, &quot;-1&quot;);</span>
<a href="#l93.215"></a><span id="l93.215" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l93.216"></a><span id="l93.216" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l93.217"></a><span id="l93.217" class="difflineminus">-    undefined, &quot;-1&quot;);</span>
<a href="#l93.218"></a><span id="l93.218" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l93.219"></a><span id="l93.219" class="difflineplus">+    // last day of month</span>
<a href="#l93.220"></a><span id="l93.220" class="difflineplus">+    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;montly-period-relative-date-radio&quot;));</span>
<a href="#l93.221"></a><span id="l93.221" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l93.222"></a><span id="l93.222" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-ordinal&quot;), undefined,</span>
<a href="#l93.223"></a><span id="l93.223" class="difflineplus">+      undefined, &quot;-1&quot;);</span>
<a href="#l93.224"></a><span id="l93.224" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l93.225"></a><span id="l93.225" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;monthly-weekday&quot;), undefined,</span>
<a href="#l93.226"></a><span id="l93.226" class="difflineplus">+      undefined, &quot;-1&quot;);</span>
<a href="#l93.227"></a><span id="l93.227" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l93.228"></a><span id="l93.228"> </span>
<a href="#l93.229"></a><span id="l93.229" class="difflineminus">-  // close dialog</span>
<a href="#l93.230"></a><span id="l93.230" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l93.231"></a><span id="l93.231" class="difflineminus">-    '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l93.232"></a><span id="l93.232" class="difflineplus">+    // close dialog</span>
<a href="#l93.233"></a><span id="l93.233" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document,</span>
<a href="#l93.234"></a><span id="l93.234" class="difflineplus">+      '/id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l93.235"></a><span id="l93.235"> }</span>
<a href="#l93.236"></a><span id="l93.236"> </span>
<a href="#l93.237"></a><span id="l93.237"> var teardownTest = function(module) {</span>
<a href="#l93.238"></a><span id="l93.238" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l93.239"></a><span id="l93.239" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l93.240"></a><span id="l93.240"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyNRecurrence.js</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -7,154 +7,154 @@ var modalDialog = require(&quot;../shared-mod</span>
<a href="#l94.4"></a><span id="l94.4"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l94.5"></a><span id="l94.5"> </span>
<a href="#l94.6"></a><span id="l94.6"> var sleep = 500;</span>
<a href="#l94.7"></a><span id="l94.7"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l94.8"></a><span id="l94.8"> var hour = 8;</span>
<a href="#l94.9"></a><span id="l94.9"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l94.10"></a><span id="l94.10"> </span>
<a href="#l94.11"></a><span id="l94.11"> var setupModule = function(module) {</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l94.14"></a><span id="l94.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l94.15"></a><span id="l94.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l94.16"></a><span id="l94.16"> };</span>
<a href="#l94.17"></a><span id="l94.17"> </span>
<a href="#l94.18"></a><span id="l94.18"> var testWeeklyNRecurrence = function() {</span>
<a href="#l94.19"></a><span id="l94.19" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l94.20"></a><span id="l94.20" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l94.21"></a><span id="l94.21" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l94.22"></a><span id="l94.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l94.23"></a><span id="l94.23" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l94.24"></a><span id="l94.24" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l94.25"></a><span id="l94.25"> </span>
<a href="#l94.26"></a><span id="l94.26" class="difflineminus">-  // rotate view</span>
<a href="#l94.27"></a><span id="l94.27" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l94.28"></a><span id="l94.28" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l94.29"></a><span id="l94.29" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l94.30"></a><span id="l94.30" class="difflineminus">-    return view.orient == &quot;horizontal&quot;;</span>
<a href="#l94.31"></a><span id="l94.31" class="difflineminus">-  });</span>
<a href="#l94.32"></a><span id="l94.32" class="difflineplus">+    // rotate view</span>
<a href="#l94.33"></a><span id="l94.33" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l94.34"></a><span id="l94.34" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l94.35"></a><span id="l94.35" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l94.36"></a><span id="l94.36" class="difflineplus">+        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l94.37"></a><span id="l94.37" class="difflineplus">+    });</span>
<a href="#l94.38"></a><span id="l94.38"> </span>
<a href="#l94.39"></a><span id="l94.39" class="difflineminus">-  // create weekly recurring event</span>
<a href="#l94.40"></a><span id="l94.40" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l94.41"></a><span id="l94.41" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l94.42"></a><span id="l94.42" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l94.43"></a><span id="l94.43" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l94.44"></a><span id="l94.44" class="difflineplus">+    // create weekly recurring event</span>
<a href="#l94.45"></a><span id="l94.45" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l94.46"></a><span id="l94.46" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l94.47"></a><span id="l94.47" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l94.48"></a><span id="l94.48" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l94.49"></a><span id="l94.49"> </span>
<a href="#l94.50"></a><span id="l94.50" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l94.51"></a><span id="l94.51" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l94.52"></a><span id="l94.52" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l94.53"></a><span id="l94.53" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l94.54"></a><span id="l94.54" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l94.55"></a><span id="l94.55" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l94.56"></a><span id="l94.56" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l94.57"></a><span id="l94.57" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l94.58"></a><span id="l94.58"> </span>
<a href="#l94.59"></a><span id="l94.59" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l94.60"></a><span id="l94.60" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l94.61"></a><span id="l94.61"> </span>
<a href="#l94.62"></a><span id="l94.62" class="difflineminus">-  // check day view</span>
<a href="#l94.63"></a><span id="l94.63" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l94.64"></a><span id="l94.64" class="difflineminus">-    eventPath;</span>
<a href="#l94.65"></a><span id="l94.65" class="difflineplus">+    // check day view</span>
<a href="#l94.66"></a><span id="l94.66" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l94.67"></a><span id="l94.67" class="difflineplus">+      eventPath;</span>
<a href="#l94.68"></a><span id="l94.68"> </span>
<a href="#l94.69"></a><span id="l94.69" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l94.70"></a><span id="l94.70" class="difflineminus">-  for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l94.71"></a><span id="l94.71" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.72"></a><span id="l94.72" class="difflineplus">+    // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l94.73"></a><span id="l94.73" class="difflineplus">+    for (let i = 0; i &lt; 4; i++) {</span>
<a href="#l94.74"></a><span id="l94.74" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.75"></a><span id="l94.75" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l94.76"></a><span id="l94.76" class="difflineplus">+    }</span>
<a href="#l94.77"></a><span id="l94.77" class="difflineplus">+</span>
<a href="#l94.78"></a><span id="l94.78" class="difflineplus">+    // Saturday</span>
<a href="#l94.79"></a><span id="l94.79">     calUtils.forward(controller, 1);</span>
<a href="#l94.80"></a><span id="l94.80" class="difflineminus">-  }</span>
<a href="#l94.81"></a><span id="l94.81" class="difflineminus">-</span>
<a href="#l94.82"></a><span id="l94.82" class="difflineminus">-  // Saturday</span>
<a href="#l94.83"></a><span id="l94.83" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l94.84"></a><span id="l94.84" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.85"></a><span id="l94.85" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.86"></a><span id="l94.86"> </span>
<a href="#l94.87"></a><span id="l94.87" class="difflineminus">-  // check week view</span>
<a href="#l94.88"></a><span id="l94.88" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l94.89"></a><span id="l94.89" class="difflineplus">+    // check week view</span>
<a href="#l94.90"></a><span id="l94.90" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l94.91"></a><span id="l94.91"> </span>
<a href="#l94.92"></a><span id="l94.92" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l94.93"></a><span id="l94.93" class="difflineminus">-  for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l94.94"></a><span id="l94.94" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour) +</span>
<a href="#l94.95"></a><span id="l94.95" class="difflineplus">+    // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l94.96"></a><span id="l94.96" class="difflineplus">+    for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l94.97"></a><span id="l94.97" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, i, hour) +</span>
<a href="#l94.98"></a><span id="l94.98" class="difflineplus">+          eventPath;</span>
<a href="#l94.99"></a><span id="l94.99" class="difflineplus">+        controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.100"></a><span id="l94.100" class="difflineplus">+    }</span>
<a href="#l94.101"></a><span id="l94.101" class="difflineplus">+</span>
<a href="#l94.102"></a><span id="l94.102" class="difflineplus">+    // Saturday</span>
<a href="#l94.103"></a><span id="l94.103" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l94.104"></a><span id="l94.104">       eventPath;</span>
<a href="#l94.105"></a><span id="l94.105" class="difflineminus">-    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.106"></a><span id="l94.106" class="difflineminus">-  }</span>
<a href="#l94.107"></a><span id="l94.107" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.108"></a><span id="l94.108"> </span>
<a href="#l94.109"></a><span id="l94.109" class="difflineminus">-  // Saturday</span>
<a href="#l94.110"></a><span id="l94.110" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour) +</span>
<a href="#l94.111"></a><span id="l94.111" class="difflineminus">-    eventPath;</span>
<a href="#l94.112"></a><span id="l94.112" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.113"></a><span id="l94.113" class="difflineminus">-</span>
<a href="#l94.114"></a><span id="l94.114" class="difflineminus">-  // check multiweek view</span>
<a href="#l94.115"></a><span id="l94.115" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l94.116"></a><span id="l94.116" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l94.117"></a><span id="l94.117" class="difflineplus">+    // check multiweek view</span>
<a href="#l94.118"></a><span id="l94.118" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l94.119"></a><span id="l94.119" class="difflineplus">+    checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l94.120"></a><span id="l94.120"> </span>
<a href="#l94.121"></a><span id="l94.121" class="difflineminus">-  // check month view</span>
<a href="#l94.122"></a><span id="l94.122" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l94.123"></a><span id="l94.123" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l94.124"></a><span id="l94.124" class="difflineplus">+    // check month view</span>
<a href="#l94.125"></a><span id="l94.125" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l94.126"></a><span id="l94.126" class="difflineplus">+    checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l94.127"></a><span id="l94.127"> </span>
<a href="#l94.128"></a><span id="l94.128" class="difflineminus">-  // delete event</span>
<a href="#l94.129"></a><span id="l94.129" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour) +</span>
<a href="#l94.130"></a><span id="l94.130" class="difflineminus">-    eventPath;</span>
<a href="#l94.131"></a><span id="l94.131" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.132"></a><span id="l94.132" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l94.133"></a><span id="l94.133" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l94.134"></a><span id="l94.134" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l94.135"></a><span id="l94.135" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.136"></a><span id="l94.136" class="difflineplus">+    // delete event</span>
<a href="#l94.137"></a><span id="l94.137" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, hour) +</span>
<a href="#l94.138"></a><span id="l94.138" class="difflineplus">+      eventPath;</span>
<a href="#l94.139"></a><span id="l94.139" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.140"></a><span id="l94.140" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l94.141"></a><span id="l94.141" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l94.142"></a><span id="l94.142" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l94.143"></a><span id="l94.143" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.144"></a><span id="l94.144"> </span>
<a href="#l94.145"></a><span id="l94.145" class="difflineminus">-  // reset view</span>
<a href="#l94.146"></a><span id="l94.146" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l94.147"></a><span id="l94.147" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l94.148"></a><span id="l94.148" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l94.149"></a><span id="l94.149" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l94.150"></a><span id="l94.150" class="difflineminus">-    return view.orient == &quot;vertical&quot;;</span>
<a href="#l94.151"></a><span id="l94.151" class="difflineminus">-  });</span>
<a href="#l94.152"></a><span id="l94.152" class="difflineplus">+    // reset view</span>
<a href="#l94.153"></a><span id="l94.153" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l94.154"></a><span id="l94.154" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l94.155"></a><span id="l94.155" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l94.156"></a><span id="l94.156" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l94.157"></a><span id="l94.157" class="difflineplus">+        return view.orient == &quot;vertical&quot;;</span>
<a href="#l94.158"></a><span id="l94.158" class="difflineplus">+    });</span>
<a href="#l94.159"></a><span id="l94.159"> };</span>
<a href="#l94.160"></a><span id="l94.160"> </span>
<a href="#l94.161"></a><span id="l94.161"> function setRecurrence(recurrence) {</span>
<a href="#l94.162"></a><span id="l94.162" class="difflineminus">-  // weekly</span>
<a href="#l94.163"></a><span id="l94.163" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l94.164"></a><span id="l94.164" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l94.165"></a><span id="l94.165" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l94.166"></a><span id="l94.166" class="difflineplus">+    // weekly</span>
<a href="#l94.167"></a><span id="l94.167" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l94.168"></a><span id="l94.168" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l94.169"></a><span id="l94.169" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l94.170"></a><span id="l94.170"> </span>
<a href="#l94.171"></a><span id="l94.171" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l94.172"></a><span id="l94.172" class="difflineminus">-  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l94.173"></a><span id="l94.173" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l94.174"></a><span id="l94.174" class="difflineminus">-  let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l94.175"></a><span id="l94.175" class="difflineminus">-  let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l94.176"></a><span id="l94.176" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l94.177"></a><span id="l94.177" class="difflineplus">+    let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l94.178"></a><span id="l94.178" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l94.179"></a><span id="l94.179" class="difflineplus">+    let thu = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.5.Mmm&quot;);</span>
<a href="#l94.180"></a><span id="l94.180" class="difflineplus">+    let sat = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.7.Mmm&quot;);</span>
<a href="#l94.181"></a><span id="l94.181"> </span>
<a href="#l94.182"></a><span id="l94.182" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l94.183"></a><span id="l94.183" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l94.184"></a><span id="l94.184" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l94.185"></a><span id="l94.185" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l94.186"></a><span id="l94.186" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l94.187"></a><span id="l94.187" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l94.188"></a><span id="l94.188"> </span>
<a href="#l94.189"></a><span id="l94.189" class="difflineminus">-  // starting from Monday so it should be checked</span>
<a href="#l94.190"></a><span id="l94.190" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l94.191"></a><span id="l94.191" class="difflineminus">-  // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l94.192"></a><span id="l94.192" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l94.193"></a><span id="l94.193" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l94.194"></a><span id="l94.194" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l94.195"></a><span id="l94.195" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l94.196"></a><span id="l94.196" class="difflineplus">+    // starting from Monday so it should be checked</span>
<a href="#l94.197"></a><span id="l94.197" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l94.198"></a><span id="l94.198" class="difflineplus">+    // check Tuesday, Wednesday, Thursday and Saturday too</span>
<a href="#l94.199"></a><span id="l94.199" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l94.200"></a><span id="l94.200" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l94.201"></a><span id="l94.201" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + thu + '&quot;}'));</span>
<a href="#l94.202"></a><span id="l94.202" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + sat + '&quot;}'));</span>
<a href="#l94.203"></a><span id="l94.203"> </span>
<a href="#l94.204"></a><span id="l94.204" class="difflineminus">-  // set number of occurrences</span>
<a href="#l94.205"></a><span id="l94.205" class="difflineminus">-  recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l94.206"></a><span id="l94.206" class="difflineminus">-  let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l94.207"></a><span id="l94.207" class="difflineminus">-    'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/' +</span>
<a href="#l94.208"></a><span id="l94.208" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l94.209"></a><span id="l94.209" class="difflineminus">-  // replace previous number</span>
<a href="#l94.210"></a><span id="l94.210" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l94.211"></a><span id="l94.211" class="difflineminus">-  recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l94.212"></a><span id="l94.212" class="difflineplus">+    // set number of occurrences</span>
<a href="#l94.213"></a><span id="l94.213" class="difflineplus">+    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-for&quot;));</span>
<a href="#l94.214"></a><span id="l94.214" class="difflineplus">+    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l94.215"></a><span id="l94.215" class="difflineplus">+      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-count-box&quot;)/id(&quot;repeat-ntimes-count&quot;)/' +</span>
<a href="#l94.216"></a><span id="l94.216" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l94.217"></a><span id="l94.217" class="difflineplus">+    // replace previous number</span>
<a href="#l94.218"></a><span id="l94.218" class="difflineplus">+    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l94.219"></a><span id="l94.219" class="difflineplus">+    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), &quot;4&quot;);</span>
<a href="#l94.220"></a><span id="l94.220"> </span>
<a href="#l94.221"></a><span id="l94.221" class="difflineminus">-  // close dialog</span>
<a href="#l94.222"></a><span id="l94.222" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l94.223"></a><span id="l94.223" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l94.224"></a><span id="l94.224" class="difflineplus">+    // close dialog</span>
<a href="#l94.225"></a><span id="l94.225" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l94.226"></a><span id="l94.226" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l94.227"></a><span id="l94.227"> }</span>
<a href="#l94.228"></a><span id="l94.228"> </span>
<a href="#l94.229"></a><span id="l94.229"> function checkMultiWeekView(view) {</span>
<a href="#l94.230"></a><span id="l94.230" class="difflineminus">-  let week = 1;</span>
<a href="#l94.231"></a><span id="l94.231" class="difflineplus">+    let week = 1;</span>
<a href="#l94.232"></a><span id="l94.232"> </span>
<a href="#l94.233"></a><span id="l94.233" class="difflineminus">-  // in month view event starts from 2nd row</span>
<a href="#l94.234"></a><span id="l94.234" class="difflineminus">-  if (view == &quot;month&quot;) {</span>
<a href="#l94.235"></a><span id="l94.235" class="difflineminus">-    week++;</span>
<a href="#l94.236"></a><span id="l94.236" class="difflineminus">-  }</span>
<a href="#l94.237"></a><span id="l94.237" class="difflineplus">+    // in month view event starts from 2nd row</span>
<a href="#l94.238"></a><span id="l94.238" class="difflineplus">+    if (view == &quot;month&quot;) {</span>
<a href="#l94.239"></a><span id="l94.239" class="difflineplus">+        week++;</span>
<a href="#l94.240"></a><span id="l94.240" class="difflineplus">+    }</span>
<a href="#l94.241"></a><span id="l94.241"> </span>
<a href="#l94.242"></a><span id="l94.242" class="difflineminus">-  // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l94.243"></a><span id="l94.243" class="difflineminus">-  for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l94.244"></a><span id="l94.244" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined) +</span>
<a href="#l94.245"></a><span id="l94.245" class="difflineplus">+    // Monday, Tuesday, Wednesday, Thursday</span>
<a href="#l94.246"></a><span id="l94.246" class="difflineplus">+    for (let i = 2; i &lt; 6; i++) {</span>
<a href="#l94.247"></a><span id="l94.247" class="difflineplus">+        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, i, undefined) +</span>
<a href="#l94.248"></a><span id="l94.248" class="difflineplus">+          eventPath;</span>
<a href="#l94.249"></a><span id="l94.249" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.250"></a><span id="l94.250" class="difflineplus">+    }</span>
<a href="#l94.251"></a><span id="l94.251" class="difflineplus">+</span>
<a href="#l94.252"></a><span id="l94.252" class="difflineplus">+    // Saturday</span>
<a href="#l94.253"></a><span id="l94.253" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined) +</span>
<a href="#l94.254"></a><span id="l94.254">       eventPath;</span>
<a href="#l94.255"></a><span id="l94.255" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.256"></a><span id="l94.256" class="difflineminus">-  }</span>
<a href="#l94.257"></a><span id="l94.257" class="difflineminus">-</span>
<a href="#l94.258"></a><span id="l94.258" class="difflineminus">-  // Saturday</span>
<a href="#l94.259"></a><span id="l94.259" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 7, undefined) +</span>
<a href="#l94.260"></a><span id="l94.260" class="difflineminus">-    eventPath;</span>
<a href="#l94.261"></a><span id="l94.261" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.262"></a><span id="l94.262" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l94.263"></a><span id="l94.263"> }</span>
<a href="#l94.264"></a><span id="l94.264"> </span>
<a href="#l94.265"></a><span id="l94.265"> var teardownTest = function(module) {</span>
<a href="#l94.266"></a><span id="l94.266" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l94.267"></a><span id="l94.267" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l94.268"></a><span id="l94.268"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -8,196 +8,196 @@ var utils = require(&quot;../shared-modules/u</span>
<a href="#l95.4"></a><span id="l95.4"> </span>
<a href="#l95.5"></a><span id="l95.5"> var sleep = 500;</span>
<a href="#l95.6"></a><span id="l95.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l95.7"></a><span id="l95.7"> var endDate = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l95.8"></a><span id="l95.8"> var hour = 8;</span>
<a href="#l95.9"></a><span id="l95.9"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l95.10"></a><span id="l95.10"> </span>
<a href="#l95.11"></a><span id="l95.11"> var setupModule = function(module) {</span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l95.14"></a><span id="l95.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l95.15"></a><span id="l95.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l95.16"></a><span id="l95.16"> };</span>
<a href="#l95.17"></a><span id="l95.17"> </span>
<a href="#l95.18"></a><span id="l95.18"> var testWeeklyUntilRecurrence = function() {</span>
<a href="#l95.19"></a><span id="l95.19" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l95.20"></a><span id="l95.20" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l95.21"></a><span id="l95.21" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l95.22"></a><span id="l95.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l95.23"></a><span id="l95.23" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l95.24"></a><span id="l95.24" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5); // Monday</span>
<a href="#l95.25"></a><span id="l95.25"> </span>
<a href="#l95.26"></a><span id="l95.26" class="difflineminus">-  // rotate view</span>
<a href="#l95.27"></a><span id="l95.27" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l95.28"></a><span id="l95.28" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l95.29"></a><span id="l95.29" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l95.30"></a><span id="l95.30" class="difflineminus">-    return view.orient == &quot;horizontal&quot;;</span>
<a href="#l95.31"></a><span id="l95.31" class="difflineminus">-  });</span>
<a href="#l95.32"></a><span id="l95.32" class="difflineplus">+    // rotate view</span>
<a href="#l95.33"></a><span id="l95.33" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l95.34"></a><span id="l95.34" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l95.35"></a><span id="l95.35" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l95.36"></a><span id="l95.36" class="difflineplus">+        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l95.37"></a><span id="l95.37" class="difflineplus">+    });</span>
<a href="#l95.38"></a><span id="l95.38" class="difflineplus">+</span>
<a href="#l95.39"></a><span id="l95.39" class="difflineplus">+    // create weekly recurring event</span>
<a href="#l95.40"></a><span id="l95.40" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l95.41"></a><span id="l95.41" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l95.42"></a><span id="l95.42" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l95.43"></a><span id="l95.43" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l95.44"></a><span id="l95.44"> </span>
<a href="#l95.45"></a><span id="l95.45" class="difflineminus">-  // create weekly recurring event</span>
<a href="#l95.46"></a><span id="l95.46" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l95.47"></a><span id="l95.47" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l95.48"></a><span id="l95.48" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l95.49"></a><span id="l95.49" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l95.50"></a><span id="l95.50" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l95.51"></a><span id="l95.51" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l95.52"></a><span id="l95.52" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l95.53"></a><span id="l95.53" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l95.54"></a><span id="l95.54" class="difflineplus">+</span>
<a href="#l95.55"></a><span id="l95.55" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l95.56"></a><span id="l95.56" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l95.57"></a><span id="l95.57" class="difflineplus">+</span>
<a href="#l95.58"></a><span id="l95.58" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l95.59"></a><span id="l95.59" class="difflineplus">+      eventPath;</span>
<a href="#l95.60"></a><span id="l95.60"> </span>
<a href="#l95.61"></a><span id="l95.61" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l95.62"></a><span id="l95.62" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l95.63"></a><span id="l95.63" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l95.64"></a><span id="l95.64" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l95.65"></a><span id="l95.65" class="difflineplus">+    // check day view</span>
<a href="#l95.66"></a><span id="l95.66" class="difflineplus">+    for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l95.67"></a><span id="l95.67" class="difflineplus">+        // Monday</span>
<a href="#l95.68"></a><span id="l95.68" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.69"></a><span id="l95.69" class="difflineplus">+        calUtils.forward(controller, 2);</span>
<a href="#l95.70"></a><span id="l95.70" class="difflineplus">+        // Wednesday</span>
<a href="#l95.71"></a><span id="l95.71" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.72"></a><span id="l95.72" class="difflineplus">+        calUtils.forward(controller, 2);</span>
<a href="#l95.73"></a><span id="l95.73" class="difflineplus">+        // Friday</span>
<a href="#l95.74"></a><span id="l95.74" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.75"></a><span id="l95.75" class="difflineplus">+        calUtils.forward(controller, 3);</span>
<a href="#l95.76"></a><span id="l95.76" class="difflineplus">+    }</span>
<a href="#l95.77"></a><span id="l95.77"> </span>
<a href="#l95.78"></a><span id="l95.78" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l95.79"></a><span id="l95.79" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l95.80"></a><span id="l95.80" class="difflineminus">-</span>
<a href="#l95.81"></a><span id="l95.81" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l95.82"></a><span id="l95.82" class="difflineminus">-    eventPath;</span>
<a href="#l95.83"></a><span id="l95.83" class="difflineminus">-</span>
<a href="#l95.84"></a><span id="l95.84" class="difflineminus">-  // check day view</span>
<a href="#l95.85"></a><span id="l95.85" class="difflineminus">-  for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l95.86"></a><span id="l95.86" class="difflineminus">-    // Monday</span>
<a href="#l95.87"></a><span id="l95.87" class="difflineplus">+    // Monday, last occurrence</span>
<a href="#l95.88"></a><span id="l95.88">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.89"></a><span id="l95.89">     calUtils.forward(controller, 2);</span>
<a href="#l95.90"></a><span id="l95.90">     // Wednesday</span>
<a href="#l95.91"></a><span id="l95.91" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.92"></a><span id="l95.92" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.93"></a><span id="l95.93">     calUtils.forward(controller, 2);</span>
<a href="#l95.94"></a><span id="l95.94" class="difflineminus">-    // Friday</span>
<a href="#l95.95"></a><span id="l95.95" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.96"></a><span id="l95.96" class="difflineminus">-    calUtils.forward(controller, 3);</span>
<a href="#l95.97"></a><span id="l95.97" class="difflineminus">-  }</span>
<a href="#l95.98"></a><span id="l95.98"> </span>
<a href="#l95.99"></a><span id="l95.99" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l95.100"></a><span id="l95.100" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.101"></a><span id="l95.101" class="difflineminus">-  calUtils.forward(controller, 2);</span>
<a href="#l95.102"></a><span id="l95.102" class="difflineminus">-  // Wednesday</span>
<a href="#l95.103"></a><span id="l95.103" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.104"></a><span id="l95.104" class="difflineminus">-  calUtils.forward(controller, 2);</span>
<a href="#l95.105"></a><span id="l95.105" class="difflineplus">+    // check week view</span>
<a href="#l95.106"></a><span id="l95.106" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l95.107"></a><span id="l95.107" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l95.108"></a><span id="l95.108" class="difflineplus">+    for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l95.109"></a><span id="l95.109" class="difflineplus">+        // Monday</span>
<a href="#l95.110"></a><span id="l95.110" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l95.111"></a><span id="l95.111" class="difflineplus">+          eventPath;</span>
<a href="#l95.112"></a><span id="l95.112" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.113"></a><span id="l95.113" class="difflineplus">+        // Wednesday</span>
<a href="#l95.114"></a><span id="l95.114" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l95.115"></a><span id="l95.115" class="difflineplus">+          eventPath;</span>
<a href="#l95.116"></a><span id="l95.116" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.117"></a><span id="l95.117" class="difflineplus">+        // Friday</span>
<a href="#l95.118"></a><span id="l95.118" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour) +</span>
<a href="#l95.119"></a><span id="l95.119" class="difflineplus">+          eventPath;</span>
<a href="#l95.120"></a><span id="l95.120" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.121"></a><span id="l95.121"> </span>
<a href="#l95.122"></a><span id="l95.122" class="difflineminus">-  // check week view</span>
<a href="#l95.123"></a><span id="l95.123" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l95.124"></a><span id="l95.124" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l95.125"></a><span id="l95.125" class="difflineminus">-  for (let week = 0; week &lt; 3; week++) {</span>
<a href="#l95.126"></a><span id="l95.126" class="difflineminus">-    // Monday</span>
<a href="#l95.127"></a><span id="l95.127" class="difflineplus">+        calUtils.forward(controller, 1);</span>
<a href="#l95.128"></a><span id="l95.128" class="difflineplus">+    }</span>
<a href="#l95.129"></a><span id="l95.129" class="difflineplus">+</span>
<a href="#l95.130"></a><span id="l95.130" class="difflineplus">+    // Monday, last occurrence</span>
<a href="#l95.131"></a><span id="l95.131">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l95.132"></a><span id="l95.132">       eventPath;</span>
<a href="#l95.133"></a><span id="l95.133">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.134"></a><span id="l95.134">     // Wednesday</span>
<a href="#l95.135"></a><span id="l95.135">     box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l95.136"></a><span id="l95.136">       eventPath;</span>
<a href="#l95.137"></a><span id="l95.137" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.138"></a><span id="l95.138" class="difflineminus">-    // Friday</span>
<a href="#l95.139"></a><span id="l95.139" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour) +</span>
<a href="#l95.140"></a><span id="l95.140" class="difflineminus">-      eventPath;</span>
<a href="#l95.141"></a><span id="l95.141" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.142"></a><span id="l95.142" class="difflineminus">-</span>
<a href="#l95.143"></a><span id="l95.143" class="difflineminus">-    calUtils.forward(controller, 1);</span>
<a href="#l95.144"></a><span id="l95.144" class="difflineminus">-  }</span>
<a href="#l95.145"></a><span id="l95.145" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.146"></a><span id="l95.146"> </span>
<a href="#l95.147"></a><span id="l95.147" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l95.148"></a><span id="l95.148" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l95.149"></a><span id="l95.149" class="difflineminus">-    eventPath;</span>
<a href="#l95.150"></a><span id="l95.150" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.151"></a><span id="l95.151" class="difflineminus">-  // Wednesday</span>
<a href="#l95.152"></a><span id="l95.152" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour) +</span>
<a href="#l95.153"></a><span id="l95.153" class="difflineminus">-    eventPath;</span>
<a href="#l95.154"></a><span id="l95.154" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.155"></a><span id="l95.155" class="difflineplus">+    // check multiweek view</span>
<a href="#l95.156"></a><span id="l95.156" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l95.157"></a><span id="l95.157" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l95.158"></a><span id="l95.158" class="difflineplus">+    checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l95.159"></a><span id="l95.159" class="difflineplus">+</span>
<a href="#l95.160"></a><span id="l95.160" class="difflineplus">+    // check month view</span>
<a href="#l95.161"></a><span id="l95.161" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l95.162"></a><span id="l95.162" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l95.163"></a><span id="l95.163" class="difflineplus">+    checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l95.164"></a><span id="l95.164"> </span>
<a href="#l95.165"></a><span id="l95.165" class="difflineminus">-  // check multiweek view</span>
<a href="#l95.166"></a><span id="l95.166" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l95.167"></a><span id="l95.167" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l95.168"></a><span id="l95.168" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l95.169"></a><span id="l95.169" class="difflineminus">-</span>
<a href="#l95.170"></a><span id="l95.170" class="difflineminus">-  // check month view</span>
<a href="#l95.171"></a><span id="l95.171" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l95.172"></a><span id="l95.172" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l95.173"></a><span id="l95.173" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l95.174"></a><span id="l95.174" class="difflineplus">+    // delete event</span>
<a href="#l95.175"></a><span id="l95.175" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined) +</span>
<a href="#l95.176"></a><span id="l95.176" class="difflineplus">+      eventPath;</span>
<a href="#l95.177"></a><span id="l95.177" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.178"></a><span id="l95.178" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l95.179"></a><span id="l95.179" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l95.180"></a><span id="l95.180" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l95.181"></a><span id="l95.181" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.182"></a><span id="l95.182"> </span>
<a href="#l95.183"></a><span id="l95.183" class="difflineminus">-  // delete event</span>
<a href="#l95.184"></a><span id="l95.184" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 2, 2, undefined) +</span>
<a href="#l95.185"></a><span id="l95.185" class="difflineminus">-    eventPath;</span>
<a href="#l95.186"></a><span id="l95.186" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.187"></a><span id="l95.187" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l95.188"></a><span id="l95.188" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l95.189"></a><span id="l95.189" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l95.190"></a><span id="l95.190" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.191"></a><span id="l95.191" class="difflineminus">-</span>
<a href="#l95.192"></a><span id="l95.192" class="difflineminus">-  // reset view</span>
<a href="#l95.193"></a><span id="l95.193" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l95.194"></a><span id="l95.194" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l95.195"></a><span id="l95.195" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l95.196"></a><span id="l95.196" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l95.197"></a><span id="l95.197" class="difflineminus">-    return view.orient == &quot;vertical&quot;;</span>
<a href="#l95.198"></a><span id="l95.198" class="difflineminus">-  });</span>
<a href="#l95.199"></a><span id="l95.199" class="difflineplus">+    // reset view</span>
<a href="#l95.200"></a><span id="l95.200" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l95.201"></a><span id="l95.201" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l95.202"></a><span id="l95.202" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l95.203"></a><span id="l95.203" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l95.204"></a><span id="l95.204" class="difflineplus">+        return view.orient == &quot;vertical&quot;;</span>
<a href="#l95.205"></a><span id="l95.205" class="difflineplus">+    });</span>
<a href="#l95.206"></a><span id="l95.206"> };</span>
<a href="#l95.207"></a><span id="l95.207"> </span>
<a href="#l95.208"></a><span id="l95.208"> function setRecurrence(recurrence) {</span>
<a href="#l95.209"></a><span id="l95.209" class="difflineminus">-  // weekly</span>
<a href="#l95.210"></a><span id="l95.210" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l95.211"></a><span id="l95.211" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l95.212"></a><span id="l95.212" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l95.213"></a><span id="l95.213" class="difflineplus">+    // weekly</span>
<a href="#l95.214"></a><span id="l95.214" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l95.215"></a><span id="l95.215" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l95.216"></a><span id="l95.216" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l95.217"></a><span id="l95.217"> </span>
<a href="#l95.218"></a><span id="l95.218" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l95.219"></a><span id="l95.219" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l95.220"></a><span id="l95.220" class="difflineminus">-  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l95.221"></a><span id="l95.221" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l95.222"></a><span id="l95.222" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l95.223"></a><span id="l95.223" class="difflineplus">+    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l95.224"></a><span id="l95.224"> </span>
<a href="#l95.225"></a><span id="l95.225" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l95.226"></a><span id="l95.226" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l95.227"></a><span id="l95.227" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l95.228"></a><span id="l95.228" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l95.229"></a><span id="l95.229" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l95.230"></a><span id="l95.230" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l95.231"></a><span id="l95.231"> </span>
<a href="#l95.232"></a><span id="l95.232" class="difflineminus">-  // starting from Monday so it should be checked</span>
<a href="#l95.233"></a><span id="l95.233" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l95.234"></a><span id="l95.234" class="difflineminus">-  // check Wednesday and Friday too</span>
<a href="#l95.235"></a><span id="l95.235" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l95.236"></a><span id="l95.236" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l95.237"></a><span id="l95.237" class="difflineplus">+    // starting from Monday so it should be checked</span>
<a href="#l95.238"></a><span id="l95.238" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l95.239"></a><span id="l95.239" class="difflineplus">+    // check Wednesday and Friday too</span>
<a href="#l95.240"></a><span id="l95.240" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l95.241"></a><span id="l95.241" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l95.242"></a><span id="l95.242"> </span>
<a href="#l95.243"></a><span id="l95.243" class="difflineminus">-  // set until date</span>
<a href="#l95.244"></a><span id="l95.244" class="difflineminus">-  recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l95.245"></a><span id="l95.245" class="difflineminus">-  let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l95.246"></a><span id="l95.246" class="difflineminus">-    'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/' +</span>
<a href="#l95.247"></a><span id="l95.247" class="difflineminus">-    'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l95.248"></a><span id="l95.248" class="difflineminus">-    'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l95.249"></a><span id="l95.249" class="difflineminus">-  // delete previous date</span>
<a href="#l95.250"></a><span id="l95.250" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l95.251"></a><span id="l95.251" class="difflineminus">-  recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l95.252"></a><span id="l95.252" class="difflineplus">+    // set until date</span>
<a href="#l95.253"></a><span id="l95.253" class="difflineplus">+    recurrence.click(new elementslib.ID(recurrence.window.document, &quot;recurrence-range-until&quot;));</span>
<a href="#l95.254"></a><span id="l95.254" class="difflineplus">+    let input = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-range-groupbox&quot;)/[1]/' +</span>
<a href="#l95.255"></a><span id="l95.255" class="difflineplus">+      'id(&quot;recurrence-duration&quot;)/id(&quot;recurrence-range-until-box&quot;)/id(&quot;repeat-until-date&quot;)/' +</span>
<a href="#l95.256"></a><span id="l95.256" class="difflineplus">+      'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l95.257"></a><span id="l95.257" class="difflineplus">+      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l95.258"></a><span id="l95.258" class="difflineplus">+    // delete previous date</span>
<a href="#l95.259"></a><span id="l95.259" class="difflineplus">+    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l95.260"></a><span id="l95.260" class="difflineplus">+    recurrence.keypress(new elementslib.Lookup(recurrence.window.document, input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l95.261"></a><span id="l95.261"> </span>
<a href="#l95.262"></a><span id="l95.262" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l95.263"></a><span id="l95.263" class="difflineminus">-                     .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l95.264"></a><span id="l95.264" class="difflineminus">-  let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l95.265"></a><span id="l95.265" class="difflineminus">-                                             endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l95.266"></a><span id="l95.266" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l95.267"></a><span id="l95.267" class="difflineplus">+                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l95.268"></a><span id="l95.268" class="difflineplus">+    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l95.269"></a><span id="l95.269" class="difflineplus">+                                               endDate.getFullYear(), endDate.getMonth() + 1, endDate.getDate());</span>
<a href="#l95.270"></a><span id="l95.270"> </span>
<a href="#l95.271"></a><span id="l95.271" class="difflineminus">-  recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l95.272"></a><span id="l95.272" class="difflineplus">+    recurrence.type(new elementslib.Lookup(recurrence.window.document, input), endDateString);</span>
<a href="#l95.273"></a><span id="l95.273"> </span>
<a href="#l95.274"></a><span id="l95.274" class="difflineminus">-  // close dialog</span>
<a href="#l95.275"></a><span id="l95.275" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l95.276"></a><span id="l95.276" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l95.277"></a><span id="l95.277" class="difflineplus">+    // close dialog</span>
<a href="#l95.278"></a><span id="l95.278" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l95.279"></a><span id="l95.279" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l95.280"></a><span id="l95.280"> }</span>
<a href="#l95.281"></a><span id="l95.281"> </span>
<a href="#l95.282"></a><span id="l95.282"> function checkMultiWeekView(view) {</span>
<a href="#l95.283"></a><span id="l95.283" class="difflineminus">-  let startWeek = 1;</span>
<a href="#l95.284"></a><span id="l95.284" class="difflineplus">+    let startWeek = 1;</span>
<a href="#l95.285"></a><span id="l95.285" class="difflineplus">+</span>
<a href="#l95.286"></a><span id="l95.286" class="difflineplus">+    // in month view event starts from 2nd row</span>
<a href="#l95.287"></a><span id="l95.287" class="difflineplus">+    if (view == &quot;month&quot;) {</span>
<a href="#l95.288"></a><span id="l95.288" class="difflineplus">+        startWeek++;</span>
<a href="#l95.289"></a><span id="l95.289" class="difflineplus">+    }</span>
<a href="#l95.290"></a><span id="l95.290"> </span>
<a href="#l95.291"></a><span id="l95.291" class="difflineminus">-  // in month view event starts from 2nd row</span>
<a href="#l95.292"></a><span id="l95.292" class="difflineminus">-  if (view == &quot;month&quot;) {</span>
<a href="#l95.293"></a><span id="l95.293" class="difflineminus">-    startWeek++;</span>
<a href="#l95.294"></a><span id="l95.294" class="difflineminus">-  }</span>
<a href="#l95.295"></a><span id="l95.295" class="difflineplus">+    for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l95.296"></a><span id="l95.296" class="difflineplus">+        // Monday</span>
<a href="#l95.297"></a><span id="l95.297" class="difflineplus">+        let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined) +</span>
<a href="#l95.298"></a><span id="l95.298" class="difflineplus">+          eventPath;</span>
<a href="#l95.299"></a><span id="l95.299" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.300"></a><span id="l95.300" class="difflineplus">+        // Wednesday</span>
<a href="#l95.301"></a><span id="l95.301" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined) +</span>
<a href="#l95.302"></a><span id="l95.302" class="difflineplus">+          eventPath;</span>
<a href="#l95.303"></a><span id="l95.303" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.304"></a><span id="l95.304" class="difflineplus">+        // Friday</span>
<a href="#l95.305"></a><span id="l95.305" class="difflineplus">+        box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined) +</span>
<a href="#l95.306"></a><span id="l95.306" class="difflineplus">+          eventPath;</span>
<a href="#l95.307"></a><span id="l95.307" class="difflineplus">+        controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.308"></a><span id="l95.308" class="difflineplus">+    }</span>
<a href="#l95.309"></a><span id="l95.309"> </span>
<a href="#l95.310"></a><span id="l95.310" class="difflineminus">-  for (let week = startWeek; week &lt; startWeek + 3; week++) {</span>
<a href="#l95.311"></a><span id="l95.311" class="difflineminus">-    // Monday</span>
<a href="#l95.312"></a><span id="l95.312" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 2, undefined) +</span>
<a href="#l95.313"></a><span id="l95.313" class="difflineminus">-      eventPath;</span>
<a href="#l95.314"></a><span id="l95.314" class="difflineplus">+    // Monday, last occurrence</span>
<a href="#l95.315"></a><span id="l95.315" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l95.316"></a><span id="l95.316" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l95.317"></a><span id="l95.317">     controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.318"></a><span id="l95.318">     // Wednesday</span>
<a href="#l95.319"></a><span id="l95.319" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 4, undefined) +</span>
<a href="#l95.320"></a><span id="l95.320" class="difflineminus">-      eventPath;</span>
<a href="#l95.321"></a><span id="l95.321" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.322"></a><span id="l95.322" class="difflineminus">-    // Friday</span>
<a href="#l95.323"></a><span id="l95.323" class="difflineminus">-    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, week, 6, undefined) +</span>
<a href="#l95.324"></a><span id="l95.324" class="difflineminus">-      eventPath;</span>
<a href="#l95.325"></a><span id="l95.325" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.326"></a><span id="l95.326" class="difflineminus">-  }</span>
<a href="#l95.327"></a><span id="l95.327" class="difflineminus">-</span>
<a href="#l95.328"></a><span id="l95.328" class="difflineminus">-  // Monday, last occurrence</span>
<a href="#l95.329"></a><span id="l95.329" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 2,</span>
<a href="#l95.330"></a><span id="l95.330" class="difflineminus">-    undefined) + eventPath;</span>
<a href="#l95.331"></a><span id="l95.331" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.332"></a><span id="l95.332" class="difflineminus">-  // Wednesday</span>
<a href="#l95.333"></a><span id="l95.333" class="difflineminus">-  box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l95.334"></a><span id="l95.334" class="difflineminus">-    undefined) + eventPath;</span>
<a href="#l95.335"></a><span id="l95.335" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.336"></a><span id="l95.336" class="difflineplus">+    box = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 3, 4,</span>
<a href="#l95.337"></a><span id="l95.337" class="difflineplus">+      undefined) + eventPath;</span>
<a href="#l95.338"></a><span id="l95.338" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l95.339"></a><span id="l95.339"> }</span>
<a href="#l95.340"></a><span id="l95.340"> </span>
<a href="#l95.341"></a><span id="l95.341"> var teardownTest = function(module) {</span>
<a href="#l95.342"></a><span id="l95.342" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l95.343"></a><span id="l95.343" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l95.344"></a><span id="l95.344"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -8,303 +8,303 @@ var utils = require(&quot;../shared-modules/u</span>
<a href="#l96.4"></a><span id="l96.4"> </span>
<a href="#l96.5"></a><span id="l96.5"> var sleep = 500;</span>
<a href="#l96.6"></a><span id="l96.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l96.7"></a><span id="l96.7"> var hour = 8;</span>
<a href="#l96.8"></a><span id="l96.8"> var startDate = new Date(2009, 0, 6);</span>
<a href="#l96.9"></a><span id="l96.9"> var eventPath = '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}';</span>
<a href="#l96.10"></a><span id="l96.10"> </span>
<a href="#l96.11"></a><span id="l96.11"> var setupModule = function(module) {</span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l96.14"></a><span id="l96.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l96.15"></a><span id="l96.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l96.16"></a><span id="l96.16"> };</span>
<a href="#l96.17"></a><span id="l96.17"> </span>
<a href="#l96.18"></a><span id="l96.18"> var testWeeklyWithExceptionRecurrence = function() {</span>
<a href="#l96.19"></a><span id="l96.19" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l96.20"></a><span id="l96.20" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l96.21"></a><span id="l96.21" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.22"></a><span id="l96.22" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l96.23"></a><span id="l96.23" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l96.24"></a><span id="l96.24" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.25"></a><span id="l96.25"> </span>
<a href="#l96.26"></a><span id="l96.26" class="difflineminus">-  // rotate view</span>
<a href="#l96.27"></a><span id="l96.27" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l96.28"></a><span id="l96.28" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l96.29"></a><span id="l96.29" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l96.30"></a><span id="l96.30" class="difflineminus">-    return view.orient == &quot;horizontal&quot;;</span>
<a href="#l96.31"></a><span id="l96.31" class="difflineminus">-  });</span>
<a href="#l96.32"></a><span id="l96.32" class="difflineplus">+    // rotate view</span>
<a href="#l96.33"></a><span id="l96.33" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l96.34"></a><span id="l96.34" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l96.35"></a><span id="l96.35" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l96.36"></a><span id="l96.36" class="difflineplus">+        return view.orient == &quot;horizontal&quot;;</span>
<a href="#l96.37"></a><span id="l96.37" class="difflineplus">+    });</span>
<a href="#l96.38"></a><span id="l96.38"> </span>
<a href="#l96.39"></a><span id="l96.39" class="difflineminus">-  // create weekly recurring event</span>
<a href="#l96.40"></a><span id="l96.40" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.41"></a><span id="l96.41" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l96.42"></a><span id="l96.42" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l96.43"></a><span id="l96.43" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l96.44"></a><span id="l96.44" class="difflineplus">+    // create weekly recurring event</span>
<a href="#l96.45"></a><span id="l96.45" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.46"></a><span id="l96.46" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l96.47"></a><span id="l96.47" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l96.48"></a><span id="l96.48" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l96.49"></a><span id="l96.49"> </span>
<a href="#l96.50"></a><span id="l96.50" class="difflineminus">-  let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l96.51"></a><span id="l96.51" class="difflineminus">-  dialog.start(setRecurrence);</span>
<a href="#l96.52"></a><span id="l96.52" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l96.53"></a><span id="l96.53" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l96.54"></a><span id="l96.54" class="difflineplus">+    let dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l96.55"></a><span id="l96.55" class="difflineplus">+    dialog.start(setRecurrence);</span>
<a href="#l96.56"></a><span id="l96.56" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l96.57"></a><span id="l96.57" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l96.58"></a><span id="l96.58"> </span>
<a href="#l96.59"></a><span id="l96.59" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l96.60"></a><span id="l96.60" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l96.61"></a><span id="l96.61"> </span>
<a href="#l96.62"></a><span id="l96.62" class="difflineminus">-  // move 5th January occurrence to 6th January</span>
<a href="#l96.63"></a><span id="l96.63" class="difflineminus">-  calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l96.64"></a><span id="l96.64" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.65"></a><span id="l96.65" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.66"></a><span id="l96.66" class="difflineminus">-      eventPath));</span>
<a href="#l96.67"></a><span id="l96.67" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l96.68"></a><span id="l96.68" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l96.69"></a><span id="l96.69" class="difflineminus">-  event.sleep(sleep);</span>
<a href="#l96.70"></a><span id="l96.70" class="difflineplus">+    // move 5th January occurrence to 6th January</span>
<a href="#l96.71"></a><span id="l96.71" class="difflineplus">+    calUtils.handleOccurrenceModification(controller, false);</span>
<a href="#l96.72"></a><span id="l96.72" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.73"></a><span id="l96.73" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.74"></a><span id="l96.74" class="difflineplus">+        eventPath));</span>
<a href="#l96.75"></a><span id="l96.75" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l96.76"></a><span id="l96.76" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l96.77"></a><span id="l96.77" class="difflineplus">+    event.sleep(sleep);</span>
<a href="#l96.78"></a><span id="l96.78"> </span>
<a href="#l96.79"></a><span id="l96.79" class="difflineminus">-  let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l96.80"></a><span id="l96.80" class="difflineminus">-    'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/' +</span>
<a href="#l96.81"></a><span id="l96.81" class="difflineminus">-    'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l96.82"></a><span id="l96.82" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l96.83"></a><span id="l96.83" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l96.84"></a><span id="l96.84" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l96.85"></a><span id="l96.85" class="difflineminus">-  let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l96.86"></a><span id="l96.86" class="difflineminus">-    'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/' +</span>
<a href="#l96.87"></a><span id="l96.87" class="difflineminus">-    'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l96.88"></a><span id="l96.88" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l96.89"></a><span id="l96.89" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l96.90"></a><span id="l96.90" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l96.91"></a><span id="l96.91" class="difflineplus">+    let startDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l96.92"></a><span id="l96.92" class="difflineplus">+      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-startdate-row&quot;)/' +</span>
<a href="#l96.93"></a><span id="l96.93" class="difflineplus">+      'id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l96.94"></a><span id="l96.94" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l96.95"></a><span id="l96.95" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l96.96"></a><span id="l96.96" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l96.97"></a><span id="l96.97" class="difflineplus">+    let endDateInput = new elementslib.Lookup(event.window.document, '/id(&quot;calendar-event-dialog&quot;)/' +</span>
<a href="#l96.98"></a><span id="l96.98" class="difflineplus">+      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-enddate-row&quot;)/[1]/' +</span>
<a href="#l96.99"></a><span id="l96.99" class="difflineplus">+      'id(&quot;event-grid-enddate-picker-box&quot;)/id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/' +</span>
<a href="#l96.100"></a><span id="l96.100" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l96.101"></a><span id="l96.101" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l96.102"></a><span id="l96.102" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l96.103"></a><span id="l96.103"> </span>
<a href="#l96.104"></a><span id="l96.104" class="difflineminus">-  event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l96.105"></a><span id="l96.105" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l96.106"></a><span id="l96.106" class="difflineminus">-                     .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l96.107"></a><span id="l96.107" class="difflineminus">-  let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l96.108"></a><span id="l96.108" class="difflineminus">-                                             startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l96.109"></a><span id="l96.109" class="difflineminus">-  event.type(startDateInput, startDateString);</span>
<a href="#l96.110"></a><span id="l96.110" class="difflineminus">-  // applies startdate change</span>
<a href="#l96.111"></a><span id="l96.111" class="difflineminus">-  event.click(endDateInput);</span>
<a href="#l96.112"></a><span id="l96.112" class="difflineplus">+    event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l96.113"></a><span id="l96.113" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l96.114"></a><span id="l96.114" class="difflineplus">+                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l96.115"></a><span id="l96.115" class="difflineplus">+    let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l96.116"></a><span id="l96.116" class="difflineplus">+                                               startDate.getFullYear(), startDate.getMonth() + 1, startDate.getDate());</span>
<a href="#l96.117"></a><span id="l96.117" class="difflineplus">+    event.type(startDateInput, startDateString);</span>
<a href="#l96.118"></a><span id="l96.118" class="difflineplus">+    // applies startdate change</span>
<a href="#l96.119"></a><span id="l96.119" class="difflineplus">+    event.click(endDateInput);</span>
<a href="#l96.120"></a><span id="l96.120"> </span>
<a href="#l96.121"></a><span id="l96.121" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l96.122"></a><span id="l96.122" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l96.123"></a><span id="l96.123" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l96.124"></a><span id="l96.124" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l96.125"></a><span id="l96.125"> </span>
<a href="#l96.126"></a><span id="l96.126" class="difflineminus">-  // change recurrence rule</span>
<a href="#l96.127"></a><span id="l96.127" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l96.128"></a><span id="l96.128" class="difflineminus">-  calUtils.handleParentModification(controller, false);</span>
<a href="#l96.129"></a><span id="l96.129" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.130"></a><span id="l96.130" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.131"></a><span id="l96.131" class="difflineminus">-      eventPath));</span>
<a href="#l96.132"></a><span id="l96.132" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l96.133"></a><span id="l96.133" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l96.134"></a><span id="l96.134" class="difflineplus">+    // change recurrence rule</span>
<a href="#l96.135"></a><span id="l96.135" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 7);</span>
<a href="#l96.136"></a><span id="l96.136" class="difflineplus">+    calUtils.handleParentModification(controller, false);</span>
<a href="#l96.137"></a><span id="l96.137" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.138"></a><span id="l96.138" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.139"></a><span id="l96.139" class="difflineplus">+        eventPath));</span>
<a href="#l96.140"></a><span id="l96.140" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l96.141"></a><span id="l96.141" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l96.142"></a><span id="l96.142"> </span>
<a href="#l96.143"></a><span id="l96.143" class="difflineminus">-  dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l96.144"></a><span id="l96.144" class="difflineminus">-  dialog.start(changeRecurrence);</span>
<a href="#l96.145"></a><span id="l96.145" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l96.146"></a><span id="l96.146" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l96.147"></a><span id="l96.147" class="difflineplus">+    dialog = new modalDialog.modalDialog(event.window);</span>
<a href="#l96.148"></a><span id="l96.148" class="difflineplus">+    dialog.start(changeRecurrence);</span>
<a href="#l96.149"></a><span id="l96.149" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l96.150"></a><span id="l96.150" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined, &quot;custom&quot;);</span>
<a href="#l96.151"></a><span id="l96.151"> </span>
<a href="#l96.152"></a><span id="l96.152" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l96.153"></a><span id="l96.153" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l96.154"></a><span id="l96.154" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l96.155"></a><span id="l96.155" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l96.156"></a><span id="l96.156"> </span>
<a href="#l96.157"></a><span id="l96.157" class="difflineminus">-  // check two weeks</span>
<a href="#l96.158"></a><span id="l96.158" class="difflineminus">-  // day view</span>
<a href="#l96.159"></a><span id="l96.159" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l96.160"></a><span id="l96.160" class="difflineminus">-  let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.161"></a><span id="l96.161" class="difflineminus">-    eventPath;</span>
<a href="#l96.162"></a><span id="l96.162" class="difflineplus">+    // check two weeks</span>
<a href="#l96.163"></a><span id="l96.163" class="difflineplus">+    // day view</span>
<a href="#l96.164"></a><span id="l96.164" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l96.165"></a><span id="l96.165" class="difflineplus">+    let path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.166"></a><span id="l96.166" class="difflineplus">+      eventPath;</span>
<a href="#l96.167"></a><span id="l96.167"> </span>
<a href="#l96.168"></a><span id="l96.168" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.169"></a><span id="l96.169" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.170"></a><span id="l96.170" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.171"></a><span id="l96.171" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.172"></a><span id="l96.172"> </span>
<a href="#l96.173"></a><span id="l96.173" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.174"></a><span id="l96.174" class="difflineminus">-  let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l96.175"></a><span id="l96.175" class="difflineminus">-    'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l96.176"></a><span id="l96.176" class="difflineminus">-    'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l96.177"></a><span id="l96.177" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l96.178"></a><span id="l96.178" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l96.179"></a><span id="l96.179" class="difflineminus">-  // assert exactly two</span>
<a href="#l96.180"></a><span id="l96.180" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.181"></a><span id="l96.181" class="difflineminus">-    tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l96.182"></a><span id="l96.182" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.183"></a><span id="l96.183" class="difflineminus">-    tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l96.184"></a><span id="l96.184" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.185"></a><span id="l96.185" class="difflineminus">-    tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l96.186"></a><span id="l96.186" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.187"></a><span id="l96.187" class="difflineplus">+    let tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l96.188"></a><span id="l96.188" class="difflineplus">+      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l96.189"></a><span id="l96.189" class="difflineplus">+      'id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l96.190"></a><span id="l96.190" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l96.191"></a><span id="l96.191" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l96.192"></a><span id="l96.192" class="difflineplus">+    // assert exactly two</span>
<a href="#l96.193"></a><span id="l96.193" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.194"></a><span id="l96.194" class="difflineplus">+      tuesPath.replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l96.195"></a><span id="l96.195" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.196"></a><span id="l96.196" class="difflineplus">+      tuesPath.replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l96.197"></a><span id="l96.197" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.198"></a><span id="l96.198" class="difflineplus">+      tuesPath.replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l96.199"></a><span id="l96.199"> </span>
<a href="#l96.200"></a><span id="l96.200" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.201"></a><span id="l96.201" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.202"></a><span id="l96.202" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.203"></a><span id="l96.203" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.204"></a><span id="l96.204" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.205"></a><span id="l96.205" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.206"></a><span id="l96.206" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.207"></a><span id="l96.207" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.208"></a><span id="l96.208" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.209"></a><span id="l96.209" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.210"></a><span id="l96.210" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.211"></a><span id="l96.211" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.212"></a><span id="l96.212" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.213"></a><span id="l96.213" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.214"></a><span id="l96.214" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.215"></a><span id="l96.215" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.216"></a><span id="l96.216" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.217"></a><span id="l96.217" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.218"></a><span id="l96.218" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.219"></a><span id="l96.219" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.220"></a><span id="l96.220"> </span>
<a href="#l96.221"></a><span id="l96.221" class="difflineminus">-  // next week</span>
<a href="#l96.222"></a><span id="l96.222" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.223"></a><span id="l96.223" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.224"></a><span id="l96.224" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.225"></a><span id="l96.225" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.226"></a><span id="l96.226" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.227"></a><span id="l96.227" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.228"></a><span id="l96.228" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.229"></a><span id="l96.229" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.230"></a><span id="l96.230" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.231"></a><span id="l96.231" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.232"></a><span id="l96.232" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.233"></a><span id="l96.233" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.234"></a><span id="l96.234" class="difflineplus">+    // next week</span>
<a href="#l96.235"></a><span id="l96.235" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.236"></a><span id="l96.236" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.237"></a><span id="l96.237" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.238"></a><span id="l96.238" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.239"></a><span id="l96.239" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.240"></a><span id="l96.240" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.241"></a><span id="l96.241" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.242"></a><span id="l96.242" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.243"></a><span id="l96.243" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.244"></a><span id="l96.244" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.245"></a><span id="l96.245" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.246"></a><span id="l96.246" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.247"></a><span id="l96.247"> </span>
<a href="#l96.248"></a><span id="l96.248" class="difflineminus">-  // week view</span>
<a href="#l96.249"></a><span id="l96.249" class="difflineminus">-  calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l96.250"></a><span id="l96.250" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.251"></a><span id="l96.251" class="difflineplus">+    // week view</span>
<a href="#l96.252"></a><span id="l96.252" class="difflineplus">+    calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l96.253"></a><span id="l96.253" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.254"></a><span id="l96.254"> </span>
<a href="#l96.255"></a><span id="l96.255" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l96.256"></a><span id="l96.256" class="difflineminus">-    eventPath;</span>
<a href="#l96.257"></a><span id="l96.257" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.258"></a><span id="l96.258" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour) +</span>
<a href="#l96.259"></a><span id="l96.259" class="difflineplus">+      eventPath;</span>
<a href="#l96.260"></a><span id="l96.260" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.261"></a><span id="l96.261"> </span>
<a href="#l96.262"></a><span id="l96.262" class="difflineminus">-  tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l96.263"></a><span id="l96.263" class="difflineminus">-    'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l96.264"></a><span id="l96.264" class="difflineminus">-    'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l96.265"></a><span id="l96.265" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l96.266"></a><span id="l96.266" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l96.267"></a><span id="l96.267" class="difflineminus">-  // assert exactly two</span>
<a href="#l96.268"></a><span id="l96.268" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.269"></a><span id="l96.269" class="difflineminus">-    tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l96.270"></a><span id="l96.270" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.271"></a><span id="l96.271" class="difflineminus">-    tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l96.272"></a><span id="l96.272" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.273"></a><span id="l96.273" class="difflineminus">-    tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l96.274"></a><span id="l96.274" class="difflineplus">+    tuesPath = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l96.275"></a><span id="l96.275" class="difflineplus">+      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/' +</span>
<a href="#l96.276"></a><span id="l96.276" class="difflineplus">+      'id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l96.277"></a><span id="l96.277" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[dayIndex]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l96.278"></a><span id="l96.278" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[eventIndex]';</span>
<a href="#l96.279"></a><span id="l96.279" class="difflineplus">+    // assert exactly two</span>
<a href="#l96.280"></a><span id="l96.280" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.281"></a><span id="l96.281" class="difflineplus">+      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;0&quot;) + eventPath));</span>
<a href="#l96.282"></a><span id="l96.282" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.283"></a><span id="l96.283" class="difflineplus">+      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;1&quot;) + eventPath));</span>
<a href="#l96.284"></a><span id="l96.284" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document,</span>
<a href="#l96.285"></a><span id="l96.285" class="difflineplus">+      tuesPath.replace(&quot;dayIndex&quot;, &quot;2&quot;).replace(&quot;eventIndex&quot;, &quot;2&quot;) + eventPath));</span>
<a href="#l96.286"></a><span id="l96.286"> </span>
<a href="#l96.287"></a><span id="l96.287" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l96.288"></a><span id="l96.288" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.289"></a><span id="l96.289" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l96.290"></a><span id="l96.290" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.291"></a><span id="l96.291" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l96.292"></a><span id="l96.292" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.293"></a><span id="l96.293" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l96.294"></a><span id="l96.294" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.295"></a><span id="l96.295" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l96.296"></a><span id="l96.296" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.297"></a><span id="l96.297" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l96.298"></a><span id="l96.298" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.299"></a><span id="l96.299" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l96.300"></a><span id="l96.300" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.301"></a><span id="l96.301" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l96.302"></a><span id="l96.302" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.303"></a><span id="l96.303"> </span>
<a href="#l96.304"></a><span id="l96.304" class="difflineminus">-  calUtils.forward(controller, 1);</span>
<a href="#l96.305"></a><span id="l96.305" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l96.306"></a><span id="l96.306" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.307"></a><span id="l96.307" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l96.308"></a><span id="l96.308" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.309"></a><span id="l96.309" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l96.310"></a><span id="l96.310" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.311"></a><span id="l96.311" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l96.312"></a><span id="l96.312" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.313"></a><span id="l96.313" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l96.314"></a><span id="l96.314" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.315"></a><span id="l96.315" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l96.316"></a><span id="l96.316" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.317"></a><span id="l96.317" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l96.318"></a><span id="l96.318" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.319"></a><span id="l96.319" class="difflineplus">+    calUtils.forward(controller, 1);</span>
<a href="#l96.320"></a><span id="l96.320" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, hour);</span>
<a href="#l96.321"></a><span id="l96.321" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.322"></a><span id="l96.322" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 2, hour);</span>
<a href="#l96.323"></a><span id="l96.323" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.324"></a><span id="l96.324" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 3, hour);</span>
<a href="#l96.325"></a><span id="l96.325" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.326"></a><span id="l96.326" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 4, hour);</span>
<a href="#l96.327"></a><span id="l96.327" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.328"></a><span id="l96.328" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 5, hour);</span>
<a href="#l96.329"></a><span id="l96.329" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.330"></a><span id="l96.330" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 6, hour);</span>
<a href="#l96.331"></a><span id="l96.331" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.332"></a><span id="l96.332" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, hour);</span>
<a href="#l96.333"></a><span id="l96.333" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.334"></a><span id="l96.334"> </span>
<a href="#l96.335"></a><span id="l96.335" class="difflineminus">-  // multiweek view</span>
<a href="#l96.336"></a><span id="l96.336" class="difflineminus">-  calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l96.337"></a><span id="l96.337" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.338"></a><span id="l96.338" class="difflineminus">-  checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l96.339"></a><span id="l96.339" class="difflineplus">+    // multiweek view</span>
<a href="#l96.340"></a><span id="l96.340" class="difflineplus">+    calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l96.341"></a><span id="l96.341" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 5);</span>
<a href="#l96.342"></a><span id="l96.342" class="difflineplus">+    checkMultiWeekView(&quot;multiweek&quot;);</span>
<a href="#l96.343"></a><span id="l96.343"> </span>
<a href="#l96.344"></a><span id="l96.344" class="difflineminus">-  // month view</span>
<a href="#l96.345"></a><span id="l96.345" class="difflineminus">-  calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l96.346"></a><span id="l96.346" class="difflineminus">-  checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l96.347"></a><span id="l96.347" class="difflineplus">+    // month view</span>
<a href="#l96.348"></a><span id="l96.348" class="difflineplus">+    calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l96.349"></a><span id="l96.349" class="difflineplus">+    checkMultiWeekView(&quot;month&quot;);</span>
<a href="#l96.350"></a><span id="l96.350"> </span>
<a href="#l96.351"></a><span id="l96.351" class="difflineminus">-  // delete event</span>
<a href="#l96.352"></a><span id="l96.352" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l96.353"></a><span id="l96.353" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l96.354"></a><span id="l96.354" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.355"></a><span id="l96.355" class="difflineminus">-    eventPath;</span>
<a href="#l96.356"></a><span id="l96.356" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.357"></a><span id="l96.357" class="difflineminus">-  calUtils.handleParentDeletion(controller, false);</span>
<a href="#l96.358"></a><span id="l96.358" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l96.359"></a><span id="l96.359" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l96.360"></a><span id="l96.360" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.361"></a><span id="l96.361" class="difflineplus">+    // delete event</span>
<a href="#l96.362"></a><span id="l96.362" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l96.363"></a><span id="l96.363" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 12);</span>
<a href="#l96.364"></a><span id="l96.364" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l96.365"></a><span id="l96.365" class="difflineplus">+      eventPath;</span>
<a href="#l96.366"></a><span id="l96.366" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.367"></a><span id="l96.367" class="difflineplus">+    calUtils.handleParentDeletion(controller, false);</span>
<a href="#l96.368"></a><span id="l96.368" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l96.369"></a><span id="l96.369" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l96.370"></a><span id="l96.370" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, path));</span>
<a href="#l96.371"></a><span id="l96.371"> </span>
<a href="#l96.372"></a><span id="l96.372" class="difflineminus">-  // reset view</span>
<a href="#l96.373"></a><span id="l96.373" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l96.374"></a><span id="l96.374" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l96.375"></a><span id="l96.375" class="difflineminus">-    let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l96.376"></a><span id="l96.376" class="difflineminus">-    return view.orient == &quot;vertical&quot;;</span>
<a href="#l96.377"></a><span id="l96.377" class="difflineminus">-  });</span>
<a href="#l96.378"></a><span id="l96.378" class="difflineplus">+    // reset view</span>
<a href="#l96.379"></a><span id="l96.379" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnViewRotated&quot;);</span>
<a href="#l96.380"></a><span id="l96.380" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l96.381"></a><span id="l96.381" class="difflineplus">+        let view = (new elementslib.ID(controller.window.document, &quot;day-view&quot;)).getNode();</span>
<a href="#l96.382"></a><span id="l96.382" class="difflineplus">+        return view.orient == &quot;vertical&quot;;</span>
<a href="#l96.383"></a><span id="l96.383" class="difflineplus">+    });</span>
<a href="#l96.384"></a><span id="l96.384"> };</span>
<a href="#l96.385"></a><span id="l96.385"> </span>
<a href="#l96.386"></a><span id="l96.386"> function setRecurrence(recurrence) {</span>
<a href="#l96.387"></a><span id="l96.387" class="difflineminus">-  // weekly</span>
<a href="#l96.388"></a><span id="l96.388" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l96.389"></a><span id="l96.389" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l96.390"></a><span id="l96.390" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l96.391"></a><span id="l96.391" class="difflineplus">+    // weekly</span>
<a href="#l96.392"></a><span id="l96.392" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l96.393"></a><span id="l96.393" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l96.394"></a><span id="l96.394" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l96.395"></a><span id="l96.395"> </span>
<a href="#l96.396"></a><span id="l96.396" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l96.397"></a><span id="l96.397" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l96.398"></a><span id="l96.398" class="difflineminus">-  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l96.399"></a><span id="l96.399" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l96.400"></a><span id="l96.400" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l96.401"></a><span id="l96.401" class="difflineplus">+    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l96.402"></a><span id="l96.402"> </span>
<a href="#l96.403"></a><span id="l96.403" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l96.404"></a><span id="l96.404" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l96.405"></a><span id="l96.405" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l96.406"></a><span id="l96.406" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l96.407"></a><span id="l96.407" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l96.408"></a><span id="l96.408" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l96.409"></a><span id="l96.409"> </span>
<a href="#l96.410"></a><span id="l96.410" class="difflineminus">-  // starting from Monday so it should be checked</span>
<a href="#l96.411"></a><span id="l96.411" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l96.412"></a><span id="l96.412" class="difflineminus">-  // check Wednesday and Friday too</span>
<a href="#l96.413"></a><span id="l96.413" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l96.414"></a><span id="l96.414" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l96.415"></a><span id="l96.415" class="difflineplus">+    // starting from Monday so it should be checked</span>
<a href="#l96.416"></a><span id="l96.416" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l96.417"></a><span id="l96.417" class="difflineplus">+    // check Wednesday and Friday too</span>
<a href="#l96.418"></a><span id="l96.418" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l96.419"></a><span id="l96.419" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l96.420"></a><span id="l96.420"> </span>
<a href="#l96.421"></a><span id="l96.421" class="difflineminus">-  // close dialog</span>
<a href="#l96.422"></a><span id="l96.422" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l96.423"></a><span id="l96.423" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l96.424"></a><span id="l96.424" class="difflineplus">+    // close dialog</span>
<a href="#l96.425"></a><span id="l96.425" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l96.426"></a><span id="l96.426" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l96.427"></a><span id="l96.427"> }</span>
<a href="#l96.428"></a><span id="l96.428"> </span>
<a href="#l96.429"></a><span id="l96.429"> function changeRecurrence(recurrence) {</span>
<a href="#l96.430"></a><span id="l96.430" class="difflineminus">-  // weekly</span>
<a href="#l96.431"></a><span id="l96.431" class="difflineminus">-  recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l96.432"></a><span id="l96.432" class="difflineminus">-  recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l96.433"></a><span id="l96.433" class="difflineminus">-  recurrence.sleep(sleep);</span>
<a href="#l96.434"></a><span id="l96.434" class="difflineplus">+    // weekly</span>
<a href="#l96.435"></a><span id="l96.435" class="difflineplus">+    recurrence.waitForElement(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;));</span>
<a href="#l96.436"></a><span id="l96.436" class="difflineplus">+    recurrence.select(new elementslib.ID(recurrence.window.document, &quot;period-list&quot;), undefined, undefined, &quot;1&quot;);</span>
<a href="#l96.437"></a><span id="l96.437" class="difflineplus">+    recurrence.sleep(sleep);</span>
<a href="#l96.438"></a><span id="l96.438"> </span>
<a href="#l96.439"></a><span id="l96.439" class="difflineminus">-  let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l96.440"></a><span id="l96.440" class="difflineminus">-  let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l96.441"></a><span id="l96.441" class="difflineminus">-  let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l96.442"></a><span id="l96.442" class="difflineminus">-  let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l96.443"></a><span id="l96.443" class="difflineplus">+    let mon = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.2.Mmm&quot;);</span>
<a href="#l96.444"></a><span id="l96.444" class="difflineplus">+    let tue = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.3.Mmm&quot;);</span>
<a href="#l96.445"></a><span id="l96.445" class="difflineplus">+    let wed = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.4.Mmm&quot;);</span>
<a href="#l96.446"></a><span id="l96.446" class="difflineplus">+    let fri = utils.getProperty(&quot;chrome://calendar/locale/dateFormat.properties&quot;, &quot;day.6.Mmm&quot;);</span>
<a href="#l96.447"></a><span id="l96.447"> </span>
<a href="#l96.448"></a><span id="l96.448" class="difflineminus">-  let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l96.449"></a><span id="l96.449" class="difflineminus">-    'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l96.450"></a><span id="l96.450" class="difflineminus">-    'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l96.451"></a><span id="l96.451" class="difflineplus">+    let days = '/id(&quot;calendar-event-dialog-recurrence&quot;)/id(&quot;recurrence-pattern-groupbox&quot;)/' +</span>
<a href="#l96.452"></a><span id="l96.452" class="difflineplus">+      'id(&quot;recurrence-pattern-grid&quot;)/id(&quot;recurrence-pattern-rows&quot;)/id(&quot;recurrence-pattern-period-row&quot;)/' +</span>
<a href="#l96.453"></a><span id="l96.453" class="difflineplus">+      'id(&quot;period-deck&quot;)/id(&quot;period-deck-weekly-box&quot;)/[1]/id(&quot;daypicker-weekday&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/';</span>
<a href="#l96.454"></a><span id="l96.454"> </span>
<a href="#l96.455"></a><span id="l96.455" class="difflineminus">-  // check old rule</span>
<a href="#l96.456"></a><span id="l96.456" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l96.457"></a><span id="l96.457" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l96.458"></a><span id="l96.458" class="difflineminus">-  recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l96.459"></a><span id="l96.459" class="difflineplus">+    // check old rule</span>
<a href="#l96.460"></a><span id="l96.460" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + mon + '&quot;}'));</span>
<a href="#l96.461"></a><span id="l96.461" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + wed + '&quot;}'));</span>
<a href="#l96.462"></a><span id="l96.462" class="difflineplus">+    recurrence.assertChecked(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + fri + '&quot;}'));</span>
<a href="#l96.463"></a><span id="l96.463"> </span>
<a href="#l96.464"></a><span id="l96.464" class="difflineminus">-  // check Tuesday</span>
<a href="#l96.465"></a><span id="l96.465" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l96.466"></a><span id="l96.466" class="difflineplus">+    // check Tuesday</span>
<a href="#l96.467"></a><span id="l96.467" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, days + '{&quot;label&quot;:&quot;' + tue + '&quot;}'));</span>
<a href="#l96.468"></a><span id="l96.468"> </span>
<a href="#l96.469"></a><span id="l96.469" class="difflineminus">-  // close dialog</span>
<a href="#l96.470"></a><span id="l96.470" class="difflineminus">-  recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l96.471"></a><span id="l96.471" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l96.472"></a><span id="l96.472" class="difflineplus">+    // close dialog</span>
<a href="#l96.473"></a><span id="l96.473" class="difflineplus">+    recurrence.click(new elementslib.Lookup(recurrence.window.document, '/id(&quot;calendar-event-dialog-recurrence&quot;)/' +</span>
<a href="#l96.474"></a><span id="l96.474" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l96.475"></a><span id="l96.475"> }</span>
<a href="#l96.476"></a><span id="l96.476"> </span>
<a href="#l96.477"></a><span id="l96.477"> function checkMultiWeekView(view) {</span>
<a href="#l96.478"></a><span id="l96.478" class="difflineminus">-  let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l96.479"></a><span id="l96.479" class="difflineplus">+    let startWeek = view == &quot;multiweek&quot; ? 1 : 2;</span>
<a href="#l96.480"></a><span id="l96.480"> </span>
<a href="#l96.481"></a><span id="l96.481" class="difflineminus">-  let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l96.482"></a><span id="l96.482" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.483"></a><span id="l96.483" class="difflineminus">-  // assert exactly two</span>
<a href="#l96.484"></a><span id="l96.484" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l96.485"></a><span id="l96.485" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[0]&quot;));</span>
<a href="#l96.486"></a><span id="l96.486" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l96.487"></a><span id="l96.487" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[1]&quot;));</span>
<a href="#l96.488"></a><span id="l96.488" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l96.489"></a><span id="l96.489" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + &quot;/[2]&quot;));</span>
<a href="#l96.490"></a><span id="l96.490" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l96.491"></a><span id="l96.491" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.492"></a><span id="l96.492" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l96.493"></a><span id="l96.493" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.494"></a><span id="l96.494" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l96.495"></a><span id="l96.495" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.496"></a><span id="l96.496" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l96.497"></a><span id="l96.497" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.498"></a><span id="l96.498" class="difflineplus">+    let path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 2, hour);</span>
<a href="#l96.499"></a><span id="l96.499" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.500"></a><span id="l96.500" class="difflineplus">+    // assert exactly two</span>
<a href="#l96.501"></a><span id="l96.501" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l96.502"></a><span id="l96.502" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[0]&quot;));</span>
<a href="#l96.503"></a><span id="l96.503" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l96.504"></a><span id="l96.504" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + &quot;/[1]&quot;));</span>
<a href="#l96.505"></a><span id="l96.505" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 3, hour);</span>
<a href="#l96.506"></a><span id="l96.506" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + &quot;/[2]&quot;));</span>
<a href="#l96.507"></a><span id="l96.507" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 4, hour);</span>
<a href="#l96.508"></a><span id="l96.508" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.509"></a><span id="l96.509" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 5, hour);</span>
<a href="#l96.510"></a><span id="l96.510" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.511"></a><span id="l96.511" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 6, hour);</span>
<a href="#l96.512"></a><span id="l96.512" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.513"></a><span id="l96.513" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek, 7, hour);</span>
<a href="#l96.514"></a><span id="l96.514" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.515"></a><span id="l96.515"> </span>
<a href="#l96.516"></a><span id="l96.516" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l96.517"></a><span id="l96.517" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.518"></a><span id="l96.518" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l96.519"></a><span id="l96.519" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.520"></a><span id="l96.520" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l96.521"></a><span id="l96.521" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.522"></a><span id="l96.522" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l96.523"></a><span id="l96.523" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.524"></a><span id="l96.524" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l96.525"></a><span id="l96.525" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.526"></a><span id="l96.526" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l96.527"></a><span id="l96.527" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.528"></a><span id="l96.528" class="difflineminus">-  path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l96.529"></a><span id="l96.529" class="difflineminus">-  controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.530"></a><span id="l96.530" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 1, hour);</span>
<a href="#l96.531"></a><span id="l96.531" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.532"></a><span id="l96.532" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 2, hour);</span>
<a href="#l96.533"></a><span id="l96.533" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.534"></a><span id="l96.534" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 3, hour);</span>
<a href="#l96.535"></a><span id="l96.535" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.536"></a><span id="l96.536" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 4, hour);</span>
<a href="#l96.537"></a><span id="l96.537" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.538"></a><span id="l96.538" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 5, hour);</span>
<a href="#l96.539"></a><span id="l96.539" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.540"></a><span id="l96.540" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 6, hour);</span>
<a href="#l96.541"></a><span id="l96.541" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.542"></a><span id="l96.542" class="difflineplus">+    path = calUtils.getEventBoxPath(controller, view, calUtils.EVENT_BOX, startWeek + 1, 7, hour);</span>
<a href="#l96.543"></a><span id="l96.543" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, path + eventPath));</span>
<a href="#l96.544"></a><span id="l96.544"> }</span>
<a href="#l96.545"></a><span id="l96.545"> </span>
<a href="#l96.546"></a><span id="l96.546"> var teardownTest = function(module) {</span>
<a href="#l96.547"></a><span id="l96.547" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l96.548"></a><span id="l96.548" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l96.549"></a><span id="l96.549"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/calendar-utils.js</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -17,345 +17,345 @@ var EVENT_BOX = 0; // Use when you need </span>
<a href="#l97.4"></a><span id="l97.4"> var CANVAS_BOX = 1; // Use when you need a calendar canvas box</span>
<a href="#l97.5"></a><span id="l97.5"> var ALLDAY = 2; // Use when you need an allday canvas or event box</span>
<a href="#l97.6"></a><span id="l97.6"> </span>
<a href="#l97.7"></a><span id="l97.7"> /**</span>
<a href="#l97.8"></a><span id="l97.8">  *  Accept to send notification email with event to attendees</span>
<a href="#l97.9"></a><span id="l97.9">  *  @param controller - Mozmill window controller</span>
<a href="#l97.10"></a><span id="l97.10">  */</span>
<a href="#l97.11"></a><span id="l97.11"> function acceptSendingNotificationMail(controller) {</span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-  modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (dialog) =&gt; {</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineminus">-      dialog.waitThenClick(new elementslib.Lookup(dialog.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l97.14"></a><span id="l97.14" class="difflineminus">-        'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l97.15"></a><span id="l97.15" class="difflineplus">+    modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (dialog) =&gt; {</span>
<a href="#l97.16"></a><span id="l97.16" class="difflineplus">+        dialog.waitThenClick(new elementslib.Lookup(dialog.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l97.17"></a><span id="l97.17" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l97.18"></a><span id="l97.18">     }</span>
<a href="#l97.19"></a><span id="l97.19">   );</span>
<a href="#l97.20"></a><span id="l97.20"> </span>
<a href="#l97.21"></a><span id="l97.21" class="difflineminus">-  modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l97.22"></a><span id="l97.22" class="difflineplus">+    modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l97.23"></a><span id="l97.23"> }</span>
<a href="#l97.24"></a><span id="l97.24"> </span>
<a href="#l97.25"></a><span id="l97.25"> /**</span>
<a href="#l97.26"></a><span id="l97.26">  *  Add an attachment with url</span>
<a href="#l97.27"></a><span id="l97.27">  *  @param controller - Mozmill window controller</span>
<a href="#l97.28"></a><span id="l97.28">  */</span>
<a href="#l97.29"></a><span id="l97.29"> function handleAddingAttachment(controller, url) {</span>
<a href="#l97.30"></a><span id="l97.30" class="difflineminus">-  modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (attachment) =&gt; {</span>
<a href="#l97.31"></a><span id="l97.31" class="difflineminus">-    let input = new elementslib.ID(attachment.window.document, &quot;loginTextbox&quot;);</span>
<a href="#l97.32"></a><span id="l97.32" class="difflineminus">-    attachment.waitForElement(input);</span>
<a href="#l97.33"></a><span id="l97.33" class="difflineminus">-    input.getNode().value = url;</span>
<a href="#l97.34"></a><span id="l97.34" class="difflineminus">-    attachment.click(new elementslib.Lookup(attachment.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l97.35"></a><span id="l97.35" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l97.36"></a><span id="l97.36" class="difflineminus">-  });</span>
<a href="#l97.37"></a><span id="l97.37" class="difflineplus">+    modalDialog.plan_for_modal_dialog(&quot;commonDialog&quot;, (attachment) =&gt; {</span>
<a href="#l97.38"></a><span id="l97.38" class="difflineplus">+        let input = new elementslib.ID(attachment.window.document, &quot;loginTextbox&quot;);</span>
<a href="#l97.39"></a><span id="l97.39" class="difflineplus">+        attachment.waitForElement(input);</span>
<a href="#l97.40"></a><span id="l97.40" class="difflineplus">+        input.getNode().value = url;</span>
<a href="#l97.41"></a><span id="l97.41" class="difflineplus">+        attachment.click(new elementslib.Lookup(attachment.window.document, '/id(&quot;commonDialog&quot;)/' +</span>
<a href="#l97.42"></a><span id="l97.42" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l97.43"></a><span id="l97.43" class="difflineplus">+    });</span>
<a href="#l97.44"></a><span id="l97.44"> </span>
<a href="#l97.45"></a><span id="l97.45" class="difflineminus">-  modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l97.46"></a><span id="l97.46" class="difflineplus">+    modalDialog.wait_for_modal_dialog(&quot;commonDialog&quot;);</span>
<a href="#l97.47"></a><span id="l97.47"> }</span>
<a href="#l97.48"></a><span id="l97.48"> </span>
<a href="#l97.49"></a><span id="l97.49"> /**</span>
<a href="#l97.50"></a><span id="l97.50">  *  Choose to delete just one occurrence of a repeating event</span>
<a href="#l97.51"></a><span id="l97.51">  *  @param controller - Mozmill window controller</span>
<a href="#l97.52"></a><span id="l97.52">  *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l97.53"></a><span id="l97.53">  */</span>
<a href="#l97.54"></a><span id="l97.54"> function handleOccurrenceDeletion(controller, attendees) {</span>
<a href="#l97.55"></a><span id="l97.55" class="difflineminus">-  let dialog = new modalDialog.modalDialog(controller.window);</span>
<a href="#l97.56"></a><span id="l97.56" class="difflineminus">-  dialog.start((dialogController) =&gt; {</span>
<a href="#l97.57"></a><span id="l97.57" class="difflineminus">-    if (attendees) {</span>
<a href="#l97.58"></a><span id="l97.58" class="difflineminus">-      acceptSendingNotificationMail();</span>
<a href="#l97.59"></a><span id="l97.59" class="difflineminus">-    }</span>
<a href="#l97.60"></a><span id="l97.60" class="difflineminus">-    dialogController.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-occurrence-button&quot;));</span>
<a href="#l97.61"></a><span id="l97.61" class="difflineminus">-  });</span>
<a href="#l97.62"></a><span id="l97.62" class="difflineplus">+    let dialog = new modalDialog.modalDialog(controller.window);</span>
<a href="#l97.63"></a><span id="l97.63" class="difflineplus">+    dialog.start((dialogController) =&gt; {</span>
<a href="#l97.64"></a><span id="l97.64" class="difflineplus">+        if (attendees) {</span>
<a href="#l97.65"></a><span id="l97.65" class="difflineplus">+            acceptSendingNotificationMail();</span>
<a href="#l97.66"></a><span id="l97.66" class="difflineplus">+        }</span>
<a href="#l97.67"></a><span id="l97.67" class="difflineplus">+        dialogController.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-occurrence-button&quot;));</span>
<a href="#l97.68"></a><span id="l97.68" class="difflineplus">+    });</span>
<a href="#l97.69"></a><span id="l97.69"> }</span>
<a href="#l97.70"></a><span id="l97.70"> </span>
<a href="#l97.71"></a><span id="l97.71"> /**</span>
<a href="#l97.72"></a><span id="l97.72">  *  Choose to delete all occurrences of a repeating event</span>
<a href="#l97.73"></a><span id="l97.73">  *  @param controller - Mozmill window controller</span>
<a href="#l97.74"></a><span id="l97.74">  *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l97.75"></a><span id="l97.75">  */</span>
<a href="#l97.76"></a><span id="l97.76"> function handleParentDeletion(controller, attendees) {</span>
<a href="#l97.77"></a><span id="l97.77" class="difflineminus">-  let dialog = new modalDialog.modalDialog(controller.window);</span>
<a href="#l97.78"></a><span id="l97.78" class="difflineminus">-  dialog.start((dialogController) =&gt; {</span>
<a href="#l97.79"></a><span id="l97.79" class="difflineminus">-    if (attendees) {</span>
<a href="#l97.80"></a><span id="l97.80" class="difflineminus">-      acceptSendingNotificationMail();</span>
<a href="#l97.81"></a><span id="l97.81" class="difflineminus">-    }</span>
<a href="#l97.82"></a><span id="l97.82" class="difflineminus">-    dialogController.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-parent-button&quot;));</span>
<a href="#l97.83"></a><span id="l97.83" class="difflineminus">-  });</span>
<a href="#l97.84"></a><span id="l97.84" class="difflineplus">+    let dialog = new modalDialog.modalDialog(controller.window);</span>
<a href="#l97.85"></a><span id="l97.85" class="difflineplus">+    dialog.start((dialogController) =&gt; {</span>
<a href="#l97.86"></a><span id="l97.86" class="difflineplus">+        if (attendees) {</span>
<a href="#l97.87"></a><span id="l97.87" class="difflineplus">+            acceptSendingNotificationMail();</span>
<a href="#l97.88"></a><span id="l97.88" class="difflineplus">+        }</span>
<a href="#l97.89"></a><span id="l97.89" class="difflineplus">+        dialogController.waitThenClick(new elementslib.ID(dialog.window.document, &quot;accept-parent-button&quot;));</span>
<a href="#l97.90"></a><span id="l97.90" class="difflineplus">+    });</span>
<a href="#l97.91"></a><span id="l97.91"> }</span>
<a href="#l97.92"></a><span id="l97.92"> </span>
<a href="#l97.93"></a><span id="l97.93"> /**</span>
<a href="#l97.94"></a><span id="l97.94">  *  Choose to modify just one occurrence of a repeating event</span>
<a href="#l97.95"></a><span id="l97.95">  *  @param controller - Mozmill window controller</span>
<a href="#l97.96"></a><span id="l97.96">  *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l97.97"></a><span id="l97.97">  */</span>
<a href="#l97.98"></a><span id="l97.98"> function handleOccurrenceModification(controller, attendees) {</span>
<a href="#l97.99"></a><span id="l97.99" class="difflineminus">-  handleOccurrenceDeletion(controller, attendees);</span>
<a href="#l97.100"></a><span id="l97.100" class="difflineplus">+    handleOccurrenceDeletion(controller, attendees);</span>
<a href="#l97.101"></a><span id="l97.101"> }</span>
<a href="#l97.102"></a><span id="l97.102"> </span>
<a href="#l97.103"></a><span id="l97.103"> /**</span>
<a href="#l97.104"></a><span id="l97.104">  *  Choose to modify all occurrences of a repeating event</span>
<a href="#l97.105"></a><span id="l97.105">  *  @param controller - Mozmill window controller</span>
<a href="#l97.106"></a><span id="l97.106">  *  @param attendees - whether there are attendees that can be notified or not</span>
<a href="#l97.107"></a><span id="l97.107">  */</span>
<a href="#l97.108"></a><span id="l97.108"> function handleParentModification(controller, attendees) {</span>
<a href="#l97.109"></a><span id="l97.109" class="difflineminus">-  handleParentDeletion(controller, attendees);</span>
<a href="#l97.110"></a><span id="l97.110" class="difflineplus">+    handleParentDeletion(controller, attendees);</span>
<a href="#l97.111"></a><span id="l97.111"> }</span>
<a href="#l97.112"></a><span id="l97.112"> </span>
<a href="#l97.113"></a><span id="l97.113"> /**</span>
<a href="#l97.114"></a><span id="l97.114">  *  Switch to a view</span>
<a href="#l97.115"></a><span id="l97.115">  *  @param controller - Mozmill window controller</span>
<a href="#l97.116"></a><span id="l97.116">  *  @param view - day, week, multiweek or month</span>
<a href="#l97.117"></a><span id="l97.117">  */</span>
<a href="#l97.118"></a><span id="l97.118"> function switchToView(controller, view) {</span>
<a href="#l97.119"></a><span id="l97.119" class="difflineminus">-  switch (view) {</span>
<a href="#l97.120"></a><span id="l97.120" class="difflineminus">-    case &quot;week&quot;:</span>
<a href="#l97.121"></a><span id="l97.121" class="difflineminus">-      controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.122"></a><span id="l97.122" class="difflineminus">-        &quot;calendar-week-view-button&quot;));</span>
<a href="#l97.123"></a><span id="l97.123" class="difflineminus">-      controller.waitFor(() =&gt; {</span>
<a href="#l97.124"></a><span id="l97.124" class="difflineminus">-        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.125"></a><span id="l97.125" class="difflineminus">-        &quot;calendar-week-view-button&quot;);</span>
<a href="#l97.126"></a><span id="l97.126" class="difflineminus">-        return button.getNode().selected == true;</span>
<a href="#l97.127"></a><span id="l97.127" class="difflineminus">-      });</span>
<a href="#l97.128"></a><span id="l97.128" class="difflineminus">-      break;</span>
<a href="#l97.129"></a><span id="l97.129" class="difflineminus">-    case &quot;multiweek&quot;:</span>
<a href="#l97.130"></a><span id="l97.130" class="difflineminus">-      controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.131"></a><span id="l97.131" class="difflineminus">-        &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l97.132"></a><span id="l97.132" class="difflineminus">-      controller.waitFor(() =&gt; {</span>
<a href="#l97.133"></a><span id="l97.133" class="difflineminus">-        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.134"></a><span id="l97.134" class="difflineminus">-        &quot;calendar-multiweek-view-button&quot;);</span>
<a href="#l97.135"></a><span id="l97.135" class="difflineminus">-        return button.getNode().selected == true;</span>
<a href="#l97.136"></a><span id="l97.136" class="difflineminus">-      });</span>
<a href="#l97.137"></a><span id="l97.137" class="difflineminus">-      break;</span>
<a href="#l97.138"></a><span id="l97.138" class="difflineminus">-    case &quot;month&quot;:</span>
<a href="#l97.139"></a><span id="l97.139" class="difflineminus">-      controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.140"></a><span id="l97.140" class="difflineminus">-        &quot;calendar-month-view-button&quot;));</span>
<a href="#l97.141"></a><span id="l97.141" class="difflineminus">-      controller.waitFor(() =&gt; {</span>
<a href="#l97.142"></a><span id="l97.142" class="difflineminus">-        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.143"></a><span id="l97.143" class="difflineminus">-        &quot;calendar-month-view-button&quot;);</span>
<a href="#l97.144"></a><span id="l97.144" class="difflineminus">-        return button.getNode().selected == true;</span>
<a href="#l97.145"></a><span id="l97.145" class="difflineminus">-      });</span>
<a href="#l97.146"></a><span id="l97.146" class="difflineminus">-      break;</span>
<a href="#l97.147"></a><span id="l97.147" class="difflineminus">-    default:</span>
<a href="#l97.148"></a><span id="l97.148" class="difflineminus">-      controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.149"></a><span id="l97.149" class="difflineminus">-        &quot;calendar-day-view-button&quot;));</span>
<a href="#l97.150"></a><span id="l97.150" class="difflineminus">-      controller.waitFor(() =&gt; {</span>
<a href="#l97.151"></a><span id="l97.151" class="difflineminus">-        let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.152"></a><span id="l97.152" class="difflineminus">-        &quot;calendar-day-view-button&quot;);</span>
<a href="#l97.153"></a><span id="l97.153" class="difflineminus">-        return button.getNode().selected == true;</span>
<a href="#l97.154"></a><span id="l97.154" class="difflineminus">-      });</span>
<a href="#l97.155"></a><span id="l97.155" class="difflineminus">-  }</span>
<a href="#l97.156"></a><span id="l97.156" class="difflineplus">+    switch (view) {</span>
<a href="#l97.157"></a><span id="l97.157" class="difflineplus">+        case &quot;week&quot;:</span>
<a href="#l97.158"></a><span id="l97.158" class="difflineplus">+            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.159"></a><span id="l97.159" class="difflineplus">+              &quot;calendar-week-view-button&quot;));</span>
<a href="#l97.160"></a><span id="l97.160" class="difflineplus">+            controller.waitFor(() =&gt; {</span>
<a href="#l97.161"></a><span id="l97.161" class="difflineplus">+                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.162"></a><span id="l97.162" class="difflineplus">+                &quot;calendar-week-view-button&quot;);</span>
<a href="#l97.163"></a><span id="l97.163" class="difflineplus">+                return button.getNode().selected == true;</span>
<a href="#l97.164"></a><span id="l97.164" class="difflineplus">+            });</span>
<a href="#l97.165"></a><span id="l97.165" class="difflineplus">+            break;</span>
<a href="#l97.166"></a><span id="l97.166" class="difflineplus">+        case &quot;multiweek&quot;:</span>
<a href="#l97.167"></a><span id="l97.167" class="difflineplus">+            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.168"></a><span id="l97.168" class="difflineplus">+              &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l97.169"></a><span id="l97.169" class="difflineplus">+            controller.waitFor(() =&gt; {</span>
<a href="#l97.170"></a><span id="l97.170" class="difflineplus">+                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.171"></a><span id="l97.171" class="difflineplus">+                &quot;calendar-multiweek-view-button&quot;);</span>
<a href="#l97.172"></a><span id="l97.172" class="difflineplus">+                return button.getNode().selected == true;</span>
<a href="#l97.173"></a><span id="l97.173" class="difflineplus">+            });</span>
<a href="#l97.174"></a><span id="l97.174" class="difflineplus">+            break;</span>
<a href="#l97.175"></a><span id="l97.175" class="difflineplus">+        case &quot;month&quot;:</span>
<a href="#l97.176"></a><span id="l97.176" class="difflineplus">+            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.177"></a><span id="l97.177" class="difflineplus">+              &quot;calendar-month-view-button&quot;));</span>
<a href="#l97.178"></a><span id="l97.178" class="difflineplus">+            controller.waitFor(() =&gt; {</span>
<a href="#l97.179"></a><span id="l97.179" class="difflineplus">+                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.180"></a><span id="l97.180" class="difflineplus">+                &quot;calendar-month-view-button&quot;);</span>
<a href="#l97.181"></a><span id="l97.181" class="difflineplus">+                return button.getNode().selected == true;</span>
<a href="#l97.182"></a><span id="l97.182" class="difflineplus">+            });</span>
<a href="#l97.183"></a><span id="l97.183" class="difflineplus">+            break;</span>
<a href="#l97.184"></a><span id="l97.184" class="difflineplus">+        default:</span>
<a href="#l97.185"></a><span id="l97.185" class="difflineplus">+            controller.waitThenClick(new elementslib.ID(controller.window.document,</span>
<a href="#l97.186"></a><span id="l97.186" class="difflineplus">+              &quot;calendar-day-view-button&quot;));</span>
<a href="#l97.187"></a><span id="l97.187" class="difflineplus">+            controller.waitFor(() =&gt; {</span>
<a href="#l97.188"></a><span id="l97.188" class="difflineplus">+                let button = new elementslib.ID(controller.window.document,</span>
<a href="#l97.189"></a><span id="l97.189" class="difflineplus">+                &quot;calendar-day-view-button&quot;);</span>
<a href="#l97.190"></a><span id="l97.190" class="difflineplus">+                return button.getNode().selected == true;</span>
<a href="#l97.191"></a><span id="l97.191" class="difflineplus">+            });</span>
<a href="#l97.192"></a><span id="l97.192" class="difflineplus">+    }</span>
<a href="#l97.193"></a><span id="l97.193"> }</span>
<a href="#l97.194"></a><span id="l97.194"> </span>
<a href="#l97.195"></a><span id="l97.195"> /**</span>
<a href="#l97.196"></a><span id="l97.196">  *  Go to a specific date using minimonth</span>
<a href="#l97.197"></a><span id="l97.197">  *  @param controller - main window controller</span>
<a href="#l97.198"></a><span id="l97.198">  *  @param year - four-digit year</span>
<a href="#l97.199"></a><span id="l97.199">  *  @param month - 1-based index of a month</span>
<a href="#l97.200"></a><span id="l97.200">  *  @param day - 1-based index of a day</span>
<a href="#l97.201"></a><span id="l97.201">  */</span>
<a href="#l97.202"></a><span id="l97.202"> function goToDate(controller, year, month, day) {</span>
<a href="#l97.203"></a><span id="l97.203" class="difflineminus">-  let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l97.204"></a><span id="l97.204" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l97.205"></a><span id="l97.205" class="difflineminus">-    'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l97.206"></a><span id="l97.206" class="difflineminus">-  let activeYear = (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.207"></a><span id="l97.207" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.208"></a><span id="l97.208" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l97.209"></a><span id="l97.209" class="difflineminus">-  let activeMonth = (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.210"></a><span id="l97.210" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.211"></a><span id="l97.211" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;index&quot;);</span>
<a href="#l97.212"></a><span id="l97.212" class="difflineminus">-  let yearDifference = activeYear - year;</span>
<a href="#l97.213"></a><span id="l97.213" class="difflineminus">-  let monthDifference = activeMonth - (month - 1);</span>
<a href="#l97.214"></a><span id="l97.214" class="difflineplus">+    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l97.215"></a><span id="l97.215" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l97.216"></a><span id="l97.216" class="difflineplus">+      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l97.217"></a><span id="l97.217" class="difflineplus">+    let activeYear = (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.218"></a><span id="l97.218" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.219"></a><span id="l97.219" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l97.220"></a><span id="l97.220" class="difflineplus">+    let activeMonth = (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.221"></a><span id="l97.221" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.222"></a><span id="l97.222" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;current&quot;:&quot;true&quot;}')).getNode().getAttribute(&quot;index&quot;);</span>
<a href="#l97.223"></a><span id="l97.223" class="difflineplus">+    let yearDifference = activeYear - year;</span>
<a href="#l97.224"></a><span id="l97.224" class="difflineplus">+    let monthDifference = activeMonth - (month - 1);</span>
<a href="#l97.225"></a><span id="l97.225"> </span>
<a href="#l97.226"></a><span id="l97.226" class="difflineminus">-  if (yearDifference != 0) {</span>
<a href="#l97.227"></a><span id="l97.227" class="difflineminus">-    let scrollArrow = yearDifference &gt; 0</span>
<a href="#l97.228"></a><span id="l97.228" class="difflineminus">-      ? (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.229"></a><span id="l97.229" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.230"></a><span id="l97.230" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-up&quot;}')).getNode()</span>
<a href="#l97.231"></a><span id="l97.231" class="difflineminus">-      : (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.232"></a><span id="l97.232" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.233"></a><span id="l97.233" class="difflineminus">-          'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-down&quot;}')).getNode();</span>
<a href="#l97.234"></a><span id="l97.234" class="difflineplus">+    if (yearDifference != 0) {</span>
<a href="#l97.235"></a><span id="l97.235" class="difflineplus">+        let scrollArrow = yearDifference &gt; 0</span>
<a href="#l97.236"></a><span id="l97.236" class="difflineplus">+          ? (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.237"></a><span id="l97.237" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.238"></a><span id="l97.238" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-up&quot;}')).getNode()</span>
<a href="#l97.239"></a><span id="l97.239" class="difflineplus">+          : (new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.240"></a><span id="l97.240" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.241"></a><span id="l97.241" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;class&quot;:&quot;autorepeatbutton-down&quot;}')).getNode();</span>
<a href="#l97.242"></a><span id="l97.242"> </span>
<a href="#l97.243"></a><span id="l97.243" class="difflineminus">-    // pick year</span>
<a href="#l97.244"></a><span id="l97.244" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.245"></a><span id="l97.245" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l97.246"></a><span id="l97.246" class="difflineminus">-    controller.sleep(500);</span>
<a href="#l97.247"></a><span id="l97.247" class="difflineplus">+        // pick year</span>
<a href="#l97.248"></a><span id="l97.248" class="difflineplus">+        controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.249"></a><span id="l97.249" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l97.250"></a><span id="l97.250" class="difflineplus">+        controller.sleep(500);</span>
<a href="#l97.251"></a><span id="l97.251"> </span>
<a href="#l97.252"></a><span id="l97.252" class="difflineminus">-    for (let i = 0; i &lt; Math.abs(yearDifference); i++) {</span>
<a href="#l97.253"></a><span id="l97.253" class="difflineminus">-      scrollArrow.doCommand();</span>
<a href="#l97.254"></a><span id="l97.254" class="difflineminus">-      controller.sleep(100);</span>
<a href="#l97.255"></a><span id="l97.255" class="difflineplus">+        for (let i = 0; i &lt; Math.abs(yearDifference); i++) {</span>
<a href="#l97.256"></a><span id="l97.256" class="difflineplus">+            scrollArrow.doCommand();</span>
<a href="#l97.257"></a><span id="l97.257" class="difflineplus">+            controller.sleep(100);</span>
<a href="#l97.258"></a><span id="l97.258" class="difflineplus">+        }</span>
<a href="#l97.259"></a><span id="l97.259" class="difflineplus">+</span>
<a href="#l97.260"></a><span id="l97.260" class="difflineplus">+        controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.261"></a><span id="l97.261" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.262"></a><span id="l97.262" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;' + year + '&quot;}'));</span>
<a href="#l97.263"></a><span id="l97.263" class="difflineplus">+        controller.sleep(500);</span>
<a href="#l97.264"></a><span id="l97.264">     }</span>
<a href="#l97.265"></a><span id="l97.265"> </span>
<a href="#l97.266"></a><span id="l97.266" class="difflineminus">-    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.267"></a><span id="l97.267" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.268"></a><span id="l97.268" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;' + year + '&quot;}'));</span>
<a href="#l97.269"></a><span id="l97.269" class="difflineminus">-    controller.sleep(500);</span>
<a href="#l97.270"></a><span id="l97.270" class="difflineminus">-  }</span>
<a href="#l97.271"></a><span id="l97.271" class="difflineplus">+    if (monthDifference != 0) {</span>
<a href="#l97.272"></a><span id="l97.272" class="difflineplus">+        // pick month</span>
<a href="#l97.273"></a><span id="l97.273" class="difflineplus">+        controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.274"></a><span id="l97.274" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})/[' + activeMonth +</span>
<a href="#l97.275"></a><span id="l97.275" class="difflineplus">+          &quot;]&quot;));</span>
<a href="#l97.276"></a><span id="l97.276" class="difflineplus">+        controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.277"></a><span id="l97.277" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.278"></a><span id="l97.278" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;' + (month - 1) + '&quot;}'));</span>
<a href="#l97.279"></a><span id="l97.279" class="difflineplus">+        controller.sleep(500);</span>
<a href="#l97.280"></a><span id="l97.280" class="difflineplus">+    }</span>
<a href="#l97.281"></a><span id="l97.281"> </span>
<a href="#l97.282"></a><span id="l97.282" class="difflineminus">-  if (monthDifference != 0) {</span>
<a href="#l97.283"></a><span id="l97.283" class="difflineminus">-    // pick month</span>
<a href="#l97.284"></a><span id="l97.284" class="difflineplus">+    let lastDayInFirstRow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l97.285"></a><span id="l97.285" class="difflineplus">+      miniMonth + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/[6]')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l97.286"></a><span id="l97.286" class="difflineplus">+    let positionOfFirst = 7 - lastDayInFirstRow;</span>
<a href="#l97.287"></a><span id="l97.287" class="difflineplus">+    let dateColumn = (positionOfFirst + day - 1) % 7;</span>
<a href="#l97.288"></a><span id="l97.288" class="difflineplus">+    let dateRow = Math.floor((positionOfFirst + day - 1) / 7);</span>
<a href="#l97.289"></a><span id="l97.289" class="difflineplus">+</span>
<a href="#l97.290"></a><span id="l97.290" class="difflineplus">+    // pick day</span>
<a href="#l97.291"></a><span id="l97.291">     controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.292"></a><span id="l97.292" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})/[' + activeMonth +</span>
<a href="#l97.293"></a><span id="l97.293" class="difflineminus">-      &quot;]&quot;));</span>
<a href="#l97.294"></a><span id="l97.294" class="difflineminus">-    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.295"></a><span id="l97.295" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l97.296"></a><span id="l97.296" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;' + (month - 1) + '&quot;}'));</span>
<a href="#l97.297"></a><span id="l97.297" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[' + (dateRow + 1) + &quot;]/[&quot; + dateColumn + &quot;]&quot;));</span>
<a href="#l97.298"></a><span id="l97.298">     controller.sleep(500);</span>
<a href="#l97.299"></a><span id="l97.299" class="difflineminus">-  }</span>
<a href="#l97.300"></a><span id="l97.300" class="difflineminus">-</span>
<a href="#l97.301"></a><span id="l97.301" class="difflineminus">-  let lastDayInFirstRow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l97.302"></a><span id="l97.302" class="difflineminus">-    miniMonth + 'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/[6]')).getNode().getAttribute(&quot;value&quot;);</span>
<a href="#l97.303"></a><span id="l97.303" class="difflineminus">-  let positionOfFirst = 7 - lastDayInFirstRow;</span>
<a href="#l97.304"></a><span id="l97.304" class="difflineminus">-  let dateColumn = (positionOfFirst + day - 1) % 7;</span>
<a href="#l97.305"></a><span id="l97.305" class="difflineminus">-  let dateRow = Math.floor((positionOfFirst + day - 1) / 7);</span>
<a href="#l97.306"></a><span id="l97.306" class="difflineminus">-</span>
<a href="#l97.307"></a><span id="l97.307" class="difflineminus">-  // pick day</span>
<a href="#l97.308"></a><span id="l97.308" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l97.309"></a><span id="l97.309" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[' + (dateRow + 1) + &quot;]/[&quot; + dateColumn + &quot;]&quot;));</span>
<a href="#l97.310"></a><span id="l97.310" class="difflineminus">-  controller.sleep(500);</span>
<a href="#l97.311"></a><span id="l97.311"> }</span>
<a href="#l97.312"></a><span id="l97.312"> </span>
<a href="#l97.313"></a><span id="l97.313"> /**</span>
<a href="#l97.314"></a><span id="l97.314">  *  @param controller - main window controller</span>
<a href="#l97.315"></a><span id="l97.315">  *  @param view - day, week, multiweek or month</span>
<a href="#l97.316"></a><span id="l97.316">  *  @param option - bg for creating event, fg for checking</span>
<a href="#l97.317"></a><span id="l97.317">  *  @param row - only used in multiweek and month view, 1-based index of a row</span>
<a href="#l97.318"></a><span id="l97.318">  *  @param column - 1-based index of a column</span>
<a href="#l97.319"></a><span id="l97.319">  *  @param hour - index of hour box</span>
<a href="#l97.320"></a><span id="l97.320">  *  @returns path string</span>
<a href="#l97.321"></a><span id="l97.321">  */</span>
<a href="#l97.322"></a><span id="l97.322"> function getEventBoxPath(controller, view, option, row, column, hour) {</span>
<a href="#l97.323"></a><span id="l97.323" class="difflineminus">-  let viewDeck = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l97.324"></a><span id="l97.324" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l97.325"></a><span id="l97.325" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)';</span>
<a href="#l97.326"></a><span id="l97.326" class="difflineminus">-  let dayView = viewDeck + '/id(&quot;day-view&quot;)';</span>
<a href="#l97.327"></a><span id="l97.327" class="difflineminus">-  let weekView = viewDeck + '/id(&quot;week-view&quot;)';</span>
<a href="#l97.328"></a><span id="l97.328" class="difflineminus">-  let multiweekView = viewDeck + '/id(&quot;multiweek-view&quot;)';</span>
<a href="#l97.329"></a><span id="l97.329" class="difflineminus">-  let monthView = viewDeck + '/id(&quot;month-view&quot;)';</span>
<a href="#l97.330"></a><span id="l97.330" class="difflineplus">+    let viewDeck = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l97.331"></a><span id="l97.331" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l97.332"></a><span id="l97.332" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)';</span>
<a href="#l97.333"></a><span id="l97.333" class="difflineplus">+    let dayView = viewDeck + '/id(&quot;day-view&quot;)';</span>
<a href="#l97.334"></a><span id="l97.334" class="difflineplus">+    let weekView = viewDeck + '/id(&quot;week-view&quot;)';</span>
<a href="#l97.335"></a><span id="l97.335" class="difflineplus">+    let multiweekView = viewDeck + '/id(&quot;multiweek-view&quot;)';</span>
<a href="#l97.336"></a><span id="l97.336" class="difflineplus">+    let monthView = viewDeck + '/id(&quot;month-view&quot;)';</span>
<a href="#l97.337"></a><span id="l97.337"> </span>
<a href="#l97.338"></a><span id="l97.338" class="difflineminus">-  let path = &quot;&quot;;</span>
<a href="#l97.339"></a><span id="l97.339" class="difflineminus">-  switch (view) {</span>
<a href="#l97.340"></a><span id="l97.340" class="difflineminus">-    case &quot;week&quot;:</span>
<a href="#l97.341"></a><span id="l97.341" class="difflineminus">-      path += weekView;</span>
<a href="#l97.342"></a><span id="l97.342" class="difflineminus">-      break;</span>
<a href="#l97.343"></a><span id="l97.343" class="difflineminus">-    case &quot;multiweek&quot;:</span>
<a href="#l97.344"></a><span id="l97.344" class="difflineminus">-      path += multiweekView;</span>
<a href="#l97.345"></a><span id="l97.345" class="difflineminus">-      break;</span>
<a href="#l97.346"></a><span id="l97.346" class="difflineminus">-    case &quot;month&quot;:</span>
<a href="#l97.347"></a><span id="l97.347" class="difflineminus">-      path += monthView;</span>
<a href="#l97.348"></a><span id="l97.348" class="difflineminus">-      break;</span>
<a href="#l97.349"></a><span id="l97.349" class="difflineminus">-    default: path += dayView;</span>
<a href="#l97.350"></a><span id="l97.350" class="difflineminus">-  }</span>
<a href="#l97.351"></a><span id="l97.351" class="difflineminus">-</span>
<a href="#l97.352"></a><span id="l97.352" class="difflineminus">-  if ((view == &quot;day&quot; || view == &quot;week&quot;) &amp;&amp; option == ALLDAY) {</span>
<a href="#l97.353"></a><span id="l97.353" class="difflineminus">-    path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;headerbox&quot;})/anon({&quot;anonid&quot;:&quot;headerdaybox&quot;})';</span>
<a href="#l97.354"></a><span id="l97.354" class="difflineminus">-    path += &quot;/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l97.355"></a><span id="l97.355" class="difflineminus">-</span>
<a href="#l97.356"></a><span id="l97.356" class="difflineminus">-    return path;</span>
<a href="#l97.357"></a><span id="l97.357" class="difflineminus">-  } else if (view == &quot;day&quot; || view == &quot;week&quot;) {</span>
<a href="#l97.358"></a><span id="l97.358" class="difflineminus">-    path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})';</span>
<a href="#l97.359"></a><span id="l97.359" class="difflineminus">-    path += &quot;/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l97.360"></a><span id="l97.360" class="difflineminus">-    path += '/anon({&quot;anonid&quot;:&quot;boxstack&quot;})';</span>
<a href="#l97.361"></a><span id="l97.361" class="difflineminus">-</span>
<a href="#l97.362"></a><span id="l97.362" class="difflineminus">-    if (option == CANVAS_BOX) {</span>
<a href="#l97.363"></a><span id="l97.363" class="difflineminus">-      path += '/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + hour + &quot;]&quot;;</span>
<a href="#l97.364"></a><span id="l97.364" class="difflineminus">-    } else {</span>
<a href="#l97.365"></a><span id="l97.365" class="difflineminus">-      path += '/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l97.366"></a><span id="l97.366" class="difflineplus">+    let path = &quot;&quot;;</span>
<a href="#l97.367"></a><span id="l97.367" class="difflineplus">+    switch (view) {</span>
<a href="#l97.368"></a><span id="l97.368" class="difflineplus">+        case &quot;week&quot;:</span>
<a href="#l97.369"></a><span id="l97.369" class="difflineplus">+            path += weekView;</span>
<a href="#l97.370"></a><span id="l97.370" class="difflineplus">+            break;</span>
<a href="#l97.371"></a><span id="l97.371" class="difflineplus">+        case &quot;multiweek&quot;:</span>
<a href="#l97.372"></a><span id="l97.372" class="difflineplus">+            path += multiweekView;</span>
<a href="#l97.373"></a><span id="l97.373" class="difflineplus">+            break;</span>
<a href="#l97.374"></a><span id="l97.374" class="difflineplus">+        case &quot;month&quot;:</span>
<a href="#l97.375"></a><span id="l97.375" class="difflineplus">+            path += monthView;</span>
<a href="#l97.376"></a><span id="l97.376" class="difflineplus">+            break;</span>
<a href="#l97.377"></a><span id="l97.377" class="difflineplus">+        default: path += dayView;</span>
<a href="#l97.378"></a><span id="l97.378">     }</span>
<a href="#l97.379"></a><span id="l97.379"> </span>
<a href="#l97.380"></a><span id="l97.380" class="difflineminus">-    return path;</span>
<a href="#l97.381"></a><span id="l97.381" class="difflineminus">-  } else {</span>
<a href="#l97.382"></a><span id="l97.382" class="difflineminus">-    path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l97.383"></a><span id="l97.383" class="difflineminus">-      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[' + (row - 1) + &quot;]/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l97.384"></a><span id="l97.384" class="difflineplus">+    if ((view == &quot;day&quot; || view == &quot;week&quot;) &amp;&amp; option == ALLDAY) {</span>
<a href="#l97.385"></a><span id="l97.385" class="difflineplus">+        path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;headerbox&quot;})/anon({&quot;anonid&quot;:&quot;headerdaybox&quot;})';</span>
<a href="#l97.386"></a><span id="l97.386" class="difflineplus">+        path += &quot;/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l97.387"></a><span id="l97.387" class="difflineplus">+</span>
<a href="#l97.388"></a><span id="l97.388" class="difflineplus">+        return path;</span>
<a href="#l97.389"></a><span id="l97.389" class="difflineplus">+    } else if (view == &quot;day&quot; || view == &quot;week&quot;) {</span>
<a href="#l97.390"></a><span id="l97.390" class="difflineplus">+        path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})';</span>
<a href="#l97.391"></a><span id="l97.391" class="difflineplus">+        path += &quot;/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l97.392"></a><span id="l97.392" class="difflineplus">+        path += '/anon({&quot;anonid&quot;:&quot;boxstack&quot;})';</span>
<a href="#l97.393"></a><span id="l97.393"> </span>
<a href="#l97.394"></a><span id="l97.394" class="difflineminus">-    if (option == CANVAS_BOX) {</span>
<a href="#l97.395"></a><span id="l97.395" class="difflineminus">-      path += '/anon({&quot;anonid&quot;:&quot;day-items&quot;})';</span>
<a href="#l97.396"></a><span id="l97.396" class="difflineplus">+        if (option == CANVAS_BOX) {</span>
<a href="#l97.397"></a><span id="l97.397" class="difflineplus">+            path += '/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + hour + &quot;]&quot;;</span>
<a href="#l97.398"></a><span id="l97.398" class="difflineplus">+        } else {</span>
<a href="#l97.399"></a><span id="l97.399" class="difflineplus">+            path += '/anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l97.400"></a><span id="l97.400" class="difflineplus">+        }</span>
<a href="#l97.401"></a><span id="l97.401" class="difflineplus">+</span>
<a href="#l97.402"></a><span id="l97.402" class="difflineplus">+        return path;</span>
<a href="#l97.403"></a><span id="l97.403" class="difflineplus">+    } else {</span>
<a href="#l97.404"></a><span id="l97.404" class="difflineplus">+        path += '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l97.405"></a><span id="l97.405" class="difflineplus">+          'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[' + (row - 1) + &quot;]/[&quot; + (column - 1) + &quot;]&quot;;</span>
<a href="#l97.406"></a><span id="l97.406" class="difflineplus">+</span>
<a href="#l97.407"></a><span id="l97.407" class="difflineplus">+        if (option == CANVAS_BOX) {</span>
<a href="#l97.408"></a><span id="l97.408" class="difflineplus">+            path += '/anon({&quot;anonid&quot;:&quot;day-items&quot;})';</span>
<a href="#l97.409"></a><span id="l97.409" class="difflineplus">+        }</span>
<a href="#l97.410"></a><span id="l97.410" class="difflineplus">+</span>
<a href="#l97.411"></a><span id="l97.411" class="difflineplus">+        return path;</span>
<a href="#l97.412"></a><span id="l97.412">     }</span>
<a href="#l97.413"></a><span id="l97.413" class="difflineminus">-</span>
<a href="#l97.414"></a><span id="l97.414" class="difflineminus">-    return path;</span>
<a href="#l97.415"></a><span id="l97.415" class="difflineminus">-  }</span>
<a href="#l97.416"></a><span id="l97.416"> }</span>
<a href="#l97.417"></a><span id="l97.417"> </span>
<a href="#l97.418"></a><span id="l97.418"> /**</span>
<a href="#l97.419"></a><span id="l97.419">  * @param controller - Mozmill window controller</span>
<a href="#l97.420"></a><span id="l97.420">  * @param n - how many times next button in view is clicked</span>
<a href="#l97.421"></a><span id="l97.421">  */</span>
<a href="#l97.422"></a><span id="l97.422"> function forward(controller, n) {</span>
<a href="#l97.423"></a><span id="l97.423" class="difflineminus">-  for (let i = 0; i &lt; n; i++) {</span>
<a href="#l97.424"></a><span id="l97.424" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l97.425"></a><span id="l97.425" class="difflineminus">-    controller.sleep(100);</span>
<a href="#l97.426"></a><span id="l97.426" class="difflineminus">-  }</span>
<a href="#l97.427"></a><span id="l97.427" class="difflineplus">+    for (let i = 0; i &lt; n; i++) {</span>
<a href="#l97.428"></a><span id="l97.428" class="difflineplus">+        controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l97.429"></a><span id="l97.429" class="difflineplus">+        controller.sleep(100);</span>
<a href="#l97.430"></a><span id="l97.430" class="difflineplus">+    }</span>
<a href="#l97.431"></a><span id="l97.431"> }</span>
<a href="#l97.432"></a><span id="l97.432"> </span>
<a href="#l97.433"></a><span id="l97.433"> /**</span>
<a href="#l97.434"></a><span id="l97.434">  * @param controller - Mozmill window controller</span>
<a href="#l97.435"></a><span id="l97.435">  * @param n - how many times previous button in view is clicked</span>
<a href="#l97.436"></a><span id="l97.436">  */</span>
<a href="#l97.437"></a><span id="l97.437"> function back(controller, n) {</span>
<a href="#l97.438"></a><span id="l97.438" class="difflineminus">-  for (let i = 0; i &lt; n; i++) {</span>
<a href="#l97.439"></a><span id="l97.439" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;previous-view-button&quot;));</span>
<a href="#l97.440"></a><span id="l97.440" class="difflineminus">-    controller.sleep(100);</span>
<a href="#l97.441"></a><span id="l97.441" class="difflineminus">-  }</span>
<a href="#l97.442"></a><span id="l97.442" class="difflineplus">+    for (let i = 0; i &lt; n; i++) {</span>
<a href="#l97.443"></a><span id="l97.443" class="difflineplus">+        controller.click(new elementslib.ID(controller.window.document, &quot;previous-view-button&quot;));</span>
<a href="#l97.444"></a><span id="l97.444" class="difflineplus">+        controller.sleep(100);</span>
<a href="#l97.445"></a><span id="l97.445" class="difflineplus">+    }</span>
<a href="#l97.446"></a><span id="l97.446"> }</span>
<a href="#l97.447"></a><span id="l97.447"> </span>
<a href="#l97.448"></a><span id="l97.448"> /**</span>
<a href="#l97.449"></a><span id="l97.449">  * Deletes all calendars with given name</span>
<a href="#l97.450"></a><span id="l97.450">  * @param controller - Mozmill window controller</span>
<a href="#l97.451"></a><span id="l97.451">  * @param name - calendar name</span>
<a href="#l97.452"></a><span id="l97.452">  */</span>
<a href="#l97.453"></a><span id="l97.453"> function deleteCalendars(controller, name) {</span>
<a href="#l97.454"></a><span id="l97.454" class="difflineminus">-  let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l97.455"></a><span id="l97.455" class="difflineminus">-                    .getNode().ownerDocument.defaultView;</span>
<a href="#l97.456"></a><span id="l97.456" class="difflineminus">-  let manager = defaultView.getCalendarManager();</span>
<a href="#l97.457"></a><span id="l97.457" class="difflineminus">-  let cals = manager.getCalendars({});</span>
<a href="#l97.458"></a><span id="l97.458" class="difflineplus">+    let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l97.459"></a><span id="l97.459" class="difflineplus">+                      .getNode().ownerDocument.defaultView;</span>
<a href="#l97.460"></a><span id="l97.460" class="difflineplus">+    let manager = defaultView.getCalendarManager();</span>
<a href="#l97.461"></a><span id="l97.461" class="difflineplus">+    let cals = manager.getCalendars({});</span>
<a href="#l97.462"></a><span id="l97.462"> </span>
<a href="#l97.463"></a><span id="l97.463" class="difflineminus">-  for (let i = 0; i &lt; cals.length; i++) {</span>
<a href="#l97.464"></a><span id="l97.464" class="difflineminus">-    if (cals[i].name == name) {</span>
<a href="#l97.465"></a><span id="l97.465" class="difflineminus">-        manager.removeCalendar(cals[i]);</span>
<a href="#l97.466"></a><span id="l97.466" class="difflineplus">+    for (let i = 0; i &lt; cals.length; i++) {</span>
<a href="#l97.467"></a><span id="l97.467" class="difflineplus">+        if (cals[i].name == name) {</span>
<a href="#l97.468"></a><span id="l97.468" class="difflineplus">+            manager.removeCalendar(cals[i]);</span>
<a href="#l97.469"></a><span id="l97.469" class="difflineplus">+        }</span>
<a href="#l97.470"></a><span id="l97.470">     }</span>
<a href="#l97.471"></a><span id="l97.471" class="difflineminus">-  }</span>
<a href="#l97.472"></a><span id="l97.472"> }</span>
<a href="#l97.473"></a><span id="l97.473"> </span>
<a href="#l97.474"></a><span id="l97.474"> /**</span>
<a href="#l97.475"></a><span id="l97.475">  * Creates local calendar with given name and select it in calendars list</span>
<a href="#l97.476"></a><span id="l97.476">  * @param controller - Mozmill window controller</span>
<a href="#l97.477"></a><span id="l97.477">  * @param name - calendar name</span>
<a href="#l97.478"></a><span id="l97.478">  */</span>
<a href="#l97.479"></a><span id="l97.479"> function createCalendar(controller, name) {</span>
<a href="#l97.480"></a><span id="l97.480" class="difflineminus">-  let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l97.481"></a><span id="l97.481" class="difflineminus">-                    .getNode().ownerDocument.defaultView;</span>
<a href="#l97.482"></a><span id="l97.482" class="difflineminus">-  let manager = defaultView.getCalendarManager();</span>
<a href="#l97.483"></a><span id="l97.483" class="difflineplus">+    let defaultView = (new elementslib.ID(controller.window.document, &quot;messengerWindow&quot;))</span>
<a href="#l97.484"></a><span id="l97.484" class="difflineplus">+                      .getNode().ownerDocument.defaultView;</span>
<a href="#l97.485"></a><span id="l97.485" class="difflineplus">+    let manager = defaultView.getCalendarManager();</span>
<a href="#l97.486"></a><span id="l97.486"> </span>
<a href="#l97.487"></a><span id="l97.487" class="difflineminus">-  let url = defaultView.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l97.488"></a><span id="l97.488" class="difflineminus">-  let calendar = manager.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l97.489"></a><span id="l97.489" class="difflineminus">-  calendar.name = name;</span>
<a href="#l97.490"></a><span id="l97.490" class="difflineminus">-  manager.registerCalendar(calendar);</span>
<a href="#l97.491"></a><span id="l97.491" class="difflineplus">+    let url = defaultView.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l97.492"></a><span id="l97.492" class="difflineplus">+    let calendar = manager.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l97.493"></a><span id="l97.493" class="difflineplus">+    calendar.name = name;</span>
<a href="#l97.494"></a><span id="l97.494" class="difflineplus">+    manager.registerCalendar(calendar);</span>
<a href="#l97.495"></a><span id="l97.495"> </span>
<a href="#l97.496"></a><span id="l97.496" class="difflineminus">-  let id = calendar.id;</span>
<a href="#l97.497"></a><span id="l97.497" class="difflineminus">-  let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l97.498"></a><span id="l97.498" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l97.499"></a><span id="l97.499" class="difflineminus">-    'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/' +</span>
<a href="#l97.500"></a><span id="l97.500" class="difflineminus">-    'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l97.501"></a><span id="l97.501" class="difflineminus">-    .getNode();</span>
<a href="#l97.502"></a><span id="l97.502" class="difflineminus">-  for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l97.503"></a><span id="l97.503" class="difflineminus">-    if (calendarTree.mCalendarList[i].id == id) {</span>
<a href="#l97.504"></a><span id="l97.504" class="difflineminus">-      calendarTree.tree.view.selection.select(i);</span>
<a href="#l97.505"></a><span id="l97.505" class="difflineplus">+    let id = calendar.id;</span>
<a href="#l97.506"></a><span id="l97.506" class="difflineplus">+    let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l97.507"></a><span id="l97.507" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l97.508"></a><span id="l97.508" class="difflineplus">+      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/' +</span>
<a href="#l97.509"></a><span id="l97.509" class="difflineplus">+      'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l97.510"></a><span id="l97.510" class="difflineplus">+      .getNode();</span>
<a href="#l97.511"></a><span id="l97.511" class="difflineplus">+    for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l97.512"></a><span id="l97.512" class="difflineplus">+        if (calendarTree.mCalendarList[i].id == id) {</span>
<a href="#l97.513"></a><span id="l97.513" class="difflineplus">+            calendarTree.tree.view.selection.select(i);</span>
<a href="#l97.514"></a><span id="l97.514" class="difflineplus">+        }</span>
<a href="#l97.515"></a><span id="l97.515">     }</span>
<a href="#l97.516"></a><span id="l97.516" class="difflineminus">-  }</span>
<a href="#l97.517"></a><span id="l97.517"> }</span>
<a href="#l97.518"></a><span id="l97.518"> </span>
<a href="#l97.519"></a><span id="l97.519"> /**</span>
<a href="#l97.520"></a><span id="l97.520">  * Retrieves array of all calendar-event-box elements in node</span>
<a href="#l97.521"></a><span id="l97.521">  * @param node - node to be searched</span>
<a href="#l97.522"></a><span id="l97.522">  * @param eventNodes - array where to put resultng nodes</span>
<a href="#l97.523"></a><span id="l97.523">  */</span>
<a href="#l97.524"></a><span id="l97.524"> function findEventsInNode(node, eventNodes) {</span>
<a href="#l97.525"></a><span id="l97.525" class="difflineminus">-  if (node.tagName == &quot;calendar-event-box&quot;) {</span>
<a href="#l97.526"></a><span id="l97.526" class="difflineminus">-    eventNodes.push(node);</span>
<a href="#l97.527"></a><span id="l97.527" class="difflineminus">-    return;</span>
<a href="#l97.528"></a><span id="l97.528" class="difflineminus">-  } else if (node.children.length &gt; 0) {</span>
<a href="#l97.529"></a><span id="l97.529" class="difflineminus">-    for (let i = 0; i &lt; node.children.length; i++) {</span>
<a href="#l97.530"></a><span id="l97.530" class="difflineminus">-      findEventsInNode(node.children[i], eventNodes);</span>
<a href="#l97.531"></a><span id="l97.531" class="difflineplus">+    if (node.tagName == &quot;calendar-event-box&quot;) {</span>
<a href="#l97.532"></a><span id="l97.532" class="difflineplus">+        eventNodes.push(node);</span>
<a href="#l97.533"></a><span id="l97.533" class="difflineplus">+        return;</span>
<a href="#l97.534"></a><span id="l97.534" class="difflineplus">+    } else if (node.children.length &gt; 0) {</span>
<a href="#l97.535"></a><span id="l97.535" class="difflineplus">+        for (let i = 0; i &lt; node.children.length; i++) {</span>
<a href="#l97.536"></a><span id="l97.536" class="difflineplus">+            findEventsInNode(node.children[i], eventNodes);</span>
<a href="#l97.537"></a><span id="l97.537" class="difflineplus">+        }</span>
<a href="#l97.538"></a><span id="l97.538">     }</span>
<a href="#l97.539"></a><span id="l97.539" class="difflineminus">-  }</span>
<a href="#l97.540"></a><span id="l97.540"> }</span>
<a href="#l97.541"></a><span id="l97.541"> </span>
<a href="#l97.542"></a><span id="l97.542"> /**</span>
<a href="#l97.543"></a><span id="l97.543">  *  Helper function to enter event/task dialog data</span>
<a href="#l97.544"></a><span id="l97.544">  *  @param controller - event/task controller</span>
<a href="#l97.545"></a><span id="l97.545">  *  @param data - dataset object</span>
<a href="#l97.546"></a><span id="l97.546">  *                  title - event/task title</span>
<a href="#l97.547"></a><span id="l97.547">  *                  location - event/task location</span>
<a href="#l97.548"></a><span id="l97.548" class="difflineat">@@ -376,290 +376,290 @@ function findEventsInNode(node, eventNod</span>
<a href="#l97.549"></a><span id="l97.549">  *                           none/needs-action/in-process/completed/cancelled for tasks</span>
<a href="#l97.550"></a><span id="l97.550">  *                  completed - Date object for tasks</span>
<a href="#l97.551"></a><span id="l97.551">  *                  percent - percent complete for tasks</span>
<a href="#l97.552"></a><span id="l97.552">  *                  freebusy - free/busy</span>
<a href="#l97.553"></a><span id="l97.553">  *                  attachment.add - url to add</span>
<a href="#l97.554"></a><span id="l97.554">  *                  attachment.remove - label of url to remove (without http://)</span>
<a href="#l97.555"></a><span id="l97.555">  */</span>
<a href="#l97.556"></a><span id="l97.556"> function setData(controller, data) {</span>
<a href="#l97.557"></a><span id="l97.557" class="difflineminus">-  let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l97.558"></a><span id="l97.558" class="difflineminus">-  let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l97.559"></a><span id="l97.559" class="difflineminus">-  let dialog;</span>
<a href="#l97.560"></a><span id="l97.560" class="difflineminus">-  let isEvent = true;</span>
<a href="#l97.561"></a><span id="l97.561" class="difflineminus">-</span>
<a href="#l97.562"></a><span id="l97.562" class="difflineminus">-  // see if it's an event dialog</span>
<a href="#l97.563"></a><span id="l97.563" class="difflineminus">-  try {</span>
<a href="#l97.564"></a><span id="l97.564" class="difflineminus">-    (new elementslib.Lookup(controller.window.document, eventDialog)).getNode();</span>
<a href="#l97.565"></a><span id="l97.565" class="difflineminus">-    dialog = eventDialog;</span>
<a href="#l97.566"></a><span id="l97.566" class="difflineminus">-  } catch (error) {</span>
<a href="#l97.567"></a><span id="l97.567" class="difflineminus">-    dialog = taskDialog;</span>
<a href="#l97.568"></a><span id="l97.568" class="difflineminus">-    isEvent = false;</span>
<a href="#l97.569"></a><span id="l97.569" class="difflineminus">-  }</span>
<a href="#l97.570"></a><span id="l97.570" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l97.571"></a><span id="l97.571" class="difflineplus">+    let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l97.572"></a><span id="l97.572" class="difflineplus">+    let dialog;</span>
<a href="#l97.573"></a><span id="l97.573" class="difflineplus">+    let isEvent = true;</span>
<a href="#l97.574"></a><span id="l97.574"> </span>
<a href="#l97.575"></a><span id="l97.575" class="difflineminus">-  let dateInput = 'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l97.576"></a><span id="l97.576" class="difflineminus">-    'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l97.577"></a><span id="l97.577" class="difflineminus">-  let timeInput = 'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l97.578"></a><span id="l97.578" class="difflineminus">-    'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l97.579"></a><span id="l97.579" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l97.580"></a><span id="l97.580" class="difflineminus">-  let startDateInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.581"></a><span id="l97.581" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l97.582"></a><span id="l97.582" class="difflineminus">-    (isEvent ? 'id(&quot;event-starttime&quot;)/' : 'id(&quot;todo-entrydate&quot;)/') +</span>
<a href="#l97.583"></a><span id="l97.583" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' + dateInput);</span>
<a href="#l97.584"></a><span id="l97.584" class="difflineminus">-  let endDateInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.585"></a><span id="l97.585" class="difflineminus">-    'id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/' +</span>
<a href="#l97.586"></a><span id="l97.586" class="difflineminus">-    (isEvent ? 'id(&quot;event-endtime&quot;)/' : 'id(&quot;todo-duedate&quot;)/') +</span>
<a href="#l97.587"></a><span id="l97.587" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' + dateInput);</span>
<a href="#l97.588"></a><span id="l97.588" class="difflineminus">-  let startTimeInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.589"></a><span id="l97.589" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l97.590"></a><span id="l97.590" class="difflineminus">-    (isEvent ? 'id(&quot;event-starttime&quot;)/' : 'id(&quot;todo-entrydate&quot;)/') +</span>
<a href="#l97.591"></a><span id="l97.591" class="difflineminus">-    timeInput);</span>
<a href="#l97.592"></a><span id="l97.592" class="difflineminus">-  let endTimeInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.593"></a><span id="l97.593" class="difflineminus">-    'id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/' +</span>
<a href="#l97.594"></a><span id="l97.594" class="difflineminus">-    (isEvent ? 'id(&quot;event-endtime&quot;)/' : 'id(&quot;todo-duedate&quot;)/') +</span>
<a href="#l97.595"></a><span id="l97.595" class="difflineminus">-    timeInput);</span>
<a href="#l97.596"></a><span id="l97.596" class="difflineminus">-  let completedDateInput = new elementslib.Lookup(controller.window.document,</span>
<a href="#l97.597"></a><span id="l97.597" class="difflineminus">-    dialog + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l97.598"></a><span id="l97.598" class="difflineminus">-    'id(&quot;completed-date-picker&quot;)/' + dateInput);</span>
<a href="#l97.599"></a><span id="l97.599" class="difflineminus">-  let percentCompleteInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.600"></a><span id="l97.600" class="difflineminus">-    'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l97.601"></a><span id="l97.601" class="difflineminus">-    'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l97.602"></a><span id="l97.602" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l97.603"></a><span id="l97.603" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l97.604"></a><span id="l97.604" class="difflineminus">-                              .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l97.605"></a><span id="l97.605" class="difflineminus">-  let mac = utils.appInfo.os.toLowerCase().includes(&quot;darwin&quot;);</span>
<a href="#l97.606"></a><span id="l97.606" class="difflineminus">-  // wait for input elements' values to be populated</span>
<a href="#l97.607"></a><span id="l97.607" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l97.608"></a><span id="l97.608" class="difflineminus">-</span>
<a href="#l97.609"></a><span id="l97.609" class="difflineminus">-  // title</span>
<a href="#l97.610"></a><span id="l97.610" class="difflineminus">-  if (data.title != undefined) {</span>
<a href="#l97.611"></a><span id="l97.611" class="difflineminus">-    if (mac) {</span>
<a href="#l97.612"></a><span id="l97.612" class="difflineminus">-      let titleField = new elementslib.ID(controller.window.document, &quot;item-title&quot;);</span>
<a href="#l97.613"></a><span id="l97.613" class="difflineminus">-      titleField.getNode().value = data.title;</span>
<a href="#l97.614"></a><span id="l97.614" class="difflineminus">-    } else {</span>
<a href="#l97.615"></a><span id="l97.615" class="difflineminus">-      controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.616"></a><span id="l97.616" class="difflineminus">-        'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.617"></a><span id="l97.617" class="difflineminus">-        'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.618"></a><span id="l97.618" class="difflineminus">-        &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.619"></a><span id="l97.619" class="difflineminus">-      controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.620"></a><span id="l97.620" class="difflineminus">-        'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.621"></a><span id="l97.621" class="difflineminus">-        'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.622"></a><span id="l97.622" class="difflineminus">-        data.title);</span>
<a href="#l97.623"></a><span id="l97.623" class="difflineplus">+    // see if it's an event dialog</span>
<a href="#l97.624"></a><span id="l97.624" class="difflineplus">+    try {</span>
<a href="#l97.625"></a><span id="l97.625" class="difflineplus">+        (new elementslib.Lookup(controller.window.document, eventDialog)).getNode();</span>
<a href="#l97.626"></a><span id="l97.626" class="difflineplus">+        dialog = eventDialog;</span>
<a href="#l97.627"></a><span id="l97.627" class="difflineplus">+    } catch (error) {</span>
<a href="#l97.628"></a><span id="l97.628" class="difflineplus">+        dialog = taskDialog;</span>
<a href="#l97.629"></a><span id="l97.629" class="difflineplus">+        isEvent = false;</span>
<a href="#l97.630"></a><span id="l97.630">     }</span>
<a href="#l97.631"></a><span id="l97.631" class="difflineminus">-  }</span>
<a href="#l97.632"></a><span id="l97.632"> </span>
<a href="#l97.633"></a><span id="l97.633" class="difflineminus">-  // location</span>
<a href="#l97.634"></a><span id="l97.634" class="difflineminus">-  if (data.location != undefined) {</span>
<a href="#l97.635"></a><span id="l97.635" class="difflineminus">-    if (mac) {</span>
<a href="#l97.636"></a><span id="l97.636" class="difflineminus">-      let locationField = new elementslib.ID(controller.window.document, &quot;item-location&quot;);</span>
<a href="#l97.637"></a><span id="l97.637" class="difflineminus">-      locationField.getNode().value = data.location;</span>
<a href="#l97.638"></a><span id="l97.638" class="difflineminus">-    } else {</span>
<a href="#l97.639"></a><span id="l97.639" class="difflineminus">-      controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.640"></a><span id="l97.640" class="difflineminus">-        'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.641"></a><span id="l97.641" class="difflineminus">-        'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.642"></a><span id="l97.642" class="difflineminus">-        &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.643"></a><span id="l97.643" class="difflineminus">-      controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.644"></a><span id="l97.644" class="difflineminus">-        'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.645"></a><span id="l97.645" class="difflineminus">-        'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.646"></a><span id="l97.646" class="difflineminus">-        data.location);</span>
<a href="#l97.647"></a><span id="l97.647" class="difflineminus">-    }</span>
<a href="#l97.648"></a><span id="l97.648" class="difflineminus">-  }</span>
<a href="#l97.649"></a><span id="l97.649" class="difflineminus">-</span>
<a href="#l97.650"></a><span id="l97.650" class="difflineminus">-  // category</span>
<a href="#l97.651"></a><span id="l97.651" class="difflineminus">-  if (data.category != undefined) {</span>
<a href="#l97.652"></a><span id="l97.652" class="difflineminus">-    controller.select(new elementslib.ID(controller.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l97.653"></a><span id="l97.653" class="difflineminus">-      data.category);</span>
<a href="#l97.654"></a><span id="l97.654" class="difflineplus">+    let dateInput = 'anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/{&quot;class&quot;:&quot;datepicker-text-class&quot;}/' +</span>
<a href="#l97.655"></a><span id="l97.655" class="difflineplus">+      'anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l97.656"></a><span id="l97.656" class="difflineplus">+    let timeInput = 'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l97.657"></a><span id="l97.657" class="difflineplus">+      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l97.658"></a><span id="l97.658" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l97.659"></a><span id="l97.659" class="difflineplus">+    let startDateInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.660"></a><span id="l97.660" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l97.661"></a><span id="l97.661" class="difflineplus">+      (isEvent ? 'id(&quot;event-starttime&quot;)/' : 'id(&quot;todo-entrydate&quot;)/') +</span>
<a href="#l97.662"></a><span id="l97.662" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' + dateInput);</span>
<a href="#l97.663"></a><span id="l97.663" class="difflineplus">+    let endDateInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.664"></a><span id="l97.664" class="difflineplus">+      'id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/' +</span>
<a href="#l97.665"></a><span id="l97.665" class="difflineplus">+      (isEvent ? 'id(&quot;event-endtime&quot;)/' : 'id(&quot;todo-duedate&quot;)/') +</span>
<a href="#l97.666"></a><span id="l97.666" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' + dateInput);</span>
<a href="#l97.667"></a><span id="l97.667" class="difflineplus">+    let startTimeInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.668"></a><span id="l97.668" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l97.669"></a><span id="l97.669" class="difflineplus">+      (isEvent ? 'id(&quot;event-starttime&quot;)/' : 'id(&quot;todo-entrydate&quot;)/') +</span>
<a href="#l97.670"></a><span id="l97.670" class="difflineplus">+      timeInput);</span>
<a href="#l97.671"></a><span id="l97.671" class="difflineplus">+    let endTimeInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.672"></a><span id="l97.672" class="difflineplus">+      'id(&quot;event-grid-enddate-row&quot;)/[1]/id(&quot;event-grid-enddate-picker-box&quot;)/' +</span>
<a href="#l97.673"></a><span id="l97.673" class="difflineplus">+      (isEvent ? 'id(&quot;event-endtime&quot;)/' : 'id(&quot;todo-duedate&quot;)/') +</span>
<a href="#l97.674"></a><span id="l97.674" class="difflineplus">+      timeInput);</span>
<a href="#l97.675"></a><span id="l97.675" class="difflineplus">+    let completedDateInput = new elementslib.Lookup(controller.window.document,</span>
<a href="#l97.676"></a><span id="l97.676" class="difflineplus">+      dialog + 'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l97.677"></a><span id="l97.677" class="difflineplus">+      'id(&quot;completed-date-picker&quot;)/' + dateInput);</span>
<a href="#l97.678"></a><span id="l97.678" class="difflineplus">+    let percentCompleteInput = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.679"></a><span id="l97.679" class="difflineplus">+      'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l97.680"></a><span id="l97.680" class="difflineplus">+      'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l97.681"></a><span id="l97.681" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l97.682"></a><span id="l97.682" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l97.683"></a><span id="l97.683" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l97.684"></a><span id="l97.684" class="difflineplus">+    let mac = utils.appInfo.os.toLowerCase().includes(&quot;darwin&quot;);</span>
<a href="#l97.685"></a><span id="l97.685" class="difflineplus">+    // wait for input elements' values to be populated</span>
<a href="#l97.686"></a><span id="l97.686">     controller.sleep(sleep);</span>
<a href="#l97.687"></a><span id="l97.687" class="difflineminus">-  }</span>
<a href="#l97.688"></a><span id="l97.688" class="difflineminus">-</span>
<a href="#l97.689"></a><span id="l97.689" class="difflineminus">-  // all-day</span>
<a href="#l97.690"></a><span id="l97.690" class="difflineminus">-  if (data.allday != undefined &amp;&amp; isEvent) {</span>
<a href="#l97.691"></a><span id="l97.691" class="difflineminus">-    controller.check(new elementslib.ID(controller.window.document, &quot;event-all-day&quot;), data.allday);</span>
<a href="#l97.692"></a><span id="l97.692" class="difflineminus">-  }</span>
<a href="#l97.693"></a><span id="l97.693"> </span>
<a href="#l97.694"></a><span id="l97.694" class="difflineminus">-  // timezone</span>
<a href="#l97.695"></a><span id="l97.695" class="difflineminus">-  if (data.timezone != undefined) {</span>
<a href="#l97.696"></a><span id="l97.696" class="difflineminus">-    let menuitem = new elementslib.ID(controller.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l97.697"></a><span id="l97.697" class="difflineminus">-    menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l97.698"></a><span id="l97.698" class="difflineminus">-    controller.click(menuitem);</span>
<a href="#l97.699"></a><span id="l97.699" class="difflineminus">-  }</span>
<a href="#l97.700"></a><span id="l97.700" class="difflineplus">+    // title</span>
<a href="#l97.701"></a><span id="l97.701" class="difflineplus">+    if (data.title != undefined) {</span>
<a href="#l97.702"></a><span id="l97.702" class="difflineplus">+        if (mac) {</span>
<a href="#l97.703"></a><span id="l97.703" class="difflineplus">+            let titleField = new elementslib.ID(controller.window.document, &quot;item-title&quot;);</span>
<a href="#l97.704"></a><span id="l97.704" class="difflineplus">+            titleField.getNode().value = data.title;</span>
<a href="#l97.705"></a><span id="l97.705" class="difflineplus">+        } else {</span>
<a href="#l97.706"></a><span id="l97.706" class="difflineplus">+            controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.707"></a><span id="l97.707" class="difflineplus">+              'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.708"></a><span id="l97.708" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.709"></a><span id="l97.709" class="difflineplus">+              &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.710"></a><span id="l97.710" class="difflineplus">+            controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.711"></a><span id="l97.711" class="difflineplus">+              'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.712"></a><span id="l97.712" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.713"></a><span id="l97.713" class="difflineplus">+              data.title);</span>
<a href="#l97.714"></a><span id="l97.714" class="difflineplus">+        }</span>
<a href="#l97.715"></a><span id="l97.715" class="difflineplus">+    }</span>
<a href="#l97.716"></a><span id="l97.716"> </span>
<a href="#l97.717"></a><span id="l97.717" class="difflineminus">-  // startdate</span>
<a href="#l97.718"></a><span id="l97.718" class="difflineminus">-  if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.719"></a><span id="l97.719" class="difflineminus">-    let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l97.720"></a><span id="l97.720" class="difflineminus">-      data.startdate.getFullYear(), data.startdate.getMonth() + 1, data.startdate.getDate());</span>
<a href="#l97.721"></a><span id="l97.721" class="difflineminus">-    if (!isEvent) {</span>
<a href="#l97.722"></a><span id="l97.722" class="difflineminus">-      controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-entrydate&quot;), true);</span>
<a href="#l97.723"></a><span id="l97.723" class="difflineplus">+    // location</span>
<a href="#l97.724"></a><span id="l97.724" class="difflineplus">+    if (data.location != undefined) {</span>
<a href="#l97.725"></a><span id="l97.725" class="difflineplus">+        if (mac) {</span>
<a href="#l97.726"></a><span id="l97.726" class="difflineplus">+            let locationField = new elementslib.ID(controller.window.document, &quot;item-location&quot;);</span>
<a href="#l97.727"></a><span id="l97.727" class="difflineplus">+            locationField.getNode().value = data.location;</span>
<a href="#l97.728"></a><span id="l97.728" class="difflineplus">+        } else {</span>
<a href="#l97.729"></a><span id="l97.729" class="difflineplus">+            controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.730"></a><span id="l97.730" class="difflineplus">+              'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.731"></a><span id="l97.731" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.732"></a><span id="l97.732" class="difflineplus">+              &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.733"></a><span id="l97.733" class="difflineplus">+            controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.734"></a><span id="l97.734" class="difflineplus">+              'id(&quot;event-grid-location-row&quot;)/id(&quot;item-location&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l97.735"></a><span id="l97.735" class="difflineplus">+              'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.736"></a><span id="l97.736" class="difflineplus">+              data.location);</span>
<a href="#l97.737"></a><span id="l97.737" class="difflineplus">+        }</span>
<a href="#l97.738"></a><span id="l97.738">     }</span>
<a href="#l97.739"></a><span id="l97.739" class="difflineminus">-    if (mac) {</span>
<a href="#l97.740"></a><span id="l97.740" class="difflineminus">-      startDateInput.getNode().value = startdate;</span>
<a href="#l97.741"></a><span id="l97.741" class="difflineminus">-    } else {</span>
<a href="#l97.742"></a><span id="l97.742" class="difflineminus">-      controller.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.743"></a><span id="l97.743" class="difflineminus">-      controller.type(startDateInput, startdate);</span>
<a href="#l97.744"></a><span id="l97.744" class="difflineplus">+</span>
<a href="#l97.745"></a><span id="l97.745" class="difflineplus">+    // category</span>
<a href="#l97.746"></a><span id="l97.746" class="difflineplus">+    if (data.category != undefined) {</span>
<a href="#l97.747"></a><span id="l97.747" class="difflineplus">+        controller.select(new elementslib.ID(controller.window.document, &quot;item-categories&quot;), undefined,</span>
<a href="#l97.748"></a><span id="l97.748" class="difflineplus">+          data.category);</span>
<a href="#l97.749"></a><span id="l97.749" class="difflineplus">+        controller.sleep(sleep);</span>
<a href="#l97.750"></a><span id="l97.750">     }</span>
<a href="#l97.751"></a><span id="l97.751" class="difflineminus">-  }</span>
<a href="#l97.752"></a><span id="l97.752" class="difflineplus">+</span>
<a href="#l97.753"></a><span id="l97.753" class="difflineplus">+    // all-day</span>
<a href="#l97.754"></a><span id="l97.754" class="difflineplus">+    if (data.allday != undefined &amp;&amp; isEvent) {</span>
<a href="#l97.755"></a><span id="l97.755" class="difflineplus">+        controller.check(new elementslib.ID(controller.window.document, &quot;event-all-day&quot;), data.allday);</span>
<a href="#l97.756"></a><span id="l97.756" class="difflineplus">+    }</span>
<a href="#l97.757"></a><span id="l97.757"> </span>
<a href="#l97.758"></a><span id="l97.758" class="difflineminus">-  // starttime</span>
<a href="#l97.759"></a><span id="l97.759" class="difflineminus">-  if (data.starttime != undefined &amp;&amp; data.starttime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.760"></a><span id="l97.760" class="difflineminus">-    let starttime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l97.761"></a><span id="l97.761" class="difflineminus">-      data.starttime.getHours(), data.starttime.getMinutes(), 0);</span>
<a href="#l97.762"></a><span id="l97.762" class="difflineminus">-    if (mac) {</span>
<a href="#l97.763"></a><span id="l97.763" class="difflineminus">-      startTimeInput.getNode().value = starttime;</span>
<a href="#l97.764"></a><span id="l97.764" class="difflineminus">-      controller.sleep(sleep);</span>
<a href="#l97.765"></a><span id="l97.765" class="difflineminus">-    } else {</span>
<a href="#l97.766"></a><span id="l97.766" class="difflineminus">-      controller.keypress(startTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.767"></a><span id="l97.767" class="difflineminus">-      controller.type(startTimeInput, starttime);</span>
<a href="#l97.768"></a><span id="l97.768" class="difflineplus">+    // timezone</span>
<a href="#l97.769"></a><span id="l97.769" class="difflineplus">+    if (data.timezone != undefined) {</span>
<a href="#l97.770"></a><span id="l97.770" class="difflineplus">+        let menuitem = new elementslib.ID(controller.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l97.771"></a><span id="l97.771" class="difflineplus">+        menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l97.772"></a><span id="l97.772" class="difflineplus">+        controller.click(menuitem);</span>
<a href="#l97.773"></a><span id="l97.773" class="difflineplus">+    }</span>
<a href="#l97.774"></a><span id="l97.774" class="difflineplus">+</span>
<a href="#l97.775"></a><span id="l97.775" class="difflineplus">+    // startdate</span>
<a href="#l97.776"></a><span id="l97.776" class="difflineplus">+    if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.777"></a><span id="l97.777" class="difflineplus">+        let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l97.778"></a><span id="l97.778" class="difflineplus">+          data.startdate.getFullYear(), data.startdate.getMonth() + 1, data.startdate.getDate());</span>
<a href="#l97.779"></a><span id="l97.779" class="difflineplus">+        if (!isEvent) {</span>
<a href="#l97.780"></a><span id="l97.780" class="difflineplus">+            controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-entrydate&quot;), true);</span>
<a href="#l97.781"></a><span id="l97.781" class="difflineplus">+        }</span>
<a href="#l97.782"></a><span id="l97.782" class="difflineplus">+        if (mac) {</span>
<a href="#l97.783"></a><span id="l97.783" class="difflineplus">+            startDateInput.getNode().value = startdate;</span>
<a href="#l97.784"></a><span id="l97.784" class="difflineplus">+        } else {</span>
<a href="#l97.785"></a><span id="l97.785" class="difflineplus">+            controller.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.786"></a><span id="l97.786" class="difflineplus">+            controller.type(startDateInput, startdate);</span>
<a href="#l97.787"></a><span id="l97.787" class="difflineplus">+        }</span>
<a href="#l97.788"></a><span id="l97.788">     }</span>
<a href="#l97.789"></a><span id="l97.789" class="difflineminus">-  }</span>
<a href="#l97.790"></a><span id="l97.790"> </span>
<a href="#l97.791"></a><span id="l97.791" class="difflineminus">-  // enddate</span>
<a href="#l97.792"></a><span id="l97.792" class="difflineminus">-  if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.793"></a><span id="l97.793" class="difflineminus">-    let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l97.794"></a><span id="l97.794" class="difflineminus">-      data.enddate.getFullYear(), data.enddate.getMonth() + 1, data.enddate.getDate());</span>
<a href="#l97.795"></a><span id="l97.795" class="difflineminus">-    if (!isEvent) {</span>
<a href="#l97.796"></a><span id="l97.796" class="difflineminus">-      controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-duedate&quot;), true);</span>
<a href="#l97.797"></a><span id="l97.797" class="difflineminus">-    }</span>
<a href="#l97.798"></a><span id="l97.798" class="difflineminus">-    if (mac) {</span>
<a href="#l97.799"></a><span id="l97.799" class="difflineminus">-      endDateInput.getNode().value = enddate;</span>
<a href="#l97.800"></a><span id="l97.800" class="difflineminus">-    } else {</span>
<a href="#l97.801"></a><span id="l97.801" class="difflineminus">-      controller.keypress(endDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.802"></a><span id="l97.802" class="difflineminus">-      controller.type(endDateInput, enddate);</span>
<a href="#l97.803"></a><span id="l97.803" class="difflineplus">+    // starttime</span>
<a href="#l97.804"></a><span id="l97.804" class="difflineplus">+    if (data.starttime != undefined &amp;&amp; data.starttime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.805"></a><span id="l97.805" class="difflineplus">+        let starttime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l97.806"></a><span id="l97.806" class="difflineplus">+          data.starttime.getHours(), data.starttime.getMinutes(), 0);</span>
<a href="#l97.807"></a><span id="l97.807" class="difflineplus">+        if (mac) {</span>
<a href="#l97.808"></a><span id="l97.808" class="difflineplus">+            startTimeInput.getNode().value = starttime;</span>
<a href="#l97.809"></a><span id="l97.809" class="difflineplus">+            controller.sleep(sleep);</span>
<a href="#l97.810"></a><span id="l97.810" class="difflineplus">+        } else {</span>
<a href="#l97.811"></a><span id="l97.811" class="difflineplus">+            controller.keypress(startTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.812"></a><span id="l97.812" class="difflineplus">+            controller.type(startTimeInput, starttime);</span>
<a href="#l97.813"></a><span id="l97.813" class="difflineplus">+        }</span>
<a href="#l97.814"></a><span id="l97.814">     }</span>
<a href="#l97.815"></a><span id="l97.815" class="difflineminus">-  }</span>
<a href="#l97.816"></a><span id="l97.816" class="difflineminus">-</span>
<a href="#l97.817"></a><span id="l97.817" class="difflineminus">-  // endttime</span>
<a href="#l97.818"></a><span id="l97.818" class="difflineminus">-  if (data.endtime != undefined &amp;&amp; data.endtime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.819"></a><span id="l97.819" class="difflineminus">-    let endtime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l97.820"></a><span id="l97.820" class="difflineminus">-      data.endtime.getHours(), data.endtime.getMinutes(), 0);</span>
<a href="#l97.821"></a><span id="l97.821" class="difflineminus">-    if (mac) {</span>
<a href="#l97.822"></a><span id="l97.822" class="difflineminus">-      endTimeInput.getNode().value = endtime;</span>
<a href="#l97.823"></a><span id="l97.823" class="difflineminus">-      controller.sleep(sleep);</span>
<a href="#l97.824"></a><span id="l97.824" class="difflineminus">-    } else {</span>
<a href="#l97.825"></a><span id="l97.825" class="difflineminus">-      controller.keypress(endTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.826"></a><span id="l97.826" class="difflineminus">-      controller.type(endTimeInput, endtime);</span>
<a href="#l97.827"></a><span id="l97.827" class="difflineminus">-    }</span>
<a href="#l97.828"></a><span id="l97.828" class="difflineminus">-  }</span>
<a href="#l97.829"></a><span id="l97.829"> </span>
<a href="#l97.830"></a><span id="l97.830" class="difflineminus">-  // recurrence</span>
<a href="#l97.831"></a><span id="l97.831" class="difflineminus">-  if (data.repeat != undefined) {</span>
<a href="#l97.832"></a><span id="l97.832" class="difflineminus">-    controller.select(new elementslib.ID(controller.window.document, &quot;item-repeat&quot;), undefined,</span>
<a href="#l97.833"></a><span id="l97.833" class="difflineminus">-      undefined, data.repeat);</span>
<a href="#l97.834"></a><span id="l97.834" class="difflineminus">-  }</span>
<a href="#l97.835"></a><span id="l97.835" class="difflineminus">-</span>
<a href="#l97.836"></a><span id="l97.836" class="difflineminus">-  // reminder</span>
<a href="#l97.837"></a><span id="l97.837" class="difflineminus">-  if (data.reminder != undefined) {</span>
<a href="#l97.838"></a><span id="l97.838" class="difflineminus">-    controller.select(new elementslib.ID(controller.window.document, &quot;item-alarm&quot;), data.reminder);</span>
<a href="#l97.839"></a><span id="l97.839" class="difflineminus">-  }</span>
<a href="#l97.840"></a><span id="l97.840" class="difflineplus">+    // enddate</span>
<a href="#l97.841"></a><span id="l97.841" class="difflineplus">+    if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.842"></a><span id="l97.842" class="difflineplus">+        let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l97.843"></a><span id="l97.843" class="difflineplus">+          data.enddate.getFullYear(), data.enddate.getMonth() + 1, data.enddate.getDate());</span>
<a href="#l97.844"></a><span id="l97.844" class="difflineplus">+        if (!isEvent) {</span>
<a href="#l97.845"></a><span id="l97.845" class="difflineplus">+            controller.check(new elementslib.ID(controller.window.document, &quot;todo-has-duedate&quot;), true);</span>
<a href="#l97.846"></a><span id="l97.846" class="difflineplus">+        }</span>
<a href="#l97.847"></a><span id="l97.847" class="difflineplus">+        if (mac) {</span>
<a href="#l97.848"></a><span id="l97.848" class="difflineplus">+            endDateInput.getNode().value = enddate;</span>
<a href="#l97.849"></a><span id="l97.849" class="difflineplus">+        } else {</span>
<a href="#l97.850"></a><span id="l97.850" class="difflineplus">+            controller.keypress(endDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.851"></a><span id="l97.851" class="difflineplus">+            controller.type(endDateInput, enddate);</span>
<a href="#l97.852"></a><span id="l97.852" class="difflineplus">+        }</span>
<a href="#l97.853"></a><span id="l97.853" class="difflineplus">+    }</span>
<a href="#l97.854"></a><span id="l97.854"> </span>
<a href="#l97.855"></a><span id="l97.855" class="difflineminus">-  // description</span>
<a href="#l97.856"></a><span id="l97.856" class="difflineminus">-  if (data.description != undefined) {</span>
<a href="#l97.857"></a><span id="l97.857" class="difflineminus">-    if (mac) {</span>
<a href="#l97.858"></a><span id="l97.858" class="difflineminus">-      let descField = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.859"></a><span id="l97.859" class="difflineminus">-        'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l97.860"></a><span id="l97.860" class="difflineminus">-        'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l97.861"></a><span id="l97.861" class="difflineminus">-      descField.getNode().value = data.description;</span>
<a href="#l97.862"></a><span id="l97.862" class="difflineminus">-    } else {</span>
<a href="#l97.863"></a><span id="l97.863" class="difflineminus">-      controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.864"></a><span id="l97.864" class="difflineminus">-        'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l97.865"></a><span id="l97.865" class="difflineminus">-        'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.866"></a><span id="l97.866" class="difflineminus">-        &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.867"></a><span id="l97.867" class="difflineminus">-      controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.868"></a><span id="l97.868" class="difflineminus">-        'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l97.869"></a><span id="l97.869" class="difflineminus">-        'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.870"></a><span id="l97.870" class="difflineminus">-        data.description);</span>
<a href="#l97.871"></a><span id="l97.871" class="difflineplus">+    // endttime</span>
<a href="#l97.872"></a><span id="l97.872" class="difflineplus">+    if (data.endtime != undefined &amp;&amp; data.endtime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l97.873"></a><span id="l97.873" class="difflineplus">+        let endtime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds,</span>
<a href="#l97.874"></a><span id="l97.874" class="difflineplus">+          data.endtime.getHours(), data.endtime.getMinutes(), 0);</span>
<a href="#l97.875"></a><span id="l97.875" class="difflineplus">+        if (mac) {</span>
<a href="#l97.876"></a><span id="l97.876" class="difflineplus">+            endTimeInput.getNode().value = endtime;</span>
<a href="#l97.877"></a><span id="l97.877" class="difflineplus">+            controller.sleep(sleep);</span>
<a href="#l97.878"></a><span id="l97.878" class="difflineplus">+        } else {</span>
<a href="#l97.879"></a><span id="l97.879" class="difflineplus">+            controller.keypress(endTimeInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.880"></a><span id="l97.880" class="difflineplus">+            controller.type(endTimeInput, endtime);</span>
<a href="#l97.881"></a><span id="l97.881" class="difflineplus">+        }</span>
<a href="#l97.882"></a><span id="l97.882">     }</span>
<a href="#l97.883"></a><span id="l97.883" class="difflineminus">-  }</span>
<a href="#l97.884"></a><span id="l97.884" class="difflineplus">+</span>
<a href="#l97.885"></a><span id="l97.885" class="difflineplus">+    // recurrence</span>
<a href="#l97.886"></a><span id="l97.886" class="difflineplus">+    if (data.repeat != undefined) {</span>
<a href="#l97.887"></a><span id="l97.887" class="difflineplus">+        controller.select(new elementslib.ID(controller.window.document, &quot;item-repeat&quot;), undefined,</span>
<a href="#l97.888"></a><span id="l97.888" class="difflineplus">+          undefined, data.repeat);</span>
<a href="#l97.889"></a><span id="l97.889" class="difflineplus">+    }</span>
<a href="#l97.890"></a><span id="l97.890" class="difflineplus">+</span>
<a href="#l97.891"></a><span id="l97.891" class="difflineplus">+    // reminder</span>
<a href="#l97.892"></a><span id="l97.892" class="difflineplus">+    if (data.reminder != undefined) {</span>
<a href="#l97.893"></a><span id="l97.893" class="difflineplus">+        controller.select(new elementslib.ID(controller.window.document, &quot;item-alarm&quot;), data.reminder);</span>
<a href="#l97.894"></a><span id="l97.894" class="difflineplus">+    }</span>
<a href="#l97.895"></a><span id="l97.895"> </span>
<a href="#l97.896"></a><span id="l97.896" class="difflineminus">-  // priority</span>
<a href="#l97.897"></a><span id="l97.897" class="difflineminus">-  if (data.priority != undefined) {</span>
<a href="#l97.898"></a><span id="l97.898" class="difflineminus">-    controller.mainMenu.click(&quot;#options-priority-&quot; + data.priority + &quot;-label&quot;);</span>
<a href="#l97.899"></a><span id="l97.899" class="difflineminus">-  }</span>
<a href="#l97.900"></a><span id="l97.900" class="difflineminus">-</span>
<a href="#l97.901"></a><span id="l97.901" class="difflineminus">-  // privacy</span>
<a href="#l97.902"></a><span id="l97.902" class="difflineminus">-  if (data.privacy != undefined) {</span>
<a href="#l97.903"></a><span id="l97.903" class="difflineminus">-    controller.mainMenu.click(&quot;#options-privacy-&quot; + data.privacy + &quot;-menuitem&quot;);</span>
<a href="#l97.904"></a><span id="l97.904" class="difflineminus">-  }</span>
<a href="#l97.905"></a><span id="l97.905" class="difflineplus">+    // description</span>
<a href="#l97.906"></a><span id="l97.906" class="difflineplus">+    if (data.description != undefined) {</span>
<a href="#l97.907"></a><span id="l97.907" class="difflineplus">+        if (mac) {</span>
<a href="#l97.908"></a><span id="l97.908" class="difflineplus">+            let descField = new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.909"></a><span id="l97.909" class="difflineplus">+              'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l97.910"></a><span id="l97.910" class="difflineplus">+              'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l97.911"></a><span id="l97.911" class="difflineplus">+            descField.getNode().value = data.description;</span>
<a href="#l97.912"></a><span id="l97.912" class="difflineplus">+        } else {</span>
<a href="#l97.913"></a><span id="l97.913" class="difflineplus">+            controller.keypress(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.914"></a><span id="l97.914" class="difflineplus">+              'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l97.915"></a><span id="l97.915" class="difflineplus">+              'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.916"></a><span id="l97.916" class="difflineplus">+              &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.917"></a><span id="l97.917" class="difflineplus">+            controller.type(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.918"></a><span id="l97.918" class="difflineplus">+              'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l97.919"></a><span id="l97.919" class="difflineplus">+              'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l97.920"></a><span id="l97.920" class="difflineplus">+              data.description);</span>
<a href="#l97.921"></a><span id="l97.921" class="difflineplus">+        }</span>
<a href="#l97.922"></a><span id="l97.922" class="difflineplus">+    }</span>
<a href="#l97.923"></a><span id="l97.923"> </span>
<a href="#l97.924"></a><span id="l97.924" class="difflineminus">-  // status</span>
<a href="#l97.925"></a><span id="l97.925" class="difflineminus">-  if (data.status != undefined) {</span>
<a href="#l97.926"></a><span id="l97.926" class="difflineminus">-    if (isEvent) {</span>
<a href="#l97.927"></a><span id="l97.927" class="difflineminus">-      controller.mainMenu.click(&quot;#options-status-&quot; + data.status + &quot;-menuitem&quot;);</span>
<a href="#l97.928"></a><span id="l97.928" class="difflineminus">-    } else {</span>
<a href="#l97.929"></a><span id="l97.929" class="difflineminus">-      controller.select(new elementslib.ID(controller.window.document, &quot;todo-status&quot;), undefined,</span>
<a href="#l97.930"></a><span id="l97.930" class="difflineminus">-        undefined, data.status.toUpperCase());</span>
<a href="#l97.931"></a><span id="l97.931" class="difflineminus">-      controller.sleep(sleep);</span>
<a href="#l97.932"></a><span id="l97.932" class="difflineplus">+    // priority</span>
<a href="#l97.933"></a><span id="l97.933" class="difflineplus">+    if (data.priority != undefined) {</span>
<a href="#l97.934"></a><span id="l97.934" class="difflineplus">+        controller.mainMenu.click(&quot;#options-priority-&quot; + data.priority + &quot;-label&quot;);</span>
<a href="#l97.935"></a><span id="l97.935" class="difflineplus">+    }</span>
<a href="#l97.936"></a><span id="l97.936" class="difflineplus">+</span>
<a href="#l97.937"></a><span id="l97.937" class="difflineplus">+    // privacy</span>
<a href="#l97.938"></a><span id="l97.938" class="difflineplus">+    if (data.privacy != undefined) {</span>
<a href="#l97.939"></a><span id="l97.939" class="difflineplus">+        controller.mainMenu.click(&quot;#options-privacy-&quot; + data.privacy + &quot;-menuitem&quot;);</span>
<a href="#l97.940"></a><span id="l97.940">     }</span>
<a href="#l97.941"></a><span id="l97.941" class="difflineminus">-  }</span>
<a href="#l97.942"></a><span id="l97.942" class="difflineminus">-</span>
<a href="#l97.943"></a><span id="l97.943" class="difflineminus">-  let currentStatus = (new elementslib.ID(controller.window.document, &quot;todo-status&quot;)).getNode().value;</span>
<a href="#l97.944"></a><span id="l97.944"> </span>
<a href="#l97.945"></a><span id="l97.945" class="difflineminus">-  // completed on</span>
<a href="#l97.946"></a><span id="l97.946" class="difflineminus">-  if (data.completed != undefined &amp;&amp; data.completed.constructor.name == &quot;Date&quot; &amp;&amp; !isEvent) {</span>
<a href="#l97.947"></a><span id="l97.947" class="difflineminus">-    let completeddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l97.948"></a><span id="l97.948" class="difflineminus">-      data.completed.getFullYear(), data.completed.getMonth() + 1,</span>
<a href="#l97.949"></a><span id="l97.949" class="difflineminus">-      data.completed.getDate());</span>
<a href="#l97.950"></a><span id="l97.950" class="difflineplus">+    // status</span>
<a href="#l97.951"></a><span id="l97.951" class="difflineplus">+    if (data.status != undefined) {</span>
<a href="#l97.952"></a><span id="l97.952" class="difflineplus">+        if (isEvent) {</span>
<a href="#l97.953"></a><span id="l97.953" class="difflineplus">+            controller.mainMenu.click(&quot;#options-status-&quot; + data.status + &quot;-menuitem&quot;);</span>
<a href="#l97.954"></a><span id="l97.954" class="difflineplus">+        } else {</span>
<a href="#l97.955"></a><span id="l97.955" class="difflineplus">+            controller.select(new elementslib.ID(controller.window.document, &quot;todo-status&quot;), undefined,</span>
<a href="#l97.956"></a><span id="l97.956" class="difflineplus">+              undefined, data.status.toUpperCase());</span>
<a href="#l97.957"></a><span id="l97.957" class="difflineplus">+            controller.sleep(sleep);</span>
<a href="#l97.958"></a><span id="l97.958" class="difflineplus">+        }</span>
<a href="#l97.959"></a><span id="l97.959" class="difflineplus">+    }</span>
<a href="#l97.960"></a><span id="l97.960" class="difflineplus">+</span>
<a href="#l97.961"></a><span id="l97.961" class="difflineplus">+    let currentStatus = (new elementslib.ID(controller.window.document, &quot;todo-status&quot;)).getNode().value;</span>
<a href="#l97.962"></a><span id="l97.962"> </span>
<a href="#l97.963"></a><span id="l97.963" class="difflineminus">-    if (currentStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l97.964"></a><span id="l97.964" class="difflineminus">-      if (mac) {</span>
<a href="#l97.965"></a><span id="l97.965" class="difflineminus">-        completedDateInput.getNode().value = completeddate;</span>
<a href="#l97.966"></a><span id="l97.966" class="difflineminus">-      } else {</span>
<a href="#l97.967"></a><span id="l97.967" class="difflineminus">-        controller.keypress(completedDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.968"></a><span id="l97.968" class="difflineminus">-        controller.type(completedDateInput, completeddate);</span>
<a href="#l97.969"></a><span id="l97.969" class="difflineminus">-      }</span>
<a href="#l97.970"></a><span id="l97.970" class="difflineplus">+    // completed on</span>
<a href="#l97.971"></a><span id="l97.971" class="difflineplus">+    if (data.completed != undefined &amp;&amp; data.completed.constructor.name == &quot;Date&quot; &amp;&amp; !isEvent) {</span>
<a href="#l97.972"></a><span id="l97.972" class="difflineplus">+        let completeddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l97.973"></a><span id="l97.973" class="difflineplus">+          data.completed.getFullYear(), data.completed.getMonth() + 1,</span>
<a href="#l97.974"></a><span id="l97.974" class="difflineplus">+          data.completed.getDate());</span>
<a href="#l97.975"></a><span id="l97.975" class="difflineplus">+</span>
<a href="#l97.976"></a><span id="l97.976" class="difflineplus">+        if (currentStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l97.977"></a><span id="l97.977" class="difflineplus">+            if (mac) {</span>
<a href="#l97.978"></a><span id="l97.978" class="difflineplus">+                completedDateInput.getNode().value = completeddate;</span>
<a href="#l97.979"></a><span id="l97.979" class="difflineplus">+            } else {</span>
<a href="#l97.980"></a><span id="l97.980" class="difflineplus">+                controller.keypress(completedDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l97.981"></a><span id="l97.981" class="difflineplus">+                controller.type(completedDateInput, completeddate);</span>
<a href="#l97.982"></a><span id="l97.982" class="difflineplus">+            }</span>
<a href="#l97.983"></a><span id="l97.983" class="difflineplus">+        }</span>
<a href="#l97.984"></a><span id="l97.984">     }</span>
<a href="#l97.985"></a><span id="l97.985" class="difflineminus">-  }</span>
<a href="#l97.986"></a><span id="l97.986" class="difflineminus">-</span>
<a href="#l97.987"></a><span id="l97.987" class="difflineminus">-  // percent complete</span>
<a href="#l97.988"></a><span id="l97.988" class="difflineminus">-  if (data.percent != undefined &amp;&amp;</span>
<a href="#l97.989"></a><span id="l97.989" class="difflineminus">-       (currentStatus == &quot;NEEDS-ACTION&quot; || currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l97.990"></a><span id="l97.990" class="difflineminus">-        currentStatus == &quot;COMPLETED&quot;)) {</span>
<a href="#l97.991"></a><span id="l97.991" class="difflineminus">-    percentCompleteInput.getNode().value = data.percent;</span>
<a href="#l97.992"></a><span id="l97.992" class="difflineminus">-  }</span>
<a href="#l97.993"></a><span id="l97.993"> </span>
<a href="#l97.994"></a><span id="l97.994" class="difflineminus">-  // free/busy</span>
<a href="#l97.995"></a><span id="l97.995" class="difflineminus">-  if (data.freebusy != undefined) {</span>
<a href="#l97.996"></a><span id="l97.996" class="difflineminus">-    controller.mainMenu.click(&quot;#options-freebusy-&quot; + data.freebusy + &quot;-menuitem&quot;);</span>
<a href="#l97.997"></a><span id="l97.997" class="difflineminus">-  }</span>
<a href="#l97.998"></a><span id="l97.998" class="difflineplus">+    // percent complete</span>
<a href="#l97.999"></a><span id="l97.999" class="difflineplus">+    if (data.percent != undefined &amp;&amp;</span>
<a href="#l97.1000"></a><span id="l97.1000" class="difflineplus">+         (currentStatus == &quot;NEEDS-ACTION&quot; || currentStatus == &quot;IN-PROCESS&quot; ||</span>
<a href="#l97.1001"></a><span id="l97.1001" class="difflineplus">+          currentStatus == &quot;COMPLETED&quot;)) {</span>
<a href="#l97.1002"></a><span id="l97.1002" class="difflineplus">+        percentCompleteInput.getNode().value = data.percent;</span>
<a href="#l97.1003"></a><span id="l97.1003" class="difflineplus">+    }</span>
<a href="#l97.1004"></a><span id="l97.1004"> </span>
<a href="#l97.1005"></a><span id="l97.1005" class="difflineminus">-  // attachment</span>
<a href="#l97.1006"></a><span id="l97.1006" class="difflineminus">-  if (data.attachment != undefined) {</span>
<a href="#l97.1007"></a><span id="l97.1007" class="difflineminus">-    if (data.attachment.add != undefined) {</span>
<a href="#l97.1008"></a><span id="l97.1008" class="difflineminus">-      handleAddingAttachment(controller, data.attachment.add);</span>
<a href="#l97.1009"></a><span id="l97.1009" class="difflineminus">-      controller.click(new elementslib.ID(controller.window.document, &quot;button-url&quot;));</span>
<a href="#l97.1010"></a><span id="l97.1010" class="difflineplus">+    // free/busy</span>
<a href="#l97.1011"></a><span id="l97.1011" class="difflineplus">+    if (data.freebusy != undefined) {</span>
<a href="#l97.1012"></a><span id="l97.1012" class="difflineplus">+        controller.mainMenu.click(&quot;#options-freebusy-&quot; + data.freebusy + &quot;-menuitem&quot;);</span>
<a href="#l97.1013"></a><span id="l97.1013">     }</span>
<a href="#l97.1014"></a><span id="l97.1014" class="difflineminus">-    if (data.attachment.delete != undefined) {</span>
<a href="#l97.1015"></a><span id="l97.1015" class="difflineminus">-      controller.click(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.1016"></a><span id="l97.1016" class="difflineminus">-        'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;' +</span>
<a href="#l97.1017"></a><span id="l97.1017" class="difflineminus">-        data.attachment.delete + '&quot;}'));</span>
<a href="#l97.1018"></a><span id="l97.1018" class="difflineminus">-      controller.keypress(new elementslib.ID(controller.window.document, &quot;attachment-link&quot;),</span>
<a href="#l97.1019"></a><span id="l97.1019" class="difflineminus">-        &quot;VK_DELETE&quot;, {});</span>
<a href="#l97.1020"></a><span id="l97.1020" class="difflineplus">+</span>
<a href="#l97.1021"></a><span id="l97.1021" class="difflineplus">+    // attachment</span>
<a href="#l97.1022"></a><span id="l97.1022" class="difflineplus">+    if (data.attachment != undefined) {</span>
<a href="#l97.1023"></a><span id="l97.1023" class="difflineplus">+        if (data.attachment.add != undefined) {</span>
<a href="#l97.1024"></a><span id="l97.1024" class="difflineplus">+            handleAddingAttachment(controller, data.attachment.add);</span>
<a href="#l97.1025"></a><span id="l97.1025" class="difflineplus">+            controller.click(new elementslib.ID(controller.window.document, &quot;button-url&quot;));</span>
<a href="#l97.1026"></a><span id="l97.1026" class="difflineplus">+        }</span>
<a href="#l97.1027"></a><span id="l97.1027" class="difflineplus">+        if (data.attachment.delete != undefined) {</span>
<a href="#l97.1028"></a><span id="l97.1028" class="difflineplus">+            controller.click(new elementslib.Lookup(controller.window.document, dialog +</span>
<a href="#l97.1029"></a><span id="l97.1029" class="difflineplus">+              'id(&quot;event-grid-attachment-row&quot;)/id(&quot;attachment-link&quot;)/{&quot;label&quot;:&quot;' +</span>
<a href="#l97.1030"></a><span id="l97.1030" class="difflineplus">+              data.attachment.delete + '&quot;}'));</span>
<a href="#l97.1031"></a><span id="l97.1031" class="difflineplus">+            controller.keypress(new elementslib.ID(controller.window.document, &quot;attachment-link&quot;),</span>
<a href="#l97.1032"></a><span id="l97.1032" class="difflineplus">+              &quot;VK_DELETE&quot;, {});</span>
<a href="#l97.1033"></a><span id="l97.1033" class="difflineplus">+        }</span>
<a href="#l97.1034"></a><span id="l97.1034">     }</span>
<a href="#l97.1035"></a><span id="l97.1035" class="difflineminus">-  }</span>
<a href="#l97.1036"></a><span id="l97.1036"> </span>
<a href="#l97.1037"></a><span id="l97.1037" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l97.1038"></a><span id="l97.1038" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l97.1039"></a><span id="l97.1039"> }</span>
<a href="#l97.1040"></a><span id="l97.1040"> </span>
<a href="#l97.1041"></a><span id="l97.1041"> function open_lightning_prefs(aCallback, aParentController, collector, windowTimeout) {</span>
<a href="#l97.1042"></a><span id="l97.1042" class="difflineminus">-  function paneLoadedChecker() {</span>
<a href="#l97.1043"></a><span id="l97.1043" class="difflineminus">-    let pane = prefsController.window.document.getElementById(&quot;paneLightning&quot;);</span>
<a href="#l97.1044"></a><span id="l97.1044" class="difflineminus">-    return pane.loaded;</span>
<a href="#l97.1045"></a><span id="l97.1045" class="difflineminus">-  }</span>
<a href="#l97.1046"></a><span id="l97.1046" class="difflineplus">+    function paneLoadedChecker() {</span>
<a href="#l97.1047"></a><span id="l97.1047" class="difflineplus">+        let pane = prefsController.window.document.getElementById(&quot;paneLightning&quot;);</span>
<a href="#l97.1048"></a><span id="l97.1048" class="difflineplus">+        return pane.loaded;</span>
<a href="#l97.1049"></a><span id="l97.1049" class="difflineplus">+    }</span>
<a href="#l97.1050"></a><span id="l97.1050"> </span>
<a href="#l97.1051"></a><span id="l97.1051" class="difflineminus">-  let timeout = windowTimeout || 30000;</span>
<a href="#l97.1052"></a><span id="l97.1052" class="difflineminus">-  aParentController.window.openOptionsDialog(&quot;paneLightning&quot;);</span>
<a href="#l97.1053"></a><span id="l97.1053" class="difflineminus">-  aParentController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length == 1,</span>
<a href="#l97.1054"></a><span id="l97.1054" class="difflineminus">-                            &quot;Error opening preferences window&quot;, timeout);</span>
<a href="#l97.1055"></a><span id="l97.1055" class="difflineminus">-  let prefsController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Mail:Preferences&quot;)[0]);</span>
<a href="#l97.1056"></a><span id="l97.1056" class="difflineminus">-  prefsController.waitFor(paneLoadedChecker, &quot;Timed out waiting for lightning prefpane to load.&quot;);</span>
<a href="#l97.1057"></a><span id="l97.1057" class="difflineplus">+    let timeout = windowTimeout || 30000;</span>
<a href="#l97.1058"></a><span id="l97.1058" class="difflineplus">+    aParentController.window.openOptionsDialog(&quot;paneLightning&quot;);</span>
<a href="#l97.1059"></a><span id="l97.1059" class="difflineplus">+    aParentController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length == 1,</span>
<a href="#l97.1060"></a><span id="l97.1060" class="difflineplus">+                              &quot;Error opening preferences window&quot;, timeout);</span>
<a href="#l97.1061"></a><span id="l97.1061" class="difflineplus">+    let prefsController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Mail:Preferences&quot;)[0]);</span>
<a href="#l97.1062"></a><span id="l97.1062" class="difflineplus">+    prefsController.waitFor(paneLoadedChecker, &quot;Timed out waiting for lightning prefpane to load.&quot;);</span>
<a href="#l97.1063"></a><span id="l97.1063"> </span>
<a href="#l97.1064"></a><span id="l97.1064" class="difflineminus">-  aCallback(prefsController);</span>
<a href="#l97.1065"></a><span id="l97.1065" class="difflineplus">+    aCallback(prefsController);</span>
<a href="#l97.1066"></a><span id="l97.1066"> </span>
<a href="#l97.1067"></a><span id="l97.1067" class="difflineminus">-  prefsController.window.close();</span>
<a href="#l97.1068"></a><span id="l97.1068" class="difflineminus">-  aParentController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length == 0,</span>
<a href="#l97.1069"></a><span id="l97.1069" class="difflineminus">-                            &quot;Error closing preferences window&quot;, timeout);</span>
<a href="#l97.1070"></a><span id="l97.1070" class="difflineplus">+    prefsController.window.close();</span>
<a href="#l97.1071"></a><span id="l97.1071" class="difflineplus">+    aParentController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Mail:Preferences&quot;).length == 0,</span>
<a href="#l97.1072"></a><span id="l97.1072" class="difflineplus">+                              &quot;Error closing preferences window&quot;, timeout);</span>
<a href="#l97.1073"></a><span id="l97.1073"> }</span>
<a href="#l97.1074"></a><span id="l97.1074"> </span>
<a href="#l97.1075"></a><span id="l97.1075"> // Export of constants</span>
<a href="#l97.1076"></a><span id="l97.1076"> exports.ALLDAY = ALLDAY;</span>
<a href="#l97.1077"></a><span id="l97.1077"> exports.CANVAS_BOX = CANVAS_BOX;</span>
<a href="#l97.1078"></a><span id="l97.1078"> exports.EVENT_BOX = EVENT_BOX;</span>
<a href="#l97.1079"></a><span id="l97.1079"> </span>
<a href="#l97.1080"></a><span id="l97.1080"> // Export of functions</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -1,90 +1,90 @@</span>
<a href="#l98.4"></a><span id="l98.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l98.5"></a><span id="l98.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l98.6"></a><span id="l98.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l98.7"></a><span id="l98.7"> </span>
<a href="#l98.8"></a><span id="l98.8"> var calUtils = require(&quot;calendar-utils&quot;);</span>
<a href="#l98.9"></a><span id="l98.9"> var prefs = require(&quot;prefs&quot;);</span>
<a href="#l98.10"></a><span id="l98.10"> </span>
<a href="#l98.11"></a><span id="l98.11"> function switchAppTimezone(timezone) {</span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-  // change directly as Mac has different Lookup &amp; XPath than Windows &amp; Linux, bug 536605</span>
<a href="#l98.13"></a><span id="l98.13" class="difflineminus">-  prefs.preferences.setPref(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l98.14"></a><span id="l98.14" class="difflineplus">+    // change directly as Mac has different Lookup &amp; XPath than Windows &amp; Linux, bug 536605</span>
<a href="#l98.15"></a><span id="l98.15" class="difflineplus">+    prefs.preferences.setPref(&quot;calendar.timezone.local&quot;, timezone);</span>
<a href="#l98.16"></a><span id="l98.16"> }</span>
<a href="#l98.17"></a><span id="l98.17"> </span>
<a href="#l98.18"></a><span id="l98.18"> function verify(controller, dates, timezones, times) {</span>
<a href="#l98.19"></a><span id="l98.19" class="difflineminus">-  let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l98.20"></a><span id="l98.20" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l98.21"></a><span id="l98.21" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)';</span>
<a href="#l98.22"></a><span id="l98.22" class="difflineminus">-  let dayStack = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l98.23"></a><span id="l98.23" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l98.24"></a><span id="l98.24" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l98.25"></a><span id="l98.25" class="difflineminus">-  let timeLine = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/' +</span>
<a href="#l98.26"></a><span id="l98.26" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;topbox&quot;})/';</span>
<a href="#l98.27"></a><span id="l98.27" class="difflineminus">-  let allowedDifference = 3;</span>
<a href="#l98.28"></a><span id="l98.28" class="difflineplus">+    let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l98.29"></a><span id="l98.29" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l98.30"></a><span id="l98.30" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)';</span>
<a href="#l98.31"></a><span id="l98.31" class="difflineplus">+    let dayStack = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l98.32"></a><span id="l98.32" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l98.33"></a><span id="l98.33" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l98.34"></a><span id="l98.34" class="difflineplus">+    let timeLine = dayView + '/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/' +</span>
<a href="#l98.35"></a><span id="l98.35" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/';</span>
<a href="#l98.36"></a><span id="l98.36" class="difflineplus">+    let allowedDifference = 3;</span>
<a href="#l98.37"></a><span id="l98.37"> </span>
<a href="#l98.38"></a><span id="l98.38" class="difflineminus">-  /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l98.39"></a><span id="l98.39" class="difflineminus">-     xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l98.40"></a><span id="l98.40" class="difflineminus">-     a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l98.41"></a><span id="l98.41" class="difflineminus">-     But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l98.42"></a><span id="l98.42" class="difflineminus">-     on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l98.43"></a><span id="l98.43" class="difflineminus">-  */</span>
<a href="#l98.44"></a><span id="l98.44" class="difflineminus">-  for (let date = 0; date &lt; dates.length; date++) {</span>
<a href="#l98.45"></a><span id="l98.45" class="difflineminus">-    calUtils.goToDate(controller, dates[date][0], dates[date][1], dates[date][2]);</span>
<a href="#l98.46"></a><span id="l98.46" class="difflineplus">+    /* Event box' time can't be deduced from it's position in                    ----------------</span>
<a href="#l98.47"></a><span id="l98.47" class="difflineplus">+       xul element tree because for each event a box is laid over whole day and  |___spacer_____|</span>
<a href="#l98.48"></a><span id="l98.48" class="difflineplus">+       a spacer is added to push the event to it's correct location.             |__event_box___|</span>
<a href="#l98.49"></a><span id="l98.49" class="difflineplus">+       But timeline can be used to retrieve the position of a particular hour    |day continues |</span>
<a href="#l98.50"></a><span id="l98.50" class="difflineplus">+       on screen and it can be compared against the position of the event.       ----------------</span>
<a href="#l98.51"></a><span id="l98.51" class="difflineplus">+    */</span>
<a href="#l98.52"></a><span id="l98.52" class="difflineplus">+    for (let date = 0; date &lt; dates.length; date++) {</span>
<a href="#l98.53"></a><span id="l98.53" class="difflineplus">+        calUtils.goToDate(controller, dates[date][0], dates[date][1], dates[date][2]);</span>
<a href="#l98.54"></a><span id="l98.54"> </span>
<a href="#l98.55"></a><span id="l98.55" class="difflineminus">-    // find event with timezone tz</span>
<a href="#l98.56"></a><span id="l98.56" class="difflineminus">-    for (let tzIdx = 0; tzIdx &lt; timezones.length; tzIdx++) {</span>
<a href="#l98.57"></a><span id="l98.57" class="difflineminus">-      let found = false;</span>
<a href="#l98.58"></a><span id="l98.58" class="difflineplus">+        // find event with timezone tz</span>
<a href="#l98.59"></a><span id="l98.59" class="difflineplus">+        for (let tzIdx = 0; tzIdx &lt; timezones.length; tzIdx++) {</span>
<a href="#l98.60"></a><span id="l98.60" class="difflineplus">+            let found = false;</span>
<a href="#l98.61"></a><span id="l98.61"> </span>
<a href="#l98.62"></a><span id="l98.62" class="difflineminus">-      let correctHour = times[date][tzIdx][0];</span>
<a href="#l98.63"></a><span id="l98.63" class="difflineminus">-      let minutes = times[date][tzIdx][1];</span>
<a href="#l98.64"></a><span id="l98.64" class="difflineminus">-      let day = times[date][tzIdx][2];</span>
<a href="#l98.65"></a><span id="l98.65" class="difflineplus">+            let correctHour = times[date][tzIdx][0];</span>
<a href="#l98.66"></a><span id="l98.66" class="difflineplus">+            let minutes = times[date][tzIdx][1];</span>
<a href="#l98.67"></a><span id="l98.67" class="difflineplus">+            let day = times[date][tzIdx][2];</span>
<a href="#l98.68"></a><span id="l98.68"> </span>
<a href="#l98.69"></a><span id="l98.69" class="difflineminus">-      let timeNode = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l98.70"></a><span id="l98.70" class="difflineminus">-                                             timeLine + &quot;[&quot; + correctHour + &quot;]&quot;)).getNode();</span>
<a href="#l98.71"></a><span id="l98.71" class="difflineminus">-      let timeY = timeNode.boxObject.y;</span>
<a href="#l98.72"></a><span id="l98.72" class="difflineminus">-      timeY += timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l98.73"></a><span id="l98.73" class="difflineplus">+            let timeNode = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l98.74"></a><span id="l98.74" class="difflineplus">+                                                   timeLine + &quot;[&quot; + correctHour + &quot;]&quot;)).getNode();</span>
<a href="#l98.75"></a><span id="l98.75" class="difflineplus">+            let timeY = timeNode.boxObject.y;</span>
<a href="#l98.76"></a><span id="l98.76" class="difflineplus">+            timeY += timeNode.boxObject.height * (minutes / 60);</span>
<a href="#l98.77"></a><span id="l98.77"> </span>
<a href="#l98.78"></a><span id="l98.78" class="difflineminus">-      let stackNode;</span>
<a href="#l98.79"></a><span id="l98.79" class="difflineminus">-      let eventNodes = [];</span>
<a href="#l98.80"></a><span id="l98.80" class="difflineplus">+            let stackNode;</span>
<a href="#l98.81"></a><span id="l98.81" class="difflineplus">+            let eventNodes = [];</span>
<a href="#l98.82"></a><span id="l98.82"> </span>
<a href="#l98.83"></a><span id="l98.83" class="difflineminus">-      // same day</span>
<a href="#l98.84"></a><span id="l98.84" class="difflineminus">-      if (day == undefined) {</span>
<a href="#l98.85"></a><span id="l98.85" class="difflineminus">-        stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l98.86"></a><span id="l98.86" class="difflineminus">-      }</span>
<a href="#l98.87"></a><span id="l98.87" class="difflineplus">+            // same day</span>
<a href="#l98.88"></a><span id="l98.88" class="difflineplus">+            if (day == undefined) {</span>
<a href="#l98.89"></a><span id="l98.89" class="difflineplus">+                stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l98.90"></a><span id="l98.90" class="difflineplus">+            }</span>
<a href="#l98.91"></a><span id="l98.91"> </span>
<a href="#l98.92"></a><span id="l98.92" class="difflineminus">-      // following day</span>
<a href="#l98.93"></a><span id="l98.93" class="difflineminus">-      if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l98.94"></a><span id="l98.94" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l98.95"></a><span id="l98.95" class="difflineminus">-        stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l98.96"></a><span id="l98.96" class="difflineminus">-      }</span>
<a href="#l98.97"></a><span id="l98.97" class="difflineplus">+            // following day</span>
<a href="#l98.98"></a><span id="l98.98" class="difflineplus">+            if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l98.99"></a><span id="l98.99" class="difflineplus">+                calUtils.forward(controller, 1);</span>
<a href="#l98.100"></a><span id="l98.100" class="difflineplus">+                stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l98.101"></a><span id="l98.101" class="difflineplus">+            }</span>
<a href="#l98.102"></a><span id="l98.102"> </span>
<a href="#l98.103"></a><span id="l98.103" class="difflineminus">-      // previous day</span>
<a href="#l98.104"></a><span id="l98.104" class="difflineminus">-      if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l98.105"></a><span id="l98.105" class="difflineminus">-        calUtils.back(controller, 1);</span>
<a href="#l98.106"></a><span id="l98.106" class="difflineminus">-        stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l98.107"></a><span id="l98.107" class="difflineminus">-      }</span>
<a href="#l98.108"></a><span id="l98.108" class="difflineplus">+            // previous day</span>
<a href="#l98.109"></a><span id="l98.109" class="difflineplus">+            if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l98.110"></a><span id="l98.110" class="difflineplus">+                calUtils.back(controller, 1);</span>
<a href="#l98.111"></a><span id="l98.111" class="difflineplus">+                stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l98.112"></a><span id="l98.112" class="difflineplus">+            }</span>
<a href="#l98.113"></a><span id="l98.113"> </span>
<a href="#l98.114"></a><span id="l98.114" class="difflineminus">-      calUtils.findEventsInNode(stackNode, eventNodes);</span>
<a href="#l98.115"></a><span id="l98.115" class="difflineplus">+            calUtils.findEventsInNode(stackNode, eventNodes);</span>
<a href="#l98.116"></a><span id="l98.116"> </span>
<a href="#l98.117"></a><span id="l98.117" class="difflineminus">-      for (let node of eventNodes) {</span>
<a href="#l98.118"></a><span id="l98.118" class="difflineminus">-        if (Math.abs(timeY - node.boxObject.y) &lt; allowedDifference &amp;&amp;</span>
<a href="#l98.119"></a><span id="l98.119" class="difflineminus">-                     timezones[tzIdx] == node.mOccurrence.title) {</span>
<a href="#l98.120"></a><span id="l98.120" class="difflineminus">-          found = true;</span>
<a href="#l98.121"></a><span id="l98.121" class="difflineminus">-          break;</span>
<a href="#l98.122"></a><span id="l98.122" class="difflineminus">-        }</span>
<a href="#l98.123"></a><span id="l98.123" class="difflineminus">-      }</span>
<a href="#l98.124"></a><span id="l98.124" class="difflineplus">+            for (let node of eventNodes) {</span>
<a href="#l98.125"></a><span id="l98.125" class="difflineplus">+                if (Math.abs(timeY - node.boxObject.y) &lt; allowedDifference &amp;&amp;</span>
<a href="#l98.126"></a><span id="l98.126" class="difflineplus">+                             timezones[tzIdx] == node.mOccurrence.title) {</span>
<a href="#l98.127"></a><span id="l98.127" class="difflineplus">+                    found = true;</span>
<a href="#l98.128"></a><span id="l98.128" class="difflineplus">+                    break;</span>
<a href="#l98.129"></a><span id="l98.129" class="difflineplus">+                }</span>
<a href="#l98.130"></a><span id="l98.130" class="difflineplus">+            }</span>
<a href="#l98.131"></a><span id="l98.131"> </span>
<a href="#l98.132"></a><span id="l98.132" class="difflineminus">-      if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l98.133"></a><span id="l98.133" class="difflineminus">-        calUtils.back(controller, 1);</span>
<a href="#l98.134"></a><span id="l98.134" class="difflineminus">-      }</span>
<a href="#l98.135"></a><span id="l98.135" class="difflineplus">+            if (day != undefined &amp;&amp; day == 1) {</span>
<a href="#l98.136"></a><span id="l98.136" class="difflineplus">+                calUtils.back(controller, 1);</span>
<a href="#l98.137"></a><span id="l98.137" class="difflineplus">+            }</span>
<a href="#l98.138"></a><span id="l98.138"> </span>
<a href="#l98.139"></a><span id="l98.139" class="difflineminus">-      if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l98.140"></a><span id="l98.140" class="difflineminus">-        calUtils.forward(controller, 1);</span>
<a href="#l98.141"></a><span id="l98.141" class="difflineminus">-      }</span>
<a href="#l98.142"></a><span id="l98.142" class="difflineminus">-      controller.assertJS(found == true);</span>
<a href="#l98.143"></a><span id="l98.143" class="difflineplus">+            if (day != undefined &amp;&amp; day == -1) {</span>
<a href="#l98.144"></a><span id="l98.144" class="difflineplus">+                calUtils.forward(controller, 1);</span>
<a href="#l98.145"></a><span id="l98.145" class="difflineplus">+            }</span>
<a href="#l98.146"></a><span id="l98.146" class="difflineplus">+            controller.assertJS(found == true);</span>
<a href="#l98.147"></a><span id="l98.147" class="difflineplus">+        }</span>
<a href="#l98.148"></a><span id="l98.148">     }</span>
<a href="#l98.149"></a><span id="l98.149" class="difflineminus">-  }</span>
<a href="#l98.150"></a><span id="l98.150"> }</span>
<a href="#l98.151"></a><span id="l98.151"> </span>
<a href="#l98.152"></a><span id="l98.152"> // Export of functions</span>
<a href="#l98.153"></a><span id="l98.153"> exports.switchAppTimezone = switchAppTimezone;</span>
<a href="#l98.154"></a><span id="l98.154"> exports.verify = verify;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/calendar/test/mozmill/testAlarmDefaultValue.js</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -14,105 +14,105 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l99.4"></a><span id="l99.4"> var MODULE_NAME = &quot;testAlarmDefaultValue&quot;;</span>
<a href="#l99.5"></a><span id="l99.5"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l99.6"></a><span id="l99.6"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l99.7"></a><span id="l99.7"> </span>
<a href="#l99.8"></a><span id="l99.8"> var calendarController;</span>
<a href="#l99.9"></a><span id="l99.9"> var calUtils = require(&quot;shared-modules/calendar-utils&quot;);</span>
<a href="#l99.10"></a><span id="l99.10"> </span>
<a href="#l99.11"></a><span id="l99.11"> function setupModule(module) {</span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-  calendarController = mozmill.getMail3PaneController();</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+    calendarController = mozmill.getMail3PaneController();</span>
<a href="#l99.14"></a><span id="l99.14"> }</span>
<a href="#l99.15"></a><span id="l99.15"> </span>
<a href="#l99.16"></a><span id="l99.16"> function testDefaultAlarms() {</span>
<a href="#l99.17"></a><span id="l99.17" class="difflineminus">-  let localeUnitString = cal.calGetString(&quot;calendar&quot;,</span>
<a href="#l99.18"></a><span id="l99.18" class="difflineminus">-                                          &quot;unitDays&quot;);</span>
<a href="#l99.19"></a><span id="l99.19" class="difflineminus">-  let unitString = PluralForm.get(50, localeUnitString)</span>
<a href="#l99.20"></a><span id="l99.20" class="difflineminus">-                             .replace(&quot;#1&quot;, 50);</span>
<a href="#l99.21"></a><span id="l99.21" class="difflineminus">-  let originStringEvent = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.22"></a><span id="l99.22" class="difflineminus">-                                           &quot;reminderCustomOriginBeginBeforeEvent&quot;);</span>
<a href="#l99.23"></a><span id="l99.23" class="difflineminus">-  let originStringTask = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.24"></a><span id="l99.24" class="difflineminus">-                                          &quot;reminderCustomOriginBeginBeforeTask&quot;);</span>
<a href="#l99.25"></a><span id="l99.25" class="difflineminus">-  let expectedEventReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.26"></a><span id="l99.26" class="difflineminus">-                                              &quot;reminderCustomTitle&quot;,</span>
<a href="#l99.27"></a><span id="l99.27" class="difflineminus">-                                              [unitString, originStringEvent]);</span>
<a href="#l99.28"></a><span id="l99.28" class="difflineminus">-  let expectedTaskReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.29"></a><span id="l99.29" class="difflineminus">-                                              &quot;reminderCustomTitle&quot;,</span>
<a href="#l99.30"></a><span id="l99.30" class="difflineminus">-                                              [unitString, originStringTask]);</span>
<a href="#l99.31"></a><span id="l99.31" class="difflineplus">+    let localeUnitString = cal.calGetString(&quot;calendar&quot;,</span>
<a href="#l99.32"></a><span id="l99.32" class="difflineplus">+                                            &quot;unitDays&quot;);</span>
<a href="#l99.33"></a><span id="l99.33" class="difflineplus">+    let unitString = PluralForm.get(50, localeUnitString)</span>
<a href="#l99.34"></a><span id="l99.34" class="difflineplus">+                               .replace(&quot;#1&quot;, 50);</span>
<a href="#l99.35"></a><span id="l99.35" class="difflineplus">+    let originStringEvent = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.36"></a><span id="l99.36" class="difflineplus">+                                             &quot;reminderCustomOriginBeginBeforeEvent&quot;);</span>
<a href="#l99.37"></a><span id="l99.37" class="difflineplus">+    let originStringTask = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.38"></a><span id="l99.38" class="difflineplus">+                                            &quot;reminderCustomOriginBeginBeforeTask&quot;);</span>
<a href="#l99.39"></a><span id="l99.39" class="difflineplus">+    let expectedEventReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.40"></a><span id="l99.40" class="difflineplus">+                                                &quot;reminderCustomTitle&quot;,</span>
<a href="#l99.41"></a><span id="l99.41" class="difflineplus">+                                                [unitString, originStringEvent]);</span>
<a href="#l99.42"></a><span id="l99.42" class="difflineplus">+    let expectedTaskReminder = cal.calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l99.43"></a><span id="l99.43" class="difflineplus">+                                                &quot;reminderCustomTitle&quot;,</span>
<a href="#l99.44"></a><span id="l99.44" class="difflineplus">+                                                [unitString, originStringTask]);</span>
<a href="#l99.45"></a><span id="l99.45"> </span>
<a href="#l99.46"></a><span id="l99.46" class="difflineminus">-  // Configure the lightning preferences</span>
<a href="#l99.47"></a><span id="l99.47" class="difflineminus">-  calUtils.open_lightning_prefs(handle_pref_dialog, calendarController, collector);</span>
<a href="#l99.48"></a><span id="l99.48" class="difflineplus">+    // Configure the lightning preferences</span>
<a href="#l99.49"></a><span id="l99.49" class="difflineplus">+    calUtils.open_lightning_prefs(handle_pref_dialog, calendarController, collector);</span>
<a href="#l99.50"></a><span id="l99.50"> </span>
<a href="#l99.51"></a><span id="l99.51" class="difflineminus">-  // Create New Event</span>
<a href="#l99.52"></a><span id="l99.52" class="difflineminus">-  calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-calendar-menuitem&quot;));</span>
<a href="#l99.53"></a><span id="l99.53" class="difflineplus">+    // Create New Event</span>
<a href="#l99.54"></a><span id="l99.54" class="difflineplus">+    calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-calendar-menuitem&quot;));</span>
<a href="#l99.55"></a><span id="l99.55"> </span>
<a href="#l99.56"></a><span id="l99.56" class="difflineminus">-  // Set up the event dialog controller</span>
<a href="#l99.57"></a><span id="l99.57" class="difflineminus">-  calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0);</span>
<a href="#l99.58"></a><span id="l99.58" class="difflineminus">-  let eventController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l99.59"></a><span id="l99.59" class="difflineplus">+    // Set up the event dialog controller</span>
<a href="#l99.60"></a><span id="l99.60" class="difflineplus">+    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0);</span>
<a href="#l99.61"></a><span id="l99.61" class="difflineplus">+    let eventController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l99.62"></a><span id="l99.62"> </span>
<a href="#l99.63"></a><span id="l99.63" class="difflineminus">-  // Check if the &quot;custom&quot; item was selected</span>
<a href="#l99.64"></a><span id="l99.64" class="difflineminus">-  eventController.assertDOMProperty(new elementslib.ID(eventController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l99.65"></a><span id="l99.65" class="difflineminus">-                                    &quot;value&quot;,</span>
<a href="#l99.66"></a><span id="l99.66" class="difflineminus">-                                    &quot;custom&quot;);</span>
<a href="#l99.67"></a><span id="l99.67" class="difflineminus">-  eventController.assertDOMProperty(new elementslib.XPath(eventController.window.document,</span>
<a href="#l99.68"></a><span id="l99.68" class="difflineminus">-                                      '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l99.69"></a><span id="l99.69" class="difflineminus">-                                      'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l99.70"></a><span id="l99.70" class="difflineminus">-                                    &quot;value&quot;,</span>
<a href="#l99.71"></a><span id="l99.71" class="difflineminus">-                                    expectedEventReminder);</span>
<a href="#l99.72"></a><span id="l99.72" class="difflineplus">+    // Check if the &quot;custom&quot; item was selected</span>
<a href="#l99.73"></a><span id="l99.73" class="difflineplus">+    eventController.assertDOMProperty(new elementslib.ID(eventController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l99.74"></a><span id="l99.74" class="difflineplus">+                                      &quot;value&quot;,</span>
<a href="#l99.75"></a><span id="l99.75" class="difflineplus">+                                      &quot;custom&quot;);</span>
<a href="#l99.76"></a><span id="l99.76" class="difflineplus">+    eventController.assertDOMProperty(new elementslib.XPath(eventController.window.document,</span>
<a href="#l99.77"></a><span id="l99.77" class="difflineplus">+                                        '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l99.78"></a><span id="l99.78" class="difflineplus">+                                        'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l99.79"></a><span id="l99.79" class="difflineplus">+                                      &quot;value&quot;,</span>
<a href="#l99.80"></a><span id="l99.80" class="difflineplus">+                                      expectedEventReminder);</span>
<a href="#l99.81"></a><span id="l99.81"> </span>
<a href="#l99.82"></a><span id="l99.82" class="difflineminus">-  // Close the event dialog</span>
<a href="#l99.83"></a><span id="l99.83" class="difflineminus">-  eventController.window.close();</span>
<a href="#l99.84"></a><span id="l99.84" class="difflineminus">-  calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l99.85"></a><span id="l99.85" class="difflineplus">+    // Close the event dialog</span>
<a href="#l99.86"></a><span id="l99.86" class="difflineplus">+    eventController.window.close();</span>
<a href="#l99.87"></a><span id="l99.87" class="difflineplus">+    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l99.88"></a><span id="l99.88"> </span>
<a href="#l99.89"></a><span id="l99.89" class="difflineminus">-  // Create New Task</span>
<a href="#l99.90"></a><span id="l99.90" class="difflineminus">-  calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-task-menuitem&quot;));</span>
<a href="#l99.91"></a><span id="l99.91" class="difflineplus">+    // Create New Task</span>
<a href="#l99.92"></a><span id="l99.92" class="difflineplus">+    calendarController.click(new elementslib.ID(calendarController.window.document, &quot;newMsgButton-task-menuitem&quot;));</span>
<a href="#l99.93"></a><span id="l99.93"> </span>
<a href="#l99.94"></a><span id="l99.94" class="difflineminus">-  // Set up the task dialog controller</span>
<a href="#l99.95"></a><span id="l99.95" class="difflineminus">-  calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0);</span>
<a href="#l99.96"></a><span id="l99.96" class="difflineminus">-  let taskController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l99.97"></a><span id="l99.97" class="difflineplus">+    // Set up the task dialog controller</span>
<a href="#l99.98"></a><span id="l99.98" class="difflineplus">+    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0);</span>
<a href="#l99.99"></a><span id="l99.99" class="difflineplus">+    let taskController = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l99.100"></a><span id="l99.100"> </span>
<a href="#l99.101"></a><span id="l99.101" class="difflineminus">-  // Check if the &quot;custom&quot; item was selected</span>
<a href="#l99.102"></a><span id="l99.102" class="difflineminus">-  taskController.assertDOMProperty(new elementslib.ID(taskController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l99.103"></a><span id="l99.103" class="difflineminus">-                                   &quot;value&quot;,</span>
<a href="#l99.104"></a><span id="l99.104" class="difflineminus">-                                   &quot;custom&quot;);</span>
<a href="#l99.105"></a><span id="l99.105" class="difflineminus">-  taskController.assertDOMProperty(new elementslib.XPath(taskController.window.document,</span>
<a href="#l99.106"></a><span id="l99.106" class="difflineminus">-                                     '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l99.107"></a><span id="l99.107" class="difflineminus">-                                      'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l99.108"></a><span id="l99.108" class="difflineminus">-                                   &quot;value&quot;,</span>
<a href="#l99.109"></a><span id="l99.109" class="difflineminus">-                                   expectedTaskReminder);</span>
<a href="#l99.110"></a><span id="l99.110" class="difflineminus">-  // Close the task dialog</span>
<a href="#l99.111"></a><span id="l99.111" class="difflineminus">-  taskController.window.close();</span>
<a href="#l99.112"></a><span id="l99.112" class="difflineminus">-  calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l99.113"></a><span id="l99.113" class="difflineplus">+    // Check if the &quot;custom&quot; item was selected</span>
<a href="#l99.114"></a><span id="l99.114" class="difflineplus">+    taskController.assertDOMProperty(new elementslib.ID(taskController.window.document, &quot;item-alarm&quot;),</span>
<a href="#l99.115"></a><span id="l99.115" class="difflineplus">+                                     &quot;value&quot;,</span>
<a href="#l99.116"></a><span id="l99.116" class="difflineplus">+                                     &quot;custom&quot;);</span>
<a href="#l99.117"></a><span id="l99.117" class="difflineplus">+    taskController.assertDOMProperty(new elementslib.XPath(taskController.window.document,</span>
<a href="#l99.118"></a><span id="l99.118" class="difflineplus">+                                       '//*[@id=&quot;reminder-details&quot;]/*[local-name()=&quot;label&quot; ' +</span>
<a href="#l99.119"></a><span id="l99.119" class="difflineplus">+                                        'and (not(@hidden) or @hidden=&quot;false&quot;)]'),</span>
<a href="#l99.120"></a><span id="l99.120" class="difflineplus">+                                     &quot;value&quot;,</span>
<a href="#l99.121"></a><span id="l99.121" class="difflineplus">+                                     expectedTaskReminder);</span>
<a href="#l99.122"></a><span id="l99.122" class="difflineplus">+    // Close the task dialog</span>
<a href="#l99.123"></a><span id="l99.123" class="difflineplus">+    taskController.window.close();</span>
<a href="#l99.124"></a><span id="l99.124" class="difflineplus">+    calendarController.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l99.125"></a><span id="l99.125"> }</span>
<a href="#l99.126"></a><span id="l99.126"> </span>
<a href="#l99.127"></a><span id="l99.127"> function handle_pref_dialog(prefsController) {</span>
<a href="#l99.128"></a><span id="l99.128" class="difflineminus">-  // Click on the alarms tab</span>
<a href="#l99.129"></a><span id="l99.129" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;calPreferencesTabAlarms&quot;));</span>
<a href="#l99.130"></a><span id="l99.130" class="difflineplus">+    // Click on the alarms tab</span>
<a href="#l99.131"></a><span id="l99.131" class="difflineplus">+    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;calPreferencesTabAlarms&quot;));</span>
<a href="#l99.132"></a><span id="l99.132"> </span>
<a href="#l99.133"></a><span id="l99.133" class="difflineminus">-  // Turn on alarms for events and tasks</span>
<a href="#l99.134"></a><span id="l99.134" class="difflineminus">-  prefsController.waitThenClick(new elementslib.ID(prefsController.window.document, &quot;eventdefalarm&quot;));</span>
<a href="#l99.135"></a><span id="l99.135" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmon&quot;));</span>
<a href="#l99.136"></a><span id="l99.136" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarm&quot;));</span>
<a href="#l99.137"></a><span id="l99.137" class="difflineminus">-  prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarmon&quot;));</span>
<a href="#l99.138"></a><span id="l99.138" class="difflineplus">+    // Turn on alarms for events and tasks</span>
<a href="#l99.139"></a><span id="l99.139" class="difflineplus">+    prefsController.waitThenClick(new elementslib.ID(prefsController.window.document, &quot;eventdefalarm&quot;));</span>
<a href="#l99.140"></a><span id="l99.140" class="difflineplus">+    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmon&quot;));</span>
<a href="#l99.141"></a><span id="l99.141" class="difflineplus">+    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarm&quot;));</span>
<a href="#l99.142"></a><span id="l99.142" class="difflineplus">+    prefsController.click(new elementslib.ID(prefsController.window.document, &quot;tododefalarmon&quot;));</span>
<a href="#l99.143"></a><span id="l99.143"> </span>
<a href="#l99.144"></a><span id="l99.144" class="difflineminus">-  // Selects &quot;days&quot; as a unit</span>
<a href="#l99.145"></a><span id="l99.145" class="difflineminus">-  prefsController.select(new elementslib.ID(prefsController.window.document, &quot;tododefalarmunit&quot;),</span>
<a href="#l99.146"></a><span id="l99.146" class="difflineminus">-                         null, null, &quot;days&quot;);</span>
<a href="#l99.147"></a><span id="l99.147" class="difflineminus">-  prefsController.select(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmunit&quot;),</span>
<a href="#l99.148"></a><span id="l99.148" class="difflineminus">-                         null, null, &quot;days&quot;);</span>
<a href="#l99.149"></a><span id="l99.149" class="difflineplus">+    // Selects &quot;days&quot; as a unit</span>
<a href="#l99.150"></a><span id="l99.150" class="difflineplus">+    prefsController.select(new elementslib.ID(prefsController.window.document, &quot;tododefalarmunit&quot;),</span>
<a href="#l99.151"></a><span id="l99.151" class="difflineplus">+                           null, null, &quot;days&quot;);</span>
<a href="#l99.152"></a><span id="l99.152" class="difflineplus">+    prefsController.select(new elementslib.ID(prefsController.window.document, &quot;eventdefalarmunit&quot;),</span>
<a href="#l99.153"></a><span id="l99.153" class="difflineplus">+                           null, null, &quot;days&quot;);</span>
<a href="#l99.154"></a><span id="l99.154"> </span>
<a href="#l99.155"></a><span id="l99.155" class="difflineminus">-  // Sets default alarm length for events to &quot;50&quot;</span>
<a href="#l99.156"></a><span id="l99.156" class="difflineminus">-  let eventdefalarmlen = new elementslib.ID(prefsController.window.document, &quot;eventdefalarmlen&quot;);</span>
<a href="#l99.157"></a><span id="l99.157" class="difflineminus">-  let tododefalarmlen = new elementslib.ID(prefsController.window.document, &quot;tododefalarmlen&quot;);</span>
<a href="#l99.158"></a><span id="l99.158" class="difflineminus">-  prefsController.keypress(eventdefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l99.159"></a><span id="l99.159" class="difflineminus">-  prefsController.type(eventdefalarmlen, &quot;50&quot;);</span>
<a href="#l99.160"></a><span id="l99.160" class="difflineminus">-  prefsController.keypress(tododefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l99.161"></a><span id="l99.161" class="difflineminus">-  prefsController.type(tododefalarmlen, &quot;50&quot;);</span>
<a href="#l99.162"></a><span id="l99.162" class="difflineplus">+    // Sets default alarm length for events to &quot;50&quot;</span>
<a href="#l99.163"></a><span id="l99.163" class="difflineplus">+    let eventdefalarmlen = new elementslib.ID(prefsController.window.document, &quot;eventdefalarmlen&quot;);</span>
<a href="#l99.164"></a><span id="l99.164" class="difflineplus">+    let tododefalarmlen = new elementslib.ID(prefsController.window.document, &quot;tododefalarmlen&quot;);</span>
<a href="#l99.165"></a><span id="l99.165" class="difflineplus">+    prefsController.keypress(eventdefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l99.166"></a><span id="l99.166" class="difflineplus">+    prefsController.type(eventdefalarmlen, &quot;50&quot;);</span>
<a href="#l99.167"></a><span id="l99.167" class="difflineplus">+    prefsController.keypress(tododefalarmlen, &quot;a&quot;, { accelKey: true });</span>
<a href="#l99.168"></a><span id="l99.168" class="difflineplus">+    prefsController.type(tododefalarmlen, &quot;50&quot;);</span>
<a href="#l99.169"></a><span id="l99.169"> }</span>
<a href="#l99.170"></a><span id="l99.170"> </span>
<a href="#l99.171"></a><span id="l99.171"> function teardownTest(module) {</span>
<a href="#l99.172"></a><span id="l99.172" class="difflineminus">-  Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l99.173"></a><span id="l99.173" class="difflineminus">-  Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmunit&quot;);</span>
<a href="#l99.174"></a><span id="l99.174" class="difflineminus">-  Services.prefs.clearUserPref(&quot;calendar.alarms.onforevents&quot;);</span>
<a href="#l99.175"></a><span id="l99.175" class="difflineminus">-  Services.prefs.clearUserPref(&quot;calendar.alarms.onfortodos&quot;);</span>
<a href="#l99.176"></a><span id="l99.176" class="difflineminus">-  Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmlen&quot;);</span>
<a href="#l99.177"></a><span id="l99.177" class="difflineminus">-  Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmunit&quot;);</span>
<a href="#l99.178"></a><span id="l99.178" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l99.179"></a><span id="l99.179" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.eventalarmunit&quot;);</span>
<a href="#l99.180"></a><span id="l99.180" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.onforevents&quot;);</span>
<a href="#l99.181"></a><span id="l99.181" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.onfortodos&quot;);</span>
<a href="#l99.182"></a><span id="l99.182" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmlen&quot;);</span>
<a href="#l99.183"></a><span id="l99.183" class="difflineplus">+    Services.prefs.clearUserPref(&quot;calendar.alarms.todoalarmunit&quot;);</span>
<a href="#l99.184"></a><span id="l99.184"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -6,92 +6,92 @@ var MODULE_NAME = &quot;testBasicFunctionalit</span>
<a href="#l100.4"></a><span id="l100.4"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l100.5"></a><span id="l100.5"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l100.6"></a><span id="l100.6"> </span>
<a href="#l100.7"></a><span id="l100.7"> var calUtils = require(&quot;shared-modules/calendar-utils&quot;);</span>
<a href="#l100.8"></a><span id="l100.8"> var TIMEOUT_MODAL_DIALOG = 30000;</span>
<a href="#l100.9"></a><span id="l100.9"> </span>
<a href="#l100.10"></a><span id="l100.10"> var modalDialog;</span>
<a href="#l100.11"></a><span id="l100.11"> var setupModule = function(module) {</span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l100.13"></a><span id="l100.13" class="difflineminus">-  modalDialog = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l100.14"></a><span id="l100.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l100.15"></a><span id="l100.15" class="difflineplus">+    modalDialog = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l100.16"></a><span id="l100.16"> };</span>
<a href="#l100.17"></a><span id="l100.17"> </span>
<a href="#l100.18"></a><span id="l100.18"> var testSmokeTest = function() {</span>
<a href="#l100.19"></a><span id="l100.19" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l100.20"></a><span id="l100.20" class="difflineminus">-                              .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l100.21"></a><span id="l100.21" class="difflineminus">-  let path = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l100.22"></a><span id="l100.22" class="difflineminus">-    'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/';</span>
<a href="#l100.23"></a><span id="l100.23" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l100.24"></a><span id="l100.24" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l100.25"></a><span id="l100.25" class="difflineplus">+    let path = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l100.26"></a><span id="l100.26" class="difflineplus">+      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/';</span>
<a href="#l100.27"></a><span id="l100.27"> </span>
<a href="#l100.28"></a><span id="l100.28" class="difflineminus">-  // open calendar view</span>
<a href="#l100.29"></a><span id="l100.29" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l100.30"></a><span id="l100.30" class="difflineplus">+    // open calendar view</span>
<a href="#l100.31"></a><span id="l100.31" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l100.32"></a><span id="l100.32"> </span>
<a href="#l100.33"></a><span id="l100.33" class="difflineminus">-  // check for minimonth</span>
<a href="#l100.34"></a><span id="l100.34" class="difflineminus">-  controller.waitForElement(new elementslib.ID(controller.window.document, &quot;calMinimonth&quot;));</span>
<a href="#l100.35"></a><span id="l100.35" class="difflineminus">-  // every month has a first</span>
<a href="#l100.36"></a><span id="l100.36" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.37"></a><span id="l100.37" class="difflineminus">-    'id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/' +</span>
<a href="#l100.38"></a><span id="l100.38" class="difflineminus">-    'id(&quot;calMinimonth&quot;)/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l100.39"></a><span id="l100.39" class="difflineplus">+    // check for minimonth</span>
<a href="#l100.40"></a><span id="l100.40" class="difflineplus">+    controller.waitForElement(new elementslib.ID(controller.window.document, &quot;calMinimonth&quot;));</span>
<a href="#l100.41"></a><span id="l100.41" class="difflineplus">+    // every month has a first</span>
<a href="#l100.42"></a><span id="l100.42" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.43"></a><span id="l100.43" class="difflineplus">+      'id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/' +</span>
<a href="#l100.44"></a><span id="l100.44" class="difflineplus">+      'id(&quot;calMinimonth&quot;)/anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l100.45"></a><span id="l100.45"> </span>
<a href="#l100.46"></a><span id="l100.46" class="difflineminus">-  // check for calendar list</span>
<a href="#l100.47"></a><span id="l100.47" class="difflineminus">-  controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-list-pane&quot;));</span>
<a href="#l100.48"></a><span id="l100.48" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.49"></a><span id="l100.49" class="difflineminus">-    'id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/' +</span>
<a href="#l100.50"></a><span id="l100.50" class="difflineminus">-    'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})'));</span>
<a href="#l100.51"></a><span id="l100.51" class="difflineplus">+    // check for calendar list</span>
<a href="#l100.52"></a><span id="l100.52" class="difflineplus">+    controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-list-pane&quot;));</span>
<a href="#l100.53"></a><span id="l100.53" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.54"></a><span id="l100.54" class="difflineplus">+      'id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/' +</span>
<a href="#l100.55"></a><span id="l100.55" class="difflineplus">+      'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})'));</span>
<a href="#l100.56"></a><span id="l100.56"> </span>
<a href="#l100.57"></a><span id="l100.57" class="difflineminus">-  // check for event search</span>
<a href="#l100.58"></a><span id="l100.58" class="difflineminus">-  controller.assertNode(new elementslib.ID(controller.window.document, &quot;bottom-events-box&quot;));</span>
<a href="#l100.59"></a><span id="l100.59" class="difflineminus">-  // there should be search field</span>
<a href="#l100.60"></a><span id="l100.60" class="difflineminus">-  controller.assertNode(new elementslib.ID(controller.window.document, &quot;unifinder-search-field&quot;));</span>
<a href="#l100.61"></a><span id="l100.61" class="difflineplus">+    // check for event search</span>
<a href="#l100.62"></a><span id="l100.62" class="difflineplus">+    controller.assertNode(new elementslib.ID(controller.window.document, &quot;bottom-events-box&quot;));</span>
<a href="#l100.63"></a><span id="l100.63" class="difflineplus">+    // there should be search field</span>
<a href="#l100.64"></a><span id="l100.64" class="difflineplus">+    controller.assertNode(new elementslib.ID(controller.window.document, &quot;unifinder-search-field&quot;));</span>
<a href="#l100.65"></a><span id="l100.65"> </span>
<a href="#l100.66"></a><span id="l100.66" class="difflineminus">-  // default view is day view which should have 09:00 label and box</span>
<a href="#l100.67"></a><span id="l100.67" class="difflineminus">-  let label = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, 9, 0, 0);</span>
<a href="#l100.68"></a><span id="l100.68" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.69"></a><span id="l100.69" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/' +</span>
<a href="#l100.70"></a><span id="l100.70" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/' +</span>
<a href="#l100.71"></a><span id="l100.71" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;topbox&quot;})/[9]/{&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;' + label + '&quot;}'));</span>
<a href="#l100.72"></a><span id="l100.72" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.73"></a><span id="l100.73" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/' +</span>
<a href="#l100.74"></a><span id="l100.74" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/' +</span>
<a href="#l100.75"></a><span id="l100.75" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'));</span>
<a href="#l100.76"></a><span id="l100.76" class="difflineplus">+    // default view is day view which should have 09:00 label and box</span>
<a href="#l100.77"></a><span id="l100.77" class="difflineplus">+    let label = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, 9, 0, 0);</span>
<a href="#l100.78"></a><span id="l100.78" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.79"></a><span id="l100.79" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/' +</span>
<a href="#l100.80"></a><span id="l100.80" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/' +</span>
<a href="#l100.81"></a><span id="l100.81" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/[9]/{&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;' + label + '&quot;}'));</span>
<a href="#l100.82"></a><span id="l100.82" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.83"></a><span id="l100.83" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/' +</span>
<a href="#l100.84"></a><span id="l100.84" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/[0]/' +</span>
<a href="#l100.85"></a><span id="l100.85" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'));</span>
<a href="#l100.86"></a><span id="l100.86"> </span>
<a href="#l100.87"></a><span id="l100.87" class="difflineminus">-  // open tasks view</span>
<a href="#l100.88"></a><span id="l100.88" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l100.89"></a><span id="l100.89" class="difflineminus">-  // should be possible to filter today's tasks</span>
<a href="#l100.90"></a><span id="l100.90" class="difflineminus">-  controller.waitForElement(new elementslib.ID(controller.window.document, &quot;opt_today_filter&quot;));</span>
<a href="#l100.91"></a><span id="l100.91" class="difflineminus">-  // check for task add button</span>
<a href="#l100.92"></a><span id="l100.92" class="difflineminus">-  controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-add-task-button&quot;));</span>
<a href="#l100.93"></a><span id="l100.93" class="difflineminus">-  // check for filtered tasks list</span>
<a href="#l100.94"></a><span id="l100.94" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.95"></a><span id="l100.95" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/[1]/id(&quot;calendar-task-tree&quot;)/' +</span>
<a href="#l100.96"></a><span id="l100.96" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}'));</span>
<a href="#l100.97"></a><span id="l100.97" class="difflineplus">+    // open tasks view</span>
<a href="#l100.98"></a><span id="l100.98" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l100.99"></a><span id="l100.99" class="difflineplus">+    // should be possible to filter today's tasks</span>
<a href="#l100.100"></a><span id="l100.100" class="difflineplus">+    controller.waitForElement(new elementslib.ID(controller.window.document, &quot;opt_today_filter&quot;));</span>
<a href="#l100.101"></a><span id="l100.101" class="difflineplus">+    // check for task add button</span>
<a href="#l100.102"></a><span id="l100.102" class="difflineplus">+    controller.assertNode(new elementslib.ID(controller.window.document, &quot;calendar-add-task-button&quot;));</span>
<a href="#l100.103"></a><span id="l100.103" class="difflineplus">+    // check for filtered tasks list</span>
<a href="#l100.104"></a><span id="l100.104" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.105"></a><span id="l100.105" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/[1]/id(&quot;calendar-task-tree&quot;)/' +</span>
<a href="#l100.106"></a><span id="l100.106" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}'));</span>
<a href="#l100.107"></a><span id="l100.107"> </span>
<a href="#l100.108"></a><span id="l100.108" class="difflineminus">-  // create test calendar</span>
<a href="#l100.109"></a><span id="l100.109" class="difflineminus">-  modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l100.110"></a><span id="l100.110" class="difflineminus">-  let calendarList = new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.111"></a><span id="l100.111" class="difflineminus">-    '/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/' +</span>
<a href="#l100.112"></a><span id="l100.112" class="difflineminus">-    'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})');</span>
<a href="#l100.113"></a><span id="l100.113" class="difflineminus">-  controller.doubleClick(calendarList, 0, calendarList.getNode().boxObject.height); // bottom left</span>
<a href="#l100.114"></a><span id="l100.114" class="difflineminus">-  modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l100.115"></a><span id="l100.115" class="difflineplus">+    // create test calendar</span>
<a href="#l100.116"></a><span id="l100.116" class="difflineplus">+    modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l100.117"></a><span id="l100.117" class="difflineplus">+    let calendarList = new elementslib.Lookup(controller.window.document, path +</span>
<a href="#l100.118"></a><span id="l100.118" class="difflineplus">+      '/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/' +</span>
<a href="#l100.119"></a><span id="l100.119" class="difflineplus">+      'id(&quot;calendar-list-tree-widget&quot;)/anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})');</span>
<a href="#l100.120"></a><span id="l100.120" class="difflineplus">+    controller.doubleClick(calendarList, 0, calendarList.getNode().boxObject.height); // bottom left</span>
<a href="#l100.121"></a><span id="l100.121" class="difflineplus">+    modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l100.122"></a><span id="l100.122"> };</span>
<a href="#l100.123"></a><span id="l100.123"> </span>
<a href="#l100.124"></a><span id="l100.124"> function handleNewCalendarWizard(controller) {</span>
<a href="#l100.125"></a><span id="l100.125" class="difflineminus">-  let docEl = controller.window.document.documentElement;</span>
<a href="#l100.126"></a><span id="l100.126" class="difflineminus">-  // click next</span>
<a href="#l100.127"></a><span id="l100.127" class="difflineminus">-  docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l100.128"></a><span id="l100.128" class="difflineplus">+    let docEl = controller.window.document.documentElement;</span>
<a href="#l100.129"></a><span id="l100.129" class="difflineplus">+    // click next</span>
<a href="#l100.130"></a><span id="l100.130" class="difflineplus">+    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l100.131"></a><span id="l100.131"> </span>
<a href="#l100.132"></a><span id="l100.132" class="difflineminus">-  // set calendar name</span>
<a href="#l100.133"></a><span id="l100.133" class="difflineminus">-  let calendarNameTextBox = new elementslib.Lookup(controller.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l100.134"></a><span id="l100.134" class="difflineminus">-    '{&quot;pageid&quot;:&quot;customizePage&quot;}/[1]/id(&quot;customize-rows&quot;)/id(&quot;customize-name-row&quot;)/' +</span>
<a href="#l100.135"></a><span id="l100.135" class="difflineminus">-    'id(&quot;calendar-name&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l100.136"></a><span id="l100.136" class="difflineminus">-  controller.waitForElement(calendarNameTextBox);</span>
<a href="#l100.137"></a><span id="l100.137" class="difflineminus">-  controller.type(calendarNameTextBox, &quot;Mozmill&quot;);</span>
<a href="#l100.138"></a><span id="l100.138" class="difflineplus">+    // set calendar name</span>
<a href="#l100.139"></a><span id="l100.139" class="difflineplus">+    let calendarNameTextBox = new elementslib.Lookup(controller.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l100.140"></a><span id="l100.140" class="difflineplus">+      '{&quot;pageid&quot;:&quot;customizePage&quot;}/[1]/id(&quot;customize-rows&quot;)/id(&quot;customize-name-row&quot;)/' +</span>
<a href="#l100.141"></a><span id="l100.141" class="difflineplus">+      'id(&quot;calendar-name&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l100.142"></a><span id="l100.142" class="difflineplus">+    controller.waitForElement(calendarNameTextBox);</span>
<a href="#l100.143"></a><span id="l100.143" class="difflineplus">+    controller.type(calendarNameTextBox, &quot;Mozmill&quot;);</span>
<a href="#l100.144"></a><span id="l100.144"> </span>
<a href="#l100.145"></a><span id="l100.145" class="difflineminus">-  // click next</span>
<a href="#l100.146"></a><span id="l100.146" class="difflineminus">-  docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l100.147"></a><span id="l100.147" class="difflineplus">+    // click next</span>
<a href="#l100.148"></a><span id="l100.148" class="difflineplus">+    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l100.149"></a><span id="l100.149"> </span>
<a href="#l100.150"></a><span id="l100.150" class="difflineminus">-  // click finish</span>
<a href="#l100.151"></a><span id="l100.151" class="difflineminus">-  docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l100.152"></a><span id="l100.152" class="difflineplus">+    // click finish</span>
<a href="#l100.153"></a><span id="l100.153" class="difflineplus">+    docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l100.154"></a><span id="l100.154"> }</span>
<a href="#l100.155"></a><span id="l100.155"> </span>
<a href="#l100.156"></a><span id="l100.156"> var teardownTest = function(module) {</span>
<a href="#l100.157"></a><span id="l100.157" class="difflineminus">-  calUtils.deleteCalendars(controller, &quot;Mozmill&quot;);</span>
<a href="#l100.158"></a><span id="l100.158" class="difflineplus">+    calUtils.deleteCalendars(controller, &quot;Mozmill&quot;);</span>
<a href="#l100.159"></a><span id="l100.159"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/calendar/test/mozmill/testLocalICS.js</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -15,121 +15,121 @@ var sleep = 500;</span>
<a href="#l101.4"></a><span id="l101.4"> var TIMEOUT_MODAL_DIALOG = 30000;</span>
<a href="#l101.5"></a><span id="l101.5"> var hour = 8;</span>
<a href="#l101.6"></a><span id="l101.6"> var calendar;</span>
<a href="#l101.7"></a><span id="l101.7"> var uri;</span>
<a href="#l101.8"></a><span id="l101.8"> var file;</span>
<a href="#l101.9"></a><span id="l101.9"> var title;</span>
<a href="#l101.10"></a><span id="l101.10"> </span>
<a href="#l101.11"></a><span id="l101.11"> var setupModule = function(module) {</span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineminus">-  modalDialog = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l101.14"></a><span id="l101.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l101.15"></a><span id="l101.15" class="difflineplus">+    modalDialog = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l101.16"></a><span id="l101.16"> </span>
<a href="#l101.17"></a><span id="l101.17" class="difflineminus">-  // unique name needed as deleting a calendar only unsubscribes from it</span>
<a href="#l101.18"></a><span id="l101.18" class="difflineminus">-  // and if same file were used on next testrun then previously created event would show up</span>
<a href="#l101.19"></a><span id="l101.19" class="difflineminus">-  let time = (new Date()).getTime() + &quot;&quot;;</span>
<a href="#l101.20"></a><span id="l101.20" class="difflineminus">-  calendar = time;</span>
<a href="#l101.21"></a><span id="l101.21" class="difflineminus">-  title = time;</span>
<a href="#l101.22"></a><span id="l101.22" class="difflineplus">+    // unique name needed as deleting a calendar only unsubscribes from it</span>
<a href="#l101.23"></a><span id="l101.23" class="difflineplus">+    // and if same file were used on next testrun then previously created event would show up</span>
<a href="#l101.24"></a><span id="l101.24" class="difflineplus">+    let time = (new Date()).getTime() + &quot;&quot;;</span>
<a href="#l101.25"></a><span id="l101.25" class="difflineplus">+    calendar = time;</span>
<a href="#l101.26"></a><span id="l101.26" class="difflineplus">+    title = time;</span>
<a href="#l101.27"></a><span id="l101.27"> </span>
<a href="#l101.28"></a><span id="l101.28" class="difflineminus">-  file = Services.dirsvc.get(&quot;TmpD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l101.29"></a><span id="l101.29" class="difflineminus">-  file.append(calendar + &quot;.ics&quot;);</span>
<a href="#l101.30"></a><span id="l101.30" class="difflineminus">-  let fileURI = Services.io.newFileURI(file);</span>
<a href="#l101.31"></a><span id="l101.31" class="difflineminus">-  uri = fileURI.prePath + fileURI.path;</span>
<a href="#l101.32"></a><span id="l101.32" class="difflineplus">+    file = Services.dirsvc.get(&quot;TmpD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l101.33"></a><span id="l101.33" class="difflineplus">+    file.append(calendar + &quot;.ics&quot;);</span>
<a href="#l101.34"></a><span id="l101.34" class="difflineplus">+    let fileURI = Services.io.newFileURI(file);</span>
<a href="#l101.35"></a><span id="l101.35" class="difflineplus">+    uri = fileURI.prePath + fileURI.path;</span>
<a href="#l101.36"></a><span id="l101.36"> };</span>
<a href="#l101.37"></a><span id="l101.37"> </span>
<a href="#l101.38"></a><span id="l101.38"> var testLocalICS = function() {</span>
<a href="#l101.39"></a><span id="l101.39" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l101.40"></a><span id="l101.40" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l101.41"></a><span id="l101.41" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l101.42"></a><span id="l101.42" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l101.43"></a><span id="l101.43"> </span>
<a href="#l101.44"></a><span id="l101.44" class="difflineminus">-  modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l101.45"></a><span id="l101.45" class="difflineminus">-  controller.mainMenu.click(&quot;#ltnNewCalendar&quot;);</span>
<a href="#l101.46"></a><span id="l101.46" class="difflineminus">-  modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l101.47"></a><span id="l101.47" class="difflineplus">+    modalDialog.plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, handleNewCalendarWizard);</span>
<a href="#l101.48"></a><span id="l101.48" class="difflineplus">+    controller.mainMenu.click(&quot;#ltnNewCalendar&quot;);</span>
<a href="#l101.49"></a><span id="l101.49" class="difflineplus">+    modalDialog.wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l101.50"></a><span id="l101.50"> </span>
<a href="#l101.51"></a><span id="l101.51" class="difflineminus">-  // create new event</span>
<a href="#l101.52"></a><span id="l101.52" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l101.53"></a><span id="l101.53" class="difflineminus">-    calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l101.54"></a><span id="l101.54" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l101.55"></a><span id="l101.55" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l101.56"></a><span id="l101.56" class="difflineminus">-    .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l101.57"></a><span id="l101.57" class="difflineplus">+    // create new event</span>
<a href="#l101.58"></a><span id="l101.58" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l101.59"></a><span id="l101.59" class="difflineplus">+      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, hour)), 1, 1);</span>
<a href="#l101.60"></a><span id="l101.60" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l101.61"></a><span id="l101.61" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils</span>
<a href="#l101.62"></a><span id="l101.62" class="difflineplus">+      .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l101.63"></a><span id="l101.63"> </span>
<a href="#l101.64"></a><span id="l101.64" class="difflineminus">-  // let the iframe load</span>
<a href="#l101.65"></a><span id="l101.65" class="difflineminus">-  let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l101.66"></a><span id="l101.66" class="difflineminus">-  event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l101.67"></a><span id="l101.67" class="difflineplus">+    // let the iframe load</span>
<a href="#l101.68"></a><span id="l101.68" class="difflineplus">+    let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l101.69"></a><span id="l101.69" class="difflineplus">+    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l101.70"></a><span id="l101.70"> </span>
<a href="#l101.71"></a><span id="l101.71" class="difflineminus">-  // title</span>
<a href="#l101.72"></a><span id="l101.72" class="difflineminus">-  let titleTextBox = new elementslib.Lookup(iframe.contentDocument, '/id(&quot;calendar-event-dialog-inner&quot;)/' +</span>
<a href="#l101.73"></a><span id="l101.73" class="difflineminus">-    'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-title-row&quot;)/' +</span>
<a href="#l101.74"></a><span id="l101.74" class="difflineminus">-    'id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l101.75"></a><span id="l101.75" class="difflineminus">-  event.waitForElement(titleTextBox);</span>
<a href="#l101.76"></a><span id="l101.76" class="difflineminus">-  event.type(titleTextBox, title);</span>
<a href="#l101.77"></a><span id="l101.77" class="difflineplus">+    // title</span>
<a href="#l101.78"></a><span id="l101.78" class="difflineplus">+    let titleTextBox = new elementslib.Lookup(iframe.contentDocument, '/id(&quot;calendar-event-dialog-inner&quot;)/' +</span>
<a href="#l101.79"></a><span id="l101.79" class="difflineplus">+      'id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/id(&quot;event-grid-title-row&quot;)/' +</span>
<a href="#l101.80"></a><span id="l101.80" class="difflineplus">+      'id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l101.81"></a><span id="l101.81" class="difflineplus">+    event.waitForElement(titleTextBox);</span>
<a href="#l101.82"></a><span id="l101.82" class="difflineplus">+    event.type(titleTextBox, title);</span>
<a href="#l101.83"></a><span id="l101.83"> </span>
<a href="#l101.84"></a><span id="l101.84" class="difflineminus">-  // set calendar</span>
<a href="#l101.85"></a><span id="l101.85" class="difflineminus">-  let itemCalendar = new elementslib.ID(event.window.document, &quot;item-calendar&quot;);</span>
<a href="#l101.86"></a><span id="l101.86" class="difflineminus">-  event.select(itemCalendar, undefined, calendar);</span>
<a href="#l101.87"></a><span id="l101.87" class="difflineminus">-  // HACK - Wait for the value to be selected. This is needed for platforms</span>
<a href="#l101.88"></a><span id="l101.88" class="difflineminus">-  // like mac where selecting the menuitem is an asynchronous process, it might</span>
<a href="#l101.89"></a><span id="l101.89" class="difflineminus">-  // be fixed in a later version of mozmill.</span>
<a href="#l101.90"></a><span id="l101.90" class="difflineminus">-  event.waitFor(() =&gt; itemCalendar.getNode().value == calendar);</span>
<a href="#l101.91"></a><span id="l101.91" class="difflineplus">+    // set calendar</span>
<a href="#l101.92"></a><span id="l101.92" class="difflineplus">+    let itemCalendar = new elementslib.ID(event.window.document, &quot;item-calendar&quot;);</span>
<a href="#l101.93"></a><span id="l101.93" class="difflineplus">+    event.select(itemCalendar, undefined, calendar);</span>
<a href="#l101.94"></a><span id="l101.94" class="difflineplus">+    // HACK - Wait for the value to be selected. This is needed for platforms</span>
<a href="#l101.95"></a><span id="l101.95" class="difflineplus">+    // like mac where selecting the menuitem is an asynchronous process, it might</span>
<a href="#l101.96"></a><span id="l101.96" class="difflineplus">+    // be fixed in a later version of mozmill.</span>
<a href="#l101.97"></a><span id="l101.97" class="difflineplus">+    event.waitFor(() =&gt; itemCalendar.getNode().value == calendar);</span>
<a href="#l101.98"></a><span id="l101.98"> </span>
<a href="#l101.99"></a><span id="l101.99" class="difflineminus">-  // save</span>
<a href="#l101.100"></a><span id="l101.100" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l101.101"></a><span id="l101.101" class="difflineplus">+    // save</span>
<a href="#l101.102"></a><span id="l101.102" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l101.103"></a><span id="l101.103"> </span>
<a href="#l101.104"></a><span id="l101.104" class="difflineminus">-  // assert presence in view</span>
<a href="#l101.105"></a><span id="l101.105" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l101.106"></a><span id="l101.106" class="difflineminus">-    '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar + '&quot;}';</span>
<a href="#l101.107"></a><span id="l101.107" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l101.108"></a><span id="l101.108" class="difflineplus">+    // assert presence in view</span>
<a href="#l101.109"></a><span id="l101.109" class="difflineplus">+    let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour) +</span>
<a href="#l101.110"></a><span id="l101.110" class="difflineplus">+      '/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar + '&quot;}';</span>
<a href="#l101.111"></a><span id="l101.111" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l101.112"></a><span id="l101.112"> </span>
<a href="#l101.113"></a><span id="l101.113" class="difflineminus">-  // verify in file</span>
<a href="#l101.114"></a><span id="l101.114" class="difflineminus">-  let fstream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l101.115"></a><span id="l101.115" class="difflineminus">-                          .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l101.116"></a><span id="l101.116" class="difflineminus">-  let cstream = Components.classes[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l101.117"></a><span id="l101.117" class="difflineminus">-                          .createInstance(Components.interfaces.nsIConverterInputStream);</span>
<a href="#l101.118"></a><span id="l101.118" class="difflineplus">+    // verify in file</span>
<a href="#l101.119"></a><span id="l101.119" class="difflineplus">+    let fstream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l101.120"></a><span id="l101.120" class="difflineplus">+                            .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l101.121"></a><span id="l101.121" class="difflineplus">+    let cstream = Components.classes[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l101.122"></a><span id="l101.122" class="difflineplus">+                            .createInstance(Components.interfaces.nsIConverterInputStream);</span>
<a href="#l101.123"></a><span id="l101.123"> </span>
<a href="#l101.124"></a><span id="l101.124" class="difflineminus">-  // wait a moment until file is written</span>
<a href="#l101.125"></a><span id="l101.125" class="difflineminus">-  let i = 0;</span>
<a href="#l101.126"></a><span id="l101.126" class="difflineminus">-  while (!file.exists() &amp;&amp; i &lt; 10) {</span>
<a href="#l101.127"></a><span id="l101.127" class="difflineminus">-    controller.sleep(sleep);</span>
<a href="#l101.128"></a><span id="l101.128" class="difflineminus">-    i++;</span>
<a href="#l101.129"></a><span id="l101.129" class="difflineminus">-  }</span>
<a href="#l101.130"></a><span id="l101.130" class="difflineplus">+    // wait a moment until file is written</span>
<a href="#l101.131"></a><span id="l101.131" class="difflineplus">+    let i = 0;</span>
<a href="#l101.132"></a><span id="l101.132" class="difflineplus">+    while (!file.exists() &amp;&amp; i &lt; 10) {</span>
<a href="#l101.133"></a><span id="l101.133" class="difflineplus">+        controller.sleep(sleep);</span>
<a href="#l101.134"></a><span id="l101.134" class="difflineplus">+        i++;</span>
<a href="#l101.135"></a><span id="l101.135" class="difflineplus">+    }</span>
<a href="#l101.136"></a><span id="l101.136"> </span>
<a href="#l101.137"></a><span id="l101.137" class="difflineminus">-  fstream.init(file, -1, 0, 0);</span>
<a href="#l101.138"></a><span id="l101.138" class="difflineminus">-  cstream.init(fstream, &quot;UTF-8&quot;, 0, 0);</span>
<a href="#l101.139"></a><span id="l101.139" class="difflineplus">+    fstream.init(file, -1, 0, 0);</span>
<a href="#l101.140"></a><span id="l101.140" class="difflineplus">+    cstream.init(fstream, &quot;UTF-8&quot;, 0, 0);</span>
<a href="#l101.141"></a><span id="l101.141"> </span>
<a href="#l101.142"></a><span id="l101.142" class="difflineminus">-  let str = {};</span>
<a href="#l101.143"></a><span id="l101.143" class="difflineminus">-  cstream.readString(-1, str);</span>
<a href="#l101.144"></a><span id="l101.144" class="difflineminus">-  cstream.close();</span>
<a href="#l101.145"></a><span id="l101.145" class="difflineplus">+    let str = {};</span>
<a href="#l101.146"></a><span id="l101.146" class="difflineplus">+    cstream.readString(-1, str);</span>
<a href="#l101.147"></a><span id="l101.147" class="difflineplus">+    cstream.close();</span>
<a href="#l101.148"></a><span id="l101.148"> </span>
<a href="#l101.149"></a><span id="l101.149" class="difflineminus">-  controller.assertJS(str.value.includes(&quot;SUMMARY:&quot; + title));</span>
<a href="#l101.150"></a><span id="l101.150" class="difflineplus">+    controller.assertJS(str.value.includes(&quot;SUMMARY:&quot; + title));</span>
<a href="#l101.151"></a><span id="l101.151"> };</span>
<a href="#l101.152"></a><span id="l101.152"> </span>
<a href="#l101.153"></a><span id="l101.153"> var teardownTest = function(module) {</span>
<a href="#l101.154"></a><span id="l101.154" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l101.155"></a><span id="l101.155" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l101.156"></a><span id="l101.156"> };</span>
<a href="#l101.157"></a><span id="l101.157"> </span>
<a href="#l101.158"></a><span id="l101.158"> function handleNewCalendarWizard(wizard) {</span>
<a href="#l101.159"></a><span id="l101.159" class="difflineminus">-  let docEl = wizard.window.document.documentElement;</span>
<a href="#l101.160"></a><span id="l101.160" class="difflineplus">+    let docEl = wizard.window.document.documentElement;</span>
<a href="#l101.161"></a><span id="l101.161"> </span>
<a href="#l101.162"></a><span id="l101.162" class="difflineminus">-  // choose network calendar</span>
<a href="#l101.163"></a><span id="l101.163" class="difflineminus">-  let remoteOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l101.164"></a><span id="l101.164" class="difflineminus">-    '{&quot;pageid&quot;:&quot;initialPage&quot;}/id(&quot;calendar-type&quot;)/{&quot;value&quot;:&quot;remote&quot;}');</span>
<a href="#l101.165"></a><span id="l101.165" class="difflineminus">-  wizard.waitForElement(remoteOption);</span>
<a href="#l101.166"></a><span id="l101.166" class="difflineminus">-  wizard.radio(remoteOption);</span>
<a href="#l101.167"></a><span id="l101.167" class="difflineminus">-  docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l101.168"></a><span id="l101.168" class="difflineplus">+    // choose network calendar</span>
<a href="#l101.169"></a><span id="l101.169" class="difflineplus">+    let remoteOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l101.170"></a><span id="l101.170" class="difflineplus">+      '{&quot;pageid&quot;:&quot;initialPage&quot;}/id(&quot;calendar-type&quot;)/{&quot;value&quot;:&quot;remote&quot;}');</span>
<a href="#l101.171"></a><span id="l101.171" class="difflineplus">+    wizard.waitForElement(remoteOption);</span>
<a href="#l101.172"></a><span id="l101.172" class="difflineplus">+    wizard.radio(remoteOption);</span>
<a href="#l101.173"></a><span id="l101.173" class="difflineplus">+    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l101.174"></a><span id="l101.174"> </span>
<a href="#l101.175"></a><span id="l101.175" class="difflineminus">-  // choose ical</span>
<a href="#l101.176"></a><span id="l101.176" class="difflineminus">-  let icalOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l101.177"></a><span id="l101.177" class="difflineminus">-    '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/[0]/id(&quot;calendar-format&quot;)/{&quot;value&quot;:&quot;ics&quot;}');</span>
<a href="#l101.178"></a><span id="l101.178" class="difflineminus">-  wizard.waitForElement(icalOption);</span>
<a href="#l101.179"></a><span id="l101.179" class="difflineminus">-  wizard.radio(icalOption);</span>
<a href="#l101.180"></a><span id="l101.180" class="difflineminus">-  // enter location</span>
<a href="#l101.181"></a><span id="l101.181" class="difflineminus">-  wizard.type(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l101.182"></a><span id="l101.182" class="difflineminus">-    '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calendar-uri&quot;)/' +</span>
<a href="#l101.183"></a><span id="l101.183" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l101.184"></a><span id="l101.184" class="difflineminus">-    uri);</span>
<a href="#l101.185"></a><span id="l101.185" class="difflineminus">-  docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l101.186"></a><span id="l101.186" class="difflineplus">+    // choose ical</span>
<a href="#l101.187"></a><span id="l101.187" class="difflineplus">+    let icalOption = new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l101.188"></a><span id="l101.188" class="difflineplus">+      '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/[0]/id(&quot;calendar-format&quot;)/{&quot;value&quot;:&quot;ics&quot;}');</span>
<a href="#l101.189"></a><span id="l101.189" class="difflineplus">+    wizard.waitForElement(icalOption);</span>
<a href="#l101.190"></a><span id="l101.190" class="difflineplus">+    wizard.radio(icalOption);</span>
<a href="#l101.191"></a><span id="l101.191" class="difflineplus">+    // enter location</span>
<a href="#l101.192"></a><span id="l101.192" class="difflineplus">+    wizard.type(new elementslib.Lookup(wizard.window.document, '/id(&quot;calendar-wizard&quot;)/' +</span>
<a href="#l101.193"></a><span id="l101.193" class="difflineplus">+      '{&quot;pageid&quot;:&quot;locationPage&quot;}/[1]/[1]/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calendar-uri&quot;)/' +</span>
<a href="#l101.194"></a><span id="l101.194" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l101.195"></a><span id="l101.195" class="difflineplus">+      uri);</span>
<a href="#l101.196"></a><span id="l101.196" class="difflineplus">+    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l101.197"></a><span id="l101.197"> </span>
<a href="#l101.198"></a><span id="l101.198" class="difflineminus">-  // name is filled in automatically using filename</span>
<a href="#l101.199"></a><span id="l101.199" class="difflineminus">-  wizard.waitFor(() =&gt; docEl.getButton(&quot;next&quot;).disabled == false);</span>
<a href="#l101.200"></a><span id="l101.200" class="difflineminus">-  docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l101.201"></a><span id="l101.201" class="difflineplus">+    // name is filled in automatically using filename</span>
<a href="#l101.202"></a><span id="l101.202" class="difflineplus">+    wizard.waitFor(() =&gt; docEl.getButton(&quot;next&quot;).disabled == false);</span>
<a href="#l101.203"></a><span id="l101.203" class="difflineplus">+    docEl.getButton(&quot;next&quot;).doCommand();</span>
<a href="#l101.204"></a><span id="l101.204"> </span>
<a href="#l101.205"></a><span id="l101.205" class="difflineminus">-  // finish</span>
<a href="#l101.206"></a><span id="l101.206" class="difflineminus">-  docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l101.207"></a><span id="l101.207" class="difflineplus">+    // finish</span>
<a href="#l101.208"></a><span id="l101.208" class="difflineplus">+    docEl.getButton(&quot;finish&quot;).doCommand();</span>
<a href="#l101.209"></a><span id="l101.209"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/calendar/test/mozmill/testTodayPane.js</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -10,244 +10,244 @@ var MODULE_REQUIRES = [&quot;calendar-utils&quot;]</span>
<a href="#l102.4"></a><span id="l102.4"> var WAIT_FOR_WINDOW_TIMEOUT = 500;</span>
<a href="#l102.5"></a><span id="l102.5"> var MOZMILL_CALENDAR = &quot;Mozmill&quot;;</span>
<a href="#l102.6"></a><span id="l102.6"> </span>
<a href="#l102.7"></a><span id="l102.7"> var calUtils = require(&quot;./shared-modules/calendar-utils&quot;);</span>
<a href="#l102.8"></a><span id="l102.8"> </span>
<a href="#l102.9"></a><span id="l102.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l102.10"></a><span id="l102.10"> </span>
<a href="#l102.11"></a><span id="l102.11"> var setupModule = function(module) {</span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineminus">-  calUtils.createCalendar(controller, MOZMILL_CALENDAR);</span>
<a href="#l102.14"></a><span id="l102.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l102.15"></a><span id="l102.15" class="difflineplus">+    calUtils.createCalendar(controller, MOZMILL_CALENDAR);</span>
<a href="#l102.16"></a><span id="l102.16"> };</span>
<a href="#l102.17"></a><span id="l102.17"> </span>
<a href="#l102.18"></a><span id="l102.18"> var testTodayPane = function() {</span>
<a href="#l102.19"></a><span id="l102.19" class="difflineminus">-  // paths</span>
<a href="#l102.20"></a><span id="l102.20" class="difflineminus">-  let panels = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l102.21"></a><span id="l102.21" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/';</span>
<a href="#l102.22"></a><span id="l102.22" class="difflineminus">-  let miniMonth = panels + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l102.23"></a><span id="l102.23" class="difflineminus">-    'id(&quot;minimonth-pane&quot;)/';</span>
<a href="#l102.24"></a><span id="l102.24" class="difflineminus">-  let dayView = panels + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/' +</span>
<a href="#l102.25"></a><span id="l102.25" class="difflineminus">-    'id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/';</span>
<a href="#l102.26"></a><span id="l102.26" class="difflineminus">-  let dayPath = dayView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/' +</span>
<a href="#l102.27"></a><span id="l102.27" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l102.28"></a><span id="l102.28" class="difflineminus">-  let eventName = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/' +</span>
<a href="#l102.29"></a><span id="l102.29" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l102.30"></a><span id="l102.30" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l102.31"></a><span id="l102.31" class="difflineplus">+    // paths</span>
<a href="#l102.32"></a><span id="l102.32" class="difflineplus">+    let panels = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l102.33"></a><span id="l102.33" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/';</span>
<a href="#l102.34"></a><span id="l102.34" class="difflineplus">+    let miniMonth = panels + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l102.35"></a><span id="l102.35" class="difflineplus">+      'id(&quot;minimonth-pane&quot;)/';</span>
<a href="#l102.36"></a><span id="l102.36" class="difflineplus">+    let dayView = panels + 'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;calendarDisplayDeck&quot;)/' +</span>
<a href="#l102.37"></a><span id="l102.37" class="difflineplus">+      'id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/';</span>
<a href="#l102.38"></a><span id="l102.38" class="difflineplus">+    let dayPath = dayView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/' +</span>
<a href="#l102.39"></a><span id="l102.39" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/{&quot;flex&quot;:&quot;1&quot;}';</span>
<a href="#l102.40"></a><span id="l102.40" class="difflineplus">+    let eventName = '/id(&quot;calendar-event-dialog-inner&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/' +</span>
<a href="#l102.41"></a><span id="l102.41" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l102.42"></a><span id="l102.42" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})';</span>
<a href="#l102.43"></a><span id="l102.43"> </span>
<a href="#l102.44"></a><span id="l102.44" class="difflineminus">-  // open calendar view</span>
<a href="#l102.45"></a><span id="l102.45" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l102.46"></a><span id="l102.46" class="difflineminus">-  controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l102.47"></a><span id="l102.47" class="difflineplus">+    // open calendar view</span>
<a href="#l102.48"></a><span id="l102.48" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l102.49"></a><span id="l102.49" class="difflineplus">+    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l102.50"></a><span id="l102.50"> </span>
<a href="#l102.51"></a><span id="l102.51" class="difflineminus">-  // go to today and verify date</span>
<a href="#l102.52"></a><span id="l102.52" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l102.53"></a><span id="l102.53" class="difflineminus">-    '{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/' +</span>
<a href="#l102.54"></a><span id="l102.54" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;today-button&quot;})'));</span>
<a href="#l102.55"></a><span id="l102.55" class="difflineminus">-  let dayNode = (new elementslib.Lookup(controller.window.document, dayPath)).getNode();</span>
<a href="#l102.56"></a><span id="l102.56" class="difflineminus">-  controller.assertJS(dayNode.mDate.icalString == getIsoDate());</span>
<a href="#l102.57"></a><span id="l102.57" class="difflineplus">+    // go to today and verify date</span>
<a href="#l102.58"></a><span id="l102.58" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l102.59"></a><span id="l102.59" class="difflineplus">+      '{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/' +</span>
<a href="#l102.60"></a><span id="l102.60" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;today-button&quot;})'));</span>
<a href="#l102.61"></a><span id="l102.61" class="difflineplus">+    let dayNode = (new elementslib.Lookup(controller.window.document, dayPath)).getNode();</span>
<a href="#l102.62"></a><span id="l102.62" class="difflineplus">+    controller.assertJS(dayNode.mDate.icalString == getIsoDate());</span>
<a href="#l102.63"></a><span id="l102.63"> </span>
<a href="#l102.64"></a><span id="l102.64" class="difflineminus">-  // create event 6 hours from now, if this is tomorrow then at 23 today</span>
<a href="#l102.65"></a><span id="l102.65" class="difflineminus">-  // doubleclick only triggers new event dialog on visible boxes, so scrolling may be needed</span>
<a href="#l102.66"></a><span id="l102.66" class="difflineminus">-  // by default visible time is 08:00 - 17:00, box of 17th hour is out of view</span>
<a href="#l102.67"></a><span id="l102.67" class="difflineminus">-  let hour = (new Date()).getHours();</span>
<a href="#l102.68"></a><span id="l102.68" class="difflineminus">-  let startHour = (hour &lt; 18) ? hour + 6 : 23;</span>
<a href="#l102.69"></a><span id="l102.69" class="difflineminus">-  let view = (new elementslib.Lookup(controller.window.document, dayView)).getNode();</span>
<a href="#l102.70"></a><span id="l102.70" class="difflineplus">+    // create event 6 hours from now, if this is tomorrow then at 23 today</span>
<a href="#l102.71"></a><span id="l102.71" class="difflineplus">+    // doubleclick only triggers new event dialog on visible boxes, so scrolling may be needed</span>
<a href="#l102.72"></a><span id="l102.72" class="difflineplus">+    // by default visible time is 08:00 - 17:00, box of 17th hour is out of view</span>
<a href="#l102.73"></a><span id="l102.73" class="difflineplus">+    let hour = (new Date()).getHours();</span>
<a href="#l102.74"></a><span id="l102.74" class="difflineplus">+    let startHour = (hour &lt; 18 ? hour + 6 : 23);</span>
<a href="#l102.75"></a><span id="l102.75" class="difflineplus">+    let view = (new elementslib.Lookup(controller.window.document, dayView)).getNode();</span>
<a href="#l102.76"></a><span id="l102.76"> </span>
<a href="#l102.77"></a><span id="l102.77" class="difflineminus">-  if (startHour &lt; 8 || startHour &gt; 16) {</span>
<a href="#l102.78"></a><span id="l102.78" class="difflineminus">-    view.scrollToMinute(60 * startHour);</span>
<a href="#l102.79"></a><span id="l102.79" class="difflineminus">-  }</span>
<a href="#l102.80"></a><span id="l102.80" class="difflineplus">+    if (startHour &lt; 8 || startHour &gt; 16) {</span>
<a href="#l102.81"></a><span id="l102.81" class="difflineplus">+        view.scrollToMinute(60 * startHour);</span>
<a href="#l102.82"></a><span id="l102.82" class="difflineplus">+    }</span>
<a href="#l102.83"></a><span id="l102.83"> </span>
<a href="#l102.84"></a><span id="l102.84" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l102.85"></a><span id="l102.85" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l102.86"></a><span id="l102.86" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l102.87"></a><span id="l102.87" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + startHour + &quot;]&quot;), 1, 1);</span>
<a href="#l102.88"></a><span id="l102.88" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.89"></a><span id="l102.89" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l102.90"></a><span id="l102.90" class="difflineminus">-  let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l102.91"></a><span id="l102.91" class="difflineminus">-  event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l102.92"></a><span id="l102.92" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l102.93"></a><span id="l102.93" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l102.94"></a><span id="l102.94" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l102.95"></a><span id="l102.95" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[' + startHour + &quot;]&quot;), 1, 1);</span>
<a href="#l102.96"></a><span id="l102.96" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.97"></a><span id="l102.97" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l102.98"></a><span id="l102.98" class="difflineplus">+    let iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l102.99"></a><span id="l102.99" class="difflineplus">+    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l102.100"></a><span id="l102.100"> </span>
<a href="#l102.101"></a><span id="l102.101" class="difflineminus">-  event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l102.102"></a><span id="l102.102" class="difflineminus">-  event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Today's Event&quot;);</span>
<a href="#l102.103"></a><span id="l102.103" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l102.104"></a><span id="l102.104" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l102.105"></a><span id="l102.105" class="difflineplus">+    event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l102.106"></a><span id="l102.106" class="difflineplus">+    event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Today's Event&quot;);</span>
<a href="#l102.107"></a><span id="l102.107" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l102.108"></a><span id="l102.108" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l102.109"></a><span id="l102.109"> </span>
<a href="#l102.110"></a><span id="l102.110" class="difflineminus">-  // reset view</span>
<a href="#l102.111"></a><span id="l102.111" class="difflineminus">-  view.scrollToMinute(60 * 8);</span>
<a href="#l102.112"></a><span id="l102.112" class="difflineplus">+    // reset view</span>
<a href="#l102.113"></a><span id="l102.113" class="difflineplus">+    view.scrollToMinute(60 * 8);</span>
<a href="#l102.114"></a><span id="l102.114"> </span>
<a href="#l102.115"></a><span id="l102.115" class="difflineminus">-  // go to tomorrow and add an event</span>
<a href="#l102.116"></a><span id="l102.116" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l102.117"></a><span id="l102.117" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l102.118"></a><span id="l102.118" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l102.119"></a><span id="l102.119" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l102.120"></a><span id="l102.120" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l102.121"></a><span id="l102.121" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.122"></a><span id="l102.122" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l102.123"></a><span id="l102.123" class="difflineminus">-  iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l102.124"></a><span id="l102.124" class="difflineminus">-  event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l102.125"></a><span id="l102.125" class="difflineplus">+    // go to tomorrow and add an event</span>
<a href="#l102.126"></a><span id="l102.126" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l102.127"></a><span id="l102.127" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l102.128"></a><span id="l102.128" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l102.129"></a><span id="l102.129" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l102.130"></a><span id="l102.130" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l102.131"></a><span id="l102.131" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.132"></a><span id="l102.132" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l102.133"></a><span id="l102.133" class="difflineplus">+    iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l102.134"></a><span id="l102.134" class="difflineplus">+    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l102.135"></a><span id="l102.135"> </span>
<a href="#l102.136"></a><span id="l102.136" class="difflineminus">-  event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l102.137"></a><span id="l102.137" class="difflineminus">-  event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Tomorrow's Event&quot;);</span>
<a href="#l102.138"></a><span id="l102.138" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l102.139"></a><span id="l102.139" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l102.140"></a><span id="l102.140" class="difflineplus">+    event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l102.141"></a><span id="l102.141" class="difflineplus">+    event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Tomorrow's Event&quot;);</span>
<a href="#l102.142"></a><span id="l102.142" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l102.143"></a><span id="l102.143" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l102.144"></a><span id="l102.144"> </span>
<a href="#l102.145"></a><span id="l102.145" class="difflineminus">-  // go 5 days forward and add an event</span>
<a href="#l102.146"></a><span id="l102.146" class="difflineminus">-  for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l102.147"></a><span id="l102.147" class="difflineminus">-    controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l102.148"></a><span id="l102.148" class="difflineminus">-  }</span>
<a href="#l102.149"></a><span id="l102.149" class="difflineminus">-  controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.150"></a><span id="l102.150" class="difflineplus">+    // go 5 days forward and add an event</span>
<a href="#l102.151"></a><span id="l102.151" class="difflineplus">+    for (let i = 0; i &lt; 5; i++) {</span>
<a href="#l102.152"></a><span id="l102.152" class="difflineplus">+        controller.click(new elementslib.ID(controller.window.document, &quot;next-view-button&quot;));</span>
<a href="#l102.153"></a><span id="l102.153" class="difflineplus">+    }</span>
<a href="#l102.154"></a><span id="l102.154" class="difflineplus">+    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.155"></a><span id="l102.155"> </span>
<a href="#l102.156"></a><span id="l102.156" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l102.157"></a><span id="l102.157" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l102.158"></a><span id="l102.158" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l102.159"></a><span id="l102.159" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l102.160"></a><span id="l102.160" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.161"></a><span id="l102.161" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l102.162"></a><span id="l102.162" class="difflineminus">-  iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l102.163"></a><span id="l102.163" class="difflineminus">-  event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l102.164"></a><span id="l102.164" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l102.165"></a><span id="l102.165" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l102.166"></a><span id="l102.166" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l102.167"></a><span id="l102.167" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[9]'), 1, 1);</span>
<a href="#l102.168"></a><span id="l102.168" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.169"></a><span id="l102.169" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l102.170"></a><span id="l102.170" class="difflineplus">+    iframe = event.window.document.getElementById(&quot;lightning-item-panel-iframe&quot;);</span>
<a href="#l102.171"></a><span id="l102.171" class="difflineplus">+    event.waitFor(() =&gt; iframe.contentWindow.onLoad &amp;&amp; iframe.contentWindow.onLoad.hasLoaded == true);</span>
<a href="#l102.172"></a><span id="l102.172"> </span>
<a href="#l102.173"></a><span id="l102.173" class="difflineminus">-  event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l102.174"></a><span id="l102.174" class="difflineminus">-  event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Future's Event&quot;);</span>
<a href="#l102.175"></a><span id="l102.175" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l102.176"></a><span id="l102.176" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l102.177"></a><span id="l102.177" class="difflineplus">+    event.waitForElement(new elementslib.Lookup(iframe.contentDocument, eventName));</span>
<a href="#l102.178"></a><span id="l102.178" class="difflineplus">+    event.type(new elementslib.Lookup(iframe.contentDocument, eventName), &quot;Future's Event&quot;);</span>
<a href="#l102.179"></a><span id="l102.179" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l102.180"></a><span id="l102.180" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l102.181"></a><span id="l102.181"> </span>
<a href="#l102.182"></a><span id="l102.182" class="difflineminus">-  // go to mail tab</span>
<a href="#l102.183"></a><span id="l102.183" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.184"></a><span id="l102.184" class="difflineminus">-    'id(&quot;navigation-toolbox&quot;)/id(&quot;tabs-toolbar&quot;)/id(&quot;tabcontainer&quot;)/{&quot;first-tab&quot;:&quot;true&quot;,&quot;type&quot;:&quot;folder&quot;}/' +</span>
<a href="#l102.185"></a><span id="l102.185" class="difflineminus">-    'anon({&quot;class&quot;:&quot;tab-stack&quot;})/{&quot;class&quot;:&quot;tab-background&quot;}/{&quot;class&quot;:&quot;tab-background-middle&quot;}'));</span>
<a href="#l102.186"></a><span id="l102.186" class="difflineminus">-  controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.187"></a><span id="l102.187" class="difflineplus">+    // go to mail tab</span>
<a href="#l102.188"></a><span id="l102.188" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.189"></a><span id="l102.189" class="difflineplus">+      'id(&quot;navigation-toolbox&quot;)/id(&quot;tabs-toolbar&quot;)/id(&quot;tabcontainer&quot;)/{&quot;first-tab&quot;:&quot;true&quot;,&quot;type&quot;:&quot;folder&quot;}/' +</span>
<a href="#l102.190"></a><span id="l102.190" class="difflineplus">+      'anon({&quot;class&quot;:&quot;tab-stack&quot;})/{&quot;class&quot;:&quot;tab-background&quot;}/{&quot;class&quot;:&quot;tab-background-middle&quot;}'));</span>
<a href="#l102.191"></a><span id="l102.191" class="difflineplus">+    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.192"></a><span id="l102.192"> </span>
<a href="#l102.193"></a><span id="l102.193" class="difflineminus">-  // verify today pane open</span>
<a href="#l102.194"></a><span id="l102.194" class="difflineminus">-  controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.195"></a><span id="l102.195" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l102.196"></a><span id="l102.196" class="difflineplus">+    // verify today pane open</span>
<a href="#l102.197"></a><span id="l102.197" class="difflineplus">+    controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.198"></a><span id="l102.198" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l102.199"></a><span id="l102.199"> </span>
<a href="#l102.200"></a><span id="l102.200" class="difflineminus">-  // verify today pane's date</span>
<a href="#l102.201"></a><span id="l102.201" class="difflineminus">-  controller.assertValue(new elementslib.ID(controller.window.document, &quot;datevalue-label&quot;),</span>
<a href="#l102.202"></a><span id="l102.202" class="difflineminus">-    (new Date()).getDate());</span>
<a href="#l102.203"></a><span id="l102.203" class="difflineplus">+    // verify today pane's date</span>
<a href="#l102.204"></a><span id="l102.204" class="difflineplus">+    controller.assertValue(new elementslib.ID(controller.window.document, &quot;datevalue-label&quot;),</span>
<a href="#l102.205"></a><span id="l102.205" class="difflineplus">+      (new Date()).getDate());</span>
<a href="#l102.206"></a><span id="l102.206"> </span>
<a href="#l102.207"></a><span id="l102.207" class="difflineminus">-  // tomorrow and soon are collapsed by default</span>
<a href="#l102.208"></a><span id="l102.208" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.209"></a><span id="l102.209" class="difflineminus">-    'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.210"></a><span id="l102.210" class="difflineminus">-    'id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.211"></a><span id="l102.211" class="difflineminus">-    'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.212"></a><span id="l102.212" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.213"></a><span id="l102.213" class="difflineminus">-    'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.214"></a><span id="l102.214" class="difflineminus">-    'id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.215"></a><span id="l102.215" class="difflineminus">-    'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.216"></a><span id="l102.216" class="difflineminus">-  controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.217"></a><span id="l102.217" class="difflineplus">+    // tomorrow and soon are collapsed by default</span>
<a href="#l102.218"></a><span id="l102.218" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.219"></a><span id="l102.219" class="difflineplus">+      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.220"></a><span id="l102.220" class="difflineplus">+      'id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.221"></a><span id="l102.221" class="difflineplus">+      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.222"></a><span id="l102.222" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.223"></a><span id="l102.223" class="difflineplus">+      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.224"></a><span id="l102.224" class="difflineplus">+      'id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.225"></a><span id="l102.225" class="difflineplus">+      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.226"></a><span id="l102.226" class="difflineplus">+    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.227"></a><span id="l102.227"> </span>
<a href="#l102.228"></a><span id="l102.228" class="difflineminus">-  // verify events shown in today pane</span>
<a href="#l102.229"></a><span id="l102.229" class="difflineminus">-  let now = new Date();</span>
<a href="#l102.230"></a><span id="l102.230" class="difflineminus">-  now.setHours(startHour);</span>
<a href="#l102.231"></a><span id="l102.231" class="difflineminus">-  now.setMinutes(0);</span>
<a href="#l102.232"></a><span id="l102.232" class="difflineminus">-  let dtz = cal.calendarDefaultTimezone();</span>
<a href="#l102.233"></a><span id="l102.233" class="difflineminus">-  let probeDate = cal.jsDateToDateTime(now, dtz);</span>
<a href="#l102.234"></a><span id="l102.234" class="difflineminus">-  let dateFormatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l102.235"></a><span id="l102.235" class="difflineminus">-                                .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l102.236"></a><span id="l102.236" class="difflineminus">-  let startTime = dateFormatter.formatTime(probeDate);</span>
<a href="#l102.237"></a><span id="l102.237" class="difflineminus">-  controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.238"></a><span id="l102.238" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.239"></a><span id="l102.239" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.240"></a><span id="l102.240" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l102.241"></a><span id="l102.241" class="difflineminus">-    startTime + &quot; Today's Event&quot;);</span>
<a href="#l102.242"></a><span id="l102.242" class="difflineplus">+    // verify events shown in today pane</span>
<a href="#l102.243"></a><span id="l102.243" class="difflineplus">+    let now = new Date();</span>
<a href="#l102.244"></a><span id="l102.244" class="difflineplus">+    now.setHours(startHour);</span>
<a href="#l102.245"></a><span id="l102.245" class="difflineplus">+    now.setMinutes(0);</span>
<a href="#l102.246"></a><span id="l102.246" class="difflineplus">+    let dtz = cal.calendarDefaultTimezone();</span>
<a href="#l102.247"></a><span id="l102.247" class="difflineplus">+    let probeDate = cal.jsDateToDateTime(now, dtz);</span>
<a href="#l102.248"></a><span id="l102.248" class="difflineplus">+    let dateFormatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l102.249"></a><span id="l102.249" class="difflineplus">+                                  .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l102.250"></a><span id="l102.250" class="difflineplus">+    let startTime = dateFormatter.formatTime(probeDate);</span>
<a href="#l102.251"></a><span id="l102.251" class="difflineplus">+    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.252"></a><span id="l102.252" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.253"></a><span id="l102.253" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.254"></a><span id="l102.254" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l102.255"></a><span id="l102.255" class="difflineplus">+      startTime + &quot; Today's Event&quot;);</span>
<a href="#l102.256"></a><span id="l102.256"> </span>
<a href="#l102.257"></a><span id="l102.257" class="difflineminus">-  let tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 9, 0);</span>
<a href="#l102.258"></a><span id="l102.258" class="difflineminus">-  probeDate = cal.jsDateToDateTime(tomorrow, dtz);</span>
<a href="#l102.259"></a><span id="l102.259" class="difflineminus">-  startTime = dateFormatter.formatTime(probeDate);</span>
<a href="#l102.260"></a><span id="l102.260" class="difflineminus">-  controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.261"></a><span id="l102.261" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.262"></a><span id="l102.262" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.263"></a><span id="l102.263" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l102.264"></a><span id="l102.264" class="difflineminus">-    startTime + &quot; Tomorrow's Event&quot;);</span>
<a href="#l102.265"></a><span id="l102.265" class="difflineplus">+    let tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 9, 0);</span>
<a href="#l102.266"></a><span id="l102.266" class="difflineplus">+    probeDate = cal.jsDateToDateTime(tomorrow, dtz);</span>
<a href="#l102.267"></a><span id="l102.267" class="difflineplus">+    startTime = dateFormatter.formatTime(probeDate);</span>
<a href="#l102.268"></a><span id="l102.268" class="difflineplus">+    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.269"></a><span id="l102.269" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.270"></a><span id="l102.270" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.271"></a><span id="l102.271" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l102.272"></a><span id="l102.272" class="difflineplus">+      startTime + &quot; Tomorrow's Event&quot;);</span>
<a href="#l102.273"></a><span id="l102.273"> </span>
<a href="#l102.274"></a><span id="l102.274" class="difflineminus">-  let future = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 6, 9, 0);</span>
<a href="#l102.275"></a><span id="l102.275" class="difflineminus">-  probeDate = cal.jsDateToDateTime(future, dtz);</span>
<a href="#l102.276"></a><span id="l102.276" class="difflineminus">-  startTime = dateFormatter.formatDateTime(probeDate);</span>
<a href="#l102.277"></a><span id="l102.277" class="difflineplus">+    let future = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 6, 9, 0);</span>
<a href="#l102.278"></a><span id="l102.278" class="difflineplus">+    probeDate = cal.jsDateToDateTime(future, dtz);</span>
<a href="#l102.279"></a><span id="l102.279" class="difflineplus">+    startTime = dateFormatter.formatDateTime(probeDate);</span>
<a href="#l102.280"></a><span id="l102.280"> </span>
<a href="#l102.281"></a><span id="l102.281" class="difflineminus">-  // Future event's start time</span>
<a href="#l102.282"></a><span id="l102.282" class="difflineminus">-  controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.283"></a><span id="l102.283" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.284"></a><span id="l102.284" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.285"></a><span id="l102.285" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l102.286"></a><span id="l102.286" class="difflineminus">-    startTime);</span>
<a href="#l102.287"></a><span id="l102.287" class="difflineplus">+    // Future event's start time</span>
<a href="#l102.288"></a><span id="l102.288" class="difflineplus">+    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.289"></a><span id="l102.289" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.290"></a><span id="l102.290" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.291"></a><span id="l102.291" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/[0]/anon({&quot;anonid&quot;:&quot;agenda-event-start&quot;})/'),</span>
<a href="#l102.292"></a><span id="l102.292" class="difflineplus">+      startTime);</span>
<a href="#l102.293"></a><span id="l102.293"> </span>
<a href="#l102.294"></a><span id="l102.294" class="difflineminus">-  // Future event's title</span>
<a href="#l102.295"></a><span id="l102.295" class="difflineminus">-  controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.296"></a><span id="l102.296" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.297"></a><span id="l102.297" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.298"></a><span id="l102.298" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/anon({&quot;anonid&quot;:&quot;agenda-event-title&quot;})/'),</span>
<a href="#l102.299"></a><span id="l102.299" class="difflineminus">-    &quot;Future's Event&quot;);</span>
<a href="#l102.300"></a><span id="l102.300" class="difflineplus">+    // Future event's title</span>
<a href="#l102.301"></a><span id="l102.301" class="difflineplus">+    controller.assertText(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.302"></a><span id="l102.302" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.303"></a><span id="l102.303" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]/anon({&quot;anonid&quot;:&quot;agenda-container-box&quot;})/' +</span>
<a href="#l102.304"></a><span id="l102.304" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;agenda-description&quot;})/anon({&quot;anonid&quot;:&quot;agenda-event-title&quot;})/'),</span>
<a href="#l102.305"></a><span id="l102.305" class="difflineplus">+      &quot;Future's Event&quot;);</span>
<a href="#l102.306"></a><span id="l102.306"> </span>
<a href="#l102.307"></a><span id="l102.307" class="difflineminus">-  // delete events</span>
<a href="#l102.308"></a><span id="l102.308" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.309"></a><span id="l102.309" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.310"></a><span id="l102.310" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]'));</span>
<a href="#l102.311"></a><span id="l102.311" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l102.312"></a><span id="l102.312" class="difflineminus">-    &quot;VK_DELETE&quot;,</span>
<a href="#l102.313"></a><span id="l102.313" class="difflineminus">-    {});</span>
<a href="#l102.314"></a><span id="l102.314" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.315"></a><span id="l102.315" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.316"></a><span id="l102.316" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]'));</span>
<a href="#l102.317"></a><span id="l102.317" class="difflineplus">+    // delete events</span>
<a href="#l102.318"></a><span id="l102.318" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.319"></a><span id="l102.319" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.320"></a><span id="l102.320" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]'));</span>
<a href="#l102.321"></a><span id="l102.321" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l102.322"></a><span id="l102.322" class="difflineplus">+      &quot;VK_DELETE&quot;,</span>
<a href="#l102.323"></a><span id="l102.323" class="difflineplus">+      {});</span>
<a href="#l102.324"></a><span id="l102.324" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.325"></a><span id="l102.325" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.326"></a><span id="l102.326" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[6]'));</span>
<a href="#l102.327"></a><span id="l102.327"> </span>
<a href="#l102.328"></a><span id="l102.328" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.329"></a><span id="l102.329" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.330"></a><span id="l102.330" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[3]'));</span>
<a href="#l102.331"></a><span id="l102.331" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l102.332"></a><span id="l102.332" class="difflineminus">-    &quot;VK_DELETE&quot;,</span>
<a href="#l102.333"></a><span id="l102.333" class="difflineminus">-    {});</span>
<a href="#l102.334"></a><span id="l102.334" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.335"></a><span id="l102.335" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.336"></a><span id="l102.336" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[5]'));</span>
<a href="#l102.337"></a><span id="l102.337" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.338"></a><span id="l102.338" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.339"></a><span id="l102.339" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[3]'));</span>
<a href="#l102.340"></a><span id="l102.340" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l102.341"></a><span id="l102.341" class="difflineplus">+      &quot;VK_DELETE&quot;,</span>
<a href="#l102.342"></a><span id="l102.342" class="difflineplus">+      {});</span>
<a href="#l102.343"></a><span id="l102.343" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.344"></a><span id="l102.344" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.345"></a><span id="l102.345" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[5]'));</span>
<a href="#l102.346"></a><span id="l102.346"> </span>
<a href="#l102.347"></a><span id="l102.347" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.348"></a><span id="l102.348" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.349"></a><span id="l102.349" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]'));</span>
<a href="#l102.350"></a><span id="l102.350" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l102.351"></a><span id="l102.351" class="difflineminus">-    &quot;VK_DELETE&quot;,</span>
<a href="#l102.352"></a><span id="l102.352" class="difflineminus">-    {});</span>
<a href="#l102.353"></a><span id="l102.353" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.354"></a><span id="l102.354" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.355"></a><span id="l102.355" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]'));</span>
<a href="#l102.356"></a><span id="l102.356" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.357"></a><span id="l102.357" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.358"></a><span id="l102.358" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]'));</span>
<a href="#l102.359"></a><span id="l102.359" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;agenda-listbox&quot;),</span>
<a href="#l102.360"></a><span id="l102.360" class="difflineplus">+      &quot;VK_DELETE&quot;,</span>
<a href="#l102.361"></a><span id="l102.361" class="difflineplus">+      {});</span>
<a href="#l102.362"></a><span id="l102.362" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.363"></a><span id="l102.363" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.364"></a><span id="l102.364" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[4]'));</span>
<a href="#l102.365"></a><span id="l102.365"> </span>
<a href="#l102.366"></a><span id="l102.366" class="difflineminus">-  // hide and verify today pane hidden</span>
<a href="#l102.367"></a><span id="l102.367" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l102.368"></a><span id="l102.368" class="difflineminus">-  controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.369"></a><span id="l102.369" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/{&quot;collapsed&quot;:&quot;true&quot;}'));</span>
<a href="#l102.370"></a><span id="l102.370" class="difflineplus">+    // hide and verify today pane hidden</span>
<a href="#l102.371"></a><span id="l102.371" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l102.372"></a><span id="l102.372" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.373"></a><span id="l102.373" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/{&quot;collapsed&quot;:&quot;true&quot;}'));</span>
<a href="#l102.374"></a><span id="l102.374"> </span>
<a href="#l102.375"></a><span id="l102.375" class="difflineminus">-  // reset today pane</span>
<a href="#l102.376"></a><span id="l102.376" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l102.377"></a><span id="l102.377" class="difflineminus">-  controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.378"></a><span id="l102.378" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l102.379"></a><span id="l102.379" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.380"></a><span id="l102.380" class="difflineminus">-    'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.381"></a><span id="l102.381" class="difflineminus">-    'id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.382"></a><span id="l102.382" class="difflineminus">-    'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.383"></a><span id="l102.383" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.384"></a><span id="l102.384" class="difflineminus">-    'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.385"></a><span id="l102.385" class="difflineminus">-    'id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.386"></a><span id="l102.386" class="difflineminus">-    'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.387"></a><span id="l102.387" class="difflineminus">-  controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.388"></a><span id="l102.388" class="difflineplus">+    // reset today pane</span>
<a href="#l102.389"></a><span id="l102.389" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-status-todaypane-button&quot;));</span>
<a href="#l102.390"></a><span id="l102.390" class="difflineplus">+    controller.assertNotDOMProperty(new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.391"></a><span id="l102.391" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)'), &quot;collapsed&quot;);</span>
<a href="#l102.392"></a><span id="l102.392" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.393"></a><span id="l102.393" class="difflineplus">+      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.394"></a><span id="l102.394" class="difflineplus">+      'id(&quot;agenda-listbox&quot;)/id(&quot;tomorrow-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.395"></a><span id="l102.395" class="difflineplus">+      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.396"></a><span id="l102.396" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, '/id(&quot;messengerWindow&quot;)/' +</span>
<a href="#l102.397"></a><span id="l102.397" class="difflineplus">+      'id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/[3]/' +</span>
<a href="#l102.398"></a><span id="l102.398" class="difflineplus">+      'id(&quot;agenda-listbox&quot;)/id(&quot;nextweek-header&quot;)/anon({&quot;anonid&quot;:&quot;agenda-checkbox-widget&quot;})/' +</span>
<a href="#l102.399"></a><span id="l102.399" class="difflineplus">+      'anon({&quot;class&quot;:&quot;checkbox-check&quot;})'));</span>
<a href="#l102.400"></a><span id="l102.400" class="difflineplus">+    controller.sleep(WAIT_FOR_WINDOW_TIMEOUT);</span>
<a href="#l102.401"></a><span id="l102.401"> </span>
<a href="#l102.402"></a><span id="l102.402" class="difflineminus">-  // verify tomorrow and soon collapsed</span>
<a href="#l102.403"></a><span id="l102.403" class="difflineminus">-  tomorrow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.404"></a><span id="l102.404" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.405"></a><span id="l102.405" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[1]/anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})')).getNode();</span>
<a href="#l102.406"></a><span id="l102.406" class="difflineminus">-  let soon = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.407"></a><span id="l102.407" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.408"></a><span id="l102.408" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})')).getNode();</span>
<a href="#l102.409"></a><span id="l102.409" class="difflineminus">-// TODO This is failing, which might actually be an error in our code!</span>
<a href="#l102.410"></a><span id="l102.410" class="difflineminus">-//  controller.assertJS(!tomorrow.hasAttribute(&quot;checked&quot;)</span>
<a href="#l102.411"></a><span id="l102.411" class="difflineminus">-//    || tomorrow.getAttribute(&quot;checked&quot;) != &quot;true&quot;);</span>
<a href="#l102.412"></a><span id="l102.412" class="difflineminus">-  controller.assertJS(!soon.hasAttribute(&quot;checked&quot;) ||</span>
<a href="#l102.413"></a><span id="l102.413" class="difflineminus">-    soon.getAttribute(&quot;checked&quot;) != &quot;true&quot;);</span>
<a href="#l102.414"></a><span id="l102.414" class="difflineplus">+    // verify tomorrow and soon collapsed</span>
<a href="#l102.415"></a><span id="l102.415" class="difflineplus">+    tomorrow = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.416"></a><span id="l102.416" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.417"></a><span id="l102.417" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[1]/anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})')).getNode();</span>
<a href="#l102.418"></a><span id="l102.418" class="difflineplus">+    let soon = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l102.419"></a><span id="l102.419" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)/[1]/id(&quot;agenda-panel&quot;)/' +</span>
<a href="#l102.420"></a><span id="l102.420" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)/[2]/anon({&quot;class&quot;:&quot;agenda-checkbox&quot;})')).getNode();</span>
<a href="#l102.421"></a><span id="l102.421" class="difflineplus">+    // TODO This is failing, which might actually be an error in our code!</span>
<a href="#l102.422"></a><span id="l102.422" class="difflineplus">+    //  controller.assertJS(!tomorrow.hasAttribute(&quot;checked&quot;)</span>
<a href="#l102.423"></a><span id="l102.423" class="difflineplus">+    //    || tomorrow.getAttribute(&quot;checked&quot;) != &quot;true&quot;);</span>
<a href="#l102.424"></a><span id="l102.424" class="difflineplus">+    controller.assertJS(!soon.hasAttribute(&quot;checked&quot;) ||</span>
<a href="#l102.425"></a><span id="l102.425" class="difflineplus">+      soon.getAttribute(&quot;checked&quot;) != &quot;true&quot;);</span>
<a href="#l102.426"></a><span id="l102.426"> };</span>
<a href="#l102.427"></a><span id="l102.427"> </span>
<a href="#l102.428"></a><span id="l102.428"> var getIsoDate = function() {</span>
<a href="#l102.429"></a><span id="l102.429" class="difflineminus">-  let date = new Date();</span>
<a href="#l102.430"></a><span id="l102.430" class="difflineminus">-  let year = date.getFullYear();</span>
<a href="#l102.431"></a><span id="l102.431" class="difflineminus">-  let month = (date.getMonth() &lt; 9) ? &quot;0&quot; + (date.getMonth() + 1) : (date.getMonth() + 1);</span>
<a href="#l102.432"></a><span id="l102.432" class="difflineminus">-  let day = (date.getDate() &lt; 10) ? &quot;0&quot; + date.getDate() : date.getDate();</span>
<a href="#l102.433"></a><span id="l102.433" class="difflineminus">-  let isoDate = year + &quot;&quot; + month + &quot;&quot; + day;</span>
<a href="#l102.434"></a><span id="l102.434" class="difflineminus">-  return isoDate;</span>
<a href="#l102.435"></a><span id="l102.435" class="difflineplus">+    let date = new Date();</span>
<a href="#l102.436"></a><span id="l102.436" class="difflineplus">+    let year = date.getFullYear();</span>
<a href="#l102.437"></a><span id="l102.437" class="difflineplus">+    let month = (date.getMonth() &lt; 9 ? &quot;0&quot; + (date.getMonth() + 1) : date.getMonth() + 1);</span>
<a href="#l102.438"></a><span id="l102.438" class="difflineplus">+    let day = (date.getDate() &lt; 10 ? &quot;0&quot; + date.getDate() : date.getDate());</span>
<a href="#l102.439"></a><span id="l102.439" class="difflineplus">+    let isoDate = year + &quot;&quot; + month + &quot;&quot; + day;</span>
<a href="#l102.440"></a><span id="l102.440" class="difflineplus">+    return isoDate;</span>
<a href="#l102.441"></a><span id="l102.441"> };</span>
<a href="#l102.442"></a><span id="l102.442"> </span>
<a href="#l102.443"></a><span id="l102.443"> var teardownTest = function(module) {</span>
<a href="#l102.444"></a><span id="l102.444" class="difflineminus">-  calUtils.deleteCalendars(controller, MOZMILL_CALENDAR);</span>
<a href="#l102.445"></a><span id="l102.445" class="difflineplus">+    calUtils.deleteCalendars(controller, MOZMILL_CALENDAR);</span>
<a href="#l102.446"></a><span id="l102.446"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test1.js</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test1.js</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -3,15 +3,15 @@</span>
<a href="#l103.4"></a><span id="l103.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l103.5"></a><span id="l103.5"> </span>
<a href="#l103.6"></a><span id="l103.6"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l103.7"></a><span id="l103.7"> var timezoneUtils = require(&quot;../shared-modules/timezone-utils&quot;);</span>
<a href="#l103.8"></a><span id="l103.8"> </span>
<a href="#l103.9"></a><span id="l103.9"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l103.10"></a><span id="l103.10"> </span>
<a href="#l103.11"></a><span id="l103.11"> var setupModule = function(module) {</span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l103.14"></a><span id="l103.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l103.15"></a><span id="l103.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l103.16"></a><span id="l103.16"> };</span>
<a href="#l103.17"></a><span id="l103.17"> </span>
<a href="#l103.18"></a><span id="l103.18"> var testTimezones1_SetGMT = function() {</span>
<a href="#l103.19"></a><span id="l103.19" class="difflineminus">-  timezoneUtils.switchAppTimezone(&quot;Europe/London&quot;);</span>
<a href="#l103.20"></a><span id="l103.20" class="difflineplus">+    timezoneUtils.switchAppTimezone(&quot;Europe/London&quot;);</span>
<a href="#l103.21"></a><span id="l103.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test10.js</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -18,23 +18,23 @@ var times = [[[18, 30], [19, 30], [20, 3</span>
<a href="#l104.4"></a><span id="l104.4">              [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l104.5"></a><span id="l104.5">              [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l104.6"></a><span id="l104.6">              [[16, 30], [18, 30], [19, 30], [19, 30], [21, 30], [21, 30], [23, 30], [1, 30, +1]],</span>
<a href="#l104.7"></a><span id="l104.7">              [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [22, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l104.8"></a><span id="l104.8">              [[17, 30], [19, 30], [20, 30], [20, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]],</span>
<a href="#l104.9"></a><span id="l104.9">              [[18, 30], [19, 30], [20, 30], [21, 30], [22, 30], [23, 30], [0, 30, +1], [1, 30, +1]]];</span>
<a href="#l104.10"></a><span id="l104.10"> </span>
<a href="#l104.11"></a><span id="l104.11"> var setupModule = function(module) {</span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l104.14"></a><span id="l104.14"> };</span>
<a href="#l104.15"></a><span id="l104.15"> </span>
<a href="#l104.16"></a><span id="l104.16"> var testTimezones10_checkAdelaide = function() {</span>
<a href="#l104.17"></a><span id="l104.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l104.18"></a><span id="l104.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l104.19"></a><span id="l104.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l104.20"></a><span id="l104.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l104.21"></a><span id="l104.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l104.22"></a><span id="l104.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l104.23"></a><span id="l104.23"> </span>
<a href="#l104.24"></a><span id="l104.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l104.25"></a><span id="l104.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l104.26"></a><span id="l104.26"> };</span>
<a href="#l104.27"></a><span id="l104.27"> </span>
<a href="#l104.28"></a><span id="l104.28"> var teardownTest = function(module) {</span>
<a href="#l104.29"></a><span id="l104.29" class="difflineminus">-  prefs.preferences.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l104.30"></a><span id="l104.30" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l104.31"></a><span id="l104.31" class="difflineplus">+    prefs.preferences.clearUserPref(&quot;calendar.timezone.local&quot;);</span>
<a href="#l104.32"></a><span id="l104.32" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l104.33"></a><span id="l104.33"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test2.js</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -8,66 +8,66 @@ var timezoneUtils = require(&quot;../shared-m</span>
<a href="#l105.4"></a><span id="l105.4"> </span>
<a href="#l105.5"></a><span id="l105.5"> var sleep = 500;</span>
<a href="#l105.6"></a><span id="l105.6"> var timezones = [&quot;America/St_Johns&quot;, &quot;America/Caracas&quot;, &quot;America/Phoenix&quot;, &quot;America/Los_Angeles&quot;,</span>
<a href="#l105.7"></a><span id="l105.7">                  &quot;America/Argentina/Buenos_Aires&quot;, &quot;Europe/Paris&quot;, &quot;Asia/Kathmandu&quot;, &quot;Australia/Adelaide&quot;];</span>
<a href="#l105.8"></a><span id="l105.8"> var times = [[4, 30], [4, 30], [3, 0], [3, 0], [9, 0], [14, 0], [19, 45], [1, 30]];</span>
<a href="#l105.9"></a><span id="l105.9"> var gTimezone;</span>
<a href="#l105.10"></a><span id="l105.10"> </span>
<a href="#l105.11"></a><span id="l105.11"> var setupModule = function(module) {</span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l105.14"></a><span id="l105.14"> };</span>
<a href="#l105.15"></a><span id="l105.15"> </span>
<a href="#l105.16"></a><span id="l105.16"> var testTimezones2_CreateEvents = function() {</span>
<a href="#l105.17"></a><span id="l105.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l105.18"></a><span id="l105.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l105.19"></a><span id="l105.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l105.20"></a><span id="l105.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l105.21"></a><span id="l105.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l105.22"></a><span id="l105.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l105.23"></a><span id="l105.23"> </span>
<a href="#l105.24"></a><span id="l105.24" class="difflineminus">-  // create daily recurring events in all timezones</span>
<a href="#l105.25"></a><span id="l105.25" class="difflineminus">-  let time = new Date();</span>
<a href="#l105.26"></a><span id="l105.26" class="difflineminus">-  for (let i = 0; i &lt; timezones.length; i++) {</span>
<a href="#l105.27"></a><span id="l105.27" class="difflineminus">-    controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l105.28"></a><span id="l105.28" class="difflineminus">-      calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, i + 8)), 1, 1);</span>
<a href="#l105.29"></a><span id="l105.29" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l105.30"></a><span id="l105.30" class="difflineminus">-    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l105.31"></a><span id="l105.31" class="difflineplus">+    // create daily recurring events in all timezones</span>
<a href="#l105.32"></a><span id="l105.32" class="difflineplus">+    let time = new Date();</span>
<a href="#l105.33"></a><span id="l105.33" class="difflineplus">+    for (let i = 0; i &lt; timezones.length; i++) {</span>
<a href="#l105.34"></a><span id="l105.34" class="difflineplus">+        controller.doubleClick(new elementslib.Lookup(controller.window.document,</span>
<a href="#l105.35"></a><span id="l105.35" class="difflineplus">+          calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.CANVAS_BOX, undefined, 1, i + 8)), 1, 1);</span>
<a href="#l105.36"></a><span id="l105.36" class="difflineplus">+        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l105.37"></a><span id="l105.37" class="difflineplus">+        let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l105.38"></a><span id="l105.38"> </span>
<a href="#l105.39"></a><span id="l105.39" class="difflineminus">-    time.setHours(times[i][0]);</span>
<a href="#l105.40"></a><span id="l105.40" class="difflineminus">-    time.setMinutes(times[i][1]);</span>
<a href="#l105.41"></a><span id="l105.41" class="difflineplus">+        time.setHours(times[i][0]);</span>
<a href="#l105.42"></a><span id="l105.42" class="difflineplus">+        time.setMinutes(times[i][1]);</span>
<a href="#l105.43"></a><span id="l105.43"> </span>
<a href="#l105.44"></a><span id="l105.44" class="difflineminus">-    // set timezone</span>
<a href="#l105.45"></a><span id="l105.45" class="difflineminus">-    setTimezone(event, timezones[i]);</span>
<a href="#l105.46"></a><span id="l105.46" class="difflineplus">+        // set timezone</span>
<a href="#l105.47"></a><span id="l105.47" class="difflineplus">+        setTimezone(event, timezones[i]);</span>
<a href="#l105.48"></a><span id="l105.48"> </span>
<a href="#l105.49"></a><span id="l105.49" class="difflineminus">-    // set title and repeat</span>
<a href="#l105.50"></a><span id="l105.50" class="difflineminus">-    calUtils.setData(event, { title: timezones[i], repeat: &quot;weekly&quot;, starttime: time });</span>
<a href="#l105.51"></a><span id="l105.51" class="difflineplus">+        // set title and repeat</span>
<a href="#l105.52"></a><span id="l105.52" class="difflineplus">+        calUtils.setData(event, { title: timezones[i], repeat: &quot;weekly&quot;, starttime: time });</span>
<a href="#l105.53"></a><span id="l105.53"> </span>
<a href="#l105.54"></a><span id="l105.54" class="difflineminus">-    // save</span>
<a href="#l105.55"></a><span id="l105.55" class="difflineminus">-    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l105.56"></a><span id="l105.56" class="difflineminus">-    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l105.57"></a><span id="l105.57" class="difflineminus">-  }</span>
<a href="#l105.58"></a><span id="l105.58" class="difflineplus">+        // save</span>
<a href="#l105.59"></a><span id="l105.59" class="difflineplus">+        event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l105.60"></a><span id="l105.60" class="difflineplus">+        controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l105.61"></a><span id="l105.61" class="difflineplus">+    }</span>
<a href="#l105.62"></a><span id="l105.62"> };</span>
<a href="#l105.63"></a><span id="l105.63"> </span>
<a href="#l105.64"></a><span id="l105.64"> var teardownTest = function(module) {</span>
<a href="#l105.65"></a><span id="l105.65" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[0]);</span>
<a href="#l105.66"></a><span id="l105.66" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[0]);</span>
<a href="#l105.67"></a><span id="l105.67"> };</span>
<a href="#l105.68"></a><span id="l105.68"> </span>
<a href="#l105.69"></a><span id="l105.69"> function setTimezone(event, timezone) {</span>
<a href="#l105.70"></a><span id="l105.70" class="difflineminus">-  gTimezone = timezone;</span>
<a href="#l105.71"></a><span id="l105.71" class="difflineplus">+    gTimezone = timezone;</span>
<a href="#l105.72"></a><span id="l105.72"> </span>
<a href="#l105.73"></a><span id="l105.73" class="difflineminus">-  // for some reason setting checked is needed, no other menuitem with checkbox needs it</span>
<a href="#l105.74"></a><span id="l105.74" class="difflineminus">-  let menuitem = new elementslib.ID(event.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l105.75"></a><span id="l105.75" class="difflineminus">-  event.waitForElement(menuitem);</span>
<a href="#l105.76"></a><span id="l105.76" class="difflineminus">-  menuitem.getNode().setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l105.77"></a><span id="l105.77" class="difflineminus">-  event.click(menuitem);</span>
<a href="#l105.78"></a><span id="l105.78" class="difflineplus">+    // for some reason setting checked is needed, no other menuitem with checkbox needs it</span>
<a href="#l105.79"></a><span id="l105.79" class="difflineplus">+    let menuitem = new elementslib.ID(event.window.document, &quot;options-timezones-menuitem&quot;);</span>
<a href="#l105.80"></a><span id="l105.80" class="difflineplus">+    event.waitForElement(menuitem);</span>
<a href="#l105.81"></a><span id="l105.81" class="difflineplus">+    menuitem.getNode().setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l105.82"></a><span id="l105.82" class="difflineplus">+    event.click(menuitem);</span>
<a href="#l105.83"></a><span id="l105.83"> </span>
<a href="#l105.84"></a><span id="l105.84" class="difflineminus">-  let modal = new modalDialog.modalDialog(event.window);</span>
<a href="#l105.85"></a><span id="l105.85" class="difflineminus">-  modal.start(eventCallback);</span>
<a href="#l105.86"></a><span id="l105.86" class="difflineminus">-  event.waitForElement(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l105.87"></a><span id="l105.87" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l105.88"></a><span id="l105.88" class="difflineplus">+    let modal = new modalDialog.modalDialog(event.window);</span>
<a href="#l105.89"></a><span id="l105.89" class="difflineplus">+    modal.start(eventCallback);</span>
<a href="#l105.90"></a><span id="l105.90" class="difflineplus">+    event.waitForElement(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l105.91"></a><span id="l105.91" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;timezone-starttime&quot;));</span>
<a href="#l105.92"></a><span id="l105.92"> }</span>
<a href="#l105.93"></a><span id="l105.93"> </span>
<a href="#l105.94"></a><span id="l105.94"> function eventCallback(timezone) {</span>
<a href="#l105.95"></a><span id="l105.95" class="difflineminus">-  let item = new elementslib.XPath(timezone.window.document, &quot;/*[name()='dialog']/&quot; +</span>
<a href="#l105.96"></a><span id="l105.96" class="difflineminus">-     &quot;*[name()='menulist'][1]/*[name()='menupopup'][1]/*[@value='&quot; + gTimezone + &quot;']&quot;);</span>
<a href="#l105.97"></a><span id="l105.97" class="difflineminus">-  timezone.waitForElement(item);</span>
<a href="#l105.98"></a><span id="l105.98" class="difflineminus">-  timezone.click(item);</span>
<a href="#l105.99"></a><span id="l105.99" class="difflineminus">-  timezone.click(new elementslib.Lookup(timezone.window.document, '/id(&quot;calendar-event-dialog-timezone&quot;)/' +</span>
<a href="#l105.100"></a><span id="l105.100" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l105.101"></a><span id="l105.101" class="difflineplus">+    let item = new elementslib.XPath(timezone.window.document, &quot;/*[name()='dialog']/&quot; +</span>
<a href="#l105.102"></a><span id="l105.102" class="difflineplus">+       &quot;*[name()='menulist'][1]/*[name()='menupopup'][1]/*[@value='&quot; + gTimezone + &quot;']&quot;);</span>
<a href="#l105.103"></a><span id="l105.103" class="difflineplus">+    timezone.waitForElement(item);</span>
<a href="#l105.104"></a><span id="l105.104" class="difflineplus">+    timezone.click(item);</span>
<a href="#l105.105"></a><span id="l105.105" class="difflineplus">+    timezone.click(new elementslib.Lookup(timezone.window.document, '/id(&quot;calendar-event-dialog-timezone&quot;)/' +</span>
<a href="#l105.106"></a><span id="l105.106" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;buttons&quot;})/{&quot;dlgtype&quot;:&quot;accept&quot;}'));</span>
<a href="#l105.107"></a><span id="l105.107"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l106.1"></a><span id="l106.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l106.2"></a><span id="l106.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test3.js</span>
<a href="#l106.3"></a><span id="l106.3" class="difflineat">@@ -16,22 +16,22 @@ var times = [[[4, 30], [5, 30], [6, 30],</span>
<a href="#l106.4"></a><span id="l106.4">              [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l106.5"></a><span id="l106.5">              [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l106.6"></a><span id="l106.6">              [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [13, 30]],</span>
<a href="#l106.7"></a><span id="l106.7">              [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [9, 30], [11, 30], [12, 30]],</span>
<a href="#l106.8"></a><span id="l106.8">              [[4, 30], [6, 30], [7, 30], [7, 30], [9, 30], [10, 30], [11, 30], [12, 30]],</span>
<a href="#l106.9"></a><span id="l106.9">              [[4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30], [11, 30]]];</span>
<a href="#l106.10"></a><span id="l106.10"> </span>
<a href="#l106.11"></a><span id="l106.11"> var setupModule = function(module) {</span>
<a href="#l106.12"></a><span id="l106.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l106.13"></a><span id="l106.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l106.14"></a><span id="l106.14"> };</span>
<a href="#l106.15"></a><span id="l106.15"> </span>
<a href="#l106.16"></a><span id="l106.16"> var testTimezones3_checkStJohns = function() {</span>
<a href="#l106.17"></a><span id="l106.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l106.18"></a><span id="l106.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l106.19"></a><span id="l106.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l106.20"></a><span id="l106.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l106.21"></a><span id="l106.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l106.22"></a><span id="l106.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l106.23"></a><span id="l106.23"> </span>
<a href="#l106.24"></a><span id="l106.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l106.25"></a><span id="l106.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l106.26"></a><span id="l106.26"> };</span>
<a href="#l106.27"></a><span id="l106.27"> </span>
<a href="#l106.28"></a><span id="l106.28"> var teardownTest = function(module) {</span>
<a href="#l106.29"></a><span id="l106.29" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[1]);</span>
<a href="#l106.30"></a><span id="l106.30" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[1]);</span>
<a href="#l106.31"></a><span id="l106.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l107.1"></a><span id="l107.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l107.2"></a><span id="l107.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test4.js</span>
<a href="#l107.3"></a><span id="l107.3" class="difflineat">@@ -16,22 +16,22 @@ var times = [[[3, 30], [4, 30], [5, 30],</span>
<a href="#l107.4"></a><span id="l107.4">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l107.5"></a><span id="l107.5">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l107.6"></a><span id="l107.6">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [11, 30]],</span>
<a href="#l107.7"></a><span id="l107.7">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [7, 30], [9, 30], [10, 30]],</span>
<a href="#l107.8"></a><span id="l107.8">              [[2, 30], [4, 30], [5, 30], [5, 30], [7, 30], [8, 30], [9, 30], [10, 30]],</span>
<a href="#l107.9"></a><span id="l107.9">              [[3, 30], [4, 30], [5, 30], [6, 30], [7, 30], [8, 30], [9, 30], [10, 30]]];</span>
<a href="#l107.10"></a><span id="l107.10"> </span>
<a href="#l107.11"></a><span id="l107.11"> var setupModule = function(module) {</span>
<a href="#l107.12"></a><span id="l107.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l107.13"></a><span id="l107.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l107.14"></a><span id="l107.14"> };</span>
<a href="#l107.15"></a><span id="l107.15"> </span>
<a href="#l107.16"></a><span id="l107.16"> var testTimezones4_checkCaracas = function() {</span>
<a href="#l107.17"></a><span id="l107.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l107.18"></a><span id="l107.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l107.19"></a><span id="l107.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l107.20"></a><span id="l107.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l107.21"></a><span id="l107.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l107.22"></a><span id="l107.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l107.23"></a><span id="l107.23"> </span>
<a href="#l107.24"></a><span id="l107.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l107.25"></a><span id="l107.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l107.26"></a><span id="l107.26"> };</span>
<a href="#l107.27"></a><span id="l107.27"> </span>
<a href="#l107.28"></a><span id="l107.28"> var teardownTest = function(module) {</span>
<a href="#l107.29"></a><span id="l107.29" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[2]);</span>
<a href="#l107.30"></a><span id="l107.30" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[2]);</span>
<a href="#l107.31"></a><span id="l107.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l108.1"></a><span id="l108.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l108.2"></a><span id="l108.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test5.js</span>
<a href="#l108.3"></a><span id="l108.3" class="difflineat">@@ -16,22 +16,22 @@ var times = [[[1, 0], [2, 0], [3, 0], [4</span>
<a href="#l108.4"></a><span id="l108.4">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l108.5"></a><span id="l108.5">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l108.6"></a><span id="l108.6">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l108.7"></a><span id="l108.7">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l108.8"></a><span id="l108.8">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l108.9"></a><span id="l108.9">              [[1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0]]];</span>
<a href="#l108.10"></a><span id="l108.10"> </span>
<a href="#l108.11"></a><span id="l108.11"> var setupModule = function(module) {</span>
<a href="#l108.12"></a><span id="l108.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l108.13"></a><span id="l108.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l108.14"></a><span id="l108.14"> };</span>
<a href="#l108.15"></a><span id="l108.15"> </span>
<a href="#l108.16"></a><span id="l108.16"> var testTimezones5_checkPhoenix = function() {</span>
<a href="#l108.17"></a><span id="l108.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l108.18"></a><span id="l108.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l108.19"></a><span id="l108.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l108.20"></a><span id="l108.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l108.21"></a><span id="l108.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l108.22"></a><span id="l108.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l108.23"></a><span id="l108.23"> </span>
<a href="#l108.24"></a><span id="l108.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l108.25"></a><span id="l108.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l108.26"></a><span id="l108.26"> };</span>
<a href="#l108.27"></a><span id="l108.27"> </span>
<a href="#l108.28"></a><span id="l108.28"> var teardownTest = function(module) {</span>
<a href="#l108.29"></a><span id="l108.29" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[3]);</span>
<a href="#l108.30"></a><span id="l108.30" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[3]);</span>
<a href="#l108.31"></a><span id="l108.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l109.1"></a><span id="l109.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l109.2"></a><span id="l109.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test6.js</span>
<a href="#l109.3"></a><span id="l109.3" class="difflineat">@@ -16,22 +16,22 @@ var times = [[[0, 0], [1, 0], [2, 0], [3</span>
<a href="#l109.4"></a><span id="l109.4">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l109.5"></a><span id="l109.5">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l109.6"></a><span id="l109.6">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [9, 0]],</span>
<a href="#l109.7"></a><span id="l109.7">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [5, 0], [7, 0], [8, 0]],</span>
<a href="#l109.8"></a><span id="l109.8">              [[0, 0], [2, 0], [3, 0], [3, 0], [5, 0], [6, 0], [7, 0], [8, 0]],</span>
<a href="#l109.9"></a><span id="l109.9">              [[0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0]]];</span>
<a href="#l109.10"></a><span id="l109.10"> </span>
<a href="#l109.11"></a><span id="l109.11"> var setupModule = function(module) {</span>
<a href="#l109.12"></a><span id="l109.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l109.13"></a><span id="l109.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l109.14"></a><span id="l109.14"> };</span>
<a href="#l109.15"></a><span id="l109.15"> </span>
<a href="#l109.16"></a><span id="l109.16"> var testTimezones6_checkLosAngeles = function() {</span>
<a href="#l109.17"></a><span id="l109.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l109.18"></a><span id="l109.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l109.19"></a><span id="l109.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l109.20"></a><span id="l109.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l109.21"></a><span id="l109.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l109.22"></a><span id="l109.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l109.23"></a><span id="l109.23"> </span>
<a href="#l109.24"></a><span id="l109.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l109.25"></a><span id="l109.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l109.26"></a><span id="l109.26"> };</span>
<a href="#l109.27"></a><span id="l109.27"> </span>
<a href="#l109.28"></a><span id="l109.28"> var teardownTest = function(module) {</span>
<a href="#l109.29"></a><span id="l109.29" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[4]);</span>
<a href="#l109.30"></a><span id="l109.30" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[4]);</span>
<a href="#l109.31"></a><span id="l109.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l110.1"></a><span id="l110.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l110.2"></a><span id="l110.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test7.js</span>
<a href="#l110.3"></a><span id="l110.3" class="difflineat">@@ -16,22 +16,22 @@ var times = [[[5, 0], [6, 0], [7, 0], [8</span>
<a href="#l110.4"></a><span id="l110.4">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l110.5"></a><span id="l110.5">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l110.6"></a><span id="l110.6">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [13, 0]],</span>
<a href="#l110.7"></a><span id="l110.7">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [9, 0], [11, 0], [12, 0]],</span>
<a href="#l110.8"></a><span id="l110.8">              [[4, 0], [6, 0], [7, 0], [7, 0], [9, 0], [10, 0], [11, 0], [12, 0]],</span>
<a href="#l110.9"></a><span id="l110.9">              [[5, 0], [6, 0], [7, 0], [8, 0], [9, 0], [10, 0], [11, 0], [12, 0]]];</span>
<a href="#l110.10"></a><span id="l110.10"> </span>
<a href="#l110.11"></a><span id="l110.11"> var setupModule = function(module) {</span>
<a href="#l110.12"></a><span id="l110.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l110.13"></a><span id="l110.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l110.14"></a><span id="l110.14"> };</span>
<a href="#l110.15"></a><span id="l110.15"> </span>
<a href="#l110.16"></a><span id="l110.16"> var testTimezones7_checkBuenosAires = function() {</span>
<a href="#l110.17"></a><span id="l110.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l110.18"></a><span id="l110.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l110.19"></a><span id="l110.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l110.20"></a><span id="l110.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l110.21"></a><span id="l110.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l110.22"></a><span id="l110.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l110.23"></a><span id="l110.23"> </span>
<a href="#l110.24"></a><span id="l110.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l110.25"></a><span id="l110.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l110.26"></a><span id="l110.26"> };</span>
<a href="#l110.27"></a><span id="l110.27"> </span>
<a href="#l110.28"></a><span id="l110.28"> var teardownTest = function(module) {</span>
<a href="#l110.29"></a><span id="l110.29" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[5]);</span>
<a href="#l110.30"></a><span id="l110.30" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[5]);</span>
<a href="#l110.31"></a><span id="l110.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l111.1"></a><span id="l111.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l111.2"></a><span id="l111.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test8.js</span>
<a href="#l111.3"></a><span id="l111.3" class="difflineat">@@ -16,22 +16,22 @@ var times = [[[9, 0], [10, 0], [11, 0], </span>
<a href="#l111.4"></a><span id="l111.4">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l111.5"></a><span id="l111.5">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l111.6"></a><span id="l111.6">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [18, 0]],</span>
<a href="#l111.7"></a><span id="l111.7">              [[9, 0], [11, 0], [12, 0], [12, 0], [14, 0], [14, 0], [16, 0], [17, 0]],</span>
<a href="#l111.8"></a><span id="l111.8">              [[8, 0], [10, 0], [11, 0], [11, 0], [13, 0], [14, 0], [15, 0], [16, 0]],</span>
<a href="#l111.9"></a><span id="l111.9">              [[9, 0], [10, 0], [11, 0], [12, 0], [13, 0], [14, 0], [15, 0], [16, 0]]];</span>
<a href="#l111.10"></a><span id="l111.10"> </span>
<a href="#l111.11"></a><span id="l111.11"> var setupModule = function(module) {</span>
<a href="#l111.12"></a><span id="l111.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l111.13"></a><span id="l111.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l111.14"></a><span id="l111.14"> };</span>
<a href="#l111.15"></a><span id="l111.15"> </span>
<a href="#l111.16"></a><span id="l111.16"> var testTimezones8_checkParis = function() {</span>
<a href="#l111.17"></a><span id="l111.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l111.18"></a><span id="l111.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l111.19"></a><span id="l111.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l111.20"></a><span id="l111.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l111.21"></a><span id="l111.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l111.22"></a><span id="l111.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l111.23"></a><span id="l111.23"> </span>
<a href="#l111.24"></a><span id="l111.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l111.25"></a><span id="l111.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l111.26"></a><span id="l111.26"> };</span>
<a href="#l111.27"></a><span id="l111.27"> </span>
<a href="#l111.28"></a><span id="l111.28"> var teardownTest = function(module) {</span>
<a href="#l111.29"></a><span id="l111.29" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[6]);</span>
<a href="#l111.30"></a><span id="l111.30" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[6]);</span>
<a href="#l111.31"></a><span id="l111.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l112.1"></a><span id="l112.1" class="difflineminus">--- a/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l112.2"></a><span id="l112.2" class="difflineplus">+++ b/calendar/test/mozmill/timezoneTests/test9.js</span>
<a href="#l112.3"></a><span id="l112.3" class="difflineat">@@ -16,22 +16,22 @@ var times = [[[13, 45], [14, 45], [15, 4</span>
<a href="#l112.4"></a><span id="l112.4">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l112.5"></a><span id="l112.5">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l112.6"></a><span id="l112.6">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [21, 45]],</span>
<a href="#l112.7"></a><span id="l112.7">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [17, 45], [19, 45], [20, 45]],</span>
<a href="#l112.8"></a><span id="l112.8">              [[12, 45], [14, 45], [15, 45], [15, 45], [17, 45], [18, 45], [19, 45], [20, 45]],</span>
<a href="#l112.9"></a><span id="l112.9">              [[13, 45], [14, 45], [15, 45], [16, 45], [17, 45], [18, 45], [19, 45], [20, 45]]];</span>
<a href="#l112.10"></a><span id="l112.10"> </span>
<a href="#l112.11"></a><span id="l112.11"> var setupModule = function(module) {</span>
<a href="#l112.12"></a><span id="l112.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l112.13"></a><span id="l112.13" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l112.14"></a><span id="l112.14"> };</span>
<a href="#l112.15"></a><span id="l112.15"> </span>
<a href="#l112.16"></a><span id="l112.16"> var testTimezones9_checkKathmandu = function() {</span>
<a href="#l112.17"></a><span id="l112.17" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l112.18"></a><span id="l112.18" class="difflineminus">-  calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l112.19"></a><span id="l112.19" class="difflineminus">-  calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l112.20"></a><span id="l112.20" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l112.21"></a><span id="l112.21" class="difflineplus">+    calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l112.22"></a><span id="l112.22" class="difflineplus">+    calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l112.23"></a><span id="l112.23"> </span>
<a href="#l112.24"></a><span id="l112.24" class="difflineminus">-  timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l112.25"></a><span id="l112.25" class="difflineplus">+    timezoneUtils.verify(controller, dates, timezones, times);</span>
<a href="#l112.26"></a><span id="l112.26"> };</span>
<a href="#l112.27"></a><span id="l112.27"> </span>
<a href="#l112.28"></a><span id="l112.28"> var teardownTest = function(module) {</span>
<a href="#l112.29"></a><span id="l112.29" class="difflineminus">-  timezoneUtils.switchAppTimezone(timezones[7]);</span>
<a href="#l112.30"></a><span id="l112.30" class="difflineplus">+    timezoneUtils.switchAppTimezone(timezones[7]);</span>
<a href="#l112.31"></a><span id="l112.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l113.1"></a><span id="l113.1" class="difflineminus">--- a/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l113.2"></a><span id="l113.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l113.3"></a><span id="l113.3" class="difflineat">@@ -6,140 +6,140 @@ var calUtils = require(&quot;../shared-module</span>
<a href="#l113.4"></a><span id="l113.4"> </span>
<a href="#l113.5"></a><span id="l113.5"> var sleep = 500;</span>
<a href="#l113.6"></a><span id="l113.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l113.7"></a><span id="l113.7"> var title1 = &quot;Day View Event&quot;;</span>
<a href="#l113.8"></a><span id="l113.8"> var title2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l113.9"></a><span id="l113.9"> var desc = &quot;Day View Event Description&quot;;</span>
<a href="#l113.10"></a><span id="l113.10"> </span>
<a href="#l113.11"></a><span id="l113.11"> var setupModule = function(module) {</span>
<a href="#l113.12"></a><span id="l113.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l113.13"></a><span id="l113.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l113.14"></a><span id="l113.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l113.15"></a><span id="l113.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l113.16"></a><span id="l113.16"> };</span>
<a href="#l113.17"></a><span id="l113.17"> </span>
<a href="#l113.18"></a><span id="l113.18"> var testDayView = function() {</span>
<a href="#l113.19"></a><span id="l113.19" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l113.20"></a><span id="l113.20" class="difflineminus">-                              .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l113.21"></a><span id="l113.21" class="difflineminus">-  // paths</span>
<a href="#l113.22"></a><span id="l113.22" class="difflineminus">-  let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l113.23"></a><span id="l113.23" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l113.24"></a><span id="l113.24" class="difflineminus">-    'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l113.25"></a><span id="l113.25" class="difflineminus">-  let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l113.26"></a><span id="l113.26" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l113.27"></a><span id="l113.27" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/';</span>
<a href="#l113.28"></a><span id="l113.28" class="difflineminus">-  let day = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.29"></a><span id="l113.29" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/' +</span>
<a href="#l113.30"></a><span id="l113.30" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}');</span>
<a href="#l113.31"></a><span id="l113.31" class="difflineminus">-  let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l113.32"></a><span id="l113.32" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l113.33"></a><span id="l113.33" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l113.34"></a><span id="l113.34" class="difflineplus">+    // paths</span>
<a href="#l113.35"></a><span id="l113.35" class="difflineplus">+    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l113.36"></a><span id="l113.36" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l113.37"></a><span id="l113.37" class="difflineplus">+      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l113.38"></a><span id="l113.38" class="difflineplus">+    let dayView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l113.39"></a><span id="l113.39" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l113.40"></a><span id="l113.40" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/';</span>
<a href="#l113.41"></a><span id="l113.41" class="difflineplus">+    let day = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.42"></a><span id="l113.42" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/' +</span>
<a href="#l113.43"></a><span id="l113.43" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}');</span>
<a href="#l113.44"></a><span id="l113.44" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l113.45"></a><span id="l113.45"> </span>
<a href="#l113.46"></a><span id="l113.46" class="difflineminus">-  // open day view</span>
<a href="#l113.47"></a><span id="l113.47" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l113.48"></a><span id="l113.48" class="difflineminus">-  controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l113.49"></a><span id="l113.49" class="difflineplus">+    // open day view</span>
<a href="#l113.50"></a><span id="l113.50" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l113.51"></a><span id="l113.51" class="difflineplus">+    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-day-view-button&quot;));</span>
<a href="#l113.52"></a><span id="l113.52"> </span>
<a href="#l113.53"></a><span id="l113.53" class="difflineminus">-  // pick year</span>
<a href="#l113.54"></a><span id="l113.54" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.55"></a><span id="l113.55" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l113.56"></a><span id="l113.56" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.57"></a><span id="l113.57" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l113.58"></a><span id="l113.58" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l113.59"></a><span id="l113.59" class="difflineplus">+    // pick year</span>
<a href="#l113.60"></a><span id="l113.60" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.61"></a><span id="l113.61" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l113.62"></a><span id="l113.62" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.63"></a><span id="l113.63" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l113.64"></a><span id="l113.64" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l113.65"></a><span id="l113.65"> </span>
<a href="#l113.66"></a><span id="l113.66" class="difflineminus">-  // pick month</span>
<a href="#l113.67"></a><span id="l113.67" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.68"></a><span id="l113.68" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l113.69"></a><span id="l113.69" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.70"></a><span id="l113.70" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l113.71"></a><span id="l113.71" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l113.72"></a><span id="l113.72" class="difflineplus">+    // pick month</span>
<a href="#l113.73"></a><span id="l113.73" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.74"></a><span id="l113.74" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l113.75"></a><span id="l113.75" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.76"></a><span id="l113.76" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l113.77"></a><span id="l113.77" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l113.78"></a><span id="l113.78"> </span>
<a href="#l113.79"></a><span id="l113.79" class="difflineminus">-  // pick day</span>
<a href="#l113.80"></a><span id="l113.80" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.81"></a><span id="l113.81" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l113.82"></a><span id="l113.82" class="difflineplus">+    // pick day</span>
<a href="#l113.83"></a><span id="l113.83" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l113.84"></a><span id="l113.84" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l113.85"></a><span id="l113.85"> </span>
<a href="#l113.86"></a><span id="l113.86" class="difflineminus">-  // verify date in view</span>
<a href="#l113.87"></a><span id="l113.87" class="difflineminus">-  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l113.88"></a><span id="l113.88" class="difflineplus">+    // verify date in view</span>
<a href="#l113.89"></a><span id="l113.89" class="difflineplus">+    controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l113.90"></a><span id="l113.90"> </span>
<a href="#l113.91"></a><span id="l113.91" class="difflineminus">-  // create event at 8 AM</span>
<a href="#l113.92"></a><span id="l113.92" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.93"></a><span id="l113.93" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.94"></a><span id="l113.94" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.95"></a><span id="l113.95" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l113.96"></a><span id="l113.96" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l113.97"></a><span id="l113.97" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l113.98"></a><span id="l113.98" class="difflineplus">+    // create event at 8 AM</span>
<a href="#l113.99"></a><span id="l113.99" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.100"></a><span id="l113.100" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.101"></a><span id="l113.101" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.102"></a><span id="l113.102" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l113.103"></a><span id="l113.103" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l113.104"></a><span id="l113.104" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l113.105"></a><span id="l113.105"> </span>
<a href="#l113.106"></a><span id="l113.106" class="difflineminus">-  // check that the start time is correct</span>
<a href="#l113.107"></a><span id="l113.107" class="difflineminus">-  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.108"></a><span id="l113.108" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l113.109"></a><span id="l113.109" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l113.110"></a><span id="l113.110" class="difflineminus">-    'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l113.111"></a><span id="l113.111" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l113.112"></a><span id="l113.112" class="difflineminus">-  event.waitForElement(startTimeInput);</span>
<a href="#l113.113"></a><span id="l113.113" class="difflineminus">-  event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l113.114"></a><span id="l113.114" class="difflineminus">-  let date = startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l113.115"></a><span id="l113.115" class="difflineminus">-    2009, 1, 1);</span>
<a href="#l113.116"></a><span id="l113.116" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.117"></a><span id="l113.117" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l113.118"></a><span id="l113.118" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l113.119"></a><span id="l113.119" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l113.120"></a><span id="l113.120" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l113.121"></a><span id="l113.121" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l113.122"></a><span id="l113.122" class="difflineminus">-    date);</span>
<a href="#l113.123"></a><span id="l113.123" class="difflineplus">+    // check that the start time is correct</span>
<a href="#l113.124"></a><span id="l113.124" class="difflineplus">+    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.125"></a><span id="l113.125" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l113.126"></a><span id="l113.126" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l113.127"></a><span id="l113.127" class="difflineplus">+      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l113.128"></a><span id="l113.128" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l113.129"></a><span id="l113.129" class="difflineplus">+    event.waitForElement(startTimeInput);</span>
<a href="#l113.130"></a><span id="l113.130" class="difflineplus">+    event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l113.131"></a><span id="l113.131" class="difflineplus">+    let date = startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l113.132"></a><span id="l113.132" class="difflineplus">+      2009, 1, 1);</span>
<a href="#l113.133"></a><span id="l113.133" class="difflineplus">+    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.134"></a><span id="l113.134" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l113.135"></a><span id="l113.135" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l113.136"></a><span id="l113.136" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l113.137"></a><span id="l113.137" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l113.138"></a><span id="l113.138" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l113.139"></a><span id="l113.139" class="difflineplus">+      date);</span>
<a href="#l113.140"></a><span id="l113.140"> </span>
<a href="#l113.141"></a><span id="l113.141" class="difflineminus">-  // fill in title, description and calendar</span>
<a href="#l113.142"></a><span id="l113.142" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.143"></a><span id="l113.143" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l113.144"></a><span id="l113.144" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l113.145"></a><span id="l113.145" class="difflineminus">-    title1);</span>
<a href="#l113.146"></a><span id="l113.146" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.147"></a><span id="l113.147" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l113.148"></a><span id="l113.148" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l113.149"></a><span id="l113.149" class="difflineminus">-    desc);</span>
<a href="#l113.150"></a><span id="l113.150" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l113.151"></a><span id="l113.151" class="difflineplus">+    // fill in title, description and calendar</span>
<a href="#l113.152"></a><span id="l113.152" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.153"></a><span id="l113.153" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l113.154"></a><span id="l113.154" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l113.155"></a><span id="l113.155" class="difflineplus">+      title1);</span>
<a href="#l113.156"></a><span id="l113.156" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.157"></a><span id="l113.157" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l113.158"></a><span id="l113.158" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l113.159"></a><span id="l113.159" class="difflineplus">+      desc);</span>
<a href="#l113.160"></a><span id="l113.160" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l113.161"></a><span id="l113.161"> </span>
<a href="#l113.162"></a><span id="l113.162" class="difflineminus">-  // save</span>
<a href="#l113.163"></a><span id="l113.163" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l113.164"></a><span id="l113.164" class="difflineplus">+    // save</span>
<a href="#l113.165"></a><span id="l113.165" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l113.166"></a><span id="l113.166"> </span>
<a href="#l113.167"></a><span id="l113.167" class="difflineminus">-  // if it was created successfully, it can be opened</span>
<a href="#l113.168"></a><span id="l113.168" class="difflineminus">-  let eventBox = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.169"></a><span id="l113.169" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.170"></a><span id="l113.170" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.171"></a><span id="l113.171" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[0]/' +</span>
<a href="#l113.172"></a><span id="l113.172" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}');</span>
<a href="#l113.173"></a><span id="l113.173" class="difflineminus">-  controller.waitForElement(eventBox);</span>
<a href="#l113.174"></a><span id="l113.174" class="difflineminus">-  controller.doubleClick(eventBox);</span>
<a href="#l113.175"></a><span id="l113.175" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l113.176"></a><span id="l113.176" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l113.177"></a><span id="l113.177" class="difflineplus">+    // if it was created successfully, it can be opened</span>
<a href="#l113.178"></a><span id="l113.178" class="difflineplus">+    let eventBox = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.179"></a><span id="l113.179" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.180"></a><span id="l113.180" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.181"></a><span id="l113.181" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/[0]/' +</span>
<a href="#l113.182"></a><span id="l113.182" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}');</span>
<a href="#l113.183"></a><span id="l113.183" class="difflineplus">+    controller.waitForElement(eventBox);</span>
<a href="#l113.184"></a><span id="l113.184" class="difflineplus">+    controller.doubleClick(eventBox);</span>
<a href="#l113.185"></a><span id="l113.185" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l113.186"></a><span id="l113.186" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l113.187"></a><span id="l113.187"> </span>
<a href="#l113.188"></a><span id="l113.188" class="difflineminus">-  // change title and save changes</span>
<a href="#l113.189"></a><span id="l113.189" class="difflineminus">-  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.190"></a><span id="l113.190" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l113.191"></a><span id="l113.191" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l113.192"></a><span id="l113.192" class="difflineminus">-  event.waitForElement(titleTextBox);</span>
<a href="#l113.193"></a><span id="l113.193" class="difflineminus">-  event.type(titleTextBox, title2);</span>
<a href="#l113.194"></a><span id="l113.194" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l113.195"></a><span id="l113.195" class="difflineplus">+    // change title and save changes</span>
<a href="#l113.196"></a><span id="l113.196" class="difflineplus">+    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l113.197"></a><span id="l113.197" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l113.198"></a><span id="l113.198" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l113.199"></a><span id="l113.199" class="difflineplus">+    event.waitForElement(titleTextBox);</span>
<a href="#l113.200"></a><span id="l113.200" class="difflineplus">+    event.type(titleTextBox, title2);</span>
<a href="#l113.201"></a><span id="l113.201" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l113.202"></a><span id="l113.202"> </span>
<a href="#l113.203"></a><span id="l113.203" class="difflineminus">-  // check if name was saved</span>
<a href="#l113.204"></a><span id="l113.204" class="difflineminus">-  let eventName = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.205"></a><span id="l113.205" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.206"></a><span id="l113.206" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.207"></a><span id="l113.207" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l113.208"></a><span id="l113.208" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l113.209"></a><span id="l113.209" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l113.210"></a><span id="l113.210" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l113.211"></a><span id="l113.211" class="difflineminus">-  controller.waitForElement(eventName);</span>
<a href="#l113.212"></a><span id="l113.212" class="difflineminus">-  controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l113.213"></a><span id="l113.213" class="difflineplus">+    // check if name was saved</span>
<a href="#l113.214"></a><span id="l113.214" class="difflineplus">+    let eventName = new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.215"></a><span id="l113.215" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.216"></a><span id="l113.216" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.217"></a><span id="l113.217" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l113.218"></a><span id="l113.218" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l113.219"></a><span id="l113.219" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l113.220"></a><span id="l113.220" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l113.221"></a><span id="l113.221" class="difflineplus">+    controller.waitForElement(eventName);</span>
<a href="#l113.222"></a><span id="l113.222" class="difflineplus">+    controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l113.223"></a><span id="l113.223"> </span>
<a href="#l113.224"></a><span id="l113.224" class="difflineminus">-  // delete event</span>
<a href="#l113.225"></a><span id="l113.225" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.226"></a><span id="l113.226" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.227"></a><span id="l113.227" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.228"></a><span id="l113.228" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l113.229"></a><span id="l113.229" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l113.230"></a><span id="l113.230" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l113.231"></a><span id="l113.231" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l113.232"></a><span id="l113.232" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.233"></a><span id="l113.233" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.234"></a><span id="l113.234" class="difflineminus">-    '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.235"></a><span id="l113.235" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l113.236"></a><span id="l113.236" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l113.237"></a><span id="l113.237" class="difflineplus">+    // delete event</span>
<a href="#l113.238"></a><span id="l113.238" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.239"></a><span id="l113.239" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.240"></a><span id="l113.240" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.241"></a><span id="l113.241" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l113.242"></a><span id="l113.242" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l113.243"></a><span id="l113.243" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;day-view&quot;),</span>
<a href="#l113.244"></a><span id="l113.244" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l113.245"></a><span id="l113.245" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, dayView +</span>
<a href="#l113.246"></a><span id="l113.246" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l113.247"></a><span id="l113.247" class="difflineplus">+      '{&quot;class&quot;:&quot;calendar-event-column-even&quot;}/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/' +</span>
<a href="#l113.248"></a><span id="l113.248" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;topbox&quot;})/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/' +</span>
<a href="#l113.249"></a><span id="l113.249" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}'));</span>
<a href="#l113.250"></a><span id="l113.250"> };</span>
<a href="#l113.251"></a><span id="l113.251"> </span>
<a href="#l113.252"></a><span id="l113.252"> var teardownTest = function(module) {</span>
<a href="#l113.253"></a><span id="l113.253" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l113.254"></a><span id="l113.254" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l113.255"></a><span id="l113.255"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l114.1"></a><span id="l114.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l114.2"></a><span id="l114.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l114.3"></a><span id="l114.3" class="difflineat">@@ -6,133 +6,133 @@ var calUtils = require(&quot;../shared-module</span>
<a href="#l114.4"></a><span id="l114.4"> </span>
<a href="#l114.5"></a><span id="l114.5"> var sleep = 500;</span>
<a href="#l114.6"></a><span id="l114.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l114.7"></a><span id="l114.7"> var title1 = &quot;Month View Event&quot;;</span>
<a href="#l114.8"></a><span id="l114.8"> var title2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l114.9"></a><span id="l114.9"> var desc = &quot;Month View Event Description&quot;;</span>
<a href="#l114.10"></a><span id="l114.10"> </span>
<a href="#l114.11"></a><span id="l114.11"> var setupModule = function(module) {</span>
<a href="#l114.12"></a><span id="l114.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l114.13"></a><span id="l114.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l114.14"></a><span id="l114.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l114.15"></a><span id="l114.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l114.16"></a><span id="l114.16"> };</span>
<a href="#l114.17"></a><span id="l114.17"> </span>
<a href="#l114.18"></a><span id="l114.18"> var testMonthView = function() {</span>
<a href="#l114.19"></a><span id="l114.19" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l114.20"></a><span id="l114.20" class="difflineminus">-                              .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l114.21"></a><span id="l114.21" class="difflineminus">-  // paths</span>
<a href="#l114.22"></a><span id="l114.22" class="difflineminus">-  let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l114.23"></a><span id="l114.23" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l114.24"></a><span id="l114.24" class="difflineminus">-    'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l114.25"></a><span id="l114.25" class="difflineminus">-  let monthView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l114.26"></a><span id="l114.26" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l114.27"></a><span id="l114.27" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l114.28"></a><span id="l114.28" class="difflineminus">-  let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l114.29"></a><span id="l114.29" class="difflineminus">-  let eventBox = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l114.30"></a><span id="l114.30" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/' +</span>
<a href="#l114.31"></a><span id="l114.31" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l114.32"></a><span id="l114.32" class="difflineminus">-    '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l114.33"></a><span id="l114.33" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l114.34"></a><span id="l114.34" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l114.35"></a><span id="l114.35" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l114.36"></a><span id="l114.36" class="difflineplus">+    // paths</span>
<a href="#l114.37"></a><span id="l114.37" class="difflineplus">+    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l114.38"></a><span id="l114.38" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l114.39"></a><span id="l114.39" class="difflineplus">+      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l114.40"></a><span id="l114.40" class="difflineplus">+    let monthView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l114.41"></a><span id="l114.41" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l114.42"></a><span id="l114.42" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;month-view&quot;)/';</span>
<a href="#l114.43"></a><span id="l114.43" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l114.44"></a><span id="l114.44" class="difflineplus">+    let eventBox = monthView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l114.45"></a><span id="l114.45" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/' +</span>
<a href="#l114.46"></a><span id="l114.46" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l114.47"></a><span id="l114.47" class="difflineplus">+      '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l114.48"></a><span id="l114.48" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l114.49"></a><span id="l114.49"> </span>
<a href="#l114.50"></a><span id="l114.50" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l114.51"></a><span id="l114.51" class="difflineminus">-  controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l114.52"></a><span id="l114.52" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l114.53"></a><span id="l114.53" class="difflineplus">+    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-month-view-button&quot;));</span>
<a href="#l114.54"></a><span id="l114.54"> </span>
<a href="#l114.55"></a><span id="l114.55" class="difflineminus">-  // pick year</span>
<a href="#l114.56"></a><span id="l114.56" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.57"></a><span id="l114.57" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l114.58"></a><span id="l114.58" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.59"></a><span id="l114.59" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l114.60"></a><span id="l114.60" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l114.61"></a><span id="l114.61" class="difflineplus">+    // pick year</span>
<a href="#l114.62"></a><span id="l114.62" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.63"></a><span id="l114.63" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l114.64"></a><span id="l114.64" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.65"></a><span id="l114.65" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l114.66"></a><span id="l114.66" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l114.67"></a><span id="l114.67"> </span>
<a href="#l114.68"></a><span id="l114.68" class="difflineminus">-  // pick month</span>
<a href="#l114.69"></a><span id="l114.69" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.70"></a><span id="l114.70" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l114.71"></a><span id="l114.71" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.72"></a><span id="l114.72" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l114.73"></a><span id="l114.73" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l114.74"></a><span id="l114.74" class="difflineplus">+    // pick month</span>
<a href="#l114.75"></a><span id="l114.75" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.76"></a><span id="l114.76" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l114.77"></a><span id="l114.77" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.78"></a><span id="l114.78" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l114.79"></a><span id="l114.79" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l114.80"></a><span id="l114.80"> </span>
<a href="#l114.81"></a><span id="l114.81" class="difflineminus">-  // pick day</span>
<a href="#l114.82"></a><span id="l114.82" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.83"></a><span id="l114.83" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l114.84"></a><span id="l114.84" class="difflineplus">+    // pick day</span>
<a href="#l114.85"></a><span id="l114.85" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l114.86"></a><span id="l114.86" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l114.87"></a><span id="l114.87"> </span>
<a href="#l114.88"></a><span id="l114.88" class="difflineminus">-  // verify date</span>
<a href="#l114.89"></a><span id="l114.89" class="difflineminus">-  let day = new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l114.90"></a><span id="l114.90" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l114.91"></a><span id="l114.91" class="difflineminus">-    '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l114.92"></a><span id="l114.92" class="difflineminus">-  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l114.93"></a><span id="l114.93" class="difflineplus">+    // verify date</span>
<a href="#l114.94"></a><span id="l114.94" class="difflineplus">+    let day = new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l114.95"></a><span id="l114.95" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l114.96"></a><span id="l114.96" class="difflineplus">+      '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l114.97"></a><span id="l114.97" class="difflineplus">+    controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l114.98"></a><span id="l114.98"> </span>
<a href="#l114.99"></a><span id="l114.99" class="difflineminus">-  // create event</span>
<a href="#l114.100"></a><span id="l114.100" class="difflineminus">-  // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l114.101"></a><span id="l114.101" class="difflineminus">-  let hour = new Date().getHours(); // remember time at click</span>
<a href="#l114.102"></a><span id="l114.102" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l114.103"></a><span id="l114.103" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l114.104"></a><span id="l114.104" class="difflineminus">-    '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l114.105"></a><span id="l114.105" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l114.106"></a><span id="l114.106" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l114.107"></a><span id="l114.107" class="difflineplus">+    // create event</span>
<a href="#l114.108"></a><span id="l114.108" class="difflineplus">+    // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l114.109"></a><span id="l114.109" class="difflineplus">+    let hour = new Date().getHours(); // remember time at click</span>
<a href="#l114.110"></a><span id="l114.110" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, monthView +</span>
<a href="#l114.111"></a><span id="l114.111" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l114.112"></a><span id="l114.112" class="difflineplus">+      '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l114.113"></a><span id="l114.113" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l114.114"></a><span id="l114.114" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l114.115"></a><span id="l114.115"> </span>
<a href="#l114.116"></a><span id="l114.116" class="difflineminus">-  // check that the start time is correct</span>
<a href="#l114.117"></a><span id="l114.117" class="difflineminus">-  // next full hour except last hour hour of the day</span>
<a href="#l114.118"></a><span id="l114.118" class="difflineminus">-  let nextHour = (hour == 23) ? hour : (hour + 1) % 24;</span>
<a href="#l114.119"></a><span id="l114.119" class="difflineminus">-  let startTime = nextHour + &quot;:00&quot;; // next full hour</span>
<a href="#l114.120"></a><span id="l114.120" class="difflineminus">-  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.121"></a><span id="l114.121" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l114.122"></a><span id="l114.122" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l114.123"></a><span id="l114.123" class="difflineminus">-    'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l114.124"></a><span id="l114.124" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l114.125"></a><span id="l114.125" class="difflineminus">-  event.waitForElement(startTimeInput);</span>
<a href="#l114.126"></a><span id="l114.126" class="difflineminus">-  event.assertValue(startTimeInput, startTime);</span>
<a href="#l114.127"></a><span id="l114.127" class="difflineminus">-  let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l114.128"></a><span id="l114.128" class="difflineminus">-    2009, 1, 1);</span>
<a href="#l114.129"></a><span id="l114.129" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.130"></a><span id="l114.130" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l114.131"></a><span id="l114.131" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l114.132"></a><span id="l114.132" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l114.133"></a><span id="l114.133" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l114.134"></a><span id="l114.134" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l114.135"></a><span id="l114.135" class="difflineminus">-    date);</span>
<a href="#l114.136"></a><span id="l114.136" class="difflineplus">+    // check that the start time is correct</span>
<a href="#l114.137"></a><span id="l114.137" class="difflineplus">+    // next full hour except last hour hour of the day</span>
<a href="#l114.138"></a><span id="l114.138" class="difflineplus">+    let nextHour = (hour == 23 ? hour : (hour + 1) % 24);</span>
<a href="#l114.139"></a><span id="l114.139" class="difflineplus">+    let startTime = nextHour + &quot;:00&quot;; // next full hour</span>
<a href="#l114.140"></a><span id="l114.140" class="difflineplus">+    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.141"></a><span id="l114.141" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l114.142"></a><span id="l114.142" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l114.143"></a><span id="l114.143" class="difflineplus">+      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l114.144"></a><span id="l114.144" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l114.145"></a><span id="l114.145" class="difflineplus">+    event.waitForElement(startTimeInput);</span>
<a href="#l114.146"></a><span id="l114.146" class="difflineplus">+    event.assertValue(startTimeInput, startTime);</span>
<a href="#l114.147"></a><span id="l114.147" class="difflineplus">+    let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l114.148"></a><span id="l114.148" class="difflineplus">+      2009, 1, 1);</span>
<a href="#l114.149"></a><span id="l114.149" class="difflineplus">+    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.150"></a><span id="l114.150" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l114.151"></a><span id="l114.151" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l114.152"></a><span id="l114.152" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l114.153"></a><span id="l114.153" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l114.154"></a><span id="l114.154" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l114.155"></a><span id="l114.155" class="difflineplus">+      date);</span>
<a href="#l114.156"></a><span id="l114.156"> </span>
<a href="#l114.157"></a><span id="l114.157" class="difflineminus">-  // fill in title, description and calendar</span>
<a href="#l114.158"></a><span id="l114.158" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.159"></a><span id="l114.159" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l114.160"></a><span id="l114.160" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l114.161"></a><span id="l114.161" class="difflineminus">-    title1);</span>
<a href="#l114.162"></a><span id="l114.162" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.163"></a><span id="l114.163" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l114.164"></a><span id="l114.164" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l114.165"></a><span id="l114.165" class="difflineminus">-    desc);</span>
<a href="#l114.166"></a><span id="l114.166" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l114.167"></a><span id="l114.167" class="difflineminus">-  event.click(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.168"></a><span id="l114.168" class="difflineminus">-    'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/' +</span>
<a href="#l114.169"></a><span id="l114.169" class="difflineminus">-    '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l114.170"></a><span id="l114.170" class="difflineplus">+    // fill in title, description and calendar</span>
<a href="#l114.171"></a><span id="l114.171" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.172"></a><span id="l114.172" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l114.173"></a><span id="l114.173" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l114.174"></a><span id="l114.174" class="difflineplus">+      title1);</span>
<a href="#l114.175"></a><span id="l114.175" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.176"></a><span id="l114.176" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l114.177"></a><span id="l114.177" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l114.178"></a><span id="l114.178" class="difflineplus">+      desc);</span>
<a href="#l114.179"></a><span id="l114.179" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l114.180"></a><span id="l114.180" class="difflineplus">+    event.click(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.181"></a><span id="l114.181" class="difflineplus">+      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/' +</span>
<a href="#l114.182"></a><span id="l114.182" class="difflineplus">+      '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l114.183"></a><span id="l114.183"> </span>
<a href="#l114.184"></a><span id="l114.184" class="difflineminus">-  // save</span>
<a href="#l114.185"></a><span id="l114.185" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l114.186"></a><span id="l114.186" class="difflineplus">+    // save</span>
<a href="#l114.187"></a><span id="l114.187" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l114.188"></a><span id="l114.188"> </span>
<a href="#l114.189"></a><span id="l114.189" class="difflineminus">-  // if it was created successfully, it can be opened</span>
<a href="#l114.190"></a><span id="l114.190" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.191"></a><span id="l114.191" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.192"></a><span id="l114.192" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l114.193"></a><span id="l114.193" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l114.194"></a><span id="l114.194" class="difflineplus">+    // if it was created successfully, it can be opened</span>
<a href="#l114.195"></a><span id="l114.195" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.196"></a><span id="l114.196" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.197"></a><span id="l114.197" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l114.198"></a><span id="l114.198" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l114.199"></a><span id="l114.199"> </span>
<a href="#l114.200"></a><span id="l114.200" class="difflineminus">-  // change title and save changes</span>
<a href="#l114.201"></a><span id="l114.201" class="difflineminus">-  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.202"></a><span id="l114.202" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l114.203"></a><span id="l114.203" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l114.204"></a><span id="l114.204" class="difflineminus">-  event.waitForElement(titleTextBox);</span>
<a href="#l114.205"></a><span id="l114.205" class="difflineminus">-  event.type(titleTextBox, title2);</span>
<a href="#l114.206"></a><span id="l114.206" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l114.207"></a><span id="l114.207" class="difflineplus">+    // change title and save changes</span>
<a href="#l114.208"></a><span id="l114.208" class="difflineplus">+    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l114.209"></a><span id="l114.209" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l114.210"></a><span id="l114.210" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l114.211"></a><span id="l114.211" class="difflineplus">+    event.waitForElement(titleTextBox);</span>
<a href="#l114.212"></a><span id="l114.212" class="difflineplus">+    event.type(titleTextBox, title2);</span>
<a href="#l114.213"></a><span id="l114.213" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l114.214"></a><span id="l114.214"> </span>
<a href="#l114.215"></a><span id="l114.215" class="difflineminus">-  // check if name was saved</span>
<a href="#l114.216"></a><span id="l114.216" class="difflineminus">-  let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l114.217"></a><span id="l114.217" class="difflineminus">-    '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l114.218"></a><span id="l114.218" class="difflineminus">-  controller.waitForElement(eventName);</span>
<a href="#l114.219"></a><span id="l114.219" class="difflineminus">-  controller.assertValue(eventName, title2);</span>
<a href="#l114.220"></a><span id="l114.220" class="difflineplus">+    // check if name was saved</span>
<a href="#l114.221"></a><span id="l114.221" class="difflineplus">+    let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l114.222"></a><span id="l114.222" class="difflineplus">+      '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l114.223"></a><span id="l114.223" class="difflineplus">+    controller.waitForElement(eventName);</span>
<a href="#l114.224"></a><span id="l114.224" class="difflineplus">+    controller.assertValue(eventName, title2);</span>
<a href="#l114.225"></a><span id="l114.225"> </span>
<a href="#l114.226"></a><span id="l114.226" class="difflineminus">-  // delete event</span>
<a href="#l114.227"></a><span id="l114.227" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.228"></a><span id="l114.228" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l114.229"></a><span id="l114.229" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l114.230"></a><span id="l114.230" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.231"></a><span id="l114.231" class="difflineplus">+    // delete event</span>
<a href="#l114.232"></a><span id="l114.232" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.233"></a><span id="l114.233" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span>
<a href="#l114.234"></a><span id="l114.234" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l114.235"></a><span id="l114.235" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l114.236"></a><span id="l114.236"> };</span>
<a href="#l114.237"></a><span id="l114.237"> </span>
<a href="#l114.238"></a><span id="l114.238"> var teardownTest = function(module) {</span>
<a href="#l114.239"></a><span id="l114.239" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l114.240"></a><span id="l114.240" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l114.241"></a><span id="l114.241"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l115.1"></a><span id="l115.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l115.2"></a><span id="l115.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l115.3"></a><span id="l115.3" class="difflineat">@@ -6,133 +6,133 @@ var calUtils = require(&quot;../shared-module</span>
<a href="#l115.4"></a><span id="l115.4"> </span>
<a href="#l115.5"></a><span id="l115.5"> var sleep = 500;</span>
<a href="#l115.6"></a><span id="l115.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l115.7"></a><span id="l115.7"> var title1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l115.8"></a><span id="l115.8"> var title2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l115.9"></a><span id="l115.9"> var desc = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l115.10"></a><span id="l115.10"> </span>
<a href="#l115.11"></a><span id="l115.11"> var setupModule = function(module) {</span>
<a href="#l115.12"></a><span id="l115.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l115.13"></a><span id="l115.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l115.14"></a><span id="l115.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l115.15"></a><span id="l115.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l115.16"></a><span id="l115.16"> };</span>
<a href="#l115.17"></a><span id="l115.17"> </span>
<a href="#l115.18"></a><span id="l115.18"> var testMultiWeekView = function() {</span>
<a href="#l115.19"></a><span id="l115.19" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l115.20"></a><span id="l115.20" class="difflineminus">-                              .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l115.21"></a><span id="l115.21" class="difflineminus">-  // paths</span>
<a href="#l115.22"></a><span id="l115.22" class="difflineminus">-  let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l115.23"></a><span id="l115.23" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l115.24"></a><span id="l115.24" class="difflineminus">-    'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l115.25"></a><span id="l115.25" class="difflineminus">-  let multiWeekView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l115.26"></a><span id="l115.26" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l115.27"></a><span id="l115.27" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;multiweek-view&quot;)/';</span>
<a href="#l115.28"></a><span id="l115.28" class="difflineminus">-  let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l115.29"></a><span id="l115.29" class="difflineminus">-  let eventBox = multiWeekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l115.30"></a><span id="l115.30" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/' +</span>
<a href="#l115.31"></a><span id="l115.31" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l115.32"></a><span id="l115.32" class="difflineminus">-    '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l115.33"></a><span id="l115.33" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l115.34"></a><span id="l115.34" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l115.35"></a><span id="l115.35" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l115.36"></a><span id="l115.36" class="difflineplus">+    // paths</span>
<a href="#l115.37"></a><span id="l115.37" class="difflineplus">+    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l115.38"></a><span id="l115.38" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l115.39"></a><span id="l115.39" class="difflineplus">+      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l115.40"></a><span id="l115.40" class="difflineplus">+    let multiWeekView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l115.41"></a><span id="l115.41" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l115.42"></a><span id="l115.42" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;multiweek-view&quot;)/';</span>
<a href="#l115.43"></a><span id="l115.43" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l115.44"></a><span id="l115.44" class="difflineplus">+    let eventBox = multiWeekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/' +</span>
<a href="#l115.45"></a><span id="l115.45" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/[0]/{&quot;selected&quot;:&quot;true&quot;}/' +</span>
<a href="#l115.46"></a><span id="l115.46" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' + calendar.toLowerCase() + '&quot;}/anon({&quot;flex&quot;:&quot;1&quot;})/' +</span>
<a href="#l115.47"></a><span id="l115.47" class="difflineplus">+      '[0]/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l115.48"></a><span id="l115.48" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}';</span>
<a href="#l115.49"></a><span id="l115.49"> </span>
<a href="#l115.50"></a><span id="l115.50" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l115.51"></a><span id="l115.51" class="difflineminus">-  controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l115.52"></a><span id="l115.52" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l115.53"></a><span id="l115.53" class="difflineplus">+    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-multiweek-view-button&quot;));</span>
<a href="#l115.54"></a><span id="l115.54"> </span>
<a href="#l115.55"></a><span id="l115.55" class="difflineminus">-  // pick year</span>
<a href="#l115.56"></a><span id="l115.56" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.57"></a><span id="l115.57" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l115.58"></a><span id="l115.58" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.59"></a><span id="l115.59" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l115.60"></a><span id="l115.60" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l115.61"></a><span id="l115.61" class="difflineplus">+    // pick year</span>
<a href="#l115.62"></a><span id="l115.62" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.63"></a><span id="l115.63" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l115.64"></a><span id="l115.64" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.65"></a><span id="l115.65" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l115.66"></a><span id="l115.66" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l115.67"></a><span id="l115.67"> </span>
<a href="#l115.68"></a><span id="l115.68" class="difflineminus">-  // pick month</span>
<a href="#l115.69"></a><span id="l115.69" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.70"></a><span id="l115.70" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l115.71"></a><span id="l115.71" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.72"></a><span id="l115.72" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l115.73"></a><span id="l115.73" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l115.74"></a><span id="l115.74" class="difflineplus">+    // pick month</span>
<a href="#l115.75"></a><span id="l115.75" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.76"></a><span id="l115.76" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l115.77"></a><span id="l115.77" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.78"></a><span id="l115.78" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l115.79"></a><span id="l115.79" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l115.80"></a><span id="l115.80"> </span>
<a href="#l115.81"></a><span id="l115.81" class="difflineminus">-  // pick day</span>
<a href="#l115.82"></a><span id="l115.82" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.83"></a><span id="l115.83" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l115.84"></a><span id="l115.84" class="difflineplus">+    // pick day</span>
<a href="#l115.85"></a><span id="l115.85" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l115.86"></a><span id="l115.86" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l115.87"></a><span id="l115.87"> </span>
<a href="#l115.88"></a><span id="l115.88" class="difflineminus">-  // verify date</span>
<a href="#l115.89"></a><span id="l115.89" class="difflineminus">-  let day = new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l115.90"></a><span id="l115.90" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l115.91"></a><span id="l115.91" class="difflineminus">-    '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l115.92"></a><span id="l115.92" class="difflineminus">-  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l115.93"></a><span id="l115.93" class="difflineplus">+    // verify date</span>
<a href="#l115.94"></a><span id="l115.94" class="difflineplus">+    let day = new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l115.95"></a><span id="l115.95" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l115.96"></a><span id="l115.96" class="difflineplus">+      '[0]/{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l115.97"></a><span id="l115.97" class="difflineplus">+    controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l115.98"></a><span id="l115.98"> </span>
<a href="#l115.99"></a><span id="l115.99" class="difflineminus">-  // create event</span>
<a href="#l115.100"></a><span id="l115.100" class="difflineminus">-  // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l115.101"></a><span id="l115.101" class="difflineminus">-  let hour = new Date().getHours(); // remember time at click</span>
<a href="#l115.102"></a><span id="l115.102" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l115.103"></a><span id="l115.103" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l115.104"></a><span id="l115.104" class="difflineminus">-    '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l115.105"></a><span id="l115.105" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l115.106"></a><span id="l115.106" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l115.107"></a><span id="l115.107" class="difflineplus">+    // create event</span>
<a href="#l115.108"></a><span id="l115.108" class="difflineplus">+    // Thursday of 2009-01-01 should be the selected box in the first row with default settings</span>
<a href="#l115.109"></a><span id="l115.109" class="difflineplus">+    let hour = new Date().getHours(); // remember time at click</span>
<a href="#l115.110"></a><span id="l115.110" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, multiWeekView +</span>
<a href="#l115.111"></a><span id="l115.111" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;monthgrid&quot;})/anon({&quot;anonid&quot;:&quot;monthgridrows&quot;})/' +</span>
<a href="#l115.112"></a><span id="l115.112" class="difflineplus">+      '[0]/{&quot;selected&quot;:&quot;true&quot;}/anon({&quot;anonid&quot;:&quot;day-items&quot;})'));</span>
<a href="#l115.113"></a><span id="l115.113" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l115.114"></a><span id="l115.114" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l115.115"></a><span id="l115.115"> </span>
<a href="#l115.116"></a><span id="l115.116" class="difflineminus">-  // check that the start time is correct</span>
<a href="#l115.117"></a><span id="l115.117" class="difflineminus">-  // next full hour except last hour hour of the day</span>
<a href="#l115.118"></a><span id="l115.118" class="difflineminus">-  let nextHour = (hour == 23) ? hour : (hour + 1) % 24;</span>
<a href="#l115.119"></a><span id="l115.119" class="difflineminus">-  let startTime = nextHour + &quot;:00&quot;;</span>
<a href="#l115.120"></a><span id="l115.120" class="difflineminus">-  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.121"></a><span id="l115.121" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l115.122"></a><span id="l115.122" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l115.123"></a><span id="l115.123" class="difflineminus">-    'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l115.124"></a><span id="l115.124" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l115.125"></a><span id="l115.125" class="difflineminus">-  event.waitForElement(startTimeInput);</span>
<a href="#l115.126"></a><span id="l115.126" class="difflineminus">-  event.assertValue(startTimeInput, startTime);</span>
<a href="#l115.127"></a><span id="l115.127" class="difflineminus">-  let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l115.128"></a><span id="l115.128" class="difflineminus">-    2009, 1, 1);</span>
<a href="#l115.129"></a><span id="l115.129" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.130"></a><span id="l115.130" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l115.131"></a><span id="l115.131" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l115.132"></a><span id="l115.132" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l115.133"></a><span id="l115.133" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l115.134"></a><span id="l115.134" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l115.135"></a><span id="l115.135" class="difflineminus">-    date);</span>
<a href="#l115.136"></a><span id="l115.136" class="difflineplus">+    // check that the start time is correct</span>
<a href="#l115.137"></a><span id="l115.137" class="difflineplus">+    // next full hour except last hour hour of the day</span>
<a href="#l115.138"></a><span id="l115.138" class="difflineplus">+    let nextHour = (hour == 23 ? hour : (hour + 1) % 24);</span>
<a href="#l115.139"></a><span id="l115.139" class="difflineplus">+    let startTime = nextHour + &quot;:00&quot;;</span>
<a href="#l115.140"></a><span id="l115.140" class="difflineplus">+    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.141"></a><span id="l115.141" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l115.142"></a><span id="l115.142" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l115.143"></a><span id="l115.143" class="difflineplus">+      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l115.144"></a><span id="l115.144" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l115.145"></a><span id="l115.145" class="difflineplus">+    event.waitForElement(startTimeInput);</span>
<a href="#l115.146"></a><span id="l115.146" class="difflineplus">+    event.assertValue(startTimeInput, startTime);</span>
<a href="#l115.147"></a><span id="l115.147" class="difflineplus">+    let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l115.148"></a><span id="l115.148" class="difflineplus">+      2009, 1, 1);</span>
<a href="#l115.149"></a><span id="l115.149" class="difflineplus">+    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.150"></a><span id="l115.150" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l115.151"></a><span id="l115.151" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l115.152"></a><span id="l115.152" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l115.153"></a><span id="l115.153" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l115.154"></a><span id="l115.154" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l115.155"></a><span id="l115.155" class="difflineplus">+      date);</span>
<a href="#l115.156"></a><span id="l115.156"> </span>
<a href="#l115.157"></a><span id="l115.157" class="difflineminus">-  // fill in title, description and calendar</span>
<a href="#l115.158"></a><span id="l115.158" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.159"></a><span id="l115.159" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l115.160"></a><span id="l115.160" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l115.161"></a><span id="l115.161" class="difflineminus">-    title1);</span>
<a href="#l115.162"></a><span id="l115.162" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.163"></a><span id="l115.163" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l115.164"></a><span id="l115.164" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l115.165"></a><span id="l115.165" class="difflineminus">-    desc);</span>
<a href="#l115.166"></a><span id="l115.166" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l115.167"></a><span id="l115.167" class="difflineminus">-  event.click(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.168"></a><span id="l115.168" class="difflineminus">-    'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/' +</span>
<a href="#l115.169"></a><span id="l115.169" class="difflineminus">-    '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l115.170"></a><span id="l115.170" class="difflineplus">+    // fill in title, description and calendar</span>
<a href="#l115.171"></a><span id="l115.171" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.172"></a><span id="l115.172" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l115.173"></a><span id="l115.173" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l115.174"></a><span id="l115.174" class="difflineplus">+      title1);</span>
<a href="#l115.175"></a><span id="l115.175" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.176"></a><span id="l115.176" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l115.177"></a><span id="l115.177" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l115.178"></a><span id="l115.178" class="difflineplus">+      desc);</span>
<a href="#l115.179"></a><span id="l115.179" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;item-calendar&quot;));</span>
<a href="#l115.180"></a><span id="l115.180" class="difflineplus">+    event.click(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.181"></a><span id="l115.181" class="difflineplus">+      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/' +</span>
<a href="#l115.182"></a><span id="l115.182" class="difflineplus">+      '[0]/{&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l115.183"></a><span id="l115.183"> </span>
<a href="#l115.184"></a><span id="l115.184" class="difflineminus">-  // save</span>
<a href="#l115.185"></a><span id="l115.185" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l115.186"></a><span id="l115.186" class="difflineplus">+    // save</span>
<a href="#l115.187"></a><span id="l115.187" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l115.188"></a><span id="l115.188"> </span>
<a href="#l115.189"></a><span id="l115.189" class="difflineminus">-  // if it was created successfully, it can be opened</span>
<a href="#l115.190"></a><span id="l115.190" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.191"></a><span id="l115.191" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.192"></a><span id="l115.192" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l115.193"></a><span id="l115.193" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l115.194"></a><span id="l115.194" class="difflineplus">+    // if it was created successfully, it can be opened</span>
<a href="#l115.195"></a><span id="l115.195" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.196"></a><span id="l115.196" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.197"></a><span id="l115.197" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l115.198"></a><span id="l115.198" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l115.199"></a><span id="l115.199"> </span>
<a href="#l115.200"></a><span id="l115.200" class="difflineminus">-  // change title and save changes</span>
<a href="#l115.201"></a><span id="l115.201" class="difflineminus">-  let titmeTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.202"></a><span id="l115.202" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l115.203"></a><span id="l115.203" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l115.204"></a><span id="l115.204" class="difflineminus">-  event.waitForElement(titmeTextBox);</span>
<a href="#l115.205"></a><span id="l115.205" class="difflineminus">-  event.type(titmeTextBox, title2);</span>
<a href="#l115.206"></a><span id="l115.206" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l115.207"></a><span id="l115.207" class="difflineplus">+    // change title and save changes</span>
<a href="#l115.208"></a><span id="l115.208" class="difflineplus">+    let titmeTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l115.209"></a><span id="l115.209" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l115.210"></a><span id="l115.210" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l115.211"></a><span id="l115.211" class="difflineplus">+    event.waitForElement(titmeTextBox);</span>
<a href="#l115.212"></a><span id="l115.212" class="difflineplus">+    event.type(titmeTextBox, title2);</span>
<a href="#l115.213"></a><span id="l115.213" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l115.214"></a><span id="l115.214"> </span>
<a href="#l115.215"></a><span id="l115.215" class="difflineminus">-  // check if name was saved</span>
<a href="#l115.216"></a><span id="l115.216" class="difflineminus">-  let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l115.217"></a><span id="l115.217" class="difflineminus">-    '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l115.218"></a><span id="l115.218" class="difflineminus">-  controller.waitForElement(eventName);</span>
<a href="#l115.219"></a><span id="l115.219" class="difflineminus">-  controller.assertValue(eventName, title2);</span>
<a href="#l115.220"></a><span id="l115.220" class="difflineplus">+    // check if name was saved</span>
<a href="#l115.221"></a><span id="l115.221" class="difflineplus">+    let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l115.222"></a><span id="l115.222" class="difflineplus">+      '/{&quot;flex&quot;:&quot;1&quot;}/anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l115.223"></a><span id="l115.223" class="difflineplus">+    controller.waitForElement(eventName);</span>
<a href="#l115.224"></a><span id="l115.224" class="difflineplus">+    controller.assertValue(eventName, title2);</span>
<a href="#l115.225"></a><span id="l115.225"> </span>
<a href="#l115.226"></a><span id="l115.226" class="difflineminus">-  // delete event</span>
<a href="#l115.227"></a><span id="l115.227" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.228"></a><span id="l115.228" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;multiweek-view&quot;),</span>
<a href="#l115.229"></a><span id="l115.229" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l115.230"></a><span id="l115.230" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.231"></a><span id="l115.231" class="difflineplus">+    // delete event</span>
<a href="#l115.232"></a><span id="l115.232" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.233"></a><span id="l115.233" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;multiweek-view&quot;),</span>
<a href="#l115.234"></a><span id="l115.234" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l115.235"></a><span id="l115.235" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l115.236"></a><span id="l115.236"> };</span>
<a href="#l115.237"></a><span id="l115.237"> </span>
<a href="#l115.238"></a><span id="l115.238"> var teardownTest = function(module) {</span>
<a href="#l115.239"></a><span id="l115.239" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l115.240"></a><span id="l115.240" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l115.241"></a><span id="l115.241"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l116.1"></a><span id="l116.1" class="difflineminus">--- a/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l116.2"></a><span id="l116.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testTaskView.js</span>
<a href="#l116.3"></a><span id="l116.3" class="difflineat">@@ -7,158 +7,158 @@ var utils = require(&quot;../shared-modules/u</span>
<a href="#l116.4"></a><span id="l116.4"> </span>
<a href="#l116.5"></a><span id="l116.5"> var sleep = 500;</span>
<a href="#l116.6"></a><span id="l116.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l116.7"></a><span id="l116.7"> var title = &quot;Task&quot;;</span>
<a href="#l116.8"></a><span id="l116.8"> var description = &quot;1. Do A\n2. Do B&quot;;</span>
<a href="#l116.9"></a><span id="l116.9"> var percentComplete = &quot;50&quot;;</span>
<a href="#l116.10"></a><span id="l116.10"> </span>
<a href="#l116.11"></a><span id="l116.11"> var setupModule = function(module) {</span>
<a href="#l116.12"></a><span id="l116.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l116.13"></a><span id="l116.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l116.14"></a><span id="l116.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l116.15"></a><span id="l116.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l116.16"></a><span id="l116.16"> };</span>
<a href="#l116.17"></a><span id="l116.17"> </span>
<a href="#l116.18"></a><span id="l116.18"> // mozmill doesn't support trees yet, therefore completed checkbox and line-through style are not</span>
<a href="#l116.19"></a><span id="l116.19"> // checked</span>
<a href="#l116.20"></a><span id="l116.20"> var testTaskView = function() {</span>
<a href="#l116.21"></a><span id="l116.21" class="difflineminus">-  // paths</span>
<a href="#l116.22"></a><span id="l116.22" class="difflineminus">-  let taskView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l116.23"></a><span id="l116.23" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l116.24"></a><span id="l116.24" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/';</span>
<a href="#l116.25"></a><span id="l116.25" class="difflineminus">-  let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l116.26"></a><span id="l116.26" class="difflineminus">-  let treeChildren = taskView + '[1]/id(&quot;calendar-task-tree&quot;)/anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/' +</span>
<a href="#l116.27"></a><span id="l116.27" class="difflineminus">-    '{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}';</span>
<a href="#l116.28"></a><span id="l116.28" class="difflineminus">-  let taskTree = taskView + '[1]/id(&quot;calendar-task-tree&quot;)';</span>
<a href="#l116.29"></a><span id="l116.29" class="difflineminus">-  let toolTip = '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;taskTreeTooltip&quot;)';</span>
<a href="#l116.30"></a><span id="l116.30" class="difflineminus">-  let toolTipGrid = toolTip + '/{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/';</span>
<a href="#l116.31"></a><span id="l116.31" class="difflineplus">+    // paths</span>
<a href="#l116.32"></a><span id="l116.32" class="difflineplus">+    let taskView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l116.33"></a><span id="l116.33" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l116.34"></a><span id="l116.34" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-task-box&quot;)/';</span>
<a href="#l116.35"></a><span id="l116.35" class="difflineplus">+    let taskDialog = '/id(&quot;calendar-task-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l116.36"></a><span id="l116.36" class="difflineplus">+    let treeChildren = taskView + '[1]/id(&quot;calendar-task-tree&quot;)/anon({&quot;anonid&quot;:&quot;calendar-task-tree&quot;})/' +</span>
<a href="#l116.37"></a><span id="l116.37" class="difflineplus">+      '{&quot;tooltip&quot;:&quot;taskTreeTooltip&quot;}';</span>
<a href="#l116.38"></a><span id="l116.38" class="difflineplus">+    let taskTree = taskView + '[1]/id(&quot;calendar-task-tree&quot;)';</span>
<a href="#l116.39"></a><span id="l116.39" class="difflineplus">+    let toolTip = '/id(&quot;messengerWindow&quot;)/id(&quot;calendar-popupset&quot;)/id(&quot;taskTreeTooltip&quot;)';</span>
<a href="#l116.40"></a><span id="l116.40" class="difflineplus">+    let toolTipGrid = toolTip + '/{&quot;class&quot;:&quot;tooltipBox&quot;}/{&quot;class&quot;:&quot;tooltipHeaderGrid&quot;}/';</span>
<a href="#l116.41"></a><span id="l116.41"> </span>
<a href="#l116.42"></a><span id="l116.42" class="difflineminus">-  // open task view</span>
<a href="#l116.43"></a><span id="l116.43" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l116.44"></a><span id="l116.44" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l116.45"></a><span id="l116.45" class="difflineplus">+    // open task view</span>
<a href="#l116.46"></a><span id="l116.46" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;task-tab-button&quot;));</span>
<a href="#l116.47"></a><span id="l116.47" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l116.48"></a><span id="l116.48"> </span>
<a href="#l116.49"></a><span id="l116.49" class="difflineminus">-  // make sure that testing calendar is selected</span>
<a href="#l116.50"></a><span id="l116.50" class="difflineminus">-  let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l116.51"></a><span id="l116.51" class="difflineminus">-    '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l116.52"></a><span id="l116.52" class="difflineminus">-    'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/' +</span>
<a href="#l116.53"></a><span id="l116.53" class="difflineminus">-    'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l116.54"></a><span id="l116.54" class="difflineminus">-    .getNode();</span>
<a href="#l116.55"></a><span id="l116.55" class="difflineminus">-  for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l116.56"></a><span id="l116.56" class="difflineminus">-    if (calendarTree.mCalendarList[i].name == calendar) {</span>
<a href="#l116.57"></a><span id="l116.57" class="difflineminus">-      calendarTree.tree.view.selection.select(i);</span>
<a href="#l116.58"></a><span id="l116.58" class="difflineplus">+    // make sure that testing calendar is selected</span>
<a href="#l116.59"></a><span id="l116.59" class="difflineplus">+    let calendarTree = (new elementslib.Lookup(controller.window.document,</span>
<a href="#l116.60"></a><span id="l116.60" class="difflineplus">+      '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/id(&quot;tabpanelcontainer&quot;)/' +</span>
<a href="#l116.61"></a><span id="l116.61" class="difflineplus">+      'id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/' +</span>
<a href="#l116.62"></a><span id="l116.62" class="difflineplus">+      'id(&quot;calendar-list-pane&quot;)/id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)'))</span>
<a href="#l116.63"></a><span id="l116.63" class="difflineplus">+      .getNode();</span>
<a href="#l116.64"></a><span id="l116.64" class="difflineplus">+    for (i = 0; i &lt; calendarTree.mCalendarList.length; i++) {</span>
<a href="#l116.65"></a><span id="l116.65" class="difflineplus">+        if (calendarTree.mCalendarList[i].name == calendar) {</span>
<a href="#l116.66"></a><span id="l116.66" class="difflineplus">+            calendarTree.tree.view.selection.select(i);</span>
<a href="#l116.67"></a><span id="l116.67" class="difflineplus">+        }</span>
<a href="#l116.68"></a><span id="l116.68">     }</span>
<a href="#l116.69"></a><span id="l116.69" class="difflineminus">-  }</span>
<a href="#l116.70"></a><span id="l116.70"> </span>
<a href="#l116.71"></a><span id="l116.71" class="difflineminus">-  let taskTreeNode = (new elementslib.Lookup(controller.window.document, taskTree)).getNode();</span>
<a href="#l116.72"></a><span id="l116.72" class="difflineminus">-  let countBefore = taskTreeNode.mTaskArray.length;</span>
<a href="#l116.73"></a><span id="l116.73" class="difflineplus">+    let taskTreeNode = (new elementslib.Lookup(controller.window.document, taskTree)).getNode();</span>
<a href="#l116.74"></a><span id="l116.74" class="difflineplus">+    let countBefore = taskTreeNode.mTaskArray.length;</span>
<a href="#l116.75"></a><span id="l116.75"> </span>
<a href="#l116.76"></a><span id="l116.76" class="difflineminus">-  // add task</span>
<a href="#l116.77"></a><span id="l116.77" class="difflineminus">-  controller.type(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l116.78"></a><span id="l116.78" class="difflineminus">-    'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l116.79"></a><span id="l116.79" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.80"></a><span id="l116.80" class="difflineminus">-    title);</span>
<a href="#l116.81"></a><span id="l116.81" class="difflineminus">-  controller.keypress(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l116.82"></a><span id="l116.82" class="difflineminus">-    'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l116.83"></a><span id="l116.83" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.84"></a><span id="l116.84" class="difflineminus">-    &quot;VK_RETURN&quot;,</span>
<a href="#l116.85"></a><span id="l116.85" class="difflineminus">-    {});</span>
<a href="#l116.86"></a><span id="l116.86" class="difflineplus">+    // add task</span>
<a href="#l116.87"></a><span id="l116.87" class="difflineplus">+    controller.type(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l116.88"></a><span id="l116.88" class="difflineplus">+      'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l116.89"></a><span id="l116.89" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.90"></a><span id="l116.90" class="difflineplus">+      title);</span>
<a href="#l116.91"></a><span id="l116.91" class="difflineplus">+    controller.keypress(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l116.92"></a><span id="l116.92" class="difflineplus">+      'id(&quot;task-addition-box&quot;)/id(&quot;view-task-edit-field&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l116.93"></a><span id="l116.93" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.94"></a><span id="l116.94" class="difflineplus">+      &quot;VK_RETURN&quot;,</span>
<a href="#l116.95"></a><span id="l116.95" class="difflineplus">+      {});</span>
<a href="#l116.96"></a><span id="l116.96"> </span>
<a href="#l116.97"></a><span id="l116.97" class="difflineminus">-  // verify added</span>
<a href="#l116.98"></a><span id="l116.98" class="difflineminus">-  let countAfter;</span>
<a href="#l116.99"></a><span id="l116.99" class="difflineminus">-  controller.waitFor(() =&gt; {</span>
<a href="#l116.100"></a><span id="l116.100" class="difflineminus">-    countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l116.101"></a><span id="l116.101" class="difflineminus">-    return countBefore + 1 == countAfter;</span>
<a href="#l116.102"></a><span id="l116.102" class="difflineminus">-  });</span>
<a href="#l116.103"></a><span id="l116.103" class="difflineplus">+    // verify added</span>
<a href="#l116.104"></a><span id="l116.104" class="difflineplus">+    let countAfter;</span>
<a href="#l116.105"></a><span id="l116.105" class="difflineplus">+    controller.waitFor(() =&gt; {</span>
<a href="#l116.106"></a><span id="l116.106" class="difflineplus">+        countAfter = taskTreeNode.mTaskArray.length;</span>
<a href="#l116.107"></a><span id="l116.107" class="difflineplus">+        return countBefore + 1 == countAfter;</span>
<a href="#l116.108"></a><span id="l116.108" class="difflineplus">+    });</span>
<a href="#l116.109"></a><span id="l116.109"> </span>
<a href="#l116.110"></a><span id="l116.110" class="difflineminus">-  // last added task is automatically selected so verify detail window data</span>
<a href="#l116.111"></a><span id="l116.111" class="difflineminus">-  controller.assertJSProperty(new elementslib.ID(controller.window.document,</span>
<a href="#l116.112"></a><span id="l116.112" class="difflineminus">-    &quot;calendar-task-details-title&quot;), &quot;textContent&quot;, title);</span>
<a href="#l116.113"></a><span id="l116.113" class="difflineplus">+    // last added task is automatically selected so verify detail window data</span>
<a href="#l116.114"></a><span id="l116.114" class="difflineplus">+    controller.assertJSProperty(new elementslib.ID(controller.window.document,</span>
<a href="#l116.115"></a><span id="l116.115" class="difflineplus">+      &quot;calendar-task-details-title&quot;), &quot;textContent&quot;, title);</span>
<a href="#l116.116"></a><span id="l116.116"> </span>
<a href="#l116.117"></a><span id="l116.117" class="difflineminus">-  // open added task</span>
<a href="#l116.118"></a><span id="l116.118" class="difflineminus">-  // doubleclick on completion checkbox is ignored as opening action, so don't click at immediate</span>
<a href="#l116.119"></a><span id="l116.119" class="difflineminus">-  // left where the checkbox is located</span>
<a href="#l116.120"></a><span id="l116.120" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, treeChildren), 50, 0);</span>
<a href="#l116.121"></a><span id="l116.121" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l116.122"></a><span id="l116.122" class="difflineminus">-  let task = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l116.123"></a><span id="l116.123" class="difflineplus">+    // open added task</span>
<a href="#l116.124"></a><span id="l116.124" class="difflineplus">+    // doubleclick on completion checkbox is ignored as opening action, so don't click at immediate</span>
<a href="#l116.125"></a><span id="l116.125" class="difflineplus">+    // left where the checkbox is located</span>
<a href="#l116.126"></a><span id="l116.126" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, treeChildren), 50, 0);</span>
<a href="#l116.127"></a><span id="l116.127" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l116.128"></a><span id="l116.128" class="difflineplus">+    let task = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l116.129"></a><span id="l116.129"> </span>
<a href="#l116.130"></a><span id="l116.130" class="difflineminus">-  // verify calendar</span>
<a href="#l116.131"></a><span id="l116.131" class="difflineminus">-  task.waitForElement(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.132"></a><span id="l116.132" class="difflineminus">-    'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/' +</span>
<a href="#l116.133"></a><span id="l116.133" class="difflineminus">-    '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l116.134"></a><span id="l116.134" class="difflineplus">+    // verify calendar</span>
<a href="#l116.135"></a><span id="l116.135" class="difflineplus">+    task.waitForElement(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.136"></a><span id="l116.136" class="difflineplus">+      'id(&quot;event-grid-category-color-row&quot;)/id(&quot;event-grid-category-box&quot;)/id(&quot;item-calendar&quot;)/[0]/' +</span>
<a href="#l116.137"></a><span id="l116.137" class="difflineplus">+      '{&quot;selected&quot;:&quot;true&quot;,&quot;label&quot;:&quot;' + calendar + '&quot;}'));</span>
<a href="#l116.138"></a><span id="l116.138"> </span>
<a href="#l116.139"></a><span id="l116.139" class="difflineminus">-  // add description, mark needs action and add percent complete</span>
<a href="#l116.140"></a><span id="l116.140" class="difflineminus">-  task.type(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.141"></a><span id="l116.141" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l116.142"></a><span id="l116.142" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.143"></a><span id="l116.143" class="difflineminus">-    description);</span>
<a href="#l116.144"></a><span id="l116.144" class="difflineminus">-  task.click(new elementslib.ID(task.window.document, &quot;todo-status-needsaction-menuitem&quot;));</span>
<a href="#l116.145"></a><span id="l116.145" class="difflineplus">+    // add description, mark needs action and add percent complete</span>
<a href="#l116.146"></a><span id="l116.146" class="difflineplus">+    task.type(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.147"></a><span id="l116.147" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l116.148"></a><span id="l116.148" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.149"></a><span id="l116.149" class="difflineplus">+      description);</span>
<a href="#l116.150"></a><span id="l116.150" class="difflineplus">+    task.click(new elementslib.ID(task.window.document, &quot;todo-status-needsaction-menuitem&quot;));</span>
<a href="#l116.151"></a><span id="l116.151"> </span>
<a href="#l116.152"></a><span id="l116.152" class="difflineminus">-  // delete default 0 percent complete</span>
<a href="#l116.153"></a><span id="l116.153" class="difflineminus">-  task.keypress(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.154"></a><span id="l116.154" class="difflineminus">-    'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l116.155"></a><span id="l116.155" class="difflineminus">-    'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l116.156"></a><span id="l116.156" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.157"></a><span id="l116.157" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l116.158"></a><span id="l116.158" class="difflineminus">-  task.type(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.159"></a><span id="l116.159" class="difflineminus">-    'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l116.160"></a><span id="l116.160" class="difflineminus">-    'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l116.161"></a><span id="l116.161" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.162"></a><span id="l116.162" class="difflineminus">-    percentComplete);</span>
<a href="#l116.163"></a><span id="l116.163" class="difflineplus">+    // delete default 0 percent complete</span>
<a href="#l116.164"></a><span id="l116.164" class="difflineplus">+    task.keypress(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.165"></a><span id="l116.165" class="difflineplus">+      'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l116.166"></a><span id="l116.166" class="difflineplus">+      'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l116.167"></a><span id="l116.167" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.168"></a><span id="l116.168" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l116.169"></a><span id="l116.169" class="difflineplus">+    task.type(new elementslib.Lookup(task.window.document, taskDialog +</span>
<a href="#l116.170"></a><span id="l116.170" class="difflineplus">+      'id(&quot;event-grid-todo-status-row&quot;)/id(&quot;event-grid-todo-status-picker-box&quot;)/' +</span>
<a href="#l116.171"></a><span id="l116.171" class="difflineplus">+      'id(&quot;percent-complete-textbox&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/' +</span>
<a href="#l116.172"></a><span id="l116.172" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.173"></a><span id="l116.173" class="difflineplus">+      percentComplete);</span>
<a href="#l116.174"></a><span id="l116.174"> </span>
<a href="#l116.175"></a><span id="l116.175" class="difflineminus">-  // save</span>
<a href="#l116.176"></a><span id="l116.176" class="difflineminus">-  task.click(new elementslib.ID(task.window.document, &quot;button-save&quot;));</span>
<a href="#l116.177"></a><span id="l116.177" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l116.178"></a><span id="l116.178" class="difflineplus">+    // save</span>
<a href="#l116.179"></a><span id="l116.179" class="difflineplus">+    task.click(new elementslib.ID(task.window.document, &quot;button-save&quot;));</span>
<a href="#l116.180"></a><span id="l116.180" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length == 0);</span>
<a href="#l116.181"></a><span id="l116.181"> </span>
<a href="#l116.182"></a><span id="l116.182" class="difflineminus">-  // verify description and status in details pane</span>
<a href="#l116.183"></a><span id="l116.183" class="difflineminus">-  controller.assertValue(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l116.184"></a><span id="l116.184" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/id(&quot;calendar-task-details-description&quot;)/' +</span>
<a href="#l116.185"></a><span id="l116.185" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.186"></a><span id="l116.186" class="difflineminus">-    description);</span>
<a href="#l116.187"></a><span id="l116.187" class="difflineminus">-  let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l116.188"></a><span id="l116.188" class="difflineminus">-    &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l116.189"></a><span id="l116.189" class="difflineminus">-  controller.assertValue(new elementslib.ID(controller.window.document, &quot;calendar-task-details-status&quot;),</span>
<a href="#l116.190"></a><span id="l116.190" class="difflineminus">-    status);</span>
<a href="#l116.191"></a><span id="l116.191" class="difflineplus">+    // verify description and status in details pane</span>
<a href="#l116.192"></a><span id="l116.192" class="difflineplus">+    controller.assertValue(new elementslib.Lookup(controller.window.document, taskView +</span>
<a href="#l116.193"></a><span id="l116.193" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/id(&quot;calendar-task-details-container&quot;)/id(&quot;calendar-task-details-description&quot;)/' +</span>
<a href="#l116.194"></a><span id="l116.194" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l116.195"></a><span id="l116.195" class="difflineplus">+      description);</span>
<a href="#l116.196"></a><span id="l116.196" class="difflineplus">+    let status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l116.197"></a><span id="l116.197" class="difflineplus">+      &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l116.198"></a><span id="l116.198" class="difflineplus">+    controller.assertValue(new elementslib.ID(controller.window.document, &quot;calendar-task-details-status&quot;),</span>
<a href="#l116.199"></a><span id="l116.199" class="difflineplus">+      status);</span>
<a href="#l116.200"></a><span id="l116.200"> </span>
<a href="#l116.201"></a><span id="l116.201" class="difflineminus">-  // set high priority and verify it in detail pane</span>
<a href="#l116.202"></a><span id="l116.202" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;task-actions-priority&quot;));</span>
<a href="#l116.203"></a><span id="l116.203" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l116.204"></a><span id="l116.204" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;priority-1-menuitem&quot;));</span>
<a href="#l116.205"></a><span id="l116.205" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l116.206"></a><span id="l116.206" class="difflineminus">-  let priorityNode = new elementslib.ID(controller.window.document, &quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l116.207"></a><span id="l116.207" class="difflineminus">-  controller.assertNotDOMProperty(priorityNode, &quot;hidden&quot;);</span>
<a href="#l116.208"></a><span id="l116.208" class="difflineplus">+    // set high priority and verify it in detail pane</span>
<a href="#l116.209"></a><span id="l116.209" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;task-actions-priority&quot;));</span>
<a href="#l116.210"></a><span id="l116.210" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l116.211"></a><span id="l116.211" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;priority-1-menuitem&quot;));</span>
<a href="#l116.212"></a><span id="l116.212" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l116.213"></a><span id="l116.213" class="difflineplus">+    let priorityNode = new elementslib.ID(controller.window.document, &quot;calendar-task-details-priority-high&quot;);</span>
<a href="#l116.214"></a><span id="l116.214" class="difflineplus">+    controller.assertNotDOMProperty(priorityNode, &quot;hidden&quot;);</span>
<a href="#l116.215"></a><span id="l116.215"> </span>
<a href="#l116.216"></a><span id="l116.216" class="difflineminus">-  // verify that tooltip shows status, priority and percent complete</span>
<a href="#l116.217"></a><span id="l116.217" class="difflineminus">-  let toolTipNode = new elementslib.Lookup(controller.window.document, toolTip).getNode();</span>
<a href="#l116.218"></a><span id="l116.218" class="difflineminus">-  toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l116.219"></a><span id="l116.219" class="difflineplus">+    // verify that tooltip shows status, priority and percent complete</span>
<a href="#l116.220"></a><span id="l116.220" class="difflineplus">+    let toolTipNode = new elementslib.Lookup(controller.window.document, toolTip).getNode();</span>
<a href="#l116.221"></a><span id="l116.221" class="difflineplus">+    toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l116.222"></a><span id="l116.222"> </span>
<a href="#l116.223"></a><span id="l116.223" class="difflineminus">-  let toolTipName = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[0]/[1]&quot;);</span>
<a href="#l116.224"></a><span id="l116.224" class="difflineminus">-  let toolTipCalendar = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[1]/[1]&quot;);</span>
<a href="#l116.225"></a><span id="l116.225" class="difflineminus">-  let toolTipPriority = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[2]/[1]&quot;);</span>
<a href="#l116.226"></a><span id="l116.226" class="difflineminus">-  let toolTipStatus = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[3]/[1]&quot;);</span>
<a href="#l116.227"></a><span id="l116.227" class="difflineminus">-  let toolTipComplete = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[4]/[1]&quot;);</span>
<a href="#l116.228"></a><span id="l116.228" class="difflineminus">-  let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l116.229"></a><span id="l116.229" class="difflineminus">-    &quot;highPriority&quot;);</span>
<a href="#l116.230"></a><span id="l116.230" class="difflineplus">+    let toolTipName = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[0]/[1]&quot;);</span>
<a href="#l116.231"></a><span id="l116.231" class="difflineplus">+    let toolTipCalendar = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[1]/[1]&quot;);</span>
<a href="#l116.232"></a><span id="l116.232" class="difflineplus">+    let toolTipPriority = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[2]/[1]&quot;);</span>
<a href="#l116.233"></a><span id="l116.233" class="difflineplus">+    let toolTipStatus = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[3]/[1]&quot;);</span>
<a href="#l116.234"></a><span id="l116.234" class="difflineplus">+    let toolTipComplete = new elementslib.Lookup(controller.window.document, toolTipGrid + &quot;[1]/[4]/[1]&quot;);</span>
<a href="#l116.235"></a><span id="l116.235" class="difflineplus">+    let priority = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l116.236"></a><span id="l116.236" class="difflineplus">+      &quot;highPriority&quot;);</span>
<a href="#l116.237"></a><span id="l116.237"> </span>
<a href="#l116.238"></a><span id="l116.238" class="difflineminus">-  controller.assertJSProperty(toolTipName, &quot;textContent&quot;, title);</span>
<a href="#l116.239"></a><span id="l116.239" class="difflineminus">-  controller.assertJSProperty(toolTipCalendar, &quot;textContent&quot;, calendar);</span>
<a href="#l116.240"></a><span id="l116.240" class="difflineminus">-  controller.assertJSProperty(toolTipPriority, &quot;textContent&quot;, priority);</span>
<a href="#l116.241"></a><span id="l116.241" class="difflineminus">-  controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l116.242"></a><span id="l116.242" class="difflineminus">-  controller.assertJSProperty(toolTipComplete, &quot;textContent&quot;, percentComplete + &quot;%&quot;);</span>
<a href="#l116.243"></a><span id="l116.243" class="difflineplus">+    controller.assertJSProperty(toolTipName, &quot;textContent&quot;, title);</span>
<a href="#l116.244"></a><span id="l116.244" class="difflineplus">+    controller.assertJSProperty(toolTipCalendar, &quot;textContent&quot;, calendar);</span>
<a href="#l116.245"></a><span id="l116.245" class="difflineplus">+    controller.assertJSProperty(toolTipPriority, &quot;textContent&quot;, priority);</span>
<a href="#l116.246"></a><span id="l116.246" class="difflineplus">+    controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l116.247"></a><span id="l116.247" class="difflineplus">+    controller.assertJSProperty(toolTipComplete, &quot;textContent&quot;, percentComplete + &quot;%&quot;);</span>
<a href="#l116.248"></a><span id="l116.248"> </span>
<a href="#l116.249"></a><span id="l116.249" class="difflineminus">-  // mark completed, verify</span>
<a href="#l116.250"></a><span id="l116.250" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document,</span>
<a href="#l116.251"></a><span id="l116.251" class="difflineminus">-                                      &quot;task-actions-markcompleted&quot;));</span>
<a href="#l116.252"></a><span id="l116.252" class="difflineminus">-  controller.sleep(sleep);</span>
<a href="#l116.253"></a><span id="l116.253" class="difflineplus">+    // mark completed, verify</span>
<a href="#l116.254"></a><span id="l116.254" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document,</span>
<a href="#l116.255"></a><span id="l116.255" class="difflineplus">+                                        &quot;task-actions-markcompleted&quot;));</span>
<a href="#l116.256"></a><span id="l116.256" class="difflineplus">+    controller.sleep(sleep);</span>
<a href="#l116.257"></a><span id="l116.257"> </span>
<a href="#l116.258"></a><span id="l116.258" class="difflineminus">-  status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l116.259"></a><span id="l116.259" class="difflineminus">-    &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l116.260"></a><span id="l116.260" class="difflineminus">-  toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l116.261"></a><span id="l116.261" class="difflineminus">-  controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l116.262"></a><span id="l116.262" class="difflineplus">+    status = utils.getProperty(&quot;chrome://calendar/locale/calendar.properties&quot;,</span>
<a href="#l116.263"></a><span id="l116.263" class="difflineplus">+      &quot;taskDetailsStatusCompleted&quot;);</span>
<a href="#l116.264"></a><span id="l116.264" class="difflineplus">+    toolTipNode.ownerDocument.defaultView.showToolTip(toolTipNode, taskTreeNode.getTaskAtRow(0));</span>
<a href="#l116.265"></a><span id="l116.265" class="difflineplus">+    controller.assertJS(toolTipStatus.getNode().textContent.toLowerCase() == status.toLowerCase());</span>
<a href="#l116.266"></a><span id="l116.266"> </span>
<a href="#l116.267"></a><span id="l116.267" class="difflineminus">-  // delete task, verify</span>
<a href="#l116.268"></a><span id="l116.268" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;task-context-menu-delete&quot;));</span>
<a href="#l116.269"></a><span id="l116.269" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-delete-task-button&quot;));</span>
<a href="#l116.270"></a><span id="l116.270" class="difflineminus">-  let countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l116.271"></a><span id="l116.271" class="difflineminus">-  controller.assertJS(countAfter - 1 == countAfterDelete);</span>
<a href="#l116.272"></a><span id="l116.272" class="difflineplus">+    // delete task, verify</span>
<a href="#l116.273"></a><span id="l116.273" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;task-context-menu-delete&quot;));</span>
<a href="#l116.274"></a><span id="l116.274" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-delete-task-button&quot;));</span>
<a href="#l116.275"></a><span id="l116.275" class="difflineplus">+    let countAfterDelete = taskTreeNode.mTaskArray.length;</span>
<a href="#l116.276"></a><span id="l116.276" class="difflineplus">+    controller.assertJS(countAfter - 1 == countAfterDelete);</span>
<a href="#l116.277"></a><span id="l116.277"> };</span>
<a href="#l116.278"></a><span id="l116.278"> </span>
<a href="#l116.279"></a><span id="l116.279"> var teardownTest = function(module) {</span>
<a href="#l116.280"></a><span id="l116.280" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l116.281"></a><span id="l116.281" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l116.282"></a><span id="l116.282"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l117.1"></a><span id="l117.1" class="difflineminus">--- a/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l117.2"></a><span id="l117.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l117.3"></a><span id="l117.3" class="difflineat">@@ -6,127 +6,127 @@ var calUtils = require(&quot;../shared-module</span>
<a href="#l117.4"></a><span id="l117.4"> </span>
<a href="#l117.5"></a><span id="l117.5"> var sleep = 500;</span>
<a href="#l117.6"></a><span id="l117.6"> var calendar = &quot;Mozmill&quot;;</span>
<a href="#l117.7"></a><span id="l117.7"> var title1 = &quot;Week View Event&quot;;</span>
<a href="#l117.8"></a><span id="l117.8"> var title2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l117.9"></a><span id="l117.9"> var desc = &quot;Week View Event Description&quot;;</span>
<a href="#l117.10"></a><span id="l117.10"> </span>
<a href="#l117.11"></a><span id="l117.11"> var setupModule = function(module) {</span>
<a href="#l117.12"></a><span id="l117.12" class="difflineminus">-  controller = mozmill.getMail3PaneController();</span>
<a href="#l117.13"></a><span id="l117.13" class="difflineminus">-  calUtils.createCalendar(controller, calendar);</span>
<a href="#l117.14"></a><span id="l117.14" class="difflineplus">+    controller = mozmill.getMail3PaneController();</span>
<a href="#l117.15"></a><span id="l117.15" class="difflineplus">+    calUtils.createCalendar(controller, calendar);</span>
<a href="#l117.16"></a><span id="l117.16"> };</span>
<a href="#l117.17"></a><span id="l117.17"> </span>
<a href="#l117.18"></a><span id="l117.18"> var testWeekView = function() {</span>
<a href="#l117.19"></a><span id="l117.19" class="difflineminus">-  let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l117.20"></a><span id="l117.20" class="difflineminus">-                              .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l117.21"></a><span id="l117.21" class="difflineminus">-  // paths</span>
<a href="#l117.22"></a><span id="l117.22" class="difflineminus">-  let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l117.23"></a><span id="l117.23" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l117.24"></a><span id="l117.24" class="difflineminus">-    'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l117.25"></a><span id="l117.25" class="difflineminus">-  let weekView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l117.26"></a><span id="l117.26" class="difflineminus">-    'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l117.27"></a><span id="l117.27" class="difflineminus">-    'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/';</span>
<a href="#l117.28"></a><span id="l117.28" class="difflineminus">-  let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l117.29"></a><span id="l117.29" class="difflineminus">-  let eventBox = weekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l117.30"></a><span id="l117.30" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l117.31"></a><span id="l117.31" class="difflineminus">-    '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' +</span>
<a href="#l117.32"></a><span id="l117.32" class="difflineminus">-    calendar.toLowerCase() + '&quot;}';</span>
<a href="#l117.33"></a><span id="l117.33" class="difflineplus">+    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l117.34"></a><span id="l117.34" class="difflineplus">+                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l117.35"></a><span id="l117.35" class="difflineplus">+    // paths</span>
<a href="#l117.36"></a><span id="l117.36" class="difflineplus">+    let miniMonth = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l117.37"></a><span id="l117.37" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/id(&quot;ltnSidebar&quot;)/' +</span>
<a href="#l117.38"></a><span id="l117.38" class="difflineplus">+      'id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/';</span>
<a href="#l117.39"></a><span id="l117.39" class="difflineplus">+    let weekView = '/id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/' +</span>
<a href="#l117.40"></a><span id="l117.40" class="difflineplus">+      'id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/' +</span>
<a href="#l117.41"></a><span id="l117.41" class="difflineplus">+      'id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/id(&quot;view-deck&quot;)/id(&quot;week-view&quot;)/';</span>
<a href="#l117.42"></a><span id="l117.42" class="difflineplus">+    let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l117.43"></a><span id="l117.43" class="difflineplus">+    let eventBox = weekView + 'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/' +</span>
<a href="#l117.44"></a><span id="l117.44" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;daybox&quot;})/[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;topbox&quot;})/' +</span>
<a href="#l117.45"></a><span id="l117.45" class="difflineplus">+      '{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;flex&quot;:&quot;1&quot;}/{&quot;tooltip&quot;:&quot;itemTooltip&quot;,&quot;calendar&quot;:&quot;' +</span>
<a href="#l117.46"></a><span id="l117.46" class="difflineplus">+      calendar.toLowerCase() + '&quot;}';</span>
<a href="#l117.47"></a><span id="l117.47"> </span>
<a href="#l117.48"></a><span id="l117.48" class="difflineminus">-  controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l117.49"></a><span id="l117.49" class="difflineminus">-  controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-week-view-button&quot;));</span>
<a href="#l117.50"></a><span id="l117.50" class="difflineplus">+    controller.click(new elementslib.ID(controller.window.document, &quot;calendar-tab-button&quot;));</span>
<a href="#l117.51"></a><span id="l117.51" class="difflineplus">+    controller.waitThenClick(new elementslib.ID(controller.window.document, &quot;calendar-week-view-button&quot;));</span>
<a href="#l117.52"></a><span id="l117.52"> </span>
<a href="#l117.53"></a><span id="l117.53" class="difflineminus">-  // pick year</span>
<a href="#l117.54"></a><span id="l117.54" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.55"></a><span id="l117.55" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l117.56"></a><span id="l117.56" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.57"></a><span id="l117.57" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l117.58"></a><span id="l117.58" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l117.59"></a><span id="l117.59" class="difflineplus">+    // pick year</span>
<a href="#l117.60"></a><span id="l117.60" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.61"></a><span id="l117.61" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;yearcell&quot;})'));</span>
<a href="#l117.62"></a><span id="l117.62" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.63"></a><span id="l117.63" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l117.64"></a><span id="l117.64" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;years-popup&quot;})/[0]/{&quot;value&quot;:&quot;2009&quot;}'));</span>
<a href="#l117.65"></a><span id="l117.65"> </span>
<a href="#l117.66"></a><span id="l117.66" class="difflineminus">-  // pick month</span>
<a href="#l117.67"></a><span id="l117.67" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.68"></a><span id="l117.68" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l117.69"></a><span id="l117.69" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.70"></a><span id="l117.70" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l117.71"></a><span id="l117.71" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l117.72"></a><span id="l117.72" class="difflineplus">+    // pick month</span>
<a href="#l117.73"></a><span id="l117.73" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.74"></a><span id="l117.74" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;monthheader&quot;})'));</span>
<a href="#l117.75"></a><span id="l117.75" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.76"></a><span id="l117.76" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;minmonth-popupset&quot;})/' +</span>
<a href="#l117.77"></a><span id="l117.77" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;months-popup&quot;})/[0]/{&quot;index&quot;:&quot;0&quot;}'));</span>
<a href="#l117.78"></a><span id="l117.78"> </span>
<a href="#l117.79"></a><span id="l117.79" class="difflineminus">-  // pick day</span>
<a href="#l117.80"></a><span id="l117.80" class="difflineminus">-  controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.81"></a><span id="l117.81" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l117.82"></a><span id="l117.82" class="difflineplus">+    // pick day</span>
<a href="#l117.83"></a><span id="l117.83" class="difflineplus">+    controller.waitThenClick(new elementslib.Lookup(controller.window.document, miniMonth +</span>
<a href="#l117.84"></a><span id="l117.84" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;minimonth-calendar&quot;})/[1]/{&quot;value&quot;:&quot;1&quot;}'));</span>
<a href="#l117.85"></a><span id="l117.85"> </span>
<a href="#l117.86"></a><span id="l117.86" class="difflineminus">-  // verify date</span>
<a href="#l117.87"></a><span id="l117.87" class="difflineminus">-  let day = new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l117.88"></a><span id="l117.88" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/' +</span>
<a href="#l117.89"></a><span id="l117.89" class="difflineminus">-    '{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l117.90"></a><span id="l117.90" class="difflineminus">-  controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l117.91"></a><span id="l117.91" class="difflineplus">+    // verify date</span>
<a href="#l117.92"></a><span id="l117.92" class="difflineplus">+    let day = new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l117.93"></a><span id="l117.93" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;labelbox&quot;})/anon({&quot;anonid&quot;:&quot;labeldaybox&quot;})/' +</span>
<a href="#l117.94"></a><span id="l117.94" class="difflineplus">+      '{&quot;selected&quot;:&quot;true&quot;}');</span>
<a href="#l117.95"></a><span id="l117.95" class="difflineplus">+    controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l117.96"></a><span id="l117.96"> </span>
<a href="#l117.97"></a><span id="l117.97" class="difflineminus">-  // create event at 8 AM</span>
<a href="#l117.98"></a><span id="l117.98" class="difflineminus">-  // Thursday of 2009-01-01 is 4th with default settings</span>
<a href="#l117.99"></a><span id="l117.99" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l117.100"></a><span id="l117.100" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l117.101"></a><span id="l117.101" class="difflineminus">-    '[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l117.102"></a><span id="l117.102" class="difflineminus">-  controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l117.103"></a><span id="l117.103" class="difflineminus">-  let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l117.104"></a><span id="l117.104" class="difflineplus">+    // create event at 8 AM</span>
<a href="#l117.105"></a><span id="l117.105" class="difflineplus">+    // Thursday of 2009-01-01 is 4th with default settings</span>
<a href="#l117.106"></a><span id="l117.106" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, weekView +</span>
<a href="#l117.107"></a><span id="l117.107" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;mainbox&quot;})/anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;daybox&quot;})/' +</span>
<a href="#l117.108"></a><span id="l117.108" class="difflineplus">+      '[4]/anon({&quot;anonid&quot;:&quot;boxstack&quot;})/anon({&quot;anonid&quot;:&quot;bgbox&quot;})/[8]'), 1, 1);</span>
<a href="#l117.109"></a><span id="l117.109" class="difflineplus">+    controller.waitFor(() =&gt; mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l117.110"></a><span id="l117.110" class="difflineplus">+    let event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l117.111"></a><span id="l117.111"> </span>
<a href="#l117.112"></a><span id="l117.112" class="difflineminus">-  // check that the start time is correct</span>
<a href="#l117.113"></a><span id="l117.113" class="difflineminus">-  let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.114"></a><span id="l117.114" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l117.115"></a><span id="l117.115" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l117.116"></a><span id="l117.116" class="difflineminus">-    'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l117.117"></a><span id="l117.117" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l117.118"></a><span id="l117.118" class="difflineminus">-  event.waitForElement(startTimeInput);</span>
<a href="#l117.119"></a><span id="l117.119" class="difflineminus">-  event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l117.120"></a><span id="l117.120" class="difflineminus">-  let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l117.121"></a><span id="l117.121" class="difflineminus">-    2009, 1, 1);</span>
<a href="#l117.122"></a><span id="l117.122" class="difflineminus">-  event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.123"></a><span id="l117.123" class="difflineminus">-    'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l117.124"></a><span id="l117.124" class="difflineminus">-    'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l117.125"></a><span id="l117.125" class="difflineminus">-    'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l117.126"></a><span id="l117.126" class="difflineminus">-    '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l117.127"></a><span id="l117.127" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l117.128"></a><span id="l117.128" class="difflineminus">-    date);</span>
<a href="#l117.129"></a><span id="l117.129" class="difflineplus">+    // check that the start time is correct</span>
<a href="#l117.130"></a><span id="l117.130" class="difflineplus">+    let startTimeInput = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.131"></a><span id="l117.131" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l117.132"></a><span id="l117.132" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/' +</span>
<a href="#l117.133"></a><span id="l117.133" class="difflineplus">+      'anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/' +</span>
<a href="#l117.134"></a><span id="l117.134" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l117.135"></a><span id="l117.135" class="difflineplus">+    event.waitForElement(startTimeInput);</span>
<a href="#l117.136"></a><span id="l117.136" class="difflineplus">+    event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l117.137"></a><span id="l117.137" class="difflineplus">+    let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l117.138"></a><span id="l117.138" class="difflineplus">+      2009, 1, 1);</span>
<a href="#l117.139"></a><span id="l117.139" class="difflineplus">+    event.assertValue(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.140"></a><span id="l117.140" class="difflineplus">+      'id(&quot;event-grid-startdate-row&quot;)/id(&quot;event-grid-startdate-picker-box&quot;)/' +</span>
<a href="#l117.141"></a><span id="l117.141" class="difflineplus">+      'id(&quot;event-starttime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/' +</span>
<a href="#l117.142"></a><span id="l117.142" class="difflineplus">+      'anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/' +</span>
<a href="#l117.143"></a><span id="l117.143" class="difflineplus">+      '{&quot;class&quot;:&quot;datepicker-text-class&quot;}/anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/' +</span>
<a href="#l117.144"></a><span id="l117.144" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l117.145"></a><span id="l117.145" class="difflineplus">+      date);</span>
<a href="#l117.146"></a><span id="l117.146"> </span>
<a href="#l117.147"></a><span id="l117.147" class="difflineminus">-  // fill in title, description and calendar</span>
<a href="#l117.148"></a><span id="l117.148" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.149"></a><span id="l117.149" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l117.150"></a><span id="l117.150" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l117.151"></a><span id="l117.151" class="difflineminus">-    title1);</span>
<a href="#l117.152"></a><span id="l117.152" class="difflineminus">-  event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.153"></a><span id="l117.153" class="difflineminus">-    'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l117.154"></a><span id="l117.154" class="difflineminus">-    'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l117.155"></a><span id="l117.155" class="difflineminus">-    desc);</span>
<a href="#l117.156"></a><span id="l117.156" class="difflineminus">-  event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l117.157"></a><span id="l117.157" class="difflineplus">+    // fill in title, description and calendar</span>
<a href="#l117.158"></a><span id="l117.158" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.159"></a><span id="l117.159" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l117.160"></a><span id="l117.160" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l117.161"></a><span id="l117.161" class="difflineplus">+      title1);</span>
<a href="#l117.162"></a><span id="l117.162" class="difflineplus">+    event.type(new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.163"></a><span id="l117.163" class="difflineplus">+      'id(&quot;event-grid-description-row&quot;)/id(&quot;item-description&quot;)/' +</span>
<a href="#l117.164"></a><span id="l117.164" class="difflineplus">+      'anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/anon({&quot;anonid&quot;:&quot;input&quot;})'),</span>
<a href="#l117.165"></a><span id="l117.165" class="difflineplus">+      desc);</span>
<a href="#l117.166"></a><span id="l117.166" class="difflineplus">+    event.select(new elementslib.ID(event.window.document, &quot;item-calendar&quot;), null, calendar);</span>
<a href="#l117.167"></a><span id="l117.167"> </span>
<a href="#l117.168"></a><span id="l117.168" class="difflineminus">-  // save</span>
<a href="#l117.169"></a><span id="l117.169" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l117.170"></a><span id="l117.170" class="difflineplus">+    // save</span>
<a href="#l117.171"></a><span id="l117.171" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l117.172"></a><span id="l117.172"> </span>
<a href="#l117.173"></a><span id="l117.173" class="difflineminus">-  // if it was created successfully, it can be opened</span>
<a href="#l117.174"></a><span id="l117.174" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.175"></a><span id="l117.175" class="difflineminus">-  controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.176"></a><span id="l117.176" class="difflineminus">-  controller.waitFor(() =&gt; utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l117.177"></a><span id="l117.177" class="difflineminus">-  event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l117.178"></a><span id="l117.178" class="difflineplus">+    // if it was created successfully, it can be opened</span>
<a href="#l117.179"></a><span id="l117.179" class="difflineplus">+    controller.waitForElement(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.180"></a><span id="l117.180" class="difflineplus">+    controller.doubleClick(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.181"></a><span id="l117.181" class="difflineplus">+    controller.waitFor(() =&gt; utils.getWindows(&quot;Calendar:EventDialog&quot;).length &gt; 0, sleep);</span>
<a href="#l117.182"></a><span id="l117.182" class="difflineplus">+    event = new mozmill.controller.MozMillController(mozmill.utils.getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l117.183"></a><span id="l117.183"> </span>
<a href="#l117.184"></a><span id="l117.184" class="difflineminus">-  // change title and save changes</span>
<a href="#l117.185"></a><span id="l117.185" class="difflineminus">-  let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.186"></a><span id="l117.186" class="difflineminus">-    'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l117.187"></a><span id="l117.187" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l117.188"></a><span id="l117.188" class="difflineminus">-  event.waitForElement(titleTextBox);</span>
<a href="#l117.189"></a><span id="l117.189" class="difflineminus">-  event.type(titleTextBox, title2);</span>
<a href="#l117.190"></a><span id="l117.190" class="difflineminus">-  event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l117.191"></a><span id="l117.191" class="difflineplus">+    // change title and save changes</span>
<a href="#l117.192"></a><span id="l117.192" class="difflineplus">+    let titleTextBox = new elementslib.Lookup(event.window.document, eventDialog +</span>
<a href="#l117.193"></a><span id="l117.193" class="difflineplus">+      'id(&quot;event-grid-title-row&quot;)/id(&quot;item-title&quot;)/anon({&quot;class&quot;:&quot;textbox-input-box&quot;})/' +</span>
<a href="#l117.194"></a><span id="l117.194" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;input&quot;})');</span>
<a href="#l117.195"></a><span id="l117.195" class="difflineplus">+    event.waitForElement(titleTextBox);</span>
<a href="#l117.196"></a><span id="l117.196" class="difflineplus">+    event.type(titleTextBox, title2);</span>
<a href="#l117.197"></a><span id="l117.197" class="difflineplus">+    event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l117.198"></a><span id="l117.198"> </span>
<a href="#l117.199"></a><span id="l117.199" class="difflineminus">-  // check if name was saved</span>
<a href="#l117.200"></a><span id="l117.200" class="difflineminus">-  let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l117.201"></a><span id="l117.201" class="difflineminus">-    '/anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l117.202"></a><span id="l117.202" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/' +</span>
<a href="#l117.203"></a><span id="l117.203" class="difflineminus">-    'anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l117.204"></a><span id="l117.204" class="difflineminus">-  controller.waitForElement(eventName);</span>
<a href="#l117.205"></a><span id="l117.205" class="difflineminus">-  controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l117.206"></a><span id="l117.206" class="difflineplus">+    // check if name was saved</span>
<a href="#l117.207"></a><span id="l117.207" class="difflineplus">+    let eventName = new elementslib.Lookup(controller.window.document, eventBox +</span>
<a href="#l117.208"></a><span id="l117.208" class="difflineplus">+      '/anon({&quot;flex&quot;:&quot;1&quot;})/anon({&quot;anonid&quot;:&quot;event-container&quot;})/{&quot;class&quot;:&quot;calendar-event-selection&quot;}/' +</span>
<a href="#l117.209"></a><span id="l117.209" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;eventbox&quot;})/{&quot;class&quot;:&quot;calendar-event-details&quot;}/' +</span>
<a href="#l117.210"></a><span id="l117.210" class="difflineplus">+      'anon({&quot;anonid&quot;:&quot;event-name&quot;})');</span>
<a href="#l117.211"></a><span id="l117.211" class="difflineplus">+    controller.waitForElement(eventName);</span>
<a href="#l117.212"></a><span id="l117.212" class="difflineplus">+    controller.assertJSProperty(eventName, &quot;textContent&quot;, title2);</span>
<a href="#l117.213"></a><span id="l117.213"> </span>
<a href="#l117.214"></a><span id="l117.214" class="difflineminus">-  // delete event</span>
<a href="#l117.215"></a><span id="l117.215" class="difflineminus">-  controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.216"></a><span id="l117.216" class="difflineminus">-  controller.keypress(new elementslib.ID(controller.window.document, &quot;week-view&quot;),</span>
<a href="#l117.217"></a><span id="l117.217" class="difflineminus">-    &quot;VK_DELETE&quot;, {});</span>
<a href="#l117.218"></a><span id="l117.218" class="difflineminus">-  controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.219"></a><span id="l117.219" class="difflineplus">+    // delete event</span>
<a href="#l117.220"></a><span id="l117.220" class="difflineplus">+    controller.click(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.221"></a><span id="l117.221" class="difflineplus">+    controller.keypress(new elementslib.ID(controller.window.document, &quot;week-view&quot;),</span>
<a href="#l117.222"></a><span id="l117.222" class="difflineplus">+      &quot;VK_DELETE&quot;, {});</span>
<a href="#l117.223"></a><span id="l117.223" class="difflineplus">+    controller.waitForElementNotPresent(new elementslib.Lookup(controller.window.document, eventBox));</span>
<a href="#l117.224"></a><span id="l117.224"> };</span>
<a href="#l117.225"></a><span id="l117.225"> </span>
<a href="#l117.226"></a><span id="l117.226"> var teardownTest = function(module) {</span>
<a href="#l117.227"></a><span id="l117.227" class="difflineminus">-  calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l117.228"></a><span id="l117.228" class="difflineplus">+    calUtils.deleteCalendars(controller, calendar);</span>
<a href="#l117.229"></a><span id="l117.229"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l118.1"></a><span id="l118.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l118.2"></a><span id="l118.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l118.3"></a><span id="l118.3" class="difflineat">@@ -13,22 +13,22 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l118.4"></a><span id="l118.4"> Components.utils.import(&quot;resource://gre/modules/FileUtils.jsm&quot;);</span>
<a href="#l118.5"></a><span id="l118.5"> </span>
<a href="#l118.6"></a><span id="l118.6"> Components.utils.import(&quot;resource://testing-common/AppInfo.jsm&quot;);</span>
<a href="#l118.7"></a><span id="l118.7"> updateAppInfo();</span>
<a href="#l118.8"></a><span id="l118.8"> </span>
<a href="#l118.9"></a><span id="l118.9"> var { classes: Cc, interfaces: Ci, results: Cr, utils: Cu } = Components;</span>
<a href="#l118.10"></a><span id="l118.10"> </span>
<a href="#l118.11"></a><span id="l118.11"> (function() {</span>
<a href="#l118.12"></a><span id="l118.12" class="difflineminus">-  let bindir = Services.dirsvc.get(&quot;CurProcD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l118.13"></a><span id="l118.13" class="difflineminus">-  bindir.append(&quot;extensions&quot;);</span>
<a href="#l118.14"></a><span id="l118.14" class="difflineminus">-  bindir.append(&quot;{e2fda1a4-762b-4020-b5ad-a41df1933103}&quot;);</span>
<a href="#l118.15"></a><span id="l118.15" class="difflineminus">-  bindir.append(&quot;chrome.manifest&quot;);</span>
<a href="#l118.16"></a><span id="l118.16" class="difflineminus">-  dump(&quot;Loading&quot; + bindir.path + &quot;\n&quot;);</span>
<a href="#l118.17"></a><span id="l118.17" class="difflineminus">-  Components.manager.autoRegister(bindir);</span>
<a href="#l118.18"></a><span id="l118.18" class="difflineplus">+    let bindir = Services.dirsvc.get(&quot;CurProcD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l118.19"></a><span id="l118.19" class="difflineplus">+    bindir.append(&quot;extensions&quot;);</span>
<a href="#l118.20"></a><span id="l118.20" class="difflineplus">+    bindir.append(&quot;{e2fda1a4-762b-4020-b5ad-a41df1933103}&quot;);</span>
<a href="#l118.21"></a><span id="l118.21" class="difflineplus">+    bindir.append(&quot;chrome.manifest&quot;);</span>
<a href="#l118.22"></a><span id="l118.22" class="difflineplus">+    dump(&quot;Loading&quot; + bindir.path + &quot;\n&quot;);</span>
<a href="#l118.23"></a><span id="l118.23" class="difflineplus">+    Components.manager.autoRegister(bindir);</span>
<a href="#l118.24"></a><span id="l118.24"> })();</span>
<a href="#l118.25"></a><span id="l118.25"> </span>
<a href="#l118.26"></a><span id="l118.26"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l118.27"></a><span id="l118.27"> </span>
<a href="#l118.28"></a><span id="l118.28"> // we might want to use calUtils.jsm only in the future throughout all tests,</span>
<a href="#l118.29"></a><span id="l118.29"> // but for now source in good old calUtils.js:</span>
<a href="#l118.30"></a><span id="l118.30"> cal.loadScripts([&quot;calUtils.js&quot;], Components.utils.getGlobalForObject(Cc));</span>
<a href="#l118.31"></a><span id="l118.31"> </span>
<a href="#l118.32"></a><span id="l118.32" class="difflineat">@@ -184,35 +184,35 @@ function compareItemsSpecific(aLeftItem,</span>
<a href="#l118.33"></a><span id="l118.33"> /**</span>
<a href="#l118.34"></a><span id="l118.34">  * Unfold ics lines by removing any \r\n or \n followed by a linear whitespace</span>
<a href="#l118.35"></a><span id="l118.35">  * (space or htab).</span>
<a href="#l118.36"></a><span id="l118.36">  *</span>
<a href="#l118.37"></a><span id="l118.37">  * @param aLine     The line to unfold</span>
<a href="#l118.38"></a><span id="l118.38">  * @return          The unfolded line</span>
<a href="#l118.39"></a><span id="l118.39">  */</span>
<a href="#l118.40"></a><span id="l118.40"> function ics_unfoldline(aLine) {</span>
<a href="#l118.41"></a><span id="l118.41" class="difflineminus">-  return aLine.replace(/\r?\n[ \t]/g, &quot;&quot;);</span>
<a href="#l118.42"></a><span id="l118.42" class="difflineplus">+    return aLine.replace(/\r?\n[ \t]/g, &quot;&quot;);</span>
<a href="#l118.43"></a><span id="l118.43"> }</span>
<a href="#l118.44"></a><span id="l118.44"> </span>
<a href="#l118.45"></a><span id="l118.45"> /**</span>
<a href="#l118.46"></a><span id="l118.46">  * Read a JSON file and return the JS object</span>
<a href="#l118.47"></a><span id="l118.47">  */</span>
<a href="#l118.48"></a><span id="l118.48"> function readJSONFile(aFile) {</span>
<a href="#l118.49"></a><span id="l118.49">     let stream = Cc[&quot;@mozilla.org/network/file-input-stream;1&quot;].createInstance(Ci.nsIFileInputStream);</span>
<a href="#l118.50"></a><span id="l118.50" class="difflineminus">-  try {</span>
<a href="#l118.51"></a><span id="l118.51" class="difflineminus">-      stream.init(aFile, FileUtils.MODE_RDONLY, FileUtils.PERMS_FILE, 0);</span>
<a href="#l118.52"></a><span id="l118.52" class="difflineminus">-      let json = Cc[&quot;@mozilla.org/dom/json;1&quot;].createInstance(Components.interfaces.nsIJSON);</span>
<a href="#l118.53"></a><span id="l118.53" class="difflineminus">-      let data = json.decodeFromStream(stream, stream.available());</span>
<a href="#l118.54"></a><span id="l118.54" class="difflineminus">-      return data;</span>
<a href="#l118.55"></a><span id="l118.55" class="difflineminus">-  } catch (ex) {</span>
<a href="#l118.56"></a><span id="l118.56" class="difflineminus">-      dump(&quot;readJSONFile: Error reading JSON file: &quot; + ex);</span>
<a href="#l118.57"></a><span id="l118.57" class="difflineminus">-  } finally {</span>
<a href="#l118.58"></a><span id="l118.58" class="difflineminus">-      stream.close();</span>
<a href="#l118.59"></a><span id="l118.59" class="difflineminus">-  }</span>
<a href="#l118.60"></a><span id="l118.60" class="difflineminus">-  return false;</span>
<a href="#l118.61"></a><span id="l118.61" class="difflineplus">+    try {</span>
<a href="#l118.62"></a><span id="l118.62" class="difflineplus">+        stream.init(aFile, FileUtils.MODE_RDONLY, FileUtils.PERMS_FILE, 0);</span>
<a href="#l118.63"></a><span id="l118.63" class="difflineplus">+        let json = Cc[&quot;@mozilla.org/dom/json;1&quot;].createInstance(Components.interfaces.nsIJSON);</span>
<a href="#l118.64"></a><span id="l118.64" class="difflineplus">+        let data = json.decodeFromStream(stream, stream.available());</span>
<a href="#l118.65"></a><span id="l118.65" class="difflineplus">+        return data;</span>
<a href="#l118.66"></a><span id="l118.66" class="difflineplus">+    } catch (ex) {</span>
<a href="#l118.67"></a><span id="l118.67" class="difflineplus">+        dump(&quot;readJSONFile: Error reading JSON file: &quot; + ex);</span>
<a href="#l118.68"></a><span id="l118.68" class="difflineplus">+    } finally {</span>
<a href="#l118.69"></a><span id="l118.69" class="difflineplus">+        stream.close();</span>
<a href="#l118.70"></a><span id="l118.70" class="difflineplus">+    }</span>
<a href="#l118.71"></a><span id="l118.71" class="difflineplus">+    return false;</span>
<a href="#l118.72"></a><span id="l118.72"> }</span>
<a href="#l118.73"></a><span id="l118.73"> </span>
<a href="#l118.74"></a><span id="l118.74"> function do_load_timezoneservice(callback) {</span>
<a href="#l118.75"></a><span id="l118.75">     do_test_pending();</span>
<a href="#l118.76"></a><span id="l118.76">     cal.getTimezoneService().startup({</span>
<a href="#l118.77"></a><span id="l118.77">         onResult: function() {</span>
<a href="#l118.78"></a><span id="l118.78">             do_test_finished();</span>
<a href="#l118.79"></a><span id="l118.79">             callback();</span>
<a href="#l118.80"></a><span id="l118.80" class="difflineat">@@ -227,21 +227,21 @@ function do_load_calmgr(callback) {</span>
<a href="#l118.81"></a><span id="l118.81">             do_test_finished();</span>
<a href="#l118.82"></a><span id="l118.82">             callback();</span>
<a href="#l118.83"></a><span id="l118.83">         }</span>
<a href="#l118.84"></a><span id="l118.84">     });</span>
<a href="#l118.85"></a><span id="l118.85"> }</span>
<a href="#l118.86"></a><span id="l118.86"> </span>
<a href="#l118.87"></a><span id="l118.87"> function do_calendar_startup(callback) {</span>
<a href="#l118.88"></a><span id="l118.88">     let obs = {</span>
<a href="#l118.89"></a><span id="l118.89" class="difflineminus">-      observe: function() {</span>
<a href="#l118.90"></a><span id="l118.90" class="difflineminus">-        Services.obs.removeObserver(this, &quot;calendar-startup-done&quot;);</span>
<a href="#l118.91"></a><span id="l118.91" class="difflineminus">-        do_test_finished();</span>
<a href="#l118.92"></a><span id="l118.92" class="difflineminus">-        do_execute_soon(callback);</span>
<a href="#l118.93"></a><span id="l118.93" class="difflineminus">-      }</span>
<a href="#l118.94"></a><span id="l118.94" class="difflineplus">+        observe: function() {</span>
<a href="#l118.95"></a><span id="l118.95" class="difflineplus">+            Services.obs.removeObserver(this, &quot;calendar-startup-done&quot;);</span>
<a href="#l118.96"></a><span id="l118.96" class="difflineplus">+            do_test_finished();</span>
<a href="#l118.97"></a><span id="l118.97" class="difflineplus">+            do_execute_soon(callback);</span>
<a href="#l118.98"></a><span id="l118.98" class="difflineplus">+        }</span>
<a href="#l118.99"></a><span id="l118.99">     };</span>
<a href="#l118.100"></a><span id="l118.100"> </span>
<a href="#l118.101"></a><span id="l118.101">     let startupService = Components.classes[&quot;@mozilla.org/calendar/startup-service;1&quot;]</span>
<a href="#l118.102"></a><span id="l118.102">                                    .getService(Components.interfaces.nsISupports).wrappedJSObject;</span>
<a href="#l118.103"></a><span id="l118.103"> </span>
<a href="#l118.104"></a><span id="l118.104">     if (startupService.started) {</span>
<a href="#l118.105"></a><span id="l118.105">         callback();</span>
<a href="#l118.106"></a><span id="l118.106">     } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l119.1"></a><span id="l119.1" class="difflineminus">--- a/calendar/test/unit/test_alarmservice.js</span>
<a href="#l119.2"></a><span id="l119.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmservice.js</span>
<a href="#l119.3"></a><span id="l119.3" class="difflineat">@@ -192,18 +192,22 @@ function addTestItems(aCalendar) {</span>
<a href="#l119.4"></a><span id="l119.4"> </span>
<a href="#l119.5"></a><span id="l119.5">     // alarm more than 6 hours in the future should not have a timer set</span>
<a href="#l119.6"></a><span id="l119.6">     [item, alarm] = createEventWithAlarm(aCalendar, date, date, &quot;PT7H&quot;);</span>
<a href="#l119.7"></a><span id="l119.7">     alarmObserver.expectResult(aCalendar, item, alarm, EXPECT_NONE);</span>
<a href="#l119.8"></a><span id="l119.8">     aCalendar.addItem(item, null);</span>
<a href="#l119.9"></a><span id="l119.9"> </span>
<a href="#l119.10"></a><span id="l119.10">     // test multiple alarms on an item</span>
<a href="#l119.11"></a><span id="l119.11">     [item, alarm] = createEventWithAlarm(aCalendar, date, date);</span>
<a href="#l119.12"></a><span id="l119.12" class="difflineminus">-    [[&quot;-PT1H&quot;, EXPECT_FIRED], [&quot;-PT15M&quot;, EXPECT_FIRED], [&quot;PT1H&quot;, EXPECT_TIMER],</span>
<a href="#l119.13"></a><span id="l119.13" class="difflineminus">-     [&quot;PT7H&quot;, EXPECT_NONE], [&quot;P7D&quot;, EXPECT_NONE]].forEach(([offset, expected]) =&gt; {</span>
<a href="#l119.14"></a><span id="l119.14" class="difflineplus">+    const firedOffsets = [</span>
<a href="#l119.15"></a><span id="l119.15" class="difflineplus">+        [&quot;-PT1H&quot;, EXPECT_FIRED], [&quot;-PT15M&quot;, EXPECT_FIRED], [&quot;PT1H&quot;, EXPECT_TIMER],</span>
<a href="#l119.16"></a><span id="l119.16" class="difflineplus">+        [&quot;PT7H&quot;, EXPECT_NONE], [&quot;P7D&quot;, EXPECT_NONE]</span>
<a href="#l119.17"></a><span id="l119.17" class="difflineplus">+    ];</span>
<a href="#l119.18"></a><span id="l119.18" class="difflineplus">+</span>
<a href="#l119.19"></a><span id="l119.19" class="difflineplus">+    firedOffsets.forEach(([offset, expected]) =&gt; {</span>
<a href="#l119.20"></a><span id="l119.20">         alarm = createAlarmFromDuration(offset);</span>
<a href="#l119.21"></a><span id="l119.21">         item.addAlarm(alarm);</span>
<a href="#l119.22"></a><span id="l119.22">         alarmObserver.expectResult(aCalendar, item, alarm, expected);</span>
<a href="#l119.23"></a><span id="l119.23">     });</span>
<a href="#l119.24"></a><span id="l119.24">     aCalendar.addItem(item, null);</span>
<a href="#l119.25"></a><span id="l119.25"> </span>
<a href="#l119.26"></a><span id="l119.26">     // daily repeating event starting almost 2 full days ago. The alarms on the first 2 occurrences</span>
<a href="#l119.27"></a><span id="l119.27">     // should fire, and a timer should be set for the next occurrence only</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l120.1"></a><span id="l120.1" class="difflineminus">--- a/calendar/test/unit/test_alarmutils.js</span>
<a href="#l120.2"></a><span id="l120.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmutils.js</span>
<a href="#l120.3"></a><span id="l120.3" class="difflineat">@@ -37,19 +37,19 @@ add_task(function* test_setDefaultValues</span>
<a href="#l120.4"></a><span id="l120.4">     equal(alarm.offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l120.5"></a><span id="l120.5"> </span>
<a href="#l120.6"></a><span id="l120.6">     Preferences.set(&quot;calendar.alarms.onforevents&quot;, 0);</span>
<a href="#l120.7"></a><span id="l120.7">     item = cal.createEvent();</span>
<a href="#l120.8"></a><span id="l120.8">     cal.alarms.setDefaultValues(item);</span>
<a href="#l120.9"></a><span id="l120.9">     equal(item.getAlarms({}).length, 0);</span>
<a href="#l120.10"></a><span id="l120.10"> </span>
<a href="#l120.11"></a><span id="l120.11">     let mockCalendar = {</span>
<a href="#l120.12"></a><span id="l120.12" class="difflineminus">-      getProperty: function() {</span>
<a href="#l120.13"></a><span id="l120.13" class="difflineminus">-        return [&quot;SHOUT&quot;];</span>
<a href="#l120.14"></a><span id="l120.14" class="difflineminus">-      }</span>
<a href="#l120.15"></a><span id="l120.15" class="difflineplus">+        getProperty: function() {</span>
<a href="#l120.16"></a><span id="l120.16" class="difflineplus">+            return [&quot;SHOUT&quot;];</span>
<a href="#l120.17"></a><span id="l120.17" class="difflineplus">+        }</span>
<a href="#l120.18"></a><span id="l120.18">     };</span>
<a href="#l120.19"></a><span id="l120.19"> </span>
<a href="#l120.20"></a><span id="l120.20">     Preferences.set(&quot;calendar.alarms.onforevents&quot;, 1);</span>
<a href="#l120.21"></a><span id="l120.21">     Preferences.set(&quot;calendar.alarms.eventalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l120.22"></a><span id="l120.22">     Preferences.set(&quot;calendar.alarms.eventalarmlen&quot;, 60);</span>
<a href="#l120.23"></a><span id="l120.23">     item = cal.createEvent();</span>
<a href="#l120.24"></a><span id="l120.24">     item.calendar = mockCalendar;</span>
<a href="#l120.25"></a><span id="l120.25">     cal.alarms.setDefaultValues(item);</span>
<a href="#l120.26"></a><span id="l120.26" class="difflineat">@@ -64,17 +64,17 @@ add_task(function* test_setDefaultValues</span>
<a href="#l120.27"></a><span id="l120.27">     Preferences.reset(&quot;calendar.alarms.eventalarmlen&quot;);</span>
<a href="#l120.28"></a><span id="l120.28"> });</span>
<a href="#l120.29"></a><span id="l120.29"> </span>
<a href="#l120.30"></a><span id="l120.30"> add_task(function* test_setDefaultValues_tasks() {</span>
<a href="#l120.31"></a><span id="l120.31">     let item, alarm;</span>
<a href="#l120.32"></a><span id="l120.32">     let calnow = cal.now;</span>
<a href="#l120.33"></a><span id="l120.33">     let nowDate = cal.createDateTime(&quot;20150815T120000&quot;);</span>
<a href="#l120.34"></a><span id="l120.34">     cal.now = function() {</span>
<a href="#l120.35"></a><span id="l120.35" class="difflineminus">-      return nowDate;</span>
<a href="#l120.36"></a><span id="l120.36" class="difflineplus">+        return nowDate;</span>
<a href="#l120.37"></a><span id="l120.37">     };</span>
<a href="#l120.38"></a><span id="l120.38"> </span>
<a href="#l120.39"></a><span id="l120.39">     Preferences.set(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l120.40"></a><span id="l120.40">     Preferences.set(&quot;calendar.alarms.todoalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l120.41"></a><span id="l120.41">     Preferences.set(&quot;calendar.alarms.todoalarmlen&quot;, 60);</span>
<a href="#l120.42"></a><span id="l120.42">     item = cal.createTodo();</span>
<a href="#l120.43"></a><span id="l120.43">     equal(item.entryDate, null);</span>
<a href="#l120.44"></a><span id="l120.44">     cal.alarms.setDefaultValues(item);</span>
<a href="#l120.45"></a><span id="l120.45" class="difflineat">@@ -97,19 +97,19 @@ add_task(function* test_setDefaultValues</span>
<a href="#l120.46"></a><span id="l120.46">     equal(alarm.offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l120.47"></a><span id="l120.47"> </span>
<a href="#l120.48"></a><span id="l120.48">     Preferences.set(&quot;calendar.alarms.onfortodos&quot;, 0);</span>
<a href="#l120.49"></a><span id="l120.49">     item = cal.createTodo();</span>
<a href="#l120.50"></a><span id="l120.50">     cal.alarms.setDefaultValues(item);</span>
<a href="#l120.51"></a><span id="l120.51">     equal(item.getAlarms({}).length, 0);</span>
<a href="#l120.52"></a><span id="l120.52"> </span>
<a href="#l120.53"></a><span id="l120.53">     let mockCalendar = {</span>
<a href="#l120.54"></a><span id="l120.54" class="difflineminus">-      getProperty: function() {</span>
<a href="#l120.55"></a><span id="l120.55" class="difflineminus">-        return [&quot;SHOUT&quot;];</span>
<a href="#l120.56"></a><span id="l120.56" class="difflineminus">-      }</span>
<a href="#l120.57"></a><span id="l120.57" class="difflineplus">+        getProperty: function() {</span>
<a href="#l120.58"></a><span id="l120.58" class="difflineplus">+            return [&quot;SHOUT&quot;];</span>
<a href="#l120.59"></a><span id="l120.59" class="difflineplus">+        }</span>
<a href="#l120.60"></a><span id="l120.60">     };</span>
<a href="#l120.61"></a><span id="l120.61"> </span>
<a href="#l120.62"></a><span id="l120.62">     Preferences.set(&quot;calendar.alarms.onfortodos&quot;, 1);</span>
<a href="#l120.63"></a><span id="l120.63">     Preferences.set(&quot;calendar.alarms.todoalarmunit&quot;, &quot;hours&quot;);</span>
<a href="#l120.64"></a><span id="l120.64">     Preferences.set(&quot;calendar.alarms.todoalarmlen&quot;, 60);</span>
<a href="#l120.65"></a><span id="l120.65">     item = cal.createTodo();</span>
<a href="#l120.66"></a><span id="l120.66">     item.calendar = mockCalendar;</span>
<a href="#l120.67"></a><span id="l120.67">     cal.alarms.setDefaultValues(item);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l121.1"></a><span id="l121.1" class="difflineminus">--- a/calendar/test/unit/test_attendee.js</span>
<a href="#l121.2"></a><span id="l121.2" class="difflineplus">+++ b/calendar/test/unit/test_attendee.js</span>
<a href="#l121.3"></a><span id="l121.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l121.4"></a><span id="l121.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l121.5"></a><span id="l121.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l121.6"></a><span id="l121.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l121.7"></a><span id="l121.7"> </span>
<a href="#l121.8"></a><span id="l121.8" class="difflineminus">- Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l121.9"></a><span id="l121.9" class="difflineplus">+Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l121.10"></a><span id="l121.10"> </span>
<a href="#l121.11"></a><span id="l121.11"> function run_test() {</span>
<a href="#l121.12"></a><span id="l121.12">     test_values();</span>
<a href="#l121.13"></a><span id="l121.13">     test_serialize();</span>
<a href="#l121.14"></a><span id="l121.14">     test_properties();</span>
<a href="#l121.15"></a><span id="l121.15">     test_doubleParameters(); // Bug 875739</span>
<a href="#l121.16"></a><span id="l121.16"> }</span>
<a href="#l121.17"></a><span id="l121.17"> </span>
<a href="#l121.18"></a><span id="l121.18" class="difflineat">@@ -30,17 +30,17 @@ function test_values() {</span>
<a href="#l121.19"></a><span id="l121.19">             ok(expectedAttendees.includes(allAttendees[i]));</span>
<a href="#l121.20"></a><span id="l121.20">         }</span>
<a href="#l121.21"></a><span id="l121.21">     }</span>
<a href="#l121.22"></a><span id="l121.22">     function findById(event, id, a) {</span>
<a href="#l121.23"></a><span id="l121.23">         let foundAttendee = event.getAttendeeById(id);</span>
<a href="#l121.24"></a><span id="l121.24">         equal(foundAttendee, a);</span>
<a href="#l121.25"></a><span id="l121.25">     }</span>
<a href="#l121.26"></a><span id="l121.26">     function testImmutability(a, properties) {</span>
<a href="#l121.27"></a><span id="l121.27" class="difflineminus">-         ok(!a.isMutable);</span>
<a href="#l121.28"></a><span id="l121.28" class="difflineplus">+        ok(!a.isMutable);</span>
<a href="#l121.29"></a><span id="l121.29">         // Check if setting a property throws. It should.</span>
<a href="#l121.30"></a><span id="l121.30">         for (let i = 0; i &lt; properties.length; i++) {</span>
<a href="#l121.31"></a><span id="l121.31">             let old = a[properties[i]];</span>
<a href="#l121.32"></a><span id="l121.32">             throws(() =&gt; {</span>
<a href="#l121.33"></a><span id="l121.33">                 a[properties[i]] = old + 1;</span>
<a href="#l121.34"></a><span id="l121.34">             }, /Can not modify immutable data container/);</span>
<a href="#l121.35"></a><span id="l121.35"> </span>
<a href="#l121.36"></a><span id="l121.36">             equal(a[properties[i]], old);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l122.1"></a><span id="l122.1" class="difflineminus">--- a/calendar/test/unit/test_bug350845.js</span>
<a href="#l122.2"></a><span id="l122.2" class="difflineplus">+++ b/calendar/test/unit/test_bug350845.js</span>
<a href="#l122.3"></a><span id="l122.3" class="difflineat">@@ -12,27 +12,27 @@ function run_test() {</span>
<a href="#l122.4"></a><span id="l122.4">     // Test getters for imported event</span>
<a href="#l122.5"></a><span id="l122.5">     equal(event.getProperty(&quot;X-FOO&quot;), &quot;QUUX&quot;);</span>
<a href="#l122.6"></a><span id="l122.6">     ok(event.hasProperty(&quot;X-FOO&quot;));</span>
<a href="#l122.7"></a><span id="l122.7">     equal(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;BAZ&quot;);</span>
<a href="#l122.8"></a><span id="l122.8">     ok(event.hasPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;));</span>
<a href="#l122.9"></a><span id="l122.9"> </span>
<a href="#l122.10"></a><span id="l122.10">     // Test setters</span>
<a href="#l122.11"></a><span id="l122.11">     throws(() =&gt; {</span>
<a href="#l122.12"></a><span id="l122.12" class="difflineminus">-      event.setPropertyParameter(&quot;X-UNKNOWN&quot;, &quot;UNKNOWN&quot;, &quot;VALUE&quot;);</span>
<a href="#l122.13"></a><span id="l122.13" class="difflineplus">+        event.setPropertyParameter(&quot;X-UNKNOWN&quot;, &quot;UNKNOWN&quot;, &quot;VALUE&quot;);</span>
<a href="#l122.14"></a><span id="l122.14">     }, /Property X-UNKNOWN not set/);</span>
<a href="#l122.15"></a><span id="l122.15"> </span>
<a href="#l122.16"></a><span id="l122.16">     // More setters</span>
<a href="#l122.17"></a><span id="l122.17">     event.setPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;, &quot;FNORD&quot;);</span>
<a href="#l122.18"></a><span id="l122.18">     equal(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;FNORD&quot;);</span>
<a href="#l122.19"></a><span id="l122.19">     notEqual(event.icalString.match(/^X-FOO;X-BAR=FNORD:QUUX$/m), null);</span>
<a href="#l122.20"></a><span id="l122.20"> </span>
<a href="#l122.21"></a><span id="l122.21">     // Enumerator</span>
<a href="#l122.22"></a><span id="l122.22">     throws(() =&gt; {</span>
<a href="#l122.23"></a><span id="l122.23" class="difflineminus">-      event.getParameterEnumerator(&quot;X-UNKNOWN&quot;);</span>
<a href="#l122.24"></a><span id="l122.24" class="difflineplus">+        event.getParameterEnumerator(&quot;X-UNKNOWN&quot;);</span>
<a href="#l122.25"></a><span id="l122.25">     }, /Property X-UNKNOWN not set/);</span>
<a href="#l122.26"></a><span id="l122.26"> </span>
<a href="#l122.27"></a><span id="l122.27">     // More enumerator</span>
<a href="#l122.28"></a><span id="l122.28">     let enume = event.getParameterEnumerator(&quot;X-FOO&quot;);</span>
<a href="#l122.29"></a><span id="l122.29">     ok(enume.hasMoreElements());</span>
<a href="#l122.30"></a><span id="l122.30">     let xbar = enume.getNext().QueryInterface(Components.interfaces.nsIProperty);</span>
<a href="#l122.31"></a><span id="l122.31">     equal(xbar.name, &quot;X-BAR&quot;);</span>
<a href="#l122.32"></a><span id="l122.32">     equal(xbar.value, &quot;FNORD&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l123.1"></a><span id="l123.1" class="difflineminus">--- a/calendar/test/unit/test_calmgr.js</span>
<a href="#l123.2"></a><span id="l123.2" class="difflineplus">+++ b/calendar/test/unit/test_calmgr.js</span>
<a href="#l123.3"></a><span id="l123.3" class="difflineat">@@ -35,27 +35,27 @@ add_test(function test_registration() {</span>
<a href="#l123.4"></a><span id="l123.4">     let memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-memory-calendar://&quot;, null, null));</span>
<a href="#l123.5"></a><span id="l123.5">     checkCalendarCount(0, 0, 0);</span>
<a href="#l123.6"></a><span id="l123.6"> </span>
<a href="#l123.7"></a><span id="l123.7">     // Register an observer to test it.</span>
<a href="#l123.8"></a><span id="l123.8">     let registered = false, unregistered = false, deleted = false, readOnly = false;</span>
<a href="#l123.9"></a><span id="l123.9">     let mgrobs = cal.createAdapter(Components.interfaces.calICalendarManagerObserver, {</span>
<a href="#l123.10"></a><span id="l123.10">         onCalendarRegistered: function(aCalendar) {</span>
<a href="#l123.11"></a><span id="l123.11">             if (aCalendar.id == memory.id) {</span>
<a href="#l123.12"></a><span id="l123.12" class="difflineminus">-              registered = true;</span>
<a href="#l123.13"></a><span id="l123.13" class="difflineplus">+                registered = true;</span>
<a href="#l123.14"></a><span id="l123.14">             }</span>
<a href="#l123.15"></a><span id="l123.15">         },</span>
<a href="#l123.16"></a><span id="l123.16">         onCalendarUnregistering: function(aCalendar) {</span>
<a href="#l123.17"></a><span id="l123.17">             if (aCalendar.id == memory.id) {</span>
<a href="#l123.18"></a><span id="l123.18" class="difflineminus">-              unregistered = true;</span>
<a href="#l123.19"></a><span id="l123.19" class="difflineplus">+                unregistered = true;</span>
<a href="#l123.20"></a><span id="l123.20">             }</span>
<a href="#l123.21"></a><span id="l123.21">         },</span>
<a href="#l123.22"></a><span id="l123.22">         onCalendarDeleting: function(aCalendar) {</span>
<a href="#l123.23"></a><span id="l123.23">             if (aCalendar.id == memory.id) {</span>
<a href="#l123.24"></a><span id="l123.24" class="difflineminus">-              deleted = true;</span>
<a href="#l123.25"></a><span id="l123.25" class="difflineplus">+                deleted = true;</span>
<a href="#l123.26"></a><span id="l123.26">             }</span>
<a href="#l123.27"></a><span id="l123.27">         }</span>
<a href="#l123.28"></a><span id="l123.28">     });</span>
<a href="#l123.29"></a><span id="l123.29">     let calobs = cal.createAdapter(Components.interfaces.calIObserver, {</span>
<a href="#l123.30"></a><span id="l123.30">         onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l123.31"></a><span id="l123.31">             equal(aCalendar.id, memory.id);</span>
<a href="#l123.32"></a><span id="l123.32">             equal(aName, &quot;readOnly&quot;);</span>
<a href="#l123.33"></a><span id="l123.33">             readOnly = aValue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l124.1"></a><span id="l124.1" class="difflineminus">--- a/calendar/test/unit/test_freebusy_service.js</span>
<a href="#l124.2"></a><span id="l124.2" class="difflineplus">+++ b/calendar/test/unit/test_freebusy_service.js</span>
<a href="#l124.3"></a><span id="l124.3" class="difflineat">@@ -22,17 +22,17 @@ function really_run_test() {</span>
<a href="#l124.4"></a><span id="l124.4"> function test_found() {</span>
<a href="#l124.5"></a><span id="l124.5">     _clearProviders();</span>
<a href="#l124.6"></a><span id="l124.6"> </span>
<a href="#l124.7"></a><span id="l124.7">     equal(_countProviders(), 0);</span>
<a href="#l124.8"></a><span id="l124.8"> </span>
<a href="#l124.9"></a><span id="l124.9">     let provider1 = {</span>
<a href="#l124.10"></a><span id="l124.10">         id: 1,</span>
<a href="#l124.11"></a><span id="l124.11">         getFreeBusyIntervals: function() {</span>
<a href="#l124.12"></a><span id="l124.12" class="difflineminus">-          aListener.onResult(null, []);</span>
<a href="#l124.13"></a><span id="l124.13" class="difflineplus">+            aListener.onResult(null, []);</span>
<a href="#l124.14"></a><span id="l124.14">         }</span>
<a href="#l124.15"></a><span id="l124.15">     };</span>
<a href="#l124.16"></a><span id="l124.16"> </span>
<a href="#l124.17"></a><span id="l124.17">     let provider2 = {</span>
<a href="#l124.18"></a><span id="l124.18">         id: 2,</span>
<a href="#l124.19"></a><span id="l124.19">         called: false,</span>
<a href="#l124.20"></a><span id="l124.20">         getFreeBusyIntervals: function(aCalId, aStart, aEnd, aTypes, aListener) {</span>
<a href="#l124.21"></a><span id="l124.21">             ok(!this.called);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l125.1"></a><span id="l125.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l125.2"></a><span id="l125.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l125.3"></a><span id="l125.3" class="difflineat">@@ -1,25 +1,25 @@</span>
<a href="#l125.4"></a><span id="l125.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l125.5"></a><span id="l125.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l125.6"></a><span id="l125.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l125.7"></a><span id="l125.7"> </span>
<a href="#l125.8"></a><span id="l125.8"> (function() {</span>
<a href="#l125.9"></a><span id="l125.9" class="difflineminus">-  Components.utils.import(&quot;resource:///modules/Services.jsm&quot;);</span>
<a href="#l125.10"></a><span id="l125.10" class="difflineminus">-  Services.prefs.setBoolPref(&quot;javascript.options.showInConsole&quot;, true);</span>
<a href="#l125.11"></a><span id="l125.11" class="difflineminus">-  Services.prefs.setBoolPref(&quot;browser.dom.window.dump.enabled&quot;, true);</span>
<a href="#l125.12"></a><span id="l125.12" class="difflineminus">-  Services.prefs.setBoolPref(&quot;calendar.debug.log&quot;, true);</span>
<a href="#l125.13"></a><span id="l125.13" class="difflineminus">-  Services.prefs.setBoolPref(&quot;calendar.debug.log.verbose&quot;, true);</span>
<a href="#l125.14"></a><span id="l125.14" class="difflineplus">+    Components.utils.import(&quot;resource:///modules/Services.jsm&quot;);</span>
<a href="#l125.15"></a><span id="l125.15" class="difflineplus">+    Services.prefs.setBoolPref(&quot;javascript.options.showInConsole&quot;, true);</span>
<a href="#l125.16"></a><span id="l125.16" class="difflineplus">+    Services.prefs.setBoolPref(&quot;browser.dom.window.dump.enabled&quot;, true);</span>
<a href="#l125.17"></a><span id="l125.17" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.debug.log&quot;, true);</span>
<a href="#l125.18"></a><span id="l125.18" class="difflineplus">+    Services.prefs.setBoolPref(&quot;calendar.debug.log.verbose&quot;, true);</span>
<a href="#l125.19"></a><span id="l125.19"> </span>
<a href="#l125.20"></a><span id="l125.20" class="difflineminus">-  let bindir = Services.dirsvc.get(&quot;CurProcD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l125.21"></a><span id="l125.21" class="difflineminus">-  bindir.append(&quot;extensions&quot;);</span>
<a href="#l125.22"></a><span id="l125.22" class="difflineminus">-  bindir.append(&quot;{a62ef8ec-5fdc-40c2-873c-223b8a6925cc}&quot;);</span>
<a href="#l125.23"></a><span id="l125.23" class="difflineminus">-  bindir.append(&quot;chrome.manifest&quot;);</span>
<a href="#l125.24"></a><span id="l125.24" class="difflineminus">-  dump(&quot;Loading&quot; + bindir.path + &quot;\n&quot;);</span>
<a href="#l125.25"></a><span id="l125.25" class="difflineminus">-  Components.manager.autoRegister(bindir);</span>
<a href="#l125.26"></a><span id="l125.26" class="difflineplus">+    let bindir = Services.dirsvc.get(&quot;CurProcD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l125.27"></a><span id="l125.27" class="difflineplus">+    bindir.append(&quot;extensions&quot;);</span>
<a href="#l125.28"></a><span id="l125.28" class="difflineplus">+    bindir.append(&quot;{a62ef8ec-5fdc-40c2-873c-223b8a6925cc}&quot;);</span>
<a href="#l125.29"></a><span id="l125.29" class="difflineplus">+    bindir.append(&quot;chrome.manifest&quot;);</span>
<a href="#l125.30"></a><span id="l125.30" class="difflineplus">+    dump(&quot;Loading&quot; + bindir.path + &quot;\n&quot;);</span>
<a href="#l125.31"></a><span id="l125.31" class="difflineplus">+    Components.manager.autoRegister(bindir);</span>
<a href="#l125.32"></a><span id="l125.32"> })();</span>
<a href="#l125.33"></a><span id="l125.33"> </span>
<a href="#l125.34"></a><span id="l125.34"> Components.utils.import(&quot;resource://testing-common/httpd.js&quot;);</span>
<a href="#l125.35"></a><span id="l125.35"> Components.utils.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l125.36"></a><span id="l125.36"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l125.37"></a><span id="l125.37"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l125.38"></a><span id="l125.38"> </span>
<a href="#l125.39"></a><span id="l125.39"> Components.utils.import(&quot;resource://gdata-provider/modules/gdataSession.jsm&quot;);</span>
<a href="#l125.40"></a><span id="l125.40" class="difflineat">@@ -127,25 +127,25 @@ GDataServer.prototype = {</span>
<a href="#l125.41"></a><span id="l125.41"> </span>
<a href="#l125.42"></a><span id="l125.42">         this.creator = {</span>
<a href="#l125.43"></a><span id="l125.43">             email: this.calendarId,</span>
<a href="#l125.44"></a><span id="l125.44">             self: true,</span>
<a href="#l125.45"></a><span id="l125.45">             displayName: &quot;Eggs P. Seashell&quot;</span>
<a href="#l125.46"></a><span id="l125.46">         };</span>
<a href="#l125.47"></a><span id="l125.47"> </span>
<a href="#l125.48"></a><span id="l125.48">         this.eventsData = {</span>
<a href="#l125.49"></a><span id="l125.49" class="difflineminus">-           kind: &quot;calendar#events&quot;,</span>
<a href="#l125.50"></a><span id="l125.50" class="difflineminus">-           etag: &quot;\&quot;1410880601360000\&quot;&quot;,</span>
<a href="#l125.51"></a><span id="l125.51" class="difflineminus">-           nextSyncToken: generateID(),</span>
<a href="#l125.52"></a><span id="l125.52" class="difflineminus">-           updated: &quot;2014-09-16T15:16:41.360Z&quot;,</span>
<a href="#l125.53"></a><span id="l125.53" class="difflineminus">-           accessRole: &quot;owner&quot;,</span>
<a href="#l125.54"></a><span id="l125.54" class="difflineminus">-           summary: &quot;xpcshell&quot;,</span>
<a href="#l125.55"></a><span id="l125.55" class="difflineminus">-           timeZone: &quot;Europe/Berlin&quot;,</span>
<a href="#l125.56"></a><span id="l125.56" class="difflineminus">-           defaultReminders: [],</span>
<a href="#l125.57"></a><span id="l125.57" class="difflineminus">-           items: []</span>
<a href="#l125.58"></a><span id="l125.58" class="difflineplus">+            kind: &quot;calendar#events&quot;,</span>
<a href="#l125.59"></a><span id="l125.59" class="difflineplus">+            etag: &quot;\&quot;1410880601360000\&quot;&quot;,</span>
<a href="#l125.60"></a><span id="l125.60" class="difflineplus">+            nextSyncToken: generateID(),</span>
<a href="#l125.61"></a><span id="l125.61" class="difflineplus">+            updated: &quot;2014-09-16T15:16:41.360Z&quot;,</span>
<a href="#l125.62"></a><span id="l125.62" class="difflineplus">+            accessRole: &quot;owner&quot;,</span>
<a href="#l125.63"></a><span id="l125.63" class="difflineplus">+            summary: &quot;xpcshell&quot;,</span>
<a href="#l125.64"></a><span id="l125.64" class="difflineplus">+            timeZone: &quot;Europe/Berlin&quot;,</span>
<a href="#l125.65"></a><span id="l125.65" class="difflineplus">+            defaultReminders: [],</span>
<a href="#l125.66"></a><span id="l125.66" class="difflineplus">+            items: []</span>
<a href="#l125.67"></a><span id="l125.67">         };</span>
<a href="#l125.68"></a><span id="l125.68"> </span>
<a href="#l125.69"></a><span id="l125.69">         this.tasksData = {</span>
<a href="#l125.70"></a><span id="l125.70">             kind: &quot;tasks#tasks&quot;,</span>
<a href="#l125.71"></a><span id="l125.71">             etag: &quot;\&quot;1410880601360000\&quot;&quot;,</span>
<a href="#l125.72"></a><span id="l125.72">             items: []</span>
<a href="#l125.73"></a><span id="l125.73">         };</span>
<a href="#l125.74"></a><span id="l125.74"> </span>
<a href="#l125.75"></a><span id="l125.75" class="difflineat">@@ -198,22 +198,22 @@ GDataServer.prototype = {</span>
<a href="#l125.76"></a><span id="l125.76">         let calmgr = cal.getCalendarManager();</span>
<a href="#l125.77"></a><span id="l125.77">         let client = calmgr.createCalendar(&quot;gdata&quot;, Services.io.newURI(uri, null, null));</span>
<a href="#l125.78"></a><span id="l125.78">         let uclient = client.wrappedJSObject;</span>
<a href="#l125.79"></a><span id="l125.79">         client.name = &quot;xpcshell&quot;;</span>
<a href="#l125.80"></a><span id="l125.80"> </span>
<a href="#l125.81"></a><span id="l125.81">         // Make sure we catch the last error message in case sync fails</span>
<a href="#l125.82"></a><span id="l125.82">         monkeyPatch(uclient, &quot;replayChangesOn&quot;, (protofunc, aListener) =&gt; {</span>
<a href="#l125.83"></a><span id="l125.83">             protofunc({</span>
<a href="#l125.84"></a><span id="l125.84" class="difflineminus">-              onResult: function(operation, detail) {</span>
<a href="#l125.85"></a><span id="l125.85" class="difflineminus">-                uclient._lastStatus = operation.status;</span>
<a href="#l125.86"></a><span id="l125.86" class="difflineminus">-                uclient._lastMessage = detail;</span>
<a href="#l125.87"></a><span id="l125.87" class="difflineminus">-                aListener.onResult(operation, detail);</span>
<a href="#l125.88"></a><span id="l125.88" class="difflineminus">-              }</span>
<a href="#l125.89"></a><span id="l125.89" class="difflineminus">-           });</span>
<a href="#l125.90"></a><span id="l125.90" class="difflineplus">+                onResult: function(operation, detail) {</span>
<a href="#l125.91"></a><span id="l125.91" class="difflineplus">+                    uclient._lastStatus = operation.status;</span>
<a href="#l125.92"></a><span id="l125.92" class="difflineplus">+                    uclient._lastMessage = detail;</span>
<a href="#l125.93"></a><span id="l125.93" class="difflineplus">+                    aListener.onResult(operation, detail);</span>
<a href="#l125.94"></a><span id="l125.94" class="difflineplus">+                }</span>
<a href="#l125.95"></a><span id="l125.95" class="difflineplus">+            });</span>
<a href="#l125.96"></a><span id="l125.96">         });</span>
<a href="#l125.97"></a><span id="l125.97"> </span>
<a href="#l125.98"></a><span id="l125.98">         calmgr.registerCalendar(client);</span>
<a href="#l125.99"></a><span id="l125.99">         uclient.mThrottleLimits = {};</span>
<a href="#l125.100"></a><span id="l125.100">         MockConflictPrompt.register();</span>
<a href="#l125.101"></a><span id="l125.101"> </span>
<a href="#l125.102"></a><span id="l125.102">         let cachedCalendar = calmgr.getCalendarById(client.id);</span>
<a href="#l125.103"></a><span id="l125.103">         return this.waitForLoad(cachedCalendar);</span>
<a href="#l125.104"></a><span id="l125.104" class="difflineat">@@ -269,24 +269,24 @@ GDataServer.prototype = {</span>
<a href="#l125.105"></a><span id="l125.105">                     return;</span>
<a href="#l125.106"></a><span id="l125.106">                 }</span>
<a href="#l125.107"></a><span id="l125.107">                 data.nextSyncToken = nextSyncToken;</span>
<a href="#l125.108"></a><span id="l125.108">                 data.items = sync.events;</span>
<a href="#l125.109"></a><span id="l125.109">             } else {</span>
<a href="#l125.110"></a><span id="l125.110">                 this.paginateRequest(parameters, this.events, data);</span>
<a href="#l125.111"></a><span id="l125.111">             }</span>
<a href="#l125.112"></a><span id="l125.112">             response.write(JSON.stringify(data));</span>
<a href="#l125.113"></a><span id="l125.113" class="difflineminus">-         } else if (method == &quot;POST&quot;) {</span>
<a href="#l125.114"></a><span id="l125.114" class="difflineplus">+        } else if (method == &quot;POST&quot;) {</span>
<a href="#l125.115"></a><span id="l125.115">             // Add an event</span>
<a href="#l125.116"></a><span id="l125.116">             let isImport = request.path.endsWith(&quot;/events/import&quot;);</span>
<a href="#l125.117"></a><span id="l125.117">             let data = this.processAddEvent(body, isImport);</span>
<a href="#l125.118"></a><span id="l125.118">             this.events.push(data);</span>
<a href="#l125.119"></a><span id="l125.119">             response.setStatusLine(null, 201, &quot;Created&quot;);</span>
<a href="#l125.120"></a><span id="l125.120">             response.write(JSON.stringify(data));</span>
<a href="#l125.121"></a><span id="l125.121" class="difflineminus">-         } else if ((method == &quot;PUT&quot; || method == &quot;PATCH&quot;) &amp;&amp; request.path.match(/\/events\/([a-z0-9_TZ]+)$/)) {</span>
<a href="#l125.122"></a><span id="l125.122" class="difflineplus">+        } else if ((method == &quot;PUT&quot; || method == &quot;PATCH&quot;) &amp;&amp; request.path.match(/\/events\/([a-z0-9_TZ]+)$/)) {</span>
<a href="#l125.123"></a><span id="l125.123">             // Modify an event</span>
<a href="#l125.124"></a><span id="l125.124">             let eventId = RegExp.$1;</span>
<a href="#l125.125"></a><span id="l125.125">             this.handleModify(request, response, body, this.events, eventId,</span>
<a href="#l125.126"></a><span id="l125.126">                               this.processModifyEvent.bind(this));</span>
<a href="#l125.127"></a><span id="l125.127">         } else if (method == &quot;DELETE&quot; &amp;&amp; request.path.match(/\/events\/([a-z0-9_TZ]+)$/)) {</span>
<a href="#l125.128"></a><span id="l125.128">             let eventId = RegExp.$1;</span>
<a href="#l125.129"></a><span id="l125.129">             this.handleDelete(request, response, this.events, eventId);</span>
<a href="#l125.130"></a><span id="l125.130">         }</span>
<a href="#l125.131"></a><span id="l125.131" class="difflineat">@@ -474,17 +474,17 @@ function findKey(container, key, searchK</span>
<a href="#l125.132"></a><span id="l125.132">     let foundItem = foundIndex == -1 ? null : container[foundIndex];</span>
<a href="#l125.133"></a><span id="l125.133">     return [foundIndex, foundItem];</span>
<a href="#l125.134"></a><span id="l125.134"> }</span>
<a href="#l125.135"></a><span id="l125.135"> </span>
<a href="#l125.136"></a><span id="l125.136"> function generateID() {</span>
<a href="#l125.137"></a><span id="l125.137">     let chars = &quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;;</span>
<a href="#l125.138"></a><span id="l125.138">     let str = &quot;&quot;;</span>
<a href="#l125.139"></a><span id="l125.139">     for (let i = 26; i; i--) {</span>
<a href="#l125.140"></a><span id="l125.140" class="difflineminus">-      str += chars[Math.floor(Math.random() * chars.length)];</span>
<a href="#l125.141"></a><span id="l125.141" class="difflineplus">+        str += chars[Math.floor(Math.random() * chars.length)];</span>
<a href="#l125.142"></a><span id="l125.142">     }</span>
<a href="#l125.143"></a><span id="l125.143">     return str;</span>
<a href="#l125.144"></a><span id="l125.144"> }</span>
<a href="#l125.145"></a><span id="l125.145"> </span>
<a href="#l125.146"></a><span id="l125.146"> function getAllMeta(calendar) {</span>
<a href="#l125.147"></a><span id="l125.147">     let keys = {}, values = {};</span>
<a href="#l125.148"></a><span id="l125.148">     calendar.getAllMetaData({}, keys, values);</span>
<a href="#l125.149"></a><span id="l125.149">     return new Map(keys.value.map((k, i) =&gt; [k, values.value[i]]));</span>
<a href="#l125.150"></a><span id="l125.150" class="difflineat">@@ -720,46 +720,46 @@ add_task(function* test_JSONToDate() {</span>
<a href="#l125.151"></a><span id="l125.151"> </span>
<a href="#l125.152"></a><span id="l125.152"> add_task(function* test_organizerCN() {</span>
<a href="#l125.153"></a><span id="l125.153">     gServer.events = [];</span>
<a href="#l125.154"></a><span id="l125.154">     let client = yield gServer.getClient();</span>
<a href="#l125.155"></a><span id="l125.155">     equal(client.getProperty(&quot;organizerCN&quot;), null);</span>
<a href="#l125.156"></a><span id="l125.156">     gServer.resetClient(client);</span>
<a href="#l125.157"></a><span id="l125.157"> </span>
<a href="#l125.158"></a><span id="l125.158">     gServer.events = [{</span>
<a href="#l125.159"></a><span id="l125.159" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.160"></a><span id="l125.160" class="difflineminus">-       etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.161"></a><span id="l125.161" class="difflineminus">-       id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.162"></a><span id="l125.162" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.163"></a><span id="l125.163" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.164"></a><span id="l125.164" class="difflineminus">-       summary: &quot;New Event&quot;,</span>
<a href="#l125.165"></a><span id="l125.165" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.166"></a><span id="l125.166" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.167"></a><span id="l125.167" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.168"></a><span id="l125.168" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.169"></a><span id="l125.169" class="difflineminus">-       iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.170"></a><span id="l125.170" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.171"></a><span id="l125.171" class="difflineplus">+        etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.172"></a><span id="l125.172" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.173"></a><span id="l125.173" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.174"></a><span id="l125.174" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.175"></a><span id="l125.175" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.176"></a><span id="l125.176" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.177"></a><span id="l125.177" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.178"></a><span id="l125.178" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.179"></a><span id="l125.179" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.180"></a><span id="l125.180" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.181"></a><span id="l125.181">     }];</span>
<a href="#l125.182"></a><span id="l125.182">     client = yield gServer.getClient();</span>
<a href="#l125.183"></a><span id="l125.183">     equal(client.getProperty(&quot;organizerCN&quot;), gServer.creator.displayName);</span>
<a href="#l125.184"></a><span id="l125.184">     gServer.resetClient(client);</span>
<a href="#l125.185"></a><span id="l125.185"> });</span>
<a href="#l125.186"></a><span id="l125.186"> </span>
<a href="#l125.187"></a><span id="l125.187"> add_task(function* test_always_readOnly() {</span>
<a href="#l125.188"></a><span id="l125.188">     gServer.events = [{</span>
<a href="#l125.189"></a><span id="l125.189" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.190"></a><span id="l125.190" class="difflineminus">-       etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.191"></a><span id="l125.191" class="difflineminus">-       id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.192"></a><span id="l125.192" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.193"></a><span id="l125.193" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.194"></a><span id="l125.194" class="difflineminus">-       summary: &quot;New Event&quot;,</span>
<a href="#l125.195"></a><span id="l125.195" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.196"></a><span id="l125.196" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.197"></a><span id="l125.197" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.198"></a><span id="l125.198" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.199"></a><span id="l125.199" class="difflineminus">-       iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.200"></a><span id="l125.200" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.201"></a><span id="l125.201" class="difflineplus">+        etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.202"></a><span id="l125.202" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.203"></a><span id="l125.203" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.204"></a><span id="l125.204" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.205"></a><span id="l125.205" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.206"></a><span id="l125.206" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.207"></a><span id="l125.207" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.208"></a><span id="l125.208" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.209"></a><span id="l125.209" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.210"></a><span id="l125.210" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.211"></a><span id="l125.211">     }];</span>
<a href="#l125.212"></a><span id="l125.212">     gServer.calendarListData.accessRole = &quot;freeBusyReader&quot;;</span>
<a href="#l125.213"></a><span id="l125.213">     let client = yield gServer.getClient();</span>
<a href="#l125.214"></a><span id="l125.214">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l125.215"></a><span id="l125.215">     ok(client.readOnly);</span>
<a href="#l125.216"></a><span id="l125.216">     client.readOnly = false;</span>
<a href="#l125.217"></a><span id="l125.217">     ok(client.readOnly);</span>
<a href="#l125.218"></a><span id="l125.218"> </span>
<a href="#l125.219"></a><span id="l125.219" class="difflineat">@@ -772,61 +772,59 @@ add_task(function* test_always_readOnly(</span>
<a href="#l125.220"></a><span id="l125.220">     client = yield gServer.getClient();</span>
<a href="#l125.221"></a><span id="l125.221">     ok(client.readOnly);</span>
<a href="#l125.222"></a><span id="l125.222">     client.readOnly = false;</span>
<a href="#l125.223"></a><span id="l125.223">     ok(client.readOnly);</span>
<a href="#l125.224"></a><span id="l125.224">     gServer.resetClient(client);</span>
<a href="#l125.225"></a><span id="l125.225"> });</span>
<a href="#l125.226"></a><span id="l125.226"> </span>
<a href="#l125.227"></a><span id="l125.227"> add_task(function* test_reset_sync() {</span>
<a href="#l125.228"></a><span id="l125.228" class="difflineminus">-    gServer.tasks = [</span>
<a href="#l125.229"></a><span id="l125.229" class="difflineminus">-       {</span>
<a href="#l125.230"></a><span id="l125.230" class="difflineplus">+    gServer.tasks = [{</span>
<a href="#l125.231"></a><span id="l125.231">         kind: &quot;tasks#task&quot;,</span>
<a href="#l125.232"></a><span id="l125.232">         id: &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;,</span>
<a href="#l125.233"></a><span id="l125.233">         etag: &quot;\&quot;Lck7VNWFJuXdzMtOmrYPx0KFV2s/LTIwNjA4MDcyNDM\&quot;&quot;,</span>
<a href="#l125.234"></a><span id="l125.234">         title: &quot;New Task&quot;,</span>
<a href="#l125.235"></a><span id="l125.235">         updated: &quot;2014-09-08T16:30:27.000Z&quot;,</span>
<a href="#l125.236"></a><span id="l125.236">         selfLink: gServer.baseUri + &quot;/tasks/v1/lists/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDow/tasks/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;,</span>
<a href="#l125.237"></a><span id="l125.237">         position: &quot;00000000000000130998&quot;,</span>
<a href="#l125.238"></a><span id="l125.238">         status: &quot;needsAction&quot;</span>
<a href="#l125.239"></a><span id="l125.239" class="difflineminus">-      }, {</span>
<a href="#l125.240"></a><span id="l125.240" class="difflineplus">+    }, {</span>
<a href="#l125.241"></a><span id="l125.241">         kind: &quot;tasks#task&quot;,</span>
<a href="#l125.242"></a><span id="l125.242">         id: &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo5OTU0Mjk2MzQ&quot;,</span>
<a href="#l125.243"></a><span id="l125.243">         etag: &quot;\&quot;Lck7VNWFJuXdzMtOmrYPx0KFV2s/LTQyNTY0MjUwOQ\&quot;&quot;,</span>
<a href="#l125.244"></a><span id="l125.244">         title: &quot;New Task 2&quot;,</span>
<a href="#l125.245"></a><span id="l125.245">         updated: &quot;2014-09-08T16:30:27.000Z&quot;,</span>
<a href="#l125.246"></a><span id="l125.246">         selfLink: gServer.baseUri + &quot;/tasks/v1/lists/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDow/tasks/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo5OTU0Mjk2MzQ&quot;,</span>
<a href="#l125.247"></a><span id="l125.247">         position: &quot;00000000000000130993&quot;,</span>
<a href="#l125.248"></a><span id="l125.248">         status: &quot;needsAction&quot;</span>
<a href="#l125.249"></a><span id="l125.249" class="difflineminus">-      }</span>
<a href="#l125.250"></a><span id="l125.250" class="difflineminus">-    ];</span>
<a href="#l125.251"></a><span id="l125.251" class="difflineplus">+    }];</span>
<a href="#l125.252"></a><span id="l125.252">     gServer.events = [{</span>
<a href="#l125.253"></a><span id="l125.253" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.254"></a><span id="l125.254" class="difflineminus">-       etag: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l125.255"></a><span id="l125.255" class="difflineminus">-       id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.256"></a><span id="l125.256" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.257"></a><span id="l125.257" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.258"></a><span id="l125.258" class="difflineminus">-       summary: &quot;New Event&quot;,</span>
<a href="#l125.259"></a><span id="l125.259" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.260"></a><span id="l125.260" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.261"></a><span id="l125.261" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.262"></a><span id="l125.262" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.263"></a><span id="l125.263" class="difflineminus">-       iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.264"></a><span id="l125.264" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.265"></a><span id="l125.265" class="difflineplus">+        etag: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l125.266"></a><span id="l125.266" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.267"></a><span id="l125.267" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.268"></a><span id="l125.268" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.269"></a><span id="l125.269" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.270"></a><span id="l125.270" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.271"></a><span id="l125.271" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.272"></a><span id="l125.272" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.273"></a><span id="l125.273" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.274"></a><span id="l125.274" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.275"></a><span id="l125.275">     }, {</span>
<a href="#l125.276"></a><span id="l125.276" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.277"></a><span id="l125.277" class="difflineminus">-       etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.278"></a><span id="l125.278" class="difflineminus">-       id: &quot;fepf8uf6n7n04w7feukucs9n8e&quot;,</span>
<a href="#l125.279"></a><span id="l125.279" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.280"></a><span id="l125.280" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.281"></a><span id="l125.281" class="difflineminus">-       summary: &quot;New Event 2&quot;,</span>
<a href="#l125.282"></a><span id="l125.282" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.283"></a><span id="l125.283" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.284"></a><span id="l125.284" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.285"></a><span id="l125.285" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.286"></a><span id="l125.286" class="difflineminus">-       iCalUID: &quot;fepf8uf6n7n04w7feukucs9n8e@google.com&quot;</span>
<a href="#l125.287"></a><span id="l125.287" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.288"></a><span id="l125.288" class="difflineplus">+        etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.289"></a><span id="l125.289" class="difflineplus">+        id: &quot;fepf8uf6n7n04w7feukucs9n8e&quot;,</span>
<a href="#l125.290"></a><span id="l125.290" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.291"></a><span id="l125.291" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.292"></a><span id="l125.292" class="difflineplus">+        summary: &quot;New Event 2&quot;,</span>
<a href="#l125.293"></a><span id="l125.293" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.294"></a><span id="l125.294" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.295"></a><span id="l125.295" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.296"></a><span id="l125.296" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.297"></a><span id="l125.297" class="difflineplus">+        iCalUID: &quot;fepf8uf6n7n04w7feukucs9n8e@google.com&quot;</span>
<a href="#l125.298"></a><span id="l125.298">     }];</span>
<a href="#l125.299"></a><span id="l125.299">     let client = yield gServer.getClient();</span>
<a href="#l125.300"></a><span id="l125.300">     let uncached = client.wrappedJSObject.mUncachedCalendar.wrappedJSObject;</span>
<a href="#l125.301"></a><span id="l125.301">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l125.302"></a><span id="l125.302"> </span>
<a href="#l125.303"></a><span id="l125.303">     let items = yield pclient.getAllItems();</span>
<a href="#l125.304"></a><span id="l125.304">     equal(items.length, 4);</span>
<a href="#l125.305"></a><span id="l125.305"> </span>
<a href="#l125.306"></a><span id="l125.306" class="difflineat">@@ -839,82 +837,78 @@ add_task(function* test_reset_sync() {</span>
<a href="#l125.307"></a><span id="l125.307"> </span>
<a href="#l125.308"></a><span id="l125.308">     equal(client.getProperty(&quot;syncToken.events&quot;), &quot;&quot;);</span>
<a href="#l125.309"></a><span id="l125.309">     equal(client.getProperty(&quot;lastUpdated.tasks&quot;), &quot;&quot;);</span>
<a href="#l125.310"></a><span id="l125.310"> </span>
<a href="#l125.311"></a><span id="l125.311">     gServer.resetClient(client);</span>
<a href="#l125.312"></a><span id="l125.312"> });</span>
<a href="#l125.313"></a><span id="l125.313"> </span>
<a href="#l125.314"></a><span id="l125.314"> add_task(function* test_basicItems() {</span>
<a href="#l125.315"></a><span id="l125.315" class="difflineminus">-    gServer.events = [</span>
<a href="#l125.316"></a><span id="l125.316" class="difflineminus">-      {</span>
<a href="#l125.317"></a><span id="l125.317" class="difflineminus">-         kind: &quot;calendar#event&quot;,</span>
<a href="#l125.318"></a><span id="l125.318" class="difflineminus">-         etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.319"></a><span id="l125.319" class="difflineminus">-         id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.320"></a><span id="l125.320" class="difflineminus">-         status: &quot;confirmed&quot;,</span>
<a href="#l125.321"></a><span id="l125.321" class="difflineminus">-         htmlLink: gServer.baseUri + &quot;/calendar/event?eid=eventhash&quot;,</span>
<a href="#l125.322"></a><span id="l125.322" class="difflineminus">-         created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.323"></a><span id="l125.323" class="difflineminus">-         updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.324"></a><span id="l125.324" class="difflineminus">-         summary: &quot;New Event&quot;,</span>
<a href="#l125.325"></a><span id="l125.325" class="difflineminus">-         description: &quot;description&quot;,</span>
<a href="#l125.326"></a><span id="l125.326" class="difflineminus">-         location: &quot;Hard Drive&quot;,</span>
<a href="#l125.327"></a><span id="l125.327" class="difflineminus">-         colorId: 17,</span>
<a href="#l125.328"></a><span id="l125.328" class="difflineminus">-         creator: gServer.creator,</span>
<a href="#l125.329"></a><span id="l125.329" class="difflineminus">-         organizer: gServer.creator,</span>
<a href="#l125.330"></a><span id="l125.330" class="difflineminus">-         start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.331"></a><span id="l125.331" class="difflineminus">-         end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.332"></a><span id="l125.332" class="difflineminus">-         transparency: &quot;transparent&quot;,</span>
<a href="#l125.333"></a><span id="l125.333" class="difflineminus">-         visibility: &quot;private&quot;,</span>
<a href="#l125.334"></a><span id="l125.334" class="difflineminus">-         iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;,</span>
<a href="#l125.335"></a><span id="l125.335" class="difflineminus">-         sequence: 1,</span>
<a href="#l125.336"></a><span id="l125.336" class="difflineminus">-         reminders: {</span>
<a href="#l125.337"></a><span id="l125.337" class="difflineplus">+    gServer.events = [{</span>
<a href="#l125.338"></a><span id="l125.338" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.339"></a><span id="l125.339" class="difflineplus">+        etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.340"></a><span id="l125.340" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.341"></a><span id="l125.341" class="difflineplus">+        status: &quot;confirmed&quot;,</span>
<a href="#l125.342"></a><span id="l125.342" class="difflineplus">+        htmlLink: gServer.baseUri + &quot;/calendar/event?eid=eventhash&quot;,</span>
<a href="#l125.343"></a><span id="l125.343" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.344"></a><span id="l125.344" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.345"></a><span id="l125.345" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.346"></a><span id="l125.346" class="difflineplus">+        description: &quot;description&quot;,</span>
<a href="#l125.347"></a><span id="l125.347" class="difflineplus">+        location: &quot;Hard Drive&quot;,</span>
<a href="#l125.348"></a><span id="l125.348" class="difflineplus">+        colorId: 17,</span>
<a href="#l125.349"></a><span id="l125.349" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.350"></a><span id="l125.350" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.351"></a><span id="l125.351" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.352"></a><span id="l125.352" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.353"></a><span id="l125.353" class="difflineplus">+        transparency: &quot;transparent&quot;,</span>
<a href="#l125.354"></a><span id="l125.354" class="difflineplus">+        visibility: &quot;private&quot;,</span>
<a href="#l125.355"></a><span id="l125.355" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;,</span>
<a href="#l125.356"></a><span id="l125.356" class="difflineplus">+        sequence: 1,</span>
<a href="#l125.357"></a><span id="l125.357" class="difflineplus">+        reminders: {</span>
<a href="#l125.358"></a><span id="l125.358">             useDefault: false,</span>
<a href="#l125.359"></a><span id="l125.359">             overrides: [{</span>
<a href="#l125.360"></a><span id="l125.360">                 method: &quot;email&quot;,</span>
<a href="#l125.361"></a><span id="l125.361">                 minutes: 20</span>
<a href="#l125.362"></a><span id="l125.362" class="difflineminus">-             }]</span>
<a href="#l125.363"></a><span id="l125.363" class="difflineminus">-         },</span>
<a href="#l125.364"></a><span id="l125.364" class="difflineminus">-         attendees: [{</span>
<a href="#l125.365"></a><span id="l125.365" class="difflineplus">+            }]</span>
<a href="#l125.366"></a><span id="l125.366" class="difflineplus">+        },</span>
<a href="#l125.367"></a><span id="l125.367" class="difflineplus">+        attendees: [{</span>
<a href="#l125.368"></a><span id="l125.368">             displayName: &quot;attendee name&quot;,</span>
<a href="#l125.369"></a><span id="l125.369">             email: &quot;attendee@example.com&quot;,</span>
<a href="#l125.370"></a><span id="l125.370">             optional: true,</span>
<a href="#l125.371"></a><span id="l125.371">             responseStatus: &quot;tentative&quot;</span>
<a href="#l125.372"></a><span id="l125.372">         }],</span>
<a href="#l125.373"></a><span id="l125.373"> </span>
<a href="#l125.374"></a><span id="l125.374">         extendedProperties: {</span>
<a href="#l125.375"></a><span id="l125.375" class="difflineminus">-          &quot;shared&quot;: { &quot;X-MOZ-CATEGORIES&quot;: &quot;foo,bar&quot; },</span>
<a href="#l125.376"></a><span id="l125.376" class="difflineminus">-          &quot;private&quot;: {</span>
<a href="#l125.377"></a><span id="l125.377" class="difflineminus">-            &quot;X-MOZ-LASTACK&quot;: &quot;2014-01-01T01:01:01Z&quot;,</span>
<a href="#l125.378"></a><span id="l125.378" class="difflineminus">-            &quot;X-MOZ-SNOOZE-TIME&quot;: &quot;2014-01-01T02:02:02Z&quot;</span>
<a href="#l125.379"></a><span id="l125.379" class="difflineminus">-          }</span>
<a href="#l125.380"></a><span id="l125.380" class="difflineplus">+            &quot;shared&quot;: { &quot;X-MOZ-CATEGORIES&quot;: &quot;foo,bar&quot; },</span>
<a href="#l125.381"></a><span id="l125.381" class="difflineplus">+            &quot;private&quot;: {</span>
<a href="#l125.382"></a><span id="l125.382" class="difflineplus">+                &quot;X-MOZ-LASTACK&quot;: &quot;2014-01-01T01:01:01Z&quot;,</span>
<a href="#l125.383"></a><span id="l125.383" class="difflineplus">+                &quot;X-MOZ-SNOOZE-TIME&quot;: &quot;2014-01-01T02:02:02Z&quot;</span>
<a href="#l125.384"></a><span id="l125.384" class="difflineplus">+            }</span>
<a href="#l125.385"></a><span id="l125.385">         }</span>
<a href="#l125.386"></a><span id="l125.386" class="difflineminus">-      }</span>
<a href="#l125.387"></a><span id="l125.387" class="difflineminus">-    ];</span>
<a href="#l125.388"></a><span id="l125.388" class="difflineplus">+    }];</span>
<a href="#l125.389"></a><span id="l125.389"> </span>
<a href="#l125.390"></a><span id="l125.390" class="difflineminus">-    gServer.tasks = [</span>
<a href="#l125.391"></a><span id="l125.391" class="difflineminus">-       {</span>
<a href="#l125.392"></a><span id="l125.392" class="difflineplus">+    gServer.tasks = [{</span>
<a href="#l125.393"></a><span id="l125.393">         kind: &quot;tasks#task&quot;,</span>
<a href="#l125.394"></a><span id="l125.394">         id: &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;,</span>
<a href="#l125.395"></a><span id="l125.395">         etag: &quot;\&quot;Lck7VNWFJuXdzMtOmrYPx0KFV2s/LTIwNjA4MDcyNDM\&quot;&quot;,</span>
<a href="#l125.396"></a><span id="l125.396">         title: &quot;New Task&quot;,</span>
<a href="#l125.397"></a><span id="l125.397">         updated: &quot;2014-09-08T16:30:27.000Z&quot;,</span>
<a href="#l125.398"></a><span id="l125.398">         selfLink: gServer.baseUri + &quot;/tasks/v1/lists/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDow/tasks/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;,</span>
<a href="#l125.399"></a><span id="l125.399">         position: &quot;00000000000000130998&quot;,</span>
<a href="#l125.400"></a><span id="l125.400">         status: &quot;completed&quot;,</span>
<a href="#l125.401"></a><span id="l125.401">         due: &quot;2014-09-04T00:00:00.000Z&quot;,</span>
<a href="#l125.402"></a><span id="l125.402">         completed: &quot;2014-09-01T17:00:00.000Z&quot;,</span>
<a href="#l125.403"></a><span id="l125.403">         notes: &quot;description&quot;,</span>
<a href="#l125.404"></a><span id="l125.404">         parent: &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo4MDIzOTU2NDc&quot;,</span>
<a href="#l125.405"></a><span id="l125.405">         links: [{</span>
<a href="#l125.406"></a><span id="l125.406" class="difflineminus">-          link: &quot;mailto:something@example.com&quot;,</span>
<a href="#l125.407"></a><span id="l125.407" class="difflineminus">-          description: &quot;link description&quot;,</span>
<a href="#l125.408"></a><span id="l125.408" class="difflineminus">-          type: &quot;email&quot;</span>
<a href="#l125.409"></a><span id="l125.409" class="difflineplus">+            link: &quot;mailto:something@example.com&quot;,</span>
<a href="#l125.410"></a><span id="l125.410" class="difflineplus">+            description: &quot;link description&quot;,</span>
<a href="#l125.411"></a><span id="l125.411" class="difflineplus">+            type: &quot;email&quot;</span>
<a href="#l125.412"></a><span id="l125.412">         }]</span>
<a href="#l125.413"></a><span id="l125.413" class="difflineminus">-      }</span>
<a href="#l125.414"></a><span id="l125.414" class="difflineminus">-    ];</span>
<a href="#l125.415"></a><span id="l125.415" class="difflineplus">+    }];</span>
<a href="#l125.416"></a><span id="l125.416"> </span>
<a href="#l125.417"></a><span id="l125.417">     let client = yield gServer.getClient();</span>
<a href="#l125.418"></a><span id="l125.418">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l125.419"></a><span id="l125.419"> </span>
<a href="#l125.420"></a><span id="l125.420">     let items = yield pclient.getAllItems();</span>
<a href="#l125.421"></a><span id="l125.421">     equal(items.length, 2);</span>
<a href="#l125.422"></a><span id="l125.422"> </span>
<a href="#l125.423"></a><span id="l125.423">     let event = cal.isEvent(items[0]) ? items[0] : items[1];</span>
<a href="#l125.424"></a><span id="l125.424" class="difflineat">@@ -1257,40 +1251,38 @@ add_task(function* test_modify_invitatio</span>
<a href="#l125.425"></a><span id="l125.425">         displayName: &quot;organizer name&quot;,</span>
<a href="#l125.426"></a><span id="l125.426">         email: &quot;organizer@example.com&quot;,</span>
<a href="#l125.427"></a><span id="l125.427">         organizer: true,</span>
<a href="#l125.428"></a><span id="l125.428">         responseStatus: &quot;tentative&quot;</span>
<a href="#l125.429"></a><span id="l125.429">     };</span>
<a href="#l125.430"></a><span id="l125.430">     let attendee = Object.assign({}, gServer.creator);</span>
<a href="#l125.431"></a><span id="l125.431">     attendee.responseStatus = &quot;needsAction&quot;;</span>
<a href="#l125.432"></a><span id="l125.432"> </span>
<a href="#l125.433"></a><span id="l125.433" class="difflineminus">-    gServer.events = [</span>
<a href="#l125.434"></a><span id="l125.434" class="difflineminus">-      {</span>
<a href="#l125.435"></a><span id="l125.435" class="difflineminus">-         kind: &quot;calendar#event&quot;,</span>
<a href="#l125.436"></a><span id="l125.436" class="difflineminus">-         etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.437"></a><span id="l125.437" class="difflineminus">-         id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.438"></a><span id="l125.438" class="difflineminus">-         status: &quot;confirmed&quot;,</span>
<a href="#l125.439"></a><span id="l125.439" class="difflineminus">-         htmlLink: gServer.baseUri + &quot;/calendar/event?eid=eventhash&quot;,</span>
<a href="#l125.440"></a><span id="l125.440" class="difflineminus">-         created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.441"></a><span id="l125.441" class="difflineminus">-         updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.442"></a><span id="l125.442" class="difflineminus">-         summary: &quot;New Event&quot;,</span>
<a href="#l125.443"></a><span id="l125.443" class="difflineminus">-         description: &quot;description&quot;,</span>
<a href="#l125.444"></a><span id="l125.444" class="difflineminus">-         location: &quot;Hard Drive&quot;,</span>
<a href="#l125.445"></a><span id="l125.445" class="difflineminus">-         colorId: 17,</span>
<a href="#l125.446"></a><span id="l125.446" class="difflineminus">-         creator: organizer,</span>
<a href="#l125.447"></a><span id="l125.447" class="difflineminus">-         organizer: organizer,</span>
<a href="#l125.448"></a><span id="l125.448" class="difflineminus">-         start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.449"></a><span id="l125.449" class="difflineminus">-         end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.450"></a><span id="l125.450" class="difflineminus">-         transparency: &quot;transparent&quot;,</span>
<a href="#l125.451"></a><span id="l125.451" class="difflineminus">-         visibility: &quot;private&quot;,</span>
<a href="#l125.452"></a><span id="l125.452" class="difflineminus">-         iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;,</span>
<a href="#l125.453"></a><span id="l125.453" class="difflineminus">-         sequence: 1,</span>
<a href="#l125.454"></a><span id="l125.454" class="difflineminus">-         attendees: [organizer, attendee],</span>
<a href="#l125.455"></a><span id="l125.455" class="difflineminus">-      }</span>
<a href="#l125.456"></a><span id="l125.456" class="difflineminus">-    ];</span>
<a href="#l125.457"></a><span id="l125.457" class="difflineplus">+    gServer.events = [{</span>
<a href="#l125.458"></a><span id="l125.458" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.459"></a><span id="l125.459" class="difflineplus">+        etag: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l125.460"></a><span id="l125.460" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.461"></a><span id="l125.461" class="difflineplus">+        status: &quot;confirmed&quot;,</span>
<a href="#l125.462"></a><span id="l125.462" class="difflineplus">+        htmlLink: gServer.baseUri + &quot;/calendar/event?eid=eventhash&quot;,</span>
<a href="#l125.463"></a><span id="l125.463" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.464"></a><span id="l125.464" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.465"></a><span id="l125.465" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.466"></a><span id="l125.466" class="difflineplus">+        description: &quot;description&quot;,</span>
<a href="#l125.467"></a><span id="l125.467" class="difflineplus">+        location: &quot;Hard Drive&quot;,</span>
<a href="#l125.468"></a><span id="l125.468" class="difflineplus">+        colorId: 17,</span>
<a href="#l125.469"></a><span id="l125.469" class="difflineplus">+        creator: organizer,</span>
<a href="#l125.470"></a><span id="l125.470" class="difflineplus">+        organizer: organizer,</span>
<a href="#l125.471"></a><span id="l125.471" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.472"></a><span id="l125.472" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.473"></a><span id="l125.473" class="difflineplus">+        transparency: &quot;transparent&quot;,</span>
<a href="#l125.474"></a><span id="l125.474" class="difflineplus">+        visibility: &quot;private&quot;,</span>
<a href="#l125.475"></a><span id="l125.475" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;,</span>
<a href="#l125.476"></a><span id="l125.476" class="difflineplus">+        sequence: 1,</span>
<a href="#l125.477"></a><span id="l125.477" class="difflineplus">+        attendees: [organizer, attendee],</span>
<a href="#l125.478"></a><span id="l125.478" class="difflineplus">+    }];</span>
<a href="#l125.479"></a><span id="l125.479"> </span>
<a href="#l125.480"></a><span id="l125.480">     // Case #1: User is attendee</span>
<a href="#l125.481"></a><span id="l125.481">     let client = yield gServer.getClient();</span>
<a href="#l125.482"></a><span id="l125.482">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l125.483"></a><span id="l125.483"> </span>
<a href="#l125.484"></a><span id="l125.484">     let items = yield pclient.getAllItems();</span>
<a href="#l125.485"></a><span id="l125.485">     equal(items.length, 1);</span>
<a href="#l125.486"></a><span id="l125.486"> </span>
<a href="#l125.487"></a><span id="l125.487" class="difflineat">@@ -1527,27 +1519,27 @@ add_task(function* test_metadata_recurri</span>
<a href="#l125.488"></a><span id="l125.488">     gServer.resetClient(client);</span>
<a href="#l125.489"></a><span id="l125.489"> });</span>
<a href="#l125.490"></a><span id="l125.490"> </span>
<a href="#l125.491"></a><span id="l125.491"> add_task(function* test_conflict_modify() {</span>
<a href="#l125.492"></a><span id="l125.492">     // TODO task/event conflicts are handled in the same way so I'm going to</span>
<a href="#l125.493"></a><span id="l125.493">     // skip adding tests for tasks here, but it probably wouldn't hurt to</span>
<a href="#l125.494"></a><span id="l125.494">     // create them at some point.</span>
<a href="#l125.495"></a><span id="l125.495">     gServer.events = [{</span>
<a href="#l125.496"></a><span id="l125.496" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.497"></a><span id="l125.497" class="difflineminus">-       etag: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l125.498"></a><span id="l125.498" class="difflineminus">-       id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.499"></a><span id="l125.499" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.500"></a><span id="l125.500" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.501"></a><span id="l125.501" class="difflineminus">-       summary: &quot;New Event&quot;,</span>
<a href="#l125.502"></a><span id="l125.502" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.503"></a><span id="l125.503" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.504"></a><span id="l125.504" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.505"></a><span id="l125.505" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.506"></a><span id="l125.506" class="difflineminus">-       iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.507"></a><span id="l125.507" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.508"></a><span id="l125.508" class="difflineplus">+        etag: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l125.509"></a><span id="l125.509" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.510"></a><span id="l125.510" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.511"></a><span id="l125.511" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.512"></a><span id="l125.512" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.513"></a><span id="l125.513" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.514"></a><span id="l125.514" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.515"></a><span id="l125.515" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.516"></a><span id="l125.516" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.517"></a><span id="l125.517" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.518"></a><span id="l125.518">     }];</span>
<a href="#l125.519"></a><span id="l125.519">     let client = yield gServer.getClient();</span>
<a href="#l125.520"></a><span id="l125.520">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l125.521"></a><span id="l125.521">     let item = (yield pclient.getAllItems())[0];</span>
<a href="#l125.522"></a><span id="l125.522"> </span>
<a href="#l125.523"></a><span id="l125.523">     // Case #1: Modified on server, modify locally, overwrite conflict</span>
<a href="#l125.524"></a><span id="l125.524">     MockConflictPrompt.overwrite = true;</span>
<a href="#l125.525"></a><span id="l125.525">     let newItem = item.clone();</span>
<a href="#l125.526"></a><span id="l125.526" class="difflineat">@@ -1615,27 +1607,27 @@ add_task(function* test_conflict_modify(</span>
<a href="#l125.527"></a><span id="l125.527">     gServer.resetClient(client);</span>
<a href="#l125.528"></a><span id="l125.528"> });</span>
<a href="#l125.529"></a><span id="l125.529"> </span>
<a href="#l125.530"></a><span id="l125.530"> add_task(function* test_conflict_delete() {</span>
<a href="#l125.531"></a><span id="l125.531">     // TODO task/event conflicts are handled in the same way so I'm going to</span>
<a href="#l125.532"></a><span id="l125.532">     // skip adding tests for tasks here, but it probably wouldn't hurt to</span>
<a href="#l125.533"></a><span id="l125.533">     // create them at some point.</span>
<a href="#l125.534"></a><span id="l125.534">     let coreEvent = {</span>
<a href="#l125.535"></a><span id="l125.535" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.536"></a><span id="l125.536" class="difflineminus">-       etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.537"></a><span id="l125.537" class="difflineminus">-       id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.538"></a><span id="l125.538" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.539"></a><span id="l125.539" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.540"></a><span id="l125.540" class="difflineminus">-       summary: &quot;New Event&quot;,</span>
<a href="#l125.541"></a><span id="l125.541" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.542"></a><span id="l125.542" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.543"></a><span id="l125.543" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.544"></a><span id="l125.544" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.545"></a><span id="l125.545" class="difflineminus">-       iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.546"></a><span id="l125.546" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.547"></a><span id="l125.547" class="difflineplus">+        etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.548"></a><span id="l125.548" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.549"></a><span id="l125.549" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.550"></a><span id="l125.550" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.551"></a><span id="l125.551" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.552"></a><span id="l125.552" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.553"></a><span id="l125.553" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.554"></a><span id="l125.554" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.555"></a><span id="l125.555" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.556"></a><span id="l125.556" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.557"></a><span id="l125.557">     };</span>
<a href="#l125.558"></a><span id="l125.558"> </span>
<a href="#l125.559"></a><span id="l125.559">     // Load intial event to server</span>
<a href="#l125.560"></a><span id="l125.560">     gServer.events = [coreEvent];</span>
<a href="#l125.561"></a><span id="l125.561">     let client = yield gServer.getClient();</span>
<a href="#l125.562"></a><span id="l125.562">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l125.563"></a><span id="l125.563">     let item = (yield pclient.getAllItems())[0];</span>
<a href="#l125.564"></a><span id="l125.564"> </span>
<a href="#l125.565"></a><span id="l125.565" class="difflineat">@@ -1721,28 +1713,28 @@ add_task(function* test_conflict_delete(</span>
<a href="#l125.566"></a><span id="l125.566"> add_task(function* test_default_alarms() {</span>
<a href="#l125.567"></a><span id="l125.567">     let defaultReminders = [</span>
<a href="#l125.568"></a><span id="l125.568">         { method: &quot;popup&quot;, minutes: 10 },</span>
<a href="#l125.569"></a><span id="l125.569">         { method: &quot;email&quot;, minutes: 20 },</span>
<a href="#l125.570"></a><span id="l125.570">     ];</span>
<a href="#l125.571"></a><span id="l125.571">     gServer.calendarListData.defaultReminders = defaultReminders;</span>
<a href="#l125.572"></a><span id="l125.572">     gServer.eventsData.defaultReminders = defaultReminders;</span>
<a href="#l125.573"></a><span id="l125.573">     gServer.events = [{</span>
<a href="#l125.574"></a><span id="l125.574" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.575"></a><span id="l125.575" class="difflineminus">-       etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.576"></a><span id="l125.576" class="difflineminus">-       id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.577"></a><span id="l125.577" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.578"></a><span id="l125.578" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.579"></a><span id="l125.579" class="difflineminus">-       summary: &quot;Default Reminder&quot;,</span>
<a href="#l125.580"></a><span id="l125.580" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.581"></a><span id="l125.581" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.582"></a><span id="l125.582" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.583"></a><span id="l125.583" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.584"></a><span id="l125.584" class="difflineminus">-       iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;,</span>
<a href="#l125.585"></a><span id="l125.585" class="difflineminus">-       reminders: { useDefault: true }</span>
<a href="#l125.586"></a><span id="l125.586" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.587"></a><span id="l125.587" class="difflineplus">+        etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.588"></a><span id="l125.588" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.589"></a><span id="l125.589" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.590"></a><span id="l125.590" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.591"></a><span id="l125.591" class="difflineplus">+        summary: &quot;Default Reminder&quot;,</span>
<a href="#l125.592"></a><span id="l125.592" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.593"></a><span id="l125.593" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.594"></a><span id="l125.594" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.595"></a><span id="l125.595" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.596"></a><span id="l125.596" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;,</span>
<a href="#l125.597"></a><span id="l125.597" class="difflineplus">+        reminders: { useDefault: true }</span>
<a href="#l125.598"></a><span id="l125.598">     }];</span>
<a href="#l125.599"></a><span id="l125.599"> </span>
<a href="#l125.600"></a><span id="l125.600">     // Case #1: read default alarms from event stream</span>
<a href="#l125.601"></a><span id="l125.601">     let client = yield gServer.getClient();</span>
<a href="#l125.602"></a><span id="l125.602">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l125.603"></a><span id="l125.603">     equal(client.getProperty(&quot;settings.defaultReminders&quot;), JSON.stringify(defaultReminders));</span>
<a href="#l125.604"></a><span id="l125.604"> </span>
<a href="#l125.605"></a><span id="l125.605">     let item = (yield pclient.getAllItems())[0];</span>
<a href="#l125.606"></a><span id="l125.606" class="difflineat">@@ -1831,62 +1823,60 @@ add_task(function* test_default_alarms()</span>
<a href="#l125.607"></a><span id="l125.607">     item = (yield pclient.getAllItems())[0];</span>
<a href="#l125.608"></a><span id="l125.608">     equal(item.getProperty(&quot;X-DEFAULT-ALARM&quot;), &quot;TRUE&quot;);</span>
<a href="#l125.609"></a><span id="l125.609"> </span>
<a href="#l125.610"></a><span id="l125.610">     gServer.resetClient(client);</span>
<a href="#l125.611"></a><span id="l125.611"> });</span>
<a href="#l125.612"></a><span id="l125.612"> </span>
<a href="#l125.613"></a><span id="l125.613"> add_task(function* test_paginate() {</span>
<a href="#l125.614"></a><span id="l125.614">     gServer.events = [{</span>
<a href="#l125.615"></a><span id="l125.615" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.616"></a><span id="l125.616" class="difflineminus">-       etag: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l125.617"></a><span id="l125.617" class="difflineminus">-       id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.618"></a><span id="l125.618" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.619"></a><span id="l125.619" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.620"></a><span id="l125.620" class="difflineminus">-       summary: &quot;New Event&quot;,</span>
<a href="#l125.621"></a><span id="l125.621" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.622"></a><span id="l125.622" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.623"></a><span id="l125.623" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.624"></a><span id="l125.624" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.625"></a><span id="l125.625" class="difflineminus">-       iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.626"></a><span id="l125.626" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.627"></a><span id="l125.627" class="difflineplus">+        etag: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l125.628"></a><span id="l125.628" class="difflineplus">+        id: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l125.629"></a><span id="l125.629" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.630"></a><span id="l125.630" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.631"></a><span id="l125.631" class="difflineplus">+        summary: &quot;New Event&quot;,</span>
<a href="#l125.632"></a><span id="l125.632" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.633"></a><span id="l125.633" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.634"></a><span id="l125.634" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.635"></a><span id="l125.635" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.636"></a><span id="l125.636" class="difflineplus">+        iCalUID: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l125.637"></a><span id="l125.637">     }, {</span>
<a href="#l125.638"></a><span id="l125.638" class="difflineminus">-       kind: &quot;calendar#event&quot;,</span>
<a href="#l125.639"></a><span id="l125.639" class="difflineminus">-       etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.640"></a><span id="l125.640" class="difflineminus">-       id: &quot;fepf8uf6n7n04w7feukucs9n8e&quot;,</span>
<a href="#l125.641"></a><span id="l125.641" class="difflineminus">-       created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.642"></a><span id="l125.642" class="difflineminus">-       updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.643"></a><span id="l125.643" class="difflineminus">-       summary: &quot;New Event 2&quot;,</span>
<a href="#l125.644"></a><span id="l125.644" class="difflineminus">-       creator: gServer.creator,</span>
<a href="#l125.645"></a><span id="l125.645" class="difflineminus">-       organizer: gServer.creator,</span>
<a href="#l125.646"></a><span id="l125.646" class="difflineminus">-       start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.647"></a><span id="l125.647" class="difflineminus">-       end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.648"></a><span id="l125.648" class="difflineminus">-       iCalUID: &quot;fepf8uf6n7n04w7feukucs9n8e@google.com&quot;</span>
<a href="#l125.649"></a><span id="l125.649" class="difflineplus">+        kind: &quot;calendar#event&quot;,</span>
<a href="#l125.650"></a><span id="l125.650" class="difflineplus">+        etag: &quot;\&quot;2\&quot;&quot;,</span>
<a href="#l125.651"></a><span id="l125.651" class="difflineplus">+        id: &quot;fepf8uf6n7n04w7feukucs9n8e&quot;,</span>
<a href="#l125.652"></a><span id="l125.652" class="difflineplus">+        created: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l125.653"></a><span id="l125.653" class="difflineplus">+        updated: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l125.654"></a><span id="l125.654" class="difflineplus">+        summary: &quot;New Event 2&quot;,</span>
<a href="#l125.655"></a><span id="l125.655" class="difflineplus">+        creator: gServer.creator,</span>
<a href="#l125.656"></a><span id="l125.656" class="difflineplus">+        organizer: gServer.creator,</span>
<a href="#l125.657"></a><span id="l125.657" class="difflineplus">+        start: { dateTime: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l125.658"></a><span id="l125.658" class="difflineplus">+        end: { dateTime: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l125.659"></a><span id="l125.659" class="difflineplus">+        iCalUID: &quot;fepf8uf6n7n04w7feukucs9n8e@google.com&quot;</span>
<a href="#l125.660"></a><span id="l125.660">     }];</span>
<a href="#l125.661"></a><span id="l125.661"> </span>
<a href="#l125.662"></a><span id="l125.662" class="difflineminus">-    gServer.tasks = [</span>
<a href="#l125.663"></a><span id="l125.663" class="difflineminus">-       {</span>
<a href="#l125.664"></a><span id="l125.664" class="difflineplus">+    gServer.tasks = [{</span>
<a href="#l125.665"></a><span id="l125.665">         kind: &quot;tasks#task&quot;,</span>
<a href="#l125.666"></a><span id="l125.666">         id: &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;,</span>
<a href="#l125.667"></a><span id="l125.667">         etag: &quot;\&quot;Lck7VNWFJuXdzMtOmrYPx0KFV2s/LTIwNjA4MDcyNDM\&quot;&quot;,</span>
<a href="#l125.668"></a><span id="l125.668">         title: &quot;New Task&quot;,</span>
<a href="#l125.669"></a><span id="l125.669">         updated: &quot;2014-09-08T16:30:27.000Z&quot;,</span>
<a href="#l125.670"></a><span id="l125.670">         selfLink: gServer.baseUri + &quot;/tasks/v1/lists/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDow/tasks/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;,</span>
<a href="#l125.671"></a><span id="l125.671">         position: &quot;00000000000000130998&quot;,</span>
<a href="#l125.672"></a><span id="l125.672">         status: &quot;needsAction&quot;</span>
<a href="#l125.673"></a><span id="l125.673" class="difflineminus">-      }, {</span>
<a href="#l125.674"></a><span id="l125.674" class="difflineplus">+    }, {</span>
<a href="#l125.675"></a><span id="l125.675">         kind: &quot;tasks#task&quot;,</span>
<a href="#l125.676"></a><span id="l125.676">         id: &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo5OTU0Mjk2MzQ&quot;,</span>
<a href="#l125.677"></a><span id="l125.677">         etag: &quot;\&quot;Lck7VNWFJuXdzMtOmrYPx0KFV2s/LTQyNTY0MjUwOQ\&quot;&quot;,</span>
<a href="#l125.678"></a><span id="l125.678">         title: &quot;New Task 2&quot;,</span>
<a href="#l125.679"></a><span id="l125.679">         updated: &quot;2014-09-08T16:30:27.000Z&quot;,</span>
<a href="#l125.680"></a><span id="l125.680">         selfLink: gServer.baseUri + &quot;/tasks/v1/lists/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDow/tasks/MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo5OTU0Mjk2MzQ&quot;,</span>
<a href="#l125.681"></a><span id="l125.681">         position: &quot;00000000000000130993&quot;,</span>
<a href="#l125.682"></a><span id="l125.682">         status: &quot;needsAction&quot;</span>
<a href="#l125.683"></a><span id="l125.683" class="difflineminus">-      }</span>
<a href="#l125.684"></a><span id="l125.684" class="difflineminus">-    ];</span>
<a href="#l125.685"></a><span id="l125.685" class="difflineplus">+    }];</span>
<a href="#l125.686"></a><span id="l125.686"> </span>
<a href="#l125.687"></a><span id="l125.687">     Preferences.set(&quot;calendar.google.maxResultsPerRequest&quot;, 1);</span>
<a href="#l125.688"></a><span id="l125.688"> </span>
<a href="#l125.689"></a><span id="l125.689">     let client = yield gServer.getClient();</span>
<a href="#l125.690"></a><span id="l125.690">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l125.691"></a><span id="l125.691"> </span>
<a href="#l125.692"></a><span id="l125.692">     // Make sure all pages were requested</span>
<a href="#l125.693"></a><span id="l125.693">     equal(gServer.eventsData.nextPageToken, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l126.1"></a><span id="l126.1" class="difflineminus">--- a/calendar/test/unit/test_ics.js</span>
<a href="#l126.2"></a><span id="l126.2" class="difflineplus">+++ b/calendar/test/unit/test_ics.js</span>
<a href="#l126.3"></a><span id="l126.3" class="difflineat">@@ -5,106 +5,103 @@</span>
<a href="#l126.4"></a><span id="l126.4"> function run_test() {</span>
<a href="#l126.5"></a><span id="l126.5">     test_folding();</span>
<a href="#l126.6"></a><span id="l126.6">     test_icalProps();</span>
<a href="#l126.7"></a><span id="l126.7">     test_roundtrip();</span>
<a href="#l126.8"></a><span id="l126.8">     test_duration();</span>
<a href="#l126.9"></a><span id="l126.9">     test_serialize();</span>
<a href="#l126.10"></a><span id="l126.10"> }</span>
<a href="#l126.11"></a><span id="l126.11"> </span>
<a href="#l126.12"></a><span id="l126.12" class="difflineminus">-var test_data = [</span>
<a href="#l126.13"></a><span id="l126.13" class="difflineminus">-    {</span>
<a href="#l126.14"></a><span id="l126.14" class="difflineminus">-      expectedDateProps: {</span>
<a href="#l126.15"></a><span id="l126.15" class="difflineminus">-          month: 10,</span>
<a href="#l126.16"></a><span id="l126.16" class="difflineminus">-          day: 25,</span>
<a href="#l126.17"></a><span id="l126.17" class="difflineminus">-          year: 2004,</span>
<a href="#l126.18"></a><span id="l126.18" class="difflineminus">-          isDate: true</span>
<a href="#l126.19"></a><span id="l126.19" class="difflineminus">-      },</span>
<a href="#l126.20"></a><span id="l126.20" class="difflineminus">-      expectedProps: {</span>
<a href="#l126.21"></a><span id="l126.21" class="difflineminus">-          title: &quot;Christmas&quot;,</span>
<a href="#l126.22"></a><span id="l126.22" class="difflineminus">-          id: &quot;20041119T052239Z-1000472-1-5c0746bb-Oracle&quot;,</span>
<a href="#l126.23"></a><span id="l126.23" class="difflineminus">-          priority: 0,</span>
<a href="#l126.24"></a><span id="l126.24" class="difflineminus">-          status: &quot;CONFIRMED&quot;</span>
<a href="#l126.25"></a><span id="l126.25" class="difflineminus">-      },</span>
<a href="#l126.26"></a><span id="l126.26" class="difflineminus">-      ics: &quot;BEGIN:VCALENDAR\n&quot; +</span>
<a href="#l126.27"></a><span id="l126.27" class="difflineminus">-        &quot;PRODID:-//ORACLE//NONSGML CSDK 9.0.5 - CalDAVServlet 9.0.5//EN\n&quot; +</span>
<a href="#l126.28"></a><span id="l126.28" class="difflineminus">-        &quot;VERSION:2.0\n&quot; +</span>
<a href="#l126.29"></a><span id="l126.29" class="difflineminus">-        &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l126.30"></a><span id="l126.30" class="difflineminus">-        &quot;UID:20041119T052239Z-1000472-1-5c0746bb-Oracle\n&quot; +</span>
<a href="#l126.31"></a><span id="l126.31" class="difflineminus">-        &quot;ORGANIZER;X-ORACLE-GUID=E9359406791C763EE0305794071A39A4;CN=Simon Vaillan\n&quot; +</span>
<a href="#l126.32"></a><span id="l126.32" class="difflineminus">-        &quot; court:mailto:simon.vaillancourt@oracle.com\n&quot; +</span>
<a href="#l126.33"></a><span id="l126.33" class="difflineminus">-        &quot;SEQUENCE:0\n&quot; +</span>
<a href="#l126.34"></a><span id="l126.34" class="difflineminus">-        &quot;DTSTAMP:20041124T010028Z\n&quot; +</span>
<a href="#l126.35"></a><span id="l126.35" class="difflineminus">-        &quot;CREATED:20041119T052239Z\n&quot; +</span>
<a href="#l126.36"></a><span id="l126.36" class="difflineminus">-        &quot;X-ORACLE-EVENTINSTANCE-GUID:I1+16778354+1+1+438153759\n&quot; +</span>
<a href="#l126.37"></a><span id="l126.37" class="difflineminus">-        &quot;X-ORACLE-EVENT-GUID:E1+16778354+1+438153759\n&quot; +</span>
<a href="#l126.38"></a><span id="l126.38" class="difflineminus">-        &quot;X-ORACLE-EVENTTYPE:DAY EVENT\n&quot; +</span>
<a href="#l126.39"></a><span id="l126.39" class="difflineminus">-        &quot;TRANSP:TRANSPARENT\n&quot; +</span>
<a href="#l126.40"></a><span id="l126.40" class="difflineminus">-        &quot;SUMMARY:Christmas\n&quot; +</span>
<a href="#l126.41"></a><span id="l126.41" class="difflineminus">-        &quot;STATUS:CONFIRMED\n&quot; +</span>
<a href="#l126.42"></a><span id="l126.42" class="difflineminus">-        &quot;PRIORITY:0\n&quot; +</span>
<a href="#l126.43"></a><span id="l126.43" class="difflineminus">-        &quot;DTSTART;VALUE=DATE:20041125\n&quot; +</span>
<a href="#l126.44"></a><span id="l126.44" class="difflineminus">-        &quot;DTEND;VALUE=DATE:20041125\n&quot; +</span>
<a href="#l126.45"></a><span id="l126.45" class="difflineminus">-        &quot;CLASS:PUBLIC\n&quot; +</span>
<a href="#l126.46"></a><span id="l126.46" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E92F51FB4A48E91CE0305794071A149C;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.47"></a><span id="l126.47" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=James Stevens;PARTSTAT=NEEDS-ACTION:mailto:james.stevens@o\n&quot; +</span>
<a href="#l126.48"></a><span id="l126.48" class="difflineminus">-        &quot; racle.com\n&quot; +</span>
<a href="#l126.49"></a><span id="l126.49" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E9359406791C763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.50"></a><span id="l126.50" class="difflineminus">-        &quot; ;RSVP=FALSE;CN=Simon Vaillancourt;PARTSTAT=ACCEPTED:mailto:simon.vaillan\n&quot; +</span>
<a href="#l126.51"></a><span id="l126.51" class="difflineminus">-        &quot; court@oracle.com\n&quot; +</span>
<a href="#l126.52"></a><span id="l126.52" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E9359406791D763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.53"></a><span id="l126.53" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Bernard Desruisseaux;PARTSTAT=NEEDS-ACTION:mailto:bernard.\n&quot; +</span>
<a href="#l126.54"></a><span id="l126.54" class="difflineminus">-        &quot; desruisseaux@oracle.com\n&quot; +</span>
<a href="#l126.55"></a><span id="l126.55" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E9359406791E763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.56"></a><span id="l126.56" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Mario Bonin;PARTSTAT=NEEDS-ACTION:mailto:mario.bonin@oracl\n&quot; +</span>
<a href="#l126.57"></a><span id="l126.57" class="difflineminus">-        &quot; e.com\n&quot; +</span>
<a href="#l126.58"></a><span id="l126.58" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E9359406791F763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.59"></a><span id="l126.59" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Jeremy Chone;PARTSTAT=NEEDS-ACTION:mailto:jeremy.chone@ora\n&quot; +</span>
<a href="#l126.60"></a><span id="l126.60" class="difflineminus">-        &quot; cle.com\n&quot; +</span>
<a href="#l126.61"></a><span id="l126.61" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-PERSONAL-COMMENT-ISDIRTY=TRUE;X-ORACLE-GUID=E9359406792\n&quot; +</span>
<a href="#l126.62"></a><span id="l126.62" class="difflineminus">-        &quot; 0763EE0305794071A39A4;CUTYPE=INDIVIDUAL;RSVP=TRUE;CN=Mike Shaver;PARTSTA\n&quot; +</span>
<a href="#l126.63"></a><span id="l126.63" class="difflineminus">-        &quot; T=NEEDS-ACTION:mailto:mike.x.shaver@oracle.com\n&quot; +</span>
<a href="#l126.64"></a><span id="l126.64" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067921763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.65"></a><span id="l126.65" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=David Ball;PARTSTAT=NEEDS-ACTION:mailto:david.ball@oracle.\n&quot; +</span>
<a href="#l126.66"></a><span id="l126.66" class="difflineminus">-        &quot; com\n&quot; +</span>
<a href="#l126.67"></a><span id="l126.67" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067922763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.68"></a><span id="l126.68" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Marten Haring;PARTSTAT=NEEDS-ACTION:mailto:marten.den.hari\n&quot; +</span>
<a href="#l126.69"></a><span id="l126.69" class="difflineminus">-        &quot; ng@oracle.com\n&quot; +</span>
<a href="#l126.70"></a><span id="l126.70" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067923763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.71"></a><span id="l126.71" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Peter Egyed;PARTSTAT=NEEDS-ACTION:mailto:peter.egyed@oracl\n&quot; +</span>
<a href="#l126.72"></a><span id="l126.72" class="difflineminus">-        &quot; e.com\n&quot; +</span>
<a href="#l126.73"></a><span id="l126.73" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067924763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.74"></a><span id="l126.74" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Francois Perrault;PARTSTAT=NEEDS-ACTION:mailto:francois.pe\n&quot; +</span>
<a href="#l126.75"></a><span id="l126.75" class="difflineminus">-        &quot; rrault@oracle.com\n&quot; +</span>
<a href="#l126.76"></a><span id="l126.76" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067925763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.77"></a><span id="l126.77" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Vladimir Vukicevic;PARTSTAT=NEEDS-ACTION:mailto:vladimir.v\n&quot; +</span>
<a href="#l126.78"></a><span id="l126.78" class="difflineminus">-        &quot; ukicevic@oracle.com\n&quot; +</span>
<a href="#l126.79"></a><span id="l126.79" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067926763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.80"></a><span id="l126.80" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Cyrus Daboo;PARTSTAT=NEEDS-ACTION:mailto:daboo@isamet.com\n&quot; +</span>
<a href="#l126.81"></a><span id="l126.81" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067927763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.82"></a><span id="l126.82" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Lisa Dusseault;PARTSTAT=NEEDS-ACTION:mailto:lisa@osafounda\n&quot; +</span>
<a href="#l126.83"></a><span id="l126.83" class="difflineminus">-        &quot; tion.org\n&quot; +</span>
<a href="#l126.84"></a><span id="l126.84" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067928763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.85"></a><span id="l126.85" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Dan Mosedale;PARTSTAT=NEEDS-ACTION:mailto:dan.mosedale@ora\n&quot; +</span>
<a href="#l126.86"></a><span id="l126.86" class="difflineminus">-        &quot; cle.com\n&quot; +</span>
<a href="#l126.87"></a><span id="l126.87" class="difflineminus">-        &quot;ATTENDEE;X-ORACLE-GUID=E93594067929763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.88"></a><span id="l126.88" class="difflineminus">-        &quot; ;RSVP=TRUE;CN=Stuart Parmenter;PARTSTAT=NEEDS-ACTION:mailto:stuart.parme\n&quot; +</span>
<a href="#l126.89"></a><span id="l126.89" class="difflineminus">-        &quot; nter@oracle.com\n&quot; +</span>
<a href="#l126.90"></a><span id="l126.90" class="difflineminus">-        &quot;END:VEVENT\n&quot; +</span>
<a href="#l126.91"></a><span id="l126.91" class="difflineminus">-        &quot;END:VCALENDAR\n&quot;</span>
<a href="#l126.92"></a><span id="l126.92" class="difflineplus">+var test_data = [{</span>
<a href="#l126.93"></a><span id="l126.93" class="difflineplus">+    expectedDateProps: {</span>
<a href="#l126.94"></a><span id="l126.94" class="difflineplus">+        month: 10,</span>
<a href="#l126.95"></a><span id="l126.95" class="difflineplus">+        day: 25,</span>
<a href="#l126.96"></a><span id="l126.96" class="difflineplus">+        year: 2004,</span>
<a href="#l126.97"></a><span id="l126.97" class="difflineplus">+        isDate: true</span>
<a href="#l126.98"></a><span id="l126.98" class="difflineplus">+    },</span>
<a href="#l126.99"></a><span id="l126.99" class="difflineplus">+    expectedProps: {</span>
<a href="#l126.100"></a><span id="l126.100" class="difflineplus">+        title: &quot;Christmas&quot;,</span>
<a href="#l126.101"></a><span id="l126.101" class="difflineplus">+        id: &quot;20041119T052239Z-1000472-1-5c0746bb-Oracle&quot;,</span>
<a href="#l126.102"></a><span id="l126.102" class="difflineplus">+        priority: 0,</span>
<a href="#l126.103"></a><span id="l126.103" class="difflineplus">+        status: &quot;CONFIRMED&quot;</span>
<a href="#l126.104"></a><span id="l126.104">     },</span>
<a href="#l126.105"></a><span id="l126.105" class="difflineminus">-    {</span>
<a href="#l126.106"></a><span id="l126.106" class="difflineminus">-        expectedProps: { &quot;x-magic&quot;: &quot;mymagicstring&quot; },</span>
<a href="#l126.107"></a><span id="l126.107" class="difflineminus">-        ics: &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l126.108"></a><span id="l126.108" class="difflineminus">-             &quot;UID:1\n&quot; +</span>
<a href="#l126.109"></a><span id="l126.109" class="difflineminus">-             &quot;DTSTART:20070521T100000Z\n&quot; +</span>
<a href="#l126.110"></a><span id="l126.110" class="difflineminus">-             &quot;X-MAGIC:mymagicstring\n&quot; +</span>
<a href="#l126.111"></a><span id="l126.111" class="difflineminus">-             &quot;END:VEVENT&quot;</span>
<a href="#l126.112"></a><span id="l126.112" class="difflineminus">-    }</span>
<a href="#l126.113"></a><span id="l126.113" class="difflineminus">-];</span>
<a href="#l126.114"></a><span id="l126.114" class="difflineplus">+    ics: &quot;BEGIN:VCALENDAR\n&quot; +</span>
<a href="#l126.115"></a><span id="l126.115" class="difflineplus">+         &quot;PRODID:-//ORACLE//NONSGML CSDK 9.0.5 - CalDAVServlet 9.0.5//EN\n&quot; +</span>
<a href="#l126.116"></a><span id="l126.116" class="difflineplus">+         &quot;VERSION:2.0\n&quot; +</span>
<a href="#l126.117"></a><span id="l126.117" class="difflineplus">+         &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l126.118"></a><span id="l126.118" class="difflineplus">+         &quot;UID:20041119T052239Z-1000472-1-5c0746bb-Oracle\n&quot; +</span>
<a href="#l126.119"></a><span id="l126.119" class="difflineplus">+         &quot;ORGANIZER;X-ORACLE-GUID=E9359406791C763EE0305794071A39A4;CN=Simon Vaillan\n&quot; +</span>
<a href="#l126.120"></a><span id="l126.120" class="difflineplus">+         &quot; court:mailto:simon.vaillancourt@oracle.com\n&quot; +</span>
<a href="#l126.121"></a><span id="l126.121" class="difflineplus">+         &quot;SEQUENCE:0\n&quot; +</span>
<a href="#l126.122"></a><span id="l126.122" class="difflineplus">+         &quot;DTSTAMP:20041124T010028Z\n&quot; +</span>
<a href="#l126.123"></a><span id="l126.123" class="difflineplus">+         &quot;CREATED:20041119T052239Z\n&quot; +</span>
<a href="#l126.124"></a><span id="l126.124" class="difflineplus">+         &quot;X-ORACLE-EVENTINSTANCE-GUID:I1+16778354+1+1+438153759\n&quot; +</span>
<a href="#l126.125"></a><span id="l126.125" class="difflineplus">+         &quot;X-ORACLE-EVENT-GUID:E1+16778354+1+438153759\n&quot; +</span>
<a href="#l126.126"></a><span id="l126.126" class="difflineplus">+         &quot;X-ORACLE-EVENTTYPE:DAY EVENT\n&quot; +</span>
<a href="#l126.127"></a><span id="l126.127" class="difflineplus">+         &quot;TRANSP:TRANSPARENT\n&quot; +</span>
<a href="#l126.128"></a><span id="l126.128" class="difflineplus">+         &quot;SUMMARY:Christmas\n&quot; +</span>
<a href="#l126.129"></a><span id="l126.129" class="difflineplus">+         &quot;STATUS:CONFIRMED\n&quot; +</span>
<a href="#l126.130"></a><span id="l126.130" class="difflineplus">+         &quot;PRIORITY:0\n&quot; +</span>
<a href="#l126.131"></a><span id="l126.131" class="difflineplus">+         &quot;DTSTART;VALUE=DATE:20041125\n&quot; +</span>
<a href="#l126.132"></a><span id="l126.132" class="difflineplus">+         &quot;DTEND;VALUE=DATE:20041125\n&quot; +</span>
<a href="#l126.133"></a><span id="l126.133" class="difflineplus">+         &quot;CLASS:PUBLIC\n&quot; +</span>
<a href="#l126.134"></a><span id="l126.134" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E92F51FB4A48E91CE0305794071A149C;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.135"></a><span id="l126.135" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=James Stevens;PARTSTAT=NEEDS-ACTION:mailto:james.stevens@o\n&quot; +</span>
<a href="#l126.136"></a><span id="l126.136" class="difflineplus">+         &quot; racle.com\n&quot; +</span>
<a href="#l126.137"></a><span id="l126.137" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E9359406791C763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.138"></a><span id="l126.138" class="difflineplus">+         &quot; ;RSVP=FALSE;CN=Simon Vaillancourt;PARTSTAT=ACCEPTED:mailto:simon.vaillan\n&quot; +</span>
<a href="#l126.139"></a><span id="l126.139" class="difflineplus">+         &quot; court@oracle.com\n&quot; +</span>
<a href="#l126.140"></a><span id="l126.140" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E9359406791D763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.141"></a><span id="l126.141" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Bernard Desruisseaux;PARTSTAT=NEEDS-ACTION:mailto:bernard.\n&quot; +</span>
<a href="#l126.142"></a><span id="l126.142" class="difflineplus">+         &quot; desruisseaux@oracle.com\n&quot; +</span>
<a href="#l126.143"></a><span id="l126.143" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E9359406791E763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.144"></a><span id="l126.144" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Mario Bonin;PARTSTAT=NEEDS-ACTION:mailto:mario.bonin@oracl\n&quot; +</span>
<a href="#l126.145"></a><span id="l126.145" class="difflineplus">+         &quot; e.com\n&quot; +</span>
<a href="#l126.146"></a><span id="l126.146" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E9359406791F763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.147"></a><span id="l126.147" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Jeremy Chone;PARTSTAT=NEEDS-ACTION:mailto:jeremy.chone@ora\n&quot; +</span>
<a href="#l126.148"></a><span id="l126.148" class="difflineplus">+         &quot; cle.com\n&quot; +</span>
<a href="#l126.149"></a><span id="l126.149" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-PERSONAL-COMMENT-ISDIRTY=TRUE;X-ORACLE-GUID=E9359406792\n&quot; +</span>
<a href="#l126.150"></a><span id="l126.150" class="difflineplus">+         &quot; 0763EE0305794071A39A4;CUTYPE=INDIVIDUAL;RSVP=TRUE;CN=Mike Shaver;PARTSTA\n&quot; +</span>
<a href="#l126.151"></a><span id="l126.151" class="difflineplus">+         &quot; T=NEEDS-ACTION:mailto:mike.x.shaver@oracle.com\n&quot; +</span>
<a href="#l126.152"></a><span id="l126.152" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067921763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.153"></a><span id="l126.153" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=David Ball;PARTSTAT=NEEDS-ACTION:mailto:david.ball@oracle.\n&quot; +</span>
<a href="#l126.154"></a><span id="l126.154" class="difflineplus">+         &quot; com\n&quot; +</span>
<a href="#l126.155"></a><span id="l126.155" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067922763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.156"></a><span id="l126.156" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Marten Haring;PARTSTAT=NEEDS-ACTION:mailto:marten.den.hari\n&quot; +</span>
<a href="#l126.157"></a><span id="l126.157" class="difflineplus">+         &quot; ng@oracle.com\n&quot; +</span>
<a href="#l126.158"></a><span id="l126.158" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067923763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.159"></a><span id="l126.159" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Peter Egyed;PARTSTAT=NEEDS-ACTION:mailto:peter.egyed@oracl\n&quot; +</span>
<a href="#l126.160"></a><span id="l126.160" class="difflineplus">+         &quot; e.com\n&quot; +</span>
<a href="#l126.161"></a><span id="l126.161" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067924763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.162"></a><span id="l126.162" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Francois Perrault;PARTSTAT=NEEDS-ACTION:mailto:francois.pe\n&quot; +</span>
<a href="#l126.163"></a><span id="l126.163" class="difflineplus">+         &quot; rrault@oracle.com\n&quot; +</span>
<a href="#l126.164"></a><span id="l126.164" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067925763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.165"></a><span id="l126.165" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Vladimir Vukicevic;PARTSTAT=NEEDS-ACTION:mailto:vladimir.v\n&quot; +</span>
<a href="#l126.166"></a><span id="l126.166" class="difflineplus">+         &quot; ukicevic@oracle.com\n&quot; +</span>
<a href="#l126.167"></a><span id="l126.167" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067926763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.168"></a><span id="l126.168" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Cyrus Daboo;PARTSTAT=NEEDS-ACTION:mailto:daboo@isamet.com\n&quot; +</span>
<a href="#l126.169"></a><span id="l126.169" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067927763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.170"></a><span id="l126.170" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Lisa Dusseault;PARTSTAT=NEEDS-ACTION:mailto:lisa@osafounda\n&quot; +</span>
<a href="#l126.171"></a><span id="l126.171" class="difflineplus">+         &quot; tion.org\n&quot; +</span>
<a href="#l126.172"></a><span id="l126.172" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067928763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.173"></a><span id="l126.173" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Dan Mosedale;PARTSTAT=NEEDS-ACTION:mailto:dan.mosedale@ora\n&quot; +</span>
<a href="#l126.174"></a><span id="l126.174" class="difflineplus">+         &quot; cle.com\n&quot; +</span>
<a href="#l126.175"></a><span id="l126.175" class="difflineplus">+         &quot;ATTENDEE;X-ORACLE-GUID=E93594067929763EE0305794071A39A4;CUTYPE=INDIVIDUAL\n&quot; +</span>
<a href="#l126.176"></a><span id="l126.176" class="difflineplus">+         &quot; ;RSVP=TRUE;CN=Stuart Parmenter;PARTSTAT=NEEDS-ACTION:mailto:stuart.parme\n&quot; +</span>
<a href="#l126.177"></a><span id="l126.177" class="difflineplus">+         &quot; nter@oracle.com\n&quot; +</span>
<a href="#l126.178"></a><span id="l126.178" class="difflineplus">+         &quot;END:VEVENT\n&quot; +</span>
<a href="#l126.179"></a><span id="l126.179" class="difflineplus">+         &quot;END:VCALENDAR\n&quot;</span>
<a href="#l126.180"></a><span id="l126.180" class="difflineplus">+}, {</span>
<a href="#l126.181"></a><span id="l126.181" class="difflineplus">+    expectedProps: { &quot;x-magic&quot;: &quot;mymagicstring&quot; },</span>
<a href="#l126.182"></a><span id="l126.182" class="difflineplus">+    ics: &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l126.183"></a><span id="l126.183" class="difflineplus">+         &quot;UID:1\n&quot; +</span>
<a href="#l126.184"></a><span id="l126.184" class="difflineplus">+         &quot;DTSTART:20070521T100000Z\n&quot; +</span>
<a href="#l126.185"></a><span id="l126.185" class="difflineplus">+         &quot;X-MAGIC:mymagicstring\n&quot; +</span>
<a href="#l126.186"></a><span id="l126.186" class="difflineplus">+         &quot;END:VEVENT&quot;</span>
<a href="#l126.187"></a><span id="l126.187" class="difflineplus">+}];</span>
<a href="#l126.188"></a><span id="l126.188"> </span>
<a href="#l126.189"></a><span id="l126.189"> function test_roundtrip() {</span>
<a href="#l126.190"></a><span id="l126.190">     function checkEvent(data, event) {</span>
<a href="#l126.191"></a><span id="l126.191">         checkRoundtrip(data.expectedProps, event);</span>
<a href="#l126.192"></a><span id="l126.192"> </span>
<a href="#l126.193"></a><span id="l126.193">         // Checking dates</span>
<a href="#l126.194"></a><span id="l126.194">         if (&quot;expectedDateProps&quot; in data) {</span>
<a href="#l126.195"></a><span id="l126.195">             checkProps(data.expectedDateProps, event.startDate);</span>
<a href="#l126.196"></a><span id="l126.196" class="difflineat">@@ -133,17 +130,17 @@ function test_roundtrip() {</span>
<a href="#l126.197"></a><span id="l126.197">                     event2.icalComponent = rootComp;</span>
<a href="#l126.198"></a><span id="l126.198">                     checkEvent(thisdata, event2);</span>
<a href="#l126.199"></a><span id="l126.199">                     do_test_finished();</span>
<a href="#l126.200"></a><span id="l126.200">                 } catch (e) {</span>
<a href="#l126.201"></a><span id="l126.201">                     do_throw(e + &quot;\n&quot;);</span>
<a href="#l126.202"></a><span id="l126.202">                     do_test_finished();</span>
<a href="#l126.203"></a><span id="l126.203">                 }</span>
<a href="#l126.204"></a><span id="l126.204">             }</span>
<a href="#l126.205"></a><span id="l126.205" class="difflineminus">-         });</span>
<a href="#l126.206"></a><span id="l126.206" class="difflineplus">+        });</span>
<a href="#l126.207"></a><span id="l126.207">     }</span>
<a href="#l126.208"></a><span id="l126.208"> }</span>
<a href="#l126.209"></a><span id="l126.209"> </span>
<a href="#l126.210"></a><span id="l126.210"> function test_folding() {</span>
<a href="#l126.211"></a><span id="l126.211">     // check folding</span>
<a href="#l126.212"></a><span id="l126.212">     const id = &quot;loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong-id-provoking-folding&quot;;</span>
<a href="#l126.213"></a><span id="l126.213">     let todo = cal.createTodo(), todo_ = cal.createTodo();</span>
<a href="#l126.214"></a><span id="l126.214">     todo.id = id;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l127.1"></a><span id="l127.1" class="difflineminus">--- a/calendar/test/unit/test_ics_service.js</span>
<a href="#l127.2"></a><span id="l127.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_service.js</span>
<a href="#l127.3"></a><span id="l127.3" class="difflineat">@@ -38,42 +38,46 @@ function test_icalstring() {</span>
<a href="#l127.4"></a><span id="l127.4">                     equal(thing.getProperty(k), properties[k]);</span>
<a href="#l127.5"></a><span id="l127.5">                 }</span>
<a href="#l127.6"></a><span id="l127.6">             }</span>
<a href="#l127.7"></a><span id="l127.7">         }</span>
<a href="#l127.8"></a><span id="l127.8">         return thing;</span>
<a href="#l127.9"></a><span id="l127.9">     }</span>
<a href="#l127.10"></a><span id="l127.10"> </span>
<a href="#l127.11"></a><span id="l127.11">     let attach = checkComp(cal.createAttachment.bind(cal),</span>
<a href="#l127.12"></a><span id="l127.12" class="difflineminus">-                           &quot;ATTACH;ENCODING=BASE64;FMTTYPE=text/calendar;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l127.13"></a><span id="l127.13" class="difflineminus">-                           { formatType: &quot;text/calendar&quot;, encoding: &quot;BASE64&quot; },</span>
<a href="#l127.14"></a><span id="l127.14" class="difflineminus">-                           { FILENAME: &quot;test.ics&quot; });</span>
<a href="#l127.15"></a><span id="l127.15" class="difflineplus">+        &quot;ATTACH;ENCODING=BASE64;FMTTYPE=text/calendar;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l127.16"></a><span id="l127.16" class="difflineplus">+        { formatType: &quot;text/calendar&quot;, encoding: &quot;BASE64&quot; },</span>
<a href="#l127.17"></a><span id="l127.17" class="difflineplus">+        { FILENAME: &quot;test.ics&quot; }</span>
<a href="#l127.18"></a><span id="l127.18" class="difflineplus">+    );</span>
<a href="#l127.19"></a><span id="l127.19">     equal(attach.uri.spec, &quot;http://example.com/test.ics&quot;);</span>
<a href="#l127.20"></a><span id="l127.20"> </span>
<a href="#l127.21"></a><span id="l127.21">     checkComp(cal.createAttendee.bind(cal),</span>
<a href="#l127.22"></a><span id="l127.22" class="difflineminus">-              &quot;ATTENDEE;RSVP=TRUE;CN=Name;PARTSTAT=ACCEPTED;CUTYPE=RESOURCE;ROLE=REQ-PARTICIPANT;X-THING=BAR:mailto:test@example.com&quot;,</span>
<a href="#l127.23"></a><span id="l127.23" class="difflineminus">-              {</span>
<a href="#l127.24"></a><span id="l127.24" class="difflineminus">-                  id: &quot;mailto:test@example.com&quot;,</span>
<a href="#l127.25"></a><span id="l127.25" class="difflineminus">-                  commonName: &quot;Name&quot;,</span>
<a href="#l127.26"></a><span id="l127.26" class="difflineminus">-                  rsvp: &quot;TRUE&quot;,</span>
<a href="#l127.27"></a><span id="l127.27" class="difflineminus">-                  isOrganizer: false,</span>
<a href="#l127.28"></a><span id="l127.28" class="difflineminus">-                  role: &quot;REQ-PARTICIPANT&quot;,</span>
<a href="#l127.29"></a><span id="l127.29" class="difflineminus">-                  participationStatus: &quot;ACCEPTED&quot;,</span>
<a href="#l127.30"></a><span id="l127.30" class="difflineminus">-                  userType: &quot;RESOURCE&quot;</span>
<a href="#l127.31"></a><span id="l127.31" class="difflineminus">-              },</span>
<a href="#l127.32"></a><span id="l127.32" class="difflineminus">-              { &quot;X-THING&quot;: &quot;BAR&quot; });</span>
<a href="#l127.33"></a><span id="l127.33" class="difflineplus">+        &quot;ATTENDEE;RSVP=TRUE;CN=Name;PARTSTAT=ACCEPTED;CUTYPE=RESOURCE;ROLE=REQ-PARTICIPANT;X-THING=BAR:mailto:test@example.com&quot;,</span>
<a href="#l127.34"></a><span id="l127.34" class="difflineplus">+        {</span>
<a href="#l127.35"></a><span id="l127.35" class="difflineplus">+            id: &quot;mailto:test@example.com&quot;,</span>
<a href="#l127.36"></a><span id="l127.36" class="difflineplus">+            commonName: &quot;Name&quot;,</span>
<a href="#l127.37"></a><span id="l127.37" class="difflineplus">+            rsvp: &quot;TRUE&quot;,</span>
<a href="#l127.38"></a><span id="l127.38" class="difflineplus">+            isOrganizer: false,</span>
<a href="#l127.39"></a><span id="l127.39" class="difflineplus">+            role: &quot;REQ-PARTICIPANT&quot;,</span>
<a href="#l127.40"></a><span id="l127.40" class="difflineplus">+            participationStatus: &quot;ACCEPTED&quot;,</span>
<a href="#l127.41"></a><span id="l127.41" class="difflineplus">+            userType: &quot;RESOURCE&quot;</span>
<a href="#l127.42"></a><span id="l127.42" class="difflineplus">+        },</span>
<a href="#l127.43"></a><span id="l127.43" class="difflineplus">+        { &quot;X-THING&quot;: &quot;BAR&quot; }</span>
<a href="#l127.44"></a><span id="l127.44" class="difflineplus">+    );</span>
<a href="#l127.45"></a><span id="l127.45"> </span>
<a href="#l127.46"></a><span id="l127.46">     checkComp(cal.createRelation.bind(cal),</span>
<a href="#l127.47"></a><span id="l127.47" class="difflineminus">-              &quot;RELATED-TO;RELTYPE=SIBLING;FOO=BAR:VALUE&quot;,</span>
<a href="#l127.48"></a><span id="l127.48" class="difflineminus">-              { relType: &quot;SIBLING&quot;, relId: &quot;VALUE&quot; },</span>
<a href="#l127.49"></a><span id="l127.49" class="difflineminus">-              { FOO: &quot;BAR&quot; });</span>
<a href="#l127.50"></a><span id="l127.50" class="difflineplus">+        &quot;RELATED-TO;RELTYPE=SIBLING;FOO=BAR:VALUE&quot;,</span>
<a href="#l127.51"></a><span id="l127.51" class="difflineplus">+        { relType: &quot;SIBLING&quot;, relId: &quot;VALUE&quot; },</span>
<a href="#l127.52"></a><span id="l127.52" class="difflineplus">+        { FOO: &quot;BAR&quot; }</span>
<a href="#l127.53"></a><span id="l127.53" class="difflineplus">+    );</span>
<a href="#l127.54"></a><span id="l127.54"> </span>
<a href="#l127.55"></a><span id="l127.55">     let rrule = checkComp(cal.createRecurrenceRule.bind(cal),</span>
<a href="#l127.56"></a><span id="l127.56" class="difflineminus">-                          &quot;RRULE:FREQ=WEEKLY;COUNT=5;INTERVAL=2;BYDAY=MO&quot;,</span>
<a href="#l127.57"></a><span id="l127.57" class="difflineminus">-                          { count: 5, isByCount: true, type: &quot;WEEKLY&quot;, interval: 2 });</span>
<a href="#l127.58"></a><span id="l127.58" class="difflineplus">+        &quot;RRULE:FREQ=WEEKLY;COUNT=5;INTERVAL=2;BYDAY=MO&quot;,</span>
<a href="#l127.59"></a><span id="l127.59" class="difflineplus">+        { count: 5, isByCount: true, type: &quot;WEEKLY&quot;, interval: 2 }</span>
<a href="#l127.60"></a><span id="l127.60" class="difflineplus">+    );</span>
<a href="#l127.61"></a><span id="l127.61">     equal(rrule.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l127.62"></a><span id="l127.62"> </span>
<a href="#l127.63"></a><span id="l127.63">     if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l127.64"></a><span id="l127.64">         let rdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l127.65"></a><span id="l127.65">                               &quot;RDATE:20120101T000000&quot;,</span>
<a href="#l127.66"></a><span id="l127.66">                               { isNegative: false });</span>
<a href="#l127.67"></a><span id="l127.67">         equal(rdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l127.68"></a><span id="l127.68">     } else {</span>
<a href="#l127.69"></a><span id="l127.69" class="difflineat">@@ -109,26 +113,29 @@ function test_icsservice() {</span>
<a href="#l127.70"></a><span id="l127.70">         for (let k in parameters) {</span>
<a href="#l127.71"></a><span id="l127.71">             equal(thing.getParameter(k), parameters[k]);</span>
<a href="#l127.72"></a><span id="l127.72">         }</span>
<a href="#l127.73"></a><span id="l127.73">         return thing;</span>
<a href="#l127.74"></a><span id="l127.74">     }</span>
<a href="#l127.75"></a><span id="l127.75"> </span>
<a href="#l127.76"></a><span id="l127.76">     // Test ::createIcalPropertyFromString</span>
<a href="#l127.77"></a><span id="l127.77">     checkProp(svc.createIcalPropertyFromString.bind(svc),</span>
<a href="#l127.78"></a><span id="l127.78" class="difflineminus">-              &quot;ATTACH;ENCODING=BASE64;FMTTYPE=text/calendar;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l127.79"></a><span id="l127.79" class="difflineminus">-              { value: &quot;http://example.com/test.ics&quot;, propertyName: &quot;ATTACH&quot; },</span>
<a href="#l127.80"></a><span id="l127.80" class="difflineminus">-              { ENCODING: &quot;BASE64&quot;, FMTTYPE: &quot;text/calendar&quot;, FILENAME: &quot;test.ics&quot; });</span>
<a href="#l127.81"></a><span id="l127.81" class="difflineplus">+        &quot;ATTACH;ENCODING=BASE64;FMTTYPE=text/calendar;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l127.82"></a><span id="l127.82" class="difflineplus">+        { value: &quot;http://example.com/test.ics&quot;, propertyName: &quot;ATTACH&quot; },</span>
<a href="#l127.83"></a><span id="l127.83" class="difflineplus">+        { ENCODING: &quot;BASE64&quot;, FMTTYPE: &quot;text/calendar&quot;, FILENAME: &quot;test.ics&quot; }</span>
<a href="#l127.84"></a><span id="l127.84" class="difflineplus">+    );</span>
<a href="#l127.85"></a><span id="l127.85"> </span>
<a href="#l127.86"></a><span id="l127.86">     checkProp(svc.createIcalPropertyFromString.bind(svc),</span>
<a href="#l127.87"></a><span id="l127.87" class="difflineminus">-              &quot;DESCRIPTION:new\\nlines\\nare\\ngreat\\,eh?&quot;,</span>
<a href="#l127.88"></a><span id="l127.88" class="difflineminus">-              {</span>
<a href="#l127.89"></a><span id="l127.89" class="difflineminus">-                  value: &quot;new\nlines\nare\ngreat,eh?&quot;,</span>
<a href="#l127.90"></a><span id="l127.90" class="difflineminus">-                  valueAsIcalString: &quot;new\\nlines\\nare\\ngreat\\,eh?&quot;</span>
<a href="#l127.91"></a><span id="l127.91" class="difflineminus">-              }, {});</span>
<a href="#l127.92"></a><span id="l127.92" class="difflineplus">+        &quot;DESCRIPTION:new\\nlines\\nare\\ngreat\\,eh?&quot;,</span>
<a href="#l127.93"></a><span id="l127.93" class="difflineplus">+        {</span>
<a href="#l127.94"></a><span id="l127.94" class="difflineplus">+            value: &quot;new\nlines\nare\ngreat,eh?&quot;,</span>
<a href="#l127.95"></a><span id="l127.95" class="difflineplus">+            valueAsIcalString: &quot;new\\nlines\\nare\\ngreat\\,eh?&quot;</span>
<a href="#l127.96"></a><span id="l127.96" class="difflineplus">+        },</span>
<a href="#l127.97"></a><span id="l127.97" class="difflineplus">+        {}</span>
<a href="#l127.98"></a><span id="l127.98" class="difflineplus">+    );</span>
<a href="#l127.99"></a><span id="l127.99"> </span>
<a href="#l127.100"></a><span id="l127.100">     // Test ::createIcalProperty</span>
<a href="#l127.101"></a><span id="l127.101">     let attach2 = svc.createIcalProperty(&quot;ATTACH&quot;);</span>
<a href="#l127.102"></a><span id="l127.102">     equal(attach2.propertyName, &quot;ATTACH&quot;);</span>
<a href="#l127.103"></a><span id="l127.103">     attach2.value = &quot;http://example.com/&quot;;</span>
<a href="#l127.104"></a><span id="l127.104">     equal(attach2.icalString, &quot;ATTACH:http://example.com/\r\n&quot;);</span>
<a href="#l127.105"></a><span id="l127.105"> }</span>
<a href="#l127.106"></a><span id="l127.106"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l128.1"></a><span id="l128.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l128.2"></a><span id="l128.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l128.3"></a><span id="l128.3" class="difflineat">@@ -1,202 +1,202 @@</span>
<a href="#l128.4"></a><span id="l128.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l128.5"></a><span id="l128.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l128.6"></a><span id="l128.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l128.7"></a><span id="l128.7"> </span>
<a href="#l128.8"></a><span id="l128.8"> var icalStringArray = [</span>
<a href="#l128.9"></a><span id="l128.9" class="difflineminus">-                // Comments refer to the range defined in testGetItems().</span>
<a href="#l128.10"></a><span id="l128.10" class="difflineminus">-                // 1: one-hour event</span>
<a href="#l128.11"></a><span id="l128.11" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.12"></a><span id="l128.12" class="difflineminus">-                &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l128.13"></a><span id="l128.13" class="difflineminus">-                &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l128.14"></a><span id="l128.14" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.15"></a><span id="l128.15" class="difflineminus">-                // 2: Test a zero-length event with DTSTART and DTEND</span>
<a href="#l128.16"></a><span id="l128.16" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.17"></a><span id="l128.17" class="difflineminus">-                &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.18"></a><span id="l128.18" class="difflineminus">-                &quot;DTEND:20020402T000000Z\n&quot; +</span>
<a href="#l128.19"></a><span id="l128.19" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.20"></a><span id="l128.20" class="difflineminus">-                // 3: Test a zero-length event with DTSTART and no DTEND</span>
<a href="#l128.21"></a><span id="l128.21" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.22"></a><span id="l128.22" class="difflineminus">-                &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.23"></a><span id="l128.23" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.24"></a><span id="l128.24" class="difflineminus">-                // 4: Test a zero-length event with DTEND set and no  DTSTART. Invalid!</span>
<a href="#l128.25"></a><span id="l128.25" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.26"></a><span id="l128.26" class="difflineminus">-                &quot;DTEND:20020402T000000Z\n&quot; +</span>
<a href="#l128.27"></a><span id="l128.27" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.28"></a><span id="l128.28" class="difflineminus">-                // 5: one-hour event that is outside the range</span>
<a href="#l128.29"></a><span id="l128.29" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.30"></a><span id="l128.30" class="difflineminus">-                &quot;DTSTART:20020401T114500Z\n&quot; +</span>
<a href="#l128.31"></a><span id="l128.31" class="difflineminus">-                &quot;DTEND:20020401T124500Z\n&quot; +</span>
<a href="#l128.32"></a><span id="l128.32" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.33"></a><span id="l128.33" class="difflineminus">-                // 6: one-hour event that starts outside the range and ends inside.</span>
<a href="#l128.34"></a><span id="l128.34" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.35"></a><span id="l128.35" class="difflineminus">-                &quot;DTSTART:20020401T114500Z\n&quot; +</span>
<a href="#l128.36"></a><span id="l128.36" class="difflineminus">-                &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l128.37"></a><span id="l128.37" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.38"></a><span id="l128.38" class="difflineminus">-                // 7:  one-hour event that starts inside the range and ends outside.</span>
<a href="#l128.39"></a><span id="l128.39" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.40"></a><span id="l128.40" class="difflineminus">-                &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l128.41"></a><span id="l128.41" class="difflineminus">-                &quot;DTEND:20020403T124500Z\n&quot; +</span>
<a href="#l128.42"></a><span id="l128.42" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.43"></a><span id="l128.43" class="difflineminus">-                // 8: one-hour event that starts at the end of the range.</span>
<a href="#l128.44"></a><span id="l128.44" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.45"></a><span id="l128.45" class="difflineminus">-                &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.46"></a><span id="l128.46" class="difflineminus">-                &quot;DTEND:20020403T124500Z\n&quot; +</span>
<a href="#l128.47"></a><span id="l128.47" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.48"></a><span id="l128.48" class="difflineminus">-                // 9: allday event that starts at start of range and ends at end of range.</span>
<a href="#l128.49"></a><span id="l128.49" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.50"></a><span id="l128.50" class="difflineminus">-                &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.51"></a><span id="l128.51" class="difflineminus">-                &quot;DTEND;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l128.52"></a><span id="l128.52" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.53"></a><span id="l128.53" class="difflineminus">-                // 10: allday event that starts at end of range.</span>
<a href="#l128.54"></a><span id="l128.54" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.55"></a><span id="l128.55" class="difflineminus">-                &quot;DTSTART;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l128.56"></a><span id="l128.56" class="difflineminus">-                &quot;DTEND;VALUE=DATE:20020404\n&quot; +</span>
<a href="#l128.57"></a><span id="l128.57" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.58"></a><span id="l128.58" class="difflineminus">-                // 11: allday event that ends at start of range. See bug 333363.</span>
<a href="#l128.59"></a><span id="l128.59" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.60"></a><span id="l128.60" class="difflineminus">-                &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l128.61"></a><span id="l128.61" class="difflineminus">-                &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.62"></a><span id="l128.62" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.63"></a><span id="l128.63" class="difflineminus">-                // 12: daily recurring allday event. parent item in the range.</span>
<a href="#l128.64"></a><span id="l128.64" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.65"></a><span id="l128.65" class="difflineminus">-                &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.66"></a><span id="l128.66" class="difflineminus">-                &quot;DTEND;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l128.67"></a><span id="l128.67" class="difflineminus">-                &quot;RRULE:FREQ=DAILY;INTERVAL=1;COUNT=10\n&quot; +</span>
<a href="#l128.68"></a><span id="l128.68" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.69"></a><span id="l128.69" class="difflineminus">-                // 13: daily recurring allday event. First occurence in the range.</span>
<a href="#l128.70"></a><span id="l128.70" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.71"></a><span id="l128.71" class="difflineminus">-                &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l128.72"></a><span id="l128.72" class="difflineminus">-                &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.73"></a><span id="l128.73" class="difflineminus">-                &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.74"></a><span id="l128.74" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.75"></a><span id="l128.75" class="difflineminus">-                // 14: two-daily recurring allday event. Not in the range.</span>
<a href="#l128.76"></a><span id="l128.76" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.77"></a><span id="l128.77" class="difflineminus">-                &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l128.78"></a><span id="l128.78" class="difflineminus">-                &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.79"></a><span id="l128.79" class="difflineminus">-                &quot;RRULE:FREQ=DAILY;INTERVAL=2;COUNT=10\n&quot; +</span>
<a href="#l128.80"></a><span id="l128.80" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.81"></a><span id="l128.81" class="difflineminus">-                // 15: daily recurring one-hour event. Parent in the range.</span>
<a href="#l128.82"></a><span id="l128.82" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.83"></a><span id="l128.83" class="difflineminus">-                &quot;DTSTART:20020402T100000Z\n&quot; +</span>
<a href="#l128.84"></a><span id="l128.84" class="difflineminus">-                &quot;DTEND:20020402T110000Z\n&quot; +</span>
<a href="#l128.85"></a><span id="l128.85" class="difflineminus">-                &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.86"></a><span id="l128.86" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.87"></a><span id="l128.87" class="difflineminus">-                // 16: daily recurring one-hour event. Occurrence in the range.</span>
<a href="#l128.88"></a><span id="l128.88" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.89"></a><span id="l128.89" class="difflineminus">-                &quot;DTSTART:20020401T100000Z\n&quot; +</span>
<a href="#l128.90"></a><span id="l128.90" class="difflineminus">-                &quot;DTEND:20020401T110000Z\n&quot; +</span>
<a href="#l128.91"></a><span id="l128.91" class="difflineminus">-                &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.92"></a><span id="l128.92" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.93"></a><span id="l128.93" class="difflineminus">-                // 17: zero-length task with DTSTART and DUE set at start of range.</span>
<a href="#l128.94"></a><span id="l128.94" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.95"></a><span id="l128.95" class="difflineminus">-                &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.96"></a><span id="l128.96" class="difflineminus">-                &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l128.97"></a><span id="l128.97" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.98"></a><span id="l128.98" class="difflineminus">-                // 18: zero-length event with only DTSTART set at start of range.</span>
<a href="#l128.99"></a><span id="l128.99" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.100"></a><span id="l128.100" class="difflineminus">-                &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.101"></a><span id="l128.101" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.102"></a><span id="l128.102" class="difflineminus">-                // 19: zero-length event with only DUE set at start of range.</span>
<a href="#l128.103"></a><span id="l128.103" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.104"></a><span id="l128.104" class="difflineminus">-                &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l128.105"></a><span id="l128.105" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.106"></a><span id="l128.106" class="difflineminus">-                // 20: one-hour todo within the range.</span>
<a href="#l128.107"></a><span id="l128.107" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.108"></a><span id="l128.108" class="difflineminus">-                &quot;DTSTART:20020402T110000Z\n&quot; +</span>
<a href="#l128.109"></a><span id="l128.109" class="difflineminus">-                &quot;DUE:20020402T120000Z\n&quot; +</span>
<a href="#l128.110"></a><span id="l128.110" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.111"></a><span id="l128.111" class="difflineminus">-                // 21: zero-length todo that starts at end of range.</span>
<a href="#l128.112"></a><span id="l128.112" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.113"></a><span id="l128.113" class="difflineminus">-                &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.114"></a><span id="l128.114" class="difflineminus">-                &quot;DUE:20020403T010000Z\n&quot; +</span>
<a href="#l128.115"></a><span id="l128.115" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.116"></a><span id="l128.116" class="difflineminus">-                // 22: one-hour todo that ends at start of range.</span>
<a href="#l128.117"></a><span id="l128.117" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.118"></a><span id="l128.118" class="difflineminus">-                &quot;DTSTART:20020401T230000Z\n&quot; +</span>
<a href="#l128.119"></a><span id="l128.119" class="difflineminus">-                &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l128.120"></a><span id="l128.120" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.121"></a><span id="l128.121" class="difflineminus">-                // 23: daily recurring one-hour event. Parent in the range.</span>
<a href="#l128.122"></a><span id="l128.122" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.123"></a><span id="l128.123" class="difflineminus">-                &quot;DTSTART:20020402T000000\n&quot; +</span>
<a href="#l128.124"></a><span id="l128.124" class="difflineminus">-                &quot;DTEND:20020402T010000\n&quot; +</span>
<a href="#l128.125"></a><span id="l128.125" class="difflineminus">-                &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.126"></a><span id="l128.126" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.127"></a><span id="l128.127" class="difflineminus">-                // 24: daily recurring 24-hour event. Parent in the range.</span>
<a href="#l128.128"></a><span id="l128.128" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.129"></a><span id="l128.129" class="difflineminus">-                &quot;DTSTART:20020402T000000\n&quot; +</span>
<a href="#l128.130"></a><span id="l128.130" class="difflineminus">-                &quot;DTEND:20020403T000000\n&quot; +</span>
<a href="#l128.131"></a><span id="l128.131" class="difflineminus">-                &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.132"></a><span id="l128.132" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.133"></a><span id="l128.133" class="difflineminus">-                // 25: todo that has neither start nor due date set.</span>
<a href="#l128.134"></a><span id="l128.134" class="difflineminus">-                // Should be returned on every getItems() call. See bug 405459.</span>
<a href="#l128.135"></a><span id="l128.135" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.136"></a><span id="l128.136" class="difflineminus">-                &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.137"></a><span id="l128.137" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.138"></a><span id="l128.138" class="difflineminus">-                // 26: todo that has neither start nor due date but</span>
<a href="#l128.139"></a><span id="l128.139" class="difflineminus">-                // a completion time set after range. See bug 405459.</span>
<a href="#l128.140"></a><span id="l128.140" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.141"></a><span id="l128.141" class="difflineminus">-                &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.142"></a><span id="l128.142" class="difflineminus">-                &quot;COMPLETED:20030404T000001\n&quot; +</span>
<a href="#l128.143"></a><span id="l128.143" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.144"></a><span id="l128.144" class="difflineminus">-                // 27: todo that has neither start nor due date but a</span>
<a href="#l128.145"></a><span id="l128.145" class="difflineminus">-                // completion time set in the range. See bug 405459.</span>
<a href="#l128.146"></a><span id="l128.146" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.147"></a><span id="l128.147" class="difflineminus">-                &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.148"></a><span id="l128.148" class="difflineminus">-                &quot;COMPLETED:20020402T120001\n&quot; +</span>
<a href="#l128.149"></a><span id="l128.149" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.150"></a><span id="l128.150" class="difflineminus">-                // 28: todo that has neither start nor due date but a</span>
<a href="#l128.151"></a><span id="l128.151" class="difflineminus">-                // completion time set before the range. See bug 405459.</span>
<a href="#l128.152"></a><span id="l128.152" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.153"></a><span id="l128.153" class="difflineminus">-                &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.154"></a><span id="l128.154" class="difflineminus">-                &quot;COMPLETED:20020402T000000\n&quot; +</span>
<a href="#l128.155"></a><span id="l128.155" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.156"></a><span id="l128.156" class="difflineminus">-                // 29: todo that has neither start nor due date set,</span>
<a href="#l128.157"></a><span id="l128.157" class="difflineminus">-                // has the status &quot;COMPLETED&quot; but no completion time. See bug 405459.</span>
<a href="#l128.158"></a><span id="l128.158" class="difflineminus">-                &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.159"></a><span id="l128.159" class="difflineminus">-                &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.160"></a><span id="l128.160" class="difflineminus">-                &quot;STATUS:COMPLETED\n&quot; +</span>
<a href="#l128.161"></a><span id="l128.161" class="difflineminus">-                &quot;END:VTODO\n&quot;,</span>
<a href="#l128.162"></a><span id="l128.162" class="difflineminus">-                // 30: one-hour event with duration (in the range). See bug 390492.</span>
<a href="#l128.163"></a><span id="l128.163" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.164"></a><span id="l128.164" class="difflineminus">-                &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l128.165"></a><span id="l128.165" class="difflineminus">-                &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l128.166"></a><span id="l128.166" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.167"></a><span id="l128.167" class="difflineminus">-                // 31: one-hour event with duration (after the range). See bug 390492.</span>
<a href="#l128.168"></a><span id="l128.168" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.169"></a><span id="l128.169" class="difflineminus">-                &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.170"></a><span id="l128.170" class="difflineminus">-                &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l128.171"></a><span id="l128.171" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.172"></a><span id="l128.172" class="difflineminus">-                // 32: one-hour event with duration (before the range). See bug 390492.</span>
<a href="#l128.173"></a><span id="l128.173" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.174"></a><span id="l128.174" class="difflineminus">-                &quot;DTSTART:20020401T230000Z\n&quot; +</span>
<a href="#l128.175"></a><span id="l128.175" class="difflineminus">-                &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l128.176"></a><span id="l128.176" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.177"></a><span id="l128.177" class="difflineminus">-                // 33: one-day event with duration. Starts in the range, Ends outside. See bug 390492.</span>
<a href="#l128.178"></a><span id="l128.178" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.179"></a><span id="l128.179" class="difflineminus">-                &quot;DTSTART:20020402T120000Z\n&quot; +</span>
<a href="#l128.180"></a><span id="l128.180" class="difflineminus">-                &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.181"></a><span id="l128.181" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.182"></a><span id="l128.182" class="difflineminus">-                // 34: one-day event with duration. Starts before the range. Ends inside. See bug 390492.</span>
<a href="#l128.183"></a><span id="l128.183" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.184"></a><span id="l128.184" class="difflineminus">-                &quot;DTSTART:20020401T120000Z\n&quot; +</span>
<a href="#l128.185"></a><span id="l128.185" class="difflineminus">-                &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.186"></a><span id="l128.186" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.187"></a><span id="l128.187" class="difflineminus">-                // 35: one-day event with duration (before the range). See bug 390492.</span>
<a href="#l128.188"></a><span id="l128.188" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.189"></a><span id="l128.189" class="difflineminus">-                &quot;DTSTART:20020401T000000Z\n&quot; +</span>
<a href="#l128.190"></a><span id="l128.190" class="difflineminus">-                &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.191"></a><span id="l128.191" class="difflineminus">-                &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.192"></a><span id="l128.192" class="difflineminus">-                // 36: one-day event with duration (after the range). See bug 390492.</span>
<a href="#l128.193"></a><span id="l128.193" class="difflineminus">-                &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.194"></a><span id="l128.194" class="difflineminus">-                &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.195"></a><span id="l128.195" class="difflineminus">-                &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.196"></a><span id="l128.196" class="difflineminus">-                &quot;END:VEVENT\n&quot;</span>
<a href="#l128.197"></a><span id="l128.197" class="difflineminus">-                ];</span>
<a href="#l128.198"></a><span id="l128.198" class="difflineplus">+    // Comments refer to the range defined in testGetItems().</span>
<a href="#l128.199"></a><span id="l128.199" class="difflineplus">+    // 1: one-hour event</span>
<a href="#l128.200"></a><span id="l128.200" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.201"></a><span id="l128.201" class="difflineplus">+    &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l128.202"></a><span id="l128.202" class="difflineplus">+    &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l128.203"></a><span id="l128.203" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.204"></a><span id="l128.204" class="difflineplus">+    // 2: Test a zero-length event with DTSTART and DTEND</span>
<a href="#l128.205"></a><span id="l128.205" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.206"></a><span id="l128.206" class="difflineplus">+    &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.207"></a><span id="l128.207" class="difflineplus">+    &quot;DTEND:20020402T000000Z\n&quot; +</span>
<a href="#l128.208"></a><span id="l128.208" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.209"></a><span id="l128.209" class="difflineplus">+    // 3: Test a zero-length event with DTSTART and no DTEND</span>
<a href="#l128.210"></a><span id="l128.210" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.211"></a><span id="l128.211" class="difflineplus">+    &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.212"></a><span id="l128.212" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.213"></a><span id="l128.213" class="difflineplus">+    // 4: Test a zero-length event with DTEND set and no  DTSTART. Invalid!</span>
<a href="#l128.214"></a><span id="l128.214" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.215"></a><span id="l128.215" class="difflineplus">+    &quot;DTEND:20020402T000000Z\n&quot; +</span>
<a href="#l128.216"></a><span id="l128.216" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.217"></a><span id="l128.217" class="difflineplus">+    // 5: one-hour event that is outside the range</span>
<a href="#l128.218"></a><span id="l128.218" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.219"></a><span id="l128.219" class="difflineplus">+    &quot;DTSTART:20020401T114500Z\n&quot; +</span>
<a href="#l128.220"></a><span id="l128.220" class="difflineplus">+    &quot;DTEND:20020401T124500Z\n&quot; +</span>
<a href="#l128.221"></a><span id="l128.221" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.222"></a><span id="l128.222" class="difflineplus">+    // 6: one-hour event that starts outside the range and ends inside.</span>
<a href="#l128.223"></a><span id="l128.223" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.224"></a><span id="l128.224" class="difflineplus">+    &quot;DTSTART:20020401T114500Z\n&quot; +</span>
<a href="#l128.225"></a><span id="l128.225" class="difflineplus">+    &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l128.226"></a><span id="l128.226" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.227"></a><span id="l128.227" class="difflineplus">+    // 7:  one-hour event that starts inside the range and ends outside.</span>
<a href="#l128.228"></a><span id="l128.228" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.229"></a><span id="l128.229" class="difflineplus">+    &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l128.230"></a><span id="l128.230" class="difflineplus">+    &quot;DTEND:20020403T124500Z\n&quot; +</span>
<a href="#l128.231"></a><span id="l128.231" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.232"></a><span id="l128.232" class="difflineplus">+    // 8: one-hour event that starts at the end of the range.</span>
<a href="#l128.233"></a><span id="l128.233" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.234"></a><span id="l128.234" class="difflineplus">+    &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.235"></a><span id="l128.235" class="difflineplus">+    &quot;DTEND:20020403T124500Z\n&quot; +</span>
<a href="#l128.236"></a><span id="l128.236" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.237"></a><span id="l128.237" class="difflineplus">+    // 9: allday event that starts at start of range and ends at end of range.</span>
<a href="#l128.238"></a><span id="l128.238" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.239"></a><span id="l128.239" class="difflineplus">+    &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.240"></a><span id="l128.240" class="difflineplus">+    &quot;DTEND;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l128.241"></a><span id="l128.241" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.242"></a><span id="l128.242" class="difflineplus">+    // 10: allday event that starts at end of range.</span>
<a href="#l128.243"></a><span id="l128.243" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.244"></a><span id="l128.244" class="difflineplus">+    &quot;DTSTART;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l128.245"></a><span id="l128.245" class="difflineplus">+    &quot;DTEND;VALUE=DATE:20020404\n&quot; +</span>
<a href="#l128.246"></a><span id="l128.246" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.247"></a><span id="l128.247" class="difflineplus">+    // 11: allday event that ends at start of range. See bug 333363.</span>
<a href="#l128.248"></a><span id="l128.248" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.249"></a><span id="l128.249" class="difflineplus">+    &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l128.250"></a><span id="l128.250" class="difflineplus">+    &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.251"></a><span id="l128.251" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.252"></a><span id="l128.252" class="difflineplus">+    // 12: daily recurring allday event. parent item in the range.</span>
<a href="#l128.253"></a><span id="l128.253" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.254"></a><span id="l128.254" class="difflineplus">+    &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.255"></a><span id="l128.255" class="difflineplus">+    &quot;DTEND;VALUE=DATE:20020403\n&quot; +</span>
<a href="#l128.256"></a><span id="l128.256" class="difflineplus">+    &quot;RRULE:FREQ=DAILY;INTERVAL=1;COUNT=10\n&quot; +</span>
<a href="#l128.257"></a><span id="l128.257" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.258"></a><span id="l128.258" class="difflineplus">+    // 13: daily recurring allday event. First occurence in the range.</span>
<a href="#l128.259"></a><span id="l128.259" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.260"></a><span id="l128.260" class="difflineplus">+    &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l128.261"></a><span id="l128.261" class="difflineplus">+    &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.262"></a><span id="l128.262" class="difflineplus">+    &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.263"></a><span id="l128.263" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.264"></a><span id="l128.264" class="difflineplus">+    // 14: two-daily recurring allday event. Not in the range.</span>
<a href="#l128.265"></a><span id="l128.265" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.266"></a><span id="l128.266" class="difflineplus">+    &quot;DTSTART;VALUE=DATE:20020401\n&quot; +</span>
<a href="#l128.267"></a><span id="l128.267" class="difflineplus">+    &quot;DTEND;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l128.268"></a><span id="l128.268" class="difflineplus">+    &quot;RRULE:FREQ=DAILY;INTERVAL=2;COUNT=10\n&quot; +</span>
<a href="#l128.269"></a><span id="l128.269" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.270"></a><span id="l128.270" class="difflineplus">+    // 15: daily recurring one-hour event. Parent in the range.</span>
<a href="#l128.271"></a><span id="l128.271" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.272"></a><span id="l128.272" class="difflineplus">+    &quot;DTSTART:20020402T100000Z\n&quot; +</span>
<a href="#l128.273"></a><span id="l128.273" class="difflineplus">+    &quot;DTEND:20020402T110000Z\n&quot; +</span>
<a href="#l128.274"></a><span id="l128.274" class="difflineplus">+    &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.275"></a><span id="l128.275" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.276"></a><span id="l128.276" class="difflineplus">+    // 16: daily recurring one-hour event. Occurrence in the range.</span>
<a href="#l128.277"></a><span id="l128.277" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.278"></a><span id="l128.278" class="difflineplus">+    &quot;DTSTART:20020401T100000Z\n&quot; +</span>
<a href="#l128.279"></a><span id="l128.279" class="difflineplus">+    &quot;DTEND:20020401T110000Z\n&quot; +</span>
<a href="#l128.280"></a><span id="l128.280" class="difflineplus">+    &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.281"></a><span id="l128.281" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.282"></a><span id="l128.282" class="difflineplus">+    // 17: zero-length task with DTSTART and DUE set at start of range.</span>
<a href="#l128.283"></a><span id="l128.283" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.284"></a><span id="l128.284" class="difflineplus">+    &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.285"></a><span id="l128.285" class="difflineplus">+    &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l128.286"></a><span id="l128.286" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.287"></a><span id="l128.287" class="difflineplus">+    // 18: zero-length event with only DTSTART set at start of range.</span>
<a href="#l128.288"></a><span id="l128.288" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.289"></a><span id="l128.289" class="difflineplus">+    &quot;DTSTART:20020402T000000Z\n&quot; +</span>
<a href="#l128.290"></a><span id="l128.290" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.291"></a><span id="l128.291" class="difflineplus">+    // 19: zero-length event with only DUE set at start of range.</span>
<a href="#l128.292"></a><span id="l128.292" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.293"></a><span id="l128.293" class="difflineplus">+    &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l128.294"></a><span id="l128.294" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.295"></a><span id="l128.295" class="difflineplus">+    // 20: one-hour todo within the range.</span>
<a href="#l128.296"></a><span id="l128.296" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.297"></a><span id="l128.297" class="difflineplus">+    &quot;DTSTART:20020402T110000Z\n&quot; +</span>
<a href="#l128.298"></a><span id="l128.298" class="difflineplus">+    &quot;DUE:20020402T120000Z\n&quot; +</span>
<a href="#l128.299"></a><span id="l128.299" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.300"></a><span id="l128.300" class="difflineplus">+    // 21: zero-length todo that starts at end of range.</span>
<a href="#l128.301"></a><span id="l128.301" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.302"></a><span id="l128.302" class="difflineplus">+    &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.303"></a><span id="l128.303" class="difflineplus">+    &quot;DUE:20020403T010000Z\n&quot; +</span>
<a href="#l128.304"></a><span id="l128.304" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.305"></a><span id="l128.305" class="difflineplus">+    // 22: one-hour todo that ends at start of range.</span>
<a href="#l128.306"></a><span id="l128.306" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.307"></a><span id="l128.307" class="difflineplus">+    &quot;DTSTART:20020401T230000Z\n&quot; +</span>
<a href="#l128.308"></a><span id="l128.308" class="difflineplus">+    &quot;DUE:20020402T000000Z\n&quot; +</span>
<a href="#l128.309"></a><span id="l128.309" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.310"></a><span id="l128.310" class="difflineplus">+    // 23: daily recurring one-hour event. Parent in the range.</span>
<a href="#l128.311"></a><span id="l128.311" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.312"></a><span id="l128.312" class="difflineplus">+    &quot;DTSTART:20020402T000000\n&quot; +</span>
<a href="#l128.313"></a><span id="l128.313" class="difflineplus">+    &quot;DTEND:20020402T010000\n&quot; +</span>
<a href="#l128.314"></a><span id="l128.314" class="difflineplus">+    &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.315"></a><span id="l128.315" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.316"></a><span id="l128.316" class="difflineplus">+    // 24: daily recurring 24-hour event. Parent in the range.</span>
<a href="#l128.317"></a><span id="l128.317" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.318"></a><span id="l128.318" class="difflineplus">+    &quot;DTSTART:20020402T000000\n&quot; +</span>
<a href="#l128.319"></a><span id="l128.319" class="difflineplus">+    &quot;DTEND:20020403T000000\n&quot; +</span>
<a href="#l128.320"></a><span id="l128.320" class="difflineplus">+    &quot;RRULE:FREQ=DAILY;COUNT=10\n&quot; +</span>
<a href="#l128.321"></a><span id="l128.321" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.322"></a><span id="l128.322" class="difflineplus">+    // 25: todo that has neither start nor due date set.</span>
<a href="#l128.323"></a><span id="l128.323" class="difflineplus">+    // Should be returned on every getItems() call. See bug 405459.</span>
<a href="#l128.324"></a><span id="l128.324" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.325"></a><span id="l128.325" class="difflineplus">+    &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.326"></a><span id="l128.326" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.327"></a><span id="l128.327" class="difflineplus">+    // 26: todo that has neither start nor due date but</span>
<a href="#l128.328"></a><span id="l128.328" class="difflineplus">+    // a completion time set after range. See bug 405459.</span>
<a href="#l128.329"></a><span id="l128.329" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.330"></a><span id="l128.330" class="difflineplus">+    &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.331"></a><span id="l128.331" class="difflineplus">+    &quot;COMPLETED:20030404T000001\n&quot; +</span>
<a href="#l128.332"></a><span id="l128.332" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.333"></a><span id="l128.333" class="difflineplus">+    // 27: todo that has neither start nor due date but a</span>
<a href="#l128.334"></a><span id="l128.334" class="difflineplus">+    // completion time set in the range. See bug 405459.</span>
<a href="#l128.335"></a><span id="l128.335" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.336"></a><span id="l128.336" class="difflineplus">+    &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.337"></a><span id="l128.337" class="difflineplus">+    &quot;COMPLETED:20020402T120001\n&quot; +</span>
<a href="#l128.338"></a><span id="l128.338" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.339"></a><span id="l128.339" class="difflineplus">+    // 28: todo that has neither start nor due date but a</span>
<a href="#l128.340"></a><span id="l128.340" class="difflineplus">+    // completion time set before the range. See bug 405459.</span>
<a href="#l128.341"></a><span id="l128.341" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.342"></a><span id="l128.342" class="difflineplus">+    &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.343"></a><span id="l128.343" class="difflineplus">+    &quot;COMPLETED:20020402T000000\n&quot; +</span>
<a href="#l128.344"></a><span id="l128.344" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.345"></a><span id="l128.345" class="difflineplus">+    // 29: todo that has neither start nor due date set,</span>
<a href="#l128.346"></a><span id="l128.346" class="difflineplus">+    // has the status &quot;COMPLETED&quot; but no completion time. See bug 405459.</span>
<a href="#l128.347"></a><span id="l128.347" class="difflineplus">+    &quot;BEGIN:VTODO\n&quot; +</span>
<a href="#l128.348"></a><span id="l128.348" class="difflineplus">+    &quot;SUMMARY:Todo\n&quot; +</span>
<a href="#l128.349"></a><span id="l128.349" class="difflineplus">+    &quot;STATUS:COMPLETED\n&quot; +</span>
<a href="#l128.350"></a><span id="l128.350" class="difflineplus">+    &quot;END:VTODO\n&quot;,</span>
<a href="#l128.351"></a><span id="l128.351" class="difflineplus">+    // 30: one-hour event with duration (in the range). See bug 390492.</span>
<a href="#l128.352"></a><span id="l128.352" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.353"></a><span id="l128.353" class="difflineplus">+    &quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l128.354"></a><span id="l128.354" class="difflineplus">+    &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l128.355"></a><span id="l128.355" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.356"></a><span id="l128.356" class="difflineplus">+    // 31: one-hour event with duration (after the range). See bug 390492.</span>
<a href="#l128.357"></a><span id="l128.357" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.358"></a><span id="l128.358" class="difflineplus">+    &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.359"></a><span id="l128.359" class="difflineplus">+    &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l128.360"></a><span id="l128.360" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.361"></a><span id="l128.361" class="difflineplus">+    // 32: one-hour event with duration (before the range). See bug 390492.</span>
<a href="#l128.362"></a><span id="l128.362" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.363"></a><span id="l128.363" class="difflineplus">+    &quot;DTSTART:20020401T230000Z\n&quot; +</span>
<a href="#l128.364"></a><span id="l128.364" class="difflineplus">+    &quot;DURATION:PT1H\n&quot; +</span>
<a href="#l128.365"></a><span id="l128.365" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.366"></a><span id="l128.366" class="difflineplus">+    // 33: one-day event with duration. Starts in the range, Ends outside. See bug 390492.</span>
<a href="#l128.367"></a><span id="l128.367" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.368"></a><span id="l128.368" class="difflineplus">+    &quot;DTSTART:20020402T120000Z\n&quot; +</span>
<a href="#l128.369"></a><span id="l128.369" class="difflineplus">+    &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.370"></a><span id="l128.370" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.371"></a><span id="l128.371" class="difflineplus">+    // 34: one-day event with duration. Starts before the range. Ends inside. See bug 390492.</span>
<a href="#l128.372"></a><span id="l128.372" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.373"></a><span id="l128.373" class="difflineplus">+    &quot;DTSTART:20020401T120000Z\n&quot; +</span>
<a href="#l128.374"></a><span id="l128.374" class="difflineplus">+    &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.375"></a><span id="l128.375" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.376"></a><span id="l128.376" class="difflineplus">+    // 35: one-day event with duration (before the range). See bug 390492.</span>
<a href="#l128.377"></a><span id="l128.377" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.378"></a><span id="l128.378" class="difflineplus">+    &quot;DTSTART:20020401T000000Z\n&quot; +</span>
<a href="#l128.379"></a><span id="l128.379" class="difflineplus">+    &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.380"></a><span id="l128.380" class="difflineplus">+    &quot;END:VEVENT\n&quot;,</span>
<a href="#l128.381"></a><span id="l128.381" class="difflineplus">+    // 36: one-day event with duration (after the range). See bug 390492.</span>
<a href="#l128.382"></a><span id="l128.382" class="difflineplus">+    &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l128.383"></a><span id="l128.383" class="difflineplus">+    &quot;DTSTART:20020403T000000Z\n&quot; +</span>
<a href="#l128.384"></a><span id="l128.384" class="difflineplus">+    &quot;DURATION:P1D\n&quot; +</span>
<a href="#l128.385"></a><span id="l128.385" class="difflineplus">+    &quot;END:VEVENT\n&quot;</span>
<a href="#l128.386"></a><span id="l128.386" class="difflineplus">+];</span>
<a href="#l128.387"></a><span id="l128.387"> </span>
<a href="#l128.388"></a><span id="l128.388"> function run_test() {</span>
<a href="#l128.389"></a><span id="l128.389">     // First entry is test number, second item is expected result for testGetItems().</span>
<a href="#l128.390"></a><span id="l128.390">     let wantedArray = [[1, 1],</span>
<a href="#l128.391"></a><span id="l128.391">                        [2, 1],</span>
<a href="#l128.392"></a><span id="l128.392">                        [3, 1],</span>
<a href="#l128.393"></a><span id="l128.393">                        [5, 0],</span>
<a href="#l128.394"></a><span id="l128.394">                        [6, 1],</span>
<a href="#l128.395"></a><span id="l128.395" class="difflineat">@@ -243,23 +243,23 @@ function run_test() {</span>
<a href="#l128.396"></a><span id="l128.396">             item = createTodoFromIcalString(calItem);</span>
<a href="#l128.397"></a><span id="l128.397">         }</span>
<a href="#l128.398"></a><span id="l128.398"> </span>
<a href="#l128.399"></a><span id="l128.399">         print(&quot;Test &quot; + wantedArray[i][0]);</span>
<a href="#l128.400"></a><span id="l128.400">         testGetItems(item, itemArray[1]);</span>
<a href="#l128.401"></a><span id="l128.401">         testGetItem(item);</span>
<a href="#l128.402"></a><span id="l128.402">     }</span>
<a href="#l128.403"></a><span id="l128.403"> </span>
<a href="#l128.404"></a><span id="l128.404" class="difflineminus">-   /**</span>
<a href="#l128.405"></a><span id="l128.405" class="difflineminus">-    * Adds aItem to a calendar and performs a getItems() call using the</span>
<a href="#l128.406"></a><span id="l128.406" class="difflineminus">-    * following range:</span>
<a href="#l128.407"></a><span id="l128.407" class="difflineminus">-    *   2002/04/02 0:00 - 2002/04/03 0:00</span>
<a href="#l128.408"></a><span id="l128.408" class="difflineminus">-    * The amount of returned items is compared with expected amount (aResult).</span>
<a href="#l128.409"></a><span id="l128.409" class="difflineminus">-    * Additionally, the properties of the returned item are compared with aItem.</span>
<a href="#l128.410"></a><span id="l128.410" class="difflineminus">-    */</span>
<a href="#l128.411"></a><span id="l128.411" class="difflineplus">+    /**</span>
<a href="#l128.412"></a><span id="l128.412" class="difflineplus">+     * Adds aItem to a calendar and performs a getItems() call using the</span>
<a href="#l128.413"></a><span id="l128.413" class="difflineplus">+     * following range:</span>
<a href="#l128.414"></a><span id="l128.414" class="difflineplus">+     *   2002/04/02 0:00 - 2002/04/03 0:00</span>
<a href="#l128.415"></a><span id="l128.415" class="difflineplus">+     * The amount of returned items is compared with expected amount (aResult).</span>
<a href="#l128.416"></a><span id="l128.416" class="difflineplus">+     * Additionally, the properties of the returned item are compared with aItem.</span>
<a href="#l128.417"></a><span id="l128.417" class="difflineplus">+     */</span>
<a href="#l128.418"></a><span id="l128.418">     function testGetItems(aItem, aResult) {</span>
<a href="#l128.419"></a><span id="l128.419">         for (let calendar of [getStorageCal(), getMemoryCal()]) {</span>
<a href="#l128.420"></a><span id="l128.420">             checkCalendar(calendar, aItem, aResult);</span>
<a href="#l128.421"></a><span id="l128.421">         }</span>
<a href="#l128.422"></a><span id="l128.422">     }</span>
<a href="#l128.423"></a><span id="l128.423"> </span>
<a href="#l128.424"></a><span id="l128.424">     function checkCalendar(calendar, aItem, aResult) {</span>
<a href="#l128.425"></a><span id="l128.425">         // construct range</span>
<a href="#l128.426"></a><span id="l128.426" class="difflineat">@@ -304,22 +304,22 @@ function run_test() {</span>
<a href="#l128.427"></a><span id="l128.427">             }</span>
<a href="#l128.428"></a><span id="l128.428">         };</span>
<a href="#l128.429"></a><span id="l128.429"> </span>
<a href="#l128.430"></a><span id="l128.430">         // add item to calendar</span>
<a href="#l128.431"></a><span id="l128.431">         do_test_pending();</span>
<a href="#l128.432"></a><span id="l128.432">         calendar.addItem(aItem, listener);</span>
<a href="#l128.433"></a><span id="l128.433">     }</span>
<a href="#l128.434"></a><span id="l128.434"> </span>
<a href="#l128.435"></a><span id="l128.435" class="difflineminus">-   /**</span>
<a href="#l128.436"></a><span id="l128.436" class="difflineminus">-    * (1) Add aItem to a calendar.</span>
<a href="#l128.437"></a><span id="l128.437" class="difflineminus">-    * The properties of the added item are compared with the passed item.</span>
<a href="#l128.438"></a><span id="l128.438" class="difflineminus">-    * (2) Perform a getItem() call.</span>
<a href="#l128.439"></a><span id="l128.439" class="difflineminus">-    * The properties of the returned item are compared with the passed item.</span>
<a href="#l128.440"></a><span id="l128.440" class="difflineminus">-    */</span>
<a href="#l128.441"></a><span id="l128.441" class="difflineplus">+    /**</span>
<a href="#l128.442"></a><span id="l128.442" class="difflineplus">+     * (1) Add aItem to a calendar.</span>
<a href="#l128.443"></a><span id="l128.443" class="difflineplus">+     * The properties of the added item are compared with the passed item.</span>
<a href="#l128.444"></a><span id="l128.444" class="difflineplus">+     * (2) Perform a getItem() call.</span>
<a href="#l128.445"></a><span id="l128.445" class="difflineplus">+     * The properties of the returned item are compared with the passed item.</span>
<a href="#l128.446"></a><span id="l128.446" class="difflineplus">+     */</span>
<a href="#l128.447"></a><span id="l128.447">     function testGetItem(aItem) {</span>
<a href="#l128.448"></a><span id="l128.448">         // get calendars</span>
<a href="#l128.449"></a><span id="l128.449">         let calArray = [];</span>
<a href="#l128.450"></a><span id="l128.450">         calArray.push(getStorageCal());</span>
<a href="#l128.451"></a><span id="l128.451">         calArray.push(getMemoryCal());</span>
<a href="#l128.452"></a><span id="l128.452">         for (let calendar of calArray) {</span>
<a href="#l128.453"></a><span id="l128.453">             // implement listener</span>
<a href="#l128.454"></a><span id="l128.454">             let count = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l129.1"></a><span id="l129.1" class="difflineminus">--- a/calendar/test/unit/test_webcal.js</span>
<a href="#l129.2"></a><span id="l129.2" class="difflineplus">+++ b/calendar/test/unit/test_webcal.js</span>
<a href="#l129.3"></a><span id="l129.3" class="difflineat">@@ -5,18 +5,18 @@</span>
<a href="#l129.4"></a><span id="l129.4"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l129.5"></a><span id="l129.5"> Components.utils.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l129.6"></a><span id="l129.6"> Components.utils.import(&quot;resource://testing-common/httpd.js&quot;);</span>
<a href="#l129.7"></a><span id="l129.7"> </span>
<a href="#l129.8"></a><span id="l129.8"> function run_test() {</span>
<a href="#l129.9"></a><span id="l129.9">     let httpserv = new HttpServer();</span>
<a href="#l129.10"></a><span id="l129.10">     httpserv.registerPrefixHandler(&quot;/&quot;, {</span>
<a href="#l129.11"></a><span id="l129.11">         handle: function(request, response) {</span>
<a href="#l129.12"></a><span id="l129.12" class="difflineminus">-          response.setStatusLine(request.httpVersion, 200, &quot;OK&quot;);</span>
<a href="#l129.13"></a><span id="l129.13" class="difflineminus">-          equal(request.path, &quot;/test_webcal&quot;);</span>
<a href="#l129.14"></a><span id="l129.14" class="difflineplus">+            response.setStatusLine(request.httpVersion, 200, &quot;OK&quot;);</span>
<a href="#l129.15"></a><span id="l129.15" class="difflineplus">+            equal(request.path, &quot;/test_webcal&quot;);</span>
<a href="#l129.16"></a><span id="l129.16">         }</span>
<a href="#l129.17"></a><span id="l129.17">     });</span>
<a href="#l129.18"></a><span id="l129.18">     httpserv.start(-1);</span>
<a href="#l129.19"></a><span id="l129.19"> </span>
<a href="#l129.20"></a><span id="l129.20">     let baseUri = &quot;://localhost:&quot; + httpserv.identity.primaryPort + &quot;/test_webcal&quot;;</span>
<a href="#l129.21"></a><span id="l129.21">     add_test(check_webcal_uri.bind(null, &quot;webcal&quot; + baseUri));</span>
<a href="#l129.22"></a><span id="l129.22">     // TODO webcals needs bug 466524 to be fixed</span>
<a href="#l129.23"></a><span id="l129.23">     // add_test(check_webcal_uri.bind(null, &quot;webcals&quot; + baseUri));</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

