<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29374:67ee43e49968f2ccfc9a701dc93d77b2db8858e9</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 67ee43e49968f2ccfc9a701dc93d77b2db8858e9" />
<meta property="og:url" content="/comm-central/rev/67ee43e49968f2ccfc9a701dc93d77b2db8858e9" />
<meta property="og:description" content="Bug 1631019 - Remove old migration code and setup wizard. r=PatrickBrunschwig" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 67ee43e49968f2ccfc9a701dc93d77b2db8858e9 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/67ee43e49968f2ccfc9a701dc93d77b2db8858e9">shortlog</a> |
<a href="/comm-central/log/67ee43e49968f2ccfc9a701dc93d77b2db8858e9">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/67ee43e49968f2ccfc9a701dc93d77b2db8858e9">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/67ee43e49968f2ccfc9a701dc93d77b2db8858e9">files</a> |
changeset |
<a href="/comm-central/raw-rev/67ee43e49968f2ccfc9a701dc93d77b2db8858e9">raw</a>  | <a href="/comm-central/archive/67ee43e49968f2ccfc9a701dc93d77b2db8858e9.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1631019">Bug 1631019</a> - Remove old migration code and setup wizard. r=PatrickBrunschwig
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#97;&#105;&#32;&#69;&#110;&#103;&#101;&#114;&#116;&#32;&#60;&#107;&#97;&#105;&#101;&#64;&#107;&#117;&#105;&#120;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 19 Apr 2020 22:18:14 +0200</td></tr>

<tr>
 <td>changeset 29374</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/67ee43e49968f2ccfc9a701dc93d77b2db8858e9">67ee43e49968f2ccfc9a701dc93d77b2db8858e9</a></td>
</tr>



<tr>
<td>parent 29373</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/743b54aa3cb1ba99c4229936901f2b146b55618d">743b54aa3cb1ba99c4229936901f2b146b55618d</a>
</td>
</tr>

<tr>
<td>child 29375</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f0676c4790a181e102e26c54b13a526d33e0e63c">f0676c4790a181e102e26c54b13a526d33e0e63c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=67ee43e49968f2ccfc9a701dc93d77b2db8858e9">17332</a></td></tr>
<tr><td>push user</td><td>kaie@kuix.de</td></tr>
<tr><td>push date</td><td class="date age">Wed, 22 Apr 2020 17:09:13 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@f0676c4790a1 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f0676c4790a181e102e26c54b13a526d33e0e63c">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=f0676c4790a181e102e26c54b13a526d33e0e63c&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f0676c4790a181e102e26c54b13a526d33e0e63c&newProject=comm-central&newRevision=804e09a2b5711c710984702bfca2551ac7d4e24d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f0676c4790a181e102e26c54b13a526d33e0e63c&newProject=comm-central&newRevision=804e09a2b5711c710984702bfca2551ac7d4e24d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=f0676c4790a181e102e26c54b13a526d33e0e63c&newProject=comm-central&newRevision=804e09a2b5711c710984702bfca2551ac7d4e24d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28PatrickBrunschwig%29&revcount=50">PatrickBrunschwig</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1631019">1631019</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1631019">Bug 1631019</a> - Remove old migration code and setup wizard. r=PatrickBrunschwig

Differential Revision: <a href="https://phabricator.services.mozilla.com/D71898">https://phabricator.services.mozilla.com/D71898</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/am-e2e/prefs/e2e-prefs.js">mail/extensions/am-e2e/prefs/e2e-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/am-e2e/prefs/e2e-prefs.js">file</a> |
<a href="/comm-central/annotate/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/am-e2e/prefs/e2e-prefs.js">annotate</a> |
<a href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/am-e2e/prefs/e2e-prefs.js">diff</a> |
<a href="/comm-central/comparison/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/am-e2e/prefs/e2e-prefs.js">comparison</a> |
<a href="/comm-central/log/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/am-e2e/prefs/e2e-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/configure.jsm">mail/extensions/openpgp/content/modules/configure.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/configure.jsm">file</a> |
<a href="/comm-central/annotate/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/configure.jsm">annotate</a> |
<a href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/configure.jsm">diff</a> |
<a href="/comm-central/comparison/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/configure.jsm">comparison</a> |
<a href="/comm-central/log/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/configure.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/core.jsm">mail/extensions/openpgp/content/modules/core.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/core.jsm">file</a> |
<a href="/comm-central/annotate/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/core.jsm">annotate</a> |
<a href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/core.jsm">diff</a> |
<a href="/comm-central/comparison/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/core.jsm">comparison</a> |
<a href="/comm-central/log/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/core.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">mail/extensions/openpgp/content/modules/stdlib/misc.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">file</a> |
<a href="/comm-central/annotate/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">annotate</a> |
<a href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">diff</a> |
<a href="/comm-central/comparison/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">comparison</a> |
<a href="/comm-central/log/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/stdlib/misc.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/windows.jsm">mail/extensions/openpgp/content/modules/windows.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/windows.jsm">file</a> |
<a href="/comm-central/annotate/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/windows.jsm">annotate</a> |
<a href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/windows.jsm">diff</a> |
<a href="/comm-central/comparison/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/windows.jsm">comparison</a> |
<a href="/comm-central/log/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/modules/windows.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/strings/enigmail.properties">mail/extensions/openpgp/content/strings/enigmail.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/strings/enigmail.properties">file</a> |
<a href="/comm-central/annotate/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/strings/enigmail.properties">annotate</a> |
<a href="/comm-central/diff/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/strings/enigmail.properties">diff</a> |
<a href="/comm-central/comparison/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/strings/enigmail.properties">comparison</a> |
<a href="/comm-central/log/67ee43e49968f2ccfc9a701dc93d77b2db8858e9/mail/extensions/openpgp/content/strings/enigmail.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/extensions/am-e2e/prefs/e2e-prefs.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/extensions/am-e2e/prefs/e2e-prefs.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -21,19 +21,16 @@ pref(&quot;mail.identity.default.signing_cert</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> /**</span>
<a href="#l1.6"></a><span id="l1.6">  * OpenPGP prefs</span>
<a href="#l1.7"></a><span id="l1.7">  */</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> pref(&quot;mail.identity.default.openpgp_key_id&quot;, &quot;&quot;);</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-// the last configured Enigmail version</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-pref(&quot;temp.openpgp.configuredVersion&quot;, &quot;&quot;);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-</span>
<a href="#l1.15"></a><span id="l1.15"> // Hide prefs and menu entries from non-advanced users</span>
<a href="#l1.16"></a><span id="l1.16"> pref(&quot;temp.openpgp.advancedUser&quot;, false);</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> // ** enigmail keySel preferences:</span>
<a href="#l1.19"></a><span id="l1.19"> // use rules to assign keys</span>
<a href="#l1.20"></a><span id="l1.20"> pref(&quot;temp.openpgp.assignKeysByRules&quot;, true);</span>
<a href="#l1.21"></a><span id="l1.21"> // use email addresses to assign keys</span>
<a href="#l1.22"></a><span id="l1.22"> pref(&quot;temp.openpgp.assignKeysByEmailAddr&quot;, true);</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -70,19 +67,16 @@ pref(&quot;temp.openpgp.encryptAttachmentsSki</span>
<a href="#l1.24"></a><span id="l1.24"> pref(&quot;temp.openpgp.encryptToSelf&quot;, true);</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26"> // enable 'Decrypt &amp; open' for double click on attachment (if possible)</span>
<a href="#l1.27"></a><span id="l1.27"> pref(&quot;temp.openpgp.handleDoubleClick&quot;, true);</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29"> // disable '&lt;' and '&gt;' around email addresses</span>
<a href="#l1.30"></a><span id="l1.30"> pref(&quot;temp.openpgp.hushMailSupport&quot;, false);</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-// display alert for 'failed to initialize enigmime'</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-pref(&quot;temp.openpgp.initAlert&quot;, true);</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-</span>
<a href="#l1.35"></a><span id="l1.35"> // use -a for encrypting attachments for inline PGP</span>
<a href="#l1.36"></a><span id="l1.36"> pref(&quot;temp.openpgp.inlineAttachAsciiArmor&quot;, false);</span>
<a href="#l1.37"></a><span id="l1.37"> </span>
<a href="#l1.38"></a><span id="l1.38"> // extension to append for inline-encrypted attachments</span>
<a href="#l1.39"></a><span id="l1.39"> pref(&quot;temp.openpgp.inlineAttachExt&quot;, &quot;.pgp&quot;);</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41"> // extension to append for inline-signed attachments</span>
<a href="#l1.42"></a><span id="l1.42"> pref(&quot;temp.openpgp.inlineSigAttachExt&quot;, &quot;.sig&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/configure.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/configure.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3,21 +3,20 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.5"></a><span id="l2.5">  * file, You can obtain one at https://mozilla.org/MPL/2.0/.</span>
<a href="#l2.6"></a><span id="l2.6">  */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> &quot;use strict&quot;;</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> var EXPORTED_SYMBOLS = [&quot;EnigmailConfigure&quot;];</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-</span>
<a href="#l2.14"></a><span id="l2.14"> const { EnigmailLog } = ChromeUtils.import(</span>
<a href="#l2.15"></a><span id="l2.15">   &quot;chrome://openpgp/content/modules/log.jsm&quot;</span>
<a href="#l2.16"></a><span id="l2.16"> );</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+/*</span>
<a href="#l2.18"></a><span id="l2.18"> const { EnigmailPrefs } = ChromeUtils.import(</span>
<a href="#l2.19"></a><span id="l2.19">   &quot;chrome://openpgp/content/modules/prefs.jsm&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> );</span>
<a href="#l2.21"></a><span id="l2.21"> const { EnigmailTimer } = ChromeUtils.import(</span>
<a href="#l2.22"></a><span id="l2.22">   &quot;chrome://openpgp/content/modules/timer.jsm&quot;</span>
<a href="#l2.23"></a><span id="l2.23"> );</span>
<a href="#l2.24"></a><span id="l2.24"> const { EnigmailApp } = ChromeUtils.import(</span>
<a href="#l2.25"></a><span id="l2.25">   &quot;chrome://openpgp/content/modules/app.jsm&quot;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineat">@@ -44,287 +43,30 @@ const { EnigmailLazy } = ChromeUtils.imp</span>
<a href="#l2.27"></a><span id="l2.27">   &quot;chrome://openpgp/content/modules/lazy.jsm&quot;</span>
<a href="#l2.28"></a><span id="l2.28"> );</span>
<a href="#l2.29"></a><span id="l2.29"> const { EnigmailAutoSetup } = ChromeUtils.import(</span>
<a href="#l2.30"></a><span id="l2.30">   &quot;chrome://openpgp/content/modules/autoSetup.jsm&quot;</span>
<a href="#l2.31"></a><span id="l2.31"> );</span>
<a href="#l2.32"></a><span id="l2.32"> const { MailServices } = ChromeUtils.import(</span>
<a href="#l2.33"></a><span id="l2.33">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l2.34"></a><span id="l2.34"> );</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-/**</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">- * Upgrade sending prefs</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">- * (v1.6.x -&gt; v1.7 )</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">- */</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-function upgradePrefsSending() {</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-  EnigmailLog.DEBUG(&quot;enigmailCommon.jsm: upgradePrefsSending()\n&quot;);</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-  var cbs = EnigmailPrefs.getPref(&quot;confirmBeforeSend&quot;);</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-  var ats = EnigmailPrefs.getPref(&quot;alwaysTrustSend&quot;);</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-  var ksfr = EnigmailPrefs.getPref(&quot;keepSettingsForReply&quot;);</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-  EnigmailLog.DEBUG(</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-    &quot;enigmailCommon.jsm: upgradePrefsSending cbs=&quot; +</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-      cbs +</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-      &quot; ats=&quot; +</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-      ats +</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-      &quot; ksfr=&quot; +</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-      ksfr +</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-      &quot;\n&quot;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-  );</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-  // Upgrade confirmBeforeSend (bool) to confirmBeforeSending (int)</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-  switch (cbs) {</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-    case false:</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-      EnigmailPrefs.setPref(&quot;confirmBeforeSending&quot;, 0); // never</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-      break;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-    case true:</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-      EnigmailPrefs.setPref(&quot;confirmBeforeSending&quot;, 1); // always</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-      break;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-  }</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-  // Upgrade alwaysTrustSend (bool)   to acceptedKeys (int)</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-  switch (ats) {</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-    case false:</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-      EnigmailPrefs.setPref(&quot;acceptedKeys&quot;, 0); // valid</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-      break;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-    case true:</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-      EnigmailPrefs.setPref(&quot;acceptedKeys&quot;, 1); // all</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-      break;</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-  }</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-  // if all settings are default settings, use convenient encryption</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-  if (cbs === false &amp;&amp; ats === true &amp;&amp; ksfr === true) {</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-    EnigmailPrefs.setPref(&quot;encryptionModel&quot;, 0); // convenient</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-    EnigmailLog.DEBUG(</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-      &quot;enigmailCommon.jsm: upgradePrefsSending() encryptionModel=0 (convenient)\n&quot;</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-    );</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-  } else {</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-    EnigmailPrefs.setPref(&quot;encryptionModel&quot;, 1); // manually</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-    EnigmailLog.DEBUG(</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-      &quot;enigmailCommon.jsm: upgradePrefsSending() encryptionModel=1 (manually)\n&quot;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-    );</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-  }</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-  // clear old prefs</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-  EnigmailPrefs.getPrefBranch().clearUserPref(&quot;confirmBeforeSend&quot;);</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-  EnigmailPrefs.getPrefBranch().clearUserPref(&quot;alwaysTrustSend&quot;);</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-}</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-/**</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">- * Replace short key IDs with FPR in identity settings</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">- * (v1.9 -&gt; v2.0)</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">- */</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-function replaceKeyIdWithFpr() {</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-  try {</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-    const GetKeyRing = EnigmailLazy.loader(</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-      &quot;enigmail/keyRing.jsm&quot;,</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-      &quot;EnigmailKeyRing&quot;</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-    );</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-    for (let id of MailServices.accounts.allIdentities) {</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-      if (id.getBoolAttribute(&quot;enablePgp&quot;)) {</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-        let keyId = id.getCharAttribute(&quot;pgpkeyId&quot;);</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-        if (keyId.search(/^(0x)?[a-fA-F0-9]{8}$/) === 0) {</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-          EnigmailCore.getService();</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-          let k = GetKeyRing().getKeyById(keyId);</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-          if (k) {</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-            id.setCharAttribute(&quot;pgpkeyId&quot;, &quot;0x&quot; + k.fpr);</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-          } else {</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-            id.setCharAttribute(&quot;pgpkeyId&quot;, &quot;&quot;);</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineminus">-          }</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-        }</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-      }</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-    }</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-  } catch (ex) {</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-    EnigmailDialog.alert(&quot;config upgrade: error&quot; + ex.toString());</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-  }</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-}</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-/**</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">- * Change the default to PGP/MIME for all accounts, except nntp</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">- * (v1.8.x -&gt; v1.9)</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineminus">- */</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-function defaultPgpMime() {</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineminus">-  let changedSomething = false;</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineminus">-</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineminus">-  for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineminus">-    if (ac.incomingServer.type.search(/(pop3|imap|movemail)/) &gt;= 0) {</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-      for (let id of ac.identities) {</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-        if (</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-          id.getBoolAttribute(&quot;enablePgp&quot;) &amp;&amp;</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-          !id.getBoolAttribute(&quot;pgpMimeMode&quot;)</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-        ) {</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-          changedSomething = true;</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-        }</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-        id.setBoolAttribute(&quot;pgpMimeMode&quot;, true);</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-      }</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-    }</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-  }</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-  if (EnigmailPrefs.getPref(&quot;advancedUser&quot;) &amp;&amp; changedSomething) {</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-    EnigmailDialog.alert(</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-      null,</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-      EnigmailLocale.getString(&quot;preferences.defaultToPgpMime&quot;)</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-    );</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-  }</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-}</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-/**</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">- * set the Autocrypt prefer-encrypt option to &quot;mutual&quot; for all existing</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">- * accounts</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineminus">- */</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-function setAutocryptForOldAccounts() {</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-  try {</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-    for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-      if (ac.incomingServer.type.search(/(pop3|imap|movemail)/) &gt;= 0) {</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-        ac.incomingServer.setIntValue(&quot;acPreferEncrypt&quot;, 1);</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-      }</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-    }</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-  } catch (ex) {}</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineminus">-}</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-function setDefaultKeyServer() {</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineminus">-  EnigmailLog.DEBUG(&quot;configure.jsm: setDefaultKeyServer()\n&quot;);</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineminus">-</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineminus">-  let ks = EnigmailPrefs.getPref(&quot;keyserver&quot;);</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineminus">-</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineminus">-  if (ks.search(/^ldaps?:\/\//) &lt; 0) {</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineminus">-    ks = &quot;vks://keys.openpgp.org, &quot; + ks;</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineminus">-  }</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineminus">-</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineminus">-  ks = ks.replace(/hkps:\/\/keys.openpgp.org/g, &quot;vks://keys.openpgp.org&quot;);</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineminus">-  EnigmailPrefs.setPref(&quot;keyserver&quot;, ks);</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineminus">-}</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineminus">-</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineminus">-function displayUpgradeInfo() {</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineminus">-  EnigmailLog.DEBUG(&quot;configure.jsm: displayUpgradeInfo()\n&quot;);</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineminus">-  try {</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineminus">-    EnigmailWindows.openMailTab(&quot;chrome://openpgp/content/ui/upgradeInfo.html&quot;);</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineminus">-  } catch (ex) {}</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineminus">-}</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+*/</span>
<a href="#l2.189"></a><span id="l2.189"> </span>
<a href="#l2.190"></a><span id="l2.190"> var EnigmailConfigure = {</span>
<a href="#l2.191"></a><span id="l2.191">   /**</span>
<a href="#l2.192"></a><span id="l2.192">    * configureEnigmail: main function for configuring Enigmail during the first run</span>
<a href="#l2.193"></a><span id="l2.193">    * this method is called from core.jsm if Enigmail has not been set up before</span>
<a href="#l2.194"></a><span id="l2.194">    * (determined via checking the configuredVersion in the preferences)</span>
<a href="#l2.195"></a><span id="l2.195">    *</span>
<a href="#l2.196"></a><span id="l2.196">    * @param {nsIWindow} win:                 The parent window. Null if no parent window available</span>
<a href="#l2.197"></a><span id="l2.197">    * @param {Boolean}   startingPreferences: if true, called while switching to new preferences</span>
<a href="#l2.198"></a><span id="l2.198">    *                        (to avoid re-check for preferences)</span>
<a href="#l2.199"></a><span id="l2.199">    *</span>
<a href="#l2.200"></a><span id="l2.200">    * @return {Promise&lt;null&gt;}</span>
<a href="#l2.201"></a><span id="l2.201">    */</span>
<a href="#l2.202"></a><span id="l2.202">   async configureEnigmail(win, startingPreferences) {</span>
<a href="#l2.203"></a><span id="l2.203">     EnigmailLog.DEBUG(&quot;configure.jsm: configureEnigmail()\n&quot;);</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineminus">-    if (!EnigmailStdlib.hasConfiguredAccounts()) {</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineminus">-      EnigmailLog.DEBUG(</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-        &quot;configure.jsm: configureEnigmail: no account configured. Waiting 60 seconds.\n&quot;</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineminus">-      );</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineminus">-</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineminus">-      // try again in 60 seconds</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineminus">-      EnigmailTimer.setTimeout(function() {</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineminus">-        EnigmailConfigure.configureEnigmail(win, startingPreferences);</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineminus">-      }, 60000);</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineminus">-      return;</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineminus">-    }</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineminus">-</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineminus">-    let oldVer = EnigmailPrefs.getPref(&quot;configuredVersion&quot;);</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineminus">-</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineminus">-    if (oldVer === &quot;&quot;) {</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineminus">-      try {</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineminus">-        await EnigmailAutoSetup.determinePreviousInstallType();</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineminus">-</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineminus">-        switch (EnigmailAutoSetup.value) {</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineminus">-          case EnigmailConstants.AUTOSETUP_NOT_INITIALIZED:</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineminus">-          case EnigmailConstants.AUTOSETUP_NO_ACCOUNT:</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-            break;</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineminus">-          default:</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineminus">-            EnigmailPrefs.setPref(</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-              &quot;configuredVersion&quot;,</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineminus">-              EnigmailApp.getVersion()</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineminus">-            );</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineminus">-            EnigmailWindows.openSetupWizard(win);</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineminus">-        }</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineminus">-      } catch (x) {</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineminus">-        // ignore exceptions and proceed without setup wizard</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineminus">-      }</span>
<a href="#l2.237"></a><span id="l2.237" class="difflineminus">-    } else {</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineminus">-      if (Services.vc.compare(oldVer, &quot;1.7a1pre&quot;) &lt; 0) {</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineminus">-        // 1: rules only</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineminus">-        //     =&gt; assignKeysByRules true; rest false</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineminus">-        // 2: rules &amp; email addresses (normal)</span>
<a href="#l2.242"></a><span id="l2.242" class="difflineminus">-        //     =&gt; assignKeysByRules/assignKeysByEmailAddr/assignKeysManuallyIfMissing true</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineminus">-        // 3: email address only (no rules)</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-        //     =&gt; assignKeysByEmailAddr/assignKeysManuallyIfMissing true</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineminus">-        // 4: manually (always prompt, no rules)</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineminus">-        //     =&gt; assignKeysManuallyAlways true</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineminus">-        // 5: no rules, no key selection</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineminus">-        //     =&gt; assignKeysByRules/assignKeysByEmailAddr true</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineplus">+    // TODO: one time migration from enigmail</span>
<a href="#l2.250"></a><span id="l2.250"> </span>
<a href="#l2.251"></a><span id="l2.251" class="difflineminus">-        upgradePrefsSending();</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineminus">-      }</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineminus">-      if (Services.vc.compare(oldVer, &quot;1.7&quot;) &lt; 0) {</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineminus">-        // open a modal dialog. Since this might happen during the opening of another</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineminus">-        // window, we have to do this asynchronously</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineminus">-        EnigmailTimer.setTimeout(function() {</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineminus">-          var doIt = EnigmailDialog.confirmDlg(</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineminus">-            win,</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineminus">-            EnigmailLocale.getString(</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineminus">-              &quot;enigmailCommon.versionSignificantlyChanged&quot;</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineminus">-            ),</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineminus">-            EnigmailLocale.getString(&quot;enigmailCommon.checkPreferences&quot;),</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineminus">-            EnigmailLocale.getString(&quot;dlg.button.close&quot;)</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineminus">-          );</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineminus">-          if (!startingPreferences &amp;&amp; doIt) {</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineminus">-            // same as:</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineminus">-            // - EnigmailWindows.openPrefWindow(window, true, 'sendingTab');</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineminus">-            // but</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineminus">-            // - without starting the service again because we do that right now</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-            // - and modal (waiting for its end)</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineminus">-            win.openDialog(</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-              &quot;chrome://openpgp/content/ui/pref-enigmail.xhtml&quot;,</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-              &quot;_blank&quot;,</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineminus">-              &quot;chrome,resizable=yes,modal&quot;,</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineminus">-              {</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineminus">-                showBasic: true,</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineminus">-                clientType: &quot;thunderbird&quot;,</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineminus">-                selectTab: &quot;sendingTab&quot;,</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineminus">-              }</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineminus">-            );</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineminus">-          }</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineminus">-        }, 100);</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-      }</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineminus">-</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineminus">-      if (Services.vc.compare(oldVer, &quot;1.9a2pre&quot;) &lt; 0) {</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-        defaultPgpMime();</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineminus">-      }</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineminus">-      if (Services.vc.compare(oldVer, &quot;2.0a1pre&quot;) &lt; 0) {</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-        this.upgradeTo20();</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineminus">-      }</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineminus">-      if (Services.vc.compare(oldVer, &quot;2.0.1a2pre&quot;) &lt; 0) {</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineminus">-        this.upgradeTo201();</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineminus">-      }</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineminus">-      if (Services.vc.compare(oldVer, &quot;2.1b2&quot;) &lt; 0) {</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineminus">-        this.upgradeTo21();</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineminus">-      }</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineminus">-    }</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineminus">-</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineminus">-    EnigmailPrefs.setPref(&quot;configuredVersion&quot;, EnigmailApp.getVersion());</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineminus">-    EnigmailPrefs.savePrefs();</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineminus">-  },</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineminus">-</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineminus">-  upgradeTo20() {</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineminus">-    replaceKeyIdWithFpr();</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineminus">-    displayUpgradeInfo();</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineminus">-  },</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineminus">-</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineminus">-  upgradeTo201() {</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineminus">-    setAutocryptForOldAccounts();</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineminus">-  },</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineminus">-</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineminus">-  upgradeTo21() {</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineminus">-    setDefaultKeyServer();</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineplus">+    //EnigmailPrefs.setPref(&quot;configuredVersion&quot;, EnigmailApp.getVersion());</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineplus">+    //EnigmailPrefs.savePrefs();</span>
<a href="#l2.316"></a><span id="l2.316">   },</span>
<a href="#l2.317"></a><span id="l2.317"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/core.jsm</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/core.jsm</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -46,20 +46,22 @@ const getEnigmailPrefs = EnigmailLazy.lo</span>
<a href="#l3.4"></a><span id="l3.4"> const getEnigmailVerify = EnigmailLazy.loader(</span>
<a href="#l3.5"></a><span id="l3.5">   &quot;enigmail/mimeVerify.jsm&quot;,</span>
<a href="#l3.6"></a><span id="l3.6">   &quot;EnigmailVerify&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> );</span>
<a href="#l3.8"></a><span id="l3.8"> const getEnigmailWindows = EnigmailLazy.loader(</span>
<a href="#l3.9"></a><span id="l3.9">   &quot;enigmail/windows.jsm&quot;,</span>
<a href="#l3.10"></a><span id="l3.10">   &quot;EnigmailWindows&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> );</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+/*</span>
<a href="#l3.13"></a><span id="l3.13"> const getEnigmailDialog = EnigmailLazy.loader(</span>
<a href="#l3.14"></a><span id="l3.14">   &quot;enigmail/dialog.jsm&quot;,</span>
<a href="#l3.15"></a><span id="l3.15">   &quot;EnigmailDialog&quot;</span>
<a href="#l3.16"></a><span id="l3.16"> );</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+*/</span>
<a href="#l3.18"></a><span id="l3.18"> const getEnigmailConfigure = EnigmailLazy.loader(</span>
<a href="#l3.19"></a><span id="l3.19">   &quot;enigmail/configure.jsm&quot;,</span>
<a href="#l3.20"></a><span id="l3.20">   &quot;EnigmailConfigure&quot;</span>
<a href="#l3.21"></a><span id="l3.21"> );</span>
<a href="#l3.22"></a><span id="l3.22"> const getEnigmailApp = EnigmailLazy.loader(&quot;enigmail/app.jsm&quot;, &quot;EnigmailApp&quot;);</span>
<a href="#l3.23"></a><span id="l3.23"> //const getEnigmailWksMimeHandler = EnigmailLazy.loader(</span>
<a href="#l3.24"></a><span id="l3.24"> //  &quot;enigmail/wksMimeHandler.jsm&quot;,</span>
<a href="#l3.25"></a><span id="l3.25"> //  &quot;EnigmailWksMimeHandler&quot;</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineat">@@ -462,82 +464,25 @@ Enigmail.prototype = {</span>
<a href="#l3.27"></a><span id="l3.27">   getService(win, startingPreferences) {</span>
<a href="#l3.28"></a><span id="l3.28">     if (!win) {</span>
<a href="#l3.29"></a><span id="l3.29">       win = getEnigmailWindows().getBestParentWin();</span>
<a href="#l3.30"></a><span id="l3.30">     }</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32">     getEnigmailLog().DEBUG(&quot;core.jsm: svc = &quot; + this + &quot;\n&quot;);</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34">     if (!this.initialized) {</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-      const firstInitialization = !this.initializationAttempted;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-      try {</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-        // Initialize enigmail</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-        let app = getEnigmailApp();</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-        app.initAddon();</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-        EnigmailCore.init(app.getVersion());</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-        this.initialize(win, app.getVersion());</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-        try {</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-          // Reset alert count to default value</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-          getEnigmailPrefs()</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-            .getPrefBranch()</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-            .clearUserPref(&quot;initAlert&quot;);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-        } catch (ex) {}</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-      } catch (ex) {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-        if (firstInitialization) {</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-          // Display initialization error alert</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-          const errMsg =</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-            (this.initializationError</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-              ? this.initializationError</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-              : getEnigmailLocale().getString(&quot;accessError&quot;)) +</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-            &quot;\n\n&quot; +</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-            getEnigmailLocale().getString(&quot;initErr.howToFixIt&quot;);</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-          const checkedObj = {</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-            value: false,</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-          };</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-          if (getEnigmailPrefs().getPref(&quot;initAlert&quot;)) {</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-            const r = getEnigmailDialog().longAlert(</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-              win,</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-              &quot;Enigmail: &quot; + errMsg,</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-              getEnigmailLocale().getString(&quot;dlgNoPrompt&quot;),</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-              null,</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-              getEnigmailLocale().getString(&quot;initErr.setupWizard.button&quot;),</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-              null,</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-              checkedObj</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-            );</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-            if (r &gt;= 0 &amp;&amp; checkedObj.value) {</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-              getEnigmailPrefs().setPref(&quot;initAlert&quot;, false);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-            }</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-            if (r == 1) {</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-              // start setup wizard</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-              getEnigmailWindows().openSetupWizard(win, false);</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-              return Enigmail.getService(win);</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-            }</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-          }</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-          if (getEnigmailPrefs().getPref(&quot;initAlert&quot;)) {</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-            this.initializationAttempted = false;</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-            gEnigmailService = null;</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-          }</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-        }</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-        return null;</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-      }</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+      // Initialize enigmail</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+      let app = getEnigmailApp();</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+      app.initAddon();</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+      EnigmailCore.init(app.getVersion());</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+      this.initialize(win, app.getVersion());</span>
<a href="#l3.95"></a><span id="l3.95"> </span>
<a href="#l3.96"></a><span id="l3.96">       const configuredVersion = getEnigmailPrefs().getPref(&quot;configuredVersion&quot;);</span>
<a href="#l3.97"></a><span id="l3.97"> </span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-      getEnigmailLog().DEBUG(</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-        &quot;core.jsm: getService: last used version: &quot; + configuredVersion + &quot;\n&quot;</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-      );</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineminus">-</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-      if (</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-        this.initialized &amp;&amp;</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-        getEnigmailApp().getVersion() != configuredVersion</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-      ) {</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+      if (this.initialized &amp;&amp; configuredVersion !== &quot;&quot;) {</span>
<a href="#l3.107"></a><span id="l3.107">         getEnigmailConfigure().configureEnigmail(win, startingPreferences);</span>
<a href="#l3.108"></a><span id="l3.108">       }</span>
<a href="#l3.109"></a><span id="l3.109">     }</span>
<a href="#l3.110"></a><span id="l3.110"> </span>
<a href="#l3.111"></a><span id="l3.111">     EnigmailCore.startup(0);</span>
<a href="#l3.112"></a><span id="l3.112">     getEnigmailPgpmimeHander().startup(0);</span>
<a href="#l3.113"></a><span id="l3.113">     return this.initialized ? this : null;</span>
<a href="#l3.114"></a><span id="l3.114">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/stdlib/misc.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/stdlib/misc.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -10,18 +10,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> var EXPORTED_SYMBOLS = [</span>
<a href="#l4.6"></a><span id="l4.6">   // Identity management helpers</span>
<a href="#l4.7"></a><span id="l4.7">   &quot;gIdentities&quot;,</span>
<a href="#l4.8"></a><span id="l4.8">   &quot;fillIdentities&quot;,</span>
<a href="#l4.9"></a><span id="l4.9">   &quot;getIdentities&quot;,</span>
<a href="#l4.10"></a><span id="l4.10">   &quot;getDefaultIdentity&quot;,</span>
<a href="#l4.11"></a><span id="l4.11">   &quot;getIdentityForEmail&quot;,</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  // Account management helpers:</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-  &quot;hasConfiguredAccounts&quot;,</span>
<a href="#l4.14"></a><span id="l4.14">   // JS programming helpers</span>
<a href="#l4.15"></a><span id="l4.15">   &quot;range&quot;,</span>
<a href="#l4.16"></a><span id="l4.16">   &quot;MixIn&quot;,</span>
<a href="#l4.17"></a><span id="l4.17">   &quot;combine&quot;,</span>
<a href="#l4.18"></a><span id="l4.18">   &quot;entries&quot;,</span>
<a href="#l4.19"></a><span id="l4.19">   // XPCOM helpers</span>
<a href="#l4.20"></a><span id="l4.20">   &quot;NS_FAILED&quot;,</span>
<a href="#l4.21"></a><span id="l4.21">   &quot;NS_SUCCEEDED&quot;,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -404,24 +402,8 @@ function systemCharset() {</span>
<a href="#l4.23"></a><span id="l4.23"> }</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25"> function combine(a1, a2) {</span>
<a href="#l4.26"></a><span id="l4.26">   if (a1.length != a2.length) {</span>
<a href="#l4.27"></a><span id="l4.27">     throw new Error(&quot;combine: the given arrays have different lengths&quot;);</span>
<a href="#l4.28"></a><span id="l4.28">   }</span>
<a href="#l4.29"></a><span id="l4.29">   return [...range(0, a1.length)].map(i =&gt; [a1[i], a2[i]]);</span>
<a href="#l4.30"></a><span id="l4.30"> }</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-/**</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">- * Determine if at least one account / identity is configured</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">- * @return {Bool}</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">- */</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-function hasConfiguredAccounts() {</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-  for (let ac of MailServices.accounts.accounts) {</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-    if (ac.incomingServer.type !== &quot;none&quot;) {</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-      if (ac.defaultIdentity.email.length &gt; 0) {</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-        return true;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-      }</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-    }</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-  }</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-  return false;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/windows.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/windows.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -23,41 +23,16 @@ const { EnigmailKeyRing } = ChromeUtils.</span>
<a href="#l5.4"></a><span id="l5.4">   &quot;chrome://openpgp/content/modules/keyRing.jsm&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> );</span>
<a href="#l5.6"></a><span id="l5.6"> const { EnigmailStdlib } = ChromeUtils.import(</span>
<a href="#l5.7"></a><span id="l5.7">   &quot;chrome://openpgp/content/modules/stdlib.jsm&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> );</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10"> var EnigmailWindows = {</span>
<a href="#l5.11"></a><span id="l5.11">   /**</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-   * Display the OpenPGP setup wizard window</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-   *</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-   * win      : nsIWindow - the parent window</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-   * skipIntro: Boolean   - optional, if true, skip the introduction page</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-   *</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-   * no return value</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-   */</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-  openSetupWizard(win, setupType) {</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-    EnigmailLog.DEBUG(&quot;windows.jsm: openSetupWizard()\n&quot;);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-    if (!EnigmailStdlib.hasConfiguredAccounts()) {</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-      EnigmailLog.DEBUG(</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-        &quot;windows.jsm: openSetupWizard: no configured accounts\n&quot;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-      );</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-      return;</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-    }</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-    win.open(</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-      &quot;chrome://openpgp/content/ui/setupWizard2.xhtml&quot;,</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-      &quot;&quot;,</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-      &quot;chrome,centerscreen,resizable&quot;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-    );</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-  },</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-  /**</span>
<a href="#l5.37"></a><span id="l5.37">    * Open a window, or focus it if it is already open</span>
<a href="#l5.38"></a><span id="l5.38">    *</span>
<a href="#l5.39"></a><span id="l5.39">    * @winName   : String - name of the window; used to identify if it is already open</span>
<a href="#l5.40"></a><span id="l5.40">    * @spec      : String - window URL (e.g. chrome://openpgp/content/ui/test.xhtml)</span>
<a href="#l5.41"></a><span id="l5.41">    * @winOptions: String - window options as defined in nsIWindow.open</span>
<a href="#l5.42"></a><span id="l5.42">    * @optObj    : any    - an Object, Array, String, etc. that is passed as parameter</span>
<a href="#l5.43"></a><span id="l5.43">    *                       to the window</span>
<a href="#l5.44"></a><span id="l5.44">    */</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineat">@@ -156,27 +131,16 @@ var EnigmailWindows = {</span>
<a href="#l5.46"></a><span id="l5.46">     EnigmailWindows.openWin(</span>
<a href="#l5.47"></a><span id="l5.47">       &quot;enigmail:help&quot;,</span>
<a href="#l5.48"></a><span id="l5.48">       &quot;chrome://openpgp/content/ui/enigmailHelp.xhtml?src=&quot; + source,</span>
<a href="#l5.49"></a><span id="l5.49">       &quot;centerscreen,resizable&quot;</span>
<a href="#l5.50"></a><span id="l5.50">     );</span>
<a href="#l5.51"></a><span id="l5.51">   },</span>
<a href="#l5.52"></a><span id="l5.52"> </span>
<a href="#l5.53"></a><span id="l5.53">   /**</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-   * Display the &quot;About Enigmail&quot; window</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-   *</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-   * no return value</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-   */</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-  openAboutWindow() {</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-    EnigmailWindows.openMailTab(</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-      &quot;chrome://openpgp/content/ui/aboutEnigmail.html&quot;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-    );</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-  },</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-  /**</span>
<a href="#l5.65"></a><span id="l5.65">    * Open the Enigmail Documentation page in a new window</span>
<a href="#l5.66"></a><span id="l5.66">    *</span>
<a href="#l5.67"></a><span id="l5.67">    * no return value</span>
<a href="#l5.68"></a><span id="l5.68">    */</span>
<a href="#l5.69"></a><span id="l5.69">   openEnigmailDocu(parent) {</span>
<a href="#l5.70"></a><span id="l5.70">     if (!parent) {</span>
<a href="#l5.71"></a><span id="l5.71">       parent = this.getMostRecentWindow();</span>
<a href="#l5.72"></a><span id="l5.72">     }</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineat">@@ -296,41 +260,16 @@ var EnigmailWindows = {</span>
<a href="#l5.74"></a><span id="l5.74">       &quot;enigmail:logFile&quot;,</span>
<a href="#l5.75"></a><span id="l5.75">       &quot;chrome://openpgp/content/ui/enigmailViewFile.xhtml?viewLog=1&amp;title=&quot; +</span>
<a href="#l5.76"></a><span id="l5.76">         escape(EnigmailLocale.getString(&quot;debugLog.title&quot;)),</span>
<a href="#l5.77"></a><span id="l5.77">       &quot;centerscreen&quot;</span>
<a href="#l5.78"></a><span id="l5.78">     );</span>
<a href="#l5.79"></a><span id="l5.79">   },</span>
<a href="#l5.80"></a><span id="l5.80"> </span>
<a href="#l5.81"></a><span id="l5.81">   /**</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-   * Display the preferences dialog</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-   *</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-   * @win       - |object| holding the parent window for the dialog</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-   * @showBasic - |boolean| true if only the 1st page of the preferences window</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-   *              should be displayed / false otherwise</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-   * @selectTab - |string| ID of the tab element (in XUL) to display when opening</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-   *</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-   * no return value</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-   */</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-  openPrefWindow(win, showBasic, selectTab) {</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-    EnigmailLog.DEBUG(&quot;windows.js: openPrefWindow\n&quot;);</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-    EnigmailCore.getService(win, true); // true: starting preferences dialog</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-    let url;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-    url = &quot;chrome://openpgp/content/ui/pref-enigmail.xhtml&quot;;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-    win.openDialog(url, &quot;_blank&quot;, &quot;chrome,resizable=yes&quot;, {</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-      showBasic,</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-      clientType: &quot;thunderbird&quot;,</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-      selectTab,</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-    });</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-  },</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-  /**</span>
<a href="#l5.107"></a><span id="l5.107">    * Display the dialog for changing the expiry date of one or several keys</span>
<a href="#l5.108"></a><span id="l5.108">    *</span>
<a href="#l5.109"></a><span id="l5.109">    * @win        - |object| holding the parent window for the dialog</span>
<a href="#l5.110"></a><span id="l5.110">    * @userIdArr  - |array| of |strings| containing the User IDs</span>
<a href="#l5.111"></a><span id="l5.111">    * @keyIdArr   - |array| of |strings| containing the key IDs (eg. &quot;0x12345678&quot;) to change</span>
<a href="#l5.112"></a><span id="l5.112">    *</span>
<a href="#l5.113"></a><span id="l5.113">    * @return  Boolean - true if expiry date was changed; false otherwise</span>
<a href="#l5.114"></a><span id="l5.114">    */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/extensions/openpgp/content/strings/enigmail.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/strings/enigmail.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -678,48 +678,16 @@ enigmail.acSetupPasswd.descEnterPasswd=P</span>
<a href="#l6.4"></a><span id="l6.4">   enigmail.acSetupPasswd.descCopyPasswd=Please enter the setup code below on your other device to proceed with the setup.</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> #strings in autocrypt.jsm</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> autocrypt.setupMsg.subject=Autocrypt Setup Message</span>
<a href="#l6.9"></a><span id="l6.9"> autocrypt.setupMsg.msgBody=To set up your new device for Autocrypt, please follow the instuctions that should be presented by your new device.</span>
<a href="#l6.10"></a><span id="l6.10"> autocrypt.setupMsg.fileTxt=This is the Autocrypt setup file used to transfer settings and keys between clients. You can decrypt it using the setup code displayed on your old device, then import the key to your keyring.</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-#strings in upgradeInfo.html</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-upgradeInfo.doctitle=What's New in Gine-Liam v2.0?</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-upgradeInfo.welcome1=Welcome to the new Gine-Liam version 2.0!</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-upgradeInfo.welcome2=The release contains a lot of new and changed features. Please take a minute to find out what's new:</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-upgradeInfo.encSubject.title=Encrypting the Message Subject</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-upgradeInfo.encSubject.desc=We developed a new method that moves the email subject into the encrypted message, and replaces the visible subject with &quot;Encrypted Message&quot;. Once such a message is decrypted, the original subject is replaced automatically. Hiding the subject is on by default; there is a preference to turn it off if you don't like it. &lt;i&gt;(Note: this feature requires the message to be sent with PGP/MIME.)&lt;/i&gt;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-upgradeInfo.buttons.title=Changed behavior of Encrypt and Sign Buttons</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-upgradeInfo.buttons.desc=The &lt;b&gt;Encrypt&lt;/b&gt; and &lt;b&gt;Sign&lt;/b&gt; buttons in the message composer window now work for both the OpenPGP and S/MIME protocols. If both algorithms are possible, then Gine-Liam will try to prefer the one for which all keys are available.</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-upgradeInfo.autocrypt.title=Support for Autocrypt</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-upgradeInfo.autocrypt.desc=Gine-Liam now supports &lt;a href=&quot;https://autocrypt.org/&quot;&gt;Autocrypt&lt;/a&gt;, a new standard to distribute keys as part of sent messages. Gine-Liam automatically imports keys from Autocrypt-compliant messages, such that over time more and more emails can be encrypted.</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-upgradeInfo.bottom.desc=Please visit &lt;a href=&quot;https://doesnotexist-openpgp-integration.thunderbird/home/docu.php&quot;&gt;our documentation&lt;/a&gt; for help on using Gine-Liam.</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-#strings in enigmailAbout.html</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-aboutEnigmail.tabName=About Gine-Liam</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-aboutEnigmail.title=OpenPGP support provided by Gine-Liam</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-aboutEnigmail.team=Gine-Liam is developed by the Gine-Liam Team:</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-aboutEnigmail.projectLeader=Lead Developer:</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-aboutEnigmail.usability=Usability:</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-aboutEnigmail.documentation=Documentation:</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-aboutEnigmail.testing=Testing:</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-aboutEnigmail.userSupport=User Support:</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-aboutEnigmail.userSupport.team=the team and the list/forum members</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-aboutEnigmail.localization=Localization: &lt;em&gt;See the &lt;a href=&quot;https://doesnotexist-openpgp-integration.thunderbird/download/langpack.php&quot; target=&quot;_blank&quot;&gt;Gine-Liam Language Packs page&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-aboutEnigmail.Credits=Credits:</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-aboutEnigmail.origAuthor=Original author of the Gine-Liam extension</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-aboutEnigmail.icons=Icons:</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-aboutEnigmail.formerMembers=Former team members:</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-aboutEnigmail.projectHosting=Project hosting:</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-aboutEnigmail.licenseSupportTitle=License &amp;amp; Support</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-aboutEnigmail.license=Gine-Liam OpenPGP is open source and licensed under the %S</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-aboutEnigmail.support=Support and download is available from &lt;a href=&quot;https://doesnotexist-openpgp-integration.thunderbird/&quot;&gt;doesnotexist-openpgp-integration.thunderbird&lt;/a&gt;.</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-</span>
<a href="#l6.44"></a><span id="l6.44"> #strings in updateGnuPG.html</span>
<a href="#l6.45"></a><span id="l6.45"> updateGnuPG.tabName=GnuPG Update</span>
<a href="#l6.46"></a><span id="l6.46"> updateGnuPG.title=Updates for GnuPG</span>
<a href="#l6.47"></a><span id="l6.47"> updateGnuPG.introduction.desc=Gine-Liam requires GnuPG to perform its cryptographic functions. We recommend that you keep your installation of GnuPG up to date.</span>
<a href="#l6.48"></a><span id="l6.48"> updateGnuPG.updateRequired=A newer version of GnuPG is available. We strongly recommend that you keep your GnuPG installation up to date. Please click on the &lt;em&gt;Install Update&lt;/em&gt; button to download and install the update.</span>
<a href="#l6.49"></a><span id="l6.49"> updateGnuPG.noUpdateRequired=GnuPG is up to date.</span>
<a href="#l6.50"></a><span id="l6.50"> updateGnuPG.cannotUpdate.header=Gine-Liam only supports updating the following packages:</span>
<a href="#l6.51"></a><span id="l6.51"> updateGnuPG.cannotUpdate.footer=You seem to use some other variant of GnuGP; unfortunately it is therefore not possible for Gine-Liam to update your GnuGP installation.</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

