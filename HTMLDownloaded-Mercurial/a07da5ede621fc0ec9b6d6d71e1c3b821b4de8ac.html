<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21490:a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac" />
<meta property="og:url" content="/comm-central/rev/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac" />
<meta property="og:description" content="Bug 1229684 - Use Intl.DateTimeFormat instead of nsIScriptableDateFormat. r=makemyday" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">shortlog</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">files</a> |
changeset |
<a href="/comm-central/raw-rev/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">raw</a>  | <a href="/comm-central/archive/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1229684">Bug 1229684</a> - Use Intl.DateTimeFormat instead of nsIScriptableDateFormat. r=makemyday
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#97;&#118;&#105;&#32;&#82;&#117;&#101;&#100;&#97;&#32;&#60;&#102;&#111;&#115;&#115;&#64;&#102;&#114;&#97;&#110;&#106;&#97;&#114;&#117;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 19 Apr 2017 13:08:02 +0200</td></tr>

<tr>
 <td>changeset 21490</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac</a></td>
</tr>



<tr>
<td>parent 21489</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f58639c9f2e31f6de391b64900e6cf184ae15968">f58639c9f2e31f6de391b64900e6cf184ae15968</a>
</td>
</tr>

<tr>
<td>child 21491</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/91accf84262c025310e1c1be51c44e6e132c2c26">91accf84262c025310e1c1be51c44e6e132c2c26</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">13081</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 27 Apr 2017 21:02:25 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a07da5ede621 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac&newProject=comm-central&newRevision=23041d346f13041079cdd5256e4f63acf361e244&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac&newProject=comm-central&newRevision=23041d346f13041079cdd5256e4f63acf361e244&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac&newProject=comm-central&newRevision=23041d346f13041079cdd5256e4f63acf361e244&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28makemyday%29&revcount=50">makemyday</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1229684">1229684</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1229684">Bug 1229684</a> - Use Intl.DateTimeFormat instead of nsIScriptableDateFormat. r=makemyday</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/preferences/views.js">calendar/base/content/preferences/views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/preferences/views.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/preferences/views.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/preferences/views.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/preferences/views.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/content/preferences/views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/src/calDateTimeFormatter.js">calendar/base/src/calDateTimeFormatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/src/calDateTimeFormatter.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/src/calDateTimeFormatter.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/src/calDateTimeFormatter.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/src/calDateTimeFormatter.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/base/src/calDateTimeFormatter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js">calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/shared-modules/test-calendar-utils.js">calendar/test/mozmill/shared-modules/test-calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/shared-modules/test-calendar-utils.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/shared-modules/test-calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/shared-modules/test-calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/shared-modules/test-calendar-utils.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/shared-modules/test-calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/testBasicFunctionality.js">calendar/test/mozmill/testBasicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/testBasicFunctionality.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/testBasicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/testBasicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/testBasicFunctionality.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/testBasicFunctionality.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testDayView.js">calendar/test/mozmill/views/testDayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testDayView.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testDayView.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testDayView.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testDayView.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testDayView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMonthView.js">calendar/test/mozmill/views/testMonthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMonthView.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMonthView.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMonthView.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMonthView.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMonthView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMultiweekView.js">calendar/test/mozmill/views/testMultiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMultiweekView.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMultiweekView.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMultiweekView.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMultiweekView.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testMultiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testWeekView.js">calendar/test/mozmill/views/testWeekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testWeekView.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testWeekView.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testWeekView.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testWeekView.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/mozmill/views/testWeekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/unit/test_ltninvitationutils.js">calendar/test/unit/test_ltninvitationutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/unit/test_ltninvitationutils.js">file</a> |
<a href="/comm-central/annotate/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/unit/test_ltninvitationutils.js">annotate</a> |
<a href="/comm-central/diff/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/unit/test_ltninvitationutils.js">diff</a> |
<a href="/comm-central/comparison/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/unit/test_ltninvitationutils.js">comparison</a> |
<a href="/comm-central/log/a07da5ede621fc0ec9b6d6d71e1c3b821b4de8ac/calendar/test/unit/test_ltninvitationutils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -89,16 +89,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">       &lt;/method&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">       &lt;property name=&quot;pixelsPerMinute&quot;</span>
<a href="#l1.7"></a><span id="l1.7">                 onget=&quot;return this.mPixPerMin&quot;</span>
<a href="#l1.8"></a><span id="l1.8">                 onset=&quot;if (this.mPixPerMin != val) { this.mPixPerMin = val; this.relayout(); } return val;&quot;/&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+          Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l1.13"></a><span id="l1.13">           let topbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;topbox&quot;);</span>
<a href="#l1.14"></a><span id="l1.14">           let orient = topbox.getAttribute(&quot;orient&quot;);</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">           function makeTimeBox(timestr, size) {</span>
<a href="#l1.17"></a><span id="l1.17">               let box = createXULElement(&quot;box&quot;);</span>
<a href="#l1.18"></a><span id="l1.18">               box.setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">               if (orient == &quot;horizontal&quot;) {</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -116,18 +117,18 @@</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">               return box;</span>
<a href="#l1.24"></a><span id="l1.24">           }</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">           while (topbox.hasChildNodes()) {</span>
<a href="#l1.27"></a><span id="l1.27">               topbox.lastChild.remove();</span>
<a href="#l1.28"></a><span id="l1.28">           }</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-          let formatter = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-                                    .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+          let timeFormatter = cal.getDateFormatter();</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+          let jsTime = new Date();</span>
<a href="#l1.34"></a><span id="l1.34">           let timeString;</span>
<a href="#l1.35"></a><span id="l1.35">           let theMin = this.mStartMin;</span>
<a href="#l1.36"></a><span id="l1.36">           let theHour = Math.floor(theMin / 60);</span>
<a href="#l1.37"></a><span id="l1.37">           let durLeft = this.mEndMin - this.mStartMin;</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">           while (durLeft &gt; 0) {</span>
<a href="#l1.40"></a><span id="l1.40">               let dur;</span>
<a href="#l1.41"></a><span id="l1.41">               if (this.mEndMin - theMin &lt; 60) {</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineat">@@ -142,19 +143,18 @@</span>
<a href="#l1.43"></a><span id="l1.43"> </span>
<a href="#l1.44"></a><span id="l1.44">               // calculate duration pixel as the difference between</span>
<a href="#l1.45"></a><span id="l1.45">               // start pixel and end pixel to avoid rounding errors.</span>
<a href="#l1.46"></a><span id="l1.46">               let startPix = Math.round(theMin * this.mPixPerMin);</span>
<a href="#l1.47"></a><span id="l1.47">               let endPix = Math.round((theMin + dur) * this.mPixPerMin);</span>
<a href="#l1.48"></a><span id="l1.48">               let durPix = endPix - startPix;</span>
<a href="#l1.49"></a><span id="l1.49">               let box;</span>
<a href="#l1.50"></a><span id="l1.50">               if (dur == 60) {</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-                  timeString = formatter.FormatTime(&quot;&quot;,</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-                                                    Components.interfaces.nsIScriptableDateFormat.timeFormatNoSeconds,</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-                                                    theHour, 0, 0);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+                  jsTime.setHours(theHour, 0, 0);</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+                  timeString = timeFormatter.formatTime(cal.jsDateToDateTime(jsTime, cal.floating()));</span>
<a href="#l1.56"></a><span id="l1.56">                   box = makeTimeBox(timeString, durPix);</span>
<a href="#l1.57"></a><span id="l1.57">               } else {</span>
<a href="#l1.58"></a><span id="l1.58">                   box = makeTimeBox(&quot;&quot;, durPix);</span>
<a href="#l1.59"></a><span id="l1.59">               }</span>
<a href="#l1.60"></a><span id="l1.60"> </span>
<a href="#l1.61"></a><span id="l1.61">               // Set up workweek hours</span>
<a href="#l1.62"></a><span id="l1.62">               if (theHour &lt; this.mDayStartHour || theHour &gt;= this.mDayEndHour) {</span>
<a href="#l1.63"></a><span id="l1.63">                   box.setAttribute(&quot;off-time&quot;, &quot;true&quot;);</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineat">@@ -1937,38 +1937,38 @@</span>
<a href="#l1.65"></a><span id="l1.65">           // So we really don't have anything to do here.</span>
<a href="#l1.66"></a><span id="l1.66">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.67"></a><span id="l1.67">       &lt;/method&gt;</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69">       &lt;method name=&quot;updateDragLabels&quot;&gt;</span>
<a href="#l1.70"></a><span id="l1.70">         &lt;parameter name=&quot;aFirstColumn&quot;/&gt;</span>
<a href="#l1.71"></a><span id="l1.71">         &lt;parameter name=&quot;aLastColumn&quot;/&gt;</span>
<a href="#l1.72"></a><span id="l1.72">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+          Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l1.74"></a><span id="l1.74">           if (!this.mDragState) {</span>
<a href="#l1.75"></a><span id="l1.75">               return;</span>
<a href="#l1.76"></a><span id="l1.76">           }</span>
<a href="#l1.77"></a><span id="l1.77"> </span>
<a href="#l1.78"></a><span id="l1.78">           let firstColumn = aFirstColumn || this;</span>
<a href="#l1.79"></a><span id="l1.79">           let lastColumn = aLastColumn || this;</span>
<a href="#l1.80"></a><span id="l1.80">           let realstartmin = this.mDragState.startMin + this.mStartMin;</span>
<a href="#l1.81"></a><span id="l1.81">           let realendmin = this.mDragState.endMin + this.mStartMin;</span>
<a href="#l1.82"></a><span id="l1.82">           let starthr = Math.floor(realstartmin / 60);</span>
<a href="#l1.83"></a><span id="l1.83">           let startmin = realstartmin % 60;</span>
<a href="#l1.84"></a><span id="l1.84"> </span>
<a href="#l1.85"></a><span id="l1.85">           let endhr = Math.floor(realendmin / 60);</span>
<a href="#l1.86"></a><span id="l1.86">           let endmin = realendmin % 60;</span>
<a href="#l1.87"></a><span id="l1.87"> </span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-          let formatter = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-                                    .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineminus">-          let startstr = formatter.FormatTime(&quot;&quot;,</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineminus">-                                              Components.interfaces.nsIScriptableDateFormat.timeFormatNoSeconds,</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineminus">-                                              starthr, startmin, 0);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineminus">-          let endstr = formatter.FormatTime(&quot;&quot;,</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-                                            Components.interfaces.nsIScriptableDateFormat.timeFormatNoSeconds,</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-                                            endhr, endmin, 0);</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+          let timeFormatter = cal.getDateFormatter();</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+          let jsTime = new Date();</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+          jsTime.setHours(starthr, startmin);</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+          let startstr = timeFormatter.formatTime(cal.jsDateToDateTime(jsTime, cal.floating()));</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+          jsTime.setHours(endhr, endmin);</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+          let endstr = timeFormatter.formatTime(cal.jsDateToDateTime(jsTime, cal.floating()));</span>
<a href="#l1.103"></a><span id="l1.103"> </span>
<a href="#l1.104"></a><span id="l1.104">           // Tasks without Entry or Due date have a string as first label</span>
<a href="#l1.105"></a><span id="l1.105">           // instead of the time.</span>
<a href="#l1.106"></a><span id="l1.106">           if (cal.isToDo(this.mDragState.dragOccurrence)) {</span>
<a href="#l1.107"></a><span id="l1.107">               if (!this.mDragState.dragOccurrence.dueDate) {</span>
<a href="#l1.108"></a><span id="l1.108">                   startstr = calGetString(&quot;calendar&quot;, &quot;dragLabelTasksWithOnlyEntryDate&quot;);</span>
<a href="#l1.109"></a><span id="l1.109">               } else if (!this.mDragState.dragOccurrence.entryDate) {</span>
<a href="#l1.110"></a><span id="l1.110">                   startstr = calGetString(&quot;calendar&quot;, &quot;dragLabelTasksWithOnlyDueDate&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/preferences/views.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/preferences/views.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -19,24 +19,29 @@ var gViewsPane = {</span>
<a href="#l2.4"></a><span id="l2.4">         this.initializeViewStartEndMenus();</span>
<a href="#l2.5"></a><span id="l2.5">     },</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">     /**</span>
<a href="#l2.8"></a><span id="l2.8">      * Initialize the strings for the  &quot;day starts at&quot; and &quot;day ends at&quot;</span>
<a href="#l2.9"></a><span id="l2.9">      * menulists. This is needed to respect locales that use AM/PM.</span>
<a href="#l2.10"></a><span id="l2.10">      */</span>
<a href="#l2.11"></a><span id="l2.11">     initializeViewStartEndMenus: function() {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+        Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l2.13"></a><span id="l2.13">         let labelIdStart;</span>
<a href="#l2.14"></a><span id="l2.14">         let labelIdEnd;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-        let timeFormatter = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                                      .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+        let calTime = cal.createDateTime();</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+        calTime.minute = 0;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+        let timeFormatter = cal.getDateFormatter();</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+</span>
<a href="#l2.23"></a><span id="l2.23">         // 1 to 23 instead of 0 to 24 to keep midnight &amp; noon as the localized strings</span>
<a href="#l2.24"></a><span id="l2.24">         for (let theHour = 1; theHour &lt;= 23; theHour++) {</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-            let time = timeFormatter.FormatTime(&quot;&quot;, Components.interfaces.nsIScriptableDateFormat</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-                                    .timeFormatNoSeconds, theHour, 0, 0);</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+            calTime.hour = theHour;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+            let time = timeFormatter.formatTime(calTime);</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">             labelIdStart = &quot;timeStart&quot; + theHour;</span>
<a href="#l2.31"></a><span id="l2.31">             labelIdEnd = &quot;timeEnd&quot; + theHour;</span>
<a href="#l2.32"></a><span id="l2.32">             // This if block to keep Noon as the localized string, instead of as a number.</span>
<a href="#l2.33"></a><span id="l2.33">             if (theHour != 12) {</span>
<a href="#l2.34"></a><span id="l2.34">                 document.getElementById(labelIdStart).setAttribute(&quot;label&quot;, time);</span>
<a href="#l2.35"></a><span id="l2.35">                 document.getElementById(labelIdEnd).setAttribute(&quot;label&quot;, time);</span>
<a href="#l2.36"></a><span id="l2.36">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,75 +1,23 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.9"></a><span id="l3.9"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.10"></a><span id="l3.10"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-var nsIScriptableDateFormat = Components.interfaces.nsIScriptableDateFormat;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> function calDateTimeFormatter() {</span>
<a href="#l3.16"></a><span id="l3.16">     this.wrappedJSObject = this;</span>
<a href="#l3.17"></a><span id="l3.17">     this.mDateStringBundle = Services.strings.createBundle(&quot;chrome://calendar/locale/dateFormat.properties&quot;);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-    this.mDateService =</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-        Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-                  .getService(nsIScriptableDateFormat);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-    // Do does the month or day come first in this locale?</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-    this.mMonthFirst = false;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-    // If LONG FORMATTED DATE is same as short formatted date,</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-    // then OS has poor extended/long date config, so use workaround.</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-    this.mUseLongDateService = true;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-    let probeDate =</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-        Components.classes[&quot;@mozilla.org/calendar/datetime;1&quot;]</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-                  .createInstance(Components.interfaces.calIDateTime);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-    probeDate.timezone = UTC();</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-    probeDate.year = 2002;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-    probeDate.month = 3;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-    probeDate.day = 5;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-    try {</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-        // We're try/catching the calls to nsScriptableDateFormat since it's</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-        // outside this module. We're also reusing probeDate rather than</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-        // creating 3 discrete calDateTimes for performance.</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-        let probeStringA = this.formatDateShort(probeDate);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-        let longProbeString = this.formatDateLong(probeDate);</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-        probeDate.month = 4;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-        let probeStringB = this.formatDateShort(probeDate);</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-        probeDate.month = 3;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-        probeDate.day = 6;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-        let probeStringC = this.formatDateShort(probeDate);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-        // Compare the index of the first differing character between</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-        // probeStringA to probeStringB and probeStringA to probeStringC.</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-        for (let i = 0; i &lt; probeStringA.length; i++) {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-            if (probeStringA[i] != probeStringB[i]) {</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-                this.mMonthFirst = true;</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-                break;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-            } else if (probeStringA[i] != probeStringC[i]) {</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-                this.mMonthFirst = false;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-                break;</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-            }</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-        }</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-        // On Unix extended/long date format may be created using %Ex instead</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-        // of %x. Some systems may not support it and return &quot;Ex&quot; or same as</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-        // short string. In that case, don't use long date service, use a</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-        // workaround hack instead.</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-        if (longProbeString == null ||</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-            longProbeString.length &lt; 4 ||</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-            longProbeString == probeStringA) {</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-            this.mUseLongDateService = false;</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-        }</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-    } catch (e) {</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-        this.mUseLongDateService = false;</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-    }</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+    this.mLocale = Components.classes[&quot;@mozilla.org/chrome/chrome-registry;1&quot;]</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+                             .getService(Components.interfaces.nsIXULChromeRegistry)</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+                             .getSelectedLocale(&quot;global&quot;, true);</span>
<a href="#l3.75"></a><span id="l3.75"> }</span>
<a href="#l3.76"></a><span id="l3.76"> var calDateTimeFormatterClassID = Components.ID(&quot;{4123da9a-f047-42da-a7d0-cc4175b9f36a}&quot;);</span>
<a href="#l3.77"></a><span id="l3.77"> var calDateTimeFormatterInterfaces = [Components.interfaces.calIDateTimeFormatter];</span>
<a href="#l3.78"></a><span id="l3.78"> calDateTimeFormatter.prototype = {</span>
<a href="#l3.79"></a><span id="l3.79">     classID: calDateTimeFormatterClassID,</span>
<a href="#l3.80"></a><span id="l3.80">     QueryInterface: XPCOMUtils.generateQI(calDateTimeFormatterInterfaces),</span>
<a href="#l3.81"></a><span id="l3.81">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l3.82"></a><span id="l3.82">         classID: calDateTimeFormatterClassID,</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineat">@@ -80,87 +28,72 @@ calDateTimeFormatter.prototype = {</span>
<a href="#l3.84"></a><span id="l3.84"> </span>
<a href="#l3.85"></a><span id="l3.85">     formatDate: function(aDate) {</span>
<a href="#l3.86"></a><span id="l3.86">         // Format the date using user's format preference (long or short)</span>
<a href="#l3.87"></a><span id="l3.87">         let format = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l3.88"></a><span id="l3.88">         return (format == 0 ? this.formatDateLong(aDate) : this.formatDateShort(aDate));</span>
<a href="#l3.89"></a><span id="l3.89">     },</span>
<a href="#l3.90"></a><span id="l3.90"> </span>
<a href="#l3.91"></a><span id="l3.91">     formatDateShort: function(aDate) {</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineminus">-        return this.mDateService.FormatDate(&quot;&quot;,</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-                                            nsIScriptableDateFormat.dateFormatShort,</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-                                            aDate.year,</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-                                            aDate.month + 1,</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-                                            aDate.day);</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+        let dtOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+        dtOptions = this._addTzOption(aDate, dtOptions);</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+        return cal.dateTimeToJsDate(aDate).toLocaleDateString(undefined, dtOptions);</span>
<a href="#l3.100"></a><span id="l3.100">     },</span>
<a href="#l3.101"></a><span id="l3.101"> </span>
<a href="#l3.102"></a><span id="l3.102">     formatDateLong: function(aDate) {</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-        let longDate;</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-        if (this.mUseLongDateService) {</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-            longDate = this.mDateService.FormatDate(&quot;&quot;,</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-                                                    nsIScriptableDateFormat.dateFormatLong,</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-                                                    aDate.year,</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-                                                    aDate.month + 1,</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-                                                    aDate.day);</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineminus">-            // check whether weekday name appears as in Lightning localization. if not, this is</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineminus">-            // probably a minority language without OS support, so we should fall back to compose</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineminus">-            // longDate on our own. May be not needed anymore once bug 441167 is fixed.</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-            if (!longDate.includes(this.dayName(aDate.weekday)) &amp;&amp;</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-                !longDate.includes(this.shortDayName(aDate.weekday))) {</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-                longDate = null;</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-                this.mUseLongDateService = false;</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-            }</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-        }</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineminus">-        if (longDate == null) {</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-            // HACK We are probably on Linux or have a minority localization and want a string in</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-            // long format. dateService.dateFormatLong on Linux may return a short string, so</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-            // build our own.</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-            longDate = cal.calGetString(&quot;calendar&quot;, &quot;formatDateLong&quot;,</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-                                        [this.shortDayName(aDate.weekday),</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-                                         this.formatDayWithOrdinal(aDate.day),</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-                                         this.shortMonthName(aDate.month),</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-                                         aDate.year]);</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-        }</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-        return longDate;</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+        let dtOptions = { weekday: 'long', year: 'numeric', month: 'long', day: '2-digit' };</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+        dtOptions = this._addTzOption(aDate, dtOptions);</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+        return cal.dateTimeToJsDate(aDate).toLocaleDateString(this.mLocale, dtOptions);</span>
<a href="#l3.133"></a><span id="l3.133">     },</span>
<a href="#l3.134"></a><span id="l3.134"> </span>
<a href="#l3.135"></a><span id="l3.135">     formatDateWithoutYear: function(aDate) {</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineminus">-        // Doing this the hard way, because nsIScriptableDateFormat doesn't</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-        // have a way to not include the year.</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineminus">-        if (this.mMonthFirst) {</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-            return this.shortMonthName(aDate.month) + &quot; &quot; + this.formatDayWithOrdinal(aDate.day);</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineminus">-        } else {</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-            return this.formatDayWithOrdinal(aDate.day) + &quot; &quot; + this.shortMonthName(aDate.month);</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-        }</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+        let dtOptions = { month: 'short', day: 'numeric' };</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+        dtOptions = this._addTzOption(aDate, dtOptions);</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+        return cal.dateTimeToJsDate(aDate).toLocaleDateString(this.mLocale, dtOptions);</span>
<a href="#l3.146"></a><span id="l3.146">     },</span>
<a href="#l3.147"></a><span id="l3.147"> </span>
<a href="#l3.148"></a><span id="l3.148">     formatTime: function(aDate) {</span>
<a href="#l3.149"></a><span id="l3.149">         if (aDate.isDate) {</span>
<a href="#l3.150"></a><span id="l3.150">             return this.mDateStringBundle.GetStringFromName(&quot;AllDay&quot;);</span>
<a href="#l3.151"></a><span id="l3.151">         }</span>
<a href="#l3.152"></a><span id="l3.152"> </span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-        return this.mDateService.FormatTime(&quot;&quot;,</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineminus">-                                            nsIScriptableDateFormat.timeFormatNoSeconds,</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineminus">-                                            aDate.hour,</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineminus">-                                            aDate.minute,</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-                                            0);</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+        let timeOptions = { hour: 'numeric', minute: '2-digit' };</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+        timeOptions = this._addTzOption(aDate, timeOptions);</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+        return cal.dateTimeToJsDate(aDate).toLocaleTimeString(undefined, timeOptions);</span>
<a href="#l3.161"></a><span id="l3.161">     },</span>
<a href="#l3.162"></a><span id="l3.162"> </span>
<a href="#l3.163"></a><span id="l3.163">     formatDateTime: function(aDate) {</span>
<a href="#l3.164"></a><span id="l3.164">         let formattedDate = this.formatDate(aDate);</span>
<a href="#l3.165"></a><span id="l3.165">         let formattedTime = this.formatTime(aDate);</span>
<a href="#l3.166"></a><span id="l3.166"> </span>
<a href="#l3.167"></a><span id="l3.167">         let timeBeforeDate = Preferences.get(&quot;calendar.date.formatTimeBeforeDate&quot;, false);</span>
<a href="#l3.168"></a><span id="l3.168">         if (timeBeforeDate) {</span>
<a href="#l3.169"></a><span id="l3.169">             return formattedTime + &quot; &quot; + formattedDate;</span>
<a href="#l3.170"></a><span id="l3.170">         } else {</span>
<a href="#l3.171"></a><span id="l3.171">             return formattedDate + &quot; &quot; + formattedTime;</span>
<a href="#l3.172"></a><span id="l3.172">         }</span>
<a href="#l3.173"></a><span id="l3.173">     },</span>
<a href="#l3.174"></a><span id="l3.174"> </span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+    /**</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+     * _addTzOption adds a timezone to apply on Intl.DateTimeFormat formatting operations to the</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+     * provided options argument based on the timezone of the date argument.</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+     *</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+     * @param  {calIDateTime} aDate    The date object holding the tz information</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+     * @param  {JsObject}     aOptions The options object to extend.</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+     * @return {JsObject}              The object containing the formatting options.</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+     */</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+    _addTzOption: function(aDate, aOptions) {</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+        let timezone = aDate.timezone;</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineplus">+        // we set the tz only if we have a valid tz - otherwise localtime will be used on formatting.</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+        if (timezone &amp;&amp; (timezone.isUTC || timezone.icalComponent)) {</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineplus">+            aOptions.timeZone = timezone.tzid;</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+        }</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+        return aOptions;</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+    },</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+</span>
<a href="#l3.192"></a><span id="l3.192">     formatTimeInterval: function(aStartDate, aEndDate) {</span>
<a href="#l3.193"></a><span id="l3.193">         if (!aStartDate &amp;&amp; aEndDate) {</span>
<a href="#l3.194"></a><span id="l3.194">             return this.formatTime(aEndDate);</span>
<a href="#l3.195"></a><span id="l3.195">         }</span>
<a href="#l3.196"></a><span id="l3.196">         if (!aEndDate &amp;&amp; aStartDate) {</span>
<a href="#l3.197"></a><span id="l3.197">             return this.formatTime(aStartDate);</span>
<a href="#l3.198"></a><span id="l3.198">         }</span>
<a href="#l3.199"></a><span id="l3.199">         if (!aStartDate &amp;&amp; !aEndDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1864,26 +1864,20 @@</span>
<a href="#l4.4"></a><span id="l4.4">               this.kTimeFormatString = &quot;%H:%M&quot;;</span>
<a href="#l4.5"></a><span id="l4.5">           }</span>
<a href="#l4.6"></a><span id="l4.6">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.7"></a><span id="l4.7">       &lt;/method&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">       &lt;method name=&quot;formatDate&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l4.11"></a><span id="l4.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-          // workaround for bugs 354073/327869:</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-          // aDate.toLocaleFormat(&quot;%x&quot;) exits application</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-          // if year before 1900 (e.g., typo) on MSWindows (due to MS bug).</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-          let nsIScriptableDateFormat = Components.interfaces.nsIScriptableDateFormat;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-          let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-                                      .getService(nsIScriptableDateFormat);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-          return dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort,</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-                                        aDate.getFullYear(),</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-                                        aDate.getMonth() + 1,</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-                                        aDate.getDate());</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+          Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+          let dateFormatter = cal.getDateFormatter();</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+          return dateFormatter.formatDateShort(cal.jsDateToDateTime(aDate, cal.floating()));</span>
<a href="#l4.26"></a><span id="l4.26">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.27"></a><span id="l4.27">       &lt;/method&gt;</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">       &lt;method name=&quot;formatTime&quot;&gt;</span>
<a href="#l4.30"></a><span id="l4.30">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l4.31"></a><span id="l4.31">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.32"></a><span id="l4.32">           // remove leading zero in hours before colon in xx01:23pmxx</span>
<a href="#l4.33"></a><span id="l4.33">           return aValue.toLocaleFormat(this.kTimeFormatString).replace(/0(\d):/, &quot;$1:&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/test/mozmill/cal-recurrence/testWeeklyUntilRecurrence.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> var MODULE_NAME = &quot;testWeeklyUntilRecurrence&quot;;</span>
<a href="#l5.9"></a><span id="l5.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l5.10"></a><span id="l5.10"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-Cu.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> var SHORT_SLEEP, TIMEOUT_MODAL_DIALOG, CALENDARNAME, EVENTPATH, EVENT_BOX;</span>
<a href="#l5.16"></a><span id="l5.16"> var CANVAS_BOX, REC_DLG_DAYS, REC_DLG_ACCEPT, REC_DLG_UNTIL_INPUT;</span>
<a href="#l5.17"></a><span id="l5.17"> var helpersForController, handleOccurrencePrompt, switchToView, goToDate;</span>
<a href="#l5.18"></a><span id="l5.18"> var invokeEventDialog, viewForward, deleteCalendars, createCalendar, menulistSelect;</span>
<a href="#l5.19"></a><span id="l5.19"> var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21"> const ENDDATE = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -165,20 +165,19 @@ function setRecurrence(recurrence) {</span>
<a href="#l5.23"></a><span id="l5.23">     // set until date</span>
<a href="#l5.24"></a><span id="l5.24">     recurrence.radio(recid(&quot;recurrence-range-until&quot;));</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">     // delete previous date</span>
<a href="#l5.27"></a><span id="l5.27">     let untilInput = reclookup(REC_DLG_UNTIL_INPUT);</span>
<a href="#l5.28"></a><span id="l5.28">     recurrence.keypress(untilInput, &quot;a&quot;, { accelKey: true });</span>
<a href="#l5.29"></a><span id="l5.29">     recurrence.keypress(untilInput, &quot;VK_DELETE&quot;, {});</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-                       .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-    let ymd = [ENDDATE.getFullYear(), ENDDATE.getMonth() + 1, ENDDATE.getDate()];</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+    let endDateString = dateFormatter.formatDateShort(cal.jsDateToDateTime(ENDDATE, cal.floating()));</span>
<a href="#l5.38"></a><span id="l5.38">     recsleep(SHORT_SLEEP);</span>
<a href="#l5.39"></a><span id="l5.39">     recurrence.type(untilInput, endDateString);</span>
<a href="#l5.40"></a><span id="l5.40"> </span>
<a href="#l5.41"></a><span id="l5.41">     recsleep(SHORT_SLEEP);</span>
<a href="#l5.42"></a><span id="l5.42">     // Move focus to ensure the date is selected</span>
<a href="#l5.43"></a><span id="l5.43">     recurrence.keypress(untilInput, &quot;VK_TAB&quot;, {});</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">     // close dialog</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyUntilRecurrence.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,15 +1,17 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l6.9"></a><span id="l6.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+</span>
<a href="#l6.13"></a><span id="l6.13"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l6.14"></a><span id="l6.14"> var switchToView, goToDate, viewForward, handleOccurrencePrompt;</span>
<a href="#l6.15"></a><span id="l6.15"> var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l6.18"></a><span id="l6.18"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> var ENDDATE = new Date(2009, 0, 26); // last Monday in month</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -174,20 +176,19 @@ function setRecurrence(recurrence) {</span>
<a href="#l6.22"></a><span id="l6.22">         anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l6.23"></a><span id="l6.23">         anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l6.24"></a><span id="l6.24">     `;</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">     // delete previous date</span>
<a href="#l6.27"></a><span id="l6.27">     recurrence.keypress(reclookup(input), &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l6.28"></a><span id="l6.28">     recurrence.keypress(reclookup(input), &quot;VK_DELETE&quot;, {});</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-    let ymd = [ENDDATE.getFullYear(), ENDDATE.getMonth() + 1, ENDDATE.getDate()];</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-    let endDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+    let endDateString = dateFormatter.formatDateShort(cal.jsDateToDateTime(ENDDATE, cal.floating()));</span>
<a href="#l6.37"></a><span id="l6.37"> </span>
<a href="#l6.38"></a><span id="l6.38">     recurrence.type(reclookup(input), endDateString);</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40">     // close dialog</span>
<a href="#l6.41"></a><span id="l6.41">     recurrence.click(reclookup(`</span>
<a href="#l6.42"></a><span id="l6.42">         /id(&quot;calendar-event-dialog-recurrence&quot;)/anon({&quot;anonid&quot;:&quot;buttons&quot;})/</span>
<a href="#l6.43"></a><span id="l6.43">         {&quot;dlgtype&quot;:&quot;accept&quot;}</span>
<a href="#l6.44"></a><span id="l6.44">     `));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testWeeklyWithExceptionRecurrence.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,15 +1,17 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l7.9"></a><span id="l7.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+</span>
<a href="#l7.13"></a><span id="l7.13"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l7.14"></a><span id="l7.14"> var switchToView, goToDate, handleOccurrencePrompt;</span>
<a href="#l7.15"></a><span id="l7.15"> var CALENDARNAME, EVENT_BOX, CANVAS_BOX;</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> var modalDialog = require(&quot;../shared-modules/modal-dialog&quot;);</span>
<a href="#l7.18"></a><span id="l7.18"> var utils = require(&quot;../shared-modules/utils&quot;);</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> var HOUR = 8;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -80,20 +82,20 @@ function testWeeklyWithExceptionRecurren</span>
<a href="#l7.22"></a><span id="l7.22">             id(&quot;event-endtime&quot;)/anon({&quot;anonid&quot;:&quot;hbox&quot;})/</span>
<a href="#l7.23"></a><span id="l7.23">             anon({&quot;anonid&quot;:&quot;date-picker&quot;})/anon({&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l7.24"></a><span id="l7.24">             {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l7.25"></a><span id="l7.25">             anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l7.26"></a><span id="l7.26">             anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l7.27"></a><span id="l7.27">         `);</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">         event.keypress(startDateInput, &quot;a&quot;, { ctrlKey: true });</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-        let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-                                    .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-        let ymd = [STARTDATE.getFullYear(), STARTDATE.getMonth() + 1, STARTDATE.getDate()];</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-        let startDateString = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+        let dateFormatter = cal.getDateFormatter();</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+        let startDateString = dateFormatter.formatDateShort(cal.jsDateToDateTime(STARTDATE, cal.floating()));</span>
<a href="#l7.38"></a><span id="l7.38">         event.type(startDateInput, startDateString);</span>
<a href="#l7.39"></a><span id="l7.39">         // applies startdate change</span>
<a href="#l7.40"></a><span id="l7.40">         event.click(endDateInput);</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">         event.click(eventid(&quot;button-saveandclose&quot;));</span>
<a href="#l7.43"></a><span id="l7.43">     });</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45">     // change recurrence rule</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l8.4"></a><span id="l8.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.5"></a><span id="l8.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> var MODULE_NAME = &quot;calendar-utils&quot;;</span>
<a href="#l8.8"></a><span id="l8.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l8.9"></a><span id="l8.9"> var MODULE_REQUIRES = [&quot;window-helpers&quot;, &quot;folder-display-helpers&quot;, &quot;pref-window-helpers&quot;];</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11"> Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+Cu.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l8.13"></a><span id="l8.13"> var os = {};</span>
<a href="#l8.14"></a><span id="l8.14"> Cu.import(&quot;resource://mozmill/stdlib/os.js&quot;, os);</span>
<a href="#l8.15"></a><span id="l8.15"> var frame = {};</span>
<a href="#l8.16"></a><span id="l8.16"> Cu.import(&quot;resource://mozmill/modules/frame.js&quot;, frame);</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18"> var SHORT_SLEEP = 100;</span>
<a href="#l8.19"></a><span id="l8.19"> var MID_SLEEP = 500;</span>
<a href="#l8.20"></a><span id="l8.20"> var TIMEOUT_MODAL_DIALOG = 30000;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -660,18 +661,17 @@ function setData(dialog, iframe, data) {</span>
<a href="#l8.22"></a><span id="l8.22">         id(&quot;event-grid-todo-status-picker-box&quot;)/id(&quot;completed-date-picker&quot;)/${dateInput}</span>
<a href="#l8.23"></a><span id="l8.23">     `);</span>
<a href="#l8.24"></a><span id="l8.24">     let percentCompleteInput = iframeLookup(`</span>
<a href="#l8.25"></a><span id="l8.25">         ${innerFrame}/id(&quot;event-grid-todo-status-row&quot;)/</span>
<a href="#l8.26"></a><span id="l8.26">         id(&quot;event-grid-todo-status-picker-box&quot;)/id(&quot;percent-complete-textbox&quot;)/</span>
<a href="#l8.27"></a><span id="l8.27">         anon({&quot;class&quot;:&quot;textbox-input-box numberbox-input-box&quot;})/</span>
<a href="#l8.28"></a><span id="l8.28">         anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l8.29"></a><span id="l8.29">     `);</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-    let dateService = Cc[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-                        .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l8.33"></a><span id="l8.33">     // wait for input elements' values to be populated</span>
<a href="#l8.34"></a><span id="l8.34">     sleep();</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">     // title</span>
<a href="#l8.37"></a><span id="l8.37">     if (data.title != undefined) {</span>
<a href="#l8.38"></a><span id="l8.38">         // we need to set directly here in case there is already a title.</span>
<a href="#l8.39"></a><span id="l8.39">         // accelKey+a won't work in all OS</span>
<a href="#l8.40"></a><span id="l8.40">         iframeId(&quot;item-title&quot;).getNode().value = data.title;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineat">@@ -704,57 +704,45 @@ function setData(dialog, iframe, data) {</span>
<a href="#l8.42"></a><span id="l8.42">     if (data.timezone != undefined) {</span>
<a href="#l8.43"></a><span id="l8.43">         let menuitem = iframeId(&quot;options-timezones-menuitem&quot;);</span>
<a href="#l8.44"></a><span id="l8.44">         menuitem.getNode().setAttribute(&quot;checked&quot;, data.timezone);</span>
<a href="#l8.45"></a><span id="l8.45">         dialog.click(menuitem);</span>
<a href="#l8.46"></a><span id="l8.46">     }</span>
<a href="#l8.47"></a><span id="l8.47"> </span>
<a href="#l8.48"></a><span id="l8.48">     // startdate</span>
<a href="#l8.49"></a><span id="l8.49">     if (data.startdate != undefined &amp;&amp; data.startdate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-        let ymd = [</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-            data.startdate.getFullYear(),</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-            data.startdate.getMonth() + 1,</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-            data.startdate.getDate()</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-        ];</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-        let startdate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+        let startdate = dateFormatter.formatDateShort(cal.jsDateToDateTime(data.startdate, cal.floating()));</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58">         if (!isEvent) {</span>
<a href="#l8.59"></a><span id="l8.59">             dialog.check(iframeId(&quot;todo-has-entrydate&quot;), true);</span>
<a href="#l8.60"></a><span id="l8.60">         }</span>
<a href="#l8.61"></a><span id="l8.61">         dialog.keypress(startDateInput, &quot;a&quot;, { accelKey: true });</span>
<a href="#l8.62"></a><span id="l8.62">         dialog.type(startDateInput, startdate);</span>
<a href="#l8.63"></a><span id="l8.63">     }</span>
<a href="#l8.64"></a><span id="l8.64"> </span>
<a href="#l8.65"></a><span id="l8.65">     // starttime</span>
<a href="#l8.66"></a><span id="l8.66">     if (data.starttime != undefined &amp;&amp; data.starttime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-        let hms = [data.starttime.getHours(), data.starttime.getMinutes(), 0];</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-        let starttime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, ...hms);</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+        let starttime = dateFormatter.formatTime(cal.jsDateToDateTime(data.starttime, cal.floating()));</span>
<a href="#l8.70"></a><span id="l8.70">         startTimeInput.getNode().value = starttime;</span>
<a href="#l8.71"></a><span id="l8.71">         sleep();</span>
<a href="#l8.72"></a><span id="l8.72">     }</span>
<a href="#l8.73"></a><span id="l8.73"> </span>
<a href="#l8.74"></a><span id="l8.74">     // enddate</span>
<a href="#l8.75"></a><span id="l8.75">     if (data.enddate != undefined &amp;&amp; data.enddate.constructor.name == &quot;Date&quot;) {</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineminus">-        let ymd = [</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-            data.enddate.getFullYear(),</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-            data.enddate.getMonth() + 1,</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-            data.enddate.getDate()</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-        ];</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-        let enddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+        let enddate = dateFormatter.formatDateShort(cal.jsDateToDateTime(data.enddate, cal.floating()));</span>
<a href="#l8.83"></a><span id="l8.83">         if (!isEvent) {</span>
<a href="#l8.84"></a><span id="l8.84">             dialog.check(iframeId(&quot;todo-has-duedate&quot;), true);</span>
<a href="#l8.85"></a><span id="l8.85">         }</span>
<a href="#l8.86"></a><span id="l8.86">         dialog.keypress(endDateInput, &quot;a&quot;, { accelKey: true });</span>
<a href="#l8.87"></a><span id="l8.87">         dialog.type(endDateInput, enddate);</span>
<a href="#l8.88"></a><span id="l8.88">     }</span>
<a href="#l8.89"></a><span id="l8.89"> </span>
<a href="#l8.90"></a><span id="l8.90">     // endtime</span>
<a href="#l8.91"></a><span id="l8.91">     if (data.endtime != undefined &amp;&amp; data.endtime.constructor.name == &quot;Date&quot;) {</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-        let hms = [data.endtime.getHours(), data.endtime.getMinutes(), 0];</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-        let endtime = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, ...hms);</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+        let endtime = dateFormatter.formatTime(cal.jsDateToDateTime(data.endtime, cal.floating()));</span>
<a href="#l8.95"></a><span id="l8.95">         endTimeInput.getNode().value = endtime;</span>
<a href="#l8.96"></a><span id="l8.96">     }</span>
<a href="#l8.97"></a><span id="l8.97"> </span>
<a href="#l8.98"></a><span id="l8.98">     // recurrence</span>
<a href="#l8.99"></a><span id="l8.99">     if (data.repeat != undefined) {</span>
<a href="#l8.100"></a><span id="l8.100">         menulistSelect(iframeId(&quot;item-repeat&quot;), data.repeat, dialog);</span>
<a href="#l8.101"></a><span id="l8.101">     }</span>
<a href="#l8.102"></a><span id="l8.102"> </span>
<a href="#l8.103"></a><span id="l8.103" class="difflineat">@@ -792,22 +780,17 @@ function setData(dialog, iframe, data) {</span>
<a href="#l8.104"></a><span id="l8.104">             menulistSelect(iframeId(&quot;todo-status&quot;), data.status.toUpperCase(), dialog);</span>
<a href="#l8.105"></a><span id="l8.105">         }</span>
<a href="#l8.106"></a><span id="l8.106">     }</span>
<a href="#l8.107"></a><span id="l8.107"> </span>
<a href="#l8.108"></a><span id="l8.108">     let currentStatus = iframeId(&quot;todo-status&quot;).getNode().value;</span>
<a href="#l8.109"></a><span id="l8.109"> </span>
<a href="#l8.110"></a><span id="l8.110">     // completed on</span>
<a href="#l8.111"></a><span id="l8.111">     if (data.completed != undefined &amp;&amp; data.completed.constructor.name == &quot;Date&quot; &amp;&amp; !isEvent) {</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-        let ymd = [</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-            data.completed.getFullYear(),</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-            data.completed.getMonth() + 1,</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-            data.completed.getDate()</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-        ];</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-        let completeddate = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, ...ymd);</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+        let completeddate = dateFormatter.formatDateShort(cal.jsDateToDateTime(data.completed, cal.floating()));</span>
<a href="#l8.119"></a><span id="l8.119"> </span>
<a href="#l8.120"></a><span id="l8.120">         if (currentStatus == &quot;COMPLETED&quot;) {</span>
<a href="#l8.121"></a><span id="l8.121">             completedDateInput.getNode().value = completeddate;</span>
<a href="#l8.122"></a><span id="l8.122">         }</span>
<a href="#l8.123"></a><span id="l8.123">     }</span>
<a href="#l8.124"></a><span id="l8.124"> </span>
<a href="#l8.125"></a><span id="l8.125">     // percent complete</span>
<a href="#l8.126"></a><span id="l8.126">     if (data.percent != undefined &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,16 +1,18 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.5"></a><span id="l9.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.6"></a><span id="l9.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> var MODULE_NAME = &quot;testBasicFunctionality&quot;;</span>
<a href="#l9.9"></a><span id="l9.9"> var RELATIVE_ROOT = &quot;./shared-modules&quot;;</span>
<a href="#l9.10"></a><span id="l9.10"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;, &quot;window-helpers&quot;];</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+</span>
<a href="#l9.14"></a><span id="l9.14"> var plan_for_modal_dialog, wait_for_modal_dialog;</span>
<a href="#l9.15"></a><span id="l9.15"> var helpersForController, deleteCalendars, handleNewCalendarWizard;</span>
<a href="#l9.16"></a><span id="l9.16"> var TIMEOUT_MODAL_DIALOG, CALENDARNAME;</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18"> function setupModule(module) {</span>
<a href="#l9.19"></a><span id="l9.19">     controller = mozmill.getMail3PaneController();</span>
<a href="#l9.20"></a><span id="l9.20">     ({ plan_for_modal_dialog, wait_for_modal_dialog } =</span>
<a href="#l9.21"></a><span id="l9.21">         collector.getModule(&quot;window-helpers&quot;));</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -21,18 +23,17 @@ function setupModule(module) {</span>
<a href="#l9.23"></a><span id="l9.23">         TIMEOUT_MODAL_DIALOG,</span>
<a href="#l9.24"></a><span id="l9.24">         CALENDARNAME</span>
<a href="#l9.25"></a><span id="l9.25">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l9.26"></a><span id="l9.26">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l9.27"></a><span id="l9.27">     Object.assign(module, helpersForController(controller));</span>
<a href="#l9.28"></a><span id="l9.28"> }</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30"> function testSmokeTest() {</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l9.34"></a><span id="l9.34">     let path = `</span>
<a href="#l9.35"></a><span id="l9.35">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l9.36"></a><span id="l9.36">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)</span>
<a href="#l9.37"></a><span id="l9.37">     `;</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39">     // open calendar view</span>
<a href="#l9.40"></a><span id="l9.40">     controller.click(eid(&quot;calendar-tab-button&quot;));</span>
<a href="#l9.41"></a><span id="l9.41"> </span>
<a href="#l9.42"></a><span id="l9.42" class="difflineat">@@ -54,17 +55,19 @@ function testSmokeTest() {</span>
<a href="#l9.43"></a><span id="l9.43">     `));</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45">     // check for event search</span>
<a href="#l9.46"></a><span id="l9.46">     controller.assertNode(eid(&quot;bottom-events-box&quot;));</span>
<a href="#l9.47"></a><span id="l9.47">     // there should be search field</span>
<a href="#l9.48"></a><span id="l9.48">     controller.assertNode(eid(&quot;unifinder-search-field&quot;));</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50">     // default view is day view which should have 09:00 label and box</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-    let label = dateService.FormatTime(&quot;&quot;, dateService.timeFormatNoSeconds, 9, 0, 0);</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+    let someTime = cal.createDateTime();</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+    someTime.resetTo(someTime.year, someTime.month, someTime.day, 9, 0, 0, someTime.timezone);</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+    let label = dateFormatter.formatTime(someTime);</span>
<a href="#l9.55"></a><span id="l9.55">     controller.assertNode(lookup(`</span>
<a href="#l9.56"></a><span id="l9.56">         ${path}/id(&quot;calendarDisplayDeck&quot;)/id(&quot;calendar-view-box&quot;)/</span>
<a href="#l9.57"></a><span id="l9.57">         id(&quot;view-deck&quot;)/id(&quot;day-view&quot;)/anon({&quot;anonid&quot;:&quot;mainbox&quot;})/</span>
<a href="#l9.58"></a><span id="l9.58">         anon({&quot;anonid&quot;:&quot;scrollbox&quot;})/anon({&quot;anonid&quot;:&quot;timebar&quot;})/</span>
<a href="#l9.59"></a><span id="l9.59">         anon({&quot;anonid&quot;:&quot;topbox&quot;})/[9]/</span>
<a href="#l9.60"></a><span id="l9.60">         {&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;${label}&quot;}</span>
<a href="#l9.61"></a><span id="l9.61">     `));</span>
<a href="#l9.62"></a><span id="l9.62">     controller.assertNode(lookup(`</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testDayView.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,15 +1,17 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l10.9"></a><span id="l10.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+</span>
<a href="#l10.13"></a><span id="l10.13"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l10.14"></a><span id="l10.14"> var CALENDARNAME;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> var TITLE1 = &quot;Day View Event&quot;;</span>
<a href="#l10.17"></a><span id="l10.17"> var TITLE2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l10.18"></a><span id="l10.18"> var DESC = &quot;Day View Event Description&quot;;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> function setupModule(module) {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -23,18 +25,17 @@ function setupModule(module) {</span>
<a href="#l10.22"></a><span id="l10.22">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l10.23"></a><span id="l10.23">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l10.24"></a><span id="l10.24">     Object.assign(module, helpersForController(controller));</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l10.27"></a><span id="l10.27"> }</span>
<a href="#l10.28"></a><span id="l10.28"> </span>
<a href="#l10.29"></a><span id="l10.29"> function testDayView() {</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-    let dateService = Cc[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-                        .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l10.33"></a><span id="l10.33">     // paths</span>
<a href="#l10.34"></a><span id="l10.34">     let miniMonth = `</span>
<a href="#l10.35"></a><span id="l10.35">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l10.36"></a><span id="l10.36">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l10.37"></a><span id="l10.37">         id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l10.38"></a><span id="l10.38">         id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l10.39"></a><span id="l10.39">     `;</span>
<a href="#l10.40"></a><span id="l10.40">     let dayView = `</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineat">@@ -98,17 +99,19 @@ function testDayView() {</span>
<a href="#l10.42"></a><span id="l10.42">             id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l10.43"></a><span id="l10.43">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l10.44"></a><span id="l10.44">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l10.45"></a><span id="l10.45">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l10.46"></a><span id="l10.46">             anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l10.47"></a><span id="l10.47">         `);</span>
<a href="#l10.48"></a><span id="l10.48">         event.waitForElement(startTimeInput);</span>
<a href="#l10.49"></a><span id="l10.49">         event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+        let someTime = cal.createDateTime();</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+        someTime.resetTo(2009, 1, 1);</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l10.54"></a><span id="l10.54">         event.assertValue(eventlookup(`</span>
<a href="#l10.55"></a><span id="l10.55">             ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l10.56"></a><span id="l10.56">             id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l10.57"></a><span id="l10.57">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l10.58"></a><span id="l10.58">             anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l10.59"></a><span id="l10.59">             {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l10.60"></a><span id="l10.60">             anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l10.61"></a><span id="l10.61">             anon({&quot;anonid&quot;:&quot;input&quot;})</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMonthView.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,15 +1,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l11.9"></a><span id="l11.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l11.14"></a><span id="l11.14"> var CALENDARNAME;</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> var TITLE1 = &quot;Month View Event&quot;;</span>
<a href="#l11.17"></a><span id="l11.17"> var TITLE2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l11.18"></a><span id="l11.18"> var DESC = &quot;Month View Event Description&quot;;</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20"> function setupModule(module) {</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -23,18 +25,17 @@ function setupModule(module) {</span>
<a href="#l11.22"></a><span id="l11.22">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l11.23"></a><span id="l11.23">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l11.24"></a><span id="l11.24">     Object.assign(module, helpersForController(controller));</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l11.27"></a><span id="l11.27"> }</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29"> function testMonthView() {</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l11.33"></a><span id="l11.33">     // paths</span>
<a href="#l11.34"></a><span id="l11.34">     let miniMonth = `</span>
<a href="#l11.35"></a><span id="l11.35">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l11.36"></a><span id="l11.36">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l11.37"></a><span id="l11.37">         id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l11.38"></a><span id="l11.38">         id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l11.39"></a><span id="l11.39">     `;</span>
<a href="#l11.40"></a><span id="l11.40">     let monthView = `</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineat">@@ -109,17 +110,19 @@ function testMonthView() {</span>
<a href="#l11.42"></a><span id="l11.42">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l11.43"></a><span id="l11.43">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l11.44"></a><span id="l11.44">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l11.45"></a><span id="l11.45">             anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l11.46"></a><span id="l11.46">         `);</span>
<a href="#l11.47"></a><span id="l11.47">         event.waitForElement(startTimeInput);</span>
<a href="#l11.48"></a><span id="l11.48">         event.assertValue(startTimeInput, startTime);</span>
<a href="#l11.49"></a><span id="l11.49"> </span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+        let someTime = cal.now();</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+        someTime.resetTo(2009, 1, 1);</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l11.54"></a><span id="l11.54">         event.assertValue(eventlookup(`</span>
<a href="#l11.55"></a><span id="l11.55">             ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l11.56"></a><span id="l11.56">             id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l11.57"></a><span id="l11.57">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l11.58"></a><span id="l11.58">             anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l11.59"></a><span id="l11.59">             {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l11.60"></a><span id="l11.60">             anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l11.61"></a><span id="l11.61">             anon({&quot;anonid&quot;:&quot;input&quot;})</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testMultiweekView.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,15 +1,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.5"></a><span id="l12.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.6"></a><span id="l12.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l12.9"></a><span id="l12.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+</span>
<a href="#l12.13"></a><span id="l12.13"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l12.14"></a><span id="l12.14"> var CALENDARNAME;</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16"> var TITLE1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l12.17"></a><span id="l12.17"> var TITLE2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l12.18"></a><span id="l12.18"> var DESC = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20"> function setupModule(module) {</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -23,18 +25,17 @@ function setupModule(module) {</span>
<a href="#l12.22"></a><span id="l12.22">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l12.23"></a><span id="l12.23">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l12.24"></a><span id="l12.24">     Object.assign(module, helpersForController(controller));</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l12.27"></a><span id="l12.27"> }</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29"> function testMultiWeekView() {</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l12.33"></a><span id="l12.33">     // paths</span>
<a href="#l12.34"></a><span id="l12.34">     let miniMonth = `</span>
<a href="#l12.35"></a><span id="l12.35">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l12.36"></a><span id="l12.36">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l12.37"></a><span id="l12.37">         id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l12.38"></a><span id="l12.38">         id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l12.39"></a><span id="l12.39">     `;</span>
<a href="#l12.40"></a><span id="l12.40">     let multiWeekView = `</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -108,17 +109,19 @@ function testMultiWeekView() {</span>
<a href="#l12.42"></a><span id="l12.42">             id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l12.43"></a><span id="l12.43">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l12.44"></a><span id="l12.44">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l12.45"></a><span id="l12.45">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l12.46"></a><span id="l12.46">             anon({&quot;anonid&quot;:&quot;input&quot;})</span>
<a href="#l12.47"></a><span id="l12.47">         `);</span>
<a href="#l12.48"></a><span id="l12.48">         event.waitForElement(startTimeInput);</span>
<a href="#l12.49"></a><span id="l12.49">         event.assertValue(startTimeInput, startTime);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+        let someTime = cal.createDateTime();</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+        someTime.resetTo(2009, 1, 1);</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l12.54"></a><span id="l12.54">         event.assertValue(eventlookup(`</span>
<a href="#l12.55"></a><span id="l12.55">             ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l12.56"></a><span id="l12.56">             id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l12.57"></a><span id="l12.57">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l12.58"></a><span id="l12.58">             anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l12.59"></a><span id="l12.59">             {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l12.60"></a><span id="l12.60">             anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l12.61"></a><span id="l12.61">             anon({&quot;anonid&quot;:&quot;input&quot;})</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/test/mozmill/views/testWeekView.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,15 +1,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.5"></a><span id="l13.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.6"></a><span id="l13.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l13.9"></a><span id="l13.9"> var MODULE_REQUIRES = [&quot;calendar-utils&quot;];</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+</span>
<a href="#l13.13"></a><span id="l13.13"> var helpersForController, invokeEventDialog, createCalendar, deleteCalendars;</span>
<a href="#l13.14"></a><span id="l13.14"> var CALENDARNAME;</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16"> var TITLE1 = &quot;Week View Event&quot;;</span>
<a href="#l13.17"></a><span id="l13.17"> var TITLE2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l13.18"></a><span id="l13.18"> var DESC = &quot;Week View Event Description&quot;;</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> function setupModule(module) {</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -24,18 +26,17 @@ function setupModule(module) {</span>
<a href="#l13.22"></a><span id="l13.22">     } = collector.getModule(&quot;calendar-utils&quot;));</span>
<a href="#l13.23"></a><span id="l13.23">     collector.getModule(&quot;calendar-utils&quot;).setupModule();</span>
<a href="#l13.24"></a><span id="l13.24">     Object.assign(module, helpersForController(controller));</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26">     createCalendar(controller, CALENDARNAME);</span>
<a href="#l13.27"></a><span id="l13.27"> }</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29"> function testWeekView() {</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-    let dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-                                .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l13.33"></a><span id="l13.33">     // paths</span>
<a href="#l13.34"></a><span id="l13.34">     let miniMonth = `</span>
<a href="#l13.35"></a><span id="l13.35">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l13.36"></a><span id="l13.36">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l13.37"></a><span id="l13.37">         id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l13.38"></a><span id="l13.38">         id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)/</span>
<a href="#l13.39"></a><span id="l13.39">     `;</span>
<a href="#l13.40"></a><span id="l13.40">     let weekView = `</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineat">@@ -105,17 +106,19 @@ function testWeekView() {</span>
<a href="#l13.42"></a><span id="l13.42">             id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l13.43"></a><span id="l13.43">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;time-picker&quot;})/</span>
<a href="#l13.44"></a><span id="l13.44">             anon({&quot;class&quot;:&quot;timepicker-box-class&quot;})/</span>
<a href="#l13.45"></a><span id="l13.45">             anon({&quot;class&quot;:&quot;timepicker-text-class&quot;})/anon({&quot;flex&quot;:&quot;1&quot;})/</span>
<a href="#l13.46"></a><span id="l13.46">             anon({&quot;anonid&quot;:&quot;input&quot;})'</span>
<a href="#l13.47"></a><span id="l13.47">         `);</span>
<a href="#l13.48"></a><span id="l13.48">         event.waitForElement(startTimeInput);</span>
<a href="#l13.49"></a><span id="l13.49">         event.assertValue(startTimeInput, &quot;8:00&quot;);</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-        let date = dateService.FormatDate(&quot;&quot;, dateService.dateFormatShort, 2009, 1, 1);</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+        let someTime = cal.createDateTime();</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+        someTime.resetTo(2009, 1, 1);</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+        let date = dateFormatter.formatDateShort(someDate);</span>
<a href="#l13.54"></a><span id="l13.54">         event.assertValue(eventlookup(`</span>
<a href="#l13.55"></a><span id="l13.55">             ${eventDialog}/id(&quot;event-grid-startdate-row&quot;)/</span>
<a href="#l13.56"></a><span id="l13.56">             id(&quot;event-grid-startdate-picker-box&quot;)/id(&quot;event-starttime&quot;)/</span>
<a href="#l13.57"></a><span id="l13.57">             anon({&quot;anonid&quot;:&quot;hbox&quot;})/anon({&quot;anonid&quot;:&quot;date-picker&quot;})/</span>
<a href="#l13.58"></a><span id="l13.58">             anon({&quot;flex&quot;:&quot;1&quot;,&quot;id&quot;:&quot;hbox&quot;,&quot;class&quot;:&quot;datepicker-box-class&quot;})/</span>
<a href="#l13.59"></a><span id="l13.59">             {&quot;class&quot;:&quot;datepicker-text-class&quot;}/</span>
<a href="#l13.60"></a><span id="l13.60">             anon({&quot;class&quot;:&quot;menulist-editable-box textbox-input-box&quot;})/</span>
<a href="#l13.61"></a><span id="l13.61">             anon({&quot;anonid&quot;:&quot;input&quot;})</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -438,50 +438,24 @@ add_task(function* compareInvitationOver</span>
<a href="#l14.4"></a><span id="l14.4">             },</span>
<a href="#l14.5"></a><span id="l14.5">             current: {</span>
<a href="#l14.6"></a><span id="l14.6">                 dtstart: &quot;DTSTART;TZID=Europe/Berlin:20150909T140000\r\n&quot;,</span>
<a href="#l14.7"></a><span id="l14.7">                 dtend: &quot;DTEND;TZID=Europe/Berlin:20150909T150000\r\n&quot;</span>
<a href="#l14.8"></a><span id="l14.8">             },</span>
<a href="#l14.9"></a><span id="l14.9">             ignore: &quot;&quot;</span>
<a href="#l14.10"></a><span id="l14.10">         },</span>
<a href="#l14.11"></a><span id="l14.11">         expected: {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-            // time format is platform dependent, so we use alternative result sets here</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-            // the first three are to meet configurations running for automated tests, the</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-            // following are some flavours that may occur - if you get a failure for this test,</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-            // add your pattern here</span>
<a href="#l14.16"></a><span id="l14.16">             node: &quot;imipHtml-when-content&quot;,</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-            some: [&quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wed 9 Sep 2015 02:00 PM  03:00 PM&lt;/span&gt;&quot; +</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-                   &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wed 9 Sep 2015 01:00 PM  02:00 PM&lt;/span&gt;&quot;,</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wed 9 Sep 2015 2:00 PM  3:00 PM&lt;/span&gt;&quot; +</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-                   &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wed 9 Sep 2015 1:00 PM  2:00 PM&lt;/span&gt;&quot;,</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wednesday, September 09, 2015 2:00 PM  3:00 PM&lt;/span&gt;&quot; +</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+            some: [&quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wednesday, September 09, 2015 2:00 PM  3:00 PM&lt;/span&gt;&quot; +</span>
<a href="#l14.27"></a><span id="l14.27">                    &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l14.28"></a><span id="l14.28">                    &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wednesday, September 09, 2015 1:00 PM  2:00 PM&lt;/span&gt;&quot;,</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-                   // do not change the patterns above unless there are related test failures when</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-                   // running automated tests</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wed 09 Sep 2015 2:00 PM  3:00 PM&lt;/span&gt;&quot; +</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-                   &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wed 09 Sep 2015 1:00 PM  2:00 PM&lt;/span&gt;&quot;,</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wednesday, 09 September, 2015 2:00 PM  3:00 PM&lt;/span&gt;&quot; +</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wednesday, September 09, 2015 14:00  15:00&lt;/span&gt;&quot; +</span>
<a href="#l14.38"></a><span id="l14.38">                    &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wednesday, 09 September, 2015 1:00 PM  2:00 PM&lt;/span&gt;&quot;,</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wed 9 Sep 2015 14:00  15:00&lt;/span&gt;&quot; +</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-                   &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wed 9 Sep 2015 13:00  14:00&lt;/span&gt;&quot;,</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;added\&quot;&gt;Wed 09 Sep 2015 14:00  15:00&lt;/span&gt;&quot; +</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-                   &quot;&lt;br xmlns=\&quot;\&quot;/&gt;&quot; +</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wed 09 Sep 2015 13:00  14:00&lt;/span&gt;&quot;]</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+                   &quot;&lt;span xmlns=\&quot;\&quot; class=\&quot;removed\&quot;&gt;Wednesday, September 09, 2015 13:00  14:00&lt;/span&gt;&quot;]</span>
<a href="#l14.49"></a><span id="l14.49">         }</span>
<a href="#l14.50"></a><span id="l14.50">     }, {</span>
<a href="#l14.51"></a><span id="l14.51">         input: {</span>
<a href="#l14.52"></a><span id="l14.52">             previous: { organizer: &quot;ORGANIZER:mailto:organizer1@example.net\r\n&quot; },</span>
<a href="#l14.53"></a><span id="l14.53">             current: { organizer: &quot;ORGANIZER:mailto:organizer2@example.net\r\n&quot; },</span>
<a href="#l14.54"></a><span id="l14.54">             ignore: &quot;&quot;</span>
<a href="#l14.55"></a><span id="l14.55">         },</span>
<a href="#l14.56"></a><span id="l14.56">         expected: {</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineat">@@ -833,32 +807,26 @@ add_task(function* parseCounter_test() {</span>
<a href="#l14.58"></a><span id="l14.58">                 proposed: &quot;Test Event 2&quot;,</span>
<a href="#l14.59"></a><span id="l14.59">                 original: &quot;Test Event&quot;</span>
<a href="#l14.60"></a><span id="l14.60">             }, {</span>
<a href="#l14.61"></a><span id="l14.61">                 property: &quot;LOCATION&quot;,</span>
<a href="#l14.62"></a><span id="l14.62">                 proposed: &quot;Room 2&quot;,</span>
<a href="#l14.63"></a><span id="l14.63">                 original: &quot;Room 1&quot;</span>
<a href="#l14.64"></a><span id="l14.64">             }, {</span>
<a href="#l14.65"></a><span id="l14.65">                 property: &quot;DTSTART&quot;,</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-                proposed: [&quot;Thursday, September 10, 2015 9:00 PM Europe/Berlin&quot;, // Automation Win</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineminus">-                           &quot;Thu 10 Sep 2015 9:00 PM Europe/Berlin&quot;, // Automation OSX</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-                           &quot;Thu 10 Sep 2015 09:00 PM Europe/Berlin&quot;, // Automation Linux</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-                           &quot;Thu 10 Sep 2015 21:00 Europe/Berlin&quot;], // Local Win 24h</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+                proposed: [&quot;Thursday, September 10, 2015 9:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+                           &quot;Thursday, September 10, 2015 21:00 Europe/Berlin&quot;],</span>
<a href="#l14.72"></a><span id="l14.72">                 original: [&quot;Wednesday, September 09, 2015 9:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-                           &quot;Wed 9 Sep 2015 9:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-                           &quot;Wed 9 Sep 2015 09:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-                           &quot;Wed 9 Sep 2015 21:00 Europe/Berlin&quot;]</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+                           &quot;Wednesday, September 09, 2015 21:00 Europe/Berlin&quot;]</span>
<a href="#l14.77"></a><span id="l14.77">             }, {</span>
<a href="#l14.78"></a><span id="l14.78">                 property: &quot;DTEND&quot;,</span>
<a href="#l14.79"></a><span id="l14.79">                 proposed: [&quot;Thursday, September 10, 2015 10:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineminus">-                           &quot;Thu 10 Sep 2015 10:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-                           &quot;Thu 10 Sep 2015 22:00 Europe/Berlin&quot;],</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+                           &quot;Thursday, September 10, 2015 22:00 Europe/Berlin&quot;],</span>
<a href="#l14.83"></a><span id="l14.83">                 original: [&quot;Wednesday, September 09, 2015 10:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-                           &quot;Wed 9 Sep 2015 10:00 PM Europe/Berlin&quot;,</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-                           &quot;Wed 9 Sep 2015 22:00 Europe/Berlin&quot;]</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+                           &quot;Wednesday, September 09, 2015 22:00 Europe/Berlin&quot;]</span>
<a href="#l14.87"></a><span id="l14.87">             }, {</span>
<a href="#l14.88"></a><span id="l14.88">                 property: &quot;COMMENT&quot;,</span>
<a href="#l14.89"></a><span id="l14.89">                 proposed: &quot;Sorry\, I cannot make it that time.&quot;,</span>
<a href="#l14.90"></a><span id="l14.90">                 original: null</span>
<a href="#l14.91"></a><span id="l14.91">             }]</span>
<a href="#l14.92"></a><span id="l14.92">         }</span>
<a href="#l14.93"></a><span id="l14.93">     }, {</span>
<a href="#l14.94"></a><span id="l14.94">         // #2: test with an unsupported property has been changed</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

