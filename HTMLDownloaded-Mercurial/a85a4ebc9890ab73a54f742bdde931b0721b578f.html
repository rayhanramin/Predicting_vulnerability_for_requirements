<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17497:a85a4ebc9890ab73a54f742bdde931b0721b578f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a85a4ebc9890ab73a54f742bdde931b0721b578f" />
<meta property="og:url" content="/comm-central/rev/a85a4ebc9890ab73a54f742bdde931b0721b578f" />
<meta property="og:description" content="Bug 854791 - Check free disk space looks enough before starting compacting mbox folder. r=rkent, ui-r=bwinton, a=Ratty on a SeaMonkey CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a85a4ebc9890ab73a54f742bdde931b0721b578f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a85a4ebc9890ab73a54f742bdde931b0721b578f">shortlog</a> |
<a href="/comm-central/log/a85a4ebc9890ab73a54f742bdde931b0721b578f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a85a4ebc9890ab73a54f742bdde931b0721b578f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a85a4ebc9890ab73a54f742bdde931b0721b578f">files</a> |
changeset |
<a href="/comm-central/raw-rev/a85a4ebc9890ab73a54f742bdde931b0721b578f">raw</a>  | <a href="/comm-central/archive/a85a4ebc9890ab73a54f742bdde931b0721b578f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=854791">Bug 854791</a> - Check free disk space looks enough before starting compacting mbox folder. r=rkent, ui-r=bwinton, a=Ratty on a SeaMonkey CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 17 Feb 2015 14:18:54 +0100</td></tr>

<tr>
 <td>changeset 17497</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a85a4ebc9890ab73a54f742bdde931b0721b578f">a85a4ebc9890ab73a54f742bdde931b0721b578f</a></td>
</tr>



<tr>
<td>parent 17496</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/bc4533660d85dd258450230c757e99e34cda99b5">bc4533660d85dd258450230c757e99e34cda99b5</a>
</td>
</tr>

<tr>
<td>child 17498</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/99137515f12e4dfd620221e48e96cb4af13a2d84">99137515f12e4dfd620221e48e96cb4af13a2d84</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a85a4ebc9890ab73a54f742bdde931b0721b578f">10771</a></td></tr>
<tr><td>push user</td><td>archaeopteryx@coole-files.de</td></tr>
<tr><td>push date</td><td class="date age">Tue, 17 Feb 2015 17:01:35 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a85a4ebc9890 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a85a4ebc9890ab73a54f742bdde931b0721b578f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a85a4ebc9890ab73a54f742bdde931b0721b578f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a85a4ebc9890ab73a54f742bdde931b0721b578f&newProject=comm-central&newRevision=a85a4ebc9890ab73a54f742bdde931b0721b578f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a85a4ebc9890ab73a54f742bdde931b0721b578f&newProject=comm-central&newRevision=a85a4ebc9890ab73a54f742bdde931b0721b578f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a85a4ebc9890ab73a54f742bdde931b0721b578f&newProject=comm-central&newRevision=a85a4ebc9890ab73a54f742bdde931b0721b578f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28rkent%29&revcount=50">rkent</a>, <a href="/comm-central/log?rev=reviewer%28bwinton%29&revcount=50">bwinton</a>, <a href="/comm-central/log?rev=reviewer%28Ratty%29&revcount=50">Ratty</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=854791">854791</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=854791">Bug 854791</a> - Check free disk space looks enough before starting compacting mbox folder. r=rkent, ui-r=bwinton, a=Ratty on a SeaMonkey CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a85a4ebc9890ab73a54f742bdde931b0721b578f/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/a85a4ebc9890ab73a54f742bdde931b0721b578f/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/a85a4ebc9890ab73a54f742bdde931b0721b578f/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/a85a4ebc9890ab73a54f742bdde931b0721b578f/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.cpp">mailnews/base/src/nsMsgFolderCompactor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.cpp">file</a> |
<a href="/comm-central/annotate/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.cpp">annotate</a> |
<a href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.cpp">diff</a> |
<a href="/comm-central/comparison/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.cpp">comparison</a> |
<a href="/comm-central/log/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.h">mailnews/base/src/nsMsgFolderCompactor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.h">file</a> |
<a href="/comm-central/annotate/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.h">annotate</a> |
<a href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.h">diff</a> |
<a href="/comm-central/comparison/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.h">comparison</a> |
<a href="/comm-central/log/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/base/src/nsMsgFolderCompactor.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/public/nsIMsgDatabase.idl">mailnews/db/msgdb/public/nsIMsgDatabase.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/public/nsIMsgDatabase.idl">file</a> |
<a href="/comm-central/annotate/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/public/nsIMsgDatabase.idl">annotate</a> |
<a href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/public/nsIMsgDatabase.idl">diff</a> |
<a href="/comm-central/comparison/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/public/nsIMsgDatabase.idl">comparison</a> |
<a href="/comm-central/log/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/public/nsIMsgDatabase.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/a85a4ebc9890ab73a54f742bdde931b0721b578f/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/suite/locales/en-US/chrome/mailnews/messenger.properties">suite/locales/en-US/chrome/mailnews/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a85a4ebc9890ab73a54f742bdde931b0721b578f/suite/locales/en-US/chrome/mailnews/messenger.properties">file</a> |
<a href="/comm-central/annotate/a85a4ebc9890ab73a54f742bdde931b0721b578f/suite/locales/en-US/chrome/mailnews/messenger.properties">annotate</a> |
<a href="/comm-central/diff/a85a4ebc9890ab73a54f742bdde931b0721b578f/suite/locales/en-US/chrome/mailnews/messenger.properties">diff</a> |
<a href="/comm-central/comparison/a85a4ebc9890ab73a54f742bdde931b0721b578f/suite/locales/en-US/chrome/mailnews/messenger.properties">comparison</a> |
<a href="/comm-central/log/a85a4ebc9890ab73a54f742bdde931b0721b578f/suite/locales/en-US/chrome/mailnews/messenger.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -78,16 +78,17 @@ confirmFolderDeletionForFilter=Deleting </span>
<a href="#l1.4"></a><span id="l1.4"> alertFilterChanged=Filters associated with this folder will be updated.</span>
<a href="#l1.5"></a><span id="l1.5"> filterDisabled=The folder '%S' could not be found, so filter(s) associated with this folder will be disabled. Verify that the folder exists, and that filters point to a valid destination folder.</span>
<a href="#l1.6"></a><span id="l1.6"> filterFolderDeniedLocked=The messages could not be filtered to folder '%S' because another operation is in progress.</span>
<a href="#l1.7"></a><span id="l1.7"> parsingFolderFailed=Unable to open the folder %S because it is in use by some other operation. Please wait for that operation to finish and then select the folder again.</span>
<a href="#l1.8"></a><span id="l1.8"> deletingMsgsFailed=Unable to delete messages in folder %S because it is in use by some other operation. Please wait for that operation to finish and then try again.</span>
<a href="#l1.9"></a><span id="l1.9"> alertFilterCheckbox=Do not warn me again.</span>
<a href="#l1.10"></a><span id="l1.10"> compactFolderDeniedLock=The folder '%S' cannot be compacted because another operation is in progress. Please try again later.</span>
<a href="#l1.11"></a><span id="l1.11"> compactFolderWriteFailed=The folder '%S' could not be compacted because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+compactFolderInsufficientSpace=Some folders (e.g. '%S') cannot be compacted because there is not enough free disk space. Please delete some files and try again.</span>
<a href="#l1.13"></a><span id="l1.13"> filterFolderHdrAddFailed=The messages could not be filtered to folder '%S' because adding a message to it failed. Verify that the folder is displaying properly or try to repair it from the folder properties.</span>
<a href="#l1.14"></a><span id="l1.14"> filterFolderWriteFailed=The messages could not be filtered to folder '%S' because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l1.15"></a><span id="l1.15"> copyMsgWriteFailed=The messages could not be moved or copied to folder '%S' because writing to folder failed. To gain disk space, from the File menu, first choose Empty Trash, and then choose Compact Folders, and then try again.</span>
<a href="#l1.16"></a><span id="l1.16"> cantMoveMsgWOBodyOffline=While working offline, you cannot move or copy messages that were not downloaded for offline use. From the Mail window, open the File menu, choose Offline, then uncheck Work Offline, and then try again.</span>
<a href="#l1.17"></a><span id="l1.17"> operationFailedFolderBusy=The operation failed because another operation is using the folder. Please wait for that operation to finish and then try again.</span>
<a href="#l1.18"></a><span id="l1.18"> folderRenameFailed=The folder could not be renamed. Perhaps the folder is being reparsed, or the new name is not a valid folder name.</span>
<a href="#l1.19"></a><span id="l1.19"> # LOCALIZATION NOTE(verboseFolderFormat): %1$S is folder name, %2$S is server name</span>
<a href="#l1.20"></a><span id="l1.20"> verboseFolderFormat=%1$S on %2$S</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -28,16 +28,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsMsgFolderCompactor.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#include &lt;algorithm&gt;</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.15"></a><span id="l2.15"> // nsFolderCompactState</span>
<a href="#l2.16"></a><span id="l2.16"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> NS_IMPL_ISUPPORTS(nsFolderCompactState, nsIMsgFolderCompactor, nsIRequestObserver, nsIStreamListener, nsICopyMessageStreamListener, nsIUrlListener)</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> nsFolderCompactState::nsFolderCompactState()</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -49,16 +50,17 @@ nsFolderCompactState::nsFolderCompactSta</span>
<a href="#l2.22"></a><span id="l2.22">   m_compactAll = false;</span>
<a href="#l2.23"></a><span id="l2.23">   m_compactOfflineAlso = false;</span>
<a href="#l2.24"></a><span id="l2.24">   m_compactingOfflineFolders = false;</span>
<a href="#l2.25"></a><span id="l2.25">   m_parsingFolder=false;</span>
<a href="#l2.26"></a><span id="l2.26">   m_folderIndex = 0;</span>
<a href="#l2.27"></a><span id="l2.27">   m_startOfMsg = true;</span>
<a href="#l2.28"></a><span id="l2.28">   m_needStatusLine = false;</span>
<a href="#l2.29"></a><span id="l2.29">   m_totalExpungedBytes = 0;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+  m_alreadyWarnedDiskSpace = false;</span>
<a href="#l2.31"></a><span id="l2.31"> }</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33"> nsFolderCompactState::~nsFolderCompactState()</span>
<a href="#l2.34"></a><span id="l2.34"> {</span>
<a href="#l2.35"></a><span id="l2.35">   CloseOutputStream();</span>
<a href="#l2.36"></a><span id="l2.36">   if (NS_FAILED(m_status))</span>
<a href="#l2.37"></a><span id="l2.37">   {</span>
<a href="#l2.38"></a><span id="l2.38">     CleanupTempFilesAfterError();</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineat">@@ -162,24 +164,19 @@ nsFolderCompactState::Compact(nsIMsgFold</span>
<a href="#l2.40"></a><span id="l2.40">   m_listener = aListener;</span>
<a href="#l2.41"></a><span id="l2.41">   if (!m_compactingOfflineFolders &amp;&amp; !aOfflineStore)</span>
<a href="#l2.42"></a><span id="l2.42">   {</span>
<a href="#l2.43"></a><span id="l2.43">     nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder = do_QueryInterface(folder);</span>
<a href="#l2.44"></a><span id="l2.44">     if (imapFolder)</span>
<a href="#l2.45"></a><span id="l2.45">       return imapFolder-&gt;Expunge(this, aMsgWindow);</span>
<a href="#l2.46"></a><span id="l2.46">   }</span>
<a href="#l2.47"></a><span id="l2.47"> </span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-   int64_t expunged;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-   folder-&gt;GetExpungedBytes(&amp;expunged);</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-   m_totalExpungedBytes += expunged;</span>
<a href="#l2.51"></a><span id="l2.51">    m_window = aMsgWindow;</span>
<a href="#l2.52"></a><span id="l2.52">    nsresult rv;</span>
<a href="#l2.53"></a><span id="l2.53">    nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-   nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-   nsCOMPtr&lt;nsIMsgDatabase&gt; mailDBFactory;</span>
<a href="#l2.56"></a><span id="l2.56">    nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l2.57"></a><span id="l2.57">    nsCString baseMessageURI;</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59">    nsCOMPtr &lt;nsIMsgLocalMailFolder&gt; localFolder = do_QueryInterface(folder, &amp;rv);</span>
<a href="#l2.60"></a><span id="l2.60">    if (NS_SUCCEEDED(rv) &amp;&amp; localFolder)</span>
<a href="#l2.61"></a><span id="l2.61">    {</span>
<a href="#l2.62"></a><span id="l2.62">      rv=localFolder-&gt;GetDatabaseWOReparse(getter_AddRefs(db));</span>
<a href="#l2.63"></a><span id="l2.63">      if (NS_FAILED(rv) || !db)</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineat">@@ -207,38 +204,87 @@ nsFolderCompactState::Compact(nsIMsgFold</span>
<a href="#l2.65"></a><span id="l2.65">        }</span>
<a href="#l2.66"></a><span id="l2.66">      }</span>
<a href="#l2.67"></a><span id="l2.67">    }</span>
<a href="#l2.68"></a><span id="l2.68">    else</span>
<a href="#l2.69"></a><span id="l2.69">    {</span>
<a href="#l2.70"></a><span id="l2.70">      rv = folder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l2.71"></a><span id="l2.71">      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.72"></a><span id="l2.72">    }</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+</span>
<a href="#l2.74"></a><span id="l2.74">    rv = folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l2.75"></a><span id="l2.75">    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.76"></a><span id="l2.76"> </span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-   rv = folder-&gt;GetBaseMessageURI(baseMessageURI);</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+   int64_t expunged;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+   folder-&gt;GetExpungedBytes(&amp;expunged);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+   bool abortCompactFolder = false;</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+   int64_t diskSize;</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+   rv = folder-&gt;GetSizeOnDisk(&amp;diskSize);</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+   int64_t diskFree;</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+   rv = path-&gt;GetDiskSpaceAvailable(&amp;diskFree);</span>
<a href="#l2.88"></a><span id="l2.88">    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-    </span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-   rv = Init(folder, baseMessageURI.get(), db, path, m_window);</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+   // Let's try to not even start compact if there is really low free space.</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+   // It may still fail later as we do not know how big exactly the folder DB will</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+   // end up being.</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+   // The DB already doesn't contain references to messages that are already deleted.</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+   // So theoretically it shouldn't shrink with compact. But in practice,</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+   // the automatic shrinking of the DB may still have not yet happened.</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+   // So we cap the final size at 1KB per message.</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+   db-&gt;Commit(nsMsgDBCommitType::kCompressCommit);</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+   int64_t dbSize;</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+   rv = db-&gt;GetDatabaseSize(&amp;dbSize);</span>
<a href="#l2.103"></a><span id="l2.103">    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.104"></a><span id="l2.104"> </span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-   bool isLocked;</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-   m_folder-&gt;GetLocked(&amp;isLocked);</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-   if(!isLocked)</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+   int32_t totalMsgs;</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+   rv = folder-&gt;GetTotalMessages(false, &amp;totalMsgs);</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+   int64_t expectedDBSize = std::min&lt;int64_t&gt;(dbSize, totalMsgs * 1024);</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+   if (diskFree &lt; diskSize - expunged + expectedDBSize)</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+   {</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+     if (!m_alreadyWarnedDiskSpace)</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+     {</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+       folder-&gt;ThrowAlertMsg(&quot;compactFolderInsufficientSpace&quot;, m_window);</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+       m_alreadyWarnedDiskSpace = true;</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+     }</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+     abortCompactFolder = true;</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+   }</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+   if (!abortCompactFolder)</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+   {</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+     rv = folder-&gt;GetBaseMessageURI(baseMessageURI);</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+     rv = Init(folder, baseMessageURI.get(), db, path, m_window);</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+     bool isLocked;</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+     m_folder-&gt;GetLocked(&amp;isLocked);</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+     if (isLocked)</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+     {</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+       m_folder-&gt;NotifyCompactCompleted();</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+       CleanupTempFilesAfterError();</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+       m_folder-&gt;ThrowAlertMsg(&quot;compactFolderDeniedLock&quot;, m_window);</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+       abortCompactFolder = true;</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+     }</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+   }</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+   if (!abortCompactFolder)</span>
<a href="#l2.142"></a><span id="l2.142">    {</span>
<a href="#l2.143"></a><span id="l2.143">      nsCOMPtr &lt;nsISupports&gt; supports = do_QueryInterface(static_cast&lt;nsIMsgFolderCompactor*&gt;(this));</span>
<a href="#l2.144"></a><span id="l2.144">      m_folder-&gt;AcquireSemaphore(supports);</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+     m_totalExpungedBytes += expunged;</span>
<a href="#l2.146"></a><span id="l2.146">      return StartCompacting();</span>
<a href="#l2.147"></a><span id="l2.147">    }</span>
<a href="#l2.148"></a><span id="l2.148">    else</span>
<a href="#l2.149"></a><span id="l2.149">    {</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-     m_folder-&gt;NotifyCompactCompleted();</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-     CleanupTempFilesAfterError();</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-     m_folder-&gt;ThrowAlertMsg(&quot;compactFolderDeniedLock&quot;, m_window);</span>
<a href="#l2.153"></a><span id="l2.153">      if (m_compactAll)</span>
<a href="#l2.154"></a><span id="l2.154">        return CompactNextFolder();</span>
<a href="#l2.155"></a><span id="l2.155">      else</span>
<a href="#l2.156"></a><span id="l2.156">        return NS_OK;</span>
<a href="#l2.157"></a><span id="l2.157">    }</span>
<a href="#l2.158"></a><span id="l2.158"> }</span>
<a href="#l2.159"></a><span id="l2.159"> </span>
<a href="#l2.160"></a><span id="l2.160"> nsresult nsFolderCompactState::ShowStatusMsg(const nsString&amp; aMsg)</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineat">@@ -428,17 +474,17 @@ nsFolderCompactState::FinishCompact()</span>
<a href="#l2.162"></a><span id="l2.162">   // close down database of the original folder</span>
<a href="#l2.163"></a><span id="l2.163">   m_folder-&gt;ForceDBClosed();</span>
<a href="#l2.164"></a><span id="l2.164"> </span>
<a href="#l2.165"></a><span id="l2.165">   nsCOMPtr&lt;nsIFile&gt; cloneFile;</span>
<a href="#l2.166"></a><span id="l2.166">   int64_t fileSize;</span>
<a href="#l2.167"></a><span id="l2.167">   rv = m_file-&gt;Clone(getter_AddRefs(cloneFile));</span>
<a href="#l2.168"></a><span id="l2.168">   if (NS_SUCCEEDED(rv))</span>
<a href="#l2.169"></a><span id="l2.169">     rv = cloneFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineminus">-  bool tempFileRightSize = (fileSize == m_totalMsgSize);</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+  bool tempFileRightSize = ((uint64_t)fileSize == m_totalMsgSize);</span>
<a href="#l2.172"></a><span id="l2.172">   NS_WARN_IF_FALSE(tempFileRightSize, &quot;temp file not of expected size in compact&quot;);</span>
<a href="#l2.173"></a><span id="l2.173"> </span>
<a href="#l2.174"></a><span id="l2.174">   bool folderRenameSucceeded = false;</span>
<a href="#l2.175"></a><span id="l2.175">   bool msfRenameSucceeded = false;</span>
<a href="#l2.176"></a><span id="l2.176">   if (NS_SUCCEEDED(rv) &amp;&amp; tempFileRightSize)</span>
<a href="#l2.177"></a><span id="l2.177">   {</span>
<a href="#l2.178"></a><span id="l2.178">     // First we're going to try and move the old summary file out the way.</span>
<a href="#l2.179"></a><span id="l2.179">     // We don't delete it yet, as we want to keep the files in sync.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -83,16 +83,17 @@ protected:</span>
<a href="#l3.4"></a><span id="l3.4">   bool m_parsingFolder; //flag for parsing local folders;</span>
<a href="#l3.5"></a><span id="l3.5">   // these members are used to add missing status lines to compacted messages.</span>
<a href="#l3.6"></a><span id="l3.6">   bool m_needStatusLine;</span>
<a href="#l3.7"></a><span id="l3.7">   bool m_startOfMsg;</span>
<a href="#l3.8"></a><span id="l3.8">   int32_t m_statusOffset;</span>
<a href="#l3.9"></a><span id="l3.9">   uint32_t m_addedHeaderSize;</span>
<a href="#l3.10"></a><span id="l3.10">   nsCOMPtr&lt;nsIArray&gt; m_offlineFolderArray;</span>
<a href="#l3.11"></a><span id="l3.11">   nsCOMPtr&lt;nsIUrlListener&gt; m_listener;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  bool m_alreadyWarnedDiskSpace;</span>
<a href="#l3.13"></a><span id="l3.13"> };</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> class nsOfflineStoreCompactState : public nsFolderCompactState</span>
<a href="#l3.16"></a><span id="l3.16"> {</span>
<a href="#l3.17"></a><span id="l3.17"> public:</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">   nsOfflineStoreCompactState(void);</span>
<a href="#l3.20"></a><span id="l3.20">   virtual ~nsOfflineStoreCompactState(void);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsIMsgDatabase.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsIMsgDatabase.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -238,29 +238,32 @@ interface nsIMsgDBService : nsISupports</span>
<a href="#l4.4"></a><span id="l4.4">    * @param aFolder   The folder to close the cached (open) db for.</span>
<a href="#l4.5"></a><span id="l4.5">    */</span>
<a href="#l4.6"></a><span id="l4.6">   void forceFolderDBClosed(in nsIMsgFolder aFolder);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">   /// an enumerator to iterate over the open dbs.</span>
<a href="#l4.9"></a><span id="l4.9">   readonly attribute nsIArray openDBs;</span>
<a href="#l4.10"></a><span id="l4.10"> };</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-[scriptable, uuid(2dbc9e31-5f8c-408c-960e-a91cecde368c)]</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+[scriptable, uuid(b64e66f8-4717-423a-be42-482658fb2199)]</span>
<a href="#l4.14"></a><span id="l4.14"> interface nsIMsgDatabase : nsIDBChangeAnnouncer {</span>
<a href="#l4.15"></a><span id="l4.15">   void Close(in boolean aForceCommit);</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">   void Commit(in nsMsgDBCommit commitType);</span>
<a href="#l4.18"></a><span id="l4.18">   // Force closed is evil, and we should see if we can do without it.</span>
<a href="#l4.19"></a><span id="l4.19">   // In 4.x, it was mainly used to remove corrupted databases.</span>
<a href="#l4.20"></a><span id="l4.20">   void ForceClosed();</span>
<a href="#l4.21"></a><span id="l4.21">   void clearCachedHdrs();</span>
<a href="#l4.22"></a><span id="l4.22">   void resetHdrCacheSize(in unsigned long size);</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">   readonly attribute nsIDBFolderInfo  dBFolderInfo;</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  /// Size of the database file in bytes.</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+  readonly attribute long long databaseSize;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+</span>
<a href="#l4.29"></a><span id="l4.29">   /// Folder this db was opened on.</span>
<a href="#l4.30"></a><span id="l4.30">   readonly attribute nsIMsgFolder folder;</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">   /**</span>
<a href="#l4.33"></a><span id="l4.33">    * This is used when deciding which db's to close to free up memory</span>
<a href="#l4.34"></a><span id="l4.34">    * and other resources in an LRU manner. It doesn't track every operation</span>
<a href="#l4.35"></a><span id="l4.35">    * on every object from the db, but high level things like open, commit,</span>
<a href="#l4.36"></a><span id="l4.36">    * and perhaps some of the list methods. Commit should be a proxy for all</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -574,16 +574,39 @@ NS_IMETHODIMP nsMsgDatabase::GetLastUseT</span>
<a href="#l5.4"></a><span id="l5.4"> }</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> NS_IMETHODIMP nsMsgDatabase::SetLastUseTime(PRTime aTime)</span>
<a href="#l5.7"></a><span id="l5.7"> {</span>
<a href="#l5.8"></a><span id="l5.8">   gLastUseTime = m_lastUseTime = aTime;</span>
<a href="#l5.9"></a><span id="l5.9">   return NS_OK;</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+NS_IMETHODIMP nsMsgDatabase::GetDatabaseSize(int64_t *_retval)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+{</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+  nsresult rv;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; summaryFilePath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+  rv = summaryFilePath-&gt;InitWithNativePath(m_dbName);</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+  bool exists;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+  rv = summaryFilePath-&gt;Exists(&amp;exists);</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+  if (NS_SUCCEEDED(rv))</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+  {</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+    if (exists)</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+      rv = summaryFilePath-&gt;GetFileSize(_retval);</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+    else</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+      *_retval = 0;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+  }</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  return rv;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+}</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+</span>
<a href="#l5.35"></a><span id="l5.35"> NS_IMETHODIMP nsMsgDatabase::ClearCachedHdrs()</span>
<a href="#l5.36"></a><span id="l5.36"> {</span>
<a href="#l5.37"></a><span id="l5.37">   ClearCachedObjects(false);</span>
<a href="#l5.38"></a><span id="l5.38"> #ifdef DEBUG_bienvenu1</span>
<a href="#l5.39"></a><span id="l5.39">   if (mRefCnt &gt; 1)</span>
<a href="#l5.40"></a><span id="l5.40">   {</span>
<a href="#l5.41"></a><span id="l5.41">     NS_ASSERTION(false, &quot;&quot;);</span>
<a href="#l5.42"></a><span id="l5.42">     printf(&quot;someone's holding onto db - refs = %ld\n&quot;, mRefCnt);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -75,16 +75,17 @@ confirmFolderDeletionForFilter=Deleting </span>
<a href="#l6.4"></a><span id="l6.4"> alertFilterChanged=Filters associated with this folder will be updated.</span>
<a href="#l6.5"></a><span id="l6.5"> filterDisabled=The folder '%S' could not be found, so filter(s) associated with this folder will be disabled. Verify that the folder exists, and that filters point to a valid destination folder.</span>
<a href="#l6.6"></a><span id="l6.6"> filterFolderDeniedLocked=The messages could not be filtered to folder '%S' because another operation is in progress.</span>
<a href="#l6.7"></a><span id="l6.7"> parsingFolderFailed=Unable to open the folder %S because it is in use by some other operation. Please wait for that operation to finish and then select the folder again.</span>
<a href="#l6.8"></a><span id="l6.8"> deletingMsgsFailed=Unable to delete messages in folder %S because it is in use by some other operation. Please wait for that operation to finish and then try again.</span>
<a href="#l6.9"></a><span id="l6.9"> alertFilterCheckbox=Do not warn me again.</span>
<a href="#l6.10"></a><span id="l6.10"> compactFolderDeniedLock=The folder '%S' cannot be compacted because another operation is in progress. Please try again later.</span>
<a href="#l6.11"></a><span id="l6.11"> compactFolderWriteFailed=The folder '%S' could not be compacted because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+compactFolderInsufficientSpace=Some folders (e.g. '%S') cannot be compacted because there is not enough free disk space. Please delete some files and try again.</span>
<a href="#l6.13"></a><span id="l6.13"> filterFolderHdrAddFailed=The messages could not be filtered to folder '%S' because adding a message to it failed. Verify that the folder is displaying properly or try to repair it from the folder properties.</span>
<a href="#l6.14"></a><span id="l6.14"> filterFolderWriteFailed=The messages could not be filtered to folder '%S' because writing to folder failed. Verify that you have enough disk space, and that you have write privileges to the file system, then try again.</span>
<a href="#l6.15"></a><span id="l6.15"> copyMsgWriteFailed=The messages could not be moved or copied to folder '%S' because writing to folder failed. To gain disk space, from the File menu, first choose Empty Trash, and then choose Compact Folders, and then try again.</span>
<a href="#l6.16"></a><span id="l6.16"> cantMoveMsgWOBodyOffline=While working offline, you cannot move or copy messages that were not downloaded for offline use. From the Mail window, open the File menu, choose Offline, then uncheck Work Offline, and then try again.</span>
<a href="#l6.17"></a><span id="l6.17"> operationFailedFolderBusy=The operation failed because another operation is using the folder. Please wait for that operation to finish and then try again.</span>
<a href="#l6.18"></a><span id="l6.18"> folderRenameFailed=The folder could not be renamed. Perhaps the folder is being reparsed, or the new name is not a valid folder name.</span>
<a href="#l6.19"></a><span id="l6.19"> # LOCALIZATION NOTE(verboseFolderFormat): %1$S is folder name, %2$S is server name</span>
<a href="#l6.20"></a><span id="l6.20"> verboseFolderFormat=%1$S on %2$S</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

