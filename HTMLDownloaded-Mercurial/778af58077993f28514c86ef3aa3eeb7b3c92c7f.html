<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29902:778af58077993f28514c86ef3aa3eeb7b3c92c7f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 778af58077993f28514c86ef3aa3eeb7b3c92c7f" />
<meta property="og:url" content="/comm-central/rev/778af58077993f28514c86ef3aa3eeb7b3c92c7f" />
<meta property="og:description" content="Backed out changeset edee35309f49 (bug 1638822) for test failures" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 778af58077993f28514c86ef3aa3eeb7b3c92c7f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/778af58077993f28514c86ef3aa3eeb7b3c92c7f">shortlog</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/778af58077993f28514c86ef3aa3eeb7b3c92c7f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f">files</a> |
changeset |
<a href="/comm-central/raw-rev/778af58077993f28514c86ef3aa3eeb7b3c92c7f">raw</a>  | <a href="/comm-central/archive/778af58077993f28514c86ef3aa3eeb7b3c92c7f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Backed out changeset edee35309f49 (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1638822">bug 1638822</a>) for test failures
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 18 Jun 2020 16:49:22 +0300</td></tr>

<tr>
 <td>changeset 29902</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/778af58077993f28514c86ef3aa3eeb7b3c92c7f">778af58077993f28514c86ef3aa3eeb7b3c92c7f</a></td>
</tr>



<tr>
<td>parent 29901</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/02b477b49fc8f6fc35665548f236e109d1aee77e">02b477b49fc8f6fc35665548f236e109d1aee77e</a>
</td>
</tr>

<tr>
<td>child 29903</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/23275377fdbe5afbb5e5f1786bbcfc08defd0c9a">23275377fdbe5afbb5e5f1786bbcfc08defd0c9a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=778af58077993f28514c86ef3aa3eeb7b3c92c7f">17588</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Thu, 18 Jun 2020 13:51:02 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@778af5807799 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=778af58077993f28514c86ef3aa3eeb7b3c92c7f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=778af58077993f28514c86ef3aa3eeb7b3c92c7f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=778af58077993f28514c86ef3aa3eeb7b3c92c7f&newProject=comm-central&newRevision=02b477b49fc8f6fc35665548f236e109d1aee77e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=778af58077993f28514c86ef3aa3eeb7b3c92c7f&newProject=comm-central&newRevision=02b477b49fc8f6fc35665548f236e109d1aee77e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=778af58077993f28514c86ef3aa3eeb7b3c92c7f&newProject=comm-central&newRevision=02b477b49fc8f6fc35665548f236e109d1aee77e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1638822">1638822</a></td></tr>

<tr><td>backs out</td><td><a style="font-family: monospace" href="/comm-central/rev/edee35309f496e96b7b2708f1f87de89b505b3d9">edee35309f496e96b7b2708f1f87de89b505b3d9</a></td></tr>


</table></div>

<div class="page_body description">Backed out changeset edee35309f49 (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1638822">bug 1638822</a>) for test failures</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/decryption.jsm">mail/extensions/openpgp/content/modules/decryption.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/decryption.jsm">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/decryption.jsm">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/decryption.jsm">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/decryption.jsm">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/decryption.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/encryption.jsm">mail/extensions/openpgp/content/modules/encryption.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/encryption.jsm">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/encryption.jsm">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/encryption.jsm">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/encryption.jsm">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/encryption.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm">mail/extensions/openpgp/content/modules/keyLookupHelper.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyRing.jsm">mail/extensions/openpgp/content/modules/keyRing.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyRing.jsm">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyRing.jsm">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyRing.jsm">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyRing.jsm">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/modules/keyRing.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.ftl">mail/extensions/openpgp/content/strings/enigmail.ftl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.ftl">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.ftl">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.ftl">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.ftl">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.ftl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.properties">mail/extensions/openpgp/content/strings/enigmail.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.properties">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.properties">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.properties">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.properties">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/strings/enigmail.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/commonWorkflows.js">mail/extensions/openpgp/content/ui/commonWorkflows.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/commonWorkflows.js">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/commonWorkflows.js">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/commonWorkflows.js">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/commonWorkflows.js">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/commonWorkflows.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">mail/extensions/openpgp/content/ui/enigmailKeyManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/778af58077993f28514c86ef3aa3eeb7b3c92c7f/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/decryption.jsm</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/decryption.jsm</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -248,17 +248,17 @@ var EnigmailDecryption = {</span>
<a href="#l1.4"></a><span id="l1.4">     var tail = cipherText.substr(</span>
<a href="#l1.5"></a><span id="l1.5">       endIndexObj.value + 1,</span>
<a href="#l1.6"></a><span id="l1.6">       cipherText.length - endIndexObj.value - 1</span>
<a href="#l1.7"></a><span id="l1.7">     );</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">     if (publicKey) {</span>
<a href="#l1.10"></a><span id="l1.10">       // TODO: import key into our scratch area for new, unknown keys</span>
<a href="#l1.11"></a><span id="l1.11">       if (!allowImport) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        errorMsgObj.value = l10n.formatValueSync(&quot;key-in-message-body&quot;);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        errorMsgObj.value = EnigmailLocale.getString(&quot;keyInMessageBody&quot;);</span>
<a href="#l1.14"></a><span id="l1.14">         statusFlagsObj.value |= EnigmailConstants.DISPLAY_MESSAGE;</span>
<a href="#l1.15"></a><span id="l1.15">         statusFlagsObj.value |= EnigmailConstants.INLINE_KEY;</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17">         return &quot;&quot;;</span>
<a href="#l1.18"></a><span id="l1.18">       }</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">       // Import public key</span>
<a href="#l1.21"></a><span id="l1.21">       exitCodeObj.value = EnigmailKeyRing.importKey(</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -283,17 +283,17 @@ var EnigmailDecryption = {</span>
<a href="#l1.23"></a><span id="l1.23">         EnigmailConstants.SIGNATURE_ARMOR</span>
<a href="#l1.24"></a><span id="l1.24">       );</span>
<a href="#l1.25"></a><span id="l1.25">       if (oldSignature &amp;&amp; newSignature != oldSignature) {</span>
<a href="#l1.26"></a><span id="l1.26">         EnigmailLog.ERROR(</span>
<a href="#l1.27"></a><span id="l1.27">           &quot;enigmail.js: Enigmail.decryptMessage: Error - signature mismatch &quot; +</span>
<a href="#l1.28"></a><span id="l1.28">             newSignature +</span>
<a href="#l1.29"></a><span id="l1.29">             &quot;\n&quot;</span>
<a href="#l1.30"></a><span id="l1.30">         );</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-        errorMsgObj.value = l10n.formatValueSync(&quot;sig-mismatch&quot;);</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+        errorMsgObj.value = EnigmailLocale.getString(&quot;sigMismatch&quot;);</span>
<a href="#l1.33"></a><span id="l1.33">         statusFlagsObj.value |= EnigmailConstants.DISPLAY_MESSAGE;</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35">         return &quot;&quot;;</span>
<a href="#l1.36"></a><span id="l1.36">       }</span>
<a href="#l1.37"></a><span id="l1.37">     }</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">     if (!EnigmailCore.getService(parent)) {</span>
<a href="#l1.40"></a><span id="l1.40">       statusFlagsObj.value |= EnigmailConstants.DISPLAY_MESSAGE;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -395,17 +395,19 @@ var EnigmailDecryption = {</span>
<a href="#l1.42"></a><span id="l1.42">     }</span>
<a href="#l1.43"></a><span id="l1.43"> </span>
<a href="#l1.44"></a><span id="l1.44">     var pubKeyId = keyIdObj.value;</span>
<a href="#l1.45"></a><span id="l1.45"> </span>
<a href="#l1.46"></a><span id="l1.46">     if (statusFlagsObj.value &amp; EnigmailConstants.BAD_SIGNATURE) {</span>
<a href="#l1.47"></a><span id="l1.47">       if (verifyOnly &amp;&amp; indentStrObj.value) {</span>
<a href="#l1.48"></a><span id="l1.48">         // Probably replied message that could not be verified</span>
<a href="#l1.49"></a><span id="l1.49">         errorMsgObj.value =</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-          l10n.formatValueSync(&quot;unverified-reply&quot;) + &quot;\n\n&quot; + errorMsgObj.value;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+          EnigmailLocale.getString(&quot;unverifiedReply&quot;) +</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+          &quot;\n\n&quot; +</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+          errorMsgObj.value;</span>
<a href="#l1.54"></a><span id="l1.54">         return &quot;&quot;;</span>
<a href="#l1.55"></a><span id="l1.55">       }</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57">       // Return bad signature (for checking later)</span>
<a href="#l1.58"></a><span id="l1.58">       signatureObj.value = newSignature;</span>
<a href="#l1.59"></a><span id="l1.59">     } else if (</span>
<a href="#l1.60"></a><span id="l1.60">       pubKeyId &amp;&amp;</span>
<a href="#l1.61"></a><span id="l1.61">       statusFlagsObj.value &amp; EnigmailConstants.UNCERTAIN_SIGNATURE</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineat">@@ -449,22 +451,20 @@ var EnigmailDecryption = {</span>
<a href="#l1.63"></a><span id="l1.63">           false,</span>
<a href="#l1.64"></a><span id="l1.64">           pubKeyId,</span>
<a href="#l1.65"></a><span id="l1.65">           importErrorMsgObj</span>
<a href="#l1.66"></a><span id="l1.66">         );</span>
<a href="#l1.67"></a><span id="l1.67"> </span>
<a href="#l1.68"></a><span id="l1.68">         importedKey = exitStatus === 0;</span>
<a href="#l1.69"></a><span id="l1.69"> </span>
<a href="#l1.70"></a><span id="l1.70">         if (exitStatus &gt; 0) {</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-          l10n.formatValue(&quot;cant-import&quot;).then(value =&gt; {</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-            EnigmailDialog.alert(</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-              parent,</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-              value + importErrorMsgObj.value</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-            );</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-          });</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+          EnigmailDialog.alert(</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+            parent,</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+            EnigmailLocale.getString(&quot;cantImport&quot;) + importErrorMsgObj.value</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+          );</span>
<a href="#l1.81"></a><span id="l1.81">         }</span>
<a href="#l1.82"></a><span id="l1.82">       }</span>
<a href="#l1.83"></a><span id="l1.83"> </span>
<a href="#l1.84"></a><span id="l1.84">       if (importedKey) {</span>
<a href="#l1.85"></a><span id="l1.85">         // Recursive call; note that EnigmailConstants.UI_ALLOW_KEY_IMPORT is unset</span>
<a href="#l1.86"></a><span id="l1.86">         // to break the recursion</span>
<a href="#l1.87"></a><span id="l1.87">         var uiFlagsDeep = interactive ? EnigmailConstants.UI_INTERACTIVE : 0;</span>
<a href="#l1.88"></a><span id="l1.88">         signatureObj.value = &quot;&quot;;</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineat">@@ -570,31 +570,31 @@ var EnigmailDecryption = {</span>
<a href="#l1.90"></a><span id="l1.90">         exitCodeObj.keyList = preview;</span>
<a href="#l1.91"></a><span id="l1.91">         let exitStatus = 0;</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93">         if (preview &amp;&amp; errorMsgObj.value === &quot;&quot;) {</span>
<a href="#l1.94"></a><span id="l1.94">           if (preview.length &gt; 0) {</span>
<a href="#l1.95"></a><span id="l1.95">             if (preview.length == 1) {</span>
<a href="#l1.96"></a><span id="l1.96">               exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l1.97"></a><span id="l1.97">                 parent,</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-                l10n.formatValueSync(&quot;do-import-one&quot;, {</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-                  name: preview[0].name,</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-                  id: preview[0].id,</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-                })</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+                EnigmailLocale.getString(&quot;doImportOne&quot;, [</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+                  preview[0].name,</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+                  preview[0].id,</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+                ])</span>
<a href="#l1.106"></a><span id="l1.106">               );</span>
<a href="#l1.107"></a><span id="l1.107">             } else {</span>
<a href="#l1.108"></a><span id="l1.108">               exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l1.109"></a><span id="l1.109">                 parent,</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-                l10n.formatValueSync(&quot;do-import-multiple&quot;, {</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineminus">-                  key: preview</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+                EnigmailLocale.getString(&quot;doImportMultiple&quot;, [</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+                  preview</span>
<a href="#l1.114"></a><span id="l1.114">                     .map(function(a) {</span>
<a href="#l1.115"></a><span id="l1.115">                       return &quot;\t&quot; + a.name + &quot; (&quot; + a.id + &quot;)&quot;;</span>
<a href="#l1.116"></a><span id="l1.116">                     })</span>
<a href="#l1.117"></a><span id="l1.117">                     .join(&quot;\n&quot;),</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineminus">-                })</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+                ])</span>
<a href="#l1.120"></a><span id="l1.120">               );</span>
<a href="#l1.121"></a><span id="l1.121">             }</span>
<a href="#l1.122"></a><span id="l1.122"> </span>
<a href="#l1.123"></a><span id="l1.123">             if (exitStatus) {</span>
<a href="#l1.124"></a><span id="l1.124">               exitCodeObj.value = EnigmailKeyRing.importKey(</span>
<a href="#l1.125"></a><span id="l1.125">                 parent,</span>
<a href="#l1.126"></a><span id="l1.126">                 false,</span>
<a href="#l1.127"></a><span id="l1.127">                 byteData,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/encryption.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/encryption.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -18,16 +18,19 @@ const { EnigmailLog } = ChromeUtils.impo</span>
<a href="#l2.4"></a><span id="l2.4">   &quot;chrome://openpgp/content/modules/log.jsm&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> );</span>
<a href="#l2.6"></a><span id="l2.6"> const { EnigmailPrefs } = ChromeUtils.import(</span>
<a href="#l2.7"></a><span id="l2.7">   &quot;chrome://openpgp/content/modules/prefs.jsm&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> );</span>
<a href="#l2.9"></a><span id="l2.9"> const { EnigmailApp } = ChromeUtils.import(</span>
<a href="#l2.10"></a><span id="l2.10">   &quot;chrome://openpgp/content/modules/app.jsm&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> );</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+const { EnigmailLocale } = ChromeUtils.import(</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  &quot;chrome://openpgp/content/modules/locale.jsm&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+);</span>
<a href="#l2.15"></a><span id="l2.15"> const { EnigmailDialog } = ChromeUtils.import(</span>
<a href="#l2.16"></a><span id="l2.16">   &quot;chrome://openpgp/content/modules/dialog.jsm&quot;</span>
<a href="#l2.17"></a><span id="l2.17"> );</span>
<a href="#l2.18"></a><span id="l2.18"> const { EnigmailGpg } = ChromeUtils.import(</span>
<a href="#l2.19"></a><span id="l2.19">   &quot;chrome://openpgp/content/modules/gpg.jsm&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> );</span>
<a href="#l2.21"></a><span id="l2.21"> const { EnigmailErrorHandling } = ChromeUtils.import(</span>
<a href="#l2.22"></a><span id="l2.22">   &quot;chrome://openpgp/content/modules/errorHandling.jsm&quot;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineat">@@ -42,17 +45,16 @@ const { EnigmailKeyRing } = ChromeUtils.</span>
<a href="#l2.24"></a><span id="l2.24">   &quot;chrome://openpgp/content/modules/keyRing.jsm&quot;</span>
<a href="#l2.25"></a><span id="l2.25"> );</span>
<a href="#l2.26"></a><span id="l2.26"> const { EnigmailConstants } = ChromeUtils.import(</span>
<a href="#l2.27"></a><span id="l2.27">   &quot;chrome://openpgp/content/modules/constants.jsm&quot;</span>
<a href="#l2.28"></a><span id="l2.28"> );</span>
<a href="#l2.29"></a><span id="l2.29"> const { EnigmailCryptoAPI } = ChromeUtils.import(</span>
<a href="#l2.30"></a><span id="l2.30">   &quot;chrome://openpgp/content/modules/cryptoAPI.jsm&quot;</span>
<a href="#l2.31"></a><span id="l2.31"> );</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-const l10n = new Localization([&quot;messenger/openpgp/enigmail.ftl&quot;], true);</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34"> const gMimeHashAlgorithms = [</span>
<a href="#l2.35"></a><span id="l2.35">   null,</span>
<a href="#l2.36"></a><span id="l2.36">   &quot;sha1&quot;,</span>
<a href="#l2.37"></a><span id="l2.37">   &quot;ripemd160&quot;,</span>
<a href="#l2.38"></a><span id="l2.38">   &quot;sha256&quot;,</span>
<a href="#l2.39"></a><span id="l2.39">   &quot;sha384&quot;,</span>
<a href="#l2.40"></a><span id="l2.40">   &quot;sha512&quot;,</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineat">@@ -82,17 +84,17 @@ var EnigmailEncryption = {</span>
<a href="#l2.42"></a><span id="l2.42">       &quot;encryption.jsm: getEncryptCommand: hashAlgorithm=&quot; + hashAlgorithm + &quot;\n&quot;</span>
<a href="#l2.43"></a><span id="l2.43">     );</span>
<a href="#l2.44"></a><span id="l2.44"> </span>
<a href="#l2.45"></a><span id="l2.45">     try {</span>
<a href="#l2.46"></a><span id="l2.46">       fromMailAddr = EnigmailFuncs.stripEmail(fromMailAddr);</span>
<a href="#l2.47"></a><span id="l2.47">       toMailAddr = EnigmailFuncs.stripEmail(toMailAddr);</span>
<a href="#l2.48"></a><span id="l2.48">       bccMailAddr = EnigmailFuncs.stripEmail(bccMailAddr);</span>
<a href="#l2.49"></a><span id="l2.49">     } catch (ex) {</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-      errorMsgObj.value = l10n.formatValueSync(&quot;invalid-email&quot;);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+      errorMsgObj.value = EnigmailLocale.getString(&quot;invalidEmail&quot;);</span>
<a href="#l2.52"></a><span id="l2.52">       return null;</span>
<a href="#l2.53"></a><span id="l2.53">     }</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55">     var signMsg = sendFlags &amp; EnigmailConstants.SEND_SIGNED;</span>
<a href="#l2.56"></a><span id="l2.56">     var encryptMsg = sendFlags &amp; EnigmailConstants.SEND_ENCRYPTED;</span>
<a href="#l2.57"></a><span id="l2.57">     var usePgpMime = sendFlags &amp; EnigmailConstants.SEND_PGP_MIME;</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59">     var useDefaultComment = false;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineat">@@ -246,17 +248,17 @@ var EnigmailEncryption = {</span>
<a href="#l2.61"></a><span id="l2.61">       logFileObj</span>
<a href="#l2.62"></a><span id="l2.62">     );</span>
<a href="#l2.63"></a><span id="l2.63"> </span>
<a href="#l2.64"></a><span id="l2.64">     try {</span>
<a href="#l2.65"></a><span id="l2.65">       fromMailAddr = EnigmailFuncs.stripEmail(fromMailAddr);</span>
<a href="#l2.66"></a><span id="l2.66">       toMailAddr = EnigmailFuncs.stripEmail(toMailAddr);</span>
<a href="#l2.67"></a><span id="l2.67">       bccMailAddr = EnigmailFuncs.stripEmail(bccMailAddr);</span>
<a href="#l2.68"></a><span id="l2.68">     } catch (ex) {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-      errorMsgObj.value = l10n.formatValueSync(&quot;invalid-email&quot;);</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+      errorMsgObj.value = EnigmailLocale.getString(&quot;invalidEmail&quot;);</span>
<a href="#l2.71"></a><span id="l2.71">       return null;</span>
<a href="#l2.72"></a><span id="l2.72">     }</span>
<a href="#l2.73"></a><span id="l2.73"> </span>
<a href="#l2.74"></a><span id="l2.74">     var signMsg = sendFlags &amp; EnigmailConstants.SEND_SIGNED;</span>
<a href="#l2.75"></a><span id="l2.75">     var encryptMsg = sendFlags &amp; EnigmailConstants.SEND_ENCRYPTED;</span>
<a href="#l2.76"></a><span id="l2.76">     var usePgpMime = sendFlags &amp; EnigmailConstants.SEND_PGP_MIME;</span>
<a href="#l2.77"></a><span id="l2.77"> </span>
<a href="#l2.78"></a><span id="l2.78">     var detachedSig =</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineat">@@ -370,19 +372,20 @@ var EnigmailEncryption = {</span>
<a href="#l2.80"></a><span id="l2.80">       let key = EnigmailKeyRing.getKeyById(fromMailAddr);</span>
<a href="#l2.81"></a><span id="l2.81">       keyList.push(key);</span>
<a href="#l2.82"></a><span id="l2.82">     } else {</span>
<a href="#l2.83"></a><span id="l2.83">       // email address specified</span>
<a href="#l2.84"></a><span id="l2.84">       keyList = EnigmailKeyRing.getKeysByUserId(fromMailAddr);</span>
<a href="#l2.85"></a><span id="l2.85">     }</span>
<a href="#l2.86"></a><span id="l2.86"> </span>
<a href="#l2.87"></a><span id="l2.87">     if (keyList.length === 0) {</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-      ret.errorMsg = l10n.formatValueSync(&quot;error-own-key-unusable&quot;, {</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-        addr: fromMailAddr,</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-      });</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+      ret.errorMsg = EnigmailLocale.getString(</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+        &quot;errorOwnKeyUnusable&quot;,</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+        fromMailAddr</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+      );</span>
<a href="#l2.95"></a><span id="l2.95">       return ret;</span>
<a href="#l2.96"></a><span id="l2.96">     }</span>
<a href="#l2.97"></a><span id="l2.97"> </span>
<a href="#l2.98"></a><span id="l2.98">     if (sign) {</span>
<a href="#l2.99"></a><span id="l2.99">       keyList = keyList.reduce(function(p, keyObj) {</span>
<a href="#l2.100"></a><span id="l2.100">         if (keyObj &amp;&amp; keyObj.getSigningValidity().keyValid) {</span>
<a href="#l2.101"></a><span id="l2.101">           p.push(keyObj);</span>
<a href="#l2.102"></a><span id="l2.102">         }</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineat">@@ -465,17 +468,17 @@ var EnigmailEncryption = {</span>
<a href="#l2.104"></a><span id="l2.104">     }</span>
<a href="#l2.105"></a><span id="l2.105"> </span>
<a href="#l2.106"></a><span id="l2.106">     errorMsgObj.value = &quot;&quot;;</span>
<a href="#l2.107"></a><span id="l2.107"> </span>
<a href="#l2.108"></a><span id="l2.108">     if (!sendFlags) {</span>
<a href="#l2.109"></a><span id="l2.109">       EnigmailLog.DEBUG(</span>
<a href="#l2.110"></a><span id="l2.110">         &quot;encryption.jsm: encryptMessageStart: NO ENCRYPTION!\n&quot;</span>
<a href="#l2.111"></a><span id="l2.111">       );</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-      errorMsgObj.value = l10n.formatValueSync(&quot;not-required&quot;);</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+      errorMsgObj.value = EnigmailLocale.getString(&quot;notRequired&quot;);</span>
<a href="#l2.114"></a><span id="l2.114">       return null;</span>
<a href="#l2.115"></a><span id="l2.115">     }</span>
<a href="#l2.116"></a><span id="l2.116"> </span>
<a href="#l2.117"></a><span id="l2.117">     if (!EnigmailCore.getService(win)) {</span>
<a href="#l2.118"></a><span id="l2.118">       throw new Error(</span>
<a href="#l2.119"></a><span id="l2.119">         &quot;encryption.jsm: encryptMessageStart: not yet initialized&quot;</span>
<a href="#l2.120"></a><span id="l2.120">       );</span>
<a href="#l2.121"></a><span id="l2.121">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/keyLookupHelper.jsm</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -18,16 +18,19 @@ var EnigmailKeyRing = ChromeUtils.import</span>
<a href="#l3.4"></a><span id="l3.4">   &quot;chrome://openpgp/content/modules/keyRing.jsm&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> ).EnigmailKeyRing;</span>
<a href="#l3.6"></a><span id="l3.6"> var EnigmailKeyServer = ChromeUtils.import(</span>
<a href="#l3.7"></a><span id="l3.7">   &quot;chrome://openpgp/content/modules/keyserver.jsm&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> ).EnigmailKeyServer;</span>
<a href="#l3.9"></a><span id="l3.9"> var { EnigmailKeyserverURIs } = ChromeUtils.import(</span>
<a href="#l3.10"></a><span id="l3.10">   &quot;chrome://openpgp/content/modules/keyserverUris.jsm&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> );</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+var EnigmailLocale = ChromeUtils.import(</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  &quot;chrome://openpgp/content/modules/locale.jsm&quot;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+).EnigmailLocale;</span>
<a href="#l3.15"></a><span id="l3.15"> var EnigmailWkdLookup = ChromeUtils.import(</span>
<a href="#l3.16"></a><span id="l3.16">   &quot;chrome://openpgp/content/modules/wkdLookup.jsm&quot;</span>
<a href="#l3.17"></a><span id="l3.17"> ).EnigmailWkdLookup;</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> const l10n = new Localization([&quot;messenger/openpgp/enigmail.ftl&quot;], true);</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21"> var KeyLookupHelper = {</span>
<a href="#l3.22"></a><span id="l3.22">   async lookupAndImportOnKeyserver(</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineat">@@ -54,17 +57,17 @@ var KeyLookupHelper = {</span>
<a href="#l3.24"></a><span id="l3.24">       if (keyList) {</span>
<a href="#l3.25"></a><span id="l3.25">         somethingWasImported = EnigmailKeyRing.importKeyDataWithConfirmation(</span>
<a href="#l3.26"></a><span id="l3.26">           window,</span>
<a href="#l3.27"></a><span id="l3.27">           keyList,</span>
<a href="#l3.28"></a><span id="l3.28">           vks.keyData,</span>
<a href="#l3.29"></a><span id="l3.29">           true</span>
<a href="#l3.30"></a><span id="l3.30">         );</span>
<a href="#l3.31"></a><span id="l3.31">       } else {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-        EnigmailDialog.alert(window, await l10n.formatValue(&quot;preview-failed&quot;));</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+        EnigmailDialog.alert(window, EnigmailLocale.getString(&quot;previewFailed&quot;));</span>
<a href="#l3.34"></a><span id="l3.34">       }</span>
<a href="#l3.35"></a><span id="l3.35">     } else {</span>
<a href="#l3.36"></a><span id="l3.36">       console.debug(&quot;searchKeysOnInternet no data in keys.openpgp.org&quot;);</span>
<a href="#l3.37"></a><span id="l3.37">     }</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39">     return somethingWasImported;</span>
<a href="#l3.40"></a><span id="l3.40">   },</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42" class="difflineat">@@ -86,17 +89,17 @@ var KeyLookupHelper = {</span>
<a href="#l3.43"></a><span id="l3.43">       let keyList = EnigmailKey.getKeyListFromKeyBlock(</span>
<a href="#l3.44"></a><span id="l3.44">         wkdKeys.keyData,</span>
<a href="#l3.45"></a><span id="l3.45">         {},</span>
<a href="#l3.46"></a><span id="l3.46">         false,</span>
<a href="#l3.47"></a><span id="l3.47">         true,</span>
<a href="#l3.48"></a><span id="l3.48">         false</span>
<a href="#l3.49"></a><span id="l3.49">       );</span>
<a href="#l3.50"></a><span id="l3.50">       if (!keyList) {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-        EnigmailDialog.alert(window, await l10n.formatValue(&quot;preview-failed&quot;));</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+        EnigmailDialog.alert(window, EnigmailLocale.getString(&quot;previewFailed&quot;));</span>
<a href="#l3.53"></a><span id="l3.53">       } else {</span>
<a href="#l3.54"></a><span id="l3.54">         somethingWasImported = EnigmailKeyRing.importKeyDataWithConfirmation(</span>
<a href="#l3.55"></a><span id="l3.55">           window,</span>
<a href="#l3.56"></a><span id="l3.56">           keyList,</span>
<a href="#l3.57"></a><span id="l3.57">           wkdKeys.keyData,</span>
<a href="#l3.58"></a><span id="l3.58">           true</span>
<a href="#l3.59"></a><span id="l3.59">         );</span>
<a href="#l3.60"></a><span id="l3.60">         if (somethingWasImported &amp;&amp; whenDoneCB) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/keyRing.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/keyRing.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -613,17 +613,17 @@ var EnigmailKeyRing = {</span>
<a href="#l4.4"></a><span id="l4.4">         keyBlock,</span>
<a href="#l4.5"></a><span id="l4.5">         0,</span>
<a href="#l4.6"></a><span id="l4.6">         &quot;&quot;,</span>
<a href="#l4.7"></a><span id="l4.7">         beginIndexObj,</span>
<a href="#l4.8"></a><span id="l4.8">         endIndexObj,</span>
<a href="#l4.9"></a><span id="l4.9">         {}</span>
<a href="#l4.10"></a><span id="l4.10">       );</span>
<a href="#l4.11"></a><span id="l4.11">       if (!blockType) {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-        errorMsgObj.value = l10n.formatValueSync(&quot;no-pgp-block&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+        errorMsgObj.value = EnigmailLocale.getString(&quot;noPGPblock&quot;);</span>
<a href="#l4.14"></a><span id="l4.14">         return 1;</span>
<a href="#l4.15"></a><span id="l4.15">       }</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">       if (blockType.search(/^(PUBLIC|PRIVATE) KEY BLOCK$/) !== 0) {</span>
<a href="#l4.18"></a><span id="l4.18">         errorMsgObj.value = l10n.formatValueSync(&quot;not-first-block&quot;);</span>
<a href="#l4.19"></a><span id="l4.19">         return 1;</span>
<a href="#l4.20"></a><span id="l4.20">       }</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -696,31 +696,31 @@ var EnigmailKeyRing = {</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">   importKeyDataWithConfirmation(window, preview, keyData, isBinary) {</span>
<a href="#l4.25"></a><span id="l4.25">     let somethingWasImported = false;</span>
<a href="#l4.26"></a><span id="l4.26">     if (preview.length &gt; 0) {</span>
<a href="#l4.27"></a><span id="l4.27">       let exitStatus;</span>
<a href="#l4.28"></a><span id="l4.28">       if (preview.length == 1) {</span>
<a href="#l4.29"></a><span id="l4.29">         exitStatus = getDialog().confirmDlg(</span>
<a href="#l4.30"></a><span id="l4.30">           window,</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-          l10n.formatValueSync(&quot;do-import-one&quot;, {</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-            name: preview[0].name,</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-            id: preview[0].id,</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-          })</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+          EnigmailLocale.getString(&quot;doImportOne&quot;, [</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+            preview[0].name,</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+            preview[0].id,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+          ])</span>
<a href="#l4.39"></a><span id="l4.39">         );</span>
<a href="#l4.40"></a><span id="l4.40">       } else {</span>
<a href="#l4.41"></a><span id="l4.41">         exitStatus = getDialog().confirmDlg(</span>
<a href="#l4.42"></a><span id="l4.42">           window,</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-          l10n.formatValueSync(&quot;do-import-multiple&quot;, {</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-            key: preview</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+          EnigmailLocale.getString(&quot;doImportMultiple&quot;, [</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+            preview</span>
<a href="#l4.47"></a><span id="l4.47">               .map(function(a) {</span>
<a href="#l4.48"></a><span id="l4.48">                 return &quot;\t&quot; + a.name + &quot; (&quot; + a.id + &quot;)&quot;;</span>
<a href="#l4.49"></a><span id="l4.49">               })</span>
<a href="#l4.50"></a><span id="l4.50">               .join(&quot;\n&quot;),</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-          })</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+          ])</span>
<a href="#l4.53"></a><span id="l4.53">         );</span>
<a href="#l4.54"></a><span id="l4.54">       }</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56">       if (exitStatus) {</span>
<a href="#l4.57"></a><span id="l4.57">         let errorMsgObj = {};</span>
<a href="#l4.58"></a><span id="l4.58">         try {</span>
<a href="#l4.59"></a><span id="l4.59">           exitStatus = EnigmailKeyRing.importKey(</span>
<a href="#l4.60"></a><span id="l4.60">             window,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/extensions/openpgp/content/strings/enigmail.ftl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/strings/enigmail.ftl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -282,17 +282,16 @@ no-key-selected = You should select at l</span>
<a href="#l5.4"></a><span id="l5.4"> export-to-file = Export Public Key To File</span>
<a href="#l5.5"></a><span id="l5.5"> export-keypair-to-file = Export Secret and Public Key To File</span>
<a href="#l5.6"></a><span id="l5.6"> export-secret-key = Do you want to include the secret key in the saved OpenPGP key file?</span>
<a href="#l5.7"></a><span id="l5.7"> save-keys-ok = The keys were successfully saved</span>
<a href="#l5.8"></a><span id="l5.8"> save-keys-failed = Saving the keys failed</span>
<a href="#l5.9"></a><span id="l5.9"> default-pub-key-filename = Exported-public-keys</span>
<a href="#l5.10"></a><span id="l5.10"> default-pub-sec-key-filename = Exported-public-and-secret-keys</span>
<a href="#l5.11"></a><span id="l5.11"> refresh-key-warn = Warning: depending on the number of keys and the connection speed, refreshing all keys could be quite a lengthy process!</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-preview-failed = Can't read public key file.</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> # Strings in keyObj.jsm</span>
<a href="#l5.15"></a><span id="l5.15"> key-ring-pub-key-revoked = The key { $userId } (key ID { $keyId }) is revoked.</span>
<a href="#l5.16"></a><span id="l5.16"> key-ring-pub-key-expired = The key { $userId } (key ID { $keyId }) has expired.</span>
<a href="#l5.17"></a><span id="l5.17"> key-ring-key-disabled = The key { $userId } (key ID { $keyId }) is disabled; it cannot be used.</span>
<a href="#l5.18"></a><span id="l5.18"> key-ring-key-invalid = The key { $userId } (key ID { $keyId }) is not valid. Please consider verifying it correctly.</span>
<a href="#l5.19"></a><span id="l5.19"> key-ring-key-not-trusted=The key { $userId } (key ID { $keyId }) is not trusted enough. Please set the trust level of your key to &quot;ultimate&quot; to use it for signing.</span>
<a href="#l5.20"></a><span id="l5.20"> key-ring-no-secret-key = You do not seem to have the secret key for { $userId } (key ID { $keyId }) on your keyring; you cannot use the key for signing.</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -332,17 +331,16 @@ no-key-found = We could not find any key</span>
<a href="#l5.22"></a><span id="l5.22"> fail-key-extract = Error - key extraction command failed</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24"> # Strings used in keyRing.jsm</span>
<a href="#l5.25"></a><span id="l5.25"> fail-cancel = Error - Key receive cancelled by user</span>
<a href="#l5.26"></a><span id="l5.26"> not-first-block = Error - First OpenPGP block not public key block</span>
<a href="#l5.27"></a><span id="l5.27"> import-key-confirm = Import public key(s) embedded in message?</span>
<a href="#l5.28"></a><span id="l5.28"> fail-key-import = Error - key importing failed</span>
<a href="#l5.29"></a><span id="l5.29"> file-write-failed = Failed to write to file { $output }</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-no-pgp-block = Error - No valid armored OpenPGP data block found</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32"> # Strings used in trust.jsm</span>
<a href="#l5.33"></a><span id="l5.33"> key-valid-unknown = unknown</span>
<a href="#l5.34"></a><span id="l5.34"> key-valid-invalid = invalid</span>
<a href="#l5.35"></a><span id="l5.35"> key-valid-disabled = disabled</span>
<a href="#l5.36"></a><span id="l5.36"> key-valid-revoked = revoked</span>
<a href="#l5.37"></a><span id="l5.37"> key-valid-expired = expired</span>
<a href="#l5.38"></a><span id="l5.38"> key-trust-untrusted = untrusted</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineat">@@ -350,55 +348,13 @@ key-trust-marginal = marginal</span>
<a href="#l5.40"></a><span id="l5.40"> key-trust-full = trusted</span>
<a href="#l5.41"></a><span id="l5.41"> key-trust-ultimate = ultimate</span>
<a href="#l5.42"></a><span id="l5.42"> key-trust-group = (group)</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44"> # Strings used in commonWorkflows.js</span>
<a href="#l5.45"></a><span id="l5.45"> import-key-file = Import OpenPGP Key File</span>
<a href="#l5.46"></a><span id="l5.46"> gnupg-file = GnuPG Files</span>
<a href="#l5.47"></a><span id="l5.47"> import-keys-failed=Importing the keys failed</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-passphrase-prompt = Please enter the passphrase that unlocks the following key: { $key }</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50"> # Strings used in enigmailKeygen.js</span>
<a href="#l5.51"></a><span id="l5.51"> save-revoke-cert-as = Create &amp; Save Revocation Certificate</span>
<a href="#l5.52"></a><span id="l5.52"> revoke-cert-ok = The revocation certificate has been successfully created. You can use it to invalidate your public key, e.g. in case you would lose your secret key.</span>
<a href="#l5.53"></a><span id="l5.53"> revoke-cert-failed = The revocation certificate could not be created.</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-# Strings used in enigmailMessengerOverlay.js</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-failed-decrypt = Error - decryption failed</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-# Strings used in enigmailMsgComposeOverlay.js</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-msg-compose-button-send = &amp;Send Message</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-msg-compose-details-button-label = Details</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-msg-compose-details-button-access-key = D</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-send-aborted = Send operation aborted.\n\n</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-key-not-trusted = Not enough trust for key '{ $key }'</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-key-not-found = Key '{ $key }' not found</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-key-revoked = Key '{ $key }' revoked</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-key-expired = Key '{ $key }' expired</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-msg-compose-internal-error = An internal error has occurred.</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-keys-to-export = Select OpenPGP Keys to Insert</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-msg-compose-partially-encrypted-inlinePGP = The message you are replying to contained both unencrypted and encrypted parts. If the sender was not able to decrypt some message parts originally, you may be leaking confidential information that the sender was not able to originally decrypt themselves.\n\nPlease consider removing all quoted text from your reply to this sender.</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-msg-compose-cannot-save-draft = Error while saving draft</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-msg-compose-partially-encrypted-short = Beware of leaking sensitive information - partially encrypted email.</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-quoted-printable-warn = You have enabled 'quoted-printable' encoding for sending messages. This may result in incorrect decryption and/or verification of your message.\nDo you wish to turn off sending 'quoted-printable' messages now?</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-minimal-line-wrapping = You have set line wrapping to { $width } characters. For correct encryption and/or signing, this value needs to be at least 68.\nDo you wish to change line wrapping to 68 characters now?</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-sending-hidden-rcpt = This message has BCC (blind copy) recipients. If this message is encrypted, it is possible to hide the BCC recipients but users of some products (e.g. PGP Corp.) will not be able to decrypt the message. Given this, we recommend to avoid BCC-emails with encrypted messages.</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-send-with-hidden-bcc = Hide BCC recipients</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-send-with-shown-bcc = Encrypt normally</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-sending-news = Encrypted send operation aborted.\n\nThis message cannot be encrypted because there are newsgroup recipients. Please re-send the message without encryption.</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-send-to-news-warning = Warning: you are about to send an encrypted email to a newsgroup.\n\nThis is discouraged because it only makes sense if all members of the group can decrypt the message, i.e. the message needs to be encrypted with the keys of all group participants. Please send this message only if you know exactly what you are doing.\n\nContinue?</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-# Strings used in decryption.jsm</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-do-import-multiple = Import the following keys?\n\n{ $key }</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-do-import-one = Import { $name } ({ $id })?</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-cant-import = Error importing public key\n\n</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-unverified-reply = Indented message part (reply) was probably modified</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-key-in-message-body = A key was found in the message body. Click 'Import Key' to import the key</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-sig-mismatch = Error - Signature mismatch</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-invalid-email = Error - invalid email address(es)</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-# Strings used in enigmailMsgHdrViewOverlay.js</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-decrypted-msg-with-format-error = Decrypted message (restored broken PGP email format probably caused by an old Exchange server, so that the result might not be perfect to read)</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-# Strings used in encryption.jsm</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-error-own-key-unusable = The key ID '{ $addr }' configured for the current identity does not yield a usable OpenPGP key.\n\nPlease ensure that you have a valid, not expired OpenPGP key and that your account settings point to that key.\nIf your key is not expired, then check if you did set Owner trust to &quot;full&quot; or &quot;ultimate&quot;.</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-not-required = Error - no encryption required</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/extensions/openpgp/content/strings/enigmail.properties</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/strings/enigmail.properties</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -89,45 +89,69 @@ noteCutMessage2=*Multiple message blocks</span>
<a href="#l6.4"></a><span id="l6.4"> decryptOkNoSig=Warning\n\nDecryption was successful, but the signature could not be verified correctly</span>
<a href="#l6.5"></a><span id="l6.5"> msgOvl.button.contAnyway=&amp;Continue Anyway</span>
<a href="#l6.6"></a><span id="l6.6"> signature.verifiedOK=The signature for attachment %S was successfully verified</span>
<a href="#l6.7"></a><span id="l6.7"> signature.verifyFailed=The signature for attachment %S could not be verified</span>
<a href="#l6.8"></a><span id="l6.8"> attachment.noMatchToSignature=Could not match attachment '%S' to a signature file</span>
<a href="#l6.9"></a><span id="l6.9"> attachment.noMatchFromSignature=Could not match signature file '%S' to an attachment</span>
<a href="#l6.10"></a><span id="l6.10"> fixBrokenExchangeMsg.failed=Did not succeed to repair message.</span>
<a href="#l6.11"></a><span id="l6.11"> ### detailsDlg.importKey=Import key</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-### wksNoIdentity=This key is not linked to any of your email accounts. Please add an account for at least one of the following email addresse(s):\n\n%S</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-### wksConfirmSuccess=Confirmation email sent.</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-### wksConfirmFailure=Sending the confirmation email failed.</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+wksNoIdentity=This key is not linked to any of your email accounts. Please add an account for at least one of the following email addresse(s):\n\n%S</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+wksConfirmSuccess=Confirmation email sent.</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+wksConfirmFailure=Sending the confirmation email failed.</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19"> #####################################################################</span>
<a href="#l6.20"></a><span id="l6.20"> # Strings in enigmailMsgComposeOverlay.js</span>
<a href="#l6.21"></a><span id="l6.21"> #####################################################################</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+keysToExport=Select OpenPGP Keys to Insert</span>
<a href="#l6.24"></a><span id="l6.24"> ### keysToUse=Select OpenPGP Key(s) to use for %S</span>
<a href="#l6.25"></a><span id="l6.25"> ### pubKey=Public key for %S\n</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27"> ### windowLocked=Compose window is locked; send cancelled</span>
<a href="#l6.28"></a><span id="l6.28"> ### composeSpecifyEmail=Please specify your primary email address, which will be used to choose the signing key for outgoing messages.\n If you leave it blank, the FROM address of the message will be used to choose the signing key.</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+sendingHiddenRcpt=This message has BCC (blind copy) recipients. If this message is encrypted, it is possible to hide the BCC recipients but users of some products (e.g. PGP Corp.) will not be able to decrypt the message. Given this, we recommend to avoid BCC-emails with encrypted messages.</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+sendWithHiddenBcc=Hide BCC recipients</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+sendWithShownBcc=Encrypt normally</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+sendingNews=Encrypted send operation aborted.\n\nThis message cannot be encrypted because there are newsgroup recipients. Please re-send the message without encryption.</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+sendToNewsWarning=Warning: you are about to send an encrypted email to a newsgroup.\n\nThis is discouraged because it only makes sense if all members of the group can decrypt the message, i.e. the message needs to be encrypted with the keys of all group participants. Please send this message only if you know exactly what you are doing.\n\nContinue?</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+hasHTML=HTML email warning:\nThis message may contain HTML, which could cause signing/encryption to fail. To avoid this in the future, you should press the SHIFT key when clicking on the Compose/Reply button to send signed email.\nIf you sign email by default, you should uncheck the 'Compose Messages in HTML' preference box to permanently disable HTML email for this email account.</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+strippingHTML=Message contains HTML formatting information that will be lost when converting to plain text for signing/encryption. Do you wish to proceed?</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+msgCompose.button.sendAnyway=&amp;Send Message Anyway</span>
<a href="#l6.37"></a><span id="l6.37"> ### attachWarning=Attachments to this message are not local, they cannot be encrypted. In order to encrypt the attachments, store them as local files first and attach these files. Do you wish to send the message anyway?</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+quotedPrintableWarn=You have enabled 'quoted-printable' encoding for sending messages. This may result in incorrect decryption and/or verification of your message.\nDo you wish to turn off sending 'quoted-printable' messages now?</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+minimalLineWrapping=You have set line wrapping to %S characters. For correct encryption and/or signing, this value needs to be at least 68.\nDo you wish to change line wrapping to 68 characters now?</span>
<a href="#l6.40"></a><span id="l6.40"> ### warning=Warning</span>
<a href="#l6.41"></a><span id="l6.41"> ### signIconClicked=You have manually modified signing. Therefore, while you are composing this message, (de)activating signing does not depend anymore on (de)activating encryption.</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+errorOwnKeyUnusable=The key ID '%S' configured for the current identity does not yield a usable OpenPGP key.\n\nPlease ensure that you have a valid, not expired OpenPGP key and that your account settings point to that key.\nIf your key is not expired, then check if you did set Owner trust to &quot;full&quot; or &quot;ultimate&quot;.</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+msgCompose.cannotSaveDraft=Error while saving draft</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+msgCompose.partiallyEncrypted.short=Beware of leaking sensitive information - partially encrypted email.</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+msgCompose.partiallyEncrypted.inlinePGP=The message you are replying to contained both unencrypted and encrypted parts. If the sender was not able to decrypt some message parts originally, you may be leaking confidential information that the sender was not able to originally decrypt themselves.\n\nPlease consider removing all quoted text from your reply to this sender.</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47"> ### msgCompose.internalEncryptionError=Internal Error: promised encryption disabled</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+msgCompose.internalError=An internal error has occurred.</span>
<a href="#l6.49"></a><span id="l6.49"> </span>
<a href="#l6.50"></a><span id="l6.50"> ### msgCompose.protectSubject.tooltip=Protect the message subject</span>
<a href="#l6.51"></a><span id="l6.51"> ### msgCompose.noSubjectProtection.tooltip=Do not protect the message subject</span>
<a href="#l6.52"></a><span id="l6.52"> ### msgCompose.protectSubject.dialogTitle=Enable Protection of Subject?</span>
<a href="#l6.53"></a><span id="l6.53"> ### msgCompose.protectSubject.question=Regular encrypted emails contain the unredacted subject.\n\nWe have established a standard to hide the original subject in the encrypted message\nand replace it with a dummy text, such that the subject is only visible after the email is decrypted.\n\nDo you want to protect the subject in encrypted messages?</span>
<a href="#l6.54"></a><span id="l6.54"> ### msgCompose.protectSubject.yesButton=&amp;Protect subject</span>
<a href="#l6.55"></a><span id="l6.55"> ### msgCompose.protectSubject.noButton=&amp;Leave subject unprotected</span>
<a href="#l6.56"></a><span id="l6.56"> </span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+msgCompose.detailsButton.label=Details ...</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+msgCompose.detailsButton.accessKey=D</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+</span>
<a href="#l6.60"></a><span id="l6.60"> # note: should end with double newline:</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+sendAborted=Send operation aborted.\n\n</span>
<a href="#l6.62"></a><span id="l6.62"> </span>
<a href="#l6.63"></a><span id="l6.63"> # details:</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+keyNotTrusted=Not enough trust for key '%S'</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+keyNotFound=Key '%S' not found</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+keyRevoked=Key '%S' revoked</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+keyExpired=Key '%S' expired</span>
<a href="#l6.68"></a><span id="l6.68"> </span>
<a href="#l6.69"></a><span id="l6.69"> ### statPGPMIME=PGP/MIME</span>
<a href="#l6.70"></a><span id="l6.70"> ### statSMIME=S/MIME</span>
<a href="#l6.71"></a><span id="l6.71"> ### statSigned=SIGNED</span>
<a href="#l6.72"></a><span id="l6.72"> ### statEncrypted=ENCRYPTED</span>
<a href="#l6.73"></a><span id="l6.73"> ### statPlain=UNSIGNED and UNENCRYPTED</span>
<a href="#l6.74"></a><span id="l6.74"> </span>
<a href="#l6.75"></a><span id="l6.75"> ### offlineSave=Save %1$S message to %2$S in Unsent Messages folder?</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineat">@@ -157,100 +181,116 @@ fixBrokenExchangeMsg.failed=Did not succ</span>
<a href="#l6.77"></a><span id="l6.77"> ### reasonManuallyForced=manually forced</span>
<a href="#l6.78"></a><span id="l6.78"> ### reasonByRecipientRules=forced by per-recipient rules</span>
<a href="#l6.79"></a><span id="l6.79"> ### reasonByAutoEncryption=forced by auto encryption</span>
<a href="#l6.80"></a><span id="l6.80"> ### reasonByConflict=due to conflict in per-recipient rules</span>
<a href="#l6.81"></a><span id="l6.81"> ### reasonByEncryptionMode=due to encryption mode</span>
<a href="#l6.82"></a><span id="l6.82"> </span>
<a href="#l6.83"></a><span id="l6.83"> # should not be used anymore:</span>
<a href="#l6.84"></a><span id="l6.84"> ### encryptYes=Message will be encrypted</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+encryptNo=Message will not be encrypted</span>
<a href="#l6.86"></a><span id="l6.86"> </span>
<a href="#l6.87"></a><span id="l6.87"> # should not be used anymore:</span>
<a href="#l6.88"></a><span id="l6.88"> ### signYes=Message will be signed</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+signNo=Message will not be signed</span>
<a href="#l6.90"></a><span id="l6.90"> </span>
<a href="#l6.91"></a><span id="l6.91"> </span>
<a href="#l6.92"></a><span id="l6.92"> # PGP/MIME status:</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-### pgpmimeNormal=Protocol: PGP/MIME</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-### inlinePGPNormal=Protocol: Inline PGP</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-### smimeNormal=Protocol: S/MIME</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+pgpmimeNormal=Protocol: PGP/MIME</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+inlinePGPNormal=Protocol: Inline PGP</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+smimeNormal=Protocol: S/MIME</span>
<a href="#l6.99"></a><span id="l6.99"> ### pgpmimeAuto=Protocol: PGP/MIME (auto)</span>
<a href="#l6.100"></a><span id="l6.100"> ### inlinePGPAuto=Protocol: Inline PGP (auto)</span>
<a href="#l6.101"></a><span id="l6.101"> ### smimeAuto=Protocol: S/MIME (auto)</span>
<a href="#l6.102"></a><span id="l6.102"> </span>
<a href="#l6.103"></a><span id="l6.103"> # should not be used anymore</span>
<a href="#l6.104"></a><span id="l6.104"> ### pgpmimeYes=PGP/MIME will be used</span>
<a href="#l6.105"></a><span id="l6.105"> ### pgpmimeNo=Inline PGP will be used</span>
<a href="#l6.106"></a><span id="l6.106"> </span>
<a href="#l6.107"></a><span id="l6.107"> # Attach own key status (tooltip strings):</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-### attachOwnKeyYes=Your own public key will be attached</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-### attachOwnKeyDisabled=Your own public key cannot be attached. You have to select a specific key\nin the OpenPGP section of the Account Settings to enable this feature.</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+attachOwnKeyNo=Your own public key will not be attached</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+attachOwnKeyYes=Your own public key will be attached</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+attachOwnKeyDisabled=Your own public key cannot be attached. You have to select a specific key\nin the OpenPGP section of the Account Settings to enable this feature.</span>
<a href="#l6.113"></a><span id="l6.113"> </span>
<a href="#l6.114"></a><span id="l6.114"> ### rulesConflict=Conflicting per-recipient rules detected\n%S\n\nSend message with these settings?</span>
<a href="#l6.115"></a><span id="l6.115"> ### msgCompose.button.configure=&amp;Configure</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+msgCompose.button.send=&amp;Send Message</span>
<a href="#l6.117"></a><span id="l6.117"> ### msgCompose.button.save=&amp;Save Message</span>
<a href="#l6.118"></a><span id="l6.118"> </span>
<a href="#l6.119"></a><span id="l6.119"> # Strings in enigmailMsgHdrViewOverlay.js</span>
<a href="#l6.120"></a><span id="l6.120"> ### signatureFrom=Signature from public key %S</span>
<a href="#l6.121"></a><span id="l6.121"> ### clickDecrypt=; use 'Decrypt/Verify' function</span>
<a href="#l6.122"></a><span id="l6.122"> ### clickDecryptRetry=; use 'Decrypt/Verify' function to retry</span>
<a href="#l6.123"></a><span id="l6.123"> ### clickDetailsButton=; click on 'Details' button for more information</span>
<a href="#l6.124"></a><span id="l6.124"> ### clickImportButton=; click on the 'Import Key' button to import the key</span>
<a href="#l6.125"></a><span id="l6.125"> ### keyTypeUnsupported=; the key type is not supported by your version of GnuPG</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-### decryptManually=; click on the 'Decrypt' button to decrypt the message</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-### verifyManually=; click on the 'Verify' button to verify the signature</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-### headerView.button.verify=Verify</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-### headerView.button.decrypt=Decrypt</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-### msgPart=Part of the message %S</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-### msgSigned=signed</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineplus">+decryptManually=; click on the 'Decrypt' button to decrypt the message</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineplus">+verifyManually=; click on the 'Verify' button to verify the signature</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineplus">+headerView.button.verify=Verify</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineplus">+headerView.button.decrypt=Decrypt</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineplus">+msgPart=Part of the message %S</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+msgSigned=signed</span>
<a href="#l6.138"></a><span id="l6.138"> ### msgSignedUnkownKey=signed with unknown key</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineminus">-### msgEncrypted=encrypted</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+msgEncrypted=encrypted</span>
<a href="#l6.141"></a><span id="l6.141"> ### msgSignedAndEnc=signed and encrypted</span>
<a href="#l6.142"></a><span id="l6.142"> </span>
<a href="#l6.143"></a><span id="l6.143"> ### goodSig=Good signature</span>
<a href="#l6.144"></a><span id="l6.144"> ### uncertainSig=Uncertain signature</span>
<a href="#l6.145"></a><span id="l6.145"> ### badSig=Bad signature</span>
<a href="#l6.146"></a><span id="l6.146"> ### incompleteDecrypt=Decryption incomplete</span>
<a href="#l6.147"></a><span id="l6.147"> ### needKey=Error - no matching secret key found to decrypt message</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineplus">+failedDecrypt=Error - decryption failed</span>
<a href="#l6.149"></a><span id="l6.149"> ### badPhrase=Error - bad passphrase</span>
<a href="#l6.150"></a><span id="l6.150"> ### missingMdcError=Error - missing or broken integrity protection (MDC)</span>
<a href="#l6.151"></a><span id="l6.151"> ### failedDecryptVerify=Error - decryption/verification failed</span>
<a href="#l6.152"></a><span id="l6.152"> ### viewInfo=; View &gt; Message security info for details</span>
<a href="#l6.153"></a><span id="l6.153"> ### brokenExchangeMessage=Broken PGP/MIME message from MS-Exchange.</span>
<a href="#l6.154"></a><span id="l6.154"> </span>
<a href="#l6.155"></a><span id="l6.155"> ### decryptedMsg=Decrypted message</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineplus">+decryptedMsgWithFormatError=Decrypted message (restored broken PGP email format probably caused by an old Exchange server, so that the result might not be perfect to read)</span>
<a href="#l6.157"></a><span id="l6.157"> </span>
<a href="#l6.158"></a><span id="l6.158"> ### usedAlgorithms=Used Algorithms: %1$S and %2$S</span>
<a href="#l6.159"></a><span id="l6.159"> </span>
<a href="#l6.160"></a><span id="l6.160" class="difflineminus">-### wksConfirmationReq=Web Key Directory Confirmation Request</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineminus">-### wksConfirmationReq.message=This message has been sent by your email provider to confirm deployment of your OpenPGP public key\nin their Web Key Directory.\nProviding your public key helps others to discover your key and thus being able to encrypt messages to you.\n\nIf you want to deploy your key in the Web Key Directory now, please click on the button &quot;Confirm Request&quot; in the status bar.\nOtherwise, simply ignore this message.</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineminus">-### wksConfirmationReq.button.label=Confirm Request</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineplus">+wksConfirmationReq=Web Key Directory Confirmation Request</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineplus">+wksConfirmationReq.message=This message has been sent by your email provider to confirm deployment of your OpenPGP public key\nin their Web Key Directory.\nProviding your public key helps others to discover your key and thus being able to encrypt messages to you.\n\nIf you want to deploy your key in the Web Key Directory now, please click on the button &quot;Confirm Request&quot; in the status bar.\nOtherwise, simply ignore this message.</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineplus">+wksConfirmationReq.button.label=Confirm Request</span>
<a href="#l6.166"></a><span id="l6.166"> </span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-### autocryptSetupReq.setupMsg.desc=This message contains all information to transfer your Autocrypt settings along with your secret key securely from your original device.</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-### autocryptSetupReq.setupMsg.backup=You can keep this message and use it as a backup for your secret key. If you want to do this, you should write down the password and store it securely.</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineplus">+autocryptSetupReq.setupMsg.desc=This message contains all information to transfer your Autocrypt settings along with your secret key securely from your original device.</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineplus">+autocryptSetupReq.setupMsg.backup=You can keep this message and use it as a backup for your secret key. If you want to do this, you should write down the password and store it securely.</span>
<a href="#l6.171"></a><span id="l6.171"> ### autocryptSetupReq.message.sent=Please click on the message on your new device and follow the instuctions to import the settings.</span>
<a href="#l6.172"></a><span id="l6.172"> </span>
<a href="#l6.173"></a><span id="l6.173"> # strings in pref-enigmail.js</span>
<a href="#l6.174"></a><span id="l6.174"> ### locateGpg=Locate GnuPG program</span>
<a href="#l6.175"></a><span id="l6.175"> ### warningsAreReset=All warnings have been reset.</span>
<a href="#l6.176"></a><span id="l6.176"> ### prefs.gpgFound=GnuPG was found in %S</span>
<a href="#l6.177"></a><span id="l6.177"> ### prefs.gpgNotFound=Could not find GnuPG</span>
<a href="#l6.178"></a><span id="l6.178"> ### prefEnigmail.oneKeyserverOnly=Error - you can only specify one keyserver for automatic downloading of missing OpenPGP keys.</span>
<a href="#l6.179"></a><span id="l6.179"> ### acSetupMessage.desc=Transfer your key to another Autocrypt-enabled device. (&lt;html:span class='enigmailLink' href='https://autocrypt.org'&gt;What is Autocrypt&lt;/html:span&gt;)</span>
<a href="#l6.180"></a><span id="l6.180"> </span>
<a href="#l6.181"></a><span id="l6.181"> # Strings used in core.jsm</span>
<a href="#l6.182"></a><span id="l6.182"> # (said file also re-uses some strings from above)</span>
<a href="#l6.183"></a><span id="l6.183"> </span>
<a href="#l6.184"></a><span id="l6.184"> ### enterAdminPin=Please type in the ADMIN PIN of your SmartCard</span>
<a href="#l6.185"></a><span id="l6.185"> ### enterCardPin=Please type your SmartCard PIN</span>
<a href="#l6.186"></a><span id="l6.186"> </span>
<a href="#l6.187"></a><span id="l6.187" class="difflineminus">-### badCommand=Error - encryption command failed</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-### cmdLine=command line and output:</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-### notComplete=Error - key generation not yet completed</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineplus">+badCommand=Error - encryption command failed</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineplus">+cmdLine=command line and output:</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineplus">+notRequired=Error - no encryption required</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineplus">+notComplete=Error - key generation not yet completed</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineplus">+invalidEmail=Error - invalid email address(es)</span>
<a href="#l6.196"></a><span id="l6.196"> ### noPassphrase=Error - no passphrase supplied</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineplus">+noPGPblock=Error - No valid armored OpenPGP data block found</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineplus">+unverifiedReply=Indented message part (reply) was probably modified</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineplus">+keyInMessageBody=A key was found in the message body. Click 'Import Key' to import the key</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineplus">+sigMismatch=Error - Signature mismatch</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineplus">+cantImport=Error importing public key\n\n</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineplus">+doImportOne=Import %1$S (%2$S)?</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineplus">+doImportMultiple=Import the following keys?\n\n%S</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineplus">+previewFailed=Can't read public key file.</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineplus">+passphrasePrompt=Please enter the passphrase that unlocks the following key: %S</span>
<a href="#l6.206"></a><span id="l6.206"> </span>
<a href="#l6.207"></a><span id="l6.207"> # Strings used in errorHandling.jsm</span>
<a href="#l6.208"></a><span id="l6.208"> ### sc.wrongCardAvailable=The SmartCard %1$S found in your reader cannot be used to process the message.\nPlease insert your SmartCard %2$S and repeat the operation.</span>
<a href="#l6.209"></a><span id="l6.209"> ### sc.insertCard=The operation requires your SmartCard %S.\nPlease insert the required SmartCard and repeat the operation.</span>
<a href="#l6.210"></a><span id="l6.210"> ### sc.removeCard=The operation requires no SmartCard to be in the reader.\nPlease remove your SmartCard and repeat the operation.</span>
<a href="#l6.211"></a><span id="l6.211"> ### sc.noCardAvailable=No SmartCard could be found in your reader\nPlease insert your SmartCard and repeat the operation.</span>
<a href="#l6.212"></a><span id="l6.212"> ### sc.noReaderAvailable=Your SmartCard reader could not be accessed\nPlease attach your SmartCard reader, insert your card, and repeat the operation.</span>
<a href="#l6.213"></a><span id="l6.213"> ### keyError.resolutionAction=Please select a valid key in the OpenPGP section of your Account Settings.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/commonWorkflows.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/commonWorkflows.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -30,19 +30,17 @@ var l10n = new Localization([&quot;messenger/</span>
<a href="#l7.4"></a><span id="l7.4"> function passphrasePromptCallback(win, keyId, resultFlags) {</span>
<a href="#l7.5"></a><span id="l7.5">   let p = {};</span>
<a href="#l7.6"></a><span id="l7.6">   p.value = &quot;&quot;;</span>
<a href="#l7.7"></a><span id="l7.7">   let dummy = {};</span>
<a href="#l7.8"></a><span id="l7.8">   if (</span>
<a href="#l7.9"></a><span id="l7.9">     !Services.prompt.promptPassword(</span>
<a href="#l7.10"></a><span id="l7.10">       win,</span>
<a href="#l7.11"></a><span id="l7.11">       &quot;&quot;,</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      l10n.formatValueSync(&quot;passphrase-prompt&quot;, {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-        key: keyId,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-      }),</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+      EnigmailLocale.getString(&quot;passphrasePrompt&quot;, [keyId]),</span>
<a href="#l7.16"></a><span id="l7.16">       p,</span>
<a href="#l7.17"></a><span id="l7.17">       null,</span>
<a href="#l7.18"></a><span id="l7.18">       dummy</span>
<a href="#l7.19"></a><span id="l7.19">     )</span>
<a href="#l7.20"></a><span id="l7.20">   ) {</span>
<a href="#l7.21"></a><span id="l7.21">     resultFlags.canceled = true;</span>
<a href="#l7.22"></a><span id="l7.22">     return &quot;&quot;;</span>
<a href="#l7.23"></a><span id="l7.23">   }</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -90,31 +88,31 @@ function EnigmailCommon_importKeysFromFi</span>
<a href="#l7.25"></a><span id="l7.25">     return false;</span>
<a href="#l7.26"></a><span id="l7.26">   }</span>
<a href="#l7.27"></a><span id="l7.27">   let exitStatus = -1;</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">   if (preview.length &gt; 0) {</span>
<a href="#l7.30"></a><span id="l7.30">     if (preview.length == 1) {</span>
<a href="#l7.31"></a><span id="l7.31">       exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l7.32"></a><span id="l7.32">         window,</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-        l10n.formatValueSync(&quot;do-import-one&quot;, {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-          name: preview[0].name,</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-          id: preview[0].id,</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-        })</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+        EnigmailLocale.getString(&quot;doImportOne&quot;, [</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+          preview[0].name,</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+          preview[0].id,</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+        ])</span>
<a href="#l7.41"></a><span id="l7.41">       );</span>
<a href="#l7.42"></a><span id="l7.42">     } else {</span>
<a href="#l7.43"></a><span id="l7.43">       exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l7.44"></a><span id="l7.44">         window,</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-        l10n.formatValueSync(&quot;do-import-multiple&quot;, {</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-          key: preview</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+        EnigmailLocale.getString(&quot;doImportMultiple&quot;, [</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+          preview</span>
<a href="#l7.49"></a><span id="l7.49">             .map(function(a) {</span>
<a href="#l7.50"></a><span id="l7.50">               return &quot;\t&quot; + a.name + &quot; (&quot; + a.id + &quot;)&quot;;</span>
<a href="#l7.51"></a><span id="l7.51">             })</span>
<a href="#l7.52"></a><span id="l7.52">             .join(&quot;\n&quot;),</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-        })</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+        ])</span>
<a href="#l7.55"></a><span id="l7.55">       );</span>
<a href="#l7.56"></a><span id="l7.56">     }</span>
<a href="#l7.57"></a><span id="l7.57"> </span>
<a href="#l7.58"></a><span id="l7.58">     if (exitStatus) {</span>
<a href="#l7.59"></a><span id="l7.59">       // import</span>
<a href="#l7.60"></a><span id="l7.60">       let resultKeys = {};</span>
<a href="#l7.61"></a><span id="l7.61">       let exitCode = EnigmailKeyRing.importKeyFromFile(</span>
<a href="#l7.62"></a><span id="l7.62">         window,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailKeyManager.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailKeyManager.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -766,31 +766,31 @@ function enigmailImportFromClipbrd() {</span>
<a href="#l8.4"></a><span id="l8.4">   );</span>
<a href="#l8.5"></a><span id="l8.5">   // should we allow importing secret keys?</span>
<a href="#l8.6"></a><span id="l8.6">   var exitStatus = -1;</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">   if (preview &amp;&amp; preview.length &gt; 0) {</span>
<a href="#l8.9"></a><span id="l8.9">     if (preview.length == 1) {</span>
<a href="#l8.10"></a><span id="l8.10">       exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l8.11"></a><span id="l8.11">         window,</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        l10n.formatValueSync(&quot;do-import-one&quot;, {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-          name: preview[0].name,</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-          id: preview[0].id,</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-        })</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+        EnigmailLocale.getString(&quot;doImportOne&quot;, [</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+          preview[0].name,</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+          preview[0].id,</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+        ])</span>
<a href="#l8.20"></a><span id="l8.20">       );</span>
<a href="#l8.21"></a><span id="l8.21">     } else {</span>
<a href="#l8.22"></a><span id="l8.22">       exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l8.23"></a><span id="l8.23">         window,</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-        l10n.formatValueSync(&quot;do-import-multiple&quot;, {</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-          key: preview</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+        EnigmailLocale.getString(&quot;doImportMultiple&quot;, [</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+          preview</span>
<a href="#l8.28"></a><span id="l8.28">             .map(function(a) {</span>
<a href="#l8.29"></a><span id="l8.29">               return &quot;\t&quot; + a.name + &quot; (&quot; + a.id + &quot;)&quot;;</span>
<a href="#l8.30"></a><span id="l8.30">             })</span>
<a href="#l8.31"></a><span id="l8.31">             .join(&quot;\n&quot;),</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-        })</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+        ])</span>
<a href="#l8.34"></a><span id="l8.34">       );</span>
<a href="#l8.35"></a><span id="l8.35">     }</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">     if (exitStatus) {</span>
<a href="#l8.38"></a><span id="l8.38">       // import</span>
<a href="#l8.39"></a><span id="l8.39">       EnigmailKeyRing.importKey(</span>
<a href="#l8.40"></a><span id="l8.40">         window,</span>
<a href="#l8.41"></a><span id="l8.41">         false,</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineat">@@ -801,19 +801,17 @@ function enigmailImportFromClipbrd() {</span>
<a href="#l8.43"></a><span id="l8.43">       );</span>
<a href="#l8.44"></a><span id="l8.44">       var keyList = preview.map(function(a) {</span>
<a href="#l8.45"></a><span id="l8.45">         return a.id;</span>
<a href="#l8.46"></a><span id="l8.46">       });</span>
<a href="#l8.47"></a><span id="l8.47">       EnigmailDialog.keyImportDlg(window, keyList);</span>
<a href="#l8.48"></a><span id="l8.48">       refreshKeys();</span>
<a href="#l8.49"></a><span id="l8.49">     }</span>
<a href="#l8.50"></a><span id="l8.50">   } else {</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-    document.l10n.formatValue(&quot;preview-failed&quot;).then(value =&gt; {</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-      EnigmailDialog.alert(window, value);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-    });</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+    EnigmailDialog.alert(window, EnigmailLocale.getString(&quot;previewFailed&quot;));</span>
<a href="#l8.55"></a><span id="l8.55">   }</span>
<a href="#l8.56"></a><span id="l8.56"> }</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58"> function enigmailCopyToClipbrd() {</span>
<a href="#l8.59"></a><span id="l8.59">   var enigmailSvc = GetEnigmailSvc();</span>
<a href="#l8.60"></a><span id="l8.60">   if (!enigmailSvc) {</span>
<a href="#l8.61"></a><span id="l8.61">     return;</span>
<a href="#l8.62"></a><span id="l8.62">   }</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineat">@@ -1110,50 +1108,51 @@ function enigmailImportKeysFromUrl() {</span>
<a href="#l8.64"></a><span id="l8.64">         );</span>
<a href="#l8.65"></a><span id="l8.65">         // should we allow importing secret keys?</span>
<a href="#l8.66"></a><span id="l8.66">         var exitStatus = -1;</span>
<a href="#l8.67"></a><span id="l8.67"> </span>
<a href="#l8.68"></a><span id="l8.68">         if (preview &amp;&amp; preview.length &gt; 0) {</span>
<a href="#l8.69"></a><span id="l8.69">           if (preview.length == 1) {</span>
<a href="#l8.70"></a><span id="l8.70">             exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l8.71"></a><span id="l8.71">               window,</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineminus">-              l10n.formatValueSync(&quot;do-import-one&quot;, {</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-                name: preview[0].name,</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-                id: preview[0].id,</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineminus">-              })</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+              EnigmailLocale.getString(&quot;doImportOne&quot;, [</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+                preview[0].name,</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+                preview[0].id,</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+              ])</span>
<a href="#l8.80"></a><span id="l8.80">             );</span>
<a href="#l8.81"></a><span id="l8.81">           } else {</span>
<a href="#l8.82"></a><span id="l8.82">             exitStatus = EnigmailDialog.confirmDlg(</span>
<a href="#l8.83"></a><span id="l8.83">               window,</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-              l10n.formatValueSync(&quot;do-import-multiple&quot;, {</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-                key: preview</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+              EnigmailLocale.getString(&quot;doImportMultiple&quot;, [</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+                preview</span>
<a href="#l8.88"></a><span id="l8.88">                   .map(function(a) {</span>
<a href="#l8.89"></a><span id="l8.89">                     return &quot;\t&quot; + a.name + &quot; (&quot; + a.id + &quot;)&quot;;</span>
<a href="#l8.90"></a><span id="l8.90">                   })</span>
<a href="#l8.91"></a><span id="l8.91">                   .join(&quot;\n&quot;),</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-              })</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+              ])</span>
<a href="#l8.94"></a><span id="l8.94">             );</span>
<a href="#l8.95"></a><span id="l8.95">           }</span>
<a href="#l8.96"></a><span id="l8.96"> </span>
<a href="#l8.97"></a><span id="l8.97">           if (exitStatus) {</span>
<a href="#l8.98"></a><span id="l8.98">             EnigmailKeyRing.importKey(</span>
<a href="#l8.99"></a><span id="l8.99">               window,</span>
<a href="#l8.100"></a><span id="l8.100">               false,</span>
<a href="#l8.101"></a><span id="l8.101">               data,</span>
<a href="#l8.102"></a><span id="l8.102">               false,</span>
<a href="#l8.103"></a><span id="l8.103">               &quot;&quot;,</span>
<a href="#l8.104"></a><span id="l8.104">               errorMsgObj</span>
<a href="#l8.105"></a><span id="l8.105">             );</span>
<a href="#l8.106"></a><span id="l8.106">             errorMsgObj.preview = preview;</span>
<a href="#l8.107"></a><span id="l8.107">             resolve(errorMsgObj);</span>
<a href="#l8.108"></a><span id="l8.108">           }</span>
<a href="#l8.109"></a><span id="l8.109">         } else {</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-          document.l10n.formatValue(&quot;preview-failed&quot;).then(value =&gt; {</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-            EnigmailDialog.alert(window, value);</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-          });</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+          EnigmailDialog.alert(</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+            window,</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+            EnigmailLocale.getString(&quot;previewFailed&quot;)</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineplus">+          );</span>
<a href="#l8.117"></a><span id="l8.117">         }</span>
<a href="#l8.118"></a><span id="l8.118">       };</span>
<a href="#l8.119"></a><span id="l8.119"> </span>
<a href="#l8.120"></a><span id="l8.120">       try {</span>
<a href="#l8.121"></a><span id="l8.121">         var bufferListener = EnigmailStreams.newStringStreamListener(cbFunc);</span>
<a href="#l8.122"></a><span id="l8.122">         var ioServ = Services.io;</span>
<a href="#l8.123"></a><span id="l8.123">         var msgUri = ioServ.newURI(value.value);</span>
<a href="#l8.124"></a><span id="l8.124"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailMessengerOverlay.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1787,19 +1787,20 @@ Enigmail.msg = {</span>
<a href="#l9.4"></a><span id="l9.4">     if (preview &amp;&amp; errorMsgObj.value === &quot;&quot;) {</span>
<a href="#l9.5"></a><span id="l9.5">       EnigmailKeyRing.importKeyDataWithConfirmation(</span>
<a href="#l9.6"></a><span id="l9.6">         window,</span>
<a href="#l9.7"></a><span id="l9.7">         preview,</span>
<a href="#l9.8"></a><span id="l9.8">         keyData,</span>
<a href="#l9.9"></a><span id="l9.9">         true</span>
<a href="#l9.10"></a><span id="l9.10">       );</span>
<a href="#l9.11"></a><span id="l9.11">     } else {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-      document.l10n.formatValue(&quot;preview-failed&quot;).then(value =&gt; {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-        EnigmailDialog.alert(window, value + &quot;\n&quot; + errorMsgObj.value);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-      });</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+      EnigmailDialog.alert(</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+        window,</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+        EnigmailLocale.getString(&quot;previewFailed&quot;) + &quot;\n&quot; + errorMsgObj.value</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+      );</span>
<a href="#l9.19"></a><span id="l9.19">     }</span>
<a href="#l9.20"></a><span id="l9.20">   },</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22">   async searchSignatureKey() {</span>
<a href="#l9.23"></a><span id="l9.23">     let keyId = document</span>
<a href="#l9.24"></a><span id="l9.24">       .getElementById(&quot;signatureKeyBox&quot;)</span>
<a href="#l9.25"></a><span id="l9.25">       .getAttribute(&quot;keyid&quot;);</span>
<a href="#l9.26"></a><span id="l9.26">     if (!keyId) {</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineat">@@ -1837,19 +1838,20 @@ Enigmail.msg = {</span>
<a href="#l9.28"></a><span id="l9.28">     if (preview &amp;&amp; errorMsgObj.value === &quot;&quot;) {</span>
<a href="#l9.29"></a><span id="l9.29">       EnigmailKeyRing.importKeyDataWithConfirmation(</span>
<a href="#l9.30"></a><span id="l9.30">         window,</span>
<a href="#l9.31"></a><span id="l9.31">         preview,</span>
<a href="#l9.32"></a><span id="l9.32">         keyData,</span>
<a href="#l9.33"></a><span id="l9.33">         false</span>
<a href="#l9.34"></a><span id="l9.34">       );</span>
<a href="#l9.35"></a><span id="l9.35">     } else {</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-      document.l10n.formatValue(&quot;preview-failed&quot;).then(value =&gt; {</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-        EnigmailDialog.alert(window, value + &quot;\n&quot; + errorMsgObj.value);</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-      });</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+      EnigmailDialog.alert(</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+        window,</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+        EnigmailLocale.getString(&quot;previewFailed&quot;) + &quot;\n&quot; + errorMsgObj.value</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+      );</span>
<a href="#l9.43"></a><span id="l9.43">     }</span>
<a href="#l9.44"></a><span id="l9.44">   },</span>
<a href="#l9.45"></a><span id="l9.45"> </span>
<a href="#l9.46"></a><span id="l9.46">   /**</span>
<a href="#l9.47"></a><span id="l9.47">    * Extract the subject from the 1st content line and move it to the subject line</span>
<a href="#l9.48"></a><span id="l9.48">    */</span>
<a href="#l9.49"></a><span id="l9.49">   movePEPsubject() {</span>
<a href="#l9.50"></a><span id="l9.50">     EnigmailLog.DEBUG(&quot;enigmailMessengerOverlay.js: movePEPsubject:\n&quot;);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineat">@@ -2712,17 +2714,17 @@ Enigmail.msg = {</span>
<a href="#l9.52"></a><span id="l9.52">       attachment.displayName = newLabel;</span>
<a href="#l9.53"></a><span id="l9.53">     }</span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55">     if (index &amp;&amp; index.length &gt; 0) {</span>
<a href="#l9.56"></a><span id="l9.56">       this.revealAttachments(parseInt(index, 10) + 1);</span>
<a href="#l9.57"></a><span id="l9.57">     }</span>
<a href="#l9.58"></a><span id="l9.58">   },</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-  async decryptAttachmentCallback(cbArray) {</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+  decryptAttachmentCallback(cbArray) {</span>
<a href="#l9.62"></a><span id="l9.62">     EnigmailLog.DEBUG(</span>
<a href="#l9.63"></a><span id="l9.63">       &quot;enigmailMessengerOverlay.js: decryptAttachmentCallback:\n&quot;</span>
<a href="#l9.64"></a><span id="l9.64">     );</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66">     var callbackArg = cbArray[0];</span>
<a href="#l9.67"></a><span id="l9.67"> </span>
<a href="#l9.68"></a><span id="l9.68">     var exitCodeObj = {};</span>
<a href="#l9.69"></a><span id="l9.69">     var statusFlagsObj = {};</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineat">@@ -2819,19 +2821,20 @@ Enigmail.msg = {</span>
<a href="#l9.71"></a><span id="l9.71">       if (preview &amp;&amp; errorMsgObj.value === &quot;&quot;) {</span>
<a href="#l9.72"></a><span id="l9.72">         EnigmailKeyRing.importKeyDataWithConfirmation(</span>
<a href="#l9.73"></a><span id="l9.73">           window,</span>
<a href="#l9.74"></a><span id="l9.74">           preview,</span>
<a href="#l9.75"></a><span id="l9.75">           callbackArg.data,</span>
<a href="#l9.76"></a><span id="l9.76">           false</span>
<a href="#l9.77"></a><span id="l9.77">         );</span>
<a href="#l9.78"></a><span id="l9.78">       } else {</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">-        document.l10n.formatValue(&quot;preview-failed&quot;).then(value =&gt; {</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-          EnigmailDialog.alert(window, value + &quot;\n&quot; + errorMsgObj.value);</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-        });</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+        EnigmailDialog.alert(</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+          window,</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+          EnigmailLocale.getString(&quot;previewFailed&quot;) + &quot;\n&quot; + errorMsgObj.value</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+        );</span>
<a href="#l9.86"></a><span id="l9.86">       }</span>
<a href="#l9.87"></a><span id="l9.87">       outFile.remove(true);</span>
<a href="#l9.88"></a><span id="l9.88">       return;</span>
<a href="#l9.89"></a><span id="l9.89">     }</span>
<a href="#l9.90"></a><span id="l9.90"> </span>
<a href="#l9.91"></a><span id="l9.91">     exitStatus = EnigmailDecryption.decryptAttachment(</span>
<a href="#l9.92"></a><span id="l9.92">       window,</span>
<a href="#l9.93"></a><span id="l9.93">       outFile,</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineat">@@ -2858,19 +2861,17 @@ Enigmail.msg = {</span>
<a href="#l9.95"></a><span id="l9.95">           EnigmailDialog.info(</span>
<a href="#l9.96"></a><span id="l9.96">             window,</span>
<a href="#l9.97"></a><span id="l9.97">             EnigmailLocale.getString(&quot;decryptOkNoSig&quot;)</span>
<a href="#l9.98"></a><span id="l9.98">           );</span>
<a href="#l9.99"></a><span id="l9.99">         }</span>
<a href="#l9.100"></a><span id="l9.100">       } else {</span>
<a href="#l9.101"></a><span id="l9.101">         EnigmailDialog.info(</span>
<a href="#l9.102"></a><span id="l9.102">           window,</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-          (await document.l10n.formatValue(&quot;failed-decrypt&quot;)) +</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-            &quot;\n\n&quot; +</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineminus">-            errorMsgObj.value</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+          EnigmailLocale.getString(&quot;failedDecrypt&quot;) + &quot;\n\n&quot; + errorMsgObj.value</span>
<a href="#l9.107"></a><span id="l9.107">         );</span>
<a href="#l9.108"></a><span id="l9.108">         exitStatus = false;</span>
<a href="#l9.109"></a><span id="l9.109">       }</span>
<a href="#l9.110"></a><span id="l9.110">     }</span>
<a href="#l9.111"></a><span id="l9.111">     if (exitStatus) {</span>
<a href="#l9.112"></a><span id="l9.112">       if (statusFlagsObj.value &amp; EnigmailConstants.IMPORTED_KEY) {</span>
<a href="#l9.113"></a><span id="l9.113">         if (exitCodeObj.keyList) {</span>
<a href="#l9.114"></a><span id="l9.114">           let importKeyList = exitCodeObj.keyList.map(function(a) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailMsgComposeOverlay.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -95,18 +95,16 @@ var EnigmailMsgRead = ChromeUtils.import</span>
<a href="#l10.4"></a><span id="l10.4"> var EnigmailMimeEncrypt = ChromeUtils.import(</span>
<a href="#l10.5"></a><span id="l10.5">   &quot;chrome://openpgp/content/modules/mimeEncrypt.jsm&quot;</span>
<a href="#l10.6"></a><span id="l10.6"> ).EnigmailMimeEncrypt;</span>
<a href="#l10.7"></a><span id="l10.7"> const { EnigmailCryptoAPI } = ChromeUtils.import(</span>
<a href="#l10.8"></a><span id="l10.8">   &quot;chrome://openpgp/content/modules/cryptoAPI.jsm&quot;</span>
<a href="#l10.9"></a><span id="l10.9"> );</span>
<a href="#l10.10"></a><span id="l10.10"> var { jsmime } = ChromeUtils.import(&quot;resource:///modules/jsmime.jsm&quot;);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var l10n = new Localization([&quot;messenger/openpgp/enigmail.ftl&quot;], true);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-</span>
<a href="#l10.14"></a><span id="l10.14"> // Account encryption policy values:</span>
<a href="#l10.15"></a><span id="l10.15"> // const kEncryptionPolicy_Never = 0;</span>
<a href="#l10.16"></a><span id="l10.16"> // 'IfPossible' was used by ns4.</span>
<a href="#l10.17"></a><span id="l10.17"> // const kEncryptionPolicy_IfPossible = 1;</span>
<a href="#l10.18"></a><span id="l10.18"> var kEncryptionPolicy_Always = 2;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> if (!Enigmail) {</span>
<a href="#l10.21"></a><span id="l10.21">   var Enigmail = {};</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -957,24 +955,24 @@ Enigmail.msg = {</span>
<a href="#l10.23"></a><span id="l10.23">       );</span>
<a href="#l10.24"></a><span id="l10.24">       if (attachedObj) {</span>
<a href="#l10.25"></a><span id="l10.25">         this.attachOwnKeyObj.attachedObj = attachedObj;</span>
<a href="#l10.26"></a><span id="l10.26">         this.attachOwnKeyObj.attachedKey = hex;</span>
<a href="#l10.27"></a><span id="l10.27">       }</span>
<a href="#l10.28"></a><span id="l10.28">     }</span>
<a href="#l10.29"></a><span id="l10.29">   },</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  async attachKey() {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  attachKey() {</span>
<a href="#l10.33"></a><span id="l10.33">     EnigmailLog.DEBUG(</span>
<a href="#l10.34"></a><span id="l10.34">       &quot;enigmailMsgComposeOverlay.js: Enigmail.msg.attachKey: \n&quot;</span>
<a href="#l10.35"></a><span id="l10.35">     );</span>
<a href="#l10.36"></a><span id="l10.36"> </span>
<a href="#l10.37"></a><span id="l10.37">     var resultObj = {};</span>
<a href="#l10.38"></a><span id="l10.38">     var inputObj = {};</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    inputObj.dialogHeader = await document.l10n.formatValue(&quot;keys-to-export&quot;);</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+    inputObj.dialogHeader = EnigmailLocale.getString(&quot;keysToExport&quot;);</span>
<a href="#l10.41"></a><span id="l10.41">     inputObj.options = &quot;multisel,allowexpired,nosending&quot;;</span>
<a href="#l10.42"></a><span id="l10.42">     if (this.trustAllKeys) {</span>
<a href="#l10.43"></a><span id="l10.43">       inputObj.options += &quot;,trustallkeys&quot;;</span>
<a href="#l10.44"></a><span id="l10.44">     }</span>
<a href="#l10.45"></a><span id="l10.45">     window.openDialog(</span>
<a href="#l10.46"></a><span id="l10.46">       &quot;chrome://openpgp/content/ui/enigmailKeySelection.xhtml&quot;,</span>
<a href="#l10.47"></a><span id="l10.47">       &quot;&quot;,</span>
<a href="#l10.48"></a><span id="l10.48">       &quot;dialog,modal,centerscreen,resizable&quot;,</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineat">@@ -1580,19 +1578,17 @@ Enigmail.msg = {</span>
<a href="#l10.50"></a><span id="l10.50">       var editor = gMsgCompose.editor.QueryInterface(Ci.nsIEditorMailSupport);</span>
<a href="#l10.51"></a><span id="l10.51">       var encoderFlags = dce.OutputFormatted | dce.OutputLFLineBreak;</span>
<a href="#l10.52"></a><span id="l10.52"> </span>
<a href="#l10.53"></a><span id="l10.53">       var wrapWidth = this.getMailPref(&quot;mailnews.wraplength&quot;);</span>
<a href="#l10.54"></a><span id="l10.54">       if (wrapWidth &gt; 0 &amp;&amp; wrapWidth &lt; 68 &amp;&amp; editor.wrapWidth &gt; 0) {</span>
<a href="#l10.55"></a><span id="l10.55">         if (</span>
<a href="#l10.56"></a><span id="l10.56">           EnigmailDialog.confirmDlg(</span>
<a href="#l10.57"></a><span id="l10.57">             window,</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-            l10n.formatValueSync(&quot;minimal-line-wrapping&quot;, {</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-              width: wrapWidth,</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-            })</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+            EnigmailLocale.getString(&quot;minimalLineWrapping&quot;, [wrapWidth])</span>
<a href="#l10.62"></a><span id="l10.62">           )</span>
<a href="#l10.63"></a><span id="l10.63">         ) {</span>
<a href="#l10.64"></a><span id="l10.64">           wrapWidth = 68;</span>
<a href="#l10.65"></a><span id="l10.65">           EnigmailPrefs.getPrefRoot().setIntPref(</span>
<a href="#l10.66"></a><span id="l10.66">             &quot;mailnews.wraplength&quot;,</span>
<a href="#l10.67"></a><span id="l10.67">             wrapWidth</span>
<a href="#l10.68"></a><span id="l10.68">           );</span>
<a href="#l10.69"></a><span id="l10.69">         }</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineat">@@ -1761,26 +1757,22 @@ Enigmail.msg = {</span>
<a href="#l10.71"></a><span id="l10.71">     if (</span>
<a href="#l10.72"></a><span id="l10.72">       testStatusFlagsObj.value &amp;</span>
<a href="#l10.73"></a><span id="l10.73">       (EnigmailConstants.INVALID_RECIPIENT | EnigmailConstants.NO_SECKEY)</span>
<a href="#l10.74"></a><span id="l10.74">     ) {</span>
<a href="#l10.75"></a><span id="l10.75">       // check if own key is invalid</span>
<a href="#l10.76"></a><span id="l10.76">       if (testErrorMsgObj.value &amp;&amp; testErrorMsgObj.value.length &gt; 0) {</span>
<a href="#l10.77"></a><span id="l10.77">         ++this.saveDraftError;</span>
<a href="#l10.78"></a><span id="l10.78">         if (this.saveDraftError === 1) {</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-          document.l10n</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-            .formatValue(&quot;msg-compose-cannot-save-draft&quot;)</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-            .then(value =&gt; {</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-              this.notifyUser(</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-                3,</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-                value,</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-                &quot;saveDraftFailed&quot;,</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-                testErrorMsgObj.value</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-              );</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-            });</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+          this.notifyUser(</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+            3,</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+            EnigmailLocale.getString(&quot;msgCompose.cannotSaveDraft&quot;),</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+            &quot;saveDraftFailed&quot;,</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+            testErrorMsgObj.value</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+          );</span>
<a href="#l10.95"></a><span id="l10.95">         }</span>
<a href="#l10.96"></a><span id="l10.96">         return false;</span>
<a href="#l10.97"></a><span id="l10.97">       }</span>
<a href="#l10.98"></a><span id="l10.98">     }</span>
<a href="#l10.99"></a><span id="l10.99"> </span>
<a href="#l10.100"></a><span id="l10.100">     let secInfo;</span>
<a href="#l10.101"></a><span id="l10.101"> </span>
<a href="#l10.102"></a><span id="l10.102">     let param = Enigmail.msg.getSecurityParams();</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineat">@@ -2045,23 +2037,23 @@ Enigmail.msg = {</span>
<a href="#l10.104"></a><span id="l10.104"> </span>
<a href="#l10.105"></a><span id="l10.105">         var dummy = {</span>
<a href="#l10.106"></a><span id="l10.106">           value: null,</span>
<a href="#l10.107"></a><span id="l10.107">         };</span>
<a href="#l10.108"></a><span id="l10.108"> </span>
<a href="#l10.109"></a><span id="l10.109">         var hideBccUsers = promptSvc.confirmEx(</span>
<a href="#l10.110"></a><span id="l10.110">           window,</span>
<a href="#l10.111"></a><span id="l10.111">           EnigmailLocale.getString(&quot;enigConfirm2&quot;),</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-          l10n.formatValueSync(&quot;sending-hidden-rcpt&quot;),</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+          EnigmailLocale.getString(&quot;sendingHiddenRcpt&quot;),</span>
<a href="#l10.114"></a><span id="l10.114">           promptSvc.BUTTON_TITLE_IS_STRING * promptSvc.BUTTON_POS_0 +</span>
<a href="#l10.115"></a><span id="l10.115">             promptSvc.BUTTON_TITLE_CANCEL * promptSvc.BUTTON_POS_1 +</span>
<a href="#l10.116"></a><span id="l10.116">             promptSvc.BUTTON_TITLE_IS_STRING * promptSvc.BUTTON_POS_2,</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-          l10n.formatValueSync(&quot;send-with-shown-bcc&quot;),</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+          EnigmailLocale.getString(&quot;sendWithShownBcc&quot;),</span>
<a href="#l10.119"></a><span id="l10.119">           null,</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-          l10n.formatValueSync(&quot;send-with-hidden-bcc&quot;),</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+          EnigmailLocale.getString(&quot;sendWithHiddenBcc&quot;),</span>
<a href="#l10.122"></a><span id="l10.122">           null,</span>
<a href="#l10.123"></a><span id="l10.123">           dummy</span>
<a href="#l10.124"></a><span id="l10.124">         );</span>
<a href="#l10.125"></a><span id="l10.125">         switch (hideBccUsers) {</span>
<a href="#l10.126"></a><span id="l10.126">           case 2:</span>
<a href="#l10.127"></a><span id="l10.127">             this.addRecipients(bccAddrList, recList);</span>
<a href="#l10.128"></a><span id="l10.128">             this.addRecipients(toAddrList, recList);</span>
<a href="#l10.129"></a><span id="l10.129">             break;</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineat">@@ -2074,26 +2066,24 @@ Enigmail.msg = {</span>
<a href="#l10.131"></a><span id="l10.131">       }</span>
<a href="#l10.132"></a><span id="l10.132">     }</span>
<a href="#l10.133"></a><span id="l10.133"> </span>
<a href="#l10.134"></a><span id="l10.134">     if (newsgroups) {</span>
<a href="#l10.135"></a><span id="l10.135">       toAddrList.push(newsgroups);</span>
<a href="#l10.136"></a><span id="l10.136"> </span>
<a href="#l10.137"></a><span id="l10.137">       if (sendFlags &amp; EnigmailConstants.SEND_ENCRYPTED) {</span>
<a href="#l10.138"></a><span id="l10.138">         if (!EnigmailPrefs.getPref(&quot;encryptToNews&quot;)) {</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-          document.l10n.formatValue(&quot;sending-news&quot;).then(value =&gt; {</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-            EnigmailDialog.alert(window, value);</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineminus">-          });</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+          EnigmailDialog.alert(window, EnigmailLocale.getString(&quot;sendingNews&quot;));</span>
<a href="#l10.143"></a><span id="l10.143">           return false;</span>
<a href="#l10.144"></a><span id="l10.144">         } else if (</span>
<a href="#l10.145"></a><span id="l10.145">           !EnigmailDialog.confirmPref(</span>
<a href="#l10.146"></a><span id="l10.146">             window,</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineminus">-            l10n.formatValueSync(&quot;send-to-news-warning&quot;),</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+            EnigmailLocale.getString(&quot;sendToNewsWarning&quot;),</span>
<a href="#l10.149"></a><span id="l10.149">             &quot;warnOnSendingNewsgroups&quot;,</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-            l10n.formatValueSync(&quot;msg-compose-button-send&quot;)</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+            EnigmailLocale.getString(&quot;msgCompose.button.send&quot;)</span>
<a href="#l10.152"></a><span id="l10.152">           )</span>
<a href="#l10.153"></a><span id="l10.153">         ) {</span>
<a href="#l10.154"></a><span id="l10.154">           return false;</span>
<a href="#l10.155"></a><span id="l10.155">         }</span>
<a href="#l10.156"></a><span id="l10.156">       }</span>
<a href="#l10.157"></a><span id="l10.157">     }</span>
<a href="#l10.158"></a><span id="l10.158"> </span>
<a href="#l10.159"></a><span id="l10.159">     return {</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineat">@@ -2507,17 +2497,17 @@ Enigmail.msg = {</span>
<a href="#l10.161"></a><span id="l10.161">       return false;</span>
<a href="#l10.162"></a><span id="l10.162">     }</span>
<a href="#l10.163"></a><span id="l10.163"> </span>
<a href="#l10.164"></a><span id="l10.164">     try {</span>
<a href="#l10.165"></a><span id="l10.165">       if (this.getMailPref(&quot;mail.strictly_mime&quot;)) {</span>
<a href="#l10.166"></a><span id="l10.166">         if (</span>
<a href="#l10.167"></a><span id="l10.167">           EnigmailDialog.confirmPref(</span>
<a href="#l10.168"></a><span id="l10.168">             window,</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineminus">-            l10n.formatValueSync(&quot;quoted-printable-warn&quot;),</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+            EnigmailLocale.getString(&quot;quotedPrintableWarn&quot;),</span>
<a href="#l10.171"></a><span id="l10.171">             &quot;quotedPrintableWarn&quot;</span>
<a href="#l10.172"></a><span id="l10.172">           )</span>
<a href="#l10.173"></a><span id="l10.173">         ) {</span>
<a href="#l10.174"></a><span id="l10.174">           EnigmailPrefs.getPrefRoot().setBoolPref(&quot;mail.strictly_mime&quot;, false);</span>
<a href="#l10.175"></a><span id="l10.175">         }</span>
<a href="#l10.176"></a><span id="l10.176">       }</span>
<a href="#l10.177"></a><span id="l10.177">     } catch (ex) {}</span>
<a href="#l10.178"></a><span id="l10.178"> </span>
<a href="#l10.179"></a><span id="l10.179" class="difflineat">@@ -2633,61 +2623,55 @@ Enigmail.msg = {</span>
<a href="#l10.180"></a><span id="l10.180">           return false;</span>
<a href="#l10.181"></a><span id="l10.181">         }</span>
<a href="#l10.182"></a><span id="l10.182">       }</span>
<a href="#l10.183"></a><span id="l10.183">     }</span>
<a href="#l10.184"></a><span id="l10.184"> </span>
<a href="#l10.185"></a><span id="l10.185">     return true;</span>
<a href="#l10.186"></a><span id="l10.186">   },</span>
<a href="#l10.187"></a><span id="l10.187"> </span>
<a href="#l10.188"></a><span id="l10.188" class="difflineminus">-  async sendAborted(window, errorMsgObj) {</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineplus">+  sendAborted(window, errorMsgObj) {</span>
<a href="#l10.190"></a><span id="l10.190">     if (errorMsgObj &amp;&amp; errorMsgObj.value) {</span>
<a href="#l10.191"></a><span id="l10.191">       var txt = errorMsgObj.value;</span>
<a href="#l10.192"></a><span id="l10.192">       var txtLines = txt.split(/\r?\n/);</span>
<a href="#l10.193"></a><span id="l10.193">       var errorMsg = &quot;&quot;;</span>
<a href="#l10.194"></a><span id="l10.194">       for (var i = 0; i &lt; txtLines.length; ++i) {</span>
<a href="#l10.195"></a><span id="l10.195">         var line = txtLines[i];</span>
<a href="#l10.196"></a><span id="l10.196">         var tokens = line.split(/ /);</span>
<a href="#l10.197"></a><span id="l10.197">         // process most important business reasons for invalid recipient (and sender) errors:</span>
<a href="#l10.198"></a><span id="l10.198">         if (</span>
<a href="#l10.199"></a><span id="l10.199">           tokens.length == 3 &amp;&amp;</span>
<a href="#l10.200"></a><span id="l10.200">           (tokens[0] == &quot;INV_RECP&quot; || tokens[0] == &quot;INV_SGNR&quot;)</span>
<a href="#l10.201"></a><span id="l10.201">         ) {</span>
<a href="#l10.202"></a><span id="l10.202">           var reason = tokens[1];</span>
<a href="#l10.203"></a><span id="l10.203">           var key = tokens[2];</span>
<a href="#l10.204"></a><span id="l10.204">           if (reason == &quot;10&quot;) {</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineminus">-            errorMsg +=</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineminus">-              (await document.l10n.formatValue(&quot;key-not-trusted&quot;, { key })) +</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineminus">-              &quot;\n&quot;;</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineplus">+            errorMsg += EnigmailLocale.getString(&quot;keyNotTrusted&quot;, [key]) + &quot;\n&quot;;</span>
<a href="#l10.209"></a><span id="l10.209">           } else if (reason == &quot;1&quot;) {</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineminus">-            errorMsg +=</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineminus">-              (await document.l10n.formatValue(&quot;key-not-found&quot;, { key })) +</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineminus">-              &quot;\n&quot;;</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineplus">+            errorMsg += EnigmailLocale.getString(&quot;keyNotFound&quot;, [key]) + &quot;\n&quot;;</span>
<a href="#l10.214"></a><span id="l10.214">           } else if (reason == &quot;4&quot;) {</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineminus">-            errorMsg +=</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineminus">-              (await document.l10n.formatValue(&quot;key-revoked&quot;, { key })) + &quot;\n&quot;;</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineplus">+            errorMsg += EnigmailLocale.getString(&quot;keyRevoked&quot;, [key]) + &quot;\n&quot;;</span>
<a href="#l10.218"></a><span id="l10.218">           } else if (reason == &quot;5&quot;) {</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineminus">-            errorMsg +=</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineminus">-              (await document.l10n.formatValue(&quot;key-expired&quot;, { key })) + &quot;\n&quot;;</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineplus">+            errorMsg += EnigmailLocale.getString(&quot;keyExpired&quot;, [key]) + &quot;\n&quot;;</span>
<a href="#l10.222"></a><span id="l10.222">           }</span>
<a href="#l10.223"></a><span id="l10.223">         }</span>
<a href="#l10.224"></a><span id="l10.224">       }</span>
<a href="#l10.225"></a><span id="l10.225">       if (errorMsg !== &quot;&quot;) {</span>
<a href="#l10.226"></a><span id="l10.226">         txt = errorMsg + &quot;\n&quot; + txt;</span>
<a href="#l10.227"></a><span id="l10.227">       }</span>
<a href="#l10.228"></a><span id="l10.228">       EnigmailDialog.info(</span>
<a href="#l10.229"></a><span id="l10.229">         window,</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineminus">-        (await document.l10n.formatValue(&quot;send-aborted&quot;)) + txt</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+        EnigmailLocale.getString(&quot;sendAborted&quot;) + txt</span>
<a href="#l10.232"></a><span id="l10.232">       );</span>
<a href="#l10.233"></a><span id="l10.233">     } else {</span>
<a href="#l10.234"></a><span id="l10.234">       EnigmailDialog.info(</span>
<a href="#l10.235"></a><span id="l10.235">         window,</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineminus">-        (await document.l10n.formatValue(&quot;send-aborted&quot;)) +</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+        EnigmailLocale.getString(&quot;sendAborted&quot;) +</span>
<a href="#l10.238"></a><span id="l10.238">           &quot;\n&quot; +</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineminus">-          (await document.l10n.formatValue(&quot;msg-compose-internal-error&quot;))</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+          EnigmailLocale.getString(&quot;msgCompose.internalError&quot;)</span>
<a href="#l10.241"></a><span id="l10.241">       );</span>
<a href="#l10.242"></a><span id="l10.242">     }</span>
<a href="#l10.243"></a><span id="l10.243">   },</span>
<a href="#l10.244"></a><span id="l10.244"> </span>
<a href="#l10.245"></a><span id="l10.245">   getMailPref(prefName) {</span>
<a href="#l10.246"></a><span id="l10.246">     let prefRoot = EnigmailPrefs.getPrefRoot();</span>
<a href="#l10.247"></a><span id="l10.247"> </span>
<a href="#l10.248"></a><span id="l10.248">     var prefValue = null;</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineat">@@ -3324,17 +3308,17 @@ Enigmail.msg = {</span>
<a href="#l10.250"></a><span id="l10.250">    * Display a notification to the user at the bottom of the window</span>
<a href="#l10.251"></a><span id="l10.251">    *</span>
<a href="#l10.252"></a><span id="l10.252">    * @param priority: Number    - Priority of the message [1 = high (error) ... 3 = low (info)]</span>
<a href="#l10.253"></a><span id="l10.253">    * @param msgText: String     - Text to be displayed in notification bar</span>
<a href="#l10.254"></a><span id="l10.254">    * @param messageId: String   - Unique message type identification</span>
<a href="#l10.255"></a><span id="l10.255">    * @param detailsText: String - optional text to be displayed by clicking on &quot;Details&quot; button.</span>
<a href="#l10.256"></a><span id="l10.256">    *                              if null or &quot;&quot;, then the Detail button will no be displayed.</span>
<a href="#l10.257"></a><span id="l10.257">    */</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineminus">-  async notifyUser(priority, msgText, messageId, detailsText) {</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineplus">+  notifyUser(priority, msgText, messageId, detailsText) {</span>
<a href="#l10.260"></a><span id="l10.260">     let notif = document.getElementById(&quot;attachmentNotificationBox&quot;);</span>
<a href="#l10.261"></a><span id="l10.261">     if (!notif) {</span>
<a href="#l10.262"></a><span id="l10.262">       notif = gNotification.notificationbox;</span>
<a href="#l10.263"></a><span id="l10.263">     }</span>
<a href="#l10.264"></a><span id="l10.264">     let prio;</span>
<a href="#l10.265"></a><span id="l10.265"> </span>
<a href="#l10.266"></a><span id="l10.266">     switch (priority) {</span>
<a href="#l10.267"></a><span id="l10.267">       case 1:</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineat">@@ -3346,42 +3330,40 @@ Enigmail.msg = {</span>
<a href="#l10.269"></a><span id="l10.269">       default:</span>
<a href="#l10.270"></a><span id="l10.270">         prio = notif.PRIORITY_WARNING_MEDIUM;</span>
<a href="#l10.271"></a><span id="l10.271">     }</span>
<a href="#l10.272"></a><span id="l10.272"> </span>
<a href="#l10.273"></a><span id="l10.273">     let buttonArr = [];</span>
<a href="#l10.274"></a><span id="l10.274"> </span>
<a href="#l10.275"></a><span id="l10.275">     if (detailsText &amp;&amp; detailsText.length &gt; 0) {</span>
<a href="#l10.276"></a><span id="l10.276">       buttonArr.push({</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineminus">-        accessKey: await document.l10n.formatValue(</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineminus">-          &quot;msg-compose-details-button-access-key&quot;</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineplus">+        accessKey: EnigmailLocale.getString(</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineplus">+          &quot;msgCompose.detailsButton.accessKey&quot;</span>
<a href="#l10.281"></a><span id="l10.281">         ),</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineminus">-        label: await document.l10n.formatValue(</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineminus">-          &quot;msg-compose-details-button-label&quot;</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineminus">-        ),</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineplus">+        label: EnigmailLocale.getString(&quot;msgCompose.detailsButton.label&quot;),</span>
<a href="#l10.286"></a><span id="l10.286">         callback(aNotificationBar, aButton) {</span>
<a href="#l10.287"></a><span id="l10.287">           EnigmailDialog.info(window, detailsText);</span>
<a href="#l10.288"></a><span id="l10.288">         },</span>
<a href="#l10.289"></a><span id="l10.289">       });</span>
<a href="#l10.290"></a><span id="l10.290">     }</span>
<a href="#l10.291"></a><span id="l10.291">     notif.appendNotification(msgText, messageId, null, prio, buttonArr);</span>
<a href="#l10.292"></a><span id="l10.292">   },</span>
<a href="#l10.293"></a><span id="l10.293"> </span>
<a href="#l10.294"></a><span id="l10.294">   /**</span>
<a href="#l10.295"></a><span id="l10.295">    * Display a warning message if we are replying to or forwarding</span>
<a href="#l10.296"></a><span id="l10.296">    * a partially decrypted inline-PGP email</span>
<a href="#l10.297"></a><span id="l10.297">    */</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineminus">-  async displayPartialEncryptedWarning() {</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineminus">-    let msgLong = await document.l10n.formatValue(</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineminus">-      &quot;msg-compose-partially-encrypted-inlinePGP&quot;</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineplus">+  displayPartialEncryptedWarning() {</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineplus">+    let msgLong = EnigmailLocale.getString(</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineplus">+      &quot;msgCompose.partiallyEncrypted.inlinePGP&quot;</span>
<a href="#l10.304"></a><span id="l10.304">     );</span>
<a href="#l10.305"></a><span id="l10.305"> </span>
<a href="#l10.306"></a><span id="l10.306">     this.notifyUser(</span>
<a href="#l10.307"></a><span id="l10.307">       1,</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineminus">-      await document.l10n.formatValue(&quot;msg-compose-partially-encrypted-short&quot;),</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineplus">+      EnigmailLocale.getString(&quot;msgCompose.partiallyEncrypted.short&quot;),</span>
<a href="#l10.310"></a><span id="l10.310">       &quot;notifyPartialDecrypt&quot;,</span>
<a href="#l10.311"></a><span id="l10.311">       msgLong</span>
<a href="#l10.312"></a><span id="l10.312">     );</span>
<a href="#l10.313"></a><span id="l10.313">   },</span>
<a href="#l10.314"></a><span id="l10.314"> </span>
<a href="#l10.315"></a><span id="l10.315">   editorSelectAll() {</span>
<a href="#l10.316"></a><span id="l10.316">     if (this.editor) {</span>
<a href="#l10.317"></a><span id="l10.317">       this.editor.selectAll();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailMsgHdrViewOverlay.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -514,17 +514,17 @@ Enigmail.hdrView = {</span>
<a href="#l11.4"></a><span id="l11.4">         if (k) {</span>
<a href="#l11.5"></a><span id="l11.5">           gDBView.reloadMessageWithAllParts();</span>
<a href="#l11.6"></a><span id="l11.6">         }</span>
<a href="#l11.7"></a><span id="l11.7">       }</span>
<a href="#l11.8"></a><span id="l11.8">     });</span>
<a href="#l11.9"></a><span id="l11.9">   },</span>
<a href="#l11.10"></a><span id="l11.10">   */</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  async displayStatusBar() {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  displayStatusBar() {</span>
<a href="#l11.14"></a><span id="l11.14">     let secInfo = Enigmail.msg.securityInfo;</span>
<a href="#l11.15"></a><span id="l11.15">     let statusFlags = secInfo.statusFlags;</span>
<a href="#l11.16"></a><span id="l11.16">     let extStatusFlags =</span>
<a href="#l11.17"></a><span id="l11.17">       &quot;extStatusFlags&quot; in secInfo ? secInfo.extStatusFlags : 0;</span>
<a href="#l11.18"></a><span id="l11.18">     let cryptoContainer, encryptedUINode, signedUINode;</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">     cryptoContainer = gCryptoContainer;</span>
<a href="#l11.21"></a><span id="l11.21">     signedUINode = gSignedUINode;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -547,19 +547,17 @@ Enigmail.hdrView = {</span>
<a href="#l11.23"></a><span id="l11.23">         this.msgEncryptionState = EnigmailConstants.MSG_ENC_FAILURE;</span>
<a href="#l11.24"></a><span id="l11.24">       }</span>
<a href="#l11.25"></a><span id="l11.25">       this.msgSignatureState = EnigmailConstants.MSG_SIG_NONE;</span>
<a href="#l11.26"></a><span id="l11.26">     } else if (statusFlags &amp; EnigmailConstants.DECRYPTION_OKAY) {</span>
<a href="#l11.27"></a><span id="l11.27">       EnigmailURIs.rememberEncryptedUri(this.lastEncryptedMsgKey);</span>
<a href="#l11.28"></a><span id="l11.28">       encryptedUINode.setAttribute(&quot;encrypted&quot;, &quot;ok&quot;);</span>
<a href="#l11.29"></a><span id="l11.29">       this.msgEncryptionState = EnigmailConstants.MSG_ENC_OK;</span>
<a href="#l11.30"></a><span id="l11.30">       if (secInfo.xtraStatus &amp;&amp; secInfo.xtraStatus == &quot;buggyMailFormat&quot;) {</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-        console.log(</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-          await document.l10n.formatValue(&quot;decrypted-msg-with-format-error&quot;)</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-        );</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+        console.log(EnigmailLocale.getString(&quot;decryptedMsgWithFormatError&quot;));</span>
<a href="#l11.35"></a><span id="l11.35">       }</span>
<a href="#l11.36"></a><span id="l11.36">     }</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38">     if (</span>
<a href="#l11.39"></a><span id="l11.39">       statusFlags &amp;</span>
<a href="#l11.40"></a><span id="l11.40">       (EnigmailConstants.BAD_SIGNATURE |</span>
<a href="#l11.41"></a><span id="l11.41">         EnigmailConstants.REVOKED_KEY |</span>
<a href="#l11.42"></a><span id="l11.42">         EnigmailConstants.EXPIRED_KEY_SIGNATURE |</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

