<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20050:fd02e757b1420b415cd3df380922d350c3dbefb6</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ fd02e757b1420b415cd3df380922d350c3dbefb6" />
<meta property="og:url" content="/comm-central/rev/fd02e757b1420b415cd3df380922d350c3dbefb6" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable no-shadow and no-redeclare rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / fd02e757b1420b415cd3df380922d350c3dbefb6 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/fd02e757b1420b415cd3df380922d350c3dbefb6">shortlog</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/fd02e757b1420b415cd3df380922d350c3dbefb6">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6">files</a> |
changeset |
<a href="/comm-central/raw-rev/fd02e757b1420b415cd3df380922d350c3dbefb6">raw</a>  | <a href="/comm-central/archive/fd02e757b1420b415cd3df380922d350c3dbefb6.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-shadow and no-redeclare rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 11:19:28 +0200</td></tr>

<tr>
 <td>changeset 20050</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/fd02e757b1420b415cd3df380922d350c3dbefb6">fd02e757b1420b415cd3df380922d350c3dbefb6</a></td>
</tr>



<tr>
<td>parent 20049</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/305102c9beddb775c8841d10118d73e0adc5e3a3">305102c9beddb775c8841d10118d73e0adc5e3a3</a>
</td>
</tr>

<tr>
<td>child 20051</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7063147fed66249f88739ba93466bd58a7ff032f">7063147fed66249f88739ba93466bd58a7ff032f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=fd02e757b1420b415cd3df380922d350c3dbefb6">12298</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Fri, 16 Sep 2016 20:23:58 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@fd02e757b142 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fd02e757b1420b415cd3df380922d350c3dbefb6">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fd02e757b1420b415cd3df380922d350c3dbefb6&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fd02e757b1420b415cd3df380922d350c3dbefb6&newProject=comm-central&newRevision=626c889fd0927fd07df3bfe982a09c19ea7a8e7e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fd02e757b1420b415cd3df380922d350c3dbefb6&newProject=comm-central&newRevision=626c889fd0927fd07df3bfe982a09c19ea7a8e7e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fd02e757b1420b415cd3df380922d350c3dbefb6&newProject=comm-central&newRevision=626c889fd0927fd07df3bfe982a09c19ea7a8e7e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-shadow and no-redeclare rule. r=MakeMyDay

MozReview-Commit-ID: AupckwvAGYZ</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calDateTime.js">calendar/base/backend/icaljs/calDateTime.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calDateTime.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calDateTime.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calDateTime.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calDateTime.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calDateTime.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calICSService.js">calendar/base/backend/icaljs/calICSService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calICSService.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calICSService.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calICSService.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calICSService.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calICSService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calPeriod.js">calendar/base/backend/icaljs/calPeriod.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calPeriod.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calPeriod.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calPeriod.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calPeriod.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calPeriod.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calRecurrenceRule.js">calendar/base/backend/icaljs/calRecurrenceRule.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calRecurrenceRule.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calRecurrenceRule.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calRecurrenceRule.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calRecurrenceRule.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/backend/icaljs/calRecurrenceRule.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">calendar/base/content/dialogs/calendar-subscriptions-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-summary-dialog.js">calendar/base/content/dialogs/calendar-summary-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-summary-dialog.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-summary-dialog.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-summary-dialog.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-summary-dialog.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/dialogs/calendar-summary-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/import-export.js">calendar/base/content/import-export.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/import-export.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/import-export.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/import-export.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/import-export.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/content/import-export.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calExtract.jsm">calendar/base/modules/calExtract.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calExtract.jsm">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calExtract.jsm">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calExtract.jsm">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calExtract.jsm">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calExtract.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calRecurrenceUtils.jsm">calendar/base/modules/calRecurrenceUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calRecurrenceUtils.jsm">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calRecurrenceUtils.jsm">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calRecurrenceUtils.jsm">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calRecurrenceUtils.jsm">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/modules/calRecurrenceUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/imip-bar.js">calendar/lightning/content/imip-bar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/imip-bar.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/imip-bar.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/imip-bar.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/imip-bar.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/imip-bar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrence/testDailyRecurrence.js">calendar/test/mozmill/recurrence/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrence/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrence/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrence/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrence/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrence/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_attendee.js">calendar/test/unit/test_attendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_attendee.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_attendee.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_attendee.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_attendee.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_attendee.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_bug759324.js">calendar/test/unit/test_bug759324.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_bug759324.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_bug759324.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_bug759324.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_bug759324.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_bug759324.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_ics_parser.js">calendar/test/unit/test_ics_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_ics_parser.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_ics_parser.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_ics_parser.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_ics_parser.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_ics_parser.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_recur.js">calendar/test/unit/test_recur.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_recur.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_recur.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_recur.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_recur.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_recur.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_storage.js">calendar/test/unit/test_storage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_storage.js">file</a> |
<a href="/comm-central/annotate/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_storage.js">annotate</a> |
<a href="/comm-central/diff/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_storage.js">diff</a> |
<a href="/comm-central/comparison/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_storage.js">comparison</a> |
<a href="/comm-central/log/fd02e757b1420b415cd3df380922d350c3dbefb6/calendar/test/unit/test_storage.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -185,21 +185,30 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">     // Disallow empty statements. This will report an error for:</span>
<a href="#l1.6"></a><span id="l1.6">     // try { something(); } catch (e) {}</span>
<a href="#l1.7"></a><span id="l1.7">     // but will not report it for:</span>
<a href="#l1.8"></a><span id="l1.8">     // try { something(); } catch (e) { /* Silencing the error because ...*/ }</span>
<a href="#l1.9"></a><span id="l1.9">     // which is a valid use case.</span>
<a href="#l1.10"></a><span id="l1.10">     &quot;no-empty&quot;: 2,</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Disallow declaring the same variable more than once (we use let anyway).</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;no-redeclare&quot;: 2,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    // Warn about declaration of variables already declared in the outer scope.</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+    // This isn't an error because it sometimes is useful to use the same name</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    // in a small helper function rather than having to come up with another</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+    // random name.  Still, making this a warning can help people avoid being</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+    // confused.</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+    &quot;no-shadow&quot;: 2,</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+</span>
<a href="#l1.22"></a><span id="l1.22">     // Will enable these rules later</span>
<a href="#l1.23"></a><span id="l1.23">     &quot;block-spacing&quot;: 0,</span>
<a href="#l1.24"></a><span id="l1.24">     &quot;no-lonely-if&quot;: 0,</span>
<a href="#l1.25"></a><span id="l1.25">     &quot;space-before-blocks&quot;: 0,</span>
<a href="#l1.26"></a><span id="l1.26">     &quot;computed-property-spacing&quot;: 0,</span>
<a href="#l1.27"></a><span id="l1.27">     &quot;consistent-return&quot;: 0,</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-    &quot;no-redeclare&quot;: 0,</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.31"></a><span id="l1.31">     // easier updates in the future.</span>
<a href="#l1.32"></a><span id="l1.32">     &quot;no-else-return&quot;: 0,</span>
<a href="#l1.33"></a><span id="l1.33">   }</span>
<a href="#l1.34"></a><span id="l1.34"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calDateTime.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calDateTime.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -49,18 +49,18 @@ calDateTime.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">     get minute() { return this.innerObject.minute; },</span>
<a href="#l2.6"></a><span id="l2.6">     set minute(val) { this.innerObject.minute = val; },</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8">     get second() { return this.innerObject.second; },</span>
<a href="#l2.9"></a><span id="l2.9">     set second(val) { this.innerObject.second = val; },</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     get timezone() { return new calICALJSTimezone(this.innerObject.zone); },</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    set timezone(val) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-        unwrapSetter(ICAL.Timezone, val, function(val) {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    set timezone(rawval) {</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+        unwrapSetter(ICAL.Timezone, rawval, function(val) {</span>
<a href="#l2.16"></a><span id="l2.16">             this.innerObject.zone = val;</span>
<a href="#l2.17"></a><span id="l2.17">             return val;</span>
<a href="#l2.18"></a><span id="l2.18">         }, this);</span>
<a href="#l2.19"></a><span id="l2.19">     },</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">     resetTo: function(yr, mo, dy, hr, mi, sc, tz) {</span>
<a href="#l2.22"></a><span id="l2.22">         this.innerObject.fromData({</span>
<a href="#l2.23"></a><span id="l2.23">             year: yr, month: mo + 1, day: dy,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calICSService.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calICSService.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -74,18 +74,18 @@ calIcalProperty.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">     },</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">     get valueAsDatetime() {</span>
<a href="#l3.7"></a><span id="l3.7">         let val = this.innerObject.getFirstValue();</span>
<a href="#l3.8"></a><span id="l3.8">         let isIcalTime = val &amp;&amp; (typeof val == &quot;object&quot;) &amp;&amp;</span>
<a href="#l3.9"></a><span id="l3.9">                          (&quot;icalclass&quot; in val) &amp;&amp; val.icalclass == &quot;icaltime&quot;;</span>
<a href="#l3.10"></a><span id="l3.10">         return (isIcalTime ? new calDateTime(val) : null);</span>
<a href="#l3.11"></a><span id="l3.11">     },</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    set valueAsDatetime(val) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-        unwrapSetter(ICAL.Time, val, function(val) {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    set valueAsDatetime(rawval) {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+        unwrapSetter(ICAL.Time, rawval, function(val) {</span>
<a href="#l3.16"></a><span id="l3.16">             if (val &amp;&amp; val.zone &amp;&amp;</span>
<a href="#l3.17"></a><span id="l3.17">                 val.zone != ICAL.Timezone.utcTimezone &amp;&amp;</span>
<a href="#l3.18"></a><span id="l3.18">                 val.zone != ICAL.Timezone.localTimezone) {</span>
<a href="#l3.19"></a><span id="l3.19">                 this.innerObject.setParameter(&quot;TZID&quot;, val.zone.tzid);</span>
<a href="#l3.20"></a><span id="l3.20">                 if (this.parent) {</span>
<a href="#l3.21"></a><span id="l3.21">                     let tzref = wrapGetter(calICALJSTimezone, val.zone);</span>
<a href="#l3.22"></a><span id="l3.22">                     this.parent.addTimezoneReference(tzref);</span>
<a href="#l3.23"></a><span id="l3.23">                 }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calPeriod.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calPeriod.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -27,25 +27,25 @@ calPeriod.prototype = {</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">     get icalPeriod() { return this.innerObject; },</span>
<a href="#l4.6"></a><span id="l4.6">     set icalPeriod(val) { this.innerObject = val; },</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">     makeImmutable: function() { this.isMutable = false; },</span>
<a href="#l4.9"></a><span id="l4.9">     clone: function() { return new calPeriod(this.innerObject.clone()); },</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">     get start() { return wrapGetter(calDateTime, this.innerObject.start); },</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    set start(val) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-        unwrapSetter(ICAL.Time, val, function(val) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+    set start(rawval) {</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+        unwrapSetter(ICAL.Time, rawval, function(val) {</span>
<a href="#l4.16"></a><span id="l4.16">             this.innerObject.start = val;</span>
<a href="#l4.17"></a><span id="l4.17">         }, this);</span>
<a href="#l4.18"></a><span id="l4.18">     },</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">     get end() { return wrapGetter(calDateTime, this.innerObject.getEnd()); },</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-    set end(val) {</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-        unwrapSetter(ICAL.Time, val, function(val) {</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+    set end(rawval) {</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+        unwrapSetter(ICAL.Time, rawval, function(val) {</span>
<a href="#l4.25"></a><span id="l4.25">             if (this.innerObject.duration) {</span>
<a href="#l4.26"></a><span id="l4.26">                 this.innerObject.duration = null;</span>
<a href="#l4.27"></a><span id="l4.27">             }</span>
<a href="#l4.28"></a><span id="l4.28">             this.innerObject.end = val;</span>
<a href="#l4.29"></a><span id="l4.29">         }, this);</span>
<a href="#l4.30"></a><span id="l4.30">     },</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">     get duration() { return wrapGetter(calDuration, this.innerObject.getDuration()); },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calRecurrenceRule.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calRecurrenceRule.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -98,18 +98,18 @@ calRecurrenceRule.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">     get icalString() { return &quot;RRULE:&quot; + this.innerObject.toString() + ICAL.newLineChar; },</span>
<a href="#l5.5"></a><span id="l5.5">     set icalString(val) { this.innerObject = ICAL.Recur.fromString(val.replace(/^RRULE:/i, &quot;&quot;)); },</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7">     get icalProperty() {</span>
<a href="#l5.8"></a><span id="l5.8">         let prop = new ICAL.Property(&quot;rrule&quot;);</span>
<a href="#l5.9"></a><span id="l5.9">         prop.setValue(this.innerObject);</span>
<a href="#l5.10"></a><span id="l5.10">         return new calIcalProperty(prop);</span>
<a href="#l5.11"></a><span id="l5.11">     },</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    set icalProperty(val) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-        unwrapSetter(ICAL.Property, val, function(val) {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+    set icalProperty(rawval) {</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+        unwrapSetter(ICAL.Property, rawval, function(val) {</span>
<a href="#l5.16"></a><span id="l5.16">             this.innerObject = val.getFirstValue();</span>
<a href="#l5.17"></a><span id="l5.17">         }, this);</span>
<a href="#l5.18"></a><span id="l5.18">     },</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">     get type() { return this.innerObject.freq; },</span>
<a href="#l5.21"></a><span id="l5.21">     set type(val) { this.innerObject.freq = val; },</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23">     get interval() { return this.innerObject.interval; },</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineat">@@ -125,18 +125,18 @@ calRecurrenceRule.prototype = {</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">     get untilDate() {</span>
<a href="#l5.27"></a><span id="l5.27">         if (this.innerObject.until) {</span>
<a href="#l5.28"></a><span id="l5.28">             return new calDateTime(this.innerObject.until);</span>
<a href="#l5.29"></a><span id="l5.29">         } else {</span>
<a href="#l5.30"></a><span id="l5.30">             return null;</span>
<a href="#l5.31"></a><span id="l5.31">         }</span>
<a href="#l5.32"></a><span id="l5.32">     },</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-    set untilDate(val) {</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-        unwrapSetter(ICAL.Time, val, function(val) {</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    set untilDate(rawval) {</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+        unwrapSetter(ICAL.Time, rawval, function(val) {</span>
<a href="#l5.37"></a><span id="l5.37">             if (val.timezone != ICAL.Timezone.utcTimezone &amp;&amp;</span>
<a href="#l5.38"></a><span id="l5.38">                 val.timezone != ICAL.Timezone.localTimezone) {</span>
<a href="#l5.39"></a><span id="l5.39">                 val = val.convertToZone(ICAL.Timezone.utcTimezone);</span>
<a href="#l5.40"></a><span id="l5.40">             }</span>
<a href="#l5.41"></a><span id="l5.41"> </span>
<a href="#l5.42"></a><span id="l5.42">             this.innerObject.until = val;</span>
<a href="#l5.43"></a><span id="l5.43">         }, this);</span>
<a href="#l5.44"></a><span id="l5.44">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -625,27 +625,27 @@ function refreshCalendarQuery(aStart, aE</span>
<a href="#l6.4"></a><span id="l6.4">     let refreshJob = {</span>
<a href="#l6.5"></a><span id="l6.5">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l6.6"></a><span id="l6.6">         agendaListbox: this,</span>
<a href="#l6.7"></a><span id="l6.7">         calendar: null,</span>
<a href="#l6.8"></a><span id="l6.8">         calId: null,</span>
<a href="#l6.9"></a><span id="l6.9">         operation: null,</span>
<a href="#l6.10"></a><span id="l6.10">         cancelled: false,</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        onOperationComplete: function(aOpCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l6.14"></a><span id="l6.14">             if (this.agendaListbox.mPendingRefreshJobs.has(this.calId)) {</span>
<a href="#l6.15"></a><span id="l6.15">                 this.agendaListbox.mPendingRefreshJobs.delete(this.calId);</span>
<a href="#l6.16"></a><span id="l6.16">             }</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">             if (!this.cancelled) {</span>
<a href="#l6.19"></a><span id="l6.19">                 setCurrentEvent();</span>
<a href="#l6.20"></a><span id="l6.20">             }</span>
<a href="#l6.21"></a><span id="l6.21">         },</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-        onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+        onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l6.25"></a><span id="l6.25">             if (this.cancelled || !Components.isSuccessCode(aStatus)) {</span>
<a href="#l6.26"></a><span id="l6.26">                 return;</span>
<a href="#l6.27"></a><span id="l6.27">             }</span>
<a href="#l6.28"></a><span id="l6.28">             for (let item of aItems) {</span>
<a href="#l6.29"></a><span id="l6.29">                 this.agendaListbox.addItem(item);</span>
<a href="#l6.30"></a><span id="l6.30">             }</span>
<a href="#l6.31"></a><span id="l6.31">         },</span>
<a href="#l6.32"></a><span id="l6.32"> </span>
<a href="#l6.33"></a><span id="l6.33" class="difflineat">@@ -653,17 +653,17 @@ function refreshCalendarQuery(aStart, aE</span>
<a href="#l6.34"></a><span id="l6.34">             this.cancelled = true;</span>
<a href="#l6.35"></a><span id="l6.35">             let op = cal.wrapInstance(this.operation, Components.interfaces.calIOperation);</span>
<a href="#l6.36"></a><span id="l6.36">             if (op &amp;&amp; op.isPending) {</span>
<a href="#l6.37"></a><span id="l6.37">                 op.cancel();</span>
<a href="#l6.38"></a><span id="l6.38">                 this.operation = null;</span>
<a href="#l6.39"></a><span id="l6.39">             }</span>
<a href="#l6.40"></a><span id="l6.40">         },</span>
<a href="#l6.41"></a><span id="l6.41"> </span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-        execute: function(aStart, aEnd, aCalendar) {</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+        execute: function() {</span>
<a href="#l6.44"></a><span id="l6.44">             if (!(aStart || aEnd || aCalendar)) {</span>
<a href="#l6.45"></a><span id="l6.45">                 this.agendaListbox.removeListItems();</span>
<a href="#l6.46"></a><span id="l6.46">             }</span>
<a href="#l6.47"></a><span id="l6.47"> </span>
<a href="#l6.48"></a><span id="l6.48">             if (!aCalendar) {</span>
<a href="#l6.49"></a><span id="l6.49">                 aCalendar = this.agendaListbox.calendar;</span>
<a href="#l6.50"></a><span id="l6.50">             }</span>
<a href="#l6.51"></a><span id="l6.51">             if (!aStart) {</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineat">@@ -699,17 +699,17 @@ function refreshCalendarQuery(aStart, aE</span>
<a href="#l6.53"></a><span id="l6.53">             op = cal.wrapInstance(op, Components.interfaces.calIOperation);</span>
<a href="#l6.54"></a><span id="l6.54">             if (op &amp;&amp; op.isPending) {</span>
<a href="#l6.55"></a><span id="l6.55">                 this.operation = op;</span>
<a href="#l6.56"></a><span id="l6.56">                 this.agendaListbox.mPendingRefreshJobs.set(this.calId, this);</span>
<a href="#l6.57"></a><span id="l6.57">             }</span>
<a href="#l6.58"></a><span id="l6.58">         }</span>
<a href="#l6.59"></a><span id="l6.59">     };</span>
<a href="#l6.60"></a><span id="l6.60"> </span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-    refreshJob.execute(aStart, aEnd, aCalendar);</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+    refreshJob.execute();</span>
<a href="#l6.63"></a><span id="l6.63"> };</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65"> /**</span>
<a href="#l6.66"></a><span id="l6.66">  * Sets up the calendar for the agenda listbox.</span>
<a href="#l6.67"></a><span id="l6.67">  */</span>
<a href="#l6.68"></a><span id="l6.68"> agendaListbox.setupCalendar =</span>
<a href="#l6.69"></a><span id="l6.69"> function setupCalendar() {</span>
<a href="#l6.70"></a><span id="l6.70">     this.init();</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineat">@@ -832,23 +832,23 @@ function getSelectedItems() {</span>
<a href="#l6.72"></a><span id="l6.72">  * Checks if the passed node in the listbox is an Event item (not a</span>
<a href="#l6.73"></a><span id="l6.73">  * period item).</span>
<a href="#l6.74"></a><span id="l6.74">  *</span>
<a href="#l6.75"></a><span id="l6.75">  * @param aListItem     The node to check for.</span>
<a href="#l6.76"></a><span id="l6.76">  * @return              True, if the node is not a period item.</span>
<a href="#l6.77"></a><span id="l6.77">  */</span>
<a href="#l6.78"></a><span id="l6.78"> agendaListbox.isEventListItem =</span>
<a href="#l6.79"></a><span id="l6.79"> function isEventListItem(aListItem) {</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-    var isEventListItem = (aListItem != null);</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-    if (isEventListItem) {</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+    var isListItem = (aListItem != null);</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+    if (isListItem) {</span>
<a href="#l6.84"></a><span id="l6.84">         var localName = aListItem.localName;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-        isEventListItem = (localName == &quot;agenda-richlist-item&quot; ||</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-                           localName == &quot;agenda-allday-richlist-item&quot;);</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+        isListItem = (localName == &quot;agenda-richlist-item&quot; ||</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+                      localName == &quot;agenda-allday-richlist-item&quot;);</span>
<a href="#l6.89"></a><span id="l6.89">     }</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-    return isEventListItem;</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+    return isListItem;</span>
<a href="#l6.92"></a><span id="l6.92"> };</span>
<a href="#l6.93"></a><span id="l6.93"> </span>
<a href="#l6.94"></a><span id="l6.94"> /**</span>
<a href="#l6.95"></a><span id="l6.95">  * Removes all Event items, keeping the period items intact.</span>
<a href="#l6.96"></a><span id="l6.96">  */</span>
<a href="#l6.97"></a><span id="l6.97"> agendaListbox.removeListItems =</span>
<a href="#l6.98"></a><span id="l6.98"> function removeListItems() {</span>
<a href="#l6.99"></a><span id="l6.99">     var listItem = this.agendaListboxControl.lastChild;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -456,29 +456,29 @@</span>
<a href="#l7.4"></a><span id="l7.4">           let refreshJob = {</span>
<a href="#l7.5"></a><span id="l7.5">               QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l7.6"></a><span id="l7.6">               calView: this,</span>
<a href="#l7.7"></a><span id="l7.7">               calendar: null,</span>
<a href="#l7.8"></a><span id="l7.8">               calId: null,</span>
<a href="#l7.9"></a><span id="l7.9">               operation: null,</span>
<a href="#l7.10"></a><span id="l7.10">               cancelled: false,</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-              onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+              onOperationComplete: function(aOpCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l7.14"></a><span id="l7.14">                   this.calView.mLog.info(&quot;Refresh complete of calendar &quot; + this.calId);</span>
<a href="#l7.15"></a><span id="l7.15">                   if (this.calView.mPendingRefreshJobs.has(this.calId)) {</span>
<a href="#l7.16"></a><span id="l7.16">                       this.calView.mPendingRefreshJobs.delete(this.calId);</span>
<a href="#l7.17"></a><span id="l7.17">                   }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">                   if (!this.cancelled) {</span>
<a href="#l7.20"></a><span id="l7.20">                       // Fire event</span>
<a href="#l7.21"></a><span id="l7.21">                       this.calView.fireEvent('viewloaded', aOperationType);</span>
<a href="#l7.22"></a><span id="l7.22">                   }</span>
<a href="#l7.23"></a><span id="l7.23">               },</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-              onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+              onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l7.27"></a><span id="l7.27">                   if (this.cancelled || !Components.isSuccessCode(aStatus)) {</span>
<a href="#l7.28"></a><span id="l7.28">                       return;</span>
<a href="#l7.29"></a><span id="l7.29">                   }</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">                   for (let item of aItems) {</span>
<a href="#l7.32"></a><span id="l7.32">                       if (!cal.isToDo(item) || item.entryDate || item.dueDate) {</span>
<a href="#l7.33"></a><span id="l7.33">                           this.calView.doAddItem(item);</span>
<a href="#l7.34"></a><span id="l7.34">                       }</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineat">@@ -490,17 +490,17 @@</span>
<a href="#l7.36"></a><span id="l7.36">                   this.cancelled = true;</span>
<a href="#l7.37"></a><span id="l7.37">                   let op = cal.wrapInstance(this.operation, Components.interfaces.calIOperation);</span>
<a href="#l7.38"></a><span id="l7.38">                   if (op &amp;&amp; op.isPending) {</span>
<a href="#l7.39"></a><span id="l7.39">                       op.cancel();</span>
<a href="#l7.40"></a><span id="l7.40">                       this.operation = null;</span>
<a href="#l7.41"></a><span id="l7.41">                   }</span>
<a href="#l7.42"></a><span id="l7.42">               },</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-              execute: function(aCalendar) {</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+              execute: function() {</span>
<a href="#l7.46"></a><span id="l7.46">                   if (!this.calView.startDate || !this.calView.endDate || !aCalendar) {</span>
<a href="#l7.47"></a><span id="l7.47">                       return;</span>
<a href="#l7.48"></a><span id="l7.48">                   }</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50">                   if (aCalendar.type == &quot;composite&quot;) {</span>
<a href="#l7.51"></a><span id="l7.51">                       // we're refreshing from the composite calendar, so we can cancel</span>
<a href="#l7.52"></a><span id="l7.52">                       // all other pending refresh jobs.</span>
<a href="#l7.53"></a><span id="l7.53">                       this.calView.mLog.info(&quot;Refreshing composite calendar, cancelling all pending refreshes&quot;);</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineat">@@ -543,17 +543,17 @@</span>
<a href="#l7.55"></a><span id="l7.55">                   op = cal.wrapInstance(op, Components.interfaces.calIOperation);</span>
<a href="#l7.56"></a><span id="l7.56">                   if (op &amp;&amp; op.isPending) {</span>
<a href="#l7.57"></a><span id="l7.57">                       this.operation = op;</span>
<a href="#l7.58"></a><span id="l7.58">                       this.calView.mPendingRefreshJobs.set(this.calId, this);</span>
<a href="#l7.59"></a><span id="l7.59">                   }</span>
<a href="#l7.60"></a><span id="l7.60">               }</span>
<a href="#l7.61"></a><span id="l7.61">           };</span>
<a href="#l7.62"></a><span id="l7.62"> </span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-          refreshJob.execute(aCalendar);</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+          refreshJob.execute();</span>
<a href="#l7.65"></a><span id="l7.65">         ]]&gt;&lt;/body&gt;</span>
<a href="#l7.66"></a><span id="l7.66">       &lt;/method&gt;</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68">       &lt;method name=&quot;deleteItemsFromCalendar&quot;&gt;</span>
<a href="#l7.69"></a><span id="l7.69">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l7.70"></a><span id="l7.70">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l7.71"></a><span id="l7.71">             /* This method must be implemented in subclasses. */</span>
<a href="#l7.72"></a><span id="l7.72">             throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -33,34 +33,30 @@ var calendarExtract = {</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">             langs.push([label, localeParts[1]]);</span>
<a href="#l8.6"></a><span id="l8.6">         }</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">         // sort</span>
<a href="#l8.9"></a><span id="l8.9">         let pref = &quot;calendar.patterns.last.used.languages&quot;;</span>
<a href="#l8.10"></a><span id="l8.10">         let lastUsedLangs = Preferences.get(pref, &quot;&quot;);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        function createLanguageComptor(lastUsedLangs) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-            return function compare(a, b) {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-                let idx_a = lastUsedLangs.indexOf(a[1]);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-                let idx_b = lastUsedLangs.indexOf(b[1]);</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+        langs.sort((a, b) =&gt; {</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+            let idx_a = lastUsedLangs.indexOf(a[1]);</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+            let idx_b = lastUsedLangs.indexOf(b[1]);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-                if (idx_a == -1 &amp;&amp; idx_b == -1) {</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-                    return a[0].localeCompare(b[0]);</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-                } else if (idx_a != -1 &amp;&amp; idx_b != -1) {</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-                    return idx_a - idx_b;</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineminus">-                } else if (idx_a != -1) {</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-                    return -1;</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineminus">-                } else {</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-                    return 1;</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineminus">-                }</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-            };</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-        }</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-        langs.sort(createLanguageComptor(lastUsedLangs));</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+            if (idx_a == -1 &amp;&amp; idx_b == -1) {</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+                return a[0].localeCompare(b[0]);</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+            } else if (idx_a != -1 &amp;&amp; idx_b != -1) {</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+                return idx_a - idx_b;</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+            } else if (idx_a != -1) {</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+                return -1;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+            } else {</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+                return 1;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+            }</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+        });</span>
<a href="#l8.43"></a><span id="l8.43">         removeChildren(localeList);</span>
<a href="#l8.44"></a><span id="l8.44"> </span>
<a href="#l8.45"></a><span id="l8.45">         for (let lang of langs) {</span>
<a href="#l8.46"></a><span id="l8.46">             addMenuItem(localeList, lang[0], lang[1], null);</span>
<a href="#l8.47"></a><span id="l8.47">         }</span>
<a href="#l8.48"></a><span id="l8.48">     },</span>
<a href="#l8.49"></a><span id="l8.49"> </span>
<a href="#l8.50"></a><span id="l8.50">     extractWithLocale: function extractWithLocale(event, isEvent) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -222,24 +222,24 @@ function setDefaultItemValues(aItem, aCa</span>
<a href="#l9.4"></a><span id="l9.4">  * @param summary       (optional) The event's title.</span>
<a href="#l9.5"></a><span id="l9.5">  * @param event         (optional) A template event to show in the dialog</span>
<a href="#l9.6"></a><span id="l9.6">  * @param aForceAllDay  (optional) Make sure the event shown in the dialog is an</span>
<a href="#l9.7"></a><span id="l9.7">  *                                   allday event.</span>
<a href="#l9.8"></a><span id="l9.8">  */</span>
<a href="#l9.9"></a><span id="l9.9"> function createEventWithDialog(calendar, startDate, endDate, summary, event, aForceAllday) {</span>
<a href="#l9.10"></a><span id="l9.10">     const kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    var onNewEvent = function(item, calendar, originalItem, listener) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    var onNewEvent = function(item, opcalendar, originalItem, listener) {</span>
<a href="#l9.14"></a><span id="l9.14">         if (item.id) {</span>
<a href="#l9.15"></a><span id="l9.15">             // If the item already has an id, then this is the result of</span>
<a href="#l9.16"></a><span id="l9.16">             // saving the item without closing, and then saving again.</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-            doTransaction('modify', item, calendar, originalItem, listener);</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+            doTransaction('modify', item, opcalendar, originalItem, listener);</span>
<a href="#l9.19"></a><span id="l9.19">         } else {</span>
<a href="#l9.20"></a><span id="l9.20">             // Otherwise, this is an addition</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-            doTransaction('add', item, calendar, null, listener);</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+            doTransaction('add', item, opcalendar, null, listener);</span>
<a href="#l9.23"></a><span id="l9.23">         }</span>
<a href="#l9.24"></a><span id="l9.24">     };</span>
<a href="#l9.25"></a><span id="l9.25"> </span>
<a href="#l9.26"></a><span id="l9.26">     if (event) {</span>
<a href="#l9.27"></a><span id="l9.27">         if (!event.isMutable) {</span>
<a href="#l9.28"></a><span id="l9.28">             event = event.clone();</span>
<a href="#l9.29"></a><span id="l9.29">         }</span>
<a href="#l9.30"></a><span id="l9.30">         // If the event should be created from a template, then make sure to</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineat">@@ -279,24 +279,24 @@ function createEventWithDialog(calendar,</span>
<a href="#l9.32"></a><span id="l9.32">  * @param dueDate       (optional) The task's due date.</span>
<a href="#l9.33"></a><span id="l9.33">  * @param summary       (optional) The task's title.</span>
<a href="#l9.34"></a><span id="l9.34">  * @param todo          (optional) A template task to show in the dialog.</span>
<a href="#l9.35"></a><span id="l9.35">  * @param initialDate   (optional) The initial date for new task datepickers</span>
<a href="#l9.36"></a><span id="l9.36">  */</span>
<a href="#l9.37"></a><span id="l9.37"> function createTodoWithDialog(calendar, dueDate, summary, todo, initialDate) {</span>
<a href="#l9.38"></a><span id="l9.38">     const kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-    var onNewItem = function(item, calendar, originalItem, listener) {</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+    var onNewItem = function(item, opcalendar, originalItem, listener) {</span>
<a href="#l9.42"></a><span id="l9.42">         if (item.id) {</span>
<a href="#l9.43"></a><span id="l9.43">             // If the item already has an id, then this is the result of</span>
<a href="#l9.44"></a><span id="l9.44">             // saving the item without closing, and then saving again.</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-            doTransaction('modify', item, calendar, originalItem, listener);</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+            doTransaction('modify', item, opcalendar, originalItem, listener);</span>
<a href="#l9.47"></a><span id="l9.47">         } else {</span>
<a href="#l9.48"></a><span id="l9.48">             // Otherwise, this is an addition</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-            doTransaction('add', item, calendar, null, listener);</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+            doTransaction('add', item, opcalendar, null, listener);</span>
<a href="#l9.51"></a><span id="l9.51">         }</span>
<a href="#l9.52"></a><span id="l9.52">     };</span>
<a href="#l9.53"></a><span id="l9.53"> </span>
<a href="#l9.54"></a><span id="l9.54">     if (todo) {</span>
<a href="#l9.55"></a><span id="l9.55">         // If the todo should be created from a template, then make sure to</span>
<a href="#l9.56"></a><span id="l9.56">         // remove the id so that the item obtains a new id when doing the</span>
<a href="#l9.57"></a><span id="l9.57">         // transaction</span>
<a href="#l9.58"></a><span id="l9.58">         if (todo.id) {</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineat">@@ -440,21 +440,21 @@ function openEventDialog(calendarItem, c</span>
<a href="#l9.60"></a><span id="l9.60">     args.mode = mode;</span>
<a href="#l9.61"></a><span id="l9.61">     args.onOk = callback;</span>
<a href="#l9.62"></a><span id="l9.62">     args.job = job;</span>
<a href="#l9.63"></a><span id="l9.63">     args.initialStartDateValue = (initialDate || getDefaultStartDate());</span>
<a href="#l9.64"></a><span id="l9.64">     args.inTab = Preferences.get(&quot;calendar.item.editInTab&quot;, false);</span>
<a href="#l9.65"></a><span id="l9.65">     args.useNewItemUI = Preferences.get(&quot;calendar.item.useNewItemUI&quot;, false);</span>
<a href="#l9.66"></a><span id="l9.66"> </span>
<a href="#l9.67"></a><span id="l9.67">     // this will be called if file-&gt;new has been selected from within the dialog</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-    args.onNewEvent = function(calendar) {</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-        createEventWithDialog(calendar, null, null);</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+    args.onNewEvent = function(opcalendar) {</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+        createEventWithDialog(opcalendar, null, null);</span>
<a href="#l9.72"></a><span id="l9.72">     };</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-    args.onNewTodo = function(calendar) {</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-        createTodoWithDialog(calendar);</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+    args.onNewTodo = function(opcalendar) {</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+        createTodoWithDialog(opcalendar);</span>
<a href="#l9.77"></a><span id="l9.77">     };</span>
<a href="#l9.78"></a><span id="l9.78"> </span>
<a href="#l9.79"></a><span id="l9.79">     // the dialog will reset this to auto when it is done loading.</span>
<a href="#l9.80"></a><span id="l9.80">     window.setCursor(&quot;wait&quot;);</span>
<a href="#l9.81"></a><span id="l9.81"> </span>
<a href="#l9.82"></a><span id="l9.82">     // ask the provide if this item is an invitation. if this is the case</span>
<a href="#l9.83"></a><span id="l9.83">     // we'll open the summary dialog since the user is not allowed to change</span>
<a href="#l9.84"></a><span id="l9.84">     // the details of the item.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -919,58 +919,58 @@</span>
<a href="#l10.4"></a><span id="l10.4">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.5"></a><span id="l10.5">           let refreshJob = {</span>
<a href="#l10.6"></a><span id="l10.6">               QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l10.7"></a><span id="l10.7">               binding: this,</span>
<a href="#l10.8"></a><span id="l10.8">               calendar: null,</span>
<a href="#l10.9"></a><span id="l10.9">               items: null,</span>
<a href="#l10.10"></a><span id="l10.10">               operation: null,</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-              onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                  if (aCalendar.id in this.binding.mPendingRefreshJobs) {</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-                      delete this.binding.mPendingRefreshJobs[aCalendar.id];</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+              onOperationComplete: function(aOpCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+                  if (aOpCalendar.id in this.binding.mPendingRefreshJobs) {</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+                      delete this.binding.mPendingRefreshJobs[aOpCalendar.id];</span>
<a href="#l10.18"></a><span id="l10.18">                   }</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20">                   let oldItems = this.binding.mTaskArray.filter(function(item) {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-                      return item.calendar.id == aCalendar.id;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+                      return item.calendar.id == aOpCalendar.id;</span>
<a href="#l10.23"></a><span id="l10.23">                   });</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25">                   this.binding.mTreeView.modifyItems(this.items, oldItems);</span>
<a href="#l10.26"></a><span id="l10.26">               },</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-              onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+              onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l10.30"></a><span id="l10.30">                   this.items = this.items.concat(aItems);</span>
<a href="#l10.31"></a><span id="l10.31">               },</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33">               cancel: function() {</span>
<a href="#l10.34"></a><span id="l10.34">                   if (this.operation &amp;&amp; this.operation.isPending) {</span>
<a href="#l10.35"></a><span id="l10.35">                       this.operation.cancel();</span>
<a href="#l10.36"></a><span id="l10.36">                       this.operation = null;</span>
<a href="#l10.37"></a><span id="l10.37">                       this.items = [];</span>
<a href="#l10.38"></a><span id="l10.38">                   }</span>
<a href="#l10.39"></a><span id="l10.39">               },</span>
<a href="#l10.40"></a><span id="l10.40"> </span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-              execute: function(aCalendar) {</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+              execute: function() {</span>
<a href="#l10.43"></a><span id="l10.43">                   if (aCalendar.id in this.binding.mPendingRefreshJobs) {</span>
<a href="#l10.44"></a><span id="l10.44">                       this.binding.mPendingRefreshJobs[aCalendar.id].cancel();</span>
<a href="#l10.45"></a><span id="l10.45">                   }</span>
<a href="#l10.46"></a><span id="l10.46">                   this.calendar = aCalendar;</span>
<a href="#l10.47"></a><span id="l10.47">                   this.items = [];</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49">                   let op = this.binding.mFilter.getItems(aCalendar,</span>
<a href="#l10.50"></a><span id="l10.50">                                                          aCalendar.ITEM_FILTER_TYPE_TODO,</span>
<a href="#l10.51"></a><span id="l10.51">                                                          this);</span>
<a href="#l10.52"></a><span id="l10.52">                   if (op &amp;&amp; op.isPending) {</span>
<a href="#l10.53"></a><span id="l10.53">                       this.operation = op;</span>
<a href="#l10.54"></a><span id="l10.54">                       this.binding.mPendingRefreshJobs[aCalendar.id] = this;</span>
<a href="#l10.55"></a><span id="l10.55">                   }</span>
<a href="#l10.56"></a><span id="l10.56">               }</span>
<a href="#l10.57"></a><span id="l10.57">           };</span>
<a href="#l10.58"></a><span id="l10.58"> </span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-          refreshJob.execute(aCalendar);</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+          refreshJob.execute();</span>
<a href="#l10.61"></a><span id="l10.61">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.62"></a><span id="l10.62">       &lt;/method&gt;</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64">       &lt;method name=&quot;selectAll&quot;&gt;</span>
<a href="#l10.65"></a><span id="l10.65">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.66"></a><span id="l10.66">           if (this.mTreeView.selection) {</span>
<a href="#l10.67"></a><span id="l10.67">             this.mTreeView.selection.selectAll();</span>
<a href="#l10.68"></a><span id="l10.68">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -877,28 +877,28 @@ function addItemsFromCalendar(aCalendar,</span>
<a href="#l11.4"></a><span id="l11.4">         // If the unifinder is hidden, don't refresh the events to reduce needed</span>
<a href="#l11.5"></a><span id="l11.5">         // getItems calls.</span>
<a href="#l11.6"></a><span id="l11.6">         return;</span>
<a href="#l11.7"></a><span id="l11.7">     }</span>
<a href="#l11.8"></a><span id="l11.8">     var refreshListener = {</span>
<a href="#l11.9"></a><span id="l11.9">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l11.10"></a><span id="l11.10">         mEventArray: [],</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        onOperationComplete: function rET_onOperationComplete(aCalendar,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+        onOperationComplete: function rET_onOperationComplete(aOpCalendar,</span>
<a href="#l11.14"></a><span id="l11.14">                                                               aStatus,</span>
<a href="#l11.15"></a><span id="l11.15">                                                               aOperationType,</span>
<a href="#l11.16"></a><span id="l11.16">                                                               aId,</span>
<a href="#l11.17"></a><span id="l11.17">                                                               aDateTime) {</span>
<a href="#l11.18"></a><span id="l11.18">             var refreshTreeInternalFunc = function() {</span>
<a href="#l11.19"></a><span id="l11.19">                 aAddItemsInternalFunc(refreshListener.mEventArray);</span>
<a href="#l11.20"></a><span id="l11.20">             };</span>
<a href="#l11.21"></a><span id="l11.21">             setTimeout(refreshTreeInternalFunc, 0);</span>
<a href="#l11.22"></a><span id="l11.22">         },</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-        onGetResult: function rET_onGetResult(aCalendar,</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+        onGetResult: function rET_onGetResult(aOpCalendar,</span>
<a href="#l11.26"></a><span id="l11.26">                                               aStatus,</span>
<a href="#l11.27"></a><span id="l11.27">                                               aItemType,</span>
<a href="#l11.28"></a><span id="l11.28">                                               aDetail,</span>
<a href="#l11.29"></a><span id="l11.29">                                               aCount,</span>
<a href="#l11.30"></a><span id="l11.30">                                               aItems) {</span>
<a href="#l11.31"></a><span id="l11.31">             refreshListener.mEventArray = refreshListener.mEventArray.concat(aItems);</span>
<a href="#l11.32"></a><span id="l11.32">         }</span>
<a href="#l11.33"></a><span id="l11.33">     };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -370,17 +370,16 @@</span>
<a href="#l12.4"></a><span id="l12.4">           }</span>
<a href="#l12.5"></a><span id="l12.5">           return newNode;</span>
<a href="#l12.6"></a><span id="l12.6">         ]]&gt;&lt;/body&gt;</span>
<a href="#l12.7"></a><span id="l12.7">       &lt;/method&gt;</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">       &lt;property name=&quot;attendees&quot;&gt;</span>
<a href="#l12.10"></a><span id="l12.10">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.11"></a><span id="l12.11">           let attendees = [];</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-          let inputField;</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14">           for (let i = 1; true; i++) {</span>
<a href="#l12.15"></a><span id="l12.15">               let inputField = this.getInputElement(i);</span>
<a href="#l12.16"></a><span id="l12.16">               if (!inputField) {</span>
<a href="#l12.17"></a><span id="l12.17">                   break;</span>
<a href="#l12.18"></a><span id="l12.18">               } else if (inputField.value == &quot;&quot;) {</span>
<a href="#l12.19"></a><span id="l12.19">                   continue;</span>
<a href="#l12.20"></a><span id="l12.20">               }</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -418,17 +417,16 @@</span>
<a href="#l12.22"></a><span id="l12.22">           }</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">           return attendees;</span>
<a href="#l12.25"></a><span id="l12.25">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l12.26"></a><span id="l12.26">       &lt;/property&gt;</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">       &lt;property name=&quot;organizer&quot;&gt;</span>
<a href="#l12.29"></a><span id="l12.29">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-          let inputField;</span>
<a href="#l12.31"></a><span id="l12.31">           for (let i = 1; true; i++) {</span>
<a href="#l12.32"></a><span id="l12.32">               let inputField = this.getInputElement(i);</span>
<a href="#l12.33"></a><span id="l12.33">               if (!inputField) {</span>
<a href="#l12.34"></a><span id="l12.34">                   break;</span>
<a href="#l12.35"></a><span id="l12.35">               } else if (inputField.value == &quot;&quot;) {</span>
<a href="#l12.36"></a><span id="l12.36">                   continue;</span>
<a href="#l12.37"></a><span id="l12.37">               }</span>
<a href="#l12.38"></a><span id="l12.38"> </span>
<a href="#l12.39"></a><span id="l12.39" class="difflineat">@@ -594,25 +592,25 @@</span>
<a href="#l12.40"></a><span id="l12.40">             let userTypeIcon = document.getAnonymousElementByAttribute(listitem, &quot;anonid&quot;, &quot;usertype-icon&quot;);</span>
<a href="#l12.41"></a><span id="l12.41">             userTypeIcon.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l12.42"></a><span id="l12.42">             userTypeIcon.setAttribute(&quot;id&quot;, &quot;attendeeCol2#&quot; + rowNumber);</span>
<a href="#l12.43"></a><span id="l12.43">             userTypeIcon.setAttribute(&quot;cutype&quot;, newAttendee.userType);</span>
<a href="#l12.44"></a><span id="l12.44">           ]]&gt;&lt;/body&gt;</span>
<a href="#l12.45"></a><span id="l12.45">     &lt;/method&gt;</span>
<a href="#l12.46"></a><span id="l12.46"> </span>
<a href="#l12.47"></a><span id="l12.47">     &lt;method name=&quot;resolvePotentialList&quot;&gt;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-        &lt;parameter name=&quot;input&quot;/&gt;</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+        &lt;parameter name=&quot;aInput&quot;/&gt;</span>
<a href="#l12.50"></a><span id="l12.50">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-            let fieldValue = input.value;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-            if (input.id.length &gt; 0 &amp;&amp; fieldValue.length &gt; 0) {</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+            let fieldValue = aInput.value;</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+            if (aInput.id.length &gt; 0 &amp;&amp; fieldValue.length &gt; 0) {</span>
<a href="#l12.55"></a><span id="l12.55">                 let mailingList = this._resolveListByName(fieldValue);</span>
<a href="#l12.56"></a><span id="l12.56">                 if (mailingList) {</span>
<a href="#l12.57"></a><span id="l12.57">                     let entries = this._getListEntries(mailingList);</span>
<a href="#l12.58"></a><span id="l12.58">                       if (entries.length &gt; 0) {</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineminus">-                          let currentIndex = parseInt(input.id.substr(13), 10);</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+                          let currentIndex = parseInt(aInput.id.substr(13), 10);</span>
<a href="#l12.61"></a><span id="l12.61">                           let template = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l12.62"></a><span id="l12.62">                           let currentNode = template.parentNode.childNodes[currentIndex];</span>
<a href="#l12.63"></a><span id="l12.63">                           this._fillListItemWithEntry(currentNode, entries[0], currentIndex);</span>
<a href="#l12.64"></a><span id="l12.64">                           entries.shift();</span>
<a href="#l12.65"></a><span id="l12.65">                           let nextNode = template.parentNode.childNodes[currentIndex + 1];</span>
<a href="#l12.66"></a><span id="l12.66">                           currentIndex++;</span>
<a href="#l12.67"></a><span id="l12.67">                           for (let entry of entries) {</span>
<a href="#l12.68"></a><span id="l12.68">                               currentNode = template.cloneNode(true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -166,20 +166,20 @@</span>
<a href="#l13.4"></a><span id="l13.4">                           .getService(</span>
<a href="#l13.5"></a><span id="l13.5">                               Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l13.6"></a><span id="l13.6">           }</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">           // First set the formatted date string as title</span>
<a href="#l13.9"></a><span id="l13.9">           let day =</span>
<a href="#l13.10"></a><span id="l13.10">               document.getAnonymousElementByAttribute(</span>
<a href="#l13.11"></a><span id="l13.11">                   this, &quot;anonid&quot;, &quot;day&quot;);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-          let value = (this.mZoomFactor &gt; 100) ?</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+          let dateValue = (this.mZoomFactor &gt; 100) ?</span>
<a href="#l13.14"></a><span id="l13.14">               this.mDateFormatter.formatDateShort(date) :</span>
<a href="#l13.15"></a><span id="l13.15">               this.mDateFormatter.formatDateLong(date);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-          day.setAttribute(&quot;value&quot;, value);</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+          day.setAttribute(&quot;value&quot;, dateValue);</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">           // Now create as many 'hour' elements as needed</span>
<a href="#l13.20"></a><span id="l13.20">           let step_in_minutes = Math.floor(60 * this.mZoomFactor / 100);</span>
<a href="#l13.21"></a><span id="l13.21">           let hours =</span>
<a href="#l13.22"></a><span id="l13.22">               document.getAnonymousElementByAttribute(</span>
<a href="#l13.23"></a><span id="l13.23">                   this, &quot;anonid&quot;, &quot;hours&quot;);</span>
<a href="#l13.24"></a><span id="l13.24">           date.hour = this.mStartHour;</span>
<a href="#l13.25"></a><span id="l13.25">           if (hours.childNodes.length &lt;= 0) {</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineat">@@ -765,18 +765,16 @@</span>
<a href="#l13.27"></a><span id="l13.27">               end.day += this.mRange;</span>
<a href="#l13.28"></a><span id="l13.28">               end.timezone = kDefaultTimezone;</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">               // First of all set all state slots to 'free'</span>
<a href="#l13.31"></a><span id="l13.31">               for (let i = 0; i &lt; this.mState.length; i++) {</span>
<a href="#l13.32"></a><span id="l13.32">                   this.mState[i] = Components.interfaces.calIFreeBusyInterval.FREE;</span>
<a href="#l13.33"></a><span id="l13.33">               }</span>
<a href="#l13.34"></a><span id="l13.34"> </span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-              let numHours = this.numHours;</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-</span>
<a href="#l13.37"></a><span id="l13.37">               // Iterate all incoming freebusy entries</span>
<a href="#l13.38"></a><span id="l13.38">               for (let entry of aEntries) {</span>
<a href="#l13.39"></a><span id="l13.39">                   let rangeStart = entry.interval.start.getInTimezone(kDefaultTimezone);</span>
<a href="#l13.40"></a><span id="l13.40">                   let rangeEnd = entry.interval.end.getInTimezone(kDefaultTimezone);</span>
<a href="#l13.41"></a><span id="l13.41"> </span>
<a href="#l13.42"></a><span id="l13.42">                   if (rangeStart.compare(start) &lt; 0) {</span>
<a href="#l13.43"></a><span id="l13.43">                       rangeStart = start.clone();</span>
<a href="#l13.44"></a><span id="l13.44">                   }</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineat">@@ -834,29 +832,29 @@</span>
<a href="#l13.46"></a><span id="l13.46">                           let minutes_per_block = 60 * zoomfactor / 100;</span>
<a href="#l13.47"></a><span id="l13.47"> </span>
<a href="#l13.48"></a><span id="l13.48">                           let block = Math.floor(minute / minutes_per_block);</span>
<a href="#l13.49"></a><span id="l13.49"> </span>
<a href="#l13.50"></a><span id="l13.50">                           return Math.ceil(fNumHours) * day + block;</span>
<a href="#l13.51"></a><span id="l13.51">                       };</span>
<a href="#l13.52"></a><span id="l13.52"> </span>
<a href="#l13.53"></a><span id="l13.53">                       // Number of hours (fractional representation)</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-                      let numHours = this.mEndHour - this.mStartHour;</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-                      let fNumHours = numHours * 100 / this.mZoomFactor;</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+                      let calcNumHours = this.mEndHour - this.mStartHour;</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+                      let fNumHours = calcNumHours * 100 / this.mZoomFactor;</span>
<a href="#l13.58"></a><span id="l13.58"> </span>
<a href="#l13.59"></a><span id="l13.59">                       let start_offset =</span>
<a href="#l13.60"></a><span id="l13.60">                           minute2offset(start_in_minutes,</span>
<a href="#l13.61"></a><span id="l13.61">                                         fNumHours,</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-                                        numHours,</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+                                        calcNumHours,</span>
<a href="#l13.64"></a><span id="l13.64">                                         this.mStartHour,</span>
<a href="#l13.65"></a><span id="l13.65">                                         this.mZoomFactor);</span>
<a href="#l13.66"></a><span id="l13.66">                       let end_offset =</span>
<a href="#l13.67"></a><span id="l13.67">                           minute2offset(end_in_minutes - 1,</span>
<a href="#l13.68"></a><span id="l13.68">                                         fNumHours,</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineminus">-                                        numHours,</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+                                        calcNumHours,</span>
<a href="#l13.71"></a><span id="l13.71">                                         this.mStartHour,</span>
<a href="#l13.72"></a><span id="l13.72">                                         this.mZoomFactor);</span>
<a href="#l13.73"></a><span id="l13.73"> </span>
<a href="#l13.74"></a><span id="l13.74">                       // Set all affected state slots</span>
<a href="#l13.75"></a><span id="l13.75">                       for (let i = start_offset; i &lt;= end_offset; i++) {</span>
<a href="#l13.76"></a><span id="l13.76">                           this.mState[i] = entry.freeBusyType;</span>
<a href="#l13.77"></a><span id="l13.77">                       }</span>
<a href="#l13.78"></a><span id="l13.78">                   }</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineat">@@ -1397,18 +1395,18 @@</span>
<a href="#l13.80"></a><span id="l13.80">           }</span>
<a href="#l13.81"></a><span id="l13.81"> </span>
<a href="#l13.82"></a><span id="l13.82">           // In case the new starttime happens to be scheduled</span>
<a href="#l13.83"></a><span id="l13.83">           // on a different day, we also need to update the</span>
<a href="#l13.84"></a><span id="l13.84">           // complete freebusy informations and appropriate</span>
<a href="#l13.85"></a><span id="l13.85">           // underlying arrays holding the informaion.</span>
<a href="#l13.86"></a><span id="l13.86">           if (this.mStartDate.day != startTime.day) {</span>
<a href="#l13.87"></a><span id="l13.87">               for (let i = 1; i &lt;= this.mMaxFreeBusy; i++) {</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-                  let row = this.getFreeBusyElement(i);</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-                  row.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+                  let fbelem = this.getFreeBusyElement(i);</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+                  fbelem.setAttribute(&quot;dirty&quot;, &quot;true&quot;);</span>
<a href="#l13.92"></a><span id="l13.92">               }</span>
<a href="#l13.93"></a><span id="l13.93">               this.updateFreeBusy();</span>
<a href="#l13.94"></a><span id="l13.94">           }</span>
<a href="#l13.95"></a><span id="l13.95"> </span>
<a href="#l13.96"></a><span id="l13.96">           // Return the new starttime of the item.</span>
<a href="#l13.97"></a><span id="l13.97">           return startTime;</span>
<a href="#l13.98"></a><span id="l13.98">         ]]&gt;&lt;/body&gt;</span>
<a href="#l13.99"></a><span id="l13.99">       &lt;/method&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -186,37 +186,37 @@ function initializeControls(rule) {</span>
<a href="#l14.4"></a><span id="l14.4">     // &quot;YEARLY&quot; ruletype</span>
<a href="#l14.5"></a><span id="l14.5">     if (byMonthRuleComponent.length == 0 || rule.type != &quot;YEARLY&quot;) {</span>
<a href="#l14.6"></a><span id="l14.6">         setElementValue(&quot;yearly-month-rule&quot;, startDate.month + 1);</span>
<a href="#l14.7"></a><span id="l14.7">         setElementValue(&quot;yearly-month-ordinal&quot;, startDate.month + 1);</span>
<a href="#l14.8"></a><span id="l14.8">         if (byMonthDayRuleComponent.length &gt; 0) {</span>
<a href="#l14.9"></a><span id="l14.9">             setControlsForByMonthDay_YearlyRule(startDate, byMonthDayRuleComponent[0]);</span>
<a href="#l14.10"></a><span id="l14.10">         } else {</span>
<a href="#l14.11"></a><span id="l14.11">             setElementValue(&quot;yearly-days&quot;, startDate.day);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-            let day = Math.floor((startDate.day - 1) / 7) + 1;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-            setElementValue(&quot;yearly-ordinal&quot;, day);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+            let ordinalDay = Math.floor((startDate.day - 1) / 7) + 1;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+            setElementValue(&quot;yearly-ordinal&quot;, ordinalDay);</span>
<a href="#l14.16"></a><span id="l14.16">             setElementValue(&quot;yearly-weekday&quot;, startDate.weekday + 1);</span>
<a href="#l14.17"></a><span id="l14.17">         }</span>
<a href="#l14.18"></a><span id="l14.18">     } else {</span>
<a href="#l14.19"></a><span id="l14.19">         setElementValue(&quot;yearly-month-rule&quot;, byMonthRuleComponent[0]);</span>
<a href="#l14.20"></a><span id="l14.20">         setElementValue(&quot;yearly-month-ordinal&quot;, byMonthRuleComponent[0]);</span>
<a href="#l14.21"></a><span id="l14.21">         if (byMonthDayRuleComponent.length &gt; 0) {</span>
<a href="#l14.22"></a><span id="l14.22">             let date = startDate.clone();</span>
<a href="#l14.23"></a><span id="l14.23">             date.month = byMonthRuleComponent[0] - 1;</span>
<a href="#l14.24"></a><span id="l14.24">             setControlsForByMonthDay_YearlyRule(date, byMonthDayRuleComponent[0]);</span>
<a href="#l14.25"></a><span id="l14.25">         } else if (byDayRuleComponent.length &gt; 0) {</span>
<a href="#l14.26"></a><span id="l14.26">             document.getElementById(&quot;yearly-group&quot;).selectedIndex = 1;</span>
<a href="#l14.27"></a><span id="l14.27">             if (everyWeekDay(byDayRuleComponent)) {</span>
<a href="#l14.28"></a><span id="l14.28">                 // Every day of the month.</span>
<a href="#l14.29"></a><span id="l14.29">                 setElementValue(&quot;yearly-ordinal&quot;, 0);</span>
<a href="#l14.30"></a><span id="l14.30">                 setElementValue(&quot;yearly-weekday&quot;, -1);</span>
<a href="#l14.31"></a><span id="l14.31">             } else {</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-                let ruleInfo = getOrdinalAndWeekdayOfRule(byDayRuleComponent[0]);</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-                setElementValue(&quot;yearly-ordinal&quot;, ruleInfo.ordinal);</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-                setElementValue(&quot;yearly-weekday&quot;, ruleInfo.weekday);</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+                let yearlyRuleInfo = getOrdinalAndWeekdayOfRule(byDayRuleComponent[0]);</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+                setElementValue(&quot;yearly-ordinal&quot;, yearlyRuleInfo.ordinal);</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+                setElementValue(&quot;yearly-weekday&quot;, yearlyRuleInfo.weekday);</span>
<a href="#l14.38"></a><span id="l14.38">             }</span>
<a href="#l14.39"></a><span id="l14.39">         } else if (byMonthRuleComponent.length &gt; 0) {</span>
<a href="#l14.40"></a><span id="l14.40">             document.getElementById(&quot;yearly-group&quot;).selectedIndex = 0;</span>
<a href="#l14.41"></a><span id="l14.41">             setElementValue(&quot;yearly-days&quot;, startDate.day);</span>
<a href="#l14.42"></a><span id="l14.42">         }</span>
<a href="#l14.43"></a><span id="l14.43">     }</span>
<a href="#l14.44"></a><span id="l14.44"> </span>
<a href="#l14.45"></a><span id="l14.45">     /* load up the duration of the event radiogroup */</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineat">@@ -278,60 +278,62 @@ function onSave(item) {</span>
<a href="#l14.47"></a><span id="l14.47">         recurrenceInfo.item = item;</span>
<a href="#l14.48"></a><span id="l14.48">     } else {</span>
<a href="#l14.49"></a><span id="l14.49">         recurrenceInfo = createRecurrenceInfo(item);</span>
<a href="#l14.50"></a><span id="l14.50">     }</span>
<a href="#l14.51"></a><span id="l14.51"> </span>
<a href="#l14.52"></a><span id="l14.52">     var recRule = createRecurrenceRule();</span>
<a href="#l14.53"></a><span id="l14.53">     const ALL_WEEKDAYS = [2, 3, 4, 5, 6, 7, 1]; // The sequence MO,TU,WE,TH,FR,SA,SU.</span>
<a href="#l14.54"></a><span id="l14.54">     switch (deckNumber) {</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-    case 0:</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+    case 0: {</span>
<a href="#l14.57"></a><span id="l14.57">         recRule.type = &quot;DAILY&quot;;</span>
<a href="#l14.58"></a><span id="l14.58">         let dailyGroup = document.getElementById(&quot;daily-group&quot;);</span>
<a href="#l14.59"></a><span id="l14.59">         if (dailyGroup.selectedIndex == 0) {</span>
<a href="#l14.60"></a><span id="l14.60">             let ndays = Math.max(1, Number(getElementValue(&quot;daily-days&quot;)));</span>
<a href="#l14.61"></a><span id="l14.61">             recRule.interval = ndays;</span>
<a href="#l14.62"></a><span id="l14.62">         } else {</span>
<a href="#l14.63"></a><span id="l14.63">             recRule.interval = 1;</span>
<a href="#l14.64"></a><span id="l14.64">             let onDays = [2, 3, 4, 5, 6];</span>
<a href="#l14.65"></a><span id="l14.65">             recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l14.66"></a><span id="l14.66">         }</span>
<a href="#l14.67"></a><span id="l14.67">         break;</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineminus">-    case 1:</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+    }</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+    case 1: {</span>
<a href="#l14.71"></a><span id="l14.71">         recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l14.72"></a><span id="l14.72">         let ndays = Number(getElementValue(&quot;weekly-weeks&quot;));</span>
<a href="#l14.73"></a><span id="l14.73">         recRule.interval = ndays;</span>
<a href="#l14.74"></a><span id="l14.74">         let onDays = document.getElementById(&quot;daypicker-weekday&quot;).days;</span>
<a href="#l14.75"></a><span id="l14.75">         if (onDays.length &gt; 0) {</span>
<a href="#l14.76"></a><span id="l14.76">             recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l14.77"></a><span id="l14.77">         }</span>
<a href="#l14.78"></a><span id="l14.78">         break;</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+    }</span>
<a href="#l14.80"></a><span id="l14.80">     case 2:</span>
<a href="#l14.81"></a><span id="l14.81">         recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineminus">-        var monthInterval = Number(getElementValue(&quot;monthly-interval&quot;));</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+        let monthInterval = Number(getElementValue(&quot;monthly-interval&quot;));</span>
<a href="#l14.84"></a><span id="l14.84">         recRule.interval = monthInterval;</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-        var monthlyGroup = document.getElementById(&quot;monthly-group&quot;);</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+        let monthlyGroup = document.getElementById(&quot;monthly-group&quot;);</span>
<a href="#l14.87"></a><span id="l14.87">         if (monthlyGroup.selectedIndex == 0) {</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-            var ordinal = Number(getElementValue(&quot;monthly-ordinal&quot;));</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-            var day_of_week = Number(getElementValue(&quot;monthly-weekday&quot;));</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-            if (day_of_week &lt; 0) {</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineminus">-                if (ordinal == 0) {</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+            let monthlyOrdinal = Number(getElementValue(&quot;monthly-monthlyOrdinal&quot;));</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+            let monthlyDOW = Number(getElementValue(&quot;monthly-weekday&quot;));</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+            if (monthlyDOW &lt; 0) {</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+                if (monthlyOrdinal == 0) {</span>
<a href="#l14.96"></a><span id="l14.96">                     // Monthly rule &quot;Every day of the month&quot;.</span>
<a href="#l14.97"></a><span id="l14.97">                     recRule.setComponent(&quot;BYDAY&quot;, 7, ALL_WEEKDAYS);</span>
<a href="#l14.98"></a><span id="l14.98">                 } else {</span>
<a href="#l14.99"></a><span id="l14.99">                     // One of the first five days or the last day of the month.</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-                    recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [ ordinal ]);</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+                    recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [ monthlyOrdinal ]);</span>
<a href="#l14.102"></a><span id="l14.102">                 }</span>
<a href="#l14.103"></a><span id="l14.103">             } else {</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-                var sign = ordinal &lt; 0 ? -1 : 1;</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-                var onDays = [ (Math.abs(ordinal) * 8 + day_of_week) * sign ];</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+                let sign = monthlyOrdinal &lt; 0 ? -1 : 1;</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+                let onDays = [ (Math.abs(monthlyOrdinal) * 8 + monthlyDOW) * sign ];</span>
<a href="#l14.108"></a><span id="l14.108">                 recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l14.109"></a><span id="l14.109">             }</span>
<a href="#l14.110"></a><span id="l14.110">         } else {</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-            var monthlyDays = document.getElementById(&quot;monthly-days&quot;).days;</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+            let monthlyDays = document.getElementById(&quot;monthly-days&quot;).days;</span>
<a href="#l14.113"></a><span id="l14.113">             if (monthlyDays.length &gt; 0) {</span>
<a href="#l14.114"></a><span id="l14.114">                 recRule.setComponent(&quot;BYMONTHDAY&quot;, monthlyDays.length, monthlyDays);</span>
<a href="#l14.115"></a><span id="l14.115">             }</span>
<a href="#l14.116"></a><span id="l14.116">         }</span>
<a href="#l14.117"></a><span id="l14.117">         break;</span>
<a href="#l14.118"></a><span id="l14.118">     case 3:</span>
<a href="#l14.119"></a><span id="l14.119">         recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l14.120"></a><span id="l14.120">         let yearInterval = Number(getElementValue(&quot;yearly-interval&quot;));</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineat">@@ -340,29 +342,29 @@ function onSave(item) {</span>
<a href="#l14.122"></a><span id="l14.122">         if (yearlyGroup.selectedIndex == 0) {</span>
<a href="#l14.123"></a><span id="l14.123">             let yearlyByMonth = [ Number(getElementValue(&quot;yearly-month-ordinal&quot;)) ];</span>
<a href="#l14.124"></a><span id="l14.124">             recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l14.125"></a><span id="l14.125">             let yearlyByDay = [ Number(getElementValue(&quot;yearly-days&quot;)) ];</span>
<a href="#l14.126"></a><span id="l14.126">             recRule.setComponent(&quot;BYMONTHDAY&quot;, yearlyByDay.length, yearlyByDay);</span>
<a href="#l14.127"></a><span id="l14.127">         } else {</span>
<a href="#l14.128"></a><span id="l14.128">             let yearlyByMonth = [ Number(getElementValue(&quot;yearly-month-rule&quot;)) ];</span>
<a href="#l14.129"></a><span id="l14.129">             recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineminus">-            let ordinal = Number(getElementValue(&quot;yearly-ordinal&quot;));</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineminus">-            let day_of_week = Number(getElementValue(&quot;yearly-weekday&quot;));</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineminus">-            if (day_of_week &lt; 0) {</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineminus">-                if (ordinal == 0) {</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+            let yearlyOrdinal = Number(getElementValue(&quot;yearly-ordinal&quot;));</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineplus">+            let yearlyDOW = Number(getElementValue(&quot;yearly-weekday&quot;));</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineplus">+            if (yearlyDOW &lt; 0) {</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineplus">+                if (yearlyOrdinal == 0) {</span>
<a href="#l14.138"></a><span id="l14.138">                     // Yearly rule &quot;Every day of a month&quot;.</span>
<a href="#l14.139"></a><span id="l14.139">                     recRule.setComponent(&quot;BYDAY&quot;, 7, ALL_WEEKDAYS);</span>
<a href="#l14.140"></a><span id="l14.140">                 } else {</span>
<a href="#l14.141"></a><span id="l14.141">                     // One of the first five days or the last of a month.</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineminus">-                    recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [ ordinal ]);</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineplus">+                    recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [ yearlyOrdinal ]);</span>
<a href="#l14.144"></a><span id="l14.144">                 }</span>
<a href="#l14.145"></a><span id="l14.145">             } else {</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineminus">-                let sign = ordinal &lt; 0 ? -1 : 1;</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineminus">-                let onDays = [ (Math.abs(ordinal) * 8 + day_of_week) * sign ];</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineplus">+                let sign = yearlyOrdinal &lt; 0 ? -1 : 1;</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineplus">+                let onDays = [ (Math.abs(yearlyOrdinal) * 8 + yearlyDOW) * sign ];</span>
<a href="#l14.150"></a><span id="l14.150">                 recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l14.151"></a><span id="l14.151">             }</span>
<a href="#l14.152"></a><span id="l14.152">         }</span>
<a href="#l14.153"></a><span id="l14.153">         break;</span>
<a href="#l14.154"></a><span id="l14.154">     }</span>
<a href="#l14.155"></a><span id="l14.155"> </span>
<a href="#l14.156"></a><span id="l14.156">     // Figure out how long this event is supposed to last</span>
<a href="#l14.157"></a><span id="l14.157">     switch (document.getElementById(&quot;recurrence-duration&quot;).selectedItem.value) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -88,44 +88,43 @@ function onCancel() {</span>
<a href="#l15.4"></a><span id="l15.4"> }</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> /**</span>
<a href="#l15.7"></a><span id="l15.7">  * Performs the search for subscriptions, canceling any pending searches.</span>
<a href="#l15.8"></a><span id="l15.8">  */</span>
<a href="#l15.9"></a><span id="l15.9"> function onSearch() {</span>
<a href="#l15.10"></a><span id="l15.10">     cancelPendingSearchOperation();</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    var richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    let richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l15.14"></a><span id="l15.14">     richListBox.clear();</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-    var registeredCals = {};</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-    for (var calendar of getCalendarManager().getCalendars({})) {</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+    let registeredCals = {};</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+    for (let calendar of getCalendarManager().getCalendars({})) {</span>
<a href="#l15.20"></a><span id="l15.20">         registeredCals[calendar.id] = true;</span>
<a href="#l15.21"></a><span id="l15.21">     }</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-    var opListener = {</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+    let opListener = {</span>
<a href="#l15.25"></a><span id="l15.25">         onResult: function search_onResult(op, result) {</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-            var richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l15.27"></a><span id="l15.27">             if (result) {</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-                for (var calendar of result) {</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+                for (let calendar of result) {</span>
<a href="#l15.30"></a><span id="l15.30">                     richListBox.addCalendar(calendar, registeredCals[calendar.id]);</span>
<a href="#l15.31"></a><span id="l15.31">                 }</span>
<a href="#l15.32"></a><span id="l15.32">             }</span>
<a href="#l15.33"></a><span id="l15.33">             if (!op.isPending) {</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-                var statusDeck = document.getElementById(&quot;status-deck&quot;);</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+                let statusDeck = document.getElementById(&quot;status-deck&quot;);</span>
<a href="#l15.36"></a><span id="l15.36">                 if (richListBox.getRowCount() &gt; 0) {</span>
<a href="#l15.37"></a><span id="l15.37">                     statusDeck.selectedIndex = 0;</span>
<a href="#l15.38"></a><span id="l15.38">                 } else {</span>
<a href="#l15.39"></a><span id="l15.39">                     statusDeck.selectedIndex = 2;</span>
<a href="#l15.40"></a><span id="l15.40">                 }</span>
<a href="#l15.41"></a><span id="l15.41">             }</span>
<a href="#l15.42"></a><span id="l15.42">         }</span>
<a href="#l15.43"></a><span id="l15.43">     };</span>
<a href="#l15.44"></a><span id="l15.44"> </span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-    var op = getCalendarSearchService().searchForCalendars(document.getElementById(&quot;search-textbox&quot;).value,</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+    let op = getCalendarSearchService().searchForCalendars(document.getElementById(&quot;search-textbox&quot;).value,</span>
<a href="#l15.47"></a><span id="l15.47">                                                            0 /* hints */, 50, opListener);</span>
<a href="#l15.48"></a><span id="l15.48">     if (op &amp;&amp; op.isPending) {</span>
<a href="#l15.49"></a><span id="l15.49">         gCurrentSearchOperation = op;</span>
<a href="#l15.50"></a><span id="l15.50">         document.getElementById(&quot;status-deck&quot;).selectedIndex = 1;</span>
<a href="#l15.51"></a><span id="l15.51">     }</span>
<a href="#l15.52"></a><span id="l15.52"> }</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -27,22 +27,22 @@ function onLoad() {</span>
<a href="#l16.4"></a><span id="l16.4">         // keep this context...</span>
<a href="#l16.5"></a><span id="l16.5">         var self = this;</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7">         // store the 'finalize'-functor in the provided job-object.</span>
<a href="#l16.8"></a><span id="l16.8">         args.job.finalize = function finalize() {</span>
<a href="#l16.9"></a><span id="l16.9">             // store any pending modifications...</span>
<a href="#l16.10"></a><span id="l16.10">             self.onAccept();</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-            let item = window.calendarItem;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+            let calendarItem = window.calendarItem;</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">             // ...and close the window.</span>
<a href="#l16.16"></a><span id="l16.16">             window.close();</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-            return item;</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+            return calendarItem;</span>
<a href="#l16.20"></a><span id="l16.20">         };</span>
<a href="#l16.21"></a><span id="l16.21">     }</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23">     // set the dialog-id to enable the right window-icon to be loaded.</span>
<a href="#l16.24"></a><span id="l16.24">     if (cal.isEvent(item)) {</span>
<a href="#l16.25"></a><span id="l16.25">         setDialogId(document.documentElement, &quot;calendar-event-summary-dialog&quot;);</span>
<a href="#l16.26"></a><span id="l16.26">     } else if (cal.isToDo(item)) {</span>
<a href="#l16.27"></a><span id="l16.27">         setDialogId(document.documentElement, &quot;calendar-task-summary-dialog&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/import-export.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/import-export.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -316,20 +316,20 @@ function saveEventsToFile(calendarEventA</span>
<a href="#l17.4"></a><span id="l17.4">  * the user will be prompted with a list of calendars to choose which one to export.</span>
<a href="#l17.5"></a><span id="l17.5">  *</span>
<a href="#l17.6"></a><span id="l17.6">  * @param aCalendar     (optional) A specific calendar to export</span>
<a href="#l17.7"></a><span id="l17.7">  */</span>
<a href="#l17.8"></a><span id="l17.8"> function exportEntireCalendar(aCalendar) {</span>
<a href="#l17.9"></a><span id="l17.9">     var itemArray = [];</span>
<a href="#l17.10"></a><span id="l17.10">     var getListener = {</span>
<a href="#l17.11"></a><span id="l17.11">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-            saveEventsToFile(itemArray, aCalendar.name);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+        onOperationComplete: function(aOpCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+            saveEventsToFile(itemArray, aOpCalendar.name);</span>
<a href="#l17.16"></a><span id="l17.16">         },</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-        onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+        onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l17.19"></a><span id="l17.19">             for (let item of aItems) {</span>
<a href="#l17.20"></a><span id="l17.20">                 itemArray.push(item);</span>
<a href="#l17.21"></a><span id="l17.21">             }</span>
<a href="#l17.22"></a><span id="l17.22">         }</span>
<a href="#l17.23"></a><span id="l17.23">     };</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25">     function getItemsFromCal(aCal) {</span>
<a href="#l17.26"></a><span id="l17.26">         aCal.getItems(Components.interfaces.calICalendar.ITEM_FILTER_ALL_ITEMS,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/modules/calExtract.jsm</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/modules/calExtract.jsm</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1264,24 +1264,26 @@ Extractor.prototype = {</span>
<a href="#l18.4"></a><span id="l18.4">             return -1;</span>
<a href="#l18.5"></a><span id="l18.5">         } else {</span>
<a href="#l18.6"></a><span id="l18.6">             return r;</span>
<a href="#l18.7"></a><span id="l18.7">         }</span>
<a href="#l18.8"></a><span id="l18.8">     },</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">     guess: function guess(year, month, day, hour, minute, start, end, str,</span>
<a href="#l18.11"></a><span id="l18.11">                           relation, pattern, ambiguous) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-        let guess = {year: year, month: month, day: day, hour: hour, minute: minute,</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                     start: start, end: end, str: str, relation: relation,</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-                     pattern: pattern, ambiguous: ambiguous};</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+        let dateGuess = {</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+            year: year, month: month, day: day, hour: hour, minute: minute,</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+            start: start, end: end, str: str, relation: relation,</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+            pattern: pattern, ambiguous: ambiguous</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+        };</span>
<a href="#l18.20"></a><span id="l18.20">         // past dates are kept for containment checks</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-        if (this.isPastDate(guess, this.now)) {</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+        if (this.isPastDate(dateGuess, this.now)) {</span>
<a href="#l18.23"></a><span id="l18.23">             guess.relation = &quot;notadatetime&quot;;</span>
<a href="#l18.24"></a><span id="l18.24">         }</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-        this.collected.push(guess);</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+        this.collected.push(dateGuess);</span>
<a href="#l18.27"></a><span id="l18.27">     },</span>
<a href="#l18.28"></a><span id="l18.28"> </span>
<a href="#l18.29"></a><span id="l18.29">     sanitize: function(str) {</span>
<a href="#l18.30"></a><span id="l18.30">         return str.replace(/[-[\]{}()*+?.,\\^$]/g, &quot;\\$&amp;&quot;);</span>
<a href="#l18.31"></a><span id="l18.31">     },</span>
<a href="#l18.32"></a><span id="l18.32"> </span>
<a href="#l18.33"></a><span id="l18.33">     unescape: function(str) {</span>
<a href="#l18.34"></a><span id="l18.34">         return str.replace(/\\([\.])/g, &quot;$1&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -723,21 +723,21 @@ cal.itip = {</span>
<a href="#l19.4"></a><span id="l19.4">             if (!isMinorUpdate || !cal.compareItemContent(stripUserData(aItem), stripUserData(aOriginalItem))) {</span>
<a href="#l19.5"></a><span id="l19.5">                 let requestItem = aItem.clone();</span>
<a href="#l19.6"></a><span id="l19.6">                 if (!requestItem.organizer) {</span>
<a href="#l19.7"></a><span id="l19.7">                     requestItem.organizer = createOrganizer(requestItem.calendar);</span>
<a href="#l19.8"></a><span id="l19.8">                 }</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">                 // Fix up our attendees for invitations using some good defaults</span>
<a href="#l19.11"></a><span id="l19.11">                 let recipients = [];</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-                let itemAtt = requestItem.getAttendees({});</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+                let reqItemAtt = requestItem.getAttendees({});</span>
<a href="#l19.14"></a><span id="l19.14">                 if (!isMinorUpdate) {</span>
<a href="#l19.15"></a><span id="l19.15">                     requestItem.removeAllAttendees();</span>
<a href="#l19.16"></a><span id="l19.16">                 }</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-                for (let attendee of itemAtt) {</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+                for (let attendee of reqItemAtt) {</span>
<a href="#l19.19"></a><span id="l19.19">                     if (!isMinorUpdate) {</span>
<a href="#l19.20"></a><span id="l19.20">                         attendee = attendee.clone();</span>
<a href="#l19.21"></a><span id="l19.21">                         if (!attendee.role) {</span>
<a href="#l19.22"></a><span id="l19.22">                             attendee.role = &quot;REQ-PARTICIPANT&quot;;</span>
<a href="#l19.23"></a><span id="l19.23">                         }</span>
<a href="#l19.24"></a><span id="l19.24">                         attendee.participationStatus = &quot;NEEDS-ACTION&quot;;</span>
<a href="#l19.25"></a><span id="l19.25">                         attendee.rsvp = &quot;TRUE&quot;;</span>
<a href="#l19.26"></a><span id="l19.26">                         requestItem.addAttendee(attendee);</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineat">@@ -912,25 +912,25 @@ function stripUserData(item_) {</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29"> /** local to this module file</span>
<a href="#l19.30"></a><span id="l19.30">  * Takes over relevant item information from iTIP item and sets received info.</span>
<a href="#l19.31"></a><span id="l19.31">  *</span>
<a href="#l19.32"></a><span id="l19.32">  * @param item         the stored calendar item to update</span>
<a href="#l19.33"></a><span id="l19.33">  * @param itipItemItem the received item</span>
<a href="#l19.34"></a><span id="l19.34">  */</span>
<a href="#l19.35"></a><span id="l19.35"> function updateItem(item, itipItemItem) {</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineminus">-    function updateUserData(newItem, item) {</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+    function updateUserData(newItem, oldItem) {</span>
<a href="#l19.38"></a><span id="l19.38">         // preserve user settings:</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineminus">-        newItem.generation = item.generation;</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+        newItem.generation = oldItem.generation;</span>
<a href="#l19.41"></a><span id="l19.41">         newItem.clearAlarms();</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-        for (let alarm of item.getAlarms({})) {</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+        for (let alarm of oldItem.getAlarms({})) {</span>
<a href="#l19.44"></a><span id="l19.44">             newItem.addAlarm(alarm);</span>
<a href="#l19.45"></a><span id="l19.45">         }</span>
<a href="#l19.46"></a><span id="l19.46" class="difflineminus">-        newItem.alarmLastAck = item.alarmLastAck;</span>
<a href="#l19.47"></a><span id="l19.47" class="difflineminus">-        let cats = item.getCategories({});</span>
<a href="#l19.48"></a><span id="l19.48" class="difflineplus">+        newItem.alarmLastAck = oldItem.alarmLastAck;</span>
<a href="#l19.49"></a><span id="l19.49" class="difflineplus">+        let cats = oldItem.getCategories({});</span>
<a href="#l19.50"></a><span id="l19.50">         newItem.setCategories(cats.length, cats);</span>
<a href="#l19.51"></a><span id="l19.51">     }</span>
<a href="#l19.52"></a><span id="l19.52"> </span>
<a href="#l19.53"></a><span id="l19.53">     let newItem = item.clone();</span>
<a href="#l19.54"></a><span id="l19.54">     newItem.icalComponent = itipItemItem.icalComponent;</span>
<a href="#l19.55"></a><span id="l19.55">     setReceivedInfo(newItem, itipItemItem);</span>
<a href="#l19.56"></a><span id="l19.56">     updateUserData(newItem, item);</span>
<a href="#l19.57"></a><span id="l19.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -523,19 +523,19 @@ cal.ProviderBase.prototype = {</span>
<a href="#l20.4"></a><span id="l20.4">         }</span>
<a href="#l20.5"></a><span id="l20.5">         this.mID = aValue;</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7">         let calMgr = cal.getCalendarManager();</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">         // make all properties persistent that have been set so far:</span>
<a href="#l20.10"></a><span id="l20.10">         for (let aName in this.mProperties) {</span>
<a href="#l20.11"></a><span id="l20.11">             if (!cal.ProviderBase.mTransientProperties[aName]) {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-                let aValue = this.mProperties[aName];</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-                if (aValue !== null) {</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-                    calMgr.setCalendarPref_(this, aName, aValue);</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+                let value = this.mProperties[aName];</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+                if (value !== null) {</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+                    calMgr.setCalendarPref_(this, aName, value);</span>
<a href="#l20.18"></a><span id="l20.18">                 }</span>
<a href="#l20.19"></a><span id="l20.19">             }</span>
<a href="#l20.20"></a><span id="l20.20">         }</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22">         let this_ = this;</span>
<a href="#l20.23"></a><span id="l20.23">         function takeOverIfNotPresent(oldPref, newPref, dontDeleteOldPref) {</span>
<a href="#l20.24"></a><span id="l20.24">             let val = calMgr.getCalendarPref_(this_, oldPref);</span>
<a href="#l20.25"></a><span id="l20.25">             if (val !== null) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -23,19 +23,19 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l21.4"></a><span id="l21.4">     function day_of_week(day) {</span>
<a href="#l21.5"></a><span id="l21.5">         return Math.abs(day) % 8;</span>
<a href="#l21.6"></a><span id="l21.6">     }</span>
<a href="#l21.7"></a><span id="l21.7">     function day_position(day) {</span>
<a href="#l21.8"></a><span id="l21.8">         return (Math.abs(day) - day_of_week(day)) / 8 * (day &lt; 0 ? -1 : 1);</span>
<a href="#l21.9"></a><span id="l21.9">     }</span>
<a href="#l21.10"></a><span id="l21.10">     function nounClass(aDayString, aRuleString) {</span>
<a href="#l21.11"></a><span id="l21.11">         // Select noun class (grammatical gender) for rule string</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-        let nounClass = getRString(aDayString + &quot;Nounclass&quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-        return aRuleString + nounClass.substr(0, 1).toUpperCase() +</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-               nounClass.substr(1);</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+        let nounClassStr = getRString(aDayString + &quot;Nounclass&quot;);</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+        return aRuleString + nounClassStr.substr(0, 1).toUpperCase() +</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+               nounClassStr.substr(1);</span>
<a href="#l21.18"></a><span id="l21.18">     }</span>
<a href="#l21.19"></a><span id="l21.19">     function pluralWeekday(aDayString) {</span>
<a href="#l21.20"></a><span id="l21.20">         let plural = getRString(&quot;pluralForWeekdays&quot;) == &quot;true&quot;;</span>
<a href="#l21.21"></a><span id="l21.21">         return (plural ? aDayString + &quot;Plural&quot; : aDayString);</span>
<a href="#l21.22"></a><span id="l21.22">     }</span>
<a href="#l21.23"></a><span id="l21.23">     function everyWeekDay(aByDay) {</span>
<a href="#l21.24"></a><span id="l21.24">         // Checks if aByDay contains only values from 1 to 7 with any order.</span>
<a href="#l21.25"></a><span id="l21.25">         let mask = aByDay.reduce((v, c) =&gt; v | (1 &lt;&lt; c), 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -93,25 +93,24 @@ calCalendarManager.prototype = {</span>
<a href="#l22.4"></a><span id="l22.4">     cleanupOfflineObservers: function ccm_cleanupOfflineObservers() {</span>
<a href="#l22.5"></a><span id="l22.5">         Services.obs.removeObserver(this, &quot;network:offline-status-changed&quot;);</span>
<a href="#l22.6"></a><span id="l22.6">     },</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">     observe: function ccm_observe(aSubject, aTopic, aData) {</span>
<a href="#l22.9"></a><span id="l22.9">         switch (aTopic) {</span>
<a href="#l22.10"></a><span id="l22.10">             case &quot;timer-callback&quot;:</span>
<a href="#l22.11"></a><span id="l22.11">                 // Refresh all the calendars that can be refreshed.</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-                var cals = this.getCalendars({});</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-                for (var calendar of cals) {</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+                for (let calendar of this.getCalendars({})) {</span>
<a href="#l22.15"></a><span id="l22.15">                     if (!calendar.getProperty(&quot;disabled&quot;) &amp;&amp; calendar.canRefresh) {</span>
<a href="#l22.16"></a><span id="l22.16">                         calendar.refresh();</span>
<a href="#l22.17"></a><span id="l22.17">                     }</span>
<a href="#l22.18"></a><span id="l22.18">                 }</span>
<a href="#l22.19"></a><span id="l22.19">                 break;</span>
<a href="#l22.20"></a><span id="l22.20">             case &quot;network:offline-status-changed&quot;:</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-                for (var id in this.mCache) {</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+                for (let id in this.mCache) {</span>
<a href="#l22.23"></a><span id="l22.23">                     let calendar = this.mCache[id];</span>
<a href="#l22.24"></a><span id="l22.24">                     if (calendar instanceof calCachedCalendar) {</span>
<a href="#l22.25"></a><span id="l22.25">                         calendar.onOfflineStatusChanged(aData == &quot;offline&quot;);</span>
<a href="#l22.26"></a><span id="l22.26">                     }</span>
<a href="#l22.27"></a><span id="l22.27">                 }</span>
<a href="#l22.28"></a><span id="l22.28">                 break;</span>
<a href="#l22.29"></a><span id="l22.29">             case &quot;http-on-examine-response&quot;:</span>
<a href="#l22.30"></a><span id="l22.30">                 try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -862,33 +862,33 @@ calFilter.prototype = {</span>
<a href="#l23.4"></a><span id="l23.4">         // we use a local proxy listener for the calICalendar.getItems() call, and use it</span>
<a href="#l23.5"></a><span id="l23.5">         // to handle occurrence expansion and filter the results before forwarding them to</span>
<a href="#l23.6"></a><span id="l23.6">         // the listener passed in the aListener argument.</span>
<a href="#l23.7"></a><span id="l23.7">         let self = this;</span>
<a href="#l23.8"></a><span id="l23.8">         let listener = {</span>
<a href="#l23.9"></a><span id="l23.9">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l23.10"></a><span id="l23.10">             onOperationComplete: aListener.onOperationComplete.bind(aListener),</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-            onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+            onGetResult: function(aOpCalendar, aStatus, aOpItemType, aDetail, aCount, aItems) {</span>
<a href="#l23.14"></a><span id="l23.14">                 let items;</span>
<a href="#l23.15"></a><span id="l23.15">                 if (props.occurrences == props.FILTER_OCCURRENCES_PAST_AND_NEXT) {</span>
<a href="#l23.16"></a><span id="l23.16">                     // with the FILTER_OCCURRENCES_PAST_AND_NEXT occurrence filter we will</span>
<a href="#l23.17"></a><span id="l23.17">                     // get parent items returned here, so we need to let the getOccurrences</span>
<a href="#l23.18"></a><span id="l23.18">                     // function handle occurrence expansion.</span>
<a href="#l23.19"></a><span id="l23.19">                     items = [];</span>
<a href="#l23.20"></a><span id="l23.20">                     for (let item of aItems) {</span>
<a href="#l23.21"></a><span id="l23.21">                         items = items.concat(self.getOccurrences(item));</span>
<a href="#l23.22"></a><span id="l23.22">                     }</span>
<a href="#l23.23"></a><span id="l23.23">                 } else {</span>
<a href="#l23.24"></a><span id="l23.24">                     // with other occurrence filters the calICalendar.getItems() function will</span>
<a href="#l23.25"></a><span id="l23.25">                     // return expanded occurrences appropriately, we only need to filter them.</span>
<a href="#l23.26"></a><span id="l23.26">                     items = self.filterItems(aItems);</span>
<a href="#l23.27"></a><span id="l23.27">                 }</span>
<a href="#l23.28"></a><span id="l23.28"> </span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">-                aListener.onGetResult(aCalendar, aStatus, aItemType, aDetail, items.length, items);</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineplus">+                aListener.onGetResult(aOpCalendar, aStatus, aOpItemType, aDetail, items.length, items);</span>
<a href="#l23.31"></a><span id="l23.31">             }</span>
<a href="#l23.32"></a><span id="l23.32">         };</span>
<a href="#l23.33"></a><span id="l23.33"> </span>
<a href="#l23.34"></a><span id="l23.34">         // build the filter argument for calICalendar.getItems() from the filter properties</span>
<a href="#l23.35"></a><span id="l23.35">         let filter = aItemType || aCalendar.FILTER_TYPE_ALL;</span>
<a href="#l23.36"></a><span id="l23.36">         if (!props.status || (props.status &amp; (props.FILTER_STATUS_COMPLETED_TODAY |</span>
<a href="#l23.37"></a><span id="l23.37">                                               props.FILTER_STATUS_COMPLETED_BEFORE))) {</span>
<a href="#l23.38"></a><span id="l23.38">             filter |= aCalendar.ITEM_FILTER_COMPLETED_YES;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1122,32 +1122,32 @@ function checkIfInRange(item, rangeStart</span>
<a href="#l24.4"></a><span id="l24.4"> /**</span>
<a href="#l24.5"></a><span id="l24.5">  * This function return the progress state of a task:</span>
<a href="#l24.6"></a><span id="l24.6">  * completed, overdue, duetoday, inprogress, future</span>
<a href="#l24.7"></a><span id="l24.7">  *</span>
<a href="#l24.8"></a><span id="l24.8">  * @param aTask     The task to check.</span>
<a href="#l24.9"></a><span id="l24.9">  * @return          The progress atom.</span>
<a href="#l24.10"></a><span id="l24.10">  */</span>
<a href="#l24.11"></a><span id="l24.11"> function getProgressAtom(aTask) {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    var now = new Date();</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    let nowdate = new Date();</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15">     if (aTask.recurrenceInfo) {</span>
<a href="#l24.16"></a><span id="l24.16">         return &quot;repeating&quot;;</span>
<a href="#l24.17"></a><span id="l24.17">     }</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19">     if (aTask.isCompleted) {</span>
<a href="#l24.20"></a><span id="l24.20">         return &quot;completed&quot;;</span>
<a href="#l24.21"></a><span id="l24.21">     }</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23">     if (aTask.dueDate &amp;&amp; aTask.dueDate.isValid) {</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-        if (cal.dateTimeToJsDate(aTask.dueDate).getTime() &lt; now.getTime()) {</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+        if (cal.dateTimeToJsDate(aTask.dueDate).getTime() &lt; nowdate.getTime()) {</span>
<a href="#l24.26"></a><span id="l24.26">             return &quot;overdue&quot;;</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-        } else if (aTask.dueDate.year == now.getFullYear() &amp;&amp;</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-                   aTask.dueDate.month == now.getMonth() &amp;&amp;</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-                   aTask.dueDate.day == now.getDate()) {</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+        } else if (aTask.dueDate.year == nowdate.getFullYear() &amp;&amp;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+                   aTask.dueDate.month == nowdate.getMonth() &amp;&amp;</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+                   aTask.dueDate.day == nowdate.getDate()) {</span>
<a href="#l24.33"></a><span id="l24.33">             return &quot;duetoday&quot;;</span>
<a href="#l24.34"></a><span id="l24.34">         }</span>
<a href="#l24.35"></a><span id="l24.35">     }</span>
<a href="#l24.36"></a><span id="l24.36"> </span>
<a href="#l24.37"></a><span id="l24.37">     if (aTask.entryDate &amp;&amp; aTask.entryDate.isValid &amp;&amp;</span>
<a href="#l24.38"></a><span id="l24.38">         cal.dateTimeToJsDate(aTask.entryDate).getTime() &lt; now.getTime()) {</span>
<a href="#l24.39"></a><span id="l24.39">         return &quot;inprogress&quot;;</span>
<a href="#l24.40"></a><span id="l24.40">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -141,21 +141,18 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l25.4"></a><span id="l25.4"> </span>
<a href="#l25.5"></a><span id="l25.5">         // strip header from string</span>
<a href="#l25.6"></a><span id="l25.6">         str = str.slice(trimResults[0].length);</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">         let args = {};</span>
<a href="#l25.9"></a><span id="l25.9">         // args.fieldList contains the field names from the first row of CSV</span>
<a href="#l25.10"></a><span id="l25.10">         args.fieldList = header;</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        let locale;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-        let i;</span>
<a href="#l25.14"></a><span id="l25.14">         let knownIndxs;</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-        for (i in locales) {</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">-            locale = locales[i];</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+        for (let locale of locales) {</span>
<a href="#l25.18"></a><span id="l25.18">             knownIndxs = 0;</span>
<a href="#l25.19"></a><span id="l25.19">             args.titleIndex = 0;</span>
<a href="#l25.20"></a><span id="l25.20">             args.startDateIndex = 0;</span>
<a href="#l25.21"></a><span id="l25.21">             for (let i = 1; i &lt;= header.length; ++i) {</span>
<a href="#l25.22"></a><span id="l25.22">                 switch (header[i - 1]) {</span>
<a href="#l25.23"></a><span id="l25.23">                     case locale.headTitle: args.titleIndex = i; knownIndxs++; break;</span>
<a href="#l25.24"></a><span id="l25.24">                     case locale.headStartDate: args.startDateIndex = i; knownIndxs++; break;</span>
<a href="#l25.25"></a><span id="l25.25">                     case locale.headStartTime: args.startTimeIndex = i; knownIndxs++; break;</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineat">@@ -198,17 +195,17 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l25.27"></a><span id="l25.27">             dump(&quot;Can't import. Life sucks\n&quot;);</span>
<a href="#l25.28"></a><span id="l25.28">             aCount.value = 0;</span>
<a href="#l25.29"></a><span id="l25.29">             return [];</span>
<a href="#l25.30"></a><span id="l25.30">         }</span>
<a href="#l25.31"></a><span id="l25.31"> </span>
<a href="#l25.32"></a><span id="l25.32">         // Construct event regexp according to field indexes. The regexp can</span>
<a href="#l25.33"></a><span id="l25.33">         // be made stricter, if it seems this matches too loosely.</span>
<a href="#l25.34"></a><span id="l25.34">         let regExpStr = &quot;^&quot;;</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineminus">-        for (i = 1; i &lt;= header.length; i++) {</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+        for (let i = 1; i &lt;= header.length; i++) {</span>
<a href="#l25.37"></a><span id="l25.37">             if (i &gt; 1) {</span>
<a href="#l25.38"></a><span id="l25.38">                 regExpStr += &quot;,&quot;;</span>
<a href="#l25.39"></a><span id="l25.39">             }</span>
<a href="#l25.40"></a><span id="l25.40">             regExpStr += &quot;(?:\&quot;((?:[^\&quot;]|\&quot;\&quot;)*)\&quot;)?&quot;;</span>
<a href="#l25.41"></a><span id="l25.41">         }</span>
<a href="#l25.42"></a><span id="l25.42">         regExpStr += &quot;$&quot;;</span>
<a href="#l25.43"></a><span id="l25.43"> </span>
<a href="#l25.44"></a><span id="l25.44">         // eventRegExp: regexp for reading events (this one'll be constructed on fly)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/lightning/content/imip-bar.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/lightning/content/imip-bar.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -355,20 +355,20 @@ var ltnImipBar = {</span>
<a href="#l26.4"></a><span id="l26.4">                 let dialogTitle = ltnGetString(&quot;lightning&quot;, &quot;confirmProcessInvitationTitle&quot;);</span>
<a href="#l26.5"></a><span id="l26.5">                 if (delTime &amp;&amp; !Services.prompt.confirm(window, dialogTitle, dialogText)) {</span>
<a href="#l26.6"></a><span id="l26.6">                     return false;</span>
<a href="#l26.7"></a><span id="l26.7">                 }</span>
<a href="#l26.8"></a><span id="l26.8">             }</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10">             if (partStat == &quot;X-SAVECOPY&quot;) {</span>
<a href="#l26.11"></a><span id="l26.11">                 // we create and adopt copies of the respective events</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-                let items = ltnImipBar.itipItem.getItemList({}).map(cal.getPublishLikeItemCopy.bind(cal));</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-                if (items.length &gt; 0) {</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineplus">+                let saveitems = ltnImipBar.itipItem.getItemList({}).map(cal.getPublishLikeItemCopy.bind(cal));</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+                if (saveitems.length &gt; 0) {</span>
<a href="#l26.16"></a><span id="l26.16">                     let newItipItem = cal.itip.getModifiedItipItem(ltnImipBar.itipItem,</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-                                                                   items,</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+                                                                   saveitems,</span>
<a href="#l26.19"></a><span id="l26.19">                                                                    {receivedMethod: &quot;PUBLISH&quot;,</span>
<a href="#l26.20"></a><span id="l26.20">                                                                     responseMethod: &quot;PUBLISH&quot;});</span>
<a href="#l26.21"></a><span id="l26.21">                     // control to avoid processing _execAction on later user changes on the item</span>
<a href="#l26.22"></a><span id="l26.22">                     let isFirstProcessing = true;</span>
<a href="#l26.23"></a><span id="l26.23">                     // setup callback and trigger re-processing</span>
<a href="#l26.24"></a><span id="l26.24">                     let storeCopy = function storeCopy(aItipItem, aRc, aActionFunc, aFoundItems) {</span>
<a href="#l26.25"></a><span id="l26.25">                         if (isFirstProcessing &amp;&amp; aActionFunc &amp;&amp; Components.isSuccessCode(aRc)) {</span>
<a href="#l26.26"></a><span id="l26.26">                             _execAction(aActionFunc, aItipItem, window, partStat);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1503,20 +1503,20 @@ function untilDateCompensation(aItem) {</span>
<a href="#l27.4"></a><span id="l27.4">     // The current start date in the item is always the date that we get</span>
<a href="#l27.5"></a><span id="l27.5">     // when opening the dialog or after the last save.</span>
<a href="#l27.6"></a><span id="l27.6">     let startDate = aItem[calGetStartDateProp(aItem)];</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">     if (aItem.recurrenceInfo) {</span>
<a href="#l27.9"></a><span id="l27.9">         let rrules = splitRecurrenceRules(aItem.recurrenceInfo);</span>
<a href="#l27.10"></a><span id="l27.10">         let rule = rrules[0][0];</span>
<a href="#l27.11"></a><span id="l27.11">         if (!rule.isByCount &amp;&amp; rule.isFinite &amp;&amp; startDate) {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-            let untilDateCompensation = startDate.subtractDate(gStartTime);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-            if (untilDateCompensation != &quot;PT0S&quot;) {</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+            let compensation = startDate.subtractDate(gStartTime);</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+            if (compensation != &quot;PT0S&quot;) {</span>
<a href="#l27.16"></a><span id="l27.16">                 let untilDate = rule.untilDate.clone();</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">-                untilDate.addDuration(untilDateCompensation);</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+                untilDate.addDuration(compensation);</span>
<a href="#l27.19"></a><span id="l27.19">                 rule.untilDate = untilDate;</span>
<a href="#l27.20"></a><span id="l27.20">             }</span>
<a href="#l27.21"></a><span id="l27.21">         }</span>
<a href="#l27.22"></a><span id="l27.22">     }</span>
<a href="#l27.23"></a><span id="l27.23"> }</span>
<a href="#l27.24"></a><span id="l27.24"> </span>
<a href="#l27.25"></a><span id="l27.25"> /**</span>
<a href="#l27.26"></a><span id="l27.26">  * Updates the dialog title based on item type and if the item is new or to be</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineat">@@ -2184,18 +2184,18 @@ function addAttachment(attachment, cloud</span>
<a href="#l27.28"></a><span id="l27.28">                 let providerType = attachment.getParameter(&quot;PROVIDER&quot;);</span>
<a href="#l27.29"></a><span id="l27.29">                 let cloudFileEnabled = Preferences.get(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l27.30"></a><span id="l27.30"> </span>
<a href="#l27.31"></a><span id="l27.31">                 if (leafName) {</span>
<a href="#l27.32"></a><span id="l27.32">                     // TODO security issues?</span>
<a href="#l27.33"></a><span id="l27.33">                     listItem.setAttribute(&quot;label&quot;, leafName);</span>
<a href="#l27.34"></a><span id="l27.34">                 }</span>
<a href="#l27.35"></a><span id="l27.35">                 if (providerType &amp;&amp; cloudFileEnabled) {</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-                    let cloudProvider = cloudFileAccounts.getProviderForType(providerType);</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">-                    listItem.setAttribute(&quot;image&quot;, cloudProvider.iconClass);</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineplus">+                    let provider = cloudFileAccounts.getProviderForType(providerType);</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineplus">+                    listItem.setAttribute(&quot;image&quot;, provider.iconClass);</span>
<a href="#l27.40"></a><span id="l27.40">                 } else {</span>
<a href="#l27.41"></a><span id="l27.41">                     listItem.setAttribute(&quot;image&quot;, &quot;moz-icon://dummy.html&quot;);</span>
<a href="#l27.42"></a><span id="l27.42">                 }</span>
<a href="#l27.43"></a><span id="l27.43">             }</span>
<a href="#l27.44"></a><span id="l27.44">         }</span>
<a href="#l27.45"></a><span id="l27.45"> </span>
<a href="#l27.46"></a><span id="l27.46">         // Now that everything is set up, add it to the attachment box.</span>
<a href="#l27.47"></a><span id="l27.47">         documentLink.appendChild(listItem);</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineat">@@ -2256,17 +2256,16 @@ function deleteAllAttachments() {</span>
<a href="#l27.49"></a><span id="l27.49">     if (itemCount &gt; 1) {</span>
<a href="#l27.50"></a><span id="l27.50">         let removeText = PluralForm.get(itemCount, cal.calGetString(&quot;calendar-event-dialog&quot;, &quot;removeAttachmentsText&quot;));</span>
<a href="#l27.51"></a><span id="l27.51">         let removeTitle = cal.calGetString(&quot;calendar-event-dialog&quot;, &quot;removeCalendarsTitle&quot;);</span>
<a href="#l27.52"></a><span id="l27.52">         ok = Services.prompt.confirm(window, removeTitle, removeText.replace(&quot;#1&quot;, itemCount), {});</span>
<a href="#l27.53"></a><span id="l27.53">     }</span>
<a href="#l27.54"></a><span id="l27.54"> </span>
<a href="#l27.55"></a><span id="l27.55">     if (ok) {</span>
<a href="#l27.56"></a><span id="l27.56">         let child;</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineminus">-        let documentLink = document.getElementById(&quot;attachment-link&quot;);</span>
<a href="#l27.58"></a><span id="l27.58">         while (documentLink.hasChildNodes()) {</span>
<a href="#l27.59"></a><span id="l27.59">             child = documentLink.lastChild;</span>
<a href="#l27.60"></a><span id="l27.60">             child.attachment = null;</span>
<a href="#l27.61"></a><span id="l27.61">             child.remove();</span>
<a href="#l27.62"></a><span id="l27.62">         }</span>
<a href="#l27.63"></a><span id="l27.63">         gAttachMap = {};</span>
<a href="#l27.64"></a><span id="l27.64">     }</span>
<a href="#l27.65"></a><span id="l27.65">     updateAttachment();</span>
<a href="#l27.66"></a><span id="l27.66" class="difflineat">@@ -2632,18 +2631,17 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l27.67"></a><span id="l27.67">             let [repeatType, untilDate] = getRepeatTypeAndUntilDate(item);</span>
<a href="#l27.68"></a><span id="l27.68">             if (gNewItemUI) {</span>
<a href="#l27.69"></a><span id="l27.69">                 gTopComponent.importState({</span>
<a href="#l27.70"></a><span id="l27.70">                     repeat: repeatType,</span>
<a href="#l27.71"></a><span id="l27.71">                     repeatUntilDate: untilDate</span>
<a href="#l27.72"></a><span id="l27.72">                 });</span>
<a href="#l27.73"></a><span id="l27.73">                 // XXX more to do, see loadRepeat</span>
<a href="#l27.74"></a><span id="l27.74">             } else {</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineminus">-                let item = window.calendarItem;</span>
<a href="#l27.76"></a><span id="l27.76" class="difflineminus">-                loadRepeat(repeatType, untilDate, item);</span>
<a href="#l27.77"></a><span id="l27.77" class="difflineplus">+                loadRepeat(repeatType, untilDate, window.calendarItem);</span>
<a href="#l27.78"></a><span id="l27.78">             }</span>
<a href="#l27.79"></a><span id="l27.79">         }</span>
<a href="#l27.80"></a><span id="l27.80">     } else {</span>
<a href="#l27.81"></a><span id="l27.81">         let item = window.calendarItem;</span>
<a href="#l27.82"></a><span id="l27.82">         let recurrenceInfo = window.recurrenceInfo || item.recurrenceInfo;</span>
<a href="#l27.83"></a><span id="l27.83">         let proposedUntilDate = (gStartTime || window.initialStartDateValue).clone();</span>
<a href="#l27.84"></a><span id="l27.84"> </span>
<a href="#l27.85"></a><span id="l27.85">         if (recurrenceInfo) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1678,17 +1678,16 @@ calDavCalendar.prototype = {</span>
<a href="#l28.4"></a><span id="l28.4">      * checkServerCaps</span>
<a href="#l28.5"></a><span id="l28.5">      * findPrincipalNS</span>
<a href="#l28.6"></a><span id="l28.6">      * checkPrincipalsNameSpace</span>
<a href="#l28.7"></a><span id="l28.7">      * completeCheckServerInfo</span>
<a href="#l28.8"></a><span id="l28.8">      */</span>
<a href="#l28.9"></a><span id="l28.9">     checkDavResourceType: function caldav_checkDavResourceType(aChangeLogListener) {</span>
<a href="#l28.10"></a><span id="l28.10">         this.ensureTargetCalendar();</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        let resourceTypeXml = null;</span>
<a href="#l28.13"></a><span id="l28.13">         let resourceType = kDavResourceTypeNone;</span>
<a href="#l28.14"></a><span id="l28.14">         let thisCalendar = this;</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16">         let queryXml =</span>
<a href="#l28.17"></a><span id="l28.17">             xmlHeader +</span>
<a href="#l28.18"></a><span id="l28.18">             '&lt;D:propfind xmlns:D=&quot;DAV:&quot; xmlns:CS=&quot;http://calendarserver.org/ns/&quot; xmlns:C=&quot;urn:ietf:params:xml:ns:caldav&quot;&gt;' +</span>
<a href="#l28.19"></a><span id="l28.19">               '&lt;D:prop&gt;' +</span>
<a href="#l28.20"></a><span id="l28.20">                 '&lt;D:resourcetype/&gt;' +</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineat">@@ -2491,37 +2490,37 @@ calDavCalendar.prototype = {</span>
<a href="#l28.22"></a><span id="l28.22">                 if (status.substr(0, 3) != &quot;2.0&quot;) {</span>
<a href="#l28.23"></a><span id="l28.23">                     cal.LOG(&quot;CalDAV: Got status &quot; + status + &quot; in response to &quot; +</span>
<a href="#l28.24"></a><span id="l28.24">                             &quot;freebusy query for&quot; + thisCalendar.name);</span>
<a href="#l28.25"></a><span id="l28.25">                 }</span>
<a href="#l28.26"></a><span id="l28.26"> </span>
<a href="#l28.27"></a><span id="l28.27">                 let caldata = caldavXPathFirst(fbResult, &quot;/C:schedule-response/C:response/C:calendar-data/text()&quot;);</span>
<a href="#l28.28"></a><span id="l28.28">                 try {</span>
<a href="#l28.29"></a><span id="l28.29">                     let calComp = cal.getIcsService().parseICS(caldata, null);</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">-                    for (let fbComp of cal.ical.calendarComponentIterator(calComp)) {</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+                    for (let calFbComp of cal.ical.calendarComponentIterator(calComp)) {</span>
<a href="#l28.32"></a><span id="l28.32">                         let interval;</span>
<a href="#l28.33"></a><span id="l28.33"> </span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">-                        let replyRangeStart = fbComp.startTime;</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineplus">+                        let replyRangeStart = calFbComp.startTime;</span>
<a href="#l28.36"></a><span id="l28.36">                         if (replyRangeStart &amp;&amp; (aRangeStart.compare(replyRangeStart) == -1)) {</span>
<a href="#l28.37"></a><span id="l28.37">                             interval = new cal.FreeBusyInterval(aCalId,</span>
<a href="#l28.38"></a><span id="l28.38">                                                                 calIFreeBusyInterval.UNKNOWN,</span>
<a href="#l28.39"></a><span id="l28.39">                                                                 aRangeStart,</span>
<a href="#l28.40"></a><span id="l28.40">                                                                 replyRangeStart);</span>
<a href="#l28.41"></a><span id="l28.41">                             periodsToReturn.push(interval);</span>
<a href="#l28.42"></a><span id="l28.42">                         }</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineminus">-                        let replyRangeEnd = fbComp.endTime;</span>
<a href="#l28.44"></a><span id="l28.44" class="difflineplus">+                        let replyRangeEnd = calFbComp.endTime;</span>
<a href="#l28.45"></a><span id="l28.45">                         if (replyRangeEnd &amp;&amp; (aRangeEnd.compare(replyRangeEnd) == 1)) {</span>
<a href="#l28.46"></a><span id="l28.46">                             interval = new cal.FreeBusyInterval(aCalId,</span>
<a href="#l28.47"></a><span id="l28.47">                                                                 calIFreeBusyInterval.UNKNOWN,</span>
<a href="#l28.48"></a><span id="l28.48">                                                                 replyRangeEnd,</span>
<a href="#l28.49"></a><span id="l28.49">                                                                 aRangeEnd);</span>
<a href="#l28.50"></a><span id="l28.50">                             periodsToReturn.push(interval);</span>
<a href="#l28.51"></a><span id="l28.51">                         }</span>
<a href="#l28.52"></a><span id="l28.52"> </span>
<a href="#l28.53"></a><span id="l28.53" class="difflineminus">-                        for (let fbProp of cal.ical.propertyIterator(fbComp, &quot;FREEBUSY&quot;)) {</span>
<a href="#l28.54"></a><span id="l28.54" class="difflineplus">+                        for (let fbProp of cal.ical.propertyIterator(calFbComp, &quot;FREEBUSY&quot;)) {</span>
<a href="#l28.55"></a><span id="l28.55">                             let fbType = fbProp.getParameter(&quot;FBTYPE&quot;);</span>
<a href="#l28.56"></a><span id="l28.56">                             if (fbType) {</span>
<a href="#l28.57"></a><span id="l28.57">                                 fbType = fbTypeMap[fbType];</span>
<a href="#l28.58"></a><span id="l28.58">                             } else {</span>
<a href="#l28.59"></a><span id="l28.59">                                 fbType = calIFreeBusyInterval.BUSY;</span>
<a href="#l28.60"></a><span id="l28.60">                             }</span>
<a href="#l28.61"></a><span id="l28.61">                             let parts = fbProp.value.split(&quot;/&quot;);</span>
<a href="#l28.62"></a><span id="l28.62">                             let begin = cal.createDateTime(parts[0]);</span>
<a href="#l28.63"></a><span id="l28.63" class="difflineat">@@ -2811,18 +2810,18 @@ calDavCalendar.prototype = {</span>
<a href="#l28.64"></a><span id="l28.64">                     var remainingAttendees = [];</span>
<a href="#l28.65"></a><span id="l28.65">                     // TODO The following XPath expressions are currently</span>
<a href="#l28.66"></a><span id="l28.66">                     // untested code, as I don't have a caldav-sched server</span>
<a href="#l28.67"></a><span id="l28.67">                     // available. If you find someone who does, please test!</span>
<a href="#l28.68"></a><span id="l28.68">                     let responses = caldavXPath(responseXML, &quot;/C:schedule-response/C:response&quot;);</span>
<a href="#l28.69"></a><span id="l28.69">                     if (responses) {</span>
<a href="#l28.70"></a><span id="l28.70">                         for (let response of responses) {</span>
<a href="#l28.71"></a><span id="l28.71">                             let recip = caldavXPathFirst(response, &quot;C:recipient/D:href/text()&quot;);</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineminus">-                            let status = caldavXPathFirst(response, &quot;C:request-status/text()&quot;);</span>
<a href="#l28.73"></a><span id="l28.73" class="difflineminus">-                            if (status.substr(0, 1) != &quot;2&quot;) {</span>
<a href="#l28.74"></a><span id="l28.74" class="difflineplus">+                            let reqstatus = caldavXPathFirst(response, &quot;C:request-status/text()&quot;);</span>
<a href="#l28.75"></a><span id="l28.75" class="difflineplus">+                            if (reqstatus.substr(0, 1) != &quot;2&quot;) {</span>
<a href="#l28.76"></a><span id="l28.76">                                 if (thisCalendar.verboseLogging()) {</span>
<a href="#l28.77"></a><span id="l28.77">                                     cal.LOG(&quot;CalDAV: Failed scheduling delivery to &quot; + recip);</span>
<a href="#l28.78"></a><span id="l28.78">                                 }</span>
<a href="#l28.79"></a><span id="l28.79">                                 for (let att of aRecipients) {</span>
<a href="#l28.80"></a><span id="l28.80">                                     if (att.id.toLowerCase() == recip.toLowerCase()) {</span>
<a href="#l28.81"></a><span id="l28.81">                                         remainingAttendees.push(att);</span>
<a href="#l28.82"></a><span id="l28.82">                                         break;</span>
<a href="#l28.83"></a><span id="l28.83">                                     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -793,17 +793,17 @@ calICSCalendar.prototype = {</span>
<a href="#l29.4"></a><span id="l29.4">         channel.loadFlags |= Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE;</span>
<a href="#l29.5"></a><span id="l29.5">         channel.notificationCallbacks = this;</span>
<a href="#l29.6"></a><span id="l29.6"> </span>
<a href="#l29.7"></a><span id="l29.7">         var downloader = Components.classes[&quot;@mozilla.org/network/downloader;1&quot;]</span>
<a href="#l29.8"></a><span id="l29.8">                                    .createInstance(CI.nsIDownloader);</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10">         var savedthis = this;</span>
<a href="#l29.11"></a><span id="l29.11">         var listener = {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-            onDownloadComplete: function(downloader, request, ctxt, status, result) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+            onDownloadComplete: function(opdownloader, request, ctxt, status, result) {</span>
<a href="#l29.14"></a><span id="l29.14">                 if (doInitialBackup) {</span>
<a href="#l29.15"></a><span id="l29.15">                     copyToOverwriting(result, backupDir, makeName('initial'));</span>
<a href="#l29.16"></a><span id="l29.16">                 }</span>
<a href="#l29.17"></a><span id="l29.17">                 if (doDailyBackup) {</span>
<a href="#l29.18"></a><span id="l29.18">                     copyToOverwriting(result, backupDir, dailyBackupFileName);</span>
<a href="#l29.19"></a><span id="l29.19">                 }</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21">                 aCallback.call(savedthis);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -468,17 +468,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">     modifyItem: function cSC_modifyItem(aNewItem, aOldItem, aListener) {</span>
<a href="#l30.5"></a><span id="l30.5">         let this_ = this;</span>
<a href="#l30.6"></a><span id="l30.6"> </span>
<a href="#l30.7"></a><span id="l30.7">         // HACK Just modifying the item would clear the offline flag, we need to</span>
<a href="#l30.8"></a><span id="l30.8">         // retrieve the flag and pass it to the real modify function.</span>
<a href="#l30.9"></a><span id="l30.9">         let offlineJournalFlagListener = {</span>
<a href="#l30.10"></a><span id="l30.10">             onGetResult: function(calendar, status, opType, id, detail) {</span>
<a href="#l30.11"></a><span id="l30.11">             },</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-            onOperationComplete: function(this_, status, opType, id, offlineFlag) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+            onOperationComplete: function(opcalendar, status, opType, id, offlineFlag) {</span>
<a href="#l30.14"></a><span id="l30.14">                 this_.doModifyItem(aNewItem, aOldItem, aListener, offlineFlag);</span>
<a href="#l30.15"></a><span id="l30.15">             }</span>
<a href="#l30.16"></a><span id="l30.16">         };</span>
<a href="#l30.17"></a><span id="l30.17">         this.getItemOfflineFlag(aOldItem, offlineJournalFlagListener);</span>
<a href="#l30.18"></a><span id="l30.18">     },</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">     doModifyItem: function cSC_doModifyItem(aNewItem, aOldItem, aListener, offlineFlag) {</span>
<a href="#l30.21"></a><span id="l30.21">         let oldOfflineFlag = offlineFlag;</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -1707,31 +1707,30 @@ calStorageCalendar.prototype = {</span>
<a href="#l30.23"></a><span id="l30.23">             } catch (e) {</span>
<a href="#l30.24"></a><span id="l30.24">                 this.logError(&quot;Error getting attendees for item '&quot; +</span>
<a href="#l30.25"></a><span id="l30.25">                               item.title + &quot;' (&quot; + item.id + &quot;)!&quot;, e);</span>
<a href="#l30.26"></a><span id="l30.26">             } finally {</span>
<a href="#l30.27"></a><span id="l30.27">                 selectItem.reset();</span>
<a href="#l30.28"></a><span id="l30.28">             }</span>
<a href="#l30.29"></a><span id="l30.29">         }</span>
<a href="#l30.30"></a><span id="l30.30"> </span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-        let row;</span>
<a href="#l30.32"></a><span id="l30.32">         if (flags &amp; CAL_ITEM_FLAG.HAS_PROPERTIES) {</span>
<a href="#l30.33"></a><span id="l30.33">             let selectItem = null;</span>
<a href="#l30.34"></a><span id="l30.34">             if (item.recurrenceId == null) {</span>
<a href="#l30.35"></a><span id="l30.35">                 selectItem = this.mSelectPropertiesForItem;</span>
<a href="#l30.36"></a><span id="l30.36">             } else {</span>
<a href="#l30.37"></a><span id="l30.37">                 selectItem = this.mSelectPropertiesForItemWithRecurrenceId;</span>
<a href="#l30.38"></a><span id="l30.38">                 this.setDateParamHelper(selectItem.params, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l30.39"></a><span id="l30.39">             }</span>
<a href="#l30.40"></a><span id="l30.40"> </span>
<a href="#l30.41"></a><span id="l30.41">             try {</span>
<a href="#l30.42"></a><span id="l30.42">                 this.prepareStatement(selectItem);</span>
<a href="#l30.43"></a><span id="l30.43">                 selectItem.params.item_id = item.id;</span>
<a href="#l30.44"></a><span id="l30.44">                 while (selectItem.executeStep()) {</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineminus">-                    row = selectItem.row;</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+                    let row = selectItem.row;</span>
<a href="#l30.47"></a><span id="l30.47">                     let name = row.key;</span>
<a href="#l30.48"></a><span id="l30.48">                     switch (name) {</span>
<a href="#l30.49"></a><span id="l30.49">                         case &quot;DURATION&quot;:</span>
<a href="#l30.50"></a><span id="l30.50">                             // for events DTEND/DUE is enforced by calEvent/calTodo, so suppress DURATION:</span>
<a href="#l30.51"></a><span id="l30.51">                             break;</span>
<a href="#l30.52"></a><span id="l30.52">                         case &quot;CATEGORIES&quot;: {</span>
<a href="#l30.53"></a><span id="l30.53">                             let cats = categoriesStringToArray(row.value);</span>
<a href="#l30.54"></a><span id="l30.54">                             item.setCategories(cats.length, cats);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -1140,28 +1140,28 @@ upgrade.v16 = function upgrade_v16(db, v</span>
<a href="#l31.4"></a><span id="l31.4">             item_id: &quot;TEXT&quot;,</span>
<a href="#l31.5"></a><span id="l31.5">             // Note the following two columns were not originally part of the</span>
<a href="#l31.6"></a><span id="l31.6">             // v16 upgrade, see note above function.</span>
<a href="#l31.7"></a><span id="l31.7">             recurrence_id: &quot;INTEGER&quot;,</span>
<a href="#l31.8"></a><span id="l31.8">             recurrence_id_tz: &quot;TEXT&quot;,</span>
<a href="#l31.9"></a><span id="l31.9">             icalString: &quot;TEXT&quot;</span>
<a href="#l31.10"></a><span id="l31.10">         }, db);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-        let copyDataOver = function copyDataOver(tbl) {</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+        let copyDataOver = function copyDataOver(tblName) {</span>
<a href="#l31.14"></a><span id="l31.14">             const transAlarm = &quot;translateAlarm(alarm_offset, &quot; +</span>
<a href="#l31.15"></a><span id="l31.15">                                               &quot;alarm_related, &quot; +</span>
<a href="#l31.16"></a><span id="l31.16">                                               &quot;alarm_time, &quot; +</span>
<a href="#l31.17"></a><span id="l31.17">                                               &quot;alarm_time_tz)&quot;;</span>
<a href="#l31.18"></a><span id="l31.18">             executeSimpleSQL(db, &quot;INSERT INTO cal_alarms (cal_id, item_id,&quot; +</span>
<a href="#l31.19"></a><span id="l31.19">                                  &quot;                        recurrence_id, &quot; +</span>
<a href="#l31.20"></a><span id="l31.20">                                  &quot;                        recurrence_id_tz, &quot; +</span>
<a href="#l31.21"></a><span id="l31.21">                                  &quot;                        icalString)&quot; +</span>
<a href="#l31.22"></a><span id="l31.22">                                  &quot; SELECT cal_id, id, recurrence_id,&quot; +</span>
<a href="#l31.23"></a><span id="l31.23">                                  &quot;        recurrence_id_tz, &quot; + transAlarm +</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">-                                 &quot;   FROM &quot; + tbl +</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineplus">+                                 &quot;   FROM &quot; + tblName +</span>
<a href="#l31.26"></a><span id="l31.26">                                  &quot;  WHERE alarm_offset IS NOT NULL&quot; +</span>
<a href="#l31.27"></a><span id="l31.27">                                  &quot;     OR alarm_time IS NOT NULL;&quot;);</span>
<a href="#l31.28"></a><span id="l31.28">         };</span>
<a href="#l31.29"></a><span id="l31.29">         copyDataOver(&quot;cal_events&quot;);</span>
<a href="#l31.30"></a><span id="l31.30">         copyDataOver(&quot;cal_todos&quot;);</span>
<a href="#l31.31"></a><span id="l31.31">         removeFunction(db, &quot;translateAlarm&quot;);</span>
<a href="#l31.32"></a><span id="l31.32"> </span>
<a href="#l31.33"></a><span id="l31.33">         // Make sure the alarm flag is set on the item</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -302,23 +302,23 @@ calWcapCalendar.prototype = {</span>
<a href="#l32.4"></a><span id="l32.4">         var ret = filterXmlNodes(propName, this.m_calProps);</span>
<a href="#l32.5"></a><span id="l32.5">         if (out_count) {</span>
<a href="#l32.6"></a><span id="l32.6">             out_count.value = ret.length;</span>
<a href="#l32.7"></a><span id="l32.7">         }</span>
<a href="#l32.8"></a><span id="l32.8">         return ret;</span>
<a href="#l32.9"></a><span id="l32.9">     },</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11">     get defaultTimezone() {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-        var tzid = this.getCalendarProperties(&quot;X-NSCP-CALPROPS-TZID&quot;);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+        let tzid = this.getCalendarProperties(&quot;X-NSCP-CALPROPS-TZID&quot;);</span>
<a href="#l32.14"></a><span id="l32.14">         if (tzid.length &gt; 0) { // first try server-configured tz:</span>
<a href="#l32.15"></a><span id="l32.15">             return tzid[0];</span>
<a href="#l32.16"></a><span id="l32.16">         } else {</span>
<a href="#l32.17"></a><span id="l32.17">             logWarning(&quot;defaultTimezone: cannot get X-NSCP-CALPROPS-TZID!&quot;, this);</span>
<a href="#l32.18"></a><span id="l32.18">             // try to use local one if supported:</span>
<a href="#l32.19"></a><span id="l32.19" class="difflineminus">-            let tzid = cal.getTimezoneService().defaultTimezone.tzid;</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineplus">+            tzid = cal.getTimezoneService().defaultTimezone.tzid;</span>
<a href="#l32.21"></a><span id="l32.21">             return (this.session.getTimezone(tzid) ? tzid : &quot;UTC&quot;);</span>
<a href="#l32.22"></a><span id="l32.22">         }</span>
<a href="#l32.23"></a><span id="l32.23">     },</span>
<a href="#l32.24"></a><span id="l32.24"> </span>
<a href="#l32.25"></a><span id="l32.25">     getAlignedTzid: function calWcapCalendar_getAlignedTzid(tz) {</span>
<a href="#l32.26"></a><span id="l32.26">         var tzid = tz.tzid;</span>
<a href="#l32.27"></a><span id="l32.27">         // check whether it is one cs supports:</span>
<a href="#l32.28"></a><span id="l32.28">         if (tz.isFloating || !this.session.getTimezone(tzid)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -275,18 +275,18 @@ function diffProperty(newItem, oldItem, </span>
<a href="#l33.4"></a><span id="l33.4"> var METHOD_PUBLISH = 1;</span>
<a href="#l33.5"></a><span id="l33.5"> var METHOD_REQUEST = 2;</span>
<a href="#l33.6"></a><span id="l33.6"> var METHOD_REPLY = 4;</span>
<a href="#l33.7"></a><span id="l33.7"> var METHOD_CANCEL = 8;</span>
<a href="#l33.8"></a><span id="l33.8"> var METHOD_UPDATE = 256;</span>
<a href="#l33.9"></a><span id="l33.9"> </span>
<a href="#l33.10"></a><span id="l33.10"> calWcapCalendar.prototype.storeItem =</span>
<a href="#l33.11"></a><span id="l33.11"> function calWcapCalendar_storeItem(bAddItem, item, oldItem, request) {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    function getOrgId(item) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-        return (item &amp;&amp; item.organizer &amp;&amp; item.organizer.id ? item.organizer.id : null);</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+    function getOrgId(orgItem) {</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+        return (orgItem &amp;&amp; orgItem.organizer &amp;&amp; orgItem.organizer.id ? orgItem.organizer.id : null);</span>
<a href="#l33.16"></a><span id="l33.16">     }</span>
<a href="#l33.17"></a><span id="l33.17">     function encodeAttendees(atts) {</span>
<a href="#l33.18"></a><span id="l33.18">         function attendeeSort(one, two) {</span>
<a href="#l33.19"></a><span id="l33.19">             one = one.id;</span>
<a href="#l33.20"></a><span id="l33.20">             two = two.id;</span>
<a href="#l33.21"></a><span id="l33.21">             if (one == two) {</span>
<a href="#l33.22"></a><span id="l33.22">                 return 0;</span>
<a href="#l33.23"></a><span id="l33.23">             }</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineat">@@ -296,22 +296,22 @@ function calWcapCalendar_storeItem(bAddI</span>
<a href="#l33.25"></a><span id="l33.25">         atts.sort(attendeeSort);</span>
<a href="#l33.26"></a><span id="l33.26">         return atts.map(this_.encodeAttendee, this_).join(&quot;;&quot;);</span>
<a href="#l33.27"></a><span id="l33.27">     }</span>
<a href="#l33.28"></a><span id="l33.28">     function encodeCategories(cats) {</span>
<a href="#l33.29"></a><span id="l33.29">         cats = cats.concat([]);</span>
<a href="#l33.30"></a><span id="l33.30">         cats.sort();</span>
<a href="#l33.31"></a><span id="l33.31">         return cats.join(&quot;;&quot;);</span>
<a href="#l33.32"></a><span id="l33.32">     }</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineminus">-    function getPrivacy(item) {</span>
<a href="#l33.34"></a><span id="l33.34" class="difflineminus">-        return ((item.privacy &amp;&amp; item.privacy != &quot;&quot;) ? item.privacy : &quot;PUBLIC&quot;);</span>
<a href="#l33.35"></a><span id="l33.35" class="difflineplus">+    function getPrivacy(pitem) {</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineplus">+        return ((pitem.privacy &amp;&amp; pitem.privacy != &quot;&quot;) ? pitem.privacy : &quot;PUBLIC&quot;);</span>
<a href="#l33.37"></a><span id="l33.37">     }</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineminus">-    function getAttachments(item) {</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineplus">+    function getAttachments(attitem) {</span>
<a href="#l33.40"></a><span id="l33.40">         var ret;</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineminus">-        var attachments = item.attachments;</span>
<a href="#l33.42"></a><span id="l33.42" class="difflineplus">+        var attachments = attitem.attachments;</span>
<a href="#l33.43"></a><span id="l33.43">         if (attachments) {</span>
<a href="#l33.44"></a><span id="l33.44">             var strings = [];</span>
<a href="#l33.45"></a><span id="l33.45">             for (var att of attachments) {</span>
<a href="#l33.46"></a><span id="l33.46">                 let wrappedAtt = cal.wrapInstance(att, Components.interfaces.calIAttachment);</span>
<a href="#l33.47"></a><span id="l33.47">                 if (typeof att == &quot;string&quot;) {</span>
<a href="#l33.48"></a><span id="l33.48">                     strings.push(encodeURIComponent(att));</span>
<a href="#l33.49"></a><span id="l33.49">                 } else if (wrappedAtt &amp;&amp; wrappedAtt.uri) {</span>
<a href="#l33.50"></a><span id="l33.50">                     strings.push(encodeURIComponent(wrappedAtt.uri.spec));</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineat">@@ -632,17 +632,17 @@ function calWcapCalendar_tunnelXProps(de</span>
<a href="#l33.52"></a><span id="l33.52">         }</span>
<a href="#l33.53"></a><span id="l33.53">     }</span>
<a href="#l33.54"></a><span id="l33.54"> };</span>
<a href="#l33.55"></a><span id="l33.55"> </span>
<a href="#l33.56"></a><span id="l33.56"> calWcapCalendar.prototype.adoptItem =</span>
<a href="#l33.57"></a><span id="l33.57"> function calWcapCalendar_adoptItem(item, listener) {</span>
<a href="#l33.58"></a><span id="l33.58">     var this_ = this;</span>
<a href="#l33.59"></a><span id="l33.59">     var request = new calWcapRequest(</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineminus">-        function adoptItem_resp(request, err, newItem) {</span>
<a href="#l33.61"></a><span id="l33.61" class="difflineplus">+        function adoptItem_resp(oprequest, err, newItem) {</span>
<a href="#l33.62"></a><span id="l33.62">             this_.notifyOperationComplete(listener,</span>
<a href="#l33.63"></a><span id="l33.63">                                           getResultCode(err),</span>
<a href="#l33.64"></a><span id="l33.64">                                           calIOperationListener.ADD,</span>
<a href="#l33.65"></a><span id="l33.65">                                           err ? item.id : newItem.id,</span>
<a href="#l33.66"></a><span id="l33.66">                                           err ? err : newItem);</span>
<a href="#l33.67"></a><span id="l33.67">             if (!err &amp;&amp; this_ == this_.superCalendar) {</span>
<a href="#l33.68"></a><span id="l33.68">                 this_.notifyObservers(&quot;onAddItem&quot;, [newItem]);</span>
<a href="#l33.69"></a><span id="l33.69">             }</span>
<a href="#l33.70"></a><span id="l33.70" class="difflineat">@@ -661,17 +661,17 @@ calWcapCalendar.prototype.addItem =</span>
<a href="#l33.71"></a><span id="l33.71"> function calWcapCalendar_addItem(item, listener) {</span>
<a href="#l33.72"></a><span id="l33.72">     this.adoptItem(item.clone(), listener);</span>
<a href="#l33.73"></a><span id="l33.73"> };</span>
<a href="#l33.74"></a><span id="l33.74"> </span>
<a href="#l33.75"></a><span id="l33.75"> calWcapCalendar.prototype.modifyItem =</span>
<a href="#l33.76"></a><span id="l33.76"> function calWcapCalendar_modifyItem(newItem, oldItem, listener) {</span>
<a href="#l33.77"></a><span id="l33.77">     var this_ = this;</span>
<a href="#l33.78"></a><span id="l33.78">     var request = new calWcapRequest(</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineminus">-        function modifyItem_resp(request, err, item) {</span>
<a href="#l33.80"></a><span id="l33.80" class="difflineplus">+        function modifyItem_resp(oprequest, err, item) {</span>
<a href="#l33.81"></a><span id="l33.81">             this_.notifyOperationComplete(listener,</span>
<a href="#l33.82"></a><span id="l33.82">                                           getResultCode(err),</span>
<a href="#l33.83"></a><span id="l33.83">                                           calIOperationListener.MODIFY,</span>
<a href="#l33.84"></a><span id="l33.84">                                           newItem.id, err ? err : item);</span>
<a href="#l33.85"></a><span id="l33.85">             if (!err &amp;&amp; this_ == this_.superCalendar) {</span>
<a href="#l33.86"></a><span id="l33.86">                 this_.notifyObservers(&quot;onModifyItem&quot;, [item, oldItem]);</span>
<a href="#l33.87"></a><span id="l33.87">             }</span>
<a href="#l33.88"></a><span id="l33.88">         },</span>
<a href="#l33.89"></a><span id="l33.89" class="difflineat">@@ -742,17 +742,17 @@ function calWcapCalendar_modifyItem(newI</span>
<a href="#l33.90"></a><span id="l33.90">     }</span>
<a href="#l33.91"></a><span id="l33.91">     return request;</span>
<a href="#l33.92"></a><span id="l33.92"> };</span>
<a href="#l33.93"></a><span id="l33.93"> </span>
<a href="#l33.94"></a><span id="l33.94"> calWcapCalendar.prototype.deleteItem =</span>
<a href="#l33.95"></a><span id="l33.95"> function calWcapCalendar_deleteItem(item, listener) {</span>
<a href="#l33.96"></a><span id="l33.96">     var this_ = this;</span>
<a href="#l33.97"></a><span id="l33.97">     var request = new calWcapRequest(</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineminus">-        function deleteItem_resp(request, err) {</span>
<a href="#l33.99"></a><span id="l33.99" class="difflineplus">+        function deleteItem_resp(oprequest, err) {</span>
<a href="#l33.100"></a><span id="l33.100">             // xxx todo: need to notify about each deleted item if multiple?</span>
<a href="#l33.101"></a><span id="l33.101">             this_.notifyOperationComplete(listener,</span>
<a href="#l33.102"></a><span id="l33.102">                                           getResultCode(err),</span>
<a href="#l33.103"></a><span id="l33.103">                                           calIOperationListener.DELETE,</span>
<a href="#l33.104"></a><span id="l33.104">                                           item.id, err ? err : item);</span>
<a href="#l33.105"></a><span id="l33.105">             if (!err &amp;&amp; this_ == this_.superCalendar) {</span>
<a href="#l33.106"></a><span id="l33.106">                 this_.notifyObservers(&quot;onDeleteItem&quot;, [item]);</span>
<a href="#l33.107"></a><span id="l33.107">             }</span>
<a href="#l33.108"></a><span id="l33.108" class="difflineat">@@ -1034,17 +1034,17 @@ calWcapCalendar.prototype.parseItems = f</span>
<a href="#l33.109"></a><span id="l33.109">     }</span>
<a href="#l33.110"></a><span id="l33.110">     return items;</span>
<a href="#l33.111"></a><span id="l33.111"> };</span>
<a href="#l33.112"></a><span id="l33.112"> </span>
<a href="#l33.113"></a><span id="l33.113"> calWcapCalendar.prototype.getItem =</span>
<a href="#l33.114"></a><span id="l33.114"> function calWcapCalendar_getItem(id, listener) {</span>
<a href="#l33.115"></a><span id="l33.115">     var this_ = this;</span>
<a href="#l33.116"></a><span id="l33.116">     var request = new calWcapRequest(</span>
<a href="#l33.117"></a><span id="l33.117" class="difflineminus">-        function getItem_resp(request, err, item) {</span>
<a href="#l33.118"></a><span id="l33.118" class="difflineplus">+        function getItem_resp(oprequest, err, item) {</span>
<a href="#l33.119"></a><span id="l33.119">             if (checkErrorCode(err, calIWcapErrors.WCAP_FETCH_EVENTS_BY_ID_FAILED) ||</span>
<a href="#l33.120"></a><span id="l33.120">                 checkErrorCode(err, calIWcapErrors.WCAP_COMPONENT_NOT_FOUND)) {</span>
<a href="#l33.121"></a><span id="l33.121">                 // querying by id is a valid use case, even if no item is returned:</span>
<a href="#l33.122"></a><span id="l33.122">                 err = NS_OK;</span>
<a href="#l33.123"></a><span id="l33.123">             }</span>
<a href="#l33.124"></a><span id="l33.124">             this_.notifyOperationComplete(listener,</span>
<a href="#l33.125"></a><span id="l33.125">                                           getResultCode(err),</span>
<a href="#l33.126"></a><span id="l33.126">                                           calIOperationListener.GET,</span>
<a href="#l33.127"></a><span id="l33.127" class="difflineat">@@ -1059,19 +1059,19 @@ function calWcapCalendar_getItem(id, lis</span>
<a href="#l33.128"></a><span id="l33.128">         }</span>
<a href="#l33.129"></a><span id="l33.129">         var params = &quot;&amp;relativealarm=1&amp;compressed=1&amp;recurring=1&quot;;</span>
<a href="#l33.130"></a><span id="l33.130">         params += &quot;&amp;emailorcalid=1&amp;fmt-out=text%2Fcalendar&amp;uid=&quot;;</span>
<a href="#l33.131"></a><span id="l33.131">         params += encodeURIComponent(id);</span>
<a href="#l33.132"></a><span id="l33.132"> </span>
<a href="#l33.133"></a><span id="l33.133">         // most common: try events first</span>
<a href="#l33.134"></a><span id="l33.134">         this.issueNetworkRequest(</span>
<a href="#l33.135"></a><span id="l33.135">             request,</span>
<a href="#l33.136"></a><span id="l33.136" class="difflineminus">-            function fetchEventById_resp(err, icalRootComp) {</span>
<a href="#l33.137"></a><span id="l33.137" class="difflineminus">-                function notifyResult(icalRootComp) {</span>
<a href="#l33.138"></a><span id="l33.138" class="difflineminus">-                    var items = this_.parseItems(icalRootComp, calICalendar.ITEM_FILTER_ALL_ITEMS, 0, null, null);</span>
<a href="#l33.139"></a><span id="l33.139" class="difflineplus">+            function fetchEventById_resp(err, eventRootComp) {</span>
<a href="#l33.140"></a><span id="l33.140" class="difflineplus">+                function notifyResult(rootComp) {</span>
<a href="#l33.141"></a><span id="l33.141" class="difflineplus">+                    var items = this_.parseItems(rootComp, calICalendar.ITEM_FILTER_ALL_ITEMS, 0, null, null);</span>
<a href="#l33.142"></a><span id="l33.142">                     if (items.length &lt; 1) {</span>
<a href="#l33.143"></a><span id="l33.143">                         throw new Components.Exception(&quot;no such item!&quot;);</span>
<a href="#l33.144"></a><span id="l33.144">                     }</span>
<a href="#l33.145"></a><span id="l33.145">                     if (items.length &gt; 1) {</span>
<a href="#l33.146"></a><span id="l33.146">                         this_.notifyError(NS_ERROR_UNEXPECTED,</span>
<a href="#l33.147"></a><span id="l33.147">                                           &quot;unexpected number of items: &quot; + items.length);</span>
<a href="#l33.148"></a><span id="l33.148">                     }</span>
<a href="#l33.149"></a><span id="l33.149">                     if (listener) {</span>
<a href="#l33.150"></a><span id="l33.150" class="difflineat">@@ -1084,25 +1084,25 @@ function calWcapCalendar_getItem(id, lis</span>
<a href="#l33.151"></a><span id="l33.151">                 if (err) {</span>
<a href="#l33.152"></a><span id="l33.152">                     if (!checkErrorCode(err, calIWcapErrors.WCAP_FETCH_EVENTS_BY_ID_FAILED) &amp;&amp;</span>
<a href="#l33.153"></a><span id="l33.153">                         !checkErrorCode(err, calIWcapErrors.WCAP_COMPONENT_NOT_FOUND)) {</span>
<a href="#l33.154"></a><span id="l33.154">                         throw err;</span>
<a href="#l33.155"></a><span id="l33.155">                     }</span>
<a href="#l33.156"></a><span id="l33.156">                     // try todos:</span>
<a href="#l33.157"></a><span id="l33.157">                     this_.issueNetworkRequest(</span>
<a href="#l33.158"></a><span id="l33.158">                         request,</span>
<a href="#l33.159"></a><span id="l33.159" class="difflineminus">-                        function fetchTodosById_resp(err, icalRootComp) {</span>
<a href="#l33.160"></a><span id="l33.160" class="difflineminus">-                            if (err) {</span>
<a href="#l33.161"></a><span id="l33.161" class="difflineminus">-                                throw err;</span>
<a href="#l33.162"></a><span id="l33.162" class="difflineplus">+                        function fetchTodosById_resp(fetcherr, todoRootComp) {</span>
<a href="#l33.163"></a><span id="l33.163" class="difflineplus">+                            if (fetcherr) {</span>
<a href="#l33.164"></a><span id="l33.164" class="difflineplus">+                                throw fetcherr;</span>
<a href="#l33.165"></a><span id="l33.165">                             }</span>
<a href="#l33.166"></a><span id="l33.166" class="difflineminus">-                            notifyResult(icalRootComp);</span>
<a href="#l33.167"></a><span id="l33.167" class="difflineplus">+                            notifyResult(todoRootComp);</span>
<a href="#l33.168"></a><span id="l33.168">                         },</span>
<a href="#l33.169"></a><span id="l33.169">                         stringToIcal, &quot;fetchtodos_by_id&quot;, params, calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l33.170"></a><span id="l33.170">                 } else {</span>
<a href="#l33.171"></a><span id="l33.171" class="difflineminus">-                    notifyResult(icalRootComp);</span>
<a href="#l33.172"></a><span id="l33.172" class="difflineplus">+                    notifyResult(eventRootComp);</span>
<a href="#l33.173"></a><span id="l33.173">                 }</span>
<a href="#l33.174"></a><span id="l33.174">             },</span>
<a href="#l33.175"></a><span id="l33.175">             stringToIcal, &quot;fetchevents_by_id&quot;, params, calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l33.176"></a><span id="l33.176">     } catch (exc) {</span>
<a href="#l33.177"></a><span id="l33.177">         request.execRespFunc(exc);</span>
<a href="#l33.178"></a><span id="l33.178">     }</span>
<a href="#l33.179"></a><span id="l33.179">     return request;</span>
<a href="#l33.180"></a><span id="l33.180"> };</span>
<a href="#l33.181"></a><span id="l33.181" class="difflineat">@@ -1145,17 +1145,17 @@ calWcapCalendar.prototype.getItems =</span>
<a href="#l33.182"></a><span id="l33.182"> function calWcapCalendar_getItems(itemFilter, maxResults, rangeStart, rangeEnd, listener) {</span>
<a href="#l33.183"></a><span id="l33.183">     rangeStart = ensureDateTime(rangeStart);</span>
<a href="#l33.184"></a><span id="l33.184">     rangeEnd = ensureDateTime(rangeEnd);</span>
<a href="#l33.185"></a><span id="l33.185">     var zRangeStart = getIcalUTC(rangeStart);</span>
<a href="#l33.186"></a><span id="l33.186">     var zRangeEnd = getIcalUTC(rangeEnd);</span>
<a href="#l33.187"></a><span id="l33.187"> </span>
<a href="#l33.188"></a><span id="l33.188">     var this_ = this;</span>
<a href="#l33.189"></a><span id="l33.189">     var request = new calWcapRequest(</span>
<a href="#l33.190"></a><span id="l33.190" class="difflineminus">-        function getItems_resp(request, err, data) {</span>
<a href="#l33.191"></a><span id="l33.191" class="difflineplus">+        function getItems_resp(oprequest, err, data) {</span>
<a href="#l33.192"></a><span id="l33.192">             log(&quot;getItems() complete: &quot; + errorToString(err), this_);</span>
<a href="#l33.193"></a><span id="l33.193">             this_.notifyOperationComplete(listener,</span>
<a href="#l33.194"></a><span id="l33.194">                                           getResultCode(err),</span>
<a href="#l33.195"></a><span id="l33.195">                                           calIOperationListener.GET,</span>
<a href="#l33.196"></a><span id="l33.196">                                           null,</span>
<a href="#l33.197"></a><span id="l33.197">                                           err);</span>
<a href="#l33.198"></a><span id="l33.198">         },</span>
<a href="#l33.199"></a><span id="l33.199">         log(&quot;getItems():\n\titemFilter=0x&quot; + itemFilter.toString(0x10) +</span>
<a href="#l33.200"></a><span id="l33.200" class="difflineat">@@ -1173,17 +1173,17 @@ function calWcapCalendar_getItems(itemFi</span>
<a href="#l33.201"></a><span id="l33.201">     // m_cachedResults holds the last data revtrieval. This is expecially useful when</span>
<a href="#l33.202"></a><span id="l33.202">     // switching on multiple subcriptions: the composite calendar multiplexes getItems()</span>
<a href="#l33.203"></a><span id="l33.203">     // calls to all composited calendars over and over again, most often on the same</span>
<a href="#l33.204"></a><span id="l33.204">     // date range (as the user usually looks at the same view).</span>
<a href="#l33.205"></a><span id="l33.205">     // This will most likely vanish when a better caching is implemented in the views,</span>
<a href="#l33.206"></a><span id="l33.206">     // or WCAP local storage caching has sufficient performance.</span>
<a href="#l33.207"></a><span id="l33.207">     // The cached results will be invalidated after 2 minutes to reflect incoming invitations.</span>
<a href="#l33.208"></a><span id="l33.208">     if (CACHE_LAST_RESULTS &gt; 0 &amp;&amp; this.m_cachedResults) {</span>
<a href="#l33.209"></a><span id="l33.209" class="difflineminus">-        for (var entry of this.m_cachedResults) {</span>
<a href="#l33.210"></a><span id="l33.210" class="difflineplus">+        for (let entry of this.m_cachedResults) {</span>
<a href="#l33.211"></a><span id="l33.211">             if ((itemFilter == entry.itemFilter) &amp;&amp;</span>
<a href="#l33.212"></a><span id="l33.212">                 equalDatetimes(rangeStart, entry.rangeStart) &amp;&amp;</span>
<a href="#l33.213"></a><span id="l33.213">                 equalDatetimes(rangeEnd, entry.rangeEnd)) {</span>
<a href="#l33.214"></a><span id="l33.214">                 log(&quot;reusing last getItems() cached data.&quot;, this);</span>
<a href="#l33.215"></a><span id="l33.215">                 if (listener) {</span>
<a href="#l33.216"></a><span id="l33.216">                     listener.onGetResult(</span>
<a href="#l33.217"></a><span id="l33.217">                         this.superCalendar, NS_OK, calIItemBase,</span>
<a href="#l33.218"></a><span id="l33.218">                         &quot;getItems()&quot;, entry.results.length, entry.results);</span>
<a href="#l33.219"></a><span id="l33.219" class="difflineat">@@ -1209,22 +1209,22 @@ function calWcapCalendar_getItems(itemFi</span>
<a href="#l33.220"></a><span id="l33.220">             function netResp(err, icalRootComp) {</span>
<a href="#l33.221"></a><span id="l33.221">                 if (err) {</span>
<a href="#l33.222"></a><span id="l33.222">                     if (checkErrorCode(err, calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR)) {</span>
<a href="#l33.223"></a><span id="l33.223">                         // try free-busy times:</span>
<a href="#l33.224"></a><span id="l33.224">                         if (listener &amp;&amp;</span>
<a href="#l33.225"></a><span id="l33.225">                             (itemFilter &amp; calICalendar.ITEM_FILTER_TYPE_EVENT) &amp;&amp;</span>
<a href="#l33.226"></a><span id="l33.226">                             rangeStart &amp;&amp; rangeEnd) {</span>
<a href="#l33.227"></a><span id="l33.227">                             var freeBusyListener = { // calIGenericOperationListener:</span>
<a href="#l33.228"></a><span id="l33.228" class="difflineminus">-                                onResult: function freeBusyListener_onResult(request, result) {</span>
<a href="#l33.229"></a><span id="l33.229" class="difflineminus">-                                    if (!Components.isSuccessCode(request.status)) {</span>
<a href="#l33.230"></a><span id="l33.230" class="difflineminus">-                                        throw request.status;</span>
<a href="#l33.231"></a><span id="l33.231" class="difflineplus">+                                onResult: function freeBusyListener_onResult(oprequest, result) {</span>
<a href="#l33.232"></a><span id="l33.232" class="difflineplus">+                                    if (!Components.isSuccessCode(oprequest.status)) {</span>
<a href="#l33.233"></a><span id="l33.233" class="difflineplus">+                                        throw oprequest.status;</span>
<a href="#l33.234"></a><span id="l33.234">                                     }</span>
<a href="#l33.235"></a><span id="l33.235">                                     var items = [];</span>
<a href="#l33.236"></a><span id="l33.236" class="difflineminus">-                                    for (var entry of result) {</span>
<a href="#l33.237"></a><span id="l33.237" class="difflineplus">+                                    for (let entry of result) {</span>
<a href="#l33.238"></a><span id="l33.238">                                         var item = createEvent();</span>
<a href="#l33.239"></a><span id="l33.239">                                         item.id = (g_busyPhantomItemUuidPrefix + getIcalUTC(entry.interval.start));</span>
<a href="#l33.240"></a><span id="l33.240">                                         item.calendar = this_.superCalendar;</span>
<a href="#l33.241"></a><span id="l33.241">                                         item.title = g_busyItemTitle;</span>
<a href="#l33.242"></a><span id="l33.242">                                         item.startDate = entry.interval.start;</span>
<a href="#l33.243"></a><span id="l33.243">                                         item.endDate = entry.interval.end;</span>
<a href="#l33.244"></a><span id="l33.244">                                         item.makeImmutable();</span>
<a href="#l33.245"></a><span id="l33.245">                                         items.push(item);</span>
<a href="#l33.246"></a><span id="l33.246" class="difflineat">@@ -1249,52 +1249,52 @@ function calWcapCalendar_getItems(itemFi</span>
<a href="#l33.247"></a><span id="l33.247">                     if (CACHE_LAST_RESULTS &gt; 0) {</span>
<a href="#l33.248"></a><span id="l33.248">                         // auto invalidate after X minutes:</span>
<a href="#l33.249"></a><span id="l33.249">                         if (!this_.m_cachedResultsTimer) {</span>
<a href="#l33.250"></a><span id="l33.250">                             var callback = {</span>
<a href="#l33.251"></a><span id="l33.251">                                 notify: function notify(timer) {</span>
<a href="#l33.252"></a><span id="l33.252">                                     if (!this_.m_cachedResults) {</span>
<a href="#l33.253"></a><span id="l33.253">                                         return;</span>
<a href="#l33.254"></a><span id="l33.254">                                     }</span>
<a href="#l33.255"></a><span id="l33.255" class="difflineminus">-                                    var now = (new Date()).getTime();</span>
<a href="#l33.256"></a><span id="l33.256" class="difflineplus">+                                    let now = (new Date()).getTime();</span>
<a href="#l33.257"></a><span id="l33.257">                                     // sort out old entries:</span>
<a href="#l33.258"></a><span id="l33.258" class="difflineminus">-                                    var entries = [];</span>
<a href="#l33.259"></a><span id="l33.259" class="difflineminus">-                                    for (var i = 0; i &lt; this_.m_cachedResults.length; ++i) {</span>
<a href="#l33.260"></a><span id="l33.260" class="difflineminus">-                                        var entry = this_.m_cachedResults[i];</span>
<a href="#l33.261"></a><span id="l33.261" class="difflineplus">+                                    let entries = [];</span>
<a href="#l33.262"></a><span id="l33.262" class="difflineplus">+                                    for (let i = 0; i &lt; this_.m_cachedResults.length; ++i) {</span>
<a href="#l33.263"></a><span id="l33.263" class="difflineplus">+                                        let entry = this_.m_cachedResults[i];</span>
<a href="#l33.264"></a><span id="l33.264">                                         if ((now - entry.stamp) &lt; (CACHE_LAST_RESULTS_INVALIDATE * 1000)) {</span>
<a href="#l33.265"></a><span id="l33.265">                                             entries.push(entry);</span>
<a href="#l33.266"></a><span id="l33.266">                                         } else {</span>
<a href="#l33.267"></a><span id="l33.267">                                             log(&quot;invalidating cached entry:\n\trangeStart=&quot; +</span>
<a href="#l33.268"></a><span id="l33.268">                                                 getIcalUTC(entry.rangeStart) + &quot;\n\trangeEnd=&quot; +</span>
<a href="#l33.269"></a><span id="l33.269">                                                 getIcalUTC(entry.rangeEnd), this_);</span>
<a href="#l33.270"></a><span id="l33.270">                                         }</span>
<a href="#l33.271"></a><span id="l33.271">                                     }</span>
<a href="#l33.272"></a><span id="l33.272">                                     this_.m_cachedResults = entries;</span>
<a href="#l33.273"></a><span id="l33.273">                                 }</span>
<a href="#l33.274"></a><span id="l33.274">                             };</span>
<a href="#l33.275"></a><span id="l33.275">                             // sort out freq:</span>
<a href="#l33.276"></a><span id="l33.276" class="difflineminus">-                            var freq = Math.min(20, // default: 20secs</span>
<a href="#l33.277"></a><span id="l33.277" class="difflineplus">+                            let freq = Math.min(20, // default: 20secs</span>
<a href="#l33.278"></a><span id="l33.278">                                                 Math.max(1, CACHE_LAST_RESULTS_INVALIDATE));</span>
<a href="#l33.279"></a><span id="l33.279">                             log(&quot;cached results sort out timer freq: &quot; + freq, this_);</span>
<a href="#l33.280"></a><span id="l33.280">                             this_.m_cachedResultsTimer = Components.classes[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l33.281"></a><span id="l33.281">                                                                    .createInstance(Components.interfaces.nsITimer);</span>
<a href="#l33.282"></a><span id="l33.282">                             this_.m_cachedResultsTimer.initWithCallback(callback, freq * 1000,</span>
<a href="#l33.283"></a><span id="l33.283">                                                                         Components.interfaces.nsITimer.TYPE_REPEATING_SLACK);</span>
<a href="#l33.284"></a><span id="l33.284">                         }</span>
<a href="#l33.285"></a><span id="l33.285">                         if (!this_.m_cachedResults) {</span>
<a href="#l33.286"></a><span id="l33.286">                             this_.m_cachedResults = [];</span>
<a href="#l33.287"></a><span id="l33.287">                         }</span>
<a href="#l33.288"></a><span id="l33.288" class="difflineminus">-                        var entry = {</span>
<a href="#l33.289"></a><span id="l33.289" class="difflineplus">+                        let cacheEntry = {</span>
<a href="#l33.290"></a><span id="l33.290">                             stamp: (new Date()).getTime(),</span>
<a href="#l33.291"></a><span id="l33.291">                             itemFilter: itemFilter,</span>
<a href="#l33.292"></a><span id="l33.292">                             rangeStart: (rangeStart ? rangeStart.clone() : null),</span>
<a href="#l33.293"></a><span id="l33.293">                             rangeEnd: (rangeEnd ? rangeEnd.clone() : null),</span>
<a href="#l33.294"></a><span id="l33.294">                             results: items</span>
<a href="#l33.295"></a><span id="l33.295">                         };</span>
<a href="#l33.296"></a><span id="l33.296" class="difflineminus">-                        this_.m_cachedResults.unshift(entry);</span>
<a href="#l33.297"></a><span id="l33.297" class="difflineplus">+                        this_.m_cachedResults.unshift(cacheEntry);</span>
<a href="#l33.298"></a><span id="l33.298">                         if (this_.m_cachedResults.length &gt; CACHE_LAST_RESULTS) {</span>
<a href="#l33.299"></a><span id="l33.299">                             this_.m_cachedResults.length = CACHE_LAST_RESULTS;</span>
<a href="#l33.300"></a><span id="l33.300">                         }</span>
<a href="#l33.301"></a><span id="l33.301">                     }</span>
<a href="#l33.302"></a><span id="l33.302"> </span>
<a href="#l33.303"></a><span id="l33.303">                     listener.onGetResult(this_.superCalendar, NS_OK, calIItemBase, &quot;getItems()&quot;, items.length, items);</span>
<a href="#l33.304"></a><span id="l33.304">                 }</span>
<a href="#l33.305"></a><span id="l33.305">             },</span>
<a href="#l33.306"></a><span id="l33.306" class="difflineat">@@ -1401,34 +1401,34 @@ function calWcapCalendar_replayChangesOn</span>
<a href="#l33.307"></a><span id="l33.307">                         dtFrom = this_.session.getServerTime(dtFrom);</span>
<a href="#l33.308"></a><span id="l33.308">                     }</span>
<a href="#l33.309"></a><span id="l33.309">                     params += (&quot;&amp;dtstart=&quot; + getIcalUTC(dtFrom));</span>
<a href="#l33.310"></a><span id="l33.310">                     params += (&quot;&amp;dtend=&quot; + getIcalUTC(this_.session.getServerTime(now)));</span>
<a href="#l33.311"></a><span id="l33.311"> </span>
<a href="#l33.312"></a><span id="l33.312">                     log(&quot;replayChangesOn(): getting last modifications...&quot;, this_);</span>
<a href="#l33.313"></a><span id="l33.313">                     this_.issueNetworkRequest(</span>
<a href="#l33.314"></a><span id="l33.314">                         request,</span>
<a href="#l33.315"></a><span id="l33.315" class="difflineminus">-                        function modifiedNetResp(err, icalRootComp) {</span>
<a href="#l33.316"></a><span id="l33.316" class="difflineminus">-                            if (err) {</span>
<a href="#l33.317"></a><span id="l33.317" class="difflineminus">-                                throw err;</span>
<a href="#l33.318"></a><span id="l33.318" class="difflineplus">+                        function modifiedNetResp(fetcherr, icalRootComp) {</span>
<a href="#l33.319"></a><span id="l33.319" class="difflineplus">+                            if (fetcherr) {</span>
<a href="#l33.320"></a><span id="l33.320" class="difflineplus">+                                throw fetcherr;</span>
<a href="#l33.321"></a><span id="l33.321">                             }</span>
<a href="#l33.322"></a><span id="l33.322">                             request.m_modifiedItems = this_.parseItems(icalRootComp,</span>
<a href="#l33.323"></a><span id="l33.323">                                                                        calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l33.324"></a><span id="l33.324">                                                                        0, null, null);</span>
<a href="#l33.325"></a><span id="l33.325">                         },</span>
<a href="#l33.326"></a><span id="l33.326">                         stringToIcal, &quot;fetchcomponents_by_lastmod&quot;,</span>
<a href="#l33.327"></a><span id="l33.327">                         params + getItemFilterParams(itemFilter),</span>
<a href="#l33.328"></a><span id="l33.328">                         calIWcapCalendar.AC_COMP_READ);</span>
<a href="#l33.329"></a><span id="l33.329"> </span>
<a href="#l33.330"></a><span id="l33.330">                     log(&quot;replayChangesOn(): getting deleted items...&quot;, this_);</span>
<a href="#l33.331"></a><span id="l33.331">                     this_.issueNetworkRequest(</span>
<a href="#l33.332"></a><span id="l33.332">                         request,</span>
<a href="#l33.333"></a><span id="l33.333" class="difflineminus">-                        function modifiedNetResp(err, icalRootComp) {</span>
<a href="#l33.334"></a><span id="l33.334" class="difflineminus">-                            if (err) {</span>
<a href="#l33.335"></a><span id="l33.335" class="difflineminus">-                                throw err;</span>
<a href="#l33.336"></a><span id="l33.336" class="difflineplus">+                        function modifiedNetResp(fetcherr, icalRootComp) {</span>
<a href="#l33.337"></a><span id="l33.337" class="difflineplus">+                            if (fetcherr) {</span>
<a href="#l33.338"></a><span id="l33.338" class="difflineplus">+                                throw fetcherr;</span>
<a href="#l33.339"></a><span id="l33.339">                             }</span>
<a href="#l33.340"></a><span id="l33.340">                             request.m_deletedItems = this_.parseItems(icalRootComp,</span>
<a href="#l33.341"></a><span id="l33.341">                                                                       calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l33.342"></a><span id="l33.342">                                                                       0, null, null);</span>
<a href="#l33.343"></a><span id="l33.343">                         },</span>
<a href="#l33.344"></a><span id="l33.344">                         stringToIcal, &quot;fetch_deletedcomponents&quot;,</span>
<a href="#l33.345"></a><span id="l33.345">                         params + getItemFilterParams(itemFilter &amp; // only component types</span>
<a href="#l33.346"></a><span id="l33.346">                                                      calICalendar.ITEM_FILTER_TYPE_ALL),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -73,20 +73,20 @@ function getWcapSessionFor(calendar, uri</span>
<a href="#l34.4"></a><span id="l34.4">             log(&quot;default calendar found.&quot;, defaultCal);</span>
<a href="#l34.5"></a><span id="l34.5"> </span>
<a href="#l34.6"></a><span id="l34.6">             // check and fix changing urls (autoconf) of subscribed calendars here:</span>
<a href="#l34.7"></a><span id="l34.7">             for (let regCal of registeredCalendars) {</span>
<a href="#l34.8"></a><span id="l34.8">                 if (!regCal.isDefaultCalendar) {</span>
<a href="#l34.9"></a><span id="l34.9">                     let [spec, params] = splitUriParams(regCal.uri);</span>
<a href="#l34.10"></a><span id="l34.10">                     if (spec != defaultSpec) {</span>
<a href="#l34.11"></a><span id="l34.11">                         log(&quot;fixing url of subscribed calendar: &quot; + regCal.calId, session);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-                        let uri = regCal.uri.clone();</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-                        uri.spec = (defaultSpec + params);</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-                        regCal.uri = uri;</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineminus">-                        regCal.setProperty(&quot;uri&quot;, uri.spec);</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+                        let caluri = regCal.uri.clone();</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+                        caluri.spec = (defaultSpec + params);</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineplus">+                        regCal.uri = caluri;</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineplus">+                        regCal.setProperty(&quot;uri&quot;, caluri.spec);</span>
<a href="#l34.20"></a><span id="l34.20">                     }</span>
<a href="#l34.21"></a><span id="l34.21">                 }</span>
<a href="#l34.22"></a><span id="l34.22">             }</span>
<a href="#l34.23"></a><span id="l34.23">         } else { // no default calendar found, dump all subscribed calendars:</span>
<a href="#l34.24"></a><span id="l34.24">             registeredCalendars.forEach(cal.getCalendarManager().unregisterCalendar,</span>
<a href="#l34.25"></a><span id="l34.25">                                         cal.getCalendarManager());</span>
<a href="#l34.26"></a><span id="l34.26">         }</span>
<a href="#l34.27"></a><span id="l34.27">     }</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineat">@@ -276,47 +276,47 @@ calWcapSession.prototype = {</span>
<a href="#l34.29"></a><span id="l34.29">                 var outPW = { value: this_.credentials.pw };</span>
<a href="#l34.30"></a><span id="l34.30">                 var outSavePW = { value: false };</span>
<a href="#l34.31"></a><span id="l34.31"> </span>
<a href="#l34.32"></a><span id="l34.32">                 if (outUser.value &amp;&amp; !outPW.value) { // lookup pw manager</span>
<a href="#l34.33"></a><span id="l34.33">                     log(&quot;looking in pw db for: &quot; + this_.uri.spec, this_);</span>
<a href="#l34.34"></a><span id="l34.34">                     cal.auth.passwordManagerGet(outUser.value, outPW, this_.uri.spec, &quot;wcap login&quot;);</span>
<a href="#l34.35"></a><span id="l34.35">                 }</span>
<a href="#l34.36"></a><span id="l34.36"> </span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-                function promptAndLoginLoop_resp(err, sessionId) {</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-                    if (checkErrorCode(err, calIWcapErrors.WCAP_LOGIN_FAILED)) {</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineplus">+                function promptAndLoginLoop_resp(loginerr, sessionId) {</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineplus">+                    if (checkErrorCode(loginerr, calIWcapErrors.WCAP_LOGIN_FAILED)) {</span>
<a href="#l34.41"></a><span id="l34.41">                         log(&quot;prompting for [user/]pw...&quot;, this_);</span>
<a href="#l34.42"></a><span id="l34.42">                         if (cal.auth.getCredentials(cal.calGetString(&quot;wcap&quot;, &quot;loginDialog.label&quot;),</span>
<a href="#l34.43"></a><span id="l34.43">                                                     this_.sessionUri.hostPort,</span>
<a href="#l34.44"></a><span id="l34.44">                                                     outUser,</span>
<a href="#l34.45"></a><span id="l34.45">                                                     outPW,</span>
<a href="#l34.46"></a><span id="l34.46">                                                     outSavePW,</span>
<a href="#l34.47"></a><span id="l34.47">                                                     this_.credentials.userId != null)) {</span>
<a href="#l34.48"></a><span id="l34.48">                             this_.login(request, promptAndLoginLoop_resp,</span>
<a href="#l34.49"></a><span id="l34.49">                                         outUser.value, outPW.value);</span>
<a href="#l34.50"></a><span id="l34.50">                         } else {</span>
<a href="#l34.51"></a><span id="l34.51">                             log(&quot;login prompt cancelled.&quot;, this_);</span>
<a href="#l34.52"></a><span id="l34.52">                             this_.defaultCalendar.setProperty(&quot;disabled&quot;, true);</span>
<a href="#l34.53"></a><span id="l34.53">                             this_.defaultCalendar.setProperty(&quot;auto-enabled&quot;, true);</span>
<a href="#l34.54"></a><span id="l34.54">                             respFunc(new Components.Exception(errorToString(calIWcapErrors.WCAP_LOGIN_FAILED),</span>
<a href="#l34.55"></a><span id="l34.55">                                                               calIWcapErrors.WCAP_LOGIN_FAILED));</span>
<a href="#l34.56"></a><span id="l34.56">                         }</span>
<a href="#l34.57"></a><span id="l34.57" class="difflineminus">-                    } else if (err) {</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineminus">-                        respFunc(err);</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineplus">+                    } else if (loginerr) {</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineplus">+                        respFunc(loginerr);</span>
<a href="#l34.61"></a><span id="l34.61">                     } else {</span>
<a href="#l34.62"></a><span id="l34.62">                         if (outSavePW.value) {</span>
<a href="#l34.63"></a><span id="l34.63">                             // so try to remove old pw from db first:</span>
<a href="#l34.64"></a><span id="l34.64">                             cal.auth.passwordManagerSave(outUser.value, outPW.value, this_.uri.spec, &quot;wcap login&quot;);</span>
<a href="#l34.65"></a><span id="l34.65">                         }</span>
<a href="#l34.66"></a><span id="l34.66">                         this_.credentials.userId = outUser.value;</span>
<a href="#l34.67"></a><span id="l34.67">                         this_.credentials.pw = outPW.value;</span>
<a href="#l34.68"></a><span id="l34.68">                         this_.setupSession(sessionId,</span>
<a href="#l34.69"></a><span id="l34.69">                                            request,</span>
<a href="#l34.70"></a><span id="l34.70" class="difflineminus">-                                           function setupSession_resp(err) {</span>
<a href="#l34.71"></a><span id="l34.71" class="difflineminus">-                                               respFunc(err, sessionId);</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineplus">+                                           function setupSession_resp(setuperr) {</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineplus">+                                               respFunc(setuperr, sessionId);</span>
<a href="#l34.74"></a><span id="l34.74">                                            });</span>
<a href="#l34.75"></a><span id="l34.75">                     }</span>
<a href="#l34.76"></a><span id="l34.76">                 }</span>
<a href="#l34.77"></a><span id="l34.77"> </span>
<a href="#l34.78"></a><span id="l34.78">                 if (outPW.value) {</span>
<a href="#l34.79"></a><span id="l34.79">                     this_.login(request, promptAndLoginLoop_resp, outUser.value, outPW.value);</span>
<a href="#l34.80"></a><span id="l34.80">                 } else {</span>
<a href="#l34.81"></a><span id="l34.81">                     promptAndLoginLoop_resp(calIWcapErrors.WCAP_LOGIN_FAILED);</span>
<a href="#l34.82"></a><span id="l34.82" class="difflineat">@@ -367,24 +367,24 @@ calWcapSession.prototype = {</span>
<a href="#l34.83"></a><span id="l34.83">             this_.sessionUri.spec + &quot;login.wcap?fmt-out=text%2Fcalendar&amp;user=&quot; +</span>
<a href="#l34.84"></a><span id="l34.84">             encodeURIComponent(user) + &quot;&amp;password=&quot; + encodeURIComponent(pw),</span>
<a href="#l34.85"></a><span id="l34.85">             false /* no logging */);</span>
<a href="#l34.86"></a><span id="l34.86">     },</span>
<a href="#l34.87"></a><span id="l34.87"> </span>
<a href="#l34.88"></a><span id="l34.88">     logout: function calWcapSession_logout(listener) {</span>
<a href="#l34.89"></a><span id="l34.89">         var this_ = this;</span>
<a href="#l34.90"></a><span id="l34.90">         var request = new calWcapRequest(</span>
<a href="#l34.91"></a><span id="l34.91" class="difflineminus">-            function logout_resp(request, err) {</span>
<a href="#l34.92"></a><span id="l34.92" class="difflineplus">+            function logout_resp(oprequest, err) {</span>
<a href="#l34.93"></a><span id="l34.93">                 if (err) {</span>
<a href="#l34.94"></a><span id="l34.94">                     logError(err, this_);</span>
<a href="#l34.95"></a><span id="l34.95">                 } else {</span>
<a href="#l34.96"></a><span id="l34.96">                     log(&quot;logout succeeded.&quot;, this_);</span>
<a href="#l34.97"></a><span id="l34.97">                 }</span>
<a href="#l34.98"></a><span id="l34.98">                 if (listener) {</span>
<a href="#l34.99"></a><span id="l34.99" class="difflineminus">-                    listener.onResult(request, null);</span>
<a href="#l34.100"></a><span id="l34.100" class="difflineplus">+                    listener.onResult(oprequest, null);</span>
<a href="#l34.101"></a><span id="l34.101">                 }</span>
<a href="#l34.102"></a><span id="l34.102">             },</span>
<a href="#l34.103"></a><span id="l34.103">             log(&quot;logout&quot;, this));</span>
<a href="#l34.104"></a><span id="l34.104"> </span>
<a href="#l34.105"></a><span id="l34.105">         var url = null;</span>
<a href="#l34.106"></a><span id="l34.106">         if (this.m_sessionId) {</span>
<a href="#l34.107"></a><span id="l34.107">             log(&quot;attempting to log out...&quot;, this);</span>
<a href="#l34.108"></a><span id="l34.108">             // although io service's offline flag is already</span>
<a href="#l34.109"></a><span id="l34.109" class="difflineat">@@ -465,17 +465,17 @@ calWcapSession.prototype = {</span>
<a href="#l34.110"></a><span id="l34.110">                 respFunc(err);</span>
<a href="#l34.111"></a><span id="l34.111">             },</span>
<a href="#l34.112"></a><span id="l34.112">             this_.sessionUri.spec + &quot;version.wcap?fmt-out=text%2Fcalendar&quot;);</span>
<a href="#l34.113"></a><span id="l34.113">     },</span>
<a href="#l34.114"></a><span id="l34.114"> </span>
<a href="#l34.115"></a><span id="l34.115">     setupSession: function calWcapSession_setupSession(sessionId, request_, respFunc) {</span>
<a href="#l34.116"></a><span id="l34.116">         var this_ = this;</span>
<a href="#l34.117"></a><span id="l34.117">         var request = new calWcapRequest(</span>
<a href="#l34.118"></a><span id="l34.118" class="difflineminus">-            function setupSession_resp(request_, err) {</span>
<a href="#l34.119"></a><span id="l34.119" class="difflineplus">+            function setupSession_resp(oprequest, err) {</span>
<a href="#l34.120"></a><span id="l34.120">                 log(&quot;setupSession_resp finished: &quot; + errorToString(err), this_);</span>
<a href="#l34.121"></a><span id="l34.121">                 respFunc(err);</span>
<a href="#l34.122"></a><span id="l34.122">             },</span>
<a href="#l34.123"></a><span id="l34.123">             log(&quot;setupSession&quot;, this));</span>
<a href="#l34.124"></a><span id="l34.124">         if (request_) {</span>
<a href="#l34.125"></a><span id="l34.125">             request_.attachSubRequest(request);</span>
<a href="#l34.126"></a><span id="l34.126">         }</span>
<a href="#l34.127"></a><span id="l34.127"> </span>
<a href="#l34.128"></a><span id="l34.128" class="difflineat">@@ -609,31 +609,31 @@ calWcapSession.prototype = {</span>
<a href="#l34.129"></a><span id="l34.129">     installCalProps_search_calprops:</span>
<a href="#l34.130"></a><span id="l34.130">     function calWcapSession_installCalProps_search_calprops(respFunc, sessionId, cals, request) {</span>
<a href="#l34.131"></a><span id="l34.131">         var this_ = this;</span>
<a href="#l34.132"></a><span id="l34.132">         var retrievedCals = {};</span>
<a href="#l34.133"></a><span id="l34.133">         var issuedSearchRequests = {};</span>
<a href="#l34.134"></a><span id="l34.134">         for (var calId in cals) {</span>
<a href="#l34.135"></a><span id="l34.135">             if (!retrievedCals[calId]) {</span>
<a href="#l34.136"></a><span id="l34.136">                 var listener = {</span>
<a href="#l34.137"></a><span id="l34.137" class="difflineminus">-                    onResult: function search_onResult(request, result) {</span>
<a href="#l34.138"></a><span id="l34.138" class="difflineplus">+                    onResult: function search_onResult(oprequest, result) {</span>
<a href="#l34.139"></a><span id="l34.139">                         try {</span>
<a href="#l34.140"></a><span id="l34.140" class="difflineminus">-                            if (!Components.isSuccessCode(request.status)) {</span>
<a href="#l34.141"></a><span id="l34.141" class="difflineminus">-                                throw request.status;</span>
<a href="#l34.142"></a><span id="l34.142" class="difflineplus">+                            if (!Components.isSuccessCode(oprequest.status)) {</span>
<a href="#l34.143"></a><span id="l34.143" class="difflineplus">+                                throw oprequest.status;</span>
<a href="#l34.144"></a><span id="l34.144">                             }</span>
<a href="#l34.145"></a><span id="l34.145">                             if (result.length &lt; 1) {</span>
<a href="#l34.146"></a><span id="l34.146">                                 throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l34.147"></a><span id="l34.147">                             }</span>
<a href="#l34.148"></a><span id="l34.148">                             for (let calendar of result) {</span>
<a href="#l34.149"></a><span id="l34.149">                                 // user may have dangling users referred in his subscription list, so</span>
<a href="#l34.150"></a><span id="l34.150">                                 // retrieve each by each, don't break:</span>
<a href="#l34.151"></a><span id="l34.151">                                 try {</span>
<a href="#l34.152"></a><span id="l34.152" class="difflineminus">-                                    var calId = calendar.calId;</span>
<a href="#l34.153"></a><span id="l34.153" class="difflineminus">-                                    if ((cals[calId] !== undefined) &amp;&amp; !retrievedCals[calId]) {</span>
<a href="#l34.154"></a><span id="l34.154" class="difflineminus">-                                        retrievedCals[calId] = calendar;</span>
<a href="#l34.155"></a><span id="l34.155" class="difflineplus">+                                    let thisCalId = calendar.calId;</span>
<a href="#l34.156"></a><span id="l34.156" class="difflineplus">+                                    if ((cals[thisCalId] !== undefined) &amp;&amp; !retrievedCals[thisCalId]) {</span>
<a href="#l34.157"></a><span id="l34.157" class="difflineplus">+                                        retrievedCals[thisCalId] = calendar;</span>
<a href="#l34.158"></a><span id="l34.158">                                         if (respFunc) {</span>
<a href="#l34.159"></a><span id="l34.159">                                             respFunc(calendar);</span>
<a href="#l34.160"></a><span id="l34.160">                                         }</span>
<a href="#l34.161"></a><span id="l34.161">                                     }</span>
<a href="#l34.162"></a><span id="l34.162">                                 } catch (exc) { // ignore but log any errors on subscribed calendars:</span>
<a href="#l34.163"></a><span id="l34.163">                                     logError(exc, this_);</span>
<a href="#l34.164"></a><span id="l34.164">                                 }</span>
<a href="#l34.165"></a><span id="l34.165">                             }</span>
<a href="#l34.166"></a><span id="l34.166" class="difflineat">@@ -711,27 +711,27 @@ calWcapSession.prototype = {</span>
<a href="#l34.167"></a><span id="l34.167">         var this_ = this;</span>
<a href="#l34.168"></a><span id="l34.168">         function getSessionId_resp(err, sessionId) {</span>
<a href="#l34.169"></a><span id="l34.169">             if (err) {</span>
<a href="#l34.170"></a><span id="l34.170">                 request.execSubRespFunc(respFunc, err);</span>
<a href="#l34.171"></a><span id="l34.171">             } else {</span>
<a href="#l34.172"></a><span id="l34.172">                 // else have session uri and id:</span>
<a href="#l34.173"></a><span id="l34.173">                 this_.issueNetworkRequest_(</span>
<a href="#l34.174"></a><span id="l34.174">                     request,</span>
<a href="#l34.175"></a><span id="l34.175" class="difflineminus">-                    function issueNetworkRequest_resp(err, data) {</span>
<a href="#l34.176"></a><span id="l34.176" class="difflineplus">+                    function issueNetworkRequest_resp(loginerr, data) {</span>
<a href="#l34.177"></a><span id="l34.177">                         // timeout?</span>
<a href="#l34.178"></a><span id="l34.178" class="difflineminus">-                        if (checkErrorCode(err, calIWcapErrors.WCAP_LOGIN_FAILED)) {</span>
<a href="#l34.179"></a><span id="l34.179" class="difflineplus">+                        if (checkErrorCode(loginerr, calIWcapErrors.WCAP_LOGIN_FAILED)) {</span>
<a href="#l34.180"></a><span id="l34.180">                             // try again:</span>
<a href="#l34.181"></a><span id="l34.181">                             this_.getSessionId(</span>
<a href="#l34.182"></a><span id="l34.182">                                 request,</span>
<a href="#l34.183"></a><span id="l34.183">                                 getSessionId_resp,</span>
<a href="#l34.184"></a><span id="l34.184">                                 sessionId/* (old) timed-out session */);</span>
<a href="#l34.185"></a><span id="l34.185">                             return;</span>
<a href="#l34.186"></a><span id="l34.186">                         }</span>
<a href="#l34.187"></a><span id="l34.187" class="difflineminus">-                        request.execSubRespFunc(respFunc, err, data);</span>
<a href="#l34.188"></a><span id="l34.188" class="difflineplus">+                        request.execSubRespFunc(respFunc, loginerr, data);</span>
<a href="#l34.189"></a><span id="l34.189">                     },</span>
<a href="#l34.190"></a><span id="l34.190">                     dataConvFunc, wcapCommand, params, sessionId);</span>
<a href="#l34.191"></a><span id="l34.191">             }</span>
<a href="#l34.192"></a><span id="l34.192">         }</span>
<a href="#l34.193"></a><span id="l34.193">         this.getSessionId(request, getSessionId_resp);</span>
<a href="#l34.194"></a><span id="l34.194">     },</span>
<a href="#l34.195"></a><span id="l34.195"> </span>
<a href="#l34.196"></a><span id="l34.196">     issueNetworkRequest_: function calWcapSession_issueNetworkRequest_(</span>
<a href="#l34.197"></a><span id="l34.197" class="difflineat">@@ -863,22 +863,22 @@ calWcapSession.prototype = {</span>
<a href="#l34.198"></a><span id="l34.198">         return ret;</span>
<a href="#l34.199"></a><span id="l34.199">     },</span>
<a href="#l34.200"></a><span id="l34.200"> </span>
<a href="#l34.201"></a><span id="l34.201">     // calICalendarSearchProvider:</span>
<a href="#l34.202"></a><span id="l34.202">     searchForCalendars:</span>
<a href="#l34.203"></a><span id="l34.203">     function calWcapSession_searchForCalendars(searchString, hints, maxResults, listener) {</span>
<a href="#l34.204"></a><span id="l34.204">         var this_ = this;</span>
<a href="#l34.205"></a><span id="l34.205">         var request = new calWcapRequest(</span>
<a href="#l34.206"></a><span id="l34.206" class="difflineminus">-            function searchForCalendars_resp(request, err, data) {</span>
<a href="#l34.207"></a><span id="l34.207" class="difflineplus">+            function searchForCalendars_resp(oprequest, err, data) {</span>
<a href="#l34.208"></a><span id="l34.208">                 if (err &amp;&amp; !checkErrorCode(err, calIErrors.OPERATION_CANCELLED)) {</span>
<a href="#l34.209"></a><span id="l34.209">                     this_.notifyError(err);</span>
<a href="#l34.210"></a><span id="l34.210">                 }</span>
<a href="#l34.211"></a><span id="l34.211">                 if (listener) {</span>
<a href="#l34.212"></a><span id="l34.212" class="difflineminus">-                    listener.onResult(request, data);</span>
<a href="#l34.213"></a><span id="l34.213" class="difflineplus">+                    listener.onResult(oprequest, data);</span>
<a href="#l34.214"></a><span id="l34.214">                 }</span>
<a href="#l34.215"></a><span id="l34.215">             },</span>
<a href="#l34.216"></a><span id="l34.216">             log(&quot;searchForCalendars, searchString=&quot; + searchString, this));</span>
<a href="#l34.217"></a><span id="l34.217"> </span>
<a href="#l34.218"></a><span id="l34.218">         try {</span>
<a href="#l34.219"></a><span id="l34.219">             var registeredCalendars = this.getRegisteredCalendars(true);</span>
<a href="#l34.220"></a><span id="l34.220"> </span>
<a href="#l34.221"></a><span id="l34.221">             var params = (&quot;&amp;fmt-out=text%2Fxml&amp;search-string=&quot; + encodeURIComponent(searchString));</span>
<a href="#l34.222"></a><span id="l34.222" class="difflineat">@@ -947,32 +947,32 @@ calWcapSession.prototype = {</span>
<a href="#l34.223"></a><span id="l34.223">     function calWcapCalendar_getFreeBusyIntervals(calId, rangeStart, rangeEnd, busyTypes, listener) {</span>
<a href="#l34.224"></a><span id="l34.224">         rangeStart = ensureDateTime(rangeStart);</span>
<a href="#l34.225"></a><span id="l34.225">         rangeEnd = ensureDateTime(rangeEnd);</span>
<a href="#l34.226"></a><span id="l34.226">         var zRangeStart = getIcalUTC(rangeStart);</span>
<a href="#l34.227"></a><span id="l34.227">         var zRangeEnd = getIcalUTC(rangeEnd);</span>
<a href="#l34.228"></a><span id="l34.228"> </span>
<a href="#l34.229"></a><span id="l34.229">         var this_ = this;</span>
<a href="#l34.230"></a><span id="l34.230">         var request = new calWcapRequest(</span>
<a href="#l34.231"></a><span id="l34.231" class="difflineminus">-            function _resp(request, err, data) {</span>
<a href="#l34.232"></a><span id="l34.232" class="difflineplus">+            function _resp(oprequest, err, data) {</span>
<a href="#l34.233"></a><span id="l34.233">                 var rc = getResultCode(err);</span>
<a href="#l34.234"></a><span id="l34.234">                 switch (rc) {</span>
<a href="#l34.235"></a><span id="l34.235">                     case calIWcapErrors.WCAP_NO_ERRNO: // workaround</span>
<a href="#l34.236"></a><span id="l34.236">                     case calIWcapErrors.WCAP_ACCESS_DENIED_TO_CALENDAR:</span>
<a href="#l34.237"></a><span id="l34.237">                     case calIWcapErrors.WCAP_CALENDAR_DOES_NOT_EXIST:</span>
<a href="#l34.238"></a><span id="l34.238">                         log(&quot;getFreeBusyIntervals_resp() error: &quot; + errorToString(err), this_);</span>
<a href="#l34.239"></a><span id="l34.239">                         break;</span>
<a href="#l34.240"></a><span id="l34.240">                     default:</span>
<a href="#l34.241"></a><span id="l34.241">                         if (!Components.isSuccessCode(rc)) {</span>
<a href="#l34.242"></a><span id="l34.242">                             this_.notifyError(err);</span>
<a href="#l34.243"></a><span id="l34.243">                         }</span>
<a href="#l34.244"></a><span id="l34.244">                         break;</span>
<a href="#l34.245"></a><span id="l34.245">                 }</span>
<a href="#l34.246"></a><span id="l34.246">                 if (listener) {</span>
<a href="#l34.247"></a><span id="l34.247" class="difflineminus">-                    listener.onResult(request, data);</span>
<a href="#l34.248"></a><span id="l34.248" class="difflineplus">+                    listener.onResult(oprequest, data);</span>
<a href="#l34.249"></a><span id="l34.249">                 }</span>
<a href="#l34.250"></a><span id="l34.250">             },</span>
<a href="#l34.251"></a><span id="l34.251">             log(&quot;getFreeBusyIntervals():\n\tcalId=&quot; + calId +</span>
<a href="#l34.252"></a><span id="l34.252">                 &quot;\n\trangeStart=&quot; + zRangeStart + &quot;,\n\trangeEnd=&quot; + zRangeEnd, this));</span>
<a href="#l34.253"></a><span id="l34.253"> </span>
<a href="#l34.254"></a><span id="l34.254">         try {</span>
<a href="#l34.255"></a><span id="l34.255">             var params = (&quot;&amp;calid=&quot; + encodeURIComponent(calId));</span>
<a href="#l34.256"></a><span id="l34.256">             params += (&quot;&amp;busyonly=&quot; + ((busyTypes &amp; calIFreeBusyInterval.FREE) ? &quot;0&quot; : &quot;1&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -122,42 +122,42 @@</span>
<a href="#l35.4"></a><span id="l35.4">          - you should use parseDateTime for that.</span>
<a href="#l35.5"></a><span id="l35.5">         --&gt;</span>
<a href="#l35.6"></a><span id="l35.6">       &lt;method name=&quot;parseLanguageDate&quot;&gt;</span>
<a href="#l35.7"></a><span id="l35.7">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l35.8"></a><span id="l35.8">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l35.9"></a><span id="l35.9">            if (!aValue) {</span>
<a href="#l35.10"></a><span id="l35.10">              return null;</span>
<a href="#l35.11"></a><span id="l35.11">            }</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-           var val = aValue.toLowerCase();</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+           let val = aValue.toLowerCase();</span>
<a href="#l35.14"></a><span id="l35.14">            // Look for the easy ones like today, tomorrow, etc</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">-           for (var rel of this.mRelativeDates) {</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+           for (let rel of this.mRelativeDates) {</span>
<a href="#l35.17"></a><span id="l35.17">              if (val == rel.word) {</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-               var now = new Date();</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+               let now = new Date();</span>
<a href="#l35.20"></a><span id="l35.20">                now.setDate(now.getDate() + rel.offset);</span>
<a href="#l35.21"></a><span id="l35.21">                return now;</span>
<a href="#l35.22"></a><span id="l35.22">              }</span>
<a href="#l35.23"></a><span id="l35.23">            }</span>
<a href="#l35.24"></a><span id="l35.24"> </span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">-           var parser = this;</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+           let parser = this;</span>
<a href="#l35.27"></a><span id="l35.27"> </span>
<a href="#l35.28"></a><span id="l35.28">            // Takes a written day of the week and returns a js-date</span>
<a href="#l35.29"></a><span id="l35.29">            // corresponding to the nearest day in the future that is</span>
<a href="#l35.30"></a><span id="l35.30">            // that day of the week</span>
<a href="#l35.31"></a><span id="l35.31">            function getDateForDay(aWord) {</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineminus">-             for (var i in parser.mDayNames) {</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+             for (let i in parser.mDayNames) {</span>
<a href="#l35.34"></a><span id="l35.34">                if (aWord != parser.mDayNames[i]) {</span>
<a href="#l35.35"></a><span id="l35.35">                  continue;</span>
<a href="#l35.36"></a><span id="l35.36">                }</span>
<a href="#l35.37"></a><span id="l35.37">                // Figure out what day of the week today is.</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineminus">-               var today = cal.now();</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+               let today = cal.now();</span>
<a href="#l35.40"></a><span id="l35.40"> </span>
<a href="#l35.41"></a><span id="l35.41">                // i-weekday gets the offset. Add 7 to ensure that the %</span>
<a href="#l35.42"></a><span id="l35.42">                // operation stays positive.</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineminus">-               var offset = (i - today.weekday + 7) % 7;</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+               let offset = (i - today.weekday + 7) % 7;</span>
<a href="#l35.45"></a><span id="l35.45">                today.day = today.day + offset;</span>
<a href="#l35.46"></a><span id="l35.46">                return cal.dateTimeToJsDate(today);</span>
<a href="#l35.47"></a><span id="l35.47">              }</span>
<a href="#l35.48"></a><span id="l35.48">              return null;</span>
<a href="#l35.49"></a><span id="l35.49">            }</span>
<a href="#l35.50"></a><span id="l35.50"> </span>
<a href="#l35.51"></a><span id="l35.51">            // Remove commas</span>
<a href="#l35.52"></a><span id="l35.52">            val = val.replace(',', '');</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineat">@@ -181,26 +181,26 @@</span>
<a href="#l35.54"></a><span id="l35.54">              if (val.includes(this.mMonthShortNames[i])) {</span>
<a href="#l35.55"></a><span id="l35.55">                let newVal = val.replace(this.mMonthShortNames[i], Number(i) + 1);</span>
<a href="#l35.56"></a><span id="l35.56">                newVal = newVal.replace(' ', '/');</span>
<a href="#l35.57"></a><span id="l35.57">                return this.parseDateTime(newVal);</span>
<a href="#l35.58"></a><span id="l35.58">              }</span>
<a href="#l35.59"></a><span id="l35.59">           }</span>
<a href="#l35.60"></a><span id="l35.60"> </span>
<a href="#l35.61"></a><span id="l35.61">           // Now for the cool 'next' and 'last'</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineminus">-          var words = val.split(' ');</span>
<a href="#l35.63"></a><span id="l35.63" class="difflineminus">-          var offset, day;</span>
<a href="#l35.64"></a><span id="l35.64" class="difflineplus">+          let words = val.split(' ');</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineplus">+          let offset, day;</span>
<a href="#l35.66"></a><span id="l35.66">           for (let word of words) {</span>
<a href="#l35.67"></a><span id="l35.67">             for (let rel of this.mRelationWords) {</span>
<a href="#l35.68"></a><span id="l35.68">               if (word == rel.word) {</span>
<a href="#l35.69"></a><span id="l35.69">                 offset = rel.offset;</span>
<a href="#l35.70"></a><span id="l35.70">                 break;</span>
<a href="#l35.71"></a><span id="l35.71">               }</span>
<a href="#l35.72"></a><span id="l35.72">             }</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineminus">-            for (var i in this.mDayNames) {</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineplus">+            for (let i in this.mDayNames) {</span>
<a href="#l35.75"></a><span id="l35.75">               if (word == this.mDayNames[i]) {</span>
<a href="#l35.76"></a><span id="l35.76">                 day = getDateForDay(word);</span>
<a href="#l35.77"></a><span id="l35.77">                 break;</span>
<a href="#l35.78"></a><span id="l35.78">               }</span>
<a href="#l35.79"></a><span id="l35.79">             }</span>
<a href="#l35.80"></a><span id="l35.80">           }</span>
<a href="#l35.81"></a><span id="l35.81"> </span>
<a href="#l35.82"></a><span id="l35.82">           if (day &amp;&amp; offset != undefined) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrence/testDailyRecurrence.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -28,76 +28,76 @@ var testDailyRecurrence = function() {</span>
<a href="#l36.4"></a><span id="l36.4">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l36.5"></a><span id="l36.5"> </span>
<a href="#l36.6"></a><span id="l36.6">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l36.7"></a><span id="l36.7">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l36.8"></a><span id="l36.8">     &quot;daily&quot;);</span>
<a href="#l36.9"></a><span id="l36.9">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11">   // check day view for 7 days</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l36.14"></a><span id="l36.14">     + eventPath;</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+  controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l36.17"></a><span id="l36.17"> </span>
<a href="#l36.18"></a><span id="l36.18">   for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l36.21"></a><span id="l36.21">     calUtils.forward(controller, 1);</span>
<a href="#l36.22"></a><span id="l36.22">   }</span>
<a href="#l36.23"></a><span id="l36.23"> </span>
<a href="#l36.24"></a><span id="l36.24">   // check week view for 2 weeks</span>
<a href="#l36.25"></a><span id="l36.25">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l36.26"></a><span id="l36.26">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l36.27"></a><span id="l36.27"> </span>
<a href="#l36.28"></a><span id="l36.28">   for (let day = 5; day &lt;= 7; day++){</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineplus">+    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l36.31"></a><span id="l36.31">       + eventPath;</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l36.34"></a><span id="l36.34">   }</span>
<a href="#l36.35"></a><span id="l36.35"> </span>
<a href="#l36.36"></a><span id="l36.36">   calUtils.forward(controller, 1);</span>
<a href="#l36.37"></a><span id="l36.37"> </span>
<a href="#l36.38"></a><span id="l36.38">   for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineplus">+    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l36.41"></a><span id="l36.41">       + eventPath;</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l36.44"></a><span id="l36.44">   }</span>
<a href="#l36.45"></a><span id="l36.45"> </span>
<a href="#l36.46"></a><span id="l36.46">   // check multiweek view for 4 weeks</span>
<a href="#l36.47"></a><span id="l36.47">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l36.48"></a><span id="l36.48">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50">   for (let day = 5; day &lt;= 7; day++){</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineplus">+    let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l36.53"></a><span id="l36.53">       + eventPath;</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l36.56"></a><span id="l36.56">   }</span>
<a href="#l36.57"></a><span id="l36.57"> </span>
<a href="#l36.58"></a><span id="l36.58">   for (let week = 2; week &lt;= 4; week++){</span>
<a href="#l36.59"></a><span id="l36.59">     for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineminus">-      let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineplus">+      let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l36.62"></a><span id="l36.62">         + eventPath;</span>
<a href="#l36.63"></a><span id="l36.63" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.64"></a><span id="l36.64" class="difflineplus">+      controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l36.65"></a><span id="l36.65">     }</span>
<a href="#l36.66"></a><span id="l36.66">   }</span>
<a href="#l36.67"></a><span id="l36.67"> </span>
<a href="#l36.68"></a><span id="l36.68">   // check month view for all 5 weeks</span>
<a href="#l36.69"></a><span id="l36.69">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l36.70"></a><span id="l36.70">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l36.71"></a><span id="l36.71"> </span>
<a href="#l36.72"></a><span id="l36.72">   for (let day = 5; day &lt;= 7; day++){</span>
<a href="#l36.73"></a><span id="l36.73" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineplus">+    let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l36.75"></a><span id="l36.75">       + eventPath;</span>
<a href="#l36.76"></a><span id="l36.76" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l36.78"></a><span id="l36.78">   }</span>
<a href="#l36.79"></a><span id="l36.79"> </span>
<a href="#l36.80"></a><span id="l36.80">   for (let week = 2; week &lt;= 5; week++){</span>
<a href="#l36.81"></a><span id="l36.81">     for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineminus">-      let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l36.83"></a><span id="l36.83" class="difflineplus">+      let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l36.84"></a><span id="l36.84">         + eventPath;</span>
<a href="#l36.85"></a><span id="l36.85" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineplus">+      controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l36.87"></a><span id="l36.87">     }</span>
<a href="#l36.88"></a><span id="l36.88">   }</span>
<a href="#l36.89"></a><span id="l36.89"> </span>
<a href="#l36.90"></a><span id="l36.90">   // delete 3rd January occurrence</span>
<a href="#l36.91"></a><span id="l36.91">   let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l36.92"></a><span id="l36.92">     + eventPath;</span>
<a href="#l36.93"></a><span id="l36.93">   calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l36.94"></a><span id="l36.94">   controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l36.95"></a><span id="l36.95" class="difflineat">@@ -150,49 +150,49 @@ var testDailyRecurrence = function() {</span>
<a href="#l36.96"></a><span id="l36.96">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.97"></a><span id="l36.97">   }</span>
<a href="#l36.98"></a><span id="l36.98"> </span>
<a href="#l36.99"></a><span id="l36.99">   // check week view for 2 weeks</span>
<a href="#l36.100"></a><span id="l36.100">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l36.101"></a><span id="l36.101">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l36.102"></a><span id="l36.102"> </span>
<a href="#l36.103"></a><span id="l36.103">   for (let i = 0; i &lt;= 1; i++){</span>
<a href="#l36.104"></a><span id="l36.104" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineplus">+    let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l36.106"></a><span id="l36.106">       + eventPath;</span>
<a href="#l36.107"></a><span id="l36.107" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.108"></a><span id="l36.108" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l36.109"></a><span id="l36.109" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l36.110"></a><span id="l36.110" class="difflineplus">+    weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l36.111"></a><span id="l36.111">       + eventPath;</span>
<a href="#l36.112"></a><span id="l36.112" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.113"></a><span id="l36.113" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l36.114"></a><span id="l36.114">     calUtils.forward(controller, 1);</span>
<a href="#l36.115"></a><span id="l36.115">   }</span>
<a href="#l36.116"></a><span id="l36.116"> </span>
<a href="#l36.117"></a><span id="l36.117">   // check multiweek view for 4 weeks</span>
<a href="#l36.118"></a><span id="l36.118">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l36.119"></a><span id="l36.119">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l36.120"></a><span id="l36.120"> </span>
<a href="#l36.121"></a><span id="l36.121">   for (let i = 1; i &lt;= 4; i++){</span>
<a href="#l36.122"></a><span id="l36.122" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l36.123"></a><span id="l36.123" class="difflineplus">+    let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l36.124"></a><span id="l36.124">       + eventPath;</span>
<a href="#l36.125"></a><span id="l36.125" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.126"></a><span id="l36.126" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l36.127"></a><span id="l36.127" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l36.128"></a><span id="l36.128" class="difflineplus">+    mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l36.129"></a><span id="l36.129">       + eventPath;</span>
<a href="#l36.130"></a><span id="l36.130" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.131"></a><span id="l36.131" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l36.132"></a><span id="l36.132">   }</span>
<a href="#l36.133"></a><span id="l36.133"> </span>
<a href="#l36.134"></a><span id="l36.134">   // check month view for all 5 weeks</span>
<a href="#l36.135"></a><span id="l36.135">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l36.136"></a><span id="l36.136">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l36.137"></a><span id="l36.137"> </span>
<a href="#l36.138"></a><span id="l36.138">   for (let i = 1; i &lt;= 5; i++){</span>
<a href="#l36.139"></a><span id="l36.139" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l36.140"></a><span id="l36.140" class="difflineplus">+    let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l36.141"></a><span id="l36.141">       + eventPath;</span>
<a href="#l36.142"></a><span id="l36.142" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.143"></a><span id="l36.143" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l36.144"></a><span id="l36.144" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l36.145"></a><span id="l36.145" class="difflineplus">+    mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l36.146"></a><span id="l36.146">       + eventPath;</span>
<a href="#l36.147"></a><span id="l36.147" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.148"></a><span id="l36.148" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l36.149"></a><span id="l36.149">   }</span>
<a href="#l36.150"></a><span id="l36.150"> </span>
<a href="#l36.151"></a><span id="l36.151">   // delete event</span>
<a href="#l36.152"></a><span id="l36.152">   day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined)</span>
<a href="#l36.153"></a><span id="l36.153">     + eventPath;</span>
<a href="#l36.154"></a><span id="l36.154">   controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l36.155"></a><span id="l36.155">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l36.156"></a><span id="l36.156">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/test/mozmill/recurrenceRotated/testDailyRecurrence.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -35,76 +35,76 @@ var testDailyRecurrence = function() {</span>
<a href="#l37.4"></a><span id="l37.4">     .getWindows(&quot;Calendar:EventDialog&quot;)[0]);</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6">   event.waitForElement(new elementslib.ID(event.window.document, &quot;item-repeat&quot;));</span>
<a href="#l37.7"></a><span id="l37.7">   event.select(new elementslib.ID(event.window.document, &quot;item-repeat&quot;), undefined, undefined,</span>
<a href="#l37.8"></a><span id="l37.8">     &quot;daily&quot;);</span>
<a href="#l37.9"></a><span id="l37.9">   event.click(new elementslib.ID(event.window.document, &quot;button-save&quot;));</span>
<a href="#l37.10"></a><span id="l37.10"> </span>
<a href="#l37.11"></a><span id="l37.11">   // check day view for 7 days</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-  let box = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+  let daybox = calUtils.getEventBoxPath(controller, &quot;day&quot;, calUtils.EVENT_BOX, undefined, 1, hour, undefined)</span>
<a href="#l37.14"></a><span id="l37.14">     + eventPath;</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-  controller.waitForElement(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+  controller.waitForElement(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l37.17"></a><span id="l37.17"> </span>
<a href="#l37.18"></a><span id="l37.18">   for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, daybox));</span>
<a href="#l37.21"></a><span id="l37.21">     calUtils.forward(controller, 1);</span>
<a href="#l37.22"></a><span id="l37.22">   }</span>
<a href="#l37.23"></a><span id="l37.23"> </span>
<a href="#l37.24"></a><span id="l37.24">   // check week view for 2 weeks</span>
<a href="#l37.25"></a><span id="l37.25">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l37.26"></a><span id="l37.26">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l37.27"></a><span id="l37.27"> </span>
<a href="#l37.28"></a><span id="l37.28">   for (let day = 5; day &lt;= 7; day++){</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineplus">+    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l37.31"></a><span id="l37.31">       + eventPath;</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.33"></a><span id="l37.33" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l37.34"></a><span id="l37.34">   }</span>
<a href="#l37.35"></a><span id="l37.35"> </span>
<a href="#l37.36"></a><span id="l37.36">   calUtils.forward(controller, 1);</span>
<a href="#l37.37"></a><span id="l37.37"> </span>
<a href="#l37.38"></a><span id="l37.38">   for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l37.39"></a><span id="l37.39" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l37.40"></a><span id="l37.40" class="difflineplus">+    let weekbox = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, 2, day, hour)</span>
<a href="#l37.41"></a><span id="l37.41">       + eventPath;</span>
<a href="#l37.42"></a><span id="l37.42" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.43"></a><span id="l37.43" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, weekbox));</span>
<a href="#l37.44"></a><span id="l37.44">   }</span>
<a href="#l37.45"></a><span id="l37.45"> </span>
<a href="#l37.46"></a><span id="l37.46">   // check multiweek view for 4 weeks</span>
<a href="#l37.47"></a><span id="l37.47">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l37.48"></a><span id="l37.48">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l37.49"></a><span id="l37.49"> </span>
<a href="#l37.50"></a><span id="l37.50">   for (let day = 5; day &lt;= 7; day++){</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineplus">+    let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, 1, day, hour)</span>
<a href="#l37.53"></a><span id="l37.53">       + eventPath;</span>
<a href="#l37.54"></a><span id="l37.54" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.55"></a><span id="l37.55" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l37.56"></a><span id="l37.56">   }</span>
<a href="#l37.57"></a><span id="l37.57"> </span>
<a href="#l37.58"></a><span id="l37.58">   for (let week = 2; week &lt;= 4; week++){</span>
<a href="#l37.59"></a><span id="l37.59">     for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineminus">-      let box = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineplus">+      let mweekbox = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, week, day, hour)</span>
<a href="#l37.62"></a><span id="l37.62">         + eventPath;</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineplus">+      controller.assertNode(new elementslib.Lookup(controller.window.document, mweekbox));</span>
<a href="#l37.65"></a><span id="l37.65">     }</span>
<a href="#l37.66"></a><span id="l37.66">   }</span>
<a href="#l37.67"></a><span id="l37.67"> </span>
<a href="#l37.68"></a><span id="l37.68">   // check month view for all 5 weeks</span>
<a href="#l37.69"></a><span id="l37.69">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l37.70"></a><span id="l37.70">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l37.71"></a><span id="l37.71"> </span>
<a href="#l37.72"></a><span id="l37.72">   for (let day = 5; day &lt;= 7; day++){</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineminus">-    let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l37.74"></a><span id="l37.74" class="difflineplus">+    let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, day, undefined)</span>
<a href="#l37.75"></a><span id="l37.75">       + eventPath;</span>
<a href="#l37.76"></a><span id="l37.76" class="difflineminus">-    controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.77"></a><span id="l37.77" class="difflineplus">+    controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l37.78"></a><span id="l37.78">   }</span>
<a href="#l37.79"></a><span id="l37.79"> </span>
<a href="#l37.80"></a><span id="l37.80">   for (let week = 2; week &lt;= 5; week++){</span>
<a href="#l37.81"></a><span id="l37.81">     for (let day = 1; day &lt;= 7; day++){</span>
<a href="#l37.82"></a><span id="l37.82" class="difflineminus">-      let box = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l37.83"></a><span id="l37.83" class="difflineplus">+      let mbox = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, week, day, undefined)</span>
<a href="#l37.84"></a><span id="l37.84">         + eventPath;</span>
<a href="#l37.85"></a><span id="l37.85" class="difflineminus">-      controller.assertNode(new elementslib.Lookup(controller.window.document, box));</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineplus">+      controller.assertNode(new elementslib.Lookup(controller.window.document, mbox));</span>
<a href="#l37.87"></a><span id="l37.87">     }</span>
<a href="#l37.88"></a><span id="l37.88">   }</span>
<a href="#l37.89"></a><span id="l37.89"> </span>
<a href="#l37.90"></a><span id="l37.90">   // delete 3rd January occurrence</span>
<a href="#l37.91"></a><span id="l37.91">   let saturday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 7, undefined)</span>
<a href="#l37.92"></a><span id="l37.92">     + eventPath;</span>
<a href="#l37.93"></a><span id="l37.93">   calUtils.handleOccurrenceDeletion(controller, false);</span>
<a href="#l37.94"></a><span id="l37.94">   controller.click(new elementslib.Lookup(controller.window.document, saturday));</span>
<a href="#l37.95"></a><span id="l37.95" class="difflineat">@@ -157,49 +157,49 @@ var testDailyRecurrence = function() {</span>
<a href="#l37.96"></a><span id="l37.96">     controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.97"></a><span id="l37.97">   }</span>
<a href="#l37.98"></a><span id="l37.98"> </span>
<a href="#l37.99"></a><span id="l37.99">   // check week view for 2 weeks</span>
<a href="#l37.100"></a><span id="l37.100">   calUtils.switchToView(controller, &quot;week&quot;);</span>
<a href="#l37.101"></a><span id="l37.101">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l37.102"></a><span id="l37.102"> </span>
<a href="#l37.103"></a><span id="l37.103">   for (let i = 0; i &lt;= 1; i++){</span>
<a href="#l37.104"></a><span id="l37.104" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l37.105"></a><span id="l37.105" class="difflineplus">+    let weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 1, undefined)</span>
<a href="#l37.106"></a><span id="l37.106">       + eventPath;</span>
<a href="#l37.107"></a><span id="l37.107" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.108"></a><span id="l37.108" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l37.109"></a><span id="l37.109" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l37.110"></a><span id="l37.110" class="difflineplus">+    weekday = calUtils.getEventBoxPath(controller, &quot;week&quot;, calUtils.EVENT_BOX, undefined, 7, undefined)</span>
<a href="#l37.111"></a><span id="l37.111">       + eventPath;</span>
<a href="#l37.112"></a><span id="l37.112" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.113"></a><span id="l37.113" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, weekday));</span>
<a href="#l37.114"></a><span id="l37.114">     calUtils.forward(controller, 1);</span>
<a href="#l37.115"></a><span id="l37.115">   }</span>
<a href="#l37.116"></a><span id="l37.116"> </span>
<a href="#l37.117"></a><span id="l37.117">   // check multiweek view for 4 weeks</span>
<a href="#l37.118"></a><span id="l37.118">   calUtils.switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l37.119"></a><span id="l37.119">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l37.120"></a><span id="l37.120"> </span>
<a href="#l37.121"></a><span id="l37.121">   for (let i = 1; i &lt;= 4; i++){</span>
<a href="#l37.122"></a><span id="l37.122" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l37.123"></a><span id="l37.123" class="difflineplus">+    let mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l37.124"></a><span id="l37.124">       + eventPath;</span>
<a href="#l37.125"></a><span id="l37.125" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.126"></a><span id="l37.126" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l37.127"></a><span id="l37.127" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l37.128"></a><span id="l37.128" class="difflineplus">+    mweekday = calUtils.getEventBoxPath(controller, &quot;multiweek&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l37.129"></a><span id="l37.129">       + eventPath;</span>
<a href="#l37.130"></a><span id="l37.130" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.131"></a><span id="l37.131" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mweekday));</span>
<a href="#l37.132"></a><span id="l37.132">   }</span>
<a href="#l37.133"></a><span id="l37.133"> </span>
<a href="#l37.134"></a><span id="l37.134">   // check month view for all 5 weeks</span>
<a href="#l37.135"></a><span id="l37.135">   calUtils.switchToView(controller, &quot;month&quot;);</span>
<a href="#l37.136"></a><span id="l37.136">   calUtils.goToDate(controller, 2009, 1, 1);</span>
<a href="#l37.137"></a><span id="l37.137"> </span>
<a href="#l37.138"></a><span id="l37.138">   for (let i = 1; i &lt;= 5; i++){</span>
<a href="#l37.139"></a><span id="l37.139" class="difflineminus">-    let day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l37.140"></a><span id="l37.140" class="difflineplus">+    let mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 1, undefined)</span>
<a href="#l37.141"></a><span id="l37.141">       + eventPath;</span>
<a href="#l37.142"></a><span id="l37.142" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.143"></a><span id="l37.143" class="difflineminus">-    day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l37.144"></a><span id="l37.144" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l37.145"></a><span id="l37.145" class="difflineplus">+    mday = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, i, 7, undefined)</span>
<a href="#l37.146"></a><span id="l37.146">       + eventPath;</span>
<a href="#l37.147"></a><span id="l37.147" class="difflineminus">-    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.148"></a><span id="l37.148" class="difflineplus">+    controller.assertNodeNotExist(new elementslib.Lookup(controller.window.document, mday));</span>
<a href="#l37.149"></a><span id="l37.149">   }</span>
<a href="#l37.150"></a><span id="l37.150"> </span>
<a href="#l37.151"></a><span id="l37.151">   // delete event</span>
<a href="#l37.152"></a><span id="l37.152">   day = calUtils.getEventBoxPath(controller, &quot;month&quot;, calUtils.EVENT_BOX, 1, 5, undefined)</span>
<a href="#l37.153"></a><span id="l37.153">     + eventPath;</span>
<a href="#l37.154"></a><span id="l37.154">   controller.click(new elementslib.Lookup(controller.window.document, day));</span>
<a href="#l37.155"></a><span id="l37.155">   calUtils.handleParentDeletion(controller, false);</span>
<a href="#l37.156"></a><span id="l37.156">   controller.keypress(new elementslib.ID(controller.window.document, &quot;month-view&quot;),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/test/unit/test_attendee.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/test/unit/test_attendee.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -53,17 +53,17 @@ function test_values() {</span>
<a href="#l38.4"></a><span id="l38.4">     var a1 = cal.createAttendee();</span>
<a href="#l38.5"></a><span id="l38.5">     // Testing attendee set/get.</span>
<a href="#l38.6"></a><span id="l38.6">     var properties = [&quot;id&quot;, &quot;commonName&quot;, &quot;rsvp&quot;, &quot;role&quot;, &quot;participationStatus&quot;,</span>
<a href="#l38.7"></a><span id="l38.7">                       &quot;userType&quot;];</span>
<a href="#l38.8"></a><span id="l38.8">     var values = [&quot;myid&quot;, &quot;mycn&quot;, &quot;TRUE&quot;, &quot;CHAIR&quot;, &quot;DECLINED&quot;, &quot;RESOURCE&quot;];</span>
<a href="#l38.9"></a><span id="l38.9">     // Make sure test is valid</span>
<a href="#l38.10"></a><span id="l38.10">     equal(properties.length, values.length);</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    for (var i = 0; i &lt; properties.length; i++) {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    for (let i = 0; i &lt; properties.length; i++) {</span>
<a href="#l38.14"></a><span id="l38.14">         a1[properties[i]] = values[i];</span>
<a href="#l38.15"></a><span id="l38.15">         equal(a1[properties[i]], values[i]);</span>
<a href="#l38.16"></a><span id="l38.16">     }</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18">     // Create event</span>
<a href="#l38.19"></a><span id="l38.19">     var event = cal.createEvent();</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21">     // Add attendee to event</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/test/unit/test_bug759324.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/test/unit/test_bug759324.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -24,48 +24,48 @@ function run_test() {</span>
<a href="#l39.4"></a><span id="l39.4">     rec.title = &quot;changed&quot;;</span>
<a href="#l39.5"></a><span id="l39.5">     item.recurrenceInfo.modifyException(rec, true);</span>
<a href="#l39.6"></a><span id="l39.6"> </span>
<a href="#l39.7"></a><span id="l39.7">     do_test_pending();</span>
<a href="#l39.8"></a><span id="l39.8">     storage.addItem(item, { onOperationComplete: checkAddedItem });</span>
<a href="#l39.9"></a><span id="l39.9"> </span>
<a href="#l39.10"></a><span id="l39.10">     function checkAddedItem(c, s, o, i, addedItem) {</span>
<a href="#l39.11"></a><span id="l39.11">         let seq = addedItem.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-        let rec = addedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+        let occ = addedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15">         equal(seq, 3);</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineminus">-        equal(rec.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineplus">+        equal(occ.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l39.18"></a><span id="l39.18"> </span>
<a href="#l39.19"></a><span id="l39.19">         let changedItem = addedItem.clone();</span>
<a href="#l39.20"></a><span id="l39.20">         changedItem.setProperty(&quot;SEQUENCE&quot;, parseInt(seq, 10) + 1);</span>
<a href="#l39.21"></a><span id="l39.21"> </span>
<a href="#l39.22"></a><span id="l39.22">         storage.modifyItem(changedItem, addedItem, { onOperationComplete: checkModifiedItem });</span>
<a href="#l39.23"></a><span id="l39.23">     }</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25">     function checkModifiedItem(c, s, o, i, changedItem) {</span>
<a href="#l39.26"></a><span id="l39.26">         let seq = changedItem.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l39.27"></a><span id="l39.27" class="difflineminus">-        let rec = changedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineplus">+        let occ = changedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l39.29"></a><span id="l39.29"> </span>
<a href="#l39.30"></a><span id="l39.30">         equal(seq, 4);</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-        equal(rec.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+        equal(occ.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l39.33"></a><span id="l39.33"> </span>
<a href="#l39.34"></a><span id="l39.34">         // Now check with the pref off</span>
<a href="#l39.35"></a><span id="l39.35">         storage.deleteProperty(&quot;capabilities.propagate-sequence&quot;);</span>
<a href="#l39.36"></a><span id="l39.36"> </span>
<a href="#l39.37"></a><span id="l39.37">         let changedItem2 = changedItem.clone();</span>
<a href="#l39.38"></a><span id="l39.38">         changedItem2.setProperty(&quot;SEQUENCE&quot;, parseInt(seq, 10) + 1);</span>
<a href="#l39.39"></a><span id="l39.39"> </span>
<a href="#l39.40"></a><span id="l39.40">         storage.modifyItem(changedItem2, changedItem, { onOperationComplete: checkNormalItem });</span>
<a href="#l39.41"></a><span id="l39.41">     }</span>
<a href="#l39.42"></a><span id="l39.42"> </span>
<a href="#l39.43"></a><span id="l39.43">     function checkNormalItem(c, s, o, i, changedItem) {</span>
<a href="#l39.44"></a><span id="l39.44">         let seq = changedItem.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l39.45"></a><span id="l39.45" class="difflineminus">-        let rec = changedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l39.46"></a><span id="l39.46" class="difflineplus">+        let occ = changedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l39.47"></a><span id="l39.47"> </span>
<a href="#l39.48"></a><span id="l39.48">         equal(seq, 5);</span>
<a href="#l39.49"></a><span id="l39.49" class="difflineminus">-        equal(rec.getProperty(&quot;SEQUENCE&quot;), 4);</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineplus">+        equal(occ.getProperty(&quot;SEQUENCE&quot;), 4);</span>
<a href="#l39.51"></a><span id="l39.51">         completeTest();</span>
<a href="#l39.52"></a><span id="l39.52">     }</span>
<a href="#l39.53"></a><span id="l39.53"> </span>
<a href="#l39.54"></a><span id="l39.54">     function completeTest() {</span>
<a href="#l39.55"></a><span id="l39.55">         do_test_finished();</span>
<a href="#l39.56"></a><span id="l39.56">     }</span>
<a href="#l39.57"></a><span id="l39.57"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/test/unit/test_ics_parser.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_parser.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -44,17 +44,17 @@ function test_props_comps() {</span>
<a href="#l40.4"></a><span id="l40.4"> }</span>
<a href="#l40.5"></a><span id="l40.5"> </span>
<a href="#l40.6"></a><span id="l40.6"> function test_failures() {</span>
<a href="#l40.7"></a><span id="l40.7">     let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l40.8"></a><span id="l40.8">                            .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10">     do_test_pending();</span>
<a href="#l40.11"></a><span id="l40.11">     parser.parseString(&quot;BOGUS&quot;, null, {</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-        onParsingComplete: function(rc, parser) {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+        onParsingComplete: function(rc, opparser) {</span>
<a href="#l40.14"></a><span id="l40.14">             dump(&quot;Note: The previous error message is expected ^^\n&quot;);</span>
<a href="#l40.15"></a><span id="l40.15">             equal(rc, Components.results.NS_ERROR_FAILURE);</span>
<a href="#l40.16"></a><span id="l40.16">             do_test_finished();</span>
<a href="#l40.17"></a><span id="l40.17">         }</span>
<a href="#l40.18"></a><span id="l40.18">     });</span>
<a href="#l40.19"></a><span id="l40.19"> </span>
<a href="#l40.20"></a><span id="l40.20">     // No real error here, but there is a message...</span>
<a href="#l40.21"></a><span id="l40.21">     parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -121,17 +121,17 @@ function test_async() {</span>
<a href="#l40.23"></a><span id="l40.23">         &quot;UID:2&quot;,</span>
<a href="#l40.24"></a><span id="l40.24">         &quot;DTSTART:20120101T010103&quot;,</span>
<a href="#l40.25"></a><span id="l40.25">         &quot;DUE:20120101T010104&quot;,</span>
<a href="#l40.26"></a><span id="l40.26">         &quot;END:VTODO&quot;,</span>
<a href="#l40.27"></a><span id="l40.27">         &quot;END:VCALENDAR&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l40.28"></a><span id="l40.28"> </span>
<a href="#l40.29"></a><span id="l40.29">     do_test_pending();</span>
<a href="#l40.30"></a><span id="l40.30">     parser.parseString(str, null, {</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-        onParsingComplete: function(rc, parser) {</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+        onParsingComplete: function(rc, opparser) {</span>
<a href="#l40.33"></a><span id="l40.33">             let items = parser.getItems({});</span>
<a href="#l40.34"></a><span id="l40.34">             equal(items.length, 2);</span>
<a href="#l40.35"></a><span id="l40.35">             let item = items[0];</span>
<a href="#l40.36"></a><span id="l40.36">             ok(cal.isToDo(item));</span>
<a href="#l40.37"></a><span id="l40.37"> </span>
<a href="#l40.38"></a><span id="l40.38">             equal(item.entryDate.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l40.39"></a><span id="l40.39">             equal(item.dueDate.icalString, &quot;20120101T010102&quot;);</span>
<a href="#l40.40"></a><span id="l40.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -691,20 +691,20 @@ function test_startdate_change() {</span>
<a href="#l41.4"></a><span id="l41.4">     item.startDate = cal.createDateTime(&quot;20020502T114500Z&quot;);</span>
<a href="#l41.5"></a><span id="l41.5"> </span>
<a href="#l41.6"></a><span id="l41.6">     function makeRecEvent(str) {</span>
<a href="#l41.7"></a><span id="l41.7">         return makeEvent(&quot;DTSTART:20020402T114500Z\r\n&quot; +</span>
<a href="#l41.8"></a><span id="l41.8">                          &quot;DTEND:20020402T134500Z\r\n&quot; +</span>
<a href="#l41.9"></a><span id="l41.9">                          str);</span>
<a href="#l41.10"></a><span id="l41.10">     }</span>
<a href="#l41.11"></a><span id="l41.11"> </span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    function changeBy(item, dur) {</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-        let newDate = item.startDate.clone();</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineplus">+    function changeBy(changeItem, dur) {</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+        let newDate = changeItem.startDate.clone();</span>
<a href="#l41.16"></a><span id="l41.16">         newDate.addDuration(cal.createDuration(dur));</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineminus">-        item.startDate = newDate;</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineplus">+        changeItem.startDate = newDate;</span>
<a href="#l41.19"></a><span id="l41.19">     }</span>
<a href="#l41.20"></a><span id="l41.20"> </span>
<a href="#l41.21"></a><span id="l41.21">     let dur, ritem;</span>
<a href="#l41.22"></a><span id="l41.22"> </span>
<a href="#l41.23"></a><span id="l41.23">     // Changing an existing start date for a recurring item shouldn't either</span>
<a href="#l41.24"></a><span id="l41.24">     item = makeRecEvent(&quot;RRULE:FREQ=DAILY\r\n&quot;);</span>
<a href="#l41.25"></a><span id="l41.25">     changeBy(item, &quot;PT1H&quot;);</span>
<a href="#l41.26"></a><span id="l41.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/test/unit/test_storage.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/test/unit/test_storage.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -14,20 +14,20 @@ function testAttachRoundtrip() {</span>
<a href="#l42.4"></a><span id="l42.4">                &quot;ATTACH;FMTTYPE=text/calendar;ENCODING=BASE64;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l42.5"></a><span id="l42.5">                &quot;ATTENDEE;RSVP=TRUE;CUTYPE=INDIVIDUAL;CN=Name;PARTSTAT=ACCEPTED;ROLE=REQ-PARTICIPANT;X-THING=BAR:mailto:test@example.com&quot;,</span>
<a href="#l42.6"></a><span id="l42.6">                &quot;RELATED-TO;RELTYPE=SIBLING;FOO=BAR:VALUE&quot;,</span>
<a href="#l42.7"></a><span id="l42.7">                &quot;RRULE:FREQ=MONTHLY;INTERVAL=2;COUNT=5;BYDAY=MO&quot;,</span>
<a href="#l42.8"></a><span id="l42.8">                &quot;RDATE:20120201T010101Z&quot;,</span>
<a href="#l42.9"></a><span id="l42.9">                &quot;EXDATE:20120301T010101Z&quot;,</span>
<a href="#l42.10"></a><span id="l42.10">                &quot;END:VEVENT&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-    let item = createEventFromIcalString(str);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+    let storageItem = createEventFromIcalString(str);</span>
<a href="#l42.14"></a><span id="l42.14"> </span>
<a href="#l42.15"></a><span id="l42.15">     do_test_pending();</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineminus">-    storage.addItem(item, {</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+    storage.addItem(storageItem, {</span>
<a href="#l42.18"></a><span id="l42.18">         onOperationComplete: function checkAddedItem(c, s, o, i, addedItem) {</span>
<a href="#l42.19"></a><span id="l42.19">             do_execute_soon(function() {</span>
<a href="#l42.20"></a><span id="l42.20">                 // Make sure the cache is cleared, otherwise we'll get the cached item.</span>
<a href="#l42.21"></a><span id="l42.21">                 delete storage.wrappedJSObject.mItemCache[addedItem.id];</span>
<a href="#l42.22"></a><span id="l42.22">                 storage.getItem(addedItem.id, retrieveItem);</span>
<a href="#l42.23"></a><span id="l42.23">             });</span>
<a href="#l42.24"></a><span id="l42.24">         }</span>
<a href="#l42.25"></a><span id="l42.25">     });</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

