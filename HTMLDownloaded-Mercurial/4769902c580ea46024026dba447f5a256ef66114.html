<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24761:4769902c580ea46024026dba447f5a256ef66114</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 4769902c580ea46024026dba447f5a256ef66114" />
<meta property="og:url" content="/comm-central/rev/4769902c580ea46024026dba447f5a256ef66114" />
<meta property="og:description" content="Bug 1490448 - fix problems found by JS strict mode in MozMill tests. r=jorgk CLOSED TREE" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 4769902c580ea46024026dba447f5a256ef66114 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/4769902c580ea46024026dba447f5a256ef66114">shortlog</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/4769902c580ea46024026dba447f5a256ef66114">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114">files</a> |
changeset |
<a href="/comm-central/raw-rev/4769902c580ea46024026dba447f5a256ef66114">raw</a>  | <a href="/comm-central/archive/4769902c580ea46024026dba447f5a256ef66114.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1490448">Bug 1490448</a> - fix problems found by JS strict mode in MozMill tests. r=jorgk CLOSED TREE
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 17 Sep 2018 12:52:00 +0200</td></tr>

<tr>
 <td>changeset 24761</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/4769902c580ea46024026dba447f5a256ef66114">4769902c580ea46024026dba447f5a256ef66114</a></td>
</tr>



<tr>
<td>parent 24760</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2977f7b7b8d661f1bd377786f3add1c1aa551d80">2977f7b7b8d661f1bd377786f3add1c1aa551d80</a>
</td>
</tr>

<tr>
<td>child 24762</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/03d79b0cf04825ec9cd17a9d254df09f74bf1e71">03d79b0cf04825ec9cd17a9d254df09f74bf1e71</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=4769902c580ea46024026dba447f5a256ef66114">14897</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 17 Sep 2018 22:13:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@4769902c580e [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4769902c580ea46024026dba447f5a256ef66114">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4769902c580ea46024026dba447f5a256ef66114&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4769902c580ea46024026dba447f5a256ef66114&newProject=comm-central&newRevision=f4212f66b639624c507a68f1a6db487022ca9fdb&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4769902c580ea46024026dba447f5a256ef66114&newProject=comm-central&newRevision=f4212f66b639624c507a68f1a6db487022ca9fdb&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4769902c580ea46024026dba447f5a256ef66114&newProject=comm-central&newRevision=f4212f66b639624c507a68f1a6db487022ca9fdb&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1490448">1490448</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1490448">Bug 1490448</a> - fix problems found by JS strict mode in MozMill tests. r=jorgk CLOSED TREE</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-actions.js">mail/test/mozmill/account/test-account-actions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-actions.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-actions.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-actions.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-actions.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-actions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-tree.js">mail/test/mozmill/account/test-account-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-tree.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-tree.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-tree.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-tree.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-tree.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-values.js">mail/test/mozmill/account/test-account-values.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-values.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-values.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-values.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-values.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/account/test-account-values.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book-panes.js">mail/test/mozmill/addrbook/test-address-book-panes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book-panes.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book-panes.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book-panes.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book-panes.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book-panes.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book.js">mail/test/mozmill/addrbook/test-address-book.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/addrbook/test-address-book.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment-size.js">mail/test/mozmill/attachment/test-attachment-size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment-size.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment-size.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment-size.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment-size.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment-size.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment.js">mail/test/mozmill/attachment/test-attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/attachment/test-attachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-address-widgets.js">mail/test/mozmill/composition/test-address-widgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-address-widgets.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-address-widgets.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-address-widgets.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-address-widgets.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-address-widgets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-drafts.js">mail/test/mozmill/composition/test-drafts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-drafts.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-drafts.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-drafts.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-drafts.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-drafts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forward-headers.js">mail/test/mozmill/composition/test-forward-headers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forward-headers.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forward-headers.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forward-headers.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forward-headers.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forward-headers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forwarded-content.js">mail/test/mozmill/composition/test-forwarded-content.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forwarded-content.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forwarded-content.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forwarded-content.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forwarded-content.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-forwarded-content.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-save-changes-on-quit.js">mail/test/mozmill/composition/test-save-changes-on-quit.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-save-changes-on-quit.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-save-changes-on-quit.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-save-changes-on-quit.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-save-changes-on-quit.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/composition/test-save-changes-on-quit.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/content-tabs/test-plugin-crashing.js">mail/test/mozmill/content-tabs/test-plugin-crashing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/content-tabs/test-plugin-crashing.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/content-tabs/test-plugin-crashing.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/content-tabs/test-plugin-crashing.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/content-tabs/test-plugin-crashing.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/content-tabs/test-plugin-crashing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/downloads/test-about-downloads.js">mail/test/mozmill/downloads/test-about-downloads.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/downloads/test-about-downloads.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/downloads/test-about-downloads.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/downloads/test-about-downloads.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/downloads/test-about-downloads.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/downloads/test-about-downloads.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-message-size.js">mail/test/mozmill/folder-display/test-message-size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-message-size.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-message-size.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-message-size.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-message-size.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-message-size.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-pane-focus.js">mail/test/mozmill/folder-display/test-pane-focus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-pane-focus.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-pane-focus.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-pane-focus.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-pane-focus.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-pane-focus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js">mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-tooltip-multimessage.js">mail/test/mozmill/folder-display/test-tooltip-multimessage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-tooltip-multimessage.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-tooltip-multimessage.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-tooltip-multimessage.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-tooltip-multimessage.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-display/test-tooltip-multimessage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-pane/test-folder-pane.js">mail/test/mozmill/folder-pane/test-folder-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-pane/test-folder-pane.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-pane/test-folder-pane.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-pane/test-folder-pane.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-pane/test-folder-pane.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-pane/test-folder-pane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">mail/test/mozmill/folder-tree-modes/test-mode-switching.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-mode-switching.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">mail/test/mozmill/folder-tree-modes/test-smart-folders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-widget/test-message-filters.js">mail/test/mozmill/folder-widget/test-message-filters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-widget/test-message-filters.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-widget/test-message-filters.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-widget/test-message-filters.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-widget/test-message-filters.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/folder-widget/test-message-filters.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/instrumentation/test-instrument-setup.js">mail/test/mozmill/instrumentation/test-instrument-setup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/instrumentation/test-instrument-setup.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/instrumentation/test-instrument-setup.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/instrumentation/test-instrument-setup.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/instrumentation/test-instrument-setup.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/instrumentation/test-instrument-setup.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-identity.js">mail/test/mozmill/message-header/test-reply-identity.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-identity.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-identity.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-identity.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-identity.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-identity.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js">mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/newmailaccount/test-newmailaccount.js">mail/test/mozmill/newmailaccount/test-newmailaccount.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/newmailaccount/test-newmailaccount.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/newmailaccount/test-newmailaccount.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/newmailaccount/test-newmailaccount.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/newmailaccount/test-newmailaccount.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/newmailaccount/test-newmailaccount.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/session-store/test-session-store.js">mail/test/mozmill/session-store/test-session-store.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/session-store/test-session-store.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/session-store/test-session-store.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/session-store/test-session-store.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/session-store/test-session-store.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/session-store/test-session-store.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">mail/test/mozmill/shared-modules/test-content-tab-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">mail/test/mozmill/shared-modules/test-folder-display-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js">mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-nntp-helpers.js">mail/test/mozmill/shared-modules/test-nntp-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-nntp-helpers.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-nntp-helpers.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-nntp-helpers.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-nntp-helpers.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/mozmill/shared-modules/test-nntp-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js">mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4769902c580ea46024026dba447f5a256ef66114/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js">file</a> |
<a href="/comm-central/annotate/4769902c580ea46024026dba447f5a256ef66114/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js">annotate</a> |
<a href="/comm-central/diff/4769902c580ea46024026dba447f5a256ef66114/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js">diff</a> |
<a href="/comm-central/comparison/4769902c580ea46024026dba447f5a256ef66114/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js">comparison</a> |
<a href="/comm-central/log/4769902c580ea46024026dba447f5a256ef66114/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-actions.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-actions.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -97,26 +97,27 @@ function subtest_check_account_actions(a</span>
<a href="#l1.4"></a><span id="l1.4">   close_popup(amc, amc.eid(&quot;accountActionsDropdown&quot;));</span>
<a href="#l1.5"></a><span id="l1.5"> }</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> function test_account_actions() {</span>
<a href="#l1.8"></a><span id="l1.8">   // IMAP account: can be default, can be removed.</span>
<a href="#l1.9"></a><span id="l1.9">   open_advanced_settings(function(amc) {</span>
<a href="#l1.10"></a><span id="l1.10">     subtest_check_account_actions(amc, imapAccount.key, true, true, true);</span>
<a href="#l1.11"></a><span id="l1.11">   });</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+</span>
<a href="#l1.13"></a><span id="l1.13">   // NNTP (News) account: can't be default, can be removed.</span>
<a href="#l1.14"></a><span id="l1.14">   open_advanced_settings(function(amc) {</span>
<a href="#l1.15"></a><span id="l1.15">     subtest_check_account_actions(amc, nntpAccount.key, false, true, true);</span>
<a href="#l1.16"></a><span id="l1.16">   });</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+</span>
<a href="#l1.18"></a><span id="l1.18">   // Local Folders account: can't be removed, can't be default.</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-  localFoldersAccount = MailServices.accounts.FindAccountForServer(MailServices.accounts.localFoldersServer);</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+  var localFoldersAccount = MailServices.accounts.FindAccountForServer(MailServices.accounts.localFoldersServer);</span>
<a href="#l1.21"></a><span id="l1.21">   open_advanced_settings(function(amc) {</span>
<a href="#l1.22"></a><span id="l1.22">     subtest_check_account_actions(amc, localFoldersAccount.key, false, false, true);</span>
<a href="#l1.23"></a><span id="l1.23">   });</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-</span>
<a href="#l1.25"></a><span id="l1.25">   // SMTP server row: can't be removed, can't be default.</span>
<a href="#l1.26"></a><span id="l1.26">   open_advanced_settings(function(amc) {</span>
<a href="#l1.27"></a><span id="l1.27">     subtest_check_account_actions(amc, null, false, false, true);</span>
<a href="#l1.28"></a><span id="l1.28">   });</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30">   // on the IMAP account, disable Delete Account menu item</span>
<a href="#l1.31"></a><span id="l1.31">   let disableItemPref = &quot;mail.disable_button.delete_account&quot;;</span>
<a href="#l1.32"></a><span id="l1.32"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-tree.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-tree.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -169,12 +169,12 @@ function subtest_check_selection_after_a</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">   // Remove our account.</span>
<a href="#l2.6"></a><span id="l2.6">   remove_account(gPopAccount, amc);</span>
<a href="#l2.7"></a><span id="l2.7">   // Now there should be only the original accounts left.</span>
<a href="#l2.8"></a><span id="l2.8">   assert_equals(MailServices.accounts.allServers.length, gOriginalAccountCount);</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10">   // See if the currently selected account is the one next in the account list.</span>
<a href="#l2.11"></a><span id="l2.11">   let accountTree = amc.e(&quot;accounttree&quot;);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  accountRow = accountTree.view.selection.currentIndex;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  let accountRow = accountTree.view.selection.currentIndex;</span>
<a href="#l2.14"></a><span id="l2.14">   assert_equals(accountTree.view.getItemAtIndex(accountRow)._account,</span>
<a href="#l2.15"></a><span id="l2.15">                 accountList[accountIndex + 1]);</span>
<a href="#l2.16"></a><span id="l2.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/test/mozmill/account/test-account-values.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/test/mozmill/account/test-account-values.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -104,17 +104,17 @@ function subtest_check_default_CC_addres</span>
<a href="#l3.4"></a><span id="l3.4">  */</span>
<a href="#l3.5"></a><span id="l3.5"> function test_account_name() {</span>
<a href="#l3.6"></a><span id="l3.6">   // We already have a POP account ready.</span>
<a href="#l3.7"></a><span id="l3.7">   // Create also a NNTP server.</span>
<a href="#l3.8"></a><span id="l3.8">   let nntpServer = MailServices.accounts</span>
<a href="#l3.9"></a><span id="l3.9">     .createIncomingServer(null, &quot;example.nntp.invalid&quot;, &quot;nntp&quot;)</span>
<a href="#l3.10"></a><span id="l3.10">     .QueryInterface(Ci.nsINntpIncomingServer);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  identity = MailServices.accounts.createIdentity();</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  let identity = MailServices.accounts.createIdentity();</span>
<a href="#l3.14"></a><span id="l3.14">   identity.email = &quot;tinderbox2@example.invalid&quot;;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">   let nntpAccount = MailServices.accounts.createAccount();</span>
<a href="#l3.17"></a><span id="l3.17">   nntpAccount.incomingServer = nntpServer;</span>
<a href="#l3.18"></a><span id="l3.18">   nntpAccount.addIdentity(identity);</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   assert_equals(gPopAccount.incomingServer.prettyName, &quot;nobody on example.invalid&quot;);</span>
<a href="#l3.21"></a><span id="l3.21">   assert_equals(nntpAccount.incomingServer.prettyName, &quot;example.nntp.invalid&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/addrbook/test-address-book-panes.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/addrbook/test-address-book-panes.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -8,16 +8,18 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> &quot;use strict&quot;;</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> var MODULE_NAME = &quot;test-address-book-panes&quot;;</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l4.10"></a><span id="l4.10"> var MODULE_REQUIRES = [&quot;address-book-helpers&quot;, &quot;folder-display-helpers&quot;];</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+var abController;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14"> function setupModule(module) {</span>
<a href="#l4.15"></a><span id="l4.15">   // We need this to get mc which is needed in open_address_book_window.</span>
<a href="#l4.16"></a><span id="l4.16">   let fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l4.17"></a><span id="l4.17">   fdh.installInto(module);</span>
<a href="#l4.18"></a><span id="l4.18">   let abh = collector.getModule(&quot;address-book-helpers&quot;);</span>
<a href="#l4.19"></a><span id="l4.19">   abh.installInto(module);</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21">   // Open the address book main window</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/addrbook/test-address-book.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/addrbook/test-address-book.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -6,44 +6,33 @@</span>
<a href="#l5.4"></a><span id="l5.4">  * Tests for the address book.</span>
<a href="#l5.5"></a><span id="l5.5">  */</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> &quot;use strict&quot;;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> var MODULE_NAME = 'test-address-book';</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-var MODULE_REQUIRES = ['address-book-helpers', 'folder-display-helpers',</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;address-book-helpers&quot;,</span>
<a href="#l5.14"></a><span id="l5.14">                        'compose-helpers', 'window-helpers',</span>
<a href="#l5.15"></a><span id="l5.15">                        'prompt-helpers'];</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l5.18"></a><span id="l5.18"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.19"></a><span id="l5.19"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21"> var abController = null;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-var addrBook1, addrBook2, addrBook3, addrBook4;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+var addrBook1, addrBook2, addrBook3, addrBook4, ldapBook;</span>
<a href="#l5.24"></a><span id="l5.24"> var mListA, mListB, mListC, mListD, mListE;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-var windowHelper;</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27"> function setupModule(module)</span>
<a href="#l5.28"></a><span id="l5.28"> {</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-  let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-  fdh.installInto(module);</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-  let abh = collector.getModule('address-book-helpers');</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-  abh.installInto(module);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-  let ch = collector.getModule('compose-helpers');</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-  ch.installInto(module);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-  let ph = collector.getModule('prompt-helpers');</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-  ph.installInto(module);</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-  windowHelper = collector.getModule('window-helpers');</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+    collector.getModule(lib).installInto(module);</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+  }</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">   // Open the address book main window</span>
<a href="#l5.47"></a><span id="l5.47">   abController = open_address_book_window();</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49">   // Let's add some new address books.  I'll add them</span>
<a href="#l5.50"></a><span id="l5.50">   // out of order to properly test the alphabetical</span>
<a href="#l5.51"></a><span id="l5.51">   // ordering of the address books.</span>
<a href="#l5.52"></a><span id="l5.52">   ldapBook = create_ldap_address_book(&quot;LDAP Book&quot;);</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineat">@@ -122,30 +111,30 @@ function test_persist_collapsed_and_expa</span>
<a href="#l5.54"></a><span id="l5.54"> {</span>
<a href="#l5.55"></a><span id="l5.55">   // Set the state of address books 1 and 3 to expanded</span>
<a href="#l5.56"></a><span id="l5.56">   set_address_books_expanded([addrBook1, addrBook3]);</span>
<a href="#l5.57"></a><span id="l5.57"> </span>
<a href="#l5.58"></a><span id="l5.58">   // Set address book 2 to be collapsed</span>
<a href="#l5.59"></a><span id="l5.59">   set_address_book_collapsed(addrBook2);</span>
<a href="#l5.60"></a><span id="l5.60"> </span>
<a href="#l5.61"></a><span id="l5.61">   // Now close and re-open the address book</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-  abController.window.close();</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+  close_address_book_window(abController);</span>
<a href="#l5.64"></a><span id="l5.64">   abController = open_address_book_window();</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66">   assert_true(is_address_book_collapsed(addrBook2));</span>
<a href="#l5.67"></a><span id="l5.67">   assert_true(!is_address_book_collapsed(addrBook1));</span>
<a href="#l5.68"></a><span id="l5.68">   assert_true(!is_address_book_collapsed(addrBook3));</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70">   // Now set the state of address books 1 and 3 to collapsed</span>
<a href="#l5.71"></a><span id="l5.71">   // and make sure 2 is expanded</span>
<a href="#l5.72"></a><span id="l5.72">   set_address_books_collapsed([addrBook1, addrBook3]);</span>
<a href="#l5.73"></a><span id="l5.73">   set_address_book_expanded(addrBook2);</span>
<a href="#l5.74"></a><span id="l5.74"> </span>
<a href="#l5.75"></a><span id="l5.75">   // Now close and re-open the address book</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-  abController.window.close();</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+  close_address_book_window(abController);</span>
<a href="#l5.78"></a><span id="l5.78">   abController = open_address_book_window();</span>
<a href="#l5.79"></a><span id="l5.79"> </span>
<a href="#l5.80"></a><span id="l5.80">   assert_true(!is_address_book_collapsed(addrBook2));</span>
<a href="#l5.81"></a><span id="l5.81">   assert_true(is_address_book_collapsed(addrBook1));</span>
<a href="#l5.82"></a><span id="l5.82">   assert_true(is_address_book_collapsed(addrBook3));</span>
<a href="#l5.83"></a><span id="l5.83"> }</span>
<a href="#l5.84"></a><span id="l5.84"> </span>
<a href="#l5.85"></a><span id="l5.85"> /* Test that if we try to delete a contact, that we are given</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineat">@@ -348,17 +337,17 @@ function test_writing_to_mailing_list() </span>
<a href="#l5.87"></a><span id="l5.87">   // Now select the mailing list in the tree...</span>
<a href="#l5.88"></a><span id="l5.88">   select_address_book(addedList);</span>
<a href="#l5.89"></a><span id="l5.89"> </span>
<a href="#l5.90"></a><span id="l5.90">   // Focus it...</span>
<a href="#l5.91"></a><span id="l5.91">   abController.window.gDirTree.focus();</span>
<a href="#l5.92"></a><span id="l5.92"> </span>
<a href="#l5.93"></a><span id="l5.93">   // Assuming we've made it this far, now we just plan for the compose</span>
<a href="#l5.94"></a><span id="l5.94">   // window...</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-  windowHelper.plan_for_new_window(&quot;msgcompose&quot;);</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+  plan_for_new_window(&quot;msgcompose&quot;);</span>
<a href="#l5.97"></a><span id="l5.97">   // ... and click the &quot;Write&quot; button</span>
<a href="#l5.98"></a><span id="l5.98">   abController.click(abController.eid(&quot;button-newmessage&quot;));</span>
<a href="#l5.99"></a><span id="l5.99">   let composeWin = wait_for_compose_window(abController);</span>
<a href="#l5.100"></a><span id="l5.100">   let to = composeWin.window.gMsgCompose.compFields.to;</span>
<a href="#l5.101"></a><span id="l5.101"> </span>
<a href="#l5.102"></a><span id="l5.102">   // Make sure we're writing to all contacts in the mailing list.</span>
<a href="#l5.103"></a><span id="l5.103">   for (let contact of contacts) {</span>
<a href="#l5.104"></a><span id="l5.104">     assert_true(to.includes(contact.primaryEmail));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment-size.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment-size.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -326,20 +326,18 @@ function check_total_attachment_size(cou</span>
<a href="#l6.4"></a><span id="l6.4">  * @param index the index of the message to check in the thread pane</span>
<a href="#l6.5"></a><span id="l6.5">  */</span>
<a href="#l6.6"></a><span id="l6.6"> function help_test_attachment_size(index) {</span>
<a href="#l6.7"></a><span id="l6.7">   be_in_folder(folder);</span>
<a href="#l6.8"></a><span id="l6.8">   let curMessage = select_click_row(index);</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">   let expectedSizes = messages[index].attachmentSizes;</span>
<a href="#l6.11"></a><span id="l6.11">   for (let i = 0; i &lt; expectedSizes.length; i++) {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    if(expectedSizes[i] == null) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-      unknownSize = true;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    if (expectedSizes[i] == null)</span>
<a href="#l6.15"></a><span id="l6.15">       check_no_attachment_size(i);</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-    }</span>
<a href="#l6.17"></a><span id="l6.17">     else</span>
<a href="#l6.18"></a><span id="l6.18">       check_attachment_size(i, expectedSizes[i]);</span>
<a href="#l6.19"></a><span id="l6.19">   }</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">   let totalSize = messages[index].attachmentTotalSize;</span>
<a href="#l6.22"></a><span id="l6.22">   check_total_attachment_size(expectedSizes.length, totalSize.size,</span>
<a href="#l6.23"></a><span id="l6.23">                               totalSize.exact);</span>
<a href="#l6.24"></a><span id="l6.24"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -16,16 +16,17 @@ var MODULE_REQUIRES = ['folder-display-h</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> var elib = {};</span>
<a href="#l7.6"></a><span id="l7.6"> ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.js&quot;, elib);</span>
<a href="#l7.7"></a><span id="l7.7"> var EventUtils = {};</span>
<a href="#l7.8"></a><span id="l7.8"> ChromeUtils.import(&quot;chrome://mozmill/content/stdlib/EventUtils.js&quot;, EventUtils);</span>
<a href="#l7.9"></a><span id="l7.9"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> var folder;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+var messages;</span>
<a href="#l7.13"></a><span id="l7.13"> </span>
<a href="#l7.14"></a><span id="l7.14"> var textAttachment =</span>
<a href="#l7.15"></a><span id="l7.15">   &quot;One of these days... people like me will rise up and overthrow you, and &quot; +</span>
<a href="#l7.16"></a><span id="l7.16">   &quot;the end of tyranny by the homeostatic machine will have arrived. The day &quot; +</span>
<a href="#l7.17"></a><span id="l7.17">   &quot;of human values and compassion and simple warmth will return, and when &quot; +</span>
<a href="#l7.18"></a><span id="l7.18">   &quot;that happens someone like myself who has gone through an ordeal and who &quot; +</span>
<a href="#l7.19"></a><span id="l7.19">   &quot;genuinely needs hot coffee to pick him up and keep him functioning when &quot; +</span>
<a href="#l7.20"></a><span id="l7.20">   &quot;he has to function will get the hot coffee whether he happens to have a &quot; +</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-address-widgets.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-address-widgets.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -12,26 +12,30 @@ var MODULE_NAME = &quot;test-address-widgets&quot;</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l8.6"></a><span id="l8.6"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;compose-helpers&quot;,</span>
<a href="#l8.7"></a><span id="l8.7">                          &quot;window-helpers&quot;];</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> var cwc = null; // compose window controller</span>
<a href="#l8.10"></a><span id="l8.10"> var accountPOP3 = null;</span>
<a href="#l8.11"></a><span id="l8.11"> var accountNNTP = null;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+var originalAccountCount;</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14"> function setupModule(module) {</span>
<a href="#l8.15"></a><span id="l8.15">   for (let lib of MODULE_REQUIRES) {</span>
<a href="#l8.16"></a><span id="l8.16">     collector.getModule(lib).installInto(module);</span>
<a href="#l8.17"></a><span id="l8.17">   }</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">   // Ensure we're in the tinderbox account as that has the right identities set</span>
<a href="#l8.20"></a><span id="l8.20">   // up for this test.</span>
<a href="#l8.21"></a><span id="l8.21">   let server = MailServices.accounts.FindServer(&quot;tinderbox&quot;, FAKE_SERVER_HOSTNAME, &quot;pop3&quot;);</span>
<a href="#l8.22"></a><span id="l8.22">   accountPOP3 = MailServices.accounts.FindAccountForServer(server);</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+  // There may be pre-existing accounts from other tests.</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+  originalAccountCount = MailServices.accounts.allServers.length;</span>
<a href="#l8.26"></a><span id="l8.26"> };</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28"> function teardownModule(module) {</span>
<a href="#l8.29"></a><span id="l8.29"> }</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31"> /**</span>
<a href="#l8.32"></a><span id="l8.32">  * Check if the address type items are in the wished state.</span>
<a href="#l8.33"></a><span id="l8.33">  *</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineat">@@ -62,25 +66,22 @@ function check_mail_address_types() {</span>
<a href="#l8.35"></a><span id="l8.35">  * With a NNTP account, all address types should be enabled.</span>
<a href="#l8.36"></a><span id="l8.36">  */</span>
<a href="#l8.37"></a><span id="l8.37"> function check_nntp_address_types() {</span>
<a href="#l8.38"></a><span id="l8.38">   check_address_types_state([&quot;addr_to&quot;, &quot;addr_cc&quot;, &quot;addr_reply&quot;, &quot;addr_bcc&quot;,</span>
<a href="#l8.39"></a><span id="l8.39">                              &quot;addr_newsgroups&quot;, &quot;addr_followup&quot;]);</span>
<a href="#l8.40"></a><span id="l8.40"> }</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42"> function add_NNTP_account() {</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-  // There may be pre-existing accounts from other tests.</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-  originalAccountCount = MailServices.accounts.allServers.length;</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-</span>
<a href="#l8.46"></a><span id="l8.46">   // Create a NNTP server</span>
<a href="#l8.47"></a><span id="l8.47">   let nntpServer = MailServices.accounts</span>
<a href="#l8.48"></a><span id="l8.48">     .createIncomingServer(null, &quot;example.nntp.invalid&quot;, &quot;nntp&quot;)</span>
<a href="#l8.49"></a><span id="l8.49">     .QueryInterface(Ci.nsINntpIncomingServer);</span>
<a href="#l8.50"></a><span id="l8.50"> </span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-  identity = MailServices.accounts.createIdentity();</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+  let identity = MailServices.accounts.createIdentity();</span>
<a href="#l8.53"></a><span id="l8.53">   identity.email = &quot;tinderbox2@example.invalid&quot;;</span>
<a href="#l8.54"></a><span id="l8.54"> </span>
<a href="#l8.55"></a><span id="l8.55">   accountNNTP = MailServices.accounts.createAccount();</span>
<a href="#l8.56"></a><span id="l8.56">   accountNNTP.incomingServer = nntpServer;</span>
<a href="#l8.57"></a><span id="l8.57">   accountNNTP.addIdentity(identity);</span>
<a href="#l8.58"></a><span id="l8.58">   // Now there should be 1 more account.</span>
<a href="#l8.59"></a><span id="l8.59">   assert_equals(MailServices.accounts.allServers.length, originalAccountCount + 1);</span>
<a href="#l8.60"></a><span id="l8.60"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-drafts.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-drafts.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -90,19 +90,19 @@ function internal_check_delivery_format(</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">   setup_msg_contents(cwc, &quot;test@example.invalid&quot;,</span>
<a href="#l9.6"></a><span id="l9.6">                      &quot;Testing storing of the composition properties in the draft!&quot;,</span>
<a href="#l9.7"></a><span id="l9.7">                      &quot;Hello!&quot;);</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">   // Select our wanted format.</span>
<a href="#l9.10"></a><span id="l9.10">   if (!mc.mozmillModule.isMac) {</span>
<a href="#l9.11"></a><span id="l9.11">     cwc.click(cwc.eid(&quot;optionsMenu&quot;));</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    formatMenu = cwc.click_menus_in_sequence(cwc.e(&quot;optionsMenuPopup&quot;),</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                                             [ { id: &quot;outputFormatMenu&quot; },</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-                                               { id: &quot;format_both&quot; } ]);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+    cwc.click_menus_in_sequence(cwc.e(&quot;optionsMenuPopup&quot;),</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+                                [ { id: &quot;outputFormatMenu&quot; },</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+                                  { id: &quot;format_both&quot; } ]);</span>
<a href="#l9.18"></a><span id="l9.18">   } else {</span>
<a href="#l9.19"></a><span id="l9.19">     // On OS X the main menu seems not accessible for clicking from mozmill.</span>
<a href="#l9.20"></a><span id="l9.20">     assert_true(cwc.e(&quot;outputFormatMenu&quot;).getAttribute(&quot;oncommand&quot;).startsWith(&quot;OutputFormatMenuSelect(&quot;));</span>
<a href="#l9.21"></a><span id="l9.21">     cwc.window.OutputFormatMenuSelect(cwc.e(&quot;format_both&quot;));</span>
<a href="#l9.22"></a><span id="l9.22">   }</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">   /**</span>
<a href="#l9.25"></a><span id="l9.25">    * Check if the right format is selected in the menu.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-forward-headers.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-forward-headers.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -12,33 +12,32 @@</span>
<a href="#l10.4"></a><span id="l10.4"> var MODULE_NAME = &quot;test-forward-headers&quot;;</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l10.7"></a><span id="l10.7"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;compose-helpers&quot;, &quot;window-helpers&quot;,</span>
<a href="#l10.8"></a><span id="l10.8">                          &quot;message-helpers&quot;];</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-var composeHelper = null;</span>
<a href="#l10.13"></a><span id="l10.13"> var cwc = null; // compose window controller</span>
<a href="#l10.14"></a><span id="l10.14"> var folder;</span>
<a href="#l10.15"></a><span id="l10.15"> var gDrafts;</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17"> var setupModule = function (module) {</span>
<a href="#l10.18"></a><span id="l10.18">   let fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l10.19"></a><span id="l10.19">   fdh.installInto(module);</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-  composeHelper = collector.getModule(&quot;compose-helpers&quot;);</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+  let composeHelper = collector.getModule(&quot;compose-helpers&quot;);</span>
<a href="#l10.22"></a><span id="l10.22">   composeHelper.installInto(module);</span>
<a href="#l10.23"></a><span id="l10.23">   let wh = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l10.24"></a><span id="l10.24">   wh.installInto(module);</span>
<a href="#l10.25"></a><span id="l10.25">   let mh = collector.getModule(&quot;message-helpers&quot;);</span>
<a href="#l10.26"></a><span id="l10.26">   mh.installInto(module);</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">   folder = create_folder(&quot;Test&quot;);</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-  thread1 = create_thread(10);</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+  let thread1 = create_thread(10);</span>
<a href="#l10.31"></a><span id="l10.31">   add_sets_to_folders([folder], [thread1]);</span>
<a href="#l10.32"></a><span id="l10.32"> </span>
<a href="#l10.33"></a><span id="l10.33">   gDrafts = get_special_folder(Ci.nsMsgFolderFlags.Drafts, true);</span>
<a href="#l10.34"></a><span id="l10.34"> </span>
<a href="#l10.35"></a><span id="l10.35">   // Don't create paragraphs in the test.</span>
<a href="#l10.36"></a><span id="l10.36">   // The test checks for the first DOM node and expects a text and not</span>
<a href="#l10.37"></a><span id="l10.37">   // a paragraph.</span>
<a href="#l10.38"></a><span id="l10.38">   Services.prefs.setBoolPref(&quot;mail.compose.default_to_paragraph&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-forwarded-content.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-forwarded-content.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -9,34 +9,24 @@</span>
<a href="#l11.4"></a><span id="l11.4"> &quot;use strict&quot;;</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6"> var MODULE_NAME = &quot;test-forwarded-content&quot;;</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l11.9"></a><span id="l11.9"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;,</span>
<a href="#l11.10"></a><span id="l11.10">                          &quot;window-helpers&quot;, &quot;compose-helpers&quot;];</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-var elib = {};</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.js&quot;, elib);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-var folderHelper = null;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-var windowindowHelperelper = null;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-var composeHelper = null;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">-</span>
<a href="#l11.19"></a><span id="l11.19"> var folder = null;</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-var setupModule = function(module) {</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-  folderHelper = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">-  folderHelper.installInto(module);</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">-  windowHelper = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-  windowHelper.installInto(module);</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-  composeHelper = collector.getModule(&quot;compose-helpers&quot;);</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-  composeHelper.installInto(module);</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+function setupModule(module) {</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+    collector.getModule(lib).installInto(module);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+  }</span>
<a href="#l11.32"></a><span id="l11.32"> </span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-  folder = folderHelper.create_folder(&quot;Forward Content Testing&quot;);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  folder = create_folder(&quot;Forward Content Testing&quot;);</span>
<a href="#l11.35"></a><span id="l11.35">   add_message_to_folder(folder, create_message({</span>
<a href="#l11.36"></a><span id="l11.36">     subject: &quot;something like &lt;foo@example&gt;&quot;,</span>
<a href="#l11.37"></a><span id="l11.37">     body: {body: &quot;Testing bug 397021!&quot;},</span>
<a href="#l11.38"></a><span id="l11.38">   }));</span>
<a href="#l11.39"></a><span id="l11.39"> }</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41"> /**</span>
<a href="#l11.42"></a><span id="l11.42">  * Test that the subject is set properly in the forwarded message content</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-save-changes-on-quit.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-save-changes-on-quit.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -123,17 +123,17 @@ function test_can_quit_on_changes() {</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5">   // Set the Mock Prompt Service to return true, so that we're</span>
<a href="#l12.6"></a><span id="l12.6">   // allowing the quit to occur.</span>
<a href="#l12.7"></a><span id="l12.7">   gMockPromptService.returnValue = DONT_SAVE;</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">   // Trigger the quit-application-request notification</span>
<a href="#l12.10"></a><span id="l12.10">   Services.obs.notifyObservers(cancelQuit, &quot;quit-application-requested&quot;);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  promptState = gMockPromptService.promptState;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  let promptState = gMockPromptService.promptState;</span>
<a href="#l12.14"></a><span id="l12.14">   assert_not_equals(null, promptState, &quot;Expected a confirmEx prompt&quot;);</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16">   assert_equals(&quot;confirmEx&quot;, promptState.method);</span>
<a href="#l12.17"></a><span id="l12.17">   // Since we returned true on the confirmation dialog,</span>
<a href="#l12.18"></a><span id="l12.18">   // we should be quitting - so cancelQuit.data should now be</span>
<a href="#l12.19"></a><span id="l12.19">   // false</span>
<a href="#l12.20"></a><span id="l12.20">   assert_false(cancelQuit.data, &quot;The quit request was cancelled&quot;);</span>
<a href="#l12.21"></a><span id="l12.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-plugin-crashing.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-plugin-crashing.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -13,17 +13,17 @@ var frame = {};</span>
<a href="#l13.4"></a><span id="l13.4"> ChromeUtils.import(&quot;chrome://mozmill/content/modules/frame.js&quot;, frame);</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> ChromeUtils.import('resource://gre/modules/Services.jsm');</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> var gContentWindow = null;</span>
<a href="#l13.9"></a><span id="l13.9"> var gJSObject = null;</span>
<a href="#l13.10"></a><span id="l13.10"> var gTabDoc = null;</span>
<a href="#l13.11"></a><span id="l13.11"> var gOldStartPage = null;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-var gOldCrashReporterEnabled = null;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+var gOldPluginCrashDocPage = null;</span>
<a href="#l13.14"></a><span id="l13.14"> var crashReporter = null;</span>
<a href="#l13.15"></a><span id="l13.15"> var kPluginId = &quot;test-plugin&quot;;</span>
<a href="#l13.16"></a><span id="l13.16"> var kStartPagePref = &quot;mailnews.start_page.override_url&quot;;</span>
<a href="#l13.17"></a><span id="l13.17"> var kPluginCrashDocPref = &quot;plugins.crash.supportUrl&quot;;</span>
<a href="#l13.18"></a><span id="l13.18"> // RELATIVE_ROOT messes with the collector, so we have to bring the path back</span>
<a href="#l13.19"></a><span id="l13.19"> // so we get the right path for the resources.</span>
<a href="#l13.20"></a><span id="l13.20"> var kUrl = collector.addHttpResource('../content-tabs/html', '');</span>
<a href="#l13.21"></a><span id="l13.21"> var kPluginUrl = kUrl + &quot;plugin.html&quot;;</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -41,22 +41,18 @@ function setupModule(module) {</span>
<a href="#l13.23"></a><span id="l13.23">   gOldPluginCrashDocPage = Services.prefs.getCharPref(kPluginCrashDocPref);</span>
<a href="#l13.24"></a><span id="l13.24"> </span>
<a href="#l13.25"></a><span id="l13.25">   Services.prefs.setCharPref(kStartPagePref, kPluginUrl);</span>
<a href="#l13.26"></a><span id="l13.26">   Services.prefs.setCharPref(kPluginCrashDocPref, kPluginCrashDocUrl);</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">   try {</span>
<a href="#l13.29"></a><span id="l13.29">     crashReporter = Cc[&quot;@mozilla.org/toolkit/crash-reporter;1&quot;]</span>
<a href="#l13.30"></a><span id="l13.30">                       .getService(Ci.nsICrashReporter);</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-    // Force the crash reporter to be enabled, but record its old setting.</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-    gOldCrashReporterEnabled = crashReporter.enabled;</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-    if (!crashReporter.enabled) {</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-      crashReporter.enabled = true;</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-    }</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+    // The crash reporter must be enabled.</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+    assert_true(crashReporter.enabled, &quot;Mandatory Crash reporter is not enabled&quot;);</span>
<a href="#l13.39"></a><span id="l13.39">   } catch (e) {</span>
<a href="#l13.40"></a><span id="l13.40">     // Crashreporter is not working.</span>
<a href="#l13.41"></a><span id="l13.41">   }</span>
<a href="#l13.42"></a><span id="l13.42"> </span>
<a href="#l13.43"></a><span id="l13.43"> </span>
<a href="#l13.44"></a><span id="l13.44">   /* Bug 689580 - these crash tests fail randomly on 64-bit OSX.  We'll</span>
<a href="#l13.45"></a><span id="l13.45">    * disable them for now, until we can figure out what's going on.</span>
<a href="#l13.46"></a><span id="l13.46">    */</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineat">@@ -76,19 +72,16 @@ function setupModule(module) {</span>
<a href="#l13.48"></a><span id="l13.48">       func.__force_skip__ = true;</span>
<a href="#l13.49"></a><span id="l13.49">     });</span>
<a href="#l13.50"></a><span id="l13.50">   }</span>
<a href="#l13.51"></a><span id="l13.51">   let plugin = get_test_plugin();</span>
<a href="#l13.52"></a><span id="l13.52">   plugin.enabledState = plugin.STATE_ENABLED;</span>
<a href="#l13.53"></a><span id="l13.53"> };</span>
<a href="#l13.54"></a><span id="l13.54"> </span>
<a href="#l13.55"></a><span id="l13.55"> function teardownModule(module) {</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-  if (crashReporter)</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-    crashReporter.enabled = gOldCrashReporterEnabled;</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-</span>
<a href="#l13.59"></a><span id="l13.59">   Services.prefs.setCharPref(kStartPagePref, gOldStartPage);</span>
<a href="#l13.60"></a><span id="l13.60">   Services.prefs.setCharPref(kPluginCrashDocPref, gOldPluginCrashDocPage);</span>
<a href="#l13.61"></a><span id="l13.61"> }</span>
<a href="#l13.62"></a><span id="l13.62"> </span>
<a href="#l13.63"></a><span id="l13.63"> function setupTest() {</span>
<a href="#l13.64"></a><span id="l13.64">   let tab = open_content_tab_with_click(mc.menus.helpMenu.whatsNew, kPluginUrl);</span>
<a href="#l13.65"></a><span id="l13.65">   assert_tab_has_title(tab, &quot;Plugin Test&quot;);</span>
<a href="#l13.66"></a><span id="l13.66"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/test/mozmill/downloads/test-about-downloads.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/test/mozmill/downloads/test-about-downloads.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -15,17 +15,16 @@ var MODULE_NAME = &quot;test-about-downloads&quot;</span>
<a href="#l14.4"></a><span id="l14.4"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l14.5"></a><span id="l14.5"> var MODULE_REQUIRES = [ 'attachment-helpers',</span>
<a href="#l14.6"></a><span id="l14.6">                         'content-tab-helpers',</span>
<a href="#l14.7"></a><span id="l14.7">                         'dom-helpers',</span>
<a href="#l14.8"></a><span id="l14.8">                         'folder-display-helpers',</span>
<a href="#l14.9"></a><span id="l14.9">                         'prompt-helpers',</span>
<a href="#l14.10"></a><span id="l14.10">                         'window-helpers' ];</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-var mozmill = {}; ChromeUtils.import(&quot;chrome://mozmill/content/modules/mozmill.js&quot;, mozmill);</span>
<a href="#l14.13"></a><span id="l14.13"> var elementslib = {}; ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.js&quot;, elementslib);</span>
<a href="#l14.14"></a><span id="l14.14"> var downloads = {}; ChromeUtils.import(&quot;resource://gre/modules/Downloads.jsm&quot;, downloads);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> var downloadsTab;</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> var attachmentFileNames = [</span>
<a href="#l14.19"></a><span id="l14.19">   &quot;Attachment#1.txt&quot;,</span>
<a href="#l14.20"></a><span id="l14.20">   &quot;Attachment#2.txt&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-message-size.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-message-size.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -19,23 +19,23 @@ var folder;</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5"> function setupModule(module) {</span>
<a href="#l15.6"></a><span id="l15.6">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l15.7"></a><span id="l15.7">   fdh.installInto(module);</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">   folder = create_folder(&quot;MessageSizeA&quot;);</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">   // Create messages with sizes in the byte, KB, and MB ranges.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  bytemsg = create_message({body: {body: &quot; &quot;}});</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  let bytemsg = create_message({body: {body: &quot; &quot;}});</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-  kbstring = &quot;x &quot;.repeat(1024/2);</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-  kbmsg = create_message({body: {body: kbstring}});</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  let kbstring = &quot;x &quot;.repeat(1024/2);</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+  let kbmsg = create_message({body: {body: kbstring}});</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-  mbstring = kbstring.repeat(1024);</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-  mbmsg = create_message({body: {body: mbstring}});</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+  let mbstring = kbstring.repeat(1024);</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+  let mbmsg = create_message({body: {body: mbstring}});</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">   add_message_to_folder(folder, bytemsg);</span>
<a href="#l15.26"></a><span id="l15.26">   add_message_to_folder(folder, kbmsg);</span>
<a href="#l15.27"></a><span id="l15.27">   add_message_to_folder(folder, mbmsg);</span>
<a href="#l15.28"></a><span id="l15.28"> }</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30"> function _help_test_message_size(index, unit) {</span>
<a href="#l15.31"></a><span id="l15.31">   be_in_folder(folder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-pane-focus.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-pane-focus.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -16,17 +16,17 @@ var MODULE_REQUIRES = [&quot;folder-display-h</span>
<a href="#l16.4"></a><span id="l16.4"> var folder;</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> function setupModule(module) {</span>
<a href="#l16.7"></a><span id="l16.7">   let fdh = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l16.8"></a><span id="l16.8">   fdh.installInto(module);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">   folder = create_folder(&quot;PaneFocus&quot;);</span>
<a href="#l16.11"></a><span id="l16.11">   let msg1 = create_thread(1);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  thread = create_thread(3);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  let thread = create_thread(3);</span>
<a href="#l16.14"></a><span id="l16.14">   let msg2 = create_thread(1);</span>
<a href="#l16.15"></a><span id="l16.15">   add_sets_to_folders([folder], [msg1, thread, msg2]);</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">   be_in_folder(folder);</span>
<a href="#l16.18"></a><span id="l16.18">   make_display_threaded();</span>
<a href="#l16.19"></a><span id="l16.19">   collapse_all_threads();</span>
<a href="#l16.20"></a><span id="l16.20"> }</span>
<a href="#l16.21"></a><span id="l16.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -229,28 +229,28 @@ function _middle_click_on_existing_multi</span>
<a href="#l17.4"></a><span id="l17.4">   assert_folder_selected_and_displayed(folderA);</span>
<a href="#l17.5"></a><span id="l17.5"> }</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7"> /**</span>
<a href="#l17.8"></a><span id="l17.8">  * Generate background and foreground tests for each middle click test.</span>
<a href="#l17.9"></a><span id="l17.9">  *</span>
<a href="#l17.10"></a><span id="l17.10">  * @param aTests an array of test names</span>
<a href="#l17.11"></a><span id="l17.11">  */</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+var global = this;</span>
<a href="#l17.13"></a><span id="l17.13"> function _generate_background_foreground_tests(aTests) {</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-  let self = this;</span>
<a href="#l17.15"></a><span id="l17.15">   for (let test of aTests) {</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-    let helperFunc = this[&quot;_&quot; + test + &quot;_helper&quot;];</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-    this[&quot;test_&quot; + test + &quot;_background&quot;] = function() {</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+    let helperFunc = global[&quot;_&quot; + test + &quot;_helper&quot;];</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+    global[&quot;test_&quot; + test + &quot;_background&quot;] = function() {</span>
<a href="#l17.20"></a><span id="l17.20">       set_context_menu_background_tabs(true);</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-      helperFunc.apply(self, [true]);</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+      helperFunc(true);</span>
<a href="#l17.23"></a><span id="l17.23">       reset_context_menu_background_tabs();</span>
<a href="#l17.24"></a><span id="l17.24">     };</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-    this[&quot;test_&quot; + test + &quot;_foreground&quot;] = function() {</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+    global[&quot;test_&quot; + test + &quot;_foreground&quot;] = function() {</span>
<a href="#l17.27"></a><span id="l17.27">       set_context_menu_background_tabs(false);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-      helperFunc.apply(self, [false]);</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+      helperFunc(false);</span>
<a href="#l17.30"></a><span id="l17.30">       reset_context_menu_background_tabs();</span>
<a href="#l17.31"></a><span id="l17.31">     };</span>
<a href="#l17.32"></a><span id="l17.32">   }</span>
<a href="#l17.33"></a><span id="l17.33"> }</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35"> _generate_background_foreground_tests([</span>
<a href="#l17.36"></a><span id="l17.36">   &quot;middle_click_folder_with_nothing_selected&quot;,</span>
<a href="#l17.37"></a><span id="l17.37">   &quot;middle_click_folder_with_one_thing_selected&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -394,28 +394,28 @@ function _middle_click_on_expanded_threa</span>
<a href="#l18.4"></a><span id="l18.4">   close_tab(tabMessage);</span>
<a href="#l18.5"></a><span id="l18.5"> }</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7"> /**</span>
<a href="#l18.8"></a><span id="l18.8">  * Generate background and foreground tests for each middle click test.</span>
<a href="#l18.9"></a><span id="l18.9">  *</span>
<a href="#l18.10"></a><span id="l18.10">  * @param aTests an array of test names</span>
<a href="#l18.11"></a><span id="l18.11">  */</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+var global = this;</span>
<a href="#l18.13"></a><span id="l18.13"> function _generate_background_foreground_tests(aTests) {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-  let self = this;</span>
<a href="#l18.15"></a><span id="l18.15">   for (let test of aTests) {</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-    let helperFunc = this[&quot;_&quot; + test + &quot;_helper&quot;];</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-    this[&quot;test_&quot; + test + &quot;_background&quot;] = function() {</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+    let helperFunc = global[&quot;_&quot; + test + &quot;_helper&quot;];</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+    global[&quot;test_&quot; + test + &quot;_background&quot;] = function() {</span>
<a href="#l18.20"></a><span id="l18.20">       set_context_menu_background_tabs(true);</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-      helperFunc.apply(self, [true]);</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+      helperFunc(true);</span>
<a href="#l18.23"></a><span id="l18.23">       reset_context_menu_background_tabs();</span>
<a href="#l18.24"></a><span id="l18.24">     };</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-    this[&quot;test_&quot; + test + &quot;_foreground&quot;] = function() {</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+    global[&quot;test_&quot; + test + &quot;_foreground&quot;] = function() {</span>
<a href="#l18.27"></a><span id="l18.27">       set_context_menu_background_tabs(false);</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineminus">-      helperFunc.apply(self, [false]);</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+      helperFunc(false);</span>
<a href="#l18.30"></a><span id="l18.30">       reset_context_menu_background_tabs();</span>
<a href="#l18.31"></a><span id="l18.31">     };</span>
<a href="#l18.32"></a><span id="l18.32">   }</span>
<a href="#l18.33"></a><span id="l18.33"> }</span>
<a href="#l18.34"></a><span id="l18.34"> </span>
<a href="#l18.35"></a><span id="l18.35"> _generate_background_foreground_tests([</span>
<a href="#l18.36"></a><span id="l18.36">   &quot;middle_click_with_nothing_selected&quot;,</span>
<a href="#l18.37"></a><span id="l18.37">   &quot;middle_click_with_one_thing_selected&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-savedsearch-reload-after-compact.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -9,46 +9,44 @@</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> &quot;use strict&quot;;</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> var MODULE_NAME = &quot;test-savedsearch-reload-after-compact&quot;;</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l19.10"></a><span id="l19.10"> var MODULE_REQUIRES = ['folder-display-helpers', 'window-helpers'];</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-var folderInbox, folderVirtual;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-</span>
<a href="#l19.14"></a><span id="l19.14"> function setupModule(module) {</span>
<a href="#l19.15"></a><span id="l19.15">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l19.16"></a><span id="l19.16">   fdh.installInto(module);</span>
<a href="#l19.17"></a><span id="l19.17">   let wh = collector.getModule('window-helpers');</span>
<a href="#l19.18"></a><span id="l19.18">   wh.installInto(module);</span>
<a href="#l19.19"></a><span id="l19.19"> }</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21"> /**</span>
<a href="#l19.22"></a><span id="l19.22">  * Add some messages to a folder, delete the first one, and create a saved</span>
<a href="#l19.23"></a><span id="l19.23">  * search over the inbox and the folder. Then, compact folders.</span>
<a href="#l19.24"></a><span id="l19.24">  */</span>
<a href="#l19.25"></a><span id="l19.25"> function test_setup_virtual_folder_and_compact() {</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">-  otherFolder = create_folder(&quot;otherFolder&quot;);</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+  let otherFolder = create_folder(&quot;otherFolder&quot;);</span>
<a href="#l19.28"></a><span id="l19.28">   let [msgSet] = make_new_sets_in_folder(otherFolder, [{count: 2}]);</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30">   /**</span>
<a href="#l19.31"></a><span id="l19.31">    * We delete the first message in the local folder, so compaction of the</span>
<a href="#l19.32"></a><span id="l19.32">    * folder will invalidate the key of the second message in the folder. Then,</span>
<a href="#l19.33"></a><span id="l19.33">    * we select the second message and issue the compact. This causes saving the</span>
<a href="#l19.34"></a><span id="l19.34">    * selection on the compaction notification to fail. We test the saved search</span>
<a href="#l19.35"></a><span id="l19.35">    * view still gets rebuilt, such that there is a valid msg hdr at row 0.</span>
<a href="#l19.36"></a><span id="l19.36">    */</span>
<a href="#l19.37"></a><span id="l19.37">   be_in_folder(otherFolder);</span>
<a href="#l19.38"></a><span id="l19.38">   let curMessage = select_click_row(0);</span>
<a href="#l19.39"></a><span id="l19.39">   press_delete();</span>
<a href="#l19.40"></a><span id="l19.40"> </span>
<a href="#l19.41"></a><span id="l19.41" class="difflineminus">-  folderVirtual = create_virtual_folder([inboxFolder, otherFolder], {},</span>
<a href="#l19.42"></a><span id="l19.42" class="difflineminus">-                                        true, &quot;SavedSearch&quot;);</span>
<a href="#l19.43"></a><span id="l19.43" class="difflineplus">+  let folderVirtual = create_virtual_folder([inboxFolder, otherFolder], {},</span>
<a href="#l19.44"></a><span id="l19.44" class="difflineplus">+                                            true, &quot;SavedSearch&quot;);</span>
<a href="#l19.45"></a><span id="l19.45"> </span>
<a href="#l19.46"></a><span id="l19.46">   be_in_folder(folderVirtual);</span>
<a href="#l19.47"></a><span id="l19.47">   curMessage = select_click_row(0);</span>
<a href="#l19.48"></a><span id="l19.48">   let urlListener = {</span>
<a href="#l19.49"></a><span id="l19.49">     compactDone: false,</span>
<a href="#l19.50"></a><span id="l19.50"> </span>
<a href="#l19.51"></a><span id="l19.51">     OnStartRunningUrl: function (aUrl) {</span>
<a href="#l19.52"></a><span id="l19.52">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-tooltip-multimessage.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-tooltip-multimessage.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -15,17 +15,17 @@ var MODULE_REQUIRES = ['folder-display-h</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> var folder;</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> var setupModule = function(module) {</span>
<a href="#l20.8"></a><span id="l20.8">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l20.9"></a><span id="l20.9">   fdh.installInto(module);</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   folder = create_folder(&quot;Test&quot;);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  thread1 = create_thread(10);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  let thread1 = create_thread(10);</span>
<a href="#l20.14"></a><span id="l20.14">   add_sets_to_folders([folder], [thread1]);</span>
<a href="#l20.15"></a><span id="l20.15"> };</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17"> function test_tooltips() {</span>
<a href="#l20.18"></a><span id="l20.18">   // Trigger the message summary. This is needed otherwise we cannot compute the</span>
<a href="#l20.19"></a><span id="l20.19">   // style of aHTMLTooltip in mailWindow.js</span>
<a href="#l20.20"></a><span id="l20.20">   be_in_folder(folder);</span>
<a href="#l20.21"></a><span id="l20.21">   select_click_row(0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/test/mozmill/folder-pane/test-folder-pane.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/test/mozmill/folder-pane/test-folder-pane.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -35,27 +35,31 @@ function test_all_folders_toggle_folder_</span>
<a href="#l21.4"></a><span id="l21.4">   collapse_folder(pop3Server.rootFolder);</span>
<a href="#l21.5"></a><span id="l21.5">   collapse_folder(MailServices.accounts.localFoldersServer.rootFolder);</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7">   // All folders mode should give us only 2 rows to start</span>
<a href="#l21.8"></a><span id="l21.8">   // (tinderbox account and local folders)</span>
<a href="#l21.9"></a><span id="l21.9">   let accounts = 2;</span>
<a href="#l21.10"></a><span id="l21.10">   assert_folder_tree_view_row_count(accounts);</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  let inbox = trash = outbox = archives = folderPaneA = 1;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  let inbox = 1;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+  let trash = 1;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+  let outbox = 1;</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+  let archives = 1;</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+  let folderPaneA = 1;</span>
<a href="#l21.18"></a><span id="l21.18">   // Create archives folder - this is ugly, but essentially the same as</span>
<a href="#l21.19"></a><span id="l21.19">   // what mailWindowOverlay.js does. We can't use the built-in helper</span>
<a href="#l21.20"></a><span id="l21.20">   // method to create the folder because we need the archive flag to get</span>
<a href="#l21.21"></a><span id="l21.21">   // set before the folder added notification is sent out, which means</span>
<a href="#l21.22"></a><span id="l21.22">   // creating the folder object via RDF, setting the flag, and then</span>
<a href="#l21.23"></a><span id="l21.23">   // creating the storage, which sends the notification.</span>
<a href="#l21.24"></a><span id="l21.24">   let rdfService = Cc['@mozilla.org/rdf/rdf-service;1']</span>
<a href="#l21.25"></a><span id="l21.25">                      .getService(Ci.nsIRDFService);</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-  folder = rdfService.GetResource(pop3Server.rootFolder.URI + &quot;/Archives&quot;).</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-           QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+  let folder = rdfService.GetResource(pop3Server.rootFolder.URI + &quot;/Archives&quot;)</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+                         .QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l21.30"></a><span id="l21.30">   folder.setFlag(Ci.nsMsgFolderFlags.Archive);</span>
<a href="#l21.31"></a><span id="l21.31">   folder.createStorageIfMissing(null);</span>
<a href="#l21.32"></a><span id="l21.32">   // After creating Archives, account should have expanded</span>
<a href="#l21.33"></a><span id="l21.33">   // so that we should have 5 rows visible</span>
<a href="#l21.34"></a><span id="l21.34">   assert_folder_tree_view_row_count(accounts + inbox + trash +</span>
<a href="#l21.35"></a><span id="l21.35">                                     archives);</span>
<a href="#l21.36"></a><span id="l21.36">   // close the tinderbox server.</span>
<a href="#l21.37"></a><span id="l21.37">   mc.folderTreeView.toggleOpenState(0)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -16,17 +16,17 @@ var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l22.4"></a><span id="l22.4"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;, &quot;window-helpers&quot;];</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6"> // spaces in the name are intentional</span>
<a href="#l22.7"></a><span id="l22.7"> var smartParentNameA=&quot;My Smart Folder A&quot;;</span>
<a href="#l22.8"></a><span id="l22.8"> var smartParentNameB=&quot;My Smart Folder B&quot;;</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10"> var rootFolder;</span>
<a href="#l22.11"></a><span id="l22.11"> var inboxSubfolder, subfolderA, subfolderB;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-var smartInboxFolder;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+var smartFolderInbox;</span>
<a href="#l22.14"></a><span id="l22.14"> var smartFolderA;</span>
<a href="#l22.15"></a><span id="l22.15"> </span>
<a href="#l22.16"></a><span id="l22.16"> var nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l22.17"></a><span id="l22.17"> </span>
<a href="#l22.18"></a><span id="l22.18"> /**</span>
<a href="#l22.19"></a><span id="l22.19">  * create two smart folder types and two real folders, one for each</span>
<a href="#l22.20"></a><span id="l22.20">  * smart folder type</span>
<a href="#l22.21"></a><span id="l22.21">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-mode-switching.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-mode-switching.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -20,17 +20,19 @@ var inboxFolder;</span>
<a href="#l23.4"></a><span id="l23.4"> var unreadFolder;</span>
<a href="#l23.5"></a><span id="l23.5"> var favoriteFolder;</span>
<a href="#l23.6"></a><span id="l23.6"> var toggle_menu;</span>
<a href="#l23.7"></a><span id="l23.7"> var toggle_appmenu;</span>
<a href="#l23.8"></a><span id="l23.8"> var tree;</span>
<a href="#l23.9"></a><span id="l23.9"> var modeList_menu;</span>
<a href="#l23.10"></a><span id="l23.10"> var modeList_appmenu;</span>
<a href="#l23.11"></a><span id="l23.11"> var view_menu;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-var view_appmenu;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+var view_menupopup;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+var appmenu;</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineplus">+var appmenu_popup;</span>
<a href="#l23.16"></a><span id="l23.16"> </span>
<a href="#l23.17"></a><span id="l23.17"> function setupModule(module) {</span>
<a href="#l23.18"></a><span id="l23.18">   for (let lib of MODULE_REQUIRES) {</span>
<a href="#l23.19"></a><span id="l23.19">     collector.getModule(lib).installInto(module);</span>
<a href="#l23.20"></a><span id="l23.20">   }</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22">   rootFolder = inboxFolder.server.rootFolder;</span>
<a href="#l23.23"></a><span id="l23.23"> </span>
<a href="#l23.24"></a><span id="l23.24" class="difflineat">@@ -48,17 +50,17 @@ function setupModule(module) {</span>
<a href="#l23.25"></a><span id="l23.25">   toggle_appmenu = mc.e(&quot;appmenu_compactFolderView&quot;);</span>
<a href="#l23.26"></a><span id="l23.26"> </span>
<a href="#l23.27"></a><span id="l23.27">   modeList_menu = mc.e(&quot;menu_FolderViewsPopup&quot;);</span>
<a href="#l23.28"></a><span id="l23.28">   modeList_appmenu = mc.e(&quot;appmenu_FolderViewsPopup&quot;);</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30">   view_menu = mc.eid(&quot;menu_View&quot;);</span>
<a href="#l23.31"></a><span id="l23.31">   view_menupopup = mc.e(&quot;menu_View_Popup&quot;);</span>
<a href="#l23.32"></a><span id="l23.32">   appmenu = mc.eid(&quot;button-appmenu&quot;);</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-  appmenupopup = mc.e(&quot;appmenu-popup&quot;);</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+  appmenu_popup = mc.e(&quot;appmenu-popup&quot;);</span>
<a href="#l23.35"></a><span id="l23.35"> </span>
<a href="#l23.36"></a><span id="l23.36">   tree = mc.folderTreeView;</span>
<a href="#l23.37"></a><span id="l23.37"> </span>
<a href="#l23.38"></a><span id="l23.38">   select_no_folders();</span>
<a href="#l23.39"></a><span id="l23.39"> }</span>
<a href="#l23.40"></a><span id="l23.40"> </span>
<a href="#l23.41"></a><span id="l23.41"> /**</span>
<a href="#l23.42"></a><span id="l23.42">  * Check if both &quot;Compact view&quot; checkboxes in menu are of the expected state.</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineat">@@ -79,39 +81,40 @@ function assert_compact_state(aChecked, </span>
<a href="#l23.44"></a><span id="l23.44">  * Check whether the expected folder mode is selected in menus and internally.</span>
<a href="#l23.45"></a><span id="l23.45">  *</span>
<a href="#l23.46"></a><span id="l23.46">  * @param aMode  The name of the expected mode.</span>
<a href="#l23.47"></a><span id="l23.47">  */</span>
<a href="#l23.48"></a><span id="l23.48"> function assert_mode_selected(aMode) {</span>
<a href="#l23.49"></a><span id="l23.49">   assert_equals(tree.mode, aMode);</span>
<a href="#l23.50"></a><span id="l23.50">   let baseMode = tree.baseMode();</span>
<a href="#l23.51"></a><span id="l23.51">   assert_compact_state(baseMode != tree.mode);</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+  let popuplist;</span>
<a href="#l23.53"></a><span id="l23.53">   // We need to open the menu because only then the right mode is set in them.</span>
<a href="#l23.54"></a><span id="l23.54">   if (!mc.mozmillModule.isMac) {</span>
<a href="#l23.55"></a><span id="l23.55">     // On OS X the main menu seems not accessible for clicking from mozmill.</span>
<a href="#l23.56"></a><span id="l23.56">     mc.click(view_menu);</span>
<a href="#l23.57"></a><span id="l23.57">     popuplist = mc.click_menus_in_sequence(view_menupopup, [ { id: modeList_menu.parentNode.id } ], true);</span>
<a href="#l23.58"></a><span id="l23.58">     assert_true(modeList_menu.querySelector('[value=&quot;' + baseMode + '&quot;]').hasAttribute(&quot;checked&quot;));</span>
<a href="#l23.59"></a><span id="l23.59">     mc.close_popup_sequence(popuplist);</span>
<a href="#l23.60"></a><span id="l23.60">   }</span>
<a href="#l23.61"></a><span id="l23.61">   mc.click(appmenu);</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineminus">-  popuplist = mc.click_menus_in_sequence(appmenupopup, [ { id: modeList_appmenu.parentNode.id } ], true);</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineplus">+  popuplist = mc.click_menus_in_sequence(appmenu_popup, [ { id: modeList_appmenu.parentNode.id } ], true);</span>
<a href="#l23.64"></a><span id="l23.64">   assert_true(modeList_menu.querySelector('[value=&quot;' + baseMode + '&quot;]').hasAttribute(&quot;checked&quot;));</span>
<a href="#l23.65"></a><span id="l23.65">   mc.close_popup_sequence(popuplist);</span>
<a href="#l23.66"></a><span id="l23.66"> }</span>
<a href="#l23.67"></a><span id="l23.67"> </span>
<a href="#l23.68"></a><span id="l23.68"> /**</span>
<a href="#l23.69"></a><span id="l23.69">  * Toggle the folder mode by clicking in the menu.</span>
<a href="#l23.70"></a><span id="l23.70">  *</span>
<a href="#l23.71"></a><span id="l23.71">  * @param aMode  The base name of the mode to select.</span>
<a href="#l23.72"></a><span id="l23.72">  */</span>
<a href="#l23.73"></a><span id="l23.73"> function select_mode_in_menu(aMode) {</span>
<a href="#l23.74"></a><span id="l23.74">   mc.click(appmenu);</span>
<a href="#l23.75"></a><span id="l23.75" class="difflineminus">-  mc.click_menus_in_sequence(appmenupopup, [ { id: modeList_appmenu.parentNode.id },</span>
<a href="#l23.76"></a><span id="l23.76" class="difflineminus">-                                             { value: aMode } ]);</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineplus">+  mc.click_menus_in_sequence(appmenu_popup, [ { id: modeList_appmenu.parentNode.id },</span>
<a href="#l23.78"></a><span id="l23.78" class="difflineplus">+                                              { value: aMode } ]);</span>
<a href="#l23.79"></a><span id="l23.79"> }</span>
<a href="#l23.80"></a><span id="l23.80"> </span>
<a href="#l23.81"></a><span id="l23.81"> /**</span>
<a href="#l23.82"></a><span id="l23.82">  * Toggle the Compact view option by clicking in the menu.</span>
<a href="#l23.83"></a><span id="l23.83">  */</span>
<a href="#l23.84"></a><span id="l23.84"> function toggle_compact_in_menu() {</span>
<a href="#l23.85"></a><span id="l23.85">   // For some reason, clicking the menuitem does not work by any means,</span>
<a href="#l23.86"></a><span id="l23.86">   // therefore we just simulate it here.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-smart-folders.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-smart-folders.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -160,17 +160,17 @@ function test_folder_flag_changes() {</span>
<a href="#l24.4"></a><span id="l24.4">   archive_selected_messages();</span>
<a href="#l24.5"></a><span id="l24.5">   let pop3Server = MailServices.accounts.FindServer(&quot;tinderbox&quot;, FAKE_SERVER_HOSTNAME, &quot;pop3&quot;);</span>
<a href="#l24.6"></a><span id="l24.6">   let pop3Inbox = get_special_folder(Ci.nsMsgFolderFlags.Inbox, false, pop3Server);</span>
<a href="#l24.7"></a><span id="l24.7">   make_new_sets_in_folder(pop3Inbox, [{count: 1}]);</span>
<a href="#l24.8"></a><span id="l24.8">   mc.folderTreeView.selectFolder(pop3Inbox);</span>
<a href="#l24.9"></a><span id="l24.9">   select_click_row(0);</span>
<a href="#l24.10"></a><span id="l24.10">   archive_selected_messages();</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  smartArchiveFolder = get_smart_folder_named(&quot;Archives&quot;);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  let smartArchiveFolder = get_smart_folder_named(&quot;Archives&quot;);</span>
<a href="#l24.14"></a><span id="l24.14">   let archiveScope = &quot;|&quot; + smartArchiveFolder.msgDatabase.dBFolderInfo</span>
<a href="#l24.15"></a><span id="l24.15">                      .getCharProperty(&quot;searchFolderUri&quot;) + &quot;|&quot;;</span>
<a href="#l24.16"></a><span id="l24.16">   // We should have both this account, and a folder corresponding</span>
<a href="#l24.17"></a><span id="l24.17">   // to this year in the scope.</span>
<a href="#l24.18"></a><span id="l24.18">   rootFolder = inboxFolder.server.rootFolder;</span>
<a href="#l24.19"></a><span id="l24.19">   let archiveFolder = rootFolder.getChildNamed(&quot;Archives&quot;);</span>
<a href="#l24.20"></a><span id="l24.20">   assert_folder_and_children_in_scope(archiveFolder, archiveScope);</span>
<a href="#l24.21"></a><span id="l24.21">   archiveFolder = pop3Server.rootFolder.getChildNamed(&quot;Archives&quot;);</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -184,17 +184,17 @@ function test_folder_flag_changes() {</span>
<a href="#l24.23"></a><span id="l24.23">   // changed it.</span>
<a href="#l24.24"></a><span id="l24.24">   archiveScope = &quot;|&quot; + smartArchiveFolder.msgDatabase.dBFolderInfo</span>
<a href="#l24.25"></a><span id="l24.25">                  .getCharProperty(&quot;searchFolderUri&quot;) + &quot;|&quot;;</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27">   // figure out what we expect the archiveScope to now be.</span>
<a href="#l24.28"></a><span id="l24.28">   rootFolder = inboxFolder.server.rootFolder;</span>
<a href="#l24.29"></a><span id="l24.29">   let localArchiveFolder = rootFolder.getChildNamed(&quot;Archives&quot;);</span>
<a href="#l24.30"></a><span id="l24.30">   let allDescendants = localArchiveFolder.descendants;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-  desiredScope = &quot;|&quot; + localArchiveFolder.URI + &quot;|&quot;;</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+  let desiredScope = &quot;|&quot; + localArchiveFolder.URI + &quot;|&quot;;</span>
<a href="#l24.33"></a><span id="l24.33">   for (let folder of fixIterator(allDescendants, Ci.nsIMsgFolder)) {</span>
<a href="#l24.34"></a><span id="l24.34">     desiredScope += folder.URI + &quot;|&quot;;</span>
<a href="#l24.35"></a><span id="l24.35">   }</span>
<a href="#l24.36"></a><span id="l24.36"> </span>
<a href="#l24.37"></a><span id="l24.37">   if (archiveScope != desiredScope)</span>
<a href="#l24.38"></a><span id="l24.38">     throw &quot;archive scope wrong after removing folder&quot;;</span>
<a href="#l24.39"></a><span id="l24.39">   assert_folder_and_children_not_in_scope(archiveFolder, archiveScope);</span>
<a href="#l24.40"></a><span id="l24.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/test/mozmill/folder-widget/test-message-filters.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/test/mozmill/folder-widget/test-message-filters.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -26,25 +26,22 @@ function setupModule(module)</span>
<a href="#l25.4"></a><span id="l25.4">   }</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">   setupNNTPDaemon();</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">   folderA = create_folder(&quot;FolderToolbarA&quot;);</span>
<a href="#l25.9"></a><span id="l25.9">   // we need one message to select and open</span>
<a href="#l25.10"></a><span id="l25.10">   make_new_sets_in_folder(folderA, [{count: 1}]);</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  server = setupLocalServer(NNTP_PORT);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  setupLocalServer(NNTP_PORT);</span>
<a href="#l25.14"></a><span id="l25.14"> </span>
<a href="#l25.15"></a><span id="l25.15">   // Note, the uri is for hostname &quot;invalid&quot; which is the original uri. See</span>
<a href="#l25.16"></a><span id="l25.16">   // setupProtocolTest parameters.</span>
<a href="#l25.17"></a><span id="l25.17">   var prefix = &quot;news://invalid:&quot;+NNTP_PORT+&quot;/&quot;;</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">-  // Test - group subscribe listing</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-  test = &quot;news:*&quot;;</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">-</span>
<a href="#l25.22"></a><span id="l25.22">   if (mc.mozmillModule.isMac) {</span>
<a href="#l25.23"></a><span id="l25.23">     test_customize_toolbar_doesnt_double_get_mail_menu.__force_skip__ = true;</span>
<a href="#l25.24"></a><span id="l25.24">   }</span>
<a href="#l25.25"></a><span id="l25.25"> }</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27"> /*</span>
<a href="#l25.28"></a><span id="l25.28">  * Test that the message filter list shows newsgroup servers.</span>
<a href="#l25.29"></a><span id="l25.29">  */</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineat">@@ -54,17 +51,17 @@ function test_message_filter_shows_newsg</span>
<a href="#l25.31"></a><span id="l25.31"> </span>
<a href="#l25.32"></a><span id="l25.32">   // Open the &quot;Tools  Message Filters&quot; window,</span>
<a href="#l25.33"></a><span id="l25.33">   // a.k.a. &quot;tasksMenu  filtersCmd&quot;.</span>
<a href="#l25.34"></a><span id="l25.34">   plan_for_new_window(&quot;mailnews:filterlist&quot;);</span>
<a href="#l25.35"></a><span id="l25.35">   mc.menus.Tools.filtersCmd.click();</span>
<a href="#l25.36"></a><span id="l25.36">   let filterc = wait_for_new_window(&quot;mailnews:filterlist&quot;);</span>
<a href="#l25.37"></a><span id="l25.37">   wait_for_window_focused(filterc.window);</span>
<a href="#l25.38"></a><span id="l25.38"> </span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-  popup = filterc.eid(&quot;serverMenuPopup&quot;);</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+  let popup = filterc.eid(&quot;serverMenuPopup&quot;);</span>
<a href="#l25.41"></a><span id="l25.41">   filterc.assertNode(popup);</span>
<a href="#l25.42"></a><span id="l25.42">   filterc.click(popup);</span>
<a href="#l25.43"></a><span id="l25.43"> </span>
<a href="#l25.44"></a><span id="l25.44">   let nntp = new elib.Elem(popup.node.children.item(2));</span>
<a href="#l25.45"></a><span id="l25.45">   filterc.assertNode(nntp);</span>
<a href="#l25.46"></a><span id="l25.46">   // We need to get the newsgroups to pop up somehow.</span>
<a href="#l25.47"></a><span id="l25.47">   // These all fail.</span>
<a href="#l25.48"></a><span id="l25.48">   //filterc.click(nntp);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/test/mozmill/instrumentation/test-instrument-setup.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/test/mozmill/instrumentation/test-instrument-setup.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -33,17 +33,17 @@ function setupModule(module) {</span>
<a href="#l26.4"></a><span id="l26.4">   let url = collector.addHttpResource(&quot;../account/xml&quot;, &quot;autoconfig&quot;);</span>
<a href="#l26.5"></a><span id="l26.5">   Services.prefs.setCharPref(&quot;mailnews.auto_config_url&quot;, url);</span>
<a href="#l26.6"></a><span id="l26.6"> </span>
<a href="#l26.7"></a><span id="l26.7">   // Force .com MIME-Type to text/xml</span>
<a href="#l26.8"></a><span id="l26.8">   collector.httpd.registerContentType(&quot;com&quot;, &quot;text/xml&quot;);</span>
<a href="#l26.9"></a><span id="l26.9"> }</span>
<a href="#l26.10"></a><span id="l26.10"> </span>
<a href="#l26.11"></a><span id="l26.11"> function test_mail_account_setup() {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  awc = wait_for_existing_window(&quot;mail:autoconfig&quot;);</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  let awc = wait_for_existing_window(&quot;mail:autoconfig&quot;);</span>
<a href="#l26.14"></a><span id="l26.14"> </span>
<a href="#l26.15"></a><span id="l26.15">   // Input user's account information</span>
<a href="#l26.16"></a><span id="l26.16">   awc.e(&quot;realname&quot;).focus();</span>
<a href="#l26.17"></a><span id="l26.17">   input_value(awc, user.name);</span>
<a href="#l26.18"></a><span id="l26.18">   awc.keypress(null, &quot;VK_TAB&quot;, {});</span>
<a href="#l26.19"></a><span id="l26.19">   input_value(awc, user.email);</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21">   // Load the autoconfig file from http://localhost:433**/autoconfig/example.com</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/test/mozmill/message-header/test-reply-identity.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/test/mozmill/message-header/test-reply-identity.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -11,33 +11,25 @@</span>
<a href="#l27.4"></a><span id="l27.4"> &quot;use strict&quot;;</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> var MODULE_NAME = &quot;test-reply-identity&quot;;</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l27.9"></a><span id="l27.9"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;,</span>
<a href="#l27.10"></a><span id="l27.10">                          &quot;window-helpers&quot;, &quot;compose-helpers&quot;];</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-var folderHelper = null;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-var windowindowHelperelper = null;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-var composeHelper = null;</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">-</span>
<a href="#l27.16"></a><span id="l27.16"> var testFolder = null;</span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18"> var identity1Email = &quot;carl@example.com&quot;;</span>
<a href="#l27.19"></a><span id="l27.19"> var identity2Email = &quot;lenny@springfield.invalid&quot;;</span>
<a href="#l27.20"></a><span id="l27.20"> </span>
<a href="#l27.21"></a><span id="l27.21" class="difflineminus">-var setupModule = function (module) {</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">-</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineminus">-  folderHelper = collector.getModule(&quot;folder-display-helpers&quot;);</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineminus">-  folderHelper.installInto(module);</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineminus">-  windowHelper = collector.getModule(&quot;window-helpers&quot;);</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineminus">-  windowHelper.installInto(module);</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineminus">-  composeHelper = collector.getModule(&quot;compose-helpers&quot;);</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineminus">-  composeHelper.installInto(module);</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+function setupModule(module) {</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineplus">+  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+    collector.getModule(lib).installInto(module);</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+  }</span>
<a href="#l27.33"></a><span id="l27.33"> </span>
<a href="#l27.34"></a><span id="l27.34">   addIdentitiesAndFolder();</span>
<a href="#l27.35"></a><span id="l27.35">   // Msg #0</span>
<a href="#l27.36"></a><span id="l27.36">   add_message_to_folder(testFolder, create_message({</span>
<a href="#l27.37"></a><span id="l27.37">     from: &quot;Homer &lt;homer@example.com&gt;&quot;,</span>
<a href="#l27.38"></a><span id="l27.38">     to: &quot;workers@springfield.invalid&quot;,</span>
<a href="#l27.39"></a><span id="l27.39">     subject: &quot;no matching identity, like bcc/list&quot;,</span>
<a href="#l27.40"></a><span id="l27.40">     body: {body: &quot;Alcohol is a way of life, alcohol is my way of life, and I aim to keep it.&quot;},</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineat">@@ -85,17 +77,17 @@ var setupModule = function (module) {</span>
<a href="#l27.42"></a><span id="l27.42">   add_message_to_folder(testFolder, create_message({</span>
<a href="#l27.43"></a><span id="l27.43">     from: identity2Email + &quot; &lt;&quot; + identity2Email+ &quot;&gt;&quot;,</span>
<a href="#l27.44"></a><span id="l27.44">     to: &quot;Marge &lt;marge@example.com&gt;&quot;,</span>
<a href="#l27.45"></a><span id="l27.45">     subject: &quot;from second self&quot;,</span>
<a href="#l27.46"></a><span id="l27.46">     body: {body: &quot;All my life I've had one dream, to achieve my many goals.&quot;}</span>
<a href="#l27.47"></a><span id="l27.47">   }));</span>
<a href="#l27.48"></a><span id="l27.48"> }</span>
<a href="#l27.49"></a><span id="l27.49"> </span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-var addIdentitiesAndFolder = function() {</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+function addIdentitiesAndFolder() {</span>
<a href="#l27.52"></a><span id="l27.52">   let server = MailServices.accounts.createIncomingServer(&quot;nobody&quot;,</span>
<a href="#l27.53"></a><span id="l27.53">                                                           &quot;Reply Identity Testing&quot;, &quot;pop3&quot;);</span>
<a href="#l27.54"></a><span id="l27.54">   testFolder = server.rootFolder.QueryInterface(Ci.nsIMsgLocalMailFolder)</span>
<a href="#l27.55"></a><span id="l27.55">                      .createLocalSubfolder(&quot;Replies&quot;);</span>
<a href="#l27.56"></a><span id="l27.56"> </span>
<a href="#l27.57"></a><span id="l27.57">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l27.58"></a><span id="l27.58">   identity.email = identity1Email;</span>
<a href="#l27.59"></a><span id="l27.59"> </span>
<a href="#l27.60"></a><span id="l27.60" class="difflineat">@@ -117,78 +109,78 @@ var checkReply = function (replyWin, exp</span>
<a href="#l27.61"></a><span id="l27.61"> }</span>
<a href="#l27.62"></a><span id="l27.62"> </span>
<a href="#l27.63"></a><span id="l27.63"> function test_reply_no_matching_identity() {</span>
<a href="#l27.64"></a><span id="l27.64">   be_in_folder(testFolder);</span>
<a href="#l27.65"></a><span id="l27.65"> </span>
<a href="#l27.66"></a><span id="l27.66">   let msg = select_click_row(0);</span>
<a href="#l27.67"></a><span id="l27.67">   assert_selected_and_displayed(mc, msg);</span>
<a href="#l27.68"></a><span id="l27.68"> </span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-  let replyWin = composeHelper.open_compose_with_reply();</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineplus">+  let replyWin = open_compose_with_reply();</span>
<a href="#l27.71"></a><span id="l27.71">   // Should have selected the default identity.</span>
<a href="#l27.72"></a><span id="l27.72">   checkReply(replyWin, identity1Email);</span>
<a href="#l27.73"></a><span id="l27.73">   close_compose_window(replyWin);</span>
<a href="#l27.74"></a><span id="l27.74"> }</span>
<a href="#l27.75"></a><span id="l27.75"> </span>
<a href="#l27.76"></a><span id="l27.76"> function test_reply_matching_only_deliveredto() {</span>
<a href="#l27.77"></a><span id="l27.77">   be_in_folder(testFolder);</span>
<a href="#l27.78"></a><span id="l27.78"> </span>
<a href="#l27.79"></a><span id="l27.79">   let msg = select_click_row(1);</span>
<a href="#l27.80"></a><span id="l27.80">   assert_selected_and_displayed(mc, msg);</span>
<a href="#l27.81"></a><span id="l27.81"> </span>
<a href="#l27.82"></a><span id="l27.82" class="difflineminus">-  let replyWin = composeHelper.open_compose_with_reply();</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+  let replyWin = open_compose_with_reply();</span>
<a href="#l27.84"></a><span id="l27.84">   // Should have selected the second id, which is listed in Delivered-To:.</span>
<a href="#l27.85"></a><span id="l27.85">   checkReply(replyWin, identity2Email);</span>
<a href="#l27.86"></a><span id="l27.86">   close_compose_window(replyWin);</span>
<a href="#l27.87"></a><span id="l27.87"> }</span>
<a href="#l27.88"></a><span id="l27.88"> </span>
<a href="#l27.89"></a><span id="l27.89"> function test_reply_matching_subaddress() {</span>
<a href="#l27.90"></a><span id="l27.90">   be_in_folder(testFolder);</span>
<a href="#l27.91"></a><span id="l27.91"> </span>
<a href="#l27.92"></a><span id="l27.92">   let msg = select_click_row(2);</span>
<a href="#l27.93"></a><span id="l27.93">   assert_selected_and_displayed(mc, msg);</span>
<a href="#l27.94"></a><span id="l27.94"> </span>
<a href="#l27.95"></a><span id="l27.95" class="difflineminus">-  let replyWin = composeHelper.open_compose_with_reply();</span>
<a href="#l27.96"></a><span id="l27.96" class="difflineplus">+  let replyWin = open_compose_with_reply();</span>
<a href="#l27.97"></a><span id="l27.97">   // Should have selected the first id, the email doesn't fully match.</span>
<a href="#l27.98"></a><span id="l27.98">   // other.lenny != &quot;our&quot; lenny</span>
<a href="#l27.99"></a><span id="l27.99">   checkReply(replyWin, identity1Email);</span>
<a href="#l27.100"></a><span id="l27.100">   close_compose_window(replyWin);</span>
<a href="#l27.101"></a><span id="l27.101"> }</span>
<a href="#l27.102"></a><span id="l27.102"> </span>
<a href="#l27.103"></a><span id="l27.103"> function test_reply_to_matching_second_id() {</span>
<a href="#l27.104"></a><span id="l27.104">   be_in_folder(testFolder);</span>
<a href="#l27.105"></a><span id="l27.105"> </span>
<a href="#l27.106"></a><span id="l27.106">   let msg = select_click_row(3);</span>
<a href="#l27.107"></a><span id="l27.107">   assert_selected_and_displayed(mc, msg);</span>
<a href="#l27.108"></a><span id="l27.108"> </span>
<a href="#l27.109"></a><span id="l27.109" class="difflineminus">-  let replyWin = composeHelper.open_compose_with_reply();</span>
<a href="#l27.110"></a><span id="l27.110" class="difflineplus">+  let replyWin = open_compose_with_reply();</span>
<a href="#l27.111"></a><span id="l27.111">   // Should have selected the second id, which was in To;.</span>
<a href="#l27.112"></a><span id="l27.112">   checkReply(replyWin, identity2Email);</span>
<a href="#l27.113"></a><span id="l27.113">   close_compose_window(replyWin);</span>
<a href="#l27.114"></a><span id="l27.114"> }</span>
<a href="#l27.115"></a><span id="l27.115"> </span>
<a href="#l27.116"></a><span id="l27.116"> function test_deliveredto_to_matching_only_parlty() {</span>
<a href="#l27.117"></a><span id="l27.117">   be_in_folder(testFolder);</span>
<a href="#l27.118"></a><span id="l27.118"> </span>
<a href="#l27.119"></a><span id="l27.119">   let msg = select_click_row(4);</span>
<a href="#l27.120"></a><span id="l27.120">   assert_selected_and_displayed(mc, msg);</span>
<a href="#l27.121"></a><span id="l27.121"> </span>
<a href="#l27.122"></a><span id="l27.122" class="difflineminus">-  let replyWin = composeHelper.open_compose_with_reply();</span>
<a href="#l27.123"></a><span id="l27.123" class="difflineplus">+  let replyWin = open_compose_with_reply();</span>
<a href="#l27.124"></a><span id="l27.124">   // Should have selected the (default) first id.</span>
<a href="#l27.125"></a><span id="l27.125">   checkReply(replyWin, identity1Email);</span>
<a href="#l27.126"></a><span id="l27.126">   close_compose_window(replyWin);</span>
<a href="#l27.127"></a><span id="l27.127"> }</span>
<a href="#l27.128"></a><span id="l27.128"> </span>
<a href="#l27.129"></a><span id="l27.129"> /**</span>
<a href="#l27.130"></a><span id="l27.130">  * A reply from self is treated as a follow-up. And this self</span>
<a href="#l27.131"></a><span id="l27.131">  * was the second identity, so the reply should also be from the second identity.</span>
<a href="#l27.132"></a><span id="l27.132">  */</span>
<a href="#l27.133"></a><span id="l27.133"> function test_reply_to_self_second_id() {</span>
<a href="#l27.134"></a><span id="l27.134">   be_in_folder(testFolder);</span>
<a href="#l27.135"></a><span id="l27.135"> </span>
<a href="#l27.136"></a><span id="l27.136">   let msg = select_click_row(5);</span>
<a href="#l27.137"></a><span id="l27.137">   assert_selected_and_displayed(mc, msg);</span>
<a href="#l27.138"></a><span id="l27.138"> </span>
<a href="#l27.139"></a><span id="l27.139" class="difflineminus">-  let replyWin = composeHelper.open_compose_with_reply();</span>
<a href="#l27.140"></a><span id="l27.140" class="difflineplus">+  let replyWin = open_compose_with_reply();</span>
<a href="#l27.141"></a><span id="l27.141">   // Should have selected the second id, which was in From.</span>
<a href="#l27.142"></a><span id="l27.142">   checkReply(replyWin, identity2Email);</span>
<a href="#l27.143"></a><span id="l27.143">   close_compose_window(replyWin, false /*no prompt*/);</span>
<a href="#l27.144"></a><span id="l27.144"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/test/mozmill/message-header/test-reply-to-list-from-address-selection.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -9,40 +9,32 @@</span>
<a href="#l28.4"></a><span id="l28.4"> &quot;use strict&quot;;</span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6"> var MODULE_NAME = &quot;test-reply-to-list-from-address-selection&quot;;</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8"> var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l28.9"></a><span id="l28.9"> var MODULE_REQUIRES = ['folder-display-helpers',</span>
<a href="#l28.10"></a><span id="l28.10">                        'window-helpers', 'compose-helpers'];</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-var folderHelper = null;</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-var windowindowHelperelper = null;</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-var composeHelper = null;</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-</span>
<a href="#l28.16"></a><span id="l28.16"> var testFolder = null;</span>
<a href="#l28.17"></a><span id="l28.17"> var msgHdr = null;</span>
<a href="#l28.18"></a><span id="l28.18"> var replyToListWindow = null;</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20"> var identityString1 = &quot;tinderbox_correct_identity@foo.invalid&quot;;</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">-var setupModule = function (module) {</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">-</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">-  folderHelper = collector.getModule('folder-display-helpers');</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">-  folderHelper.installInto(module);</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-  windowHelper = collector.getModule('window-helpers');</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-  windowHelper.installInto(module);</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-  composeHelper = collector.getModule('compose-helpers');</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineminus">-  composeHelper.installInto(module);</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineplus">+function setupModule(module) {</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+  for (let lib of MODULE_REQUIRES) {</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+    collector.getModule(lib).installInto(module);</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+  }</span>
<a href="#l28.34"></a><span id="l28.34"> </span>
<a href="#l28.35"></a><span id="l28.35">   addIdentitiesAndFolder();</span>
<a href="#l28.36"></a><span id="l28.36">   addMessageToFolder(testFolder);</span>
<a href="#l28.37"></a><span id="l28.37"> }</span>
<a href="#l28.38"></a><span id="l28.38"> </span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-var addMessageToFolder = function (aFolder) {</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+function addMessageToFolder(aFolder) {</span>
<a href="#l28.41"></a><span id="l28.41">   var msgId = Cc[&quot;@mozilla.org/uuid-generator;1&quot;]</span>
<a href="#l28.42"></a><span id="l28.42">                 .getService(Ci.nsIUUIDGenerator)</span>
<a href="#l28.43"></a><span id="l28.43">                 .generateUUID() + &quot;@mozillamessaging.invalid&quot;;</span>
<a href="#l28.44"></a><span id="l28.44"> </span>
<a href="#l28.45"></a><span id="l28.45">   var source = &quot;From - Sat Nov  1 12:39:54 2008\n&quot; +</span>
<a href="#l28.46"></a><span id="l28.46">                 &quot;X-Mozilla-Status: 0001\n&quot; +</span>
<a href="#l28.47"></a><span id="l28.47">                 &quot;X-Mozilla-Status2: 00000000\n&quot; +</span>
<a href="#l28.48"></a><span id="l28.48">                 &quot;Delivered-To: &lt;tinderbox_identity333@foo.invalid&gt;\n&quot; +</span>
<a href="#l28.49"></a><span id="l28.49" class="difflineat">@@ -65,17 +57,17 @@ var addMessageToFolder = function (aFold</span>
<a href="#l28.50"></a><span id="l28.50">   aFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l28.51"></a><span id="l28.51">   aFolder.gettingNewMessages = true;</span>
<a href="#l28.52"></a><span id="l28.52">   aFolder.addMessage(source);</span>
<a href="#l28.53"></a><span id="l28.53">   aFolder.gettingNewMessages = false;</span>
<a href="#l28.54"></a><span id="l28.54"> </span>
<a href="#l28.55"></a><span id="l28.55">   return aFolder.msgDatabase.getMsgHdrForMessageID(msgId);</span>
<a href="#l28.56"></a><span id="l28.56"> }</span>
<a href="#l28.57"></a><span id="l28.57"> </span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-var addIdentitiesAndFolder = function() {</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineplus">+function addIdentitiesAndFolder() {</span>
<a href="#l28.60"></a><span id="l28.60">   let identity2 = MailServices.accounts.createIdentity();</span>
<a href="#l28.61"></a><span id="l28.61">   //identity.fullName = &quot;Tinderbox_Identity1&quot;;</span>
<a href="#l28.62"></a><span id="l28.62">   identity2.email=&quot;tinderbox_identity1@foo.invalid&quot;;</span>
<a href="#l28.63"></a><span id="l28.63"> </span>
<a href="#l28.64"></a><span id="l28.64">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l28.65"></a><span id="l28.65">   //identity.fullName = &quot;Tinderbox_Identity1&quot;;</span>
<a href="#l28.66"></a><span id="l28.66">   identity.email = identityString1;</span>
<a href="#l28.67"></a><span id="l28.67"> </span>
<a href="#l28.68"></a><span id="l28.68" class="difflineat">@@ -91,17 +83,17 @@ var addIdentitiesAndFolder = function() </span>
<a href="#l28.69"></a><span id="l28.69"> }</span>
<a href="#l28.70"></a><span id="l28.70"> </span>
<a href="#l28.71"></a><span id="l28.71"> function test_Reply_To_List_From_Address() {</span>
<a href="#l28.72"></a><span id="l28.72">   be_in_folder(testFolder);</span>
<a href="#l28.73"></a><span id="l28.73"> </span>
<a href="#l28.74"></a><span id="l28.74">   let curMessage = select_click_row(0);</span>
<a href="#l28.75"></a><span id="l28.75">   assert_selected_and_displayed(mc, curMessage);</span>
<a href="#l28.76"></a><span id="l28.76"> </span>
<a href="#l28.77"></a><span id="l28.77" class="difflineminus">-  replyToListWindow = composeHelper.open_compose_with_reply_to_list();</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineplus">+  replyToListWindow = open_compose_with_reply_to_list();</span>
<a href="#l28.79"></a><span id="l28.79"> </span>
<a href="#l28.80"></a><span id="l28.80">   var identityList = replyToListWindow.e(&quot;msgIdentity&quot;);</span>
<a href="#l28.81"></a><span id="l28.81"> </span>
<a href="#l28.82"></a><span id="l28.82">   // see if it's the correct identity selected</span>
<a href="#l28.83"></a><span id="l28.83">   if (!identityList.selectedItem.label.includes(identityString1))</span>
<a href="#l28.84"></a><span id="l28.84">     throw new Error(&quot;The From address is not correctly selected! Expected: &quot;+</span>
<a href="#l28.85"></a><span id="l28.85">                     identityString1 + &quot;; Actual: &quot;  +</span>
<a href="#l28.86"></a><span id="l28.86">                     identityList.selectedItem.label);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/test/mozmill/newmailaccount/test-newmailaccount.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/test/mozmill/newmailaccount/test-newmailaccount.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -718,17 +718,17 @@ function subtest_search_button_disabled_</span>
<a href="#l29.4"></a><span id="l29.4">   type_in_search_name(w, &quot;Dexter Morgan&quot;);</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6">   // We already have at least one provider checked from the last case, so</span>
<a href="#l29.7"></a><span id="l29.7">   // the search submit button should become enabled</span>
<a href="#l29.8"></a><span id="l29.8">   wait_for_element_enabled(w, w.e(&quot;searchSubmit&quot;), true);</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10">   // Case 3:  Search input has text, no providers selected</span>
<a href="#l29.11"></a><span id="l29.11">   // Make sure no provider checkboxes are checked.</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  inputs = w.window.document.querySelectorAll('input[type=&quot;checkbox&quot;]:checked');</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+  let inputs = w.window.document.querySelectorAll('input[type=&quot;checkbox&quot;]:checked');</span>
<a href="#l29.14"></a><span id="l29.14">   for (input of inputs) {</span>
<a href="#l29.15"></a><span id="l29.15">     mc.click(new elib.Elem(input));</span>
<a href="#l29.16"></a><span id="l29.16">   }</span>
<a href="#l29.17"></a><span id="l29.17"> </span>
<a href="#l29.18"></a><span id="l29.18">   // The search submit button should now be disabled</span>
<a href="#l29.19"></a><span id="l29.19">   wait_for_element_enabled(w, w.e(&quot;searchSubmit&quot;), false);</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21">   // We'll turn on a single provider now to enable the search button,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/test/mozmill/session-store/test-session-store.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/test/mozmill/session-store/test-session-store.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -412,29 +412,28 @@ async function test_bad_session_file_sim</span>
<a href="#l30.4"></a><span id="l30.4">                &quot;saved state is bad so state object should be null&quot;);</span>
<a href="#l30.5"></a><span id="l30.5"> </span>
<a href="#l30.6"></a><span id="l30.6">   // The bad session file should now not exist.</span>
<a href="#l30.7"></a><span id="l30.7">   utils.waitFor(() =&gt; !sessionStoreManager.sessionFile.exists(),</span>
<a href="#l30.8"></a><span id="l30.8">                 &quot;session file should now not exist&quot;);</span>
<a href="#l30.9"></a><span id="l30.9"> }</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11"> function test_clean_shutdown_session_persistence_simple() {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-</span>
<a href="#l30.13"></a><span id="l30.13">   // open a few more 3pane windows</span>
<a href="#l30.14"></a><span id="l30.14">   for (var i = 0; i &lt; 3; ++i) {</span>
<a href="#l30.15"></a><span id="l30.15">     open3PaneWindow();</span>
<a href="#l30.16"></a><span id="l30.16">   }</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18">   // make sure we have a different window open, so that we don't start shutting</span>
<a href="#l30.19"></a><span id="l30.19">   // down just because the last window was closed</span>
<a href="#l30.20"></a><span id="l30.20">   let abwc = openAddressBook();</span>
<a href="#l30.21"></a><span id="l30.21"> </span>
<a href="#l30.22"></a><span id="l30.22">   // close all the 3pane windows</span>
<a href="#l30.23"></a><span id="l30.23">   let lastWindowState = null;</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineminus">-  enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineplus">+  let enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l30.26"></a><span id="l30.26">   while (enumerator.hasMoreElements()) {</span>
<a href="#l30.27"></a><span id="l30.27">     let window = enumerator.getNext();</span>
<a href="#l30.28"></a><span id="l30.28">     if (!enumerator.hasMoreElements())</span>
<a href="#l30.29"></a><span id="l30.29">       lastWindowState = window.getWindowStateForSessionPersistence();</span>
<a href="#l30.30"></a><span id="l30.30"> </span>
<a href="#l30.31"></a><span id="l30.31">     close_window(new mozmill.controller.MozMillController(window));</span>
<a href="#l30.32"></a><span id="l30.32">   }</span>
<a href="#l30.33"></a><span id="l30.33"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -27,17 +27,17 @@ var EXT_PROTOCOL_SVC_CID = &quot;@mozilla.org</span>
<a href="#l31.4"></a><span id="l31.4"> var folderDisplayHelper;</span>
<a href="#l31.5"></a><span id="l31.5"> var mc;</span>
<a href="#l31.6"></a><span id="l31.6"> var wh;</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8"> var _originalBlocklistURL = null;</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10"> // logHelper (and therefore folderDisplayHelper) exports</span>
<a href="#l31.11"></a><span id="l31.11"> var mark_failure;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-var gMockExtProtocolSvcReg;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+var gMockExtProtSvcReg;</span>
<a href="#l31.14"></a><span id="l31.14"> </span>
<a href="#l31.15"></a><span id="l31.15"> function setupModule() {</span>
<a href="#l31.16"></a><span id="l31.16">   folderDisplayHelper = collector.getModule('folder-display-helpers');</span>
<a href="#l31.17"></a><span id="l31.17">   mc = folderDisplayHelper.mc;</span>
<a href="#l31.18"></a><span id="l31.18">   mark_failure = folderDisplayHelper.mark_failure;</span>
<a href="#l31.19"></a><span id="l31.19"> </span>
<a href="#l31.20"></a><span id="l31.20">   wh = collector.getModule('window-helpers');</span>
<a href="#l31.21"></a><span id="l31.21">   let moh = collector.getModule('mock-object-helpers');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -159,17 +159,17 @@ function setupModule() {</span>
<a href="#l32.4"></a><span id="l32.4">     });</span>
<a href="#l32.5"></a><span id="l32.5">   // Listen for the fail event so that we can annotate the failure object</span>
<a href="#l32.6"></a><span id="l32.6">   //  with additional metadata.  This works out because we are directly handed</span>
<a href="#l32.7"></a><span id="l32.7">   //  a reference to the object that will be provided to the jsbridge and we</span>
<a href="#l32.8"></a><span id="l32.8">   //  can mutate it.  (The jsbridge is a global listener and so is guaranteed</span>
<a href="#l32.9"></a><span id="l32.9">   //  to be invoked after our specific named listener.)</span>
<a href="#l32.10"></a><span id="l32.10">   frame.events.addListener(&quot;fail&quot;, function(obj) {</span>
<a href="#l32.11"></a><span id="l32.11">       // normalize nsIExceptions so they look like JS exceptions...</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-      rawex = obj.exception;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+      let rawex = obj.exception;</span>
<a href="#l32.14"></a><span id="l32.14">       if (obj.exception != null &amp;&amp;</span>
<a href="#l32.15"></a><span id="l32.15">           (obj.exception instanceof Ci.nsIException)) {</span>
<a href="#l32.16"></a><span id="l32.16">         obj.exception = {</span>
<a href="#l32.17"></a><span id="l32.17">           message: &quot;nsIException: &quot; + rawex.message + &quot; (&quot; + rawex.result + &quot;)&quot;,</span>
<a href="#l32.18"></a><span id="l32.18">           fileName: rawex.filename,</span>
<a href="#l32.19"></a><span id="l32.19">           lineNumber: rawex.lineNumber,</span>
<a href="#l32.20"></a><span id="l32.20">           name: rawex.name,</span>
<a href="#l32.21"></a><span id="l32.21">           result: rawex.result,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-newmailaccount-helpers.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -187,15 +187,15 @@ var gConsoleListener = {</span>
<a href="#l33.4"></a><span id="l33.4">     this._sawMsg = false;</span>
<a href="#l33.5"></a><span id="l33.5">   },</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">   get sawMsg() {</span>
<a href="#l33.8"></a><span id="l33.8">     return this._sawMsg;</span>
<a href="#l33.9"></a><span id="l33.9">   },</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11">   wait: function() {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    self = this;</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    let self = this;</span>
<a href="#l33.14"></a><span id="l33.14">     mc.waitFor(function() {</span>
<a href="#l33.15"></a><span id="l33.15">       return self.sawMsg;</span>
<a href="#l33.16"></a><span id="l33.16">     },</span>
<a href="#l33.17"></a><span id="l33.17">     &quot;Timed out waiting for console message: &quot; + this._msg);</span>
<a href="#l33.18"></a><span id="l33.18">   },</span>
<a href="#l33.19"></a><span id="l33.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-nntp-helpers.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-nntp-helpers.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -30,16 +30,18 @@ var groups = [</span>
<a href="#l34.4"></a><span id="l34.4">   [&quot;test.subscribe.simple&quot;, true],</span>
<a href="#l34.5"></a><span id="l34.5">   [&quot;test.filter&quot;, true]</span>
<a href="#l34.6"></a><span id="l34.6"> ];</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8"> var folderDisplayHelper;</span>
<a href="#l34.9"></a><span id="l34.9"> var mc;</span>
<a href="#l34.10"></a><span id="l34.10"> var windowHelper;</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+var testHelperModule;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+</span>
<a href="#l34.14"></a><span id="l34.14"> function setupModule() {</span>
<a href="#l34.15"></a><span id="l34.15">   folderDisplayHelper = collector.getModule('folder-display-helpers');</span>
<a href="#l34.16"></a><span id="l34.16">   mc = folderDisplayHelper.mc;</span>
<a href="#l34.17"></a><span id="l34.17">   windowHelper = collector.getModule('window-helpers');</span>
<a href="#l34.18"></a><span id="l34.18">   testHelperModule = {</span>
<a href="#l34.19"></a><span id="l34.19">     Cc: Cc,</span>
<a href="#l34.20"></a><span id="l34.20">     Ci: Ci,</span>
<a href="#l34.21"></a><span id="l34.21">     Cu: Cu,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/httpd.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -742,17 +742,18 @@ nsHttpServer.prototype =</span>
<a href="#l35.4"></a><span id="l35.4">     //     this._stopCallback by starting and immediately stopping this, at</span>
<a href="#l35.5"></a><span id="l35.5">     //     which point we'd be nulling out a field we no longer have a right to</span>
<a href="#l35.6"></a><span id="l35.6">     //     modify.</span>
<a href="#l35.7"></a><span id="l35.7">     //</span>
<a href="#l35.8"></a><span id="l35.8">     var callback = this._stopCallback;</span>
<a href="#l35.9"></a><span id="l35.9">     this._stopCallback = null;</span>
<a href="#l35.10"></a><span id="l35.10">     try</span>
<a href="#l35.11"></a><span id="l35.11">     {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-      callback();</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+      if (typeof callback === &quot;function&quot;)</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+        callback();</span>
<a href="#l35.15"></a><span id="l35.15">     }</span>
<a href="#l35.16"></a><span id="l35.16">     catch (e)</span>
<a href="#l35.17"></a><span id="l35.17">     {</span>
<a href="#l35.18"></a><span id="l35.18">       // not throwing because this is specified as being usually (but not</span>
<a href="#l35.19"></a><span id="l35.19">       // always) asynchronous</span>
<a href="#l35.20"></a><span id="l35.20">       dump(&quot;!!! error running onStopped callback: &quot; + e + &quot;\n&quot;);</span>
<a href="#l35.21"></a><span id="l35.21">     }</span>
<a href="#l35.22"></a><span id="l35.22">   },</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

