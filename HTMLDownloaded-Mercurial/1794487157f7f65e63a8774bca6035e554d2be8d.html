<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 23218:1794487157f7f65e63a8774bca6035e554d2be8d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1794487157f7f65e63a8774bca6035e554d2be8d" />
<meta property="og:url" content="/comm-central/rev/1794487157f7f65e63a8774bca6035e554d2be8d" />
<meta property="og:description" content="Bug 1433156 - Move item related functions into calItemUtils.jsm - automatic changes. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1794487157f7f65e63a8774bca6035e554d2be8d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1794487157f7f65e63a8774bca6035e554d2be8d">shortlog</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1794487157f7f65e63a8774bca6035e554d2be8d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d">files</a> |
changeset |
<a href="/comm-central/raw-rev/1794487157f7f65e63a8774bca6035e554d2be8d">raw</a>  | <a href="/comm-central/archive/1794487157f7f65e63a8774bca6035e554d2be8d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1433156">Bug 1433156</a> - Move item related functions into calItemUtils.jsm - automatic changes. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 15 Oct 2017 09:46:41 +0200</td></tr>

<tr>
 <td>changeset 23218</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1794487157f7f65e63a8774bca6035e554d2be8d">1794487157f7f65e63a8774bca6035e554d2be8d</a></td>
</tr>



<tr>
<td>parent 23217</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/593b026dc5253ba0426c32f88d519fc9e9aab82c">593b026dc5253ba0426c32f88d519fc9e9aab82c</a>
</td>
</tr>

<tr>
<td>child 23219</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/033ede986813abe46b060a294645a46de42b21b1">033ede986813abe46b060a294645a46de42b21b1</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1794487157f7f65e63a8774bca6035e554d2be8d">14037</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 31 Jan 2018 23:35:59 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@173984b4516a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=173984b4516a0d3b16870b6dd321d8c0a2f4ee1f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=173984b4516a0d3b16870b6dd321d8c0a2f4ee1f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=173984b4516a0d3b16870b6dd321d8c0a2f4ee1f&newProject=comm-central&newRevision=1761d9ef933cc1326e9133d3aa988cde2c902beb&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=173984b4516a0d3b16870b6dd321d8c0a2f4ee1f&newProject=comm-central&newRevision=1761d9ef933cc1326e9133d3aa988cde2c902beb&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=173984b4516a0d3b16870b6dd321d8c0a2f4ee1f&newProject=comm-central&newRevision=1761d9ef933cc1326e9133d3aa988cde2c902beb&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1433156">1433156</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1433156">Bug 1433156</a> - Move item related functions into calItemUtils.jsm - automatic changes. r=MakeMyDay

MozReview-Commit-ID: 5zgCtmiv30S</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-clipboard.js">calendar/base/content/calendar-clipboard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-clipboard.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-clipboard.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-clipboard.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-clipboard.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-clipboard.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-common-sets.js">calendar/base/content/calendar-common-sets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-common-sets.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-common-sets.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-common-sets.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-common-sets.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-common-sets.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-dnd-listener.js">calendar/base/content/calendar-dnd-listener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-dnd-listener.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-dnd-listener.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-dnd-listener.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-dnd-listener.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-dnd-listener.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-bindings.xml">calendar/base/content/calendar-item-bindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-bindings.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-bindings.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-bindings.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-bindings.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-bindings.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.js">calendar/base/content/calendar-task-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-occurrence-prompt.xul">calendar/base/content/dialogs/calendar-occurrence-prompt.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-occurrence-prompt.xul">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-occurrence-prompt.xul">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-occurrence-prompt.xul">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-occurrence-prompt.xul">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-occurrence-prompt.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-summary-dialog.js">calendar/base/content/dialogs/calendar-summary-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-summary-dialog.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-summary-dialog.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-summary-dialog.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-summary-dialog.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/dialogs/calendar-summary-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-alarm-widget.xml">calendar/base/content/widgets/calendar-alarm-widget.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-alarm-widget.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-alarm-widget.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-alarm-widget.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-alarm-widget.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-alarm-widget.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-widgets.xml">calendar/base/content/widgets/calendar-widgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-widgets.xml">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-widgets.xml">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-widgets.xml">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-widgets.xml">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/content/widgets/calendar-widgets.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calAlarmUtils.jsm">calendar/base/modules/calAlarmUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calAlarmUtils.jsm">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calAlarmUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calAlarmUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calAlarmUtils.jsm">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calAlarmUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calDateTimeUtils.jsm">calendar/base/modules/calDateTimeUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calDateTimeUtils.jsm">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calDateTimeUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calDateTimeUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calDateTimeUtils.jsm">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calDateTimeUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calViewUtils.jsm">calendar/base/modules/calViewUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calViewUtils.jsm">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calViewUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calViewUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calViewUtils.jsm">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/modules/calViewUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarm.js">calendar/base/src/calAlarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarm.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarm.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarm.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarm.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarm.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calEvent.js">calendar/base/src/calEvent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calEvent.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calEvent.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calEvent.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calEvent.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calEvent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsParser.js">calendar/base/src/calIcsParser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsParser.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsParser.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsParser.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsParser.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsParser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsSerializer.js">calendar/base/src/calIcsSerializer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsSerializer.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsSerializer.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsSerializer.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsSerializer.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calIcsSerializer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calRecurrenceInfo.js">calendar/base/src/calRecurrenceInfo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calRecurrenceInfo.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calRecurrenceInfo.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calRecurrenceInfo.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calRecurrenceInfo.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calRecurrenceInfo.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calTodo.js">calendar/base/src/calTodo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calTodo.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calTodo.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calTodo.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calTodo.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/base/src/calTodo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/components/lightningTextCalendarConverter.js">calendar/lightning/components/lightningTextCalendarConverter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/components/lightningTextCalendarConverter.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/components/lightningTextCalendarConverter.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/components/lightningTextCalendarConverter.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/components/lightningTextCalendarConverter.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/components/lightningTextCalendarConverter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-panel.js">calendar/lightning/content/lightning-item-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-panel.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-panel.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-panel.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-panel.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/content/lightning-item-panel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/modules/ltnInvitationUtils.jsm">calendar/lightning/modules/ltnInvitationUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/modules/ltnInvitationUtils.jsm">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/modules/ltnInvitationUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/modules/ltnInvitationUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/modules/ltnInvitationUtils.jsm">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/lightning/modules/ltnInvitationUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/components/calGoogleCalendar.js">calendar/providers/gdata/components/calGoogleCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/components/calGoogleCalendar.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/components/calGoogleCalendar.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/components/calGoogleCalendar.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/components/calGoogleCalendar.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/components/calGoogleCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/content/gdata-calendar-event-dialog.js">calendar/providers/gdata/content/gdata-calendar-event-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/content/gdata-calendar-event-dialog.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/content/gdata-calendar-event-dialog.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/content/gdata-calendar-event-dialog.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/content/gdata-calendar-event-dialog.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/content/gdata-calendar-event-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/modules/gdataUtils.jsm">calendar/providers/gdata/modules/gdataUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/modules/gdataUtils.jsm">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/modules/gdataUtils.jsm">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/modules/gdataUtils.jsm">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/modules/gdataUtils.jsm">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/gdata/modules/gdataUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/resources/content/mouseoverPreviews.js">calendar/resources/content/mouseoverPreviews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/resources/content/mouseoverPreviews.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/resources/content/mouseoverPreviews.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/resources/content/mouseoverPreviews.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/resources/content/mouseoverPreviews.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/resources/content/mouseoverPreviews.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_ics_parser.js">calendar/test/unit/test_ics_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_ics_parser.js">file</a> |
<a href="/comm-central/annotate/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_ics_parser.js">annotate</a> |
<a href="/comm-central/diff/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_ics_parser.js">diff</a> |
<a href="/comm-central/comparison/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_ics_parser.js">comparison</a> |
<a href="/comm-central/log/1794487157f7f65e63a8774bca6035e554d2be8d/calendar/test/unit/test_ics_parser.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -216,17 +216,17 @@ agendaListbox.editSelectedItem = functio</span>
<a href="#l1.4"></a><span id="l1.4">  * item occurrs tomorrow.</span>
<a href="#l1.5"></a><span id="l1.5">  *</span>
<a href="#l1.6"></a><span id="l1.6">  * @param aItem     The item to find the period for.</span>
<a href="#l1.7"></a><span id="l1.7">  */</span>
<a href="#l1.8"></a><span id="l1.8"> agendaListbox.findPeriodsForItem = function(aItem) {</span>
<a href="#l1.9"></a><span id="l1.9">     let retPeriods = [];</span>
<a href="#l1.10"></a><span id="l1.10">     for (let i = 0; i &lt; this.periods.length; i++) {</span>
<a href="#l1.11"></a><span id="l1.11">         if (this.periods[i].open) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-            if (cal.checkIfInRange(aItem, this.periods[i].start, this.periods[i].end)) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+            if (cal.item.checkIfInRange(aItem, this.periods[i].start, this.periods[i].end)) {</span>
<a href="#l1.14"></a><span id="l1.14">                 retPeriods.push(this.periods[i]);</span>
<a href="#l1.15"></a><span id="l1.15">             }</span>
<a href="#l1.16"></a><span id="l1.16">         }</span>
<a href="#l1.17"></a><span id="l1.17">     }</span>
<a href="#l1.18"></a><span id="l1.18">     return retPeriods;</span>
<a href="#l1.19"></a><span id="l1.19"> };</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21"> /**</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -289,17 +289,17 @@ agendaListbox.addItemBefore = function(a</span>
<a href="#l1.23"></a><span id="l1.23"> /**</span>
<a href="#l1.24"></a><span id="l1.24">  * Adds an item to the agenda listbox. This function finds the correct period</span>
<a href="#l1.25"></a><span id="l1.25">  * for the item and inserts it correctly so the period stays sorted.</span>
<a href="#l1.26"></a><span id="l1.26">  *</span>
<a href="#l1.27"></a><span id="l1.27">  * @param aItem         The calIItemBase to add.</span>
<a href="#l1.28"></a><span id="l1.28">  * @return              The newly created XUL element.</span>
<a href="#l1.29"></a><span id="l1.29">  */</span>
<a href="#l1.30"></a><span id="l1.30"> agendaListbox.addItem = function(aItem) {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-    if (!cal.isEvent(aItem)) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+    if (!cal.item.isEvent(aItem)) {</span>
<a href="#l1.33"></a><span id="l1.33">         return null;</span>
<a href="#l1.34"></a><span id="l1.34">     }</span>
<a href="#l1.35"></a><span id="l1.35">     let periods = this.findPeriodsForItem(aItem);</span>
<a href="#l1.36"></a><span id="l1.36">     if (periods.length == 0) {</span>
<a href="#l1.37"></a><span id="l1.37">         return null;</span>
<a href="#l1.38"></a><span id="l1.38">     }</span>
<a href="#l1.39"></a><span id="l1.39">     let newlistItem = null;</span>
<a href="#l1.40"></a><span id="l1.40">     for (let i = 0; i &lt; periods.length; i++) {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -884,17 +884,17 @@ agendaListbox.calendarObserver.onStartBa</span>
<a href="#l1.42"></a><span id="l1.42"> agendaListbox.calendarObserver.onEndBatch = function() {</span>
<a href="#l1.43"></a><span id="l1.43"> };</span>
<a href="#l1.44"></a><span id="l1.44"> </span>
<a href="#l1.45"></a><span id="l1.45"> agendaListbox.calendarObserver.onLoad = function() {</span>
<a href="#l1.46"></a><span id="l1.46">     this.agendaListbox.refreshCalendarQuery();</span>
<a href="#l1.47"></a><span id="l1.47"> };</span>
<a href="#l1.48"></a><span id="l1.48"> </span>
<a href="#l1.49"></a><span id="l1.49"> agendaListbox.calendarObserver.onAddItem = function(item) {</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-    if (!cal.isEvent(item)) {</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+    if (!cal.item.isEvent(item)) {</span>
<a href="#l1.52"></a><span id="l1.52">         return;</span>
<a href="#l1.53"></a><span id="l1.53">     }</span>
<a href="#l1.54"></a><span id="l1.54">     // get all sub items if it is a recurring item</span>
<a href="#l1.55"></a><span id="l1.55">     let occs = this.getOccurrencesBetween(item);</span>
<a href="#l1.56"></a><span id="l1.56">     occs.forEach(this.agendaListbox.addItem, this.agendaListbox);</span>
<a href="#l1.57"></a><span id="l1.57">     setCurrentEvent();</span>
<a href="#l1.58"></a><span id="l1.58"> };</span>
<a href="#l1.59"></a><span id="l1.59"> </span>
<a href="#l1.60"></a><span id="l1.60" class="difflineat">@@ -908,34 +908,34 @@ agendaListbox.calendarObserver.getOccurr</span>
<a href="#l1.61"></a><span id="l1.61">     return occs;</span>
<a href="#l1.62"></a><span id="l1.62"> };</span>
<a href="#l1.63"></a><span id="l1.63"> </span>
<a href="#l1.64"></a><span id="l1.64"> agendaListbox.calendarObserver.onDeleteItem = function(item, rebuildFlag) {</span>
<a href="#l1.65"></a><span id="l1.65">     this.onLocalDeleteItem(item, true);</span>
<a href="#l1.66"></a><span id="l1.66"> };</span>
<a href="#l1.67"></a><span id="l1.67"> </span>
<a href="#l1.68"></a><span id="l1.68"> agendaListbox.calendarObserver.onLocalDeleteItem = function(item, moveSelection) {</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-    if (!cal.isEvent(item)) {</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+    if (!cal.item.isEvent(item)) {</span>
<a href="#l1.71"></a><span id="l1.71">         return false;</span>
<a href="#l1.72"></a><span id="l1.72">     }</span>
<a href="#l1.73"></a><span id="l1.73">     let selectedItemHashId = -1;</span>
<a href="#l1.74"></a><span id="l1.74">     // get all sub items if it is a recurring item</span>
<a href="#l1.75"></a><span id="l1.75">     let occs = this.getOccurrencesBetween(item);</span>
<a href="#l1.76"></a><span id="l1.76">     for (let i = 0; i &lt; occs.length; i++) {</span>
<a href="#l1.77"></a><span id="l1.77">         let isSelected = this.agendaListbox.deleteItem(occs[i], moveSelection);</span>
<a href="#l1.78"></a><span id="l1.78">         if (isSelected) {</span>
<a href="#l1.79"></a><span id="l1.79">             selectedItemHashId = occs[i].hashId;</span>
<a href="#l1.80"></a><span id="l1.80">         }</span>
<a href="#l1.81"></a><span id="l1.81">     }</span>
<a href="#l1.82"></a><span id="l1.82">     return selectedItemHashId;</span>
<a href="#l1.83"></a><span id="l1.83"> };</span>
<a href="#l1.84"></a><span id="l1.84"> </span>
<a href="#l1.85"></a><span id="l1.85"> agendaListbox.calendarObserver.onModifyItem = function(newItem, oldItem) {</span>
<a href="#l1.86"></a><span id="l1.86">     let selectedItemHashId = this.onLocalDeleteItem(oldItem, false);</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-    if (!cal.isEvent(newItem)) {</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+    if (!cal.item.isEvent(newItem)) {</span>
<a href="#l1.89"></a><span id="l1.89">         return;</span>
<a href="#l1.90"></a><span id="l1.90">     }</span>
<a href="#l1.91"></a><span id="l1.91">     this.onAddItem(newItem);</span>
<a href="#l1.92"></a><span id="l1.92">     if (selectedItemHashId != -1) {</span>
<a href="#l1.93"></a><span id="l1.93">         let listItem = agendaListbox.getListItemByHashId(selectedItemHashId);</span>
<a href="#l1.94"></a><span id="l1.94">         if (listItem) {</span>
<a href="#l1.95"></a><span id="l1.95">             agendaListbox.agendaListboxControl.clearSelection();</span>
<a href="#l1.96"></a><span id="l1.96">             agendaListbox.agendaListboxControl.ensureElementIsVisible(listItem);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -74,17 +74,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">               onEndBatch: function() {</span>
<a href="#l2.5"></a><span id="l2.5">               },</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">               onLoad: function() {</span>
<a href="#l2.8"></a><span id="l2.8">                   this.calView.refresh();</span>
<a href="#l2.9"></a><span id="l2.9">               },</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">               onAddItem: function(aItem) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                  if (cal.isToDo(aItem)) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                  if (cal.item.isToDo(aItem)) {</span>
<a href="#l2.14"></a><span id="l2.14">                       if (!aItem.entryDate &amp;&amp; !aItem.dueDate) {</span>
<a href="#l2.15"></a><span id="l2.15">                           return;</span>
<a href="#l2.16"></a><span id="l2.16">                       }</span>
<a href="#l2.17"></a><span id="l2.17">                       if (!this.calView.mTasksInView) {</span>
<a href="#l2.18"></a><span id="l2.18">                           return;</span>
<a href="#l2.19"></a><span id="l2.19">                       }</span>
<a href="#l2.20"></a><span id="l2.20">                       if (aItem.isCompleted &amp;&amp; !this.calView.mShowCompleted) {</span>
<a href="#l2.21"></a><span id="l2.21">                           return;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -95,31 +95,31 @@</span>
<a href="#l2.23"></a><span id="l2.23">                                                          this.calView.queryEndDate,</span>
<a href="#l2.24"></a><span id="l2.24">                                                          {});</span>
<a href="#l2.25"></a><span id="l2.25">                   for (let occ of occs) {</span>
<a href="#l2.26"></a><span id="l2.26">                       this.calView.doAddItem(occ);</span>
<a href="#l2.27"></a><span id="l2.27">                   }</span>
<a href="#l2.28"></a><span id="l2.28">               },</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">               onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-                  if (cal.isToDo(aNewItem) &amp;&amp; cal.isToDo(aOldItem) &amp;&amp;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+                  if (cal.item.isToDo(aNewItem) &amp;&amp; cal.item.isToDo(aOldItem) &amp;&amp;</span>
<a href="#l2.33"></a><span id="l2.33">                       !this.calView.mTasksInView) {</span>
<a href="#l2.34"></a><span id="l2.34">                       return;</span>
<a href="#l2.35"></a><span id="l2.35">                   }</span>
<a href="#l2.36"></a><span id="l2.36">                   let occs;</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-                  if (!cal.isToDo(aOldItem) || aOldItem.entryDate || aOldItem.dueDate) {</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+                  if (!cal.item.isToDo(aOldItem) || aOldItem.entryDate || aOldItem.dueDate) {</span>
<a href="#l2.40"></a><span id="l2.40">                       occs = aOldItem.getOccurrencesBetween(this.calView.startDate,</span>
<a href="#l2.41"></a><span id="l2.41">                                                             this.calView.queryEndDate,</span>
<a href="#l2.42"></a><span id="l2.42">                                                             {});</span>
<a href="#l2.43"></a><span id="l2.43">                       for (let occ of occs) {</span>
<a href="#l2.44"></a><span id="l2.44">                           this.calView.doDeleteItem(occ);</span>
<a href="#l2.45"></a><span id="l2.45">                       }</span>
<a href="#l2.46"></a><span id="l2.46">                   }</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-                  if (cal.isToDo(aNewItem)) {</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+                  if (cal.item.isToDo(aNewItem)) {</span>
<a href="#l2.49"></a><span id="l2.49">                       if ((!aNewItem.entryDate &amp;&amp; !aNewItem.dueDate) || !this.calView.mTasksInView) {</span>
<a href="#l2.50"></a><span id="l2.50">                           return;</span>
<a href="#l2.51"></a><span id="l2.51">                       }</span>
<a href="#l2.52"></a><span id="l2.52">                       if (aNewItem.isCompleted &amp;&amp; !this.calView.mShowCompleted) {</span>
<a href="#l2.53"></a><span id="l2.53">                           return;</span>
<a href="#l2.54"></a><span id="l2.54">                       }</span>
<a href="#l2.55"></a><span id="l2.55">                   }</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57" class="difflineat">@@ -127,17 +127,17 @@</span>
<a href="#l2.58"></a><span id="l2.58">                                                         this.calView.queryEndDate,</span>
<a href="#l2.59"></a><span id="l2.59">                                                         {});</span>
<a href="#l2.60"></a><span id="l2.60">                   for (let occ of occs) {</span>
<a href="#l2.61"></a><span id="l2.61">                       this.calView.doAddItem(occ);</span>
<a href="#l2.62"></a><span id="l2.62">                   }</span>
<a href="#l2.63"></a><span id="l2.63">               },</span>
<a href="#l2.64"></a><span id="l2.64"> </span>
<a href="#l2.65"></a><span id="l2.65">               onDeleteItem: function(aItem) {</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-                  if (cal.isToDo(aItem)) {</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+                  if (cal.item.isToDo(aItem)) {</span>
<a href="#l2.68"></a><span id="l2.68">                       if (!this.calView.mTasksInView) {</span>
<a href="#l2.69"></a><span id="l2.69">                           return;</span>
<a href="#l2.70"></a><span id="l2.70">                       }</span>
<a href="#l2.71"></a><span id="l2.71">                       if (!aItem.entryDate &amp;&amp; !aItem.dueDate) {</span>
<a href="#l2.72"></a><span id="l2.72">                           return;</span>
<a href="#l2.73"></a><span id="l2.73">                       }</span>
<a href="#l2.74"></a><span id="l2.74">                       if (aItem.isCompleted &amp;&amp; !this.calView.mShowCompleted) {</span>
<a href="#l2.75"></a><span id="l2.75">                           return;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineat">@@ -471,17 +471,17 @@</span>
<a href="#l2.77"></a><span id="l2.77">                 },</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">                 onGetResult: function(aOpCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l2.80"></a><span id="l2.80">                     if (this.cancelled || !Components.isSuccessCode(aStatus)) {</span>
<a href="#l2.81"></a><span id="l2.81">                         return;</span>
<a href="#l2.82"></a><span id="l2.82">                     }</span>
<a href="#l2.83"></a><span id="l2.83"> </span>
<a href="#l2.84"></a><span id="l2.84">                     for (let item of aItems) {</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-                        if (!cal.isToDo(item) || item.entryDate || item.dueDate) {</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+                        if (!cal.item.isToDo(item) || item.entryDate || item.dueDate) {</span>
<a href="#l2.87"></a><span id="l2.87">                             this.calView.doAddItem(item);</span>
<a href="#l2.88"></a><span id="l2.88">                         }</span>
<a href="#l2.89"></a><span id="l2.89">                     }</span>
<a href="#l2.90"></a><span id="l2.90">                 },</span>
<a href="#l2.91"></a><span id="l2.91"> </span>
<a href="#l2.92"></a><span id="l2.92">                 cancel: function() {</span>
<a href="#l2.93"></a><span id="l2.93">                     this.calView.mLog.info(&quot;Refresh cancelled for calendar &quot; + this.calId);</span>
<a href="#l2.94"></a><span id="l2.94">                     this.cancelled = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-clipboard.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-clipboard.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -210,17 +210,17 @@ function pasteFromClipboard() {</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">             startBatchTransaction();</span>
<a href="#l3.6"></a><span id="l3.6">             for (let item of items) {</span>
<a href="#l3.7"></a><span id="l3.7">                 let newItem = item.clone();</span>
<a href="#l3.8"></a><span id="l3.8">                 // Set new UID to allow multiple paste actions of the same</span>
<a href="#l3.9"></a><span id="l3.9">                 // clipboard content.</span>
<a href="#l3.10"></a><span id="l3.10">                 newItem.id = cal.getUUID();</span>
<a href="#l3.11"></a><span id="l3.11">                 if (offset) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                    cal.shiftItem(newItem, offset);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                    cal.item.shiftOffset(newItem, offset);</span>
<a href="#l3.14"></a><span id="l3.14">                 }</span>
<a href="#l3.15"></a><span id="l3.15">                 doTransaction(&quot;add&quot;, newItem, destCal, null, null);</span>
<a href="#l3.16"></a><span id="l3.16">             }</span>
<a href="#l3.17"></a><span id="l3.17">             endBatchTransaction();</span>
<a href="#l3.18"></a><span id="l3.18">             break;</span>
<a href="#l3.19"></a><span id="l3.19">         }</span>
<a href="#l3.20"></a><span id="l3.20">         default:</span>
<a href="#l3.21"></a><span id="l3.21">             break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-common-sets.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-common-sets.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -813,23 +813,23 @@ function removeCalendarCommandController</span>
<a href="#l4.4"></a><span id="l4.4"> function setupContextItemType(event, items) {</span>
<a href="#l4.5"></a><span id="l4.5">     function adaptModificationMenuItem(aMenuItemId, aItemType) {</span>
<a href="#l4.6"></a><span id="l4.6">         let menuItem = document.getElementById(aMenuItemId);</span>
<a href="#l4.7"></a><span id="l4.7">         if (menuItem) {</span>
<a href="#l4.8"></a><span id="l4.8">             menuItem.setAttribute(&quot;label&quot;, cal.calGetString(&quot;calendar&quot;, &quot;delete&quot; + aItemType + &quot;Label&quot;));</span>
<a href="#l4.9"></a><span id="l4.9">             menuItem.setAttribute(&quot;accesskey&quot;, cal.calGetString(&quot;calendar&quot;, &quot;delete&quot; + aItemType + &quot;Accesskey&quot;));</span>
<a href="#l4.10"></a><span id="l4.10">         }</span>
<a href="#l4.11"></a><span id="l4.11">     }</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    if (items.some(cal.isEvent) &amp;&amp; items.some(cal.isToDo)) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    if (items.some(cal.item.isEvent) &amp;&amp; items.some(cal.item.isToDo)) {</span>
<a href="#l4.14"></a><span id="l4.14">         event.target.setAttribute(&quot;type&quot;, &quot;mixed&quot;);</span>
<a href="#l4.15"></a><span id="l4.15">         adaptModificationMenuItem(&quot;calendar-item-context-menu-delete-menuitem&quot;, &quot;Item&quot;);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-    } else if (items.length &amp;&amp; cal.isEvent(items[0])) {</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+    } else if (items.length &amp;&amp; cal.item.isEvent(items[0])) {</span>
<a href="#l4.18"></a><span id="l4.18">         event.target.setAttribute(&quot;type&quot;, &quot;event&quot;);</span>
<a href="#l4.19"></a><span id="l4.19">         adaptModificationMenuItem(&quot;calendar-item-context-menu-delete-menuitem&quot;, &quot;Event&quot;);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-    } else if (items.length &amp;&amp; cal.isToDo(items[0])) {</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+    } else if (items.length &amp;&amp; cal.item.isToDo(items[0])) {</span>
<a href="#l4.22"></a><span id="l4.22">         event.target.setAttribute(&quot;type&quot;, &quot;todo&quot;);</span>
<a href="#l4.23"></a><span id="l4.23">         adaptModificationMenuItem(&quot;calendar-item-context-menu-delete-menuitem&quot;, &quot;Task&quot;);</span>
<a href="#l4.24"></a><span id="l4.24">     } else {</span>
<a href="#l4.25"></a><span id="l4.25">         event.target.removeAttribute(&quot;type&quot;);</span>
<a href="#l4.26"></a><span id="l4.26">         adaptModificationMenuItem(&quot;calendar-item-context-menu-delete-menuitem&quot;, &quot;Item&quot;);</span>
<a href="#l4.27"></a><span id="l4.27">     }</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29">     let menu = document.getElementById(&quot;calendar-item-context-menu-attendance-menu&quot;);</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineat">@@ -906,20 +906,20 @@ function calendarUpdateNewItemsCommand()</span>
<a href="#l4.31"></a><span id="l4.31">         &quot;calendar_new_todo_context_command&quot;,</span>
<a href="#l4.32"></a><span id="l4.32">         &quot;calendar_new_todo_todaypane_command&quot;</span>
<a href="#l4.33"></a><span id="l4.33">     ];</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35">     // re-calculate command status</span>
<a href="#l4.36"></a><span id="l4.36">     CalendarNewEventsCommandEnabled = false;</span>
<a href="#l4.37"></a><span id="l4.37">     CalendarNewTasksCommandEnabled = false;</span>
<a href="#l4.38"></a><span id="l4.38">     let calendars = cal.getCalendarManager().getCalendars({}).filter(cal.acl.isCalendarWritable).filter(cal.acl.userCanAddItemsToCalendar);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-    if (calendars.some(cal.isEventCalendar)) {</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+    if (calendars.some(cal.item.isEventCalendar)) {</span>
<a href="#l4.41"></a><span id="l4.41">         CalendarNewEventsCommandEnabled = true;</span>
<a href="#l4.42"></a><span id="l4.42">     }</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-    if (calendars.some(cal.isTaskCalendar)) {</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+    if (calendars.some(cal.item.isTaskCalendar)) {</span>
<a href="#l4.45"></a><span id="l4.45">         CalendarNewTasksCommandEnabled = true;</span>
<a href="#l4.46"></a><span id="l4.46">     }</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48">     // update command status if required</span>
<a href="#l4.49"></a><span id="l4.49">     if (CalendarNewEventsCommandEnabled != oldEventValue) {</span>
<a href="#l4.50"></a><span id="l4.50">         eventCommands.forEach(goUpdateCommand);</span>
<a href="#l4.51"></a><span id="l4.51">     }</span>
<a href="#l4.52"></a><span id="l4.52">     if (CalendarNewTasksCommandEnabled != oldTaskValue) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -456,17 +456,17 @@ calCalendarButtonDNDObserver.prototype =</span>
<a href="#l5.4"></a><span id="l5.4">      * Gets called in case we're dropping an array of items</span>
<a href="#l5.5"></a><span id="l5.5">      * on the 'calendar mode'-button.</span>
<a href="#l5.6"></a><span id="l5.6">      *</span>
<a href="#l5.7"></a><span id="l5.7">      * @param aItems        An array of items to handle.</span>
<a href="#l5.8"></a><span id="l5.8">      */</span>
<a href="#l5.9"></a><span id="l5.9">     onDropItems: function(aItems) {</span>
<a href="#l5.10"></a><span id="l5.10">         for (var item of aItems) {</span>
<a href="#l5.11"></a><span id="l5.11">             var newItem = item;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-            if (cal.isToDo(item)) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+            if (cal.item.isToDo(item)) {</span>
<a href="#l5.14"></a><span id="l5.14">                 newItem = itemConversion.eventFromTask(item);</span>
<a href="#l5.15"></a><span id="l5.15">             }</span>
<a href="#l5.16"></a><span id="l5.16">             createEventWithDialog(null, null, null, null, newItem);</span>
<a href="#l5.17"></a><span id="l5.17">         }</span>
<a href="#l5.18"></a><span id="l5.18">     },</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">     /**</span>
<a href="#l5.21"></a><span id="l5.21">      * calCalendarButtonDNDObserver::onDropMessage</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -505,17 +505,17 @@ calTaskButtonDNDObserver.prototype = {</span>
<a href="#l5.23"></a><span id="l5.23">      * Gets called in case we're dropping an array of items</span>
<a href="#l5.24"></a><span id="l5.24">      * on the 'task mode'-button.</span>
<a href="#l5.25"></a><span id="l5.25">      *</span>
<a href="#l5.26"></a><span id="l5.26">      * @param aItems        An array of items to handle.</span>
<a href="#l5.27"></a><span id="l5.27">      */</span>
<a href="#l5.28"></a><span id="l5.28">     onDropItems: function(aItems) {</span>
<a href="#l5.29"></a><span id="l5.29">         for (var item of aItems) {</span>
<a href="#l5.30"></a><span id="l5.30">             var newItem = item;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-            if (cal.isEvent(item)) {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+            if (cal.item.isEvent(item)) {</span>
<a href="#l5.33"></a><span id="l5.33">                 newItem = itemConversion.taskFromEvent(item);</span>
<a href="#l5.34"></a><span id="l5.34">             }</span>
<a href="#l5.35"></a><span id="l5.35">             createTodoWithDialog(null, null, null, newItem);</span>
<a href="#l5.36"></a><span id="l5.36">         }</span>
<a href="#l5.37"></a><span id="l5.37">     },</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">     /**</span>
<a href="#l5.40"></a><span id="l5.40">      * calTaskButtonDNDObserver::onDropMessage</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -555,20 +555,20 @@ function invokeEventDragSession(aItem, a</span>
<a href="#l5.42"></a><span id="l5.42">                 aOutData.value = aItem;</span>
<a href="#l5.43"></a><span id="l5.43">                 aOutDataLen.value = 1;</span>
<a href="#l5.44"></a><span id="l5.44">             } else {</span>
<a href="#l5.45"></a><span id="l5.45">                 cal.ASSERT(false, &quot;error:&quot; + aInFlavor);</span>
<a href="#l5.46"></a><span id="l5.46">             }</span>
<a href="#l5.47"></a><span id="l5.47">         }</span>
<a href="#l5.48"></a><span id="l5.48">     };</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-    if (cal.isEvent(aItem)) {</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+    if (cal.item.isEvent(aItem)) {</span>
<a href="#l5.52"></a><span id="l5.52">       transfer.addDataFlavor(&quot;application/vnd.x-moz-cal-event&quot;);</span>
<a href="#l5.53"></a><span id="l5.53">       transfer.setTransferData(&quot;application/vnd.x-moz-cal-event&quot;, flavourProvider, 0);</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-    } else if (cal.isToDo(aItem)) {</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+    } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l5.56"></a><span id="l5.56">       transfer.addDataFlavor(&quot;application/vnd.x-moz-cal-task&quot;);</span>
<a href="#l5.57"></a><span id="l5.57">       transfer.setTransferData(&quot;application/vnd.x-moz-cal-task&quot;, flavourProvider, 0);</span>
<a href="#l5.58"></a><span id="l5.58">     }</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60">     // Also set some normal data-types, in case we drag into another app</span>
<a href="#l5.61"></a><span id="l5.61">     let serializer = Components.classes[&quot;@mozilla.org/calendar/ics-serializer;1&quot;]</span>
<a href="#l5.62"></a><span id="l5.62">                                .createInstance(Components.interfaces.calIIcsSerializer);</span>
<a href="#l5.63"></a><span id="l5.63">     serializer.addItems([aItem], 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -187,19 +187,19 @@ var calendarExtract = {</span>
<a href="#l6.4"></a><span id="l6.4">                 }</span>
<a href="#l6.5"></a><span id="l6.5">                 if (endGuess.hour != null) {</span>
<a href="#l6.6"></a><span id="l6.6">                     dueDate.setHours(endGuess.hour);</span>
<a href="#l6.7"></a><span id="l6.7">                 }</span>
<a href="#l6.8"></a><span id="l6.8">                 if (endGuess.minute != null) {</span>
<a href="#l6.9"></a><span id="l6.9">                     dueDate.setMinutes(endGuess.minute);</span>
<a href="#l6.10"></a><span id="l6.10">                 }</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                cal.setItemProperty(item, &quot;entryDate&quot;, cal.dtz.jsDateToDateTime(date, dtz));</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                cal.item.setItemProperty(item, &quot;entryDate&quot;, cal.dtz.jsDateToDateTime(date, dtz));</span>
<a href="#l6.14"></a><span id="l6.14">                 if (endGuess.year != null) {</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                    cal.setItemProperty(item, &quot;dueDate&quot;, cal.dtz.jsDateToDateTime(dueDate, dtz));</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+                    cal.item.setItemProperty(item, &quot;dueDate&quot;, cal.dtz.jsDateToDateTime(dueDate, dtz));</span>
<a href="#l6.17"></a><span id="l6.17">                 }</span>
<a href="#l6.18"></a><span id="l6.18">             }</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">             // if time not guessed set allday for events</span>
<a href="#l6.21"></a><span id="l6.21">             if (allDay) {</span>
<a href="#l6.22"></a><span id="l6.22">                 createEventWithDialog(null, null, null, null, item, true);</span>
<a href="#l6.23"></a><span id="l6.23">             } else {</span>
<a href="#l6.24"></a><span id="l6.24">                 createEventWithDialog(null, null, null, null, item);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-bindings.xml</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -55,28 +55,28 @@</span>
<a href="#l7.4"></a><span id="l7.4">             this.mItem = val;</span>
<a href="#l7.5"></a><span id="l7.5">             let headerLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-label&quot;);</span>
<a href="#l7.6"></a><span id="l7.6">             let itemDateTimeLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-datetime-value&quot;);</span>
<a href="#l7.7"></a><span id="l7.7">             let date;</span>
<a href="#l7.8"></a><span id="l7.8">             if (this.mode == &quot;start&quot;) {</span>
<a href="#l7.9"></a><span id="l7.9">                 date = this.mItem[cal.dtz.startDateProp(this.mItem)];</span>
<a href="#l7.10"></a><span id="l7.10">                 if (date) {</span>
<a href="#l7.11"></a><span id="l7.11">                     let label;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-                    if (cal.isToDo(this.mItem)) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+                    if (cal.item.isToDo(this.mItem)) {</span>
<a href="#l7.14"></a><span id="l7.14">                         label = this.getAttribute(&quot;taskStartLabel&quot;);</span>
<a href="#l7.15"></a><span id="l7.15">                     } else {</span>
<a href="#l7.16"></a><span id="l7.16">                         label = this.getAttribute(&quot;eventStartLabel&quot;);</span>
<a href="#l7.17"></a><span id="l7.17">                     }</span>
<a href="#l7.18"></a><span id="l7.18">                     headerLabel.value = label;</span>
<a href="#l7.19"></a><span id="l7.19">                 }</span>
<a href="#l7.20"></a><span id="l7.20">             } else {</span>
<a href="#l7.21"></a><span id="l7.21">                 date = this.mItem[cal.dtz.endDateProp(this.mItem)];</span>
<a href="#l7.22"></a><span id="l7.22">                 if (date) {</span>
<a href="#l7.23"></a><span id="l7.23">                     let label;</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-                    if (cal.isToDo(this.mItem)) {</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+                    if (cal.item.isToDo(this.mItem)) {</span>
<a href="#l7.26"></a><span id="l7.26">                         label = this.getAttribute(&quot;taskDueLabel&quot;);</span>
<a href="#l7.27"></a><span id="l7.27">                     } else {</span>
<a href="#l7.28"></a><span id="l7.28">                         label = this.getAttribute(&quot;eventEndLabel&quot;);</span>
<a href="#l7.29"></a><span id="l7.29">                     }</span>
<a href="#l7.30"></a><span id="l7.30">                     headerLabel.value = label;</span>
<a href="#l7.31"></a><span id="l7.31">                 }</span>
<a href="#l7.32"></a><span id="l7.32">             }</span>
<a href="#l7.33"></a><span id="l7.33">             let hideLabels = (date == null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -46,17 +46,17 @@ function setDefaultItemValues(aItem, aCa</span>
<a href="#l8.4"></a><span id="l8.4">         sod.minute = 0;</span>
<a href="#l8.5"></a><span id="l8.5">         sod.second = 0;</span>
<a href="#l8.6"></a><span id="l8.6">         return sod;</span>
<a href="#l8.7"></a><span id="l8.7">     }</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">     let initialDate = aInitialDate ? aInitialDate.clone() : cal.dtz.now();</span>
<a href="#l8.10"></a><span id="l8.10">     initialDate.isDate = true;</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    if (cal.isEvent(aItem)) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    if (cal.item.isEvent(aItem)) {</span>
<a href="#l8.14"></a><span id="l8.14">         if (aStartDate) {</span>
<a href="#l8.15"></a><span id="l8.15">             aItem.startDate = aStartDate.clone();</span>
<a href="#l8.16"></a><span id="l8.16">             if (aStartDate.isDate &amp;&amp; !aForceAllday) {</span>
<a href="#l8.17"></a><span id="l8.17">                 // This is a special case where the date is specified, but the</span>
<a href="#l8.18"></a><span id="l8.18">                 // time is not. To take care, we setup up the time to our</span>
<a href="#l8.19"></a><span id="l8.19">                 // default event start time.</span>
<a href="#l8.20"></a><span id="l8.20">                 aItem.startDate = cal.dtz.getDefaultStartDate(aItem.startDate);</span>
<a href="#l8.21"></a><span id="l8.21">             } else if (aForceAllday) {</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -88,18 +88,18 @@ function setDefaultItemValues(aItem, aCa</span>
<a href="#l8.23"></a><span id="l8.23">             } else {</span>
<a href="#l8.24"></a><span id="l8.24">                 // If the event is not all day, then add the default event</span>
<a href="#l8.25"></a><span id="l8.25">                 // length.</span>
<a href="#l8.26"></a><span id="l8.26">                 aItem.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l8.27"></a><span id="l8.27">             }</span>
<a href="#l8.28"></a><span id="l8.28">         }</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30">         // Free/busy status is only valid for events, must not be set for tasks.</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-        aItem.setProperty(&quot;TRANSP&quot;, cal.getEventDefaultTransparency(aForceAllday));</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-    } else if (cal.isToDo(aItem)) {</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+        aItem.setProperty(&quot;TRANSP&quot;, cal.item.getEventDefaultTransparency(aForceAllday));</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+    } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l8.35"></a><span id="l8.35">         let now = cal.dtz.now();</span>
<a href="#l8.36"></a><span id="l8.36">         let initDate = initialDate ? initialDate.clone() : now;</span>
<a href="#l8.37"></a><span id="l8.37">         initDate.isDate = false;</span>
<a href="#l8.38"></a><span id="l8.38">         initDate.hour = now.hour;</span>
<a href="#l8.39"></a><span id="l8.39">         initDate.minute = now.minute;</span>
<a href="#l8.40"></a><span id="l8.40">         initDate.second = now.second;</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42">         if (aStartDate) {</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineat">@@ -336,17 +336,17 @@ function createTodoWithDialog(calendar, </span>
<a href="#l8.44"></a><span id="l8.44">  *            (empty if result.type = &quot;ERROR&quot;|&quot;NODIFF&quot;){Array} differences: [{</span>
<a href="#l8.45"></a><span id="l8.45">  *                property: {String} a property that is subject to the proposal</span>
<a href="#l8.46"></a><span id="l8.46">  *                proposed: {String} the proposed value</span>
<a href="#l8.47"></a><span id="l8.47">  *                original: {String} the original value</span>
<a href="#l8.48"></a><span id="l8.48">  *            }]</span>
<a href="#l8.49"></a><span id="l8.49">  *        }</span>
<a href="#l8.50"></a><span id="l8.50">  */</span>
<a href="#l8.51"></a><span id="l8.51"> function modifyEventWithDialog(aItem, job=null, aPromptOccurrence, initialDate=null, aCounterProposal) {</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-    let dlg = cal.findItemWindow(aItem);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+    let dlg = cal.item.findWindow(aItem);</span>
<a href="#l8.54"></a><span id="l8.54">     if (dlg) {</span>
<a href="#l8.55"></a><span id="l8.55">         dlg.focus();</span>
<a href="#l8.56"></a><span id="l8.56">         disposeJob(job);</span>
<a href="#l8.57"></a><span id="l8.57">         return;</span>
<a href="#l8.58"></a><span id="l8.58">     }</span>
<a href="#l8.59"></a><span id="l8.59"> </span>
<a href="#l8.60"></a><span id="l8.60">     let onModifyItem = function(item, calendar, originalItem, listener) {</span>
<a href="#l8.61"></a><span id="l8.61">         doTransaction(&quot;modify&quot;, item, calendar, originalItem, listener);</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineat">@@ -374,35 +374,35 @@ function modifyEventWithDialog(aItem, jo</span>
<a href="#l8.63"></a><span id="l8.63">  * @param mode              The operation the dialog should do (&quot;new&quot;, &quot;modify&quot;)</span>
<a href="#l8.64"></a><span id="l8.64">  * @param callback          The callback to call when the dialog has completed.</span>
<a href="#l8.65"></a><span id="l8.65">  * @param job               (optional) The job object for the modification.</span>
<a href="#l8.66"></a><span id="l8.66">  * @param initialDate       (optional) The initial date for new task datepickers</span>
<a href="#l8.67"></a><span id="l8.67">  * @param counterProposal   (optional) An object representing the counterproposal - see</span>
<a href="#l8.68"></a><span id="l8.68">  *                                     description for modifyEventWithDialog()</span>
<a href="#l8.69"></a><span id="l8.69">  */</span>
<a href="#l8.70"></a><span id="l8.70"> function openEventDialog(calendarItem, calendar, mode, callback, job=null, initialDate=null, counterProposal) {</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-    let dlg = cal.findItemWindow(calendarItem);</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+    let dlg = cal.item.findWindow(calendarItem);</span>
<a href="#l8.73"></a><span id="l8.73">     if (dlg) {</span>
<a href="#l8.74"></a><span id="l8.74">         dlg.focus();</span>
<a href="#l8.75"></a><span id="l8.75">         disposeJob(job);</span>
<a href="#l8.76"></a><span id="l8.76">         return;</span>
<a href="#l8.77"></a><span id="l8.77">     }</span>
<a href="#l8.78"></a><span id="l8.78"> </span>
<a href="#l8.79"></a><span id="l8.79">     // Set up some defaults</span>
<a href="#l8.80"></a><span id="l8.80">     mode = mode || &quot;new&quot;;</span>
<a href="#l8.81"></a><span id="l8.81">     calendar = calendar || getSelectedCalendar();</span>
<a href="#l8.82"></a><span id="l8.82">     let calendars = cal.getCalendarManager().getCalendars({});</span>
<a href="#l8.83"></a><span id="l8.83">     calendars = calendars.filter(cal.acl.isCalendarWritable);</span>
<a href="#l8.84"></a><span id="l8.84"> </span>
<a href="#l8.85"></a><span id="l8.85">     let isItemSupported;</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-    if (cal.isToDo(calendarItem)) {</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+    if (cal.item.isToDo(calendarItem)) {</span>
<a href="#l8.88"></a><span id="l8.88">         isItemSupported = function(aCalendar) {</span>
<a href="#l8.89"></a><span id="l8.89">             return (aCalendar.getProperty(&quot;capabilities.tasks.supported&quot;) !== false);</span>
<a href="#l8.90"></a><span id="l8.90">         };</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-    } else if (cal.isEvent(calendarItem)) {</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+    } else if (cal.item.isEvent(calendarItem)) {</span>
<a href="#l8.93"></a><span id="l8.93">         isItemSupported = function(aCalendar) {</span>
<a href="#l8.94"></a><span id="l8.94">             return (aCalendar.getProperty(&quot;capabilities.events.supported&quot;) !== false);</span>
<a href="#l8.95"></a><span id="l8.95">         };</span>
<a href="#l8.96"></a><span id="l8.96">     }</span>
<a href="#l8.97"></a><span id="l8.97"> </span>
<a href="#l8.98"></a><span id="l8.98">     // Filter out calendars that don't support the given calendar item</span>
<a href="#l8.99"></a><span id="l8.99">     calendars = calendars.filter(isItemSupported);</span>
<a href="#l8.100"></a><span id="l8.100"> </span>
<a href="#l8.101"></a><span id="l8.101" class="difflineat">@@ -490,17 +490,17 @@ function openEventDialog(calendarItem, c</span>
<a href="#l8.102"></a><span id="l8.102">         args.inTab = false;</span>
<a href="#l8.103"></a><span id="l8.103">     }</span>
<a href="#l8.104"></a><span id="l8.104"> </span>
<a href="#l8.105"></a><span id="l8.105">     if (args.inTab) {</span>
<a href="#l8.106"></a><span id="l8.106">         // open in a tab, currently the read-only summary dialog is</span>
<a href="#l8.107"></a><span id="l8.107">         // never opened in a tab</span>
<a href="#l8.108"></a><span id="l8.108">         args.url = url;</span>
<a href="#l8.109"></a><span id="l8.109">         let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-        let tabtype = cal.isEvent(args.calendarEvent) ? &quot;calendarEvent&quot; : &quot;calendarTask&quot;;</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineplus">+        let tabtype = cal.item.isEvent(args.calendarEvent) ? &quot;calendarEvent&quot; : &quot;calendarTask&quot;;</span>
<a href="#l8.112"></a><span id="l8.112">         tabmail.openTab(tabtype, args);</span>
<a href="#l8.113"></a><span id="l8.113">     } else {</span>
<a href="#l8.114"></a><span id="l8.114">         // open in a window</span>
<a href="#l8.115"></a><span id="l8.115"> </span>
<a href="#l8.116"></a><span id="l8.116">         // reminder: event dialog should not be modal (cf bug 122671)</span>
<a href="#l8.117"></a><span id="l8.117">         let features;</span>
<a href="#l8.118"></a><span id="l8.118">         // keyword &quot;dependent&quot; should not be used (cf bug 752206)</span>
<a href="#l8.119"></a><span id="l8.119">         if (Services.appinfo.OS == &quot;WINNT&quot;) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -75,17 +75,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">       &lt;property name=&quot;occurrence&quot;&gt;</span>
<a href="#l9.6"></a><span id="l9.6">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l9.7"></a><span id="l9.7">             return this.mOccurrence;</span>
<a href="#l9.8"></a><span id="l9.8">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l9.9"></a><span id="l9.9">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l9.10"></a><span id="l9.10">             cal.ASSERT(!this.mOccurrence, &quot;Code changes needed to set the occurrence twice&quot;, true);</span>
<a href="#l9.11"></a><span id="l9.11">             this.mOccurrence = val;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-            if (cal.isEvent(val)) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+            if (cal.item.isEvent(val)) {</span>
<a href="#l9.14"></a><span id="l9.14">                 if (!val.startDate.isDate) {</span>
<a href="#l9.15"></a><span id="l9.15">                     let label = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item-label&quot;);</span>
<a href="#l9.16"></a><span id="l9.16">                     let formatter = Components.classes[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l9.17"></a><span id="l9.17">                                               .getService(Components.interfaces.calIDateTimeFormatter);</span>
<a href="#l9.18"></a><span id="l9.18">                     let timezone = this.calendarView ? this.calendarView.mTimezone</span>
<a href="#l9.19"></a><span id="l9.19">                                                      : cal.dtz.defaultTimezone;</span>
<a href="#l9.20"></a><span id="l9.20">                     let parentDate = cal.dtz.ensureDateTime(this.parentBox.date);</span>
<a href="#l9.21"></a><span id="l9.21">                     let startTime = val.startDate.getInTimezone(timezone);</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -303,17 +303,17 @@</span>
<a href="#l9.23"></a><span id="l9.23">                 start.isDate = true;</span>
<a href="#l9.24"></a><span id="l9.24">                 startInDefaultTz.isDate = true;</span>
<a href="#l9.25"></a><span id="l9.25">                 startInDefaultTz.timezone = start.timezone;</span>
<a href="#l9.26"></a><span id="l9.26">                 let dayDiff = start.subtractDate(startInDefaultTz);</span>
<a href="#l9.27"></a><span id="l9.27">                 // Change the day where to drop the item.</span>
<a href="#l9.28"></a><span id="l9.28">                 dayboxDate.addDuration(dayDiff);</span>
<a href="#l9.29"></a><span id="l9.29">             }</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-            return cal.moveItem(aItem, dayboxDate);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+            return cal.item.moveToDate(aItem, dayboxDate);</span>
<a href="#l9.33"></a><span id="l9.33">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.34"></a><span id="l9.34">       &lt;/method&gt;</span>
<a href="#l9.35"></a><span id="l9.35">     &lt;/implementation&gt;</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">     &lt;handlers&gt;</span>
<a href="#l9.38"></a><span id="l9.38">       &lt;handler event=&quot;mousedown&quot;&gt;&lt;![CDATA[</span>
<a href="#l9.39"></a><span id="l9.39">           event.stopPropagation();</span>
<a href="#l9.40"></a><span id="l9.40">           if (this.mDate) {</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -951,20 +951,20 @@</span>
<a href="#l9.42"></a><span id="l9.42">       &lt;method name=&quot;findDayBoxesForItem&quot;&gt;</span>
<a href="#l9.43"></a><span id="l9.43">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l9.44"></a><span id="l9.44">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.45"></a><span id="l9.45">             let targetDate = null;</span>
<a href="#l9.46"></a><span id="l9.46">             let finishDate = null;</span>
<a href="#l9.47"></a><span id="l9.47">             let boxes = [];</span>
<a href="#l9.48"></a><span id="l9.48"> </span>
<a href="#l9.49"></a><span id="l9.49">             // All our boxes are in default tz, so we need these times in them too.</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-            if (cal.isEvent(aItem)) {</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+            if (cal.item.isEvent(aItem)) {</span>
<a href="#l9.52"></a><span id="l9.52">                 targetDate = aItem.startDate.getInTimezone(this.mTimezone);</span>
<a href="#l9.53"></a><span id="l9.53">                 finishDate = aItem.endDate.getInTimezone(this.mTimezone);</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-            } else if (cal.isToDo(aItem)) {</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+            } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l9.56"></a><span id="l9.56">                 // Consider tasks without entry OR due date.</span>
<a href="#l9.57"></a><span id="l9.57">                 if (aItem.entryDate || aItem.dueDate) {</span>
<a href="#l9.58"></a><span id="l9.58">                     targetDate = (aItem.entryDate || aItem.dueDate).getInTimezone(this.mTimezone);</span>
<a href="#l9.59"></a><span id="l9.59">                     finishDate = (aItem.dueDate || aItem.entryDate).getInTimezone(this.mTimezone);</span>
<a href="#l9.60"></a><span id="l9.60">                 }</span>
<a href="#l9.61"></a><span id="l9.61">             }</span>
<a href="#l9.62"></a><span id="l9.62"> </span>
<a href="#l9.63"></a><span id="l9.63">             if (!targetDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1962,17 +1962,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">             let jsTime = new Date();</span>
<a href="#l10.5"></a><span id="l10.5">             jsTime.setHours(starthr, startmin);</span>
<a href="#l10.6"></a><span id="l10.6">             let startstr = timeFormatter.formatTime(cal.dtz.jsDateToDateTime(jsTime, cal.dtz.floating));</span>
<a href="#l10.7"></a><span id="l10.7">             jsTime.setHours(endhr, endmin);</span>
<a href="#l10.8"></a><span id="l10.8">             let endstr = timeFormatter.formatTime(cal.dtz.jsDateToDateTime(jsTime, cal.dtz.floating));</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">             // Tasks without Entry or Due date have a string as first label</span>
<a href="#l10.11"></a><span id="l10.11">             // instead of the time.</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-            if (cal.isToDo(this.mDragState.dragOccurrence)) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+            if (cal.item.isToDo(this.mDragState.dragOccurrence)) {</span>
<a href="#l10.14"></a><span id="l10.14">                 if (!this.mDragState.dragOccurrence.dueDate) {</span>
<a href="#l10.15"></a><span id="l10.15">                     startstr = cal.calGetString(&quot;calendar&quot;, &quot;dragLabelTasksWithOnlyEntryDate&quot;);</span>
<a href="#l10.16"></a><span id="l10.16">                 } else if (!this.mDragState.dragOccurrence.entryDate) {</span>
<a href="#l10.17"></a><span id="l10.17">                     startstr = cal.calGetString(&quot;calendar&quot;, &quot;dragLabelTasksWithOnlyDueDate&quot;);</span>
<a href="#l10.18"></a><span id="l10.18">                 }</span>
<a href="#l10.19"></a><span id="l10.19">             }</span>
<a href="#l10.20"></a><span id="l10.20">             firstColumn.fgboxes.startlabel.setAttribute(&quot;value&quot;, startstr);</span>
<a href="#l10.21"></a><span id="l10.21">             lastColumn.fgboxes.endlabel.setAttribute(&quot;value&quot;, endstr);</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -2168,18 +2168,18 @@</span>
<a href="#l10.23"></a><span id="l10.23">                 }</span>
<a href="#l10.24"></a><span id="l10.24">             }</span>
<a href="#l10.25"></a><span id="l10.25">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.26"></a><span id="l10.26">       &lt;/method&gt;</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">       &lt;method name=&quot;onDropItem&quot;&gt;</span>
<a href="#l10.29"></a><span id="l10.29">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l10.30"></a><span id="l10.30">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-            let newItem = cal.moveItem(aItem, this.mDate);</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-            newItem = cal.setItemToAllDay(newItem, true);</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+            let newItem = cal.item.moveToDate(aItem, this.mDate);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+            newItem = cal.item.setToAllDay(newItem, true);</span>
<a href="#l10.35"></a><span id="l10.35">             return newItem;</span>
<a href="#l10.36"></a><span id="l10.36">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.37"></a><span id="l10.37">       &lt;/method&gt;</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39">       &lt;method name=&quot;selectOccurrence&quot;&gt;</span>
<a href="#l10.40"></a><span id="l10.40">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l10.41"></a><span id="l10.41">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.42"></a><span id="l10.42">             for (let itemBox of this.mItemBoxes) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -219,17 +219,17 @@ function contextPostponeTask(aEvent, aDu</span>
<a href="#l11.4"></a><span id="l11.4">         postponeTask(aDuration);</span>
<a href="#l11.5"></a><span id="l11.5">     } else {</span>
<a href="#l11.6"></a><span id="l11.6">         startBatchTransaction();</span>
<a href="#l11.7"></a><span id="l11.7">         let tasks = getSelectedTasks(aEvent);</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">         tasks.forEach((task) =&gt; {</span>
<a href="#l11.10"></a><span id="l11.10">             if (task.entryDate || task.dueDate) {</span>
<a href="#l11.11"></a><span id="l11.11">                 let newTask = task.clone();</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-                cal.shiftItem(newTask, duration);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+                cal.item.shiftOffset(newTask, duration);</span>
<a href="#l11.14"></a><span id="l11.14">                 doTransaction(&quot;modify&quot;, newTask, newTask.calendar, task, null);</span>
<a href="#l11.15"></a><span id="l11.15">             }</span>
<a href="#l11.16"></a><span id="l11.16">         });</span>
<a href="#l11.17"></a><span id="l11.17"> </span>
<a href="#l11.18"></a><span id="l11.18">         endBatchTransaction();</span>
<a href="#l11.19"></a><span id="l11.19">     }</span>
<a href="#l11.20"></a><span id="l11.20"> }</span>
<a href="#l11.21"></a><span id="l11.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -509,17 +509,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">             getRowProperties: function(aRow) {</span>
<a href="#l12.5"></a><span id="l12.5">                 let properties = [];</span>
<a href="#l12.6"></a><span id="l12.6">                 let item = this.binding.mTaskArray[aRow];</span>
<a href="#l12.7"></a><span id="l12.7">                 if (item.priority &gt; 0 &amp;&amp; item.priority &lt; 5) {</span>
<a href="#l12.8"></a><span id="l12.8">                     properties.push(&quot;highpriority&quot;);</span>
<a href="#l12.9"></a><span id="l12.9">                 } else if (item.priority &gt; 5 &amp;&amp; item.priority &lt; 10) {</span>
<a href="#l12.10"></a><span id="l12.10">                     properties.push(&quot;lowpriority&quot;);</span>
<a href="#l12.11"></a><span id="l12.11">                 }</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-                properties.push(cal.getProgressAtom(item));</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                properties.push(cal.item.getProgressAtom(item));</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">                 // Add calendar name and id atom</span>
<a href="#l12.16"></a><span id="l12.16">                 properties.push(&quot;calendar-&quot; + cal.formatStringForCSSRule(item.calendar.name));</span>
<a href="#l12.17"></a><span id="l12.17">                 properties.push(&quot;calendarid-&quot; + cal.formatStringForCSSRule(item.calendar.id));</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19">                 // Add item status atom</span>
<a href="#l12.20"></a><span id="l12.20">                 if (item.status) {</span>
<a href="#l12.21"></a><span id="l12.21">                     properties.push(&quot;status-&quot; + item.status.toLowerCase());</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -818,35 +818,35 @@</span>
<a href="#l12.23"></a><span id="l12.23">             onEndBatch: function() {</span>
<a href="#l12.24"></a><span id="l12.24">             },</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">             onLoad: function() {</span>
<a href="#l12.27"></a><span id="l12.27">                 this.binding.refresh();</span>
<a href="#l12.28"></a><span id="l12.28">             },</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30">             onAddItem: function(aItem) {</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-                if (cal.isToDo(aItem)) {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+                if (cal.item.isToDo(aItem)) {</span>
<a href="#l12.33"></a><span id="l12.33">                     this.binding.mTreeView.addItems(this.binding.mFilter.getOccurrences(aItem));</span>
<a href="#l12.34"></a><span id="l12.34">                 }</span>
<a href="#l12.35"></a><span id="l12.35">             },</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37">             onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-                if (cal.isToDo(aNewItem) || cal.isToDo(aOldItem)) {</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+                if (cal.item.isToDo(aNewItem) || cal.item.isToDo(aOldItem)) {</span>
<a href="#l12.40"></a><span id="l12.40">                     this.binding.mTreeView.modifyItems(this.binding.mFilter.getOccurrences(aNewItem),</span>
<a href="#l12.41"></a><span id="l12.41">                                                        this.binding.mFilter.getOccurrences(aOldItem));</span>
<a href="#l12.42"></a><span id="l12.42"> </span>
<a href="#l12.43"></a><span id="l12.43">                     // we also need to notify potential listeners.</span>
<a href="#l12.44"></a><span id="l12.44">                     let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l12.45"></a><span id="l12.45">                     event.initEvent(&quot;select&quot;, true, false);</span>
<a href="#l12.46"></a><span id="l12.46">                     this.binding.dispatchEvent(event);</span>
<a href="#l12.47"></a><span id="l12.47">                 }</span>
<a href="#l12.48"></a><span id="l12.48">             },</span>
<a href="#l12.49"></a><span id="l12.49"> </span>
<a href="#l12.50"></a><span id="l12.50">             onDeleteItem: function(aDeletedItem) {</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-                if (cal.isToDo(aDeletedItem)) {</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+                if (cal.item.isToDo(aDeletedItem)) {</span>
<a href="#l12.53"></a><span id="l12.53">                     this.binding.mTreeView.removeItems(this.binding.mFilter.getOccurrences(aDeletedItem));</span>
<a href="#l12.54"></a><span id="l12.54">                 }</span>
<a href="#l12.55"></a><span id="l12.55">             },</span>
<a href="#l12.56"></a><span id="l12.56"> </span>
<a href="#l12.57"></a><span id="l12.57">             onError: function(aCalendar, aErrNo, aMessage) {},</span>
<a href="#l12.58"></a><span id="l12.58">             onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l12.59"></a><span id="l12.59">                 switch (aName) {</span>
<a href="#l12.60"></a><span id="l12.60">                     case &quot;disabled&quot;:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -290,17 +290,17 @@ function appendCalendarItems(aItem, aCal</span>
<a href="#l13.4"></a><span id="l13.4">     let index = -1;</span>
<a href="#l13.5"></a><span id="l13.5">     for (let i = 0; i &lt; calendars.length; ++i) {</span>
<a href="#l13.6"></a><span id="l13.6">         let calendar = calendars[i];</span>
<a href="#l13.7"></a><span id="l13.7">         if (calendar.id == calendarToUse.id ||</span>
<a href="#l13.8"></a><span id="l13.8">             (calendar &amp;&amp;</span>
<a href="#l13.9"></a><span id="l13.9">              cal.acl.isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l13.10"></a><span id="l13.10">              (cal.acl.userCanAddItemsToCalendar(calendar) ||</span>
<a href="#l13.11"></a><span id="l13.11">               (calendar == aItem.calendar &amp;&amp; cal.acl.userCanModifyItem(aItem))) &amp;&amp;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-             cal.isItemSupported(aItem, calendar))) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+             cal.item.isItemSupported(aItem, calendar))) {</span>
<a href="#l13.14"></a><span id="l13.14">             let menuitem = addMenuItem(aCalendarMenuParent, calendar.name, calendar.name);</span>
<a href="#l13.15"></a><span id="l13.15">             menuitem.calendar = calendar;</span>
<a href="#l13.16"></a><span id="l13.16">             index++;</span>
<a href="#l13.17"></a><span id="l13.17">             if (aOnCommand) {</span>
<a href="#l13.18"></a><span id="l13.18">                 menuitem.setAttribute(&quot;oncommand&quot;, aOnCommand);</span>
<a href="#l13.19"></a><span id="l13.19">             }</span>
<a href="#l13.20"></a><span id="l13.20">             if (aCalendarMenuParent.localName == &quot;menupopup&quot;) {</span>
<a href="#l13.21"></a><span id="l13.21">                 menuitem.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -77,31 +77,31 @@ var unifinderObserver = {</span>
<a href="#l14.4"></a><span id="l14.4">             // those operations and refresh as soon as the unifinder is shown</span>
<a href="#l14.5"></a><span id="l14.5">             // again.</span>
<a href="#l14.6"></a><span id="l14.6">             gUnifinderNeedsRefresh = true;</span>
<a href="#l14.7"></a><span id="l14.7">             unifinderTreeView.clearItems();</span>
<a href="#l14.8"></a><span id="l14.8">         }</span>
<a href="#l14.9"></a><span id="l14.9">     },</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11">     onAddItem: function(aItem) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        if (cal.isEvent(aItem) &amp;&amp;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+        if (cal.item.isEvent(aItem) &amp;&amp;</span>
<a href="#l14.14"></a><span id="l14.14">             !gUnifinderNeedsRefresh &amp;&amp;</span>
<a href="#l14.15"></a><span id="l14.15">             unifinderTreeView.mFilter.isItemInFilters(aItem)</span>
<a href="#l14.16"></a><span id="l14.16">             ) {</span>
<a href="#l14.17"></a><span id="l14.17">             this.addItemToTree(aItem);</span>
<a href="#l14.18"></a><span id="l14.18">         }</span>
<a href="#l14.19"></a><span id="l14.19">     },</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">     onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l14.22"></a><span id="l14.22">         this.onDeleteItem(aOldItem);</span>
<a href="#l14.23"></a><span id="l14.23">         this.onAddItem(aNewItem);</span>
<a href="#l14.24"></a><span id="l14.24">     },</span>
<a href="#l14.25"></a><span id="l14.25"> </span>
<a href="#l14.26"></a><span id="l14.26">     onDeleteItem: function(aDeletedItem) {</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-        if (cal.isEvent(aDeletedItem) &amp;&amp; !gUnifinderNeedsRefresh) {</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+        if (cal.item.isEvent(aDeletedItem) &amp;&amp; !gUnifinderNeedsRefresh) {</span>
<a href="#l14.29"></a><span id="l14.29">             this.removeItemFromTree(aDeletedItem);</span>
<a href="#l14.30"></a><span id="l14.30">         }</span>
<a href="#l14.31"></a><span id="l14.31">     },</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33">     onError: function(aCalendar, aErrNo, aMessage) {},</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35">     onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l14.36"></a><span id="l14.36">         switch (aName) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -182,24 +182,24 @@</span>
<a href="#l15.4"></a><span id="l15.4">                 classificationBox.setAttribute(&quot;classification&quot;, item.privacy || &quot;PUBLIC&quot;);</span>
<a href="#l15.5"></a><span id="l15.5">             }</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7">             // Set up event box attributes for use in css selectors. Note if</span>
<a href="#l15.8"></a><span id="l15.8">             // something is added here, it should also be xbl:inherited correctly</span>
<a href="#l15.9"></a><span id="l15.9">             // in the &lt;content&gt; section of this binding, and all that inherit it.</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">             // Event type specific properties</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-            if (cal.isEvent(item)) {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+            if (cal.item.isEvent(item)) {</span>
<a href="#l15.14"></a><span id="l15.14">                 if (item.startDate.isDate) {</span>
<a href="#l15.15"></a><span id="l15.15">                     this.setAttribute(&quot;allday&quot;, &quot;true&quot;);</span>
<a href="#l15.16"></a><span id="l15.16">                 }</span>
<a href="#l15.17"></a><span id="l15.17">                 this.setAttribute(&quot;itemType&quot;, &quot;event&quot;);</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-            } else if (cal.isToDo(item)) {</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+            } else if (cal.item.isToDo(item)) {</span>
<a href="#l15.20"></a><span id="l15.20">                 // progress attribute</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-                this.setAttribute(&quot;progress&quot;, cal.getProgressAtom(item));</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+                this.setAttribute(&quot;progress&quot;, cal.item.getProgressAtom(item));</span>
<a href="#l15.23"></a><span id="l15.23">                 // Attribute for tasks and tasks image.</span>
<a href="#l15.24"></a><span id="l15.24">                 this.setAttribute(&quot;itemType&quot;, &quot;todo&quot;);</span>
<a href="#l15.25"></a><span id="l15.25">                 if (item.entryDate &amp;&amp; !item.dueDate) {</span>
<a href="#l15.26"></a><span id="l15.26">                     this.setAttribute(&quot;todoType&quot;, &quot;start&quot;);</span>
<a href="#l15.27"></a><span id="l15.27">                 } else if (!item.entryDate &amp;&amp; item.dueDate) {</span>
<a href="#l15.28"></a><span id="l15.28">                     this.setAttribute(&quot;todoType&quot;, &quot;end&quot;);</span>
<a href="#l15.29"></a><span id="l15.29">                 }</span>
<a href="#l15.30"></a><span id="l15.30">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -62,17 +62,17 @@ var calendarViewController = {</span>
<a href="#l16.4"></a><span id="l16.4">             // When we made the executive decision (in bug 352862) that</span>
<a href="#l16.5"></a><span id="l16.5">             // dragging an occurrence of a recurring event would _only_ act</span>
<a href="#l16.6"></a><span id="l16.6">             // upon _that_ occurrence, we removed a bunch of code from this</span>
<a href="#l16.7"></a><span id="l16.7">             // function. If we ever revert that decision, check CVS history</span>
<a href="#l16.8"></a><span id="l16.8">             // here to get that code back.</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">             if (aNewStartTime || aNewEndTime) {</span>
<a href="#l16.11"></a><span id="l16.11">                 // Yay for variable names that make this next line look silly</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-                if (cal.isEvent(instance)) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+                if (cal.item.isEvent(instance)) {</span>
<a href="#l16.14"></a><span id="l16.14">                     if (aNewStartTime &amp;&amp; instance.startDate) {</span>
<a href="#l16.15"></a><span id="l16.15">                         instance.startDate = aNewStartTime;</span>
<a href="#l16.16"></a><span id="l16.16">                     }</span>
<a href="#l16.17"></a><span id="l16.17">                     if (aNewEndTime &amp;&amp; instance.endDate) {</span>
<a href="#l16.18"></a><span id="l16.18">                         instance.endDate = aNewEndTime;</span>
<a href="#l16.19"></a><span id="l16.19">                     }</span>
<a href="#l16.20"></a><span id="l16.20">                 } else {</span>
<a href="#l16.21"></a><span id="l16.21">                     if (aNewStartTime &amp;&amp; instance.entryDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -453,17 +453,17 @@ function commonUpdateReminder(aSuppressD</span>
<a href="#l17.4"></a><span id="l17.4">     reminderList.setAttribute(&quot;last-value&quot;, reminderList.value);</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6">     // possibly the selected reminder conflicts with the item.</span>
<a href="#l17.7"></a><span id="l17.7">     // for example an end-relation combined with a task without duedate</span>
<a href="#l17.8"></a><span id="l17.8">     // is an invalid state we need to take care of. we take the same</span>
<a href="#l17.9"></a><span id="l17.9">     // approach as with recurring tasks. in case the reminder is related</span>
<a href="#l17.10"></a><span id="l17.10">     // to the entry date we check the entry date automatically and disable</span>
<a href="#l17.11"></a><span id="l17.11">     // the checkbox. the same goes for end related reminder and the due date.</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    if (cal.isToDo(window.calendarItem)) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    if (cal.item.isToDo(window.calendarItem)) {</span>
<a href="#l17.14"></a><span id="l17.14">         // In general, (re-)enable the due/entry checkboxes. This will be</span>
<a href="#l17.15"></a><span id="l17.15">         // changed in case the alarms are related to START/END below.</span>
<a href="#l17.16"></a><span id="l17.16">         enableElementWithLock(&quot;todo-has-duedate&quot;, &quot;reminder-lock&quot;);</span>
<a href="#l17.17"></a><span id="l17.17">         enableElementWithLock(&quot;todo-has-entrydate&quot;, &quot;reminder-lock&quot;);</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19">         let menuitem = reminderList.selectedItem;</span>
<a href="#l17.20"></a><span id="l17.20">         if (menuitem.value != &quot;none&quot;) {</span>
<a href="#l17.21"></a><span id="l17.21">             // In case a reminder is selected, retrieve the array of alarms from</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -463,17 +463,17 @@ function onChangeCalendar(calendar) {</span>
<a href="#l18.4"></a><span id="l18.4">  *</span>
<a href="#l18.5"></a><span id="l18.5">  * @param item        The item to check.</span>
<a href="#l18.6"></a><span id="l18.6">  */</span>
<a href="#l18.7"></a><span id="l18.7"> function disableOrEnable(item) {</span>
<a href="#l18.8"></a><span id="l18.8">     if (item.parentItem != item) {</span>
<a href="#l18.9"></a><span id="l18.9">         disableRecurrenceFields(&quot;disable-on-occurrence&quot;);</span>
<a href="#l18.10"></a><span id="l18.10">     } else if (gIsReadOnly) {</span>
<a href="#l18.11"></a><span id="l18.11">         disableRecurrenceFields(&quot;disable-on-readonly&quot;);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    } else if (cal.isToDo(item) &amp;&amp; !gStartTime) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    } else if (cal.item.isToDo(item) &amp;&amp; !gStartTime) {</span>
<a href="#l18.14"></a><span id="l18.14">         disableRecurrenceFields(&quot;disable-on-readonly&quot;);</span>
<a href="#l18.15"></a><span id="l18.15">     } else {</span>
<a href="#l18.16"></a><span id="l18.16">         enableRecurrenceFields(&quot;disable-on-readonly&quot;);</span>
<a href="#l18.17"></a><span id="l18.17">     }</span>
<a href="#l18.18"></a><span id="l18.18"> }</span>
<a href="#l18.19"></a><span id="l18.19"> </span>
<a href="#l18.20"></a><span id="l18.20"> /**</span>
<a href="#l18.21"></a><span id="l18.21">  * Disables all fields that have an attribute that matches the argument and is</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -591,27 +591,27 @@ function updatePreview() {</span>
<a href="#l18.23"></a><span id="l18.23">     }</span>
<a href="#l18.24"></a><span id="l18.24"> </span>
<a href="#l18.25"></a><span id="l18.25">     // TODO: We should better start the whole dialog with a newly cloned item</span>
<a href="#l18.26"></a><span id="l18.26">     // and always pump changes immediately into it. This would eliminate the</span>
<a href="#l18.27"></a><span id="l18.27">     // need to break the encapsulation, as we do it here. But we need the item</span>
<a href="#l18.28"></a><span id="l18.28">     // to contain the startdate in order to calculate the recurrence preview.</span>
<a href="#l18.29"></a><span id="l18.29">     item = item.clone();</span>
<a href="#l18.30"></a><span id="l18.30">     let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    if (cal.isEvent(item)) {</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    if (cal.item.isEvent(item)) {</span>
<a href="#l18.33"></a><span id="l18.33">         let startDate = gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l18.34"></a><span id="l18.34">         let endDate = gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l18.35"></a><span id="l18.35">         if (startDate.isDate) {</span>
<a href="#l18.36"></a><span id="l18.36">             endDate.day--;</span>
<a href="#l18.37"></a><span id="l18.37">         }</span>
<a href="#l18.38"></a><span id="l18.38"> </span>
<a href="#l18.39"></a><span id="l18.39">         item.startDate = startDate;</span>
<a href="#l18.40"></a><span id="l18.40">         item.endDate = endDate;</span>
<a href="#l18.41"></a><span id="l18.41">     }</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-    if (cal.isToDo(item)) {</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+    if (cal.item.isToDo(item)) {</span>
<a href="#l18.44"></a><span id="l18.44">         let entryDate = gStartTime;</span>
<a href="#l18.45"></a><span id="l18.45">         if (entryDate) {</span>
<a href="#l18.46"></a><span id="l18.46">             entryDate = entryDate.getInTimezone(kDefaultTimezone);</span>
<a href="#l18.47"></a><span id="l18.47">         } else {</span>
<a href="#l18.48"></a><span id="l18.48">             item.recurrenceInfo = null;</span>
<a href="#l18.49"></a><span id="l18.49">         }</span>
<a href="#l18.50"></a><span id="l18.50">         item.entryDate = entryDate;</span>
<a href="#l18.51"></a><span id="l18.51">         let dueDate = gEndTime;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -348,29 +348,29 @@ function updateReminder(event) {</span>
<a href="#l19.4"></a><span id="l19.4"> /**</span>
<a href="#l19.5"></a><span id="l19.5">  * Gets the locale stringname that is dependant on the item type. This function</span>
<a href="#l19.6"></a><span id="l19.6">  * appends the item type, i.e |aPrefix + &quot;Event&quot;|.</span>
<a href="#l19.7"></a><span id="l19.7">  *</span>
<a href="#l19.8"></a><span id="l19.8">  * @param aPrefix       The prefix to prepend to the item type</span>
<a href="#l19.9"></a><span id="l19.9">  * @return              The full string name.</span>
<a href="#l19.10"></a><span id="l19.10">  */</span>
<a href="#l19.11"></a><span id="l19.11"> function getItemBundleStringName(aPrefix) {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    if (cal.isEvent(window.arguments[0].item)) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    if (cal.item.isEvent(window.arguments[0].item)) {</span>
<a href="#l19.14"></a><span id="l19.14">         return aPrefix + &quot;Event&quot;;</span>
<a href="#l19.15"></a><span id="l19.15">     } else {</span>
<a href="#l19.16"></a><span id="l19.16">         return aPrefix + &quot;Task&quot;;</span>
<a href="#l19.17"></a><span id="l19.17">     }</span>
<a href="#l19.18"></a><span id="l19.18"> }</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20"> /**</span>
<a href="#l19.21"></a><span id="l19.21">  * Handler function to be called when the &quot;new&quot; button is pressed, to create a</span>
<a href="#l19.22"></a><span id="l19.22">  * new reminder item.</span>
<a href="#l19.23"></a><span id="l19.23">  */</span>
<a href="#l19.24"></a><span id="l19.24"> function onNewReminder() {</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineminus">-    let itemType = (cal.isEvent(window.arguments[0].item) ? &quot;event&quot; : &quot;todo&quot;);</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+    let itemType = (cal.item.isEvent(window.arguments[0].item) ? &quot;event&quot; : &quot;todo&quot;);</span>
<a href="#l19.27"></a><span id="l19.27">     let listbox = document.getElementById(&quot;reminder-listbox&quot;);</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29">     let reminder = cal.createAlarm();</span>
<a href="#l19.30"></a><span id="l19.30">     let alarmlen = Preferences.get(&quot;calendar.alarms.&quot; + itemType + &quot;alarmlen&quot;, 15);</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32">     // Default is a relative DISPLAY alarm, |alarmlen| minutes before the event.</span>
<a href="#l19.33"></a><span id="l19.33">     // If DISPLAY is not supported by the provider, then pick the provider's</span>
<a href="#l19.34"></a><span id="l19.34">     // first alarm type.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-occurrence-prompt.xul</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-occurrence-prompt.xul</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -27,17 +27,17 @@</span>
<a href="#l20.4"></a><span id="l20.4">     }</span>
<a href="#l20.5"></a><span id="l20.5"> </span>
<a href="#l20.6"></a><span id="l20.6">     function getDialogString(key) {</span>
<a href="#l20.7"></a><span id="l20.7">       return cal.calGetString(&quot;calendar-occurrence-prompt&quot;, key);</span>
<a href="#l20.8"></a><span id="l20.8">     }</span>
<a href="#l20.9"></a><span id="l20.9"> </span>
<a href="#l20.10"></a><span id="l20.10">     function onLoad() {</span>
<a href="#l20.11"></a><span id="l20.11">       var action = window.arguments[0].action || &quot;edit&quot;;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      var itemType = (cal.isEvent(window.arguments[0].item) ? &quot;event&quot; : &quot;task&quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      var itemType = (cal.item.isEvent(window.arguments[0].item) ? &quot;event&quot; : &quot;task&quot;);</span>
<a href="#l20.14"></a><span id="l20.14"> </span>
<a href="#l20.15"></a><span id="l20.15">       // Set up title</span>
<a href="#l20.16"></a><span id="l20.16">       document.title = getDialogString(&quot;windowtitle.&quot; + itemType + &quot;.&quot; + action);</span>
<a href="#l20.17"></a><span id="l20.17">       document.getElementById(&quot;title-label&quot;).value = window.arguments[0].item.title;</span>
<a href="#l20.18"></a><span id="l20.18"> </span>
<a href="#l20.19"></a><span id="l20.19">       // Set up header</span>
<a href="#l20.20"></a><span id="l20.20">       document.getElementById(&quot;isrepeating-label&quot;).value =</span>
<a href="#l20.21"></a><span id="l20.21">         getDialogString(&quot;header.isrepeating.&quot; + itemType + &quot;.label&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -92,20 +92,20 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l21.4"></a><span id="l21.4">             settings.end.day += 1;</span>
<a href="#l21.5"></a><span id="l21.5">             settings.start.isDate = false;</span>
<a href="#l21.6"></a><span id="l21.6">             settings.end.isDate = false;</span>
<a href="#l21.7"></a><span id="l21.7">             break;</span>
<a href="#l21.8"></a><span id="l21.8">         }</span>
<a href="#l21.9"></a><span id="l21.9">         case &quot;selected&quot;: {</span>
<a href="#l21.10"></a><span id="l21.10">             let selectedItems = theView.getSelectedItems({});</span>
<a href="#l21.11"></a><span id="l21.11">             settings.eventList = selectedItems.filter((item) =&gt; {</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-                if (cal.isEvent(item) &amp;&amp; !settings.printEvents) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+                if (cal.item.isEvent(item) &amp;&amp; !settings.printEvents) {</span>
<a href="#l21.14"></a><span id="l21.14">                     return false;</span>
<a href="#l21.15"></a><span id="l21.15">                 }</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-                if (cal.isToDo(item) &amp;&amp; !settings.printTasks) {</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+                if (cal.item.isToDo(item) &amp;&amp; !settings.printTasks) {</span>
<a href="#l21.18"></a><span id="l21.18">                     return false;</span>
<a href="#l21.19"></a><span id="l21.19">                 }</span>
<a href="#l21.20"></a><span id="l21.20">                 return true;</span>
<a href="#l21.21"></a><span id="l21.21">             });</span>
<a href="#l21.22"></a><span id="l21.22"> </span>
<a href="#l21.23"></a><span id="l21.23">             // If tasks should be printed, also include selected tasks from the</span>
<a href="#l21.24"></a><span id="l21.24">             // opening window.</span>
<a href="#l21.25"></a><span id="l21.25">             if (settings.printTasks) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-summary-dialog.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -38,19 +38,19 @@ function onLoad() {</span>
<a href="#l22.4"></a><span id="l22.4">             // ...and close the window.</span>
<a href="#l22.5"></a><span id="l22.5">             window.close();</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7">             return calendarItem;</span>
<a href="#l22.8"></a><span id="l22.8">         };</span>
<a href="#l22.9"></a><span id="l22.9">     }</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11">     // set the dialog-id to enable the right window-icon to be loaded.</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    if (cal.isEvent(item)) {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    if (cal.item.isEvent(item)) {</span>
<a href="#l22.14"></a><span id="l22.14">         setDialogId(document.documentElement, &quot;calendar-event-summary-dialog&quot;);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-    } else if (cal.isToDo(item)) {</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+    } else if (cal.item.isToDo(item)) {</span>
<a href="#l22.17"></a><span id="l22.17">         setDialogId(document.documentElement, &quot;calendar-task-summary-dialog&quot;);</span>
<a href="#l22.18"></a><span id="l22.18">     }</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">     window.attendees = item.getAttendees({});</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22">     let calendar = cal.wrapInstance(item.calendar, Components.interfaces.calISchedulingSupport);</span>
<a href="#l22.23"></a><span id="l22.23">     window.readOnly = !(cal.acl.isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l22.24"></a><span id="l22.24">                         (cal.acl.userCanModifyItem(item) ||</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineat">@@ -71,17 +71,17 @@ function onLoad() {</span>
<a href="#l22.26"></a><span id="l22.26">             // and add again. Also, this is needed if the attendee doesn't exist</span>
<a href="#l22.27"></a><span id="l22.27">             // (i.e REPLY on a mailing list)</span>
<a href="#l22.28"></a><span id="l22.28">             item.removeAttendee(attendee);</span>
<a href="#l22.29"></a><span id="l22.29">             item.addAttendee(window.attendee);</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31">             // make partstat NEEDS-ACTION only available as a option to change to,</span>
<a href="#l22.32"></a><span id="l22.32">             // if the user hasn't ever made a decision prior to opening the dialog</span>
<a href="#l22.33"></a><span id="l22.33">             let partStat = window.attendee.participationStatus || &quot;NEEDS-ACTION&quot;;</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">-            if (partStat == &quot;NEEDS-ACTION&quot; &amp;&amp; cal.isEvent(item)) {</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineplus">+            if (partStat == &quot;NEEDS-ACTION&quot; &amp;&amp; cal.item.isEvent(item)) {</span>
<a href="#l22.36"></a><span id="l22.36">                 document.getElementById(&quot;item-participation-needs-action&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l22.37"></a><span id="l22.37">             }</span>
<a href="#l22.38"></a><span id="l22.38">         }</span>
<a href="#l22.39"></a><span id="l22.39">     }</span>
<a href="#l22.40"></a><span id="l22.40"> </span>
<a href="#l22.41"></a><span id="l22.41">     document.getElementById(&quot;item-title&quot;).value = item.title;</span>
<a href="#l22.42"></a><span id="l22.42"> </span>
<a href="#l22.43"></a><span id="l22.43">     document.getElementById(&quot;item-start-row&quot;).Item = item;</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineat">@@ -145,17 +145,17 @@ function onLoad() {</span>
<a href="#l22.45"></a><span id="l22.45">     }</span>
<a href="#l22.46"></a><span id="l22.46"> </span>
<a href="#l22.47"></a><span id="l22.47">     let status = item.getProperty(&quot;STATUS&quot;);</span>
<a href="#l22.48"></a><span id="l22.48">     if (status &amp;&amp; status.length) {</span>
<a href="#l22.49"></a><span id="l22.49">         let statusRow = document.getElementById(&quot;status-row&quot;);</span>
<a href="#l22.50"></a><span id="l22.50">         for (let i = 0; i &lt; statusRow.childNodes.length; i++) {</span>
<a href="#l22.51"></a><span id="l22.51">             if (statusRow.childNodes[i].getAttribute(&quot;status&quot;) == status) {</span>
<a href="#l22.52"></a><span id="l22.52">                 statusRow.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-                if (status == &quot;CANCELLED&quot; &amp;&amp; cal.isToDo(item)) {</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineplus">+                if (status == &quot;CANCELLED&quot; &amp;&amp; cal.item.isToDo(item)) {</span>
<a href="#l22.55"></a><span id="l22.55">                     // There are two labels for CANCELLED, the second one is for</span>
<a href="#l22.56"></a><span id="l22.56">                     // todo items. Increment the counter here.</span>
<a href="#l22.57"></a><span id="l22.57">                     i++;</span>
<a href="#l22.58"></a><span id="l22.58">                 }</span>
<a href="#l22.59"></a><span id="l22.59">                 statusRow.childNodes[i].removeAttribute(&quot;hidden&quot;);</span>
<a href="#l22.60"></a><span id="l22.60">                 break;</span>
<a href="#l22.61"></a><span id="l22.61">             }</span>
<a href="#l22.62"></a><span id="l22.62">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -80,19 +80,19 @@</span>
<a href="#l23.4"></a><span id="l23.4">             }</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">             let formatter = cal.getDateFormatter();</span>
<a href="#l23.7"></a><span id="l23.7">             let titleLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alarm-title-label&quot;);</span>
<a href="#l23.8"></a><span id="l23.8">             let locationDescription = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alarm-location-description&quot;);</span>
<a href="#l23.9"></a><span id="l23.9">             let dateLabel = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alarm-date-label&quot;);</span>
<a href="#l23.10"></a><span id="l23.10"> </span>
<a href="#l23.11"></a><span id="l23.11">             // Dates</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-            if (cal.isEvent(this.mItem)) {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+            if (cal.item.isEvent(this.mItem)) {</span>
<a href="#l23.14"></a><span id="l23.14">                 dateLabel.textContent = formatter.formatItemInterval(this.mItem);</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-            } else if (cal.isToDo(this.mItem)) {</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+            } else if (cal.item.isToDo(this.mItem)) {</span>
<a href="#l23.17"></a><span id="l23.17">                 let startDate = this.mItem.entryDate || this.mItem.dueDate;</span>
<a href="#l23.18"></a><span id="l23.18">                 if (startDate) {</span>
<a href="#l23.19"></a><span id="l23.19">                     // A Task with a start or due date, show with label</span>
<a href="#l23.20"></a><span id="l23.20">                     startDate = startDate.getInTimezone(cal.dtz.defaultTimezone);</span>
<a href="#l23.21"></a><span id="l23.21">                     dateLabel.textContent = cal.calGetString(&quot;calendar&quot;,</span>
<a href="#l23.22"></a><span id="l23.22">                                                              &quot;alarmStarts&quot;,</span>
<a href="#l23.23"></a><span id="l23.23">                                                              [formatter.formatDateTime(startDate)]);</span>
<a href="#l23.24"></a><span id="l23.24">                 } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -686,17 +686,17 @@</span>
<a href="#l24.4"></a><span id="l24.4">               return;</span>
<a href="#l24.5"></a><span id="l24.5">           }</span>
<a href="#l24.6"></a><span id="l24.6">           let item = session.sourceNode.sourceObject.clone();</span>
<a href="#l24.7"></a><span id="l24.7">           this.setAttribute(&quot;dropbox&quot;, &quot;false&quot;);</span>
<a href="#l24.8"></a><span id="l24.8">           let transfer = Components.classes[&quot;@mozilla.org/widget/transferable;1&quot;]</span>
<a href="#l24.9"></a><span id="l24.9">                                    .createInstance(Components.interfaces.nsITransferable);</span>
<a href="#l24.10"></a><span id="l24.10">           transfer.init(null);</span>
<a href="#l24.11"></a><span id="l24.11"> </span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-          if (cal.isEvent(item)) {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+          if (cal.item.isEvent(item)) {</span>
<a href="#l24.14"></a><span id="l24.14">               transfer.addDataFlavor(&quot;application/x-moz-cal-event&quot;);</span>
<a href="#l24.15"></a><span id="l24.15">           } else {</span>
<a href="#l24.16"></a><span id="l24.16">               transfer.addDataFlavor(&quot;application/x-moz-cal-task&quot;);</span>
<a href="#l24.17"></a><span id="l24.17">           }</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19">           session.getData(transfer, 0);</span>
<a href="#l24.20"></a><span id="l24.20">           item = session.sourceNode.sourceObject;</span>
<a href="#l24.21"></a><span id="l24.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -10,17 +10,17 @@ cal.alarms = {</span>
<a href="#l25.4"></a><span id="l25.4">     /**</span>
<a href="#l25.5"></a><span id="l25.5">      * Read default alarm settings from user preferences and apply them to the</span>
<a href="#l25.6"></a><span id="l25.6">      * event/todo passed in. The item's calendar should be set to ensure the</span>
<a href="#l25.7"></a><span id="l25.7">      * correct alarm type is set.</span>
<a href="#l25.8"></a><span id="l25.8">      *</span>
<a href="#l25.9"></a><span id="l25.9">      * @param aItem     The item to apply the default alarm values to.</span>
<a href="#l25.10"></a><span id="l25.10">      */</span>
<a href="#l25.11"></a><span id="l25.11">     setDefaultValues: function(aItem) {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        let type = cal.isEvent(aItem) ? &quot;event&quot; : &quot;todo&quot;;</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+        let type = cal.item.isEvent(aItem) ? &quot;event&quot; : &quot;todo&quot;;</span>
<a href="#l25.14"></a><span id="l25.14">         if (Preferences.get(&quot;calendar.alarms.onfor&quot; + type + &quot;s&quot;, 0) == 1) {</span>
<a href="#l25.15"></a><span id="l25.15">             let alarmOffset = cal.createDuration();</span>
<a href="#l25.16"></a><span id="l25.16">             let alarm = cal.createAlarm();</span>
<a href="#l25.17"></a><span id="l25.17">             let units = Preferences.get(&quot;calendar.alarms.&quot; + type + &quot;alarmunit&quot;, &quot;minutes&quot;);</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19">             // Make sure the alarm pref is valid, default to minutes otherwise</span>
<a href="#l25.20"></a><span id="l25.20">             if (![&quot;weeks&quot;, &quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;, &quot;seconds&quot;].includes(units)) {</span>
<a href="#l25.21"></a><span id="l25.21">                 units = &quot;minutes&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/modules/calDateTimeUtils.jsm</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/modules/calDateTimeUtils.jsm</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -98,43 +98,43 @@ var caldtz = {</span>
<a href="#l26.4"></a><span id="l26.4">      *</span>
<a href="#l26.5"></a><span id="l26.5">      * @param aItem             The item to set up the start and end date for.</span>
<a href="#l26.6"></a><span id="l26.6">      * @param aReferenceDate    If passed, the time of this date will be modified,</span>
<a href="#l26.7"></a><span id="l26.7">      *                            keeping the date and timezone intact.</span>
<a href="#l26.8"></a><span id="l26.8">      */</span>
<a href="#l26.9"></a><span id="l26.9">     setDefaultStartEndHour: function(aItem, aReferenceDate) {</span>
<a href="#l26.10"></a><span id="l26.10">         aItem[caldtz.startDateProp(aItem)] = caldtz.getDefaultStartDate(aReferenceDate);</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-        if (cal.isEvent(aItem)) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+        if (cal.item.isEvent(aItem)) {</span>
<a href="#l26.14"></a><span id="l26.14">             aItem.endDate = aItem.startDate.clone();</span>
<a href="#l26.15"></a><span id="l26.15">             aItem.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l26.16"></a><span id="l26.16">         }</span>
<a href="#l26.17"></a><span id="l26.17">     },</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19">     /**</span>
<a href="#l26.20"></a><span id="l26.20">      * Returns the property name used for the start date of an item, ie either an</span>
<a href="#l26.21"></a><span id="l26.21">      * event's start date or a task's entry date.</span>
<a href="#l26.22"></a><span id="l26.22">      */</span>
<a href="#l26.23"></a><span id="l26.23">     startDateProp: function(aItem) {</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineminus">-        if (cal.isEvent(aItem)) {</span>
<a href="#l26.25"></a><span id="l26.25" class="difflineplus">+        if (cal.item.isEvent(aItem)) {</span>
<a href="#l26.26"></a><span id="l26.26">             return &quot;startDate&quot;;</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">-        } else if (cal.isToDo(aItem)) {</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineplus">+        } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l26.29"></a><span id="l26.29">             return &quot;entryDate&quot;;</span>
<a href="#l26.30"></a><span id="l26.30">         }</span>
<a href="#l26.31"></a><span id="l26.31">         throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l26.32"></a><span id="l26.32">     },</span>
<a href="#l26.33"></a><span id="l26.33"> </span>
<a href="#l26.34"></a><span id="l26.34">     /**</span>
<a href="#l26.35"></a><span id="l26.35">      * Returns the property name used for the end date of an item, ie either an</span>
<a href="#l26.36"></a><span id="l26.36">      * event's end date or a task's due date.</span>
<a href="#l26.37"></a><span id="l26.37">      */</span>
<a href="#l26.38"></a><span id="l26.38">     endDateProp: function(aItem) {</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineminus">-        if (cal.isEvent(aItem)) {</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineplus">+        if (cal.item.isEvent(aItem)) {</span>
<a href="#l26.41"></a><span id="l26.41">             return &quot;endDate&quot;;</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-        } else if (cal.isToDo(aItem)) {</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+        } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l26.44"></a><span id="l26.44">             return &quot;dueDate&quot;;</span>
<a href="#l26.45"></a><span id="l26.45">         }</span>
<a href="#l26.46"></a><span id="l26.46">         throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l26.47"></a><span id="l26.47">     },</span>
<a href="#l26.48"></a><span id="l26.48"> </span>
<a href="#l26.49"></a><span id="l26.49">     /**</span>
<a href="#l26.50"></a><span id="l26.50">      * Check if the two dates are on the same day (ignoring time)</span>
<a href="#l26.51"></a><span id="l26.51">      *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -665,17 +665,17 @@ cal.itip = {</span>
<a href="#l27.4"></a><span id="l27.4">                         })) {</span>
<a href="#l27.5"></a><span id="l27.5">                         exdates.push(wrappedRItem);</span>
<a href="#l27.6"></a><span id="l27.6">                     }</span>
<a href="#l27.7"></a><span id="l27.7">                 }</span>
<a href="#l27.8"></a><span id="l27.8">                 if (exdates.length &gt; 0) {</span>
<a href="#l27.9"></a><span id="l27.9">                     // check whether really only EXDATEs have been added:</span>
<a href="#l27.10"></a><span id="l27.10">                     let recInfo = clonedItem.recurrenceInfo;</span>
<a href="#l27.11"></a><span id="l27.11">                     exdates.forEach(recInfo.deleteRecurrenceItem, recInfo);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-                    if (cal.compareItemContent(clonedItem, aOriginalItem)) { // transition into &quot;delete occurrence(s)&quot;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+                    if (cal.item.compareContent(clonedItem, aOriginalItem)) { // transition into &quot;delete occurrence(s)&quot;</span>
<a href="#l27.14"></a><span id="l27.14">                         // xxx todo: support multiple</span>
<a href="#l27.15"></a><span id="l27.15">                         aItem = aOriginalItem.recurrenceInfo.getOccurrenceFor(exdates[0].date);</span>
<a href="#l27.16"></a><span id="l27.16">                         aOriginalItem = null;</span>
<a href="#l27.17"></a><span id="l27.17">                         aOpType = Components.interfaces.calIOperationListener.DELETE;</span>
<a href="#l27.18"></a><span id="l27.18">                     }</span>
<a href="#l27.19"></a><span id="l27.19">                 }</span>
<a href="#l27.20"></a><span id="l27.20">             }</span>
<a href="#l27.21"></a><span id="l27.21">         }</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -806,17 +806,17 @@ cal.itip = {</span>
<a href="#l27.23"></a><span id="l27.23">         // this will be set to false, once the user cancels sending manually</span>
<a href="#l27.24"></a><span id="l27.24">         let sendOut = true;</span>
<a href="#l27.25"></a><span id="l27.25">         // Check to see if some part of the item was updated, if so, re-send REQUEST</span>
<a href="#l27.26"></a><span id="l27.26">         if (!aOriginalItem || (cal.itip.compare(aItem, aOriginalItem) &gt; 0)) { // REQUEST</span>
<a href="#l27.27"></a><span id="l27.27">             // check whether it's a simple UPDATE (no SEQUENCE change) or real (RE)REQUEST,</span>
<a href="#l27.28"></a><span id="l27.28">             // in case of time or location/description change.</span>
<a href="#l27.29"></a><span id="l27.29">             let isMinorUpdate = (aOriginalItem &amp;&amp; (cal.itip.getSequence(aItem) == cal.itip.getSequence(aOriginalItem)));</span>
<a href="#l27.30"></a><span id="l27.30"> </span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-            if (!isMinorUpdate || !cal.compareItemContent(stripUserData(aItem), stripUserData(aOriginalItem))) {</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+            if (!isMinorUpdate || !cal.item.compareContent(stripUserData(aItem), stripUserData(aOriginalItem))) {</span>
<a href="#l27.33"></a><span id="l27.33">                 let requestItem = aItem.clone();</span>
<a href="#l27.34"></a><span id="l27.34">                 if (!requestItem.organizer) {</span>
<a href="#l27.35"></a><span id="l27.35">                     requestItem.organizer = createOrganizer(requestItem.calendar);</span>
<a href="#l27.36"></a><span id="l27.36">                 }</span>
<a href="#l27.37"></a><span id="l27.37"> </span>
<a href="#l27.38"></a><span id="l27.38">                 // Fix up our attendees for invitations using some good defaults</span>
<a href="#l27.39"></a><span id="l27.39">                 let recipients = [];</span>
<a href="#l27.40"></a><span id="l27.40">                 let reqItemAtt = requestItem.getAttendees({});</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineat">@@ -931,17 +931,17 @@ cal.itip = {</span>
<a href="#l27.42"></a><span id="l27.42">      * @param  {JsObject}     aProps     Properties to be different in the new itipItem</span>
<a href="#l27.43"></a><span id="l27.43">      * @return {calIItipItem}</span>
<a href="#l27.44"></a><span id="l27.44">      */</span>
<a href="#l27.45"></a><span id="l27.45">     getModifiedItipItem: function(aItipItem, aItems=[], aProps={}) {</span>
<a href="#l27.46"></a><span id="l27.46">         let itipItem = Components.classes[&quot;@mozilla.org/calendar/itip-item;1&quot;]</span>
<a href="#l27.47"></a><span id="l27.47">                                  .createInstance(Components.interfaces.calIItipItem);</span>
<a href="#l27.48"></a><span id="l27.48">         let serializedItems = &quot;&quot;;</span>
<a href="#l27.49"></a><span id="l27.49">         for (let item of aItems) {</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-            serializedItems += cal.getSerializedItem(item);</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+            serializedItems += cal.item.serialize(item);</span>
<a href="#l27.52"></a><span id="l27.52">         }</span>
<a href="#l27.53"></a><span id="l27.53">         itipItem.init(serializedItems);</span>
<a href="#l27.54"></a><span id="l27.54"> </span>
<a href="#l27.55"></a><span id="l27.55">         itipItem.autoResponse = (&quot;autoResponse&quot; in aProps) ? aProps.autoResponse : aItipItem.autoResponse;</span>
<a href="#l27.56"></a><span id="l27.56">         itipItem.identity = (&quot;identity&quot; in aProps) ? aProps.identity : aItipItem.identity;</span>
<a href="#l27.57"></a><span id="l27.57">         itipItem.isSend = (&quot;isSend&quot; in aProps) ? aProps.isSend : aItipItem.isSend;</span>
<a href="#l27.58"></a><span id="l27.58">         itipItem.localStatus = (&quot;localStatus&quot; in aProps) ? aProps.localStatus : aItipItem.localStatus;</span>
<a href="#l27.59"></a><span id="l27.59">         itipItem.receivedMethod = (&quot;receivedMethod&quot; in aProps) ? aProps.receivedMethod : aItipItem.receivedMethod;</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineat">@@ -1140,17 +1140,17 @@ function sendMessage(aItem, aMethod, aRe</span>
<a href="#l27.61"></a><span id="l27.61">         return false;</span>
<a href="#l27.62"></a><span id="l27.62">     }</span>
<a href="#l27.63"></a><span id="l27.63">     transport = transport.QueryInterface(Components.interfaces.calIItipTransport);</span>
<a href="#l27.64"></a><span id="l27.64"> </span>
<a href="#l27.65"></a><span id="l27.65">     let _sendItem = function(aSendToList, aSendItem) {</span>
<a href="#l27.66"></a><span id="l27.66">         let cIII = Components.interfaces.calIItipItem;</span>
<a href="#l27.67"></a><span id="l27.67">         let itipItem = Components.classes[&quot;@mozilla.org/calendar/itip-item;1&quot;]</span>
<a href="#l27.68"></a><span id="l27.68">                                  .createInstance(cIII);</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-        itipItem.init(cal.getSerializedItem(aSendItem));</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineplus">+        itipItem.init(cal.item.serialize(aSendItem));</span>
<a href="#l27.71"></a><span id="l27.71">         itipItem.responseMethod = aMethod;</span>
<a href="#l27.72"></a><span id="l27.72">         itipItem.targetCalendar = aSendItem.calendar;</span>
<a href="#l27.73"></a><span id="l27.73">         itipItem.autoResponse = autoResponse &amp;&amp; autoResponse.value ? cIII.AUTO : cIII.USER;</span>
<a href="#l27.74"></a><span id="l27.74">         if (autoResponse) {</span>
<a href="#l27.75"></a><span id="l27.75">             autoResponse.value = true; // auto every following</span>
<a href="#l27.76"></a><span id="l27.76">         }</span>
<a href="#l27.77"></a><span id="l27.77">         // XXX I don't know whether the below are used at all, since we don't use the itip processor</span>
<a href="#l27.78"></a><span id="l27.78">         itipItem.isSend = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/modules/calViewUtils.jsm</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/modules/calViewUtils.jsm</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -16,21 +16,21 @@ cal.view = {</span>
<a href="#l28.4"></a><span id="l28.4">     compareItems: function(a, b) {</span>
<a href="#l28.5"></a><span id="l28.5">         if (!a) {</span>
<a href="#l28.6"></a><span id="l28.6">             return -1;</span>
<a href="#l28.7"></a><span id="l28.7">         }</span>
<a href="#l28.8"></a><span id="l28.8">         if (!b) {</span>
<a href="#l28.9"></a><span id="l28.9">             return 1;</span>
<a href="#l28.10"></a><span id="l28.10">         }</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        let aIsEvent = cal.isEvent(a);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-        let aIsTodo = cal.isToDo(a);</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineplus">+        let aIsEvent = cal.item.isEvent(a);</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+        let aIsTodo = cal.item.isToDo(a);</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-        let bIsEvent = cal.isEvent(b);</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-        let bIsTodo = cal.isToDo(b);</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+        let bIsEvent = cal.item.isEvent(b);</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+        let bIsTodo = cal.item.isToDo(b);</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22">         // sort todos before events</span>
<a href="#l28.23"></a><span id="l28.23">         if (aIsTodo &amp;&amp; bIsEvent) {</span>
<a href="#l28.24"></a><span id="l28.24">             return -1;</span>
<a href="#l28.25"></a><span id="l28.25">         }</span>
<a href="#l28.26"></a><span id="l28.26">         if (aIsEvent &amp;&amp; bIsTodo) {</span>
<a href="#l28.27"></a><span id="l28.27">             return 1;</span>
<a href="#l28.28"></a><span id="l28.28">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/src/calAlarm.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/src/calAlarm.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -622,19 +622,19 @@ calAlarm.prototype = {</span>
<a href="#l29.4"></a><span id="l29.4">     },</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6">     get propertyEnumerator() {</span>
<a href="#l29.7"></a><span id="l29.7">         return this.mProperties.enumerator;</span>
<a href="#l29.8"></a><span id="l29.8">     },</span>
<a href="#l29.9"></a><span id="l29.9"> </span>
<a href="#l29.10"></a><span id="l29.10">     toString: function(aItem) {</span>
<a href="#l29.11"></a><span id="l29.11">         function getItemBundleStringName(aPrefix) {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-            if (!aItem || cal.isEvent(aItem)) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+            if (!aItem || cal.item.isEvent(aItem)) {</span>
<a href="#l29.14"></a><span id="l29.14">                 return aPrefix + &quot;Event&quot;;</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-            } else if (cal.isToDo(aItem)) {</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+            } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l29.17"></a><span id="l29.17">                 return aPrefix + &quot;Task&quot;;</span>
<a href="#l29.18"></a><span id="l29.18">             } else {</span>
<a href="#l29.19"></a><span id="l29.19">                 return aPrefix;</span>
<a href="#l29.20"></a><span id="l29.20">             }</span>
<a href="#l29.21"></a><span id="l29.21">         }</span>
<a href="#l29.22"></a><span id="l29.22"> </span>
<a href="#l29.23"></a><span id="l29.23">         if (this.related == ALARM_RELATED_ABSOLUTE &amp;&amp; this.mAbsoluteDate) {</span>
<a href="#l29.24"></a><span id="l29.24">             // this is an absolute alarm. Use the calendar default timezone and</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -315,17 +315,17 @@ calAlarmService.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">     unobserveCalendar: function(calendar) {</span>
<a href="#l30.6"></a><span id="l30.6">         calendar.removeObserver(this.calendarObserver);</span>
<a href="#l30.7"></a><span id="l30.7">         this.disposeCalendarTimers([calendar]);</span>
<a href="#l30.8"></a><span id="l30.8">         this.mObservers.notify(&quot;onRemoveAlarmsByCalendar&quot;, [calendar]);</span>
<a href="#l30.9"></a><span id="l30.9">     },</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11">     addAlarmsForItem: function(aItem) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        if (cal.isToDo(aItem) &amp;&amp; aItem.isCompleted) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+        if (cal.item.isToDo(aItem) &amp;&amp; aItem.isCompleted) {</span>
<a href="#l30.14"></a><span id="l30.14">             // If this is a task and it is completed, don't add the alarm.</span>
<a href="#l30.15"></a><span id="l30.15">             return;</span>
<a href="#l30.16"></a><span id="l30.16">         }</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18">         let showMissed = Preferences.get(&quot;calendar.alarms.showmissed&quot;, true);</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">         let alarms = aItem.getAlarms({});</span>
<a href="#l30.21"></a><span id="l30.21">         for (let alarm of alarms) {</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -414,17 +414,17 @@ calAlarmService.prototype = {</span>
<a href="#l30.23"></a><span id="l30.23">         // We search 1 month in each direction for alarms.  Therefore,</span>
<a href="#l30.24"></a><span id="l30.24">         // we need occurrences between initial start date and 1 month from now</span>
<a href="#l30.25"></a><span id="l30.25">         let until = nowUTC();</span>
<a href="#l30.26"></a><span id="l30.26">         until.month += 1;</span>
<a href="#l30.27"></a><span id="l30.27"> </span>
<a href="#l30.28"></a><span id="l30.28">         if (aItem &amp;&amp; aItem.recurrenceInfo) {</span>
<a href="#l30.29"></a><span id="l30.29">             return aItem.recurrenceInfo.getOccurrences(this.mRangeStart, until, 0, {});</span>
<a href="#l30.30"></a><span id="l30.30">         } else {</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-            return cal.checkIfInRange(aItem, this.mRangeStart, until) ? [aItem] : [];</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+            return cal.item.checkIfInRange(aItem, this.mRangeStart, until) ? [aItem] : [];</span>
<a href="#l30.33"></a><span id="l30.33">         }</span>
<a href="#l30.34"></a><span id="l30.34">     },</span>
<a href="#l30.35"></a><span id="l30.35"> </span>
<a href="#l30.36"></a><span id="l30.36">     addAlarmsForOccurrences: function(aParentItem) {</span>
<a href="#l30.37"></a><span id="l30.37">         let occs = this.getOccurrencesInRange(aParentItem);</span>
<a href="#l30.38"></a><span id="l30.38"> </span>
<a href="#l30.39"></a><span id="l30.39">         // Add an alarm for each occurrence</span>
<a href="#l30.40"></a><span id="l30.40">         occs.forEach(this.addAlarmsForItem, this);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/src/calEvent.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/src/calEvent.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -81,17 +81,17 @@ calEvent.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4">     { cal: &quot;DTEND&quot;, ics: &quot;endTime&quot; }],</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6">     set icalString(value) {</span>
<a href="#l31.7"></a><span id="l31.7">         this.icalComponent = cal.getIcsService().parseICS(value, null);</span>
<a href="#l31.8"></a><span id="l31.8">     },</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10">     get icalString() {</span>
<a href="#l31.11"></a><span id="l31.11">         let calcomp = cal.getIcsService().createIcalComponent(&quot;VCALENDAR&quot;);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-        cal.calSetProdidVersion(calcomp);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+        cal.item.setStaticProps(calcomp);</span>
<a href="#l31.14"></a><span id="l31.14">         calcomp.addSubcomponent(this.icalComponent);</span>
<a href="#l31.15"></a><span id="l31.15">         return calcomp.serializeToICS();</span>
<a href="#l31.16"></a><span id="l31.16">     },</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">     get icalComponent() {</span>
<a href="#l31.19"></a><span id="l31.19">         let icssvc = cal.getIcsService();</span>
<a href="#l31.20"></a><span id="l31.20">         let icalcomp = icssvc.createIcalComponent(&quot;VEVENT&quot;);</span>
<a href="#l31.21"></a><span id="l31.21">         this.fillIcalComponentFromBase(icalcomp);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -369,17 +369,17 @@ calFilter.prototype = {</span>
<a href="#l32.4"></a><span id="l32.4">     /**</span>
<a href="#l32.5"></a><span id="l32.5">      * Checks if the item matches the current filter date range.</span>
<a href="#l32.6"></a><span id="l32.6">      *</span>
<a href="#l32.7"></a><span id="l32.7">      * @param aItem               The item to check.</span>
<a href="#l32.8"></a><span id="l32.8">      * @return                    Returns true if the item falls within the date range</span>
<a href="#l32.9"></a><span id="l32.9">      *                            specified by mStartDate and mEndDate, false otherwise.</span>
<a href="#l32.10"></a><span id="l32.10">      */</span>
<a href="#l32.11"></a><span id="l32.11">     dateRangeFilter: function(aItem) {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-        return cal.checkIfInRange(aItem, this.mStartDate, this.mEndDate);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+        return cal.item.checkIfInRange(aItem, this.mStartDate, this.mEndDate);</span>
<a href="#l32.14"></a><span id="l32.14">     },</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16">     /**</span>
<a href="#l32.17"></a><span id="l32.17">      * Checks if the item matches the currently applied filter properties. Filter properties</span>
<a href="#l32.18"></a><span id="l32.18">      * with a value of null or that are not applicable to the item's type are not tested.</span>
<a href="#l32.19"></a><span id="l32.19">      *</span>
<a href="#l32.20"></a><span id="l32.20">      * @param aItem               The item to check.</span>
<a href="#l32.21"></a><span id="l32.21">      * @return                    Returns true if the item matches the filter properties</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -418,33 +418,33 @@ calFilter.prototype = {</span>
<a href="#l32.23"></a><span id="l32.23">                 cats.push(props.category);</span>
<a href="#l32.24"></a><span id="l32.24">             } else if (Array.isArray(props.category)) {</span>
<a href="#l32.25"></a><span id="l32.25">                 cats = props.category;</span>
<a href="#l32.26"></a><span id="l32.26">             }</span>
<a href="#l32.27"></a><span id="l32.27">             result = cats.some(cat =&gt; aItem.getCategories({}).includes(cat));</span>
<a href="#l32.28"></a><span id="l32.28">         }</span>
<a href="#l32.29"></a><span id="l32.29"> </span>
<a href="#l32.30"></a><span id="l32.30">         // test the status property. Only applies to tasks.</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-        if (result &amp;&amp; props.status != null &amp;&amp; cal.isToDo(aItem)) {</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+        if (result &amp;&amp; props.status != null &amp;&amp; cal.item.isToDo(aItem)) {</span>
<a href="#l32.33"></a><span id="l32.33">             let completed = aItem.isCompleted;</span>
<a href="#l32.34"></a><span id="l32.34">             let current = !aItem.completedDate || today.compare(aItem.completedDate) &lt;= 0;</span>
<a href="#l32.35"></a><span id="l32.35">             let percent = aItem.percentComplete || 0;</span>
<a href="#l32.36"></a><span id="l32.36"> </span>
<a href="#l32.37"></a><span id="l32.37">             result = ((props.status &amp; props.FILTER_STATUS_INCOMPLETE) ||</span>
<a href="#l32.38"></a><span id="l32.38">                       !(!completed &amp;&amp; (percent == 0))) &amp;&amp;</span>
<a href="#l32.39"></a><span id="l32.39">                      ((props.status &amp; props.FILTER_STATUS_IN_PROGRESS) ||</span>
<a href="#l32.40"></a><span id="l32.40">                       !(!completed &amp;&amp; (percent &gt; 0))) &amp;&amp;</span>
<a href="#l32.41"></a><span id="l32.41">                      ((props.status &amp; props.FILTER_STATUS_COMPLETED_TODAY) ||</span>
<a href="#l32.42"></a><span id="l32.42">                       !(completed &amp;&amp; current)) &amp;&amp;</span>
<a href="#l32.43"></a><span id="l32.43">                      ((props.status &amp; props.FILTER_STATUS_COMPLETED_BEFORE) ||</span>
<a href="#l32.44"></a><span id="l32.44">                       !(completed &amp;&amp; !current));</span>
<a href="#l32.45"></a><span id="l32.45">         }</span>
<a href="#l32.46"></a><span id="l32.46"> </span>
<a href="#l32.47"></a><span id="l32.47">         // test the due property. Only applies to tasks.</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineminus">-        if (result &amp;&amp; props.due != null &amp;&amp; cal.isToDo(aItem)) {</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineplus">+        if (result &amp;&amp; props.due != null &amp;&amp; cal.item.isToDo(aItem)) {</span>
<a href="#l32.50"></a><span id="l32.50">             let due = aItem.dueDate;</span>
<a href="#l32.51"></a><span id="l32.51">             let now = cal.dtz.now();</span>
<a href="#l32.52"></a><span id="l32.52"> </span>
<a href="#l32.53"></a><span id="l32.53">             result = ((props.due &amp; props.FILTER_DUE_PAST) ||</span>
<a href="#l32.54"></a><span id="l32.54">                       !(due &amp;&amp; (due.compare(now) &lt; 0))) &amp;&amp;</span>
<a href="#l32.55"></a><span id="l32.55">                      ((props.due &amp; props.FILTER_DUE_TODAY) ||</span>
<a href="#l32.56"></a><span id="l32.56">                       !(due &amp;&amp; (due.compare(now) &gt;= 0) &amp;&amp; (due.compare(tomorrow) &lt; 0))) &amp;&amp;</span>
<a href="#l32.57"></a><span id="l32.57">                      ((props.due &amp; props.FILTER_DUE_FUTURE) ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/src/calIcsParser.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/src/calIcsParser.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -70,17 +70,17 @@ calIcsParser.prototype = {</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5">         state.join(() =&gt; {</span>
<a href="#l33.6"></a><span id="l33.6">             let fakedParents = {};</span>
<a href="#l33.7"></a><span id="l33.7">             // tag &quot;exceptions&quot;, i.e. items with rid:</span>
<a href="#l33.8"></a><span id="l33.8">             for (let item of state.excItems) {</span>
<a href="#l33.9"></a><span id="l33.9">                 let parent = state.uid2parent[item.id];</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11">                 if (!parent) { // a parentless one, fake a master and override it's occurrence</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-                    parent = cal.isEvent(item) ? cal.createEvent() : cal.createTodo();</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+                    parent = cal.item.isEvent(item) ? cal.createEvent() : cal.createTodo();</span>
<a href="#l33.14"></a><span id="l33.14">                     parent.id = item.id;</span>
<a href="#l33.15"></a><span id="l33.15">                     parent.setProperty(&quot;DTSTART&quot;, item.recurrenceId);</span>
<a href="#l33.16"></a><span id="l33.16">                     parent.setProperty(&quot;X-MOZ-FAKED-MASTER&quot;, &quot;1&quot;); // this tag might be useful in the future</span>
<a href="#l33.17"></a><span id="l33.17">                     parent.recurrenceInfo = cal.createRecurrenceInfo(parent);</span>
<a href="#l33.18"></a><span id="l33.18">                     fakedParents[item.id] = true;</span>
<a href="#l33.19"></a><span id="l33.19">                     state.uid2parent[item.id] = parent;</span>
<a href="#l33.20"></a><span id="l33.20">                     state.items.push(parent);</span>
<a href="#l33.21"></a><span id="l33.21">                 }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/src/calIcsSerializer.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/src/calIcsSerializer.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -57,17 +57,17 @@ calIcsSerializer.prototype = {</span>
<a href="#l34.4"></a><span id="l34.4">         convStream.init(aStream, &quot;UTF-8&quot;);</span>
<a href="#l34.5"></a><span id="l34.5"> </span>
<a href="#l34.6"></a><span id="l34.6">         convStream.writeString(str);</span>
<a href="#l34.7"></a><span id="l34.7">         convStream.close();</span>
<a href="#l34.8"></a><span id="l34.8">     },</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">     getIcalComponent: function() {</span>
<a href="#l34.11"></a><span id="l34.11">         let calComp = cal.getIcsService().createIcalComponent(&quot;VCALENDAR&quot;);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-        cal.calSetProdidVersion(calComp);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+        cal.item.setStaticProps(calComp);</span>
<a href="#l34.14"></a><span id="l34.14"> </span>
<a href="#l34.15"></a><span id="l34.15">         // xxx todo: think about that the below code doesn't clone the properties/components,</span>
<a href="#l34.16"></a><span id="l34.16">         //           thus ownership is moved to returned VCALENDAR...</span>
<a href="#l34.17"></a><span id="l34.17"> </span>
<a href="#l34.18"></a><span id="l34.18">         for (let prop of this.mProperties) {</span>
<a href="#l34.19"></a><span id="l34.19">             calComp.addProperty(prop);</span>
<a href="#l34.20"></a><span id="l34.20">         }</span>
<a href="#l34.21"></a><span id="l34.21">         for (let comp of this.mComponents) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1080,17 +1080,17 @@ calItemBase.prototype = {</span>
<a href="#l35.4"></a><span id="l35.4">     // void getOccurrencesBetween (in calIDateTime aStartDate, in calIDateTime aEndDate,</span>
<a href="#l35.5"></a><span id="l35.5">     //                             out PRUint32 aCount,</span>
<a href="#l35.6"></a><span id="l35.6">     //                             [array,size_is(aCount),retval] out calIItemBase aOccurrences);</span>
<a href="#l35.7"></a><span id="l35.7">     getOccurrencesBetween: function(aStartDate, aEndDate, aCount) {</span>
<a href="#l35.8"></a><span id="l35.8">         if (this.recurrenceInfo) {</span>
<a href="#l35.9"></a><span id="l35.9">             return this.recurrenceInfo.getOccurrences(aStartDate, aEndDate, 0, aCount);</span>
<a href="#l35.10"></a><span id="l35.10">         }</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-        if (cal.checkIfInRange(this, aStartDate, aEndDate)) {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+        if (cal.item.checkIfInRange(this, aStartDate, aEndDate)) {</span>
<a href="#l35.14"></a><span id="l35.14">             aCount.value = 1;</span>
<a href="#l35.15"></a><span id="l35.15">             return [this];</span>
<a href="#l35.16"></a><span id="l35.16">         }</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18">         aCount.value = 0;</span>
<a href="#l35.19"></a><span id="l35.19">         return [];</span>
<a href="#l35.20"></a><span id="l35.20">     }</span>
<a href="#l35.21"></a><span id="l35.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -454,26 +454,26 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5">         let dates = [];</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7">         // toss in exceptions first. Save a map of all exceptions ids, so we</span>
<a href="#l36.8"></a><span id="l36.8">         // don't add the wrong occurrences later on.</span>
<a href="#l36.9"></a><span id="l36.9">         let occurrenceMap = {};</span>
<a href="#l36.10"></a><span id="l36.10">         for (let ex in this.mExceptionMap) {</span>
<a href="#l36.11"></a><span id="l36.11">             let item = this.mExceptionMap[ex];</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-            let occDate = cal.checkIfInRange(item, aRangeStart, aRangeEnd, true);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+            let occDate = cal.item.checkIfInRange(item, aRangeStart, aRangeEnd, true);</span>
<a href="#l36.14"></a><span id="l36.14">             occurrenceMap[ex] = true;</span>
<a href="#l36.15"></a><span id="l36.15">             if (occDate) {</span>
<a href="#l36.16"></a><span id="l36.16">                 cal.binaryInsert(dates, { id: item.recurrenceId, rstart: occDate }, ridDateSortComptor);</span>
<a href="#l36.17"></a><span id="l36.17">             }</span>
<a href="#l36.18"></a><span id="l36.18">         }</span>
<a href="#l36.19"></a><span id="l36.19"> </span>
<a href="#l36.20"></a><span id="l36.20">         // DTSTART/DUE is always part of the (positive) expanded set:</span>
<a href="#l36.21"></a><span id="l36.21">         // DTSTART always equals RECURRENCE-ID for items expanded from RRULE</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineminus">-        let baseOccDate = cal.checkIfInRange(this.mBaseItem, aRangeStart, aRangeEnd, true);</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineplus">+        let baseOccDate = cal.item.checkIfInRange(this.mBaseItem, aRangeStart, aRangeEnd, true);</span>
<a href="#l36.24"></a><span id="l36.24">         let baseOccDateKey = getRidKey(baseOccDate);</span>
<a href="#l36.25"></a><span id="l36.25">         if (baseOccDate &amp;&amp; !occurrenceMap[baseOccDateKey]) {</span>
<a href="#l36.26"></a><span id="l36.26">             occurrenceMap[baseOccDateKey] = true;</span>
<a href="#l36.27"></a><span id="l36.27">             cal.binaryInsert(dates, { id: baseOccDate, rstart: baseOccDate }, ridDateSortComptor);</span>
<a href="#l36.28"></a><span id="l36.28">         }</span>
<a href="#l36.29"></a><span id="l36.29"> </span>
<a href="#l36.30"></a><span id="l36.30">         // if both range start and end are specified, we ask for all of the occurrences,</span>
<a href="#l36.31"></a><span id="l36.31">         // to make sure we catch all possible exceptions.  If aRangeEnd isn't specified,</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineat">@@ -782,17 +782,17 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l36.33"></a><span id="l36.33">                 ex = ex.clone();</span>
<a href="#l36.34"></a><span id="l36.34">                 // track RECURRENCE-IDs in DTSTART's or RDATE's timezone,</span>
<a href="#l36.35"></a><span id="l36.35">                 // otherwise those won't match any longer w.r.t DST:</span>
<a href="#l36.36"></a><span id="l36.36">                 let rid = ex.recurrenceId;</span>
<a href="#l36.37"></a><span id="l36.37">                 let rdate = rdates[getRidKey(rid)];</span>
<a href="#l36.38"></a><span id="l36.38">                 rid = rid.getInTimezone(rdate ? rdate.timezone : startTimezone);</span>
<a href="#l36.39"></a><span id="l36.39">                 rid.addDuration(timeDiff);</span>
<a href="#l36.40"></a><span id="l36.40">                 ex.recurrenceId = rid;</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineminus">-                cal.shiftItem(ex, timeDiff);</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineplus">+                cal.item.shiftOffset(ex, timeDiff);</span>
<a href="#l36.43"></a><span id="l36.43">                 modifiedExceptions.push(ex);</span>
<a href="#l36.44"></a><span id="l36.44">                 this.removeExceptionFor(exid);</span>
<a href="#l36.45"></a><span id="l36.45">             }</span>
<a href="#l36.46"></a><span id="l36.46">         }</span>
<a href="#l36.47"></a><span id="l36.47">         for (let modifiedEx of modifiedExceptions) {</span>
<a href="#l36.48"></a><span id="l36.48">             this.modifyException(modifiedEx, true);</span>
<a href="#l36.49"></a><span id="l36.49">         }</span>
<a href="#l36.50"></a><span id="l36.50">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/base/src/calTodo.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/base/src/calTodo.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -119,17 +119,17 @@ calTodo.prototype = {</span>
<a href="#l37.4"></a><span id="l37.4">     { cal: &quot;COMPLETED&quot;, ics: &quot;completedTime&quot; }],</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6">     set icalString(value) {</span>
<a href="#l37.7"></a><span id="l37.7">         this.icalComponent = cal.getIcsService().parseICS(value, null);</span>
<a href="#l37.8"></a><span id="l37.8">     },</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">     get icalString() {</span>
<a href="#l37.11"></a><span id="l37.11">         let calcomp = cal.getIcsService().createIcalComponent(&quot;VCALENDAR&quot;);</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-        cal.calSetProdidVersion(calcomp);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+        cal.item.setStaticProps(calcomp);</span>
<a href="#l37.14"></a><span id="l37.14">         calcomp.addSubcomponent(this.icalComponent);</span>
<a href="#l37.15"></a><span id="l37.15">         return calcomp.serializeToICS();</span>
<a href="#l37.16"></a><span id="l37.16">     },</span>
<a href="#l37.17"></a><span id="l37.17"> </span>
<a href="#l37.18"></a><span id="l37.18">     get icalComponent() {</span>
<a href="#l37.19"></a><span id="l37.19">         let icssvc = cal.getIcsService();</span>
<a href="#l37.20"></a><span id="l37.20">         let icalcomp = icssvc.createIcalComponent(&quot;VTODO&quot;);</span>
<a href="#l37.21"></a><span id="l37.21">         this.fillIcalComponentFromBase(icalcomp);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -453,17 +453,17 @@ calOutlookCSVExporter.prototype = {</span>
<a href="#l38.4"></a><span id="l38.4">         headers.push(localeEn.headLocation);</span>
<a href="#l38.5"></a><span id="l38.5">         headers.push(localeEn.headPrivate);</span>
<a href="#l38.6"></a><span id="l38.6">         headers = headers.map(hdr =&gt; '&quot;' + hdr + '&quot;');</span>
<a href="#l38.7"></a><span id="l38.7">         let str = headers.join(&quot;,&quot;);</span>
<a href="#l38.8"></a><span id="l38.8">         str += exportLineEnding;</span>
<a href="#l38.9"></a><span id="l38.9">         aStream.write(str, str.length);</span>
<a href="#l38.10"></a><span id="l38.10"> </span>
<a href="#l38.11"></a><span id="l38.11">         for (let item of aItems) {</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-            if (!cal.isEvent(item)) {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+            if (!cal.item.isEvent(item)) {</span>
<a href="#l38.14"></a><span id="l38.14">                 // XXX TODO: warn the user (once) that tasks are not supported</span>
<a href="#l38.15"></a><span id="l38.15">                 // (bug 336175)</span>
<a href="#l38.16"></a><span id="l38.16">                 continue;</span>
<a href="#l38.17"></a><span id="l38.17">             }</span>
<a href="#l38.18"></a><span id="l38.18">             let line = [];</span>
<a href="#l38.19"></a><span id="l38.19">             line.push(item.title);</span>
<a href="#l38.20"></a><span id="l38.20">             line.push(dateString(item.startDate));</span>
<a href="#l38.21"></a><span id="l38.21">             line.push(timeString(item.startDate));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/lightning/components/lightningTextCalendarConverter.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/lightning/components/lightningTextCalendarConverter.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -29,17 +29,17 @@ ltnMimeConverter.prototype = {</span>
<a href="#l39.4"></a><span id="l39.4">     uri: null,</span>
<a href="#l39.5"></a><span id="l39.5"> </span>
<a href="#l39.6"></a><span id="l39.6">     convertToHTML: function(contentType, data) {</span>
<a href="#l39.7"></a><span id="l39.7">         let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l39.8"></a><span id="l39.8">                                .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l39.9"></a><span id="l39.9">         parser.parseString(data);</span>
<a href="#l39.10"></a><span id="l39.10">         let event = null;</span>
<a href="#l39.11"></a><span id="l39.11">         for (let item of parser.getItems({})) {</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-            if (cal.isEvent(item)) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+            if (cal.item.isEvent(item)) {</span>
<a href="#l39.14"></a><span id="l39.14">                 if (item.hasProperty(&quot;X-MOZ-FAKED-MASTER&quot;)) {</span>
<a href="#l39.15"></a><span id="l39.15">                     // if it's a faked master, take any overridden item to get a real occurrence:</span>
<a href="#l39.16"></a><span id="l39.16">                     let exc = item.recurrenceInfo.getExceptionFor(item.startDate);</span>
<a href="#l39.17"></a><span id="l39.17">                     cal.ASSERT(exc, &quot;unexpected!&quot;);</span>
<a href="#l39.18"></a><span id="l39.18">                     if (exc) {</span>
<a href="#l39.19"></a><span id="l39.19">                         item = exc;</span>
<a href="#l39.20"></a><span id="l39.20">                     }</span>
<a href="#l39.21"></a><span id="l39.21">                 }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -297,24 +297,24 @@ function onLoad() {</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5">     window.fbWrapper = args.fbWrapper;</span>
<a href="#l40.6"></a><span id="l40.6"> </span>
<a href="#l40.7"></a><span id="l40.7">     // the most important attribute we expect from the</span>
<a href="#l40.8"></a><span id="l40.8">     // arguments is the item we'll edit in the dialog.</span>
<a href="#l40.9"></a><span id="l40.9">     let item = args.calendarEvent;</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11">     // set the iframe's top level id for event vs task</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-    if (!cal.isEvent(item)) {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+    if (!cal.item.isEvent(item)) {</span>
<a href="#l40.14"></a><span id="l40.14">         setDialogId(document.documentElement, &quot;calendar-task-dialog-inner&quot;);</span>
<a href="#l40.15"></a><span id="l40.15">     }</span>
<a href="#l40.16"></a><span id="l40.16"> </span>
<a href="#l40.17"></a><span id="l40.17">     // new items should have a non-empty title.</span>
<a href="#l40.18"></a><span id="l40.18">     if (item.isMutable &amp;&amp; (!item.title || item.title.length &lt;= 0)) {</span>
<a href="#l40.19"></a><span id="l40.19">         item.title = cal.calGetString(&quot;calendar-event-dialog&quot;,</span>
<a href="#l40.20"></a><span id="l40.20" class="difflineminus">-                                      cal.isEvent(item) ? &quot;newEvent&quot; : &quot;newTask&quot;);</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineplus">+                                      cal.item.isEvent(item) ? &quot;newEvent&quot; : &quot;newTask&quot;);</span>
<a href="#l40.22"></a><span id="l40.22">     }</span>
<a href="#l40.23"></a><span id="l40.23"> </span>
<a href="#l40.24"></a><span id="l40.24">     window.onAcceptCallback = args.onOk;</span>
<a href="#l40.25"></a><span id="l40.25">     window.mode = args.mode;</span>
<a href="#l40.26"></a><span id="l40.26"> </span>
<a href="#l40.27"></a><span id="l40.27">     // we store the item in the window to be able</span>
<a href="#l40.28"></a><span id="l40.28">     // to access this from any location. please note</span>
<a href="#l40.29"></a><span id="l40.29">     // that the item is either an occurrence [proxy]</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineat">@@ -361,17 +361,17 @@ function onLoad() {</span>
<a href="#l40.31"></a><span id="l40.31">     }</span>
<a href="#l40.32"></a><span id="l40.32"> </span>
<a href="#l40.33"></a><span id="l40.33">     window.recurrenceInfo = null;</span>
<a href="#l40.34"></a><span id="l40.34">     if (parentItem.recurrenceInfo) {</span>
<a href="#l40.35"></a><span id="l40.35">         window.recurrenceInfo = parentItem.recurrenceInfo.clone();</span>
<a href="#l40.36"></a><span id="l40.36">     }</span>
<a href="#l40.37"></a><span id="l40.37"> </span>
<a href="#l40.38"></a><span id="l40.38">     // Set initial values for datepickers in New Tasks dialog</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">-    if (cal.isToDo(item)) {</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineplus">+    if (cal.item.isToDo(item)) {</span>
<a href="#l40.41"></a><span id="l40.41">         let initialDatesValue = cal.dtz.dateTimeToJsDate(args.initialStartDateValue);</span>
<a href="#l40.42"></a><span id="l40.42">         if (!gNewItemUI) {</span>
<a href="#l40.43"></a><span id="l40.43">             setElementValue(&quot;completed-date-picker&quot;, initialDatesValue);</span>
<a href="#l40.44"></a><span id="l40.44">             setElementValue(&quot;todo-entrydate&quot;, initialDatesValue);</span>
<a href="#l40.45"></a><span id="l40.45">             setElementValue(&quot;todo-duedate&quot;, initialDatesValue);</span>
<a href="#l40.46"></a><span id="l40.46">         }</span>
<a href="#l40.47"></a><span id="l40.47">     }</span>
<a href="#l40.48"></a><span id="l40.48">     loadDialog(window.calendarItem);</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineat">@@ -452,21 +452,21 @@ function onCommandCancel() {</span>
<a href="#l40.50"></a><span id="l40.50">     if (gInTab &amp;&amp; gTabInfoObject) {</span>
<a href="#l40.51"></a><span id="l40.51">         // Switch to the tab that the prompt refers to.</span>
<a href="#l40.52"></a><span id="l40.52">         gTabmail.switchToTab(gTabInfoObject);</span>
<a href="#l40.53"></a><span id="l40.53">     }</span>
<a href="#l40.54"></a><span id="l40.54"> </span>
<a href="#l40.55"></a><span id="l40.55">     let promptService = Components.interfaces.nsIPromptService;</span>
<a href="#l40.56"></a><span id="l40.56"> </span>
<a href="#l40.57"></a><span id="l40.57">     let promptTitle = cal.calGetString(&quot;calendar&quot;,</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineminus">-                                       cal.isEvent(window.calendarItem)</span>
<a href="#l40.59"></a><span id="l40.59" class="difflineplus">+                                       cal.item.isEvent(window.calendarItem)</span>
<a href="#l40.60"></a><span id="l40.60">                                           ? &quot;askSaveTitleEvent&quot;</span>
<a href="#l40.61"></a><span id="l40.61">                                           : &quot;askSaveTitleTask&quot;);</span>
<a href="#l40.62"></a><span id="l40.62">     let promptMessage = cal.calGetString(&quot;calendar&quot;,</span>
<a href="#l40.63"></a><span id="l40.63" class="difflineminus">-                                         cal.isEvent(window.calendarItem)</span>
<a href="#l40.64"></a><span id="l40.64" class="difflineplus">+                                         cal.item.isEvent(window.calendarItem)</span>
<a href="#l40.65"></a><span id="l40.65">                                             ? &quot;askSaveMessageEvent&quot;</span>
<a href="#l40.66"></a><span id="l40.66">                                             : &quot;askSaveMessageTask&quot;);</span>
<a href="#l40.67"></a><span id="l40.67"> </span>
<a href="#l40.68"></a><span id="l40.68">     let flags = promptService.BUTTON_TITLE_SAVE *</span>
<a href="#l40.69"></a><span id="l40.69">                 promptService.BUTTON_POS_0 +</span>
<a href="#l40.70"></a><span id="l40.70">                 promptService.BUTTON_TITLE_CANCEL *</span>
<a href="#l40.71"></a><span id="l40.71">                 promptService.BUTTON_POS_1 +</span>
<a href="#l40.72"></a><span id="l40.72">                 promptService.BUTTON_TITLE_DONT_SAVE *</span>
<a href="#l40.73"></a><span id="l40.73" class="difflineat">@@ -567,17 +567,17 @@ function loadDialog(aItem) {</span>
<a href="#l40.74"></a><span id="l40.74"> </span>
<a href="#l40.75"></a><span id="l40.75">         // filter out calendars that should not be included</span>
<a href="#l40.76"></a><span id="l40.76">         let calendarList = unfilteredList.filter((calendar) =&gt;</span>
<a href="#l40.77"></a><span id="l40.77">            (calendar.id == calendarToUse.id ||</span>
<a href="#l40.78"></a><span id="l40.78">             (calendar &amp;&amp;</span>
<a href="#l40.79"></a><span id="l40.79">              cal.acl.isCalendarWritable(calendar) &amp;&amp;</span>
<a href="#l40.80"></a><span id="l40.80">              (cal.acl.userCanAddItemsToCalendar(calendar) ||</span>
<a href="#l40.81"></a><span id="l40.81">               (calendar == aItem.calendar &amp;&amp; cal.acl.userCanModifyItem(aItem))) &amp;&amp;</span>
<a href="#l40.82"></a><span id="l40.82" class="difflineminus">-             cal.isItemSupported(aItem, calendar))));</span>
<a href="#l40.83"></a><span id="l40.83" class="difflineplus">+             cal.item.isItemSupported(aItem, calendar))));</span>
<a href="#l40.84"></a><span id="l40.84"> </span>
<a href="#l40.85"></a><span id="l40.85">         itemProps.calendarList = calendarList.map(calendar =&gt; [calendar.id, calendar.name]);</span>
<a href="#l40.86"></a><span id="l40.86"> </span>
<a href="#l40.87"></a><span id="l40.87">         if (calendarToUse &amp;&amp; calendarToUse.id) {</span>
<a href="#l40.88"></a><span id="l40.88">             let index = itemProps.calendarList.findIndex(</span>
<a href="#l40.89"></a><span id="l40.89">                 calendar =&gt; (calendar[0] == calendarToUse.id));</span>
<a href="#l40.90"></a><span id="l40.90">             if (index != -1) {</span>
<a href="#l40.91"></a><span id="l40.91">                 itemProps.initialCalendarId = calendarToUse.id;</span>
<a href="#l40.92"></a><span id="l40.92" class="difflineat">@@ -665,17 +665,17 @@ function loadDialog(aItem) {</span>
<a href="#l40.93"></a><span id="l40.93">         if (aItem.completedDate) {</span>
<a href="#l40.94"></a><span id="l40.94">             updateToDoStatus(aItem.status, cal.dtz.dateTimeToJsDate(aItem.completedDate));</span>
<a href="#l40.95"></a><span id="l40.95">         } else {</span>
<a href="#l40.96"></a><span id="l40.96">             updateToDoStatus(aItem.status);</span>
<a href="#l40.97"></a><span id="l40.97">         }</span>
<a href="#l40.98"></a><span id="l40.98">     }</span>
<a href="#l40.99"></a><span id="l40.99"> </span>
<a href="#l40.100"></a><span id="l40.100">     // Task percent complete</span>
<a href="#l40.101"></a><span id="l40.101" class="difflineminus">-    if (cal.isToDo(aItem)) {</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineplus">+    if (cal.item.isToDo(aItem)) {</span>
<a href="#l40.103"></a><span id="l40.103">         let percentCompleteInteger = 0;</span>
<a href="#l40.104"></a><span id="l40.104">         let percentCompleteProperty = aItem.getProperty(&quot;PERCENT-COMPLETE&quot;);</span>
<a href="#l40.105"></a><span id="l40.105">         if (percentCompleteProperty != null) {</span>
<a href="#l40.106"></a><span id="l40.106">             percentCompleteInteger = parseInt(percentCompleteProperty, 10);</span>
<a href="#l40.107"></a><span id="l40.107">         }</span>
<a href="#l40.108"></a><span id="l40.108">         if (percentCompleteInteger &lt; 0) {</span>
<a href="#l40.109"></a><span id="l40.109">             percentCompleteInteger = 0;</span>
<a href="#l40.110"></a><span id="l40.110">         } else if (percentCompleteInteger &gt; 100) {</span>
<a href="#l40.111"></a><span id="l40.111" class="difflineat">@@ -686,17 +686,17 @@ function loadDialog(aItem) {</span>
<a href="#l40.112"></a><span id="l40.112">             itemProps.initialPercentComplete = percentCompleteInteger;</span>
<a href="#l40.113"></a><span id="l40.113">         } else {</span>
<a href="#l40.114"></a><span id="l40.114">             setElementValue(&quot;percent-complete-textbox&quot;, percentCompleteInteger);</span>
<a href="#l40.115"></a><span id="l40.115">         }</span>
<a href="#l40.116"></a><span id="l40.116">     }</span>
<a href="#l40.117"></a><span id="l40.117"> </span>
<a href="#l40.118"></a><span id="l40.118">     // When in a window, set Item-Menu label to Event or Task</span>
<a href="#l40.119"></a><span id="l40.119">     if (!gInTab) {</span>
<a href="#l40.120"></a><span id="l40.120" class="difflineminus">-        let isEvent = cal.isEvent(aItem);</span>
<a href="#l40.121"></a><span id="l40.121" class="difflineplus">+        let isEvent = cal.item.isEvent(aItem);</span>
<a href="#l40.122"></a><span id="l40.122"> </span>
<a href="#l40.123"></a><span id="l40.123">         let labelString = isEvent ? &quot;itemMenuLabelEvent&quot; : &quot;itemMenuLabelTask&quot;;</span>
<a href="#l40.124"></a><span id="l40.124">         let label = cal.calGetString(&quot;calendar-event-dialog&quot;, labelString);</span>
<a href="#l40.125"></a><span id="l40.125"> </span>
<a href="#l40.126"></a><span id="l40.126">         let accessKeyString = isEvent ? &quot;itemMenuAccesskeyEvent2&quot; : &quot;itemMenuAccesskeyTask2&quot;;</span>
<a href="#l40.127"></a><span id="l40.127">         let accessKey = cal.calGetString(&quot;calendar-event-dialog&quot;, accessKeyString);</span>
<a href="#l40.128"></a><span id="l40.128">         sendMessage({</span>
<a href="#l40.129"></a><span id="l40.129">             command: &quot;initializeItemMenu&quot;,</span>
<a href="#l40.130"></a><span id="l40.130" class="difflineat">@@ -762,17 +762,17 @@ function loadDialog(aItem) {</span>
<a href="#l40.131"></a><span id="l40.131">         disallowcounterCheckbox.disabled = !!window.counterProposal;</span>
<a href="#l40.132"></a><span id="l40.132"> </span>
<a href="#l40.133"></a><span id="l40.133">         updateAttendees();</span>
<a href="#l40.134"></a><span id="l40.134">         updateRepeat(true);</span>
<a href="#l40.135"></a><span id="l40.135">         updateReminder(true);</span>
<a href="#l40.136"></a><span id="l40.136">     }</span>
<a href="#l40.137"></a><span id="l40.137"> </span>
<a href="#l40.138"></a><span id="l40.138">     // Status</span>
<a href="#l40.139"></a><span id="l40.139" class="difflineminus">-    if (cal.isEvent(aItem)) {</span>
<a href="#l40.140"></a><span id="l40.140" class="difflineplus">+    if (cal.item.isEvent(aItem)) {</span>
<a href="#l40.141"></a><span id="l40.141">         gConfig.status = aItem.hasProperty(&quot;STATUS&quot;) ?</span>
<a href="#l40.142"></a><span id="l40.142">             aItem.getProperty(&quot;STATUS&quot;) : &quot;NONE&quot;;</span>
<a href="#l40.143"></a><span id="l40.143">         if (gConfig.status == &quot;NONE&quot;) {</span>
<a href="#l40.144"></a><span id="l40.144">             sendMessage({ command: &quot;showCmdStatusNone&quot; });</span>
<a href="#l40.145"></a><span id="l40.145">         }</span>
<a href="#l40.146"></a><span id="l40.146">         updateConfigState({ status: gConfig.status });</span>
<a href="#l40.147"></a><span id="l40.147">         if (gNewItemUI) {</span>
<a href="#l40.148"></a><span id="l40.148">             itemProps.initialStatus = gConfig.status;</span>
<a href="#l40.149"></a><span id="l40.149" class="difflineat">@@ -887,17 +887,17 @@ function saveCategories(aItem) {</span>
<a href="#l40.150"></a><span id="l40.150"> </span>
<a href="#l40.151"></a><span id="l40.151"> /**</span>
<a href="#l40.152"></a><span id="l40.152">  * Sets up all date related controls from the passed item</span>
<a href="#l40.153"></a><span id="l40.153">  *</span>
<a href="#l40.154"></a><span id="l40.154">  * @param item      The item to parse information out of.</span>
<a href="#l40.155"></a><span id="l40.155">  */</span>
<a href="#l40.156"></a><span id="l40.156"> function loadDateTime(item) {</span>
<a href="#l40.157"></a><span id="l40.157">     let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l40.158"></a><span id="l40.158" class="difflineminus">-    if (cal.isEvent(item)) {</span>
<a href="#l40.159"></a><span id="l40.159" class="difflineplus">+    if (cal.item.isEvent(item)) {</span>
<a href="#l40.160"></a><span id="l40.160">         let startTime = item.startDate;</span>
<a href="#l40.161"></a><span id="l40.161">         let endTime = item.endDate;</span>
<a href="#l40.162"></a><span id="l40.162">         let duration = endTime.subtractDate(startTime);</span>
<a href="#l40.163"></a><span id="l40.163"> </span>
<a href="#l40.164"></a><span id="l40.164">         // Check if an all-day event has been passed in (to adapt endDate).</span>
<a href="#l40.165"></a><span id="l40.165">         if (startTime.isDate) {</span>
<a href="#l40.166"></a><span id="l40.166">             startTime = startTime.clone();</span>
<a href="#l40.167"></a><span id="l40.167">             endTime = endTime.clone();</span>
<a href="#l40.168"></a><span id="l40.168" class="difflineat">@@ -911,17 +911,17 @@ function loadDateTime(item) {</span>
<a href="#l40.169"></a><span id="l40.169">         // separately.</span>
<a href="#l40.170"></a><span id="l40.170">         gStartTimezone = startTime.timezone;</span>
<a href="#l40.171"></a><span id="l40.171">         gEndTimezone = endTime.timezone;</span>
<a href="#l40.172"></a><span id="l40.172">         gStartTime = startTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l40.173"></a><span id="l40.173">         gEndTime = endTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l40.174"></a><span id="l40.174">         gItemDuration = duration;</span>
<a href="#l40.175"></a><span id="l40.175">     }</span>
<a href="#l40.176"></a><span id="l40.176"> </span>
<a href="#l40.177"></a><span id="l40.177" class="difflineminus">-    if (cal.isToDo(item)) {</span>
<a href="#l40.178"></a><span id="l40.178" class="difflineplus">+    if (cal.item.isToDo(item)) {</span>
<a href="#l40.179"></a><span id="l40.179">         let startTime = null;</span>
<a href="#l40.180"></a><span id="l40.180">         let endTime = null;</span>
<a href="#l40.181"></a><span id="l40.181">         let duration = null;</span>
<a href="#l40.182"></a><span id="l40.182"> </span>
<a href="#l40.183"></a><span id="l40.183">         let hasEntryDate = (item.entryDate != null);</span>
<a href="#l40.184"></a><span id="l40.184">         if (hasEntryDate) {</span>
<a href="#l40.185"></a><span id="l40.185">             startTime = item.entryDate;</span>
<a href="#l40.186"></a><span id="l40.186">             gStartTimezone = startTime.timezone;</span>
<a href="#l40.187"></a><span id="l40.187" class="difflineat">@@ -987,17 +987,17 @@ function dateTimeControls2State(aStartDa</span>
<a href="#l40.188"></a><span id="l40.188">     if (gIgnoreUpdate) {</span>
<a href="#l40.189"></a><span id="l40.189">         return;</span>
<a href="#l40.190"></a><span id="l40.190">     }</span>
<a href="#l40.191"></a><span id="l40.191">     let keepAttribute = document.getElementById(&quot;keepduration-button&quot;)</span>
<a href="#l40.192"></a><span id="l40.192">                                 .getAttribute(&quot;keep&quot;) == &quot;true&quot;;</span>
<a href="#l40.193"></a><span id="l40.193">     let allDay = getElementValue(&quot;event-all-day&quot;, &quot;checked&quot;);</span>
<a href="#l40.194"></a><span id="l40.194">     let startWidgetId;</span>
<a href="#l40.195"></a><span id="l40.195">     let endWidgetId;</span>
<a href="#l40.196"></a><span id="l40.196" class="difflineminus">-    if (cal.isEvent(window.calendarItem)) {</span>
<a href="#l40.197"></a><span id="l40.197" class="difflineplus">+    if (cal.item.isEvent(window.calendarItem)) {</span>
<a href="#l40.198"></a><span id="l40.198">         startWidgetId = &quot;event-starttime&quot;;</span>
<a href="#l40.199"></a><span id="l40.199">         endWidgetId = &quot;event-endtime&quot;;</span>
<a href="#l40.200"></a><span id="l40.200">     } else {</span>
<a href="#l40.201"></a><span id="l40.201">         if (!getElementValue(&quot;todo-has-entrydate&quot;, &quot;checked&quot;)) {</span>
<a href="#l40.202"></a><span id="l40.202">             gItemDuration = null;</span>
<a href="#l40.203"></a><span id="l40.203">         }</span>
<a href="#l40.204"></a><span id="l40.204">         if (!getElementValue(&quot;todo-has-duedate&quot;, &quot;checked&quot;)) {</span>
<a href="#l40.205"></a><span id="l40.205">             gItemDuration = null;</span>
<a href="#l40.206"></a><span id="l40.206" class="difflineat">@@ -1176,17 +1176,17 @@ function updateDueDate() {</span>
<a href="#l40.207"></a><span id="l40.207">  * @param aDateTime         An object implementing the isValid and setDateTime</span>
<a href="#l40.208"></a><span id="l40.208">  *                            methods. XXX explain.</span>
<a href="#l40.209"></a><span id="l40.209">  */</span>
<a href="#l40.210"></a><span id="l40.210"> function updateDateCheckboxes(aDatePickerId, aCheckboxId, aDateTime) {</span>
<a href="#l40.211"></a><span id="l40.211">     if (gIgnoreUpdate) {</span>
<a href="#l40.212"></a><span id="l40.212">         return;</span>
<a href="#l40.213"></a><span id="l40.213">     }</span>
<a href="#l40.214"></a><span id="l40.214"> </span>
<a href="#l40.215"></a><span id="l40.215" class="difflineminus">-    if (!cal.isToDo(window.calendarItem)) {</span>
<a href="#l40.216"></a><span id="l40.216" class="difflineplus">+    if (!cal.item.isToDo(window.calendarItem)) {</span>
<a href="#l40.217"></a><span id="l40.217">         return;</span>
<a href="#l40.218"></a><span id="l40.218">     }</span>
<a href="#l40.219"></a><span id="l40.219"> </span>
<a href="#l40.220"></a><span id="l40.220">     // force something to get set if there was nothing there before</span>
<a href="#l40.221"></a><span id="l40.221">     setElementValue(aDatePickerId, getElementValue(aDatePickerId));</span>
<a href="#l40.222"></a><span id="l40.222"> </span>
<a href="#l40.223"></a><span id="l40.223">     // first of all disable the datetime picker if we don't have a date</span>
<a href="#l40.224"></a><span id="l40.224">     let hasDate = getElementValue(aCheckboxId, &quot;checked&quot;);</span>
<a href="#l40.225"></a><span id="l40.225" class="difflineat">@@ -1378,64 +1378,64 @@ function updateReminder(aSuppressDialogs</span>
<a href="#l40.226"></a><span id="l40.226">  * Saves all values the user chose on the dialog to the passed item</span>
<a href="#l40.227"></a><span id="l40.227">  *</span>
<a href="#l40.228"></a><span id="l40.228">  * @param item    The item to save to.</span>
<a href="#l40.229"></a><span id="l40.229">  */</span>
<a href="#l40.230"></a><span id="l40.230"> function saveDialog(item) {</span>
<a href="#l40.231"></a><span id="l40.231">     // Calendar</span>
<a href="#l40.232"></a><span id="l40.232">     item.calendar = getCurrentCalendar();</span>
<a href="#l40.233"></a><span id="l40.233"> </span>
<a href="#l40.234"></a><span id="l40.234" class="difflineminus">-    cal.setItemProperty(item, &quot;title&quot;, getElementValue(&quot;item-title&quot;));</span>
<a href="#l40.235"></a><span id="l40.235" class="difflineminus">-    cal.setItemProperty(item, &quot;LOCATION&quot;, getElementValue(&quot;item-location&quot;));</span>
<a href="#l40.236"></a><span id="l40.236" class="difflineplus">+    cal.item.setItemProperty(item, &quot;title&quot;, getElementValue(&quot;item-title&quot;));</span>
<a href="#l40.237"></a><span id="l40.237" class="difflineplus">+    cal.item.setItemProperty(item, &quot;LOCATION&quot;, getElementValue(&quot;item-location&quot;));</span>
<a href="#l40.238"></a><span id="l40.238"> </span>
<a href="#l40.239"></a><span id="l40.239">     saveDateTime(item);</span>
<a href="#l40.240"></a><span id="l40.240"> </span>
<a href="#l40.241"></a><span id="l40.241" class="difflineminus">-    if (cal.isToDo(item)) {</span>
<a href="#l40.242"></a><span id="l40.242" class="difflineplus">+    if (cal.item.isToDo(item)) {</span>
<a href="#l40.243"></a><span id="l40.243">         let percentCompleteInteger = 0;</span>
<a href="#l40.244"></a><span id="l40.244">         if (getElementValue(&quot;percent-complete-textbox&quot;) != &quot;&quot;) {</span>
<a href="#l40.245"></a><span id="l40.245">             percentCompleteInteger =</span>
<a href="#l40.246"></a><span id="l40.246">                 parseInt(getElementValue(&quot;percent-complete-textbox&quot;), 10);</span>
<a href="#l40.247"></a><span id="l40.247">         }</span>
<a href="#l40.248"></a><span id="l40.248">         if (percentCompleteInteger &lt; 0) {</span>
<a href="#l40.249"></a><span id="l40.249">             percentCompleteInteger = 0;</span>
<a href="#l40.250"></a><span id="l40.250">         } else if (percentCompleteInteger &gt; 100) {</span>
<a href="#l40.251"></a><span id="l40.251">             percentCompleteInteger = 100;</span>
<a href="#l40.252"></a><span id="l40.252">         }</span>
<a href="#l40.253"></a><span id="l40.253" class="difflineminus">-        cal.setItemProperty(item, &quot;PERCENT-COMPLETE&quot;, percentCompleteInteger);</span>
<a href="#l40.254"></a><span id="l40.254" class="difflineplus">+        cal.item.setItemProperty(item, &quot;PERCENT-COMPLETE&quot;, percentCompleteInteger);</span>
<a href="#l40.255"></a><span id="l40.255">     }</span>
<a href="#l40.256"></a><span id="l40.256"> </span>
<a href="#l40.257"></a><span id="l40.257">     // Categories</span>
<a href="#l40.258"></a><span id="l40.258">     saveCategories(item);</span>
<a href="#l40.259"></a><span id="l40.259"> </span>
<a href="#l40.260"></a><span id="l40.260">     // Attachment</span>
<a href="#l40.261"></a><span id="l40.261">     // We want the attachments to be up to date, remove all first.</span>
<a href="#l40.262"></a><span id="l40.262">     item.removeAllAttachments();</span>
<a href="#l40.263"></a><span id="l40.263"> </span>
<a href="#l40.264"></a><span id="l40.264">     // Now add back the new ones</span>
<a href="#l40.265"></a><span id="l40.265">     for (let hashId in gAttachMap) {</span>
<a href="#l40.266"></a><span id="l40.266">         let att = gAttachMap[hashId];</span>
<a href="#l40.267"></a><span id="l40.267">         item.addAttachment(att);</span>
<a href="#l40.268"></a><span id="l40.268">     }</span>
<a href="#l40.269"></a><span id="l40.269"> </span>
<a href="#l40.270"></a><span id="l40.270">     // Description</span>
<a href="#l40.271"></a><span id="l40.271" class="difflineminus">-    cal.setItemProperty(item, &quot;DESCRIPTION&quot;, getElementValue(&quot;item-description&quot;));</span>
<a href="#l40.272"></a><span id="l40.272" class="difflineplus">+    cal.item.setItemProperty(item, &quot;DESCRIPTION&quot;, getElementValue(&quot;item-description&quot;));</span>
<a href="#l40.273"></a><span id="l40.273"> </span>
<a href="#l40.274"></a><span id="l40.274">     // Event Status</span>
<a href="#l40.275"></a><span id="l40.275" class="difflineminus">-    if (cal.isEvent(item)) {</span>
<a href="#l40.276"></a><span id="l40.276" class="difflineplus">+    if (cal.item.isEvent(item)) {</span>
<a href="#l40.277"></a><span id="l40.277">         if (gConfig.status &amp;&amp; gConfig.status != &quot;NONE&quot;) {</span>
<a href="#l40.278"></a><span id="l40.278">             item.setProperty(&quot;STATUS&quot;, gConfig.status);</span>
<a href="#l40.279"></a><span id="l40.279">         } else {</span>
<a href="#l40.280"></a><span id="l40.280">             item.deleteProperty(&quot;STATUS&quot;);</span>
<a href="#l40.281"></a><span id="l40.281">         }</span>
<a href="#l40.282"></a><span id="l40.282">     } else {</span>
<a href="#l40.283"></a><span id="l40.283">         let status = getElementValue(&quot;todo-status&quot;);</span>
<a href="#l40.284"></a><span id="l40.284">         if (status != &quot;COMPLETED&quot;) {</span>
<a href="#l40.285"></a><span id="l40.285">             item.completedDate = null;</span>
<a href="#l40.286"></a><span id="l40.286">         }</span>
<a href="#l40.287"></a><span id="l40.287" class="difflineminus">-        cal.setItemProperty(item, &quot;STATUS&quot;, status == &quot;NONE&quot; ? null : status);</span>
<a href="#l40.288"></a><span id="l40.288" class="difflineplus">+        cal.item.setItemProperty(item, &quot;STATUS&quot;, status == &quot;NONE&quot; ? null : status);</span>
<a href="#l40.289"></a><span id="l40.289">     }</span>
<a href="#l40.290"></a><span id="l40.290"> </span>
<a href="#l40.291"></a><span id="l40.291">     // set the &quot;PRIORITY&quot; property if a valid priority has been</span>
<a href="#l40.292"></a><span id="l40.292">     // specified (any integer value except *null*) OR the item</span>
<a href="#l40.293"></a><span id="l40.293">     // already specifies a priority. in any other case we don't</span>
<a href="#l40.294"></a><span id="l40.294">     // need this property and can safely delete it. we need this special</span>
<a href="#l40.295"></a><span id="l40.295">     // handling since the WCAP provider always includes the priority</span>
<a href="#l40.296"></a><span id="l40.296">     // with value *null* and we don't detect changes to this item if</span>
<a href="#l40.297"></a><span id="l40.297" class="difflineat">@@ -1450,59 +1450,59 @@ function saveDialog(item) {</span>
<a href="#l40.298"></a><span id="l40.298">     // Transparency</span>
<a href="#l40.299"></a><span id="l40.299">     if (gConfig.showTimeAs) {</span>
<a href="#l40.300"></a><span id="l40.300">         item.setProperty(&quot;TRANSP&quot;, gConfig.showTimeAs);</span>
<a href="#l40.301"></a><span id="l40.301">     } else {</span>
<a href="#l40.302"></a><span id="l40.302">         item.deleteProperty(&quot;TRANSP&quot;);</span>
<a href="#l40.303"></a><span id="l40.303">     }</span>
<a href="#l40.304"></a><span id="l40.304"> </span>
<a href="#l40.305"></a><span id="l40.305">     // Privacy</span>
<a href="#l40.306"></a><span id="l40.306" class="difflineminus">-    cal.setItemProperty(item, &quot;CLASS&quot;, gConfig.privacy, &quot;privacy&quot;);</span>
<a href="#l40.307"></a><span id="l40.307" class="difflineminus">-</span>
<a href="#l40.308"></a><span id="l40.308" class="difflineminus">-    if (item.status == &quot;COMPLETED&quot; &amp;&amp; cal.isToDo(item)) {</span>
<a href="#l40.309"></a><span id="l40.309" class="difflineplus">+    cal.item.setItemProperty(item, &quot;CLASS&quot;, gConfig.privacy, &quot;privacy&quot;);</span>
<a href="#l40.310"></a><span id="l40.310" class="difflineplus">+</span>
<a href="#l40.311"></a><span id="l40.311" class="difflineplus">+    if (item.status == &quot;COMPLETED&quot; &amp;&amp; cal.item.isToDo(item)) {</span>
<a href="#l40.312"></a><span id="l40.312">         let elementValue = getElementValue(&quot;completed-date-picker&quot;);</span>
<a href="#l40.313"></a><span id="l40.313">         item.completedDate = cal.dtz.jsDateToDateTime(elementValue);</span>
<a href="#l40.314"></a><span id="l40.314">     }</span>
<a href="#l40.315"></a><span id="l40.315"> </span>
<a href="#l40.316"></a><span id="l40.316">     saveReminder(item);</span>
<a href="#l40.317"></a><span id="l40.317"> }</span>
<a href="#l40.318"></a><span id="l40.318"> </span>
<a href="#l40.319"></a><span id="l40.319"> /**</span>
<a href="#l40.320"></a><span id="l40.320">  * Save date and time related values from the dialog to the passed item.</span>
<a href="#l40.321"></a><span id="l40.321">  *</span>
<a href="#l40.322"></a><span id="l40.322">  * @param item    The item to save to.</span>
<a href="#l40.323"></a><span id="l40.323">  */</span>
<a href="#l40.324"></a><span id="l40.324"> function saveDateTime(item) {</span>
<a href="#l40.325"></a><span id="l40.325">     // Changes to the start date don't have to change the until date.</span>
<a href="#l40.326"></a><span id="l40.326">     untilDateCompensation(item);</span>
<a href="#l40.327"></a><span id="l40.327"> </span>
<a href="#l40.328"></a><span id="l40.328" class="difflineminus">-    if (cal.isEvent(item)) {</span>
<a href="#l40.329"></a><span id="l40.329" class="difflineplus">+    if (cal.item.isEvent(item)) {</span>
<a href="#l40.330"></a><span id="l40.330">         let startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l40.331"></a><span id="l40.331">         let endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l40.332"></a><span id="l40.332">         let isAllDay = getElementValue(&quot;event-all-day&quot;, &quot;checked&quot;);</span>
<a href="#l40.333"></a><span id="l40.333">         if (isAllDay) {</span>
<a href="#l40.334"></a><span id="l40.334">             startTime = startTime.clone();</span>
<a href="#l40.335"></a><span id="l40.335">             endTime = endTime.clone();</span>
<a href="#l40.336"></a><span id="l40.336">             startTime.isDate = true;</span>
<a href="#l40.337"></a><span id="l40.337">             endTime.isDate = true;</span>
<a href="#l40.338"></a><span id="l40.338">             endTime.day += 1;</span>
<a href="#l40.339"></a><span id="l40.339">         } else {</span>
<a href="#l40.340"></a><span id="l40.340">             startTime = startTime.clone();</span>
<a href="#l40.341"></a><span id="l40.341">             startTime.isDate = false;</span>
<a href="#l40.342"></a><span id="l40.342">             endTime = endTime.clone();</span>
<a href="#l40.343"></a><span id="l40.343">             endTime.isDate = false;</span>
<a href="#l40.344"></a><span id="l40.344">         }</span>
<a href="#l40.345"></a><span id="l40.345" class="difflineminus">-        cal.setItemProperty(item, &quot;startDate&quot;, startTime);</span>
<a href="#l40.346"></a><span id="l40.346" class="difflineminus">-        cal.setItemProperty(item, &quot;endDate&quot;, endTime);</span>
<a href="#l40.347"></a><span id="l40.347" class="difflineplus">+        cal.item.setItemProperty(item, &quot;startDate&quot;, startTime);</span>
<a href="#l40.348"></a><span id="l40.348" class="difflineplus">+        cal.item.setItemProperty(item, &quot;endDate&quot;, endTime);</span>
<a href="#l40.349"></a><span id="l40.349">     }</span>
<a href="#l40.350"></a><span id="l40.350" class="difflineminus">-    if (cal.isToDo(item)) {</span>
<a href="#l40.351"></a><span id="l40.351" class="difflineplus">+    if (cal.item.isToDo(item)) {</span>
<a href="#l40.352"></a><span id="l40.352">         let startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l40.353"></a><span id="l40.353">         let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l40.354"></a><span id="l40.354" class="difflineminus">-        cal.setItemProperty(item, &quot;entryDate&quot;, startTime);</span>
<a href="#l40.355"></a><span id="l40.355" class="difflineminus">-        cal.setItemProperty(item, &quot;dueDate&quot;, endTime);</span>
<a href="#l40.356"></a><span id="l40.356" class="difflineplus">+        cal.item.setItemProperty(item, &quot;entryDate&quot;, startTime);</span>
<a href="#l40.357"></a><span id="l40.357" class="difflineplus">+        cal.item.setItemProperty(item, &quot;dueDate&quot;, endTime);</span>
<a href="#l40.358"></a><span id="l40.358">     }</span>
<a href="#l40.359"></a><span id="l40.359"> }</span>
<a href="#l40.360"></a><span id="l40.360"> </span>
<a href="#l40.361"></a><span id="l40.361"> /**</span>
<a href="#l40.362"></a><span id="l40.362">  * Changes the until date in the rule in order to compensate the automatic</span>
<a href="#l40.363"></a><span id="l40.363">  * correction caused by the function onStartDateChange() when saving the</span>
<a href="#l40.364"></a><span id="l40.364">  * item.</span>
<a href="#l40.365"></a><span id="l40.365">  * It allows to keep the until date set in the dialog irrespective of the</span>
<a href="#l40.366"></a><span id="l40.366" class="difflineat">@@ -1528,19 +1528,19 @@ function untilDateCompensation(aItem) {</span>
<a href="#l40.367"></a><span id="l40.367"> }</span>
<a href="#l40.368"></a><span id="l40.368"> </span>
<a href="#l40.369"></a><span id="l40.369"> /**</span>
<a href="#l40.370"></a><span id="l40.370">  * Updates the dialog title based on item type and if the item is new or to be</span>
<a href="#l40.371"></a><span id="l40.371">  * modified.</span>
<a href="#l40.372"></a><span id="l40.372">  */</span>
<a href="#l40.373"></a><span id="l40.373"> function updateTitle() {</span>
<a href="#l40.374"></a><span id="l40.374">     let strName;</span>
<a href="#l40.375"></a><span id="l40.375" class="difflineminus">-    if (cal.isEvent(window.calendarItem)) {</span>
<a href="#l40.376"></a><span id="l40.376" class="difflineplus">+    if (cal.item.isEvent(window.calendarItem)) {</span>
<a href="#l40.377"></a><span id="l40.377">         strName = (window.mode == &quot;new&quot; ? &quot;newEventDialog&quot; : &quot;editEventDialog&quot;);</span>
<a href="#l40.378"></a><span id="l40.378" class="difflineminus">-    } else if (cal.isToDo(window.calendarItem)) {</span>
<a href="#l40.379"></a><span id="l40.379" class="difflineplus">+    } else if (cal.item.isToDo(window.calendarItem)) {</span>
<a href="#l40.380"></a><span id="l40.380">         strName = (window.mode == &quot;new&quot; ? &quot;newTaskDialog&quot; : &quot;editTaskDialog&quot;);</span>
<a href="#l40.381"></a><span id="l40.381">     } else {</span>
<a href="#l40.382"></a><span id="l40.382">         throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l40.383"></a><span id="l40.383">     }</span>
<a href="#l40.384"></a><span id="l40.384">     let newTitle = cal.calGetString(&quot;calendar&quot;, strName) + &quot;: &quot; +</span>
<a href="#l40.385"></a><span id="l40.385">                       getElementValue(&quot;item-title&quot;);</span>
<a href="#l40.386"></a><span id="l40.386">     sendMessage({ command: &quot;updateTitle&quot;, argument: newTitle });</span>
<a href="#l40.387"></a><span id="l40.387"> }</span>
<a href="#l40.388"></a><span id="l40.388" class="difflineat">@@ -1550,17 +1550,17 @@ function updateTitle() {</span>
<a href="#l40.389"></a><span id="l40.389">  * parts of the dialog have options selected that make sense.</span>
<a href="#l40.390"></a><span id="l40.390">  * constraining factors like</span>
<a href="#l40.391"></a><span id="l40.391">  */</span>
<a href="#l40.392"></a><span id="l40.392"> function updateAccept() {</span>
<a href="#l40.393"></a><span id="l40.393">     let enableAccept = true;</span>
<a href="#l40.394"></a><span id="l40.394">     let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l40.395"></a><span id="l40.395">     let startDate;</span>
<a href="#l40.396"></a><span id="l40.396">     let endDate;</span>
<a href="#l40.397"></a><span id="l40.397" class="difflineminus">-    let isEvent = cal.isEvent(window.calendarItem);</span>
<a href="#l40.398"></a><span id="l40.398" class="difflineplus">+    let isEvent = cal.item.isEvent(window.calendarItem);</span>
<a href="#l40.399"></a><span id="l40.399"> </span>
<a href="#l40.400"></a><span id="l40.400">     // don't allow for end dates to be before start dates</span>
<a href="#l40.401"></a><span id="l40.401">     if (isEvent) {</span>
<a href="#l40.402"></a><span id="l40.402">         startDate = cal.dtz.jsDateToDateTime(getElementValue(&quot;event-starttime&quot;));</span>
<a href="#l40.403"></a><span id="l40.403">         endDate = cal.dtz.jsDateToDateTime(getElementValue(&quot;event-endtime&quot;));</span>
<a href="#l40.404"></a><span id="l40.404">     } else {</span>
<a href="#l40.405"></a><span id="l40.405">         startDate = getElementValue(&quot;todo-has-entrydate&quot;, &quot;checked&quot;) ?</span>
<a href="#l40.406"></a><span id="l40.406">             cal.dtz.jsDateToDateTime(getElementValue(&quot;todo-entrydate&quot;)) : null;</span>
<a href="#l40.407"></a><span id="l40.407" class="difflineat">@@ -1632,17 +1632,17 @@ var gOldEndTime = null;</span>
<a href="#l40.408"></a><span id="l40.408"> var gOldStartTimezone = null;</span>
<a href="#l40.409"></a><span id="l40.409"> var gOldEndTimezone = null;</span>
<a href="#l40.410"></a><span id="l40.410"> </span>
<a href="#l40.411"></a><span id="l40.411"> /**</span>
<a href="#l40.412"></a><span id="l40.412">  * Handler function to update controls and state in consequence of the &quot;all</span>
<a href="#l40.413"></a><span id="l40.413">  * day&quot; checkbox being clicked.</span>
<a href="#l40.414"></a><span id="l40.414">  */</span>
<a href="#l40.415"></a><span id="l40.415"> function onUpdateAllDay() {</span>
<a href="#l40.416"></a><span id="l40.416" class="difflineminus">-    if (!cal.isEvent(window.calendarItem)) {</span>
<a href="#l40.417"></a><span id="l40.417" class="difflineplus">+    if (!cal.item.isEvent(window.calendarItem)) {</span>
<a href="#l40.418"></a><span id="l40.418">         return;</span>
<a href="#l40.419"></a><span id="l40.419">     }</span>
<a href="#l40.420"></a><span id="l40.420">     let allDay = getElementValue(&quot;event-all-day&quot;, &quot;checked&quot;);</span>
<a href="#l40.421"></a><span id="l40.421">     let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l40.422"></a><span id="l40.422"> </span>
<a href="#l40.423"></a><span id="l40.423">     if (allDay) {</span>
<a href="#l40.424"></a><span id="l40.424">         // Store date-times and related timezones so we can restore</span>
<a href="#l40.425"></a><span id="l40.425">         // if the user unchecks the &quot;all day&quot; checkbox.</span>
<a href="#l40.426"></a><span id="l40.426" class="difflineat">@@ -1701,17 +1701,17 @@ function onUpdateAllDay() {</span>
<a href="#l40.427"></a><span id="l40.427">  * - 'timezone-endtime'</span>
<a href="#l40.428"></a><span id="l40.428">  * the state depends on whether or not the event is configured as 'all-day' or not.</span>
<a href="#l40.429"></a><span id="l40.429">  */</span>
<a href="#l40.430"></a><span id="l40.430"> function updateAllDay() {</span>
<a href="#l40.431"></a><span id="l40.431">     if (gIgnoreUpdate) {</span>
<a href="#l40.432"></a><span id="l40.432">         return;</span>
<a href="#l40.433"></a><span id="l40.433">     }</span>
<a href="#l40.434"></a><span id="l40.434"> </span>
<a href="#l40.435"></a><span id="l40.435" class="difflineminus">-    if (!cal.isEvent(window.calendarItem)) {</span>
<a href="#l40.436"></a><span id="l40.436" class="difflineplus">+    if (!cal.item.isEvent(window.calendarItem)) {</span>
<a href="#l40.437"></a><span id="l40.437">         return;</span>
<a href="#l40.438"></a><span id="l40.438">     }</span>
<a href="#l40.439"></a><span id="l40.439"> </span>
<a href="#l40.440"></a><span id="l40.440">     let allDay = getElementValue(&quot;event-all-day&quot;, &quot;checked&quot;);</span>
<a href="#l40.441"></a><span id="l40.441">     setElementValue(&quot;event-starttime&quot;, allDay, &quot;timepickerdisabled&quot;);</span>
<a href="#l40.442"></a><span id="l40.442">     setElementValue(&quot;event-endtime&quot;, allDay, &quot;timepickerdisabled&quot;);</span>
<a href="#l40.443"></a><span id="l40.443"> </span>
<a href="#l40.444"></a><span id="l40.444">     gStartTime.isDate = allDay;</span>
<a href="#l40.445"></a><span id="l40.445" class="difflineat">@@ -1746,17 +1746,17 @@ function openNewTask() {</span>
<a href="#l40.446"></a><span id="l40.446"> </span>
<a href="#l40.447"></a><span id="l40.447"> /**</span>
<a href="#l40.448"></a><span id="l40.448">  * Update the transparency status of this dialog, depending on if the event</span>
<a href="#l40.449"></a><span id="l40.449">  * is all-day or not.</span>
<a href="#l40.450"></a><span id="l40.450">  *</span>
<a href="#l40.451"></a><span id="l40.451">  * @param allDay    If true, the event is all-day</span>
<a href="#l40.452"></a><span id="l40.452">  */</span>
<a href="#l40.453"></a><span id="l40.453"> function setShowTimeAs(allDay) {</span>
<a href="#l40.454"></a><span id="l40.454" class="difflineminus">-    gConfig.showTimeAs = cal.getEventDefaultTransparency(allDay);</span>
<a href="#l40.455"></a><span id="l40.455" class="difflineplus">+    gConfig.showTimeAs = cal.item.getEventDefaultTransparency(allDay);</span>
<a href="#l40.456"></a><span id="l40.456">     updateConfigState({ showTimeAs: gConfig.showTimeAs });</span>
<a href="#l40.457"></a><span id="l40.457"> }</span>
<a href="#l40.458"></a><span id="l40.458"> </span>
<a href="#l40.459"></a><span id="l40.459"> function editAttendees() {</span>
<a href="#l40.460"></a><span id="l40.460">     let savedWindow = window;</span>
<a href="#l40.461"></a><span id="l40.461">     let calendar = getCurrentCalendar();</span>
<a href="#l40.462"></a><span id="l40.462"> </span>
<a href="#l40.463"></a><span id="l40.463">     let callback = function(attendees, organizer, startTime, endTime) {</span>
<a href="#l40.464"></a><span id="l40.464" class="difflineat">@@ -1861,17 +1861,17 @@ function updateConfigState(aArg) {</span>
<a href="#l40.465"></a><span id="l40.465">             hasPrivacy: capSupported(&quot;privacy&quot;),</span>
<a href="#l40.466"></a><span id="l40.466">             calendarType: getCurrentCalendar().type,</span>
<a href="#l40.467"></a><span id="l40.467">             privacyValues: capValues(&quot;privacy&quot;,</span>
<a href="#l40.468"></a><span id="l40.468">                             [&quot;PUBLIC&quot;, &quot;CONFIDENTIAL&quot;, &quot;PRIVATE&quot;])</span>
<a href="#l40.469"></a><span id="l40.469">         });</span>
<a href="#l40.470"></a><span id="l40.470">     }</span>
<a href="#l40.471"></a><span id="l40.471"> </span>
<a href="#l40.472"></a><span id="l40.472">     // For tasks, do not include showTimeAs</span>
<a href="#l40.473"></a><span id="l40.473" class="difflineminus">-    if (aArg.hasOwnProperty(&quot;showTimeAs&quot;) &amp;&amp; cal.isToDo(window.calendarItem)) {</span>
<a href="#l40.474"></a><span id="l40.474" class="difflineplus">+    if (aArg.hasOwnProperty(&quot;showTimeAs&quot;) &amp;&amp; cal.item.isToDo(window.calendarItem)) {</span>
<a href="#l40.475"></a><span id="l40.475">         delete aArg.showTimeAs;</span>
<a href="#l40.476"></a><span id="l40.476">         if (Object.keys(aArg).length == 0) {</span>
<a href="#l40.477"></a><span id="l40.477">             return;</span>
<a href="#l40.478"></a><span id="l40.478">         }</span>
<a href="#l40.479"></a><span id="l40.479">     }</span>
<a href="#l40.480"></a><span id="l40.480"> </span>
<a href="#l40.481"></a><span id="l40.481">     sendMessage({ command: &quot;updateConfigState&quot;, argument: aArg });</span>
<a href="#l40.482"></a><span id="l40.482"> }</span>
<a href="#l40.483"></a><span id="l40.483" class="difflineat">@@ -2521,17 +2521,17 @@ function editRepeat() {</span>
<a href="#l40.484"></a><span id="l40.484">  * @param aItemRepeatCall      True when the function is being called from</span>
<a href="#l40.485"></a><span id="l40.485">  *                               the item-repeat menu list. It allows to detect</span>
<a href="#l40.486"></a><span id="l40.486">  *                               a change from the &quot;custom&quot; option.</span>
<a href="#l40.487"></a><span id="l40.487">  */</span>
<a href="#l40.488"></a><span id="l40.488"> function updateRepeat(aSuppressDialogs, aItemRepeatCall) {</span>
<a href="#l40.489"></a><span id="l40.489">     function setUpEntrydateForTask(item) {</span>
<a href="#l40.490"></a><span id="l40.490">         // if this item is a task, we need to make sure that it has</span>
<a href="#l40.491"></a><span id="l40.491">         // an entry-date, otherwise we can't create a recurrence.</span>
<a href="#l40.492"></a><span id="l40.492" class="difflineminus">-        if (cal.isToDo(item)) {</span>
<a href="#l40.493"></a><span id="l40.493" class="difflineplus">+        if (cal.item.isToDo(item)) {</span>
<a href="#l40.494"></a><span id="l40.494">             // automatically check 'has entrydate' if needed.</span>
<a href="#l40.495"></a><span id="l40.495">             if (!getElementValue(&quot;todo-has-entrydate&quot;, &quot;checked&quot;)) {</span>
<a href="#l40.496"></a><span id="l40.496">                 setElementValue(&quot;todo-has-entrydate&quot;, &quot;true&quot;, &quot;checked&quot;);</span>
<a href="#l40.497"></a><span id="l40.497"> </span>
<a href="#l40.498"></a><span id="l40.498">                 // make sure gStartTime is properly initialized</span>
<a href="#l40.499"></a><span id="l40.499">                 updateEntryDate();</span>
<a href="#l40.500"></a><span id="l40.500">             }</span>
<a href="#l40.501"></a><span id="l40.501"> </span>
<a href="#l40.502"></a><span id="l40.502" class="difflineat">@@ -2545,17 +2545,17 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l40.503"></a><span id="l40.503">     let repeatMenu = document.getElementById(&quot;item-repeat&quot;);</span>
<a href="#l40.504"></a><span id="l40.504">     let repeatValue = repeatMenu.selectedItem.getAttribute(&quot;value&quot;);</span>
<a href="#l40.505"></a><span id="l40.505">     let repeatDeck = document.getElementById(&quot;repeat-deck&quot;);</span>
<a href="#l40.506"></a><span id="l40.506"> </span>
<a href="#l40.507"></a><span id="l40.507">     if (repeatValue == &quot;none&quot;) {</span>
<a href="#l40.508"></a><span id="l40.508">         repeatDeck.selectedIndex = -1;</span>
<a href="#l40.509"></a><span id="l40.509">         window.recurrenceInfo = null;</span>
<a href="#l40.510"></a><span id="l40.510">         let item = window.calendarItem;</span>
<a href="#l40.511"></a><span id="l40.511" class="difflineminus">-        if (cal.isToDo(item)) {</span>
<a href="#l40.512"></a><span id="l40.512" class="difflineplus">+        if (cal.item.isToDo(item)) {</span>
<a href="#l40.513"></a><span id="l40.513">             enableElementWithLock(&quot;todo-has-entrydate&quot;, &quot;repeat-lock&quot;);</span>
<a href="#l40.514"></a><span id="l40.514">         }</span>
<a href="#l40.515"></a><span id="l40.515">     } else if (repeatValue == &quot;custom&quot;) {</span>
<a href="#l40.516"></a><span id="l40.516">         let lastRepeatDeck = repeatDeck.selectedIndex;</span>
<a href="#l40.517"></a><span id="l40.517">         repeatDeck.selectedIndex = 1;</span>
<a href="#l40.518"></a><span id="l40.518">         // the user selected custom repeat pattern. we now need to bring</span>
<a href="#l40.519"></a><span id="l40.519">         // up the appropriate dialog in order to let the user specify the</span>
<a href="#l40.520"></a><span id="l40.520">         // new rule. First of all, retrieve the item we want to specify</span>
<a href="#l40.521"></a><span id="l40.521" class="difflineat">@@ -2594,17 +2594,17 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l40.522"></a><span id="l40.522">         //   - re-enable the 'has entrydate' option in case</span>
<a href="#l40.523"></a><span id="l40.523">         //     we didn't end up with a recurrence rule.</span>
<a href="#l40.524"></a><span id="l40.524">         // 2)  Check whether the new recurrence rule needs the</span>
<a href="#l40.525"></a><span id="l40.525">         //     recurrence details text or it can be displayed</span>
<a href="#l40.526"></a><span id="l40.526">         //     only with the repeat-until-datepicker.</span>
<a href="#l40.527"></a><span id="l40.527">         if (recurrenceInfo == window.recurrenceInfo) {</span>
<a href="#l40.528"></a><span id="l40.528">             repeatMenu.selectedIndex = gLastRepeatSelection;</span>
<a href="#l40.529"></a><span id="l40.529">             repeatDeck.selectedIndex = lastRepeatDeck;</span>
<a href="#l40.530"></a><span id="l40.530" class="difflineminus">-            if (cal.isToDo(item)) {</span>
<a href="#l40.531"></a><span id="l40.531" class="difflineplus">+            if (cal.item.isToDo(item)) {</span>
<a href="#l40.532"></a><span id="l40.532">                 if (!window.recurrenceInfo) {</span>
<a href="#l40.533"></a><span id="l40.533">                     enableElementWithLock(&quot;todo-has-entrydate&quot;, &quot;repeat-lock&quot;);</span>
<a href="#l40.534"></a><span id="l40.534">                 }</span>
<a href="#l40.535"></a><span id="l40.535">             }</span>
<a href="#l40.536"></a><span id="l40.536">         } else {</span>
<a href="#l40.537"></a><span id="l40.537">             // From the Edit Recurrence dialog, the rules &quot;every day&quot; and</span>
<a href="#l40.538"></a><span id="l40.538">             // &quot;every weekday&quot; don't need the recurrence details text when they</span>
<a href="#l40.539"></a><span id="l40.539">             // have only the until date. The getRepeatTypeAndUntilDate()</span>
<a href="#l40.540"></a><span id="l40.540" class="difflineat">@@ -2693,17 +2693,17 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l40.541"></a><span id="l40.541">         }</span>
<a href="#l40.542"></a><span id="l40.542"> </span>
<a href="#l40.543"></a><span id="l40.543">         setUpEntrydateForTask(item);</span>
<a href="#l40.544"></a><span id="l40.544">         updateUntildateRecRule(recRule);</span>
<a href="#l40.545"></a><span id="l40.545"> </span>
<a href="#l40.546"></a><span id="l40.546">         recurrenceInfo.insertRecurrenceItemAt(recRule, 0);</span>
<a href="#l40.547"></a><span id="l40.547">         window.recurrenceInfo = recurrenceInfo;</span>
<a href="#l40.548"></a><span id="l40.548"> </span>
<a href="#l40.549"></a><span id="l40.549" class="difflineminus">-        if (cal.isToDo(item)) {</span>
<a href="#l40.550"></a><span id="l40.550" class="difflineplus">+        if (cal.item.isToDo(item)) {</span>
<a href="#l40.551"></a><span id="l40.551">             if (!getElementValue(&quot;todo-has-entrydate&quot;, &quot;checked&quot;)) {</span>
<a href="#l40.552"></a><span id="l40.552">                 setElementValue(&quot;todo-has-entrydate&quot;, &quot;true&quot;, &quot;checked&quot;);</span>
<a href="#l40.553"></a><span id="l40.553">             }</span>
<a href="#l40.554"></a><span id="l40.554">             disableElementWithLock(&quot;todo-has-entrydate&quot;, &quot;repeat-lock&quot;);</span>
<a href="#l40.555"></a><span id="l40.555">         }</span>
<a href="#l40.556"></a><span id="l40.556"> </span>
<a href="#l40.557"></a><span id="l40.557">         // Preset the until-datepicker's minimonth to the start date.</span>
<a href="#l40.558"></a><span id="l40.558">         let startDate = cal.dtz.dateTimeToJsDate(gStartTime.getInTimezone(cal.dtz.floating));</span>
<a href="#l40.559"></a><span id="l40.559" class="difflineat">@@ -3019,20 +3019,20 @@ function onCommandSave(aIsClosing) {</span>
<a href="#l40.560"></a><span id="l40.560">  *</span>
<a href="#l40.561"></a><span id="l40.561">  */</span>
<a href="#l40.562"></a><span id="l40.562"> function onCommandDeleteItem() {</span>
<a href="#l40.563"></a><span id="l40.563">     // only ask for confirmation, if the User changed anything on a new item or we modify an existing item</span>
<a href="#l40.564"></a><span id="l40.564">     if (isItemChanged() || window.mode != &quot;new&quot;) {</span>
<a href="#l40.565"></a><span id="l40.565">         let promptTitle = &quot;&quot;;</span>
<a href="#l40.566"></a><span id="l40.566">         let promptMessage = &quot;&quot;;</span>
<a href="#l40.567"></a><span id="l40.567"> </span>
<a href="#l40.568"></a><span id="l40.568" class="difflineminus">-        if (cal.isEvent(window.calendarItem)) {</span>
<a href="#l40.569"></a><span id="l40.569" class="difflineplus">+        if (cal.item.isEvent(window.calendarItem)) {</span>
<a href="#l40.570"></a><span id="l40.570">             promptTitle = cal.calGetString(&quot;calendar&quot;, &quot;deleteEventLabel&quot;);</span>
<a href="#l40.571"></a><span id="l40.571">             promptMessage = cal.calGetString(&quot;calendar&quot;, &quot;deleteEventMessage&quot;);</span>
<a href="#l40.572"></a><span id="l40.572" class="difflineminus">-        } else if (cal.isToDo(window.calendarItem)) {</span>
<a href="#l40.573"></a><span id="l40.573" class="difflineplus">+        } else if (cal.item.isToDo(window.calendarItem)) {</span>
<a href="#l40.574"></a><span id="l40.574">             promptTitle = cal.calGetString(&quot;calendar&quot;, &quot;deleteTaskLabel&quot;);</span>
<a href="#l40.575"></a><span id="l40.575">             promptMessage = cal.calGetString(&quot;calendar&quot;, &quot;deleteTaskMessage&quot;);</span>
<a href="#l40.576"></a><span id="l40.576">         }</span>
<a href="#l40.577"></a><span id="l40.577"> </span>
<a href="#l40.578"></a><span id="l40.578">         let answerDelete = Services.prompt.confirm(</span>
<a href="#l40.579"></a><span id="l40.579">                                     null,</span>
<a href="#l40.580"></a><span id="l40.580">                                     promptTitle,</span>
<a href="#l40.581"></a><span id="l40.581">                                     promptMessage);</span>
<a href="#l40.582"></a><span id="l40.582" class="difflineat">@@ -3242,17 +3242,17 @@ function editTimezone(aElementId, aDateT</span>
<a href="#l40.583"></a><span id="l40.583"> function updateDateTime() {</span>
<a href="#l40.584"></a><span id="l40.584">     gIgnoreUpdate = true;</span>
<a href="#l40.585"></a><span id="l40.585"> </span>
<a href="#l40.586"></a><span id="l40.586">     let item = window.calendarItem;</span>
<a href="#l40.587"></a><span id="l40.587">     // Convert to default timezone if the timezone option</span>
<a href="#l40.588"></a><span id="l40.588">     // is *not* checked, otherwise keep the specific timezone</span>
<a href="#l40.589"></a><span id="l40.589">     // and display the labels in order to modify the timezone.</span>
<a href="#l40.590"></a><span id="l40.590">     if (gTimezonesEnabled) {</span>
<a href="#l40.591"></a><span id="l40.591" class="difflineminus">-        if (cal.isEvent(item)) {</span>
<a href="#l40.592"></a><span id="l40.592" class="difflineplus">+        if (cal.item.isEvent(item)) {</span>
<a href="#l40.593"></a><span id="l40.593">             let startTime = gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l40.594"></a><span id="l40.594">             let endTime = gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l40.595"></a><span id="l40.595"> </span>
<a href="#l40.596"></a><span id="l40.596">             setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l40.597"></a><span id="l40.597"> </span>
<a href="#l40.598"></a><span id="l40.598">             // In the case where the timezones are different but</span>
<a href="#l40.599"></a><span id="l40.599">             // the timezone of the endtime is &quot;UTC&quot;, we convert</span>
<a href="#l40.600"></a><span id="l40.600">             // the endtime into the timezone of the starttime.</span>
<a href="#l40.601"></a><span id="l40.601" class="difflineat">@@ -3269,17 +3269,17 @@ function updateDateTime() {</span>
<a href="#l40.602"></a><span id="l40.602">             // automatic conversion back into the OS timezone.</span>
<a href="#l40.603"></a><span id="l40.603">             startTime.timezone = cal.dtz.floating;</span>
<a href="#l40.604"></a><span id="l40.604">             endTime.timezone = cal.dtz.floating;</span>
<a href="#l40.605"></a><span id="l40.605"> </span>
<a href="#l40.606"></a><span id="l40.606">             setElementValue(&quot;event-starttime&quot;, cal.dtz.dateTimeToJsDate(startTime));</span>
<a href="#l40.607"></a><span id="l40.607">             setElementValue(&quot;event-endtime&quot;, cal.dtz.dateTimeToJsDate(endTime));</span>
<a href="#l40.608"></a><span id="l40.608">         }</span>
<a href="#l40.609"></a><span id="l40.609"> </span>
<a href="#l40.610"></a><span id="l40.610" class="difflineminus">-        if (cal.isToDo(item)) {</span>
<a href="#l40.611"></a><span id="l40.611" class="difflineplus">+        if (cal.item.isToDo(item)) {</span>
<a href="#l40.612"></a><span id="l40.612">             let startTime = gStartTime &amp;&amp; gStartTime.getInTimezone(gStartTimezone);</span>
<a href="#l40.613"></a><span id="l40.613">             let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(gEndTimezone);</span>
<a href="#l40.614"></a><span id="l40.614">             let hasEntryDate = (startTime != null);</span>
<a href="#l40.615"></a><span id="l40.615">             let hasDueDate = (endTime != null);</span>
<a href="#l40.616"></a><span id="l40.616"> </span>
<a href="#l40.617"></a><span id="l40.617">             if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l40.618"></a><span id="l40.618">                 setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l40.619"></a><span id="l40.619">                 startTime.timezone = cal.dtz.floating;</span>
<a href="#l40.620"></a><span id="l40.620" class="difflineat">@@ -3309,31 +3309,31 @@ function updateDateTime() {</span>
<a href="#l40.621"></a><span id="l40.621"> </span>
<a href="#l40.622"></a><span id="l40.622">                 setElementValue(&quot;todo-entrydate&quot;, cal.dtz.dateTimeToJsDate(startTime));</span>
<a href="#l40.623"></a><span id="l40.623">                 setElementValue(&quot;todo-duedate&quot;, cal.dtz.dateTimeToJsDate(endTime));</span>
<a href="#l40.624"></a><span id="l40.624">             }</span>
<a href="#l40.625"></a><span id="l40.625">         }</span>
<a href="#l40.626"></a><span id="l40.626">     } else {</span>
<a href="#l40.627"></a><span id="l40.627">         let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l40.628"></a><span id="l40.628"> </span>
<a href="#l40.629"></a><span id="l40.629" class="difflineminus">-        if (cal.isEvent(item)) {</span>
<a href="#l40.630"></a><span id="l40.630" class="difflineplus">+        if (cal.item.isEvent(item)) {</span>
<a href="#l40.631"></a><span id="l40.631">             let startTime = gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l40.632"></a><span id="l40.632">             let endTime = gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l40.633"></a><span id="l40.633">             setElementValue(&quot;event-all-day&quot;, startTime.isDate, &quot;checked&quot;);</span>
<a href="#l40.634"></a><span id="l40.634"> </span>
<a href="#l40.635"></a><span id="l40.635">             // before feeding the date/time value into the control we need</span>
<a href="#l40.636"></a><span id="l40.636">             // to set the timezone to 'floating' in order to avoid the</span>
<a href="#l40.637"></a><span id="l40.637">             // automatic conversion back into the OS timezone.</span>
<a href="#l40.638"></a><span id="l40.638">             startTime.timezone = cal.dtz.floating;</span>
<a href="#l40.639"></a><span id="l40.639">             endTime.timezone = cal.dtz.floating;</span>
<a href="#l40.640"></a><span id="l40.640">             setElementValue(&quot;event-starttime&quot;, cal.dtz.dateTimeToJsDate(startTime));</span>
<a href="#l40.641"></a><span id="l40.641">             setElementValue(&quot;event-endtime&quot;, cal.dtz.dateTimeToJsDate(endTime));</span>
<a href="#l40.642"></a><span id="l40.642">         }</span>
<a href="#l40.643"></a><span id="l40.643"> </span>
<a href="#l40.644"></a><span id="l40.644" class="difflineminus">-        if (cal.isToDo(item)) {</span>
<a href="#l40.645"></a><span id="l40.645" class="difflineplus">+        if (cal.item.isToDo(item)) {</span>
<a href="#l40.646"></a><span id="l40.646">             let startTime = gStartTime &amp;&amp;</span>
<a href="#l40.647"></a><span id="l40.647">                             gStartTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l40.648"></a><span id="l40.648">             let endTime = gEndTime &amp;&amp; gEndTime.getInTimezone(kDefaultTimezone);</span>
<a href="#l40.649"></a><span id="l40.649">             let hasEntryDate = (startTime != null);</span>
<a href="#l40.650"></a><span id="l40.650">             let hasDueDate = (endTime != null);</span>
<a href="#l40.651"></a><span id="l40.651"> </span>
<a href="#l40.652"></a><span id="l40.652">             if (hasEntryDate &amp;&amp; hasDueDate) {</span>
<a href="#l40.653"></a><span id="l40.653">                 setElementValue(&quot;todo-has-entrydate&quot;, hasEntryDate, &quot;checked&quot;);</span>
<a href="#l40.654"></a><span id="l40.654" class="difflineat">@@ -3515,17 +3515,17 @@ function updateItemURL(aShow, aUrl) {</span>
<a href="#l40.655"></a><span id="l40.655"> </span>
<a href="#l40.656"></a><span id="l40.656"> /**</span>
<a href="#l40.657"></a><span id="l40.657">  * This function updates dialog controls related to attendees.</span>
<a href="#l40.658"></a><span id="l40.658">  */</span>
<a href="#l40.659"></a><span id="l40.659"> function updateAttendees() {</span>
<a href="#l40.660"></a><span id="l40.660">     // sending email invitations currently only supported for events</span>
<a href="#l40.661"></a><span id="l40.661">     let attendeeTab = document.getElementById(&quot;event-grid-tab-attendees&quot;);</span>
<a href="#l40.662"></a><span id="l40.662">     let attendeePanel = document.getElementById(&quot;event-grid-tabpanel-attendees&quot;);</span>
<a href="#l40.663"></a><span id="l40.663" class="difflineminus">-    if (cal.isEvent(window.calendarItem)) {</span>
<a href="#l40.664"></a><span id="l40.664" class="difflineplus">+    if (cal.item.isEvent(window.calendarItem)) {</span>
<a href="#l40.665"></a><span id="l40.665">         attendeeTab.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l40.666"></a><span id="l40.666">         attendeePanel.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l40.667"></a><span id="l40.667"> </span>
<a href="#l40.668"></a><span id="l40.668">         if (window.organizer &amp;&amp; window.organizer.id) {</span>
<a href="#l40.669"></a><span id="l40.669">             document.getElementById(&quot;item-organizer-row&quot;).removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l40.670"></a><span id="l40.670">             let cell = document.querySelector(&quot;.item-organizer-cell&quot;);</span>
<a href="#l40.671"></a><span id="l40.671">             let icon = cell.querySelector(&quot;img:nth-of-type(1)&quot;);</span>
<a href="#l40.672"></a><span id="l40.672">             let text = cell.querySelector(&quot;label:nth-of-type(1)&quot;);</span>
<a href="#l40.673"></a><span id="l40.673" class="difflineat">@@ -3576,17 +3576,17 @@ function updateRepeatDetails() {</span>
<a href="#l40.674"></a><span id="l40.674">         // create a details string, we simply don't show anything.</span>
<a href="#l40.675"></a><span id="l40.675">         // this could happen if the repeat rule is something exotic</span>
<a href="#l40.676"></a><span id="l40.676">         // we don't have any strings prepared for.</span>
<a href="#l40.677"></a><span id="l40.677">         let repeatDetails = document.getElementById(&quot;repeat-details&quot;);</span>
<a href="#l40.678"></a><span id="l40.678">         repeatDetails.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l40.679"></a><span id="l40.679"> </span>
<a href="#l40.680"></a><span id="l40.680">         // Try to create a descriptive string from the rule(s).</span>
<a href="#l40.681"></a><span id="l40.681">         let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l40.682"></a><span id="l40.682" class="difflineminus">-        let event = cal.isEvent(item);</span>
<a href="#l40.683"></a><span id="l40.683" class="difflineplus">+        let event = cal.item.isEvent(item);</span>
<a href="#l40.684"></a><span id="l40.684"> </span>
<a href="#l40.685"></a><span id="l40.685">         let startDate = getElementValue(event ? &quot;event-starttime&quot; : &quot;todo-entrydate&quot;);</span>
<a href="#l40.686"></a><span id="l40.686">         let endDate = getElementValue(event ? &quot;event-endtime&quot; : &quot;todo-duedate&quot;);</span>
<a href="#l40.687"></a><span id="l40.687">         startDate = cal.dtz.jsDateToDateTime(startDate, kDefaultTimezone);</span>
<a href="#l40.688"></a><span id="l40.688">         endDate = cal.dtz.jsDateToDateTime(endDate, kDefaultTimezone);</span>
<a href="#l40.689"></a><span id="l40.689"> </span>
<a href="#l40.690"></a><span id="l40.690">         let allDay = getElementValue(&quot;event-all-day&quot;, &quot;checked&quot;);</span>
<a href="#l40.691"></a><span id="l40.691">         let detailsString = recurrenceRule2String(recurrenceInfo, startDate,</span>
<a href="#l40.692"></a><span id="l40.692" class="difflineat">@@ -3765,23 +3765,23 @@ function updateCapabilities() {</span>
<a href="#l40.693"></a><span id="l40.693"> function isItemChanged() {</span>
<a href="#l40.694"></a><span id="l40.694">     let newItem = saveItem();</span>
<a href="#l40.695"></a><span id="l40.695">     let oldItem = window.calendarItem.clone();</span>
<a href="#l40.696"></a><span id="l40.696"> </span>
<a href="#l40.697"></a><span id="l40.697">     // we need to guide the description text through the text-field since</span>
<a href="#l40.698"></a><span id="l40.698">     // newlines are getting converted which would indicate changes to the</span>
<a href="#l40.699"></a><span id="l40.699">     // text.</span>
<a href="#l40.700"></a><span id="l40.700">     setElementValue(&quot;item-description&quot;, oldItem.getProperty(&quot;DESCRIPTION&quot;));</span>
<a href="#l40.701"></a><span id="l40.701" class="difflineminus">-    cal.setItemProperty(oldItem,</span>
<a href="#l40.702"></a><span id="l40.702" class="difflineplus">+    cal.item.setItemProperty(oldItem,</span>
<a href="#l40.703"></a><span id="l40.703">                         &quot;DESCRIPTION&quot;,</span>
<a href="#l40.704"></a><span id="l40.704">                         getElementValue(&quot;item-description&quot;));</span>
<a href="#l40.705"></a><span id="l40.705">     setElementValue(&quot;item-description&quot;, newItem.getProperty(&quot;DESCRIPTION&quot;));</span>
<a href="#l40.706"></a><span id="l40.706"> </span>
<a href="#l40.707"></a><span id="l40.707">     if ((newItem.calendar.id == oldItem.calendar.id) &amp;&amp;</span>
<a href="#l40.708"></a><span id="l40.708" class="difflineminus">-        cal.compareItemContent(newItem, oldItem)) {</span>
<a href="#l40.709"></a><span id="l40.709" class="difflineplus">+        cal.item.compareContent(newItem, oldItem)) {</span>
<a href="#l40.710"></a><span id="l40.710">         return false;</span>
<a href="#l40.711"></a><span id="l40.711">     }</span>
<a href="#l40.712"></a><span id="l40.712">     return true;</span>
<a href="#l40.713"></a><span id="l40.713"> }</span>
<a href="#l40.714"></a><span id="l40.714"> </span>
<a href="#l40.715"></a><span id="l40.715"> /**</span>
<a href="#l40.716"></a><span id="l40.716">  * Test if a specific capability is supported</span>
<a href="#l40.717"></a><span id="l40.717">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -260,17 +260,17 @@ function onLoadLightningItemPanel(aIfram</span>
<a href="#l41.4"></a><span id="l41.4">         // set toolbar icon color for light or dark themes</span>
<a href="#l41.5"></a><span id="l41.5">         if (typeof ToolbarIconColor !== &quot;undefined&quot;) {</span>
<a href="#l41.6"></a><span id="l41.6">             ToolbarIconColor.init();</span>
<a href="#l41.7"></a><span id="l41.7">         }</span>
<a href="#l41.8"></a><span id="l41.8">     }</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10">     // event or task</span>
<a href="#l41.11"></a><span id="l41.11">     let calendarItem = iframe.contentWindow.arguments[0].calendarEvent;</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    gConfig.isEvent = cal.isEvent(calendarItem);</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+    gConfig.isEvent = cal.item.isEvent(calendarItem);</span>
<a href="#l41.14"></a><span id="l41.14"> </span>
<a href="#l41.15"></a><span id="l41.15">     // for tasks in a window dialog, set the dialog id for CSS selection, etc.</span>
<a href="#l41.16"></a><span id="l41.16">     if (!gTabmail &amp;&amp; !gConfig.isEvent) {</span>
<a href="#l41.17"></a><span id="l41.17">         setDialogId(document.documentElement, &quot;calendar-task-dialog&quot;);</span>
<a href="#l41.18"></a><span id="l41.18">     }</span>
<a href="#l41.19"></a><span id="l41.19"> </span>
<a href="#l41.20"></a><span id="l41.20">     // timezones enabled</span>
<a href="#l41.21"></a><span id="l41.21">     gConfig.timezonesEnabled = getTimezoneCommandState();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -529,17 +529,17 @@ ltn.invitation = {</span>
<a href="#l42.4"></a><span id="l42.4">      * @return {JSObject}                          Objcet of result and differences of parsing</span>
<a href="#l42.5"></a><span id="l42.5">      * @return {String} JsObject.result.type       Parsing result: OK|OLDVERSION|ERROR|NODIFF</span>
<a href="#l42.6"></a><span id="l42.6">      * @return {String} JsObject.result.descr      Parsing result description</span>
<a href="#l42.7"></a><span id="l42.7">      * @return {Array}  JsObject.differences       Array of objects consisting of property, proposed</span>
<a href="#l42.8"></a><span id="l42.8">      *                                                 and original properties.</span>
<a href="#l42.9"></a><span id="l42.9">      * @return {String} JsObject.comment           A comment of the attendee, if any</span>
<a href="#l42.10"></a><span id="l42.10">      */</span>
<a href="#l42.11"></a><span id="l42.11">     parseCounter: function(aProposedItem, aExistingItem) {</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-        let isEvent = cal.isEvent(aProposedItem);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+        let isEvent = cal.item.isEvent(aProposedItem);</span>
<a href="#l42.14"></a><span id="l42.14">         // atm we only support a subset of properties, for a full list see RfC 5546 section 3.2.7</span>
<a href="#l42.15"></a><span id="l42.15">         let properties = [&quot;SUMMARY&quot;, &quot;LOCATION&quot;, &quot;DTSTART&quot;, &quot;DTEND&quot;, &quot;COMMENT&quot;];</span>
<a href="#l42.16"></a><span id="l42.16">         if (!isEvent) {</span>
<a href="#l42.17"></a><span id="l42.17">             cal.LOG(&quot;Parsing of counterproposals is currently only supported for events.&quot;);</span>
<a href="#l42.18"></a><span id="l42.18">             properties = [];</span>
<a href="#l42.19"></a><span id="l42.19">         }</span>
<a href="#l42.20"></a><span id="l42.20"> </span>
<a href="#l42.21"></a><span id="l42.21">         let diff = [];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -641,17 +641,17 @@ calDavCalendar.prototype = {</span>
<a href="#l43.4"></a><span id="l43.4">         }</span>
<a href="#l43.5"></a><span id="l43.5"> </span>
<a href="#l43.6"></a><span id="l43.6">         if (aItem.id == null) {</span>
<a href="#l43.7"></a><span id="l43.7">             notifyListener(Components.results.NS_ERROR_FAILURE,</span>
<a href="#l43.8"></a><span id="l43.8">                            &quot;Can't set ID on non-mutable item to addItem&quot;);</span>
<a href="#l43.9"></a><span id="l43.9">             return;</span>
<a href="#l43.10"></a><span id="l43.10">         }</span>
<a href="#l43.11"></a><span id="l43.11"> </span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-        if (!cal.isItemSupported(aItem, this)) {</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+        if (!cal.item.isItemSupported(aItem, this)) {</span>
<a href="#l43.14"></a><span id="l43.14">             notifyListener(Components.results.NS_ERROR_FAILURE,</span>
<a href="#l43.15"></a><span id="l43.15">                            &quot;Server does not support item type&quot;);</span>
<a href="#l43.16"></a><span id="l43.16">             return;</span>
<a href="#l43.17"></a><span id="l43.17">         }</span>
<a href="#l43.18"></a><span id="l43.18"> </span>
<a href="#l43.19"></a><span id="l43.19">         let parentItem = aItem.parentItem;</span>
<a href="#l43.20"></a><span id="l43.20">         parentItem.calendar = this.superCalendar;</span>
<a href="#l43.21"></a><span id="l43.21"> </span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -2413,17 +2413,17 @@ calDavCalendar.prototype = {</span>
<a href="#l43.23"></a><span id="l43.23">         }</span>
<a href="#l43.24"></a><span id="l43.24">         let mailto_aCalId = aCalIdParts.join(&quot;:&quot;);</span>
<a href="#l43.25"></a><span id="l43.25"> </span>
<a href="#l43.26"></a><span id="l43.26">         let self = this;</span>
<a href="#l43.27"></a><span id="l43.27"> </span>
<a href="#l43.28"></a><span id="l43.28">         let organizer = this.calendarUserAddress;</span>
<a href="#l43.29"></a><span id="l43.29"> </span>
<a href="#l43.30"></a><span id="l43.30">         let fbQuery = cal.getIcsService().createIcalComponent(&quot;VCALENDAR&quot;);</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-        cal.calSetProdidVersion(fbQuery);</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+        cal.item.setStaticProps(fbQuery);</span>
<a href="#l43.33"></a><span id="l43.33">         let prop = cal.getIcsService().createIcalProperty(&quot;METHOD&quot;);</span>
<a href="#l43.34"></a><span id="l43.34">         prop.value = &quot;REQUEST&quot;;</span>
<a href="#l43.35"></a><span id="l43.35">         fbQuery.addProperty(prop);</span>
<a href="#l43.36"></a><span id="l43.36">         let fbComp = cal.getIcsService().createIcalComponent(&quot;VFREEBUSY&quot;);</span>
<a href="#l43.37"></a><span id="l43.37">         fbComp.stampTime = cal.dtz.now().getInTimezone(cal.dtz.UTC);</span>
<a href="#l43.38"></a><span id="l43.38">         prop = cal.getIcsService().createIcalProperty(&quot;ORGANIZER&quot;);</span>
<a href="#l43.39"></a><span id="l43.39">         prop.value = organizer;</span>
<a href="#l43.40"></a><span id="l43.40">         fbComp.addProperty(prop);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -354,29 +354,29 @@ calGoogleCalendar.prototype = {</span>
<a href="#l44.4"></a><span id="l44.4">         (async () =&gt; {</span>
<a href="#l44.5"></a><span id="l44.5">             let itemData = ItemToJSON(aItem, this.offlineStorage, isImport);</span>
<a href="#l44.6"></a><span id="l44.6"> </span>
<a href="#l44.7"></a><span id="l44.7">             // Add the calendar to the item, for later use.</span>
<a href="#l44.8"></a><span id="l44.8">             aItem.calendar = this.superCalendar;</span>
<a href="#l44.9"></a><span id="l44.9"> </span>
<a href="#l44.10"></a><span id="l44.10">             request.type = request.ADD;</span>
<a href="#l44.11"></a><span id="l44.11">             request.calendar = this;</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-            if (cal.isEvent(aItem)) {</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+            if (cal.item.isEvent(aItem)) {</span>
<a href="#l44.14"></a><span id="l44.14">                 if (isImport) {</span>
<a href="#l44.15"></a><span id="l44.15">                     cal.LOG(&quot;[calGoogleCalendar] Adding invitation event &quot; + aItem.title);</span>
<a href="#l44.16"></a><span id="l44.16">                     request.uri = this.createEventsURI(&quot;events&quot;, &quot;import&quot;);</span>
<a href="#l44.17"></a><span id="l44.17">                 } else {</span>
<a href="#l44.18"></a><span id="l44.18">                     cal.LOG(&quot;[calGoogleCalendar] Adding regular event &quot; + aItem.title);</span>
<a href="#l44.19"></a><span id="l44.19">                     request.uri = this.createEventsURI(&quot;events&quot;);</span>
<a href="#l44.20"></a><span id="l44.20">                 }</span>
<a href="#l44.21"></a><span id="l44.21"> </span>
<a href="#l44.22"></a><span id="l44.22">                 if (Preferences.get(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l44.23"></a><span id="l44.23">                     request.addQueryParameter(&quot;sendNotifications&quot;, &quot;true&quot;);</span>
<a href="#l44.24"></a><span id="l44.24">                 }</span>
<a href="#l44.25"></a><span id="l44.25" class="difflineminus">-            } else if (cal.isToDo(aItem)) {</span>
<a href="#l44.26"></a><span id="l44.26" class="difflineplus">+            } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l44.27"></a><span id="l44.27">                 cal.LOG(&quot;[calGoogleCalendar] Adding task &quot; + aItem.title);</span>
<a href="#l44.28"></a><span id="l44.28">                 request.uri = this.createTasksURI(&quot;tasks&quot;);</span>
<a href="#l44.29"></a><span id="l44.29">                 // Tasks sent with an id will cause a bad request</span>
<a href="#l44.30"></a><span id="l44.30">                 delete itemData.id;</span>
<a href="#l44.31"></a><span id="l44.31">             }</span>
<a href="#l44.32"></a><span id="l44.32"> </span>
<a href="#l44.33"></a><span id="l44.33">             if (!request.uri) {</span>
<a href="#l44.34"></a><span id="l44.34">                 throw Components.Exception(&quot;Item type not supported&quot;,</span>
<a href="#l44.35"></a><span id="l44.35" class="difflineat">@@ -426,31 +426,31 @@ calGoogleCalendar.prototype = {</span>
<a href="#l44.36"></a><span id="l44.36">                 (aNewItem.recurrenceId ? aNewItem.recurrenceId.icalString :</span>
<a href="#l44.37"></a><span id="l44.37">                 &quot;master item&quot;) + &quot;)&quot;);</span>
<a href="#l44.38"></a><span id="l44.38"> </span>
<a href="#l44.39"></a><span id="l44.39">         // Set up the request</span>
<a href="#l44.40"></a><span id="l44.40">         let request = new calGoogleRequest();</span>
<a href="#l44.41"></a><span id="l44.41">         (async () =&gt; {</span>
<a href="#l44.42"></a><span id="l44.42">             request.type = request.MODIFY;</span>
<a href="#l44.43"></a><span id="l44.43">             request.calendar = this;</span>
<a href="#l44.44"></a><span id="l44.44" class="difflineminus">-            if (cal.isEvent(aNewItem)) {</span>
<a href="#l44.45"></a><span id="l44.45" class="difflineplus">+            if (cal.item.isEvent(aNewItem)) {</span>
<a href="#l44.46"></a><span id="l44.46">                 let googleId = getGoogleId(aNewItem, this.offlineStorage);</span>
<a href="#l44.47"></a><span id="l44.47">                 request.uri = this.createEventsURI(&quot;events&quot;, googleId);</span>
<a href="#l44.48"></a><span id="l44.48"> </span>
<a href="#l44.49"></a><span id="l44.49">                 // Updating invitations often causes a forbidden error becase</span>
<a href="#l44.50"></a><span id="l44.50">                 // some parts are not writable. Using PATCH ignores anything</span>
<a href="#l44.51"></a><span id="l44.51">                 // that isn't allowed.</span>
<a href="#l44.52"></a><span id="l44.52">                 if (cal.isInvitation(aNewItem)) {</span>
<a href="#l44.53"></a><span id="l44.53">                     request.type = request.PATCH;</span>
<a href="#l44.54"></a><span id="l44.54">                 }</span>
<a href="#l44.55"></a><span id="l44.55"> </span>
<a href="#l44.56"></a><span id="l44.56">                 if (Preferences.get(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l44.57"></a><span id="l44.57">                     request.addQueryParameter(&quot;sendNotifications&quot;, &quot;true&quot;);</span>
<a href="#l44.58"></a><span id="l44.58">                 }</span>
<a href="#l44.59"></a><span id="l44.59" class="difflineminus">-            } else if (cal.isToDo(aNewItem)) {</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineplus">+            } else if (cal.item.isToDo(aNewItem)) {</span>
<a href="#l44.61"></a><span id="l44.61">                 request.uri = this.createTasksURI(&quot;tasks&quot;, aNewItem.id);</span>
<a href="#l44.62"></a><span id="l44.62">             }</span>
<a href="#l44.63"></a><span id="l44.63"> </span>
<a href="#l44.64"></a><span id="l44.64">             if (!request.uri) {</span>
<a href="#l44.65"></a><span id="l44.65">                 throw Components.Exception(&quot;Item type not supported&quot;,</span>
<a href="#l44.66"></a><span id="l44.66">                                            Components.results.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l44.67"></a><span id="l44.67">             }</span>
<a href="#l44.68"></a><span id="l44.68"> </span>
<a href="#l44.69"></a><span id="l44.69" class="difflineat">@@ -526,22 +526,22 @@ calGoogleCalendar.prototype = {</span>
<a href="#l44.70"></a><span id="l44.70"> </span>
<a href="#l44.71"></a><span id="l44.71">     deleteItem: function(aItem, aListener) {</span>
<a href="#l44.72"></a><span id="l44.72">         cal.LOG(&quot;[calGoogleCalendar] Deleting item &quot; + aItem.title + &quot;(&quot; + aItem.id + &quot;)&quot;);</span>
<a href="#l44.73"></a><span id="l44.73"> </span>
<a href="#l44.74"></a><span id="l44.74">         let request = new calGoogleRequest();</span>
<a href="#l44.75"></a><span id="l44.75">         (async () =&gt; {</span>
<a href="#l44.76"></a><span id="l44.76">             request.type = request.DELETE;</span>
<a href="#l44.77"></a><span id="l44.77">             request.calendar = this;</span>
<a href="#l44.78"></a><span id="l44.78" class="difflineminus">-            if (cal.isEvent(aItem)) {</span>
<a href="#l44.79"></a><span id="l44.79" class="difflineplus">+            if (cal.item.isEvent(aItem)) {</span>
<a href="#l44.80"></a><span id="l44.80">                 request.uri = this.createEventsURI(&quot;events&quot;, getGoogleId(aItem, this.offlineStorage));</span>
<a href="#l44.81"></a><span id="l44.81">                 if (Preferences.get(&quot;calendar.google.sendEventNotifications&quot;, false)) {</span>
<a href="#l44.82"></a><span id="l44.82">                     request.addQueryParameter(&quot;sendNotifications&quot;, &quot;true&quot;);</span>
<a href="#l44.83"></a><span id="l44.83">                 }</span>
<a href="#l44.84"></a><span id="l44.84" class="difflineminus">-            } else if (cal.isToDo(aItem)) {</span>
<a href="#l44.85"></a><span id="l44.85" class="difflineplus">+            } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l44.86"></a><span id="l44.86">                 request.uri = this.createTasksURI(&quot;tasks&quot;, aItem.id);</span>
<a href="#l44.87"></a><span id="l44.87">             }</span>
<a href="#l44.88"></a><span id="l44.88"> </span>
<a href="#l44.89"></a><span id="l44.89">             if (!request.uri) {</span>
<a href="#l44.90"></a><span id="l44.90">                 throw Components.Exception(&quot;Item type not supported&quot;,</span>
<a href="#l44.91"></a><span id="l44.91">                                            Components.results.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l44.92"></a><span id="l44.92">             }</span>
<a href="#l44.93"></a><span id="l44.93"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-calendar-event-dialog.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-calendar-event-dialog.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -13,18 +13,18 @@ Components.utils.import(&quot;resource://gdat</span>
<a href="#l45.4"></a><span id="l45.4">     if (!(&quot;gOldEndTimezone&quot; in window)) {</span>
<a href="#l45.5"></a><span id="l45.5">         window.gOldEndTimezone = null;</span>
<a href="#l45.6"></a><span id="l45.6">     }</span>
<a href="#l45.7"></a><span id="l45.7"> </span>
<a href="#l45.8"></a><span id="l45.8">     monkeyPatch(window, &quot;updateCalendar&quot;, function(protofunc, ...args) {</span>
<a href="#l45.9"></a><span id="l45.9">         let rv = protofunc.apply(this, args);</span>
<a href="#l45.10"></a><span id="l45.10">         let calendar = getCurrentCalendar();</span>
<a href="#l45.11"></a><span id="l45.11">         let isGoogleCalendar = (calendar.type == &quot;gdata&quot;);</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-        let isTask = cal.isToDo(window.calendarItem);</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineminus">-        let isEvent = cal.isEvent(window.calendarItem);</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineplus">+        let isTask = cal.item.isToDo(window.calendarItem);</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineplus">+        let isEvent = cal.item.isEvent(window.calendarItem);</span>
<a href="#l45.16"></a><span id="l45.16">         let isGoogleTask = isGoogleCalendar &amp;&amp; isTask;</span>
<a href="#l45.17"></a><span id="l45.17">         let isGoogleEvent = isGoogleCalendar &amp;&amp; isEvent;</span>
<a href="#l45.18"></a><span id="l45.18"> </span>
<a href="#l45.19"></a><span id="l45.19">         let hideForTaskIds = [</span>
<a href="#l45.20"></a><span id="l45.20">             &quot;event-grid-location-row&quot;,</span>
<a href="#l45.21"></a><span id="l45.21"> </span>
<a href="#l45.22"></a><span id="l45.22">             &quot;event-grid-startdate-row&quot;,</span>
<a href="#l45.23"></a><span id="l45.23">             &quot;timezone-endtime&quot;,</span>
<a href="#l45.24"></a><span id="l45.24" class="difflineat">@@ -127,17 +127,17 @@ Components.utils.import(&quot;resource://gdat</span>
<a href="#l45.25"></a><span id="l45.25">             }</span>
<a href="#l45.26"></a><span id="l45.26">         }</span>
<a href="#l45.27"></a><span id="l45.27">         return rv;</span>
<a href="#l45.28"></a><span id="l45.28">     });</span>
<a href="#l45.29"></a><span id="l45.29"> </span>
<a href="#l45.30"></a><span id="l45.30">     monkeyPatch(window, &quot;updateCategoryMenulist&quot;, function(protofunc, ...args) {</span>
<a href="#l45.31"></a><span id="l45.31">         let rv;</span>
<a href="#l45.32"></a><span id="l45.32">         let calendar = getCurrentCalendar();</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineminus">-        if (calendar.type == &quot;gdata&quot; &amp;&amp; cal.isToDo(window.calendarItem)) {</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineplus">+        if (calendar.type == &quot;gdata&quot; &amp;&amp; cal.item.isToDo(window.calendarItem)) {</span>
<a href="#l45.35"></a><span id="l45.35">             let unwrappedCal = calendar.getProperty(&quot;cache.uncachedCalendar&quot;).wrappedJSObject;</span>
<a href="#l45.36"></a><span id="l45.36">             unwrappedCal.mProperties['capabilities.categories.maxCount'] = 0;</span>
<a href="#l45.37"></a><span id="l45.37">             rv = protofunc.apply(this, args);</span>
<a href="#l45.38"></a><span id="l45.38">             delete unwrappedCal.mProperties['capabilities.categories.maxCount'];</span>
<a href="#l45.39"></a><span id="l45.39">         } else {</span>
<a href="#l45.40"></a><span id="l45.40">             rv = protofunc.apply(this, args);</span>
<a href="#l45.41"></a><span id="l45.41">         }</span>
<a href="#l45.42"></a><span id="l45.42">         return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/providers/gdata/modules/gdataUtils.jsm</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/providers/gdata/modules/gdataUtils.jsm</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -543,19 +543,19 @@ function TaskToJSON(aItem, aOfflineStora</span>
<a href="#l46.4"></a><span id="l46.4"> /**</span>
<a href="#l46.5"></a><span id="l46.5">  * Convenience function to convert any item type (task/event) to its JSON</span>
<a href="#l46.6"></a><span id="l46.6">  * representation</span>
<a href="#l46.7"></a><span id="l46.7">  *</span>
<a href="#l46.8"></a><span id="l46.8">  * @param aItem         The item to convert</span>
<a href="#l46.9"></a><span id="l46.9">  * @return              A JS Object representing the item.</span>
<a href="#l46.10"></a><span id="l46.10">  */</span>
<a href="#l46.11"></a><span id="l46.11"> function ItemToJSON(aItem, aOfflineStorage, aIsImport) {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-    if (cal.isEvent(aItem)) {</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+    if (cal.item.isEvent(aItem)) {</span>
<a href="#l46.14"></a><span id="l46.14">         return EventToJSON(aItem, aOfflineStorage, aIsImport);</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineminus">-    } else if (cal.isToDo(aItem)) {</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineplus">+    } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l46.17"></a><span id="l46.17">         return TaskToJSON(aItem, aOfflineStorage, aIsImport);</span>
<a href="#l46.18"></a><span id="l46.18">     } else {</span>
<a href="#l46.19"></a><span id="l46.19">         cal.ERROR(&quot;[calGoogleCalendar] Invalid item type: &quot; + aItem.icalString);</span>
<a href="#l46.20"></a><span id="l46.20">         return null;</span>
<a href="#l46.21"></a><span id="l46.21">     }</span>
<a href="#l46.22"></a><span id="l46.22"> }</span>
<a href="#l46.23"></a><span id="l46.23"> </span>
<a href="#l46.24"></a><span id="l46.24"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -221,17 +221,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l47.4"></a><span id="l47.4">                 return reportError(&quot;item ID mismatch between old and new items&quot;);</span>
<a href="#l47.5"></a><span id="l47.5">             }</span>
<a href="#l47.6"></a><span id="l47.6"> </span>
<a href="#l47.7"></a><span id="l47.7">             aOldItem = aOldItem.parentItem;</span>
<a href="#l47.8"></a><span id="l47.8">             let storedOldItem = this.mItems[aOldItem.id];</span>
<a href="#l47.9"></a><span id="l47.9"> </span>
<a href="#l47.10"></a><span id="l47.10">             // compareItems is not suitable here. See bug 418805.</span>
<a href="#l47.11"></a><span id="l47.11">             // Cannot compare here due to bug 380060</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-            if (!cal.compareItemContent(storedOldItem, aOldItem)) {</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+            if (!cal.item.compareContent(storedOldItem, aOldItem)) {</span>
<a href="#l47.14"></a><span id="l47.14">                 return reportError(&quot;old item mismatch in modifyItem. storedId:&quot; + storedOldItem.icalComponent + &quot; old item:&quot; + aOldItem.icalComponent);</span>
<a href="#l47.15"></a><span id="l47.15">             }</span>
<a href="#l47.16"></a><span id="l47.16">             // offline bug</span>
<a href="#l47.17"></a><span id="l47.17"> </span>
<a href="#l47.18"></a><span id="l47.18">             if (aOldItem.generation != storedOldItem.generation) {</span>
<a href="#l47.19"></a><span id="l47.19">                 return reportError(&quot;generation mismatch in modifyItem&quot;);</span>
<a href="#l47.20"></a><span id="l47.20">             }</span>
<a href="#l47.21"></a><span id="l47.21"> </span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -317,19 +317,19 @@ calMemoryCalendar.prototype = {</span>
<a href="#l47.23"></a><span id="l47.23">                                          aId,</span>
<a href="#l47.24"></a><span id="l47.24">                                          null);</span>
<a href="#l47.25"></a><span id="l47.25">             return;</span>
<a href="#l47.26"></a><span id="l47.26">         }</span>
<a href="#l47.27"></a><span id="l47.27"> </span>
<a href="#l47.28"></a><span id="l47.28">         let item = this.mItems[aId];</span>
<a href="#l47.29"></a><span id="l47.29">         let iid = null;</span>
<a href="#l47.30"></a><span id="l47.30"> </span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-        if (cal.isEvent(item)) {</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineplus">+        if (cal.item.isEvent(item)) {</span>
<a href="#l47.33"></a><span id="l47.33">             iid = Components.interfaces.calIEvent;</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineminus">-        } else if (cal.isToDo(item)) {</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineplus">+        } else if (cal.item.isToDo(item)) {</span>
<a href="#l47.36"></a><span id="l47.36">             iid = Components.interfaces.calITodo;</span>
<a href="#l47.37"></a><span id="l47.37">         } else {</span>
<a href="#l47.38"></a><span id="l47.38">             this.notifyOperationComplete(aListener,</span>
<a href="#l47.39"></a><span id="l47.39">                                          Components.results.NS_ERROR_FAILURE,</span>
<a href="#l47.40"></a><span id="l47.40">                                          Components.interfaces.calIOperationListener.GET,</span>
<a href="#l47.41"></a><span id="l47.41">                                          aId,</span>
<a href="#l47.42"></a><span id="l47.42">                                          &quot;Can't deduce item type based on QI&quot;);</span>
<a href="#l47.43"></a><span id="l47.43">             return;</span>
<a href="#l47.44"></a><span id="l47.44" class="difflineat">@@ -441,17 +441,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l47.45"></a><span id="l47.45"> </span>
<a href="#l47.46"></a><span id="l47.46">             return (!reqFlag &amp;&amp;</span>
<a href="#l47.47"></a><span id="l47.47">                     (!itemFlag ||</span>
<a href="#l47.48"></a><span id="l47.48">                      itemFlag != cICL.OFFLINE_FLAG_DELETED_RECORD)) ||</span>
<a href="#l47.49"></a><span id="l47.49">                    itemFlag == reqFlag;</span>
<a href="#l47.50"></a><span id="l47.50">         };</span>
<a href="#l47.51"></a><span id="l47.51"> </span>
<a href="#l47.52"></a><span id="l47.52">         cal.forEach(this.mItems, ([id, item]) =&gt; {</span>
<a href="#l47.53"></a><span id="l47.53" class="difflineminus">-            let isEvent_ = cal.isEvent(item);</span>
<a href="#l47.54"></a><span id="l47.54" class="difflineplus">+            let isEvent_ = cal.item.isEvent(item);</span>
<a href="#l47.55"></a><span id="l47.55">             if (isEvent_) {</span>
<a href="#l47.56"></a><span id="l47.56">                 if (!wantEvents) {</span>
<a href="#l47.57"></a><span id="l47.57">                     return cal.forEach.CONTINUE;</span>
<a href="#l47.58"></a><span id="l47.58">                 }</span>
<a href="#l47.59"></a><span id="l47.59">             } else if (!wantTodos) {</span>
<a href="#l47.60"></a><span id="l47.60">                 return cal.forEach.CONTINUE;</span>
<a href="#l47.61"></a><span id="l47.61">             }</span>
<a href="#l47.62"></a><span id="l47.62"> </span>
<a href="#l47.63"></a><span id="l47.63" class="difflineat">@@ -460,31 +460,31 @@ calMemoryCalendar.prototype = {</span>
<a href="#l47.64"></a><span id="l47.64"> </span>
<a href="#l47.65"></a><span id="l47.65">             // If the offline flag doesn't match, skip the item</span>
<a href="#l47.66"></a><span id="l47.66">             if (!matchOffline(itemFlag, requestedFlag)) {</span>
<a href="#l47.67"></a><span id="l47.67">                 return cal.forEach.CONTINUE;</span>
<a href="#l47.68"></a><span id="l47.68">             }</span>
<a href="#l47.69"></a><span id="l47.69"> </span>
<a href="#l47.70"></a><span id="l47.70">             if (itemReturnOccurrences &amp;&amp; item.recurrenceInfo) {</span>
<a href="#l47.71"></a><span id="l47.71">                 let startDate = aRangeStart;</span>
<a href="#l47.72"></a><span id="l47.72" class="difflineminus">-                if (!aRangeStart &amp;&amp; cal.isToDo(item)) {</span>
<a href="#l47.73"></a><span id="l47.73" class="difflineplus">+                if (!aRangeStart &amp;&amp; cal.item.isToDo(item)) {</span>
<a href="#l47.74"></a><span id="l47.74">                     startDate = item.entryDate;</span>
<a href="#l47.75"></a><span id="l47.75">                 }</span>
<a href="#l47.76"></a><span id="l47.76">                 let occurrences = item.recurrenceInfo.getOccurrences(</span>
<a href="#l47.77"></a><span id="l47.77">                     startDate, aRangeEnd, aCount ? aCount - itemsFound.length : 0, {});</span>
<a href="#l47.78"></a><span id="l47.78">                 if (wantUnrespondedInvitations) {</span>
<a href="#l47.79"></a><span id="l47.79">                     occurrences = occurrences.filter(checkUnrespondedInvitation);</span>
<a href="#l47.80"></a><span id="l47.80">                 }</span>
<a href="#l47.81"></a><span id="l47.81">                 if (!isEvent_) {</span>
<a href="#l47.82"></a><span id="l47.82">                     occurrences = occurrences.filter(checkCompleted);</span>
<a href="#l47.83"></a><span id="l47.83">                 }</span>
<a href="#l47.84"></a><span id="l47.84">                 itemsFound = itemsFound.concat(occurrences);</span>
<a href="#l47.85"></a><span id="l47.85">             } else if ((!wantUnrespondedInvitations || checkUnrespondedInvitation(item)) &amp;&amp;</span>
<a href="#l47.86"></a><span id="l47.86">                        (isEvent_ || checkCompleted(item)) &amp;&amp;</span>
<a href="#l47.87"></a><span id="l47.87" class="difflineminus">-                       cal.checkIfInRange(item, aRangeStart, aRangeEnd)) {</span>
<a href="#l47.88"></a><span id="l47.88" class="difflineplus">+                       cal.item.checkIfInRange(item, aRangeStart, aRangeEnd)) {</span>
<a href="#l47.89"></a><span id="l47.89">                 // This needs fixing for recurring items, e.g. DTSTART of parent may occur before aRangeStart.</span>
<a href="#l47.90"></a><span id="l47.90">                 // This will be changed with bug 416975.</span>
<a href="#l47.91"></a><span id="l47.91">                 itemsFound.push(item);</span>
<a href="#l47.92"></a><span id="l47.92">             }</span>
<a href="#l47.93"></a><span id="l47.93">             if (aCount &amp;&amp; itemsFound.length &gt;= aCount) {</span>
<a href="#l47.94"></a><span id="l47.94">                 return cal.forEach.BREAK;</span>
<a href="#l47.95"></a><span id="l47.95">             }</span>
<a href="#l47.96"></a><span id="l47.96">             return cal.forEach.CONTINUE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -627,19 +627,19 @@ calStorageCalendar.prototype = {</span>
<a href="#l48.4"></a><span id="l48.4">                                          Components.results.NS_OK,</span>
<a href="#l48.5"></a><span id="l48.5">                                          Components.interfaces.calIOperationListener.GET,</span>
<a href="#l48.6"></a><span id="l48.6">                                          aId,</span>
<a href="#l48.7"></a><span id="l48.7">                                          null);</span>
<a href="#l48.8"></a><span id="l48.8">             return;</span>
<a href="#l48.9"></a><span id="l48.9">         }</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11">         let item_iid = null;</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-        if (cal.isEvent(item)) {</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+        if (cal.item.isEvent(item)) {</span>
<a href="#l48.14"></a><span id="l48.14">             item_iid = Components.interfaces.calIEvent;</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineminus">-        } else if (cal.isToDo(item)) {</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineplus">+        } else if (cal.item.isToDo(item)) {</span>
<a href="#l48.17"></a><span id="l48.17">             item_iid = Components.interfaces.calITodo;</span>
<a href="#l48.18"></a><span id="l48.18">         } else {</span>
<a href="#l48.19"></a><span id="l48.19">             this.notifyOperationComplete(aListener,</span>
<a href="#l48.20"></a><span id="l48.20">                                          Components.results.NS_ERROR_FAILURE,</span>
<a href="#l48.21"></a><span id="l48.21">                                          Components.interfaces.calIOperationListener.GET,</span>
<a href="#l48.22"></a><span id="l48.22">                                          aId,</span>
<a href="#l48.23"></a><span id="l48.23">                                          &quot;Can't deduce item type based on QI&quot;);</span>
<a href="#l48.24"></a><span id="l48.24">             return;</span>
<a href="#l48.25"></a><span id="l48.25" class="difflineat">@@ -767,17 +767,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l48.26"></a><span id="l48.26">                 // If the item is recurring, get all ocurrences that fall in</span>
<a href="#l48.27"></a><span id="l48.27">                 // the range. If the item doesn't fall into the range at all,</span>
<a href="#l48.28"></a><span id="l48.28">                 // this expands to 0 items.</span>
<a href="#l48.29"></a><span id="l48.29">                 expandedItems = item.recurrenceInfo.getOccurrences(aRangeStart, aRangeEnd, 0, {});</span>
<a href="#l48.30"></a><span id="l48.30">                 if (wantUnrespondedInvitations) {</span>
<a href="#l48.31"></a><span id="l48.31">                     expandedItems = expandedItems.filter(checkUnrespondedInvitation);</span>
<a href="#l48.32"></a><span id="l48.32">                 }</span>
<a href="#l48.33"></a><span id="l48.33">             } else if ((!wantUnrespondedInvitations || checkUnrespondedInvitation(item)) &amp;&amp;</span>
<a href="#l48.34"></a><span id="l48.34" class="difflineminus">-                       cal.checkIfInRange(item, aRangeStart, aRangeEnd)) {</span>
<a href="#l48.35"></a><span id="l48.35" class="difflineplus">+                       cal.item.checkIfInRange(item, aRangeStart, aRangeEnd)) {</span>
<a href="#l48.36"></a><span id="l48.36">                 // If no occurrences are wanted, check only the parent item.</span>
<a href="#l48.37"></a><span id="l48.37">                 // This will be changed with bug 416975.</span>
<a href="#l48.38"></a><span id="l48.38">                 expandedItems = [item];</span>
<a href="#l48.39"></a><span id="l48.39">             }</span>
<a href="#l48.40"></a><span id="l48.40"> </span>
<a href="#l48.41"></a><span id="l48.41">             if (expandedItems.length &amp;&amp; optionalFilterFunc) {</span>
<a href="#l48.42"></a><span id="l48.42">                 expandedItems = expandedItems.filter(optionalFilterFunc);</span>
<a href="#l48.43"></a><span id="l48.43">             }</span>
<a href="#l48.44"></a><span id="l48.44" class="difflineat">@@ -957,46 +957,46 @@ calStorageCalendar.prototype = {</span>
<a href="#l48.45"></a><span id="l48.45">                     aListener.onOperationComplete(self, Components.results.NS_ERROR_FAILURE,</span>
<a href="#l48.46"></a><span id="l48.46">                                                   Components.interfaces.calIOperationListener.GET, aItem.id, aItem);</span>
<a href="#l48.47"></a><span id="l48.47">                 },</span>
<a href="#l48.48"></a><span id="l48.48">                 handleCompletion: function(aReason) {</span>
<a href="#l48.49"></a><span id="l48.49">                     aListener.onOperationComplete(self, Components.results.NS_OK,</span>
<a href="#l48.50"></a><span id="l48.50">                                                   Components.interfaces.calIOperationListener.GET, aItem.id, flag);</span>
<a href="#l48.51"></a><span id="l48.51">                 }</span>
<a href="#l48.52"></a><span id="l48.52">             };</span>
<a href="#l48.53"></a><span id="l48.53" class="difflineminus">-            if (cal.isEvent(aItem)) {</span>
<a href="#l48.54"></a><span id="l48.54" class="difflineplus">+            if (cal.item.isEvent(aItem)) {</span>
<a href="#l48.55"></a><span id="l48.55">                 this.prepareStatement(this.mSelectEvent);</span>
<a href="#l48.56"></a><span id="l48.56">                 this.mSelectEvent.params.id = aID;</span>
<a href="#l48.57"></a><span id="l48.57">                 this.mSelectEvent.executeAsync(listener);</span>
<a href="#l48.58"></a><span id="l48.58" class="difflineminus">-            } else if (cal.isToDo(aItem)) {</span>
<a href="#l48.59"></a><span id="l48.59" class="difflineplus">+            } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l48.60"></a><span id="l48.60">                 this.prepareStatement(this.mSelectTodo);</span>
<a href="#l48.61"></a><span id="l48.61">                 this.mSelectTodo.params.id = aID;</span>
<a href="#l48.62"></a><span id="l48.62">                 this.mSelectTodo.executeAsync(listener);</span>
<a href="#l48.63"></a><span id="l48.63">             }</span>
<a href="#l48.64"></a><span id="l48.64">         } else {</span>
<a href="#l48.65"></a><span id="l48.65">             // It is possible that aItem can be null, flag provided should be null in this case</span>
<a href="#l48.66"></a><span id="l48.66">             aListener.onOperationComplete(this, Components.results.NS_OK,</span>
<a href="#l48.67"></a><span id="l48.67">                                                Components.interfaces.calIOperationListener.GET, null, flag);</span>
<a href="#l48.68"></a><span id="l48.68">         }</span>
<a href="#l48.69"></a><span id="l48.69">     },</span>
<a href="#l48.70"></a><span id="l48.70"> </span>
<a href="#l48.71"></a><span id="l48.71">     setOfflineJournalFlag: function(aItem, flag) {</span>
<a href="#l48.72"></a><span id="l48.72">         let aID = aItem.id;</span>
<a href="#l48.73"></a><span id="l48.73" class="difflineminus">-        if (cal.isEvent(aItem)) {</span>
<a href="#l48.74"></a><span id="l48.74" class="difflineplus">+        if (cal.item.isEvent(aItem)) {</span>
<a href="#l48.75"></a><span id="l48.75">             this.prepareStatement(this.mEditEventOfflineFlag);</span>
<a href="#l48.76"></a><span id="l48.76">             this.mEditEventOfflineFlag.params.id = aID;</span>
<a href="#l48.77"></a><span id="l48.77">             this.mEditEventOfflineFlag.params.offline_journal = flag || null;</span>
<a href="#l48.78"></a><span id="l48.78">             try {</span>
<a href="#l48.79"></a><span id="l48.79">                 this.mEditEventOfflineFlag.executeStep();</span>
<a href="#l48.80"></a><span id="l48.80">             } catch (e) {</span>
<a href="#l48.81"></a><span id="l48.81">                 this.logError(&quot;Error setting offline journal flag for &quot; + aItem.title, e);</span>
<a href="#l48.82"></a><span id="l48.82">             } finally {</span>
<a href="#l48.83"></a><span id="l48.83">                 this.mEditEventOfflineFlag.reset();</span>
<a href="#l48.84"></a><span id="l48.84">             }</span>
<a href="#l48.85"></a><span id="l48.85" class="difflineminus">-        } else if (cal.isToDo(aItem)) {</span>
<a href="#l48.86"></a><span id="l48.86" class="difflineplus">+        } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l48.87"></a><span id="l48.87">             this.prepareStatement(this.mEditTodoOfflineFlag);</span>
<a href="#l48.88"></a><span id="l48.88">             this.mEditTodoOfflineFlag.params.id = aID;</span>
<a href="#l48.89"></a><span id="l48.89">             this.mEditTodoOfflineFlag.params.offline_journal = flag || null;</span>
<a href="#l48.90"></a><span id="l48.90">             try {</span>
<a href="#l48.91"></a><span id="l48.91">                 this.mEditTodoOfflineFlag.executeStep();</span>
<a href="#l48.92"></a><span id="l48.92">             } catch (e) {</span>
<a href="#l48.93"></a><span id="l48.93">                 this.logError(&quot;Error setting offline journal flag for &quot; + aItem.title, e);</span>
<a href="#l48.94"></a><span id="l48.94">             } finally {</span>
<a href="#l48.95"></a><span id="l48.95" class="difflineat">@@ -1538,17 +1538,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l48.96"></a><span id="l48.96">         if (row.last_modified) {</span>
<a href="#l48.97"></a><span id="l48.97">             item.setProperty(&quot;LAST-MODIFIED&quot;, newDateTime(row.last_modified, &quot;UTC&quot;));</span>
<a href="#l48.98"></a><span id="l48.98">         }</span>
<a href="#l48.99"></a><span id="l48.99">     },</span>
<a href="#l48.100"></a><span id="l48.100"> </span>
<a href="#l48.101"></a><span id="l48.101">     cacheItem: function(item) {</span>
<a href="#l48.102"></a><span id="l48.102">         this.mItemCache[item.id] = item;</span>
<a href="#l48.103"></a><span id="l48.103">         if (item.recurrenceInfo) {</span>
<a href="#l48.104"></a><span id="l48.104" class="difflineminus">-            if (cal.isEvent(item)) {</span>
<a href="#l48.105"></a><span id="l48.105" class="difflineplus">+            if (cal.item.isEvent(item)) {</span>
<a href="#l48.106"></a><span id="l48.106">                 this.mRecEventCache[item.id] = item;</span>
<a href="#l48.107"></a><span id="l48.107">             } else {</span>
<a href="#l48.108"></a><span id="l48.108">                 this.mRecTodoCache[item.id] = item;</span>
<a href="#l48.109"></a><span id="l48.109">             }</span>
<a href="#l48.110"></a><span id="l48.110">         }</span>
<a href="#l48.111"></a><span id="l48.111">     },</span>
<a href="#l48.112"></a><span id="l48.112"> </span>
<a href="#l48.113"></a><span id="l48.113">     mRecEventCacheOfflineFlags: {},</span>
<a href="#l48.114"></a><span id="l48.114" class="difflineat">@@ -1776,32 +1776,32 @@ calStorageCalendar.prototype = {</span>
<a href="#l48.115"></a><span id="l48.115">             // (getAdditionalDataForItem-&gt;get[Event|Todo]FromRow-&gt;getAdditionalDataForItem):</span>
<a href="#l48.116"></a><span id="l48.116">             // every excepton has a recurrenceId and isn't flagged as CAL_ITEM_FLAG.HAS_EXCEPTIONS</span>
<a href="#l48.117"></a><span id="l48.117">             if (item.recurrenceId) {</span>
<a href="#l48.118"></a><span id="l48.118">                 throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l48.119"></a><span id="l48.119">             }</span>
<a href="#l48.120"></a><span id="l48.120"> </span>
<a href="#l48.121"></a><span id="l48.121">             let rec = item.recurrenceInfo;</span>
<a href="#l48.122"></a><span id="l48.122"> </span>
<a href="#l48.123"></a><span id="l48.123" class="difflineminus">-            if (cal.isEvent(item)) {</span>
<a href="#l48.124"></a><span id="l48.124" class="difflineplus">+            if (cal.item.isEvent(item)) {</span>
<a href="#l48.125"></a><span id="l48.125">                 this.mSelectEventExceptions.params.id = item.id;</span>
<a href="#l48.126"></a><span id="l48.126">                 this.prepareStatement(this.mSelectEventExceptions);</span>
<a href="#l48.127"></a><span id="l48.127">                 try {</span>
<a href="#l48.128"></a><span id="l48.128">                     while (this.mSelectEventExceptions.executeStep()) {</span>
<a href="#l48.129"></a><span id="l48.129">                         let row = this.mSelectEventExceptions.row;</span>
<a href="#l48.130"></a><span id="l48.130">                         let exc = this.getEventFromRow(row, {}, true /* isException */);</span>
<a href="#l48.131"></a><span id="l48.131">                         rec.modifyException(exc, true);</span>
<a href="#l48.132"></a><span id="l48.132">                     }</span>
<a href="#l48.133"></a><span id="l48.133">                 } catch (e) {</span>
<a href="#l48.134"></a><span id="l48.134">                     this.logError(&quot;Error getting exceptions for event '&quot; +</span>
<a href="#l48.135"></a><span id="l48.135">                                   item.title + &quot;' (&quot; + item.id + &quot;)!&quot;, e);</span>
<a href="#l48.136"></a><span id="l48.136">                 } finally {</span>
<a href="#l48.137"></a><span id="l48.137">                     this.mSelectEventExceptions.reset();</span>
<a href="#l48.138"></a><span id="l48.138">                 }</span>
<a href="#l48.139"></a><span id="l48.139" class="difflineminus">-            } else if (cal.isToDo(item)) {</span>
<a href="#l48.140"></a><span id="l48.140" class="difflineplus">+            } else if (cal.item.isToDo(item)) {</span>
<a href="#l48.141"></a><span id="l48.141">                 this.mSelectTodoExceptions.params.id = item.id;</span>
<a href="#l48.142"></a><span id="l48.142">                 this.prepareStatement(this.mSelectTodoExceptions);</span>
<a href="#l48.143"></a><span id="l48.143">                 try {</span>
<a href="#l48.144"></a><span id="l48.144">                     while (this.mSelectTodoExceptions.executeStep()) {</span>
<a href="#l48.145"></a><span id="l48.145">                         let row = this.mSelectTodoExceptions.row;</span>
<a href="#l48.146"></a><span id="l48.146">                         let exc = this.getTodoFromRow(row, {}, true /* isException */);</span>
<a href="#l48.147"></a><span id="l48.147">                         rec.modifyException(exc, true);</span>
<a href="#l48.148"></a><span id="l48.148">                     }</span>
<a href="#l48.149"></a><span id="l48.149" class="difflineat">@@ -2000,19 +2000,19 @@ calStorageCalendar.prototype = {</span>
<a href="#l48.150"></a><span id="l48.150"> </span>
<a href="#l48.151"></a><span id="l48.151">         flags |= this.writeAttendees(item, olditem);</span>
<a href="#l48.152"></a><span id="l48.152">         flags |= this.writeRecurrence(item, olditem);</span>
<a href="#l48.153"></a><span id="l48.153">         flags |= this.writeProperties(item, olditem);</span>
<a href="#l48.154"></a><span id="l48.154">         flags |= this.writeAttachments(item, olditem);</span>
<a href="#l48.155"></a><span id="l48.155">         flags |= this.writeRelations(item, olditem);</span>
<a href="#l48.156"></a><span id="l48.156">         flags |= this.writeAlarms(item, olditem);</span>
<a href="#l48.157"></a><span id="l48.157"> </span>
<a href="#l48.158"></a><span id="l48.158" class="difflineminus">-        if (cal.isEvent(item)) {</span>
<a href="#l48.159"></a><span id="l48.159" class="difflineplus">+        if (cal.item.isEvent(item)) {</span>
<a href="#l48.160"></a><span id="l48.160">             this.writeEvent(item, olditem, flags);</span>
<a href="#l48.161"></a><span id="l48.161" class="difflineminus">-        } else if (cal.isToDo(item)) {</span>
<a href="#l48.162"></a><span id="l48.162" class="difflineplus">+        } else if (cal.item.isToDo(item)) {</span>
<a href="#l48.163"></a><span id="l48.163">             this.writeTodo(item, olditem, flags);</span>
<a href="#l48.164"></a><span id="l48.164">         } else {</span>
<a href="#l48.165"></a><span id="l48.165">             throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l48.166"></a><span id="l48.166">         }</span>
<a href="#l48.167"></a><span id="l48.167">     },</span>
<a href="#l48.168"></a><span id="l48.168"> </span>
<a href="#l48.169"></a><span id="l48.169">     writeEvent: function(item, olditem, flags) {</span>
<a href="#l48.170"></a><span id="l48.170">         try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -314,17 +314,17 @@ calWcapCalendar.prototype.storeItem = fu</span>
<a href="#l49.4"></a><span id="l49.4">                 }</span>
<a href="#l49.5"></a><span id="l49.5">             }</span>
<a href="#l49.6"></a><span id="l49.6">             strings.sort();</span>
<a href="#l49.7"></a><span id="l49.7">             ret = strings.join(&quot;;&quot;);</span>
<a href="#l49.8"></a><span id="l49.8">         }</span>
<a href="#l49.9"></a><span id="l49.9">         return ret || &quot;&quot;;</span>
<a href="#l49.10"></a><span id="l49.10">     };</span>
<a href="#l49.11"></a><span id="l49.11"> </span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-    let bIsEvent = cal.isEvent(item);</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+    let bIsEvent = cal.item.isEvent(item);</span>
<a href="#l49.14"></a><span id="l49.14">     let bIsParent = isParent(item);</span>
<a href="#l49.15"></a><span id="l49.15"> </span>
<a href="#l49.16"></a><span id="l49.16">     let method = METHOD_PUBLISH;</span>
<a href="#l49.17"></a><span id="l49.17">     let bNoSmtpNotify = false;</span>
<a href="#l49.18"></a><span id="l49.18">     let params = &quot;&quot;;</span>
<a href="#l49.19"></a><span id="l49.19"> </span>
<a href="#l49.20"></a><span id="l49.20">     let calId = this.calId;</span>
<a href="#l49.21"></a><span id="l49.21">     if (!bAddItem &amp;&amp; this.isInvitation(item)) { // REPLY</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineat">@@ -709,17 +709,17 @@ calWcapCalendar.prototype.modifyItem = f</span>
<a href="#l49.23"></a><span id="l49.23">                                                  }</span>
<a href="#l49.24"></a><span id="l49.24">                                                  // invalidate cached results:</span>
<a href="#l49.25"></a><span id="l49.25">                                                  delete this.m_cachedResults;</span>
<a href="#l49.26"></a><span id="l49.26">                                                  this.storeItem(false /* bAddItem */, newItem, oldItem_, request);</span>
<a href="#l49.27"></a><span id="l49.27">                                              } finally {</span>
<a href="#l49.28"></a><span id="l49.28">                                                  request.unlockPending();</span>
<a href="#l49.29"></a><span id="l49.29">                                              }</span>
<a href="#l49.30"></a><span id="l49.30">                                          },</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-                                         stringToXml, cal.isEvent(newItem) ? &quot;deleteevents_by_id&quot; : &quot;deletetodos_by_id&quot;,</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+                                         stringToXml, cal.item.isEvent(newItem) ? &quot;deleteevents_by_id&quot; : &quot;deletetodos_by_id&quot;,</span>
<a href="#l49.33"></a><span id="l49.33">                                          params, calIWcapCalendar.AC_COMP_WRITE);</span>
<a href="#l49.34"></a><span id="l49.34">                 return request;</span>
<a href="#l49.35"></a><span id="l49.35">             }</span>
<a href="#l49.36"></a><span id="l49.36">         } else if (oldItem &amp;&amp; !oldItem.parentItem.recurrenceInfo.getExceptionFor(newItem.recurrenceId)) {</span>
<a href="#l49.37"></a><span id="l49.37">             // pass null for oldItem when creating new exceptions, write whole item:</span>
<a href="#l49.38"></a><span id="l49.38">             oldItem_ = null;</span>
<a href="#l49.39"></a><span id="l49.39">         }</span>
<a href="#l49.40"></a><span id="l49.40">         this.storeItem(false /* bAddItem */, newItem, oldItem_, request);</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineat">@@ -769,17 +769,17 @@ calWcapCalendar.prototype.deleteItem = f</span>
<a href="#l49.42"></a><span id="l49.42">                                          throw err;</span>
<a href="#l49.43"></a><span id="l49.43">                                      }</span>
<a href="#l49.44"></a><span id="l49.44">                                      // invalidate cached results:</span>
<a href="#l49.45"></a><span id="l49.45">                                      delete this.m_cachedResults;</span>
<a href="#l49.46"></a><span id="l49.46">                                      if (LOG_LEVEL &gt; 0) {</span>
<a href="#l49.47"></a><span id="l49.47">                                          log(&quot;deleteItem(): &quot; + getWcapRequestStatusString(xml), this);</span>
<a href="#l49.48"></a><span id="l49.48">                                      }</span>
<a href="#l49.49"></a><span id="l49.49">                                  },</span>
<a href="#l49.50"></a><span id="l49.50" class="difflineminus">-                                 stringToXml, cal.isEvent(item) ? &quot;deleteevents_by_id&quot; : &quot;deletetodos_by_id&quot;,</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineplus">+                                 stringToXml, cal.item.isEvent(item) ? &quot;deleteevents_by_id&quot; : &quot;deletetodos_by_id&quot;,</span>
<a href="#l49.52"></a><span id="l49.52">                                  params, calIWcapCalendar.AC_COMP_WRITE);</span>
<a href="#l49.53"></a><span id="l49.53">     } catch (exc) {</span>
<a href="#l49.54"></a><span id="l49.54">         request.execRespFunc(exc);</span>
<a href="#l49.55"></a><span id="l49.55">     }</span>
<a href="#l49.56"></a><span id="l49.56">     return request;</span>
<a href="#l49.57"></a><span id="l49.57"> };</span>
<a href="#l49.58"></a><span id="l49.58"> </span>
<a href="#l49.59"></a><span id="l49.59"> calWcapCalendar.prototype.patchTimezone = function(subComp, attr, xpropOrTz) {</span>
<a href="#l49.60"></a><span id="l49.60" class="difflineat">@@ -894,34 +894,34 @@ calWcapCalendar.prototype.parseItems = f</span>
<a href="#l49.61"></a><span id="l49.61">                         &quot;\nrid=&quot; + getIcalUTC(rid) +</span>
<a href="#l49.62"></a><span id="l49.62">                         &quot;\nitem.id=&quot; + item.id, this);</span>
<a href="#l49.63"></a><span id="l49.63">                 }</span>
<a href="#l49.64"></a><span id="l49.64">                 excItems.push(item);</span>
<a href="#l49.65"></a><span id="l49.65">             } else if (item.recurrenceInfo) {</span>
<a href="#l49.66"></a><span id="l49.66">                 unexpandedItems.push(item);</span>
<a href="#l49.67"></a><span id="l49.67">                 uid2parent[item.id] = item;</span>
<a href="#l49.68"></a><span id="l49.68">             } else if ((maxResults == 0 || items.length &lt; maxResults) &amp;&amp;</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineminus">-                       cal.checkIfInRange(item, rangeStart, rangeEnd)) {</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineplus">+                       cal.item.checkIfInRange(item, rangeStart, rangeEnd)) {</span>
<a href="#l49.71"></a><span id="l49.71">                 if (LOG_LEVEL &gt; 2) {</span>
<a href="#l49.72"></a><span id="l49.72">                     log(&quot;item: &quot; + item.title + &quot;\n&quot; + item.icalString, this);</span>
<a href="#l49.73"></a><span id="l49.73">                 }</span>
<a href="#l49.74"></a><span id="l49.74">                 if (!bLeaveMutable) {</span>
<a href="#l49.75"></a><span id="l49.75">                     item.makeImmutable();</span>
<a href="#l49.76"></a><span id="l49.76">                 }</span>
<a href="#l49.77"></a><span id="l49.77">                 items.push(item);</span>
<a href="#l49.78"></a><span id="l49.78">             }</span>
<a href="#l49.79"></a><span id="l49.79">         }</span>
<a href="#l49.80"></a><span id="l49.80">     }</span>
<a href="#l49.81"></a><span id="l49.81"> </span>
<a href="#l49.82"></a><span id="l49.82">     // tag &quot;exceptions&quot;, i.e. items with rid:</span>
<a href="#l49.83"></a><span id="l49.83">     for (let item of excItems) {</span>
<a href="#l49.84"></a><span id="l49.84">         let parent = uid2parent[item.id];</span>
<a href="#l49.85"></a><span id="l49.85"> </span>
<a href="#l49.86"></a><span id="l49.86">         if (!parent) { // a parentless one, fake a master and override it's occurrence</span>
<a href="#l49.87"></a><span id="l49.87" class="difflineminus">-            parent = cal.isEvent(item) ? cal.createEvent() : cal.createTodo();</span>
<a href="#l49.88"></a><span id="l49.88" class="difflineplus">+            parent = cal.item.isEvent(item) ? cal.createEvent() : cal.createTodo();</span>
<a href="#l49.89"></a><span id="l49.89">             parent.id = item.id;</span>
<a href="#l49.90"></a><span id="l49.90">             parent.calendar = this.superCalendar;</span>
<a href="#l49.91"></a><span id="l49.91">             parent.setProperty(&quot;DTSTART&quot;, item.recurrenceId);</span>
<a href="#l49.92"></a><span id="l49.92">             parent.setProperty(&quot;X-MOZ-FAKED-MASTER&quot;, &quot;1&quot;); // this tag might be useful in the future</span>
<a href="#l49.93"></a><span id="l49.93">             parent.recurrenceInfo = cal.createRecurrenceInfo(parent);</span>
<a href="#l49.94"></a><span id="l49.94">             fakedParents[item.id] = true;</span>
<a href="#l49.95"></a><span id="l49.95">             uid2parent[item.id] = parent;</span>
<a href="#l49.96"></a><span id="l49.96">             items.push(parent);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -60,19 +60,19 @@ function showToolTip(aToolTip, aItem) {</span>
<a href="#l50.4"></a><span id="l50.4"> /**</span>
<a href="#l50.5"></a><span id="l50.5">  * PUBLIC:  Called when a user hovers over a todo element and the text for the</span>
<a href="#l50.6"></a><span id="l50.6">  * mouse over is changed.</span>
<a href="#l50.7"></a><span id="l50.7">  *</span>
<a href="#l50.8"></a><span id="l50.8">  * @param {calIToDo} toDoItem    the item to create the preview for</span>
<a href="#l50.9"></a><span id="l50.9">  * @param {boolean}  aIsTooltip  enabled if used for tooltip composition (default)</span>
<a href="#l50.10"></a><span id="l50.10">  */</span>
<a href="#l50.11"></a><span id="l50.11"> function getPreviewForItem(aItem, aIsTooltip=true) {</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-    if (cal.isEvent(aItem)) {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+    if (cal.item.isEvent(aItem)) {</span>
<a href="#l50.14"></a><span id="l50.14">         return getPreviewForEvent(aItem, aIsTooltip);</span>
<a href="#l50.15"></a><span id="l50.15" class="difflineminus">-    } else if (cal.isToDo(aItem)) {</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineplus">+    } else if (cal.item.isToDo(aItem)) {</span>
<a href="#l50.17"></a><span id="l50.17">         return getPreviewForTask(aItem, aIsTooltip);</span>
<a href="#l50.18"></a><span id="l50.18">     } else {</span>
<a href="#l50.19"></a><span id="l50.19">         return null;</span>
<a href="#l50.20"></a><span id="l50.20">     }</span>
<a href="#l50.21"></a><span id="l50.21"> }</span>
<a href="#l50.22"></a><span id="l50.22"> </span>
<a href="#l50.23"></a><span id="l50.23"> /**</span>
<a href="#l50.24"></a><span id="l50.24">  * PUBLIC: Returns the string for status (none), Tentative, Confirmed, or</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -906,17 +906,17 @@ add_task(function* test_basicItems() {</span>
<a href="#l51.4"></a><span id="l51.4">     }];</span>
<a href="#l51.5"></a><span id="l51.5"> </span>
<a href="#l51.6"></a><span id="l51.6">     let client = yield gServer.getClient();</span>
<a href="#l51.7"></a><span id="l51.7">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l51.8"></a><span id="l51.8"> </span>
<a href="#l51.9"></a><span id="l51.9">     let items = yield pclient.getAllItems();</span>
<a href="#l51.10"></a><span id="l51.10">     equal(items.length, 2);</span>
<a href="#l51.11"></a><span id="l51.11"> </span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    let event = cal.isEvent(items[0]) ? items[0] : items[1];</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    let event = cal.item.isEvent(items[0]) ? items[0] : items[1];</span>
<a href="#l51.14"></a><span id="l51.14">     equal(event.id, &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;);</span>
<a href="#l51.15"></a><span id="l51.15">     equal(event.getProperty(&quot;STATUS&quot;), &quot;CONFIRMED&quot;);</span>
<a href="#l51.16"></a><span id="l51.16">     equal(event.getProperty(&quot;URL&quot;), gServer.baseUri + &quot;/calendar/event?eid=eventhash&quot;);</span>
<a href="#l51.17"></a><span id="l51.17">     equal(event.getProperty(&quot;CREATED&quot;).icalString, &quot;20060608T210452Z&quot;);</span>
<a href="#l51.18"></a><span id="l51.18">     equal(event.getProperty(&quot;LAST-MODIFIED&quot;).icalString, &quot;20060608T210549Z&quot;);</span>
<a href="#l51.19"></a><span id="l51.19">     equal(event.title, &quot;New Event&quot;);</span>
<a href="#l51.20"></a><span id="l51.20">     equal(event.getProperty(&quot;DESCRIPTION&quot;), &quot;description&quot;);</span>
<a href="#l51.21"></a><span id="l51.21">     equal(event.getProperty(&quot;LOCATION&quot;), &quot;Hard Drive&quot;);</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineat">@@ -940,17 +940,17 @@ add_task(function* test_basicItems() {</span>
<a href="#l51.23"></a><span id="l51.23">     equal(attendees[0].id, &quot;mailto:attendee@example.com&quot;);</span>
<a href="#l51.24"></a><span id="l51.24">     equal(attendees[0].commonName, &quot;attendee name&quot;);</span>
<a href="#l51.25"></a><span id="l51.25">     equal(attendees[0].role, &quot;OPT-PARTICIPANT&quot;);</span>
<a href="#l51.26"></a><span id="l51.26">     equal(attendees[0].participationStatus, &quot;TENTATIVE&quot;);</span>
<a href="#l51.27"></a><span id="l51.27">     equal(event.getCategories({}), &quot;foo,bar&quot;);</span>
<a href="#l51.28"></a><span id="l51.28">     equal(event.alarmLastAck.icalString, &quot;20140101T010101Z&quot;);</span>
<a href="#l51.29"></a><span id="l51.29">     equal(event.getProperty(&quot;X-MOZ-SNOOZE-TIME&quot;), &quot;20140101T020202Z&quot;);</span>
<a href="#l51.30"></a><span id="l51.30"> </span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-    let task = cal.isToDo(items[0]) ? items[0] : items[1];</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineplus">+    let task = cal.item.isToDo(items[0]) ? items[0] : items[1];</span>
<a href="#l51.33"></a><span id="l51.33">     equal(task.id, &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;);</span>
<a href="#l51.34"></a><span id="l51.34">     equal(task.title, &quot;New Task&quot;);</span>
<a href="#l51.35"></a><span id="l51.35">     equal(task.getProperty(&quot;LAST-MODIFIED&quot;).icalString, &quot;20140908T163027Z&quot;);</span>
<a href="#l51.36"></a><span id="l51.36">     equal(task.getProperty(&quot;X-GOOGLE-SORTKEY&quot;), &quot;00000000000000130998&quot;);</span>
<a href="#l51.37"></a><span id="l51.37">     ok(task.isCompleted);</span>
<a href="#l51.38"></a><span id="l51.38">     equal(task.dueDate.icalString, &quot;20140904&quot;);</span>
<a href="#l51.39"></a><span id="l51.39">     equal(task.completedDate.icalString, &quot;20140901T170000Z&quot;);</span>
<a href="#l51.40"></a><span id="l51.40">     equal(task.getProperty(&quot;DESCRIPTION&quot;), &quot;description&quot;);</span>
<a href="#l51.41"></a><span id="l51.41" class="difflineat">@@ -1372,33 +1372,33 @@ add_task(function* test_metadata() {</span>
<a href="#l51.42"></a><span id="l51.42">     let client = yield gServer.getClient();</span>
<a href="#l51.43"></a><span id="l51.43">     let offline = client.wrappedJSObject.mCachedCalendar;</span>
<a href="#l51.44"></a><span id="l51.44">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l51.45"></a><span id="l51.45"> </span>
<a href="#l51.46"></a><span id="l51.46">     // Check initial metadata</span>
<a href="#l51.47"></a><span id="l51.47">     let items = yield pclient.getAllItems();</span>
<a href="#l51.48"></a><span id="l51.48">     let meta = getAllMeta(offline);</span>
<a href="#l51.49"></a><span id="l51.49">     let [event, task] = items;</span>
<a href="#l51.50"></a><span id="l51.50" class="difflineminus">-    ok(cal.isEvent(event));</span>
<a href="#l51.51"></a><span id="l51.51" class="difflineminus">-    ok(cal.isToDo(task));</span>
<a href="#l51.52"></a><span id="l51.52" class="difflineplus">+    ok(cal.item.isEvent(event));</span>
<a href="#l51.53"></a><span id="l51.53" class="difflineplus">+    ok(cal.item.isToDo(task));</span>
<a href="#l51.54"></a><span id="l51.54">     equal(meta.size, 2);</span>
<a href="#l51.55"></a><span id="l51.55">     equal(meta.get(event.hashId), ['&quot;1&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l51.56"></a><span id="l51.56">     equal(meta.get(task.hashId), ['&quot;2&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l51.57"></a><span id="l51.57"> </span>
<a href="#l51.58"></a><span id="l51.58">     // Modify an event</span>
<a href="#l51.59"></a><span id="l51.59">     gServer.nextEtag = '&quot;3&quot;';</span>
<a href="#l51.60"></a><span id="l51.60">     let newEvent = event.clone();</span>
<a href="#l51.61"></a><span id="l51.61">     newEvent.title = &quot;changed&quot;;</span>
<a href="#l51.62"></a><span id="l51.62">     yield pclient.modifyItem(newEvent, event);</span>
<a href="#l51.63"></a><span id="l51.63"> </span>
<a href="#l51.64"></a><span id="l51.64">     items = yield pclient.getAllItems();</span>
<a href="#l51.65"></a><span id="l51.65">     meta = getAllMeta(offline);</span>
<a href="#l51.66"></a><span id="l51.66">     [event, task] = items;</span>
<a href="#l51.67"></a><span id="l51.67" class="difflineminus">-    ok(cal.isEvent(event));</span>
<a href="#l51.68"></a><span id="l51.68" class="difflineminus">-    ok(cal.isToDo(task));</span>
<a href="#l51.69"></a><span id="l51.69" class="difflineplus">+    ok(cal.item.isEvent(event));</span>
<a href="#l51.70"></a><span id="l51.70" class="difflineplus">+    ok(cal.item.isToDo(task));</span>
<a href="#l51.71"></a><span id="l51.71">     equal(meta.size, 2);</span>
<a href="#l51.72"></a><span id="l51.72">     equal(meta.get(event.hashId), ['&quot;3&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l51.73"></a><span id="l51.73">     equal(meta.get(task.hashId), ['&quot;2&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l51.74"></a><span id="l51.74"> </span>
<a href="#l51.75"></a><span id="l51.75">     // Modify a task</span>
<a href="#l51.76"></a><span id="l51.76">     gServer.nextEtag = '&quot;4&quot;';</span>
<a href="#l51.77"></a><span id="l51.77">     let newTask = task.clone();</span>
<a href="#l51.78"></a><span id="l51.78">     newTask.title = &quot;changed&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/test/unit/test_ics_parser.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_parser.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -125,23 +125,23 @@ function test_async() {</span>
<a href="#l52.4"></a><span id="l52.4">         &quot;END:VCALENDAR&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l52.5"></a><span id="l52.5"> </span>
<a href="#l52.6"></a><span id="l52.6">     do_test_pending();</span>
<a href="#l52.7"></a><span id="l52.7">     parser.parseString(str, null, {</span>
<a href="#l52.8"></a><span id="l52.8">         onParsingComplete: function(rc, opparser) {</span>
<a href="#l52.9"></a><span id="l52.9">             let items = parser.getItems({});</span>
<a href="#l52.10"></a><span id="l52.10">             equal(items.length, 2);</span>
<a href="#l52.11"></a><span id="l52.11">             let item = items[0];</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-            ok(cal.isToDo(item));</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+            ok(cal.item.isToDo(item));</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15">             equal(item.entryDate.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l52.16"></a><span id="l52.16">             equal(item.dueDate.icalString, &quot;20120101T010102&quot;);</span>
<a href="#l52.17"></a><span id="l52.17"> </span>
<a href="#l52.18"></a><span id="l52.18">             item = items[1];</span>
<a href="#l52.19"></a><span id="l52.19" class="difflineminus">-            ok(cal.isToDo(item));</span>
<a href="#l52.20"></a><span id="l52.20" class="difflineplus">+            ok(cal.item.isToDo(item));</span>
<a href="#l52.21"></a><span id="l52.21"> </span>
<a href="#l52.22"></a><span id="l52.22">             equal(item.entryDate.icalString, &quot;20120101T010103&quot;);</span>
<a href="#l52.23"></a><span id="l52.23">             equal(item.dueDate.icalString, &quot;20120101T010104&quot;);</span>
<a href="#l52.24"></a><span id="l52.24"> </span>
<a href="#l52.25"></a><span id="l52.25">             do_test_finished();</span>
<a href="#l52.26"></a><span id="l52.26">         }</span>
<a href="#l52.27"></a><span id="l52.27">     });</span>
<a href="#l52.28"></a><span id="l52.28"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

