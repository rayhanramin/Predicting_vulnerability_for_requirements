<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 7813:c68b4de81618d8208a2f3d2cbeee8fd44547b13b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ c68b4de81618d8208a2f3d2cbeee8fd44547b13b" />
<meta property="og:url" content="/comm-central/rev/c68b4de81618d8208a2f3d2cbeee8fd44547b13b" />
<meta property="og:description" content="Fix bug 637064 - reference libical - Update to libical 0.46. r=pmartinak" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / c68b4de81618d8208a2f3d2cbeee8fd44547b13b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/c68b4de81618d8208a2f3d2cbeee8fd44547b13b">shortlog</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/c68b4de81618d8208a2f3d2cbeee8fd44547b13b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b">files</a> |
changeset |
<a href="/comm-central/raw-rev/c68b4de81618d8208a2f3d2cbeee8fd44547b13b">raw</a>  | <a href="/comm-central/archive/c68b4de81618d8208a2f3d2cbeee8fd44547b13b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=637064">bug 637064</a> - reference libical - Update to libical 0.46. r=pmartinak
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 24 May 2011 17:13:45 +0200</td></tr>

<tr>
 <td>changeset 7813</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/c68b4de81618d8208a2f3d2cbeee8fd44547b13b">c68b4de81618d8208a2f3d2cbeee8fd44547b13b</a></td>
</tr>



<tr>
<td>parent 7812</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/212a62f8c1ffca0d530bec530ec1bcecbf2623aa">212a62f8c1ffca0d530bec530ec1bcecbf2623aa</a>
</td>
</tr>

<tr>
<td>child 7814</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8b7cdb6dd35786138888fe69645d88dd4cd81dc3">8b7cdb6dd35786138888fe69645d88dd4cd81dc3</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=c68b4de81618d8208a2f3d2cbeee8fd44547b13b">6004</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Tue, 24 May 2011 20:30:32 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@8b7cdb6dd357 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8b7cdb6dd35786138888fe69645d88dd4cd81dc3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=8b7cdb6dd35786138888fe69645d88dd4cd81dc3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8b7cdb6dd35786138888fe69645d88dd4cd81dc3&newProject=comm-central&newRevision=c68b4de81618d8208a2f3d2cbeee8fd44547b13b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8b7cdb6dd35786138888fe69645d88dd4cd81dc3&newProject=comm-central&newRevision=c68b4de81618d8208a2f3d2cbeee8fd44547b13b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=8b7cdb6dd35786138888fe69645d88dd4cd81dc3&newProject=comm-central&newRevision=c68b4de81618d8208a2f3d2cbeee8fd44547b13b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28pmartinak%29&revcount=50">pmartinak</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=637064">637064</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=637064">bug 637064</a> - reference libical - Update to libical 0.46. r=pmartinak</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/parameters.csv">calendar/libical/design-data/parameters.csv</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/parameters.csv">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/parameters.csv">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/parameters.csv">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/parameters.csv">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/parameters.csv">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/value-types.csv">calendar/libical/design-data/value-types.csv</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/value-types.csv">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/value-types.csv">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/value-types.csv">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/value-types.csv">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/design-data/value-types.csv">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedparameters.pl">calendar/libical/scripts/mkderivedparameters.pl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedparameters.pl">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedparameters.pl">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedparameters.pl">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedparameters.pl">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedparameters.pl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedproperties.pl">calendar/libical/scripts/mkderivedproperties.pl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedproperties.pl">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedproperties.pl">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedproperties.pl">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedproperties.pl">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedproperties.pl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedvalues.pl">calendar/libical/scripts/mkderivedvalues.pl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedvalues.pl">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedvalues.pl">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedvalues.pl">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedvalues.pl">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/mkderivedvalues.pl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/readvaluesfile.pl">calendar/libical/scripts/readvaluesfile.pl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/readvaluesfile.pl">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/readvaluesfile.pl">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/readvaluesfile.pl">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/readvaluesfile.pl">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/scripts/readvaluesfile.pl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/Makefile.in">calendar/libical/src/libical/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/Makefile.in">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/Makefile.in">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/Makefile.in">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/Makefile.in">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/caldate.c">calendar/libical/src/libical/caldate.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/caldate.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/caldate.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/caldate.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/caldate.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/caldate.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.c">calendar/libical/src/libical/icalarray.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.h">calendar/libical/src/libical/icalarray.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalarray.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.c">calendar/libical/src/libical/icalattach.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.h">calendar/libical/src/libical/icalattach.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattach.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattachimpl.h">calendar/libical/src/libical/icalattachimpl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattachimpl.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattachimpl.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattachimpl.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattachimpl.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalattachimpl.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.c">calendar/libical/src/libical/icalcomponent.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.h">calendar/libical/src/libical/icalcomponent.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalcomponent.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedparameter.c.in">calendar/libical/src/libical/icalderivedparameter.c.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedparameter.c.in">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedparameter.c.in">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedparameter.c.in">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedparameter.c.in">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedparameter.c.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.c.in">calendar/libical/src/libical/icalderivedproperty.c.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.c.in">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.c.in">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.c.in">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.c.in">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.c.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.h.in">calendar/libical/src/libical/icalderivedproperty.h.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.h.in">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.h.in">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.h.in">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.h.in">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedproperty.h.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.c.in">calendar/libical/src/libical/icalderivedvalue.c.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.c.in">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.c.in">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.c.in">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.c.in">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.c.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.h.in">calendar/libical/src/libical/icalderivedvalue.h.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.h.in">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.h.in">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.h.in">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.h.in">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalderivedvalue.h.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalduration.c">calendar/libical/src/libical/icalduration.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalduration.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalduration.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalduration.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalduration.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalduration.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalenums.c">calendar/libical/src/libical/icalenums.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalenums.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalenums.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalenums.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalenums.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalenums.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.c">calendar/libical/src/libical/icalerror.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.h">calendar/libical/src/libical/icalerror.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalerror.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icallangbind.c">calendar/libical/src/libical/icallangbind.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icallangbind.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icallangbind.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icallangbind.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icallangbind.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icallangbind.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalmime.c">calendar/libical/src/libical/icalmime.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalmime.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalmime.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalmime.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalmime.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalmime.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.c">calendar/libical/src/libical/icalparameter.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.h">calendar/libical/src/libical/icalparameter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparameter.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparser.c">calendar/libical/src/libical/icalparser.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparser.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparser.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparser.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparser.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalparser.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalperiod.c">calendar/libical/src/libical/icalperiod.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalperiod.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalperiod.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalperiod.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalperiod.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalperiod.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalproperty.c">calendar/libical/src/libical/icalproperty.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalproperty.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalproperty.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalproperty.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalproperty.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalproperty.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrecur.c">calendar/libical/src/libical/icalrecur.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrecur.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrecur.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrecur.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrecur.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrecur.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrestriction.c.in">calendar/libical/src/libical/icalrestriction.c.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrestriction.c.in">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrestriction.c.in">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrestriction.c.in">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrestriction.c.in">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalrestriction.c.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltime.c">calendar/libical/src/libical/icaltime.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltime.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltime.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltime.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltime.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltime.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.c">calendar/libical/src/libical/icaltimezone.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.h">calendar/libical/src/libical/icaltimezone.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltimezone.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.c">calendar/libical/src/libical/icaltypes.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.h">calendar/libical/src/libical/icaltypes.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icaltypes.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.c">calendar/libical/src/libical/icalvalue.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.h">calendar/libical/src/libical/icalvalue.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/icalvalue.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c">calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.c">calendar/libical/src/libical/pvl.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.h">calendar/libical/src/libical/pvl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/pvl.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.c">calendar/libical/src/libical/sspm.c</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.c">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.c">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.c">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.c">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.c">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.h">calendar/libical/src/libical/sspm.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/sspm.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/vsnprintf.h">calendar/libical/src/libical/vsnprintf.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/vsnprintf.h">file</a> |
<a href="/comm-central/annotate/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/vsnprintf.h">annotate</a> |
<a href="/comm-central/diff/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/vsnprintf.h">diff</a> |
<a href="/comm-central/comparison/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/vsnprintf.h">comparison</a> |
<a href="/comm-central/log/c68b4de81618d8208a2f3d2cbeee8fd44547b13b/calendar/libical/src/libical/vsnprintf.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/libical/design-data/parameters.csv</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/libical/design-data/parameters.csv</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,39 +1,39 @@</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineminus">-&quot;#Name &quot;,&quot;C Type&quot;,&quot;Enumeration Values&quot;</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineminus">-&quot;ALTREP&quot;,&quot;const char*&quot;,</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineminus">-&quot;CHARSET&quot;,&quot;const char*&quot;,</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineminus">-&quot;CN&quot;,&quot;const char*&quot;,</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineminus">-&quot;CUTYPE&quot;,&quot;icalparameter_cutype&quot;,&quot;INDIVIDUAL;GROUP;RESOURCE;ROOM;UNKNOWN&quot;</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineminus">-&quot;DELEGATED-FROM&quot;,&quot;const char*&quot;,</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-&quot;DELEGATED-TO&quot;,&quot;const char*&quot;,</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">-&quot;DIR&quot;,&quot;const char*&quot;,</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-&quot;ENCODING&quot;,&quot;icalparameter_encoding&quot;,&quot;8BIT;BASE64&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-&quot;FBTYPE&quot;,&quot;icalparameter_fbtype&quot;,&quot;FREE;BUSY;BUSY-UNAVAILABLE;BUSY-TENTATIVE&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-&quot;FMTTYPE&quot;,&quot;const char*&quot;,</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-&quot;LANGUAGE&quot;,&quot;const char*&quot;,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-&quot;MEMBER&quot;,&quot;const char*&quot;,</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-&quot;PARTSTAT&quot;,&quot;icalparameter_partstat&quot;,&quot;NEEDS-ACTION;ACCEPTED;DECLINED;TENTATIVE;DELEGATED;COMPLETED;INPROCESS&quot;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-&quot;RANGE&quot;,&quot;icalparameter_range&quot;,&quot;THISANDPRIOR;THISANDFUTURE&quot;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-&quot;RELATED&quot;,&quot;icalparameter_related&quot;,&quot;START;END&quot;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-&quot;RELTYPE&quot;,&quot;icalparameter_reltype&quot;,&quot;PARENT;CHILD;SIBLING&quot;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-&quot;ROLE&quot;,&quot;icalparameter_role&quot;,&quot;CHAIR;REQ-PARTICIPANT;OPT-PARTICIPANT;NON-PARTICIPANT&quot;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-&quot;RSVP&quot;,&quot;icalparameter_rsvp&quot;,&quot;TRUE;FALSE&quot;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-&quot;SENT-BY&quot;,&quot;const char*&quot;,</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-&quot;RECEIVED-SEQUENCE&quot;,&quot;const char*&quot;,</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-&quot;RECEIVED-DTSTAMP&quot;,&quot;const char*&quot;,</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-&quot;TZID&quot;,&quot;const char*&quot;,</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-&quot;VALUE&quot;,&quot;icalparameter_value&quot;,&quot;BINARY;BOOLEAN;DATE;DURATION;FLOAT;INTEGER;PERIOD;RECUR;TEXT;URI;ERROR;DATE-TIME;UTC-OFFSET;CAL-ADDRESS&quot;</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-&quot;X&quot;,&quot;const char*&quot;,</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-&quot;X-LIC-ERRORTYPE&quot;,&quot;icalparameter_xlicerrortype&quot;,&quot;COMPONENT-PARSE-ERROR;PROPERTY-PARSE-ERROR;PARAMETER-NAME-PARSE-ERROR;PARAMETER-VALUE-PARSE-ERROR;VALUE-PARSE-ERROR;INVALID-ITIP;UNKNOWN-VCAL-PROP-ERROR;MIME-PARSE-ERROR;VCAL-PROP-PARSE-ERROR&quot;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-&quot;X-LIC-COMPARETYPE&quot;,&quot;icalparameter_xliccomparetype&quot;,&quot;EQUAL;NOTEQUAL;LESS;GREATER;LESSEQUAL;GREATEREQUAL;REGEX;ISNULL;ISNOTNULL&quot;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+&quot;#Name &quot;,&quot;C icalparameter_kind Enum&quot;,&quot;C Type&quot;,&quot;Enumeration Values&quot;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+&quot;ALTREP&quot;,&quot;2&quot;,&quot;const char*&quot;,</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+&quot;CHARSET&quot;,&quot;3&quot;,&quot;const char*&quot;,</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+&quot;CN&quot;,&quot;4&quot;,&quot;const char*&quot;,</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+&quot;CUTYPE&quot;,&quot;5&quot;,&quot;icalparameter_cutype&quot;,&quot;INDIVIDUAL;GROUP;RESOURCE;ROOM;UNKNOWN&quot;</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+&quot;DELEGATED-FROM&quot;,&quot;6&quot;,&quot;const char*&quot;,</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+&quot;DELEGATED-TO&quot;,&quot;7&quot;,&quot;const char*&quot;,</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+&quot;DIR&quot;,&quot;8&quot;,&quot;const char*&quot;,</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+&quot;ENCODING&quot;,&quot;10&quot;,&quot;icalparameter_encoding&quot;,&quot;8BIT;BASE64&quot;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+&quot;FBTYPE&quot;,&quot;11&quot;,&quot;icalparameter_fbtype&quot;,&quot;FREE;BUSY;BUSY-UNAVAILABLE;BUSY-TENTATIVE&quot;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+&quot;FMTTYPE&quot;,&quot;12&quot;,&quot;const char*&quot;,</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+&quot;LANGUAGE&quot;,&quot;14&quot;,&quot;const char*&quot;,</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+&quot;MEMBER&quot;,&quot;18&quot;,&quot;const char*&quot;,</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+&quot;PARTSTAT&quot;,&quot;20&quot;,&quot;icalparameter_partstat&quot;,&quot;NEEDS-ACTION;ACCEPTED;DECLINED;TENTATIVE;DELEGATED;COMPLETED;INPROCESS&quot;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+&quot;RANGE&quot;,&quot;21&quot;,&quot;icalparameter_range&quot;,&quot;THISANDPRIOR;THISANDFUTURE&quot;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+&quot;RELATED&quot;,&quot;22&quot;,&quot;icalparameter_related&quot;,&quot;START;END&quot;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+&quot;RELTYPE&quot;,&quot;23&quot;,&quot;icalparameter_reltype&quot;,&quot;PARENT;CHILD;SIBLING&quot;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+&quot;ROLE&quot;,&quot;24&quot;,&quot;icalparameter_role&quot;,&quot;CHAIR;REQ-PARTICIPANT;OPT-PARTICIPANT;NON-PARTICIPANT&quot;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+&quot;RSVP&quot;,&quot;25&quot;,&quot;icalparameter_rsvp&quot;,&quot;TRUE;FALSE&quot;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+&quot;SENT-BY&quot;,&quot;26&quot;,&quot;const char*&quot;,</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+&quot;TZID&quot;,&quot;27&quot;,&quot;const char*&quot;,</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+&quot;VALUE&quot;,&quot;28&quot;,&quot;icalparameter_value&quot;,&quot;BINARY;BOOLEAN;DATE;DURATION;FLOAT;INTEGER;PERIOD;RECUR;TEXT;URI;ERROR;DATE-TIME;UTC-OFFSET;CAL-ADDRESS&quot;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+&quot;X&quot;,&quot;29&quot;,&quot;const char*&quot;,</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+&quot;X-LIC-ERRORTYPE&quot;,&quot;31&quot;,&quot;icalparameter_xlicerrortype&quot;,&quot;COMPONENT-PARSE-ERROR;PROPERTY-PARSE-ERROR;PARAMETER-NAME-PARSE-ERROR;PARAMETER-VALUE-PARSE-ERROR;VALUE-PARSE-ERROR;INVALID-ITIP;UNKNOWN-VCAL-PROP-ERROR;MIME-PARSE-ERROR;VCAL-PROP-PARSE-ERROR&quot;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+&quot;X-LIC-COMPARETYPE&quot;,&quot;30&quot;,&quot;icalparameter_xliccomparetype&quot;,&quot;EQUAL;NOTEQUAL;LESS;GREATER;LESSEQUAL;GREATEREQUAL;REGEX;ISNULL;ISNOTNULL&quot;</span>
<a href="#l1.56"></a><span id="l1.56"> &quot;#CAP Parameters&quot;,&quot;Draft 8&quot;,</span>
<a href="#l1.57"></a><span id="l1.57"> &quot;#this parameter should really be called ACTION, but this conflicts with the ACTION property&quot;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-&quot;ACTIONPARAM&quot;,&quot;icalparameter_action&quot;,&quot;ASK;ABORT&quot;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-&quot;ID&quot;,&quot;const char*&quot;,</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-&quot;ENABLE&quot;,&quot;icalparameter_enable&quot;,&quot;TRUE;FALSE&quot;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-&quot;LATENCY&quot;,&quot;const char*&quot;,</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-&quot;LOCAL&quot;,&quot;icalparameter_local&quot;,&quot;TRUE;FALSE&quot;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-&quot;LOCALIZE&quot;,&quot;const char*&quot;,</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-&quot;OPTIONS&quot;,&quot;const char*&quot;,</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-&quot;SCHEDULE-AGENT&quot;,&quot;const char*&quot;,</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-&quot;SCHEDULE-STATUS&quot;,&quot;const char*&quot;,</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-&quot;SCHEDULE-FORCE-SEND&quot;,&quot;const char*&quot;,</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+&quot;ACTIONPARAM&quot;,&quot;1&quot;,&quot;icalparameter_action&quot;,&quot;ASK;ABORT&quot;</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+&quot;ID&quot;,&quot;13&quot;,&quot;const char*&quot;,</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+&quot;ENABLE&quot;,&quot;9&quot;,&quot;icalparameter_enable&quot;,&quot;TRUE;FALSE&quot;</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+&quot;LATENCY&quot;,&quot;15&quot;,&quot;const char*&quot;,</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+&quot;LOCAL&quot;,&quot;16&quot;,&quot;icalparameter_local&quot;,&quot;TRUE;FALSE&quot;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+&quot;LOCALIZE&quot;,&quot;17&quot;,&quot;const char*&quot;,</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+&quot;OPTIONS&quot;,&quot;19&quot;,&quot;const char*&quot;,</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+&quot;NO&quot;,&quot;32&quot;,,</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+&quot;#In practice any unknown paramater that is not an xparam is treated as an ianaparam&quot;</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+&quot;IANA&quot;,&quot;33&quot;,&quot;const char*&quot;,</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+&quot;ANY&quot;,&quot;0&quot;,,</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+&quot;#NOTE for updaters.  Preserve the icalparameter_kind Enum values to aid forward compatibility&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/libical/design-data/value-types.csv</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/libical/design-data/value-types.csv</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &quot;#Name&quot;,&quot;C type&amp; gen flag&quot;,&quot;Python&quot;,&quot;Component Values&quot;,&quot;Enum Values&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> &quot;BINARY&quot;,&quot;(a)const char*&quot;,&quot;file&quot;,&quot;unitary&quot;,</span>
<a href="#l2.6"></a><span id="l2.6"> &quot;BOOLEAN&quot;,&quot;(a)int&quot;,&quot;integer&quot;,&quot;unitary&quot;,</span>
<a href="#l2.7"></a><span id="l2.7"> &quot;CAL-ADDRESS&quot;,&quot;(a)const char*&quot;,&quot;string&quot;,&quot;unitary&quot;,</span>
<a href="#l2.8"></a><span id="l2.8"> &quot;DATE&quot;,&quot;(a)struct icaltimetype&quot;,&quot;Time&quot;,&quot;unitary&quot;,</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineminus">-&quot;DATE-TIME&quot;,&quot;(a)struct icaltimetype&quot;,&quot;Time&quot;,&quot;unitary&quot;,</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+&quot;DATE-TIME&quot;,&quot;(m)struct icaltimetype&quot;,&quot;Time&quot;,&quot;unitary&quot;,</span>
<a href="#l2.11"></a><span id="l2.11"> &quot;DURATION&quot;,&quot;(a)struct icaldurationtype&quot;,&quot;Duration&quot;,&quot;unitary&quot;,</span>
<a href="#l2.12"></a><span id="l2.12"> &quot;FLOAT&quot;,&quot;(a)float&quot;,&quot;float&quot;,&quot;unitary&quot;,</span>
<a href="#l2.13"></a><span id="l2.13"> &quot;INTEGER&quot;,&quot;(a)int&quot;,&quot;integer&quot;,&quot;unitary&quot;,</span>
<a href="#l2.14"></a><span id="l2.14"> &quot;PERIOD&quot;,&quot;(a)struct icalperiodtype&quot;,&quot;Period&quot;,&quot;unitary&quot;,</span>
<a href="#l2.15"></a><span id="l2.15"> &quot;RECUR&quot;,&quot;(m)struct icalrecurrencetype&quot;,&quot;RecurrenceSet&quot;,&quot;unitary&quot;,</span>
<a href="#l2.16"></a><span id="l2.16"> &quot;TEXT&quot;,&quot;(a)const char*&quot;,&quot;string&quot;,&quot;unitary&quot;,</span>
<a href="#l2.17"></a><span id="l2.17"> &quot;URI&quot;,&quot;(a)const char*&quot;,&quot;string&quot;,&quot;unitary&quot;,</span>
<a href="#l2.18"></a><span id="l2.18"> &quot;UTC-OFFSET&quot;,&quot;(a)int&quot;,&quot;integer&quot;,&quot;unitary&quot;,</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineat">@@ -18,18 +18,18 @@</span>
<a href="#l2.20"></a><span id="l2.20"> &quot;DATE-TIME-PERIOD&quot;,&quot;(m)struct icaldatetimeperiodtype&quot;,&quot;none&quot;,&quot;DATE-TIME;PERIOD&quot;,</span>
<a href="#l2.21"></a><span id="l2.21"> &quot;TRIGGER&quot;,&quot;(m)struct icaltriggertype&quot;,&quot;string&quot;,&quot;DURATION;DATE-TIME&quot;,</span>
<a href="#l2.22"></a><span id="l2.22"> &quot;#Non-standard property enumeration types&quot;,,,,</span>
<a href="#l2.23"></a><span id="l2.23"> &quot;METHOD&quot;,&quot;(a)enum icalproperty_method&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;PUBLISH;REQUEST;REPLY;ADD;CANCEL;REFRESH;COUNTER;DECLINECOUNTER;CREATE;READ;RESPONSE;MOVE;MODIFY;GENERATEUID;DELETE&quot;</span>
<a href="#l2.24"></a><span id="l2.24"> &quot;X-LIC-CLASS&quot;,&quot;(a)enum icalproperty_xlicclass&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;PUBLISH-NEW;PUBLISH-UPDATE;PUBLISH-FREEBUSY;REQUEST-NEW;REQUEST-UPDATE;REQUEST-RESCHEDULE;REQUEST-DELEGATE;REQUEST-NEW-ORGANIZER;REQUEST-FORWARD;REQUEST-STATUS;REQUEST-FREEBUSY;REPLY-ACCEPT;REPLY-DECLINE;REPLY-DELEGATE;REPLY-CRASHER-ACCEPT;REPLY-CRASHER-DECLINE;ADD-INSTANCE;CANCEL-EVENT;CANCEL-INSTANCE;CANCEL-ALL;REFRESH;COUNTER;DECLINECOUNTER;MALFORMED;OBSOLETE;MISSEQUENCED;UNKNOWN&quot;</span>
<a href="#l2.25"></a><span id="l2.25"> &quot;ACTION&quot;,&quot;(a)enum icalproperty_action&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;AUDIO;DISPLAY;EMAIL;PROCEDURE&quot;</span>
<a href="#l2.26"></a><span id="l2.26"> &quot;STATUS&quot;,&quot;(a)enum icalproperty_status&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;TENTATIVE;CONFIRMED;COMPLETED;NEEDS-ACTION;CANCELLED;IN-PROCESS;DRAFT;FINAL&quot;</span>
<a href="#l2.27"></a><span id="l2.27"> &quot;TRANSP&quot;,&quot;(a)enum icalproperty_transp&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;OPAQUE;OPAQUE-NOCONFLICT;TRANSPARENT;TRANSPARENT-NOCONFLICT&quot;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-&quot;CLASS&quot;,&quot;(a)enum icalproperty_class&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;PUBLIC;PRIVATE;CONFIDENTIAL&quot;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+&quot;CLASS&quot;,&quot;(m)enum icalproperty_class&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;PUBLIC;PRIVATE;CONFIDENTIAL&quot;</span>
<a href="#l2.30"></a><span id="l2.30"> &quot;#Other non-standard&quot;,,,,</span>
<a href="#l2.31"></a><span id="l2.31"> &quot;REQUEST-STATUS&quot;,&quot;(a)struct icalreqstattype&quot;,&quot;string&quot;,&quot;unitary&quot;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-&quot;GEO&quot;,&quot;(a)struct icalgeotype&quot;,&quot;tuple&quot;,&quot;unitary&quot;,</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+&quot;GEO&quot;,&quot;(m)struct icalgeotype&quot;,&quot;tuple&quot;,&quot;unitary&quot;,</span>
<a href="#l2.34"></a><span id="l2.34"> &quot;STRING&quot;,&quot;(a)const char*&quot;,&quot;string&quot;,&quot;unitary&quot;,</span>
<a href="#l2.35"></a><span id="l2.35"> &quot;X&quot;,&quot;(m)const char*&quot;,&quot;string&quot;,&quot;unitary&quot;,</span>
<a href="#l2.36"></a><span id="l2.36"> &quot;#CAP enumeration types&quot;,,,,</span>
<a href="#l2.37"></a><span id="l2.37"> &quot;CMD&quot;,&quot;(a)enum icalproperty_cmd&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;ABORT;CONTINUE;CREATE;DELETE;GENERATE-UID;GET-CAPABILITY;IDENTIFY;MODIFY;MOVE;REPLY;SEARCH;SET-LOCALE&quot;</span>
<a href="#l2.38"></a><span id="l2.38"> &quot;QUERY-LEVEL&quot;,&quot;(a)enum icalproperty_querylevel&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;CAL-QL-1;CAL-QL-NONE&quot;</span>
<a href="#l2.39"></a><span id="l2.39"> &quot;CAR-LEVEL&quot;,&quot;(a)enum icalproperty_carlevel&quot;,&quot;string&quot;,&quot;unitary&quot;,&quot;CAR-NONE;CAR-MIN;CAR-FULL-1&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/libical/scripts/mkderivedparameters.pl</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/libical/scripts/mkderivedparameters.pl</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -14,63 +14,72 @@ getopts('chspi:');</span>
<a href="#l3.4"></a><span id="l3.4"> # line, and putting the generated data after the demarcation</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> if ($opt_i) {</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">   open(IN,$opt_i) || die &quot;Can't open input file $opt_i&quot;;</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   while(&lt;IN&gt;){</span>
<a href="#l3.11"></a><span id="l3.11">     if (/&lt;insert_code_here&gt;/){</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+      $autogenMsg = &quot;of section of machine generated code (mkderivedparameters.pl). Do not edit.&quot;;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+      if($opt_p){</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+          $startComment = &quot;#&quot;;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+          $endComment = &quot;&quot;;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+      } else {</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+          $startComment = &quot;/*&quot;;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+          $endComment = &quot; */&quot;;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+      }</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+      print $startComment.&quot; START &quot;.$autogenMsg.$endComment.&quot;\n\n&quot;;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+</span>
<a href="#l3.22"></a><span id="l3.22">       insert_code();</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+      print $startComment.&quot; END   &quot;.$autogenMsg.$endComment.&quot;\n\n&quot;;</span>
<a href="#l3.25"></a><span id="l3.25">     } else {</span>
<a href="#l3.26"></a><span id="l3.26">       print;</span>
<a href="#l3.27"></a><span id="l3.27">    }</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29">   }    </span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-  if($opt_p){</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-     print &quot;# Everything below this line is machine generated. Do not edit. \n&quot;;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-  } else {</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-    print &quot;/* Everything below this line is machine generated. Do not edit. */\n&quot;;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-  }</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-</span>
<a href="#l3.37"></a><span id="l3.37"> }</span>
<a href="#l3.38"></a><span id="l3.38"> </span>
<a href="#l3.39"></a><span id="l3.39"> sub insert_code</span>
<a href="#l3.40"></a><span id="l3.40"> {</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42"> # Write parameter enumerations and datatypes</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44"> if($opt_h){</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-  print &quot;typedef enum icalparameter_kind {\n    ICAL_ANY_PARAMETER = 0,\n&quot;;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+  my $enumConst = $params{'ANY'}-&gt;{&quot;kindEnum&quot;};</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+  print &quot;typedef enum icalparameter_kind {\n    ICAL_ANY_PARAMETER = &quot;.$enumConst.&quot;,\n&quot;;</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+  $enumVal = 1;</span>
<a href="#l3.49"></a><span id="l3.49">   foreach $param (sort keys %params) {</span>
<a href="#l3.50"></a><span id="l3.50">     </span>
<a href="#l3.51"></a><span id="l3.51">     next if !$param;</span>
<a href="#l3.52"></a><span id="l3.52">     </span>
<a href="#l3.53"></a><span id="l3.53">     next if $param eq 'NO' or $param eq 'ANY';</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55">     my $uc = join(&quot;&quot;,map {uc($_);}  split(/-/,$param));</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-    my @enums = @{$params{$param}-&gt;{'enums'}};</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+    $enumConst = $params{$param}-&gt;{&quot;kindEnum&quot;};</span>
<a href="#l3.59"></a><span id="l3.59">         </span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-    print &quot;    ICAL_${uc}_PARAMETER, \n&quot;;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+    print &quot;    ICAL_${uc}_PARAMETER = &quot;.$enumConst.&quot;, \n&quot;;</span>
<a href="#l3.62"></a><span id="l3.62">     </span>
<a href="#l3.63"></a><span id="l3.63">   }  </span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-  print &quot;    ICAL_NO_PARAMETER\n} icalparameter_kind;\n\n&quot;;</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+  $enumConst = $params{'NO'}-&gt;{&quot;kindEnum&quot;};</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+  print &quot;    ICAL_NO_PARAMETER = &quot;.$enumConst.&quot;\n} icalparameter_kind;\n\n&quot;;</span>
<a href="#l3.67"></a><span id="l3.67"> </span>
<a href="#l3.68"></a><span id="l3.68">   # Now create enumerations for parameter values</span>
<a href="#l3.69"></a><span id="l3.69">   $idx = 20000;</span>
<a href="#l3.70"></a><span id="l3.70">   </span>
<a href="#l3.71"></a><span id="l3.71">   print &quot;#define ICALPARAMETER_FIRST_ENUM $idx\n\n&quot;;</span>
<a href="#l3.72"></a><span id="l3.72">   </span>
<a href="#l3.73"></a><span id="l3.73">   foreach $param (sort keys %params) {</span>
<a href="#l3.74"></a><span id="l3.74">     </span>
<a href="#l3.75"></a><span id="l3.75">     next if !$param;</span>
<a href="#l3.76"></a><span id="l3.76">     </span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-    next if $param eq 'NO' or $prop eq 'ANY';</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+    next if $param eq 'NO' or $param eq 'ANY';</span>
<a href="#l3.79"></a><span id="l3.79"> </span>
<a href="#l3.80"></a><span id="l3.80">     my $type = $params{$param}-&gt;{&quot;C&quot;};</span>
<a href="#l3.81"></a><span id="l3.81">     my $ucv = join(&quot;&quot;,map {uc(lc($_));}  split(/-/,$param));    </span>
<a href="#l3.82"></a><span id="l3.82">     my @enums = @{$params{$param}-&gt;{'enums'}};</span>
<a href="#l3.83"></a><span id="l3.83"> </span>
<a href="#l3.84"></a><span id="l3.84">     if(@enums){</span>
<a href="#l3.85"></a><span id="l3.85"> </span>
<a href="#l3.86"></a><span id="l3.86">       print &quot;typedef enum $type {\n&quot;;</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineat">@@ -126,17 +135,17 @@ if ($opt_c){</span>
<a href="#l3.88"></a><span id="l3.88">   #Create the parameter Name map</span>
<a href="#l3.89"></a><span id="l3.89"> </span>
<a href="#l3.90"></a><span id="l3.90">   $out=&quot;&quot;;</span>
<a href="#l3.91"></a><span id="l3.91">   $count=0;</span>
<a href="#l3.92"></a><span id="l3.92">   foreach $param (sort keys %params) {</span>
<a href="#l3.93"></a><span id="l3.93">     </span>
<a href="#l3.94"></a><span id="l3.94">     next if !$param;</span>
<a href="#l3.95"></a><span id="l3.95">     </span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-    next if $param eq 'NO' or $prop eq 'ANY';</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+    next if $param eq 'NO' or $param eq 'ANY';</span>
<a href="#l3.98"></a><span id="l3.98"> </span>
<a href="#l3.99"></a><span id="l3.99">     my $lc = join(&quot;&quot;,map {lc($_);}  split(/-/,$param));    </span>
<a href="#l3.100"></a><span id="l3.100">     my $uc = join(&quot;&quot;,map {uc(lc($_));}  split(/-/,$param));    </span>
<a href="#l3.101"></a><span id="l3.101"> </span>
<a href="#l3.102"></a><span id="l3.102">     $count++;</span>
<a href="#l3.103"></a><span id="l3.103">     $out.=&quot;    {ICAL_${uc}_PARAMETER,\&quot;$param\&quot;},\n&quot;;</span>
<a href="#l3.104"></a><span id="l3.104"> </span>
<a href="#l3.105"></a><span id="l3.105">   }</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineat">@@ -147,17 +156,17 @@ if ($opt_c){</span>
<a href="#l3.107"></a><span id="l3.107">   </span>
<a href="#l3.108"></a><span id="l3.108">   # Create the parameter value map</span>
<a href="#l3.109"></a><span id="l3.109">   $out =&quot;&quot;;</span>
<a href="#l3.110"></a><span id="l3.110">   $count=0;</span>
<a href="#l3.111"></a><span id="l3.111">   foreach $param (sort keys %params) {</span>
<a href="#l3.112"></a><span id="l3.112">     </span>
<a href="#l3.113"></a><span id="l3.113">     next if !$param;</span>
<a href="#l3.114"></a><span id="l3.114">     </span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-    next if $param eq 'NO' or $prop eq 'ANY';</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+    next if $param eq 'NO' or $param eq 'ANY';</span>
<a href="#l3.117"></a><span id="l3.117"> </span>
<a href="#l3.118"></a><span id="l3.118">     my $type = $params{$param}-&gt;{&quot;C&quot;};</span>
<a href="#l3.119"></a><span id="l3.119">     my $uc = join(&quot;&quot;,map {uc(lc($_));}  split(/-/,$param));    </span>
<a href="#l3.120"></a><span id="l3.120">     my @enums = @{$params{$param}-&gt;{'enums'}};</span>
<a href="#l3.121"></a><span id="l3.121"> </span>
<a href="#l3.122"></a><span id="l3.122">     if(@enums){</span>
<a href="#l3.123"></a><span id="l3.123"> </span>
<a href="#l3.124"></a><span id="l3.124">       foreach $e (@enums){</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineat">@@ -173,17 +182,19 @@ if ($opt_c){</span>
<a href="#l3.126"></a><span id="l3.126">   $count+=3;</span>
<a href="#l3.127"></a><span id="l3.127">   print &quot;static const struct icalparameter_map icalparameter_map[] = {\n&quot;;</span>
<a href="#l3.128"></a><span id="l3.128">   print &quot;{ICAL_ANY_PARAMETER,0,\&quot;\&quot;},\n&quot;;</span>
<a href="#l3.129"></a><span id="l3.129">   print $out;</span>
<a href="#l3.130"></a><span id="l3.130">   print &quot;    {ICAL_NO_PARAMETER,0,\&quot;\&quot;}};\n\n&quot;;</span>
<a href="#l3.131"></a><span id="l3.131"> </span>
<a href="#l3.132"></a><span id="l3.132"> }</span>
<a href="#l3.133"></a><span id="l3.133"> </span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-foreach $param  (keys %params){</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+foreach $param  (sort keys %params){</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+  next if $param eq 'NO' or $param eq 'ANY';</span>
<a href="#l3.138"></a><span id="l3.138"> </span>
<a href="#l3.139"></a><span id="l3.139">   my $type = $params{$param}-&gt;{'C'};</span>
<a href="#l3.140"></a><span id="l3.140"> </span>
<a href="#l3.141"></a><span id="l3.141">   my $ucf = join(&quot;&quot;,map {ucfirst(lc($_));}  split(/-/,$param));</span>
<a href="#l3.142"></a><span id="l3.142">   </span>
<a href="#l3.143"></a><span id="l3.143">   my $lc = lc($ucf);</span>
<a href="#l3.144"></a><span id="l3.144">   my $uc = uc($lc);</span>
<a href="#l3.145"></a><span id="l3.145">  </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/libical/scripts/mkderivedproperties.pl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/libical/scripts/mkderivedproperties.pl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -174,30 +174,34 @@ foreach $prop (sort keys %propmap) {</span>
<a href="#l4.4"></a><span id="l4.4">   my $set_pointer_check = &quot;icalerror_check_arg_rv( (v!=0),\&quot;v\&quot;);\n&quot; if $type =~ /\*/;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">   if($opt_c) { # Generate C source</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">    if ($include_vanew) {</span>
<a href="#l4.9"></a><span id="l4.9">      print&lt;&lt;EOM;</span>
<a href="#l4.10"></a><span id="l4.10"> icalproperty* icalproperty_vanew_${lc}($type v, ...){</span>
<a href="#l4.11"></a><span id="l4.11">    va_list args;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-   struct icalproperty_impl *impl = icalproperty_new_impl(ICAL_${uc}_PROPERTY);   $pointer_check</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+   struct icalproperty_impl *impl;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+   $pointer_check</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+   impl= icalproperty_new_impl(ICAL_${uc}_PROPERTY);</span>
<a href="#l4.16"></a><span id="l4.16">    icalproperty_set_${lc}((icalproperty*)impl,v);</span>
<a href="#l4.17"></a><span id="l4.17">    va_start(args,v);</span>
<a href="#l4.18"></a><span id="l4.18">    icalproperty_add_parameters(impl, args);</span>
<a href="#l4.19"></a><span id="l4.19">    va_end(args);</span>
<a href="#l4.20"></a><span id="l4.20">    return (icalproperty*)impl;</span>
<a href="#l4.21"></a><span id="l4.21"> }</span>
<a href="#l4.22"></a><span id="l4.22"> EOM</span>
<a href="#l4.23"></a><span id="l4.23"> }</span>
<a href="#l4.24"></a><span id="l4.24"> 	print&lt;&lt;EOM;</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26"> /* $prop */</span>
<a href="#l4.27"></a><span id="l4.27"> icalproperty* icalproperty_new_${lc}($type v) {</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-   struct icalproperty_impl *impl = icalproperty_new_impl(ICAL_${uc}_PROPERTY);   $pointer_check</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+   struct icalproperty_impl *impl;</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+   $pointer_check</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+   impl = icalproperty_new_impl(ICAL_${uc}_PROPERTY);</span>
<a href="#l4.32"></a><span id="l4.32">    icalproperty_set_${lc}((icalproperty*)impl,v);</span>
<a href="#l4.33"></a><span id="l4.33">    return (icalproperty*)impl;</span>
<a href="#l4.34"></a><span id="l4.34"> }</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36"> EOM</span>
<a href="#l4.37"></a><span id="l4.37">     # Allow DTSTART, DTEND, DUE, EXDATE and RECURRENCE-ID to take DATE values.</span>
<a href="#l4.38"></a><span id="l4.38">     if ($lc eq &quot;dtstart&quot; || $lc eq &quot;dtend&quot; || $lc eq &quot;due&quot; || $lc eq &quot;exdate&quot;</span>
<a href="#l4.39"></a><span id="l4.39"> 	|| $lc eq &quot;recurrenceid&quot;) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/libical/scripts/mkderivedvalues.pl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/libical/scripts/mkderivedvalues.pl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -179,18 +179,19 @@ foreach $value  (keys %h) {</span>
<a href="#l5.4"></a><span id="l5.4">   } else {</span>
<a href="#l5.5"></a><span id="l5.5">     $union_data = $lc;</span>
<a href="#l5.6"></a><span id="l5.6">   }</span>
<a href="#l5.7"></a><span id="l5.7">   </span>
<a href="#l5.8"></a><span id="l5.8">   if ($opt_c &amp;&amp; $autogen) {</span>
<a href="#l5.9"></a><span id="l5.9">     </span>
<a href="#l5.10"></a><span id="l5.10">     print &quot;\n\n\</span>
<a href="#l5.11"></a><span id="l5.11"> icalvalue* icalvalue_new_${lc} ($type v){\</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-   struct icalvalue_impl* impl = icalvalue_new_impl(ICAL_${uc}_VALUE);\</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+   struct icalvalue_impl* impl;\</span>
<a href="#l5.14"></a><span id="l5.14">    $pointer_check\</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+   impl = icalvalue_new_impl(ICAL_${uc}_VALUE);\</span>
<a href="#l5.16"></a><span id="l5.16">    icalvalue_set_${lc}((icalvalue*)impl,v);\</span>
<a href="#l5.17"></a><span id="l5.17">    return (icalvalue*)impl;\</span>
<a href="#l5.18"></a><span id="l5.18"> }\</span>
<a href="#l5.19"></a><span id="l5.19"> void icalvalue_set_${lc}(icalvalue* value, $type v) {\</span>
<a href="#l5.20"></a><span id="l5.20">     struct icalvalue_impl* impl; \</span>
<a href="#l5.21"></a><span id="l5.21">     icalerror_check_arg_rv( (value!=0),\&quot;value\&quot;);\</span>
<a href="#l5.22"></a><span id="l5.22">     $pointer_check_rv\</span>
<a href="#l5.23"></a><span id="l5.23">     icalerror_check_value_type(value, ICAL_${uc}_VALUE);\</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/libical/scripts/readvaluesfile.pl</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/libical/scripts/readvaluesfile.pl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -105,25 +105,27 @@ sub read_parameters_file {</span>
<a href="#l6.4"></a><span id="l6.4">     s/\r//g;</span>
<a href="#l6.5"></a><span id="l6.5">    </span>
<a href="#l6.6"></a><span id="l6.6">     next if ! $_;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">     @column = split(/\,/,$_);</span>
<a href="#l6.9"></a><span id="l6.9">   </span>
<a href="#l6.10"></a><span id="l6.10">     my $parameter_name = $column[0];</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    my $data_type = $column[1];</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-    my $enum_string = $column[2];</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    my $enumConst = $column[1];</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    my $data_type = $column[2];</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+    my $enum_string = $column[3];</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">     my @enums;</span>
<a href="#l6.19"></a><span id="l6.19">     if($enum_string){</span>
<a href="#l6.20"></a><span id="l6.20">       @enums =  split(/;/,$enum_string);</span>
<a href="#l6.21"></a><span id="l6.21">     }</span>
<a href="#l6.22"></a><span id="l6.22">     </span>
<a href="#l6.23"></a><span id="l6.23">     $h{$parameter_name} = { C =&gt; $data_type,</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+			   kindEnum =&gt; $enumConst,</span>
<a href="#l6.25"></a><span id="l6.25"> 			   enums =&gt; [@enums]</span>
<a href="#l6.26"></a><span id="l6.26"> 			 };</span>
<a href="#l6.27"></a><span id="l6.27">   }</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29">   close(F);</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31">   return %h;</span>
<a href="#l6.32"></a><span id="l6.32"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/libical/src/libical/Makefile.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/libical/src/libical/Makefile.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -103,41 +103,42 @@ include $(topsrcdir)/config/rules.mk</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> DESIGNDATA = $(srcdir)/../../design-data</span>
<a href="#l7.6"></a><span id="l7.6"> ICALSCRIPTS = $(srcdir)/../../scripts</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> # ORDERING OF HEADERS IS SIGNIFICANT. Don't change this ordering. It</span>
<a href="#l7.9"></a><span id="l7.9"> # is required to make the combined header ical.h properly</span>
<a href="#l7.10"></a><span id="l7.10"> COMBINEDHEADERS =                        \</span>
<a href="#l7.11"></a><span id="l7.11">         $(srcdir)/../../config.h         \</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-	$(srcdir)/icalversion.h          \</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-	$(srcdir)/icaltime.h             \</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-	$(srcdir)/icalduration.h         \</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-	$(srcdir)/icalperiod.h           \</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-	$(srcdir)/icalenums.h            \</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-	$(srcdir)/icaltypes.h            \</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-	$(srcdir)/icalrecur.h            \</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-	$(srcdir)/icalattach.h           \</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-	icalderivedvalue.h               \</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-	icalderivedparameter.h           \</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-	$(srcdir)/icalvalue.h            \</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-	$(srcdir)/icalparameter.h        \</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-	icalderivedproperty.h            \</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-	$(srcdir)/icalproperty.h         \</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-	$(srcdir)/pvl.h                  \</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-	$(srcdir)/icalarray.h            \</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-	$(srcdir)/icalcomponent.h        \</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-	$(srcdir)/icaltimezone.h         \</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-	$(srcdir)/icalparser.h           \</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-	$(srcdir)/icalmemory.h           \</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-	$(srcdir)/icalerror.h            \</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-	$(srcdir)/icalrestriction.h      \</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-	$(srcdir)/sspm.h                 \</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-	$(srcdir)/icalmime.h             \</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-	$(srcdir)/icallangbind.h        </span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+   $(srcdir)/icalversion.h               \</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+   $(srcdir)/icaltime.h                  \</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+   $(srcdir)/icalduration.h              \</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+   $(srcdir)/icalperiod.h                \</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+   $(srcdir)/icalenums.h                 \</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+   $(srcdir)/icaltypes.h                 \</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+   $(srcdir)/icalrecur.h                 \</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+   $(srcdir)/icalattach.h                \</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+   icalderivedvalue.h                    \</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+   icalderivedparameter.h                \</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+   $(srcdir)/icalvalue.h                 \</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+   $(srcdir)/icalparameter.h             \</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+   icalderivedproperty.h                 \</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+   $(srcdir)/icalproperty.h              \</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+   $(srcdir)/pvl.h                       \</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+   $(srcdir)/icalarray.h                 \</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+   $(srcdir)/icalcomponent.h             \</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+   $(srcdir)/icaltimezone.h              \</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+   $(srcdir)/icalparser.h                \</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+   $(srcdir)/icalmemory.h                \</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+   $(srcdir)/icalerror.h                 \</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+   $(srcdir)/icalrestriction.h           \</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+   $(srcdir)/sspm.h                      \</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+   $(srcdir)/icalmime.h                  \</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+   $(srcdir)/icallangbind.h              \</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+   $(NULL)</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64"> BUILT_COMBINEDHEADERS = 	\</span>
<a href="#l7.65"></a><span id="l7.65"> 	icalderivedparameter.h	\</span>
<a href="#l7.66"></a><span id="l7.66"> 	icalderivedproperty.h	\</span>
<a href="#l7.67"></a><span id="l7.67"> 	icalderivedvalue.h</span>
<a href="#l7.68"></a><span id="l7.68"> </span>
<a href="#l7.69"></a><span id="l7.69"> BUILT_SOURCES =			\</span>
<a href="#l7.70"></a><span id="l7.70"> 	$(BUILT_COMBINEDHEADERS)\</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/libical/src/libical/caldate.c</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/libical/src/libical/caldate.c</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -67,40 +67,40 @@ struct ut_instant * date;</span>
<a href="#l8.4"></a><span id="l8.4"> 	long ke;</span>
<a href="#l8.5"></a><span id="l8.5"> 	long ialp;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> 	jd = (long) (date-&gt;j_date + 0.5);	/* integer julian date */</span>
<a href="#l8.8"></a><span id="l8.8"> 	frac = date-&gt;j_date + 0.5 - (double) jd + 1.0e-10; /* day fraction */</span>
<a href="#l8.9"></a><span id="l8.9"> 	ka = (long) jd;</span>
<a href="#l8.10"></a><span id="l8.10"> 	if ( jd &gt;= 2299161L )</span>
<a href="#l8.11"></a><span id="l8.11"> 	{</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-		ialp = ( (double) jd - 1867216.25 ) / ( 36524.25 );</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+		ialp = (long) (((double) jd) - 1867216.25 ) / 36524.25;</span>
<a href="#l8.14"></a><span id="l8.14"> 		ka = jd + 1L + ialp - ( ialp &gt;&gt; 2 );</span>
<a href="#l8.15"></a><span id="l8.15"> 	}</span>
<a href="#l8.16"></a><span id="l8.16"> 	kb = ka + 1524L;</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-	kc =  ( (double) kb - 122.1 ) / 365.25;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-	kd = (double) kc * 365.25;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-	ke = (double) ( kb - kd ) / 30.6001;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+	kc = (long) ((double) kb - 122.1 ) / 365.25;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+	kd = (long) (double) kc * 365.25;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+	ke = (long) (double) ( kb - kd ) / 30.6001;</span>
<a href="#l8.23"></a><span id="l8.23"> 	date-&gt;day = kb - kd - ((long) ( (double) ke * 30.6001 ));</span>
<a href="#l8.24"></a><span id="l8.24"> 	if ( ke &gt; 13L )</span>
<a href="#l8.25"></a><span id="l8.25"> 		date-&gt;month = ke - 13L;</span>
<a href="#l8.26"></a><span id="l8.26"> 	else</span>
<a href="#l8.27"></a><span id="l8.27"> 		date-&gt;month = ke - 1L;</span>
<a href="#l8.28"></a><span id="l8.28"> 	if ( (date-&gt;month == 2) &amp;&amp; (date-&gt;day &gt; 28) )</span>
<a href="#l8.29"></a><span id="l8.29"> 		date-&gt;day = 29;</span>
<a href="#l8.30"></a><span id="l8.30"> 	if ( (date-&gt;month == 2) &amp;&amp; (date-&gt;day == 29) &amp;&amp; (ke == 3L) )</span>
<a href="#l8.31"></a><span id="l8.31"> 		date-&gt;year = kc - 4716L;</span>
<a href="#l8.32"></a><span id="l8.32"> 	else if ( date-&gt;month &gt; 2 )</span>
<a href="#l8.33"></a><span id="l8.33"> 		date-&gt;year = kc - 4716L;</span>
<a href="#l8.34"></a><span id="l8.34"> 	else</span>
<a href="#l8.35"></a><span id="l8.35"> 		date-&gt;year = kc - 4715L;</span>
<a href="#l8.36"></a><span id="l8.36"> 	date-&gt;i_hour = date-&gt;d_hour = frac * 24.0;	/* hour */</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-	date-&gt;i_minute = date-&gt;d_minute =</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+	date-&gt;i_minute = date-&gt;d_minute = (long)</span>
<a href="#l8.39"></a><span id="l8.39"> 		( date-&gt;d_hour - (double) date-&gt;i_hour ) * 60.0; /* minute */</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-	date-&gt;i_second = date-&gt;d_second =</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+	date-&gt;i_second = date-&gt;d_second = (long)</span>
<a href="#l8.42"></a><span id="l8.42"> 		( date-&gt;d_minute - (double) date-&gt;i_minute ) * 60.0;/* second */</span>
<a href="#l8.43"></a><span id="l8.43"> 	date-&gt;weekday = (jd + 1L) % 7L;	/* day of week */</span>
<a href="#l8.44"></a><span id="l8.44"> 	if ( date-&gt;year == ((date-&gt;year &gt;&gt; 2) &lt;&lt; 2) )</span>
<a href="#l8.45"></a><span id="l8.45"> 		date-&gt;day_of_year =</span>
<a href="#l8.46"></a><span id="l8.46"> 			( ( 275 * date-&gt;month ) / 9)</span>
<a href="#l8.47"></a><span id="l8.47"> 			- ((date-&gt;month + 9) / 12)</span>
<a href="#l8.48"></a><span id="l8.48"> 			+ date-&gt;day - 30;</span>
<a href="#l8.49"></a><span id="l8.49"> 	else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/libical/src/libical/icalarray.c</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalarray.c</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -61,25 +61,52 @@ icalarray_new			(int		 element_size,</span>
<a href="#l9.4"></a><span id="l9.4">     array-&gt;increment_size = increment_size;</span>
<a href="#l9.5"></a><span id="l9.5">     array-&gt;num_elements = 0;</span>
<a href="#l9.6"></a><span id="l9.6">     array-&gt;space_allocated = 0;</span>
<a href="#l9.7"></a><span id="l9.7">     array-&gt;data = NULL;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">     return array;</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+icalarray *icalarray_copy	(icalarray	*originalarray)</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+{</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+    icalarray *array = icalarray_new(originalarray-&gt;element_size, originalarray-&gt;increment_size);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+    if (!array)</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+        return NULL;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+    array-&gt;num_elements = originalarray-&gt;num_elements;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+    array-&gt;space_allocated = originalarray-&gt;space_allocated;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+    </span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+    array-&gt;data = malloc(array-&gt;space_allocated * array-&gt;element_size);</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+    if (array-&gt;data) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+	memcpy(array-&gt;data, originalarray-&gt;data,</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+               array-&gt;element_size*array-&gt;space_allocated);</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+    } else {</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+	icalerror_set_errno(ICAL_ALLOCATION_ERROR);</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+    }</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    return array;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+}</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+</span>
<a href="#l9.36"></a><span id="l9.36"> /** @brief Destructor</span>
<a href="#l9.37"></a><span id="l9.37">  */</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39"> void</span>
<a href="#l9.40"></a><span id="l9.40"> icalarray_free			(icalarray	*array)</span>
<a href="#l9.41"></a><span id="l9.41"> {</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-    if (array-&gt;data)</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+    if (array-&gt;data) {</span>
<a href="#l9.44"></a><span id="l9.44"> 	free (array-&gt;data);</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+	array-&gt;data = 0;</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+    }</span>
<a href="#l9.47"></a><span id="l9.47">     free (array);</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+    array = 0;</span>
<a href="#l9.49"></a><span id="l9.49"> }</span>
<a href="#l9.50"></a><span id="l9.50"> </span>
<a href="#l9.51"></a><span id="l9.51"> </span>
<a href="#l9.52"></a><span id="l9.52"> void</span>
<a href="#l9.53"></a><span id="l9.53"> icalarray_append		(icalarray	*array,</span>
<a href="#l9.54"></a><span id="l9.54"> 				 const void		*element)</span>
<a href="#l9.55"></a><span id="l9.55"> {</span>
<a href="#l9.56"></a><span id="l9.56">     if (array-&gt;num_elements &gt;= array-&gt;space_allocated)</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineat">@@ -147,17 +174,20 @@ icalarray_expand		(icalarray	*array,</span>
<a href="#l9.58"></a><span id="l9.58"> 	/*</span>
<a href="#l9.59"></a><span id="l9.59">     new_data = realloc (array-&gt;data,</span>
<a href="#l9.60"></a><span id="l9.60"> 			new_space_allocated * array-&gt;element_size);</span>
<a href="#l9.61"></a><span id="l9.61"> 	*/</span>
<a href="#l9.62"></a><span id="l9.62"> 	new_data = malloc(new_space_allocated * array-&gt;element_size);</span>
<a href="#l9.63"></a><span id="l9.63"> </span>
<a href="#l9.64"></a><span id="l9.64">     if (new_data) {</span>
<a href="#l9.65"></a><span id="l9.65"> 	memcpy(new_data,array-&gt;data,array-&gt;element_size*array-&gt;space_allocated);</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-	free(array-&gt;data);</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+	if (array-&gt;data) {</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+	    free(array-&gt;data);</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+	    array-&gt;data = 0;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+	}</span>
<a href="#l9.71"></a><span id="l9.71"> 	array-&gt;data = new_data;</span>
<a href="#l9.72"></a><span id="l9.72"> 	array-&gt;space_allocated = new_space_allocated;</span>
<a href="#l9.73"></a><span id="l9.73">     } else {</span>
<a href="#l9.74"></a><span id="l9.74"> 	icalerror_set_errno(ICAL_ALLOCATION_ERROR);</span>
<a href="#l9.75"></a><span id="l9.75">     }</span>
<a href="#l9.76"></a><span id="l9.76"> }</span>
<a href="#l9.77"></a><span id="l9.77"> </span>
<a href="#l9.78"></a><span id="l9.78"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/libical/src/libical/icalarray.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalarray.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -41,16 +41,17 @@ struct _icalarray {</span>
<a href="#l10.4"></a><span id="l10.4">     unsigned int	 space_allocated;</span>
<a href="#l10.5"></a><span id="l10.5">     void		*data;</span>
<a href="#l10.6"></a><span id="l10.6"> };</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> icalarray *icalarray_new		(int		 element_size,</span>
<a href="#l10.11"></a><span id="l10.11"> 					 int		 increment_size);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+icalarray *icalarray_copy		(icalarray	*array);</span>
<a href="#l10.13"></a><span id="l10.13"> void	   icalarray_free		(icalarray	*array);</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15"> void	   icalarray_append		(icalarray	*array,</span>
<a href="#l10.16"></a><span id="l10.16"> 					 const void		*element);</span>
<a href="#l10.17"></a><span id="l10.17"> void	   icalarray_remove_element_at	(icalarray	*array,</span>
<a href="#l10.18"></a><span id="l10.18"> 					 int		 position);</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> void	  *icalarray_element_at		(icalarray	*array,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/libical/src/libical/icalattach.c</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalattach.c</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -58,31 +58,38 @@ icalattach_new_from_url (const char *url</span>
<a href="#l11.4"></a><span id="l11.4">     attach-&gt;refcount = 1;</span>
<a href="#l11.5"></a><span id="l11.5">     attach-&gt;is_url = 1;</span>
<a href="#l11.6"></a><span id="l11.6">     attach-&gt;u.url.url = url_copy;</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">     return attach;</span>
<a href="#l11.9"></a><span id="l11.9"> }</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> icalattach *</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-icalattach_new_from_data (unsigned char *data, icalattach_free_fn_t free_fn,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+icalattach_new_from_data (const char *data, icalattach_free_fn_t free_fn,</span>
<a href="#l11.14"></a><span id="l11.14"> 			  void *free_fn_data)</span>
<a href="#l11.15"></a><span id="l11.15"> {</span>
<a href="#l11.16"></a><span id="l11.16">     icalattach *attach;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+    char *data_copy;</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">     icalerror_check_arg_rz ((data != NULL), &quot;data&quot;);</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">     if ((attach = malloc (sizeof (icalattach))) == NULL) {</span>
<a href="#l11.22"></a><span id="l11.22"> 	errno = ENOMEM;</span>
<a href="#l11.23"></a><span id="l11.23"> 	return NULL;</span>
<a href="#l11.24"></a><span id="l11.24">     }</span>
<a href="#l11.25"></a><span id="l11.25"> </span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+    if ((data_copy = strdup (data)) == NULL) {</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+	free (attach);</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+	errno = ENOMEM;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+	return NULL;</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+    }</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+</span>
<a href="#l11.32"></a><span id="l11.32">     attach-&gt;refcount = 1;</span>
<a href="#l11.33"></a><span id="l11.33">     attach-&gt;is_url = 0;</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-    attach-&gt;u.data.data = data;</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+    attach-&gt;u.data.data = data_copy;</span>
<a href="#l11.36"></a><span id="l11.36">     attach-&gt;u.data.free_fn = free_fn;</span>
<a href="#l11.37"></a><span id="l11.37">     attach-&gt;u.data.free_fn_data = free_fn_data;</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39">     return attach;</span>
<a href="#l11.40"></a><span id="l11.40"> }</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42"> void</span>
<a href="#l11.43"></a><span id="l11.43"> icalattach_ref (icalattach *attach)</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineat">@@ -99,20 +106,25 @@ icalattach_unref (icalattach *attach)</span>
<a href="#l11.45"></a><span id="l11.45">     icalerror_check_arg_rv ((attach != NULL), &quot;attach&quot;);</span>
<a href="#l11.46"></a><span id="l11.46">     icalerror_check_arg_rv ((attach-&gt;refcount &gt; 0), &quot;attach-&gt;refcount &gt; 0&quot;);</span>
<a href="#l11.47"></a><span id="l11.47"> </span>
<a href="#l11.48"></a><span id="l11.48">     attach-&gt;refcount--;</span>
<a href="#l11.49"></a><span id="l11.49"> </span>
<a href="#l11.50"></a><span id="l11.50">     if (attach-&gt;refcount != 0)</span>
<a href="#l11.51"></a><span id="l11.51"> 	return;</span>
<a href="#l11.52"></a><span id="l11.52"> </span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-    if (attach-&gt;is_url)</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+    if (attach-&gt;is_url) {</span>
<a href="#l11.55"></a><span id="l11.55"> 	free (attach-&gt;u.url.url);</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-    else if (attach-&gt;u.data.free_fn)</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-	(* attach-&gt;u.data.free_fn) (attach-&gt;u.data.data, attach-&gt;u.data.free_fn_data);</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+    } else {</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+	free (attach-&gt;u.data.data);</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+/* unused for now</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+	if (attach-&gt;u.data.free_fn)</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+	   (* attach-&gt;u.data.free_fn) (attach-&gt;u.data.data, attach-&gt;u.data.free_fn_data);</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+*/</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+    }</span>
<a href="#l11.65"></a><span id="l11.65"> </span>
<a href="#l11.66"></a><span id="l11.66">     free (attach);</span>
<a href="#l11.67"></a><span id="l11.67"> }</span>
<a href="#l11.68"></a><span id="l11.68"> </span>
<a href="#l11.69"></a><span id="l11.69"> int</span>
<a href="#l11.70"></a><span id="l11.70"> icalattach_get_is_url (icalattach *attach)</span>
<a href="#l11.71"></a><span id="l11.71"> {</span>
<a href="#l11.72"></a><span id="l11.72">     icalerror_check_arg_rz ((attach != NULL), &quot;attach&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/libical/src/libical/icalattach.h</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalattach.h</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -25,17 +25,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> #define ICALATTACH_H</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> typedef struct icalattach_impl icalattach;</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9"> typedef void (* icalattach_free_fn_t) (unsigned char *data, void *user_data);</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11"> icalattach *icalattach_new_from_url (const char *url);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-icalattach *icalattach_new_from_data (unsigned char *data,</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+icalattach *icalattach_new_from_data (const char *data,</span>
<a href="#l12.14"></a><span id="l12.14"> 	icalattach_free_fn_t free_fn, void *free_fn_data);</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16"> void icalattach_ref (icalattach *attach);</span>
<a href="#l12.17"></a><span id="l12.17"> void icalattach_unref (icalattach *attach);</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19"> int icalattach_get_is_url (icalattach *attach);</span>
<a href="#l12.20"></a><span id="l12.20"> const char *icalattach_get_url (icalattach *attach);</span>
<a href="#l12.21"></a><span id="l12.21"> unsigned char *icalattach_get_data (icalattach *attach);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/libical/src/libical/icalattachimpl.h</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalattachimpl.h</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -41,17 +41,17 @@ struct icalattach_impl {</span>
<a href="#l13.4"></a><span id="l13.4"> 	union {</span>
<a href="#l13.5"></a><span id="l13.5"> 		/* URL attachment data */</span>
<a href="#l13.6"></a><span id="l13.6"> 		struct {</span>
<a href="#l13.7"></a><span id="l13.7"> 			char *url;</span>
<a href="#l13.8"></a><span id="l13.8"> 		} url;</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10"> 		/* Inline data */</span>
<a href="#l13.11"></a><span id="l13.11"> 		struct {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-			unsigned char *data;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+			char *data;</span>
<a href="#l13.14"></a><span id="l13.14"> 			icalattach_free_fn_t free_fn;</span>
<a href="#l13.15"></a><span id="l13.15"> 			void *free_fn_data;</span>
<a href="#l13.16"></a><span id="l13.16"> 		} data;</span>
<a href="#l13.17"></a><span id="l13.17"> 	} u;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> 	/* TRUE if URL, FALSE if inline data */</span>
<a href="#l13.20"></a><span id="l13.20"> 	unsigned int is_url : 1;</span>
<a href="#l13.21"></a><span id="l13.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/libical/src/libical/icalcomponent.c</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalcomponent.c</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -41,19 +41,22 @@</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> #include &lt;stdlib.h&gt;  /* for malloc */</span>
<a href="#l14.6"></a><span id="l14.6"> #include &lt;stdarg.h&gt; /* for va_list, etc */</span>
<a href="#l14.7"></a><span id="l14.7"> #include &lt;errno.h&gt;</span>
<a href="#l14.8"></a><span id="l14.8"> #include &lt;assert.h&gt;</span>
<a href="#l14.9"></a><span id="l14.9"> #include &lt;stdio.h&gt; /* for fprintf */</span>
<a href="#l14.10"></a><span id="l14.10"> #include &lt;string.h&gt; /* for strdup */</span>
<a href="#l14.11"></a><span id="l14.11"> #include &lt;limits.h&gt; /* for INT_MAX */</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+</span>
<a href="#l14.13"></a><span id="l14.13"> #ifdef WIN32</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-#define snprintf _snprintf</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-#define strncasecmp strnicmp</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+#define strncasecmp      strnicmp</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+#include &quot;vsnprintf.h&quot;</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+#endif</span>
<a href="#l14.20"></a><span id="l14.20"> #endif</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22"> struct icalcomponent_impl </span>
<a href="#l14.23"></a><span id="l14.23"> {</span>
<a href="#l14.24"></a><span id="l14.24"> 	char id[5];</span>
<a href="#l14.25"></a><span id="l14.25"> 	icalcomponent_kind kind;</span>
<a href="#l14.26"></a><span id="l14.26"> 	char* x_name;</span>
<a href="#l14.27"></a><span id="l14.27"> 	pvl_list properties;</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineat">@@ -89,16 +92,18 @@ static unsigned int icalcomponent_get_tz</span>
<a href="#l14.29"></a><span id="l14.29"> static void icalcomponent_rename_tzids(icalcomponent* comp,</span>
<a href="#l14.30"></a><span id="l14.30"> 				       icalarray* rename_table);</span>
<a href="#l14.31"></a><span id="l14.31"> static void icalcomponent_rename_tzids_callback(icalparameter *param,</span>
<a href="#l14.32"></a><span id="l14.32"> 						void *data);</span>
<a href="#l14.33"></a><span id="l14.33"> static int icalcomponent_compare_vtimezones (icalcomponent	*vtimezone1,</span>
<a href="#l14.34"></a><span id="l14.34"> 					     icalcomponent	*vtimezone2);</span>
<a href="#l14.35"></a><span id="l14.35"> static int icalcomponent_compare_timezone_fn	(const void	*elem1,</span>
<a href="#l14.36"></a><span id="l14.36"> 						 const void	*elem2);</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+static struct icaltimetype</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+icalcomponent_get_datetime(icalcomponent *comp, icalproperty *prop);</span>
<a href="#l14.39"></a><span id="l14.39"> </span>
<a href="#l14.40"></a><span id="l14.40"> </span>
<a href="#l14.41"></a><span id="l14.41"> void icalcomponent_add_children(icalcomponent *impl, va_list args)</span>
<a href="#l14.42"></a><span id="l14.42"> {</span>
<a href="#l14.43"></a><span id="l14.43">     void* vp;</span>
<a href="#l14.44"></a><span id="l14.44">     </span>
<a href="#l14.45"></a><span id="l14.45">     while((vp = va_arg(args, void*)) != 0) {</span>
<a href="#l14.46"></a><span id="l14.46"> </span>
<a href="#l14.47"></a><span id="l14.47" class="difflineat">@@ -311,30 +316,30 @@ icalcomponent_as_ical_string_r (icalcomp</span>
<a href="#l14.48"></a><span id="l14.48">    const char newline[] = &quot;\r\n&quot;;</span>
<a href="#l14.49"></a><span id="l14.49">    </span>
<a href="#l14.50"></a><span id="l14.50">    icalcomponent *c;</span>
<a href="#l14.51"></a><span id="l14.51">    icalproperty *p;</span>
<a href="#l14.52"></a><span id="l14.52">    icalcomponent_kind kind = icalcomponent_isa(impl);</span>
<a href="#l14.53"></a><span id="l14.53"> </span>
<a href="#l14.54"></a><span id="l14.54">    const char* kind_string;</span>
<a href="#l14.55"></a><span id="l14.55"> </span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-   buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-   buf_ptr = buf; </span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-</span>
<a href="#l14.59"></a><span id="l14.59">    icalerror_check_arg_rz( (impl!=0), &quot;component&quot;);</span>
<a href="#l14.60"></a><span id="l14.60">    icalerror_check_arg_rz( (kind!=ICAL_NO_COMPONENT), &quot;component kind is ICAL_NO_COMPONENT&quot;);</span>
<a href="#l14.61"></a><span id="l14.61">    </span>
<a href="#l14.62"></a><span id="l14.62">    if (kind != ICAL_X_COMPONENT) {</span>
<a href="#l14.63"></a><span id="l14.63">        kind_string  = icalcomponent_kind_to_string(kind);</span>
<a href="#l14.64"></a><span id="l14.64">    } else {</span>
<a href="#l14.65"></a><span id="l14.65">        kind_string = impl-&gt;x_name;</span>
<a href="#l14.66"></a><span id="l14.66">    }</span>
<a href="#l14.67"></a><span id="l14.67"> </span>
<a href="#l14.68"></a><span id="l14.68">    icalerror_check_arg_rz( (kind_string!=0),&quot;Unknown kind of component&quot;);</span>
<a href="#l14.69"></a><span id="l14.69"> </span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+   buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+   buf_ptr = buf; </span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+</span>
<a href="#l14.73"></a><span id="l14.73">    icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, &quot;BEGIN:&quot;);</span>
<a href="#l14.74"></a><span id="l14.74">    icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, kind_string);</span>
<a href="#l14.75"></a><span id="l14.75">    icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, newline);</span>
<a href="#l14.76"></a><span id="l14.76">    </span>
<a href="#l14.77"></a><span id="l14.77"> </span>
<a href="#l14.78"></a><span id="l14.78"> </span>
<a href="#l14.79"></a><span id="l14.79">    for( itr = pvl_head(impl-&gt;properties);</span>
<a href="#l14.80"></a><span id="l14.80"> 	 itr != 0;</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineat">@@ -389,17 +394,16 @@ icalcomponent_kind</span>
<a href="#l14.82"></a><span id="l14.82"> icalcomponent_isa (const icalcomponent* component)</span>
<a href="#l14.83"></a><span id="l14.83"> {</span>
<a href="#l14.84"></a><span id="l14.84">    icalerror_check_arg_rx( (component!=0), &quot;component&quot;, ICAL_NO_COMPONENT);</span>
<a href="#l14.85"></a><span id="l14.85"> </span>
<a href="#l14.86"></a><span id="l14.86">    if(component != 0)</span>
<a href="#l14.87"></a><span id="l14.87">    {</span>
<a href="#l14.88"></a><span id="l14.88">        return component-&gt;kind;</span>
<a href="#l14.89"></a><span id="l14.89">    }</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-</span>
<a href="#l14.91"></a><span id="l14.91">    return ICAL_NO_COMPONENT;</span>
<a href="#l14.92"></a><span id="l14.92"> }</span>
<a href="#l14.93"></a><span id="l14.93"> </span>
<a href="#l14.94"></a><span id="l14.94"> </span>
<a href="#l14.95"></a><span id="l14.95"> int</span>
<a href="#l14.96"></a><span id="l14.96"> icalcomponent_isa_component (void* component)</span>
<a href="#l14.97"></a><span id="l14.97"> {</span>
<a href="#l14.98"></a><span id="l14.98">     icalcomponent *impl = component;</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineat">@@ -846,31 +850,33 @@ icaltime_span icalcomponent_get_span(ica</span>
<a href="#l14.100"></a><span id="l14.100">  * In this case though you don't need to worry how you call this</span>
<a href="#l14.101"></a><span id="l14.101">  * function.  It will always return the correct result.</span>
<a href="#l14.102"></a><span id="l14.102">  */</span>
<a href="#l14.103"></a><span id="l14.103"> </span>
<a href="#l14.104"></a><span id="l14.104"> int icalproperty_recurrence_is_excluded(icalcomponent *comp,</span>
<a href="#l14.105"></a><span id="l14.105"> 				       struct icaltimetype *dtstart,</span>
<a href="#l14.106"></a><span id="l14.106"> 				       struct icaltimetype *recurtime) {</span>
<a href="#l14.107"></a><span id="l14.107">   icalproperty *exdate, *exrule;</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-  pvl_elem property_iterator = comp-&gt;property_iterator;</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+  pvl_elem property_iterator;</span>
<a href="#l14.110"></a><span id="l14.110"> </span>
<a href="#l14.111"></a><span id="l14.111">   if (comp == NULL || </span>
<a href="#l14.112"></a><span id="l14.112">       dtstart == NULL || </span>
<a href="#l14.113"></a><span id="l14.113">       recurtime == NULL ||</span>
<a href="#l14.114"></a><span id="l14.114">       icaltime_is_null_time(*recurtime))</span>
<a href="#l14.115"></a><span id="l14.115">     /* BAD DATA */</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineminus">-    return 1;	</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+    return 1;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+    </span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+  property_iterator = comp-&gt;property_iterator;</span>
<a href="#l14.120"></a><span id="l14.120"> </span>
<a href="#l14.121"></a><span id="l14.121">   /** first test against the exdate values **/</span>
<a href="#l14.122"></a><span id="l14.122">   for (exdate = icalcomponent_get_first_property(comp,ICAL_EXDATE_PROPERTY);</span>
<a href="#l14.123"></a><span id="l14.123">        exdate != NULL;</span>
<a href="#l14.124"></a><span id="l14.124">        exdate = icalcomponent_get_next_property(comp,ICAL_EXDATE_PROPERTY)) {</span>
<a href="#l14.125"></a><span id="l14.125"> 	 </span>
<a href="#l14.126"></a><span id="l14.126" class="difflineminus">-    struct icaltimetype exdatetime = icalproperty_get_exdate(exdate);</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineplus">+    struct icaltimetype exdatetime = icalcomponent_get_datetime(comp, exdate);</span>
<a href="#l14.128"></a><span id="l14.128"> </span>
<a href="#l14.129"></a><span id="l14.129">     if (icaltime_compare(*recurtime, exdatetime) == 0) {</span>
<a href="#l14.130"></a><span id="l14.130">       /** MATCHED **/</span>
<a href="#l14.131"></a><span id="l14.131">         </span>
<a href="#l14.132"></a><span id="l14.132">       comp-&gt;property_iterator = property_iterator;</span>
<a href="#l14.133"></a><span id="l14.133">       return 1;</span>
<a href="#l14.134"></a><span id="l14.134">     }</span>
<a href="#l14.135"></a><span id="l14.135">   }</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineat">@@ -879,17 +885,17 @@ int icalproperty_recurrence_is_excluded(</span>
<a href="#l14.137"></a><span id="l14.137">   for (exrule = icalcomponent_get_first_property(comp,ICAL_EXRULE_PROPERTY);</span>
<a href="#l14.138"></a><span id="l14.138">        exrule != NULL;</span>
<a href="#l14.139"></a><span id="l14.139">        exrule = icalcomponent_get_next_property(comp,ICAL_EXRULE_PROPERTY)) {</span>
<a href="#l14.140"></a><span id="l14.140"> 	 </span>
<a href="#l14.141"></a><span id="l14.141">     struct icalrecurrencetype recur = icalproperty_get_exrule(exrule);</span>
<a href="#l14.142"></a><span id="l14.142">     icalrecur_iterator *exrule_itr  = icalrecur_iterator_new(recur, *dtstart);</span>
<a href="#l14.143"></a><span id="l14.143">     struct icaltimetype exrule_time;</span>
<a href="#l14.144"></a><span id="l14.144"> </span>
<a href="#l14.145"></a><span id="l14.145" class="difflineminus">-    while (1) {</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineplus">+    while (exrule_itr) {</span>
<a href="#l14.147"></a><span id="l14.147">       int result;</span>
<a href="#l14.148"></a><span id="l14.148">       exrule_time = icalrecur_iterator_next(exrule_itr);</span>
<a href="#l14.149"></a><span id="l14.149"> </span>
<a href="#l14.150"></a><span id="l14.150">       if (icaltime_is_null_time(exrule_time))</span>
<a href="#l14.151"></a><span id="l14.151"> 	break;</span>
<a href="#l14.152"></a><span id="l14.152"> </span>
<a href="#l14.153"></a><span id="l14.153">       result = icaltime_compare(*recurtime, exrule_time);</span>
<a href="#l14.154"></a><span id="l14.154">       if (result == 0) {</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineat">@@ -1041,21 +1047,23 @@ void icalcomponent_foreach_recurrence(ic</span>
<a href="#l14.156"></a><span id="l14.156">   </span>
<a href="#l14.157"></a><span id="l14.157">   /* Now cycle through the rrule entries */</span>
<a href="#l14.158"></a><span id="l14.158">   for (rrule = icalcomponent_get_first_property(comp,ICAL_RRULE_PROPERTY);</span>
<a href="#l14.159"></a><span id="l14.159">        rrule != NULL;</span>
<a href="#l14.160"></a><span id="l14.160">        rrule = icalcomponent_get_next_property(comp,ICAL_RRULE_PROPERTY)) {</span>
<a href="#l14.161"></a><span id="l14.161"> </span>
<a href="#l14.162"></a><span id="l14.162">     struct icalrecurrencetype recur = icalproperty_get_rrule(rrule);</span>
<a href="#l14.163"></a><span id="l14.163">     icalrecur_iterator *rrule_itr  = icalrecur_iterator_new(recur, dtstart);</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineminus">-    struct icaltimetype rrule_time = icalrecur_iterator_next(rrule_itr);</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineplus">+    struct icaltimetype rrule_time;</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineplus">+    if(rrule_itr)  </span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+        rrule_time = icalrecur_iterator_next(rrule_itr);</span>
<a href="#l14.168"></a><span id="l14.168">     /** note that icalrecur_iterator_next always returns dtstart</span>
<a href="#l14.169"></a><span id="l14.169"> 	the first time.. **/</span>
<a href="#l14.170"></a><span id="l14.170"> </span>
<a href="#l14.171"></a><span id="l14.171" class="difflineminus">-    while (1) {</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineplus">+    while (rrule_itr) {</span>
<a href="#l14.173"></a><span id="l14.173">       rrule_time = icalrecur_iterator_next(rrule_itr);</span>
<a href="#l14.174"></a><span id="l14.174"> </span>
<a href="#l14.175"></a><span id="l14.175">       if (icaltime_is_null_time(rrule_time)) </span>
<a href="#l14.176"></a><span id="l14.176"> 	break;</span>
<a href="#l14.177"></a><span id="l14.177"> </span>
<a href="#l14.178"></a><span id="l14.178">       dur = icaltime_subtract(rrule_time, dtstart);</span>
<a href="#l14.179"></a><span id="l14.179"> </span>
<a href="#l14.180"></a><span id="l14.180">       recurspan.start = basespan.start + icaldurationtype_as_int(dur);</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineat">@@ -2026,61 +2034,61 @@ enum icalproperty_status icalcomponent_g</span>
<a href="#l14.182"></a><span id="l14.182"> </span>
<a href="#l14.183"></a><span id="l14.183">     if (prop == 0){</span>
<a href="#l14.184"></a><span id="l14.184">         return 0;</span>
<a href="#l14.185"></a><span id="l14.185">     }</span>
<a href="#l14.186"></a><span id="l14.186"> </span>
<a href="#l14.187"></a><span id="l14.187">     return icalproperty_get_status(prop);</span>
<a href="#l14.188"></a><span id="l14.188"> }</span>
<a href="#l14.189"></a><span id="l14.189"> </span>
<a href="#l14.190"></a><span id="l14.190" class="difflineminus">-icalcomponent* icalcomponent_new_vcalendar()</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineplus">+icalcomponent* icalcomponent_new_vcalendar(void)</span>
<a href="#l14.192"></a><span id="l14.192"> {</span>
<a href="#l14.193"></a><span id="l14.193">     return icalcomponent_new(ICAL_VCALENDAR_COMPONENT);</span>
<a href="#l14.194"></a><span id="l14.194"> }</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineminus">-icalcomponent* icalcomponent_new_vevent()</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineplus">+icalcomponent* icalcomponent_new_vevent(void)</span>
<a href="#l14.197"></a><span id="l14.197"> {</span>
<a href="#l14.198"></a><span id="l14.198">     return icalcomponent_new(ICAL_VEVENT_COMPONENT);</span>
<a href="#l14.199"></a><span id="l14.199"> }</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineminus">-icalcomponent* icalcomponent_new_vtodo()</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineplus">+icalcomponent* icalcomponent_new_vtodo(void)</span>
<a href="#l14.202"></a><span id="l14.202"> {</span>
<a href="#l14.203"></a><span id="l14.203">     return icalcomponent_new(ICAL_VTODO_COMPONENT);</span>
<a href="#l14.204"></a><span id="l14.204"> }</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineminus">-icalcomponent* icalcomponent_new_vjournal()</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineplus">+icalcomponent* icalcomponent_new_vjournal(void)</span>
<a href="#l14.207"></a><span id="l14.207"> {</span>
<a href="#l14.208"></a><span id="l14.208">     return icalcomponent_new(ICAL_VJOURNAL_COMPONENT);</span>
<a href="#l14.209"></a><span id="l14.209"> }</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineminus">-icalcomponent* icalcomponent_new_valarm()</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineplus">+icalcomponent* icalcomponent_new_valarm(void)</span>
<a href="#l14.212"></a><span id="l14.212"> {</span>
<a href="#l14.213"></a><span id="l14.213">     return icalcomponent_new(ICAL_VALARM_COMPONENT);</span>
<a href="#l14.214"></a><span id="l14.214"> }</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineminus">-icalcomponent* icalcomponent_new_vfreebusy()</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineplus">+icalcomponent* icalcomponent_new_vfreebusy(void)</span>
<a href="#l14.217"></a><span id="l14.217"> {</span>
<a href="#l14.218"></a><span id="l14.218">     return icalcomponent_new(ICAL_VFREEBUSY_COMPONENT);</span>
<a href="#l14.219"></a><span id="l14.219"> }</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineminus">-icalcomponent* icalcomponent_new_vtimezone()</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineplus">+icalcomponent* icalcomponent_new_vtimezone(void)</span>
<a href="#l14.222"></a><span id="l14.222"> {</span>
<a href="#l14.223"></a><span id="l14.223">     return icalcomponent_new(ICAL_VTIMEZONE_COMPONENT);</span>
<a href="#l14.224"></a><span id="l14.224"> }</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineminus">-icalcomponent* icalcomponent_new_xstandard()</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineplus">+icalcomponent* icalcomponent_new_xstandard(void)</span>
<a href="#l14.227"></a><span id="l14.227"> {</span>
<a href="#l14.228"></a><span id="l14.228">     return icalcomponent_new(ICAL_XSTANDARD_COMPONENT);</span>
<a href="#l14.229"></a><span id="l14.229"> }</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineminus">-icalcomponent* icalcomponent_new_xdaylight()</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineplus">+icalcomponent* icalcomponent_new_xdaylight(void)</span>
<a href="#l14.232"></a><span id="l14.232"> {</span>
<a href="#l14.233"></a><span id="l14.233">     return icalcomponent_new(ICAL_XDAYLIGHT_COMPONENT);</span>
<a href="#l14.234"></a><span id="l14.234"> }</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineminus">-icalcomponent* icalcomponent_new_vagenda()</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineplus">+icalcomponent* icalcomponent_new_vagenda(void)</span>
<a href="#l14.237"></a><span id="l14.237"> {</span>
<a href="#l14.238"></a><span id="l14.238">     return icalcomponent_new(ICAL_VAGENDA_COMPONENT);</span>
<a href="#l14.239"></a><span id="l14.239"> }</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineminus">-icalcomponent* icalcomponent_new_vquery()</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineplus">+icalcomponent* icalcomponent_new_vquery(void)</span>
<a href="#l14.242"></a><span id="l14.242"> {</span>
<a href="#l14.243"></a><span id="l14.243">     return icalcomponent_new(ICAL_VQUERY_COMPONENT);</span>
<a href="#l14.244"></a><span id="l14.244"> }</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineminus">-icalcomponent* icalcomponent_new_vreply()</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineplus">+icalcomponent* icalcomponent_new_vreply(void)</span>
<a href="#l14.247"></a><span id="l14.247"> {</span>
<a href="#l14.248"></a><span id="l14.248">     return icalcomponent_new(ICAL_VREPLY_COMPONENT);</span>
<a href="#l14.249"></a><span id="l14.249"> }</span>
<a href="#l14.250"></a><span id="l14.250"> </span>
<a href="#l14.251"></a><span id="l14.251"> /*</span>
<a href="#l14.252"></a><span id="l14.252">  * Timezone stuff.</span>
<a href="#l14.253"></a><span id="l14.253">  */</span>
<a href="#l14.254"></a><span id="l14.254"> </span>
<a href="#l14.255"></a><span id="l14.255" class="difflineat">@@ -2121,19 +2129,18 @@ void icalcomponent_merge_component(icalc</span>
<a href="#l14.256"></a><span id="l14.256">   /* If we need to do any renaming of TZIDs, do it now. */</span>
<a href="#l14.257"></a><span id="l14.257">   if (tzids_to_rename-&gt;num_elements != 0) {</span>
<a href="#l14.258"></a><span id="l14.258">     icalcomponent_rename_tzids (comp_to_merge, tzids_to_rename);</span>
<a href="#l14.259"></a><span id="l14.259">       </span>
<a href="#l14.260"></a><span id="l14.260">     /* Now free the tzids_to_rename array. */</span>
<a href="#l14.261"></a><span id="l14.261">     for (i = 0; i &lt; tzids_to_rename-&gt;num_elements; i++) {</span>
<a href="#l14.262"></a><span id="l14.262">       free (icalarray_element_at (tzids_to_rename, i));</span>
<a href="#l14.263"></a><span id="l14.263">     }</span>
<a href="#l14.264"></a><span id="l14.264" class="difflineminus">-    icalarray_free (tzids_to_rename);</span>
<a href="#l14.265"></a><span id="l14.265">   }</span>
<a href="#l14.266"></a><span id="l14.266" class="difflineminus">-</span>
<a href="#l14.267"></a><span id="l14.267" class="difflineplus">+  icalarray_free (tzids_to_rename);</span>
<a href="#l14.268"></a><span id="l14.268">   /* Now move all the components from comp_to_merge to comp, excluding</span>
<a href="#l14.269"></a><span id="l14.269">      VTIMEZONE components. */</span>
<a href="#l14.270"></a><span id="l14.270">   subcomp = icalcomponent_get_first_component (comp_to_merge,</span>
<a href="#l14.271"></a><span id="l14.271"> 					       ICAL_ANY_COMPONENT);</span>
<a href="#l14.272"></a><span id="l14.272">   while (subcomp) {</span>
<a href="#l14.273"></a><span id="l14.273">     next_subcomp = icalcomponent_get_next_component (comp_to_merge,</span>
<a href="#l14.274"></a><span id="l14.274"> 						     ICAL_ANY_COMPONENT);</span>
<a href="#l14.275"></a><span id="l14.275">     if (icalcomponent_isa(subcomp) != ICAL_VTIMEZONE_COMPONENT) {</span>
<a href="#l14.276"></a><span id="l14.276" class="difflineat">@@ -2244,21 +2251,27 @@ icalcomponent_handle_conflicting_vtimezo</span>
<a href="#l14.277"></a><span id="l14.277">     if (tzid_len == existing_tzid_len</span>
<a href="#l14.278"></a><span id="l14.278"> 	&amp;&amp; !strncmp (tzid, existing_tzid, tzid_len)) {</span>
<a href="#l14.279"></a><span id="l14.279">       /* Compare the VTIMEZONEs. */</span>
<a href="#l14.280"></a><span id="l14.280">       if (icalcomponent_compare_vtimezones (icaltimezone_get_component (zone),</span>
<a href="#l14.281"></a><span id="l14.281"> 					    vtimezone)) {</span>
<a href="#l14.282"></a><span id="l14.282"> 	/* The VTIMEZONEs match, so we can use the existing VTIMEZONE. But</span>
<a href="#l14.283"></a><span id="l14.283"> 	   we have to rename TZIDs to this TZID. */</span>
<a href="#l14.284"></a><span id="l14.284"> 	tzid_copy = strdup (tzid);</span>
<a href="#l14.285"></a><span id="l14.285" class="difflineplus">+        if(!tzid_copy) {</span>
<a href="#l14.286"></a><span id="l14.286" class="difflineplus">+          icalerror_set_errno(ICAL_NEWFAILED_ERROR);</span>
<a href="#l14.287"></a><span id="l14.287" class="difflineplus">+          return;</span>
<a href="#l14.288"></a><span id="l14.288" class="difflineplus">+        }</span>
<a href="#l14.289"></a><span id="l14.289"> 	existing_tzid_copy = strdup (existing_tzid);</span>
<a href="#l14.290"></a><span id="l14.290" class="difflineminus">-	if (!tzid_copy || !existing_tzid_copy) {</span>
<a href="#l14.291"></a><span id="l14.291" class="difflineplus">+        if (!existing_tzid_copy) {</span>
<a href="#l14.292"></a><span id="l14.292"> 	  icalerror_set_errno(ICAL_NEWFAILED_ERROR);</span>
<a href="#l14.293"></a><span id="l14.293" class="difflineplus">+          free(tzid_copy);</span>
<a href="#l14.294"></a><span id="l14.294"> 	} else {</span>
<a href="#l14.295"></a><span id="l14.295"> 	  icalarray_append (tzids_to_rename, tzid_copy);</span>
<a href="#l14.296"></a><span id="l14.296" class="difflineplus">+	  free(tzid_copy);</span>
<a href="#l14.297"></a><span id="l14.297"> 	  icalarray_append (tzids_to_rename, existing_tzid_copy);</span>
<a href="#l14.298"></a><span id="l14.298"> 	}</span>
<a href="#l14.299"></a><span id="l14.299"> 	return;</span>
<a href="#l14.300"></a><span id="l14.300">       } else {</span>
<a href="#l14.301"></a><span id="l14.301"> 	/* FIXME: Handle possible NEWFAILED error. */</span>
<a href="#l14.302"></a><span id="l14.302"> </span>
<a href="#l14.303"></a><span id="l14.303"> 	/* Convert the suffix to an integer and remember the maximum numeric</span>
<a href="#l14.304"></a><span id="l14.304"> 	   suffix found. */</span>
<a href="#l14.305"></a><span id="l14.305" class="difflineat">@@ -2267,27 +2280,35 @@ icalcomponent_handle_conflicting_vtimezo</span>
<a href="#l14.306"></a><span id="l14.306"> 	  max_suffix = suffix;</span>
<a href="#l14.307"></a><span id="l14.307">       }</span>
<a href="#l14.308"></a><span id="l14.308">     }</span>
<a href="#l14.309"></a><span id="l14.309">   }</span>
<a href="#l14.310"></a><span id="l14.310"> </span>
<a href="#l14.311"></a><span id="l14.311">   /* We didn't find a VTIMEZONE that matched, so we have to rename the TZID,</span>
<a href="#l14.312"></a><span id="l14.312">      using the maximum numerical suffix found + 1. */</span>
<a href="#l14.313"></a><span id="l14.313">   tzid_copy = strdup (tzid);</span>
<a href="#l14.314"></a><span id="l14.314" class="difflineplus">+  if(!tzid_copy) {</span>
<a href="#l14.315"></a><span id="l14.315" class="difflineplus">+    icalerror_set_errno(ICAL_NEWFAILED_ERROR);</span>
<a href="#l14.316"></a><span id="l14.316" class="difflineplus">+    return;</span>
<a href="#l14.317"></a><span id="l14.317" class="difflineplus">+  }</span>
<a href="#l14.318"></a><span id="l14.318" class="difflineplus">+</span>
<a href="#l14.319"></a><span id="l14.319">   snprintf (suffix_buf, sizeof(suffix_buf), &quot;%i&quot;, max_suffix + 1);</span>
<a href="#l14.320"></a><span id="l14.320">   new_tzid = malloc (tzid_len + strlen (suffix_buf) + 1);</span>
<a href="#l14.321"></a><span id="l14.321" class="difflineminus">-  if (!new_tzid || !tzid_copy) {</span>
<a href="#l14.322"></a><span id="l14.322" class="difflineplus">+  if (!new_tzid) {</span>
<a href="#l14.323"></a><span id="l14.323">     icalerror_set_errno(ICAL_NEWFAILED_ERROR);</span>
<a href="#l14.324"></a><span id="l14.324" class="difflineplus">+    free(tzid_copy);</span>
<a href="#l14.325"></a><span id="l14.325">     return;</span>
<a href="#l14.326"></a><span id="l14.326">   }</span>
<a href="#l14.327"></a><span id="l14.327"> </span>
<a href="#l14.328"></a><span id="l14.328">   strncpy (new_tzid, tzid, tzid_len);</span>
<a href="#l14.329"></a><span id="l14.329">   strcpy (new_tzid + tzid_len, suffix_buf);</span>
<a href="#l14.330"></a><span id="l14.330">   icalarray_append (tzids_to_rename, tzid_copy);</span>
<a href="#l14.331"></a><span id="l14.331">   icalarray_append (tzids_to_rename, new_tzid);</span>
<a href="#l14.332"></a><span id="l14.332" class="difflineplus">+  free(tzid_copy);</span>
<a href="#l14.333"></a><span id="l14.333" class="difflineplus">+  free(new_tzid);</span>
<a href="#l14.334"></a><span id="l14.334"> }</span>
<a href="#l14.335"></a><span id="l14.335"> </span>
<a href="#l14.336"></a><span id="l14.336"> </span>
<a href="#l14.337"></a><span id="l14.337"> /* Returns the length of the TZID, without any trailing digits. */</span>
<a href="#l14.338"></a><span id="l14.338"> static unsigned int icalcomponent_get_tzid_prefix_len (const char *tzid)</span>
<a href="#l14.339"></a><span id="l14.339"> {</span>
<a href="#l14.340"></a><span id="l14.340">   int len;</span>
<a href="#l14.341"></a><span id="l14.341">   const char *p;</span>
<a href="#l14.342"></a><span id="l14.342" class="difflineat">@@ -2399,23 +2420,25 @@ icaltimezone* icalcomponent_get_timezone</span>
<a href="#l14.343"></a><span id="l14.343">     /* Do a simple binary search. */</span>
<a href="#l14.344"></a><span id="l14.344">     lower = middle = 0;</span>
<a href="#l14.345"></a><span id="l14.345">     upper = comp-&gt;timezones-&gt;num_elements;</span>
<a href="#l14.346"></a><span id="l14.346"> </span>
<a href="#l14.347"></a><span id="l14.347">     while (lower &lt; upper) {</span>
<a href="#l14.348"></a><span id="l14.348"> 	middle = (lower + upper) &gt;&gt; 1;</span>
<a href="#l14.349"></a><span id="l14.349"> 	zone = icalarray_element_at (comp-&gt;timezones, middle);</span>
<a href="#l14.350"></a><span id="l14.350"> 	zone_tzid = icaltimezone_get_tzid (zone);</span>
<a href="#l14.351"></a><span id="l14.351" class="difflineminus">-	cmp = strcmp (tzid, zone_tzid);</span>
<a href="#l14.352"></a><span id="l14.352" class="difflineminus">-	if (cmp == 0)</span>
<a href="#l14.353"></a><span id="l14.353" class="difflineminus">-	    return zone;</span>
<a href="#l14.354"></a><span id="l14.354" class="difflineminus">-	else if (cmp &lt; 0)</span>
<a href="#l14.355"></a><span id="l14.355" class="difflineminus">-	    upper = middle;</span>
<a href="#l14.356"></a><span id="l14.356" class="difflineminus">-	else</span>
<a href="#l14.357"></a><span id="l14.357" class="difflineminus">-	    lower = middle + 1;</span>
<a href="#l14.358"></a><span id="l14.358" class="difflineplus">+	if (zone_tzid != NULL) {</span>
<a href="#l14.359"></a><span id="l14.359" class="difflineplus">+		cmp = strcmp (tzid, zone_tzid);</span>
<a href="#l14.360"></a><span id="l14.360" class="difflineplus">+		if (cmp == 0)</span>
<a href="#l14.361"></a><span id="l14.361" class="difflineplus">+			return zone;</span>
<a href="#l14.362"></a><span id="l14.362" class="difflineplus">+		else if (cmp &lt; 0)</span>
<a href="#l14.363"></a><span id="l14.363" class="difflineplus">+			upper = middle;</span>
<a href="#l14.364"></a><span id="l14.364" class="difflineplus">+		else</span>
<a href="#l14.365"></a><span id="l14.365" class="difflineplus">+			lower = middle + 1;</span>
<a href="#l14.366"></a><span id="l14.366" class="difflineplus">+	}</span>
<a href="#l14.367"></a><span id="l14.367">     }</span>
<a href="#l14.368"></a><span id="l14.368"> </span>
<a href="#l14.369"></a><span id="l14.369">     return NULL;</span>
<a href="#l14.370"></a><span id="l14.370"> }</span>
<a href="#l14.371"></a><span id="l14.371"> </span>
<a href="#l14.372"></a><span id="l14.372"> </span>
<a href="#l14.373"></a><span id="l14.373"> /**</span>
<a href="#l14.374"></a><span id="l14.374">  * A function to compare 2 icaltimezone elements, used for qsort().</span>
<a href="#l14.375"></a><span id="l14.375" class="difflineat">@@ -2568,38 +2591,31 @@ struct icaltimetype icalcomponent_get_du</span>
<a href="#l14.376"></a><span id="l14.376">     icalcomponent *inner = icalcomponent_get_inner(comp);</span>
<a href="#l14.377"></a><span id="l14.377"> </span>
<a href="#l14.378"></a><span id="l14.378">     icalproperty *due_prop</span>
<a href="#l14.379"></a><span id="l14.379">         = icalcomponent_get_first_property(inner,ICAL_DUE_PROPERTY);</span>
<a href="#l14.380"></a><span id="l14.380"> </span>
<a href="#l14.381"></a><span id="l14.381">     icalproperty *dur_prop</span>
<a href="#l14.382"></a><span id="l14.382">         = icalcomponent_get_first_property(inner, ICAL_DURATION_PROPERTY);</span>
<a href="#l14.383"></a><span id="l14.383"> </span>
<a href="#l14.384"></a><span id="l14.384" class="difflineminus">-    if( due_prop == 0 &amp;&amp; dur_prop == 0){</span>
<a href="#l14.385"></a><span id="l14.385" class="difflineminus">-        return icaltime_null_time();</span>
<a href="#l14.386"></a><span id="l14.386" class="difflineminus">-    } else if ( due_prop != 0) {</span>
<a href="#l14.387"></a><span id="l14.387" class="difflineplus">+    if ( due_prop != 0) {</span>
<a href="#l14.388"></a><span id="l14.388">         return icalproperty_get_due(due_prop);</span>
<a href="#l14.389"></a><span id="l14.389">     } else if ( dur_prop != 0) {</span>
<a href="#l14.390"></a><span id="l14.390"> </span>
<a href="#l14.391"></a><span id="l14.391">         struct icaltimetype start =</span>
<a href="#l14.392"></a><span id="l14.392">             icalcomponent_get_dtstart(inner);</span>
<a href="#l14.393"></a><span id="l14.393">         struct icaldurationtype duration =</span>
<a href="#l14.394"></a><span id="l14.394">             icalproperty_get_duration(dur_prop);</span>
<a href="#l14.395"></a><span id="l14.395"> </span>
<a href="#l14.396"></a><span id="l14.396">         struct icaltimetype due = icaltime_add(start,duration);</span>
<a href="#l14.397"></a><span id="l14.397"> </span>
<a href="#l14.398"></a><span id="l14.398">         return due;</span>
<a href="#l14.399"></a><span id="l14.399"> </span>
<a href="#l14.400"></a><span id="l14.400" class="difflineminus">-    } else {</span>
<a href="#l14.401"></a><span id="l14.401" class="difflineminus">-        /* Error, both duration and due have been specified */</span>
<a href="#l14.402"></a><span id="l14.402" class="difflineminus">-        icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l14.403"></a><span id="l14.403" class="difflineminus">-        return icaltime_null_time();</span>
<a href="#l14.404"></a><span id="l14.404" class="difflineminus">-</span>
<a href="#l14.405"></a><span id="l14.405">     }</span>
<a href="#l14.406"></a><span id="l14.406" class="difflineminus">-</span>
<a href="#l14.407"></a><span id="l14.407" class="difflineplus">+    return icaltime_null_time();</span>
<a href="#l14.408"></a><span id="l14.408"> }</span>
<a href="#l14.409"></a><span id="l14.409"> </span>
<a href="#l14.410"></a><span id="l14.410"> /** @brief Set the due date of a VTODO task.</span>
<a href="#l14.411"></a><span id="l14.411">  *</span>
<a href="#l14.412"></a><span id="l14.412">  *  @param comp Valid VTODO component.</span>
<a href="#l14.413"></a><span id="l14.413">  *  @param v    Valid due date time.</span>
<a href="#l14.414"></a><span id="l14.414">  *</span>
<a href="#l14.415"></a><span id="l14.415">  *  - If no duration or due properties then set the DUE property.</span>
<a href="#l14.416"></a><span id="l14.416" class="difflineat">@@ -2631,13 +2647,10 @@ void icalcomponent_set_due(icalcomponent</span>
<a href="#l14.417"></a><span id="l14.417">         struct icaltimetype due =</span>
<a href="#l14.418"></a><span id="l14.418">             icalcomponent_get_due(inner);</span>
<a href="#l14.419"></a><span id="l14.419"> </span>
<a href="#l14.420"></a><span id="l14.420">         struct icaldurationtype dur</span>
<a href="#l14.421"></a><span id="l14.421">             = icaltime_subtract(due,start);</span>
<a href="#l14.422"></a><span id="l14.422"> </span>
<a href="#l14.423"></a><span id="l14.423">         icalproperty_set_duration(dur_prop,dur);</span>
<a href="#l14.424"></a><span id="l14.424"> </span>
<a href="#l14.425"></a><span id="l14.425" class="difflineminus">-    } else {</span>
<a href="#l14.426"></a><span id="l14.426" class="difflineminus">-        /* Error, both duration and due have been specified */</span>
<a href="#l14.427"></a><span id="l14.427" class="difflineminus">-        icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l14.428"></a><span id="l14.428">     }</span>
<a href="#l14.429"></a><span id="l14.429"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/libical/src/libical/icalcomponent.h</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalcomponent.h</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -265,21 +265,21 @@ void icalcomponent_foreach_recurrence(ic</span>
<a href="#l15.4"></a><span id="l15.4"> 			void (*callback)(icalcomponent *comp, </span>
<a href="#l15.5"></a><span id="l15.5">                                          struct icaltime_span *span, </span>
<a href="#l15.6"></a><span id="l15.6">                                          void *data),</span>
<a href="#l15.7"></a><span id="l15.7"> 			      void *callback_data);</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10"> /*************** Type Specific routines ***************/</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-icalcomponent* icalcomponent_new_vcalendar();</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-icalcomponent* icalcomponent_new_vevent();</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-icalcomponent* icalcomponent_new_vtodo();</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-icalcomponent* icalcomponent_new_vjournal();</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-icalcomponent* icalcomponent_new_valarm();</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-icalcomponent* icalcomponent_new_vfreebusy();</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-icalcomponent* icalcomponent_new_vtimezone();</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-icalcomponent* icalcomponent_new_xstandard();</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-icalcomponent* icalcomponent_new_xdaylight();</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-icalcomponent* icalcomponent_new_vagenda();</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-icalcomponent* icalcomponent_new_vquery();</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+icalcomponent* icalcomponent_new_vcalendar(void);</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+icalcomponent* icalcomponent_new_vevent(void);</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+icalcomponent* icalcomponent_new_vtodo(void);</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+icalcomponent* icalcomponent_new_vjournal(void);</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+icalcomponent* icalcomponent_new_valarm(void);</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+icalcomponent* icalcomponent_new_vfreebusy(void);</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+icalcomponent* icalcomponent_new_vtimezone(void);</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+icalcomponent* icalcomponent_new_xstandard(void);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+icalcomponent* icalcomponent_new_xdaylight(void);</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+icalcomponent* icalcomponent_new_vagenda(void);</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+icalcomponent* icalcomponent_new_vquery(void);</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35"> #endif /* !ICALCOMPONENT_H */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/libical/src/libical/icalderivedparameter.c.in</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalderivedparameter.c.in</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -33,16 +33,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;icalparameter.h&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> #include &quot;icalparameterimpl.h&quot;</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9"> #include &quot;icalproperty.h&quot;</span>
<a href="#l16.10"></a><span id="l16.10"> #include &quot;icalerror.h&quot;</span>
<a href="#l16.11"></a><span id="l16.11"> #include &quot;icalmemory.h&quot;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+#include &quot;icaltypes.h&quot;</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14"> #include &lt;stdlib.h&gt; /* for malloc() */</span>
<a href="#l16.15"></a><span id="l16.15"> #include &lt;errno.h&gt;</span>
<a href="#l16.16"></a><span id="l16.16"> #include &lt;string.h&gt; /* for memset() */</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18"> #ifdef WIN32</span>
<a href="#l16.19"></a><span id="l16.19"> #define strcasecmp      stricmp</span>
<a href="#l16.20"></a><span id="l16.20"> #endif</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineat">@@ -93,31 +94,35 @@ const char* icalparameter_kind_to_string</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23"> }</span>
<a href="#l16.24"></a><span id="l16.24"> </span>
<a href="#l16.25"></a><span id="l16.25"> icalparameter_kind icalparameter_string_to_kind(const char* string)</span>
<a href="#l16.26"></a><span id="l16.26"> {</span>
<a href="#l16.27"></a><span id="l16.27">     int i;</span>
<a href="#l16.28"></a><span id="l16.28"> </span>
<a href="#l16.29"></a><span id="l16.29">     if (string ==0 ) { </span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-	return ICAL_NO_PARAMETER;</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+        return ICAL_NO_PARAMETER;</span>
<a href="#l16.32"></a><span id="l16.32">     }</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34">     for (i=0; parameter_map[i].kind  != ICAL_NO_PARAMETER; i++) {</span>
<a href="#l16.35"></a><span id="l16.35"> </span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-	if (strcasecmp(parameter_map[i].name, string) == 0) {</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-	    return parameter_map[i].kind;</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-	}</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+        if (strcasecmp(parameter_map[i].name, string) == 0) {</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+            return parameter_map[i].kind;</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+        }</span>
<a href="#l16.42"></a><span id="l16.42">     }</span>
<a href="#l16.43"></a><span id="l16.43"> </span>
<a href="#l16.44"></a><span id="l16.44">     if(strncmp(string,&quot;X-&quot;,2)==0){</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-	return ICAL_X_PARAMETER;</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+        return ICAL_X_PARAMETER;</span>
<a href="#l16.47"></a><span id="l16.47">     }</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-    return ICAL_NO_PARAMETER;</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+    if (ical_get_unknown_token_handling_setting() == ICAL_TREAT_AS_ERROR) {</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+        return ICAL_NO_PARAMETER;</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+    } else {</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+        return ICAL_IANA_PARAMETER;</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+    }</span>
<a href="#l16.55"></a><span id="l16.55"> }</span>
<a href="#l16.56"></a><span id="l16.56"> </span>
<a href="#l16.57"></a><span id="l16.57"> </span>
<a href="#l16.58"></a><span id="l16.58"> icalvalue_kind icalparameter_value_to_value_kind(icalparameter_value value)</span>
<a href="#l16.59"></a><span id="l16.59"> {</span>
<a href="#l16.60"></a><span id="l16.60">     int i;</span>
<a href="#l16.61"></a><span id="l16.61"> </span>
<a href="#l16.62"></a><span id="l16.62">     for (i=0; value_kind_map[i].kind  != ICAL_NO_VALUE; i++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/libical/src/libical/icalderivedproperty.c.in</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalderivedproperty.c.in</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -187,17 +187,18 @@ int icalproperty_kind_and_string_to_enum</span>
<a href="#l17.4"></a><span id="l17.4">     for (i=ICALPROPERTY_FIRST_ENUM; i != ICALPROPERTY_LAST_ENUM; i++) {</span>
<a href="#l17.5"></a><span id="l17.5"> 	if (enum_map[i-ICALPROPERTY_FIRST_ENUM].prop == pkind)</span>
<a href="#l17.6"></a><span id="l17.6"> 	    break;</span>
<a href="#l17.7"></a><span id="l17.7">     }</span>
<a href="#l17.8"></a><span id="l17.8">     if (i == ICALPROPERTY_LAST_ENUM)</span>
<a href="#l17.9"></a><span id="l17.9"> 	    return 0;</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">     for (; i != ICALPROPERTY_LAST_ENUM; i++) {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-	if ( strcasecmp(enum_map[i-ICALPROPERTY_FIRST_ENUM].str, str) == 0) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+	if(enum_map[i-ICALPROPERTY_FIRST_ENUM].prop == pkind &amp;&amp;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+           strcasecmp(enum_map[i-ICALPROPERTY_FIRST_ENUM].str, str) == 0) {</span>
<a href="#l17.15"></a><span id="l17.15"> 	    return enum_map[i-ICALPROPERTY_FIRST_ENUM].prop_enum;</span>
<a href="#l17.16"></a><span id="l17.16"> 	}</span>
<a href="#l17.17"></a><span id="l17.17">     }</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19">     return 0;</span>
<a href="#l17.20"></a><span id="l17.20"> }</span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22"> /** @deprecated please use icalproperty_kind_and_string_to_enum instead */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/libical/src/libical/icalderivedproperty.h.in</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalderivedproperty.h.in</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1,15 +1,26 @@</span>
<a href="#l18.4"></a><span id="l18.4"> /* -*- Mode: C -*-</span>
<a href="#l18.5"></a><span id="l18.5">   ======================================================================</span>
<a href="#l18.6"></a><span id="l18.6">   FILE: icalderivedproperties.{c,h}</span>
<a href="#l18.7"></a><span id="l18.7">   CREATOR: eric 09 May 1999</span>
<a href="#l18.8"></a><span id="l18.8">   </span>
<a href="#l18.9"></a><span id="l18.9">   $Id: icalderivedproperty.h.in,v 1.7 2007-04-30 13:57:48 artcancro Exp $</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineminus">-    </span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+ This program is free software; you can redistribute it and/or modify</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+ it under the terms of either:</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+    The LGPL as published by the Free Software Foundation, version</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+    2.1, available at: http://www.fsf.org/copyleft/lesser.html</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+  Or:</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+    The Mozilla Public License Version 1.0. You may obtain a copy of</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+    the License at http://www.mozilla.org/MPL/</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+</span>
<a href="#l18.23"></a><span id="l18.23">  (C) COPYRIGHT 2000, Eric Busboom, http://www.softwarestudio.org</span>
<a href="#l18.24"></a><span id="l18.24">  ======================================================================*/</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26"> </span>
<a href="#l18.27"></a><span id="l18.27"> #ifndef ICALDERIVEDPROPERTY_H</span>
<a href="#l18.28"></a><span id="l18.28"> #define ICALDERIVEDPROPERTY_H</span>
<a href="#l18.29"></a><span id="l18.29"> </span>
<a href="#l18.30"></a><span id="l18.30"> #include &lt;time.h&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/libical/src/libical/icalderivedvalue.c.in</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalderivedvalue.c.in</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -97,19 +97,21 @@ icalvalue_kind icalvalue_string_to_kind(</span>
<a href="#l19.4"></a><span id="l19.4"> 	}</span>
<a href="#l19.5"></a><span id="l19.5">     }</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7">     return  value_map[i].kind;</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9"> }</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11"> icalvalue* icalvalue_new_x (const char* v){</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-   struct icalvalue_impl* impl = icalvalue_new_impl(ICAL_X_VALUE);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+   struct icalvalue_impl* impl;</span>
<a href="#l19.14"></a><span id="l19.14">    icalerror_check_arg_rz( (v!=0),&quot;v&quot;);</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+   impl = icalvalue_new_impl(ICAL_X_VALUE);</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+</span>
<a href="#l19.18"></a><span id="l19.18">    icalvalue_set_x((icalvalue*)impl,v);</span>
<a href="#l19.19"></a><span id="l19.19">    return (icalvalue*)impl;</span>
<a href="#l19.20"></a><span id="l19.20"> }</span>
<a href="#l19.21"></a><span id="l19.21"> void icalvalue_set_x(icalvalue* impl, const char* v) {</span>
<a href="#l19.22"></a><span id="l19.22">     icalerror_check_arg_rv( (impl!=0),&quot;value&quot;);</span>
<a href="#l19.23"></a><span id="l19.23">     icalerror_check_arg_rv( (v!=0),&quot;v&quot;);</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25">     if(impl-&gt;x_value!=0) {free((void*)impl-&gt;x_value);}</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineat">@@ -118,17 +120,17 @@ void icalvalue_set_x(icalvalue* impl, co</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">     if (impl-&gt;x_value == 0){</span>
<a href="#l19.29"></a><span id="l19.29">       errno = ENOMEM;</span>
<a href="#l19.30"></a><span id="l19.30">     }</span>
<a href="#l19.31"></a><span id="l19.31">  </span>
<a href="#l19.32"></a><span id="l19.32">  }</span>
<a href="#l19.33"></a><span id="l19.33"> const char* icalvalue_get_x(const icalvalue* value) {</span>
<a href="#l19.34"></a><span id="l19.34"> </span>
<a href="#l19.35"></a><span id="l19.35" class="difflineminus">-    icalerror_check_arg( (value!=0),&quot;value&quot;);</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+    icalerror_check_arg_rz( (value!=0),&quot;value&quot;);</span>
<a href="#l19.37"></a><span id="l19.37">     icalerror_check_value_type(value, ICAL_X_VALUE);</span>
<a href="#l19.38"></a><span id="l19.38">     return value-&gt;x_value;</span>
<a href="#l19.39"></a><span id="l19.39"> }</span>
<a href="#l19.40"></a><span id="l19.40"> </span>
<a href="#l19.41"></a><span id="l19.41"> /* Recur is a special case, so it is not auto generated. */</span>
<a href="#l19.42"></a><span id="l19.42"> icalvalue*</span>
<a href="#l19.43"></a><span id="l19.43"> icalvalue_new_recur (struct icalrecurrencetype v)</span>
<a href="#l19.44"></a><span id="l19.44"> {</span>
<a href="#l19.45"></a><span id="l19.45" class="difflineat">@@ -159,17 +161,20 @@ icalvalue_set_recur(icalvalue* impl, str</span>
<a href="#l19.46"></a><span id="l19.46"> 	memcpy(impl-&gt;data.v_recur, &amp;v, sizeof(struct icalrecurrencetype));</span>
<a href="#l19.47"></a><span id="l19.47">     }</span>
<a href="#l19.48"></a><span id="l19.48"> 	       </span>
<a href="#l19.49"></a><span id="l19.49"> }</span>
<a href="#l19.50"></a><span id="l19.50"> </span>
<a href="#l19.51"></a><span id="l19.51"> struct icalrecurrencetype</span>
<a href="#l19.52"></a><span id="l19.52"> icalvalue_get_recur(const icalvalue* value)</span>
<a href="#l19.53"></a><span id="l19.53"> {</span>
<a href="#l19.54"></a><span id="l19.54" class="difflineminus">-    icalerror_check_arg( (value!=0),&quot;value&quot;);</span>
<a href="#l19.55"></a><span id="l19.55" class="difflineplus">+    struct icalrecurrencetype rt;</span>
<a href="#l19.56"></a><span id="l19.56" class="difflineplus">+    icalrecurrencetype_clear(&amp;rt);</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineplus">+</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineplus">+    icalerror_check_arg_rx( (value!=0),&quot;value&quot;, rt);</span>
<a href="#l19.59"></a><span id="l19.59">     icalerror_check_value_type(value, ICAL_RECUR_VALUE);</span>
<a href="#l19.60"></a><span id="l19.60">   </span>
<a href="#l19.61"></a><span id="l19.61">     return *(value-&gt;data.v_recur);</span>
<a href="#l19.62"></a><span id="l19.62"> }</span>
<a href="#l19.63"></a><span id="l19.63"> </span>
<a href="#l19.64"></a><span id="l19.64"> </span>
<a href="#l19.65"></a><span id="l19.65"> </span>
<a href="#l19.66"></a><span id="l19.66"> </span>
<a href="#l19.67"></a><span id="l19.67" class="difflineat">@@ -197,32 +202,72 @@ icalvalue_set_trigger(icalvalue* value, </span>
<a href="#l19.68"></a><span id="l19.68">    }</span>
<a href="#l19.69"></a><span id="l19.69"> }</span>
<a href="#l19.70"></a><span id="l19.70"> </span>
<a href="#l19.71"></a><span id="l19.71"> struct icaltriggertype</span>
<a href="#l19.72"></a><span id="l19.72"> icalvalue_get_trigger(const icalvalue* impl)</span>
<a href="#l19.73"></a><span id="l19.73"> {</span>
<a href="#l19.74"></a><span id="l19.74">     struct icaltriggertype tr;</span>
<a href="#l19.75"></a><span id="l19.75"> </span>
<a href="#l19.76"></a><span id="l19.76" class="difflineminus">-    icalerror_check_arg( (impl!=0),&quot;value&quot;);</span>
<a href="#l19.77"></a><span id="l19.77" class="difflineminus">-    icalerror_check_arg( (impl!=0),&quot;value&quot;);</span>
<a href="#l19.78"></a><span id="l19.78" class="difflineplus">+    tr.duration = icaldurationtype_from_int(0);</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineplus">+    tr.time = icaltime_null_time();</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineplus">+</span>
<a href="#l19.81"></a><span id="l19.81" class="difflineplus">+    icalerror_check_arg_rx( (impl!=0),&quot;value&quot;, tr);</span>
<a href="#l19.82"></a><span id="l19.82"> </span>
<a href="#l19.83"></a><span id="l19.83" class="difflineminus">-    if(impl-&gt;kind == ICAL_DATETIME_VALUE){</span>
<a href="#l19.84"></a><span id="l19.84" class="difflineminus">-	 tr.duration = icaldurationtype_from_int(0);</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineminus">-	 tr.time = impl-&gt;data.v_time;</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineminus">-    } else if(impl-&gt;kind == ICAL_DURATION_VALUE){</span>
<a href="#l19.87"></a><span id="l19.87" class="difflineplus">+    if(impl) {</span>
<a href="#l19.88"></a><span id="l19.88" class="difflineplus">+      if(impl-&gt;kind == ICAL_DATETIME_VALUE){</span>
<a href="#l19.89"></a><span id="l19.89" class="difflineplus">+	tr.duration = icaldurationtype_from_int(0);</span>
<a href="#l19.90"></a><span id="l19.90" class="difflineplus">+	tr.time = impl-&gt;data.v_time;</span>
<a href="#l19.91"></a><span id="l19.91" class="difflineplus">+      } else if(impl-&gt;kind == ICAL_DURATION_VALUE){</span>
<a href="#l19.92"></a><span id="l19.92"> 	tr.time = icaltime_null_time();</span>
<a href="#l19.93"></a><span id="l19.93"> 	tr.duration = impl-&gt;data.v_duration;</span>
<a href="#l19.94"></a><span id="l19.94" class="difflineminus">-    } else {</span>
<a href="#l19.95"></a><span id="l19.95" class="difflineplus">+      } else {</span>
<a href="#l19.96"></a><span id="l19.96"> 	tr.duration = icaldurationtype_from_int(0);</span>
<a href="#l19.97"></a><span id="l19.97"> 	tr.time = icaltime_null_time();</span>
<a href="#l19.98"></a><span id="l19.98"> 	icalerror_set_errno(ICAL_BADARG_ERROR);</span>
<a href="#l19.99"></a><span id="l19.99" class="difflineplus">+      }</span>
<a href="#l19.100"></a><span id="l19.100" class="difflineplus">+    } else {</span>
<a href="#l19.101"></a><span id="l19.101" class="difflineplus">+      tr.duration = icaldurationtype_from_int(0);</span>
<a href="#l19.102"></a><span id="l19.102" class="difflineplus">+      tr.time = icaltime_null_time();</span>
<a href="#l19.103"></a><span id="l19.103" class="difflineplus">+      icalerror_set_errno(ICAL_BADARG_ERROR);</span>
<a href="#l19.104"></a><span id="l19.104">     }</span>
<a href="#l19.105"></a><span id="l19.105" class="difflineplus">+    </span>
<a href="#l19.106"></a><span id="l19.106" class="difflineplus">+    return tr;</span>
<a href="#l19.107"></a><span id="l19.107" class="difflineplus">+}</span>
<a href="#l19.108"></a><span id="l19.108" class="difflineplus">+</span>
<a href="#l19.109"></a><span id="l19.109" class="difflineplus">+icalvalue*</span>
<a href="#l19.110"></a><span id="l19.110" class="difflineplus">+icalvalue_new_datetime (struct icaltimetype v){</span>
<a href="#l19.111"></a><span id="l19.111" class="difflineplus">+</span>
<a href="#l19.112"></a><span id="l19.112" class="difflineplus">+   struct icalvalue_impl* impl = icalvalue_new_impl(ICAL_DATETIME_VALUE);</span>
<a href="#l19.113"></a><span id="l19.113" class="difflineplus">+   icalvalue_set_datetime((icalvalue*)impl,v);</span>
<a href="#l19.114"></a><span id="l19.114" class="difflineplus">+   return (icalvalue*)impl;</span>
<a href="#l19.115"></a><span id="l19.115" class="difflineplus">+}</span>
<a href="#l19.116"></a><span id="l19.116"> </span>
<a href="#l19.117"></a><span id="l19.117" class="difflineminus">-    return tr;</span>
<a href="#l19.118"></a><span id="l19.118" class="difflineplus">+void</span>
<a href="#l19.119"></a><span id="l19.119" class="difflineplus">+icalvalue_set_datetime(icalvalue* value, struct icaltimetype v) {</span>
<a href="#l19.120"></a><span id="l19.120" class="difflineplus">+    struct icalvalue_impl* impl;</span>
<a href="#l19.121"></a><span id="l19.121" class="difflineplus">+    icalerror_check_arg_rv( (value!=0),&quot;value&quot;);</span>
<a href="#l19.122"></a><span id="l19.122" class="difflineplus">+</span>
<a href="#l19.123"></a><span id="l19.123" class="difflineplus">+    icalerror_check_value_type(value, ICAL_DATETIME_VALUE);</span>
<a href="#l19.124"></a><span id="l19.124" class="difflineplus">+    impl = (struct icalvalue_impl*)value;</span>
<a href="#l19.125"></a><span id="l19.125" class="difflineplus">+</span>
<a href="#l19.126"></a><span id="l19.126" class="difflineplus">+</span>
<a href="#l19.127"></a><span id="l19.127" class="difflineplus">+    impl-&gt;data.v_time = v;</span>
<a href="#l19.128"></a><span id="l19.128" class="difflineplus">+</span>
<a href="#l19.129"></a><span id="l19.129" class="difflineplus">+    icalvalue_reset_kind(impl);</span>
<a href="#l19.130"></a><span id="l19.130" class="difflineplus">+}</span>
<a href="#l19.131"></a><span id="l19.131" class="difflineplus">+</span>
<a href="#l19.132"></a><span id="l19.132" class="difflineplus">+struct icaltimetype</span>
<a href="#l19.133"></a><span id="l19.133" class="difflineplus">+icalvalue_get_datetime (const icalvalue* value) {</span>
<a href="#l19.134"></a><span id="l19.134" class="difflineplus">+  struct icaltimetype dt;</span>
<a href="#l19.135"></a><span id="l19.135" class="difflineplus">+  dt = icaltime_null_time();</span>
<a href="#l19.136"></a><span id="l19.136" class="difflineplus">+</span>
<a href="#l19.137"></a><span id="l19.137" class="difflineplus">+  icalerror_check_arg_rx((value!=0),&quot;value&quot;, dt);</span>
<a href="#l19.138"></a><span id="l19.138" class="difflineplus">+  icalerror_check_value_type (value, ICAL_DATETIME_VALUE);</span>
<a href="#l19.139"></a><span id="l19.139" class="difflineplus">+  return ((struct icalvalue_impl*)value)-&gt;data.v_time;</span>
<a href="#l19.140"></a><span id="l19.140"> }</span>
<a href="#l19.141"></a><span id="l19.141"> </span>
<a href="#l19.142"></a><span id="l19.142"> /* DATE-TIME-PERIOD is a special case, and is not auto generated */</span>
<a href="#l19.143"></a><span id="l19.143"> </span>
<a href="#l19.144"></a><span id="l19.144"> icalvalue*</span>
<a href="#l19.145"></a><span id="l19.145"> icalvalue_new_datetimeperiod (struct icaldatetimeperiodtype v)</span>
<a href="#l19.146"></a><span id="l19.146"> {</span>
<a href="#l19.147"></a><span id="l19.147">    struct icalvalue_impl* impl = icalvalue_new_impl(ICAL_DATETIMEPERIOD_VALUE);</span>
<a href="#l19.148"></a><span id="l19.148" class="difflineat">@@ -257,35 +302,108 @@ icalvalue_set_datetimeperiod(icalvalue* </span>
<a href="#l19.149"></a><span id="l19.149"> 	icalerror_set_errno(ICAL_BADARG_ERROR);</span>
<a href="#l19.150"></a><span id="l19.150">     }</span>
<a href="#l19.151"></a><span id="l19.151"> }</span>
<a href="#l19.152"></a><span id="l19.152"> </span>
<a href="#l19.153"></a><span id="l19.153"> struct icaldatetimeperiodtype</span>
<a href="#l19.154"></a><span id="l19.154"> icalvalue_get_datetimeperiod(const icalvalue* impl)</span>
<a href="#l19.155"></a><span id="l19.155"> {</span>
<a href="#l19.156"></a><span id="l19.156">   struct icaldatetimeperiodtype dtp;</span>
<a href="#l19.157"></a><span id="l19.157" class="difflineminus">-  </span>
<a href="#l19.158"></a><span id="l19.158" class="difflineminus">-  icalerror_check_arg( (impl!=0),&quot;value&quot;);</span>
<a href="#l19.159"></a><span id="l19.159" class="difflineplus">+</span>
<a href="#l19.160"></a><span id="l19.160" class="difflineplus">+  dtp.period = icalperiodtype_null_period();</span>
<a href="#l19.161"></a><span id="l19.161" class="difflineplus">+  dtp.time = icaltime_null_time();</span>
<a href="#l19.162"></a><span id="l19.162" class="difflineplus">+</span>
<a href="#l19.163"></a><span id="l19.163" class="difflineplus">+  icalerror_check_arg_rx( (impl!=0),&quot;value&quot;, dtp);</span>
<a href="#l19.164"></a><span id="l19.164">   icalerror_check_value_type(value, ICAL_DATETIMEPERIOD_VALUE);</span>
<a href="#l19.165"></a><span id="l19.165" class="difflineminus">-  </span>
<a href="#l19.166"></a><span id="l19.166" class="difflineminus">-  if( impl-&gt;kind == ICAL_DATETIME_VALUE || impl-&gt;kind == ICAL_DATE_VALUE ){</span>
<a href="#l19.167"></a><span id="l19.167" class="difflineplus">+</span>
<a href="#l19.168"></a><span id="l19.168" class="difflineplus">+  if(impl) {</span>
<a href="#l19.169"></a><span id="l19.169" class="difflineplus">+    if( impl-&gt;kind == ICAL_DATETIME_VALUE || impl-&gt;kind == ICAL_DATE_VALUE ){</span>
<a href="#l19.170"></a><span id="l19.170">       dtp.period = icalperiodtype_null_period();</span>
<a href="#l19.171"></a><span id="l19.171">       dtp.time = impl-&gt;data.v_time;</span>
<a href="#l19.172"></a><span id="l19.172" class="difflineminus">-  } else if(impl-&gt;kind == ICAL_PERIOD_VALUE) {</span>
<a href="#l19.173"></a><span id="l19.173" class="difflineplus">+    } else if(impl-&gt;kind == ICAL_PERIOD_VALUE) {</span>
<a href="#l19.174"></a><span id="l19.174">       dtp.period = impl-&gt;data.v_period;</span>
<a href="#l19.175"></a><span id="l19.175">       dtp.time = icaltime_null_time();</span>
<a href="#l19.176"></a><span id="l19.176" class="difflineminus">-  } else {</span>
<a href="#l19.177"></a><span id="l19.177" class="difflineplus">+    } else {</span>
<a href="#l19.178"></a><span id="l19.178">       dtp.period = icalperiodtype_null_period();</span>
<a href="#l19.179"></a><span id="l19.179">       dtp.time = icaltime_null_time();</span>
<a href="#l19.180"></a><span id="l19.180">       icalerror_set_errno(ICAL_BADARG_ERROR);</span>
<a href="#l19.181"></a><span id="l19.181" class="difflineplus">+    }	</span>
<a href="#l19.182"></a><span id="l19.182" class="difflineplus">+  } else {</span>
<a href="#l19.183"></a><span id="l19.183" class="difflineplus">+    dtp.period = icalperiodtype_null_period();</span>
<a href="#l19.184"></a><span id="l19.184" class="difflineplus">+    dtp.time = icaltime_null_time();</span>
<a href="#l19.185"></a><span id="l19.185" class="difflineplus">+    icalerror_set_errno(ICAL_BADARG_ERROR);</span>
<a href="#l19.186"></a><span id="l19.186">   }	</span>
<a href="#l19.187"></a><span id="l19.187"> </span>
<a href="#l19.188"></a><span id="l19.188">   return dtp;</span>
<a href="#l19.189"></a><span id="l19.189"> }</span>
<a href="#l19.190"></a><span id="l19.190"> </span>
<a href="#l19.191"></a><span id="l19.191" class="difflineplus">+icalvalue*</span>
<a href="#l19.192"></a><span id="l19.192" class="difflineplus">+icalvalue_new_class (enum icalproperty_class v){</span>
<a href="#l19.193"></a><span id="l19.193" class="difflineplus">+</span>
<a href="#l19.194"></a><span id="l19.194" class="difflineplus">+    struct icalvalue_impl* impl = icalvalue_new_impl(ICAL_CLASS_VALUE);</span>
<a href="#l19.195"></a><span id="l19.195" class="difflineplus">+    icalvalue_set_class((icalvalue*)impl,v);</span>
<a href="#l19.196"></a><span id="l19.196" class="difflineplus">+    return (icalvalue*)impl;</span>
<a href="#l19.197"></a><span id="l19.197" class="difflineplus">+}</span>
<a href="#l19.198"></a><span id="l19.198" class="difflineplus">+</span>
<a href="#l19.199"></a><span id="l19.199" class="difflineplus">+void</span>
<a href="#l19.200"></a><span id="l19.200" class="difflineplus">+icalvalue_set_class(icalvalue* value, enum icalproperty_class v) {</span>
<a href="#l19.201"></a><span id="l19.201" class="difflineplus">+    struct icalvalue_impl* impl;</span>
<a href="#l19.202"></a><span id="l19.202" class="difflineplus">+    icalerror_check_arg_rv( (value!=0),&quot;value&quot;);</span>
<a href="#l19.203"></a><span id="l19.203" class="difflineplus">+</span>
<a href="#l19.204"></a><span id="l19.204" class="difflineplus">+    icalerror_check_value_type(value, ICAL_CLASS_VALUE);</span>
<a href="#l19.205"></a><span id="l19.205" class="difflineplus">+    impl = (struct icalvalue_impl*)value;</span>
<a href="#l19.206"></a><span id="l19.206" class="difflineplus">+</span>
<a href="#l19.207"></a><span id="l19.207" class="difflineplus">+    impl-&gt;data.v_enum = v;</span>
<a href="#l19.208"></a><span id="l19.208" class="difflineplus">+</span>
<a href="#l19.209"></a><span id="l19.209" class="difflineplus">+    icalvalue_reset_kind(impl);</span>
<a href="#l19.210"></a><span id="l19.210" class="difflineplus">+}</span>
<a href="#l19.211"></a><span id="l19.211" class="difflineplus">+</span>
<a href="#l19.212"></a><span id="l19.212" class="difflineplus">+enum icalproperty_class</span>
<a href="#l19.213"></a><span id="l19.213" class="difflineplus">+icalvalue_get_class (const icalvalue* value) {</span>
<a href="#l19.214"></a><span id="l19.214" class="difflineplus">+</span>
<a href="#l19.215"></a><span id="l19.215" class="difflineplus">+    icalproperty_class pr;</span>
<a href="#l19.216"></a><span id="l19.216" class="difflineplus">+    pr = ICAL_CLASS_NONE;</span>
<a href="#l19.217"></a><span id="l19.217" class="difflineplus">+</span>
<a href="#l19.218"></a><span id="l19.218" class="difflineplus">+    icalerror_check_arg_rx ((value!=NULL),&quot;value&quot;, pr);</span>
<a href="#l19.219"></a><span id="l19.219" class="difflineplus">+    icalerror_check_arg ((value!=0),&quot;value&quot;);</span>
<a href="#l19.220"></a><span id="l19.220" class="difflineplus">+    icalerror_check_value_type (value, ICAL_CLASS_VALUE);</span>
<a href="#l19.221"></a><span id="l19.221" class="difflineplus">+    return ((struct icalvalue_impl*)value)-&gt;data.v_enum;</span>
<a href="#l19.222"></a><span id="l19.222" class="difflineplus">+}</span>
<a href="#l19.223"></a><span id="l19.223" class="difflineplus">+</span>
<a href="#l19.224"></a><span id="l19.224" class="difflineplus">+icalvalue*</span>
<a href="#l19.225"></a><span id="l19.225" class="difflineplus">+icalvalue_new_geo (struct icalgeotype v){</span>
<a href="#l19.226"></a><span id="l19.226" class="difflineplus">+</span>
<a href="#l19.227"></a><span id="l19.227" class="difflineplus">+    struct icalvalue_impl* impl = icalvalue_new_impl(ICAL_GEO_VALUE);</span>
<a href="#l19.228"></a><span id="l19.228" class="difflineplus">+    icalvalue_set_geo((icalvalue*)impl,v);</span>
<a href="#l19.229"></a><span id="l19.229" class="difflineplus">+    return (icalvalue*)impl;</span>
<a href="#l19.230"></a><span id="l19.230" class="difflineplus">+}</span>
<a href="#l19.231"></a><span id="l19.231" class="difflineplus">+</span>
<a href="#l19.232"></a><span id="l19.232" class="difflineplus">+void</span>
<a href="#l19.233"></a><span id="l19.233" class="difflineplus">+icalvalue_set_geo(icalvalue* value, struct icalgeotype v) {</span>
<a href="#l19.234"></a><span id="l19.234" class="difflineplus">+    struct icalvalue_impl* impl;</span>
<a href="#l19.235"></a><span id="l19.235" class="difflineplus">+    icalerror_check_arg_rv( (value!=0),&quot;value&quot;);</span>
<a href="#l19.236"></a><span id="l19.236" class="difflineplus">+</span>
<a href="#l19.237"></a><span id="l19.237" class="difflineplus">+    icalerror_check_value_type(value, ICAL_GEO_VALUE);</span>
<a href="#l19.238"></a><span id="l19.238" class="difflineplus">+    impl = (struct icalvalue_impl*)value;</span>
<a href="#l19.239"></a><span id="l19.239" class="difflineplus">+</span>
<a href="#l19.240"></a><span id="l19.240" class="difflineplus">+    impl-&gt;data.v_geo = v;</span>
<a href="#l19.241"></a><span id="l19.241" class="difflineplus">+</span>
<a href="#l19.242"></a><span id="l19.242" class="difflineplus">+    icalvalue_reset_kind(impl);</span>
<a href="#l19.243"></a><span id="l19.243" class="difflineplus">+}</span>
<a href="#l19.244"></a><span id="l19.244" class="difflineplus">+</span>
<a href="#l19.245"></a><span id="l19.245" class="difflineplus">+struct icalgeotype</span>
<a href="#l19.246"></a><span id="l19.246" class="difflineplus">+icalvalue_get_geo (const icalvalue* value) {</span>
<a href="#l19.247"></a><span id="l19.247" class="difflineplus">+    struct icalgeotype gt;</span>
<a href="#l19.248"></a><span id="l19.248" class="difflineplus">+    gt.lat = 255.0;</span>
<a href="#l19.249"></a><span id="l19.249" class="difflineplus">+    gt.lon = 255.0;</span>
<a href="#l19.250"></a><span id="l19.250" class="difflineplus">+</span>
<a href="#l19.251"></a><span id="l19.251" class="difflineplus">+    icalerror_check_arg_rx((value!=0),&quot;value&quot;, gt);</span>
<a href="#l19.252"></a><span id="l19.252" class="difflineplus">+    icalerror_check_value_type (value, ICAL_GEO_VALUE);</span>
<a href="#l19.253"></a><span id="l19.253" class="difflineplus">+    return ((struct icalvalue_impl*)value)-&gt;data.v_geo;</span>
<a href="#l19.254"></a><span id="l19.254" class="difflineplus">+}</span>
<a href="#l19.255"></a><span id="l19.255"> </span>
<a href="#l19.256"></a><span id="l19.256"> </span>
<a href="#l19.257"></a><span id="l19.257"> icalvalue *</span>
<a href="#l19.258"></a><span id="l19.258"> icalvalue_new_attach (icalattach *attach)</span>
<a href="#l19.259"></a><span id="l19.259"> {</span>
<a href="#l19.260"></a><span id="l19.260">     struct icalvalue_impl *impl;</span>
<a href="#l19.261"></a><span id="l19.261"> </span>
<a href="#l19.262"></a><span id="l19.262">     icalerror_check_arg_rz ((attach != NULL), &quot;attach&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/libical/src/libical/icalderivedvalue.h.in</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalderivedvalue.h.in</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -33,33 +33,45 @@</span>
<a href="#l20.4"></a><span id="l20.4"> #include &quot;icalrecur.h&quot;</span>
<a href="#l20.5"></a><span id="l20.5"> #include &quot;icaltime.h&quot;</span>
<a href="#l20.6"></a><span id="l20.6"> #include &quot;icalduration.h&quot;</span>
<a href="#l20.7"></a><span id="l20.7"> #include &quot;icalperiod.h&quot;</span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;icalattach.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9">      </span>
<a href="#l20.10"></a><span id="l20.10"> typedef struct icalvalue_impl icalvalue;</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-</span>
<a href="#l20.14"></a><span id="l20.14"> void icalvalue_set_x(icalvalue* value, const char* v);</span>
<a href="#l20.15"></a><span id="l20.15"> icalvalue* icalvalue_new_x(const char* v);</span>
<a href="#l20.16"></a><span id="l20.16"> const char* icalvalue_get_x(const icalvalue* value);</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18"> icalvalue* icalvalue_new_recur (struct icalrecurrencetype v);</span>
<a href="#l20.19"></a><span id="l20.19"> void icalvalue_set_recur(icalvalue* value, struct icalrecurrencetype v);</span>
<a href="#l20.20"></a><span id="l20.20"> struct icalrecurrencetype icalvalue_get_recur(const icalvalue* value);</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22"> icalvalue* icalvalue_new_trigger (struct icaltriggertype v);</span>
<a href="#l20.23"></a><span id="l20.23"> void icalvalue_set_trigger(icalvalue* value, struct icaltriggertype v);</span>
<a href="#l20.24"></a><span id="l20.24"> struct icaltriggertype icalvalue_get_trigger(const icalvalue* value);</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+icalvalue* icalvalue_new_datetime(struct icaltimetype v);</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+struct icaltimetype icalvalue_get_datetime(const icalvalue* value);</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+void icalvalue_set_datetime(icalvalue* value, struct icaltimetype v);</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+</span>
<a href="#l20.30"></a><span id="l20.30"> icalvalue* icalvalue_new_datetimeperiod (struct icaldatetimeperiodtype v);</span>
<a href="#l20.31"></a><span id="l20.31"> void icalvalue_set_datetimeperiod(icalvalue* value, struct icaldatetimeperiodtype v);</span>
<a href="#l20.32"></a><span id="l20.32"> struct icaldatetimeperiodtype icalvalue_get_datetimeperiod(const icalvalue* value);</span>
<a href="#l20.33"></a><span id="l20.33"> </span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+/* GEO */</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+icalvalue* icalvalue_new_geo(struct icalgeotype v);</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+struct icalgeotype icalvalue_get_geo(const icalvalue* value);</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+void icalvalue_set_geo(icalvalue* value, struct icalgeotype v);</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+</span>
<a href="#l20.39"></a><span id="l20.39"> icalvalue *icalvalue_new_attach (icalattach *attach);</span>
<a href="#l20.40"></a><span id="l20.40"> void icalvalue_set_attach (icalvalue *value, icalattach *attach);</span>
<a href="#l20.41"></a><span id="l20.41"> icalattach *icalvalue_get_attach (const icalvalue *value);</span>
<a href="#l20.42"></a><span id="l20.42"> </span>
<a href="#l20.43"></a><span id="l20.43"> void icalvalue_reset_kind(icalvalue* value);</span>
<a href="#l20.44"></a><span id="l20.44"> </span>
<a href="#l20.45"></a><span id="l20.45"> &lt;insert_code_here&gt;</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+icalvalue* icalvalue_new_class(enum icalproperty_class v);</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+enum icalproperty_class icalvalue_get_class(const icalvalue* value);</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+void icalvalue_set_class(icalvalue* value, enum icalproperty_class v);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/libical/src/libical/icalduration.c</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalduration.c</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -30,24 +30,26 @@</span>
<a href="#l21.4"></a><span id="l21.4"> #endif</span>
<a href="#l21.5"></a><span id="l21.5"> </span>
<a href="#l21.6"></a><span id="l21.6"> #include &quot;icalduration.h&quot;</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> #include &lt;assert.h&gt;</span>
<a href="#l21.9"></a><span id="l21.9"> #include &lt;string.h&gt;</span>
<a href="#l21.10"></a><span id="l21.10"> #include &lt;stdlib.h&gt;</span>
<a href="#l21.11"></a><span id="l21.11"> #include &lt;stdio.h&gt;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-#ifdef WIN32</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-#define snprintf _snprintf</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-#endif</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16"> #include &quot;icalerror.h&quot;</span>
<a href="#l21.17"></a><span id="l21.17"> #include &quot;icalmemory.h&quot;</span>
<a href="#l21.18"></a><span id="l21.18"> #include &quot;icalvalue.h&quot;</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+#ifdef WIN32</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+#include &quot;vsnprintf.h&quot;</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+#endif</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+#endif</span>
<a href="#l21.25"></a><span id="l21.25"> </span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28"> /* From Seth Alves,  &lt;alves@hungry.com&gt;   */</span>
<a href="#l21.29"></a><span id="l21.29"> struct icaldurationtype icaldurationtype_from_int(int t)</span>
<a href="#l21.30"></a><span id="l21.30"> {</span>
<a href="#l21.31"></a><span id="l21.31">     struct icaldurationtype dur;</span>
<a href="#l21.32"></a><span id="l21.32">     int used = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/libical/src/libical/icalenums.c</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalenums.c</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -30,20 +30,24 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #endif</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;icalenums.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8"> #include &lt;stdio.h&gt; /* For fprintf */</span>
<a href="#l22.9"></a><span id="l22.9"> #include &lt;stdio.h&gt; /* For stderr */</span>
<a href="#l22.10"></a><span id="l22.10"> #include &lt;string.h&gt; /* For strncmp */</span>
<a href="#l22.11"></a><span id="l22.11"> #include &lt;assert.h&gt;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+#include &quot;icalmemory.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+</span>
<a href="#l22.14"></a><span id="l22.14"> #ifdef WIN32</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-#define snprintf _snprintf</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+#include &quot;vsnprintf.h&quot;</span>
<a href="#l22.18"></a><span id="l22.18"> #endif</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-#include &quot;icalmemory.h&quot;</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+#endif</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+</span>
<a href="#l22.22"></a><span id="l22.22"> </span>
<a href="#l22.23"></a><span id="l22.23"> /*** @brief Allowed request status values</span>
<a href="#l22.24"></a><span id="l22.24">  */</span>
<a href="#l22.25"></a><span id="l22.25"> static const struct {</span>
<a href="#l22.26"></a><span id="l22.26"> 	 enum icalrequeststatus kind;</span>
<a href="#l22.27"></a><span id="l22.27"> 	int major;</span>
<a href="#l22.28"></a><span id="l22.28"> 	int minor;</span>
<a href="#l22.29"></a><span id="l22.29"> 	const char* str;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/libical/src/libical/icalerror.c</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalerror.c</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -184,17 +184,17 @@ icalerrorstate icalerror_supress(const c</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">     es = icalerror_get_error_state(e);</span>
<a href="#l23.7"></a><span id="l23.7">     icalerror_set_error_state(e,ICAL_ERROR_NONFATAL);</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9">     return es;</span>
<a href="#l23.10"></a><span id="l23.10"> }</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-const char* icalerror_perror()</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+const char* icalerror_perror(void)</span>
<a href="#l23.14"></a><span id="l23.14"> {</span>
<a href="#l23.15"></a><span id="l23.15">     return icalerror_strerror(icalerrno);</span>
<a href="#l23.16"></a><span id="l23.16"> }</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18"> void icalerror_restore(const char* error, icalerrorstate es){</span>
<a href="#l23.19"></a><span id="l23.19"> </span>
<a href="#l23.20"></a><span id="l23.20"> </span>
<a href="#l23.21"></a><span id="l23.21">     icalerrorenum e = icalerror_error_from_string(error);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/libical/src/libical/icalerror.h</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalerror.h</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -64,17 +64,27 @@ typedef enum icalerrorenum {</span>
<a href="#l24.4"></a><span id="l24.4"> icalerrorenum * icalerrno_return(void);</span>
<a href="#l24.5"></a><span id="l24.5"> #define icalerrno (*(icalerrno_return()))</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7"> /** If true, libicl aborts after a call to icalerror_set_error</span>
<a href="#l24.8"></a><span id="l24.8">  *</span>
<a href="#l24.9"></a><span id="l24.9">  *  @warning NOT THREAD SAFE -- recommended that you do not change</span>
<a href="#l24.10"></a><span id="l24.10">  *           this in a multithreaded program.</span>
<a href="#l24.11"></a><span id="l24.11">  */</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-extern int icalerror_errors_are_fatal;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+#ifdef _MSC_VER</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+  #ifdef BUILD_LIBICALDLL</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+    #define LIBICAL_EXPORT __declspec(dllexport)</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+  #else</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+    #define LIBICAL_EXPORT __declspec(dllimport)</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+  #endif</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+#else</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+  #define LIBICAL_EXPORT extern</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+#endif</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+LIBICAL_EXPORT int icalerror_errors_are_fatal;</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25"> /* Warning messages */</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27"> #ifdef __GNUC__ca</span>
<a href="#l24.28"></a><span id="l24.28"> #define icalerror_warn(message) {fprintf(stderr,&quot;%s(), %s:%d: %s\n&quot;,__FUNCTION__,__FILE__,__LINE__,message);}</span>
<a href="#l24.29"></a><span id="l24.29"> #else /* __GNU_C__ */</span>
<a href="#l24.30"></a><span id="l24.30"> #define icalerror_warn(message) {fprintf(stderr,&quot;%s:%d: %s\n&quot;,__FILE__,__LINE__,message);}</span>
<a href="#l24.31"></a><span id="l24.31"> #endif /* __GNU_C__ */</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineat">@@ -87,17 +97,17 @@ void _icalerror_set_errno(icalerrorenum)</span>
<a href="#l24.33"></a><span id="l24.33"> typedef enum icalerrorstate { </span>
<a href="#l24.34"></a><span id="l24.34">     ICAL_ERROR_FATAL,     /* Not fata */</span>
<a href="#l24.35"></a><span id="l24.35">     ICAL_ERROR_NONFATAL,  /* Fatal */</span>
<a href="#l24.36"></a><span id="l24.36">     ICAL_ERROR_DEFAULT,   /* Use the value of icalerror_errors_are_fatal*/</span>
<a href="#l24.37"></a><span id="l24.37">     ICAL_ERROR_UNKNOWN    /* Asked state for an unknown error type */</span>
<a href="#l24.38"></a><span id="l24.38"> } icalerrorstate ;</span>
<a href="#l24.39"></a><span id="l24.39"> </span>
<a href="#l24.40"></a><span id="l24.40"> const char* icalerror_strerror(icalerrorenum e);</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-const char* icalerror_perror();</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+const char* icalerror_perror(void);</span>
<a href="#l24.43"></a><span id="l24.43"> void ical_bt(void);</span>
<a href="#l24.44"></a><span id="l24.44"> void icalerror_set_error_state( icalerrorenum error, icalerrorstate);</span>
<a href="#l24.45"></a><span id="l24.45"> icalerrorstate icalerror_get_error_state( icalerrorenum error);</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47"> #ifndef ICAL_SETERROR_ISFUNC</span>
<a href="#l24.48"></a><span id="l24.48"> #define icalerror_set_errno(x) \</span>
<a href="#l24.49"></a><span id="l24.49"> icalerrno = x; \</span>
<a href="#l24.50"></a><span id="l24.50"> if(icalerror_get_error_state(x)==ICAL_ERROR_FATAL || \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/libical/src/libical/icallangbind.c</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/libical/src/libical/icallangbind.c</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -155,25 +155,28 @@ icalcomponent* icallangbind_get_next_com</span>
<a href="#l25.4"></a><span id="l25.4"> #define APPENDS(x) icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, x);</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6"> #define APPENDC(x) icalmemory_append_char(&amp;buf, &amp;buf_ptr, &amp;buf_size, x);</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> char* icallangbind_property_eval_string_r(icalproperty* prop, char* sep)</span>
<a href="#l25.9"></a><span id="l25.9"> {</span>
<a href="#l25.10"></a><span id="l25.10">     char tmp[25];</span>
<a href="#l25.11"></a><span id="l25.11">     size_t buf_size = 1024;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    char* buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-    char* buf_ptr = buf;</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+    char* buf; </span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+    char* buf_ptr; </span>
<a href="#l25.16"></a><span id="l25.16">     icalparameter *param;</span>
<a href="#l25.17"></a><span id="l25.17">     </span>
<a href="#l25.18"></a><span id="l25.18">     icalvalue* value;</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20">     if( prop == 0){</span>
<a href="#l25.21"></a><span id="l25.21"> 	return 0;</span>
<a href="#l25.22"></a><span id="l25.22">     }</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineplus">+  </span>
<a href="#l25.24"></a><span id="l25.24" class="difflineplus">+    buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineplus">+    buf_ptr = buf;</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27">     APPENDS(&quot;{ &quot;);</span>
<a href="#l25.28"></a><span id="l25.28"> </span>
<a href="#l25.29"></a><span id="l25.29">     value = icalproperty_get_value(prop);</span>
<a href="#l25.30"></a><span id="l25.30"> </span>
<a href="#l25.31"></a><span id="l25.31">     APPENDS(&quot; 'name' &quot;);</span>
<a href="#l25.32"></a><span id="l25.32">     APPENDS(sep);</span>
<a href="#l25.33"></a><span id="l25.33">     APPENDC('\'');</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/libical/src/libical/icalmime.c</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalmime.c</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -48,17 +48,17 @@</span>
<a href="#l26.4"></a><span id="l26.4"> </span>
<a href="#l26.5"></a><span id="l26.5"> struct text_part</span>
<a href="#l26.6"></a><span id="l26.6"> {</span>
<a href="#l26.7"></a><span id="l26.7"> 	char* buf;</span>
<a href="#l26.8"></a><span id="l26.8"> 	char* buf_pos;</span>
<a href="#l26.9"></a><span id="l26.9"> 	size_t buf_size;</span>
<a href="#l26.10"></a><span id="l26.10"> };</span>
<a href="#l26.11"></a><span id="l26.11"> </span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-void* icalmime_text_new_part()</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+void* icalmime_text_new_part(void)</span>
<a href="#l26.14"></a><span id="l26.14"> {</span>
<a href="#l26.15"></a><span id="l26.15"> </span>
<a href="#l26.16"></a><span id="l26.16"> #define BUF_SIZE 2048</span>
<a href="#l26.17"></a><span id="l26.17"> </span>
<a href="#l26.18"></a><span id="l26.18">     struct text_part* impl;</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20">     if ( ( impl = (struct text_part*)</span>
<a href="#l26.21"></a><span id="l26.21"> 	   malloc(sizeof(struct text_part))) == 0) {</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -120,17 +120,17 @@ void* icalmime_text_end_part(void* part)</span>
<a href="#l26.23"></a><span id="l26.23"> void icalmime_text_free_part(void *part)</span>
<a href="#l26.24"></a><span id="l26.24"> {</span>
<a href="#l26.25"></a><span id="l26.25">     part = part;</span>
<a href="#l26.26"></a><span id="l26.26"> }</span>
<a href="#l26.27"></a><span id="l26.27"> </span>
<a href="#l26.28"></a><span id="l26.28"> </span>
<a href="#l26.29"></a><span id="l26.29"> /* Ignore Attachments for now */</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-void* icalmime_attachment_new_part()</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+void* icalmime_attachment_new_part(void)</span>
<a href="#l26.33"></a><span id="l26.33"> {</span>
<a href="#l26.34"></a><span id="l26.34">     return 0;</span>
<a href="#l26.35"></a><span id="l26.35"> }</span>
<a href="#l26.36"></a><span id="l26.36"> void icalmime_attachment_add_line(void *part, struct sspm_header *header, </span>
<a href="#l26.37"></a><span id="l26.37"> 				  const char* line, size_t size)</span>
<a href="#l26.38"></a><span id="l26.38"> {</span>
<a href="#l26.39"></a><span id="l26.39">     (void)part;</span>
<a href="#l26.40"></a><span id="l26.40">     (void)header;</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineat">@@ -340,17 +340,18 @@ line between the header and the previous</span>
<a href="#l26.42"></a><span id="l26.42"> </span>
<a href="#l26.43"></a><span id="l26.43"> 	    parent = last;</span>
<a href="#l26.44"></a><span id="l26.44"> 	    icalcomponent_add_component(parent,comp);</span>
<a href="#l26.45"></a><span id="l26.45"> </span>
<a href="#l26.46"></a><span id="l26.46"> 	    last_level = parts[i].level;</span>
<a href="#l26.47"></a><span id="l26.47"> </span>
<a href="#l26.48"></a><span id="l26.48"> 	} else if (parts[i].level &lt; last_level){</span>
<a href="#l26.49"></a><span id="l26.49"> </span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-	    parent = icalcomponent_get_parent(parent);</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+	    if (parent) </span>
<a href="#l26.52"></a><span id="l26.52" class="difflineplus">+	        parent = icalcomponent_get_parent(parent);</span>
<a href="#l26.53"></a><span id="l26.53"> 	    icalcomponent_add_component(parent,comp);</span>
<a href="#l26.54"></a><span id="l26.54"> </span>
<a href="#l26.55"></a><span id="l26.55"> 	    last_level = parts[i].level;</span>
<a href="#l26.56"></a><span id="l26.56"> 	} else { </span>
<a href="#l26.57"></a><span id="l26.57"> 	    assert(0);</span>
<a href="#l26.58"></a><span id="l26.58"> 	}</span>
<a href="#l26.59"></a><span id="l26.59"> </span>
<a href="#l26.60"></a><span id="l26.60"> 	last = comp;</span>
<a href="#l26.61"></a><span id="l26.61" class="difflineat">@@ -394,14 +395,15 @@ int icalmime_test(char* (*get_string)(ch</span>
<a href="#l26.62"></a><span id="l26.62"> 	   parts[i].data =</span>
<a href="#l26.63"></a><span id="l26.63"> 	       icalcomponent_as_ical_string_r((icalcomponent*)parts[i].data);</span>
<a href="#l26.64"></a><span id="l26.64">        }</span>
<a href="#l26.65"></a><span id="l26.65">    }</span>
<a href="#l26.66"></a><span id="l26.66"> </span>
<a href="#l26.67"></a><span id="l26.67">     sspm_write_mime(parts,NUM_PARTS,&amp;out,&quot;To: bob@bob.org&quot;);</span>
<a href="#l26.68"></a><span id="l26.68"> </span>
<a href="#l26.69"></a><span id="l26.69">     printf(&quot;%s\n&quot;,out);</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+    free(out);</span>
<a href="#l26.71"></a><span id="l26.71"> </span>
<a href="#l26.72"></a><span id="l26.72">     return 0;</span>
<a href="#l26.73"></a><span id="l26.73"> </span>
<a href="#l26.74"></a><span id="l26.74"> }</span>
<a href="#l26.75"></a><span id="l26.75"> </span>
<a href="#l26.76"></a><span id="l26.76"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/libical/src/libical/icalparameter.c</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalparameter.c</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -22,32 +22,39 @@</span>
<a href="#l27.4"></a><span id="l27.4">     the License at http://www.mozilla.org/MPL/</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">   The original code is icalderivedparameters.{c,h}</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">   Contributions from:</span>
<a href="#l27.9"></a><span id="l27.9">      Graham Davison &lt;g.m.davison@computer.org&gt;</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">  ======================================================================*/</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-/*#line 29 &quot;icalparameter.c.in&quot;*/</span>
<a href="#l27.13"></a><span id="l27.13"> #ifdef HAVE_CONFIG_H</span>
<a href="#l27.14"></a><span id="l27.14"> #include &lt;config.h&gt;</span>
<a href="#l27.15"></a><span id="l27.15"> #endif</span>
<a href="#l27.16"></a><span id="l27.16"> </span>
<a href="#l27.17"></a><span id="l27.17"> </span>
<a href="#l27.18"></a><span id="l27.18"> #include &quot;icalparameter.h&quot;</span>
<a href="#l27.19"></a><span id="l27.19"> #include &quot;icalproperty.h&quot;</span>
<a href="#l27.20"></a><span id="l27.20"> #include &quot;icalerror.h&quot;</span>
<a href="#l27.21"></a><span id="l27.21"> #include &quot;icalmemory.h&quot;</span>
<a href="#l27.22"></a><span id="l27.22"> #include &quot;icalparameterimpl.h&quot;</span>
<a href="#l27.23"></a><span id="l27.23"> </span>
<a href="#l27.24"></a><span id="l27.24"> #include &lt;stdlib.h&gt; /* for malloc() */</span>
<a href="#l27.25"></a><span id="l27.25"> #include &lt;errno.h&gt;</span>
<a href="#l27.26"></a><span id="l27.26"> #include &lt;string.h&gt; /* for memset() */</span>
<a href="#l27.27"></a><span id="l27.27"> </span>
<a href="#l27.28"></a><span id="l27.28" class="difflineplus">+</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+#ifdef WIN32</span>
<a href="#l27.30"></a><span id="l27.30" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineplus">+#include &quot;vsnprintf.h&quot;</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+#endif</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineplus">+#define strcasecmp      stricmp</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineplus">+#endif</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineplus">+</span>
<a href="#l27.36"></a><span id="l27.36"> /* In icalderivedparameter */</span>
<a href="#l27.37"></a><span id="l27.37"> icalparameter* icalparameter_new_from_value_string(icalparameter_kind kind,const  char* val);</span>
<a href="#l27.38"></a><span id="l27.38"> </span>
<a href="#l27.39"></a><span id="l27.39"> </span>
<a href="#l27.40"></a><span id="l27.40"> struct icalparameter_impl* icalparameter_new_impl(icalparameter_kind kind)</span>
<a href="#l27.41"></a><span id="l27.41"> {</span>
<a href="#l27.42"></a><span id="l27.42">     struct icalparameter_impl* v;</span>
<a href="#l27.43"></a><span id="l27.43"> </span>
<a href="#l27.44"></a><span id="l27.44" class="difflineat">@@ -162,34 +169,38 @@ icalparameter* icalparameter_new_from_st</span>
<a href="#l27.45"></a><span id="l27.45">         icalerror_set_errno(ICAL_NEWFAILED_ERROR);</span>
<a href="#l27.46"></a><span id="l27.46">         return 0;</span>
<a href="#l27.47"></a><span id="l27.47">     }</span>
<a href="#l27.48"></a><span id="l27.48"> </span>
<a href="#l27.49"></a><span id="l27.49">     eq = strchr(cpy,'=');</span>
<a href="#l27.50"></a><span id="l27.50"> </span>
<a href="#l27.51"></a><span id="l27.51">     if(eq == 0){</span>
<a href="#l27.52"></a><span id="l27.52">         icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineplus">+	free(cpy);</span>
<a href="#l27.54"></a><span id="l27.54">         return 0;</span>
<a href="#l27.55"></a><span id="l27.55">     }</span>
<a href="#l27.56"></a><span id="l27.56"> </span>
<a href="#l27.57"></a><span id="l27.57">     *eq = '\0';</span>
<a href="#l27.58"></a><span id="l27.58"> </span>
<a href="#l27.59"></a><span id="l27.59">     eq++;</span>
<a href="#l27.60"></a><span id="l27.60"> </span>
<a href="#l27.61"></a><span id="l27.61">     kind = icalparameter_string_to_kind(cpy);</span>
<a href="#l27.62"></a><span id="l27.62"> </span>
<a href="#l27.63"></a><span id="l27.63">     if(kind == ICAL_NO_PARAMETER){</span>
<a href="#l27.64"></a><span id="l27.64">         icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineplus">+	free(cpy);</span>
<a href="#l27.66"></a><span id="l27.66">         return 0;</span>
<a href="#l27.67"></a><span id="l27.67">     }</span>
<a href="#l27.68"></a><span id="l27.68"> </span>
<a href="#l27.69"></a><span id="l27.69">     param = icalparameter_new_from_value_string(kind,eq);</span>
<a href="#l27.70"></a><span id="l27.70"> </span>
<a href="#l27.71"></a><span id="l27.71">     if(kind == ICAL_X_PARAMETER){</span>
<a href="#l27.72"></a><span id="l27.72">         icalparameter_set_xname(param,cpy);</span>
<a href="#l27.73"></a><span id="l27.73" class="difflineplus">+    } else if(kind == ICAL_IANA_PARAMETER) {</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineplus">+        icalparameter_set_iana_name(param, cpy);</span>
<a href="#l27.75"></a><span id="l27.75">     }</span>
<a href="#l27.76"></a><span id="l27.76"> </span>
<a href="#l27.77"></a><span id="l27.77">     free(cpy);</span>
<a href="#l27.78"></a><span id="l27.78"> </span>
<a href="#l27.79"></a><span id="l27.79">     return param;</span>
<a href="#l27.80"></a><span id="l27.80">     </span>
<a href="#l27.81"></a><span id="l27.81"> }</span>
<a href="#l27.82"></a><span id="l27.82"> </span>
<a href="#l27.83"></a><span id="l27.83" class="difflineat">@@ -215,42 +226,43 @@ icalparameter_as_ical_string(icalparamet</span>
<a href="#l27.84"></a><span id="l27.84">  * SAFE-CHAR	= any character except CTLs, DQUOTE. &quot;;&quot;, &quot;:&quot;, &quot;,&quot;</span>
<a href="#l27.85"></a><span id="l27.85">  */</span>
<a href="#l27.86"></a><span id="l27.86"> char*</span>
<a href="#l27.87"></a><span id="l27.87"> icalparameter_as_ical_string_r(icalparameter* param)</span>
<a href="#l27.88"></a><span id="l27.88"> {</span>
<a href="#l27.89"></a><span id="l27.89">     size_t buf_size = 1024;</span>
<a href="#l27.90"></a><span id="l27.90">     char* buf; </span>
<a href="#l27.91"></a><span id="l27.91">     char* buf_ptr;</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineminus">-    char *out_buf;</span>
<a href="#l27.93"></a><span id="l27.93">     const char *kind_string;</span>
<a href="#l27.94"></a><span id="l27.94"> </span>
<a href="#l27.95"></a><span id="l27.95">     icalerror_check_arg_rz( (param!=0), &quot;parameter&quot;);</span>
<a href="#l27.96"></a><span id="l27.96"> </span>
<a href="#l27.97"></a><span id="l27.97">     /* Create new buffer that we can append names, parameters and a</span>
<a href="#l27.98"></a><span id="l27.98">      * value to, and reallocate as needed.</span>
<a href="#l27.99"></a><span id="l27.99">      */</span>
<a href="#l27.100"></a><span id="l27.100"> </span>
<a href="#l27.101"></a><span id="l27.101">     buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l27.102"></a><span id="l27.102">     buf_ptr = buf;</span>
<a href="#l27.103"></a><span id="l27.103"> </span>
<a href="#l27.104"></a><span id="l27.104">     if(param-&gt;kind == ICAL_X_PARAMETER) {</span>
<a href="#l27.105"></a><span id="l27.105" class="difflineminus">-</span>
<a href="#l27.106"></a><span id="l27.106" class="difflineminus">-	icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, </span>
<a href="#l27.107"></a><span id="l27.107" class="difflineminus">-				 icalparameter_get_xname(param));</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineminus">-</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineplus">+        icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, </span>
<a href="#l27.110"></a><span id="l27.110" class="difflineplus">+                     icalparameter_get_xname(param));</span>
<a href="#l27.111"></a><span id="l27.111" class="difflineplus">+    } else if (param-&gt;kind == ICAL_IANA_PARAMETER) {</span>
<a href="#l27.112"></a><span id="l27.112" class="difflineplus">+        icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, </span>
<a href="#l27.113"></a><span id="l27.113" class="difflineplus">+                     icalparameter_get_iana_name(param));</span>
<a href="#l27.114"></a><span id="l27.114">     } else {</span>
<a href="#l27.115"></a><span id="l27.115"> </span>
<a href="#l27.116"></a><span id="l27.116"> 	kind_string = icalparameter_kind_to_string(param-&gt;kind);</span>
<a href="#l27.117"></a><span id="l27.117"> 	</span>
<a href="#l27.118"></a><span id="l27.118"> 	if (param-&gt;kind == ICAL_NO_PARAMETER || </span>
<a href="#l27.119"></a><span id="l27.119"> 	    param-&gt;kind == ICAL_ANY_PARAMETER || </span>
<a href="#l27.120"></a><span id="l27.120"> 	    kind_string == 0)</span>
<a href="#l27.121"></a><span id="l27.121"> 	{</span>
<a href="#l27.122"></a><span id="l27.122"> 	    icalerror_set_errno(ICAL_BADARG_ERROR);</span>
<a href="#l27.123"></a><span id="l27.123" class="difflineplus">+	    free(buf);</span>
<a href="#l27.124"></a><span id="l27.124"> 	    return 0;</span>
<a href="#l27.125"></a><span id="l27.125"> 	}</span>
<a href="#l27.126"></a><span id="l27.126"> 	</span>
<a href="#l27.127"></a><span id="l27.127"> 	</span>
<a href="#l27.128"></a><span id="l27.128"> 	/* Put the parameter name into the string */</span>
<a href="#l27.129"></a><span id="l27.129"> 	icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, kind_string);</span>
<a href="#l27.130"></a><span id="l27.130"> </span>
<a href="#l27.131"></a><span id="l27.131">     }</span>
<a href="#l27.132"></a><span id="l27.132" class="difflineat">@@ -269,16 +281,17 @@ icalparameter_as_ical_string_r(icalparam</span>
<a href="#l27.133"></a><span id="l27.133"> 	if (qm == 1) {</span>
<a href="#l27.134"></a><span id="l27.134"> 		icalmemory_append_char (&amp;buf, &amp;buf_ptr, &amp;buf_size, '&quot;');</span>
<a href="#l27.135"></a><span id="l27.135"> 	}</span>
<a href="#l27.136"></a><span id="l27.136">     } else if (param-&gt;data != 0){</span>
<a href="#l27.137"></a><span id="l27.137">         const char* str = icalparameter_enum_to_string(param-&gt;data);</span>
<a href="#l27.138"></a><span id="l27.138">         icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, str); </span>
<a href="#l27.139"></a><span id="l27.139">     } else {</span>
<a href="#l27.140"></a><span id="l27.140">         icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l27.141"></a><span id="l27.141" class="difflineplus">+	free(buf);</span>
<a href="#l27.142"></a><span id="l27.142">         return 0;</span>
<a href="#l27.143"></a><span id="l27.143">     }</span>
<a href="#l27.144"></a><span id="l27.144"> </span>
<a href="#l27.145"></a><span id="l27.145">     return buf;</span>
<a href="#l27.146"></a><span id="l27.146"> }</span>
<a href="#l27.147"></a><span id="l27.147"> </span>
<a href="#l27.148"></a><span id="l27.148"> </span>
<a href="#l27.149"></a><span id="l27.149"> int</span>
<a href="#l27.150"></a><span id="l27.150" class="difflineat">@@ -360,26 +373,76 @@ icalparameter_set_xvalue (icalparameter*</span>
<a href="#l27.151"></a><span id="l27.151"> const char*</span>
<a href="#l27.152"></a><span id="l27.152"> icalparameter_get_xvalue (icalparameter* param)</span>
<a href="#l27.153"></a><span id="l27.153"> {</span>
<a href="#l27.154"></a><span id="l27.154">     icalerror_check_arg_rz( (param!=0),&quot;param&quot;);</span>
<a href="#l27.155"></a><span id="l27.155"> </span>
<a href="#l27.156"></a><span id="l27.156">     return param-&gt;string;</span>
<a href="#l27.157"></a><span id="l27.157"> }</span>
<a href="#l27.158"></a><span id="l27.158"> </span>
<a href="#l27.159"></a><span id="l27.159" class="difflineplus">+void icalparameter_set_iana_value (icalparameter* param, const char* v)</span>
<a href="#l27.160"></a><span id="l27.160" class="difflineplus">+{</span>
<a href="#l27.161"></a><span id="l27.161" class="difflineplus">+    icalparameter_set_xvalue(param, v);</span>
<a href="#l27.162"></a><span id="l27.162" class="difflineplus">+}</span>
<a href="#l27.163"></a><span id="l27.163" class="difflineplus">+</span>
<a href="#l27.164"></a><span id="l27.164" class="difflineplus">+const char* icalparameter_get_iana_value(icalparameter* param)</span>
<a href="#l27.165"></a><span id="l27.165" class="difflineplus">+{</span>
<a href="#l27.166"></a><span id="l27.166" class="difflineplus">+    return icalparameter_get_xvalue(param);</span>
<a href="#l27.167"></a><span id="l27.167" class="difflineplus">+}</span>
<a href="#l27.168"></a><span id="l27.168" class="difflineplus">+</span>
<a href="#l27.169"></a><span id="l27.169" class="difflineplus">+void icalparameter_set_iana_name (icalparameter* param, const char* v)</span>
<a href="#l27.170"></a><span id="l27.170" class="difflineplus">+{</span>
<a href="#l27.171"></a><span id="l27.171" class="difflineplus">+    icalparameter_set_xname(param, v);</span>
<a href="#l27.172"></a><span id="l27.172" class="difflineplus">+}</span>
<a href="#l27.173"></a><span id="l27.173" class="difflineplus">+</span>
<a href="#l27.174"></a><span id="l27.174" class="difflineplus">+const char* icalparameter_get_iana_name (icalparameter* param)</span>
<a href="#l27.175"></a><span id="l27.175" class="difflineplus">+{</span>
<a href="#l27.176"></a><span id="l27.176" class="difflineplus">+    return icalparameter_get_xname(param);</span>
<a href="#l27.177"></a><span id="l27.177" class="difflineplus">+}</span>
<a href="#l27.178"></a><span id="l27.178" class="difflineplus">+</span>
<a href="#l27.179"></a><span id="l27.179"> void icalparameter_set_parent(icalparameter* param,</span>
<a href="#l27.180"></a><span id="l27.180"> 			     icalproperty* property)</span>
<a href="#l27.181"></a><span id="l27.181"> {</span>
<a href="#l27.182"></a><span id="l27.182">     icalerror_check_arg_rv( (param!=0),&quot;param&quot;);</span>
<a href="#l27.183"></a><span id="l27.183"> </span>
<a href="#l27.184"></a><span id="l27.184">     param-&gt;parent = property;</span>
<a href="#l27.185"></a><span id="l27.185"> }</span>
<a href="#l27.186"></a><span id="l27.186"> </span>
<a href="#l27.187"></a><span id="l27.187"> icalproperty* icalparameter_get_parent(icalparameter* param)</span>
<a href="#l27.188"></a><span id="l27.188"> {</span>
<a href="#l27.189"></a><span id="l27.189">     icalerror_check_arg_rz( (param!=0),&quot;param&quot;);</span>
<a href="#l27.190"></a><span id="l27.190"> </span>
<a href="#l27.191"></a><span id="l27.191">     return param-&gt;parent;</span>
<a href="#l27.192"></a><span id="l27.192"> }</span>
<a href="#l27.193"></a><span id="l27.193"> </span>
<a href="#l27.194"></a><span id="l27.194" class="difflineplus">+/* returns 1 if parameters have same name in ICAL, otherwise 0 */</span>
<a href="#l27.195"></a><span id="l27.195" class="difflineplus">+int icalparameter_has_same_name(icalparameter* param1, icalparameter* param2)</span>
<a href="#l27.196"></a><span id="l27.196" class="difflineplus">+{</span>
<a href="#l27.197"></a><span id="l27.197" class="difflineplus">+    icalparameter_kind kind1;</span>
<a href="#l27.198"></a><span id="l27.198" class="difflineplus">+    icalparameter_kind kind2;</span>
<a href="#l27.199"></a><span id="l27.199" class="difflineplus">+    const char *name1;</span>
<a href="#l27.200"></a><span id="l27.200" class="difflineplus">+    const char *name2;</span>
<a href="#l27.201"></a><span id="l27.201" class="difflineplus">+</span>
<a href="#l27.202"></a><span id="l27.202" class="difflineplus">+    icalerror_check_arg_rz( (param1!=0),&quot;param1&quot;);</span>
<a href="#l27.203"></a><span id="l27.203" class="difflineplus">+    icalerror_check_arg_rz( (param2!=0),&quot;param2&quot;);</span>
<a href="#l27.204"></a><span id="l27.204" class="difflineplus">+</span>
<a href="#l27.205"></a><span id="l27.205" class="difflineplus">+    kind1 = icalparameter_isa(param1);</span>
<a href="#l27.206"></a><span id="l27.206" class="difflineplus">+    kind2 = icalparameter_isa(param2);</span>
<a href="#l27.207"></a><span id="l27.207" class="difflineplus">+</span>
<a href="#l27.208"></a><span id="l27.208" class="difflineplus">+    if (kind1 != kind2)</span>
<a href="#l27.209"></a><span id="l27.209" class="difflineplus">+        return 0;</span>
<a href="#l27.210"></a><span id="l27.210" class="difflineplus">+</span>
<a href="#l27.211"></a><span id="l27.211" class="difflineplus">+    if  (kind1 == ICAL_X_PARAMETER) {</span>
<a href="#l27.212"></a><span id="l27.212" class="difflineplus">+        name1 = icalparameter_get_xname(param1);</span>
<a href="#l27.213"></a><span id="l27.213" class="difflineplus">+        name2 = icalparameter_get_xname(param2);</span>
<a href="#l27.214"></a><span id="l27.214" class="difflineplus">+        if (strcasecmp(name1, name2) != 0)</span>
<a href="#l27.215"></a><span id="l27.215" class="difflineplus">+            return 0;</span>
<a href="#l27.216"></a><span id="l27.216" class="difflineplus">+    } else if  (kind1 == ICAL_IANA_PARAMETER) {</span>
<a href="#l27.217"></a><span id="l27.217" class="difflineplus">+        name1 = icalparameter_get_iana_name(param1);</span>
<a href="#l27.218"></a><span id="l27.218" class="difflineplus">+        name2 = icalparameter_get_iana_name(param2);</span>
<a href="#l27.219"></a><span id="l27.219" class="difflineplus">+        if (strcasecmp(name1, name2) != 0)</span>
<a href="#l27.220"></a><span id="l27.220" class="difflineplus">+            return 0;</span>
<a href="#l27.221"></a><span id="l27.221" class="difflineplus">+    }</span>
<a href="#l27.222"></a><span id="l27.222" class="difflineplus">+	return 1;</span>
<a href="#l27.223"></a><span id="l27.223" class="difflineplus">+}</span>
<a href="#l27.224"></a><span id="l27.224"> </span>
<a href="#l27.225"></a><span id="l27.225"> /* Everything below this line is machine generated. Do not edit. */</span>
<a href="#l27.226"></a><span id="l27.226"> /* ALTREP */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/libical/src/libical/icalparameter.h</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalparameter.h</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -50,22 +50,31 @@ char* icalparameter_as_ical_string(icalp</span>
<a href="#l28.4"></a><span id="l28.4"> char* icalparameter_as_ical_string_r(icalparameter* parameter);</span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6"> int icalparameter_is_valid(icalparameter* parameter);</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8"> icalparameter_kind icalparameter_isa(icalparameter* parameter);</span>
<a href="#l28.9"></a><span id="l28.9"> </span>
<a href="#l28.10"></a><span id="l28.10"> int icalparameter_isa_parameter(void* param);</span>
<a href="#l28.11"></a><span id="l28.11"> </span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-/* Access the name of an X parameer */</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+/* Access the name of an X parameter */</span>
<a href="#l28.14"></a><span id="l28.14"> void icalparameter_set_xname (icalparameter* param, const char* v);</span>
<a href="#l28.15"></a><span id="l28.15"> const char* icalparameter_get_xname(icalparameter* param);</span>
<a href="#l28.16"></a><span id="l28.16"> void icalparameter_set_xvalue (icalparameter* param, const char* v);</span>
<a href="#l28.17"></a><span id="l28.17"> const char* icalparameter_get_xvalue(icalparameter* param);</span>
<a href="#l28.18"></a><span id="l28.18"> </span>
<a href="#l28.19"></a><span id="l28.19" class="difflineplus">+/* Access the name of an IANA parameter */</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineplus">+void icalparameter_set_iana_name (icalparameter* param, const char* v);</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineplus">+const char* icalparameter_get_iana_name(icalparameter* param);</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+void icalparameter_set_iana_value (icalparameter* param, const char* v);</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineplus">+const char* icalparameter_get_iana_value(icalparameter* param);</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineplus">+</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineplus">+/* returns 1 if parameters have same name in ICAL, otherwise 0 */</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineplus">+int icalparameter_has_same_name(icalparameter* param1, icalparameter* param2);</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineplus">+</span>
<a href="#l28.28"></a><span id="l28.28"> /* Convert enumerations */</span>
<a href="#l28.29"></a><span id="l28.29"> </span>
<a href="#l28.30"></a><span id="l28.30"> const char* icalparameter_kind_to_string(icalparameter_kind kind);</span>
<a href="#l28.31"></a><span id="l28.31"> icalparameter_kind icalparameter_string_to_kind(const char* string);</span>
<a href="#l28.32"></a><span id="l28.32"> </span>
<a href="#l28.33"></a><span id="l28.33"> </span>
<a href="#l28.34"></a><span id="l28.34"> </span>
<a href="#l28.35"></a><span id="l28.35"> #endif </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/libical/src/libical/icalparser.c</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalparser.c</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -50,21 +50,16 @@</span>
<a href="#l29.4"></a><span id="l29.4"> #include &lt;string.h&gt; /* For strncpy &amp; size_t */</span>
<a href="#l29.5"></a><span id="l29.5"> #include &lt;stdio.h&gt; /* For FILE and fgets and snprintf */</span>
<a href="#l29.6"></a><span id="l29.6"> #include &lt;stdlib.h&gt; /* for free */</span>
<a href="#l29.7"></a><span id="l29.7"> #include &lt;ctype.h&gt;</span>
<a href="#l29.8"></a><span id="l29.8"> </span>
<a href="#l29.9"></a><span id="l29.9"> #include &quot;icalmemory.h&quot;</span>
<a href="#l29.10"></a><span id="l29.10"> #include &quot;icalparser.h&quot;</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-#ifdef WIN32</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-#define HAVE_CTYPE_H</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-#define HAVE_ISWSPACE</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-#endif</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-</span>
<a href="#l29.17"></a><span id="l29.17"> #ifdef HAVE_WCTYPE_H</span>
<a href="#l29.18"></a><span id="l29.18"> # include &lt;wctype.h&gt;</span>
<a href="#l29.19"></a><span id="l29.19"> /* Some systems have an imcomplete implementation on wctype (FreeBSD,</span>
<a href="#l29.20"></a><span id="l29.20">  * Darwin). Cope with that. */</span>
<a href="#l29.21"></a><span id="l29.21"> # ifndef HAVE_ISWSPACE</span>
<a href="#l29.22"></a><span id="l29.22"> #  define iswspace        isspace</span>
<a href="#l29.23"></a><span id="l29.23"> # endif</span>
<a href="#l29.24"></a><span id="l29.24"> #else</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineat">@@ -279,16 +274,17 @@ char* parser_get_param_name(char* line, </span>
<a href="#l29.26"></a><span id="l29.26">     }</span>
<a href="#l29.27"></a><span id="l29.27"> </span>
<a href="#l29.28"></a><span id="l29.28">     str = make_segment(line,next);</span>
<a href="#l29.29"></a><span id="l29.29">     *end = next+1;</span>
<a href="#l29.30"></a><span id="l29.30">     if (**end == '&quot;') {</span>
<a href="#l29.31"></a><span id="l29.31">         *end = *end+1;</span>
<a href="#l29.32"></a><span id="l29.32"> 	    next = parser_get_next_char('&quot;',*end,0);</span>
<a href="#l29.33"></a><span id="l29.33"> 	    if (next == 0) {</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineplus">+			free(str);</span>
<a href="#l29.35"></a><span id="l29.35"> 		    return 0;</span>
<a href="#l29.36"></a><span id="l29.36"> 	    }</span>
<a href="#l29.37"></a><span id="l29.37"> </span>
<a href="#l29.38"></a><span id="l29.38"> 	    *buf = *end = make_segment(*end,next);</span>
<a href="#l29.39"></a><span id="l29.39">     }</span>
<a href="#l29.40"></a><span id="l29.40"> </span>
<a href="#l29.41"></a><span id="l29.41">     return str;</span>
<a href="#l29.42"></a><span id="l29.42"> }</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineat">@@ -741,21 +737,17 @@ icalcomponent* icalparser_add_line(icalp</span>
<a href="#l29.44"></a><span id="l29.44">         if (comp_kind == ICAL_NO_COMPONENT){</span>
<a href="#l29.45"></a><span id="l29.45"> </span>
<a href="#l29.46"></a><span id="l29.46"> </span>
<a href="#l29.47"></a><span id="l29.47"> 	    c = icalcomponent_new(ICAL_XLICINVALID_COMPONENT);</span>
<a href="#l29.48"></a><span id="l29.48"> 	    insert_error(c,str,&quot;Parse error in component name&quot;,</span>
<a href="#l29.49"></a><span id="l29.49"> 			 ICAL_XLICERRORTYPE_COMPONENTPARSEERROR);</span>
<a href="#l29.50"></a><span id="l29.50">         }</span>
<a href="#l29.51"></a><span id="l29.51"> </span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-	if (comp_kind != ICAL_X_COMPONENT) {</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-	    c  =  icalcomponent_new(comp_kind);</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-	} else {</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-	    c  =  icalcomponent_new_x(str);</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-	}</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineplus">+	c  =  icalcomponent_new(comp_kind);</span>
<a href="#l29.58"></a><span id="l29.58"> </span>
<a href="#l29.59"></a><span id="l29.59"> 	if (c == 0){</span>
<a href="#l29.60"></a><span id="l29.60"> 	    c = icalcomponent_new(ICAL_XLICINVALID_COMPONENT);</span>
<a href="#l29.61"></a><span id="l29.61"> 	    insert_error(c,str,&quot;Parse error in component name&quot;,</span>
<a href="#l29.62"></a><span id="l29.62"> 			 ICAL_XLICERRORTYPE_COMPONENTPARSEERROR);</span>
<a href="#l29.63"></a><span id="l29.63"> 	}</span>
<a href="#l29.64"></a><span id="l29.64"> 	    </span>
<a href="#l29.65"></a><span id="l29.65"> 	pvl_push(parser-&gt;components,c);</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineat">@@ -901,23 +893,35 @@ icalcomponent* icalparser_add_line(icalp</span>
<a href="#l29.67"></a><span id="l29.67"> 		tail = 0;</span>
<a href="#l29.68"></a><span id="l29.68"> 		break;</span>
<a href="#l29.69"></a><span id="l29.69"> 	    }</span>
<a href="#l29.70"></a><span id="l29.70"> </span>
<a href="#l29.71"></a><span id="l29.71"> 	    kind = icalparameter_string_to_kind(name);</span>
<a href="#l29.72"></a><span id="l29.72"> </span>
<a href="#l29.73"></a><span id="l29.73"> 	    if(kind == ICAL_X_PARAMETER){</span>
<a href="#l29.74"></a><span id="l29.74"> 		param = icalparameter_new(ICAL_X_PARAMETER);</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineminus">-		</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineminus">-		if(param != 0){</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineminus">-		    icalparameter_set_xname(param,name);</span>
<a href="#l29.78"></a><span id="l29.78" class="difflineminus">-		    icalparameter_set_xvalue(param,pvalue);</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineminus">-		}</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineminus">-		icalmemory_free_buffer(buf_value);</span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-		buf_value = NULL;</span>
<a href="#l29.82"></a><span id="l29.82" class="difflineplus">+            if(param != 0){</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineplus">+                icalparameter_set_xname(param,name);</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineplus">+                icalparameter_set_xvalue(param,pvalue);</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineplus">+            }</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineplus">+            icalmemory_free_buffer(buf_value);</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineplus">+            buf_value = NULL;</span>
<a href="#l29.88"></a><span id="l29.88" class="difflineplus">+	    } else if (kind == ICAL_IANA_PARAMETER){</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineplus">+            ical_unknown_token_handling tokHandlingSetting = </span>
<a href="#l29.90"></a><span id="l29.90" class="difflineplus">+                ical_get_unknown_token_handling_setting();</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineplus">+            if (tokHandlingSetting == ICAL_DISCARD_TOKEN)</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineplus">+                continue;</span>
<a href="#l29.93"></a><span id="l29.93" class="difflineplus">+            param = icalparameter_new(ICAL_IANA_PARAMETER);</span>
<a href="#l29.94"></a><span id="l29.94" class="difflineplus">+            </span>
<a href="#l29.95"></a><span id="l29.95" class="difflineplus">+            if(param != 0){</span>
<a href="#l29.96"></a><span id="l29.96" class="difflineplus">+                icalparameter_set_xname(param,name);</span>
<a href="#l29.97"></a><span id="l29.97" class="difflineplus">+                icalparameter_set_xvalue(param,pvalue);</span>
<a href="#l29.98"></a><span id="l29.98" class="difflineplus">+            }</span>
<a href="#l29.99"></a><span id="l29.99" class="difflineplus">+            icalmemory_free_buffer(buf_value);</span>
<a href="#l29.100"></a><span id="l29.100" class="difflineplus">+            buf_value = NULL;</span>
<a href="#l29.101"></a><span id="l29.101"> </span>
<a href="#l29.102"></a><span id="l29.102"> 	    } else if (kind != ICAL_NO_PARAMETER){</span>
<a href="#l29.103"></a><span id="l29.103"> 		param = icalparameter_new_from_value_string(kind,pvalue);</span>
<a href="#l29.104"></a><span id="l29.104"> </span>
<a href="#l29.105"></a><span id="l29.105"> 		icalmemory_free_buffer(buf_value);</span>
<a href="#l29.106"></a><span id="l29.106"> 		buf_value = NULL;</span>
<a href="#l29.107"></a><span id="l29.107"> </span>
<a href="#l29.108"></a><span id="l29.108"> 	    } else {</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineat">@@ -985,17 +989,16 @@ icalcomponent* icalparser_add_line(icalp</span>
<a href="#l29.110"></a><span id="l29.110"> 		    /* Ooops, could not parse the value of the</span>
<a href="#l29.111"></a><span id="l29.111"> 		       parameter ( it was not one of the defined</span>
<a href="#l29.112"></a><span id="l29.112"> 		       values ), so reset the value_kind */</span>
<a href="#l29.113"></a><span id="l29.113"> 			</span>
<a href="#l29.114"></a><span id="l29.114"> 		    insert_error(</span>
<a href="#l29.115"></a><span id="l29.115"> 			tail, str, </span>
<a href="#l29.116"></a><span id="l29.116"> 			&quot;Got a VALUE parameter with an unknown type&quot;,</span>
<a href="#l29.117"></a><span id="l29.117"> 			ICAL_XLICERRORTYPE_PARAMETERVALUEPARSEERROR);</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineminus">-		    icalparameter_free(param);</span>
<a href="#l29.119"></a><span id="l29.119"> 			</span>
<a href="#l29.120"></a><span id="l29.120"> 		    value_kind = </span>
<a href="#l29.121"></a><span id="l29.121"> 			icalproperty_kind_to_value_kind(</span>
<a href="#l29.122"></a><span id="l29.122"> 			    icalproperty_isa(prop));</span>
<a href="#l29.123"></a><span id="l29.123"> 			</span>
<a href="#l29.124"></a><span id="l29.124"> 		    icalparameter_free(param);</span>
<a href="#l29.125"></a><span id="l29.125"> 		    tail = 0;</span>
<a href="#l29.126"></a><span id="l29.126"> 		    parser-&gt;state = ICALPARSER_ERROR;</span>
<a href="#l29.127"></a><span id="l29.127" class="difflineat">@@ -1107,31 +1110,39 @@ icalcomponent* icalparser_add_line(icalp</span>
<a href="#l29.128"></a><span id="l29.128"> 	    } else {</span>
<a href="#l29.129"></a><span id="l29.129"> 		vcount++;</span>
<a href="#l29.130"></a><span id="l29.130"> 		icalproperty_set_value(prop, value);</span>
<a href="#l29.131"></a><span id="l29.131"> 	    }</span>
<a href="#l29.132"></a><span id="l29.132">  	    icalmemory_free_buffer(str);</span>
<a href="#l29.133"></a><span id="l29.133"> 	    str = NULL;</span>
<a href="#l29.134"></a><span id="l29.134"> </span>
<a href="#l29.135"></a><span id="l29.135"> 	} else {</span>
<a href="#l29.136"></a><span id="l29.136" class="difflineminus">-		if (str != NULL) {</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineminus">-			icalmemory_free_buffer(str);</span>
<a href="#l29.138"></a><span id="l29.138" class="difflineminus">-			str = NULL;</span>
<a href="#l29.139"></a><span id="l29.139" class="difflineminus">-		}</span>
<a href="#l29.140"></a><span id="l29.140" class="difflineminus">-			</span>
<a href="#l29.141"></a><span id="l29.141"> 	    if (vcount == 0){</span>
<a href="#l29.142"></a><span id="l29.142" class="difflineplus">+		char temp[200]; /* HACK */</span>
<a href="#l29.143"></a><span id="l29.143" class="difflineplus">+		</span>
<a href="#l29.144"></a><span id="l29.144" class="difflineplus">+		icalproperty_kind prop_kind = icalproperty_isa(prop);</span>
<a href="#l29.145"></a><span id="l29.145"> 		icalcomponent *tail = pvl_data(pvl_tail(parser-&gt;components));</span>
<a href="#l29.146"></a><span id="l29.146"> 		</span>
<a href="#l29.147"></a><span id="l29.147" class="difflineminus">-		/* Remove the empty property */</span>
<a href="#l29.148"></a><span id="l29.148" class="difflineplus">+		snprintf(temp,sizeof(temp),&quot;No value for %s property. Removing entire property&quot;,</span>
<a href="#l29.149"></a><span id="l29.149" class="difflineplus">+			icalproperty_kind_to_string(prop_kind));</span>
<a href="#l29.150"></a><span id="l29.150" class="difflineplus">+</span>
<a href="#l29.151"></a><span id="l29.151" class="difflineplus">+		insert_error(tail, str, temp,</span>
<a href="#l29.152"></a><span id="l29.152" class="difflineplus">+			     ICAL_XLICERRORTYPE_VALUEPARSEERROR);</span>
<a href="#l29.153"></a><span id="l29.153" class="difflineplus">+</span>
<a href="#l29.154"></a><span id="l29.154" class="difflineplus">+		/* Remove the troublesome property */</span>
<a href="#l29.155"></a><span id="l29.155"> 		icalcomponent_remove_property(tail,prop);</span>
<a href="#l29.156"></a><span id="l29.156"> 		icalproperty_free(prop);</span>
<a href="#l29.157"></a><span id="l29.157" class="difflineminus">-		prop = NULL;</span>
<a href="#l29.158"></a><span id="l29.158" class="difflineplus">+		prop = 0;</span>
<a href="#l29.159"></a><span id="l29.159" class="difflineplus">+		tail = 0;</span>
<a href="#l29.160"></a><span id="l29.160" class="difflineplus">+		parser-&gt;state = ICALPARSER_ERROR;</span>
<a href="#l29.161"></a><span id="l29.161" class="difflineplus">+		return 0;</span>
<a href="#l29.162"></a><span id="l29.162" class="difflineplus">+	    } else {</span>
<a href="#l29.163"></a><span id="l29.163" class="difflineplus">+</span>
<a href="#l29.164"></a><span id="l29.164" class="difflineplus">+		break;</span>
<a href="#l29.165"></a><span id="l29.165"> 	    }</span>
<a href="#l29.166"></a><span id="l29.166" class="difflineminus">-</span>
<a href="#l29.167"></a><span id="l29.167" class="difflineminus">-        break;</span>
<a href="#l29.168"></a><span id="l29.168"> 	}</span>
<a href="#l29.169"></a><span id="l29.169">     }</span>
<a href="#l29.170"></a><span id="l29.170"> 	</span>
<a href="#l29.171"></a><span id="l29.171">     /****************************************************************</span>
<a href="#l29.172"></a><span id="l29.172">      * End of component parsing. </span>
<a href="#l29.173"></a><span id="l29.173">      *****************************************************************/</span>
<a href="#l29.174"></a><span id="l29.174"> </span>
<a href="#l29.175"></a><span id="l29.175">     if (pvl_data(pvl_tail(parser-&gt;components)) == 0 &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/libical/src/libical/icalperiod.c</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalperiod.c</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -112,18 +112,18 @@ const char* icalperiodtype_as_ical_strin</span>
<a href="#l30.4"></a><span id="l30.4"> 	icalmemory_add_tmp_buffer(buf);</span>
<a href="#l30.5"></a><span id="l30.5"> 	return buf;</span>
<a href="#l30.6"></a><span id="l30.6"> }</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> </span>
<a href="#l30.9"></a><span id="l30.9"> char* icalperiodtype_as_ical_string_r(struct icalperiodtype p)</span>
<a href="#l30.10"></a><span id="l30.10"> {</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    const char* start;</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-    const char* end;</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+    char* start;</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+    char* end;</span>
<a href="#l30.16"></a><span id="l30.16"> </span>
<a href="#l30.17"></a><span id="l30.17">     char *buf;</span>
<a href="#l30.18"></a><span id="l30.18">     size_t buf_size = 40;</span>
<a href="#l30.19"></a><span id="l30.19">     char* buf_ptr = 0;</span>
<a href="#l30.20"></a><span id="l30.20"> </span>
<a href="#l30.21"></a><span id="l30.21">     buf = (char*)icalmemory_new_buffer(buf_size);</span>
<a href="#l30.22"></a><span id="l30.22">     buf_ptr = buf;</span>
<a href="#l30.23"></a><span id="l30.23">     </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/libical/src/libical/icalproperty.c</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalproperty.c</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -169,35 +169,39 @@ icalproperty_new_clone(icalproperty* old</span>
<a href="#l31.4"></a><span id="l31.4">     return new;</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6"> }</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8"> icalproperty* icalproperty_new_from_string(const char* str)</span>
<a href="#l31.9"></a><span id="l31.9"> {</span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11">     size_t buf_size = 1024;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    char* buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-    char* buf_ptr = buf;  </span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+    char* buf;</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+    char* buf_ptr;</span>
<a href="#l31.16"></a><span id="l31.16">     icalproperty *prop;</span>
<a href="#l31.17"></a><span id="l31.17">     icalcomponent *comp;</span>
<a href="#l31.18"></a><span id="l31.18">     int errors  = 0;</span>
<a href="#l31.19"></a><span id="l31.19"> </span>
<a href="#l31.20"></a><span id="l31.20">     icalerror_check_arg_rz( (str!=0),&quot;str&quot;);</span>
<a href="#l31.21"></a><span id="l31.21"> </span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+    buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+    buf_ptr = buf;</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineplus">+</span>
<a href="#l31.25"></a><span id="l31.25">     /* Is this a HACK or a crafty reuse of code? */</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27">     icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, &quot;BEGIN:VCALENDAR\r\n&quot;);</span>
<a href="#l31.28"></a><span id="l31.28">     icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, str);</span>
<a href="#l31.29"></a><span id="l31.29">     icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, &quot;\r\n&quot;);    </span>
<a href="#l31.30"></a><span id="l31.30">     icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, &quot;END:VCALENDAR\r\n&quot;);</span>
<a href="#l31.31"></a><span id="l31.31"> </span>
<a href="#l31.32"></a><span id="l31.32">     comp = icalparser_parse_string(buf);</span>
<a href="#l31.33"></a><span id="l31.33"> </span>
<a href="#l31.34"></a><span id="l31.34">     if(comp == 0){</span>
<a href="#l31.35"></a><span id="l31.35">         icalerror_set_errno(ICAL_PARSE_ERROR);</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineplus">+        free(buf);</span>
<a href="#l31.37"></a><span id="l31.37">         return 0;</span>
<a href="#l31.38"></a><span id="l31.38">     }</span>
<a href="#l31.39"></a><span id="l31.39"> </span>
<a href="#l31.40"></a><span id="l31.40">     errors = icalcomponent_count_errors(comp);</span>
<a href="#l31.41"></a><span id="l31.41"> </span>
<a href="#l31.42"></a><span id="l31.42">     prop = icalcomponent_get_first_property(comp,ICAL_ANY_PROPERTY);</span>
<a href="#l31.43"></a><span id="l31.43"> </span>
<a href="#l31.44"></a><span id="l31.44">     icalcomponent_remove_property(comp,prop);</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineat">@@ -268,16 +272,26 @@ get_next_line_start (char *line_start, i</span>
<a href="#l31.46"></a><span id="l31.46">     char *pos;</span>
<a href="#l31.47"></a><span id="l31.47"> </span>
<a href="#l31.48"></a><span id="l31.48">     /* If we have 74 chars or less left, we can output all of them. </span>
<a href="#l31.49"></a><span id="l31.49">        we return a pointer to the '\0' at the end of the string. */</span>
<a href="#l31.50"></a><span id="l31.50">     if (chars_left &lt; MAX_LINE_LEN) {</span>
<a href="#l31.51"></a><span id="l31.51">         return line_start + chars_left;</span>
<a href="#l31.52"></a><span id="l31.52">     } </span>
<a href="#l31.53"></a><span id="l31.53"> </span>
<a href="#l31.54"></a><span id="l31.54" class="difflineplus">+    /* Now we jump to the last possible character of the line, and step back</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+       trying to find a ';' ':' or ' '. If we find one, we return the character</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineplus">+       after it. */</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineplus">+    pos = line_start + MAX_LINE_LEN - 2;</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineplus">+    while (pos &gt; line_start) {</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineplus">+        if (*pos == ';' || *pos == ':' || *pos == ' ') {</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineplus">+	    return pos + 1;</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineplus">+	}</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineplus">+	pos--;</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineplus">+    }</span>
<a href="#l31.64"></a><span id="l31.64">     /* Now try to split on a UTF-8 boundary defined as a 7-bit</span>
<a href="#l31.65"></a><span id="l31.65">        value or as a byte with the two high-most bits set:</span>
<a href="#l31.66"></a><span id="l31.66">        11xxxxxx.  See http://czyborra.com/utf/ */</span>
<a href="#l31.67"></a><span id="l31.67"> </span>
<a href="#l31.68"></a><span id="l31.68">     pos = line_start + MAX_LINE_LEN - 1;</span>
<a href="#l31.69"></a><span id="l31.69">     while (pos &gt; line_start) {</span>
<a href="#l31.70"></a><span id="l31.70">         /* plain ascii */</span>
<a href="#l31.71"></a><span id="l31.71">         if ((*pos &amp; 128) == 0)</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineat">@@ -302,17 +316,17 @@ get_next_line_start (char *line_start, i</span>
<a href="#l31.73"></a><span id="l31.73">  *  It returns a tmp buffer.  NOTE: I'm not sure if it matters if we</span>
<a href="#l31.74"></a><span id="l31.74">  *  split a line in the middle of a UTF-8 character. It probably won't</span>
<a href="#l31.75"></a><span id="l31.75">  *  look nice in a text editor. </span>
<a href="#l31.76"></a><span id="l31.76">  */</span>
<a href="#l31.77"></a><span id="l31.77"> static char*</span>
<a href="#l31.78"></a><span id="l31.78"> fold_property_line (char *text)</span>
<a href="#l31.79"></a><span id="l31.79"> {</span>
<a href="#l31.80"></a><span id="l31.80">     size_t buf_size;</span>
<a href="#l31.81"></a><span id="l31.81" class="difflineminus">-    char *buf, *buf_ptr, *line_start, *next_line_start, *out_buf;</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineplus">+    char *buf, *buf_ptr, *line_start, *next_line_start;</span>
<a href="#l31.83"></a><span id="l31.83">     int len, chars_left, first_line;</span>
<a href="#l31.84"></a><span id="l31.84">     char ch;</span>
<a href="#l31.85"></a><span id="l31.85"> </span>
<a href="#l31.86"></a><span id="l31.86">     /* Start with a buffer twice the size of our property line, so we almost</span>
<a href="#l31.87"></a><span id="l31.87">        certainly won't overflow it. */</span>
<a href="#l31.88"></a><span id="l31.88">     len = strlen (text);</span>
<a href="#l31.89"></a><span id="l31.89">     buf_size = len * 2;</span>
<a href="#l31.90"></a><span id="l31.90">     buf = icalmemory_new_buffer (buf_size);</span>
<a href="#l31.91"></a><span id="l31.91" class="difflineat">@@ -417,26 +431,28 @@ icalproperty_as_ical_string_r(icalproper</span>
<a href="#l31.92"></a><span id="l31.92">     icalparameter *param;</span>
<a href="#l31.93"></a><span id="l31.93"> </span>
<a href="#l31.94"></a><span id="l31.94">     /* Create new buffer that we can append names, parameters and a</span>
<a href="#l31.95"></a><span id="l31.95">      * value to, and reallocate as needed.</span>
<a href="#l31.96"></a><span id="l31.96">      */</span>
<a href="#l31.97"></a><span id="l31.97"> </span>
<a href="#l31.98"></a><span id="l31.98">     const char* property_name = 0; </span>
<a href="#l31.99"></a><span id="l31.99">     size_t buf_size = 1024;</span>
<a href="#l31.100"></a><span id="l31.100" class="difflineminus">-    char* buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l31.101"></a><span id="l31.101" class="difflineminus">-    char* buf_ptr = buf;</span>
<a href="#l31.102"></a><span id="l31.102" class="difflineplus">+    char* buf;</span>
<a href="#l31.103"></a><span id="l31.103" class="difflineplus">+    char* buf_ptr;</span>
<a href="#l31.104"></a><span id="l31.104">     icalvalue* value;</span>
<a href="#l31.105"></a><span id="l31.105">     char *out_buf;</span>
<a href="#l31.106"></a><span id="l31.106">     const char* kind_string = 0;</span>
<a href="#l31.107"></a><span id="l31.107">     const char newline[] = &quot;\r\n&quot;;</span>
<a href="#l31.108"></a><span id="l31.108"> </span>
<a href="#l31.109"></a><span id="l31.109">     </span>
<a href="#l31.110"></a><span id="l31.110">     icalerror_check_arg_rz( (prop!=0),&quot;prop&quot;);</span>
<a href="#l31.111"></a><span id="l31.111"> </span>
<a href="#l31.112"></a><span id="l31.112" class="difflineplus">+    buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l31.113"></a><span id="l31.113" class="difflineplus">+    buf_ptr = buf;</span>
<a href="#l31.114"></a><span id="l31.114"> </span>
<a href="#l31.115"></a><span id="l31.115">     /* Append property name */</span>
<a href="#l31.116"></a><span id="l31.116"> </span>
<a href="#l31.117"></a><span id="l31.117">     if (prop-&gt;kind == ICAL_X_PROPERTY &amp;&amp; prop-&gt;x_name != 0){</span>
<a href="#l31.118"></a><span id="l31.118"> 	property_name = prop-&gt;x_name;</span>
<a href="#l31.119"></a><span id="l31.119">     } else {</span>
<a href="#l31.120"></a><span id="l31.120"> 	property_name = icalproperty_kind_to_string(prop-&gt;kind);</span>
<a href="#l31.121"></a><span id="l31.121">     }</span>
<a href="#l31.122"></a><span id="l31.122" class="difflineat">@@ -484,18 +500,20 @@ icalproperty_as_ical_string_r(icalproper</span>
<a href="#l31.123"></a><span id="l31.123">     /* Append value */</span>
<a href="#l31.124"></a><span id="l31.124"> </span>
<a href="#l31.125"></a><span id="l31.125">     icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, &quot;:&quot;);</span>
<a href="#l31.126"></a><span id="l31.126"> </span>
<a href="#l31.127"></a><span id="l31.127">     value = icalproperty_get_value(prop);</span>
<a href="#l31.128"></a><span id="l31.128"> </span>
<a href="#l31.129"></a><span id="l31.129">     if (value != 0){</span>
<a href="#l31.130"></a><span id="l31.130"> 	char *str = icalvalue_as_ical_string_r(value);</span>
<a href="#l31.131"></a><span id="l31.131" class="difflineminus">-	icalerror_assert((str !=0),&quot;Could not get string representation of a value&quot;);</span>
<a href="#l31.132"></a><span id="l31.132" class="difflineminus">-	icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, str);</span>
<a href="#l31.133"></a><span id="l31.133" class="difflineplus">+	if (str != 0)</span>
<a href="#l31.134"></a><span id="l31.134" class="difflineplus">+	    icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, str);</span>
<a href="#l31.135"></a><span id="l31.135" class="difflineplus">+	else</span>
<a href="#l31.136"></a><span id="l31.136" class="difflineplus">+	    icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size,&quot;ERROR: No Value&quot;); </span>
<a href="#l31.137"></a><span id="l31.137"> 	free(str);</span>
<a href="#l31.138"></a><span id="l31.138">     } else {</span>
<a href="#l31.139"></a><span id="l31.139"> 	icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size,&quot;ERROR: No Value&quot;); </span>
<a href="#l31.140"></a><span id="l31.140"> 	</span>
<a href="#l31.141"></a><span id="l31.141">     }</span>
<a href="#l31.142"></a><span id="l31.142">     </span>
<a href="#l31.143"></a><span id="l31.143">     icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, newline);</span>
<a href="#l31.144"></a><span id="l31.144"> </span>
<a href="#l31.145"></a><span id="l31.145" class="difflineat">@@ -548,21 +566,25 @@ void</span>
<a href="#l31.146"></a><span id="l31.146"> icalproperty_set_parameter (icalproperty* prop,icalparameter* parameter)</span>
<a href="#l31.147"></a><span id="l31.147"> {</span>
<a href="#l31.148"></a><span id="l31.148">     icalparameter_kind kind;</span>
<a href="#l31.149"></a><span id="l31.149">     </span>
<a href="#l31.150"></a><span id="l31.150">     icalerror_check_arg_rv( (prop!=0),&quot;prop&quot;);</span>
<a href="#l31.151"></a><span id="l31.151">     icalerror_check_arg_rv( (parameter!=0),&quot;parameter&quot;);</span>
<a href="#l31.152"></a><span id="l31.152"> </span>
<a href="#l31.153"></a><span id="l31.153">     kind = icalparameter_isa(parameter);</span>
<a href="#l31.154"></a><span id="l31.154" class="difflineminus">-    if (kind != ICAL_X_PARAMETER)</span>
<a href="#l31.155"></a><span id="l31.155" class="difflineminus">-      icalproperty_remove_parameter_by_kind(prop,kind);</span>
<a href="#l31.156"></a><span id="l31.156" class="difflineminus">-    else</span>
<a href="#l31.157"></a><span id="l31.157" class="difflineplus">+    if (kind == ICAL_X_PARAMETER) {</span>
<a href="#l31.158"></a><span id="l31.158">       icalproperty_remove_parameter_by_name(prop, </span>
<a href="#l31.159"></a><span id="l31.159"> 					    icalparameter_get_xname(parameter));</span>
<a href="#l31.160"></a><span id="l31.160" class="difflineplus">+    } else if (kind == ICAL_IANA_PARAMETER) {</span>
<a href="#l31.161"></a><span id="l31.161" class="difflineplus">+      icalproperty_remove_parameter_by_name(prop, </span>
<a href="#l31.162"></a><span id="l31.162" class="difflineplus">+					    icalparameter_get_iana_name(parameter));</span>
<a href="#l31.163"></a><span id="l31.163" class="difflineplus">+    }</span>
<a href="#l31.164"></a><span id="l31.164" class="difflineplus">+    else</span>
<a href="#l31.165"></a><span id="l31.165" class="difflineplus">+      icalproperty_remove_parameter_by_kind(prop,kind);</span>
<a href="#l31.166"></a><span id="l31.166"> </span>
<a href="#l31.167"></a><span id="l31.167">     icalproperty_add_parameter(prop,parameter);</span>
<a href="#l31.168"></a><span id="l31.168"> }</span>
<a href="#l31.169"></a><span id="l31.169"> </span>
<a href="#l31.170"></a><span id="l31.170"> void icalproperty_set_parameter_from_string(icalproperty* prop,</span>
<a href="#l31.171"></a><span id="l31.171">                                             const char* name, const char* value)</span>
<a href="#l31.172"></a><span id="l31.172"> {</span>
<a href="#l31.173"></a><span id="l31.173"> </span>
<a href="#l31.174"></a><span id="l31.174" class="difflineat">@@ -582,18 +604,20 @@ void icalproperty_set_parameter_from_str</span>
<a href="#l31.175"></a><span id="l31.175">     </span>
<a href="#l31.176"></a><span id="l31.176">     param  = icalparameter_new_from_value_string(kind,value);</span>
<a href="#l31.177"></a><span id="l31.177"> </span>
<a href="#l31.178"></a><span id="l31.178">     if (param == 0){</span>
<a href="#l31.179"></a><span id="l31.179">         icalerror_set_errno(ICAL_BADARG_ERROR);</span>
<a href="#l31.180"></a><span id="l31.180">         return;</span>
<a href="#l31.181"></a><span id="l31.181">     }</span>
<a href="#l31.182"></a><span id="l31.182"> </span>
<a href="#l31.183"></a><span id="l31.183" class="difflineminus">-    if(kind == ICAL_X_PARAMETER){</span>
<a href="#l31.184"></a><span id="l31.184" class="difflineminus">-	icalparameter_set_xname(param, name);</span>
<a href="#l31.185"></a><span id="l31.185" class="difflineplus">+    if (kind == ICAL_X_PARAMETER) {</span>
<a href="#l31.186"></a><span id="l31.186" class="difflineplus">+        icalparameter_set_xname(param, name);</span>
<a href="#l31.187"></a><span id="l31.187" class="difflineplus">+    } else if (kind == ICAL_IANA_PARAMETER) {</span>
<a href="#l31.188"></a><span id="l31.188" class="difflineplus">+        icalparameter_set_iana_name(param, name);</span>
<a href="#l31.189"></a><span id="l31.189">     }</span>
<a href="#l31.190"></a><span id="l31.190"> </span>
<a href="#l31.191"></a><span id="l31.191">     icalproperty_set_parameter(prop,param);</span>
<a href="#l31.192"></a><span id="l31.192"> </span>
<a href="#l31.193"></a><span id="l31.193"> }</span>
<a href="#l31.194"></a><span id="l31.194"> </span>
<a href="#l31.195"></a><span id="l31.195"> const char* icalproperty_get_parameter_as_string(icalproperty* prop,</span>
<a href="#l31.196"></a><span id="l31.196">                                                  const char* name)</span>
<a href="#l31.197"></a><span id="l31.197" class="difflineat">@@ -623,23 +647,29 @@ char* icalproperty_get_parameter_as_stri</span>
<a href="#l31.198"></a><span id="l31.198">     if(kind == ICAL_NO_PARAMETER){</span>
<a href="#l31.199"></a><span id="l31.199">         /* icalenum_string_to_parameter_kind will set icalerrno */</span>
<a href="#l31.200"></a><span id="l31.200">         return 0;</span>
<a href="#l31.201"></a><span id="l31.201">     }</span>
<a href="#l31.202"></a><span id="l31.202">     </span>
<a href="#l31.203"></a><span id="l31.203">     for(param = icalproperty_get_first_parameter(prop,kind); </span>
<a href="#l31.204"></a><span id="l31.204"> 	    param != 0; </span>
<a href="#l31.205"></a><span id="l31.205"> 	    param = icalproperty_get_next_parameter(prop,kind)) {</span>
<a href="#l31.206"></a><span id="l31.206" class="difflineminus">-	    if (kind != ICAL_X_PARAMETER) {</span>
<a href="#l31.207"></a><span id="l31.207" class="difflineminus">-		    break;</span>
<a href="#l31.208"></a><span id="l31.208" class="difflineminus">-	    }</span>
<a href="#l31.209"></a><span id="l31.209"> </span>
<a href="#l31.210"></a><span id="l31.210" class="difflineminus">-	    if (strcmp(icalparameter_get_xname(param),name)==0) {</span>
<a href="#l31.211"></a><span id="l31.211" class="difflineplus">+	    if (kind == ICAL_X_PARAMETER) {</span>
<a href="#l31.212"></a><span id="l31.212" class="difflineplus">+            if (strcmp(icalparameter_get_xname(param),name)==0) {</span>
<a href="#l31.213"></a><span id="l31.213" class="difflineplus">+                break;</span>
<a href="#l31.214"></a><span id="l31.214" class="difflineplus">+            }		</span>
<a href="#l31.215"></a><span id="l31.215" class="difflineplus">+        } else if (kind == ICAL_IANA_PARAMETER) {</span>
<a href="#l31.216"></a><span id="l31.216" class="difflineplus">+            if (strcmp(icalparameter_get_iana_name(param),name)==0) {</span>
<a href="#l31.217"></a><span id="l31.217" class="difflineplus">+                break;</span>
<a href="#l31.218"></a><span id="l31.218" class="difflineplus">+            }		</span>
<a href="#l31.219"></a><span id="l31.219" class="difflineplus">+	    } else {</span>
<a href="#l31.220"></a><span id="l31.220"> 		    break;</span>
<a href="#l31.221"></a><span id="l31.221" class="difflineminus">-	    }		</span>
<a href="#l31.222"></a><span id="l31.222" class="difflineplus">+        }</span>
<a href="#l31.223"></a><span id="l31.223" class="difflineplus">+</span>
<a href="#l31.224"></a><span id="l31.224">     }</span>
<a href="#l31.225"></a><span id="l31.225"> </span>
<a href="#l31.226"></a><span id="l31.226">     if (param == 0){</span>
<a href="#l31.227"></a><span id="l31.227">         return 0;</span>
<a href="#l31.228"></a><span id="l31.228">     }</span>
<a href="#l31.229"></a><span id="l31.229"> </span>
<a href="#l31.230"></a><span id="l31.230"> </span>
<a href="#l31.231"></a><span id="l31.231">     str = icalparameter_as_ical_string_r(param);</span>
<a href="#l31.232"></a><span id="l31.232" class="difflineat">@@ -742,16 +772,18 @@ icalproperty_remove_parameter_by_name(ic</span>
<a href="#l31.233"></a><span id="l31.233">     icalerror_check_arg_rv((prop!=0),&quot;prop&quot;);</span>
<a href="#l31.234"></a><span id="l31.234">     </span>
<a href="#l31.235"></a><span id="l31.235">     for(p=pvl_head(prop-&gt;parameters);p != 0; p = pvl_next(p)){</span>
<a href="#l31.236"></a><span id="l31.236"> 	icalparameter* param = (icalparameter *)pvl_data (p);</span>
<a href="#l31.237"></a><span id="l31.237"> 	const char * kind_string;</span>
<a href="#l31.238"></a><span id="l31.238"> </span>
<a href="#l31.239"></a><span id="l31.239"> 	if (icalparameter_isa(param) == ICAL_X_PARAMETER)</span>
<a href="#l31.240"></a><span id="l31.240"> 	  kind_string = icalparameter_get_xname(param);</span>
<a href="#l31.241"></a><span id="l31.241" class="difflineplus">+    else if (icalparameter_isa(param) == ICAL_IANA_PARAMETER)</span>
<a href="#l31.242"></a><span id="l31.242" class="difflineplus">+	  kind_string = icalparameter_get_iana_name(param);</span>
<a href="#l31.243"></a><span id="l31.243"> 	else</span>
<a href="#l31.244"></a><span id="l31.244"> 	  kind_string = icalparameter_kind_to_string(icalparameter_isa(param));</span>
<a href="#l31.245"></a><span id="l31.245"> </span>
<a href="#l31.246"></a><span id="l31.246"> 	if (!kind_string)</span>
<a href="#l31.247"></a><span id="l31.247"> 	  continue;</span>
<a href="#l31.248"></a><span id="l31.248"> </span>
<a href="#l31.249"></a><span id="l31.249">         if (0 == strcmp(kind_string, name)) {</span>
<a href="#l31.250"></a><span id="l31.250">             pvl_remove (prop-&gt;parameters, p);</span>
<a href="#l31.251"></a><span id="l31.251" class="difflineat">@@ -776,31 +808,25 @@ icalproperty_remove_parameter_by_ref(ica</span>
<a href="#l31.252"></a><span id="l31.252">     pvl_elem p;</span>
<a href="#l31.253"></a><span id="l31.253">     icalparameter_kind kind;</span>
<a href="#l31.254"></a><span id="l31.254">     const char *name;</span>
<a href="#l31.255"></a><span id="l31.255"> </span>
<a href="#l31.256"></a><span id="l31.256">     icalerror_check_arg_rv((prop!=0),&quot;prop&quot;);</span>
<a href="#l31.257"></a><span id="l31.257">     icalerror_check_arg_rv((parameter!=0),&quot;parameter&quot;);</span>
<a href="#l31.258"></a><span id="l31.258"> </span>
<a href="#l31.259"></a><span id="l31.259">     kind = icalparameter_isa(parameter);</span>
<a href="#l31.260"></a><span id="l31.260" class="difflineminus">-    name = icalparameter_get_xname(parameter);</span>
<a href="#l31.261"></a><span id="l31.261"> </span>
<a href="#l31.262"></a><span id="l31.262" class="difflineminus">-    /*</span>
<a href="#l31.263"></a><span id="l31.263" class="difflineminus">-     * FIXME If it's an X- parameter, also compare the names. It would be nice</span>
<a href="#l31.264"></a><span id="l31.264" class="difflineminus">-     * to have a better abstraction like icalparameter_equals()</span>
<a href="#l31.265"></a><span id="l31.265" class="difflineminus">-     */</span>
<a href="#l31.266"></a><span id="l31.266" class="difflineminus">-    for(p=pvl_head(prop-&gt;parameters);p != 0; p = pvl_next(p)){</span>
<a href="#l31.267"></a><span id="l31.267" class="difflineminus">-	icalparameter* p_param = (icalparameter *)pvl_data (p);</span>
<a href="#l31.268"></a><span id="l31.268" class="difflineminus">-	if (icalparameter_isa(p_param) == kind &amp;&amp;</span>
<a href="#l31.269"></a><span id="l31.269" class="difflineminus">-	    (kind != ICAL_X_PARAMETER ||</span>
<a href="#l31.270"></a><span id="l31.270" class="difflineminus">-	    !strcmp(icalparameter_get_xname(p_param), name))) {</span>
<a href="#l31.271"></a><span id="l31.271" class="difflineplus">+    for (p=pvl_head(prop-&gt;parameters);p != 0; p = pvl_next(p)) {</span>
<a href="#l31.272"></a><span id="l31.272" class="difflineplus">+        icalparameter* p_param = (icalparameter *)pvl_data (p);</span>
<a href="#l31.273"></a><span id="l31.273" class="difflineplus">+</span>
<a href="#l31.274"></a><span id="l31.274" class="difflineplus">+        if (icalparameter_has_same_name(parameter, p_param)) {</span>
<a href="#l31.275"></a><span id="l31.275">             pvl_remove (prop-&gt;parameters, p);</span>
<a href="#l31.276"></a><span id="l31.276">             icalparameter_free(p_param);</span>
<a href="#l31.277"></a><span id="l31.277">             break;</span>
<a href="#l31.278"></a><span id="l31.278" class="difflineminus">-	} </span>
<a href="#l31.279"></a><span id="l31.279" class="difflineplus">+        }</span>
<a href="#l31.280"></a><span id="l31.280">     }   </span>
<a href="#l31.281"></a><span id="l31.281"> }</span>
<a href="#l31.282"></a><span id="l31.282"> </span>
<a href="#l31.283"></a><span id="l31.283"> </span>
<a href="#l31.284"></a><span id="l31.284"> int</span>
<a href="#l31.285"></a><span id="l31.285"> icalproperty_count_parameters (const icalproperty* prop)</span>
<a href="#l31.286"></a><span id="l31.286"> {</span>
<a href="#l31.287"></a><span id="l31.287">     if(prop != 0){</span>
<a href="#l31.288"></a><span id="l31.288" class="difflineat">@@ -905,16 +931,17 @@ void icalproperty_set_value_from_string(</span>
<a href="#l31.289"></a><span id="l31.289">         kind = icalvalue_string_to_kind(type);</span>
<a href="#l31.290"></a><span id="l31.290">     }</span>
<a href="#l31.291"></a><span id="l31.291"> </span>
<a href="#l31.292"></a><span id="l31.292">     if(kind == ICAL_NO_VALUE){</span>
<a href="#l31.293"></a><span id="l31.293">         icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l31.294"></a><span id="l31.294">         return;</span>
<a href="#l31.295"></a><span id="l31.295">     }</span>
<a href="#l31.296"></a><span id="l31.296"> </span>
<a href="#l31.297"></a><span id="l31.297" class="difflineplus">+    icalerror_clear_errno();</span>
<a href="#l31.298"></a><span id="l31.298">     nval = icalvalue_new_from_string(kind, str);</span>
<a href="#l31.299"></a><span id="l31.299"> </span>
<a href="#l31.300"></a><span id="l31.300">     if(nval == 0){</span>
<a href="#l31.301"></a><span id="l31.301">         /* icalvalue_new_from_string sets errno */</span>
<a href="#l31.302"></a><span id="l31.302">         assert(icalerrno != ICAL_NO_ERROR);</span>
<a href="#l31.303"></a><span id="l31.303">         return;</span>
<a href="#l31.304"></a><span id="l31.304">     }</span>
<a href="#l31.305"></a><span id="l31.305"> </span>
<a href="#l31.306"></a><span id="l31.306" class="difflineat">@@ -984,29 +1011,33 @@ const char* icalproperty_get_property_na</span>
<a href="#l31.307"></a><span id="l31.307"> }</span>
<a href="#l31.308"></a><span id="l31.308"> </span>
<a href="#l31.309"></a><span id="l31.309"> </span>
<a href="#l31.310"></a><span id="l31.310"> char* icalproperty_get_property_name_r(const icalproperty* prop)</span>
<a href="#l31.311"></a><span id="l31.311"> {</span>
<a href="#l31.312"></a><span id="l31.312"> </span>
<a href="#l31.313"></a><span id="l31.313">     const char* property_name = 0;</span>
<a href="#l31.314"></a><span id="l31.314">     size_t buf_size = 256;</span>
<a href="#l31.315"></a><span id="l31.315" class="difflineminus">-    char* buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l31.316"></a><span id="l31.316" class="difflineminus">-    char* buf_ptr = buf;  </span>
<a href="#l31.317"></a><span id="l31.317" class="difflineplus">+    char* buf;</span>
<a href="#l31.318"></a><span id="l31.318" class="difflineplus">+    char* buf_ptr;</span>
<a href="#l31.319"></a><span id="l31.319"> </span>
<a href="#l31.320"></a><span id="l31.320">     icalerror_check_arg_rz( (prop!=0),&quot;prop&quot;);</span>
<a href="#l31.321"></a><span id="l31.321" class="difflineplus">+</span>
<a href="#l31.322"></a><span id="l31.322" class="difflineplus">+    buf = icalmemory_new_buffer(buf_size);</span>
<a href="#l31.323"></a><span id="l31.323" class="difflineplus">+    buf_ptr = buf;</span>
<a href="#l31.324"></a><span id="l31.324">  </span>
<a href="#l31.325"></a><span id="l31.325">     if (prop-&gt;kind == ICAL_X_PROPERTY &amp;&amp; prop-&gt;x_name != 0){</span>
<a href="#l31.326"></a><span id="l31.326">         property_name = prop-&gt;x_name;</span>
<a href="#l31.327"></a><span id="l31.327">     } else {</span>
<a href="#l31.328"></a><span id="l31.328">         property_name = icalproperty_kind_to_string(prop-&gt;kind);</span>
<a href="#l31.329"></a><span id="l31.329">     }</span>
<a href="#l31.330"></a><span id="l31.330">  </span>
<a href="#l31.331"></a><span id="l31.331">     if (property_name == 0 ) {</span>
<a href="#l31.332"></a><span id="l31.332">         icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l31.333"></a><span id="l31.333" class="difflineplus">+	icalmemory_free_buffer(buf);</span>
<a href="#l31.334"></a><span id="l31.334">         return 0;</span>
<a href="#l31.335"></a><span id="l31.335"> </span>
<a href="#l31.336"></a><span id="l31.336">     } else {</span>
<a href="#l31.337"></a><span id="l31.337">         /* _append_string will automatically grow the buffer if</span>
<a href="#l31.338"></a><span id="l31.338">            property_name is longer than the initial buffer size */</span>
<a href="#l31.339"></a><span id="l31.339">         icalmemory_append_string(&amp;buf, &amp;buf_ptr, &amp;buf_size, property_name);</span>
<a href="#l31.340"></a><span id="l31.340">     }</span>
<a href="#l31.341"></a><span id="l31.341">  </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/libical/src/libical/icalrecur.c</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalrecur.c</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -134,27 +134,33 @@</span>
<a href="#l32.4"></a><span id="l32.4"> #ifdef HAVE_CONFIG_H</span>
<a href="#l32.5"></a><span id="l32.5"> #include &quot;config.h&quot;</span>
<a href="#l32.6"></a><span id="l32.6"> #endif</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> #ifdef HAVE_STDINT_H</span>
<a href="#l32.9"></a><span id="l32.9"> #include &lt;stdint.h&gt;</span>
<a href="#l32.10"></a><span id="l32.10"> #endif</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+#ifdef WIN32</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+#include &quot;vsnprintf.h&quot;</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+#endif</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+#endif</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineplus">+</span>
<a href="#l32.18"></a><span id="l32.18" class="difflineplus">+</span>
<a href="#l32.19"></a><span id="l32.19"> #include &lt;limits.h&gt;</span>
<a href="#l32.20"></a><span id="l32.20"> </span>
<a href="#l32.21"></a><span id="l32.21"> #ifndef HAVE_INTPTR_T</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineminus">-#if defined (WIN32) || defined (XP_BEOS)</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineplus">+#if (defined (WIN32) &amp;&amp; !defined (__MINGW32__)) || defined (XP_BEOS)</span>
<a href="#l32.24"></a><span id="l32.24"> typedef long intptr_t;</span>
<a href="#l32.25"></a><span id="l32.25"> #endif</span>
<a href="#l32.26"></a><span id="l32.26"> #endif</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28"> #ifdef WIN32</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-#define snprintf _snprintf</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-#define strcasecmp stricmp</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+#define strcasecmp      stricmp</span>
<a href="#l32.32"></a><span id="l32.32"> #endif</span>
<a href="#l32.33"></a><span id="l32.33"> </span>
<a href="#l32.34"></a><span id="l32.34"> #include &quot;icalrecur.h&quot;</span>
<a href="#l32.35"></a><span id="l32.35"> </span>
<a href="#l32.36"></a><span id="l32.36"> #include &quot;icalerror.h&quot;</span>
<a href="#l32.37"></a><span id="l32.37"> #include &quot;icalmemory.h&quot;</span>
<a href="#l32.38"></a><span id="l32.38"> </span>
<a href="#l32.39"></a><span id="l32.39"> #include &lt;stdlib.h&gt; /* for malloc */</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineat">@@ -318,19 +324,23 @@ void icalrecur_add_byrules(struct icalre</span>
<a href="#l32.41"></a><span id="l32.41"> }</span>
<a href="#l32.42"></a><span id="l32.42"> </span>
<a href="#l32.43"></a><span id="l32.43"> /*</span>
<a href="#l32.44"></a><span id="l32.44">  * Days in the BYDAY rule are expected by the code to be sorted, and while</span>
<a href="#l32.45"></a><span id="l32.45">  * this may be the common case, the RFC doesn't actually mandate it. This</span>
<a href="#l32.46"></a><span id="l32.46">  * function sorts the days taking into account the first day of week.</span>
<a href="#l32.47"></a><span id="l32.47">  */</span>
<a href="#l32.48"></a><span id="l32.48"> static void</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineminus">-sort_bydayrules(short * array, int week_start)</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineplus">+sort_bydayrules(struct icalrecur_parser *parser)</span>
<a href="#l32.51"></a><span id="l32.51"> {</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineminus">-    int one, two, i, j;</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineplus">+    short *array;</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineplus">+    int week_start, one, two, i, j;</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineplus">+</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineplus">+    array = parser-&gt;rt.by_day;</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineplus">+    week_start = parser-&gt;rt.week_start;</span>
<a href="#l32.58"></a><span id="l32.58"> </span>
<a href="#l32.59"></a><span id="l32.59">     for (i=0;</span>
<a href="#l32.60"></a><span id="l32.60"> 	 i&lt;ICAL_BY_DAY_SIZE &amp;&amp; array[i] != ICAL_RECURRENCE_ARRAY_MAX;</span>
<a href="#l32.61"></a><span id="l32.61"> 	 i++) {</span>
<a href="#l32.62"></a><span id="l32.62"> 	for (j=0; j&lt;i; j++) {</span>
<a href="#l32.63"></a><span id="l32.63"> 	    one = icalrecurrencetype_day_day_of_week(array[j]) - week_start;</span>
<a href="#l32.64"></a><span id="l32.64"> 	    if (one &lt; 0) one += 7;</span>
<a href="#l32.65"></a><span id="l32.65"> 	    two = icalrecurrencetype_day_day_of_week(array[i]) - week_start;</span>
<a href="#l32.66"></a><span id="l32.66" class="difflineat">@@ -357,18 +367,16 @@ void icalrecur_add_bydayrules(struct ica</span>
<a href="#l32.67"></a><span id="l32.67">     char* end;</span>
<a href="#l32.68"></a><span id="l32.68">     char* vals_copy;</span>
<a href="#l32.69"></a><span id="l32.69"> </span>
<a href="#l32.70"></a><span id="l32.70">     vals_copy = icalmemory_strdup(vals);</span>
<a href="#l32.71"></a><span id="l32.71"> </span>
<a href="#l32.72"></a><span id="l32.72">     end = (char*)vals_copy+strlen(vals_copy);</span>
<a href="#l32.73"></a><span id="l32.73">     n = vals_copy;</span>
<a href="#l32.74"></a><span id="l32.74"> </span>
<a href="#l32.75"></a><span id="l32.75" class="difflineminus">-    array[0] = ICAL_RECURRENCE_ARRAY_MAX;</span>
<a href="#l32.76"></a><span id="l32.76" class="difflineminus">-</span>
<a href="#l32.77"></a><span id="l32.77">     while(n != 0){</span>
<a href="#l32.78"></a><span id="l32.78"> 	</span>
<a href="#l32.79"></a><span id="l32.79"> </span>
<a href="#l32.80"></a><span id="l32.80"> 	t = n;</span>
<a href="#l32.81"></a><span id="l32.81"> </span>
<a href="#l32.82"></a><span id="l32.82"> 	n = strchr(t,',');</span>
<a href="#l32.83"></a><span id="l32.83"> </span>
<a href="#l32.84"></a><span id="l32.84"> 	if(n != 0){</span>
<a href="#l32.85"></a><span id="l32.85" class="difflineat">@@ -393,25 +401,24 @@ void icalrecur_add_bydayrules(struct ica</span>
<a href="#l32.86"></a><span id="l32.86"> 	/* Outlook/Exchange generate &quot;BYDAY=MO, FR&quot; and &quot;BYDAY=2 TH&quot;.</span>
<a href="#l32.87"></a><span id="l32.87"> 	 * Cope with that.</span>
<a href="#l32.88"></a><span id="l32.88"> 	 */</span>
<a href="#l32.89"></a><span id="l32.89"> 	if (*t == ' ')</span>
<a href="#l32.90"></a><span id="l32.90"> 	    t++;</span>
<a href="#l32.91"></a><span id="l32.91"> </span>
<a href="#l32.92"></a><span id="l32.92"> 	wd = icalrecur_string_to_weekday(t);</span>
<a href="#l32.93"></a><span id="l32.93"> </span>
<a href="#l32.94"></a><span id="l32.94" class="difflineminus">-        if (wd != ICAL_NO_WEEKDAY) {</span>
<a href="#l32.95"></a><span id="l32.95" class="difflineminus">-            array[i++] = (short) (sign * (wd + 8 * weekno));</span>
<a href="#l32.96"></a><span id="l32.96" class="difflineminus">-            array[i] = ICAL_RECURRENCE_ARRAY_MAX;</span>
<a href="#l32.97"></a><span id="l32.97" class="difflineminus">-        }</span>
<a href="#l32.98"></a><span id="l32.98" class="difflineplus">+	array[i++] = (short)(sign* (wd + 8*weekno));</span>
<a href="#l32.99"></a><span id="l32.99" class="difflineplus">+	array[i] =  ICAL_RECURRENCE_ARRAY_MAX;</span>
<a href="#l32.100"></a><span id="l32.100" class="difflineplus">+</span>
<a href="#l32.101"></a><span id="l32.101">     }</span>
<a href="#l32.102"></a><span id="l32.102"> </span>
<a href="#l32.103"></a><span id="l32.103">     free(vals_copy);</span>
<a href="#l32.104"></a><span id="l32.104"> </span>
<a href="#l32.105"></a><span id="l32.105" class="difflineminus">-    sort_bydayrules(parser-&gt;rt.by_day, parser-&gt;rt.week_start);</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineplus">+    sort_bydayrules(parser);</span>
<a href="#l32.107"></a><span id="l32.107"> }</span>
<a href="#l32.108"></a><span id="l32.108"> </span>
<a href="#l32.109"></a><span id="l32.109"> </span>
<a href="#l32.110"></a><span id="l32.110"> struct icalrecurrencetype icalrecurrencetype_from_string(const char* str)</span>
<a href="#l32.111"></a><span id="l32.111"> {</span>
<a href="#l32.112"></a><span id="l32.112">     struct icalrecur_parser parser;</span>
<a href="#l32.113"></a><span id="l32.113"> </span>
<a href="#l32.114"></a><span id="l32.114">     memset(&amp;parser,0,sizeof(parser));</span>
<a href="#l32.115"></a><span id="l32.115" class="difflineat">@@ -443,30 +450,24 @@ struct icalrecurrencetype icalrecurrence</span>
<a href="#l32.116"></a><span id="l32.116"> 	    icalrecurrencetype_clear(&amp;parser.rt);</span>
<a href="#l32.117"></a><span id="l32.117"> 		free(parser.copy);</span>
<a href="#l32.118"></a><span id="l32.118"> 	    return parser.rt;</span>
<a href="#l32.119"></a><span id="l32.119"> 	}</span>
<a href="#l32.120"></a><span id="l32.120"> </span>
<a href="#l32.121"></a><span id="l32.121"> 	if (strcasecmp(name,&quot;FREQ&quot;) == 0){</span>
<a href="#l32.122"></a><span id="l32.122"> 	    parser.rt.freq = icalrecur_string_to_freq(value);</span>
<a href="#l32.123"></a><span id="l32.123"> 	} else if (strcasecmp(name,&quot;COUNT&quot;) == 0){</span>
<a href="#l32.124"></a><span id="l32.124" class="difflineminus">-	    int v = atoi(value);</span>
<a href="#l32.125"></a><span id="l32.125" class="difflineminus">-	    if (v &gt;= 0) {</span>
<a href="#l32.126"></a><span id="l32.126" class="difflineminus">-	    parser.rt.count = v;</span>
<a href="#l32.127"></a><span id="l32.127" class="difflineminus">-	    }</span>
<a href="#l32.128"></a><span id="l32.128" class="difflineplus">+	    parser.rt.count = atoi(value);</span>
<a href="#l32.129"></a><span id="l32.129"> 	} else if (strcasecmp(name,&quot;UNTIL&quot;) == 0){</span>
<a href="#l32.130"></a><span id="l32.130"> 	    parser.rt.until = icaltime_from_string(value);</span>
<a href="#l32.131"></a><span id="l32.131"> 	} else if (strcasecmp(name,&quot;INTERVAL&quot;) == 0){</span>
<a href="#l32.132"></a><span id="l32.132" class="difflineminus">-	    int v = atoi(value);</span>
<a href="#l32.133"></a><span id="l32.133" class="difflineminus">-	    if (v &gt; 0 &amp;&amp; v &lt;= SHRT_MAX) {</span>
<a href="#l32.134"></a><span id="l32.134" class="difflineminus">-	    parser.rt.interval = (short) v;</span>
<a href="#l32.135"></a><span id="l32.135" class="difflineminus">-	    }</span>
<a href="#l32.136"></a><span id="l32.136" class="difflineplus">+	    parser.rt.interval = (short)atoi(value);</span>
<a href="#l32.137"></a><span id="l32.137"> 	} else if (strcasecmp(name,&quot;WKST&quot;) == 0){</span>
<a href="#l32.138"></a><span id="l32.138"> 	    parser.rt.week_start = icalrecur_string_to_weekday(value);</span>
<a href="#l32.139"></a><span id="l32.139" class="difflineminus">-        sort_bydayrules(parser.rt.by_day, parser.rt.week_start);</span>
<a href="#l32.140"></a><span id="l32.140" class="difflineplus">+	    sort_bydayrules(&amp;parser);</span>
<a href="#l32.141"></a><span id="l32.141"> 	} else if (strcasecmp(name,&quot;BYSECOND&quot;) == 0){</span>
<a href="#l32.142"></a><span id="l32.142"> 	    icalrecur_add_byrules(&amp;parser,parser.rt.by_second,</span>
<a href="#l32.143"></a><span id="l32.143"> 				  ICAL_BY_SECOND_SIZE,value);</span>
<a href="#l32.144"></a><span id="l32.144"> 	} else if (strcasecmp(name,&quot;BYMINUTE&quot;) == 0){</span>
<a href="#l32.145"></a><span id="l32.145"> 	    icalrecur_add_byrules(&amp;parser,parser.rt.by_minute,</span>
<a href="#l32.146"></a><span id="l32.146"> 				  ICAL_BY_MINUTE_SIZE,value);</span>
<a href="#l32.147"></a><span id="l32.147"> 	} else if (strcasecmp(name,&quot;BYHOUR&quot;) == 0){</span>
<a href="#l32.148"></a><span id="l32.148"> 	    icalrecur_add_byrules(&amp;parser,parser.rt.by_hour,</span>
<a href="#l32.149"></a><span id="l32.149" class="difflineat">@@ -811,16 +812,18 @@ static int expand_year_days(icalrecur_it</span>
<a href="#l32.150"></a><span id="l32.150"> </span>
<a href="#l32.151"></a><span id="l32.151"> </span>
<a href="#l32.152"></a><span id="l32.152"> icalrecur_iterator* icalrecur_iterator_new(struct icalrecurrencetype rule, </span>
<a href="#l32.153"></a><span id="l32.153"> 					   struct icaltimetype dtstart)</span>
<a href="#l32.154"></a><span id="l32.154"> {</span>
<a href="#l32.155"></a><span id="l32.155">     icalrecur_iterator* impl;</span>
<a href="#l32.156"></a><span id="l32.156">     icalrecurrencetype_frequency freq;</span>
<a href="#l32.157"></a><span id="l32.157"> </span>
<a href="#l32.158"></a><span id="l32.158" class="difflineplus">+    icalerror_clear_errno();</span>
<a href="#l32.159"></a><span id="l32.159" class="difflineplus">+</span>
<a href="#l32.160"></a><span id="l32.160">     if ( ( impl = (icalrecur_iterator*)</span>
<a href="#l32.161"></a><span id="l32.161"> 	   malloc(sizeof(icalrecur_iterator))) == 0) {</span>
<a href="#l32.162"></a><span id="l32.162"> 	icalerror_set_errno(ICAL_NEWFAILED_ERROR);</span>
<a href="#l32.163"></a><span id="l32.163"> 	return 0;</span>
<a href="#l32.164"></a><span id="l32.164">     }</span>
<a href="#l32.165"></a><span id="l32.165"> </span>
<a href="#l32.166"></a><span id="l32.166">     memset(impl,0,sizeof(icalrecur_iterator));</span>
<a href="#l32.167"></a><span id="l32.167"> </span>
<a href="#l32.168"></a><span id="l32.168" class="difflineat">@@ -876,62 +879,57 @@ icalrecur_iterator* icalrecur_iterator_n</span>
<a href="#l32.169"></a><span id="l32.169">     /* If the BYYEARDAY appears, no other date rule part may appear.   */</span>
<a href="#l32.170"></a><span id="l32.170"> </span>
<a href="#l32.171"></a><span id="l32.171">     if(icalrecur_two_byrule(impl,BY_YEAR_DAY,BY_MONTH) ||</span>
<a href="#l32.172"></a><span id="l32.172">        icalrecur_two_byrule(impl,BY_YEAR_DAY,BY_WEEK_NO) ||</span>
<a href="#l32.173"></a><span id="l32.173">        icalrecur_two_byrule(impl,BY_YEAR_DAY,BY_MONTH_DAY) ||</span>
<a href="#l32.174"></a><span id="l32.174">        icalrecur_two_byrule(impl,BY_YEAR_DAY,BY_DAY) ){</span>
<a href="#l32.175"></a><span id="l32.175"> </span>
<a href="#l32.176"></a><span id="l32.176"> 	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.177"></a><span id="l32.177" class="difflineminus">-</span>
<a href="#l32.178"></a><span id="l32.178" class="difflineplus">+        free(impl);</span>
<a href="#l32.179"></a><span id="l32.179"> 	return 0;</span>
<a href="#l32.180"></a><span id="l32.180">     }</span>
<a href="#l32.181"></a><span id="l32.181"> </span>
<a href="#l32.182"></a><span id="l32.182" class="difflineminus">-    /* BYWEEKNO and BYMONTH rule parts may not both appear.*/</span>
<a href="#l32.183"></a><span id="l32.183" class="difflineminus">-</span>
<a href="#l32.184"></a><span id="l32.184" class="difflineminus">-    if(icalrecur_two_byrule(impl,BY_WEEK_NO,BY_MONTH)){</span>
<a href="#l32.185"></a><span id="l32.185" class="difflineminus">-	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.186"></a><span id="l32.186" class="difflineminus">-</span>
<a href="#l32.187"></a><span id="l32.187" class="difflineminus">-	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.188"></a><span id="l32.188" class="difflineminus">-	return 0;</span>
<a href="#l32.189"></a><span id="l32.189" class="difflineminus">-    }</span>
<a href="#l32.190"></a><span id="l32.190" class="difflineplus">+    </span>
<a href="#l32.191"></a><span id="l32.191"> </span>
<a href="#l32.192"></a><span id="l32.192">     /* BYWEEKNO and BYMONTHDAY rule parts may not both appear.*/</span>
<a href="#l32.193"></a><span id="l32.193"> </span>
<a href="#l32.194"></a><span id="l32.194">     if(icalrecur_two_byrule(impl,BY_WEEK_NO,BY_MONTH_DAY)){</span>
<a href="#l32.195"></a><span id="l32.195"> 	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.196"></a><span id="l32.196" class="difflineminus">-</span>
<a href="#l32.197"></a><span id="l32.197" class="difflineminus">-	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.198"></a><span id="l32.198" class="difflineminus">-	return 0;</span>
<a href="#l32.199"></a><span id="l32.199" class="difflineplus">+        free(impl);</span>
<a href="#l32.200"></a><span id="l32.200" class="difflineplus">+        return 0;</span>
<a href="#l32.201"></a><span id="l32.201">     }</span>
<a href="#l32.202"></a><span id="l32.202"> </span>
<a href="#l32.203"></a><span id="l32.203"> </span>
<a href="#l32.204"></a><span id="l32.204">     /*For MONTHLY recurrences (FREQ=MONTHLY) neither BYYEARDAY nor</span>
<a href="#l32.205"></a><span id="l32.205">       BYWEEKNO may appear. */</span>
<a href="#l32.206"></a><span id="l32.206"> </span>
<a href="#l32.207"></a><span id="l32.207">     if(freq == ICAL_MONTHLY_RECURRENCE &amp;&amp; </span>
<a href="#l32.208"></a><span id="l32.208">        icalrecur_one_byrule(impl,BY_WEEK_NO)){</span>
<a href="#l32.209"></a><span id="l32.209"> 	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.210"></a><span id="l32.210" class="difflineminus">-	return 0;</span>
<a href="#l32.211"></a><span id="l32.211" class="difflineplus">+        free(impl);</span>
<a href="#l32.212"></a><span id="l32.212" class="difflineplus">+        return 0;</span>
<a href="#l32.213"></a><span id="l32.213">     }</span>
<a href="#l32.214"></a><span id="l32.214"> </span>
<a href="#l32.215"></a><span id="l32.215"> </span>
<a href="#l32.216"></a><span id="l32.216">     /*For WEEKLY recurrences (FREQ=WEEKLY) neither BYMONTHDAY nor</span>
<a href="#l32.217"></a><span id="l32.217">       BYYEARDAY may appear. */</span>
<a href="#l32.218"></a><span id="l32.218"> </span>
<a href="#l32.219"></a><span id="l32.219">     if(freq == ICAL_WEEKLY_RECURRENCE &amp;&amp; </span>
<a href="#l32.220"></a><span id="l32.220">        icalrecur_one_byrule(impl,BY_MONTH_DAY )) {</span>
<a href="#l32.221"></a><span id="l32.221"> 	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.222"></a><span id="l32.222" class="difflineminus">-	return 0;</span>
<a href="#l32.223"></a><span id="l32.223" class="difflineplus">+	free(impl);</span>
<a href="#l32.224"></a><span id="l32.224" class="difflineplus">+        return 0;</span>
<a href="#l32.225"></a><span id="l32.225">     }</span>
<a href="#l32.226"></a><span id="l32.226"> </span>
<a href="#l32.227"></a><span id="l32.227">     /* BYYEARDAY may only appear in YEARLY rules */</span>
<a href="#l32.228"></a><span id="l32.228">     if(freq != ICAL_YEARLY_RECURRENCE &amp;&amp; </span>
<a href="#l32.229"></a><span id="l32.229">        icalrecur_one_byrule(impl,BY_YEAR_DAY )) {</span>
<a href="#l32.230"></a><span id="l32.230"> 	icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.231"></a><span id="l32.231" class="difflineplus">+        free(impl);</span>
<a href="#l32.232"></a><span id="l32.232"> 	return 0;</span>
<a href="#l32.233"></a><span id="l32.233">     }</span>
<a href="#l32.234"></a><span id="l32.234"> </span>
<a href="#l32.235"></a><span id="l32.235">     /* Rewrite some of the rules and set up defaults to make later</span>
<a href="#l32.236"></a><span id="l32.236">        processing easier. Primarily, t involves copying an element</span>
<a href="#l32.237"></a><span id="l32.237">        from the start time into the corresponding BY_* array when the</span>
<a href="#l32.238"></a><span id="l32.238">        BY_* array is empty */</span>
<a href="#l32.239"></a><span id="l32.239"> </span>
<a href="#l32.240"></a><span id="l32.240" class="difflineat">@@ -991,19 +989,25 @@ icalrecur_iterator* icalrecur_iterator_n</span>
<a href="#l32.241"></a><span id="l32.241"> </span>
<a href="#l32.242"></a><span id="l32.242">     }</span>
<a href="#l32.243"></a><span id="l32.243"> </span>
<a href="#l32.244"></a><span id="l32.244">     /* For YEARLY rule, begin by setting up the year days array . The</span>
<a href="#l32.245"></a><span id="l32.245">        YEARLY rules work by expanding one year at a time. */</span>
<a href="#l32.246"></a><span id="l32.246"> </span>
<a href="#l32.247"></a><span id="l32.247">     if(impl-&gt;rule.freq == ICAL_YEARLY_RECURRENCE){</span>
<a href="#l32.248"></a><span id="l32.248">         struct icaltimetype next;</span>
<a href="#l32.249"></a><span id="l32.249" class="difflineplus">+	icalerror_clear_errno();</span>
<a href="#l32.250"></a><span id="l32.250"> </span>
<a href="#l32.251"></a><span id="l32.251"> 	for (;;) {</span>
<a href="#l32.252"></a><span id="l32.252">             expand_year_days(impl, impl-&gt;last.year);</span>
<a href="#l32.253"></a><span id="l32.253" class="difflineplus">+        if( icalerrno != ICAL_NO_ERROR) {</span>
<a href="#l32.254"></a><span id="l32.254" class="difflineplus">+            icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.255"></a><span id="l32.255" class="difflineplus">+            free(impl);</span>
<a href="#l32.256"></a><span id="l32.256" class="difflineplus">+            return 0;</span>
<a href="#l32.257"></a><span id="l32.257" class="difflineplus">+        }</span>
<a href="#l32.258"></a><span id="l32.258"> 	    if (impl-&gt;days[0] != ICAL_RECURRENCE_ARRAY_MAX)</span>
<a href="#l32.259"></a><span id="l32.259"> 	        break; /* break when no days are expanded */</span>
<a href="#l32.260"></a><span id="l32.260"> 	    increment_year(impl,impl-&gt;rule.interval);</span>
<a href="#l32.261"></a><span id="l32.261"> 	}</span>
<a href="#l32.262"></a><span id="l32.262"> </span>
<a href="#l32.263"></a><span id="l32.263">         /* Copy the first day into last. */</span>
<a href="#l32.264"></a><span id="l32.264"> 	next = icaltime_from_day_of_year(impl-&gt;days[0], impl-&gt;last.year);</span>
<a href="#l32.265"></a><span id="l32.265">     </span>
<a href="#l32.266"></a><span id="l32.266" class="difflineat">@@ -1055,17 +1059,18 @@ icalrecur_iterator* icalrecur_iterator_n</span>
<a href="#l32.267"></a><span id="l32.267">                     }</span>
<a href="#l32.268"></a><span id="l32.268">                 }</span>
<a href="#l32.269"></a><span id="l32.269">             }</span>
<a href="#l32.270"></a><span id="l32.270">         }</span>
<a href="#l32.271"></a><span id="l32.271"> </span>
<a href="#l32.272"></a><span id="l32.272"> </span>
<a href="#l32.273"></a><span id="l32.273"> 	if(impl-&gt;last.day &gt; days_in_month || impl-&gt;last.day == 0){</span>
<a href="#l32.274"></a><span id="l32.274"> 	    icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.275"></a><span id="l32.275" class="difflineminus">-	    return 0;</span>
<a href="#l32.276"></a><span id="l32.276" class="difflineplus">+            free(impl);</span>
<a href="#l32.277"></a><span id="l32.277" class="difflineplus">+            return 0;</span>
<a href="#l32.278"></a><span id="l32.278"> 	}</span>
<a href="#l32.279"></a><span id="l32.279"> 	</span>
<a href="#l32.280"></a><span id="l32.280">     } else if (has_by_data(impl,BY_MONTH_DAY)) {</span>
<a href="#l32.281"></a><span id="l32.281"> 	impl-&gt;last = icaltime_normalize(impl-&gt;last);</span>
<a href="#l32.282"></a><span id="l32.282">     }</span>
<a href="#l32.283"></a><span id="l32.283"> </span>
<a href="#l32.284"></a><span id="l32.284"> </span>
<a href="#l32.285"></a><span id="l32.285"> </span>
<a href="#l32.286"></a><span id="l32.286" class="difflineat">@@ -1159,17 +1164,17 @@ static void increment_hour(icalrecur_ite</span>
<a href="#l32.287"></a><span id="l32.287"> {</span>
<a href="#l32.288"></a><span id="l32.288">     int days;</span>
<a href="#l32.289"></a><span id="l32.289"> </span>
<a href="#l32.290"></a><span id="l32.290">     impl-&gt;last.hour+=inc;</span>
<a href="#l32.291"></a><span id="l32.291"> </span>
<a href="#l32.292"></a><span id="l32.292">     days = impl-&gt;last.hour / 24;</span>
<a href="#l32.293"></a><span id="l32.293">     impl-&gt;last.hour = impl-&gt;last.hour % 24;</span>
<a href="#l32.294"></a><span id="l32.294"> </span>
<a href="#l32.295"></a><span id="l32.295" class="difflineminus">-    if (impl-&gt;days != 0){</span>
<a href="#l32.296"></a><span id="l32.296" class="difflineplus">+    if (days != 0){</span>
<a href="#l32.297"></a><span id="l32.297"> 	increment_monthday(impl,days);</span>
<a href="#l32.298"></a><span id="l32.298">     }</span>
<a href="#l32.299"></a><span id="l32.299"> }</span>
<a href="#l32.300"></a><span id="l32.300"> </span>
<a href="#l32.301"></a><span id="l32.301"> static void increment_minute(icalrecur_iterator* impl, int inc)</span>
<a href="#l32.302"></a><span id="l32.302"> {</span>
<a href="#l32.303"></a><span id="l32.303">     int hours;</span>
<a href="#l32.304"></a><span id="l32.304"> </span>
<a href="#l32.305"></a><span id="l32.305" class="difflineat">@@ -1495,16 +1500,30 @@ static int is_day_in_byday(icalrecur_ite</span>
<a href="#l32.306"></a><span id="l32.306">             (nth_weekday(dow,pos,tt) == tt.day)){ /*pos+wod: &quot;3FR&quot; or -1TU&quot; */</span>
<a href="#l32.307"></a><span id="l32.307">             return 1;</span>
<a href="#l32.308"></a><span id="l32.308">         }</span>
<a href="#l32.309"></a><span id="l32.309">     }</span>
<a href="#l32.310"></a><span id="l32.310"> </span>
<a href="#l32.311"></a><span id="l32.311">     return 0;</span>
<a href="#l32.312"></a><span id="l32.312"> }</span>
<a href="#l32.313"></a><span id="l32.313"> </span>
<a href="#l32.314"></a><span id="l32.314" class="difflineplus">+int check_set_position(icalrecur_iterator* impl, int set_pos)</span>
<a href="#l32.315"></a><span id="l32.315" class="difflineplus">+{</span>
<a href="#l32.316"></a><span id="l32.316" class="difflineplus">+    int i;</span>
<a href="#l32.317"></a><span id="l32.317" class="difflineplus">+    int found = 0;</span>
<a href="#l32.318"></a><span id="l32.318" class="difflineplus">+    for (i = 0; impl-&gt;rule.by_set_pos[i] != ICAL_RECURRENCE_ARRAY_MAX &amp;&amp; </span>
<a href="#l32.319"></a><span id="l32.319" class="difflineplus">+              i != ICAL_BY_SETPOS_SIZE; i++){</span>
<a href="#l32.320"></a><span id="l32.320" class="difflineplus">+        if (impl-&gt;rule.by_set_pos[i] == set_pos) {</span>
<a href="#l32.321"></a><span id="l32.321" class="difflineplus">+              found = 1;</span>
<a href="#l32.322"></a><span id="l32.322" class="difflineplus">+              break;</span>
<a href="#l32.323"></a><span id="l32.323" class="difflineplus">+        }</span>
<a href="#l32.324"></a><span id="l32.324" class="difflineplus">+    }</span>
<a href="#l32.325"></a><span id="l32.325" class="difflineplus">+    return found;</span>
<a href="#l32.326"></a><span id="l32.326" class="difflineplus">+}</span>
<a href="#l32.327"></a><span id="l32.327" class="difflineplus">+</span>
<a href="#l32.328"></a><span id="l32.328"> static int next_month(icalrecur_iterator* impl)</span>
<a href="#l32.329"></a><span id="l32.329"> {</span>
<a href="#l32.330"></a><span id="l32.330">     int data_valid = 1;</span>
<a href="#l32.331"></a><span id="l32.331">     </span>
<a href="#l32.332"></a><span id="l32.332">     int this_frequency = (impl-&gt;rule.freq == ICAL_MONTHLY_RECURRENCE);</span>
<a href="#l32.333"></a><span id="l32.333">     </span>
<a href="#l32.334"></a><span id="l32.334">     assert( has_by_data(impl,BY_MONTH) || this_frequency);</span>
<a href="#l32.335"></a><span id="l32.335">   </span>
<a href="#l32.336"></a><span id="l32.336" class="difflineat">@@ -1554,17 +1573,16 @@ static int next_month(icalrecur_iterator</span>
<a href="#l32.337"></a><span id="l32.337">           }</span>
<a href="#l32.338"></a><span id="l32.338">       }</span>
<a href="#l32.339"></a><span id="l32.339"> </span>
<a href="#l32.340"></a><span id="l32.340">   MDEND:</span>
<a href="#l32.341"></a><span id="l32.341"> </span>
<a href="#l32.342"></a><span id="l32.342">       if ( day &gt; days_in_month){</span>
<a href="#l32.343"></a><span id="l32.343">           impl-&gt;last.day = 1;</span>
<a href="#l32.344"></a><span id="l32.344">           increment_month(impl);</span>
<a href="#l32.345"></a><span id="l32.345" class="difflineminus">-          impl-&gt;last.day--; /* Go back one day, so searches next month start at day 1 */</span>
<a href="#l32.346"></a><span id="l32.346">           data_valid = 0; /* signal that impl-&gt;last is invalid */</span>
<a href="#l32.347"></a><span id="l32.347">       }</span>
<a href="#l32.348"></a><span id="l32.348"> </span>
<a href="#l32.349"></a><span id="l32.349">     </span>
<a href="#l32.350"></a><span id="l32.350">    /* </span>
<a href="#l32.351"></a><span id="l32.351">     * Case 2: </span>
<a href="#l32.352"></a><span id="l32.352">     * Rules Like: FREQ=MONTHLY;INTERVAL=1;BYDAY=FR </span>
<a href="#l32.353"></a><span id="l32.353">     */</span>
<a href="#l32.354"></a><span id="l32.354" class="difflineat">@@ -1577,36 +1595,66 @@ static int next_month(icalrecur_iterator</span>
<a href="#l32.355"></a><span id="l32.355">          and checks if each day is listed in the BY_DAY array. This</span>
<a href="#l32.356"></a><span id="l32.356">          seems very inneficient, but I think it is the simplest way to</span>
<a href="#l32.357"></a><span id="l32.357">          account for both BYDAY=1FR (First friday in month) and</span>
<a href="#l32.358"></a><span id="l32.358">          BYDAY=FR ( every friday in month ) */</span>
<a href="#l32.359"></a><span id="l32.359"> </span>
<a href="#l32.360"></a><span id="l32.360">       int day;</span>
<a href="#l32.361"></a><span id="l32.361">       int days_in_month = icaltime_days_in_month(impl-&gt;last.month,</span>
<a href="#l32.362"></a><span id="l32.362">                                                    impl-&gt;last.year);</span>
<a href="#l32.363"></a><span id="l32.363" class="difflineplus">+      int set_pos_counter = 0;</span>
<a href="#l32.364"></a><span id="l32.364" class="difflineplus">+      int set_pos_total = 0;</span>
<a href="#l32.365"></a><span id="l32.365" class="difflineplus">+      int found = 0;</span>
<a href="#l32.366"></a><span id="l32.366" class="difflineplus">+      </span>
<a href="#l32.367"></a><span id="l32.367">       assert( BYDAYPTR[0]!=ICAL_RECURRENCE_ARRAY_MAX);</span>
<a href="#l32.368"></a><span id="l32.368"> </span>
<a href="#l32.369"></a><span id="l32.369" class="difflineplus">+      /* Count the past positions for the BYSETPOS calculation */</span>
<a href="#l32.370"></a><span id="l32.370" class="difflineplus">+      if(has_by_data(impl,BY_SET_POS)){</span>
<a href="#l32.371"></a><span id="l32.371" class="difflineplus">+          int last_day = impl-&gt;last.day;</span>
<a href="#l32.372"></a><span id="l32.372" class="difflineplus">+	  for(day = 1; day &lt;= days_in_month; day++){</span>
<a href="#l32.373"></a><span id="l32.373" class="difflineplus">+    	      impl-&gt;last.day = day;</span>
<a href="#l32.374"></a><span id="l32.374" class="difflineplus">+	  </span>
<a href="#l32.375"></a><span id="l32.375" class="difflineplus">+              if(is_day_in_byday(impl,impl-&gt;last)){</span>
<a href="#l32.376"></a><span id="l32.376" class="difflineplus">+		  set_pos_total++;</span>
<a href="#l32.377"></a><span id="l32.377" class="difflineplus">+		  if(day &lt;= last_day)</span>
<a href="#l32.378"></a><span id="l32.378" class="difflineplus">+        	      set_pos_counter++;</span>
<a href="#l32.379"></a><span id="l32.379" class="difflineplus">+	      }</span>
<a href="#l32.380"></a><span id="l32.380" class="difflineplus">+	  }</span>
<a href="#l32.381"></a><span id="l32.381" class="difflineplus">+          impl-&gt;last.day = last_day;</span>
<a href="#l32.382"></a><span id="l32.382" class="difflineplus">+      }</span>
<a href="#l32.383"></a><span id="l32.383" class="difflineplus">+      </span>
<a href="#l32.384"></a><span id="l32.384">       for(day = impl-&gt;last.day+1; day &lt;= days_in_month; day++){</span>
<a href="#l32.385"></a><span id="l32.385">           impl-&gt;last.day = day;</span>
<a href="#l32.386"></a><span id="l32.386" class="difflineplus">+	  </span>
<a href="#l32.387"></a><span id="l32.387">           if(is_day_in_byday(impl,impl-&gt;last)){</span>
<a href="#l32.388"></a><span id="l32.388" class="difflineminus">-              data_valid = 1;</span>
<a href="#l32.389"></a><span id="l32.389" class="difflineminus">-              break;</span>
<a href="#l32.390"></a><span id="l32.390" class="difflineminus">-          }</span>
<a href="#l32.391"></a><span id="l32.391" class="difflineplus">+          /* If there is no BYSETPOS rule, calculate only by BYDAY</span>
<a href="#l32.392"></a><span id="l32.392" class="difflineplus">+             If there is BYSETPOS rule, take into account the occurence</span>
<a href="#l32.393"></a><span id="l32.393" class="difflineplus">+             matches with BYDAY */</span>
<a href="#l32.394"></a><span id="l32.394" class="difflineplus">+              if(!has_by_data(impl,BY_SET_POS) || check_set_position(impl, ++set_pos_counter)</span>
<a href="#l32.395"></a><span id="l32.395" class="difflineplus">+                  	|| check_set_position(impl, set_pos_counter-set_pos_total-1)) {</span>
<a href="#l32.396"></a><span id="l32.396" class="difflineplus">+                  found = 1;</span>
<a href="#l32.397"></a><span id="l32.397" class="difflineplus">+                  break;</span>
<a href="#l32.398"></a><span id="l32.398" class="difflineplus">+              }</span>
<a href="#l32.399"></a><span id="l32.399" class="difflineplus">+           }</span>
<a href="#l32.400"></a><span id="l32.400">       }</span>
<a href="#l32.401"></a><span id="l32.401" class="difflineplus">+      </span>
<a href="#l32.402"></a><span id="l32.402" class="difflineplus">+      data_valid = found;</span>
<a href="#l32.403"></a><span id="l32.403"> </span>
<a href="#l32.404"></a><span id="l32.404">       if ( day &gt; days_in_month){</span>
<a href="#l32.405"></a><span id="l32.405">           impl-&gt;last.day = 1;</span>
<a href="#l32.406"></a><span id="l32.406">           increment_month(impl);</span>
<a href="#l32.407"></a><span id="l32.407"> </span>
<a href="#l32.408"></a><span id="l32.408">           /* Did moving to the next month put us on a valid date? if</span>
<a href="#l32.409"></a><span id="l32.409">              so, note that the new data is valid, if, not, mark it</span>
<a href="#l32.410"></a><span id="l32.410">              invalid */</span>
<a href="#l32.411"></a><span id="l32.411"> </span>
<a href="#l32.412"></a><span id="l32.412">           if(is_day_in_byday(impl,impl-&gt;last)){</span>
<a href="#l32.413"></a><span id="l32.413" class="difflineminus">-              data_valid = 1;</span>
<a href="#l32.414"></a><span id="l32.414" class="difflineplus">+          /* If there is no BYSETPOS rule or BYSETPOS=1, new data is valid */</span>
<a href="#l32.415"></a><span id="l32.415" class="difflineplus">+              if(!has_by_data(impl,BY_SET_POS) || check_set_position(impl,1))</span>
<a href="#l32.416"></a><span id="l32.416" class="difflineplus">+                  data_valid = 1;</span>
<a href="#l32.417"></a><span id="l32.417">           } else {</span>
<a href="#l32.418"></a><span id="l32.418">               data_valid = 0; /* signal that impl-&gt;last is invalid */</span>
<a href="#l32.419"></a><span id="l32.419">           }</span>
<a href="#l32.420"></a><span id="l32.420">       }</span>
<a href="#l32.421"></a><span id="l32.421"> </span>
<a href="#l32.422"></a><span id="l32.422">      /* </span>
<a href="#l32.423"></a><span id="l32.423">        * Case 3</span>
<a href="#l32.424"></a><span id="l32.424">        * Rules Like: FREQ=MONTHLY;COUNT=10;BYMONTHDAY=-3  </span>
<a href="#l32.425"></a><span id="l32.425" class="difflineat">@@ -1649,22 +1697,25 @@ static int next_month(icalrecur_iterator</span>
<a href="#l32.426"></a><span id="l32.426">           }</span>
<a href="#l32.427"></a><span id="l32.427">       }</span>
<a href="#l32.428"></a><span id="l32.428"> </span>
<a href="#l32.429"></a><span id="l32.429">       impl-&gt;last.day = day;</span>
<a href="#l32.430"></a><span id="l32.430"> </span>
<a href="#l32.431"></a><span id="l32.431">   } else {</span>
<a href="#l32.432"></a><span id="l32.432">       int days_in_month;</span>
<a href="#l32.433"></a><span id="l32.433"> </span>
<a href="#l32.434"></a><span id="l32.434" class="difflineplus">+      assert( BYMDPTR[0]!=ICAL_RECURRENCE_ARRAY_MAX);</span>
<a href="#l32.435"></a><span id="l32.435" class="difflineplus">+      impl-&gt;last.day = BYMDPTR[0];</span>
<a href="#l32.436"></a><span id="l32.436" class="difflineplus">+</span>
<a href="#l32.437"></a><span id="l32.437">       increment_month(impl);</span>
<a href="#l32.438"></a><span id="l32.438"> </span>
<a href="#l32.439"></a><span id="l32.439">       days_in_month = icaltime_days_in_month(impl-&gt;last.month,</span>
<a href="#l32.440"></a><span id="l32.440">                                                    impl-&gt;last.year);</span>
<a href="#l32.441"></a><span id="l32.441">       if (impl-&gt;last.day &gt; days_in_month){</span>
<a href="#l32.442"></a><span id="l32.442" class="difflineminus">-          data_valid = 0; /* signal that impl-&gt;last is invalid */</span>
<a href="#l32.443"></a><span id="l32.443" class="difflineplus">+          impl-&gt;last.day = days_in_month;</span>
<a href="#l32.444"></a><span id="l32.444">       }</span>
<a href="#l32.445"></a><span id="l32.445">   }</span>
<a href="#l32.446"></a><span id="l32.446"> </span>
<a href="#l32.447"></a><span id="l32.447">   return data_valid;</span>
<a href="#l32.448"></a><span id="l32.448"> </span>
<a href="#l32.449"></a><span id="l32.449"> }</span>
<a href="#l32.450"></a><span id="l32.450"> </span>
<a href="#l32.451"></a><span id="l32.451"> static int next_weekday_by_week(icalrecur_iterator* impl)</span>
<a href="#l32.452"></a><span id="l32.452" class="difflineat">@@ -1677,20 +1728,16 @@ static int next_weekday_by_week(icalrecu</span>
<a href="#l32.453"></a><span id="l32.453">   if (next_hour(impl) == 0){</span>
<a href="#l32.454"></a><span id="l32.454">       return 0;</span>
<a href="#l32.455"></a><span id="l32.455">   }</span>
<a href="#l32.456"></a><span id="l32.456"> </span>
<a href="#l32.457"></a><span id="l32.457">   if(!has_by_data(impl,BY_DAY)){</span>
<a href="#l32.458"></a><span id="l32.458">       return 1;</span>
<a href="#l32.459"></a><span id="l32.459">   }</span>
<a href="#l32.460"></a><span id="l32.460"> </span>
<a href="#l32.461"></a><span id="l32.461" class="difflineminus">-  /* this call to 'sort_bydayrules' assures that the occurrences for</span>
<a href="#l32.462"></a><span id="l32.462" class="difflineminus">-     weekly recurrences will be generated in a strict linear order. */</span>
<a href="#l32.463"></a><span id="l32.463" class="difflineminus">-  sort_bydayrules(BYDAYPTR, impl-&gt;rule.week_start);</span>
<a href="#l32.464"></a><span id="l32.464" class="difflineminus">-</span>
<a href="#l32.465"></a><span id="l32.465">   /* If we get here, we need to step to tne next day */</span>
<a href="#l32.466"></a><span id="l32.466"> </span>
<a href="#l32.467"></a><span id="l32.467">   for (;;) {</span>
<a href="#l32.468"></a><span id="l32.468">       struct icaltimetype tt = icaltime_null_time();</span>
<a href="#l32.469"></a><span id="l32.469">       BYDAYIDX++; /* Look at next elem in BYDAY array */</span>
<a href="#l32.470"></a><span id="l32.470">       </span>
<a href="#l32.471"></a><span id="l32.471">       /* Are we at the end of the BYDAY array? */</span>
<a href="#l32.472"></a><span id="l32.472">       if (BYDAYPTR[BYDAYIDX]==ICAL_RECURRENCE_ARRAY_MAX){</span>
<a href="#l32.473"></a><span id="l32.473" class="difflineat">@@ -1856,17 +1903,17 @@ static pvl_list expand_by_day(icalrecur_</span>
<a href="#l32.474"></a><span id="l32.474"> </span>
<a href="#l32.475"></a><span id="l32.475"> </span>
<a href="#l32.476"></a><span id="l32.476"> /* For INTERVAL=YEARLY, set up the days[] array in the iterator to</span>
<a href="#l32.477"></a><span id="l32.477">    list all of the days of the current year that are specified in this</span>
<a href="#l32.478"></a><span id="l32.478">    rule. */</span>
<a href="#l32.479"></a><span id="l32.479"> </span>
<a href="#l32.480"></a><span id="l32.480"> static int expand_year_days(icalrecur_iterator* impl, int year)</span>
<a href="#l32.481"></a><span id="l32.481"> {</span>
<a href="#l32.482"></a><span id="l32.482" class="difflineminus">-    int j,k;</span>
<a href="#l32.483"></a><span id="l32.483" class="difflineplus">+    int i,j,k;</span>
<a href="#l32.484"></a><span id="l32.484">     int days_index=0;</span>
<a href="#l32.485"></a><span id="l32.485">     struct icaltimetype t;</span>
<a href="#l32.486"></a><span id="l32.486">     int flags;</span>
<a href="#l32.487"></a><span id="l32.487"> </span>
<a href="#l32.488"></a><span id="l32.488">     t = icaltime_null_date();</span>
<a href="#l32.489"></a><span id="l32.489"> </span>
<a href="#l32.490"></a><span id="l32.490"> #define HBD(x) has_by_data(impl,x)</span>
<a href="#l32.491"></a><span id="l32.491"> </span>
<a href="#l32.492"></a><span id="l32.492" class="difflineat">@@ -1878,16 +1925,56 @@ static int expand_year_days(icalrecur_it</span>
<a href="#l32.493"></a><span id="l32.493"> </span>
<a href="#l32.494"></a><span id="l32.494">     flags = (HBD(BY_DAY) ? 1&lt;&lt;BY_DAY : 0) + </span>
<a href="#l32.495"></a><span id="l32.495">         (HBD(BY_WEEK_NO) ? 1&lt;&lt;BY_WEEK_NO : 0) + </span>
<a href="#l32.496"></a><span id="l32.496">         (HBD(BY_MONTH_DAY) ? 1&lt;&lt;BY_MONTH_DAY : 0) + </span>
<a href="#l32.497"></a><span id="l32.497">         (HBD(BY_MONTH) ? 1&lt;&lt;BY_MONTH : 0) + </span>
<a href="#l32.498"></a><span id="l32.498">         (HBD(BY_YEAR_DAY) ? 1&lt;&lt;BY_YEAR_DAY : 0);</span>
<a href="#l32.499"></a><span id="l32.499"> </span>
<a href="#l32.500"></a><span id="l32.500">     </span>
<a href="#l32.501"></a><span id="l32.501" class="difflineplus">+    /* BY_WEEK_NO together with BY_MONTH - may conflict, in this case BY_MONTH wins */</span>
<a href="#l32.502"></a><span id="l32.502" class="difflineplus">+    if( (flags &amp; 1&lt;&lt;BY_MONTH) &amp;&amp; (flags &amp; 1&lt;&lt;BY_WEEK_NO) ){</span>
<a href="#l32.503"></a><span id="l32.503" class="difflineplus">+        int valid_weeks[ICAL_BY_WEEKNO_SIZE];</span>
<a href="#l32.504"></a><span id="l32.504" class="difflineplus">+        int valid = 1;    </span>
<a href="#l32.505"></a><span id="l32.505" class="difflineplus">+        memset(valid_weeks, 0, sizeof(valid_weeks));</span>
<a href="#l32.506"></a><span id="l32.506" class="difflineplus">+        t.year = year;</span>
<a href="#l32.507"></a><span id="l32.507" class="difflineplus">+        t.is_date = 1;</span>
<a href="#l32.508"></a><span id="l32.508" class="difflineplus">+</span>
<a href="#l32.509"></a><span id="l32.509" class="difflineplus">+        /* calculate valid week numbers */</span>
<a href="#l32.510"></a><span id="l32.510" class="difflineplus">+        for(j=0; impl-&gt;by_ptrs[BY_MONTH][j]!=ICAL_RECURRENCE_ARRAY_MAX; j++){</span>
<a href="#l32.511"></a><span id="l32.511" class="difflineplus">+            int month = impl-&gt;by_ptrs[BY_MONTH][j];</span>
<a href="#l32.512"></a><span id="l32.512" class="difflineplus">+            int first_week, last_week;</span>
<a href="#l32.513"></a><span id="l32.513" class="difflineplus">+            t.month = month;</span>
<a href="#l32.514"></a><span id="l32.514" class="difflineplus">+            t.day = 1;</span>
<a href="#l32.515"></a><span id="l32.515" class="difflineplus">+            first_week =  icaltime_week_number(t);</span>
<a href="#l32.516"></a><span id="l32.516" class="difflineplus">+            t.day = icaltime_days_in_month(month,year);</span>
<a href="#l32.517"></a><span id="l32.517" class="difflineplus">+            last_week =  icaltime_week_number(t);</span>
<a href="#l32.518"></a><span id="l32.518" class="difflineplus">+            for(j=first_week; j&lt;last_week; j++) {</span>
<a href="#l32.519"></a><span id="l32.519" class="difflineplus">+                valid_weeks[j] = 1;        </span>
<a href="#l32.520"></a><span id="l32.520" class="difflineplus">+            }</span>
<a href="#l32.521"></a><span id="l32.521" class="difflineplus">+        }</span>
<a href="#l32.522"></a><span id="l32.522" class="difflineplus">+</span>
<a href="#l32.523"></a><span id="l32.523" class="difflineplus">+        /* check valid weeks */</span>
<a href="#l32.524"></a><span id="l32.524" class="difflineplus">+        for(i = 0; BYWEEKPTR[i] != ICAL_RECURRENCE_ARRAY_MAX &amp;&amp; valid; i++){</span>
<a href="#l32.525"></a><span id="l32.525" class="difflineplus">+                int weekno = BYWEEKPTR[i];</span>
<a href="#l32.526"></a><span id="l32.526" class="difflineplus">+                if(weekno &lt; ICAL_BY_WEEKNO_SIZE)</span>
<a href="#l32.527"></a><span id="l32.527" class="difflineplus">+			valid &amp;= valid_weeks[i]; /* check if the week number is valid */</span>
<a href="#l32.528"></a><span id="l32.528" class="difflineplus">+                else</span>
<a href="#l32.529"></a><span id="l32.529" class="difflineplus">+			valid = 0;  /* invalid week number */</span>
<a href="#l32.530"></a><span id="l32.530" class="difflineplus">+        }</span>
<a href="#l32.531"></a><span id="l32.531" class="difflineplus">+</span>
<a href="#l32.532"></a><span id="l32.532" class="difflineplus">+        /* let us make the decision which rule to keep */</span>
<a href="#l32.533"></a><span id="l32.533" class="difflineplus">+        if(valid) { /* BYWEEKNO wins */</span>
<a href="#l32.534"></a><span id="l32.534" class="difflineplus">+            flags -= 1&lt;&lt;BY_MONTH;</span>
<a href="#l32.535"></a><span id="l32.535" class="difflineplus">+        }</span>
<a href="#l32.536"></a><span id="l32.536" class="difflineplus">+        else { /* BYMONTH vins */</span>
<a href="#l32.537"></a><span id="l32.537" class="difflineplus">+            flags -= 1&lt;&lt;BY_WEEK_NO;</span>
<a href="#l32.538"></a><span id="l32.538" class="difflineplus">+        }</span>
<a href="#l32.539"></a><span id="l32.539" class="difflineplus">+    }</span>
<a href="#l32.540"></a><span id="l32.540" class="difflineplus">+</span>
<a href="#l32.541"></a><span id="l32.541">     switch(flags) {</span>
<a href="#l32.542"></a><span id="l32.542">         </span>
<a href="#l32.543"></a><span id="l32.543">     case 0: {</span>
<a href="#l32.544"></a><span id="l32.544">         /* FREQ=YEARLY; */</span>
<a href="#l32.545"></a><span id="l32.545">         t = impl-&gt;dtstart;</span>
<a href="#l32.546"></a><span id="l32.546">         t.year = impl-&gt;last.year;</span>
<a href="#l32.547"></a><span id="l32.547">         </span>
<a href="#l32.548"></a><span id="l32.548">         impl-&gt;days[days_index++] = (short)icaltime_day_of_year(t);</span>
<a href="#l32.549"></a><span id="l32.549" class="difflineat">@@ -2017,17 +2104,34 @@ static int expand_year_days(icalrecur_it</span>
<a href="#l32.550"></a><span id="l32.550"> </span>
<a href="#l32.551"></a><span id="l32.551"> 	    /* This holds the day offset used to calculate the day of the year</span>
<a href="#l32.552"></a><span id="l32.552"> 	       from the month day. Just add the month day to this. */</span>
<a href="#l32.553"></a><span id="l32.553"> 	    doy_offset = icaltime_day_of_year(t) - 1;</span>
<a href="#l32.554"></a><span id="l32.554"> </span>
<a href="#l32.555"></a><span id="l32.555"> 	    t.day = days_in_month;</span>
<a href="#l32.556"></a><span id="l32.556"> 	    last_dow = icaltime_day_of_week(t);</span>
<a href="#l32.557"></a><span id="l32.557"> </span>
<a href="#l32.558"></a><span id="l32.558" class="difflineminus">-	    for(k=0;impl-&gt;by_ptrs[BY_DAY][k]!=ICAL_RECURRENCE_ARRAY_MAX;k++){</span>
<a href="#l32.559"></a><span id="l32.559" class="difflineplus">+	    if(has_by_data(impl,BY_SET_POS)) {</span>
<a href="#l32.560"></a><span id="l32.560" class="difflineplus">+	        /*FREQ=YEARLY; BYDAY=TH,20MO,-10FR; BYMONTH = 12; BYSETPOS=1*/</span>
<a href="#l32.561"></a><span id="l32.561" class="difflineplus">+	        int day;</span>
<a href="#l32.562"></a><span id="l32.562" class="difflineplus">+	        int set_pos_counter = 0;</span>
<a href="#l32.563"></a><span id="l32.563" class="difflineplus">+	        int set_pos_total = 0;</span>
<a href="#l32.564"></a><span id="l32.564" class="difflineplus">+	        int by_month_day[ICAL_BY_MONTHDAY_SIZE];</span>
<a href="#l32.565"></a><span id="l32.565" class="difflineplus">+	        for(day = 1; day &lt;= days_in_month; day++){</span>
<a href="#l32.566"></a><span id="l32.566" class="difflineplus">+	            t.day = day;</span>
<a href="#l32.567"></a><span id="l32.567" class="difflineplus">+	            if(is_day_in_byday(impl,t))</span>
<a href="#l32.568"></a><span id="l32.568" class="difflineplus">+	                by_month_day[set_pos_total++] = day;</span>
<a href="#l32.569"></a><span id="l32.569" class="difflineplus">+	        }</span>
<a href="#l32.570"></a><span id="l32.570" class="difflineplus">+	        for(set_pos_counter = 0; set_pos_counter &lt; set_pos_total; set_pos_counter++){</span>
<a href="#l32.571"></a><span id="l32.571" class="difflineplus">+	            if(check_set_position(impl, set_pos_counter+1) ||</span>
<a href="#l32.572"></a><span id="l32.572" class="difflineplus">+	                	check_set_position(impl, set_pos_counter-set_pos_total))</span>
<a href="#l32.573"></a><span id="l32.573" class="difflineplus">+	                impl-&gt;days[days_index++] = doy_offset + by_month_day[set_pos_counter];</span>
<a href="#l32.574"></a><span id="l32.574" class="difflineplus">+	        }</span>
<a href="#l32.575"></a><span id="l32.575" class="difflineplus">+	    }</span>
<a href="#l32.576"></a><span id="l32.576" class="difflineplus">+	    else for(k=0;impl-&gt;by_ptrs[BY_DAY][k]!=ICAL_RECURRENCE_ARRAY_MAX;k++){</span>
<a href="#l32.577"></a><span id="l32.577"> 	        short day_coded = impl-&gt;by_ptrs[BY_DAY][k];</span>
<a href="#l32.578"></a><span id="l32.578"> 		enum icalrecurrencetype_weekday dow =</span>
<a href="#l32.579"></a><span id="l32.579"> 		  icalrecurrencetype_day_day_of_week(day_coded);</span>
<a href="#l32.580"></a><span id="l32.580"> 		int pos = icalrecurrencetype_day_position(day_coded);  </span>
<a href="#l32.581"></a><span id="l32.581"> 		int first_matching_day, last_matching_day, day, month_day;</span>
<a href="#l32.582"></a><span id="l32.582"> </span>
<a href="#l32.583"></a><span id="l32.583"> 		/* Calculate the first day in the month with the given weekday,</span>
<a href="#l32.584"></a><span id="l32.584"> 		   and the last day. */</span>
<a href="#l32.585"></a><span id="l32.585" class="difflineat">@@ -2258,18 +2362,18 @@ static int check_contracting_rules(icalr</span>
<a href="#l32.586"></a><span id="l32.586">     } else {</span>
<a href="#l32.587"></a><span id="l32.587"> 	return 0;</span>
<a href="#l32.588"></a><span id="l32.588">     }</span>
<a href="#l32.589"></a><span id="l32.589"> }</span>
<a href="#l32.590"></a><span id="l32.590"> </span>
<a href="#l32.591"></a><span id="l32.591"> struct icaltimetype icalrecur_iterator_next(icalrecur_iterator *impl)</span>
<a href="#l32.592"></a><span id="l32.592"> {</span>
<a href="#l32.593"></a><span id="l32.593">     int valid = 1;</span>
<a href="#l32.594"></a><span id="l32.594" class="difflineminus">-    </span>
<a href="#l32.595"></a><span id="l32.595" class="difflineminus">-    if( (impl-&gt;rule.count!=0 &amp;&amp;impl-&gt;occurrence_no &gt;= impl-&gt;rule.count) ||</span>
<a href="#l32.596"></a><span id="l32.596" class="difflineplus">+</span>
<a href="#l32.597"></a><span id="l32.597" class="difflineplus">+    if( !impl ||  (impl-&gt;rule.count!=0 &amp;&amp;impl-&gt;occurrence_no &gt;= impl-&gt;rule.count) ||</span>
<a href="#l32.598"></a><span id="l32.598">        (!icaltime_is_null_time(impl-&gt;rule.until) &amp;&amp; </span>
<a href="#l32.599"></a><span id="l32.599"> 	icaltime_compare(impl-&gt;last,impl-&gt;rule.until) &gt; 0)) {</span>
<a href="#l32.600"></a><span id="l32.600"> 	return icaltime_null_time();</span>
<a href="#l32.601"></a><span id="l32.601">     }</span>
<a href="#l32.602"></a><span id="l32.602"> </span>
<a href="#l32.603"></a><span id="l32.603">     if(impl-&gt;occurrence_no == 0 </span>
<a href="#l32.604"></a><span id="l32.604">        &amp;&amp;  icaltime_compare(impl-&gt;last,impl-&gt;dtstart) &gt;= 0){</span>
<a href="#l32.605"></a><span id="l32.605"> </span>
<a href="#l32.606"></a><span id="l32.606" class="difflineat">@@ -2310,16 +2414,21 @@ struct icaltimetype icalrecur_iterator_n</span>
<a href="#l32.607"></a><span id="l32.607"> 		break;</span>
<a href="#l32.608"></a><span id="l32.608"> 	    }</span>
<a href="#l32.609"></a><span id="l32.609"> 	    default:{</span>
<a href="#l32.610"></a><span id="l32.610"> 		icalerror_set_errno(ICAL_MALFORMEDDATA_ERROR);</span>
<a href="#l32.611"></a><span id="l32.611">                 return icaltime_null_time();</span>
<a href="#l32.612"></a><span id="l32.612"> 	    }</span>
<a href="#l32.613"></a><span id="l32.613"> 	}    </span>
<a href="#l32.614"></a><span id="l32.614"> 	</span>
<a href="#l32.615"></a><span id="l32.615" class="difflineplus">+	if(impl-&gt;last.year &gt;= 2038 ){</span>
<a href="#l32.616"></a><span id="l32.616" class="difflineplus">+	    /* HACK */</span>
<a href="#l32.617"></a><span id="l32.617" class="difflineplus">+	    return icaltime_null_time();</span>
<a href="#l32.618"></a><span id="l32.618" class="difflineplus">+	}</span>
<a href="#l32.619"></a><span id="l32.619" class="difflineplus">+	</span>
<a href="#l32.620"></a><span id="l32.620">     } while(!check_contracting_rules(impl) </span>
<a href="#l32.621"></a><span id="l32.621"> 	    || icaltime_compare(impl-&gt;last,impl-&gt;dtstart) &lt; 0</span>
<a href="#l32.622"></a><span id="l32.622">             || valid == 0);</span>
<a href="#l32.623"></a><span id="l32.623">     </span>
<a href="#l32.624"></a><span id="l32.624">     </span>
<a href="#l32.625"></a><span id="l32.625"> /* Ignore null times and times that are after the until time */</span>
<a href="#l32.626"></a><span id="l32.626">     if( !icaltime_is_null_time(impl-&gt;rule.until) &amp;&amp; </span>
<a href="#l32.627"></a><span id="l32.627"> 	icaltime_compare(impl-&gt;last,impl-&gt;rule.until) &gt; 0 ) {</span>
<a href="#l32.628"></a><span id="l32.628" class="difflineat">@@ -2471,26 +2580,26 @@ int icalrecur_expand_recurrence(char* ru</span>
<a href="#l32.629"></a><span id="l32.629">     struct icaltimetype icstart, next;</span>
<a href="#l32.630"></a><span id="l32.630">     int i = 0;</span>
<a href="#l32.631"></a><span id="l32.631"> </span>
<a href="#l32.632"></a><span id="l32.632">     memset(array, 0, count*sizeof(time_t));</span>
<a href="#l32.633"></a><span id="l32.633"> </span>
<a href="#l32.634"></a><span id="l32.634">     icstart = icaltime_from_timet_with_zone(start,0,0);</span>
<a href="#l32.635"></a><span id="l32.635"> </span>
<a href="#l32.636"></a><span id="l32.636">     recur = icalrecurrencetype_from_string(rule);</span>
<a href="#l32.637"></a><span id="l32.637" class="difflineminus">-</span>
<a href="#l32.638"></a><span id="l32.638" class="difflineminus">-    for(ritr = icalrecur_iterator_new(recur,icstart),</span>
<a href="#l32.639"></a><span id="l32.639" class="difflineminus">-	next = icalrecur_iterator_next(ritr);</span>
<a href="#l32.640"></a><span id="l32.640" class="difflineminus">-	!icaltime_is_null_time(next) &amp;&amp; i &lt; count;</span>
<a href="#l32.641"></a><span id="l32.641" class="difflineminus">-	next = icalrecur_iterator_next(ritr)){</span>
<a href="#l32.642"></a><span id="l32.642" class="difflineminus">-</span>
<a href="#l32.643"></a><span id="l32.643" class="difflineminus">-	tt = icaltime_as_timet(next);</span>
<a href="#l32.644"></a><span id="l32.644" class="difflineplus">+    ritr = icalrecur_iterator_new(recur,icstart);</span>
<a href="#l32.645"></a><span id="l32.645" class="difflineplus">+    if(ritr) {</span>
<a href="#l32.646"></a><span id="l32.646" class="difflineplus">+        for(next = icalrecur_iterator_next(ritr);</span>
<a href="#l32.647"></a><span id="l32.647" class="difflineplus">+	        !icaltime_is_null_time(next) &amp;&amp; i &lt; count;</span>
<a href="#l32.648"></a><span id="l32.648" class="difflineplus">+	        next = icalrecur_iterator_next(ritr)){</span>
<a href="#l32.649"></a><span id="l32.649" class="difflineplus">+</span>
<a href="#l32.650"></a><span id="l32.650" class="difflineplus">+	            tt = icaltime_as_timet(next);</span>
<a href="#l32.651"></a><span id="l32.651"> 	</span>
<a href="#l32.652"></a><span id="l32.652" class="difflineminus">-	if (tt &gt;= start ){</span>
<a href="#l32.653"></a><span id="l32.653" class="difflineminus">-	    array[i++] = tt;</span>
<a href="#l32.654"></a><span id="l32.654" class="difflineminus">-	}</span>
<a href="#l32.655"></a><span id="l32.655" class="difflineminus">-</span>
<a href="#l32.656"></a><span id="l32.656" class="difflineplus">+                if (tt &gt;= start ){</span>
<a href="#l32.657"></a><span id="l32.657" class="difflineplus">+	                   array[i++] = tt;</span>
<a href="#l32.658"></a><span id="l32.658" class="difflineplus">+	            }</span>
<a href="#l32.659"></a><span id="l32.659" class="difflineplus">+        }</span>
<a href="#l32.660"></a><span id="l32.660" class="difflineplus">+    icalrecur_iterator_free(ritr);</span>
<a href="#l32.661"></a><span id="l32.661">     }</span>
<a href="#l32.662"></a><span id="l32.662"> </span>
<a href="#l32.663"></a><span id="l32.663" class="difflineminus">-    icalrecur_iterator_free(ritr);</span>
<a href="#l32.664"></a><span id="l32.664"> </span>
<a href="#l32.665"></a><span id="l32.665">     return 1;</span>
<a href="#l32.666"></a><span id="l32.666"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/libical/src/libical/icalrestriction.c.in</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalrestriction.c.in</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -1,29 +1,44 @@</span>
<a href="#l33.4"></a><span id="l33.4"> /*  -*- Mode: C -*- */</span>
<a href="#l33.5"></a><span id="l33.5"> /*  ======================================================================</span>
<a href="#l33.6"></a><span id="l33.6">   File: icalrestriction.c</span>
<a href="#l33.7"></a><span id="l33.7" class="difflineminus">-    </span>
<a href="#l33.8"></a><span id="l33.8" class="difflineplus">+</span>
<a href="#l33.9"></a><span id="l33.9" class="difflineplus">+  This program is free software; you can redistribute it and/or modify</span>
<a href="#l33.10"></a><span id="l33.10" class="difflineplus">+  it under the terms of either:</span>
<a href="#l33.11"></a><span id="l33.11" class="difflineplus">+</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+    The LGPL as published by the Free Software Foundation, version</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    2.1, available at: http://www.fsf.org/copyleft/lesser.html</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineplus">+</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+  Or:</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineplus">+    The Mozilla Public License Version 1.0. You may obtain a copy of</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+    the License at http://www.mozilla.org/MPL/</span>
<a href="#l33.19"></a><span id="l33.19" class="difflineplus">+</span>
<a href="#l33.20"></a><span id="l33.20">  (C) COPYRIGHT 2000, Eric Busboom, http://www.softwarestudio.org</span>
<a href="#l33.21"></a><span id="l33.21">  ======================================================================*/</span>
<a href="#l33.22"></a><span id="l33.22"> /*#line 7 &quot;icalrestriction.c.in&quot;*/</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24"> #ifdef HAVE_CONFIG_H</span>
<a href="#l33.25"></a><span id="l33.25"> #include &lt;config.h&gt;</span>
<a href="#l33.26"></a><span id="l33.26"> #endif</span>
<a href="#l33.27"></a><span id="l33.27"> </span>
<a href="#l33.28"></a><span id="l33.28"> #include &quot;icalrestriction.h&quot;</span>
<a href="#l33.29"></a><span id="l33.29"> #include &quot;icalenums.h&quot;</span>
<a href="#l33.30"></a><span id="l33.30"> #include &quot;icalerror.h&quot;</span>
<a href="#l33.31"></a><span id="l33.31"> </span>
<a href="#l33.32"></a><span id="l33.32"> #include &lt;assert.h&gt;</span>
<a href="#l33.33"></a><span id="l33.33"> #include &lt;stdio.h&gt; /* For snprintf */   </span>
<a href="#l33.34"></a><span id="l33.34" class="difflineplus">+</span>
<a href="#l33.35"></a><span id="l33.35"> #ifdef WIN32</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineminus">-#define snprintf _snprintf</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineplus">+#include &quot;vsnprintf.h&quot;</span>
<a href="#l33.39"></a><span id="l33.39"> #endif</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineplus">+#endif</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineplus">+</span>
<a href="#l33.42"></a><span id="l33.42"> </span>
<a href="#l33.43"></a><span id="l33.43"> #define TMP_BUF_SIZE 1024</span>
<a href="#l33.44"></a><span id="l33.44"> </span>
<a href="#l33.45"></a><span id="l33.45"> /* Define the structs for the restrictions. these data are filled out</span>
<a href="#l33.46"></a><span id="l33.46"> in machine generated code below */</span>
<a href="#l33.47"></a><span id="l33.47"> </span>
<a href="#l33.48"></a><span id="l33.48"> struct icalrestriction_property_record;</span>
<a href="#l33.49"></a><span id="l33.49"> </span>
<a href="#l33.50"></a><span id="l33.50" class="difflineat">@@ -279,17 +294,17 @@ const char* icalrestriction_must_if_tz_r</span>
<a href="#l33.51"></a><span id="l33.51"> const char* icalrestriction_no_dtend(</span>
<a href="#l33.52"></a><span id="l33.52"> 		const icalrestriction_property_record *rec,</span>
<a href="#l33.53"></a><span id="l33.53"> 		icalcomponent* comp,</span>
<a href="#l33.54"></a><span id="l33.54"> 		icalproperty* prop)</span>
<a href="#l33.55"></a><span id="l33.55"> {</span>
<a href="#l33.56"></a><span id="l33.56"> </span>
<a href="#l33.57"></a><span id="l33.57">     (void)rec;</span>
<a href="#l33.58"></a><span id="l33.58">     (void)prop;</span>
<a href="#l33.59"></a><span id="l33.59" class="difflineminus">-    if( !icalcomponent_get_first_property(comp,ICAL_DTEND_PROPERTY)){</span>
<a href="#l33.60"></a><span id="l33.60" class="difflineplus">+    if(icalcomponent_get_first_property(comp,ICAL_DTEND_PROPERTY)){</span>
<a href="#l33.61"></a><span id="l33.61"> </span>
<a href="#l33.62"></a><span id="l33.62"> 	return &quot;Failed iTIP restrictions for DTEND property. The component must not have both DURATION and DTEND&quot;;</span>
<a href="#l33.63"></a><span id="l33.63"> </span>
<a href="#l33.64"></a><span id="l33.64">     }</span>
<a href="#l33.65"></a><span id="l33.65"> </span>
<a href="#l33.66"></a><span id="l33.66">     return 0;    </span>
<a href="#l33.67"></a><span id="l33.67"> }</span>
<a href="#l33.68"></a><span id="l33.68"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/libical/src/libical/icaltime.c</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/libical/src/libical/icaltime.c</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -324,16 +324,17 @@ char* set_tz(const char* tzid)</span>
<a href="#l34.4"></a><span id="l34.4"> 	strcpy (old_tz_copy + 3, old_tz);</span>
<a href="#l34.5"></a><span id="l34.5">     }</span>
<a href="#l34.6"></a><span id="l34.6"> </span>
<a href="#l34.7"></a><span id="l34.7">     /* Create the new TZ string. */</span>
<a href="#l34.8"></a><span id="l34.8">     new_tz = (char*)malloc(strlen (tzid) + 4);</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">     if(new_tz == 0){</span>
<a href="#l34.11"></a><span id="l34.11"> 	icalerror_set_errno(ICAL_NEWFAILED_ERROR);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+	free(old_tz_copy);</span>
<a href="#l34.13"></a><span id="l34.13"> 	return 0;</span>
<a href="#l34.14"></a><span id="l34.14">     }</span>
<a href="#l34.15"></a><span id="l34.15"> </span>
<a href="#l34.16"></a><span id="l34.16">     strcpy (new_tz, &quot;TZ=&quot;);</span>
<a href="#l34.17"></a><span id="l34.17">     strcpy (new_tz + 3, tzid);</span>
<a href="#l34.18"></a><span id="l34.18"> </span>
<a href="#l34.19"></a><span id="l34.19">     /* Add the new TZ to the environment. */</span>
<a href="#l34.20"></a><span id="l34.20">     putenv(new_tz); </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/libical/src/libical/icaltimezone.c</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/libical/src/libical/icaltimezone.c</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -35,104 +35,63 @@</span>
<a href="#l35.4"></a><span id="l35.4"> #include &lt;stdlib.h&gt;</span>
<a href="#l35.5"></a><span id="l35.5"> #include &lt;string.h&gt;</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7"> #include &quot;icalproperty.h&quot;</span>
<a href="#l35.8"></a><span id="l35.8"> #include &quot;icalarray.h&quot;</span>
<a href="#l35.9"></a><span id="l35.9"> #include &quot;icalerror.h&quot;</span>
<a href="#l35.10"></a><span id="l35.10"> #include &quot;icalparser.h&quot;</span>
<a href="#l35.11"></a><span id="l35.11"> #include &quot;icaltimezone.h&quot;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-#ifndef NO_ZONES_TAB</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+#include &quot;icaltimezoneimpl.h&quot;</span>
<a href="#l35.14"></a><span id="l35.14"> #include &quot;icaltz-util.h&quot;</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">-#endif</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17"> #include &lt;sys/stat.h&gt;</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19"> #ifdef WIN32</span>
<a href="#l35.20"></a><span id="l35.20"> #include &lt;mbstring.h&gt;</span>
<a href="#l35.21"></a><span id="l35.21"> #include &lt;windows.h&gt;</span>
<a href="#l35.22"></a><span id="l35.22"> /* Undef the similar macro from pthread.h, it doesn't check if</span>
<a href="#l35.23"></a><span id="l35.23">  * gmtime() returns NULL.</span>
<a href="#l35.24"></a><span id="l35.24">  */</span>
<a href="#l35.25"></a><span id="l35.25"> #undef gmtime_r</span>
<a href="#l35.26"></a><span id="l35.26"> </span>
<a href="#l35.27"></a><span id="l35.27"> /* The gmtime() in Microsoft's C library is MT-safe */</span>
<a href="#l35.28"></a><span id="l35.28"> #define gmtime_r(tp,tmp) (gmtime(tp)?(*(tmp)=*gmtime(tp),(tmp)):0)</span>
<a href="#l35.29"></a><span id="l35.29"> </span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">-#define snprintf _snprintf</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-#define strcasecmp stricmp</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+// MSVC lacks the POSIX macro S_ISDIR, however it's a trivial one:</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+#ifndef S_ISDIR</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+#define S_ISDIR(m) (((m) &amp; _S_IFMT) == _S_IFDIR)</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+#include &quot;vsnprintf.h&quot;</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineplus">+#endif</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineplus">+#endif</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+#define strcasecmp      stricmp</span>
<a href="#l35.41"></a><span id="l35.41"> #endif</span>
<a href="#l35.42"></a><span id="l35.42"> </span>
<a href="#l35.43"></a><span id="l35.43"> /** This is the toplevel directory where the timezone data is installed in. */</span>
<a href="#l35.44"></a><span id="l35.44"> #define ZONEINFO_DIRECTORY	PACKAGE_DATA_DIR &quot;/zoneinfo&quot;</span>
<a href="#l35.45"></a><span id="l35.45"> </span>
<a href="#l35.46"></a><span id="l35.46" class="difflineminus">-/** The prefix we use to uniquely identify TZIDs. */</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineminus">-#define TZID_PREFIX		&quot;/citadel.org/&quot;</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineminus">-#define TZID_PREFIX_LEN		13</span>
<a href="#l35.49"></a><span id="l35.49" class="difflineplus">+/** The prefix we use to uniquely identify TZIDs.</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineplus">+    It must begin and end with forward slashes.</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+ */</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineplus">+const char *ical_tzid_prefix =	&quot;/freeassociation.sourceforge.net/&quot;;</span>
<a href="#l35.53"></a><span id="l35.53"> </span>
<a href="#l35.54"></a><span id="l35.54"> /** This is the filename of the file containing the city names and</span>
<a href="#l35.55"></a><span id="l35.55">     coordinates of all the builtin timezones. */</span>
<a href="#l35.56"></a><span id="l35.56"> #define ZONES_TAB_FILENAME	&quot;zones.tab&quot;</span>
<a href="#l35.57"></a><span id="l35.57"> </span>
<a href="#l35.58"></a><span id="l35.58"> /** This is the number of years of extra coverage we do when expanding</span>
<a href="#l35.59"></a><span id="l35.59">     the timezone changes. */</span>
<a href="#l35.60"></a><span id="l35.60"> #define ICALTIMEZONE_EXTRA_COVERAGE	5</span>
<a href="#l35.61"></a><span id="l35.61"> </span>
<a href="#l35.62"></a><span id="l35.62"> /** This is the maximum year we will expand to. time_t values only go up to</span>
<a href="#l35.63"></a><span id="l35.63">     somewhere around 2037. */</span>
<a href="#l35.64"></a><span id="l35.64"> #define ICALTIMEZONE_MAX_YEAR		2035</span>
<a href="#l35.65"></a><span id="l35.65"> </span>
<a href="#l35.66"></a><span id="l35.66" class="difflineminus">-struct _icaltimezone {</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineminus">-    char		*tzid;</span>
<a href="#l35.68"></a><span id="l35.68" class="difflineminus">-    /**&lt; The unique ID of this timezone,</span>
<a href="#l35.69"></a><span id="l35.69" class="difflineminus">-       e.g. &quot;/citadel.org/Olson_20010601_1/Africa/Banjul&quot;.</span>
<a href="#l35.70"></a><span id="l35.70" class="difflineminus">-       This should only be used to identify a VTIMEZONE. It is not</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineminus">-       meant to be displayed to the user in any form. */</span>
<a href="#l35.72"></a><span id="l35.72" class="difflineminus">-</span>
<a href="#l35.73"></a><span id="l35.73" class="difflineminus">-    char		*location;</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineminus">-    /**&lt; The location for the timezone, e.g. &quot;Africa/Accra&quot; for the</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineminus">-       Olson database. We look for this in the &quot;LOCATION&quot; or</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineminus">-       &quot;X-LIC-LOCATION&quot; properties of the VTIMEZONE component. It</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineminus">-       isn't a standard property yet. This will be NULL if no location</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineminus">-       is found in the VTIMEZONE. */</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineminus">-</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineminus">-    char		*tznames;</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineminus">-    /**&lt; This will be set to a combination of the TZNAME properties</span>
<a href="#l35.82"></a><span id="l35.82" class="difflineminus">-       from the last STANDARD and DAYLIGHT components in the</span>
<a href="#l35.83"></a><span id="l35.83" class="difflineminus">-       VTIMEZONE, e.g. &quot;EST/EDT&quot;.  If they both use the same TZNAME,</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineminus">-       or only one type of component is found, then only one TZNAME</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineminus">-       will appear, e.g. &quot;AZOT&quot;. If no TZNAME is found this will be</span>
<a href="#l35.86"></a><span id="l35.86" class="difflineminus">-       NULL. */</span>
<a href="#l35.87"></a><span id="l35.87" class="difflineminus">-</span>
<a href="#l35.88"></a><span id="l35.88" class="difflineminus">-    double		 latitude;</span>
<a href="#l35.89"></a><span id="l35.89" class="difflineminus">-    double		 longitude;</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineminus">-    /**&lt; The coordinates of the city, in degrees. */</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineminus">-</span>
<a href="#l35.92"></a><span id="l35.92" class="difflineminus">-    icalcomponent	*component;</span>
<a href="#l35.93"></a><span id="l35.93" class="difflineminus">-    /**&lt; The toplevel VTIMEZONE component loaded from the .ics file for this</span>
<a href="#l35.94"></a><span id="l35.94" class="difflineminus">-         timezone. If we need to regenerate the changes data we need this. */</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineminus">-</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineminus">-    icaltimezone	*builtin_timezone;</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineminus">-    /**&lt; If this is not NULL it points to the builtin icaltimezone</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineminus">-       that the above TZID refers to. This icaltimezone should be used</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineminus">-       instead when accessing the timezone changes data, so that the</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineminus">-       expanded timezone changes data is shared between calendar</span>
<a href="#l35.101"></a><span id="l35.101" class="difflineminus">-       components. */</span>
<a href="#l35.102"></a><span id="l35.102" class="difflineminus">-</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineminus">-    int			 end_year;</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineminus">-    /**&lt; This is the last year for which we have expanded the data to.</span>
<a href="#l35.105"></a><span id="l35.105" class="difflineminus">-       If we need to calculate a date past this we need to expand the</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineminus">-       timezone component data from scratch. */</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineminus">-</span>
<a href="#l35.108"></a><span id="l35.108" class="difflineminus">-    icalarray		*changes;</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineminus">-    /**&lt; A dynamically-allocated array of time zone changes, sorted by the</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineminus">-       time of the change in local time. So we can do fast binary-searches</span>
<a href="#l35.111"></a><span id="l35.111" class="difflineminus">-       to convert from local time to UTC. */</span>
<a href="#l35.112"></a><span id="l35.112" class="difflineminus">-};</span>
<a href="#l35.113"></a><span id="l35.113" class="difflineminus">-</span>
<a href="#l35.114"></a><span id="l35.114"> typedef struct _icaltimezonechange	icaltimezonechange;</span>
<a href="#l35.115"></a><span id="l35.115"> </span>
<a href="#l35.116"></a><span id="l35.116"> struct _icaltimezonechange {</span>
<a href="#l35.117"></a><span id="l35.117">     int		 utc_offset;</span>
<a href="#l35.118"></a><span id="l35.118">     /**&lt; The offset to add to UTC to get local time, in seconds. */</span>
<a href="#l35.119"></a><span id="l35.119"> </span>
<a href="#l35.120"></a><span id="l35.120">     int		 prev_utc_offset;</span>
<a href="#l35.121"></a><span id="l35.121">     /**&lt; The offset to add to UTC, before this change, in seconds. */</span>
<a href="#l35.122"></a><span id="l35.122" class="difflineat">@@ -148,20 +107,20 @@ struct _icaltimezonechange {</span>
<a href="#l35.123"></a><span id="l35.123">        since we haven't changed to the new offset yet. */</span>
<a href="#l35.124"></a><span id="l35.124"> </span>
<a href="#l35.125"></a><span id="l35.125">     int		 is_daylight;</span>
<a href="#l35.126"></a><span id="l35.126">     /**&lt; Whether this is STANDARD or DAYLIGHT time. */</span>
<a href="#l35.127"></a><span id="l35.127"> };</span>
<a href="#l35.128"></a><span id="l35.128"> </span>
<a href="#l35.129"></a><span id="l35.129"> </span>
<a href="#l35.130"></a><span id="l35.130"> /** An array of icaltimezones for the builtin timezones. */</span>
<a href="#l35.131"></a><span id="l35.131" class="difflineminus">-static icalarray *s_builtin_timezones = NULL;</span>
<a href="#l35.132"></a><span id="l35.132" class="difflineplus">+static icalarray *builtin_timezones = NULL;</span>
<a href="#l35.133"></a><span id="l35.133"> </span>
<a href="#l35.134"></a><span id="l35.134" class="difflineminus">-/** This is the special UTC timezone, which isn't in s_builtin_timezones. */</span>
<a href="#l35.135"></a><span id="l35.135" class="difflineminus">-static icaltimezone utc_timezone = { (char *) &quot;UTC&quot;, NULL, NULL, 0.0, 0.0, NULL, NULL, 0, NULL };</span>
<a href="#l35.136"></a><span id="l35.136" class="difflineplus">+/** This is the special UTC timezone, which isn't in builtin_timezones. */</span>
<a href="#l35.137"></a><span id="l35.137" class="difflineplus">+static icaltimezone utc_timezone = { 0, 0, 0, 0, 0, 0, 0, 0, 0 };</span>
<a href="#l35.138"></a><span id="l35.138"> </span>
<a href="#l35.139"></a><span id="l35.139"> static char* zone_files_directory = NULL;</span>
<a href="#l35.140"></a><span id="l35.140"> </span>
<a href="#l35.141"></a><span id="l35.141"> static void  icaltimezone_reset			(icaltimezone *zone);</span>
<a href="#l35.142"></a><span id="l35.142"> static char* icaltimezone_get_location_from_vtimezone (icalcomponent *component);</span>
<a href="#l35.143"></a><span id="l35.143"> static char* icaltimezone_get_tznames_from_vtimezone (icalcomponent *component);</span>
<a href="#l35.144"></a><span id="l35.144"> static void  icaltimezone_expand_changes	(icaltimezone	*zone,</span>
<a href="#l35.145"></a><span id="l35.145"> 						 int		 end_year);</span>
<a href="#l35.146"></a><span id="l35.146" class="difflineat">@@ -190,16 +149,18 @@ static int   icaltimezone_get_vtimezone_</span>
<a href="#l35.147"></a><span id="l35.147"> </span>
<a href="#l35.148"></a><span id="l35.148"> </span>
<a href="#l35.149"></a><span id="l35.149"> static void  icaltimezone_load_builtin_timezone	(icaltimezone *zone);</span>
<a href="#l35.150"></a><span id="l35.150"> </span>
<a href="#l35.151"></a><span id="l35.151"> static void  icaltimezone_ensure_coverage	(icaltimezone *zone,</span>
<a href="#l35.152"></a><span id="l35.152"> 						 int		 end_year);</span>
<a href="#l35.153"></a><span id="l35.153"> </span>
<a href="#l35.154"></a><span id="l35.154"> </span>
<a href="#l35.155"></a><span id="l35.155" class="difflineplus">+static void  icaltimezone_init_builtin_timezones(void);</span>
<a href="#l35.156"></a><span id="l35.156" class="difflineplus">+</span>
<a href="#l35.157"></a><span id="l35.157"> static void  icaltimezone_parse_zone_tab	(void);</span>
<a href="#l35.158"></a><span id="l35.158"> </span>
<a href="#l35.159"></a><span id="l35.159"> #ifdef USE_BUILTIN_TZDATA</span>
<a href="#l35.160"></a><span id="l35.160"> static char* icaltimezone_load_get_line_fn	(char		*s,</span>
<a href="#l35.161"></a><span id="l35.161"> 						 size_t		 size,</span>
<a href="#l35.162"></a><span id="l35.162"> 						 void		*data);</span>
<a href="#l35.163"></a><span id="l35.163"> #endif</span>
<a href="#l35.164"></a><span id="l35.164"> </span>
<a href="#l35.165"></a><span id="l35.165" class="difflineat">@@ -231,20 +192,28 @@ icaltimezone_copy			(icaltimezone *origi</span>
<a href="#l35.166"></a><span id="l35.166"> </span>
<a href="#l35.167"></a><span id="l35.167">     zone = (icaltimezone*) malloc (sizeof (icaltimezone));</span>
<a href="#l35.168"></a><span id="l35.168">     if (!zone) {</span>
<a href="#l35.169"></a><span id="l35.169"> 	icalerror_set_errno (ICAL_NEWFAILED_ERROR);</span>
<a href="#l35.170"></a><span id="l35.170"> 	return NULL;</span>
<a href="#l35.171"></a><span id="l35.171">     }</span>
<a href="#l35.172"></a><span id="l35.172"> </span>
<a href="#l35.173"></a><span id="l35.173">     memcpy (zone, originalzone, sizeof (icaltimezone));</span>
<a href="#l35.174"></a><span id="l35.174" class="difflineplus">+    if (zone-&gt;tzid != NULL) </span>
<a href="#l35.175"></a><span id="l35.175" class="difflineplus">+	zone-&gt;tzid = strdup (zone-&gt;tzid);</span>
<a href="#l35.176"></a><span id="l35.176">     if (zone-&gt;location != NULL) </span>
<a href="#l35.177"></a><span id="l35.177"> 	zone-&gt;location = strdup (zone-&gt;location);</span>
<a href="#l35.178"></a><span id="l35.178">     if (zone-&gt;tznames != NULL)</span>
<a href="#l35.179"></a><span id="l35.179"> 	zone-&gt;tznames = strdup (zone-&gt;tznames);</span>
<a href="#l35.180"></a><span id="l35.180" class="difflineplus">+    if (zone-&gt;changes != NULL)</span>
<a href="#l35.181"></a><span id="l35.181" class="difflineplus">+        zone-&gt;changes = icalarray_copy(zone-&gt;changes);</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineplus">+    </span>
<a href="#l35.183"></a><span id="l35.183" class="difflineplus">+    /* Let the caller set the component because then they will</span>
<a href="#l35.184"></a><span id="l35.184" class="difflineplus">+       know to be careful not to free this reference twice. */</span>
<a href="#l35.185"></a><span id="l35.185" class="difflineplus">+    zone-&gt;component = NULL;</span>
<a href="#l35.186"></a><span id="l35.186"> </span>
<a href="#l35.187"></a><span id="l35.187">     return zone;</span>
<a href="#l35.188"></a><span id="l35.188"> }</span>
<a href="#l35.189"></a><span id="l35.189"> </span>
<a href="#l35.190"></a><span id="l35.190"> /** Frees all memory used for the icaltimezone. */</span>
<a href="#l35.191"></a><span id="l35.191"> void</span>
<a href="#l35.192"></a><span id="l35.192"> icaltimezone_free			(icaltimezone *zone,</span>
<a href="#l35.193"></a><span id="l35.193"> 					 int	       free_struct)</span>
<a href="#l35.194"></a><span id="l35.194" class="difflineat">@@ -686,17 +655,17 @@ icaltimezone_expand_vtimezone		(icalcomp</span>
<a href="#l35.195"></a><span id="l35.195"> 		   since that is the offset from UTC that will be in effect</span>
<a href="#l35.196"></a><span id="l35.196"> 		   when each of the RRULE occurrences happens. */</span>
<a href="#l35.197"></a><span id="l35.197"> 		icaltime_adjust (&amp;rrule.until, 0, 0, 0,</span>
<a href="#l35.198"></a><span id="l35.198"> 				 change.prev_utc_offset);</span>
<a href="#l35.199"></a><span id="l35.199"> 		rrule.until.is_utc = 0;</span>
<a href="#l35.200"></a><span id="l35.200"> 	    }</span>
<a href="#l35.201"></a><span id="l35.201"> </span>
<a href="#l35.202"></a><span id="l35.202"> 	    rrule_iterator = icalrecur_iterator_new (rrule, dtstart);</span>
<a href="#l35.203"></a><span id="l35.203" class="difflineminus">-	    for (;;) {</span>
<a href="#l35.204"></a><span id="l35.204" class="difflineplus">+	    for (;rrule_iterator;) {</span>
<a href="#l35.205"></a><span id="l35.205"> 		occ = icalrecur_iterator_next (rrule_iterator);</span>
<a href="#l35.206"></a><span id="l35.206"> 		if (occ.year &gt; end_year || icaltime_is_null_time (occ))</span>
<a href="#l35.207"></a><span id="l35.207"> 		    break;</span>
<a href="#l35.208"></a><span id="l35.208"> </span>
<a href="#l35.209"></a><span id="l35.209"> 		change.year   = occ.year;</span>
<a href="#l35.210"></a><span id="l35.210"> 		change.month  = occ.month;</span>
<a href="#l35.211"></a><span id="l35.211"> 		change.day    = occ.day;</span>
<a href="#l35.212"></a><span id="l35.212"> 		change.hour   = occ.hour;</span>
<a href="#l35.213"></a><span id="l35.213" class="difflineat">@@ -1274,34 +1243,33 @@ icaltimezone_get_display_name		(icaltime</span>
<a href="#l35.214"></a><span id="l35.214"> 		display_name = icaltimezone_get_tznames (zone);</span>
<a href="#l35.215"></a><span id="l35.215"> 	if (!display_name) {</span>
<a href="#l35.216"></a><span id="l35.216"> 		display_name = icaltimezone_get_tzid (zone);</span>
<a href="#l35.217"></a><span id="l35.217"> 		/* Outlook will strip out X-LIC-LOCATION property and so all</span>
<a href="#l35.218"></a><span id="l35.218"> 		   we get back in the iTIP replies is the TZID. So we see if</span>
<a href="#l35.219"></a><span id="l35.219"> 		   this is one of our TZIDs and if so we jump to the city name</span>
<a href="#l35.220"></a><span id="l35.220"> 		   at the end of it. */</span>
<a href="#l35.221"></a><span id="l35.221"> 		if (display_name</span>
<a href="#l35.222"></a><span id="l35.222" class="difflineminus">-		    &amp;&amp; !strncmp (display_name, TZID_PREFIX, TZID_PREFIX_LEN)) {</span>
<a href="#l35.223"></a><span id="l35.223" class="difflineplus">+		    &amp;&amp; !strncmp (display_name, ical_tzid_prefix, strlen(ical_tzid_prefix))) {</span>
<a href="#l35.224"></a><span id="l35.224"> 		    /* Get the location, which is after the 3rd '/' char. */</span>
<a href="#l35.225"></a><span id="l35.225"> 		    const char *p;</span>
<a href="#l35.226"></a><span id="l35.226"> 		    int num_slashes = 0;</span>
<a href="#l35.227"></a><span id="l35.227"> 		    for (p = display_name; *p; p++) {</span>
<a href="#l35.228"></a><span id="l35.228"> 			if (*p == '/') {</span>
<a href="#l35.229"></a><span id="l35.229"> 			    num_slashes++;</span>
<a href="#l35.230"></a><span id="l35.230"> 			    if (num_slashes == 3)</span>
<a href="#l35.231"></a><span id="l35.231"> 				return p + 1;</span>
<a href="#l35.232"></a><span id="l35.232"> 			}</span>
<a href="#l35.233"></a><span id="l35.233"> 		    }</span>
<a href="#l35.234"></a><span id="l35.234"> 		}</span>
<a href="#l35.235"></a><span id="l35.235"> 	}</span>
<a href="#l35.236"></a><span id="l35.236"> </span>
<a href="#l35.237"></a><span id="l35.237"> 	return display_name;</span>
<a href="#l35.238"></a><span id="l35.238"> }</span>
<a href="#l35.239"></a><span id="l35.239"> </span>
<a href="#l35.240"></a><span id="l35.240" class="difflineminus">-</span>
<a href="#l35.241"></a><span id="l35.241"> icalarray*</span>
<a href="#l35.242"></a><span id="l35.242"> icaltimezone_array_new			(void)</span>
<a href="#l35.243"></a><span id="l35.243"> {</span>
<a href="#l35.244"></a><span id="l35.244">     return icalarray_new (sizeof (icaltimezone), 16);</span>
<a href="#l35.245"></a><span id="l35.245"> }</span>
<a href="#l35.246"></a><span id="l35.246"> </span>
<a href="#l35.247"></a><span id="l35.247"> </span>
<a href="#l35.248"></a><span id="l35.248"> void</span>
<a href="#l35.249"></a><span id="l35.249" class="difflineat">@@ -1341,52 +1309,49 @@ icaltimezone_array_free			(icalarray	*ti</span>
<a href="#l35.250"></a><span id="l35.250"> </span>
<a href="#l35.251"></a><span id="l35.251"> /** Returns an icalarray of icaltimezone structs, one for each builtin</span>
<a href="#l35.252"></a><span id="l35.252">    timezone.  This will load and parse the zones.tab file to get the</span>
<a href="#l35.253"></a><span id="l35.253">    timezone names and their coordinates. It will not load the</span>
<a href="#l35.254"></a><span id="l35.254">    VTIMEZONE data for any timezones. */</span>
<a href="#l35.255"></a><span id="l35.255"> icalarray*</span>
<a href="#l35.256"></a><span id="l35.256"> icaltimezone_get_builtin_timezones	(void)</span>
<a href="#l35.257"></a><span id="l35.257"> {</span>
<a href="#l35.258"></a><span id="l35.258" class="difflineminus">-#ifndef NO_ZONES_TAB</span>
<a href="#l35.259"></a><span id="l35.259" class="difflineminus">-    if (!s_builtin_timezones) {</span>
<a href="#l35.260"></a><span id="l35.260" class="difflineminus">-	icaltimezone_parse_zone_tab ();</span>
<a href="#l35.261"></a><span id="l35.261" class="difflineminus">-    }</span>
<a href="#l35.262"></a><span id="l35.262" class="difflineminus">-#endif</span>
<a href="#l35.263"></a><span id="l35.263" class="difflineminus">-    return s_builtin_timezones;</span>
<a href="#l35.264"></a><span id="l35.264" class="difflineplus">+    if (!builtin_timezones)</span>
<a href="#l35.265"></a><span id="l35.265" class="difflineplus">+	icaltimezone_init_builtin_timezones ();</span>
<a href="#l35.266"></a><span id="l35.266" class="difflineplus">+</span>
<a href="#l35.267"></a><span id="l35.267" class="difflineplus">+    return builtin_timezones;</span>
<a href="#l35.268"></a><span id="l35.268"> }</span>
<a href="#l35.269"></a><span id="l35.269"> </span>
<a href="#l35.270"></a><span id="l35.270"> /** Release builtin timezone memory */</span>
<a href="#l35.271"></a><span id="l35.271"> void</span>
<a href="#l35.272"></a><span id="l35.272"> icaltimezone_free_builtin_timezones(void)</span>
<a href="#l35.273"></a><span id="l35.273"> {</span>
<a href="#l35.274"></a><span id="l35.274" class="difflineminus">-	icaltimezone_array_free(s_builtin_timezones);</span>
<a href="#l35.275"></a><span id="l35.275" class="difflineplus">+	icaltimezone_array_free(builtin_timezones);</span>
<a href="#l35.276"></a><span id="l35.276" class="difflineplus">+	builtin_timezones = 0;</span>
<a href="#l35.277"></a><span id="l35.277"> }</span>
<a href="#l35.278"></a><span id="l35.278"> </span>
<a href="#l35.279"></a><span id="l35.279"> </span>
<a href="#l35.280"></a><span id="l35.280"> /** Returns a single builtin timezone, given its Olson city name. */</span>
<a href="#l35.281"></a><span id="l35.281"> icaltimezone*</span>
<a href="#l35.282"></a><span id="l35.282"> icaltimezone_get_builtin_timezone	(const char *location)</span>
<a href="#l35.283"></a><span id="l35.283"> {</span>
<a href="#l35.284"></a><span id="l35.284" class="difflineplus">+    icalcomponent *comp;</span>
<a href="#l35.285"></a><span id="l35.285">     icaltimezone *zone;</span>
<a href="#l35.286"></a><span id="l35.286" class="difflineminus">-    unsigned int lower;</span>
<a href="#l35.287"></a><span id="l35.287" class="difflineplus">+    int lower;</span>
<a href="#l35.288"></a><span id="l35.288">     const char *zone_location;</span>
<a href="#l35.289"></a><span id="l35.289" class="difflineminus">-    icalarray * builtin_timezones;</span>
<a href="#l35.290"></a><span id="l35.290"> </span>
<a href="#l35.291"></a><span id="l35.291">     if (!location || !location[0])</span>
<a href="#l35.292"></a><span id="l35.292"> 	return NULL;</span>
<a href="#l35.293"></a><span id="l35.293"> </span>
<a href="#l35.294"></a><span id="l35.294" class="difflineplus">+    if (!builtin_timezones)</span>
<a href="#l35.295"></a><span id="l35.295" class="difflineplus">+	icaltimezone_init_builtin_timezones ();</span>
<a href="#l35.296"></a><span id="l35.296" class="difflineplus">+</span>
<a href="#l35.297"></a><span id="l35.297">     if (!strcmp (location, &quot;UTC&quot;))</span>
<a href="#l35.298"></a><span id="l35.298"> 	return &amp;utc_timezone;</span>
<a href="#l35.299"></a><span id="l35.299">     </span>
<a href="#l35.300"></a><span id="l35.300" class="difflineminus">-    builtin_timezones = icaltimezone_get_builtin_timezones();</span>
<a href="#l35.301"></a><span id="l35.301" class="difflineminus">-    if (!builtin_timezones) {</span>
<a href="#l35.302"></a><span id="l35.302" class="difflineminus">-	return NULL;</span>
<a href="#l35.303"></a><span id="l35.303" class="difflineminus">-    }</span>
<a href="#l35.304"></a><span id="l35.304" class="difflineminus">-</span>
<a href="#l35.305"></a><span id="l35.305"> #if 0</span>
<a href="#l35.306"></a><span id="l35.306">     /* Do a simple binary search. */</span>
<a href="#l35.307"></a><span id="l35.307">     lower = middle = 0;</span>
<a href="#l35.308"></a><span id="l35.308">     upper = builtin_timezones-&gt;num_elements;</span>
<a href="#l35.309"></a><span id="l35.309"> </span>
<a href="#l35.310"></a><span id="l35.310">     while (lower &lt; upper) {</span>
<a href="#l35.311"></a><span id="l35.311"> 	middle = (lower + upper) / 2;</span>
<a href="#l35.312"></a><span id="l35.312"> 	zone = icalarray_element_at (builtin_timezones, middle);</span>
<a href="#l35.313"></a><span id="l35.313" class="difflineat">@@ -1405,16 +1370,30 @@ icaltimezone_get_builtin_timezone	(const</span>
<a href="#l35.314"></a><span id="l35.314">        so we just do a sequential search */</span>
<a href="#l35.315"></a><span id="l35.315">     for (lower = 0; lower &lt; builtin_timezones-&gt;num_elements; lower++) {</span>
<a href="#l35.316"></a><span id="l35.316"> 	zone = icalarray_element_at (builtin_timezones, lower);</span>
<a href="#l35.317"></a><span id="l35.317"> 	zone_location = icaltimezone_get_location (zone);</span>
<a href="#l35.318"></a><span id="l35.318"> 	if (strcmp (location, zone_location) == 0)</span>
<a href="#l35.319"></a><span id="l35.319"> 		return zone;</span>
<a href="#l35.320"></a><span id="l35.320">     }</span>
<a href="#l35.321"></a><span id="l35.321"> </span>
<a href="#l35.322"></a><span id="l35.322" class="difflineplus">+    /* Check whether file exists, but is not mentioned in zone.tab.</span>
<a href="#l35.323"></a><span id="l35.323" class="difflineplus">+       It means it's a deprecated timezone, but still available. */</span>
<a href="#l35.324"></a><span id="l35.324" class="difflineplus">+    comp = icaltzutil_fetch_timezone (location);</span>
<a href="#l35.325"></a><span id="l35.325" class="difflineplus">+    if (comp) {</span>
<a href="#l35.326"></a><span id="l35.326" class="difflineplus">+	icaltimezone tz;</span>
<a href="#l35.327"></a><span id="l35.327" class="difflineplus">+	icaltimezone_init (&amp;tz);</span>
<a href="#l35.328"></a><span id="l35.328" class="difflineplus">+	if (icaltimezone_set_component (&amp;tz, comp)) {</span>
<a href="#l35.329"></a><span id="l35.329" class="difflineplus">+	    icalarray_append (builtin_timezones, &amp;tz);</span>
<a href="#l35.330"></a><span id="l35.330" class="difflineplus">+	    return icalarray_element_at (builtin_timezones, builtin_timezones-&gt;num_elements - 1);</span>
<a href="#l35.331"></a><span id="l35.331" class="difflineplus">+	} else {</span>
<a href="#l35.332"></a><span id="l35.332" class="difflineplus">+	    icalcomponent_free (comp);</span>
<a href="#l35.333"></a><span id="l35.333" class="difflineplus">+	}</span>
<a href="#l35.334"></a><span id="l35.334" class="difflineplus">+    }</span>
<a href="#l35.335"></a><span id="l35.335" class="difflineplus">+</span>
<a href="#l35.336"></a><span id="l35.336">     return NULL;</span>
<a href="#l35.337"></a><span id="l35.337"> }</span>
<a href="#l35.338"></a><span id="l35.338"> </span>
<a href="#l35.339"></a><span id="l35.339"> static struct icaltimetype</span>
<a href="#l35.340"></a><span id="l35.340"> tm_to_icaltimetype (struct tm *tm)</span>
<a href="#l35.341"></a><span id="l35.341"> {</span>
<a href="#l35.342"></a><span id="l35.342"> 	struct icaltimetype itt;</span>
<a href="#l35.343"></a><span id="l35.343"> </span>
<a href="#l35.344"></a><span id="l35.344" class="difflineat">@@ -1450,29 +1429,26 @@ get_offset (icaltimezone *zone)</span>
<a href="#l35.345"></a><span id="l35.345"> }</span>
<a href="#l35.346"></a><span id="l35.346"> </span>
<a href="#l35.347"></a><span id="l35.347"> /** Returns a single builtin timezone, given its offset from UTC */</span>
<a href="#l35.348"></a><span id="l35.348"> icaltimezone*</span>
<a href="#l35.349"></a><span id="l35.349"> icaltimezone_get_builtin_timezone_from_offset	(int offset, const char *tzname)</span>
<a href="#l35.350"></a><span id="l35.350"> {</span>
<a href="#l35.351"></a><span id="l35.351">     icaltimezone *zone=NULL;</span>
<a href="#l35.352"></a><span id="l35.352">     int count, i;</span>
<a href="#l35.353"></a><span id="l35.353" class="difflineminus">-    icalarray * builtin_timezones;</span>
<a href="#l35.354"></a><span id="l35.354" class="difflineplus">+    </span>
<a href="#l35.355"></a><span id="l35.355" class="difflineplus">+    if (!builtin_timezones)</span>
<a href="#l35.356"></a><span id="l35.356" class="difflineplus">+	icaltimezone_init_builtin_timezones ();</span>
<a href="#l35.357"></a><span id="l35.357"> </span>
<a href="#l35.358"></a><span id="l35.358">     if (offset==0)</span>
<a href="#l35.359"></a><span id="l35.359"> 	return &amp;utc_timezone;</span>
<a href="#l35.360"></a><span id="l35.360"> </span>
<a href="#l35.361"></a><span id="l35.361">     if (!tzname)</span>
<a href="#l35.362"></a><span id="l35.362"> 	return NULL;</span>
<a href="#l35.363"></a><span id="l35.363"> </span>
<a href="#l35.364"></a><span id="l35.364" class="difflineminus">-    builtin_timezones = icaltimezone_get_builtin_timezones();</span>
<a href="#l35.365"></a><span id="l35.365" class="difflineminus">-    if (!builtin_timezones) {</span>
<a href="#l35.366"></a><span id="l35.366" class="difflineminus">-	return NULL;</span>
<a href="#l35.367"></a><span id="l35.367" class="difflineminus">-    }</span>
<a href="#l35.368"></a><span id="l35.368" class="difflineminus">-</span>
<a href="#l35.369"></a><span id="l35.369">     count = builtin_timezones-&gt;num_elements;</span>
<a href="#l35.370"></a><span id="l35.370"> </span>
<a href="#l35.371"></a><span id="l35.371">     for (i=0; i&lt;count; i++) {</span>
<a href="#l35.372"></a><span id="l35.372"> 	int z_offset;</span>
<a href="#l35.373"></a><span id="l35.373"> 	zone = icalarray_element_at (builtin_timezones, i);</span>
<a href="#l35.374"></a><span id="l35.374"> 	if (!zone-&gt;component)</span>
<a href="#l35.375"></a><span id="l35.375"> 	    icaltimezone_load_builtin_timezone (zone);</span>
<a href="#l35.376"></a><span id="l35.376"> 	</span>
<a href="#l35.377"></a><span id="l35.377" class="difflineat">@@ -1492,17 +1468,17 @@ icaltimezone_get_builtin_timezone_from_t</span>
<a href="#l35.378"></a><span id="l35.378">     int num_slashes = 0;</span>
<a href="#l35.379"></a><span id="l35.379">     const char *p, *zone_tzid;</span>
<a href="#l35.380"></a><span id="l35.380">     icaltimezone *zone;</span>
<a href="#l35.381"></a><span id="l35.381"> </span>
<a href="#l35.382"></a><span id="l35.382">     if (!tzid || !tzid[0])</span>
<a href="#l35.383"></a><span id="l35.383"> 	return NULL;</span>
<a href="#l35.384"></a><span id="l35.384"> </span>
<a href="#l35.385"></a><span id="l35.385">     /* Check that the TZID starts with our unique prefix. */</span>
<a href="#l35.386"></a><span id="l35.386" class="difflineminus">-    if (strncmp (tzid, TZID_PREFIX, TZID_PREFIX_LEN))</span>
<a href="#l35.387"></a><span id="l35.387" class="difflineplus">+    if (strncmp (tzid, ical_tzid_prefix, strlen(ical_tzid_prefix)))</span>
<a href="#l35.388"></a><span id="l35.388"> 	return NULL;</span>
<a href="#l35.389"></a><span id="l35.389"> </span>
<a href="#l35.390"></a><span id="l35.390">     /* Get the location, which is after the 3rd '/' character. */</span>
<a href="#l35.391"></a><span id="l35.391">     p = tzid;</span>
<a href="#l35.392"></a><span id="l35.392">     for (p = tzid; *p; p++) {</span>
<a href="#l35.393"></a><span id="l35.393"> 	if (*p == '/') {</span>
<a href="#l35.394"></a><span id="l35.394"> 	    num_slashes++;</span>
<a href="#l35.395"></a><span id="l35.395"> 	    if (num_slashes == 3)</span>
<a href="#l35.396"></a><span id="l35.396" class="difflineat">@@ -1530,21 +1506,36 @@ icaltimezone_get_builtin_timezone_from_t</span>
<a href="#l35.397"></a><span id="l35.397"> 	return NULL;</span>
<a href="#l35.398"></a><span id="l35.398"> }</span>
<a href="#l35.399"></a><span id="l35.399"> </span>
<a href="#l35.400"></a><span id="l35.400"> </span>
<a href="#l35.401"></a><span id="l35.401"> /** Returns the special UTC timezone. */</span>
<a href="#l35.402"></a><span id="l35.402"> icaltimezone*</span>
<a href="#l35.403"></a><span id="l35.403"> icaltimezone_get_utc_timezone		(void)</span>
<a href="#l35.404"></a><span id="l35.404"> {</span>
<a href="#l35.405"></a><span id="l35.405" class="difflineplus">+    if (!builtin_timezones)</span>
<a href="#l35.406"></a><span id="l35.406" class="difflineplus">+	icaltimezone_init_builtin_timezones ();</span>
<a href="#l35.407"></a><span id="l35.407" class="difflineplus">+</span>
<a href="#l35.408"></a><span id="l35.408">     return &amp;utc_timezone;</span>
<a href="#l35.409"></a><span id="l35.409"> }</span>
<a href="#l35.410"></a><span id="l35.410"> </span>
<a href="#l35.411"></a><span id="l35.411"> </span>
<a href="#l35.412"></a><span id="l35.412"> </span>
<a href="#l35.413"></a><span id="l35.413" class="difflineplus">+/** This initializes the builtin timezone data, i.e. the</span>
<a href="#l35.414"></a><span id="l35.414" class="difflineplus">+   builtin_timezones array and the special UTC timezone. It should be</span>
<a href="#l35.415"></a><span id="l35.415" class="difflineplus">+   called before any code that uses the timezone functions. */</span>
<a href="#l35.416"></a><span id="l35.416" class="difflineplus">+static void</span>
<a href="#l35.417"></a><span id="l35.417" class="difflineplus">+icaltimezone_init_builtin_timezones	(void)</span>
<a href="#l35.418"></a><span id="l35.418" class="difflineplus">+{</span>
<a href="#l35.419"></a><span id="l35.419" class="difflineplus">+    /* Initialize the special UTC timezone. */</span>
<a href="#l35.420"></a><span id="l35.420" class="difflineplus">+    utc_timezone.tzid = (char *)&quot;UTC&quot;;</span>
<a href="#l35.421"></a><span id="l35.421" class="difflineplus">+</span>
<a href="#l35.422"></a><span id="l35.422" class="difflineplus">+    icaltimezone_parse_zone_tab ();</span>
<a href="#l35.423"></a><span id="l35.423" class="difflineplus">+}</span>
<a href="#l35.424"></a><span id="l35.424" class="difflineplus">+</span>
<a href="#l35.425"></a><span id="l35.425"> static int</span>
<a href="#l35.426"></a><span id="l35.426"> parse_coord			(char		*coord,</span>
<a href="#l35.427"></a><span id="l35.427"> 				 int		 len,</span>
<a href="#l35.428"></a><span id="l35.428"> 				 int		*degrees, </span>
<a href="#l35.429"></a><span id="l35.429"> 				 int 		*minutes,</span>
<a href="#l35.430"></a><span id="l35.430"> 				 int 		*seconds)</span>
<a href="#l35.431"></a><span id="l35.431"> {</span>
<a href="#l35.432"></a><span id="l35.432"> 	if (len == 5)</span>
<a href="#l35.433"></a><span id="l35.433" class="difflineat">@@ -1586,55 +1577,70 @@ fetch_lat_long_from_string  (const char </span>
<a href="#l35.434"></a><span id="l35.434"> 		sptr++;</span>
<a href="#l35.435"></a><span id="l35.435"> 	</span>
<a href="#l35.436"></a><span id="l35.436"> 	loc = ++sptr;</span>
<a href="#l35.437"></a><span id="l35.437"> 	while (!isspace (*sptr))</span>
<a href="#l35.438"></a><span id="l35.438"> 		sptr++;</span>
<a href="#l35.439"></a><span id="l35.439"> 	len = sptr - loc;</span>
<a href="#l35.440"></a><span id="l35.440"> 	location = strncpy (location, loc, len);</span>
<a href="#l35.441"></a><span id="l35.441"> 	location [len] = '\0';</span>
<a href="#l35.442"></a><span id="l35.442" class="difflineminus">-	</span>
<a href="#l35.443"></a><span id="l35.443" class="difflineplus">+</span>
<a href="#l35.444"></a><span id="l35.444" class="difflineplus">+#if defined(sun) &amp;&amp; defined(__SVR4)</span>
<a href="#l35.445"></a><span id="l35.445" class="difflineplus">+    /* Handle EET, MET and WET in zone_sun.tab. */</span>
<a href="#l35.446"></a><span id="l35.446" class="difflineplus">+    if (!strcmp (location, &quot;Europe/&quot;)) {</span>
<a href="#l35.447"></a><span id="l35.447" class="difflineplus">+        while (*sptr != '\t')</span>
<a href="#l35.448"></a><span id="l35.448" class="difflineplus">+            sptr++;</span>
<a href="#l35.449"></a><span id="l35.449" class="difflineplus">+        loc = ++sptr;</span>
<a href="#l35.450"></a><span id="l35.450" class="difflineplus">+        while (!isspace (*sptr))</span>
<a href="#l35.451"></a><span id="l35.451" class="difflineplus">+            sptr++;</span>
<a href="#l35.452"></a><span id="l35.452" class="difflineplus">+        len = sptr - loc;</span>
<a href="#l35.453"></a><span id="l35.453" class="difflineplus">+        location = strncpy (location, loc, len);</span>
<a href="#l35.454"></a><span id="l35.454" class="difflineplus">+        location [len] = '\0';</span>
<a href="#l35.455"></a><span id="l35.455" class="difflineplus">+    }</span>
<a href="#l35.456"></a><span id="l35.456" class="difflineplus">+#endif</span>
<a href="#l35.457"></a><span id="l35.457" class="difflineplus">+</span>
<a href="#l35.458"></a><span id="l35.458"> 	lon = lat + 1;</span>
<a href="#l35.459"></a><span id="l35.459"> 	while (*lon != '+' &amp;&amp; *lon != '-')</span>
<a href="#l35.460"></a><span id="l35.460"> 		lon++;</span>
<a href="#l35.461"></a><span id="l35.461"> </span>
<a href="#l35.462"></a><span id="l35.462"> 	if (parse_coord (lat, lon - lat, latitude_degrees, latitude_minutes, latitude_seconds) == 1 ||</span>
<a href="#l35.463"></a><span id="l35.463"> 		       	parse_coord (lon, strlen (lon), longitude_degrees, longitude_minutes, longitude_seconds) </span>
<a href="#l35.464"></a><span id="l35.464" class="difflineminus">-			== 1)</span>
<a href="#l35.465"></a><span id="l35.465" class="difflineminus">-			return 1;</span>
<a href="#l35.466"></a><span id="l35.466" class="difflineplus">+			== 1) {</span>
<a href="#l35.467"></a><span id="l35.467" class="difflineplus">+				free(lat);</span>
<a href="#l35.468"></a><span id="l35.468" class="difflineplus">+				return 1;</span>
<a href="#l35.469"></a><span id="l35.469" class="difflineplus">+			}</span>
<a href="#l35.470"></a><span id="l35.470"> 	</span>
<a href="#l35.471"></a><span id="l35.471"> 	free (lat);</span>
<a href="#l35.472"></a><span id="l35.472"> </span>
<a href="#l35.473"></a><span id="l35.473"> 	return 0;</span>
<a href="#l35.474"></a><span id="l35.474"> }</span>
<a href="#l35.475"></a><span id="l35.475"> </span>
<a href="#l35.476"></a><span id="l35.476"> /** This parses the zones.tab file containing the names and locations</span>
<a href="#l35.477"></a><span id="l35.477">    of the builtin timezones. It creates the builtin_timezones array</span>
<a href="#l35.478"></a><span id="l35.478">    which is an icalarray of icaltimezone structs. It only fills in the</span>
<a href="#l35.479"></a><span id="l35.479">    location, latitude and longtude fields; the rest are left</span>
<a href="#l35.480"></a><span id="l35.480">    blank. The VTIMEZONE component is loaded later if it is needed. The</span>
<a href="#l35.481"></a><span id="l35.481">    timezones in the zones.tab file are sorted by their name, which is</span>
<a href="#l35.482"></a><span id="l35.482">    useful for binary searches. */</span>
<a href="#l35.483"></a><span id="l35.483"> static void</span>
<a href="#l35.484"></a><span id="l35.484"> icaltimezone_parse_zone_tab		(void)</span>
<a href="#l35.485"></a><span id="l35.485"> {</span>
<a href="#l35.486"></a><span id="l35.486" class="difflineminus">-#ifndef NO_ZONES_TAB</span>
<a href="#l35.487"></a><span id="l35.487">     char *filename;</span>
<a href="#l35.488"></a><span id="l35.488">     FILE *fp;</span>
<a href="#l35.489"></a><span id="l35.489">     char buf[1024];  /* Used to store each line of zones.tab as it is read. */</span>
<a href="#l35.490"></a><span id="l35.490">     char location[1024]; /* Stores the city name when parsing buf. */</span>
<a href="#l35.491"></a><span id="l35.491">     unsigned int filename_len;</span>
<a href="#l35.492"></a><span id="l35.492">     int latitude_degrees = 0, latitude_minutes = 0, latitude_seconds = 0;</span>
<a href="#l35.493"></a><span id="l35.493">     int longitude_degrees = 0, longitude_minutes = 0, longitude_seconds = 0;</span>
<a href="#l35.494"></a><span id="l35.494">     icaltimezone zone;</span>
<a href="#l35.495"></a><span id="l35.495"> </span>
<a href="#l35.496"></a><span id="l35.496" class="difflineminus">-    icalerror_assert (s_builtin_timezones == NULL,</span>
<a href="#l35.497"></a><span id="l35.497" class="difflineplus">+    icalerror_assert (builtin_timezones == NULL,</span>
<a href="#l35.498"></a><span id="l35.498"> 		      &quot;Parsing zones.tab file multiple times&quot;);</span>
<a href="#l35.499"></a><span id="l35.499"> </span>
<a href="#l35.500"></a><span id="l35.500" class="difflineminus">-    s_builtin_timezones = icalarray_new (sizeof (icaltimezone), 32);</span>
<a href="#l35.501"></a><span id="l35.501" class="difflineplus">+    builtin_timezones = icalarray_new (sizeof (icaltimezone), 32);</span>
<a href="#l35.502"></a><span id="l35.502"> </span>
<a href="#l35.503"></a><span id="l35.503"> #ifndef USE_BUILTIN_TZDATA</span>
<a href="#l35.504"></a><span id="l35.504">     filename_len = strlen ((char *) icaltzutil_get_zone_directory()) + strlen (ZONES_TAB_SYSTEM_FILENAME)</span>
<a href="#l35.505"></a><span id="l35.505"> 	+ 2;</span>
<a href="#l35.506"></a><span id="l35.506"> #else    </span>
<a href="#l35.507"></a><span id="l35.507">     filename_len = strlen (get_zone_directory()) + strlen (ZONES_TAB_FILENAME)</span>
<a href="#l35.508"></a><span id="l35.508"> 	+ 2;</span>
<a href="#l35.509"></a><span id="l35.509"> #endif    </span>
<a href="#l35.510"></a><span id="l35.510" class="difflineat">@@ -1699,46 +1705,45 @@ icaltimezone_parse_zone_tab		(void)</span>
<a href="#l35.511"></a><span id="l35.511"> 	    zone.longitude = (double) longitude_degrees</span>
<a href="#l35.512"></a><span id="l35.512"> 		+ (double) longitude_minutes / 60</span>
<a href="#l35.513"></a><span id="l35.513"> 		+ (double) longitude_seconds / 3600;</span>
<a href="#l35.514"></a><span id="l35.514"> 	else</span>
<a href="#l35.515"></a><span id="l35.515"> 	    zone.longitude = (double) longitude_degrees</span>
<a href="#l35.516"></a><span id="l35.516"> 		- (double) longitude_minutes / 60</span>
<a href="#l35.517"></a><span id="l35.517"> 		- (double) longitude_seconds / 3600;</span>
<a href="#l35.518"></a><span id="l35.518"> </span>
<a href="#l35.519"></a><span id="l35.519" class="difflineminus">-	icalarray_append (s_builtin_timezones, &amp;zone);</span>
<a href="#l35.520"></a><span id="l35.520" class="difflineplus">+	icalarray_append (builtin_timezones, &amp;zone);</span>
<a href="#l35.521"></a><span id="l35.521"> </span>
<a href="#l35.522"></a><span id="l35.522"> #if 0</span>
<a href="#l35.523"></a><span id="l35.523"> 	printf (&quot;Found zone: %s %f %f\n&quot;,</span>
<a href="#l35.524"></a><span id="l35.524"> 		location, zone.latitude, zone.longitude);</span>
<a href="#l35.525"></a><span id="l35.525"> #endif</span>
<a href="#l35.526"></a><span id="l35.526">     }</span>
<a href="#l35.527"></a><span id="l35.527"> </span>
<a href="#l35.528"></a><span id="l35.528">     fclose (fp);</span>
<a href="#l35.529"></a><span id="l35.529" class="difflineminus">-#endif /* NO_ZONES_TAB */</span>
<a href="#l35.530"></a><span id="l35.530"> }</span>
<a href="#l35.531"></a><span id="l35.531"> </span>
<a href="#l35.532"></a><span id="l35.532"> void</span>
<a href="#l35.533"></a><span id="l35.533"> icaltimezone_release_zone_tab		(void)</span>
<a href="#l35.534"></a><span id="l35.534"> {</span>
<a href="#l35.535"></a><span id="l35.535" class="difflineminus">-    unsigned int i;</span>
<a href="#l35.536"></a><span id="l35.536" class="difflineminus">-    icalarray *mybuiltin_timezones = s_builtin_timezones;</span>
<a href="#l35.537"></a><span id="l35.537" class="difflineminus">-    if (s_builtin_timezones == NULL)</span>
<a href="#l35.538"></a><span id="l35.538" class="difflineplus">+    int i;</span>
<a href="#l35.539"></a><span id="l35.539" class="difflineplus">+    icalarray *mybuiltin_timezones = builtin_timezones;</span>
<a href="#l35.540"></a><span id="l35.540" class="difflineplus">+</span>
<a href="#l35.541"></a><span id="l35.541" class="difflineplus">+    if (builtin_timezones == NULL)</span>
<a href="#l35.542"></a><span id="l35.542"> 	return;</span>
<a href="#l35.543"></a><span id="l35.543" class="difflineminus">-    s_builtin_timezones = NULL;</span>
<a href="#l35.544"></a><span id="l35.544" class="difflineplus">+    builtin_timezones = NULL;</span>
<a href="#l35.545"></a><span id="l35.545">     for (i = 0; i &lt; mybuiltin_timezones-&gt;num_elements; i++)</span>
<a href="#l35.546"></a><span id="l35.546"> 	free ( ((icaltimezone*)icalarray_element_at(mybuiltin_timezones, i))-&gt;location);</span>
<a href="#l35.547"></a><span id="l35.547">     icalarray_free (mybuiltin_timezones);</span>
<a href="#l35.548"></a><span id="l35.548"> }</span>
<a href="#l35.549"></a><span id="l35.549"> </span>
<a href="#l35.550"></a><span id="l35.550"> /** Loads the builtin VTIMEZONE data for the given timezone. */</span>
<a href="#l35.551"></a><span id="l35.551"> static void</span>
<a href="#l35.552"></a><span id="l35.552"> icaltimezone_load_builtin_timezone	(icaltimezone *zone)</span>
<a href="#l35.553"></a><span id="l35.553"> {</span>
<a href="#l35.554"></a><span id="l35.554" class="difflineminus">-#ifndef NO_ZONES_TAB</span>
<a href="#l35.555"></a><span id="l35.555">     icalcomponent *subcomp;</span>
<a href="#l35.556"></a><span id="l35.556"> </span>
<a href="#l35.557"></a><span id="l35.557"> 	    /* If the location isn't set, it isn't a builtin timezone. */</span>
<a href="#l35.558"></a><span id="l35.558">     if (!zone-&gt;location || !zone-&gt;location[0])</span>
<a href="#l35.559"></a><span id="l35.559"> 	return;</span>
<a href="#l35.560"></a><span id="l35.560"> </span>
<a href="#l35.561"></a><span id="l35.561"> #ifdef USE_BUILTIN_TZDATA</span>
<a href="#l35.562"></a><span id="l35.562">     {</span>
<a href="#l35.563"></a><span id="l35.563" class="difflineat">@@ -1792,17 +1797,17 @@ icaltimezone_load_builtin_timezone	(ical</span>
<a href="#l35.564"></a><span id="l35.564"> </span>
<a href="#l35.565"></a><span id="l35.565">     icaltimezone_get_vtimezone_properties (zone, subcomp);</span>
<a href="#l35.566"></a><span id="l35.566"> </span>
<a href="#l35.567"></a><span id="l35.567"> #ifdef USE_BUILTIN_TZDATA</span>
<a href="#l35.568"></a><span id="l35.568">     icalcomponent_remove_component(comp,subcomp);</span>
<a href="#l35.569"></a><span id="l35.569">     icalcomponent_free(comp);</span>
<a href="#l35.570"></a><span id="l35.570">     }</span>
<a href="#l35.571"></a><span id="l35.571"> #endif    </span>
<a href="#l35.572"></a><span id="l35.572" class="difflineminus">-#endif /* NO_ZONES_TAB */</span>
<a href="#l35.573"></a><span id="l35.573" class="difflineplus">+</span>
<a href="#l35.574"></a><span id="l35.574"> }</span>
<a href="#l35.575"></a><span id="l35.575"> </span>
<a href="#l35.576"></a><span id="l35.576"> </span>
<a href="#l35.577"></a><span id="l35.577"> #ifdef USE_BUILTIN_TZDATA</span>
<a href="#l35.578"></a><span id="l35.578"> /** Callback used from icalparser_parse() */</span>
<a href="#l35.579"></a><span id="l35.579"> static char *</span>
<a href="#l35.580"></a><span id="l35.580"> icaltimezone_load_get_line_fn		(char		*s,</span>
<a href="#l35.581"></a><span id="l35.581"> 					 size_t		 size,</span>
<a href="#l35.582"></a><span id="l35.582" class="difflineat">@@ -1998,22 +2003,32 @@ static const char* get_zone_directory(vo</span>
<a href="#l35.583"></a><span id="l35.583"> 	    }</span>
<a href="#l35.584"></a><span id="l35.584"> 	}</span>
<a href="#l35.585"></a><span id="l35.585"> 	return ZONEINFO_DIRECTORY;</span>
<a href="#l35.586"></a><span id="l35.586"> #endif</span>
<a href="#l35.587"></a><span id="l35.587"> }</span>
<a href="#l35.588"></a><span id="l35.588"> </span>
<a href="#l35.589"></a><span id="l35.589"> void set_zone_directory(char *path)</span>
<a href="#l35.590"></a><span id="l35.590"> {</span>
<a href="#l35.591"></a><span id="l35.591" class="difflineplus">+	if (zone_files_directory)</span>
<a href="#l35.592"></a><span id="l35.592" class="difflineplus">+		free_zone_directory();</span>
<a href="#l35.593"></a><span id="l35.593"> 	zone_files_directory = malloc(strlen(path)+1);</span>
<a href="#l35.594"></a><span id="l35.594"> 	if ( zone_files_directory != NULL )</span>
<a href="#l35.595"></a><span id="l35.595"> 	{</span>
<a href="#l35.596"></a><span id="l35.596"> 		strcpy(zone_files_directory,path);</span>
<a href="#l35.597"></a><span id="l35.597"> 	}</span>
<a href="#l35.598"></a><span id="l35.598"> }</span>
<a href="#l35.599"></a><span id="l35.599"> </span>
<a href="#l35.600"></a><span id="l35.600"> void free_zone_directory(void)</span>
<a href="#l35.601"></a><span id="l35.601"> {</span>
<a href="#l35.602"></a><span id="l35.602"> 	if ( zone_files_directory != NULL )</span>
<a href="#l35.603"></a><span id="l35.603"> 	{</span>
<a href="#l35.604"></a><span id="l35.604"> 		free(zone_files_directory);</span>
<a href="#l35.605"></a><span id="l35.605" class="difflineplus">+		zone_files_directory = NULL;</span>
<a href="#l35.606"></a><span id="l35.606"> 	}</span>
<a href="#l35.607"></a><span id="l35.607"> }</span>
<a href="#l35.608"></a><span id="l35.608" class="difflineplus">+</span>
<a href="#l35.609"></a><span id="l35.609" class="difflineplus">+void icaltimezone_set_tzid_prefix(const char *new_prefix)</span>
<a href="#l35.610"></a><span id="l35.610" class="difflineplus">+{</span>
<a href="#l35.611"></a><span id="l35.611" class="difflineplus">+	if (new_prefix) {</span>
<a href="#l35.612"></a><span id="l35.612" class="difflineplus">+		ical_tzid_prefix = new_prefix;</span>
<a href="#l35.613"></a><span id="l35.613" class="difflineplus">+	}</span>
<a href="#l35.614"></a><span id="l35.614" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/libical/src/libical/icaltimezone.h</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/libical/src/libical/icaltimezone.h</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -52,16 +52,22 @@ typedef struct _icaltimezone		icaltimezo</span>
<a href="#l36.4"></a><span id="l36.4"> icaltimezone *icaltimezone_new			(void);</span>
<a href="#l36.5"></a><span id="l36.5"> icaltimezone *icaltimezone_copy			(icaltimezone *originalzone);</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7"> /** Frees all memory used for the icaltimezone. Set free_struct to free the</span>
<a href="#l36.8"></a><span id="l36.8">    icaltimezone struct as well. */</span>
<a href="#l36.9"></a><span id="l36.9"> void icaltimezone_free				(icaltimezone *zone,</span>
<a href="#l36.10"></a><span id="l36.10"> 						 int free_struct);</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+/** Sets the prefix to be used for tzid's generated from system tzdata.</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+    Must be globally unique (such as a domain name owned by the developer</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+    of the calling application), and begin and end with forward slashes.</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+    Do not change or de-allocate the string buffer after calling this.</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+ */</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineplus">+void icaltimezone_set_tzid_prefix(const char *new_prefix);</span>
<a href="#l36.18"></a><span id="l36.18"> </span>
<a href="#l36.19"></a><span id="l36.19"> /**</span>
<a href="#l36.20"></a><span id="l36.20">  * @par Accessing timezones.</span>
<a href="#l36.21"></a><span id="l36.21">  */</span>
<a href="#l36.22"></a><span id="l36.22"> </span>
<a href="#l36.23"></a><span id="l36.23"> /** Free any builtin timezone information **/</span>
<a href="#l36.24"></a><span id="l36.24"> void icaltimezone_free_builtin_timezones(void);</span>
<a href="#l36.25"></a><span id="l36.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/libical/src/libical/icaltypes.c</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/libical/src/libical/icaltypes.c</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -38,16 +38,22 @@</span>
<a href="#l37.4"></a><span id="l37.4"> </span>
<a href="#l37.5"></a><span id="l37.5"> #ifdef WIN32</span>
<a href="#l37.6"></a><span id="l37.6"> #define snprintf      _snprintf</span>
<a href="#l37.7"></a><span id="l37.7"> #define strcasecmp    stricmp</span>
<a href="#l37.8"></a><span id="l37.8"> #endif</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10"> #define TEMP_MAX 1024</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+#ifdef HAVE_PTHREAD</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+ #include &lt;pthread.h&gt;    </span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+    static pthread_mutex_t unk_token_mutex = PTHREAD_MUTEX_INITIALIZER;</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+#endif</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineplus">+static ical_unknown_token_handling unknownTokenHandling = ICAL_TREAT_AS_ERROR;</span>
<a href="#l37.18"></a><span id="l37.18"> </span>
<a href="#l37.19"></a><span id="l37.19"> int icaltriggertype_is_null_trigger(struct icaltriggertype tr)</span>
<a href="#l37.20"></a><span id="l37.20"> {</span>
<a href="#l37.21"></a><span id="l37.21">     if(icaltime_is_null_time(tr.time) &amp;&amp; </span>
<a href="#l37.22"></a><span id="l37.22">        icaldurationtype_is_null_duration(tr.duration)){</span>
<a href="#l37.23"></a><span id="l37.23">         return 1;</span>
<a href="#l37.24"></a><span id="l37.24">     }</span>
<a href="#l37.25"></a><span id="l37.25"> </span>
<a href="#l37.26"></a><span id="l37.26" class="difflineat">@@ -173,19 +179,19 @@ const char* icalreqstattype_as_string(st</span>
<a href="#l37.27"></a><span id="l37.27"> 	return buf;</span>
<a href="#l37.28"></a><span id="l37.28"> }</span>
<a href="#l37.29"></a><span id="l37.29"> </span>
<a href="#l37.30"></a><span id="l37.30"> </span>
<a href="#l37.31"></a><span id="l37.31"> char* icalreqstattype_as_string_r(struct icalreqstattype stat)</span>
<a href="#l37.32"></a><span id="l37.32"> {</span>
<a href="#l37.33"></a><span id="l37.33">   char *temp;</span>
<a href="#l37.34"></a><span id="l37.34"> </span>
<a href="#l37.35"></a><span id="l37.35" class="difflineminus">-  temp = (char*)icalmemory_new_buffer(TEMP_MAX);</span>
<a href="#l37.36"></a><span id="l37.36" class="difflineplus">+  icalerror_check_arg_rz((stat.code != ICAL_UNKNOWN_STATUS),&quot;Status&quot;);</span>
<a href="#l37.37"></a><span id="l37.37"> </span>
<a href="#l37.38"></a><span id="l37.38" class="difflineminus">-  icalerror_check_arg_rz((stat.code != ICAL_UNKNOWN_STATUS),&quot;Status&quot;);</span>
<a href="#l37.39"></a><span id="l37.39" class="difflineplus">+  temp = (char*)icalmemory_new_buffer(TEMP_MAX);</span>
<a href="#l37.40"></a><span id="l37.40">   </span>
<a href="#l37.41"></a><span id="l37.41">   if (stat.desc == 0){</span>
<a href="#l37.42"></a><span id="l37.42">     stat.desc = icalenum_reqstat_desc(stat.code);</span>
<a href="#l37.43"></a><span id="l37.43">   }</span>
<a href="#l37.44"></a><span id="l37.44">   </span>
<a href="#l37.45"></a><span id="l37.45">   if(stat.debug != 0){</span>
<a href="#l37.46"></a><span id="l37.46">     snprintf(temp,TEMP_MAX,&quot;%d.%d;%s;%s&quot;, icalenum_reqstat_major(stat.code),</span>
<a href="#l37.47"></a><span id="l37.47">              icalenum_reqstat_minor(stat.code),</span>
<a href="#l37.48"></a><span id="l37.48" class="difflineat">@@ -194,8 +200,40 @@ char* icalreqstattype_as_string_r(struct</span>
<a href="#l37.49"></a><span id="l37.49">   } else {</span>
<a href="#l37.50"></a><span id="l37.50">     snprintf(temp,TEMP_MAX,&quot;%d.%d;%s&quot;, icalenum_reqstat_major(stat.code),</span>
<a href="#l37.51"></a><span id="l37.51">              icalenum_reqstat_minor(stat.code),</span>
<a href="#l37.52"></a><span id="l37.52">              stat.desc);</span>
<a href="#l37.53"></a><span id="l37.53">   }</span>
<a href="#l37.54"></a><span id="l37.54"> </span>
<a href="#l37.55"></a><span id="l37.55">   return temp;</span>
<a href="#l37.56"></a><span id="l37.56"> }</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineplus">+</span>
<a href="#l37.58"></a><span id="l37.58" class="difflineplus">+ical_unknown_token_handling ical_get_unknown_token_handling_setting(void)</span>
<a href="#l37.59"></a><span id="l37.59" class="difflineplus">+{</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineplus">+    ical_unknown_token_handling myHandling;</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineplus">+</span>
<a href="#l37.62"></a><span id="l37.62" class="difflineplus">+#ifdef HAVE_PTHREAD</span>
<a href="#l37.63"></a><span id="l37.63" class="difflineplus">+    pthread_mutex_lock (&amp;unk_token_mutex);</span>
<a href="#l37.64"></a><span id="l37.64" class="difflineplus">+#endif</span>
<a href="#l37.65"></a><span id="l37.65" class="difflineplus">+</span>
<a href="#l37.66"></a><span id="l37.66" class="difflineplus">+    myHandling = unknownTokenHandling;</span>
<a href="#l37.67"></a><span id="l37.67" class="difflineplus">+</span>
<a href="#l37.68"></a><span id="l37.68" class="difflineplus">+#ifdef HAVE_PTHREAD</span>
<a href="#l37.69"></a><span id="l37.69" class="difflineplus">+    pthread_mutex_unlock (&amp;unk_token_mutex);</span>
<a href="#l37.70"></a><span id="l37.70" class="difflineplus">+#endif</span>
<a href="#l37.71"></a><span id="l37.71" class="difflineplus">+</span>
<a href="#l37.72"></a><span id="l37.72" class="difflineplus">+    return myHandling;</span>
<a href="#l37.73"></a><span id="l37.73" class="difflineplus">+}</span>
<a href="#l37.74"></a><span id="l37.74" class="difflineplus">+</span>
<a href="#l37.75"></a><span id="l37.75" class="difflineplus">+void ical_set_unknown_token_handling_setting(ical_unknown_token_handling newSetting)</span>
<a href="#l37.76"></a><span id="l37.76" class="difflineplus">+{</span>
<a href="#l37.77"></a><span id="l37.77" class="difflineplus">+</span>
<a href="#l37.78"></a><span id="l37.78" class="difflineplus">+#ifdef HAVE_PTHREAD</span>
<a href="#l37.79"></a><span id="l37.79" class="difflineplus">+    pthread_mutex_lock (&amp;unk_token_mutex);</span>
<a href="#l37.80"></a><span id="l37.80" class="difflineplus">+#endif</span>
<a href="#l37.81"></a><span id="l37.81" class="difflineplus">+</span>
<a href="#l37.82"></a><span id="l37.82" class="difflineplus">+    unknownTokenHandling = newSetting;</span>
<a href="#l37.83"></a><span id="l37.83" class="difflineplus">+</span>
<a href="#l37.84"></a><span id="l37.84" class="difflineplus">+#ifdef HAVE_PTHREAD</span>
<a href="#l37.85"></a><span id="l37.85" class="difflineplus">+    pthread_mutex_unlock (&amp;unk_token_mutex);</span>
<a href="#l37.86"></a><span id="l37.86" class="difflineplus">+#endif</span>
<a href="#l37.87"></a><span id="l37.87" class="difflineplus">+</span>
<a href="#l37.88"></a><span id="l37.88" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/libical/src/libical/icaltypes.h</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/libical/src/libical/icaltypes.h</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -29,18 +29,18 @@</span>
<a href="#l38.4"></a><span id="l38.4"> #include &quot;icalenums.h&quot;</span>
<a href="#l38.5"></a><span id="l38.5"> #include &quot;icaltime.h&quot;</span>
<a href="#l38.6"></a><span id="l38.6"> #include &quot;icalduration.h&quot;</span>
<a href="#l38.7"></a><span id="l38.7"> #include &quot;icalperiod.h&quot;</span>
<a href="#l38.8"></a><span id="l38.8"> </span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10"> struct icalgeotype </span>
<a href="#l38.11"></a><span id="l38.11"> {</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-	float lat;</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">-	float lon;</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+	double lat;</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+	double lon;</span>
<a href="#l38.16"></a><span id="l38.16"> };</span>
<a href="#l38.17"></a><span id="l38.17"> </span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19"> struct icaldatetimeperiodtype </span>
<a href="#l38.20"></a><span id="l38.20"> {</span>
<a href="#l38.21"></a><span id="l38.21"> 	struct icaltimetype time;</span>
<a href="#l38.22"></a><span id="l38.22"> 	struct icalperiodtype period;</span>
<a href="#l38.23"></a><span id="l38.23"> };</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineat">@@ -100,10 +100,23 @@ struct icaltimezonetype {</span>
<a href="#l38.25"></a><span id="l38.25">     const char* tzurl;</span>
<a href="#l38.26"></a><span id="l38.26">     </span>
<a href="#l38.27"></a><span id="l38.27">     /* Array of phases. The end of the array is a phase with tzname == 0 */</span>
<a href="#l38.28"></a><span id="l38.28">     struct icaltimezonephase *phases;</span>
<a href="#l38.29"></a><span id="l38.29"> };</span>
<a href="#l38.30"></a><span id="l38.30"> </span>
<a href="#l38.31"></a><span id="l38.31"> void icaltimezonetype_free(struct icaltimezonetype tzt);</span>
<a href="#l38.32"></a><span id="l38.32"> </span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+/* ical_unknown_token_handling :</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+ *    How should the ICAL library handle components, properties and parameters with</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineplus">+ *    unknown names?</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineplus">+ *    FIXME:  Currently only affects parameters.  Extend to components and properties.</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineplus">+ */</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineplus">+typedef enum ical_unknown_token_handling {</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineplus">+    ICAL_ASSUME_IANA_TOKEN = 1, </span>
<a href="#l38.40"></a><span id="l38.40" class="difflineplus">+    ICAL_DISCARD_TOKEN = 2,</span>
<a href="#l38.41"></a><span id="l38.41" class="difflineplus">+    ICAL_TREAT_AS_ERROR = 3 </span>
<a href="#l38.42"></a><span id="l38.42" class="difflineplus">+} ical_unknown_token_handling;</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineplus">+</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineplus">+ical_unknown_token_handling ical_get_unknown_token_handling_setting(void);</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+void ical_set_unknown_token_handling_setting(ical_unknown_token_handling newSetting);</span>
<a href="#l38.46"></a><span id="l38.46"> </span>
<a href="#l38.47"></a><span id="l38.47"> #endif /* !ICALTYPES_H */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/libical/src/libical/icalvalue.c</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalvalue.c</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -131,43 +131,46 @@ icalvalue* icalvalue_new_clone(const ica</span>
<a href="#l39.4"></a><span id="l39.4"> 	case ICAL_TEXT_VALUE:</span>
<a href="#l39.5"></a><span id="l39.5"> 	case ICAL_CALADDRESS_VALUE:</span>
<a href="#l39.6"></a><span id="l39.6"> 	case ICAL_URI_VALUE:</span>
<a href="#l39.7"></a><span id="l39.7"> 	{</span>
<a href="#l39.8"></a><span id="l39.8"> 	    if (old-&gt;data.v_string != 0) { </span>
<a href="#l39.9"></a><span id="l39.9"> 		new-&gt;data.v_string=icalmemory_strdup(old-&gt;data.v_string);</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11"> 		if ( new-&gt;data.v_string == 0 ) {</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+                    icalvalue_free(new);</span>
<a href="#l39.13"></a><span id="l39.13"> 		    return 0;</span>
<a href="#l39.14"></a><span id="l39.14"> 		}		    </span>
<a href="#l39.15"></a><span id="l39.15"> </span>
<a href="#l39.16"></a><span id="l39.16"> 	    }</span>
<a href="#l39.17"></a><span id="l39.17"> 	    break;</span>
<a href="#l39.18"></a><span id="l39.18"> 	}</span>
<a href="#l39.19"></a><span id="l39.19"> 	case ICAL_RECUR_VALUE:</span>
<a href="#l39.20"></a><span id="l39.20"> 	{</span>
<a href="#l39.21"></a><span id="l39.21"> 	    if(old-&gt;data.v_recur != 0){</span>
<a href="#l39.22"></a><span id="l39.22"> 		new-&gt;data.v_recur = malloc(sizeof(struct icalrecurrencetype));</span>
<a href="#l39.23"></a><span id="l39.23"> </span>
<a href="#l39.24"></a><span id="l39.24"> 		if(new-&gt;data.v_recur == 0){</span>
<a href="#l39.25"></a><span id="l39.25" class="difflineplus">+                    icalvalue_free(new);</span>
<a href="#l39.26"></a><span id="l39.26"> 		    return 0;</span>
<a href="#l39.27"></a><span id="l39.27"> 		}</span>
<a href="#l39.28"></a><span id="l39.28"> </span>
<a href="#l39.29"></a><span id="l39.29"> 		memcpy(	new-&gt;data.v_recur, old-&gt;data.v_recur,</span>
<a href="#l39.30"></a><span id="l39.30"> 			sizeof(struct icalrecurrencetype));	</span>
<a href="#l39.31"></a><span id="l39.31"> 	    }</span>
<a href="#l39.32"></a><span id="l39.32"> 	    break;</span>
<a href="#l39.33"></a><span id="l39.33"> 	}</span>
<a href="#l39.34"></a><span id="l39.34"> </span>
<a href="#l39.35"></a><span id="l39.35"> 	case ICAL_X_VALUE: </span>
<a href="#l39.36"></a><span id="l39.36"> 	{</span>
<a href="#l39.37"></a><span id="l39.37"> 	    if (old-&gt;x_value != 0) {</span>
<a href="#l39.38"></a><span id="l39.38"> 		new-&gt;x_value=icalmemory_strdup(old-&gt;x_value);</span>
<a href="#l39.39"></a><span id="l39.39"> </span>
<a href="#l39.40"></a><span id="l39.40"> 		if (new-&gt;x_value == 0) {</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineplus">+                    icalvalue_free(new);</span>
<a href="#l39.42"></a><span id="l39.42"> 		    return 0;</span>
<a href="#l39.43"></a><span id="l39.43"> 		}</span>
<a href="#l39.44"></a><span id="l39.44"> 	    }</span>
<a href="#l39.45"></a><span id="l39.45"> </span>
<a href="#l39.46"></a><span id="l39.46"> 	    break;</span>
<a href="#l39.47"></a><span id="l39.47"> 	}</span>
<a href="#l39.48"></a><span id="l39.48"> </span>
<a href="#l39.49"></a><span id="l39.49"> 	default:</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineat">@@ -257,82 +260,16 @@ static char* icalmemory_strdup_and_dequo</span>
<a href="#l39.51"></a><span id="l39.51"> 	</span>
<a href="#l39.52"></a><span id="l39.52">     }</span>
<a href="#l39.53"></a><span id="l39.53"> </span>
<a href="#l39.54"></a><span id="l39.54">     *pout = '\0';</span>
<a href="#l39.55"></a><span id="l39.55"> </span>
<a href="#l39.56"></a><span id="l39.56">     return out;</span>
<a href="#l39.57"></a><span id="l39.57"> }</span>
<a href="#l39.58"></a><span id="l39.58"> </span>
<a href="#l39.59"></a><span id="l39.59" class="difflineminus">- /* </span>
<a href="#l39.60"></a><span id="l39.60" class="difflineminus">-  * Returns a quoted copy of a string</span>
<a href="#l39.61"></a><span id="l39.61" class="difflineminus">- */</span>
<a href="#l39.62"></a><span id="l39.62" class="difflineminus">-</span>
<a href="#l39.63"></a><span id="l39.63" class="difflineminus">-static char* icalmemory_strdup_and_quote(const char* unquoted_str)</span>
<a href="#l39.64"></a><span id="l39.64" class="difflineminus">-{</span>
<a href="#l39.65"></a><span id="l39.65" class="difflineminus">-    char *str;</span>
<a href="#l39.66"></a><span id="l39.66" class="difflineminus">-    char *str_p;</span>
<a href="#l39.67"></a><span id="l39.67" class="difflineminus">-    const char *p;</span>
<a href="#l39.68"></a><span id="l39.68" class="difflineminus">-    size_t buf_sz;</span>
<a href="#l39.69"></a><span id="l39.69" class="difflineminus">-</span>
<a href="#l39.70"></a><span id="l39.70" class="difflineminus">-    buf_sz = strlen(unquoted_str)+1;</span>
<a href="#l39.71"></a><span id="l39.71" class="difflineminus">-</span>
<a href="#l39.72"></a><span id="l39.72" class="difflineminus">-    str_p = str = (char*)icalmemory_new_buffer(buf_sz);</span>
<a href="#l39.73"></a><span id="l39.73" class="difflineminus">-</span>
<a href="#l39.74"></a><span id="l39.74" class="difflineminus">-    if (str_p == 0){</span>
<a href="#l39.75"></a><span id="l39.75" class="difflineminus">-      return 0;</span>
<a href="#l39.76"></a><span id="l39.76" class="difflineminus">-    }</span>
<a href="#l39.77"></a><span id="l39.77" class="difflineminus">-</span>
<a href="#l39.78"></a><span id="l39.78" class="difflineminus">-    for(p=unquoted_str; *p!=0; p++){</span>
<a href="#l39.79"></a><span id="l39.79" class="difflineminus">-</span>
<a href="#l39.80"></a><span id="l39.80" class="difflineminus">-	switch(*p){</span>
<a href="#l39.81"></a><span id="l39.81" class="difflineminus">-	    case '\n': {</span>
<a href="#l39.82"></a><span id="l39.82" class="difflineminus">-		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\n&quot;);</span>
<a href="#l39.83"></a><span id="l39.83" class="difflineminus">-		break;</span>
<a href="#l39.84"></a><span id="l39.84" class="difflineminus">-	    }</span>
<a href="#l39.85"></a><span id="l39.85" class="difflineminus">-</span>
<a href="#l39.86"></a><span id="l39.86" class="difflineminus">-	    case '\t': {</span>
<a href="#l39.87"></a><span id="l39.87" class="difflineminus">-		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\t&quot;);</span>
<a href="#l39.88"></a><span id="l39.88" class="difflineminus">-		break;</span>
<a href="#l39.89"></a><span id="l39.89" class="difflineminus">-	    }</span>
<a href="#l39.90"></a><span id="l39.90" class="difflineminus">-	    case '\r': {</span>
<a href="#l39.91"></a><span id="l39.91" class="difflineminus">-		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\r&quot;);</span>
<a href="#l39.92"></a><span id="l39.92" class="difflineminus">-		break;</span>
<a href="#l39.93"></a><span id="l39.93" class="difflineminus">-	    }</span>
<a href="#l39.94"></a><span id="l39.94" class="difflineminus">-	    case '\b': {</span>
<a href="#l39.95"></a><span id="l39.95" class="difflineminus">-		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\b&quot;);</span>
<a href="#l39.96"></a><span id="l39.96" class="difflineminus">-		break;</span>
<a href="#l39.97"></a><span id="l39.97" class="difflineminus">-	    }</span>
<a href="#l39.98"></a><span id="l39.98" class="difflineminus">-	    case '\f': {</span>
<a href="#l39.99"></a><span id="l39.99" class="difflineminus">-		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\f&quot;);</span>
<a href="#l39.100"></a><span id="l39.100" class="difflineminus">-		break;</span>
<a href="#l39.101"></a><span id="l39.101" class="difflineminus">-	    }</span>
<a href="#l39.102"></a><span id="l39.102" class="difflineminus">-</span>
<a href="#l39.103"></a><span id="l39.103" class="difflineminus">-	    case ';':</span>
<a href="#l39.104"></a><span id="l39.104" class="difflineminus">-	    case ',':</span>
<a href="#l39.105"></a><span id="l39.105" class="difflineminus">-	    case '&quot;':</span>
<a href="#l39.106"></a><span id="l39.106" class="difflineminus">-	    case '\\':{</span>
<a href="#l39.107"></a><span id="l39.107" class="difflineminus">-		icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,'\\');</span>
<a href="#l39.108"></a><span id="l39.108" class="difflineminus">-		icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,*p);</span>
<a href="#l39.109"></a><span id="l39.109" class="difflineminus">-		break;</span>
<a href="#l39.110"></a><span id="l39.110" class="difflineminus">-	    }</span>
<a href="#l39.111"></a><span id="l39.111" class="difflineminus">-</span>
<a href="#l39.112"></a><span id="l39.112" class="difflineminus">-	    default: {</span>
<a href="#l39.113"></a><span id="l39.113" class="difflineminus">-		icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,*p);</span>
<a href="#l39.114"></a><span id="l39.114" class="difflineminus">-	    }</span>
<a href="#l39.115"></a><span id="l39.115" class="difflineminus">-	}</span>
<a href="#l39.116"></a><span id="l39.116" class="difflineminus">-    }</span>
<a href="#l39.117"></a><span id="l39.117" class="difflineminus">-    /* Assume the last character is not a '\0' and add one. We could</span>
<a href="#l39.118"></a><span id="l39.118" class="difflineminus">-       check *str_p != 0, but that would be an uninitialized memory</span>
<a href="#l39.119"></a><span id="l39.119" class="difflineminus">-       read. */</span>
<a href="#l39.120"></a><span id="l39.120" class="difflineminus">-</span>
<a href="#l39.121"></a><span id="l39.121" class="difflineminus">-</span>
<a href="#l39.122"></a><span id="l39.122" class="difflineminus">-    icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,'\0');</span>
<a href="#l39.123"></a><span id="l39.123" class="difflineminus">-    return str;</span>
<a href="#l39.124"></a><span id="l39.124" class="difflineminus">-}    </span>
<a href="#l39.125"></a><span id="l39.125"> /*</span>
<a href="#l39.126"></a><span id="l39.126">  * FIXME</span>
<a href="#l39.127"></a><span id="l39.127">  *</span>
<a href="#l39.128"></a><span id="l39.128">  * This is a bad API, as it forces callers to specify their own X type.</span>
<a href="#l39.129"></a><span id="l39.129">  * This function should take care of this by itself.</span>
<a href="#l39.130"></a><span id="l39.130">  */</span>
<a href="#l39.131"></a><span id="l39.131"> static</span>
<a href="#l39.132"></a><span id="l39.132"> icalvalue* icalvalue_new_enum(icalvalue_kind kind, int x_type, const char* str)</span>
<a href="#l39.133"></a><span id="l39.133" class="difflineat">@@ -358,19 +295,19 @@ icalvalue* icalvalue_new_enum(icalvalue_</span>
<a href="#l39.134"></a><span id="l39.134"> /**</span>
<a href="#l39.135"></a><span id="l39.135">  * Transforms a simple float number string into a double.</span>
<a href="#l39.136"></a><span id="l39.136">  * The decimal separator (if any) of the double has to be '.'</span>
<a href="#l39.137"></a><span id="l39.137">  * The code is locale *independant* and does *not* change the locale.</span>
<a href="#l39.138"></a><span id="l39.138">  * It should be thread safe.</span>
<a href="#l39.139"></a><span id="l39.139">  * If you want a code that that does the same job with a decimal separator</span>
<a href="#l39.140"></a><span id="l39.140">  * dependant on the current locale, then use strtof() from libc.</span>
<a href="#l39.141"></a><span id="l39.141">  */</span>
<a href="#l39.142"></a><span id="l39.142" class="difflineminus">-int simple_str_to_float(const char* from,</span>
<a href="#l39.143"></a><span id="l39.143" class="difflineminus">-                        float *result,</span>
<a href="#l39.144"></a><span id="l39.144" class="difflineminus">-                        char** to)</span>
<a href="#l39.145"></a><span id="l39.145" class="difflineplus">+int simple_str_to_double(const char* from,</span>
<a href="#l39.146"></a><span id="l39.146" class="difflineplus">+                         double *result,</span>
<a href="#l39.147"></a><span id="l39.147" class="difflineplus">+                         char** to)</span>
<a href="#l39.148"></a><span id="l39.148"> {</span>
<a href="#l39.149"></a><span id="l39.149"> #define TMP_NUM_SIZE 100</span>
<a href="#l39.150"></a><span id="l39.150">     char *start=NULL, *end=NULL, *cur=(char*)from ;</span>
<a href="#l39.151"></a><span id="l39.151">     char tmp_buf[TMP_NUM_SIZE+1] ; /*hack*/</span>
<a href="#l39.152"></a><span id="l39.152">     struct lconv *loc_data = localeconv () ;</span>
<a href="#l39.153"></a><span id="l39.153">     int i=0 ;</span>
<a href="#l39.154"></a><span id="l39.154"> </span>
<a href="#l39.155"></a><span id="l39.155">     /*sanity checks*/</span>
<a href="#l39.156"></a><span id="l39.156" class="difflineat">@@ -449,17 +386,17 @@ icalvalue* icalvalue_new_from_string_wit</span>
<a href="#l39.157"></a><span id="l39.157"> 	    value = icalvalue_new_attach (attach);</span>
<a href="#l39.158"></a><span id="l39.158"> 	    icalattach_unref (attach);</span>
<a href="#l39.159"></a><span id="l39.159"> 	    break;</span>
<a href="#l39.160"></a><span id="l39.160"> 	}</span>
<a href="#l39.161"></a><span id="l39.161"> </span>
<a href="#l39.162"></a><span id="l39.162">     case ICAL_BINARY_VALUE:</span>
<a href="#l39.163"></a><span id="l39.163">     {</span>
<a href="#l39.164"></a><span id="l39.164">         icalattach *attach;</span>
<a href="#l39.165"></a><span id="l39.165" class="difflineminus">-        attach = icalattach_new_from_data ((unsigned char*)str, 0, 0);</span>
<a href="#l39.166"></a><span id="l39.166" class="difflineplus">+        attach = icalattach_new_from_data (str, 0, 0);</span>
<a href="#l39.167"></a><span id="l39.167">         if ( !attach )</span>
<a href="#l39.168"></a><span id="l39.168">           break;</span>
<a href="#l39.169"></a><span id="l39.169">         value = icalvalue_new_attach (attach);</span>
<a href="#l39.170"></a><span id="l39.170">         icalattach_unref (attach);</span>
<a href="#l39.171"></a><span id="l39.171">         break;</span>
<a href="#l39.172"></a><span id="l39.172">     }</span>
<a href="#l39.173"></a><span id="l39.173">     case ICAL_BOOLEAN_VALUE:</span>
<a href="#l39.174"></a><span id="l39.174">         {</span>
<a href="#l39.175"></a><span id="l39.175" class="difflineat">@@ -556,17 +493,17 @@ icalvalue* icalvalue_new_from_string_wit</span>
<a href="#l39.176"></a><span id="l39.176"> 	    value = icalvalue_new_uri(str);</span>
<a href="#l39.177"></a><span id="l39.177"> 	    break;</span>
<a href="#l39.178"></a><span id="l39.178">         </span>
<a href="#l39.179"></a><span id="l39.179">     case ICAL_GEO_VALUE:</span>
<a href="#l39.180"></a><span id="l39.180">     {</span>
<a href="#l39.181"></a><span id="l39.181">         char *cur=NULL ;</span>
<a href="#l39.182"></a><span id="l39.182">         struct icalgeotype geo = {0.0, 0.0};</span>
<a href="#l39.183"></a><span id="l39.183">   </span>
<a href="#l39.184"></a><span id="l39.184" class="difflineminus">-        if (simple_str_to_float (str, &amp;geo.lat, &amp;cur)) {</span>
<a href="#l39.185"></a><span id="l39.185" class="difflineplus">+        if (simple_str_to_double (str, &amp;geo.lat, &amp;cur)) {</span>
<a href="#l39.186"></a><span id="l39.186">             goto geo_parsing_error ;</span>
<a href="#l39.187"></a><span id="l39.187">         }</span>
<a href="#l39.188"></a><span id="l39.188">   </span>
<a href="#l39.189"></a><span id="l39.189">         /*skip white spaces*/</span>
<a href="#l39.190"></a><span id="l39.190">         while (cur &amp;&amp; isspace (*cur)) {</span>
<a href="#l39.191"></a><span id="l39.191">             ++cur ;</span>
<a href="#l39.192"></a><span id="l39.192">         }</span>
<a href="#l39.193"></a><span id="l39.193"> </span>
<a href="#l39.194"></a><span id="l39.194" class="difflineat">@@ -579,17 +516,17 @@ icalvalue* icalvalue_new_from_string_wit</span>
<a href="#l39.195"></a><span id="l39.195">         if (!cur)</span>
<a href="#l39.196"></a><span id="l39.196">             goto geo_parsing_error ;</span>
<a href="#l39.197"></a><span id="l39.197"> </span>
<a href="#l39.198"></a><span id="l39.198">         /*skip white spaces*/</span>
<a href="#l39.199"></a><span id="l39.199">         while (cur &amp;&amp; isspace (*cur)) {</span>
<a href="#l39.200"></a><span id="l39.200">             ++cur ;</span>
<a href="#l39.201"></a><span id="l39.201">         }</span>
<a href="#l39.202"></a><span id="l39.202"> </span>
<a href="#l39.203"></a><span id="l39.203" class="difflineminus">-        if (simple_str_to_float (cur, &amp;geo.lon, &amp;cur)) {</span>
<a href="#l39.204"></a><span id="l39.204" class="difflineplus">+        if (simple_str_to_double (cur, &amp;geo.lon, &amp;cur)) {</span>
<a href="#l39.205"></a><span id="l39.205">             goto geo_parsing_error ;</span>
<a href="#l39.206"></a><span id="l39.206">         }</span>
<a href="#l39.207"></a><span id="l39.207">         value = icalvalue_new_geo (geo) ;</span>
<a href="#l39.208"></a><span id="l39.208">         break ;</span>
<a href="#l39.209"></a><span id="l39.209"> </span>
<a href="#l39.210"></a><span id="l39.210"> geo_parsing_error:</span>
<a href="#l39.211"></a><span id="l39.211">         if (error != 0){</span>
<a href="#l39.212"></a><span id="l39.212">             char temp[TMP_BUF_SIZE];</span>
<a href="#l39.213"></a><span id="l39.213" class="difflineat">@@ -767,16 +704,17 @@ icalvalue_free (icalvalue* v)</span>
<a href="#l39.214"></a><span id="l39.214"> 		v-&gt;data.v_attach = NULL;</span>
<a href="#l39.215"></a><span id="l39.215"> 	    }</span>
<a href="#l39.216"></a><span id="l39.216"> </span>
<a href="#l39.217"></a><span id="l39.217"> 	    break;</span>
<a href="#l39.218"></a><span id="l39.218"> 	}</span>
<a href="#l39.219"></a><span id="l39.219"> 	case ICAL_TEXT_VALUE:</span>
<a href="#l39.220"></a><span id="l39.220"> 	case ICAL_CALADDRESS_VALUE:</span>
<a href="#l39.221"></a><span id="l39.221"> 	case ICAL_URI_VALUE:</span>
<a href="#l39.222"></a><span id="l39.222" class="difflineplus">+	case ICAL_STRING_VALUE:</span>
<a href="#l39.223"></a><span id="l39.223"> 	case ICAL_QUERY_VALUE:</span>
<a href="#l39.224"></a><span id="l39.224"> 	{</span>
<a href="#l39.225"></a><span id="l39.225"> 	    if (v-&gt;data.v_string != 0) { </span>
<a href="#l39.226"></a><span id="l39.226"> 		free((void*)v-&gt;data.v_string);</span>
<a href="#l39.227"></a><span id="l39.227"> 		v-&gt;data.v_string = 0;</span>
<a href="#l39.228"></a><span id="l39.228"> 	    }</span>
<a href="#l39.229"></a><span id="l39.229"> 	    break;</span>
<a href="#l39.230"></a><span id="l39.230"> 	}</span>
<a href="#l39.231"></a><span id="l39.231" class="difflineat">@@ -827,36 +765,38 @@ static char* icalvalue_binary_as_ical_st</span>
<a href="#l39.232"></a><span id="l39.232">     return str;</span>
<a href="#l39.233"></a><span id="l39.233"> }</span>
<a href="#l39.234"></a><span id="l39.234"> </span>
<a href="#l39.235"></a><span id="l39.235"> </span>
<a href="#l39.236"></a><span id="l39.236"> #define MAX_INT_DIGITS 12 /* Enough for 2^32 + sign*/ </span>
<a href="#l39.237"></a><span id="l39.237">     </span>
<a href="#l39.238"></a><span id="l39.238"> static char* icalvalue_int_as_ical_string_r(const icalvalue* value) {</span>
<a href="#l39.239"></a><span id="l39.239">     int data;</span>
<a href="#l39.240"></a><span id="l39.240" class="difflineminus">-    char* str = (char*)icalmemory_new_buffer(MAX_INT_DIGITS); </span>
<a href="#l39.241"></a><span id="l39.241" class="difflineplus">+    char* str;</span>
<a href="#l39.242"></a><span id="l39.242"> </span>
<a href="#l39.243"></a><span id="l39.243">     icalerror_check_arg_rz( (value!=0),&quot;value&quot;);</span>
<a href="#l39.244"></a><span id="l39.244" class="difflineplus">+    str = (char*)icalmemory_new_buffer(MAX_INT_DIGITS); </span>
<a href="#l39.245"></a><span id="l39.245"> </span>
<a href="#l39.246"></a><span id="l39.246">     data = icalvalue_get_integer(value);</span>
<a href="#l39.247"></a><span id="l39.247"> 	</span>
<a href="#l39.248"></a><span id="l39.248">     snprintf(str,MAX_INT_DIGITS,&quot;%d&quot;,data);</span>
<a href="#l39.249"></a><span id="l39.249"> </span>
<a href="#l39.250"></a><span id="l39.250">     return str;</span>
<a href="#l39.251"></a><span id="l39.251"> }</span>
<a href="#l39.252"></a><span id="l39.252"> </span>
<a href="#l39.253"></a><span id="l39.253"> </span>
<a href="#l39.254"></a><span id="l39.254"> static char* icalvalue_utcoffset_as_ical_string_r(const icalvalue* value)</span>
<a href="#l39.255"></a><span id="l39.255"> {    </span>
<a href="#l39.256"></a><span id="l39.256">     int data,h,m,s;</span>
<a href="#l39.257"></a><span id="l39.257">     char sign;</span>
<a href="#l39.258"></a><span id="l39.258" class="difflineminus">-    char* str = (char*)icalmemory_new_buffer(9);</span>
<a href="#l39.259"></a><span id="l39.259" class="difflineplus">+    char* str;</span>
<a href="#l39.260"></a><span id="l39.260"> </span>
<a href="#l39.261"></a><span id="l39.261">     icalerror_check_arg_rz( (value!=0),&quot;value&quot;);</span>
<a href="#l39.262"></a><span id="l39.262"> </span>
<a href="#l39.263"></a><span id="l39.263" class="difflineplus">+    str = (char*)icalmemory_new_buffer(9);</span>
<a href="#l39.264"></a><span id="l39.264">     data = icalvalue_get_utcoffset(value);</span>
<a href="#l39.265"></a><span id="l39.265"> </span>
<a href="#l39.266"></a><span id="l39.266">     if (abs(data) == data){</span>
<a href="#l39.267"></a><span id="l39.267"> 	sign = '+';</span>
<a href="#l39.268"></a><span id="l39.268">     } else {</span>
<a href="#l39.269"></a><span id="l39.269"> 	sign = '-';</span>
<a href="#l39.270"></a><span id="l39.270">     }</span>
<a href="#l39.271"></a><span id="l39.271"> </span>
<a href="#l39.272"></a><span id="l39.272" class="difflineat">@@ -895,26 +835,76 @@ static char* icalvalue_recur_as_ical_str</span>
<a href="#l39.273"></a><span id="l39.273"> </span>
<a href="#l39.274"></a><span id="l39.274">  /* @todo This is not RFC2445 compliant.</span>
<a href="#l39.275"></a><span id="l39.275">  * The RFC only allows:</span>
<a href="#l39.276"></a><span id="l39.276">  * TSAFE-CHAR = %x20-21 / %x23-2B / %x2D-39 / %x3C-5B / %x5D-7E / NON-US-ASCII</span>
<a href="#l39.277"></a><span id="l39.277">  * As such, \t\r\b\f are not allowed, not even escaped</span>
<a href="#l39.278"></a><span id="l39.278">  */</span>
<a href="#l39.279"></a><span id="l39.279"> </span>
<a href="#l39.280"></a><span id="l39.280"> static char* icalvalue_text_as_ical_string_r(const icalvalue* value) {</span>
<a href="#l39.281"></a><span id="l39.281" class="difflineminus">-    return icalmemory_strdup_and_quote(value-&gt;data.v_string);</span>
<a href="#l39.282"></a><span id="l39.282" class="difflineplus">+    char *str;</span>
<a href="#l39.283"></a><span id="l39.283" class="difflineplus">+    char *str_p;</span>
<a href="#l39.284"></a><span id="l39.284" class="difflineplus">+    const char *p;</span>
<a href="#l39.285"></a><span id="l39.285" class="difflineplus">+    size_t buf_sz;</span>
<a href="#l39.286"></a><span id="l39.286" class="difflineplus">+</span>
<a href="#l39.287"></a><span id="l39.287" class="difflineplus">+    buf_sz = strlen(value-&gt;data.v_string)+1;</span>
<a href="#l39.288"></a><span id="l39.288" class="difflineplus">+</span>
<a href="#l39.289"></a><span id="l39.289" class="difflineplus">+    str_p = str = (char*)icalmemory_new_buffer(buf_sz);</span>
<a href="#l39.290"></a><span id="l39.290" class="difflineplus">+</span>
<a href="#l39.291"></a><span id="l39.291" class="difflineplus">+    if (str_p == 0){</span>
<a href="#l39.292"></a><span id="l39.292" class="difflineplus">+      return 0;</span>
<a href="#l39.293"></a><span id="l39.293" class="difflineplus">+    }</span>
<a href="#l39.294"></a><span id="l39.294" class="difflineplus">+</span>
<a href="#l39.295"></a><span id="l39.295" class="difflineplus">+    for(p=value-&gt;data.v_string; *p!=0; p++){</span>
<a href="#l39.296"></a><span id="l39.296" class="difflineplus">+</span>
<a href="#l39.297"></a><span id="l39.297" class="difflineplus">+	switch(*p){</span>
<a href="#l39.298"></a><span id="l39.298" class="difflineplus">+	    case '\n': {</span>
<a href="#l39.299"></a><span id="l39.299" class="difflineplus">+		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\n&quot;);</span>
<a href="#l39.300"></a><span id="l39.300" class="difflineplus">+		break;</span>
<a href="#l39.301"></a><span id="l39.301" class="difflineplus">+	    }</span>
<a href="#l39.302"></a><span id="l39.302"> </span>
<a href="#l39.303"></a><span id="l39.303" class="difflineminus">-}</span>
<a href="#l39.304"></a><span id="l39.304" class="difflineplus">+	    case '\t': {</span>
<a href="#l39.305"></a><span id="l39.305" class="difflineplus">+		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\t&quot;);</span>
<a href="#l39.306"></a><span id="l39.306" class="difflineplus">+		break;</span>
<a href="#l39.307"></a><span id="l39.307" class="difflineplus">+	    }</span>
<a href="#l39.308"></a><span id="l39.308" class="difflineplus">+	    case '\r': {</span>
<a href="#l39.309"></a><span id="l39.309" class="difflineplus">+		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\r&quot;);</span>
<a href="#l39.310"></a><span id="l39.310" class="difflineplus">+		break;</span>
<a href="#l39.311"></a><span id="l39.311" class="difflineplus">+	    }</span>
<a href="#l39.312"></a><span id="l39.312" class="difflineplus">+	    case '\b': {</span>
<a href="#l39.313"></a><span id="l39.313" class="difflineplus">+		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\b&quot;);</span>
<a href="#l39.314"></a><span id="l39.314" class="difflineplus">+		break;</span>
<a href="#l39.315"></a><span id="l39.315" class="difflineplus">+	    }</span>
<a href="#l39.316"></a><span id="l39.316" class="difflineplus">+	    case '\f': {</span>
<a href="#l39.317"></a><span id="l39.317" class="difflineplus">+		icalmemory_append_string(&amp;str,&amp;str_p,&amp;buf_sz,&quot;\\f&quot;);</span>
<a href="#l39.318"></a><span id="l39.318" class="difflineplus">+		break;</span>
<a href="#l39.319"></a><span id="l39.319" class="difflineplus">+	    }</span>
<a href="#l39.320"></a><span id="l39.320" class="difflineplus">+</span>
<a href="#l39.321"></a><span id="l39.321" class="difflineplus">+	    case ';':</span>
<a href="#l39.322"></a><span id="l39.322" class="difflineplus">+	    case ',':</span>
<a href="#l39.323"></a><span id="l39.323" class="difflineplus">+	    case '&quot;':</span>
<a href="#l39.324"></a><span id="l39.324" class="difflineplus">+	    case '\\':{</span>
<a href="#l39.325"></a><span id="l39.325" class="difflineplus">+		icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,'\\');</span>
<a href="#l39.326"></a><span id="l39.326" class="difflineplus">+		icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,*p);</span>
<a href="#l39.327"></a><span id="l39.327" class="difflineplus">+		break;</span>
<a href="#l39.328"></a><span id="l39.328" class="difflineplus">+	    }</span>
<a href="#l39.329"></a><span id="l39.329" class="difflineplus">+</span>
<a href="#l39.330"></a><span id="l39.330" class="difflineplus">+	    default: {</span>
<a href="#l39.331"></a><span id="l39.331" class="difflineplus">+		icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,*p);</span>
<a href="#l39.332"></a><span id="l39.332" class="difflineplus">+	    }</span>
<a href="#l39.333"></a><span id="l39.333" class="difflineplus">+	}</span>
<a href="#l39.334"></a><span id="l39.334" class="difflineplus">+    }</span>
<a href="#l39.335"></a><span id="l39.335" class="difflineplus">+</span>
<a href="#l39.336"></a><span id="l39.336" class="difflineplus">+    /* Assume the last character is not a '\0' and add one. We could</span>
<a href="#l39.337"></a><span id="l39.337" class="difflineplus">+       check *str_p != 0, but that would be an uninitialized memory</span>
<a href="#l39.338"></a><span id="l39.338" class="difflineplus">+       read. */</span>
<a href="#l39.339"></a><span id="l39.339"> </span>
<a href="#l39.340"></a><span id="l39.340"> </span>
<a href="#l39.341"></a><span id="l39.341" class="difflineminus">-static char* icalvalue_text_as_ical_string(const icalvalue* value) {</span>
<a href="#l39.342"></a><span id="l39.342" class="difflineminus">-	char *buf;</span>
<a href="#l39.343"></a><span id="l39.343" class="difflineminus">-	buf = icalvalue_text_as_ical_string_r(value);</span>
<a href="#l39.344"></a><span id="l39.344" class="difflineminus">-	icalmemory_add_tmp_buffer(buf);</span>
<a href="#l39.345"></a><span id="l39.345" class="difflineminus">-	return buf;</span>
<a href="#l39.346"></a><span id="l39.346" class="difflineplus">+    icalmemory_append_char(&amp;str,&amp;str_p,&amp;buf_sz,'\0');</span>
<a href="#l39.347"></a><span id="l39.347" class="difflineplus">+    return str;</span>
<a href="#l39.348"></a><span id="l39.348"> }</span>
<a href="#l39.349"></a><span id="l39.349"> </span>
<a href="#l39.350"></a><span id="l39.350"> </span>
<a href="#l39.351"></a><span id="l39.351"> </span>
<a href="#l39.352"></a><span id="l39.352"> static char* </span>
<a href="#l39.353"></a><span id="l39.353"> icalvalue_attach_as_ical_string_r(const icalvalue* value) </span>
<a href="#l39.354"></a><span id="l39.354"> {</span>
<a href="#l39.355"></a><span id="l39.355">     icalattach *a;</span>
<a href="#l39.356"></a><span id="l39.356" class="difflineat">@@ -951,57 +941,69 @@ static char* icalvalue_duration_as_ical_</span>
<a href="#l39.357"></a><span id="l39.357">     return icaldurationtype_as_ical_string_r(data);</span>
<a href="#l39.358"></a><span id="l39.358"> }</span>
<a href="#l39.359"></a><span id="l39.359"> </span>
<a href="#l39.360"></a><span id="l39.360"> </span>
<a href="#l39.361"></a><span id="l39.361"> </span>
<a href="#l39.362"></a><span id="l39.362"> void print_time_to_string(char* str, const struct icaltimetype *data)</span>
<a href="#l39.363"></a><span id="l39.363"> {</span>
<a href="#l39.364"></a><span id="l39.364">     char temp[20];</span>
<a href="#l39.365"></a><span id="l39.365" class="difflineplus">+    str[0] = '\0';</span>
<a href="#l39.366"></a><span id="l39.366"> </span>
<a href="#l39.367"></a><span id="l39.367" class="difflineminus">-    if (icaltime_is_utc(*data)){</span>
<a href="#l39.368"></a><span id="l39.368" class="difflineminus">-    snprintf(temp,sizeof(temp),&quot;%02d%02d%02dZ&quot;,data-&gt;hour,data-&gt;minute,data-&gt;second);</span>
<a href="#l39.369"></a><span id="l39.369" class="difflineminus">-    } else {</span>
<a href="#l39.370"></a><span id="l39.370" class="difflineminus">-    snprintf(temp,sizeof(temp),&quot;%02d%02d%02d&quot;,data-&gt;hour,data-&gt;minute,data-&gt;second);</span>
<a href="#l39.371"></a><span id="l39.371" class="difflineminus">-    }   </span>
<a href="#l39.372"></a><span id="l39.372" class="difflineminus">-</span>
<a href="#l39.373"></a><span id="l39.373" class="difflineminus">-    strcat(str,temp);</span>
<a href="#l39.374"></a><span id="l39.374" class="difflineplus">+    if (data != 0) {</span>
<a href="#l39.375"></a><span id="l39.375" class="difflineplus">+        if (icaltime_is_utc(*data)){</span>
<a href="#l39.376"></a><span id="l39.376" class="difflineplus">+            snprintf(temp,sizeof(temp),&quot;%02d%02d%02dZ&quot;,data-&gt;hour,data-&gt;minute,data-&gt;second);</span>
<a href="#l39.377"></a><span id="l39.377" class="difflineplus">+            strncat(str,temp,7);</span>
<a href="#l39.378"></a><span id="l39.378" class="difflineplus">+        } else {</span>
<a href="#l39.379"></a><span id="l39.379" class="difflineplus">+            snprintf(temp,sizeof(temp),&quot;%02d%02d%02d&quot;,data-&gt;hour,data-&gt;minute,data-&gt;second);</span>
<a href="#l39.380"></a><span id="l39.380" class="difflineplus">+            strncat(str,temp,6);</span>
<a href="#l39.381"></a><span id="l39.381" class="difflineplus">+        }   </span>
<a href="#l39.382"></a><span id="l39.382" class="difflineplus">+    }</span>
<a href="#l39.383"></a><span id="l39.383"> }</span>
<a href="#l39.384"></a><span id="l39.384"> </span>
<a href="#l39.385"></a><span id="l39.385">  </span>
<a href="#l39.386"></a><span id="l39.386"> void print_date_to_string(char* str,  const struct icaltimetype *data)</span>
<a href="#l39.387"></a><span id="l39.387"> {</span>
<a href="#l39.388"></a><span id="l39.388">     char temp[20];</span>
<a href="#l39.389"></a><span id="l39.389" class="difflineplus">+    str[0] = '\0';</span>
<a href="#l39.390"></a><span id="l39.390"> </span>
<a href="#l39.391"></a><span id="l39.391" class="difflineminus">-    snprintf(temp,sizeof(temp),&quot;%04d%02d%02d&quot;,data-&gt;year,data-&gt;month,data-&gt;day);</span>
<a href="#l39.392"></a><span id="l39.392" class="difflineminus">-</span>
<a href="#l39.393"></a><span id="l39.393" class="difflineminus">-    strcat(str,temp);</span>
<a href="#l39.394"></a><span id="l39.394" class="difflineplus">+    if (data != 0) {</span>
<a href="#l39.395"></a><span id="l39.395" class="difflineplus">+        snprintf(temp,sizeof(temp),&quot;%04d%02d%02d&quot;,data-&gt;year,data-&gt;month,data-&gt;day);</span>
<a href="#l39.396"></a><span id="l39.396" class="difflineplus">+        strncat(str,temp,8);</span>
<a href="#l39.397"></a><span id="l39.397" class="difflineplus">+    }</span>
<a href="#l39.398"></a><span id="l39.398"> }</span>
<a href="#l39.399"></a><span id="l39.399"> </span>
<a href="#l39.400"></a><span id="l39.400"> static char* icalvalue_date_as_ical_string_r(const icalvalue* value) {</span>
<a href="#l39.401"></a><span id="l39.401"> </span>
<a href="#l39.402"></a><span id="l39.402">     struct icaltimetype data;</span>
<a href="#l39.403"></a><span id="l39.403">     char* str;</span>
<a href="#l39.404"></a><span id="l39.404">     icalerror_check_arg_rz( (value!=0),&quot;value&quot;);</span>
<a href="#l39.405"></a><span id="l39.405">     data = icalvalue_get_date(value);</span>
<a href="#l39.406"></a><span id="l39.406"> </span>
<a href="#l39.407"></a><span id="l39.407">     str = (char*)icalmemory_new_buffer(9);</span>
<a href="#l39.408"></a><span id="l39.408">  </span>
<a href="#l39.409"></a><span id="l39.409" class="difflineminus">-    str[0] = 0;</span>
<a href="#l39.410"></a><span id="l39.410" class="difflineplus">+    str[0] = '\0';</span>
<a href="#l39.411"></a><span id="l39.411">     print_date_to_string(str,&amp;data);</span>
<a href="#l39.412"></a><span id="l39.412">    </span>
<a href="#l39.413"></a><span id="l39.413">     return str;</span>
<a href="#l39.414"></a><span id="l39.414"> }</span>
<a href="#l39.415"></a><span id="l39.415"> </span>
<a href="#l39.416"></a><span id="l39.416"> void print_datetime_to_string(char* str,  const struct icaltimetype *data)</span>
<a href="#l39.417"></a><span id="l39.417"> {</span>
<a href="#l39.418"></a><span id="l39.418" class="difflineminus">-    print_date_to_string(str,data);</span>
<a href="#l39.419"></a><span id="l39.419" class="difflineminus">-    if ( !data-&gt;is_date ) {</span>
<a href="#l39.420"></a><span id="l39.420" class="difflineminus">-        strcat(str,&quot;T&quot;);</span>
<a href="#l39.421"></a><span id="l39.421" class="difflineminus">-        print_time_to_string(str,data);</span>
<a href="#l39.422"></a><span id="l39.422" class="difflineplus">+    char temp[20];</span>
<a href="#l39.423"></a><span id="l39.423" class="difflineplus">+    str[0] = '\0';</span>
<a href="#l39.424"></a><span id="l39.424" class="difflineplus">+</span>
<a href="#l39.425"></a><span id="l39.425" class="difflineplus">+    if (data != 0) {</span>
<a href="#l39.426"></a><span id="l39.426" class="difflineplus">+        print_date_to_string(str,data);</span>
<a href="#l39.427"></a><span id="l39.427" class="difflineplus">+        if ( !data-&gt;is_date ) {</span>
<a href="#l39.428"></a><span id="l39.428" class="difflineplus">+            strncat(str,&quot;T&quot;,19);</span>
<a href="#l39.429"></a><span id="l39.429" class="difflineplus">+            temp[0] = '\0';</span>
<a href="#l39.430"></a><span id="l39.430" class="difflineplus">+            print_time_to_string(temp,data);</span>
<a href="#l39.431"></a><span id="l39.431" class="difflineplus">+            strncat(str,temp,19);</span>
<a href="#l39.432"></a><span id="l39.432" class="difflineplus">+        }</span>
<a href="#l39.433"></a><span id="l39.433">     }</span>
<a href="#l39.434"></a><span id="l39.434"> }</span>
<a href="#l39.435"></a><span id="l39.435"> </span>
<a href="#l39.436"></a><span id="l39.436"> </span>
<a href="#l39.437"></a><span id="l39.437"> static char* icalvalue_datetime_as_ical_string_r(const icalvalue* value) {</span>
<a href="#l39.438"></a><span id="l39.438">     </span>
<a href="#l39.439"></a><span id="l39.439">     struct icaltimetype data;</span>
<a href="#l39.440"></a><span id="l39.440">     char* str;</span>
<a href="#l39.441"></a><span id="l39.441" class="difflineat">@@ -1016,17 +1018,16 @@ static char* icalvalue_datetime_as_ical_</span>
<a href="#l39.442"></a><span id="l39.442"> 	    return 0;</span>
<a href="#l39.443"></a><span id="l39.443"> 	}</span>
<a href="#l39.444"></a><span id="l39.444"> </span>
<a href="#l39.445"></a><span id="l39.445">     data = icalvalue_get_datetime(value);</span>
<a href="#l39.446"></a><span id="l39.446"> </span>
<a href="#l39.447"></a><span id="l39.447">     str = (char*)icalmemory_new_buffer(20);</span>
<a href="#l39.448"></a><span id="l39.448">  </span>
<a href="#l39.449"></a><span id="l39.449">     str[0] = 0;</span>
<a href="#l39.450"></a><span id="l39.450" class="difflineminus">-</span>
<a href="#l39.451"></a><span id="l39.451">     print_datetime_to_string(str,&amp;data);</span>
<a href="#l39.452"></a><span id="l39.452">    </span>
<a href="#l39.453"></a><span id="l39.453">     return str;</span>
<a href="#l39.454"></a><span id="l39.454"> </span>
<a href="#l39.455"></a><span id="l39.455"> }</span>
<a href="#l39.456"></a><span id="l39.456"> </span>
<a href="#l39.457"></a><span id="l39.457"> static char* icalvalue_float_as_ical_string_r(const icalvalue* value) {</span>
<a href="#l39.458"></a><span id="l39.458"> </span>
<a href="#l39.459"></a><span id="l39.459" class="difflineat">@@ -1178,17 +1179,17 @@ icalvalue_as_ical_string_r(const icalval</span>
<a href="#l39.460"></a><span id="l39.460">         if(value-&gt;x_value !=0){</span>
<a href="#l39.461"></a><span id="l39.461">             return icalmemory_strdup(value-&gt;x_value);</span>
<a href="#l39.462"></a><span id="l39.462">         }</span>
<a href="#l39.463"></a><span id="l39.463"> </span>
<a href="#l39.464"></a><span id="l39.464">         return icalproperty_enum_to_string_r(value-&gt;data.v_enum);</span>
<a href="#l39.465"></a><span id="l39.465">         </span>
<a href="#l39.466"></a><span id="l39.466">     case ICAL_X_VALUE: </span>
<a href="#l39.467"></a><span id="l39.467"> 	if (value-&gt;x_value != 0)</span>
<a href="#l39.468"></a><span id="l39.468" class="difflineminus">-            return icalmemory_strdup_and_quote(value-&gt;x_value);</span>
<a href="#l39.469"></a><span id="l39.469" class="difflineplus">+            return icalmemory_strdup(value-&gt;x_value);</span>
<a href="#l39.470"></a><span id="l39.470"> </span>
<a href="#l39.471"></a><span id="l39.471">     /* FALLTHRU */</span>
<a href="#l39.472"></a><span id="l39.472"> </span>
<a href="#l39.473"></a><span id="l39.473">     case ICAL_NO_VALUE:</span>
<a href="#l39.474"></a><span id="l39.474">     default:</span>
<a href="#l39.475"></a><span id="l39.475"> 	{</span>
<a href="#l39.476"></a><span id="l39.476"> 	    return 0;</span>
<a href="#l39.477"></a><span id="l39.477"> 	}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/libical/src/libical/icalvalue.h</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/libical/src/libical/icalvalue.h</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -58,28 +58,29 @@ icalvalue_kind icalvalue_isa(const icalv</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5"> int icalvalue_isa_value(void*);</span>
<a href="#l40.6"></a><span id="l40.6"> </span>
<a href="#l40.7"></a><span id="l40.7"> icalparameter_xliccomparetype icalvalue_compare(const icalvalue* a, const icalvalue *b);</span>
<a href="#l40.8"></a><span id="l40.8"> </span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10"> /* Special, non autogenerated value accessors */</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-icalvalue* icalvalue_new_recur (struct icalrecurrencetype v);</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-void icalvalue_set_recur(icalvalue* value, struct icalrecurrencetype v);</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-struct icalrecurrencetype icalvalue_get_recur(const icalvalue* value);</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+/* Defined in icalderivedvalue.h */</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+/* icalvalue* icalvalue_new_recur (struct icalrecurrencetype v); */</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineplus">+/* void icalvalue_set_recur(icalvalue* value, struct icalrecurrencetype v); */</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineplus">+/* struct icalrecurrencetype icalvalue_get_recur(const icalvalue* value); */</span>
<a href="#l40.19"></a><span id="l40.19"> </span>
<a href="#l40.20"></a><span id="l40.20" class="difflineminus">-icalvalue* icalvalue_new_trigger (struct icaltriggertype v);</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineminus">-void icalvalue_set_trigger(icalvalue* value, struct icaltriggertype v);</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineminus">-struct icaltriggertype icalvalue_get_trigger(const icalvalue* value);</span>
<a href="#l40.23"></a><span id="l40.23" class="difflineplus">+/* icalvalue* icalvalue_new_trigger (struct icaltriggertype v); */</span>
<a href="#l40.24"></a><span id="l40.24" class="difflineplus">+/* void icalvalue_set_trigger(icalvalue* value, struct icaltriggertype v); */</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineplus">+/* struct icaltriggertype icalvalue_get_trigger(const icalvalue* value); */</span>
<a href="#l40.26"></a><span id="l40.26"> </span>
<a href="#l40.27"></a><span id="l40.27" class="difflineminus">-icalvalue* icalvalue_new_datetimeperiod (struct icaldatetimeperiodtype v);</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineminus">-void icalvalue_set_datetimeperiod(icalvalue* value, </span>
<a href="#l40.29"></a><span id="l40.29" class="difflineminus">-				  struct icaldatetimeperiodtype v);</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineminus">-struct icaldatetimeperiodtype icalvalue_get_datetimeperiod(const icalvalue* value);</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineplus">+/* icalvalue* icalvalue_new_datetimeperiod (struct icaldatetimeperiodtype v); */</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+/* void icalvalue_set_datetimeperiod(icalvalue* value,  */</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineplus">+/* 				  struct icaldatetimeperiodtype v); */</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineplus">+/* struct icaldatetimeperiodtype icalvalue_get_datetimeperiod(const icalvalue* value); */</span>
<a href="#l40.35"></a><span id="l40.35"> </span>
<a href="#l40.36"></a><span id="l40.36"> /* Convert enumerations */</span>
<a href="#l40.37"></a><span id="l40.37"> </span>
<a href="#l40.38"></a><span id="l40.38"> icalvalue_kind icalvalue_string_to_kind(const char* str);</span>
<a href="#l40.39"></a><span id="l40.39"> const char* icalvalue_kind_to_string(const icalvalue_kind kind);</span>
<a href="#l40.40"></a><span id="l40.40"> </span>
<a href="#l40.41"></a><span id="l40.41"> /** Check validity of a specific icalvalue_kind **/</span>
<a href="#l40.42"></a><span id="l40.42"> int icalvalue_kind_is_valid(const icalvalue_kind kind);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1">new file mode 100644</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineminus">--- /dev/null</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineplus">+++ b/calendar/libical/src/libical/libicals_w32_vsnprintf_replacement.c</span>
<a href="#l41.4"></a><span id="l41.4" class="difflineat">@@ -0,0 +1,173 @@</span>
<a href="#l41.5"></a><span id="l41.5" class="difflineplus">+#ifdef WIN32</span>
<a href="#l41.6"></a><span id="l41.6" class="difflineplus">+#include &quot;config.h&quot;</span>
<a href="#l41.7"></a><span id="l41.7" class="difflineplus">+#ifndef HAVE_SNPRINTF</span>
<a href="#l41.8"></a><span id="l41.8" class="difflineplus">+#error DO NOT USE libical version of vsnprintf.</span>
<a href="#l41.9"></a><span id="l41.9" class="difflineplus">+#endif</span>
<a href="#l41.10"></a><span id="l41.10" class="difflineplus">+/*</span>
<a href="#l41.11"></a><span id="l41.11" class="difflineplus">+ * Revision 12: http://theos.com/~deraadt/snprintf.c</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineplus">+ *</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+ * Copyright (c) 1997 Theo de Raadt</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineplus">+ *</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+ * Redistribution and use in source and binary forms, with or without</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineplus">+ * modification, are permitted provided that the following conditions</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineplus">+ * are met:</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineplus">+ * 1. Redistributions of source code must retain the above copyright</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineplus">+ *    notice, this list of conditions and the following disclaimer.</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineplus">+ * 2. Redistributions in binary form must reproduce the above copyright</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineplus">+ *    notice, this list of conditions and the following disclaimer in the</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineplus">+ *    documentation and/or other materials provided with the distribution.</span>
<a href="#l41.23"></a><span id="l41.23" class="difflineplus">+ *</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineplus">+ * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR</span>
<a href="#l41.25"></a><span id="l41.25" class="difflineplus">+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
<a href="#l41.26"></a><span id="l41.26" class="difflineplus">+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<a href="#l41.27"></a><span id="l41.27" class="difflineplus">+ * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<a href="#l41.28"></a><span id="l41.28" class="difflineplus">+ * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT</span>
<a href="#l41.29"></a><span id="l41.29" class="difflineplus">+ * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineplus">+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineplus">+ * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineplus">+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineplus">+ * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineplus">+ */</span>
<a href="#l41.35"></a><span id="l41.35" class="difflineplus">+</span>
<a href="#l41.36"></a><span id="l41.36" class="difflineplus">+#ifndef WIN32</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineplus">+#include &lt;sys/param.h&gt;</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineplus">+#include &lt;sys/mman.h&gt;</span>
<a href="#l41.39"></a><span id="l41.39" class="difflineplus">+#include &lt;unistd.h&gt;</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineplus">+#endif</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineplus">+#include &lt;sys/types.h&gt;</span>
<a href="#l41.42"></a><span id="l41.42" class="difflineplus">+#include &lt;signal.h&gt;</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineplus">+#include &lt;stdio.h&gt;</span>
<a href="#l41.44"></a><span id="l41.44" class="difflineplus">+#include &lt;string.h&gt;</span>
<a href="#l41.45"></a><span id="l41.45" class="difflineplus">+#if __STDC__</span>
<a href="#l41.46"></a><span id="l41.46" class="difflineplus">+#include &lt;stdarg.h&gt;</span>
<a href="#l41.47"></a><span id="l41.47" class="difflineplus">+#include &lt;stdlib.h&gt;</span>
<a href="#l41.48"></a><span id="l41.48" class="difflineplus">+#else</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineplus">+#include &lt;varargs.h&gt;</span>
<a href="#l41.50"></a><span id="l41.50" class="difflineplus">+#endif</span>
<a href="#l41.51"></a><span id="l41.51" class="difflineplus">+#include &lt;setjmp.h&gt;</span>
<a href="#l41.52"></a><span id="l41.52" class="difflineplus">+</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineplus">+#ifndef roundup</span>
<a href="#l41.54"></a><span id="l41.54" class="difflineplus">+#define roundup(x, y) ((((x)+((y)-1))/(y))*(y))</span>
<a href="#l41.55"></a><span id="l41.55" class="difflineplus">+#endif</span>
<a href="#l41.56"></a><span id="l41.56" class="difflineplus">+</span>
<a href="#l41.57"></a><span id="l41.57" class="difflineplus">+static int pgsize;</span>
<a href="#l41.58"></a><span id="l41.58" class="difflineplus">+static char *curobj;</span>
<a href="#l41.59"></a><span id="l41.59" class="difflineplus">+static sigjmp_buf bail;</span>
<a href="#l41.60"></a><span id="l41.60" class="difflineplus">+</span>
<a href="#l41.61"></a><span id="l41.61" class="difflineplus">+#define EXTRABYTES	2	/* XXX: why 2? you don't want to know */</span>
<a href="#l41.62"></a><span id="l41.62" class="difflineplus">+</span>
<a href="#l41.63"></a><span id="l41.63" class="difflineplus">+static char *</span>
<a href="#l41.64"></a><span id="l41.64" class="difflineplus">+msetup(str, n)</span>
<a href="#l41.65"></a><span id="l41.65" class="difflineplus">+	char *str;</span>
<a href="#l41.66"></a><span id="l41.66" class="difflineplus">+	size_t n;</span>
<a href="#l41.67"></a><span id="l41.67" class="difflineplus">+{</span>
<a href="#l41.68"></a><span id="l41.68" class="difflineplus">+	char *e;</span>
<a href="#l41.69"></a><span id="l41.69" class="difflineplus">+</span>
<a href="#l41.70"></a><span id="l41.70" class="difflineplus">+	if (n == 0)</span>
<a href="#l41.71"></a><span id="l41.71" class="difflineplus">+		return NULL;</span>
<a href="#l41.72"></a><span id="l41.72" class="difflineplus">+	if (pgsize == 0)</span>
<a href="#l41.73"></a><span id="l41.73" class="difflineplus">+		pgsize = getpagesize();</span>
<a href="#l41.74"></a><span id="l41.74" class="difflineplus">+	curobj = (char *)malloc(n + EXTRABYTES + pgsize * 2);</span>
<a href="#l41.75"></a><span id="l41.75" class="difflineplus">+	if (curobj == NULL)</span>
<a href="#l41.76"></a><span id="l41.76" class="difflineplus">+		return NULL;</span>
<a href="#l41.77"></a><span id="l41.77" class="difflineplus">+	e = curobj + n + EXTRABYTES;</span>
<a href="#l41.78"></a><span id="l41.78" class="difflineplus">+	e = (char *)roundup((unsigned long)e, pgsize);</span>
<a href="#l41.79"></a><span id="l41.79" class="difflineplus">+	if (mprotect(e, pgsize, PROT_NONE) == -1) {</span>
<a href="#l41.80"></a><span id="l41.80" class="difflineplus">+		free(curobj);</span>
<a href="#l41.81"></a><span id="l41.81" class="difflineplus">+		curobj = NULL;</span>
<a href="#l41.82"></a><span id="l41.82" class="difflineplus">+		return NULL;</span>
<a href="#l41.83"></a><span id="l41.83" class="difflineplus">+	}</span>
<a href="#l41.84"></a><span id="l41.84" class="difflineplus">+	e = e - n - EXTRABYTES;</span>
<a href="#l41.85"></a><span id="l41.85" class="difflineplus">+	*e = '\0';</span>
<a href="#l41.86"></a><span id="l41.86" class="difflineplus">+	return (e);</span>
<a href="#l41.87"></a><span id="l41.87" class="difflineplus">+}</span>
<a href="#l41.88"></a><span id="l41.88" class="difflineplus">+</span>
<a href="#l41.89"></a><span id="l41.89" class="difflineplus">+static void</span>
<a href="#l41.90"></a><span id="l41.90" class="difflineplus">+mcatch(int i)</span>
<a href="#l41.91"></a><span id="l41.91" class="difflineplus">+{</span>
<a href="#l41.92"></a><span id="l41.92" class="difflineplus">+	siglongjmp(bail, 1);</span>
<a href="#l41.93"></a><span id="l41.93" class="difflineplus">+}</span>
<a href="#l41.94"></a><span id="l41.94" class="difflineplus">+</span>
<a href="#l41.95"></a><span id="l41.95" class="difflineplus">+static void</span>
<a href="#l41.96"></a><span id="l41.96" class="difflineplus">+mcleanup(str, n, p)</span>
<a href="#l41.97"></a><span id="l41.97" class="difflineplus">+	char *str;</span>
<a href="#l41.98"></a><span id="l41.98" class="difflineplus">+	size_t n;</span>
<a href="#l41.99"></a><span id="l41.99" class="difflineplus">+	char *p;</span>
<a href="#l41.100"></a><span id="l41.100" class="difflineplus">+{</span>
<a href="#l41.101"></a><span id="l41.101" class="difflineplus">+	strncpy(str, p, n-1);</span>
<a href="#l41.102"></a><span id="l41.102" class="difflineplus">+	str[n-1] = '\0';</span>
<a href="#l41.103"></a><span id="l41.103" class="difflineplus">+	if (mprotect((caddr_t)(p + n + EXTRABYTES), pgsize,</span>
<a href="#l41.104"></a><span id="l41.104" class="difflineplus">+	    PROT_READ|PROT_WRITE|PROT_EXEC) == -1)</span>
<a href="#l41.105"></a><span id="l41.105" class="difflineplus">+		mprotect((caddr_t)(p + n + EXTRABYTES), pgsize,</span>
<a href="#l41.106"></a><span id="l41.106" class="difflineplus">+		    PROT_READ|PROT_WRITE);</span>
<a href="#l41.107"></a><span id="l41.107" class="difflineplus">+	free(curobj);</span>
<a href="#l41.108"></a><span id="l41.108" class="difflineplus">+}</span>
<a href="#l41.109"></a><span id="l41.109" class="difflineplus">+</span>
<a href="#l41.110"></a><span id="l41.110" class="difflineplus">+int</span>
<a href="#l41.111"></a><span id="l41.111" class="difflineplus">+#if __STDC__</span>
<a href="#l41.112"></a><span id="l41.112" class="difflineplus">+vsnprintf(char *str, size_t n, char const *fmt, va_list ap)</span>
<a href="#l41.113"></a><span id="l41.113" class="difflineplus">+#else</span>
<a href="#l41.114"></a><span id="l41.114" class="difflineplus">+vsnprintf(str, n, fmt, ap)</span>
<a href="#l41.115"></a><span id="l41.115" class="difflineplus">+	char *str;</span>
<a href="#l41.116"></a><span id="l41.116" class="difflineplus">+	size_t n;</span>
<a href="#l41.117"></a><span id="l41.117" class="difflineplus">+	char *fmt;</span>
<a href="#l41.118"></a><span id="l41.118" class="difflineplus">+	char *ap;</span>
<a href="#l41.119"></a><span id="l41.119" class="difflineplus">+#endif</span>
<a href="#l41.120"></a><span id="l41.120" class="difflineplus">+{</span>
<a href="#l41.121"></a><span id="l41.121" class="difflineplus">+	struct sigaction osa, nsa;</span>
<a href="#l41.122"></a><span id="l41.122" class="difflineplus">+	char *p;</span>
<a href="#l41.123"></a><span id="l41.123" class="difflineplus">+	int ret = n + 1;	/* if we bail, indicated we overflowed */</span>
<a href="#l41.124"></a><span id="l41.124" class="difflineplus">+</span>
<a href="#l41.125"></a><span id="l41.125" class="difflineplus">+	memset(&amp;nsa, 0, sizeof nsa);</span>
<a href="#l41.126"></a><span id="l41.126" class="difflineplus">+	nsa.sa_handler = mcatch;</span>
<a href="#l41.127"></a><span id="l41.127" class="difflineplus">+	sigemptyset(&amp;nsa.sa_mask);</span>
<a href="#l41.128"></a><span id="l41.128" class="difflineplus">+</span>
<a href="#l41.129"></a><span id="l41.129" class="difflineplus">+	p = msetup(str, n);</span>
<a href="#l41.130"></a><span id="l41.130" class="difflineplus">+	if (p == NULL) {</span>
<a href="#l41.131"></a><span id="l41.131" class="difflineplus">+		*str = '\0';</span>
<a href="#l41.132"></a><span id="l41.132" class="difflineplus">+		return 0;</span>
<a href="#l41.133"></a><span id="l41.133" class="difflineplus">+	}</span>
<a href="#l41.134"></a><span id="l41.134" class="difflineplus">+	if (sigsetjmp(bail, 1) == 0) {</span>
<a href="#l41.135"></a><span id="l41.135" class="difflineplus">+		if (sigaction(SIGSEGV, &amp;nsa, &amp;osa) == -1) {</span>
<a href="#l41.136"></a><span id="l41.136" class="difflineplus">+			mcleanup(str, n, p);</span>
<a href="#l41.137"></a><span id="l41.137" class="difflineplus">+			return (0);</span>
<a href="#l41.138"></a><span id="l41.138" class="difflineplus">+		}</span>
<a href="#l41.139"></a><span id="l41.139" class="difflineplus">+		ret = vsprintf(p, fmt, ap);</span>
<a href="#l41.140"></a><span id="l41.140" class="difflineplus">+	}</span>
<a href="#l41.141"></a><span id="l41.141" class="difflineplus">+	mcleanup(str, n, p);</span>
<a href="#l41.142"></a><span id="l41.142" class="difflineplus">+	(void) sigaction(SIGSEGV, &amp;osa, NULL);</span>
<a href="#l41.143"></a><span id="l41.143" class="difflineplus">+	return (ret);</span>
<a href="#l41.144"></a><span id="l41.144" class="difflineplus">+}</span>
<a href="#l41.145"></a><span id="l41.145" class="difflineplus">+</span>
<a href="#l41.146"></a><span id="l41.146" class="difflineplus">+int</span>
<a href="#l41.147"></a><span id="l41.147" class="difflineplus">+#if __STDC__</span>
<a href="#l41.148"></a><span id="l41.148" class="difflineplus">+snprintf(char *str, size_t n, char const *fmt, ...)</span>
<a href="#l41.149"></a><span id="l41.149" class="difflineplus">+#else</span>
<a href="#l41.150"></a><span id="l41.150" class="difflineplus">+snprintf(str, n, fmt, va_alist)</span>
<a href="#l41.151"></a><span id="l41.151" class="difflineplus">+	char *str;</span>
<a href="#l41.152"></a><span id="l41.152" class="difflineplus">+	size_t n;</span>
<a href="#l41.153"></a><span id="l41.153" class="difflineplus">+	char *fmt;</span>
<a href="#l41.154"></a><span id="l41.154" class="difflineplus">+	va_dcl</span>
<a href="#l41.155"></a><span id="l41.155" class="difflineplus">+#endif</span>
<a href="#l41.156"></a><span id="l41.156" class="difflineplus">+{</span>
<a href="#l41.157"></a><span id="l41.157" class="difflineplus">+	va_list ap;</span>
<a href="#l41.158"></a><span id="l41.158" class="difflineplus">+#if __STDC__</span>
<a href="#l41.159"></a><span id="l41.159" class="difflineplus">+	va_start(ap, fmt);</span>
<a href="#l41.160"></a><span id="l41.160" class="difflineplus">+#else</span>
<a href="#l41.161"></a><span id="l41.161" class="difflineplus">+	va_start(ap);</span>
<a href="#l41.162"></a><span id="l41.162" class="difflineplus">+#endif</span>
<a href="#l41.163"></a><span id="l41.163" class="difflineplus">+</span>
<a href="#l41.164"></a><span id="l41.164" class="difflineplus">+	return (vsnprintf(str, n, fmt, ap));</span>
<a href="#l41.165"></a><span id="l41.165" class="difflineplus">+	va_end(ap);</span>
<a href="#l41.166"></a><span id="l41.166" class="difflineplus">+}</span>
<a href="#l41.167"></a><span id="l41.167" class="difflineplus">+</span>
<a href="#l41.168"></a><span id="l41.168" class="difflineplus">+</span>
<a href="#l41.169"></a><span id="l41.169" class="difflineplus">+#else</span>
<a href="#l41.170"></a><span id="l41.170" class="difflineplus">+</span>
<a href="#l41.171"></a><span id="l41.171" class="difflineplus">+/* ANSI C forbids an empty source file... */</span>
<a href="#l41.172"></a><span id="l41.172" class="difflineplus">+</span>
<a href="#l41.173"></a><span id="l41.173" class="difflineplus">+static void vsnprintf_dummy_func() {</span>
<a href="#l41.174"></a><span id="l41.174" class="difflineplus">+   vsnprintf_dummy_func();</span>
<a href="#l41.175"></a><span id="l41.175" class="difflineplus">+}</span>
<a href="#l41.176"></a><span id="l41.176" class="difflineplus">+</span>
<a href="#l41.177"></a><span id="l41.177" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/libical/src/libical/pvl.c</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/libical/src/libical/pvl.c</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -1,15 +1,27 @@</span>
<a href="#l42.4"></a><span id="l42.4"> /*======================================================================</span>
<a href="#l42.5"></a><span id="l42.5">  FILE: pvl.c</span>
<a href="#l42.6"></a><span id="l42.6">  CREATOR: eric November, 1995</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8"> </span>
<a href="#l42.9"></a><span id="l42.9">  (C) COPYRIGHT 2000, Eric Busboom &lt;eric@softwarestudio.org&gt;</span>
<a href="#l42.10"></a><span id="l42.10">      http://www.softwarestudio.org</span>
<a href="#l42.11"></a><span id="l42.11" class="difflineplus">+</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineplus">+ This program is free software; you can redistribute it and/or modify</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+ it under the terms of either:</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineplus">+</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+    The LGPL as published by the Free Software Foundation, version</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+    2.1, available at: http://www.fsf.org/copyleft/lesser.html</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineplus">+  Or:</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineplus">+</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineplus">+    The Mozilla Public License Version 1.0. You may obtain a copy of</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineplus">+    the License at http://www.mozilla.org/MPL/</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineplus">+</span>
<a href="#l42.23"></a><span id="l42.23"> ======================================================================*/</span>
<a href="#l42.24"></a><span id="l42.24"> </span>
<a href="#l42.25"></a><span id="l42.25"> #ifdef HAVE_CONFIG_H</span>
<a href="#l42.26"></a><span id="l42.26"> #include &quot;config.h&quot;</span>
<a href="#l42.27"></a><span id="l42.27"> #endif</span>
<a href="#l42.28"></a><span id="l42.28"> </span>
<a href="#l42.29"></a><span id="l42.29"> #include &quot;pvl.h&quot;</span>
<a href="#l42.30"></a><span id="l42.30"> #include &lt;errno.h&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/libical/src/libical/pvl.h</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/libical/src/libical/pvl.h</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -1,15 +1,27 @@</span>
<a href="#l43.4"></a><span id="l43.4"> /*======================================================================</span>
<a href="#l43.5"></a><span id="l43.5">  FILE: pvl.h</span>
<a href="#l43.6"></a><span id="l43.6">  CREATOR: eric November, 1995</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8"> </span>
<a href="#l43.9"></a><span id="l43.9">  (C) COPYRIGHT 2000, Eric Busboom &lt;eric@softwarestudio.org&gt;</span>
<a href="#l43.10"></a><span id="l43.10">      http://www.softwarestudio.org</span>
<a href="#l43.11"></a><span id="l43.11" class="difflineplus">+</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineplus">+ This program is free software; you can redistribute it and/or modify</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+ it under the terms of either:</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineplus">+</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineplus">+    The LGPL as published by the Free Software Foundation, version</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineplus">+    2.1, available at: http://www.fsf.org/copyleft/lesser.html</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineplus">+</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+  Or:</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineplus">+    The Mozilla Public License Version 1.0. You may obtain a copy of</span>
<a href="#l43.21"></a><span id="l43.21" class="difflineplus">+    the License at http://www.mozilla.org/MPL/</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineplus">+</span>
<a href="#l43.23"></a><span id="l43.23"> ======================================================================*/</span>
<a href="#l43.24"></a><span id="l43.24"> </span>
<a href="#l43.25"></a><span id="l43.25"> </span>
<a href="#l43.26"></a><span id="l43.26"> #ifndef __PVL_H__</span>
<a href="#l43.27"></a><span id="l43.27"> #define __PVL_H__</span>
<a href="#l43.28"></a><span id="l43.28"> </span>
<a href="#l43.29"></a><span id="l43.29"> typedef struct pvl_list_t* pvl_list;</span>
<a href="#l43.30"></a><span id="l43.30"> typedef struct pvl_elem_t* pvl_elem;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/libical/src/libical/sspm.c</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/libical/src/libical/sspm.c</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -176,17 +176,18 @@ char* sspm_get_parameter(const char* lin</span>
<a href="#l44.4"></a><span id="l44.4"> </span>
<a href="#l44.5"></a><span id="l44.5">     if(q !=0){</span>
<a href="#l44.6"></a><span id="l44.6"> 	p = q+1;</span>
<a href="#l44.7"></a><span id="l44.7">     }</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9">     if(s != 0){</span>
<a href="#l44.10"></a><span id="l44.10"> 	strncpy(name,p,(size_t)s-(size_t)p);</span>
<a href="#l44.11"></a><span id="l44.11">     } else {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-	strcpy(name,p);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+	strncpy(name,p,sizeof(name)-1);</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+	name[sizeof(name)-1]='\0';</span>
<a href="#l44.15"></a><span id="l44.15">     }</span>
<a href="#l44.16"></a><span id="l44.16"> </span>
<a href="#l44.17"></a><span id="l44.17">     /* Strip off trailing quote, if it exists */</span>
<a href="#l44.18"></a><span id="l44.18"> </span>
<a href="#l44.19"></a><span id="l44.19">     q = strrchr(name,'\&quot;');</span>
<a href="#l44.20"></a><span id="l44.20"> </span>
<a href="#l44.21"></a><span id="l44.21">     if (q != 0){</span>
<a href="#l44.22"></a><span id="l44.22"> 	*q='\0';</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineat">@@ -247,17 +248,17 @@ static const char *mime_headers[] = {</span>
<a href="#l44.24"></a><span id="l44.24">     &quot;Content-Transfer-Encoding&quot;,</span>
<a href="#l44.25"></a><span id="l44.25">     &quot;Content-Disposition&quot;,</span>
<a href="#l44.26"></a><span id="l44.26">     &quot;Content-Id&quot;,</span>
<a href="#l44.27"></a><span id="l44.27">     &quot;Mime-Version&quot;,</span>
<a href="#l44.28"></a><span id="l44.28">     0 </span>
<a href="#l44.29"></a><span id="l44.29"> };</span>
<a href="#l44.30"></a><span id="l44.30"> </span>
<a href="#l44.31"></a><span id="l44.31"> </span>
<a href="#l44.32"></a><span id="l44.32" class="difflineminus">-void* sspm_default_new_part()</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+void* sspm_default_new_part(void)</span>
<a href="#l44.34"></a><span id="l44.34"> {</span>
<a href="#l44.35"></a><span id="l44.35">     return 0;</span>
<a href="#l44.36"></a><span id="l44.36"> }</span>
<a href="#l44.37"></a><span id="l44.37"> void sspm_default_add_line(void *part, struct sspm_header *header, </span>
<a href="#l44.38"></a><span id="l44.38"> 			   const char* line, size_t size)</span>
<a href="#l44.39"></a><span id="l44.39"> {</span>
<a href="#l44.40"></a><span id="l44.40">     (void)part;</span>
<a href="#l44.41"></a><span id="l44.41">     (void)header;</span>
<a href="#l44.42"></a><span id="l44.42" class="difflineat">@@ -467,16 +468,17 @@ enum sspm_major_type sspm_find_major_con</span>
<a href="#l44.43"></a><span id="l44.43"> enum sspm_minor_type sspm_find_minor_content_type(char* type)</span>
<a href="#l44.44"></a><span id="l44.44"> {</span>
<a href="#l44.45"></a><span id="l44.45">     int i;</span>
<a href="#l44.46"></a><span id="l44.46">     char* ltype = sspm_lowercase(type);</span>
<a href="#l44.47"></a><span id="l44.47"> </span>
<a href="#l44.48"></a><span id="l44.48">     char *p = strchr(ltype,'/');</span>
<a href="#l44.49"></a><span id="l44.49"> </span>
<a href="#l44.50"></a><span id="l44.50">     if (p==0){</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineplus">+        free(ltype);</span>
<a href="#l44.52"></a><span id="l44.52"> 	return SSPM_UNKNOWN_MINOR_TYPE; </span>
<a href="#l44.53"></a><span id="l44.53">     }</span>
<a href="#l44.54"></a><span id="l44.54"> </span>
<a href="#l44.55"></a><span id="l44.55">     p++; /* Skip the '/' */</span>
<a href="#l44.56"></a><span id="l44.56"> </span>
<a href="#l44.57"></a><span id="l44.57">     for (i=0; minor_content_type_map[i].type !=  SSPM_UNKNOWN_MINOR_TYPE; i++){</span>
<a href="#l44.58"></a><span id="l44.58"> 	if(strncmp(p, minor_content_type_map[i].str,</span>
<a href="#l44.59"></a><span id="l44.59"> 		   strlen(minor_content_type_map[i].str))==0){</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/libical/src/libical/sspm.h</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/libical/src/libical/sspm.h</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -106,17 +106,17 @@ struct sspm_part {</span>
<a href="#l45.4"></a><span id="l45.4"> 	int level;</span>
<a href="#l45.5"></a><span id="l45.5"> 	size_t data_size;</span>
<a href="#l45.6"></a><span id="l45.6"> 	void *data;</span>
<a href="#l45.7"></a><span id="l45.7"> };</span>
<a href="#l45.8"></a><span id="l45.8"> </span>
<a href="#l45.9"></a><span id="l45.9"> struct sspm_action_map {</span>
<a href="#l45.10"></a><span id="l45.10"> 	enum sspm_major_type major;</span>
<a href="#l45.11"></a><span id="l45.11"> 	enum sspm_minor_type minor;</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-	void* (*new_part)();</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+	void* (*new_part)(void);</span>
<a href="#l45.14"></a><span id="l45.14"> 	void (*add_line)(void *part, struct sspm_header *header, </span>
<a href="#l45.15"></a><span id="l45.15"> 			 const char* line, size_t size);</span>
<a href="#l45.16"></a><span id="l45.16"> 	void* (*end_part)(void* part);</span>
<a href="#l45.17"></a><span id="l45.17"> 	void (*free_part)(void *part);</span>
<a href="#l45.18"></a><span id="l45.18"> };</span>
<a href="#l45.19"></a><span id="l45.19"> </span>
<a href="#l45.20"></a><span id="l45.20"> const char* sspm_major_type_string(enum sspm_major_type type);</span>
<a href="#l45.21"></a><span id="l45.21"> const char* sspm_minor_type_string(enum sspm_minor_type type);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1">new file mode 100644</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineminus">--- /dev/null</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineplus">+++ b/calendar/libical/src/libical/vsnprintf.h</span>
<a href="#l46.4"></a><span id="l46.4" class="difflineat">@@ -0,0 +1,33 @@</span>
<a href="#l46.5"></a><span id="l46.5" class="difflineplus">+#ifdef WIN32</span>
<a href="#l46.6"></a><span id="l46.6" class="difflineplus">+</span>
<a href="#l46.7"></a><span id="l46.7" class="difflineplus">+#ifndef roundup</span>
<a href="#l46.8"></a><span id="l46.8" class="difflineplus">+#define roundup(x, y) ((((x)+((y)-1))/(y))*(y))</span>
<a href="#l46.9"></a><span id="l46.9" class="difflineplus">+#endif</span>
<a href="#l46.10"></a><span id="l46.10" class="difflineplus">+</span>
<a href="#l46.11"></a><span id="l46.11" class="difflineplus">+#include &lt;stdlib.h&gt;</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineplus">+#include &lt;stdarg.h&gt;</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineplus">+int</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineplus">+#if __STDC__</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineplus">+vsnprintf(char *str, size_t n, char const *fmt, va_list ap);</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineplus">+#else</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineplus">+vsnprintf(str, n, fmt, ap);</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineplus">+	char *str;</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineplus">+	size_t n;</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineplus">+	char *fmt;</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineplus">+	char *ap;</span>
<a href="#l46.23"></a><span id="l46.23" class="difflineplus">+#endif</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineplus">+</span>
<a href="#l46.25"></a><span id="l46.25" class="difflineplus">+</span>
<a href="#l46.26"></a><span id="l46.26" class="difflineplus">+int</span>
<a href="#l46.27"></a><span id="l46.27" class="difflineplus">+#if __STDC__</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineplus">+snprintf(char *str, size_t n, char const *fmt, ...);</span>
<a href="#l46.29"></a><span id="l46.29" class="difflineplus">+#else</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineplus">+snprintf(str, n, fmt, va_alist);</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineplus">+	char *str;</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+	size_t n;</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineplus">+	char *fmt;</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineplus">+	va_dcl</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineplus">+#endif</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineplus">+</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineplus">+#endif</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

