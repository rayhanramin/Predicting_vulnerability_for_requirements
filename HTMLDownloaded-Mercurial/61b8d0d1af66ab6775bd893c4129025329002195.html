<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3157:61b8d0d1af66ab6775bd893c4129025329002195</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 61b8d0d1af66ab6775bd893c4129025329002195" />
<meta property="og:url" content="/comm-central/rev/61b8d0d1af66ab6775bd893c4129025329002195" />
<meta property="og:description" content="Bug 506613: some brokenness in the standalone message window. r=asuth" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 61b8d0d1af66ab6775bd893c4129025329002195 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/61b8d0d1af66ab6775bd893c4129025329002195">shortlog</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/61b8d0d1af66ab6775bd893c4129025329002195">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195">files</a> |
changeset |
<a href="/comm-central/raw-rev/61b8d0d1af66ab6775bd893c4129025329002195">raw</a>  | <a href="/comm-central/archive/61b8d0d1af66ab6775bd893c4129025329002195.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=506613">Bug 506613</a>: some brokenness in the standalone message window. r=asuth
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 28 Jul 2009 11:54:37 +0300</td></tr>

<tr>
 <td>changeset 3157</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/61b8d0d1af66ab6775bd893c4129025329002195">61b8d0d1af66ab6775bd893c4129025329002195</a></td>
</tr>



<tr>
<td>parent 3156</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ff42403148921dc3d3a822ba3d688012d2d372f7">ff42403148921dc3d3a822ba3d688012d2d372f7</a>
</td>
</tr>

<tr>
<td>child 3158</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/32a58120ea69ce1da517bf6d72d96b056472a05f">32a58120ea69ce1da517bf6d72d96b056472a05f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=61b8d0d1af66ab6775bd893c4129025329002195">2571</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Tue, 28 Jul 2009 08:54:59 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@61b8d0d1af66 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=61b8d0d1af66ab6775bd893c4129025329002195">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=61b8d0d1af66ab6775bd893c4129025329002195&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=61b8d0d1af66ab6775bd893c4129025329002195&newProject=comm-central&newRevision=61b8d0d1af66ab6775bd893c4129025329002195&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=61b8d0d1af66ab6775bd893c4129025329002195&newProject=comm-central&newRevision=61b8d0d1af66ab6775bd893c4129025329002195&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=61b8d0d1af66ab6775bd893c4129025329002195&newProject=comm-central&newRevision=61b8d0d1af66ab6775bd893c4129025329002195&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28asuth%29&revcount=50">asuth</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=506613">506613</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=506613">Bug 506613</a>: some brokenness in the standalone message window. r=asuth</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mail3PaneWindowCommands.js">mail/base/content/mail3PaneWindowCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mail3PaneWindowCommands.js">file</a> |
<a href="/comm-central/annotate/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mail3PaneWindowCommands.js">annotate</a> |
<a href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mail3PaneWindowCommands.js">diff</a> |
<a href="/comm-central/comparison/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mail3PaneWindowCommands.js">comparison</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mail3PaneWindowCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/messageWindow.js">mail/base/content/messageWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/messageWindow.js">file</a> |
<a href="/comm-central/annotate/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/messageWindow.js">annotate</a> |
<a href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/messageWindow.js">diff</a> |
<a href="/comm-central/comparison/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/messageWindow.js">comparison</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/messageWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgHdrViewOverlay.js">mail/base/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/61b8d0d1af66ab6775bd893c4129025329002195/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">file</a> |
<a href="/comm-central/annotate/61b8d0d1af66ab6775bd893c4129025329002195/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">annotate</a> |
<a href="/comm-central/diff/61b8d0d1af66ab6775bd893c4129025329002195/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">diff</a> |
<a href="/comm-central/comparison/61b8d0d1af66ab6775bd893c4129025329002195/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">comparison</a> |
<a href="/comm-central/log/61b8d0d1af66ab6775bd893c4129025329002195/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -280,18 +280,18 @@ var DefaultController =</span>
<a href="#l1.4"></a><span id="l1.4">         return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l1.5"></a><span id="l1.5">       case &quot;cmd_killThread&quot;:</span>
<a href="#l1.6"></a><span id="l1.6">       case &quot;cmd_killSubthread&quot;:</span>
<a href="#l1.7"></a><span id="l1.7">         return GetNumSelectedMessages() &gt; 0;</span>
<a href="#l1.8"></a><span id="l1.8">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l1.9"></a><span id="l1.9">         return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.toggleThreadWatched);</span>
<a href="#l1.10"></a><span id="l1.10">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l1.11"></a><span id="l1.11">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        var loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-        if (!(loadedFolder &amp;&amp; loadedFolder.server.canHaveFilters))</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+        if (!(gFolderDisplay.displayedFolder &amp;&amp;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+              gFolderDisplay.displayedFolder.server.canHaveFilters))</span>
<a href="#l1.16"></a><span id="l1.16">           return false;   // else fall thru</span>
<a href="#l1.17"></a><span id="l1.17">       case &quot;cmd_saveAsFile&quot;:</span>
<a href="#l1.18"></a><span id="l1.18">       case &quot;cmd_saveAsTemplate&quot;:</span>
<a href="#l1.19"></a><span id="l1.19">         if (GetNumSelectedMessages() &gt; 1)</span>
<a href="#l1.20"></a><span id="l1.20">           return false;   // else fall thru</span>
<a href="#l1.21"></a><span id="l1.21">       case &quot;cmd_reply&quot;:</span>
<a href="#l1.22"></a><span id="l1.22">       case &quot;button_reply&quot;:</span>
<a href="#l1.23"></a><span id="l1.23">       case &quot;cmd_replySender&quot;:</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineat">@@ -347,24 +347,21 @@ var DefaultController =</span>
<a href="#l1.25"></a><span id="l1.25">           return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody);</span>
<a href="#l1.26"></a><span id="l1.26">         return false;</span>
<a href="#l1.27"></a><span id="l1.27">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l1.28"></a><span id="l1.28">         return true;</span>
<a href="#l1.29"></a><span id="l1.29">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l1.30"></a><span id="l1.30">       case &quot;button_file&quot;:</span>
<a href="#l1.31"></a><span id="l1.31">       case &quot;cmd_file&quot;:</span>
<a href="#l1.32"></a><span id="l1.32">       case &quot;cmd_archive&quot;:</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-        return (GetNumSelectedMessages() &gt; 0 );</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+        return (gFolderDisplay.selectedCount &gt; 0 );</span>
<a href="#l1.35"></a><span id="l1.35">       case &quot;button_archive&quot;:</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-      {</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-        let folder = GetLoadedMsgFolder();</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-        return GetNumSelectedMessages() &gt; 0 &amp;&amp; folder &amp;&amp;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-          !folder.isSpecialFolder(Components.interfaces.nsMsgFolderFlags.Archive,</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-                                  true);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-      }</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+        return gFolderDisplay.selectedCount &gt; 0 &amp;&amp; gFolderDisplay.displayedFolder &amp;&amp;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+          !gFolderDisplay.displayedFolder.isSpecialFolder(</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+             Components.interfaces.nsMsgFolderFlags.Archive, true);</span>
<a href="#l1.45"></a><span id="l1.45">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l1.46"></a><span id="l1.46">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l1.47"></a><span id="l1.47">         // can't do news on junk yet.</span>
<a href="#l1.48"></a><span id="l1.48">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; !gFolderDisplay.selectedMessageIsNews);</span>
<a href="#l1.49"></a><span id="l1.49">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l1.50"></a><span id="l1.50">         if (GetNumSelectedMessages() &gt; 0)</span>
<a href="#l1.51"></a><span id="l1.51">           return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l1.52"></a><span id="l1.52">         return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -118,20 +118,16 @@ function fillMailContextMenu(event)</span>
<a href="#l2.4"></a><span id="l2.4">     return false; // Don't show the context menu if no items are selected.</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">   var inThreadPane = popupNodeIsInThreadPane();</span>
<a href="#l2.7"></a><span id="l2.7">   gContextMenu = new nsContextMenu(event.target);</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">   var selectedMessage = gFolderDisplay.selectedMessage;</span>
<a href="#l2.10"></a><span id="l2.10">   var isNewsgroup = gFolderDisplay.selectedMessageIsNews;</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  // Clear the global var used to keep track if a 'Delete Message' or 'Move</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  // To' command has been triggered via the thread pane context menu.</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-  gThreadPaneDeleteOrMoveOccurred = false;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-</span>
<a href="#l2.16"></a><span id="l2.16">   // Don't show mail items for links/images, just show related items.</span>
<a href="#l2.17"></a><span id="l2.17">   var hideMailItems = !inThreadPane &amp;&amp;</span>
<a href="#l2.18"></a><span id="l2.18">                       (gContextMenu.onImage || gContextMenu.onLink);</span>
<a href="#l2.19"></a><span id="l2.19">   var single = (numSelected == 1);</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">   // Select-all and copy are only available in the message-pane</span>
<a href="#l2.22"></a><span id="l2.22">   if (inThreadPane) {</span>
<a href="#l2.23"></a><span id="l2.23">     document.getElementById(&quot;mailContext-selectall&quot;).hidden = true;</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineat">@@ -167,17 +163,17 @@ function fillMailContextMenu(event)</span>
<a href="#l2.25"></a><span id="l2.25">                numSelected &gt; 1 &amp;&amp; inThreadPane &amp;&amp; !hideMailItems);</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27">   setSingleSelection(&quot;mailContext-copyMessageUrl&quot;, isNewsgroup);</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29">   ShowMenuItem(&quot;mailContext-sep-open&quot;, single);</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31">   ShowMenuItem(&quot;mailContext-sep-reply&quot;, true);</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-  var msgFolder = GetLoadedMsgFolder();</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  let msgFolder = gFolderDisplay.displayedFolder;</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36">   // Set up the move menu. We can't move from newsgroups.</span>
<a href="#l2.37"></a><span id="l2.37">   ShowMenuItem(&quot;mailContext-moveMenu&quot;,</span>
<a href="#l2.38"></a><span id="l2.38">                !isNewsgroup &amp;&amp; !hideMailItems &amp;&amp; msgFolder);</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40">   // disable move if we can't delete message(s) from this folder</span>
<a href="#l2.41"></a><span id="l2.41">   var canMove = msgFolder &amp;&amp; msgFolder.canDeleteMessages;</span>
<a href="#l2.42"></a><span id="l2.42">   EnableMenuItem(&quot;mailContext-moveMenu&quot;, canMove);</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineat">@@ -718,26 +714,29 @@ function addEmail()</span>
<a href="#l2.44"></a><span id="l2.44">   var url = gContextMenu.linkURL;</span>
<a href="#l2.45"></a><span id="l2.45">   var addresses = getEmail(url);</span>
<a href="#l2.46"></a><span id="l2.46">   window.openDialog(&quot;chrome://messenger/content/addressbook/abNewCardDialog.xul&quot;,</span>
<a href="#l2.47"></a><span id="l2.47">                     &quot;&quot;,</span>
<a href="#l2.48"></a><span id="l2.48">                      &quot;chrome,resizable=no,titlebar,modal,centerscreen&quot;,</span>
<a href="#l2.49"></a><span id="l2.49">                     {primaryEmail: addresses});</span>
<a href="#l2.50"></a><span id="l2.50"> }</span>
<a href="#l2.51"></a><span id="l2.51"> </span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-function composeEmailTo ()</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+function composeEmailTo()</span>
<a href="#l2.54"></a><span id="l2.54"> {</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-  var url = gContextMenu.linkURL;</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-  var addresses = getEmail(url);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-  var fields = Components.classes[&quot;@mozilla.org/messengercompose/composefields;1&quot;].createInstance(Components.interfaces.nsIMsgCompFields);</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-  var params = Components.classes[&quot;@mozilla.org/messengercompose/composeparams;1&quot;].createInstance(Components.interfaces.nsIMsgComposeParams);</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-  fields.to = addresses;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+  let fields = Components.classes[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+                         .createInstance(Components.interfaces.nsIMsgCompFields);</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+  let params = Components.classes[&quot;@mozilla.org/messengercompose/composeparams;1&quot;]</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+                         .createInstance(Components.interfaces.nsIMsgComposeParams);</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+  fields.to = getEmail(gContextMenu.linkURL);</span>
<a href="#l2.65"></a><span id="l2.65">   params.type = Components.interfaces.nsIMsgCompType.New;</span>
<a href="#l2.66"></a><span id="l2.66">   params.format = Components.interfaces.nsIMsgCompFormat.Default;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-  params.identity = accountManager.getFirstIdentityForServer(GetLoadedMsgFolder().server);</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+  if (gFolderDisplay.displayedFolder) {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+    params.identity = accountManager.getFirstIdentityForServer(</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+                        gFolderDisplay.displayedFolder.server);</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+  }</span>
<a href="#l2.72"></a><span id="l2.72">   params.composeFields = fields;</span>
<a href="#l2.73"></a><span id="l2.73">   msgComposeService.OpenComposeWindowWithParams(null, params);</span>
<a href="#l2.74"></a><span id="l2.74"> }</span>
<a href="#l2.75"></a><span id="l2.75"> </span>
<a href="#l2.76"></a><span id="l2.76"> // Extracts email address from url string</span>
<a href="#l2.77"></a><span id="l2.77"> function getEmail (url)</span>
<a href="#l2.78"></a><span id="l2.78"> {</span>
<a href="#l2.79"></a><span id="l2.79">   var qmark = url.indexOf( &quot;?&quot; );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -86,22 +86,20 @@ var gMarkViewedMessageAsReadTimer = null</span>
<a href="#l3.4"></a><span id="l3.4"> // change during runtime other than through the MsgBody*() functions below.</span>
<a href="#l3.5"></a><span id="l3.5"> var gDisallow_classes_no_html = 1;</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7"> // Disable the new account menu item if the account preference is locked.</span>
<a href="#l3.8"></a><span id="l3.8"> // Two other affected areas are the account central and the account manager</span>
<a href="#l3.9"></a><span id="l3.9"> // dialog.</span>
<a href="#l3.10"></a><span id="l3.10"> function menu_new_init()</span>
<a href="#l3.11"></a><span id="l3.11"> {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  var folders = gFolderTreeView.getSelectedFolders();</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  if (folders.length != 1)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  let folder = gFolderDisplay.displayedFolder;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  if (!folder)</span>
<a href="#l3.16"></a><span id="l3.16">     return;</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-  var folder = folders[0];</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-</span>
<a href="#l3.20"></a><span id="l3.20">   if (!gMessengerBundle)</span>
<a href="#l3.21"></a><span id="l3.21">     gMessengerBundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">   if (gPrefBranch.prefIsLocked(&quot;mail.disable_new_account_addition&quot;))</span>
<a href="#l3.24"></a><span id="l3.24">     document.getElementById(&quot;newAccountMenuItem&quot;).setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26">   const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l3.27"></a><span id="l3.27">   var isInbox = folder.isSpecialFolder(nsMsgFolderFlags.Inbox);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/messageWindow.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/messageWindow.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -647,17 +647,17 @@ function GetSelectedMsgFolders()</span>
<a href="#l4.4"></a><span id="l4.4"> {</span>
<a href="#l4.5"></a><span id="l4.5">   if (gFolderDisplay.displayedFolder)</span>
<a href="#l4.6"></a><span id="l4.6">     return [gFolderDisplay.displayedFolder];</span>
<a href="#l4.7"></a><span id="l4.7">   return [];</span>
<a href="#l4.8"></a><span id="l4.8"> }</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> function GetNumSelectedMessages()</span>
<a href="#l4.11"></a><span id="l4.11"> {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  return gFolderDisplay.treeSelection.count;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  return gFolderDisplay.selectedCount;</span>
<a href="#l4.14"></a><span id="l4.14"> }</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> function ReloadMessage()</span>
<a href="#l4.17"></a><span id="l4.17"> {</span>
<a href="#l4.18"></a><span id="l4.18">   gFolderDisplay.view.dbView.reloadMessage();</span>
<a href="#l4.19"></a><span id="l4.19"> }</span>
<a href="#l4.20"></a><span id="l4.20"> </span>
<a href="#l4.21"></a><span id="l4.21"> function MsgDeleteMessageFromMessageWindow(reallyDelete, fromToolbar)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1252,61 +1252,59 @@ function AddContact(emailAddressNode)</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> function EditContact(emailAddressNode)</span>
<a href="#l5.6"></a><span id="l5.6"> {</span>
<a href="#l5.7"></a><span id="l5.7">   if (emailAddressNode.cardDetails.card)</span>
<a href="#l5.8"></a><span id="l5.8">     editContactInlineUI.showEditContactPanel(emailAddressNode.cardDetails,</span>
<a href="#l5.9"></a><span id="l5.9">                                              emailAddressNode);</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-// SendMailToNode takes the email address title button, extracts</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-// the email address we stored in there and opens a compose window</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-// with that address</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+/**</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+ * Takes the email address title button, extracts the email address we stored</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+ * in there and opens a compose window with that address.</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+ * @param emailAddressNode a node which has a &quot;fullAddress&quot; attribute</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+ */</span>
<a href="#l5.20"></a><span id="l5.20"> function SendMailToNode(emailAddressNode)</span>
<a href="#l5.21"></a><span id="l5.21"> {</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-  var fields = Components.classes[&quot;@mozilla.org/messengercompose/composefields;1&quot;].createInstance(Components.interfaces.nsIMsgCompFields);</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-  var params = Components.classes[&quot;@mozilla.org/messengercompose/composeparams;1&quot;].createInstance(Components.interfaces.nsIMsgComposeParams);</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-  if (emailAddressNode &amp;&amp; fields &amp;&amp; params)</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-  {</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-    fields.to = emailAddressNode.getAttribute(&quot;fullAddress&quot;);</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-    params.type = Components.interfaces.nsIMsgCompType.New;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-    params.format = Components.interfaces.nsIMsgCompFormat.Default;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-    params.identity = accountManager.getFirstIdentityForServer(GetLoadedMsgFolder().server);</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-    params.composeFields = fields;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-    msgComposeService.OpenComposeWindowWithParams(null, params);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  let fields = Components.classes[&quot;@mozilla.org/messengercompose/composefields;1&quot;]</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+                         .createInstance(Components.interfaces.nsIMsgCompFields);</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  let params = Components.classes[&quot;@mozilla.org/messengercompose/composeparams;1&quot;]</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+                         .createInstance(Components.interfaces.nsIMsgComposeParams);</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  fields.to = emailAddressNode.getAttribute(&quot;fullAddress&quot;);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+  params.type = Components.interfaces.nsIMsgCompType.New;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+  params.format = Components.interfaces.nsIMsgCompFormat.Default;</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+  if (gFolderDisplay.displayedFolder) {</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+    params.identity = accountManager.getFirstIdentityForServer(</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+                        gFolderDisplay.displayedFolder.server);</span>
<a href="#l5.42"></a><span id="l5.42">   }</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+  params.composeFields = fields;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+  msgComposeService.OpenComposeWindowWithParams(null, params);</span>
<a href="#l5.45"></a><span id="l5.45"> }</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-// CopyEmailAddress takes the email address title button, extracts</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-// the email address we stored in there and copies it to the clipboard</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+/**</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+ * Takes the email address title button, extracts the email address we stored</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+ * in there and copies it to the clipboard.</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+ * @param emailAddressNode a node which has an &quot;emailAddress&quot; attribute</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+ */</span>
<a href="#l5.54"></a><span id="l5.54"> function CopyEmailAddress(emailAddressNode)</span>
<a href="#l5.55"></a><span id="l5.55"> {</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-  if (emailAddressNode)</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-  {</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-    var emailAddress = emailAddressNode.getAttribute(&quot;emailAddress&quot;);</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-    var contractid = &quot;@mozilla.org/widget/clipboardhelper;1&quot;;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-    var iid = Components.interfaces.nsIClipboardHelper;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-    var clipboard = Components.classes[contractid].getService(iid);</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-    clipboard.copyString(emailAddress);</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-  }</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+  let clipboard = Components.classes[&quot;@mozilla.org/widget/clipboardhelper;1&quot;]</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+                            .getService(Components.interfaces.nsIClipboardHelper);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+  clipboard.copyString(emailAddressNode.getAttribute(&quot;emailAddress&quot;));</span>
<a href="#l5.68"></a><span id="l5.68"> }</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-// CreateFilter opens the Message Filters and Filter Rules dialogs.</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-//The Filter Rules dialog has focus. The window is prefilled with filtername &lt;email address&gt;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-//Sender condition is selected and the value is prefilled &lt;email address&gt;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+/**</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+ * Causes the filter dialog to pop up, prefilled for the specified e-mail</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+ * address.</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+ * @param emailAddressNode a node which has an &quot;emailAddress&quot; attribute</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+ */</span>
<a href="#l5.78"></a><span id="l5.78"> function CreateFilter(emailAddressNode)</span>
<a href="#l5.79"></a><span id="l5.79"> {</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-  if (emailAddressNode)</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-  {</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-     var emailAddress = emailAddressNode.getAttribute(&quot;emailAddress&quot;);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-     if (emailAddress){</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-         top.MsgFilters(emailAddress, GetFirstSelectedMsgFolder());</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-     }</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-  }</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+  let emailAddress = emailAddressNode.getAttribute(&quot;emailAddress&quot;);</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+  top.MsgFilters(emailAddress, GetFirstSelectedMsgFolder());</span>
<a href="#l5.89"></a><span id="l5.89"> }</span>
<a href="#l5.90"></a><span id="l5.90"> </span>
<a href="#l5.91"></a><span id="l5.91"> // createnewAttachmentInfo --&gt; constructor method for creating new attachment object which goes into the</span>
<a href="#l5.92"></a><span id="l5.92"> // data attachment array.</span>
<a href="#l5.93"></a><span id="l5.93"> function createNewAttachmentInfo(contentType, url, displayName, uri, isExternalAttachment)</span>
<a href="#l5.94"></a><span id="l5.94"> {</span>
<a href="#l5.95"></a><span id="l5.95">   this.contentType = contentType;</span>
<a href="#l5.96"></a><span id="l5.96">   this.url = url;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -80,21 +80,16 @@ var gStartFolderUri = null;</span>
<a href="#l6.4"></a><span id="l6.4">  *</span>
<a href="#l6.5"></a><span id="l6.5">  * The value of this variable is an object with &quot;view&quot; and &quot;selection&quot; keys</span>
<a href="#l6.6"></a><span id="l6.6">  * and values.  The view value is the view whose selection we saved off, and</span>
<a href="#l6.7"></a><span id="l6.7">  * the selection value is the selection object we saved off.</span>
<a href="#l6.8"></a><span id="l6.8">  */</span>
<a href="#l6.9"></a><span id="l6.9"> var gRightMouseButtonSavedSelection = null;</span>
<a href="#l6.10"></a><span id="l6.10"> var gNewAccountToLoad = null;</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-// Global var to keep track of if the 'Delete Message' or 'Move To' thread pane</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-// context menu item was triggered.  This helps prevent the tree view from</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-// not updating on one of those menu item commands.</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-var gThreadPaneDeleteOrMoveOccurred = false;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-</span>
<a href="#l6.17"></a><span id="l6.17"> var gDisplayStartupPage = false;</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19"> // the folderListener object</span>
<a href="#l6.20"></a><span id="l6.20"> var folderListener = {</span>
<a href="#l6.21"></a><span id="l6.21">     OnItemAdded: function(parentItem, item) { },</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">     OnItemRemoved: function(parentItem, item) { },</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25" class="difflineat">@@ -986,21 +981,16 @@ function ThreadTreeOnClick(event)</span>
<a href="#l6.26"></a><span id="l6.26">   }</span>
<a href="#l6.27"></a><span id="l6.27"> }</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29"> function GetSelectedMsgFolders()</span>
<a href="#l6.30"></a><span id="l6.30"> {</span>
<a href="#l6.31"></a><span id="l6.31">   return gFolderTreeView.getSelectedFolders();</span>
<a href="#l6.32"></a><span id="l6.32"> }</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-function GetLoadedMsgFolder()</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-{</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-  return gFolderDisplay.displayedFolder;</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-}</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-</span>
<a href="#l6.39"></a><span id="l6.39"> function SelectFolder(folderUri)</span>
<a href="#l6.40"></a><span id="l6.40"> {</span>
<a href="#l6.41"></a><span id="l6.41">   gFolderTreeView.selectFolder(GetMsgFolderFromUri(folderUri));</span>
<a href="#l6.42"></a><span id="l6.42"> }</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44"> function ReloadMessage()</span>
<a href="#l6.45"></a><span id="l6.45"> {</span>
<a href="#l6.46"></a><span id="l6.46">   gFolderDisplay.view.dbView.reloadMessage();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -44,17 +44,17 @@ var gBrandBundle;</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> const nsPKIParamBlock    = &quot;@mozilla.org/security/pkiparamblock;1&quot;;</span>
<a href="#l7.6"></a><span id="l7.6"> const nsIPKIParamBlock    = Components.interfaces.nsIPKIParamBlock;</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> function setupBundles()</span>
<a href="#l7.9"></a><span id="l7.9"> {</span>
<a href="#l7.10"></a><span id="l7.10">   if (gBundle &amp;&amp; gBrandBundle)</span>
<a href="#l7.11"></a><span id="l7.11">     return;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  </span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14">   if (!gBundle) {</span>
<a href="#l7.15"></a><span id="l7.15">     gBundle = document.getElementById(&quot;bundle_read_smime&quot;);</span>
<a href="#l7.16"></a><span id="l7.16">     gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l7.17"></a><span id="l7.17">   }</span>
<a href="#l7.18"></a><span id="l7.18"> }</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> function showImapSignatureUnknown()</span>
<a href="#l7.21"></a><span id="l7.21"> {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -77,69 +77,68 @@ function showMessageReadSecurityInfo()</span>
<a href="#l7.23"></a><span id="l7.23"> {</span>
<a href="#l7.24"></a><span id="l7.24">   var gSignedUINode = document.getElementById('signedHdrIcon');</span>
<a href="#l7.25"></a><span id="l7.25">   if (gSignedUINode) {</span>
<a href="#l7.26"></a><span id="l7.26">     if (gSignedUINode.getAttribute(&quot;signed&quot;) == &quot;unknown&quot;) {</span>
<a href="#l7.27"></a><span id="l7.27">       showImapSignatureUnknown();</span>
<a href="#l7.28"></a><span id="l7.28">       return;</span>
<a href="#l7.29"></a><span id="l7.29">     }</span>
<a href="#l7.30"></a><span id="l7.30">   }</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  </span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+</span>
<a href="#l7.33"></a><span id="l7.33">   var pkiParams = Components.classes[nsPKIParamBlock].createInstance(nsIPKIParamBlock);</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35">   // isupport array starts with index 1</span>
<a href="#l7.36"></a><span id="l7.36">   pkiParams.setISupportAtIndex(1, gSignerCert);</span>
<a href="#l7.37"></a><span id="l7.37">   pkiParams.setISupportAtIndex(2, gEncryptionCert);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-  </span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+</span>
<a href="#l7.40"></a><span id="l7.40">   var params = pkiParams.QueryInterface(Components.interfaces.nsIDialogParamBlock);</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">   // int array starts with index 0, but that is used for window exit status</span>
<a href="#l7.43"></a><span id="l7.43">   params.SetInt(1, gSignatureStatus);</span>
<a href="#l7.44"></a><span id="l7.44">   params.SetInt(2, gEncryptionStatus);</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-  </span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+</span>
<a href="#l7.47"></a><span id="l7.47">   window.openDialog('chrome://messenger-smime/content/msgReadSecurityInfo.xul',</span>
<a href="#l7.48"></a><span id="l7.48">     '', 'chrome,resizable=1,modal=1,dialog=1', pkiParams );</span>
<a href="#l7.49"></a><span id="l7.49"> }</span>
<a href="#l7.50"></a><span id="l7.50"> </span>
<a href="#l7.51"></a><span id="l7.51"> var SecurityController =</span>
<a href="#l7.52"></a><span id="l7.52"> {</span>
<a href="#l7.53"></a><span id="l7.53">   supportsCommand: function(command)</span>
<a href="#l7.54"></a><span id="l7.54">   {</span>
<a href="#l7.55"></a><span id="l7.55">     switch ( command )</span>
<a href="#l7.56"></a><span id="l7.56">     {</span>
<a href="#l7.57"></a><span id="l7.57">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l7.58"></a><span id="l7.58">         return true;</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-      </span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+</span>
<a href="#l7.61"></a><span id="l7.61">       default:</span>
<a href="#l7.62"></a><span id="l7.62">         return false;</span>
<a href="#l7.63"></a><span id="l7.63">      }</span>
<a href="#l7.64"></a><span id="l7.64">   },</span>
<a href="#l7.65"></a><span id="l7.65"> </span>
<a href="#l7.66"></a><span id="l7.66">   isCommandEnabled: function(command)</span>
<a href="#l7.67"></a><span id="l7.67">   {</span>
<a href="#l7.68"></a><span id="l7.68">     switch ( command )</span>
<a href="#l7.69"></a><span id="l7.69">     {</span>
<a href="#l7.70"></a><span id="l7.70">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l7.71"></a><span id="l7.71">       {</span>
<a href="#l7.72"></a><span id="l7.72">         if (document.documentElement.getAttribute('windowtype') == &quot;mail:messageWindow&quot;)</span>
<a href="#l7.73"></a><span id="l7.73">         {</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-          return ( gCurrentMessageUri != null);</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+          return (GetNumSelectedMessages() &gt; 0);</span>
<a href="#l7.76"></a><span id="l7.76">         }</span>
<a href="#l7.77"></a><span id="l7.77">         else</span>
<a href="#l7.78"></a><span id="l7.78">         {</span>
<a href="#l7.79"></a><span id="l7.79">           if (GetNumSelectedMessages() &gt; 0 &amp;&amp; gDBView)</span>
<a href="#l7.80"></a><span id="l7.80">           {</span>
<a href="#l7.81"></a><span id="l7.81">             var enabled = new Object();</span>
<a href="#l7.82"></a><span id="l7.82">             enabled.value = false;</span>
<a href="#l7.83"></a><span id="l7.83">             var checkStatus = new Object();</span>
<a href="#l7.84"></a><span id="l7.84">             gDBView.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody, enabled, checkStatus);</span>
<a href="#l7.85"></a><span id="l7.85">             return enabled.value;</span>
<a href="#l7.86"></a><span id="l7.86">           }</span>
<a href="#l7.87"></a><span id="l7.87">         }</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-      </span>
<a href="#l7.89"></a><span id="l7.89">         return false;</span>
<a href="#l7.90"></a><span id="l7.90">       }</span>
<a href="#l7.91"></a><span id="l7.91"> </span>
<a href="#l7.92"></a><span id="l7.92">       default:</span>
<a href="#l7.93"></a><span id="l7.93">         return false;</span>
<a href="#l7.94"></a><span id="l7.94">     }</span>
<a href="#l7.95"></a><span id="l7.95">     return false;</span>
<a href="#l7.96"></a><span id="l7.96">   }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

