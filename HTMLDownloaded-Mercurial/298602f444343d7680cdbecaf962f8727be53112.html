<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22987:298602f444343d7680cdbecaf962f8727be53112</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 298602f444343d7680cdbecaf962f8727be53112" />
<meta property="og:url" content="/comm-central/rev/298602f444343d7680cdbecaf962f8727be53112" />
<meta property="og:description" content="Bug 464710 - remove RDF datasources nsMsgFolderDataSource.cpp and nsMsgAccountManagerDS.cpp. r=mkmelin,frg rs=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 298602f444343d7680cdbecaf962f8727be53112 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/298602f444343d7680cdbecaf962f8727be53112">shortlog</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/298602f444343d7680cdbecaf962f8727be53112">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/298602f444343d7680cdbecaf962f8727be53112">files</a> |
changeset |
<a href="/comm-central/raw-rev/298602f444343d7680cdbecaf962f8727be53112">raw</a>  | <a href="/comm-central/archive/298602f444343d7680cdbecaf962f8727be53112.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=464710">Bug 464710</a> - remove RDF datasources nsMsgFolderDataSource.cpp and nsMsgAccountManagerDS.cpp. r=mkmelin,frg rs=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 04 Jan 2018 15:19:00 +0100</td></tr>

<tr>
 <td>changeset 22987</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/298602f444343d7680cdbecaf962f8727be53112">298602f444343d7680cdbecaf962f8727be53112</a></td>
</tr>



<tr>
<td>parent 22986</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f4140f045ad0fb5345e3f3e27491d1b785b644c5">f4140f045ad0fb5345e3f3e27491d1b785b644c5</a>
</td>
</tr>

<tr>
<td>child 22988</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1cfb05317fd671eaa55ac38409dd0cb1aca49964">1cfb05317fd671eaa55ac38409dd0cb1aca49964</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=298602f444343d7680cdbecaf962f8727be53112">13913</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 05 Jan 2018 09:35:15 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1cfb05317fd6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1cfb05317fd671eaa55ac38409dd0cb1aca49964">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1cfb05317fd671eaa55ac38409dd0cb1aca49964&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1cfb05317fd671eaa55ac38409dd0cb1aca49964&newProject=comm-central&newRevision=afc58e5a8f81fe7e5fc5a7df028ba268371ff401&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1cfb05317fd671eaa55ac38409dd0cb1aca49964&newProject=comm-central&newRevision=afc58e5a8f81fe7e5fc5a7df028ba268371ff401&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1cfb05317fd671eaa55ac38409dd0cb1aca49964&newProject=comm-central&newRevision=afc58e5a8f81fe7e5fc5a7df028ba268371ff401&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28frg%29&revcount=50">frg</a>, <a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=464710">464710</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=464710">Bug 464710</a> - remove RDF datasources nsMsgFolderDataSource.cpp and nsMsgAccountManagerDS.cpp. r=mkmelin,frg rs=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/public/nsMsgBaseCID.h">mailnews/base/public/nsMsgBaseCID.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/public/nsMsgBaseCID.h">file</a> |
<a href="/comm-central/annotate/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/public/nsMsgBaseCID.h">annotate</a> |
<a href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/public/nsMsgBaseCID.h">diff</a> |
<a href="/comm-central/comparison/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/public/nsMsgBaseCID.h">comparison</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/public/nsMsgBaseCID.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/moz.build">mailnews/base/src/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/moz.build">file</a> |
<a href="/comm-central/annotate/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/moz.build">annotate</a> |
<a href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/moz.build">diff</a> |
<a href="/comm-central/comparison/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/moz.build">comparison</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.cpp">mailnews/base/src/nsMsgAccountManagerDS.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.cpp">diff</a> |
<a href="/comm-central/comparison/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.cpp">comparison</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.h">mailnews/base/src/nsMsgAccountManagerDS.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.h">diff</a> |
<a href="/comm-central/comparison/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.h">comparison</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgAccountManagerDS.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.cpp">mailnews/base/src/nsMsgFolderDataSource.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.cpp">diff</a> |
<a href="/comm-central/comparison/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.cpp">comparison</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.h">mailnews/base/src/nsMsgFolderDataSource.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.h">diff</a> |
<a href="/comm-central/comparison/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.h">comparison</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112/mailnews/base/src/nsMsgFolderDataSource.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/298602f444343d7680cdbecaf962f8727be53112/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/298602f444343d7680cdbecaf962f8727be53112/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/298602f444343d7680cdbecaf962f8727be53112/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/298602f444343d7680cdbecaf962f8727be53112/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/298602f444343d7680cdbecaf962f8727be53112/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/public/nsMsgBaseCID.h</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/public/nsMsgBaseCID.h</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -6,63 +6,16 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #ifndef nsMessageBaseCID_h__</span>
<a href="#l1.5"></a><span id="l1.5"> #define nsMessageBaseCID_h__</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> #include &quot;nsISupports.h&quot;</span>
<a href="#l1.8"></a><span id="l1.8"> #include &quot;nsIFactory.h&quot;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> //</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-// nsMsgFolderDataSource</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-//</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-#define NS_MAILNEWSFOLDERDATASOURCE_CONTRACTID \</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-  NS_RDF_DATASOURCE_CONTRACTID_PREFIX &quot;mailnewsfolders&quot;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-#define NS_MAILNEWSFOLDERDATASOURCE_CID                    \</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-{ /* 2B8ED4A4-F684-11d2-8A5D-0060B0FC04D2 */         \</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-  0x2b8ed4a4,                                      \</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-  0xf684,                                          \</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-  0x11d2,                                          \</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-  {0x8a, 0x5d, 0x0, 0x60, 0xb0, 0xfc, 0x4, 0xd2} \</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-}</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-#define NS_MAILNEWSUNREADFOLDERDATASOURCE_CONTRACTID \</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-  NS_RDF_DATASOURCE_CONTRACTID_PREFIX &quot;mailnewsunreadfolders&quot;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-#define NS_MAILNEWSUNREADFOLDERDATASOURCE_CID \</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-{ /* 39b6b638-5b9d-45aa-b645-77fe56bbddb7 */ \</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  0x39b6b638, \</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  0x5b9d, \</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-  0x45aa, \</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-  {0xb6, 0x45, 0x77, 0xfe, 0x56, 0xbb, 0xdd, 0xb7} \</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-}</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-#define NS_MAILNEWSFAVORITEFOLDERDATASOURCE_CONTRACTID \</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-  NS_RDF_DATASOURCE_CONTRACTID_PREFIX &quot;mailnewsfavefolders&quot;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-#define NS_MAILNEWSFAVORITEFOLDERDATASOURCE_CID \</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-{ /* dfdedc28-1b0c-4b7a-bbff-c98808034242 */ \</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-  0xdfdedc28, \</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-  0x1b0c, \</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-  0x4b7a, \</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-  {0xbb, 0xff, 0xc9, 0x88, 0x08, 0x03, 0x42, 0x42} \</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-}</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-#define NS_MAILNEWSRECENTFOLDERDATASOURCE_CONTRACTID \</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-  NS_RDF_DATASOURCE_CONTRACTID_PREFIX &quot;mailnewsrecentfolders&quot;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-#define NS_MAILNEWSRECENTFOLDERDATASOURCE_CID \</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-{ /* 64921b82-24bb-4473-ada9-dc89426129a6 */ \</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-  0x64921b82, \</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-  0x24bb, \</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-  0x4473, \</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-  {0xad, 0xa9, 0xdc, 0x89, 0x42, 0x61, 0x29, 0xa6} \</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-}</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-//</span>
<a href="#l1.59"></a><span id="l1.59"> // nsMsgAccountManager</span>
<a href="#l1.60"></a><span id="l1.60"> //</span>
<a href="#l1.61"></a><span id="l1.61"> #define NS_MSGACCOUNTMANAGER_CONTRACTID \</span>
<a href="#l1.62"></a><span id="l1.62">   &quot;@mozilla.org/messenger/account-manager;1&quot;</span>
<a href="#l1.63"></a><span id="l1.63"> </span>
<a href="#l1.64"></a><span id="l1.64"> #define NS_MSGACCOUNTMANAGER_CID									\</span>
<a href="#l1.65"></a><span id="l1.65"> { /* D2876E50-E62C-11d2-B7FC-00805F05FFA5 */			\</span>
<a href="#l1.66"></a><span id="l1.66">  0xd2876e50, 0xe62c, 0x11d2,											\</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/moz.build</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/moz.build</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -15,25 +15,23 @@ SOURCES += [</span>
<a href="#l2.4"></a><span id="l2.4">     'nsCidProtocolHandler.cpp',</span>
<a href="#l2.5"></a><span id="l2.5">     'nsCopyMessageStreamListener.cpp',</span>
<a href="#l2.6"></a><span id="l2.6">     'nsMailDirProvider.cpp',</span>
<a href="#l2.7"></a><span id="l2.7">     'nsMessenger.cpp',</span>
<a href="#l2.8"></a><span id="l2.8">     'nsMessengerBootstrap.cpp',</span>
<a href="#l2.9"></a><span id="l2.9">     'nsMessengerContentHandler.cpp',</span>
<a href="#l2.10"></a><span id="l2.10">     'nsMsgAccount.cpp',</span>
<a href="#l2.11"></a><span id="l2.11">     'nsMsgAccountManager.cpp',</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    'nsMsgAccountManagerDS.cpp',</span>
<a href="#l2.13"></a><span id="l2.13">     'nsMsgBiffManager.cpp',</span>
<a href="#l2.14"></a><span id="l2.14">     'nsMsgContentPolicy.cpp',</span>
<a href="#l2.15"></a><span id="l2.15">     'nsMsgCopyService.cpp',</span>
<a href="#l2.16"></a><span id="l2.16">     'nsMsgDBView.cpp',</span>
<a href="#l2.17"></a><span id="l2.17">     'nsMsgFolderCache.cpp',</span>
<a href="#l2.18"></a><span id="l2.18">     'nsMsgFolderCacheElement.cpp',</span>
<a href="#l2.19"></a><span id="l2.19">     'nsMsgFolderCompactor.cpp',</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-    'nsMsgFolderDataSource.cpp',</span>
<a href="#l2.21"></a><span id="l2.21">     'nsMsgFolderNotificationService.cpp',</span>
<a href="#l2.22"></a><span id="l2.22">     'nsMsgGroupThread.cpp',</span>
<a href="#l2.23"></a><span id="l2.23">     'nsMsgGroupView.cpp',</span>
<a href="#l2.24"></a><span id="l2.24">     'nsMsgMailSession.cpp',</span>
<a href="#l2.25"></a><span id="l2.25">     'nsMsgOfflineManager.cpp',</span>
<a href="#l2.26"></a><span id="l2.26">     'nsMsgProgress.cpp',</span>
<a href="#l2.27"></a><span id="l2.27">     'nsMsgPurgeService.cpp',</span>
<a href="#l2.28"></a><span id="l2.28">     'nsMsgQuickSearchDBView.cpp',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">deleted file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ /dev/null</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -1,1169 +0,0 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-/*</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">- * RDF datasource for the account manager</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">- */</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-#include &quot;nsMsgAccountManagerDS.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-#include &quot;rdf.h&quot;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-#include &quot;nsRDFCID.h&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-#include &quot;nsIRDFDataSource.h&quot;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-#include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-#include &quot;nsIServiceManager.h&quot;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-#include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-#include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-#include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-#include &quot;nsICategoryManager.h&quot;</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-#include &quot;nsXPCOM.h&quot;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-#include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-#include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-#include &quot;mozilla/Services.h&quot;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-#include &quot;nsArrayUtils.h&quot;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-// turn this on to see useful output</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-#undef DEBUG_amds</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-#define NC_RDF_PAGETITLE_PREFIX               NC_NAMESPACE_URI &quot;PageTitle&quot;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-#define NC_RDF_PAGETITLE_MAIN                 NC_RDF_PAGETITLE_PREFIX &quot;Main&quot;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-#define NC_RDF_PAGETITLE_SERVER               NC_RDF_PAGETITLE_PREFIX &quot;Server&quot;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-#define NC_RDF_PAGETITLE_COPIES               NC_RDF_PAGETITLE_PREFIX &quot;Copies&quot;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-#define NC_RDF_PAGETITLE_SYNCHRONIZATION      NC_RDF_PAGETITLE_PREFIX &quot;Synchronization&quot;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-#define NC_RDF_PAGETITLE_DISKSPACE            NC_RDF_PAGETITLE_PREFIX &quot;DiskSpace&quot;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-#define NC_RDF_PAGETITLE_ADDRESSING           NC_RDF_PAGETITLE_PREFIX &quot;Addressing&quot;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-#define NC_RDF_PAGETITLE_SMTP                 NC_RDF_PAGETITLE_PREFIX &quot;SMTP&quot;</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-#define NC_RDF_PAGETITLE_JUNK                 NC_RDF_PAGETITLE_PREFIX &quot;Junk&quot;</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-#define NC_RDF_PAGETAG NC_NAMESPACE_URI &quot;PageTag&quot;</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-#define NC_RDF_ACCOUNTROOT &quot;msgaccounts:/&quot;</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-// the root resource (msgaccounts:/)</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_AccountRoot=nullptr;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-// attributes of accounts</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_Name=nullptr;</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_FolderTreeName=nullptr;</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_FolderTreeSimpleName=nullptr;</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_NameSort=nullptr;</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_FolderTreeNameSort=nullptr;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTag=nullptr;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_IsDefaultServer=nullptr;</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_SupportsFilters=nullptr;</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_CanGetMessages=nullptr;</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_CanGetIncomingMessages=nullptr;</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-// containment</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_Child=nullptr;</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_Settings=nullptr;</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-// properties corresponding to interfaces</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_Account=nullptr;</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_Server=nullptr;</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_Identity=nullptr;</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_Junk=nullptr;</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-// individual pages</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleMain=nullptr;</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleServer=nullptr;</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleCopies=nullptr;</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleSynchronization=nullptr;</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleDiskSpace=nullptr;</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleAddressing=nullptr;</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleSMTP=nullptr;</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-nsIRDFResource* nsMsgAccountManagerDataSource::kNC_PageTitleJunk=nullptr;</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-// common literals</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-nsIRDFLiteral* nsMsgAccountManagerDataSource::kTrueLiteral = nullptr;</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineminus">-</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineminus">-nsrefcnt nsMsgAccountManagerDataSource::gAccountManagerResourceRefCnt = 0;</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineminus">-</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-// shared arc lists</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-nsCOMPtr&lt;nsIMutableArray&gt; nsMsgAccountManagerDataSource::mAccountArcsOut;</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-nsCOMPtr&lt;nsIMutableArray&gt; nsMsgAccountManagerDataSource::mAccountRootArcsOut;</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-// RDF to match</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-#define NC_RDF_ACCOUNT NC_NAMESPACE_URI &quot;Account&quot;</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-#define NC_RDF_SERVER  NC_NAMESPACE_URI &quot;Server&quot;</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineminus">-#define NC_RDF_IDENTITY NC_NAMESPACE_URI &quot;Identity&quot;</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-#define NC_RDF_SETTINGS NC_NAMESPACE_URI &quot;Settings&quot;</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-#define NC_RDF_JUNK NC_NAMESPACE_URI &quot;Junk&quot;</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-#define NC_RDF_ISDEFAULTSERVER NC_NAMESPACE_URI &quot;IsDefaultServer&quot;</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-#define NC_RDF_SUPPORTSFILTERS NC_NAMESPACE_URI &quot;SupportsFilters&quot;</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-#define NC_RDF_CANGETMESSAGES NC_NAMESPACE_URI &quot;CanGetMessages&quot;</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-#define NC_RDF_CANGETINCOMINGMESSAGES NC_NAMESPACE_URI &quot;CanGetIncomingMessages&quot;</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-nsMsgAccountManagerDataSource::nsMsgAccountManagerDataSource()</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineminus">-{</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineminus">-#ifdef DEBUG_amds</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineminus">-  printf(&quot;nsMsgAccountManagerDataSource() being created\n&quot;);</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-#endif</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-  // do per-class initialization here</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-  if (gAccountManagerResourceRefCnt++ == 0) {</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CHILD), &amp;kNC_Child);</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NAME), &amp;kNC_Name);</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERTREENAME),</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-                                 &amp;kNC_FolderTreeName);</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERTREESIMPLENAME),</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-                                 &amp;kNC_FolderTreeSimpleName);</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NAME_SORT), &amp;kNC_NameSort);</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERTREENAME_SORT),</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-                                 &amp;kNC_FolderTreeNameSort);</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETAG), &amp;kNC_PageTag);</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_ISDEFAULTSERVER),</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-                                 &amp;kNC_IsDefaultServer);</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SUPPORTSFILTERS),</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineminus">-                                 &amp;kNC_SupportsFilters);</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANGETMESSAGES),</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-                                 &amp;kNC_CanGetMessages);</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANGETINCOMINGMESSAGES),</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-                                 &amp;kNC_CanGetIncomingMessages);</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineminus">-</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_ACCOUNT), &amp;kNC_Account);</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SERVER), &amp;kNC_Server);</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_IDENTITY), &amp;kNC_Identity);</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_JUNK), &amp;kNC_Junk);</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_MAIN),</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-                                 &amp;kNC_PageTitleMain);</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_SERVER),</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-                                 &amp;kNC_PageTitleServer);</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_COPIES),</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-                                 &amp;kNC_PageTitleCopies);</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_SYNCHRONIZATION),</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-                                 &amp;kNC_PageTitleSynchronization);</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_DISKSPACE),</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-                                 &amp;kNC_PageTitleDiskSpace);</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_ADDRESSING),</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-                                 &amp;kNC_PageTitleAddressing);</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_SMTP),</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-                                 &amp;kNC_PageTitleSMTP);</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_PAGETITLE_JUNK),</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineminus">-                                 &amp;kNC_PageTitleJunk);</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineminus">-</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_ACCOUNTROOT),</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineminus">-                                 &amp;kNC_AccountRoot);</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineminus">-</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineminus">-    getRDFService()-&gt;GetLiteral(u&quot;true&quot;,</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineminus">-                                &amp;kTrueLiteral);</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineminus">-</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineminus">-    // eventually these need to exist in some kind of array</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineminus">-    // that's easily extensible</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineminus">-    getRDFService()-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SETTINGS), &amp;kNC_Settings);</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineminus">-  }</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineminus">-}</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineminus">-</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineminus">-nsMsgAccountManagerDataSource::~nsMsgAccountManagerDataSource()</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineminus">-{</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-  if (am)</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-    am-&gt;RemoveIncomingServerListener(this);</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineminus">-  if (--gAccountManagerResourceRefCnt == 0) {</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineminus">-    NS_IF_RELEASE(kNC_Child);</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-    NS_IF_RELEASE(kNC_Name);</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineminus">-    NS_IF_RELEASE(kNC_FolderTreeName);</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineminus">-    NS_IF_RELEASE(kNC_FolderTreeSimpleName);</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-    NS_IF_RELEASE(kNC_NameSort);</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-    NS_IF_RELEASE(kNC_FolderTreeNameSort);</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTag);</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-    NS_IF_RELEASE(kNC_IsDefaultServer);</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineminus">-    NS_IF_RELEASE(kNC_SupportsFilters);</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-    NS_IF_RELEASE(kNC_CanGetMessages);</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineminus">-    NS_IF_RELEASE(kNC_CanGetIncomingMessages);</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineminus">-    NS_IF_RELEASE(kNC_Account);</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineminus">-    NS_IF_RELEASE(kNC_Server);</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineminus">-    NS_IF_RELEASE(kNC_Identity);</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineminus">-    NS_IF_RELEASE(kNC_Junk);</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleMain);</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleServer);</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleCopies);</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleSynchronization);</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleDiskSpace);</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleAddressing);</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleSMTP);</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineminus">-    NS_IF_RELEASE(kNC_PageTitleJunk);</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-    NS_IF_RELEASE(kTrueLiteral);</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineminus">-</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineminus">-    NS_IF_RELEASE(kNC_AccountRoot);</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineminus">-</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineminus">-    // eventually these need to exist in some kind of array</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineminus">-    // that's easily extensible</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineminus">-    NS_IF_RELEASE(kNC_Settings);</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineminus">-</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineminus">-    mAccountArcsOut = nullptr;</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineminus">-    mAccountRootArcsOut = nullptr;</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineminus">-  }</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineminus">-</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineminus">-}</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineminus">-NS_IMPL_ADDREF_INHERITED(nsMsgAccountManagerDataSource, nsMsgRDFDataSource)</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineminus">-NS_IMPL_RELEASE_INHERITED(nsMsgAccountManagerDataSource, nsMsgRDFDataSource)</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-NS_INTERFACE_MAP_BEGIN(nsMsgAccountManagerDataSource)</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineminus">-  NS_INTERFACE_MAP_ENTRY(nsIIncomingServerListener)</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineminus">-  NS_INTERFACE_MAP_ENTRY(nsIFolderListener)</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineminus">-NS_INTERFACE_MAP_END_INHERITING(nsMsgRDFDataSource)</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineminus">-</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineminus">-nsresult</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-nsMsgAccountManagerDataSource::Init()</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-{</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineminus">-</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineminus">-  rv = nsMsgRDFDataSource::Init();</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineminus">-</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; am;</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineminus">-</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineminus">-  // get a weak ref to the account manager</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineminus">-  if (!mAccountManager)</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineminus">-  {</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineminus">-    am = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineminus">-    mAccountManager = do_GetWeakReference(am);</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineminus">-  }</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineminus">-  else</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineminus">-    am = do_QueryReferent(mAccountManager);</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineminus">-</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineminus">-  if (am)</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineminus">-  {</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineminus">-    am-&gt;AddIncomingServerListener(this);</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineminus">-    am-&gt;AddRootFolderListener(this);</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineminus">-  }</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineminus">-</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineminus">-</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineminus">-}</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineminus">-</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineminus">-void nsMsgAccountManagerDataSource::Cleanup()</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineminus">-{</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineminus">-</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineminus">-  if (am)</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineminus">-  {</span>
<a href="#l3.255"></a><span id="l3.255" class="difflineminus">-    am-&gt;RemoveIncomingServerListener(this);</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineminus">-    am-&gt;RemoveRootFolderListener(this);</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineminus">-  }</span>
<a href="#l3.258"></a><span id="l3.258" class="difflineminus">-</span>
<a href="#l3.259"></a><span id="l3.259" class="difflineminus">-  nsMsgRDFDataSource::Cleanup();</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineminus">-}</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineminus">-</span>
<a href="#l3.262"></a><span id="l3.262" class="difflineminus">-/* nsIRDFNode GetTarget (in nsIRDFResource aSource, in nsIRDFResource property, in boolean aTruthValue); */</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineminus">-nsMsgAccountManagerDataSource::GetTarget(nsIRDFResource *source,</span>
<a href="#l3.265"></a><span id="l3.265" class="difflineminus">-                                         nsIRDFResource *property,</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineminus">-                                         bool aTruthValue,</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineminus">-                                         nsIRDFNode **target)</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineminus">-{</span>
<a href="#l3.269"></a><span id="l3.269" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineminus">-</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineminus">-  rv = NS_RDF_NO_VALUE;</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineminus">-</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineminus">-  nsAutoString str;</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineminus">-  if (property == kNC_Name || property == kNC_FolderTreeName ||</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineminus">-      property == kNC_FolderTreeSimpleName)</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineminus">-  {</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineminus">-    rv = getStringBundle();</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineminus">-</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineminus">-    nsString pageTitle;</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineminus">-    if (source == kNC_PageTitleServer)</span>
<a href="#l3.283"></a><span id="l3.283" class="difflineminus">-      mStringBundle-&gt;GetStringFromName(&quot;prefPanel-server&quot;, pageTitle);</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineminus">-</span>
<a href="#l3.285"></a><span id="l3.285" class="difflineminus">-    else if (source == kNC_PageTitleCopies)</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineminus">-      mStringBundle-&gt;GetStringFromName(&quot;prefPanel-copies&quot;, pageTitle);</span>
<a href="#l3.287"></a><span id="l3.287" class="difflineminus">-    else if (source == kNC_PageTitleSynchronization)</span>
<a href="#l3.288"></a><span id="l3.288" class="difflineminus">-      mStringBundle-&gt;GetStringFromName(&quot;prefPanel-synchronization&quot;, pageTitle);</span>
<a href="#l3.289"></a><span id="l3.289" class="difflineminus">-    else if (source == kNC_PageTitleDiskSpace)</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineminus">-      mStringBundle-&gt;GetStringFromName(&quot;prefPanel-diskspace&quot;, pageTitle);</span>
<a href="#l3.291"></a><span id="l3.291" class="difflineminus">-    else if (source == kNC_PageTitleAddressing)</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineminus">-      mStringBundle-&gt;GetStringFromName(&quot;prefPanel-addressing&quot;, pageTitle);</span>
<a href="#l3.293"></a><span id="l3.293" class="difflineminus">-    else if (source == kNC_PageTitleSMTP)</span>
<a href="#l3.294"></a><span id="l3.294" class="difflineminus">-      mStringBundle-&gt;GetStringFromName(&quot;prefPanel-smtp&quot;, pageTitle);</span>
<a href="#l3.295"></a><span id="l3.295" class="difflineminus">-    else if (source == kNC_PageTitleJunk)</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineminus">-      mStringBundle-&gt;GetStringFromName(&quot;prefPanel-junk&quot;, pageTitle);</span>
<a href="#l3.297"></a><span id="l3.297" class="difflineminus">-</span>
<a href="#l3.298"></a><span id="l3.298" class="difflineminus">-    else {</span>
<a href="#l3.299"></a><span id="l3.299" class="difflineminus">-      // if it's a server, use the pretty name</span>
<a href="#l3.300"></a><span id="l3.300" class="difflineminus">-      nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryInterface(source, &amp;rv);</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineminus">-      if (NS_SUCCEEDED(rv) &amp;&amp; folder) {</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineminus">-        bool isServer;</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineminus">-        rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l3.304"></a><span id="l3.304" class="difflineminus">-        if (NS_SUCCEEDED(rv) &amp;&amp; isServer)</span>
<a href="#l3.305"></a><span id="l3.305" class="difflineminus">-          rv = folder-&gt;GetPrettyName(pageTitle);</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineminus">-      }</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineminus">-      else {</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineminus">-        // allow for the accountmanager to be dynamically extended.</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineminus">-</span>
<a href="#l3.310"></a><span id="l3.310" class="difflineminus">-        nsCOMPtr&lt;nsIStringBundleService&gt; strBundleService =</span>
<a href="#l3.311"></a><span id="l3.311" class="difflineminus">-          mozilla::services::GetStringBundleService();</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineminus">-        NS_ENSURE_TRUE(strBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineminus">-</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineminus">-        const char *sourceValue;</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineminus">-        rv = source-&gt;GetValueConst(&amp;sourceValue);</span>
<a href="#l3.316"></a><span id="l3.316" class="difflineminus">-        NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.317"></a><span id="l3.317" class="difflineminus">-</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineminus">-        // make sure the pointer math we're about to do is safe.</span>
<a href="#l3.319"></a><span id="l3.319" class="difflineminus">-        NS_ENSURE_TRUE(sourceValue &amp;&amp; (strlen(sourceValue) &gt; strlen(NC_RDF_PAGETITLE_PREFIX)), NS_ERROR_UNEXPECTED);</span>
<a href="#l3.320"></a><span id="l3.320" class="difflineminus">-</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineminus">-        nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager, &amp;rv);</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineminus">-</span>
<a href="#l3.324"></a><span id="l3.324" class="difflineminus">-        // turn NC#PageTitlefoobar into foobar, so we can get the am-foobar.properties bundle</span>
<a href="#l3.325"></a><span id="l3.325" class="difflineminus">-        nsCString chromePackageName;</span>
<a href="#l3.326"></a><span id="l3.326" class="difflineminus">-        rv = am-&gt;GetChromePackageName(nsCString(sourceValue + strlen(NC_RDF_PAGETITLE_PREFIX)), chromePackageName);</span>
<a href="#l3.327"></a><span id="l3.327" class="difflineminus">-        NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineminus">-</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineminus">-        nsAutoCString bundleURL;</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineminus">-        bundleURL = &quot;chrome://&quot;;</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineminus">-        bundleURL += chromePackageName;</span>
<a href="#l3.332"></a><span id="l3.332" class="difflineminus">-        bundleURL += &quot;/locale/am-&quot;;</span>
<a href="#l3.333"></a><span id="l3.333" class="difflineminus">-        bundleURL += (sourceValue + strlen(NC_RDF_PAGETITLE_PREFIX));</span>
<a href="#l3.334"></a><span id="l3.334" class="difflineminus">-        bundleURL += &quot;.properties&quot;;</span>
<a href="#l3.335"></a><span id="l3.335" class="difflineminus">-</span>
<a href="#l3.336"></a><span id="l3.336" class="difflineminus">-        nsCOMPtr &lt;nsIStringBundle&gt; bundle;</span>
<a href="#l3.337"></a><span id="l3.337" class="difflineminus">-        rv = strBundleService-&gt;CreateBundle(bundleURL.get(), getter_AddRefs(bundle));</span>
<a href="#l3.338"></a><span id="l3.338" class="difflineminus">-</span>
<a href="#l3.339"></a><span id="l3.339" class="difflineminus">-        NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.340"></a><span id="l3.340" class="difflineminus">-</span>
<a href="#l3.341"></a><span id="l3.341" class="difflineminus">-        nsAutoCString panelTitleName;</span>
<a href="#l3.342"></a><span id="l3.342" class="difflineminus">-        panelTitleName.AssignLiteral(&quot;prefPanel-&quot;);</span>
<a href="#l3.343"></a><span id="l3.343" class="difflineminus">-        panelTitleName.Append(sourceValue + strlen(NC_RDF_PAGETITLE_PREFIX));</span>
<a href="#l3.344"></a><span id="l3.344" class="difflineminus">-        bundle-&gt;GetStringFromName(panelTitleName.get(), pageTitle);</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineminus">-      }</span>
<a href="#l3.346"></a><span id="l3.346" class="difflineminus">-    }</span>
<a href="#l3.347"></a><span id="l3.347" class="difflineminus">-    str = pageTitle.get();</span>
<a href="#l3.348"></a><span id="l3.348" class="difflineminus">-  }</span>
<a href="#l3.349"></a><span id="l3.349" class="difflineminus">-  else if (property == kNC_PageTag) {</span>
<a href="#l3.350"></a><span id="l3.350" class="difflineminus">-    // do NOT localize these strings. these are the urls of the XUL files</span>
<a href="#l3.351"></a><span id="l3.351" class="difflineminus">-    if (source == kNC_PageTitleServer)</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineminus">-      str.AssignLiteral(&quot;am-server.xul&quot;);</span>
<a href="#l3.353"></a><span id="l3.353" class="difflineminus">-    else if (source == kNC_PageTitleCopies)</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineminus">-      str.AssignLiteral(&quot;am-copies.xul&quot;);</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineminus">-    else if ((source == kNC_PageTitleSynchronization) ||</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineminus">-             (source == kNC_PageTitleDiskSpace))</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineminus">-      str.AssignLiteral(&quot;am-offline.xul&quot;);</span>
<a href="#l3.358"></a><span id="l3.358" class="difflineminus">-    else if (source == kNC_PageTitleAddressing)</span>
<a href="#l3.359"></a><span id="l3.359" class="difflineminus">-      str.AssignLiteral(&quot;am-addressing.xul&quot;);</span>
<a href="#l3.360"></a><span id="l3.360" class="difflineminus">-    else if (source == kNC_PageTitleSMTP)</span>
<a href="#l3.361"></a><span id="l3.361" class="difflineminus">-      str.AssignLiteral(&quot;am-smtp.xul&quot;);</span>
<a href="#l3.362"></a><span id="l3.362" class="difflineminus">-    else if (source == kNC_PageTitleJunk)</span>
<a href="#l3.363"></a><span id="l3.363" class="difflineminus">-      str.AssignLiteral(&quot;am-junk.xul&quot;);</span>
<a href="#l3.364"></a><span id="l3.364" class="difflineminus">-    else {</span>
<a href="#l3.365"></a><span id="l3.365" class="difflineminus">-      nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryInterface(source, &amp;rv);</span>
<a href="#l3.366"></a><span id="l3.366" class="difflineminus">-      if (NS_SUCCEEDED(rv) &amp;&amp; folder) {</span>
<a href="#l3.367"></a><span id="l3.367" class="difflineminus">-        /* if this is a server, with no identities, then we show a special panel */</span>
<a href="#l3.368"></a><span id="l3.368" class="difflineminus">-        nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.369"></a><span id="l3.369" class="difflineminus">-        rv = getServerForFolderNode(source, getter_AddRefs(server));</span>
<a href="#l3.370"></a><span id="l3.370" class="difflineminus">-        if (server)</span>
<a href="#l3.371"></a><span id="l3.371" class="difflineminus">-          server-&gt;GetAccountManagerChrome(str);</span>
<a href="#l3.372"></a><span id="l3.372" class="difflineminus">-        else</span>
<a href="#l3.373"></a><span id="l3.373" class="difflineminus">-          str.AssignLiteral(&quot;am-main.xul&quot;);</span>
<a href="#l3.374"></a><span id="l3.374" class="difflineminus">-      }</span>
<a href="#l3.375"></a><span id="l3.375" class="difflineminus">-      else {</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineminus">-        // allow for the accountmanager to be dynamically extended</span>
<a href="#l3.377"></a><span id="l3.377" class="difflineminus">-        const char *sourceValue;</span>
<a href="#l3.378"></a><span id="l3.378" class="difflineminus">-        rv = source-&gt;GetValueConst(&amp;sourceValue);</span>
<a href="#l3.379"></a><span id="l3.379" class="difflineminus">-        NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.380"></a><span id="l3.380" class="difflineminus">-</span>
<a href="#l3.381"></a><span id="l3.381" class="difflineminus">-        // make sure the pointer math we're about to do is safe.</span>
<a href="#l3.382"></a><span id="l3.382" class="difflineminus">-        NS_ENSURE_TRUE(sourceValue &amp;&amp; (strlen(sourceValue) &gt; strlen(NC_RDF_PAGETITLE_PREFIX)), NS_ERROR_UNEXPECTED);</span>
<a href="#l3.383"></a><span id="l3.383" class="difflineminus">-</span>
<a href="#l3.384"></a><span id="l3.384" class="difflineminus">-        // turn NC#PageTitlefoobar into foobar, so we can get the am-foobar.xul file</span>
<a href="#l3.385"></a><span id="l3.385" class="difflineminus">-        str.AssignLiteral(&quot;am-&quot;);</span>
<a href="#l3.386"></a><span id="l3.386" class="difflineminus">-        str.Append(NS_ConvertASCIItoUTF16(sourceValue + strlen(NC_RDF_PAGETITLE_PREFIX)));</span>
<a href="#l3.387"></a><span id="l3.387" class="difflineminus">-        str.AppendLiteral(&quot;.xul&quot;);</span>
<a href="#l3.388"></a><span id="l3.388" class="difflineminus">-      }</span>
<a href="#l3.389"></a><span id="l3.389" class="difflineminus">-    }</span>
<a href="#l3.390"></a><span id="l3.390" class="difflineminus">-  }</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineminus">-</span>
<a href="#l3.392"></a><span id="l3.392" class="difflineminus">-  // handle sorting of servers</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineminus">-  else if ((property == kNC_NameSort) ||</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineminus">-           (property == kNC_FolderTreeNameSort)) {</span>
<a href="#l3.395"></a><span id="l3.395" class="difflineminus">-</span>
<a href="#l3.396"></a><span id="l3.396" class="difflineminus">-    // order for the folder pane</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineminus">-    // and for the account manager tree is:</span>
<a href="#l3.398"></a><span id="l3.398" class="difflineminus">-    //</span>
<a href="#l3.399"></a><span id="l3.399" class="difflineminus">-    // - default mail account</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineminus">-    // - &lt;other mail accounts&gt;</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineminus">-    // - &quot;Local Folders&quot; account</span>
<a href="#l3.402"></a><span id="l3.402" class="difflineminus">-    // - news accounts</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineminus">-    // - smtp settings (note, this is only in account manager tree)</span>
<a href="#l3.404"></a><span id="l3.404" class="difflineminus">-</span>
<a href="#l3.405"></a><span id="l3.405" class="difflineminus">-    // make sure we're handling a root folder that is a server</span>
<a href="#l3.406"></a><span id="l3.406" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.407"></a><span id="l3.407" class="difflineminus">-    rv = getServerForFolderNode(source, getter_AddRefs(server));</span>
<a href="#l3.408"></a><span id="l3.408" class="difflineminus">-</span>
<a href="#l3.409"></a><span id="l3.409" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; server) {</span>
<a href="#l3.410"></a><span id="l3.410" class="difflineminus">-      int32_t accountNum;</span>
<a href="#l3.411"></a><span id="l3.411" class="difflineminus">-      nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l3.412"></a><span id="l3.412" class="difflineminus">-</span>
<a href="#l3.413"></a><span id="l3.413" class="difflineminus">-      if (isDefaultServer(server))</span>
<a href="#l3.414"></a><span id="l3.414" class="difflineminus">-        str.AssignLiteral(&quot;000000000&quot;);</span>
<a href="#l3.415"></a><span id="l3.415" class="difflineminus">-      else {</span>
<a href="#l3.416"></a><span id="l3.416" class="difflineminus">-        rv = am-&gt;GetSortOrder(server, &amp;accountNum);</span>
<a href="#l3.417"></a><span id="l3.417" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.418"></a><span id="l3.418" class="difflineminus">-        str.AppendInt(accountNum);</span>
<a href="#l3.419"></a><span id="l3.419" class="difflineminus">-      }</span>
<a href="#l3.420"></a><span id="l3.420" class="difflineminus">-    }</span>
<a href="#l3.421"></a><span id="l3.421" class="difflineminus">-    else {</span>
<a href="#l3.422"></a><span id="l3.422" class="difflineminus">-      const char *sourceValue;</span>
<a href="#l3.423"></a><span id="l3.423" class="difflineminus">-      rv = source-&gt;GetValueConst(&amp;sourceValue);</span>
<a href="#l3.424"></a><span id="l3.424" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, NS_RDF_NO_VALUE);</span>
<a href="#l3.425"></a><span id="l3.425" class="difflineminus">-</span>
<a href="#l3.426"></a><span id="l3.426" class="difflineminus">-      // if this is a page (which we determine by the prefix of the URI)</span>
<a href="#l3.427"></a><span id="l3.427" class="difflineminus">-      // we want to generate a sort value</span>
<a href="#l3.428"></a><span id="l3.428" class="difflineminus">-      // so that we can sort the categories in the account manager tree</span>
<a href="#l3.429"></a><span id="l3.429" class="difflineminus">-      // (or the folder pane)</span>
<a href="#l3.430"></a><span id="l3.430" class="difflineminus">-      //</span>
<a href="#l3.431"></a><span id="l3.431" class="difflineminus">-      // otherwise, return NS_RDF_NO_VALUE</span>
<a href="#l3.432"></a><span id="l3.432" class="difflineminus">-      // so that the folder data source will take care of it.</span>
<a href="#l3.433"></a><span id="l3.433" class="difflineminus">-      if (sourceValue &amp;&amp; (strncmp(sourceValue, NC_RDF_PAGETITLE_PREFIX, strlen(NC_RDF_PAGETITLE_PREFIX)) == 0)) {</span>
<a href="#l3.434"></a><span id="l3.434" class="difflineminus">-        if (source == kNC_PageTitleSMTP)</span>
<a href="#l3.435"></a><span id="l3.435" class="difflineminus">-          str.AssignLiteral(&quot;900000000&quot;);</span>
<a href="#l3.436"></a><span id="l3.436" class="difflineminus">-        else if (source == kNC_PageTitleServer)</span>
<a href="#l3.437"></a><span id="l3.437" class="difflineminus">-          str.Assign('1');</span>
<a href="#l3.438"></a><span id="l3.438" class="difflineminus">-        else if (source == kNC_PageTitleCopies)</span>
<a href="#l3.439"></a><span id="l3.439" class="difflineminus">-          str.Assign('2');</span>
<a href="#l3.440"></a><span id="l3.440" class="difflineminus">-        else if (source == kNC_PageTitleAddressing)</span>
<a href="#l3.441"></a><span id="l3.441" class="difflineminus">-          str.Assign('3');</span>
<a href="#l3.442"></a><span id="l3.442" class="difflineminus">-        else if (source == kNC_PageTitleSynchronization)</span>
<a href="#l3.443"></a><span id="l3.443" class="difflineminus">-          str.Assign('4');</span>
<a href="#l3.444"></a><span id="l3.444" class="difflineminus">-        else if (source == kNC_PageTitleDiskSpace)</span>
<a href="#l3.445"></a><span id="l3.445" class="difflineminus">-          str.Assign('4');</span>
<a href="#l3.446"></a><span id="l3.446" class="difflineminus">-        else if (source == kNC_PageTitleJunk)</span>
<a href="#l3.447"></a><span id="l3.447" class="difflineminus">-          str.Assign('5');</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineminus">-        else {</span>
<a href="#l3.449"></a><span id="l3.449" class="difflineminus">-          // allow for the accountmanager to be dynamically extended</span>
<a href="#l3.450"></a><span id="l3.450" class="difflineminus">-          // all the other pages come after the standard ones</span>
<a href="#l3.451"></a><span id="l3.451" class="difflineminus">-          // server, copies, addressing, disk space (or offline &amp; disk space)</span>
<a href="#l3.452"></a><span id="l3.452" class="difflineminus">-          CopyASCIItoUTF16(nsDependentCString(sourceValue), str);</span>
<a href="#l3.453"></a><span id="l3.453" class="difflineminus">-        }</span>
<a href="#l3.454"></a><span id="l3.454" class="difflineminus">-      }</span>
<a href="#l3.455"></a><span id="l3.455" class="difflineminus">-      else {</span>
<a href="#l3.456"></a><span id="l3.456" class="difflineminus">-        return NS_RDF_NO_VALUE;</span>
<a href="#l3.457"></a><span id="l3.457" class="difflineminus">-      }</span>
<a href="#l3.458"></a><span id="l3.458" class="difflineminus">-    }</span>
<a href="#l3.459"></a><span id="l3.459" class="difflineminus">-  }</span>
<a href="#l3.460"></a><span id="l3.460" class="difflineminus">-</span>
<a href="#l3.461"></a><span id="l3.461" class="difflineminus">-  // GetTargets() stuff - need to return a valid answer so that</span>
<a href="#l3.462"></a><span id="l3.462" class="difflineminus">-  // twisties will appear</span>
<a href="#l3.463"></a><span id="l3.463" class="difflineminus">-  else if (property == kNC_Settings) {</span>
<a href="#l3.464"></a><span id="l3.464" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryInterface(source,&amp;rv);</span>
<a href="#l3.465"></a><span id="l3.465" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l3.466"></a><span id="l3.466" class="difflineminus">-      return NS_RDF_NO_VALUE;</span>
<a href="#l3.467"></a><span id="l3.467" class="difflineminus">-</span>
<a href="#l3.468"></a><span id="l3.468" class="difflineminus">-    bool isServer=false;</span>
<a href="#l3.469"></a><span id="l3.469" class="difflineminus">-    folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l3.470"></a><span id="l3.470" class="difflineminus">-    // no need to localize this!</span>
<a href="#l3.471"></a><span id="l3.471" class="difflineminus">-    if (isServer)</span>
<a href="#l3.472"></a><span id="l3.472" class="difflineminus">-      str.AssignLiteral(&quot;ServerSettings&quot;);</span>
<a href="#l3.473"></a><span id="l3.473" class="difflineminus">-  }</span>
<a href="#l3.474"></a><span id="l3.474" class="difflineminus">-</span>
<a href="#l3.475"></a><span id="l3.475" class="difflineminus">-  else if (property == kNC_IsDefaultServer) {</span>
<a href="#l3.476"></a><span id="l3.476" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; thisServer;</span>
<a href="#l3.477"></a><span id="l3.477" class="difflineminus">-    rv = getServerForFolderNode(source, getter_AddRefs(thisServer));</span>
<a href="#l3.478"></a><span id="l3.478" class="difflineminus">-    if (NS_FAILED(rv) || !thisServer) return NS_RDF_NO_VALUE;</span>
<a href="#l3.479"></a><span id="l3.479" class="difflineminus">-</span>
<a href="#l3.480"></a><span id="l3.480" class="difflineminus">-    if (isDefaultServer(thisServer))</span>
<a href="#l3.481"></a><span id="l3.481" class="difflineminus">-      str.AssignLiteral(&quot;true&quot;);</span>
<a href="#l3.482"></a><span id="l3.482" class="difflineminus">-  }</span>
<a href="#l3.483"></a><span id="l3.483" class="difflineminus">-</span>
<a href="#l3.484"></a><span id="l3.484" class="difflineminus">-  else if (property == kNC_SupportsFilters) {</span>
<a href="#l3.485"></a><span id="l3.485" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.486"></a><span id="l3.486" class="difflineminus">-    rv = getServerForFolderNode(source, getter_AddRefs(server));</span>
<a href="#l3.487"></a><span id="l3.487" class="difflineminus">-    if (NS_FAILED(rv) || !server) return NS_RDF_NO_VALUE;</span>
<a href="#l3.488"></a><span id="l3.488" class="difflineminus">-</span>
<a href="#l3.489"></a><span id="l3.489" class="difflineminus">-    if (supportsFilters(server))</span>
<a href="#l3.490"></a><span id="l3.490" class="difflineminus">-      str.AssignLiteral(&quot;true&quot;);</span>
<a href="#l3.491"></a><span id="l3.491" class="difflineminus">-  }</span>
<a href="#l3.492"></a><span id="l3.492" class="difflineminus">-  else if (property == kNC_CanGetMessages) {</span>
<a href="#l3.493"></a><span id="l3.493" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.494"></a><span id="l3.494" class="difflineminus">-    rv = getServerForFolderNode(source, getter_AddRefs(server));</span>
<a href="#l3.495"></a><span id="l3.495" class="difflineminus">-    if (NS_FAILED(rv) || !server) return NS_RDF_NO_VALUE;</span>
<a href="#l3.496"></a><span id="l3.496" class="difflineminus">-</span>
<a href="#l3.497"></a><span id="l3.497" class="difflineminus">-    if (canGetMessages(server))</span>
<a href="#l3.498"></a><span id="l3.498" class="difflineminus">-      str.AssignLiteral(&quot;true&quot;);</span>
<a href="#l3.499"></a><span id="l3.499" class="difflineminus">-  }</span>
<a href="#l3.500"></a><span id="l3.500" class="difflineminus">-  else if (property == kNC_CanGetIncomingMessages) {</span>
<a href="#l3.501"></a><span id="l3.501" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.502"></a><span id="l3.502" class="difflineminus">-    rv = getServerForFolderNode(source, getter_AddRefs(server));</span>
<a href="#l3.503"></a><span id="l3.503" class="difflineminus">-    if (NS_FAILED(rv) || !server) return NS_RDF_NO_VALUE;</span>
<a href="#l3.504"></a><span id="l3.504" class="difflineminus">-</span>
<a href="#l3.505"></a><span id="l3.505" class="difflineminus">-    if (canGetIncomingMessages(server))</span>
<a href="#l3.506"></a><span id="l3.506" class="difflineminus">-      str.AssignLiteral(&quot;true&quot;);</span>
<a href="#l3.507"></a><span id="l3.507" class="difflineminus">-  }</span>
<a href="#l3.508"></a><span id="l3.508" class="difflineminus">-</span>
<a href="#l3.509"></a><span id="l3.509" class="difflineminus">-  if (!str.IsEmpty())</span>
<a href="#l3.510"></a><span id="l3.510" class="difflineminus">-    rv = createNode(str.get(), target, getRDFService());</span>
<a href="#l3.511"></a><span id="l3.511" class="difflineminus">-</span>
<a href="#l3.512"></a><span id="l3.512" class="difflineminus">-  //if we have an empty string and we don't have an error value, then</span>
<a href="#l3.513"></a><span id="l3.513" class="difflineminus">-  //we don't have a value for RDF.</span>
<a href="#l3.514"></a><span id="l3.514" class="difflineminus">-  else if(NS_SUCCEEDED(rv))</span>
<a href="#l3.515"></a><span id="l3.515" class="difflineminus">-    rv = NS_RDF_NO_VALUE;</span>
<a href="#l3.516"></a><span id="l3.516" class="difflineminus">-</span>
<a href="#l3.517"></a><span id="l3.517" class="difflineminus">-  return rv;</span>
<a href="#l3.518"></a><span id="l3.518" class="difflineminus">-}</span>
<a href="#l3.519"></a><span id="l3.519" class="difflineminus">-</span>
<a href="#l3.520"></a><span id="l3.520" class="difflineminus">-</span>
<a href="#l3.521"></a><span id="l3.521" class="difflineminus">-</span>
<a href="#l3.522"></a><span id="l3.522" class="difflineminus">-/* nsISimpleEnumerator GetTargets (in nsIRDFResource aSource, in nsIRDFResource property, in boolean aTruthValue); */</span>
<a href="#l3.523"></a><span id="l3.523" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.524"></a><span id="l3.524" class="difflineminus">-nsMsgAccountManagerDataSource::GetTargets(nsIRDFResource *source,</span>
<a href="#l3.525"></a><span id="l3.525" class="difflineminus">-                                          nsIRDFResource *property,</span>
<a href="#l3.526"></a><span id="l3.526" class="difflineminus">-                                          bool aTruthValue,</span>
<a href="#l3.527"></a><span id="l3.527" class="difflineminus">-                                          nsISimpleEnumerator **_retval)</span>
<a href="#l3.528"></a><span id="l3.528" class="difflineminus">-{</span>
<a href="#l3.529"></a><span id="l3.529" class="difflineminus">-  nsresult rv = NS_RDF_NO_VALUE;</span>
<a href="#l3.530"></a><span id="l3.530" class="difflineminus">-</span>
<a href="#l3.531"></a><span id="l3.531" class="difflineminus">-  // create array and enumerator</span>
<a href="#l3.532"></a><span id="l3.532" class="difflineminus">-  // even if we're not handling this we need to return something empty?</span>
<a href="#l3.533"></a><span id="l3.533" class="difflineminus">-  nsCOMArray&lt;nsIRDFResource&gt; nodes;</span>
<a href="#l3.534"></a><span id="l3.534" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.535"></a><span id="l3.535" class="difflineminus">-  if (source == kNC_AccountRoot)</span>
<a href="#l3.536"></a><span id="l3.536" class="difflineminus">-    rv = createRootResources(property, &amp;nodes);</span>
<a href="#l3.537"></a><span id="l3.537" class="difflineminus">-  else if (property == kNC_Settings)</span>
<a href="#l3.538"></a><span id="l3.538" class="difflineminus">-    rv = createSettingsResources(source, &amp;nodes);</span>
<a href="#l3.539"></a><span id="l3.539" class="difflineminus">-</span>
<a href="#l3.540"></a><span id="l3.540" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l3.541"></a><span id="l3.541" class="difflineminus">-    return NS_RDF_NO_VALUE;</span>
<a href="#l3.542"></a><span id="l3.542" class="difflineminus">-  return NS_NewArrayEnumerator(_retval, nodes);</span>
<a href="#l3.543"></a><span id="l3.543" class="difflineminus">-}</span>
<a href="#l3.544"></a><span id="l3.544" class="difflineminus">-</span>
<a href="#l3.545"></a><span id="l3.545" class="difflineminus">-// end of all arcs coming out of msgaccounts:/</span>
<a href="#l3.546"></a><span id="l3.546" class="difflineminus">-nsresult</span>
<a href="#l3.547"></a><span id="l3.547" class="difflineminus">-nsMsgAccountManagerDataSource::createRootResources(nsIRDFResource *property,</span>
<a href="#l3.548"></a><span id="l3.548" class="difflineminus">-                                                   nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l3.549"></a><span id="l3.549" class="difflineminus">-{</span>
<a href="#l3.550"></a><span id="l3.550" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l3.551"></a><span id="l3.551" class="difflineminus">-  if (isContainment(property)) {</span>
<a href="#l3.552"></a><span id="l3.552" class="difflineminus">-</span>
<a href="#l3.553"></a><span id="l3.553" class="difflineminus">-    nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager);</span>
<a href="#l3.554"></a><span id="l3.554" class="difflineminus">-    if (!am) return NS_ERROR_FAILURE;</span>
<a href="#l3.555"></a><span id="l3.555" class="difflineminus">-</span>
<a href="#l3.556"></a><span id="l3.556" class="difflineminus">-    nsCOMPtr&lt;nsIArray&gt; servers;</span>
<a href="#l3.557"></a><span id="l3.557" class="difflineminus">-    rv = am-&gt;GetAllServers(getter_AddRefs(servers));</span>
<a href="#l3.558"></a><span id="l3.558" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.559"></a><span id="l3.559" class="difflineminus">-</span>
<a href="#l3.560"></a><span id="l3.560" class="difflineminus">-    uint32_t length;</span>
<a href="#l3.561"></a><span id="l3.561" class="difflineminus">-    rv = servers-&gt;GetLength(&amp;length);</span>
<a href="#l3.562"></a><span id="l3.562" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.563"></a><span id="l3.563" class="difflineminus">-</span>
<a href="#l3.564"></a><span id="l3.564" class="difflineminus">-    for (uint32_t i = 0; i &lt; length; ++i)</span>
<a href="#l3.565"></a><span id="l3.565" class="difflineminus">-    {</span>
<a href="#l3.566"></a><span id="l3.566" class="difflineminus">-      nsCOMPtr&lt;nsIMsgIncomingServer&gt; server(do_QueryElementAt(servers, i, &amp;rv));</span>
<a href="#l3.567"></a><span id="l3.567" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l3.568"></a><span id="l3.568" class="difflineminus">-        continue;</span>
<a href="#l3.569"></a><span id="l3.569" class="difflineminus">-</span>
<a href="#l3.570"></a><span id="l3.570" class="difflineminus">-      nsCOMPtr&lt;nsIMsgFolder&gt; serverFolder;</span>
<a href="#l3.571"></a><span id="l3.571" class="difflineminus">-      rv = server-&gt;GetRootFolder(getter_AddRefs(serverFolder));</span>
<a href="#l3.572"></a><span id="l3.572" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l3.573"></a><span id="l3.573" class="difflineminus">-        continue;</span>
<a href="#l3.574"></a><span id="l3.574" class="difflineminus">-</span>
<a href="#l3.575"></a><span id="l3.575" class="difflineminus">-      // add the resource to the array</span>
<a href="#l3.576"></a><span id="l3.576" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt; serverResource = do_QueryInterface(serverFolder);</span>
<a href="#l3.577"></a><span id="l3.577" class="difflineminus">-      if (serverResource)</span>
<a href="#l3.578"></a><span id="l3.578" class="difflineminus">-        (void) aNodeArray-&gt;AppendObject(serverResource);</span>
<a href="#l3.579"></a><span id="l3.579" class="difflineminus">-    }</span>
<a href="#l3.580"></a><span id="l3.580" class="difflineminus">-</span>
<a href="#l3.581"></a><span id="l3.581" class="difflineminus">-#ifdef DEBUG_amds</span>
<a href="#l3.582"></a><span id="l3.582" class="difflineminus">-    uint32_t nodecount;</span>
<a href="#l3.583"></a><span id="l3.583" class="difflineminus">-    aNodeArray-&gt;GetLength(&amp;nodecount);</span>
<a href="#l3.584"></a><span id="l3.584" class="difflineminus">-    printf(&quot;GetTargets(): added %d servers on %s\n&quot;, nodecount,</span>
<a href="#l3.585"></a><span id="l3.585" class="difflineminus">-           (const char*)property_arc);</span>
<a href="#l3.586"></a><span id="l3.586" class="difflineminus">-#endif</span>
<a href="#l3.587"></a><span id="l3.587" class="difflineminus">-    // For the &quot;settings&quot; arc, we also want to add SMTP setting.</span>
<a href="#l3.588"></a><span id="l3.588" class="difflineminus">-    if (property == kNC_Settings) {</span>
<a href="#l3.589"></a><span id="l3.589" class="difflineminus">-      aNodeArray-&gt;AppendObject(kNC_PageTitleSMTP);</span>
<a href="#l3.590"></a><span id="l3.590" class="difflineminus">-    }</span>
<a href="#l3.591"></a><span id="l3.591" class="difflineminus">-  }</span>
<a href="#l3.592"></a><span id="l3.592" class="difflineminus">-</span>
<a href="#l3.593"></a><span id="l3.593" class="difflineminus">-#ifdef DEBUG_amds</span>
<a href="#l3.594"></a><span id="l3.594" class="difflineminus">-  else {</span>
<a href="#l3.595"></a><span id="l3.595" class="difflineminus">-    printf(&quot;unknown arc %s on msgaccounts:/\n&quot;, (const char*)property_arc);</span>
<a href="#l3.596"></a><span id="l3.596" class="difflineminus">-  }</span>
<a href="#l3.597"></a><span id="l3.597" class="difflineminus">-#endif</span>
<a href="#l3.598"></a><span id="l3.598" class="difflineminus">-</span>
<a href="#l3.599"></a><span id="l3.599" class="difflineminus">-  return rv;</span>
<a href="#l3.600"></a><span id="l3.600" class="difflineminus">-}</span>
<a href="#l3.601"></a><span id="l3.601" class="difflineminus">-</span>
<a href="#l3.602"></a><span id="l3.602" class="difflineminus">-nsresult</span>
<a href="#l3.603"></a><span id="l3.603" class="difflineminus">-nsMsgAccountManagerDataSource::appendGenericSettingsResources(nsIMsgIncomingServer *server, nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l3.604"></a><span id="l3.604" class="difflineminus">-{</span>
<a href="#l3.605"></a><span id="l3.605" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.606"></a><span id="l3.606" class="difflineminus">-</span>
<a href="#l3.607"></a><span id="l3.607" class="difflineminus">-  nsCOMPtr&lt;nsICategoryManager&gt; catman = do_GetService(NS_CATEGORYMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l3.608"></a><span id="l3.608" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.609"></a><span id="l3.609" class="difflineminus">-</span>
<a href="#l3.610"></a><span id="l3.610" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; e;</span>
<a href="#l3.611"></a><span id="l3.611" class="difflineminus">-  rv = catman-&gt;EnumerateCategory(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, getter_AddRefs(e));</span>
<a href="#l3.612"></a><span id="l3.612" class="difflineminus">-  if(NS_SUCCEEDED(rv) &amp;&amp; e) {</span>
<a href="#l3.613"></a><span id="l3.613" class="difflineminus">-    while (true) {</span>
<a href="#l3.614"></a><span id="l3.614" class="difflineminus">-      nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l3.615"></a><span id="l3.615" class="difflineminus">-      rv = e-&gt;GetNext(getter_AddRefs(supports));</span>
<a href="#l3.616"></a><span id="l3.616" class="difflineminus">-      nsCOMPtr&lt;nsISupportsCString&gt; catEntry = do_QueryInterface(supports);</span>
<a href="#l3.617"></a><span id="l3.617" class="difflineminus">-      if (NS_FAILED(rv) || !catEntry)</span>
<a href="#l3.618"></a><span id="l3.618" class="difflineminus">-        break;</span>
<a href="#l3.619"></a><span id="l3.619" class="difflineminus">-</span>
<a href="#l3.620"></a><span id="l3.620" class="difflineminus">-      nsAutoCString entryString;</span>
<a href="#l3.621"></a><span id="l3.621" class="difflineminus">-      rv = catEntry-&gt;GetData(entryString);</span>
<a href="#l3.622"></a><span id="l3.622" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l3.623"></a><span id="l3.623" class="difflineminus">-        break;</span>
<a href="#l3.624"></a><span id="l3.624" class="difflineminus">-</span>
<a href="#l3.625"></a><span id="l3.625" class="difflineminus">-      nsCString contractidString;</span>
<a href="#l3.626"></a><span id="l3.626" class="difflineminus">-      rv = catman-&gt;GetCategoryEntry(MAILNEWS_ACCOUNTMANAGER_EXTENSIONS, entryString.get(), getter_Copies(contractidString));</span>
<a href="#l3.627"></a><span id="l3.627" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l3.628"></a><span id="l3.628" class="difflineminus">-        break;</span>
<a href="#l3.629"></a><span id="l3.629" class="difflineminus">-</span>
<a href="#l3.630"></a><span id="l3.630" class="difflineminus">-      nsCOMPtr &lt;nsIMsgAccountManagerExtension&gt; extension =</span>
<a href="#l3.631"></a><span id="l3.631" class="difflineminus">-        do_GetService(contractidString.get(), &amp;rv);</span>
<a href="#l3.632"></a><span id="l3.632" class="difflineminus">-      if (NS_FAILED(rv) || !extension)</span>
<a href="#l3.633"></a><span id="l3.633" class="difflineminus">-        break;</span>
<a href="#l3.634"></a><span id="l3.634" class="difflineminus">-</span>
<a href="#l3.635"></a><span id="l3.635" class="difflineminus">-      bool showPanel;</span>
<a href="#l3.636"></a><span id="l3.636" class="difflineminus">-      rv = extension-&gt;ShowPanel(server, &amp;showPanel);</span>
<a href="#l3.637"></a><span id="l3.637" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l3.638"></a><span id="l3.638" class="difflineminus">-        break;</span>
<a href="#l3.639"></a><span id="l3.639" class="difflineminus">-</span>
<a href="#l3.640"></a><span id="l3.640" class="difflineminus">-      if (showPanel) {</span>
<a href="#l3.641"></a><span id="l3.641" class="difflineminus">-        nsCString name;</span>
<a href="#l3.642"></a><span id="l3.642" class="difflineminus">-        rv = extension-&gt;GetName(name);</span>
<a href="#l3.643"></a><span id="l3.643" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l3.644"></a><span id="l3.644" class="difflineminus">-          break;</span>
<a href="#l3.645"></a><span id="l3.645" class="difflineminus">-</span>
<a href="#l3.646"></a><span id="l3.646" class="difflineminus">-        rv = appendGenericSetting(name.get(), aNodeArray);</span>
<a href="#l3.647"></a><span id="l3.647" class="difflineminus">-        if (NS_FAILED(rv))</span>
<a href="#l3.648"></a><span id="l3.648" class="difflineminus">-          break;</span>
<a href="#l3.649"></a><span id="l3.649" class="difflineminus">-      }</span>
<a href="#l3.650"></a><span id="l3.650" class="difflineminus">-    }</span>
<a href="#l3.651"></a><span id="l3.651" class="difflineminus">-  }</span>
<a href="#l3.652"></a><span id="l3.652" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.653"></a><span id="l3.653" class="difflineminus">-}</span>
<a href="#l3.654"></a><span id="l3.654" class="difflineminus">-</span>
<a href="#l3.655"></a><span id="l3.655" class="difflineminus">-nsresult</span>
<a href="#l3.656"></a><span id="l3.656" class="difflineminus">-nsMsgAccountManagerDataSource::appendGenericSetting(const char *name,</span>
<a href="#l3.657"></a><span id="l3.657" class="difflineminus">-                                                    nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l3.658"></a><span id="l3.658" class="difflineminus">-{</span>
<a href="#l3.659"></a><span id="l3.659" class="difflineminus">-  NS_ENSURE_ARG_POINTER(name);</span>
<a href="#l3.660"></a><span id="l3.660" class="difflineminus">-  NS_ENSURE_ARG_POINTER(aNodeArray);</span>
<a href="#l3.661"></a><span id="l3.661" class="difflineminus">-</span>
<a href="#l3.662"></a><span id="l3.662" class="difflineminus">-  nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l3.663"></a><span id="l3.663" class="difflineminus">-</span>
<a href="#l3.664"></a><span id="l3.664" class="difflineminus">-  nsAutoCString resourceStr;</span>
<a href="#l3.665"></a><span id="l3.665" class="difflineminus">-  resourceStr = NC_RDF_PAGETITLE_PREFIX;</span>
<a href="#l3.666"></a><span id="l3.666" class="difflineminus">-  resourceStr += name;</span>
<a href="#l3.667"></a><span id="l3.667" class="difflineminus">-</span>
<a href="#l3.668"></a><span id="l3.668" class="difflineminus">-  nsresult rv = getRDFService()-&gt;GetResource(resourceStr, getter_AddRefs(resource));</span>
<a href="#l3.669"></a><span id="l3.669" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.670"></a><span id="l3.670" class="difflineminus">-</span>
<a href="#l3.671"></a><span id="l3.671" class="difflineminus">-  // AppendElement will addref.</span>
<a href="#l3.672"></a><span id="l3.672" class="difflineminus">-  aNodeArray-&gt;AppendObject(resource);</span>
<a href="#l3.673"></a><span id="l3.673" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.674"></a><span id="l3.674" class="difflineminus">-}</span>
<a href="#l3.675"></a><span id="l3.675" class="difflineminus">-</span>
<a href="#l3.676"></a><span id="l3.676" class="difflineminus">-// end of all #Settings arcs</span>
<a href="#l3.677"></a><span id="l3.677" class="difflineminus">-nsresult</span>
<a href="#l3.678"></a><span id="l3.678" class="difflineminus">-nsMsgAccountManagerDataSource::createSettingsResources(nsIRDFResource *aSource,</span>
<a href="#l3.679"></a><span id="l3.679" class="difflineminus">-                                                       nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray)</span>
<a href="#l3.680"></a><span id="l3.680" class="difflineminus">-{</span>
<a href="#l3.681"></a><span id="l3.681" class="difflineminus">-  // If this isn't a server, just return.</span>
<a href="#l3.682"></a><span id="l3.682" class="difflineminus">-  if (aSource == kNC_PageTitleSMTP)</span>
<a href="#l3.683"></a><span id="l3.683" class="difflineminus">-    return NS_OK;</span>
<a href="#l3.684"></a><span id="l3.684" class="difflineminus">-</span>
<a href="#l3.685"></a><span id="l3.685" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.686"></a><span id="l3.686" class="difflineminus">-  getServerForFolderNode(aSource, getter_AddRefs(server));</span>
<a href="#l3.687"></a><span id="l3.687" class="difflineminus">-  if (server) {</span>
<a href="#l3.688"></a><span id="l3.688" class="difflineminus">-    bool hasIdentities;</span>
<a href="#l3.689"></a><span id="l3.689" class="difflineminus">-    nsresult rv = serverHasIdentities(server, &amp;hasIdentities);</span>
<a href="#l3.690"></a><span id="l3.690" class="difflineminus">-</span>
<a href="#l3.691"></a><span id="l3.691" class="difflineminus">-    if (hasIdentities) {</span>
<a href="#l3.692"></a><span id="l3.692" class="difflineminus">-      aNodeArray-&gt;AppendObject(kNC_PageTitleServer);</span>
<a href="#l3.693"></a><span id="l3.693" class="difflineminus">-      aNodeArray-&gt;AppendObject(kNC_PageTitleCopies);</span>
<a href="#l3.694"></a><span id="l3.694" class="difflineminus">-      aNodeArray-&gt;AppendObject(kNC_PageTitleAddressing);</span>
<a href="#l3.695"></a><span id="l3.695" class="difflineminus">-    }</span>
<a href="#l3.696"></a><span id="l3.696" class="difflineminus">-</span>
<a href="#l3.697"></a><span id="l3.697" class="difflineminus">-    // Junk settings apply for all server types except for news and rss.</span>
<a href="#l3.698"></a><span id="l3.698" class="difflineminus">-    nsCString serverType;</span>
<a href="#l3.699"></a><span id="l3.699" class="difflineminus">-    server-&gt;GetType(serverType);</span>
<a href="#l3.700"></a><span id="l3.700" class="difflineminus">-    if (!MsgLowerCaseEqualsLiteral(serverType, &quot;nntp&quot;) &amp;&amp;</span>
<a href="#l3.701"></a><span id="l3.701" class="difflineminus">-        !MsgLowerCaseEqualsLiteral(serverType, &quot;rss&quot;))</span>
<a href="#l3.702"></a><span id="l3.702" class="difflineminus">-      aNodeArray-&gt;AppendObject(kNC_PageTitleJunk);</span>
<a href="#l3.703"></a><span id="l3.703" class="difflineminus">-</span>
<a href="#l3.704"></a><span id="l3.704" class="difflineminus">-    // Check the offline capability before adding</span>
<a href="#l3.705"></a><span id="l3.705" class="difflineminus">-    // offline item</span>
<a href="#l3.706"></a><span id="l3.706" class="difflineminus">-    int32_t offlineSupportLevel = 0;</span>
<a href="#l3.707"></a><span id="l3.707" class="difflineminus">-    rv = server-&gt;GetOfflineSupportLevel(&amp;offlineSupportLevel);</span>
<a href="#l3.708"></a><span id="l3.708" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.709"></a><span id="l3.709" class="difflineminus">-</span>
<a href="#l3.710"></a><span id="l3.710" class="difflineminus">-    bool supportsDiskSpace;</span>
<a href="#l3.711"></a><span id="l3.711" class="difflineminus">-    rv = server-&gt;GetSupportsDiskSpace(&amp;supportsDiskSpace);</span>
<a href="#l3.712"></a><span id="l3.712" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l3.713"></a><span id="l3.713" class="difflineminus">-</span>
<a href="#l3.714"></a><span id="l3.714" class="difflineminus">-    // currently there is no offline without diskspace</span>
<a href="#l3.715"></a><span id="l3.715" class="difflineminus">-    if (offlineSupportLevel &gt;= OFFLINE_SUPPORT_LEVEL_REGULAR)</span>
<a href="#l3.716"></a><span id="l3.716" class="difflineminus">-      aNodeArray-&gt;AppendObject(kNC_PageTitleSynchronization);</span>
<a href="#l3.717"></a><span id="l3.717" class="difflineminus">-    else if (supportsDiskSpace)</span>
<a href="#l3.718"></a><span id="l3.718" class="difflineminus">-      aNodeArray-&gt;AppendObject(kNC_PageTitleDiskSpace);</span>
<a href="#l3.719"></a><span id="l3.719" class="difflineminus">-</span>
<a href="#l3.720"></a><span id="l3.720" class="difflineminus">-    if (hasIdentities) {</span>
<a href="#l3.721"></a><span id="l3.721" class="difflineminus">-      // extensions come after the default panels</span>
<a href="#l3.722"></a><span id="l3.722" class="difflineminus">-      rv = appendGenericSettingsResources(server, aNodeArray);</span>
<a href="#l3.723"></a><span id="l3.723" class="difflineminus">-      NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to add generic panels&quot;);</span>
<a href="#l3.724"></a><span id="l3.724" class="difflineminus">-    }</span>
<a href="#l3.725"></a><span id="l3.725" class="difflineminus">-  }</span>
<a href="#l3.726"></a><span id="l3.726" class="difflineminus">-</span>
<a href="#l3.727"></a><span id="l3.727" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.728"></a><span id="l3.728" class="difflineminus">-}</span>
<a href="#l3.729"></a><span id="l3.729" class="difflineminus">-</span>
<a href="#l3.730"></a><span id="l3.730" class="difflineminus">-nsresult</span>
<a href="#l3.731"></a><span id="l3.731" class="difflineminus">-nsMsgAccountManagerDataSource::serverHasIdentities(nsIMsgIncomingServer* aServer,</span>
<a href="#l3.732"></a><span id="l3.732" class="difflineminus">-                                                   bool *aResult)</span>
<a href="#l3.733"></a><span id="l3.733" class="difflineminus">-{</span>
<a href="#l3.734"></a><span id="l3.734" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.735"></a><span id="l3.735" class="difflineminus">-  *aResult = false;</span>
<a href="#l3.736"></a><span id="l3.736" class="difflineminus">-</span>
<a href="#l3.737"></a><span id="l3.737" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager, &amp;rv);</span>
<a href="#l3.738"></a><span id="l3.738" class="difflineminus">-</span>
<a href="#l3.739"></a><span id="l3.739" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.740"></a><span id="l3.740" class="difflineminus">-</span>
<a href="#l3.741"></a><span id="l3.741" class="difflineminus">-  nsCOMPtr&lt;nsIArray&gt; identities;</span>
<a href="#l3.742"></a><span id="l3.742" class="difflineminus">-  rv = am-&gt;GetIdentitiesForServer(aServer, getter_AddRefs(identities));</span>
<a href="#l3.743"></a><span id="l3.743" class="difflineminus">-</span>
<a href="#l3.744"></a><span id="l3.744" class="difflineminus">-  // no identities just means no arcs</span>
<a href="#l3.745"></a><span id="l3.745" class="difflineminus">-  if (NS_FAILED(rv)) return NS_OK;</span>
<a href="#l3.746"></a><span id="l3.746" class="difflineminus">-</span>
<a href="#l3.747"></a><span id="l3.747" class="difflineminus">-  uint32_t count;</span>
<a href="#l3.748"></a><span id="l3.748" class="difflineminus">-  rv = identities-&gt;GetLength(&amp;count);</span>
<a href="#l3.749"></a><span id="l3.749" class="difflineminus">-  if (NS_FAILED(rv)) return NS_OK;</span>
<a href="#l3.750"></a><span id="l3.750" class="difflineminus">-</span>
<a href="#l3.751"></a><span id="l3.751" class="difflineminus">-  if (count &gt;0)</span>
<a href="#l3.752"></a><span id="l3.752" class="difflineminus">-    *aResult = true;</span>
<a href="#l3.753"></a><span id="l3.753" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.754"></a><span id="l3.754" class="difflineminus">-}</span>
<a href="#l3.755"></a><span id="l3.755" class="difflineminus">-</span>
<a href="#l3.756"></a><span id="l3.756" class="difflineminus">-nsresult</span>
<a href="#l3.757"></a><span id="l3.757" class="difflineminus">-nsMsgAccountManagerDataSource::getAccountArcs(nsIMutableArray **aResult)</span>
<a href="#l3.758"></a><span id="l3.758" class="difflineminus">-{</span>
<a href="#l3.759"></a><span id="l3.759" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.760"></a><span id="l3.760" class="difflineminus">-  if (!mAccountArcsOut) {</span>
<a href="#l3.761"></a><span id="l3.761" class="difflineminus">-    mAccountArcsOut = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l3.762"></a><span id="l3.762" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.763"></a><span id="l3.763" class="difflineminus">-</span>
<a href="#l3.764"></a><span id="l3.764" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_Settings);</span>
<a href="#l3.765"></a><span id="l3.765" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_Name);</span>
<a href="#l3.766"></a><span id="l3.766" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeName);</span>
<a href="#l3.767"></a><span id="l3.767" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName);</span>
<a href="#l3.768"></a><span id="l3.768" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_NameSort);</span>
<a href="#l3.769"></a><span id="l3.769" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort);</span>
<a href="#l3.770"></a><span id="l3.770" class="difflineminus">-    mAccountArcsOut-&gt;AppendElement(kNC_PageTag);</span>
<a href="#l3.771"></a><span id="l3.771" class="difflineminus">-  }</span>
<a href="#l3.772"></a><span id="l3.772" class="difflineminus">-</span>
<a href="#l3.773"></a><span id="l3.773" class="difflineminus">-  NS_IF_ADDREF(*aResult = mAccountArcsOut);</span>
<a href="#l3.774"></a><span id="l3.774" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.775"></a><span id="l3.775" class="difflineminus">-}</span>
<a href="#l3.776"></a><span id="l3.776" class="difflineminus">-</span>
<a href="#l3.777"></a><span id="l3.777" class="difflineminus">-nsresult</span>
<a href="#l3.778"></a><span id="l3.778" class="difflineminus">-nsMsgAccountManagerDataSource::getAccountRootArcs(nsIMutableArray **aResult)</span>
<a href="#l3.779"></a><span id="l3.779" class="difflineminus">-{</span>
<a href="#l3.780"></a><span id="l3.780" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.781"></a><span id="l3.781" class="difflineminus">-  if (!mAccountRootArcsOut) {</span>
<a href="#l3.782"></a><span id="l3.782" class="difflineminus">-    mAccountRootArcsOut = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l3.783"></a><span id="l3.783" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.784"></a><span id="l3.784" class="difflineminus">-</span>
<a href="#l3.785"></a><span id="l3.785" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Server);</span>
<a href="#l3.786"></a><span id="l3.786" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Child);</span>
<a href="#l3.787"></a><span id="l3.787" class="difflineminus">-</span>
<a href="#l3.788"></a><span id="l3.788" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Settings);</span>
<a href="#l3.789"></a><span id="l3.789" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_Name);</span>
<a href="#l3.790"></a><span id="l3.790" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeName);</span>
<a href="#l3.791"></a><span id="l3.791" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeSimpleName);</span>
<a href="#l3.792"></a><span id="l3.792" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_NameSort);</span>
<a href="#l3.793"></a><span id="l3.793" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_FolderTreeNameSort);</span>
<a href="#l3.794"></a><span id="l3.794" class="difflineminus">-    mAccountRootArcsOut-&gt;AppendElement(kNC_PageTag);</span>
<a href="#l3.795"></a><span id="l3.795" class="difflineminus">-  }</span>
<a href="#l3.796"></a><span id="l3.796" class="difflineminus">-</span>
<a href="#l3.797"></a><span id="l3.797" class="difflineminus">-  NS_IF_ADDREF(*aResult = mAccountRootArcsOut);</span>
<a href="#l3.798"></a><span id="l3.798" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.799"></a><span id="l3.799" class="difflineminus">-}</span>
<a href="#l3.800"></a><span id="l3.800" class="difflineminus">-</span>
<a href="#l3.801"></a><span id="l3.801" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.802"></a><span id="l3.802" class="difflineminus">-nsMsgAccountManagerDataSource::HasArcOut(nsIRDFResource *source, nsIRDFResource *aArc, bool *result)</span>
<a href="#l3.803"></a><span id="l3.803" class="difflineminus">-{</span>
<a href="#l3.804"></a><span id="l3.804" class="difflineminus">-  if (aArc == kNC_Settings) {</span>
<a href="#l3.805"></a><span id="l3.805" class="difflineminus">-    // based on createSettingsResources()</span>
<a href="#l3.806"></a><span id="l3.806" class="difflineminus">-    // we only have settings for local folders and servers with identities</span>
<a href="#l3.807"></a><span id="l3.807" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.808"></a><span id="l3.808" class="difflineminus">-    nsresult rv = getServerForFolderNode(source, getter_AddRefs(server));</span>
<a href="#l3.809"></a><span id="l3.809" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; server) {</span>
<a href="#l3.810"></a><span id="l3.810" class="difflineminus">-      // Check the offline capability before adding arc</span>
<a href="#l3.811"></a><span id="l3.811" class="difflineminus">-      int32_t offlineSupportLevel = 0;</span>
<a href="#l3.812"></a><span id="l3.812" class="difflineminus">-      (void) server-&gt;GetOfflineSupportLevel(&amp;offlineSupportLevel);</span>
<a href="#l3.813"></a><span id="l3.813" class="difflineminus">-      if (offlineSupportLevel &gt;= OFFLINE_SUPPORT_LEVEL_REGULAR) {</span>
<a href="#l3.814"></a><span id="l3.814" class="difflineminus">-        *result = true;</span>
<a href="#l3.815"></a><span id="l3.815" class="difflineminus">-        return NS_OK;</span>
<a href="#l3.816"></a><span id="l3.816" class="difflineminus">-      }</span>
<a href="#l3.817"></a><span id="l3.817" class="difflineminus">-</span>
<a href="#l3.818"></a><span id="l3.818" class="difflineminus">-      bool supportsDiskSpace;</span>
<a href="#l3.819"></a><span id="l3.819" class="difflineminus">-      (void) server-&gt;GetSupportsDiskSpace(&amp;supportsDiskSpace);</span>
<a href="#l3.820"></a><span id="l3.820" class="difflineminus">-      if (supportsDiskSpace) {</span>
<a href="#l3.821"></a><span id="l3.821" class="difflineminus">-        *result = true;</span>
<a href="#l3.822"></a><span id="l3.822" class="difflineminus">-        return NS_OK;</span>
<a href="#l3.823"></a><span id="l3.823" class="difflineminus">-      }</span>
<a href="#l3.824"></a><span id="l3.824" class="difflineminus">-      return serverHasIdentities(server, result);</span>
<a href="#l3.825"></a><span id="l3.825" class="difflineminus">-    }</span>
<a href="#l3.826"></a><span id="l3.826" class="difflineminus">-  }</span>
<a href="#l3.827"></a><span id="l3.827" class="difflineminus">-</span>
<a href="#l3.828"></a><span id="l3.828" class="difflineminus">-  *result = false;</span>
<a href="#l3.829"></a><span id="l3.829" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.830"></a><span id="l3.830" class="difflineminus">-}</span>
<a href="#l3.831"></a><span id="l3.831" class="difflineminus">-</span>
<a href="#l3.832"></a><span id="l3.832" class="difflineminus">-/* nsISimpleEnumerator ArcLabelsOut (in nsIRDFResource aSource); */</span>
<a href="#l3.833"></a><span id="l3.833" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.834"></a><span id="l3.834" class="difflineminus">-nsMsgAccountManagerDataSource::ArcLabelsOut(nsIRDFResource *source,</span>
<a href="#l3.835"></a><span id="l3.835" class="difflineminus">-                                            nsISimpleEnumerator **_retval)</span>
<a href="#l3.836"></a><span id="l3.836" class="difflineminus">-{</span>
<a href="#l3.837"></a><span id="l3.837" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.838"></a><span id="l3.838" class="difflineminus">-</span>
<a href="#l3.839"></a><span id="l3.839" class="difflineminus">-  // we have to return something, so always create the array/enumerators</span>
<a href="#l3.840"></a><span id="l3.840" class="difflineminus">-  nsCOMPtr&lt;nsIMutableArray&gt; arcs;</span>
<a href="#l3.841"></a><span id="l3.841" class="difflineminus">-  if (source == kNC_AccountRoot)</span>
<a href="#l3.842"></a><span id="l3.842" class="difflineminus">-    rv = getAccountRootArcs(getter_AddRefs(arcs));</span>
<a href="#l3.843"></a><span id="l3.843" class="difflineminus">-  else</span>
<a href="#l3.844"></a><span id="l3.844" class="difflineminus">-    rv = getAccountArcs(getter_AddRefs(arcs));</span>
<a href="#l3.845"></a><span id="l3.845" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.846"></a><span id="l3.846" class="difflineminus">-</span>
<a href="#l3.847"></a><span id="l3.847" class="difflineminus">-  rv = NS_NewArrayEnumerator(_retval, arcs);</span>
<a href="#l3.848"></a><span id="l3.848" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.849"></a><span id="l3.849" class="difflineminus">-</span>
<a href="#l3.850"></a><span id="l3.850" class="difflineminus">-#ifdef DEBUG_amds_</span>
<a href="#l3.851"></a><span id="l3.851" class="difflineminus">-  printf(&quot;GetArcLabelsOut(%s): Adding child, settings, and name arclabels\n&quot;, value);</span>
<a href="#l3.852"></a><span id="l3.852" class="difflineminus">-#endif</span>
<a href="#l3.853"></a><span id="l3.853" class="difflineminus">-</span>
<a href="#l3.854"></a><span id="l3.854" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.855"></a><span id="l3.855" class="difflineminus">-}</span>
<a href="#l3.856"></a><span id="l3.856" class="difflineminus">-</span>
<a href="#l3.857"></a><span id="l3.857" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.858"></a><span id="l3.858" class="difflineminus">-nsMsgAccountManagerDataSource::HasAssertion(nsIRDFResource *aSource,</span>
<a href="#l3.859"></a><span id="l3.859" class="difflineminus">-                                            nsIRDFResource *aProperty,</span>
<a href="#l3.860"></a><span id="l3.860" class="difflineminus">-                                            nsIRDFNode *aTarget,</span>
<a href="#l3.861"></a><span id="l3.861" class="difflineminus">-                                            bool aTruthValue,</span>
<a href="#l3.862"></a><span id="l3.862" class="difflineminus">-                                            bool *_retval)</span>
<a href="#l3.863"></a><span id="l3.863" class="difflineminus">-{</span>
<a href="#l3.864"></a><span id="l3.864" class="difflineminus">-  nsresult rv=NS_ERROR_FAILURE;</span>
<a href="#l3.865"></a><span id="l3.865" class="difflineminus">-</span>
<a href="#l3.866"></a><span id="l3.866" class="difflineminus">-  //</span>
<a href="#l3.867"></a><span id="l3.867" class="difflineminus">-  // msgaccounts:/ properties</span>
<a href="#l3.868"></a><span id="l3.868" class="difflineminus">-  //</span>
<a href="#l3.869"></a><span id="l3.869" class="difflineminus">-  if (aSource == kNC_AccountRoot) {</span>
<a href="#l3.870"></a><span id="l3.870" class="difflineminus">-    rv = HasAssertionAccountRoot(aProperty, aTarget, aTruthValue, _retval);</span>
<a href="#l3.871"></a><span id="l3.871" class="difflineminus">-  }</span>
<a href="#l3.872"></a><span id="l3.872" class="difflineminus">-  //</span>
<a href="#l3.873"></a><span id="l3.873" class="difflineminus">-  // server properties</span>
<a href="#l3.874"></a><span id="l3.874" class="difflineminus">-  //   try to convert the resource to a folder, and then only</span>
<a href="#l3.875"></a><span id="l3.875" class="difflineminus">-  //   answer if it's a server.. any failure falls through to the default case</span>
<a href="#l3.876"></a><span id="l3.876" class="difflineminus">-  //</span>
<a href="#l3.877"></a><span id="l3.877" class="difflineminus">-  // short-circuit on property, so objects like filters, etc, don't get queried</span>
<a href="#l3.878"></a><span id="l3.878" class="difflineminus">-  else if (aProperty == kNC_IsDefaultServer || aProperty == kNC_CanGetMessages ||</span>
<a href="#l3.879"></a><span id="l3.879" class="difflineminus">-           aProperty == kNC_CanGetIncomingMessages || aProperty == kNC_SupportsFilters) {</span>
<a href="#l3.880"></a><span id="l3.880" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.881"></a><span id="l3.881" class="difflineminus">-    rv = getServerForFolderNode(aSource, getter_AddRefs(server));</span>
<a href="#l3.882"></a><span id="l3.882" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; server)</span>
<a href="#l3.883"></a><span id="l3.883" class="difflineminus">-      rv = HasAssertionServer(server, aProperty, aTarget,</span>
<a href="#l3.884"></a><span id="l3.884" class="difflineminus">-                              aTruthValue, _retval);</span>
<a href="#l3.885"></a><span id="l3.885" class="difflineminus">-  }</span>
<a href="#l3.886"></a><span id="l3.886" class="difflineminus">-</span>
<a href="#l3.887"></a><span id="l3.887" class="difflineminus">-  // any failures above fallthrough to the parent class</span>
<a href="#l3.888"></a><span id="l3.888" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l3.889"></a><span id="l3.889" class="difflineminus">-    return nsMsgRDFDataSource::HasAssertion(aSource, aProperty,</span>
<a href="#l3.890"></a><span id="l3.890" class="difflineminus">-                                            aTarget, aTruthValue, _retval);</span>
<a href="#l3.891"></a><span id="l3.891" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.892"></a><span id="l3.892" class="difflineminus">-}</span>
<a href="#l3.893"></a><span id="l3.893" class="difflineminus">-</span>
<a href="#l3.894"></a><span id="l3.894" class="difflineminus">-</span>
<a href="#l3.895"></a><span id="l3.895" class="difflineminus">-</span>
<a href="#l3.896"></a><span id="l3.896" class="difflineminus">-nsresult</span>
<a href="#l3.897"></a><span id="l3.897" class="difflineminus">-nsMsgAccountManagerDataSource::HasAssertionServer(nsIMsgIncomingServer *aServer,</span>
<a href="#l3.898"></a><span id="l3.898" class="difflineminus">-                                                  nsIRDFResource *aProperty,</span>
<a href="#l3.899"></a><span id="l3.899" class="difflineminus">-                                                  nsIRDFNode *aTarget,</span>
<a href="#l3.900"></a><span id="l3.900" class="difflineminus">-                                                  bool aTruthValue,</span>
<a href="#l3.901"></a><span id="l3.901" class="difflineminus">-                                                  bool *_retval)</span>
<a href="#l3.902"></a><span id="l3.902" class="difflineminus">-{</span>
<a href="#l3.903"></a><span id="l3.903" class="difflineminus">-  if (aProperty == kNC_IsDefaultServer)</span>
<a href="#l3.904"></a><span id="l3.904" class="difflineminus">-    *_retval = (aTarget == kTrueLiteral) ? isDefaultServer(aServer) : !isDefaultServer(aServer);</span>
<a href="#l3.905"></a><span id="l3.905" class="difflineminus">-  else if (aProperty == kNC_SupportsFilters)</span>
<a href="#l3.906"></a><span id="l3.906" class="difflineminus">-    *_retval = (aTarget == kTrueLiteral) ? supportsFilters(aServer) : !supportsFilters(aServer);</span>
<a href="#l3.907"></a><span id="l3.907" class="difflineminus">-  else if (aProperty == kNC_CanGetMessages)</span>
<a href="#l3.908"></a><span id="l3.908" class="difflineminus">-   *_retval = (aTarget == kTrueLiteral) ? canGetMessages(aServer) : !canGetMessages(aServer);</span>
<a href="#l3.909"></a><span id="l3.909" class="difflineminus">-  else if (aProperty == kNC_CanGetIncomingMessages)</span>
<a href="#l3.910"></a><span id="l3.910" class="difflineminus">-    *_retval = (aTarget == kTrueLiteral) ? canGetIncomingMessages(aServer) : !canGetIncomingMessages(aServer);</span>
<a href="#l3.911"></a><span id="l3.911" class="difflineminus">-  else</span>
<a href="#l3.912"></a><span id="l3.912" class="difflineminus">-    *_retval = false;</span>
<a href="#l3.913"></a><span id="l3.913" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.914"></a><span id="l3.914" class="difflineminus">-}</span>
<a href="#l3.915"></a><span id="l3.915" class="difflineminus">-</span>
<a href="#l3.916"></a><span id="l3.916" class="difflineminus">-bool</span>
<a href="#l3.917"></a><span id="l3.917" class="difflineminus">-nsMsgAccountManagerDataSource::isDefaultServer(nsIMsgIncomingServer *aServer)</span>
<a href="#l3.918"></a><span id="l3.918" class="difflineminus">-{</span>
<a href="#l3.919"></a><span id="l3.919" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.920"></a><span id="l3.920" class="difflineminus">-  if (!aServer) return false;</span>
<a href="#l3.921"></a><span id="l3.921" class="difflineminus">-</span>
<a href="#l3.922"></a><span id="l3.922" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager, &amp;rv);</span>
<a href="#l3.923"></a><span id="l3.923" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.924"></a><span id="l3.924" class="difflineminus">-</span>
<a href="#l3.925"></a><span id="l3.925" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccount&gt; defaultAccount;</span>
<a href="#l3.926"></a><span id="l3.926" class="difflineminus">-  rv = am-&gt;GetDefaultAccount(getter_AddRefs(defaultAccount));</span>
<a href="#l3.927"></a><span id="l3.927" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.928"></a><span id="l3.928" class="difflineminus">-  if (!defaultAccount) return false;</span>
<a href="#l3.929"></a><span id="l3.929" class="difflineminus">-</span>
<a href="#l3.930"></a><span id="l3.930" class="difflineminus">-  // in some weird case that there is no default and they asked</span>
<a href="#l3.931"></a><span id="l3.931" class="difflineminus">-  // for the default</span>
<a href="#l3.932"></a><span id="l3.932" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; defaultServer;</span>
<a href="#l3.933"></a><span id="l3.933" class="difflineminus">-  rv = defaultAccount-&gt;GetIncomingServer(getter_AddRefs(defaultServer));</span>
<a href="#l3.934"></a><span id="l3.934" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.935"></a><span id="l3.935" class="difflineminus">-  if (!defaultServer) return false;</span>
<a href="#l3.936"></a><span id="l3.936" class="difflineminus">-</span>
<a href="#l3.937"></a><span id="l3.937" class="difflineminus">-  bool isEqual;</span>
<a href="#l3.938"></a><span id="l3.938" class="difflineminus">-  rv = defaultServer-&gt;Equals(aServer, &amp;isEqual);</span>
<a href="#l3.939"></a><span id="l3.939" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.940"></a><span id="l3.940" class="difflineminus">-</span>
<a href="#l3.941"></a><span id="l3.941" class="difflineminus">-  return isEqual;</span>
<a href="#l3.942"></a><span id="l3.942" class="difflineminus">-}</span>
<a href="#l3.943"></a><span id="l3.943" class="difflineminus">-</span>
<a href="#l3.944"></a><span id="l3.944" class="difflineminus">-</span>
<a href="#l3.945"></a><span id="l3.945" class="difflineminus">-bool</span>
<a href="#l3.946"></a><span id="l3.946" class="difflineminus">-nsMsgAccountManagerDataSource::supportsFilters(nsIMsgIncomingServer *aServer)</span>
<a href="#l3.947"></a><span id="l3.947" class="difflineminus">-{</span>
<a href="#l3.948"></a><span id="l3.948" class="difflineminus">-  bool supportsFilters;</span>
<a href="#l3.949"></a><span id="l3.949" class="difflineminus">-  nsresult rv = aServer-&gt;GetCanHaveFilters(&amp;supportsFilters);</span>
<a href="#l3.950"></a><span id="l3.950" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.951"></a><span id="l3.951" class="difflineminus">-</span>
<a href="#l3.952"></a><span id="l3.952" class="difflineminus">-  return supportsFilters;</span>
<a href="#l3.953"></a><span id="l3.953" class="difflineminus">-}</span>
<a href="#l3.954"></a><span id="l3.954" class="difflineminus">-</span>
<a href="#l3.955"></a><span id="l3.955" class="difflineminus">-bool</span>
<a href="#l3.956"></a><span id="l3.956" class="difflineminus">-nsMsgAccountManagerDataSource::canGetMessages(nsIMsgIncomingServer *aServer)</span>
<a href="#l3.957"></a><span id="l3.957" class="difflineminus">-{</span>
<a href="#l3.958"></a><span id="l3.958" class="difflineminus">-  nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo;</span>
<a href="#l3.959"></a><span id="l3.959" class="difflineminus">-  nsresult rv = aServer-&gt;GetProtocolInfo(getter_AddRefs(protocolInfo));</span>
<a href="#l3.960"></a><span id="l3.960" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.961"></a><span id="l3.961" class="difflineminus">-</span>
<a href="#l3.962"></a><span id="l3.962" class="difflineminus">-  bool canGetMessages;</span>
<a href="#l3.963"></a><span id="l3.963" class="difflineminus">-  rv = protocolInfo-&gt;GetCanGetMessages(&amp;canGetMessages);</span>
<a href="#l3.964"></a><span id="l3.964" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.965"></a><span id="l3.965" class="difflineminus">-</span>
<a href="#l3.966"></a><span id="l3.966" class="difflineminus">-  return canGetMessages;</span>
<a href="#l3.967"></a><span id="l3.967" class="difflineminus">-}</span>
<a href="#l3.968"></a><span id="l3.968" class="difflineminus">-</span>
<a href="#l3.969"></a><span id="l3.969" class="difflineminus">-bool</span>
<a href="#l3.970"></a><span id="l3.970" class="difflineminus">-nsMsgAccountManagerDataSource::canGetIncomingMessages(nsIMsgIncomingServer *aServer)</span>
<a href="#l3.971"></a><span id="l3.971" class="difflineminus">-{</span>
<a href="#l3.972"></a><span id="l3.972" class="difflineminus">-  nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo;</span>
<a href="#l3.973"></a><span id="l3.973" class="difflineminus">-  nsresult rv = aServer-&gt;GetProtocolInfo(getter_AddRefs(protocolInfo));</span>
<a href="#l3.974"></a><span id="l3.974" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.975"></a><span id="l3.975" class="difflineminus">-</span>
<a href="#l3.976"></a><span id="l3.976" class="difflineminus">-  bool canGetIncomingMessages;</span>
<a href="#l3.977"></a><span id="l3.977" class="difflineminus">-  rv = protocolInfo-&gt;GetCanGetIncomingMessages(&amp;canGetIncomingMessages);</span>
<a href="#l3.978"></a><span id="l3.978" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l3.979"></a><span id="l3.979" class="difflineminus">-</span>
<a href="#l3.980"></a><span id="l3.980" class="difflineminus">-  return canGetIncomingMessages;</span>
<a href="#l3.981"></a><span id="l3.981" class="difflineminus">-}</span>
<a href="#l3.982"></a><span id="l3.982" class="difflineminus">-</span>
<a href="#l3.983"></a><span id="l3.983" class="difflineminus">-nsresult</span>
<a href="#l3.984"></a><span id="l3.984" class="difflineminus">-nsMsgAccountManagerDataSource::HasAssertionAccountRoot(nsIRDFResource *aProperty,</span>
<a href="#l3.985"></a><span id="l3.985" class="difflineminus">-                                                       nsIRDFNode *aTarget,</span>
<a href="#l3.986"></a><span id="l3.986" class="difflineminus">-                                                       bool aTruthValue,</span>
<a href="#l3.987"></a><span id="l3.987" class="difflineminus">-                                                       bool *_retval)</span>
<a href="#l3.988"></a><span id="l3.988" class="difflineminus">-{</span>
<a href="#l3.989"></a><span id="l3.989" class="difflineminus">-  // set up default</span>
<a href="#l3.990"></a><span id="l3.990" class="difflineminus">-  *_retval = false;</span>
<a href="#l3.991"></a><span id="l3.991" class="difflineminus">-</span>
<a href="#l3.992"></a><span id="l3.992" class="difflineminus">-  // for child and settings arcs, just make sure it's a valid server:</span>
<a href="#l3.993"></a><span id="l3.993" class="difflineminus">-  if (isContainment(aProperty)) {</span>
<a href="#l3.994"></a><span id="l3.994" class="difflineminus">-</span>
<a href="#l3.995"></a><span id="l3.995" class="difflineminus">-    nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l3.996"></a><span id="l3.996" class="difflineminus">-    nsresult rv = getServerForFolderNode(aTarget, getter_AddRefs(server));</span>
<a href="#l3.997"></a><span id="l3.997" class="difflineminus">-    if (NS_FAILED(rv) || !server) return rv;</span>
<a href="#l3.998"></a><span id="l3.998" class="difflineminus">-</span>
<a href="#l3.999"></a><span id="l3.999" class="difflineminus">-    nsCString serverKey;</span>
<a href="#l3.1000"></a><span id="l3.1000" class="difflineminus">-    server-&gt;GetKey(serverKey);</span>
<a href="#l3.1001"></a><span id="l3.1001" class="difflineminus">-</span>
<a href="#l3.1002"></a><span id="l3.1002" class="difflineminus">-    nsCOMPtr&lt;nsIMsgAccountManager&gt; am = do_QueryReferent(mAccountManager, &amp;rv);</span>
<a href="#l3.1003"></a><span id="l3.1003" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.1004"></a><span id="l3.1004" class="difflineminus">-</span>
<a href="#l3.1005"></a><span id="l3.1005" class="difflineminus">-    nsCOMPtr&lt;nsIArray&gt; serverArray;</span>
<a href="#l3.1006"></a><span id="l3.1006" class="difflineminus">-    rv = am-&gt;GetAllServers(getter_AddRefs(serverArray));</span>
<a href="#l3.1007"></a><span id="l3.1007" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.1008"></a><span id="l3.1008" class="difflineminus">-</span>
<a href="#l3.1009"></a><span id="l3.1009" class="difflineminus">-    uint32_t length;</span>
<a href="#l3.1010"></a><span id="l3.1010" class="difflineminus">-    rv = serverArray-&gt;GetLength(&amp;length);</span>
<a href="#l3.1011"></a><span id="l3.1011" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.1012"></a><span id="l3.1012" class="difflineminus">-</span>
<a href="#l3.1013"></a><span id="l3.1013" class="difflineminus">-    for (uint32_t i = 0; i &lt; length; ++i)</span>
<a href="#l3.1014"></a><span id="l3.1014" class="difflineminus">-    {</span>
<a href="#l3.1015"></a><span id="l3.1015" class="difflineminus">-      nsCOMPtr&lt;nsIMsgIncomingServer&gt; server(do_QueryElementAt(serverArray, i, &amp;rv));</span>
<a href="#l3.1016"></a><span id="l3.1016" class="difflineminus">-      if (NS_FAILED(rv))</span>
<a href="#l3.1017"></a><span id="l3.1017" class="difflineminus">-        continue;</span>
<a href="#l3.1018"></a><span id="l3.1018" class="difflineminus">-</span>
<a href="#l3.1019"></a><span id="l3.1019" class="difflineminus">-      nsCString key;</span>
<a href="#l3.1020"></a><span id="l3.1020" class="difflineminus">-      server-&gt;GetKey(key);</span>
<a href="#l3.1021"></a><span id="l3.1021" class="difflineminus">-      if (key.Equals(serverKey))</span>
<a href="#l3.1022"></a><span id="l3.1022" class="difflineminus">-      {</span>
<a href="#l3.1023"></a><span id="l3.1023" class="difflineminus">-        *_retval = true;</span>
<a href="#l3.1024"></a><span id="l3.1024" class="difflineminus">-        break;</span>
<a href="#l3.1025"></a><span id="l3.1025" class="difflineminus">-      }</span>
<a href="#l3.1026"></a><span id="l3.1026" class="difflineminus">-    }</span>
<a href="#l3.1027"></a><span id="l3.1027" class="difflineminus">-  }</span>
<a href="#l3.1028"></a><span id="l3.1028" class="difflineminus">-</span>
<a href="#l3.1029"></a><span id="l3.1029" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1030"></a><span id="l3.1030" class="difflineminus">-}</span>
<a href="#l3.1031"></a><span id="l3.1031" class="difflineminus">-</span>
<a href="#l3.1032"></a><span id="l3.1032" class="difflineminus">-bool</span>
<a href="#l3.1033"></a><span id="l3.1033" class="difflineminus">-nsMsgAccountManagerDataSource::isContainment(nsIRDFResource *aProperty)</span>
<a href="#l3.1034"></a><span id="l3.1034" class="difflineminus">-{</span>
<a href="#l3.1035"></a><span id="l3.1035" class="difflineminus">-</span>
<a href="#l3.1036"></a><span id="l3.1036" class="difflineminus">-  if (aProperty == kNC_Child ||</span>
<a href="#l3.1037"></a><span id="l3.1037" class="difflineminus">-      aProperty == kNC_Settings)</span>
<a href="#l3.1038"></a><span id="l3.1038" class="difflineminus">-    return true;</span>
<a href="#l3.1039"></a><span id="l3.1039" class="difflineminus">-  return false;</span>
<a href="#l3.1040"></a><span id="l3.1040" class="difflineminus">-}</span>
<a href="#l3.1041"></a><span id="l3.1041" class="difflineminus">-</span>
<a href="#l3.1042"></a><span id="l3.1042" class="difflineminus">-// returns failure if the object is not a root server</span>
<a href="#l3.1043"></a><span id="l3.1043" class="difflineminus">-nsresult</span>
<a href="#l3.1044"></a><span id="l3.1044" class="difflineminus">-nsMsgAccountManagerDataSource::getServerForFolderNode(nsIRDFNode *aResource,</span>
<a href="#l3.1045"></a><span id="l3.1045" class="difflineminus">-                                                      nsIMsgIncomingServer **aResult)</span>
<a href="#l3.1046"></a><span id="l3.1046" class="difflineminus">-{</span>
<a href="#l3.1047"></a><span id="l3.1047" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.1048"></a><span id="l3.1048" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryInterface(aResource, &amp;rv);</span>
<a href="#l3.1049"></a><span id="l3.1049" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l3.1050"></a><span id="l3.1050" class="difflineminus">-  {</span>
<a href="#l3.1051"></a><span id="l3.1051" class="difflineminus">-    bool isServer;</span>
<a href="#l3.1052"></a><span id="l3.1052" class="difflineminus">-    rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l3.1053"></a><span id="l3.1053" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; isServer)</span>
<a href="#l3.1054"></a><span id="l3.1054" class="difflineminus">-      return folder-&gt;GetServer(aResult);</span>
<a href="#l3.1055"></a><span id="l3.1055" class="difflineminus">-  }</span>
<a href="#l3.1056"></a><span id="l3.1056" class="difflineminus">-  return NS_ERROR_FAILURE;</span>
<a href="#l3.1057"></a><span id="l3.1057" class="difflineminus">-}</span>
<a href="#l3.1058"></a><span id="l3.1058" class="difflineminus">-</span>
<a href="#l3.1059"></a><span id="l3.1059" class="difflineminus">-nsresult</span>
<a href="#l3.1060"></a><span id="l3.1060" class="difflineminus">-nsMsgAccountManagerDataSource::getStringBundle()</span>
<a href="#l3.1061"></a><span id="l3.1061" class="difflineminus">-{</span>
<a href="#l3.1062"></a><span id="l3.1062" class="difflineminus">-  if (mStringBundle) return NS_OK;</span>
<a href="#l3.1063"></a><span id="l3.1063" class="difflineminus">-</span>
<a href="#l3.1064"></a><span id="l3.1064" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; strBundleService =</span>
<a href="#l3.1065"></a><span id="l3.1065" class="difflineminus">-    mozilla::services::GetStringBundleService();</span>
<a href="#l3.1066"></a><span id="l3.1066" class="difflineminus">-  NS_ENSURE_TRUE(strBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l3.1067"></a><span id="l3.1067" class="difflineminus">-</span>
<a href="#l3.1068"></a><span id="l3.1068" class="difflineminus">-  return strBundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/prefs.properties&quot;,</span>
<a href="#l3.1069"></a><span id="l3.1069" class="difflineminus">-                                      getter_AddRefs(mStringBundle));</span>
<a href="#l3.1070"></a><span id="l3.1070" class="difflineminus">-}</span>
<a href="#l3.1071"></a><span id="l3.1071" class="difflineminus">-</span>
<a href="#l3.1072"></a><span id="l3.1072" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.1073"></a><span id="l3.1073" class="difflineminus">-nsMsgAccountManagerDataSource::OnServerLoaded(nsIMsgIncomingServer* aServer)</span>
<a href="#l3.1074"></a><span id="l3.1074" class="difflineminus">-{</span>
<a href="#l3.1075"></a><span id="l3.1075" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; serverFolder;</span>
<a href="#l3.1076"></a><span id="l3.1076" class="difflineminus">-  nsresult rv = aServer-&gt;GetRootFolder(getter_AddRefs(serverFolder));</span>
<a href="#l3.1077"></a><span id="l3.1077" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.1078"></a><span id="l3.1078" class="difflineminus">-</span>
<a href="#l3.1079"></a><span id="l3.1079" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; serverResource = do_QueryInterface(serverFolder,&amp;rv);</span>
<a href="#l3.1080"></a><span id="l3.1080" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.1081"></a><span id="l3.1081" class="difflineminus">-</span>
<a href="#l3.1082"></a><span id="l3.1082" class="difflineminus">-  NotifyObservers(kNC_AccountRoot, kNC_Child, serverResource, nullptr, true, false);</span>
<a href="#l3.1083"></a><span id="l3.1083" class="difflineminus">-  NotifyObservers(kNC_AccountRoot, kNC_Settings, serverResource, nullptr, true, false);</span>
<a href="#l3.1084"></a><span id="l3.1084" class="difflineminus">-</span>
<a href="#l3.1085"></a><span id="l3.1085" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1086"></a><span id="l3.1086" class="difflineminus">-}</span>
<a href="#l3.1087"></a><span id="l3.1087" class="difflineminus">-</span>
<a href="#l3.1088"></a><span id="l3.1088" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.1089"></a><span id="l3.1089" class="difflineminus">-nsMsgAccountManagerDataSource::OnServerUnloaded(nsIMsgIncomingServer* aServer)</span>
<a href="#l3.1090"></a><span id="l3.1090" class="difflineminus">-{</span>
<a href="#l3.1091"></a><span id="l3.1091" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; serverFolder;</span>
<a href="#l3.1092"></a><span id="l3.1092" class="difflineminus">-  nsresult rv = aServer-&gt;GetRootFolder(getter_AddRefs(serverFolder));</span>
<a href="#l3.1093"></a><span id="l3.1093" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.1094"></a><span id="l3.1094" class="difflineminus">-</span>
<a href="#l3.1095"></a><span id="l3.1095" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; serverResource = do_QueryInterface(serverFolder,&amp;rv);</span>
<a href="#l3.1096"></a><span id="l3.1096" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l3.1097"></a><span id="l3.1097" class="difflineminus">-</span>
<a href="#l3.1098"></a><span id="l3.1098" class="difflineminus">-</span>
<a href="#l3.1099"></a><span id="l3.1099" class="difflineminus">-  NotifyObservers(kNC_AccountRoot, kNC_Child, serverResource, nullptr, false, false);</span>
<a href="#l3.1100"></a><span id="l3.1100" class="difflineminus">-  NotifyObservers(kNC_AccountRoot, kNC_Settings, serverResource, nullptr, false, false);</span>
<a href="#l3.1101"></a><span id="l3.1101" class="difflineminus">-</span>
<a href="#l3.1102"></a><span id="l3.1102" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1103"></a><span id="l3.1103" class="difflineminus">-}</span>
<a href="#l3.1104"></a><span id="l3.1104" class="difflineminus">-</span>
<a href="#l3.1105"></a><span id="l3.1105" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.1106"></a><span id="l3.1106" class="difflineminus">-nsMsgAccountManagerDataSource::OnServerChanged(nsIMsgIncomingServer *server)</span>
<a href="#l3.1107"></a><span id="l3.1107" class="difflineminus">-{</span>
<a href="#l3.1108"></a><span id="l3.1108" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1109"></a><span id="l3.1109" class="difflineminus">-}</span>
<a href="#l3.1110"></a><span id="l3.1110" class="difflineminus">-</span>
<a href="#l3.1111"></a><span id="l3.1111" class="difflineminus">-nsresult</span>
<a href="#l3.1112"></a><span id="l3.1112" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemPropertyChanged(nsIMsgFolder *, const nsACString &amp;, char const *, char const *)</span>
<a href="#l3.1113"></a><span id="l3.1113" class="difflineminus">-{</span>
<a href="#l3.1114"></a><span id="l3.1114" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1115"></a><span id="l3.1115" class="difflineminus">-}</span>
<a href="#l3.1116"></a><span id="l3.1116" class="difflineminus">-</span>
<a href="#l3.1117"></a><span id="l3.1117" class="difflineminus">-nsresult</span>
<a href="#l3.1118"></a><span id="l3.1118" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *, const nsACString &amp;, const char16_t *, const char16_t *)</span>
<a href="#l3.1119"></a><span id="l3.1119" class="difflineminus">-{</span>
<a href="#l3.1120"></a><span id="l3.1120" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1121"></a><span id="l3.1121" class="difflineminus">-}</span>
<a href="#l3.1122"></a><span id="l3.1122" class="difflineminus">-</span>
<a href="#l3.1123"></a><span id="l3.1123" class="difflineminus">-nsresult</span>
<a href="#l3.1124"></a><span id="l3.1124" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemRemoved(nsIMsgFolder *, nsISupports *)</span>
<a href="#l3.1125"></a><span id="l3.1125" class="difflineminus">-{</span>
<a href="#l3.1126"></a><span id="l3.1126" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1127"></a><span id="l3.1127" class="difflineminus">-}</span>
<a href="#l3.1128"></a><span id="l3.1128" class="difflineminus">-</span>
<a href="#l3.1129"></a><span id="l3.1129" class="difflineminus">-nsresult</span>
<a href="#l3.1130"></a><span id="l3.1130" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemPropertyFlagChanged(nsIMsgDBHdr *, const nsACString &amp;, uint32_t, uint32_t)</span>
<a href="#l3.1131"></a><span id="l3.1131" class="difflineminus">-{</span>
<a href="#l3.1132"></a><span id="l3.1132" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1133"></a><span id="l3.1133" class="difflineminus">-}</span>
<a href="#l3.1134"></a><span id="l3.1134" class="difflineminus">-</span>
<a href="#l3.1135"></a><span id="l3.1135" class="difflineminus">-nsresult</span>
<a href="#l3.1136"></a><span id="l3.1136" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemAdded(nsIMsgFolder *, nsISupports *)</span>
<a href="#l3.1137"></a><span id="l3.1137" class="difflineminus">-{</span>
<a href="#l3.1138"></a><span id="l3.1138" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1139"></a><span id="l3.1139" class="difflineminus">-}</span>
<a href="#l3.1140"></a><span id="l3.1140" class="difflineminus">-</span>
<a href="#l3.1141"></a><span id="l3.1141" class="difflineminus">-</span>
<a href="#l3.1142"></a><span id="l3.1142" class="difflineminus">-nsresult</span>
<a href="#l3.1143"></a><span id="l3.1143" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemBoolPropertyChanged(nsIMsgFolder *aItem,</span>
<a href="#l3.1144"></a><span id="l3.1144" class="difflineminus">-                                                         const nsACString &amp;aProperty,</span>
<a href="#l3.1145"></a><span id="l3.1145" class="difflineminus">-                                                         bool aOldValue,</span>
<a href="#l3.1146"></a><span id="l3.1146" class="difflineminus">-                                                         bool aNewValue)</span>
<a href="#l3.1147"></a><span id="l3.1147" class="difflineminus">-{</span>
<a href="#l3.1148"></a><span id="l3.1148" class="difflineminus">-  if (aProperty.Equals(kDefaultServer)) {</span>
<a href="#l3.1149"></a><span id="l3.1149" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(aItem));</span>
<a href="#l3.1150"></a><span id="l3.1150" class="difflineminus">-    NotifyObservers(resource, kNC_IsDefaultServer, kTrueLiteral, nullptr, aNewValue, false);</span>
<a href="#l3.1151"></a><span id="l3.1151" class="difflineminus">-  }</span>
<a href="#l3.1152"></a><span id="l3.1152" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1153"></a><span id="l3.1153" class="difflineminus">-}</span>
<a href="#l3.1154"></a><span id="l3.1154" class="difflineminus">-</span>
<a href="#l3.1155"></a><span id="l3.1155" class="difflineminus">-nsresult</span>
<a href="#l3.1156"></a><span id="l3.1156" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemEvent(nsIMsgFolder *, const nsACString &amp;)</span>
<a href="#l3.1157"></a><span id="l3.1157" class="difflineminus">-{</span>
<a href="#l3.1158"></a><span id="l3.1158" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1159"></a><span id="l3.1159" class="difflineminus">-}</span>
<a href="#l3.1160"></a><span id="l3.1160" class="difflineminus">-</span>
<a href="#l3.1161"></a><span id="l3.1161" class="difflineminus">-nsresult</span>
<a href="#l3.1162"></a><span id="l3.1162" class="difflineminus">-nsMsgAccountManagerDataSource::OnItemIntPropertyChanged(nsIMsgFolder *, const nsACString &amp;, int64_t, int64_t)</span>
<a href="#l3.1163"></a><span id="l3.1163" class="difflineminus">-{</span>
<a href="#l3.1164"></a><span id="l3.1164" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1165"></a><span id="l3.1165" class="difflineminus">-}</span>
<a href="#l3.1166"></a><span id="l3.1166" class="difflineminus">-</span>
<a href="#l3.1167"></a><span id="l3.1167" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l3.1168"></a><span id="l3.1168" class="difflineminus">-nsMsgAccountManagerDataSource::Observe(nsISupports *aSubject, const char *aTopic, const char16_t *aData)</span>
<a href="#l3.1169"></a><span id="l3.1169" class="difflineminus">-{</span>
<a href="#l3.1170"></a><span id="l3.1170" class="difflineminus">-  nsMsgRDFDataSource::Observe(aSubject, aTopic, aData);</span>
<a href="#l3.1171"></a><span id="l3.1171" class="difflineminus">-</span>
<a href="#l3.1172"></a><span id="l3.1172" class="difflineminus">-  return NS_OK;</span>
<a href="#l3.1173"></a><span id="l3.1173" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">deleted file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManagerDS.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ /dev/null</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -1,140 +0,0 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">-</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-#ifndef __nsMsgAccountManagerDS_h</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">-#define __nsMsgAccountManagerDS_h</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-#include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-#include &quot;nscore.h&quot;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-#include &quot;nsError.h&quot;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-#include &quot;nsIID.h&quot;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-#include &quot;nsIStringBundle.h&quot;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-#include &quot;nsMsgRDFDataSource.h&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-#include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-#include &quot;nsIIncomingServerListener.h&quot;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-#include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-#include &quot;nsWeakPtr.h&quot;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-#include &quot;nsCOMArray.h&quot;</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-/* {3f989ca4-f77a-11d2-969d-006008948010} */</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-#define NS_MSGACCOUNTMANAGERDATASOURCE_CID \</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-  {0x3f989ca4, 0xf77a, 0x11d2, \</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    {0x96, 0x9d, 0x00, 0x60, 0x08, 0x94, 0x80, 0x10}}</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-class nsMsgAccountManagerDataSource : public nsMsgRDFDataSource,</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-                                      public nsIFolderListener,</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-                                      public nsIIncomingServerListener</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-{</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-public:</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-  nsMsgAccountManagerDataSource();</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-  virtual nsresult Init() override;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-  virtual void Cleanup() override;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-  // service manager shutdown method</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-  NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-  NS_DECL_NSIFOLDERLISTENER</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-  NS_DECL_NSIINCOMINGSERVERLISTENER</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-  NS_DECL_NSIOBSERVER</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-  // RDF datasource methods</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-  NS_IMETHOD GetTarget(nsIRDFResource *source,</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-                       nsIRDFResource *property,</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-                       bool aTruthValue,</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-                       nsIRDFNode **_retval) override;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-  NS_IMETHOD GetTargets(nsIRDFResource *source,</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-                        nsIRDFResource *property,</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-                        bool aTruthValue,</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-                        nsISimpleEnumerator **_retval) override;</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-  NS_IMETHOD ArcLabelsOut(nsIRDFResource *source,</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-                          nsISimpleEnumerator **_retval) override;</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-  NS_IMETHOD HasAssertion(nsIRDFResource *aSource, nsIRDFResource *aProperty,</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-                          nsIRDFNode *aTarget, bool aTruthValue,</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-                          bool *_retval) override;</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-  NS_IMETHOD HasArcOut(nsIRDFResource *source, nsIRDFResource *aArc,</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-                       bool *result) override;</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-protected:</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-  virtual ~nsMsgAccountManagerDataSource();</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-  nsresult HasAssertionServer(nsIMsgIncomingServer *aServer,</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-                              nsIRDFResource *aProperty,</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-                              nsIRDFNode *aTarget,</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-                              bool aTruthValue, bool *_retval);</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-  nsresult HasAssertionAccountRoot(nsIRDFResource *aProperty,</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-                                   nsIRDFNode *aTarget,</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-                                   bool aTruthValue, bool *_retval);</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-  bool isDefaultServer(nsIMsgIncomingServer *aServer);</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-  bool supportsFilters(nsIMsgIncomingServer *aServer);</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-  bool canGetMessages(nsIMsgIncomingServer *aServer);</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-  bool canGetIncomingMessages(nsIMsgIncomingServer *aServer);</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-  static bool isContainment(nsIRDFResource *aProperty);</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-  nsresult getServerForFolderNode(nsIRDFNode *aResource,</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineminus">-                                  nsIMsgIncomingServer **aResult);</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineminus">-</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineminus">-  nsresult createRootResources(nsIRDFResource *aProperty,</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-                               nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-  nsresult createSettingsResources(nsIRDFResource *aSource,</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineminus">-                                   nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-  nsresult appendGenericSettingsResources(nsIMsgIncomingServer *server,\</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-                                          nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-  nsresult appendGenericSetting(const char *name,</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-                                nsCOMArray&lt;nsIRDFResource&gt; *aNodeArray);</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-  static nsIRDFResource* kNC_Name;</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineminus">-  static nsIRDFResource* kNC_FolderTreeName;</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-  static nsIRDFResource* kNC_FolderTreeSimpleName;</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineminus">-  static nsIRDFResource* kNC_NameSort;</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-  static nsIRDFResource* kNC_FolderTreeNameSort;</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-  static nsIRDFResource* kNC_PageTag;</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-  static nsIRDFResource* kNC_IsDefaultServer;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-  static nsIRDFResource* kNC_SupportsFilters;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-  static nsIRDFResource* kNC_CanGetMessages;</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-  static nsIRDFResource* kNC_CanGetIncomingMessages;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-  static nsIRDFResource* kNC_Child;</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-  static nsIRDFResource* kNC_AccountRoot;</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-  static nsIRDFResource* kNC_Account;</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-  static nsIRDFResource* kNC_Server;</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-  static nsIRDFResource* kNC_Identity;</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-  static nsIRDFResource* kNC_Settings;</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-  static nsIRDFResource* kNC_Junk;</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleMain;</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleServer;</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleCopies;</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleSynchronization;</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleDiskSpace;</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleAddressing;</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleSMTP;</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-  static nsIRDFResource* kNC_PageTitleJunk;</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-  static nsIRDFLiteral* kTrueLiteral;</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-  static nsrefcnt gAccountManagerResourceRefCnt;</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-  static nsresult getAccountArcs(nsIMutableArray **aResult);</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-  static nsresult getAccountRootArcs(nsIMutableArray **aResult);</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-private:</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-  nsresult serverHasIdentities(nsIMsgIncomingServer *aServer, bool *aResult);</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-  nsresult getStringBundle();</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-  static nsCOMPtr&lt;nsIMutableArray&gt; mAccountArcsOut;</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-  static nsCOMPtr&lt;nsIMutableArray&gt; mAccountRootArcsOut;</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-  nsWeakPtr mAccountManager;</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; mStringBundle;</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-};</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-#endif /* __nsMsgAccountManagerDS_h */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">deleted file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ /dev/null</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -1,2414 +0,0 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">-#include &quot;msgCore.h&quot;    // precompiled header...</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">-#include &quot;prlog.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#include &quot;prmem.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-#include &quot;nsMsgFolderDataSource.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-#include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-#include &quot;nsMsgRDFUtils.h&quot;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-#include &quot;rdf.h&quot;</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-#include &quot;nsIRDFService.h&quot;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-#include &quot;nsRDFCID.h&quot;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-#include &quot;nsIRDFNode.h&quot;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">-#include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">-</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-#include &quot;nsCOMPtr.h&quot;</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-#include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-#include &quot;nsIMsgCopyService.h&quot;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-#include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-#include &quot;nsIInputStream.h&quot;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-#include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-#include &quot;nsTraceRefcnt.h&quot;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-#include &quot;nsIMsgFolder.h&quot; // TO include biffState enum. Change to bool later...</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-#include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-#include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-#include &quot;nsINntpIncomingServer.h&quot;</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-#include &quot;nsTextFormatter.h&quot;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-#include &quot;nsIStringBundle.h&quot;</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-#include &quot;nsIPrompt.h&quot;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-#include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-#include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-#include &quot;nsArrayUtils.h&quot;</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineminus">-#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-#include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-#include &quot;nsMemory.h&quot;</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineminus">-#include &quot;nsMsgUtils.h&quot;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-#include &quot;mozilla/Services.h&quot;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-#define MESSENGER_STRING_URL       &quot;chrome://messenger/locale/messenger.properties&quot;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Child = nullptr;</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Folder= nullptr;</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Name= nullptr;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Open = nullptr;</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_FolderTreeName= nullptr;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_FolderTreeSimpleName= nullptr;</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_NameSort= nullptr;</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_FolderTreeNameSort= nullptr;</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_SpecialFolder= nullptr;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_ServerType = nullptr;</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_IsDeferred = nullptr;</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanCreateFoldersOnServer = nullptr;</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanFileMessagesOnServer = nullptr;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_IsServer = nullptr;</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_IsSecure = nullptr;</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanSubscribe = nullptr;</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_SupportsOffline = nullptr;</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanFileMessages = nullptr;</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanCreateSubfolders = nullptr;</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanRename = nullptr;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanCompact = nullptr;</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_TotalMessages= nullptr;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_TotalUnreadMessages= nullptr;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_FolderSize = nullptr;</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Charset = nullptr;</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_BiffState = nullptr;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_HasUnreadMessages = nullptr;</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_NewMessages = nullptr;</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_SubfoldersHaveUnreadMessages = nullptr;</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_NoSelect = nullptr;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_VirtualFolder = nullptr;</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_InVFEditSearchScope = nullptr;</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_ImapShared = nullptr;</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Synchronize = nullptr;</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_SyncDisabled = nullptr;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CanSearchMessages = nullptr;</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_UnreadFolders = nullptr;</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_FavoriteFolders = nullptr;</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_RecentFolders = nullptr;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineminus">-</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-// commands</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Delete= nullptr;</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_ReallyDelete= nullptr;</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_NewFolder= nullptr;</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_GetNewMessages= nullptr;</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Copy= nullptr;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Move= nullptr;</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CopyFolder= nullptr;</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_MoveFolder= nullptr;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_MarkAllMessagesRead= nullptr;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Compact= nullptr;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_CompactAll= nullptr;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_Rename= nullptr;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-nsIRDFResource* nsMsgFolderDataSource::kNC_EmptyTrash= nullptr;</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-nsrefcnt nsMsgFolderDataSource::gFolderResourceRefCnt = 0;</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineminus">-</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-static const uint32_t kDisplayBlankCount = 0xFFFFFFFE;</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineminus">-static const uint32_t kDisplayQuestionCount = 0xFFFFFFFF;</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineminus">-static const int64_t kDisplayBlankCount64 = -2;</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-static const int64_t kDisplayQuestionCount64 = -1;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-nsMsgFolderDataSource::nsMsgFolderDataSource()</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-{</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-  // one-time initialization here</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineminus">-  nsIRDFService* rdf = getRDFService();</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineminus">-</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineminus">-  if (gFolderResourceRefCnt++ == 0) {</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-    nsCOMPtr&lt;nsIStringBundle&gt; sMessengerStringBundle;</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineminus">-</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CHILD),   &amp;kNC_Child);</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDER),  &amp;kNC_Folder);</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NAME),    &amp;kNC_Name);</span>
<a href="#l5.126"></a><span id="l5.126" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_OPEN),    &amp;kNC_Open);</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERTREENAME),    &amp;kNC_FolderTreeName);</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(&quot;mailnewsunreadfolders:/&quot;),    &amp;kNC_UnreadFolders);</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(&quot;mailnewsfavefolders:/&quot;),    &amp;kNC_FavoriteFolders);</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(&quot;mailnewsrecentfolders:/&quot;),    &amp;kNC_RecentFolders);</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERTREESIMPLENAME),    &amp;kNC_FolderTreeSimpleName);</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NAME_SORT),    &amp;kNC_NameSort);</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERTREENAME_SORT),    &amp;kNC_FolderTreeNameSort);</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SPECIALFOLDER), &amp;kNC_SpecialFolder);</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SERVERTYPE), &amp;kNC_ServerType);</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_ISDEFERRED),&amp;kNC_IsDeferred);</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANCREATEFOLDERSONSERVER), &amp;kNC_CanCreateFoldersOnServer);</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANFILEMESSAGESONSERVER), &amp;kNC_CanFileMessagesOnServer);</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_ISSERVER), &amp;kNC_IsServer);</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_ISSECURE), &amp;kNC_IsSecure);</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANSUBSCRIBE), &amp;kNC_CanSubscribe);</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SUPPORTSOFFLINE), &amp;kNC_SupportsOffline);</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANFILEMESSAGES), &amp;kNC_CanFileMessages);</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANCREATESUBFOLDERS), &amp;kNC_CanCreateSubfolders);</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANRENAME), &amp;kNC_CanRename);</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANCOMPACT), &amp;kNC_CanCompact);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_TOTALMESSAGES), &amp;kNC_TotalMessages);</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_TOTALUNREADMESSAGES), &amp;kNC_TotalUnreadMessages);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_FOLDERSIZE), &amp;kNC_FolderSize);</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CHARSET), &amp;kNC_Charset);</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_BIFFSTATE), &amp;kNC_BiffState);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_HASUNREADMESSAGES), &amp;kNC_HasUnreadMessages);</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NEWMESSAGES), &amp;kNC_NewMessages);</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SUBFOLDERSHAVEUNREADMESSAGES), &amp;kNC_SubfoldersHaveUnreadMessages);</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NOSELECT), &amp;kNC_NoSelect);</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_VIRTUALFOLDER), &amp;kNC_VirtualFolder);</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_INVFEDITSEARCHSCOPE), &amp;kNC_InVFEditSearchScope);</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_IMAPSHARED), &amp;kNC_ImapShared);</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SYNCHRONIZE), &amp;kNC_Synchronize);</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_SYNCDISABLED), &amp;kNC_SyncDisabled);</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_CANSEARCHMESSAGES), &amp;kNC_CanSearchMessages);</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineminus">-</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_DELETE), &amp;kNC_Delete);</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_REALLY_DELETE), &amp;kNC_ReallyDelete);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_NEWFOLDER), &amp;kNC_NewFolder);</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_GETNEWMESSAGES), &amp;kNC_GetNewMessages);</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COPY), &amp;kNC_Copy);</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MOVE), &amp;kNC_Move);</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COPYFOLDER), &amp;kNC_CopyFolder);</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MOVEFOLDER), &amp;kNC_MoveFolder);</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_MARKALLMESSAGESREAD),</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineminus">-                             &amp;kNC_MarkAllMessagesRead);</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACT), &amp;kNC_Compact);</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_COMPACTALL), &amp;kNC_CompactAll);</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_RENAME), &amp;kNC_Rename);</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineminus">-    rdf-&gt;GetResource(NS_LITERAL_CSTRING(NC_RDF_EMPTYTRASH), &amp;kNC_EmptyTrash);</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineminus">-  }</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineminus">-</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-  CreateLiterals(rdf);</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineminus">-  CreateArcsOutEnumerator();</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineminus">-}</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineminus">-</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineminus">-nsMsgFolderDataSource::~nsMsgFolderDataSource (void)</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineminus">-{</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineminus">-  if (--gFolderResourceRefCnt == 0)</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineminus">-  {</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineminus">-    nsrefcnt refcnt;</span>
<a href="#l5.189"></a><span id="l5.189" class="difflineminus">-    NS_RELEASE2(kNC_Child, refcnt);</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineminus">-    NS_RELEASE2(kNC_Folder, refcnt);</span>
<a href="#l5.191"></a><span id="l5.191" class="difflineminus">-    NS_RELEASE2(kNC_Name, refcnt);</span>
<a href="#l5.192"></a><span id="l5.192" class="difflineminus">-    NS_RELEASE2(kNC_Open, refcnt);</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-    NS_RELEASE2(kNC_FolderTreeName, refcnt);</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-    NS_RELEASE2(kNC_FolderTreeSimpleName, refcnt);</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineminus">-    NS_RELEASE2(kNC_NameSort, refcnt);</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineminus">-    NS_RELEASE2(kNC_FolderTreeNameSort, refcnt);</span>
<a href="#l5.197"></a><span id="l5.197" class="difflineminus">-    NS_RELEASE2(kNC_SpecialFolder, refcnt);</span>
<a href="#l5.198"></a><span id="l5.198" class="difflineminus">-    NS_RELEASE2(kNC_ServerType, refcnt);</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-    NS_RELEASE2(kNC_IsDeferred, refcnt);</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineminus">-    NS_RELEASE2(kNC_CanCreateFoldersOnServer, refcnt);</span>
<a href="#l5.201"></a><span id="l5.201" class="difflineminus">-    NS_RELEASE2(kNC_CanFileMessagesOnServer, refcnt);</span>
<a href="#l5.202"></a><span id="l5.202" class="difflineminus">-    NS_RELEASE2(kNC_IsServer, refcnt);</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-    NS_RELEASE2(kNC_IsSecure, refcnt);</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineminus">-    NS_RELEASE2(kNC_CanSubscribe, refcnt);</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-    NS_RELEASE2(kNC_SupportsOffline, refcnt);</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-    NS_RELEASE2(kNC_CanFileMessages, refcnt);</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineminus">-    NS_RELEASE2(kNC_CanCreateSubfolders, refcnt);</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineminus">-    NS_RELEASE2(kNC_CanRename, refcnt);</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineminus">-    NS_RELEASE2(kNC_CanCompact, refcnt);</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineminus">-    NS_RELEASE2(kNC_TotalMessages, refcnt);</span>
<a href="#l5.211"></a><span id="l5.211" class="difflineminus">-    NS_RELEASE2(kNC_TotalUnreadMessages, refcnt);</span>
<a href="#l5.212"></a><span id="l5.212" class="difflineminus">-    NS_RELEASE2(kNC_FolderSize, refcnt);</span>
<a href="#l5.213"></a><span id="l5.213" class="difflineminus">-    NS_RELEASE2(kNC_Charset, refcnt);</span>
<a href="#l5.214"></a><span id="l5.214" class="difflineminus">-    NS_RELEASE2(kNC_BiffState, refcnt);</span>
<a href="#l5.215"></a><span id="l5.215" class="difflineminus">-    NS_RELEASE2(kNC_HasUnreadMessages, refcnt);</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineminus">-    NS_RELEASE2(kNC_NewMessages, refcnt);</span>
<a href="#l5.217"></a><span id="l5.217" class="difflineminus">-    NS_RELEASE2(kNC_SubfoldersHaveUnreadMessages, refcnt);</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineminus">-    NS_RELEASE2(kNC_NoSelect, refcnt);</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineminus">-    NS_RELEASE2(kNC_VirtualFolder, refcnt);</span>
<a href="#l5.220"></a><span id="l5.220" class="difflineminus">-    NS_RELEASE2(kNC_InVFEditSearchScope, refcnt);</span>
<a href="#l5.221"></a><span id="l5.221" class="difflineminus">-    NS_RELEASE2(kNC_ImapShared, refcnt);</span>
<a href="#l5.222"></a><span id="l5.222" class="difflineminus">-    NS_RELEASE2(kNC_Synchronize, refcnt);</span>
<a href="#l5.223"></a><span id="l5.223" class="difflineminus">-    NS_RELEASE2(kNC_SyncDisabled, refcnt);</span>
<a href="#l5.224"></a><span id="l5.224" class="difflineminus">-    NS_RELEASE2(kNC_CanSearchMessages, refcnt);</span>
<a href="#l5.225"></a><span id="l5.225" class="difflineminus">-</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineminus">-    NS_RELEASE2(kNC_Delete, refcnt);</span>
<a href="#l5.227"></a><span id="l5.227" class="difflineminus">-    NS_RELEASE2(kNC_ReallyDelete, refcnt);</span>
<a href="#l5.228"></a><span id="l5.228" class="difflineminus">-    NS_RELEASE2(kNC_NewFolder, refcnt);</span>
<a href="#l5.229"></a><span id="l5.229" class="difflineminus">-    NS_RELEASE2(kNC_GetNewMessages, refcnt);</span>
<a href="#l5.230"></a><span id="l5.230" class="difflineminus">-    NS_RELEASE2(kNC_Copy, refcnt);</span>
<a href="#l5.231"></a><span id="l5.231" class="difflineminus">-    NS_RELEASE2(kNC_Move, refcnt);</span>
<a href="#l5.232"></a><span id="l5.232" class="difflineminus">-    NS_RELEASE2(kNC_CopyFolder, refcnt);</span>
<a href="#l5.233"></a><span id="l5.233" class="difflineminus">-    NS_RELEASE2(kNC_MoveFolder, refcnt);</span>
<a href="#l5.234"></a><span id="l5.234" class="difflineminus">-    NS_RELEASE2(kNC_MarkAllMessagesRead, refcnt);</span>
<a href="#l5.235"></a><span id="l5.235" class="difflineminus">-    NS_RELEASE2(kNC_Compact, refcnt);</span>
<a href="#l5.236"></a><span id="l5.236" class="difflineminus">-    NS_RELEASE2(kNC_CompactAll, refcnt);</span>
<a href="#l5.237"></a><span id="l5.237" class="difflineminus">-    NS_RELEASE2(kNC_Rename, refcnt);</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineminus">-    NS_RELEASE2(kNC_EmptyTrash, refcnt);</span>
<a href="#l5.239"></a><span id="l5.239" class="difflineminus">-    NS_RELEASE2(kNC_UnreadFolders, refcnt);</span>
<a href="#l5.240"></a><span id="l5.240" class="difflineminus">-    NS_RELEASE2(kNC_FavoriteFolders, refcnt);</span>
<a href="#l5.241"></a><span id="l5.241" class="difflineminus">-    NS_RELEASE2(kNC_RecentFolders, refcnt);</span>
<a href="#l5.242"></a><span id="l5.242" class="difflineminus">-  }</span>
<a href="#l5.243"></a><span id="l5.243" class="difflineminus">-}</span>
<a href="#l5.244"></a><span id="l5.244" class="difflineminus">-</span>
<a href="#l5.245"></a><span id="l5.245" class="difflineminus">-nsresult nsMsgFolderDataSource::CreateLiterals(nsIRDFService *rdf)</span>
<a href="#l5.246"></a><span id="l5.246" class="difflineminus">-{</span>
<a href="#l5.247"></a><span id="l5.247" class="difflineminus">-  createNode(u&quot;true&quot;,</span>
<a href="#l5.248"></a><span id="l5.248" class="difflineminus">-    getter_AddRefs(kTrueLiteral), rdf);</span>
<a href="#l5.249"></a><span id="l5.249" class="difflineminus">-  createNode(u&quot;false&quot;,</span>
<a href="#l5.250"></a><span id="l5.250" class="difflineminus">-    getter_AddRefs(kFalseLiteral), rdf);</span>
<a href="#l5.251"></a><span id="l5.251" class="difflineminus">-</span>
<a href="#l5.252"></a><span id="l5.252" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.253"></a><span id="l5.253" class="difflineminus">-}</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineminus">-</span>
<a href="#l5.255"></a><span id="l5.255" class="difflineminus">-nsresult nsMsgFolderDataSource::Init()</span>
<a href="#l5.256"></a><span id="l5.256" class="difflineminus">-{</span>
<a href="#l5.257"></a><span id="l5.257" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.258"></a><span id="l5.258" class="difflineminus">-</span>
<a href="#l5.259"></a><span id="l5.259" class="difflineminus">-  rv = nsMsgRDFDataSource::Init();</span>
<a href="#l5.260"></a><span id="l5.260" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l5.261"></a><span id="l5.261" class="difflineminus">-    return rv;</span>
<a href="#l5.262"></a><span id="l5.262" class="difflineminus">-</span>
<a href="#l5.263"></a><span id="l5.263" class="difflineminus">-  nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession =</span>
<a href="#l5.264"></a><span id="l5.264" class="difflineminus">-    do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l5.265"></a><span id="l5.265" class="difflineminus">-</span>
<a href="#l5.266"></a><span id="l5.266" class="difflineminus">-  if(NS_SUCCEEDED(rv))</span>
<a href="#l5.267"></a><span id="l5.267" class="difflineminus">-    mailSession-&gt;AddFolderListener(this,</span>
<a href="#l5.268"></a><span id="l5.268" class="difflineminus">-      nsIFolderListener::added |</span>
<a href="#l5.269"></a><span id="l5.269" class="difflineminus">-      nsIFolderListener::removed |</span>
<a href="#l5.270"></a><span id="l5.270" class="difflineminus">-      nsIFolderListener::intPropertyChanged |</span>
<a href="#l5.271"></a><span id="l5.271" class="difflineminus">-      nsIFolderListener::boolPropertyChanged |</span>
<a href="#l5.272"></a><span id="l5.272" class="difflineminus">-      nsIFolderListener::unicharPropertyChanged);</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineminus">-</span>
<a href="#l5.274"></a><span id="l5.274" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.275"></a><span id="l5.275" class="difflineminus">-}</span>
<a href="#l5.276"></a><span id="l5.276" class="difflineminus">-</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineminus">-void nsMsgFolderDataSource::Cleanup()</span>
<a href="#l5.278"></a><span id="l5.278" class="difflineminus">-{</span>
<a href="#l5.279"></a><span id="l5.279" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.280"></a><span id="l5.280" class="difflineminus">-  if (!m_shuttingDown)</span>
<a href="#l5.281"></a><span id="l5.281" class="difflineminus">-  {</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineminus">-    nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession =</span>
<a href="#l5.283"></a><span id="l5.283" class="difflineminus">-      do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l5.284"></a><span id="l5.284" class="difflineminus">-</span>
<a href="#l5.285"></a><span id="l5.285" class="difflineminus">-    if(NS_SUCCEEDED(rv))</span>
<a href="#l5.286"></a><span id="l5.286" class="difflineminus">-      mailSession-&gt;RemoveFolderListener(this);</span>
<a href="#l5.287"></a><span id="l5.287" class="difflineminus">-  }</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineminus">-</span>
<a href="#l5.289"></a><span id="l5.289" class="difflineminus">-  nsMsgRDFDataSource::Cleanup();</span>
<a href="#l5.290"></a><span id="l5.290" class="difflineminus">-}</span>
<a href="#l5.291"></a><span id="l5.291" class="difflineminus">-</span>
<a href="#l5.292"></a><span id="l5.292" class="difflineminus">-nsresult nsMsgFolderDataSource::CreateArcsOutEnumerator()</span>
<a href="#l5.293"></a><span id="l5.293" class="difflineminus">-{</span>
<a href="#l5.294"></a><span id="l5.294" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.295"></a><span id="l5.295" class="difflineminus">-</span>
<a href="#l5.296"></a><span id="l5.296" class="difflineminus">-  rv = getFolderArcLabelsOut(kFolderArcsOutArray);</span>
<a href="#l5.297"></a><span id="l5.297" class="difflineminus">-  if(NS_FAILED(rv)) return rv;</span>
<a href="#l5.298"></a><span id="l5.298" class="difflineminus">-</span>
<a href="#l5.299"></a><span id="l5.299" class="difflineminus">-  return rv;</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineminus">-}</span>
<a href="#l5.301"></a><span id="l5.301" class="difflineminus">-</span>
<a href="#l5.302"></a><span id="l5.302" class="difflineminus">-NS_IMPL_ADDREF_INHERITED(nsMsgFolderDataSource, nsMsgRDFDataSource)</span>
<a href="#l5.303"></a><span id="l5.303" class="difflineminus">-NS_IMPL_RELEASE_INHERITED(nsMsgFolderDataSource, nsMsgRDFDataSource)</span>
<a href="#l5.304"></a><span id="l5.304" class="difflineminus">-</span>
<a href="#l5.305"></a><span id="l5.305" class="difflineminus">-NS_IMPL_QUERY_INTERFACE_INHERITED(nsMsgFolderDataSource, nsMsgRDFDataSource, nsIFolderListener)</span>
<a href="#l5.306"></a><span id="l5.306" class="difflineminus">-</span>
<a href="#l5.307"></a><span id="l5.307" class="difflineminus">- // nsIRDFDataSource methods</span>
<a href="#l5.308"></a><span id="l5.308" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::GetURI(nsACString&amp; uri)</span>
<a href="#l5.309"></a><span id="l5.309" class="difflineminus">-{</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineminus">-  uri.AssignLiteral(&quot;rdf:mailnewsfolders&quot;);</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.312"></a><span id="l5.312" class="difflineminus">-}</span>
<a href="#l5.313"></a><span id="l5.313" class="difflineminus">-</span>
<a href="#l5.314"></a><span id="l5.314" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::GetSource(nsIRDFResource* property,</span>
<a href="#l5.315"></a><span id="l5.315" class="difflineminus">-                                               nsIRDFNode* target,</span>
<a href="#l5.316"></a><span id="l5.316" class="difflineminus">-                                               bool tv,</span>
<a href="#l5.317"></a><span id="l5.317" class="difflineminus">-                                               nsIRDFResource** source /* out */)</span>
<a href="#l5.318"></a><span id="l5.318" class="difflineminus">-{</span>
<a href="#l5.319"></a><span id="l5.319" class="difflineminus">-  NS_ASSERTION(false, &quot;not implemented&quot;);</span>
<a href="#l5.320"></a><span id="l5.320" class="difflineminus">-  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineminus">-}</span>
<a href="#l5.322"></a><span id="l5.322" class="difflineminus">-</span>
<a href="#l5.323"></a><span id="l5.323" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::GetTarget(nsIRDFResource* source,</span>
<a href="#l5.324"></a><span id="l5.324" class="difflineminus">-                                               nsIRDFResource* property,</span>
<a href="#l5.325"></a><span id="l5.325" class="difflineminus">-                                               bool tv,</span>
<a href="#l5.326"></a><span id="l5.326" class="difflineminus">-                                               nsIRDFNode** target)</span>
<a href="#l5.327"></a><span id="l5.327" class="difflineminus">-{</span>
<a href="#l5.328"></a><span id="l5.328" class="difflineminus">-  nsresult rv = NS_RDF_NO_VALUE;</span>
<a href="#l5.329"></a><span id="l5.329" class="difflineminus">-</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineminus">-  // we only have positive assertions in the mail data source.</span>
<a href="#l5.331"></a><span id="l5.331" class="difflineminus">-  if (! tv)</span>
<a href="#l5.332"></a><span id="l5.332" class="difflineminus">-    return NS_RDF_NO_VALUE;</span>
<a href="#l5.333"></a><span id="l5.333" class="difflineminus">-</span>
<a href="#l5.334"></a><span id="l5.334" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source));</span>
<a href="#l5.335"></a><span id="l5.335" class="difflineminus">-  if (folder)</span>
<a href="#l5.336"></a><span id="l5.336" class="difflineminus">-    rv = createFolderNode(folder, property, target);</span>
<a href="#l5.337"></a><span id="l5.337" class="difflineminus">-  else</span>
<a href="#l5.338"></a><span id="l5.338" class="difflineminus">-    return NS_RDF_NO_VALUE;</span>
<a href="#l5.339"></a><span id="l5.339" class="difflineminus">-  return rv;</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineminus">-}</span>
<a href="#l5.341"></a><span id="l5.341" class="difflineminus">-</span>
<a href="#l5.342"></a><span id="l5.342" class="difflineminus">-</span>
<a href="#l5.343"></a><span id="l5.343" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::GetSources(nsIRDFResource* property,</span>
<a href="#l5.344"></a><span id="l5.344" class="difflineminus">-                                                nsIRDFNode* target,</span>
<a href="#l5.345"></a><span id="l5.345" class="difflineminus">-                                                bool tv,</span>
<a href="#l5.346"></a><span id="l5.346" class="difflineminus">-                                                nsISimpleEnumerator** sources)</span>
<a href="#l5.347"></a><span id="l5.347" class="difflineminus">-{</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineminus">-  return NS_RDF_NO_VALUE;</span>
<a href="#l5.349"></a><span id="l5.349" class="difflineminus">-}</span>
<a href="#l5.350"></a><span id="l5.350" class="difflineminus">-</span>
<a href="#l5.351"></a><span id="l5.351" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::GetTargets(nsIRDFResource* source,</span>
<a href="#l5.352"></a><span id="l5.352" class="difflineminus">-                                                nsIRDFResource* property,</span>
<a href="#l5.353"></a><span id="l5.353" class="difflineminus">-                                                bool tv,</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineminus">-                                                nsISimpleEnumerator** targets)</span>
<a href="#l5.355"></a><span id="l5.355" class="difflineminus">-{</span>
<a href="#l5.356"></a><span id="l5.356" class="difflineminus">-  nsresult rv = NS_RDF_NO_VALUE;</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineminus">-  if(!targets)</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l5.359"></a><span id="l5.359" class="difflineminus">-</span>
<a href="#l5.360"></a><span id="l5.360" class="difflineminus">-  *targets = nullptr;</span>
<a href="#l5.361"></a><span id="l5.361" class="difflineminus">-</span>
<a href="#l5.362"></a><span id="l5.362" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source, &amp;rv));</span>
<a href="#l5.363"></a><span id="l5.363" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineminus">-  {</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineminus">-    if (kNC_Child == property)</span>
<a href="#l5.366"></a><span id="l5.366" class="difflineminus">-    {</span>
<a href="#l5.367"></a><span id="l5.367" class="difflineminus">-      rv = folder-&gt;GetSubFolders(targets);</span>
<a href="#l5.368"></a><span id="l5.368" class="difflineminus">-    }</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineminus">-    else if ((kNC_Name == property) ||</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineminus">-      (kNC_Open == property) ||</span>
<a href="#l5.371"></a><span id="l5.371" class="difflineminus">-      (kNC_FolderTreeName == property) ||</span>
<a href="#l5.372"></a><span id="l5.372" class="difflineminus">-      (kNC_FolderTreeSimpleName == property) ||</span>
<a href="#l5.373"></a><span id="l5.373" class="difflineminus">-      (kNC_SpecialFolder == property) ||</span>
<a href="#l5.374"></a><span id="l5.374" class="difflineminus">-      (kNC_IsServer == property) ||</span>
<a href="#l5.375"></a><span id="l5.375" class="difflineminus">-      (kNC_IsSecure == property) ||</span>
<a href="#l5.376"></a><span id="l5.376" class="difflineminus">-      (kNC_CanSubscribe == property) ||</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineminus">-      (kNC_SupportsOffline == property) ||</span>
<a href="#l5.378"></a><span id="l5.378" class="difflineminus">-      (kNC_CanFileMessages == property) ||</span>
<a href="#l5.379"></a><span id="l5.379" class="difflineminus">-      (kNC_CanCreateSubfolders == property) ||</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineminus">-      (kNC_CanRename == property) ||</span>
<a href="#l5.381"></a><span id="l5.381" class="difflineminus">-      (kNC_CanCompact == property) ||</span>
<a href="#l5.382"></a><span id="l5.382" class="difflineminus">-      (kNC_ServerType == property) ||</span>
<a href="#l5.383"></a><span id="l5.383" class="difflineminus">-      (kNC_IsDeferred == property) ||</span>
<a href="#l5.384"></a><span id="l5.384" class="difflineminus">-      (kNC_CanCreateFoldersOnServer == property) ||</span>
<a href="#l5.385"></a><span id="l5.385" class="difflineminus">-      (kNC_CanFileMessagesOnServer == property) ||</span>
<a href="#l5.386"></a><span id="l5.386" class="difflineminus">-      (kNC_NoSelect == property) ||</span>
<a href="#l5.387"></a><span id="l5.387" class="difflineminus">-      (kNC_VirtualFolder == property) ||</span>
<a href="#l5.388"></a><span id="l5.388" class="difflineminus">-      (kNC_InVFEditSearchScope == property) ||</span>
<a href="#l5.389"></a><span id="l5.389" class="difflineminus">-      (kNC_ImapShared == property) ||</span>
<a href="#l5.390"></a><span id="l5.390" class="difflineminus">-      (kNC_Synchronize == property) ||</span>
<a href="#l5.391"></a><span id="l5.391" class="difflineminus">-      (kNC_SyncDisabled == property) ||</span>
<a href="#l5.392"></a><span id="l5.392" class="difflineminus">-      (kNC_CanSearchMessages == property))</span>
<a href="#l5.393"></a><span id="l5.393" class="difflineminus">-    {</span>
<a href="#l5.394"></a><span id="l5.394" class="difflineminus">-      return NS_NewSingletonEnumerator(targets, property);</span>
<a href="#l5.395"></a><span id="l5.395" class="difflineminus">-    }</span>
<a href="#l5.396"></a><span id="l5.396" class="difflineminus">-  }</span>
<a href="#l5.397"></a><span id="l5.397" class="difflineminus">-  if(!*targets)</span>
<a href="#l5.398"></a><span id="l5.398" class="difflineminus">-  {</span>
<a href="#l5.399"></a><span id="l5.399" class="difflineminus">-    //create empty cursor</span>
<a href="#l5.400"></a><span id="l5.400" class="difflineminus">-    rv = NS_NewEmptyEnumerator(targets);</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineminus">-  }</span>
<a href="#l5.402"></a><span id="l5.402" class="difflineminus">-</span>
<a href="#l5.403"></a><span id="l5.403" class="difflineminus">-  return rv;</span>
<a href="#l5.404"></a><span id="l5.404" class="difflineminus">-}</span>
<a href="#l5.405"></a><span id="l5.405" class="difflineminus">-</span>
<a href="#l5.406"></a><span id="l5.406" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::Assert(nsIRDFResource* source,</span>
<a href="#l5.407"></a><span id="l5.407" class="difflineminus">-                      nsIRDFResource* property,</span>
<a href="#l5.408"></a><span id="l5.408" class="difflineminus">-                      nsIRDFNode* target,</span>
<a href="#l5.409"></a><span id="l5.409" class="difflineminus">-                      bool tv)</span>
<a href="#l5.410"></a><span id="l5.410" class="difflineminus">-{</span>
<a href="#l5.411"></a><span id="l5.411" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source, &amp;rv));</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineminus">-  //We don't handle tv = false at the moment.</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineminus">-  if(NS_SUCCEEDED(rv) &amp;&amp; tv)</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineminus">-    return DoFolderAssert(folder, property, target);</span>
<a href="#l5.416"></a><span id="l5.416" class="difflineminus">-  return NS_ERROR_FAILURE;</span>
<a href="#l5.417"></a><span id="l5.417" class="difflineminus">-}</span>
<a href="#l5.418"></a><span id="l5.418" class="difflineminus">-</span>
<a href="#l5.419"></a><span id="l5.419" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::Unassert(nsIRDFResource* source,</span>
<a href="#l5.420"></a><span id="l5.420" class="difflineminus">-                        nsIRDFResource* property,</span>
<a href="#l5.421"></a><span id="l5.421" class="difflineminus">-                        nsIRDFNode* target)</span>
<a href="#l5.422"></a><span id="l5.422" class="difflineminus">-{</span>
<a href="#l5.423"></a><span id="l5.423" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source, &amp;rv));</span>
<a href="#l5.425"></a><span id="l5.425" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.426"></a><span id="l5.426" class="difflineminus">-  return DoFolderUnassert(folder, property, target);</span>
<a href="#l5.427"></a><span id="l5.427" class="difflineminus">-}</span>
<a href="#l5.428"></a><span id="l5.428" class="difflineminus">-</span>
<a href="#l5.429"></a><span id="l5.429" class="difflineminus">-</span>
<a href="#l5.430"></a><span id="l5.430" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::HasAssertion(nsIRDFResource* source,</span>
<a href="#l5.431"></a><span id="l5.431" class="difflineminus">-                            nsIRDFResource* property,</span>
<a href="#l5.432"></a><span id="l5.432" class="difflineminus">-                            nsIRDFNode* target,</span>
<a href="#l5.433"></a><span id="l5.433" class="difflineminus">-                            bool tv,</span>
<a href="#l5.434"></a><span id="l5.434" class="difflineminus">-                            bool* hasAssertion)</span>
<a href="#l5.435"></a><span id="l5.435" class="difflineminus">-{</span>
<a href="#l5.436"></a><span id="l5.436" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.437"></a><span id="l5.437" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source, &amp;rv));</span>
<a href="#l5.438"></a><span id="l5.438" class="difflineminus">-  if(NS_SUCCEEDED(rv))</span>
<a href="#l5.439"></a><span id="l5.439" class="difflineminus">-    return DoFolderHasAssertion(folder, property, target, tv, hasAssertion);</span>
<a href="#l5.440"></a><span id="l5.440" class="difflineminus">-  else</span>
<a href="#l5.441"></a><span id="l5.441" class="difflineminus">-    *hasAssertion = false;</span>
<a href="#l5.442"></a><span id="l5.442" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineminus">-}</span>
<a href="#l5.444"></a><span id="l5.444" class="difflineminus">-</span>
<a href="#l5.445"></a><span id="l5.445" class="difflineminus">-</span>
<a href="#l5.446"></a><span id="l5.446" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.447"></a><span id="l5.447" class="difflineminus">-nsMsgFolderDataSource::HasArcOut(nsIRDFResource *aSource, nsIRDFResource *aArc, bool *result)</span>
<a href="#l5.448"></a><span id="l5.448" class="difflineminus">-{</span>
<a href="#l5.449"></a><span id="l5.449" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.450"></a><span id="l5.450" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(aSource, &amp;rv));</span>
<a href="#l5.451"></a><span id="l5.451" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l5.452"></a><span id="l5.452" class="difflineminus">-  {</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineminus">-    *result = (aArc == kNC_Name ||</span>
<a href="#l5.454"></a><span id="l5.454" class="difflineminus">-      aArc == kNC_Open ||</span>
<a href="#l5.455"></a><span id="l5.455" class="difflineminus">-      aArc == kNC_FolderTreeName ||</span>
<a href="#l5.456"></a><span id="l5.456" class="difflineminus">-      aArc == kNC_FolderTreeSimpleName ||</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineminus">-      aArc == kNC_SpecialFolder ||</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineminus">-      aArc == kNC_ServerType ||</span>
<a href="#l5.459"></a><span id="l5.459" class="difflineminus">-      aArc == kNC_IsDeferred ||</span>
<a href="#l5.460"></a><span id="l5.460" class="difflineminus">-      aArc == kNC_CanCreateFoldersOnServer ||</span>
<a href="#l5.461"></a><span id="l5.461" class="difflineminus">-      aArc == kNC_CanFileMessagesOnServer ||</span>
<a href="#l5.462"></a><span id="l5.462" class="difflineminus">-      aArc == kNC_IsServer ||</span>
<a href="#l5.463"></a><span id="l5.463" class="difflineminus">-      aArc == kNC_IsSecure ||</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineminus">-      aArc == kNC_CanSubscribe ||</span>
<a href="#l5.465"></a><span id="l5.465" class="difflineminus">-      aArc == kNC_SupportsOffline ||</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineminus">-      aArc == kNC_CanFileMessages ||</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineminus">-      aArc == kNC_CanCreateSubfolders ||</span>
<a href="#l5.468"></a><span id="l5.468" class="difflineminus">-      aArc == kNC_CanRename ||</span>
<a href="#l5.469"></a><span id="l5.469" class="difflineminus">-      aArc == kNC_CanCompact ||</span>
<a href="#l5.470"></a><span id="l5.470" class="difflineminus">-      aArc == kNC_TotalMessages ||</span>
<a href="#l5.471"></a><span id="l5.471" class="difflineminus">-      aArc == kNC_TotalUnreadMessages ||</span>
<a href="#l5.472"></a><span id="l5.472" class="difflineminus">-      aArc == kNC_FolderSize ||</span>
<a href="#l5.473"></a><span id="l5.473" class="difflineminus">-      aArc == kNC_Charset ||</span>
<a href="#l5.474"></a><span id="l5.474" class="difflineminus">-      aArc == kNC_BiffState ||</span>
<a href="#l5.475"></a><span id="l5.475" class="difflineminus">-      aArc == kNC_Child ||</span>
<a href="#l5.476"></a><span id="l5.476" class="difflineminus">-      aArc == kNC_NoSelect ||</span>
<a href="#l5.477"></a><span id="l5.477" class="difflineminus">-      aArc == kNC_VirtualFolder ||</span>
<a href="#l5.478"></a><span id="l5.478" class="difflineminus">-      aArc == kNC_InVFEditSearchScope ||</span>
<a href="#l5.479"></a><span id="l5.479" class="difflineminus">-      aArc == kNC_ImapShared ||</span>
<a href="#l5.480"></a><span id="l5.480" class="difflineminus">-      aArc == kNC_Synchronize ||</span>
<a href="#l5.481"></a><span id="l5.481" class="difflineminus">-      aArc == kNC_SyncDisabled ||</span>
<a href="#l5.482"></a><span id="l5.482" class="difflineminus">-      aArc == kNC_CanSearchMessages);</span>
<a href="#l5.483"></a><span id="l5.483" class="difflineminus">-  }</span>
<a href="#l5.484"></a><span id="l5.484" class="difflineminus">-  else</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineminus">-  {</span>
<a href="#l5.486"></a><span id="l5.486" class="difflineminus">-    *result = false;</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineminus">-  }</span>
<a href="#l5.488"></a><span id="l5.488" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineminus">-}</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineminus">-</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::ArcLabelsIn(nsIRDFNode* node,</span>
<a href="#l5.492"></a><span id="l5.492" class="difflineminus">-                                                 nsISimpleEnumerator** labels)</span>
<a href="#l5.493"></a><span id="l5.493" class="difflineminus">-{</span>
<a href="#l5.494"></a><span id="l5.494" class="difflineminus">-  return nsMsgRDFDataSource::ArcLabelsIn(node, labels);</span>
<a href="#l5.495"></a><span id="l5.495" class="difflineminus">-}</span>
<a href="#l5.496"></a><span id="l5.496" class="difflineminus">-</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::ArcLabelsOut(nsIRDFResource* source,</span>
<a href="#l5.498"></a><span id="l5.498" class="difflineminus">-                                                  nsISimpleEnumerator** labels)</span>
<a href="#l5.499"></a><span id="l5.499" class="difflineminus">-{</span>
<a href="#l5.500"></a><span id="l5.500" class="difflineminus">-  nsresult rv = NS_RDF_NO_VALUE;</span>
<a href="#l5.501"></a><span id="l5.501" class="difflineminus">-</span>
<a href="#l5.502"></a><span id="l5.502" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source, &amp;rv));</span>
<a href="#l5.503"></a><span id="l5.503" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l5.504"></a><span id="l5.504" class="difflineminus">-  {</span>
<a href="#l5.505"></a><span id="l5.505" class="difflineminus">-    rv = NS_NewArrayEnumerator(labels, kFolderArcsOutArray);</span>
<a href="#l5.506"></a><span id="l5.506" class="difflineminus">-  }</span>
<a href="#l5.507"></a><span id="l5.507" class="difflineminus">-  else</span>
<a href="#l5.508"></a><span id="l5.508" class="difflineminus">-  {</span>
<a href="#l5.509"></a><span id="l5.509" class="difflineminus">-    rv = NS_NewEmptyEnumerator(labels);</span>
<a href="#l5.510"></a><span id="l5.510" class="difflineminus">-  }</span>
<a href="#l5.511"></a><span id="l5.511" class="difflineminus">-</span>
<a href="#l5.512"></a><span id="l5.512" class="difflineminus">-  return rv;</span>
<a href="#l5.513"></a><span id="l5.513" class="difflineminus">-}</span>
<a href="#l5.514"></a><span id="l5.514" class="difflineminus">-</span>
<a href="#l5.515"></a><span id="l5.515" class="difflineminus">-nsresult</span>
<a href="#l5.516"></a><span id="l5.516" class="difflineminus">-nsMsgFolderDataSource::getFolderArcLabelsOut(nsCOMArray&lt;nsIRDFResource&gt; &amp;aArcs)</span>
<a href="#l5.517"></a><span id="l5.517" class="difflineminus">-{</span>
<a href="#l5.518"></a><span id="l5.518" class="difflineminus">-  aArcs.AppendObject(kNC_Name);</span>
<a href="#l5.519"></a><span id="l5.519" class="difflineminus">-  aArcs.AppendObject(kNC_Open);</span>
<a href="#l5.520"></a><span id="l5.520" class="difflineminus">-  aArcs.AppendObject(kNC_FolderTreeName);</span>
<a href="#l5.521"></a><span id="l5.521" class="difflineminus">-  aArcs.AppendObject(kNC_FolderTreeSimpleName);</span>
<a href="#l5.522"></a><span id="l5.522" class="difflineminus">-  aArcs.AppendObject(kNC_SpecialFolder);</span>
<a href="#l5.523"></a><span id="l5.523" class="difflineminus">-  aArcs.AppendObject(kNC_ServerType);</span>
<a href="#l5.524"></a><span id="l5.524" class="difflineminus">-  aArcs.AppendObject(kNC_IsDeferred);</span>
<a href="#l5.525"></a><span id="l5.525" class="difflineminus">-  aArcs.AppendObject(kNC_CanCreateFoldersOnServer);</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineminus">-  aArcs.AppendObject(kNC_CanFileMessagesOnServer);</span>
<a href="#l5.527"></a><span id="l5.527" class="difflineminus">-  aArcs.AppendObject(kNC_IsServer);</span>
<a href="#l5.528"></a><span id="l5.528" class="difflineminus">-  aArcs.AppendObject(kNC_IsSecure);</span>
<a href="#l5.529"></a><span id="l5.529" class="difflineminus">-  aArcs.AppendObject(kNC_CanSubscribe);</span>
<a href="#l5.530"></a><span id="l5.530" class="difflineminus">-  aArcs.AppendObject(kNC_SupportsOffline);</span>
<a href="#l5.531"></a><span id="l5.531" class="difflineminus">-  aArcs.AppendObject(kNC_CanFileMessages);</span>
<a href="#l5.532"></a><span id="l5.532" class="difflineminus">-  aArcs.AppendObject(kNC_CanCreateSubfolders);</span>
<a href="#l5.533"></a><span id="l5.533" class="difflineminus">-  aArcs.AppendObject(kNC_CanRename);</span>
<a href="#l5.534"></a><span id="l5.534" class="difflineminus">-  aArcs.AppendObject(kNC_CanCompact);</span>
<a href="#l5.535"></a><span id="l5.535" class="difflineminus">-  aArcs.AppendObject(kNC_TotalMessages);</span>
<a href="#l5.536"></a><span id="l5.536" class="difflineminus">-  aArcs.AppendObject(kNC_TotalUnreadMessages);</span>
<a href="#l5.537"></a><span id="l5.537" class="difflineminus">-  aArcs.AppendObject(kNC_FolderSize);</span>
<a href="#l5.538"></a><span id="l5.538" class="difflineminus">-  aArcs.AppendObject(kNC_Charset);</span>
<a href="#l5.539"></a><span id="l5.539" class="difflineminus">-  aArcs.AppendObject(kNC_BiffState);</span>
<a href="#l5.540"></a><span id="l5.540" class="difflineminus">-  aArcs.AppendObject(kNC_Child);</span>
<a href="#l5.541"></a><span id="l5.541" class="difflineminus">-  aArcs.AppendObject(kNC_NoSelect);</span>
<a href="#l5.542"></a><span id="l5.542" class="difflineminus">-  aArcs.AppendObject(kNC_VirtualFolder);</span>
<a href="#l5.543"></a><span id="l5.543" class="difflineminus">-  aArcs.AppendObject(kNC_InVFEditSearchScope);</span>
<a href="#l5.544"></a><span id="l5.544" class="difflineminus">-  aArcs.AppendObject(kNC_ImapShared);</span>
<a href="#l5.545"></a><span id="l5.545" class="difflineminus">-  aArcs.AppendObject(kNC_Synchronize);</span>
<a href="#l5.546"></a><span id="l5.546" class="difflineminus">-  aArcs.AppendObject(kNC_SyncDisabled);</span>
<a href="#l5.547"></a><span id="l5.547" class="difflineminus">-  aArcs.AppendObject(kNC_CanSearchMessages);</span>
<a href="#l5.548"></a><span id="l5.548" class="difflineminus">-</span>
<a href="#l5.549"></a><span id="l5.549" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineminus">-}</span>
<a href="#l5.551"></a><span id="l5.551" class="difflineminus">-</span>
<a href="#l5.552"></a><span id="l5.552" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.553"></a><span id="l5.553" class="difflineminus">-nsMsgFolderDataSource::GetAllResources(nsISimpleEnumerator** aCursor)</span>
<a href="#l5.554"></a><span id="l5.554" class="difflineminus">-{</span>
<a href="#l5.555"></a><span id="l5.555" class="difflineminus">-  MOZ_ASSERT_UNREACHABLE(&quot;sorry!&quot;);</span>
<a href="#l5.556"></a><span id="l5.556" class="difflineminus">-  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.557"></a><span id="l5.557" class="difflineminus">-}</span>
<a href="#l5.558"></a><span id="l5.558" class="difflineminus">-</span>
<a href="#l5.559"></a><span id="l5.559" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineminus">-nsMsgFolderDataSource::GetAllCmds(nsIRDFResource* source,</span>
<a href="#l5.561"></a><span id="l5.561" class="difflineminus">-                                      nsISimpleEnumerator/*&lt;nsIRDFResource&gt;*/** commands)</span>
<a href="#l5.562"></a><span id="l5.562" class="difflineminus">-{</span>
<a href="#l5.563"></a><span id="l5.563" class="difflineminus">-  MOZ_ASSERT_UNREACHABLE(&quot;no one actually uses me&quot;);</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineminus">-</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source, &amp;rv));</span>
<a href="#l5.567"></a><span id="l5.567" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.568"></a><span id="l5.568" class="difflineminus">-</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineminus">-  nsCOMPtr&lt;nsIMutableArray&gt; cmds =</span>
<a href="#l5.570"></a><span id="l5.570" class="difflineminus">-    do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineminus">-  NS_ENSURE_STATE(cmds);</span>
<a href="#l5.572"></a><span id="l5.572" class="difflineminus">-</span>
<a href="#l5.573"></a><span id="l5.573" class="difflineminus">-  cmds-&gt;AppendElement(kNC_Delete);</span>
<a href="#l5.574"></a><span id="l5.574" class="difflineminus">-  cmds-&gt;AppendElement(kNC_ReallyDelete);</span>
<a href="#l5.575"></a><span id="l5.575" class="difflineminus">-  cmds-&gt;AppendElement(kNC_NewFolder);</span>
<a href="#l5.576"></a><span id="l5.576" class="difflineminus">-  cmds-&gt;AppendElement(kNC_GetNewMessages);</span>
<a href="#l5.577"></a><span id="l5.577" class="difflineminus">-  cmds-&gt;AppendElement(kNC_Copy);</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineminus">-  cmds-&gt;AppendElement(kNC_Move);</span>
<a href="#l5.579"></a><span id="l5.579" class="difflineminus">-  cmds-&gt;AppendElement(kNC_CopyFolder);</span>
<a href="#l5.580"></a><span id="l5.580" class="difflineminus">-  cmds-&gt;AppendElement(kNC_MoveFolder);</span>
<a href="#l5.581"></a><span id="l5.581" class="difflineminus">-  cmds-&gt;AppendElement(kNC_MarkAllMessagesRead);</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineminus">-  cmds-&gt;AppendElement(kNC_Compact);</span>
<a href="#l5.583"></a><span id="l5.583" class="difflineminus">-  cmds-&gt;AppendElement(kNC_CompactAll);</span>
<a href="#l5.584"></a><span id="l5.584" class="difflineminus">-  cmds-&gt;AppendElement(kNC_Rename);</span>
<a href="#l5.585"></a><span id="l5.585" class="difflineminus">-  cmds-&gt;AppendElement(kNC_EmptyTrash);</span>
<a href="#l5.586"></a><span id="l5.586" class="difflineminus">-</span>
<a href="#l5.587"></a><span id="l5.587" class="difflineminus">-  return cmds-&gt;Enumerate(commands);</span>
<a href="#l5.588"></a><span id="l5.588" class="difflineminus">-}</span>
<a href="#l5.589"></a><span id="l5.589" class="difflineminus">-</span>
<a href="#l5.590"></a><span id="l5.590" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.591"></a><span id="l5.591" class="difflineminus">-nsMsgFolderDataSource::IsCommandEnabled(nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l5.592"></a><span id="l5.592" class="difflineminus">-                                        nsIRDFResource*   aCommand,</span>
<a href="#l5.593"></a><span id="l5.593" class="difflineminus">-                                        nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aArguments,</span>
<a href="#l5.594"></a><span id="l5.594" class="difflineminus">-                                        bool* aResult)</span>
<a href="#l5.595"></a><span id="l5.595" class="difflineminus">-{</span>
<a href="#l5.596"></a><span id="l5.596" class="difflineminus">-#if 1</span>
<a href="#l5.597"></a><span id="l5.597" class="difflineminus">-  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.598"></a><span id="l5.598" class="difflineminus">-#else</span>
<a href="#l5.599"></a><span id="l5.599" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.600"></a><span id="l5.600" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l5.601"></a><span id="l5.601" class="difflineminus">-</span>
<a href="#l5.602"></a><span id="l5.602" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; sources = do_QueryInterface(aSources);</span>
<a href="#l5.603"></a><span id="l5.603" class="difflineminus">-  NS_ENSURE_STATE(sources);</span>
<a href="#l5.604"></a><span id="l5.604" class="difflineminus">-</span>
<a href="#l5.605"></a><span id="l5.605" class="difflineminus">-  uint32_t cnt;</span>
<a href="#l5.606"></a><span id="l5.606" class="difflineminus">-  rv = sources-&gt;Count(&amp;cnt);</span>
<a href="#l5.607"></a><span id="l5.607" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.608"></a><span id="l5.608" class="difflineminus">-  for (uint32_t i = 0; i &lt; cnt; i++)</span>
<a href="#l5.609"></a><span id="l5.609" class="difflineminus">-  {</span>
<a href="#l5.610"></a><span id="l5.610" class="difflineminus">-    folder = do_QueryElementAt(sources, i, &amp;rv);</span>
<a href="#l5.611"></a><span id="l5.611" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l5.612"></a><span id="l5.612" class="difflineminus">-    {</span>
<a href="#l5.613"></a><span id="l5.613" class="difflineminus">-      // we don't care about the arguments -- folder commands are always enabled</span>
<a href="#l5.614"></a><span id="l5.614" class="difflineminus">-      if (!((aCommand == kNC_Delete) ||</span>
<a href="#l5.615"></a><span id="l5.615" class="difflineminus">-            (aCommand == kNC_ReallyDelete) ||</span>
<a href="#l5.616"></a><span id="l5.616" class="difflineminus">-            (aCommand == kNC_NewFolder) ||</span>
<a href="#l5.617"></a><span id="l5.617" class="difflineminus">-            (aCommand == kNC_Copy) ||</span>
<a href="#l5.618"></a><span id="l5.618" class="difflineminus">-            (aCommand == kNC_Move) ||</span>
<a href="#l5.619"></a><span id="l5.619" class="difflineminus">-            (aCommand == kNC_CopyFolder) ||</span>
<a href="#l5.620"></a><span id="l5.620" class="difflineminus">-            (aCommand == kNC_MoveFolder) ||</span>
<a href="#l5.621"></a><span id="l5.621" class="difflineminus">-            (aCommand == kNC_GetNewMessages) ||</span>
<a href="#l5.622"></a><span id="l5.622" class="difflineminus">-            (aCommand == kNC_MarkAllMessagesRead) ||</span>
<a href="#l5.623"></a><span id="l5.623" class="difflineminus">-            (aCommand == kNC_Compact) ||</span>
<a href="#l5.624"></a><span id="l5.624" class="difflineminus">-            (aCommand == kNC_CompactAll) ||</span>
<a href="#l5.625"></a><span id="l5.625" class="difflineminus">-            (aCommand == kNC_Rename) ||</span>
<a href="#l5.626"></a><span id="l5.626" class="difflineminus">-            (aCommand == kNC_EmptyTrash)))</span>
<a href="#l5.627"></a><span id="l5.627" class="difflineminus">-      {</span>
<a href="#l5.628"></a><span id="l5.628" class="difflineminus">-        *aResult = false;</span>
<a href="#l5.629"></a><span id="l5.629" class="difflineminus">-        return NS_OK;</span>
<a href="#l5.630"></a><span id="l5.630" class="difflineminus">-      }</span>
<a href="#l5.631"></a><span id="l5.631" class="difflineminus">-    }</span>
<a href="#l5.632"></a><span id="l5.632" class="difflineminus">-  }</span>
<a href="#l5.633"></a><span id="l5.633" class="difflineminus">-  *aResult = true;</span>
<a href="#l5.634"></a><span id="l5.634" class="difflineminus">-  return NS_OK; // succeeded for all sources</span>
<a href="#l5.635"></a><span id="l5.635" class="difflineminus">-#endif</span>
<a href="#l5.636"></a><span id="l5.636" class="difflineminus">-}</span>
<a href="#l5.637"></a><span id="l5.637" class="difflineminus">-</span>
<a href="#l5.638"></a><span id="l5.638" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.639"></a><span id="l5.639" class="difflineminus">-nsMsgFolderDataSource::DoCommand(nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l5.640"></a><span id="l5.640" class="difflineminus">-                                 nsIRDFResource*   aCommand,</span>
<a href="#l5.641"></a><span id="l5.641" class="difflineminus">-                                 nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aArguments)</span>
<a href="#l5.642"></a><span id="l5.642" class="difflineminus">-{</span>
<a href="#l5.643"></a><span id="l5.643" class="difflineminus">-#if 1</span>
<a href="#l5.644"></a><span id="l5.644" class="difflineminus">-  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.645"></a><span id="l5.645" class="difflineminus">-#else</span>
<a href="#l5.646"></a><span id="l5.646" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l5.647"></a><span id="l5.647" class="difflineminus">-  nsCOMPtr&lt;nsISupports&gt; supports;</span>
<a href="#l5.648"></a><span id="l5.648" class="difflineminus">-  nsCOMPtr&lt;nsIMsgWindow&gt; window;</span>
<a href="#l5.649"></a><span id="l5.649" class="difflineminus">-</span>
<a href="#l5.650"></a><span id="l5.650" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; sources = do_QueryInterface(aSources);</span>
<a href="#l5.651"></a><span id="l5.651" class="difflineminus">-  NS_ENSURE_STATE(sources);</span>
<a href="#l5.652"></a><span id="l5.652" class="difflineminus">-  nsCOMPtr&lt;nsISupportsArray&gt; arguments = do_QueryInterface(aArguments);</span>
<a href="#l5.653"></a><span id="l5.653" class="difflineminus">-</span>
<a href="#l5.654"></a><span id="l5.654" class="difflineminus">-  // callers can pass in the msgWindow as the last element of the arguments</span>
<a href="#l5.655"></a><span id="l5.655" class="difflineminus">-  // array. If they do, we'll use that as the msg window for progress, etc.</span>
<a href="#l5.656"></a><span id="l5.656" class="difflineminus">-  if (arguments)</span>
<a href="#l5.657"></a><span id="l5.657" class="difflineminus">-  {</span>
<a href="#l5.658"></a><span id="l5.658" class="difflineminus">-    uint32_t numArgs;</span>
<a href="#l5.659"></a><span id="l5.659" class="difflineminus">-    arguments-&gt;Count(&amp;numArgs);</span>
<a href="#l5.660"></a><span id="l5.660" class="difflineminus">-    if (numArgs &gt; 1)</span>
<a href="#l5.661"></a><span id="l5.661" class="difflineminus">-      window = do_QueryElementAt(arguments, numArgs - 1);</span>
<a href="#l5.662"></a><span id="l5.662" class="difflineminus">-  }</span>
<a href="#l5.663"></a><span id="l5.663" class="difflineminus">-  if (!window)</span>
<a href="#l5.664"></a><span id="l5.664" class="difflineminus">-    window = mWindow;</span>
<a href="#l5.665"></a><span id="l5.665" class="difflineminus">-</span>
<a href="#l5.666"></a><span id="l5.666" class="difflineminus">-  // XXX need to handle batching of command applied to all sources</span>
<a href="#l5.667"></a><span id="l5.667" class="difflineminus">-</span>
<a href="#l5.668"></a><span id="l5.668" class="difflineminus">-  uint32_t cnt = 0;</span>
<a href="#l5.669"></a><span id="l5.669" class="difflineminus">-  uint32_t i = 0;</span>
<a href="#l5.670"></a><span id="l5.670" class="difflineminus">-</span>
<a href="#l5.671"></a><span id="l5.671" class="difflineminus">-  rv = sources-&gt;Count(&amp;cnt);</span>
<a href="#l5.672"></a><span id="l5.672" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.673"></a><span id="l5.673" class="difflineminus">-</span>
<a href="#l5.674"></a><span id="l5.674" class="difflineminus">-  for ( ; i &lt; cnt; i++)</span>
<a href="#l5.675"></a><span id="l5.675" class="difflineminus">-  {</span>
<a href="#l5.676"></a><span id="l5.676" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryElementAt(sources, i, &amp;rv);</span>
<a href="#l5.677"></a><span id="l5.677" class="difflineminus">-    if (NS_SUCCEEDED(rv))</span>
<a href="#l5.678"></a><span id="l5.678" class="difflineminus">-    {</span>
<a href="#l5.679"></a><span id="l5.679" class="difflineminus">-      if (aCommand == kNC_Delete)</span>
<a href="#l5.680"></a><span id="l5.680" class="difflineminus">-      {</span>
<a href="#l5.681"></a><span id="l5.681" class="difflineminus">-        rv = DoDeleteFromFolder(folder, arguments, window, false);</span>
<a href="#l5.682"></a><span id="l5.682" class="difflineminus">-      }</span>
<a href="#l5.683"></a><span id="l5.683" class="difflineminus">-      if (aCommand == kNC_ReallyDelete)</span>
<a href="#l5.684"></a><span id="l5.684" class="difflineminus">-      {</span>
<a href="#l5.685"></a><span id="l5.685" class="difflineminus">-        rv = DoDeleteFromFolder(folder, arguments, window, true);</span>
<a href="#l5.686"></a><span id="l5.686" class="difflineminus">-      }</span>
<a href="#l5.687"></a><span id="l5.687" class="difflineminus">-      else if (aCommand == kNC_NewFolder)</span>
<a href="#l5.688"></a><span id="l5.688" class="difflineminus">-      {</span>
<a href="#l5.689"></a><span id="l5.689" class="difflineminus">-        rv = DoNewFolder(folder, arguments, window);</span>
<a href="#l5.690"></a><span id="l5.690" class="difflineminus">-      }</span>
<a href="#l5.691"></a><span id="l5.691" class="difflineminus">-      else if (aCommand == kNC_GetNewMessages)</span>
<a href="#l5.692"></a><span id="l5.692" class="difflineminus">-      {</span>
<a href="#l5.693"></a><span id="l5.693" class="difflineminus">-        nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryElementAt(arguments, i, &amp;rv);</span>
<a href="#l5.694"></a><span id="l5.694" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.695"></a><span id="l5.695" class="difflineminus">-        rv = server-&gt;GetNewMessages(folder, window, nullptr);</span>
<a href="#l5.696"></a><span id="l5.696" class="difflineminus">-      }</span>
<a href="#l5.697"></a><span id="l5.697" class="difflineminus">-      else if (aCommand == kNC_Copy)</span>
<a href="#l5.698"></a><span id="l5.698" class="difflineminus">-      {</span>
<a href="#l5.699"></a><span id="l5.699" class="difflineminus">-        rv = DoCopyToFolder(folder, arguments, window, false);</span>
<a href="#l5.700"></a><span id="l5.700" class="difflineminus">-      }</span>
<a href="#l5.701"></a><span id="l5.701" class="difflineminus">-      else if (aCommand == kNC_Move)</span>
<a href="#l5.702"></a><span id="l5.702" class="difflineminus">-      {</span>
<a href="#l5.703"></a><span id="l5.703" class="difflineminus">-        rv = DoCopyToFolder(folder, arguments, window, true);</span>
<a href="#l5.704"></a><span id="l5.704" class="difflineminus">-      }</span>
<a href="#l5.705"></a><span id="l5.705" class="difflineminus">-      else if (aCommand == kNC_CopyFolder)</span>
<a href="#l5.706"></a><span id="l5.706" class="difflineminus">-      {</span>
<a href="#l5.707"></a><span id="l5.707" class="difflineminus">-        rv = DoFolderCopyToFolder(folder, arguments, window, false);</span>
<a href="#l5.708"></a><span id="l5.708" class="difflineminus">-      }</span>
<a href="#l5.709"></a><span id="l5.709" class="difflineminus">-      else if (aCommand == kNC_MoveFolder)</span>
<a href="#l5.710"></a><span id="l5.710" class="difflineminus">-      {</span>
<a href="#l5.711"></a><span id="l5.711" class="difflineminus">-        rv = DoFolderCopyToFolder(folder, arguments, window, true);</span>
<a href="#l5.712"></a><span id="l5.712" class="difflineminus">-      }</span>
<a href="#l5.713"></a><span id="l5.713" class="difflineminus">-      else if (aCommand == kNC_MarkAllMessagesRead)</span>
<a href="#l5.714"></a><span id="l5.714" class="difflineminus">-      {</span>
<a href="#l5.715"></a><span id="l5.715" class="difflineminus">-        rv = folder-&gt;MarkAllMessagesRead(window);</span>
<a href="#l5.716"></a><span id="l5.716" class="difflineminus">-      }</span>
<a href="#l5.717"></a><span id="l5.717" class="difflineminus">-      else if (aCommand == kNC_Compact)</span>
<a href="#l5.718"></a><span id="l5.718" class="difflineminus">-      {</span>
<a href="#l5.719"></a><span id="l5.719" class="difflineminus">-        rv = folder-&gt;Compact(nullptr, window);</span>
<a href="#l5.720"></a><span id="l5.720" class="difflineminus">-      }</span>
<a href="#l5.721"></a><span id="l5.721" class="difflineminus">-      else if (aCommand == kNC_CompactAll)</span>
<a href="#l5.722"></a><span id="l5.722" class="difflineminus">-      {</span>
<a href="#l5.723"></a><span id="l5.723" class="difflineminus">-        // this will also compact offline stores for IMAP</span>
<a href="#l5.724"></a><span id="l5.724" class="difflineminus">-        rv = folder-&gt;CompactAll(nullptr, window, true);</span>
<a href="#l5.725"></a><span id="l5.725" class="difflineminus">-      }</span>
<a href="#l5.726"></a><span id="l5.726" class="difflineminus">-      else if (aCommand == kNC_EmptyTrash)</span>
<a href="#l5.727"></a><span id="l5.727" class="difflineminus">-      {</span>
<a href="#l5.728"></a><span id="l5.728" class="difflineminus">-          rv = folder-&gt;EmptyTrash(window, nullptr);</span>
<a href="#l5.729"></a><span id="l5.729" class="difflineminus">-      }</span>
<a href="#l5.730"></a><span id="l5.730" class="difflineminus">-      else if (aCommand == kNC_Rename)</span>
<a href="#l5.731"></a><span id="l5.731" class="difflineminus">-      {</span>
<a href="#l5.732"></a><span id="l5.732" class="difflineminus">-        nsCOMPtr&lt;nsIRDFLiteral&gt; literal = do_QueryElementAt(arguments, 0, &amp;rv);</span>
<a href="#l5.733"></a><span id="l5.733" class="difflineminus">-        if(NS_SUCCEEDED(rv))</span>
<a href="#l5.734"></a><span id="l5.734" class="difflineminus">-        {</span>
<a href="#l5.735"></a><span id="l5.735" class="difflineminus">-          nsString name;</span>
<a href="#l5.736"></a><span id="l5.736" class="difflineminus">-          literal-&gt;GetValue(getter_Copies(name));</span>
<a href="#l5.737"></a><span id="l5.737" class="difflineminus">-          rv = folder-&gt;Rename(name, window);</span>
<a href="#l5.738"></a><span id="l5.738" class="difflineminus">-        }</span>
<a href="#l5.739"></a><span id="l5.739" class="difflineminus">-      }</span>
<a href="#l5.740"></a><span id="l5.740" class="difflineminus">-    }</span>
<a href="#l5.741"></a><span id="l5.741" class="difflineminus">-    else</span>
<a href="#l5.742"></a><span id="l5.742" class="difflineminus">-    {</span>
<a href="#l5.743"></a><span id="l5.743" class="difflineminus">-      rv = NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l5.744"></a><span id="l5.744" class="difflineminus">-    }</span>
<a href="#l5.745"></a><span id="l5.745" class="difflineminus">-  }</span>
<a href="#l5.746"></a><span id="l5.746" class="difflineminus">-  //for the moment return NS_OK, because failure stops entire DoCommand process.</span>
<a href="#l5.747"></a><span id="l5.747" class="difflineminus">-  return rv;</span>
<a href="#l5.748"></a><span id="l5.748" class="difflineminus">-  //return NS_OK;</span>
<a href="#l5.749"></a><span id="l5.749" class="difflineminus">-#endif</span>
<a href="#l5.750"></a><span id="l5.750" class="difflineminus">-}</span>
<a href="#l5.751"></a><span id="l5.751" class="difflineminus">-</span>
<a href="#l5.752"></a><span id="l5.752" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::OnItemAdded(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l5.753"></a><span id="l5.753" class="difflineminus">-{</span>
<a href="#l5.754"></a><span id="l5.754" class="difflineminus">-  return OnItemAddedOrRemoved(parentItem, item, true);</span>
<a href="#l5.755"></a><span id="l5.755" class="difflineminus">-}</span>
<a href="#l5.756"></a><span id="l5.756" class="difflineminus">-</span>
<a href="#l5.757"></a><span id="l5.757" class="difflineminus">-NS_IMETHODIMP nsMsgFolderDataSource::OnItemRemoved(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l5.758"></a><span id="l5.758" class="difflineminus">-{</span>
<a href="#l5.759"></a><span id="l5.759" class="difflineminus">-  return OnItemAddedOrRemoved(parentItem, item, false);</span>
<a href="#l5.760"></a><span id="l5.760" class="difflineminus">-}</span>
<a href="#l5.761"></a><span id="l5.761" class="difflineminus">-</span>
<a href="#l5.762"></a><span id="l5.762" class="difflineminus">-nsresult nsMsgFolderDataSource::OnItemAddedOrRemoved(nsIMsgFolder *parentItem, nsISupports *item, bool added)</span>
<a href="#l5.763"></a><span id="l5.763" class="difflineminus">-{</span>
<a href="#l5.764"></a><span id="l5.764" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt; itemNode(do_QueryInterface(item));</span>
<a href="#l5.765"></a><span id="l5.765" class="difflineminus">-  if (itemNode)</span>
<a href="#l5.766"></a><span id="l5.766" class="difflineminus">-  {</span>
<a href="#l5.767"></a><span id="l5.767" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; parentResource(do_QueryInterface(parentItem));</span>
<a href="#l5.768"></a><span id="l5.768" class="difflineminus">-    if (parentResource) // RDF is not happy about a null parent resource.</span>
<a href="#l5.769"></a><span id="l5.769" class="difflineminus">-      NotifyObservers(parentResource, kNC_Child, itemNode, nullptr, added, false);</span>
<a href="#l5.770"></a><span id="l5.770" class="difflineminus">-  }</span>
<a href="#l5.771"></a><span id="l5.771" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.772"></a><span id="l5.772" class="difflineminus">-}</span>
<a href="#l5.773"></a><span id="l5.773" class="difflineminus">-</span>
<a href="#l5.774"></a><span id="l5.774" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.775"></a><span id="l5.775" class="difflineminus">-nsMsgFolderDataSource::OnItemPropertyChanged(nsIMsgFolder *resource,</span>
<a href="#l5.776"></a><span id="l5.776" class="difflineminus">-                                             const nsACString &amp;property,</span>
<a href="#l5.777"></a><span id="l5.777" class="difflineminus">-                                             const char *oldValue,</span>
<a href="#l5.778"></a><span id="l5.778" class="difflineminus">-                                             const char *newValue)</span>
<a href="#l5.779"></a><span id="l5.779" class="difflineminus">-</span>
<a href="#l5.780"></a><span id="l5.780" class="difflineminus">-{</span>
<a href="#l5.781"></a><span id="l5.781" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.782"></a><span id="l5.782" class="difflineminus">-}</span>
<a href="#l5.783"></a><span id="l5.783" class="difflineminus">-</span>
<a href="#l5.784"></a><span id="l5.784" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.785"></a><span id="l5.785" class="difflineminus">-nsMsgFolderDataSource::OnItemIntPropertyChanged(nsIMsgFolder *folder,</span>
<a href="#l5.786"></a><span id="l5.786" class="difflineminus">-                                                const nsACString &amp;property,</span>
<a href="#l5.787"></a><span id="l5.787" class="difflineminus">-                                                int64_t oldValue,</span>
<a href="#l5.788"></a><span id="l5.788" class="difflineminus">-                                                int64_t newValue)</span>
<a href="#l5.789"></a><span id="l5.789" class="difflineminus">-{</span>
<a href="#l5.790"></a><span id="l5.790" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(folder));</span>
<a href="#l5.791"></a><span id="l5.791" class="difflineminus">-  if (property.Equals(kTotalMessages))</span>
<a href="#l5.792"></a><span id="l5.792" class="difflineminus">-    OnTotalMessagePropertyChanged(resource, oldValue, newValue);</span>
<a href="#l5.793"></a><span id="l5.793" class="difflineminus">-  else if (property.Equals(kTotalUnreadMessages))</span>
<a href="#l5.794"></a><span id="l5.794" class="difflineminus">-    OnUnreadMessagePropertyChanged(resource, oldValue, newValue);</span>
<a href="#l5.795"></a><span id="l5.795" class="difflineminus">-  else if (property.Equals(kFolderSize))</span>
<a href="#l5.796"></a><span id="l5.796" class="difflineminus">-    OnFolderSizePropertyChanged(resource, oldValue, newValue);</span>
<a href="#l5.797"></a><span id="l5.797" class="difflineminus">-  else if (property.Equals(kSortOrder))</span>
<a href="#l5.798"></a><span id="l5.798" class="difflineminus">-    OnFolderSortOrderPropertyChanged(resource, oldValue, newValue);</span>
<a href="#l5.799"></a><span id="l5.799" class="difflineminus">-  else if (property.Equals(kBiffState)) {</span>
<a href="#l5.800"></a><span id="l5.800" class="difflineminus">-    // be careful about skipping if oldValue == newValue</span>
<a href="#l5.801"></a><span id="l5.801" class="difflineminus">-    // see the comment in nsMsgFolder::SetBiffState() about filters</span>
<a href="#l5.802"></a><span id="l5.802" class="difflineminus">-</span>
<a href="#l5.803"></a><span id="l5.803" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; biffNode;</span>
<a href="#l5.804"></a><span id="l5.804" class="difflineminus">-    nsresult rv = createBiffStateNodeFromFlag(newValue, getter_AddRefs(biffNode));</span>
<a href="#l5.805"></a><span id="l5.805" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.806"></a><span id="l5.806" class="difflineminus">-</span>
<a href="#l5.807"></a><span id="l5.807" class="difflineminus">-    NotifyPropertyChanged(resource, kNC_BiffState, biffNode);</span>
<a href="#l5.808"></a><span id="l5.808" class="difflineminus">-  }</span>
<a href="#l5.809"></a><span id="l5.809" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.810"></a><span id="l5.810" class="difflineminus">-}</span>
<a href="#l5.811"></a><span id="l5.811" class="difflineminus">-</span>
<a href="#l5.812"></a><span id="l5.812" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.813"></a><span id="l5.813" class="difflineminus">-nsMsgFolderDataSource::OnItemUnicharPropertyChanged(nsIMsgFolder *folder,</span>
<a href="#l5.814"></a><span id="l5.814" class="difflineminus">-                                                    const nsACString &amp;property,</span>
<a href="#l5.815"></a><span id="l5.815" class="difflineminus">-                                                    const char16_t *oldValue,</span>
<a href="#l5.816"></a><span id="l5.816" class="difflineminus">-                                                    const char16_t *newValue)</span>
<a href="#l5.817"></a><span id="l5.817" class="difflineminus">-{</span>
<a href="#l5.818"></a><span id="l5.818" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(folder));</span>
<a href="#l5.819"></a><span id="l5.819" class="difflineminus">-  if (property.Equals(kName))</span>
<a href="#l5.820"></a><span id="l5.820" class="difflineminus">-  {</span>
<a href="#l5.821"></a><span id="l5.821" class="difflineminus">-    int32_t numUnread;</span>
<a href="#l5.822"></a><span id="l5.822" class="difflineminus">-    folder-&gt;GetNumUnread(false, &amp;numUnread);</span>
<a href="#l5.823"></a><span id="l5.823" class="difflineminus">-    NotifyFolderTreeNameChanged(folder, resource, numUnread);</span>
<a href="#l5.824"></a><span id="l5.824" class="difflineminus">-    NotifyFolderTreeSimpleNameChanged(folder, resource);</span>
<a href="#l5.825"></a><span id="l5.825" class="difflineminus">-    NotifyFolderNameChanged(folder, resource);</span>
<a href="#l5.826"></a><span id="l5.826" class="difflineminus">-  }</span>
<a href="#l5.827"></a><span id="l5.827" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.828"></a><span id="l5.828" class="difflineminus">-}</span>
<a href="#l5.829"></a><span id="l5.829" class="difflineminus">-</span>
<a href="#l5.830"></a><span id="l5.830" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.831"></a><span id="l5.831" class="difflineminus">-nsMsgFolderDataSource::OnItemBoolPropertyChanged(nsIMsgFolder *folder,</span>
<a href="#l5.832"></a><span id="l5.832" class="difflineminus">-                                                 const nsACString &amp;property,</span>
<a href="#l5.833"></a><span id="l5.833" class="difflineminus">-                                                 bool oldValue,</span>
<a href="#l5.834"></a><span id="l5.834" class="difflineminus">-                                                 bool newValue)</span>
<a href="#l5.835"></a><span id="l5.835" class="difflineminus">-{</span>
<a href="#l5.836"></a><span id="l5.836" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; resource(do_QueryInterface(folder));</span>
<a href="#l5.837"></a><span id="l5.837" class="difflineminus">-  if (newValue != oldValue) {</span>
<a href="#l5.838"></a><span id="l5.838" class="difflineminus">-    nsIRDFNode* literalNode = newValue?kTrueLiteral:kFalseLiteral;</span>
<a href="#l5.839"></a><span id="l5.839" class="difflineminus">-    nsIRDFNode* oldLiteralNode = oldValue?kTrueLiteral:kFalseLiteral;</span>
<a href="#l5.840"></a><span id="l5.840" class="difflineminus">-    if (property.Equals(kNewMessages))</span>
<a href="#l5.841"></a><span id="l5.841" class="difflineminus">-      NotifyPropertyChanged(resource, kNC_NewMessages, literalNode);</span>
<a href="#l5.842"></a><span id="l5.842" class="difflineminus">-    else if (property.Equals(kSynchronize))</span>
<a href="#l5.843"></a><span id="l5.843" class="difflineminus">-      NotifyPropertyChanged(resource, kNC_Synchronize, literalNode);</span>
<a href="#l5.844"></a><span id="l5.844" class="difflineminus">-    else if (property.Equals(kOpen))</span>
<a href="#l5.845"></a><span id="l5.845" class="difflineminus">-      NotifyPropertyChanged(resource, kNC_Open, literalNode);</span>
<a href="#l5.846"></a><span id="l5.846" class="difflineminus">-    else if (property.Equals(kIsDeferred))</span>
<a href="#l5.847"></a><span id="l5.847" class="difflineminus">-      NotifyPropertyChanged(resource, kNC_IsDeferred, literalNode, oldLiteralNode);</span>
<a href="#l5.848"></a><span id="l5.848" class="difflineminus">-    else if (property.Equals(kIsSecure))</span>
<a href="#l5.849"></a><span id="l5.849" class="difflineminus">-      NotifyPropertyChanged(resource, kNC_IsSecure, literalNode, oldLiteralNode);</span>
<a href="#l5.850"></a><span id="l5.850" class="difflineminus">-    else if (property.Equals(kCanFileMessages))</span>
<a href="#l5.851"></a><span id="l5.851" class="difflineminus">-      NotifyPropertyChanged(resource, kNC_CanFileMessages, literalNode, oldLiteralNode);</span>
<a href="#l5.852"></a><span id="l5.852" class="difflineminus">-    else if (property.Equals(kInVFEditSearchScope))</span>
<a href="#l5.853"></a><span id="l5.853" class="difflineminus">-      NotifyPropertyChanged(resource, kNC_InVFEditSearchScope, literalNode);</span>
<a href="#l5.854"></a><span id="l5.854" class="difflineminus">-  }</span>
<a href="#l5.855"></a><span id="l5.855" class="difflineminus">-</span>
<a href="#l5.856"></a><span id="l5.856" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.857"></a><span id="l5.857" class="difflineminus">-}</span>
<a href="#l5.858"></a><span id="l5.858" class="difflineminus">-</span>
<a href="#l5.859"></a><span id="l5.859" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.860"></a><span id="l5.860" class="difflineminus">-nsMsgFolderDataSource::OnItemPropertyFlagChanged(nsIMsgDBHdr *item,</span>
<a href="#l5.861"></a><span id="l5.861" class="difflineminus">-                                                 const nsACString &amp;property,</span>
<a href="#l5.862"></a><span id="l5.862" class="difflineminus">-                                                 uint32_t oldFlag,</span>
<a href="#l5.863"></a><span id="l5.863" class="difflineminus">-                                                 uint32_t newFlag)</span>
<a href="#l5.864"></a><span id="l5.864" class="difflineminus">-{</span>
<a href="#l5.865"></a><span id="l5.865" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.866"></a><span id="l5.866" class="difflineminus">-}</span>
<a href="#l5.867"></a><span id="l5.867" class="difflineminus">-</span>
<a href="#l5.868"></a><span id="l5.868" class="difflineminus">-NS_IMETHODIMP</span>
<a href="#l5.869"></a><span id="l5.869" class="difflineminus">-nsMsgFolderDataSource::OnItemEvent(nsIMsgFolder *aFolder, const nsACString &amp;aEvent)</span>
<a href="#l5.870"></a><span id="l5.870" class="difflineminus">-{</span>
<a href="#l5.871"></a><span id="l5.871" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.872"></a><span id="l5.872" class="difflineminus">-}</span>
<a href="#l5.873"></a><span id="l5.873" class="difflineminus">-</span>
<a href="#l5.874"></a><span id="l5.874" class="difflineminus">-</span>
<a href="#l5.875"></a><span id="l5.875" class="difflineminus">-nsresult nsMsgFolderDataSource::createFolderNode(nsIMsgFolder* folder,</span>
<a href="#l5.876"></a><span id="l5.876" class="difflineminus">-                                                 nsIRDFResource* property,</span>
<a href="#l5.877"></a><span id="l5.877" class="difflineminus">-                                                 nsIRDFNode** target)</span>
<a href="#l5.878"></a><span id="l5.878" class="difflineminus">-{</span>
<a href="#l5.879"></a><span id="l5.879" class="difflineminus">-  nsresult rv = NS_RDF_NO_VALUE;</span>
<a href="#l5.880"></a><span id="l5.880" class="difflineminus">-</span>
<a href="#l5.881"></a><span id="l5.881" class="difflineminus">-  if (kNC_NameSort == property)</span>
<a href="#l5.882"></a><span id="l5.882" class="difflineminus">-    rv = createFolderNameNode(folder, target, true);</span>
<a href="#l5.883"></a><span id="l5.883" class="difflineminus">-  else if(kNC_FolderTreeNameSort == property)</span>
<a href="#l5.884"></a><span id="l5.884" class="difflineminus">-    rv = createFolderNameNode(folder, target, true);</span>
<a href="#l5.885"></a><span id="l5.885" class="difflineminus">-  else if (kNC_Name == property)</span>
<a href="#l5.886"></a><span id="l5.886" class="difflineminus">-    rv = createFolderNameNode(folder, target, false);</span>
<a href="#l5.887"></a><span id="l5.887" class="difflineminus">-  else if(kNC_Open == property)</span>
<a href="#l5.888"></a><span id="l5.888" class="difflineminus">-    rv = createFolderOpenNode(folder, target);</span>
<a href="#l5.889"></a><span id="l5.889" class="difflineminus">-  else if (kNC_FolderTreeName == property)</span>
<a href="#l5.890"></a><span id="l5.890" class="difflineminus">-    rv = createFolderTreeNameNode(folder, target);</span>
<a href="#l5.891"></a><span id="l5.891" class="difflineminus">-  else if (kNC_FolderTreeSimpleName == property)</span>
<a href="#l5.892"></a><span id="l5.892" class="difflineminus">-    rv = createFolderTreeSimpleNameNode(folder, target);</span>
<a href="#l5.893"></a><span id="l5.893" class="difflineminus">-  else if (kNC_SpecialFolder == property)</span>
<a href="#l5.894"></a><span id="l5.894" class="difflineminus">-    rv = createFolderSpecialNode(folder,target);</span>
<a href="#l5.895"></a><span id="l5.895" class="difflineminus">-  else if (kNC_ServerType == property)</span>
<a href="#l5.896"></a><span id="l5.896" class="difflineminus">-    rv = createFolderServerTypeNode(folder, target);</span>
<a href="#l5.897"></a><span id="l5.897" class="difflineminus">-  else if (kNC_IsDeferred == property)</span>
<a href="#l5.898"></a><span id="l5.898" class="difflineminus">-    rv = createServerIsDeferredNode(folder, target);</span>
<a href="#l5.899"></a><span id="l5.899" class="difflineminus">-  else if (kNC_CanCreateFoldersOnServer == property)</span>
<a href="#l5.900"></a><span id="l5.900" class="difflineminus">-    rv = createFolderCanCreateFoldersOnServerNode(folder, target);</span>
<a href="#l5.901"></a><span id="l5.901" class="difflineminus">-  else if (kNC_CanFileMessagesOnServer == property)</span>
<a href="#l5.902"></a><span id="l5.902" class="difflineminus">-    rv = createFolderCanFileMessagesOnServerNode(folder, target);</span>
<a href="#l5.903"></a><span id="l5.903" class="difflineminus">-  else if (kNC_IsServer == property)</span>
<a href="#l5.904"></a><span id="l5.904" class="difflineminus">-    rv = createFolderIsServerNode(folder, target);</span>
<a href="#l5.905"></a><span id="l5.905" class="difflineminus">-  else if (kNC_IsSecure == property)</span>
<a href="#l5.906"></a><span id="l5.906" class="difflineminus">-    rv = createFolderIsSecureNode(folder, target);</span>
<a href="#l5.907"></a><span id="l5.907" class="difflineminus">-  else if (kNC_CanSubscribe == property)</span>
<a href="#l5.908"></a><span id="l5.908" class="difflineminus">-    rv = createFolderCanSubscribeNode(folder, target);</span>
<a href="#l5.909"></a><span id="l5.909" class="difflineminus">-  else if (kNC_SupportsOffline == property)</span>
<a href="#l5.910"></a><span id="l5.910" class="difflineminus">-    rv = createFolderSupportsOfflineNode(folder, target);</span>
<a href="#l5.911"></a><span id="l5.911" class="difflineminus">-  else if (kNC_CanFileMessages == property)</span>
<a href="#l5.912"></a><span id="l5.912" class="difflineminus">-    rv = createFolderCanFileMessagesNode(folder, target);</span>
<a href="#l5.913"></a><span id="l5.913" class="difflineminus">-  else if (kNC_CanCreateSubfolders == property)</span>
<a href="#l5.914"></a><span id="l5.914" class="difflineminus">-    rv = createFolderCanCreateSubfoldersNode(folder, target);</span>
<a href="#l5.915"></a><span id="l5.915" class="difflineminus">-  else if (kNC_CanRename == property)</span>
<a href="#l5.916"></a><span id="l5.916" class="difflineminus">-    rv = createFolderCanRenameNode(folder, target);</span>
<a href="#l5.917"></a><span id="l5.917" class="difflineminus">-  else if (kNC_CanCompact == property)</span>
<a href="#l5.918"></a><span id="l5.918" class="difflineminus">-    rv = createFolderCanCompactNode(folder, target);</span>
<a href="#l5.919"></a><span id="l5.919" class="difflineminus">-  else if (kNC_TotalMessages == property)</span>
<a href="#l5.920"></a><span id="l5.920" class="difflineminus">-    rv = createTotalMessagesNode(folder, target);</span>
<a href="#l5.921"></a><span id="l5.921" class="difflineminus">-  else if (kNC_TotalUnreadMessages == property)</span>
<a href="#l5.922"></a><span id="l5.922" class="difflineminus">-    rv = createUnreadMessagesNode(folder, target);</span>
<a href="#l5.923"></a><span id="l5.923" class="difflineminus">-  else if (kNC_FolderSize == property)</span>
<a href="#l5.924"></a><span id="l5.924" class="difflineminus">-    rv = createFolderSizeNode(folder, target);</span>
<a href="#l5.925"></a><span id="l5.925" class="difflineminus">-  else if (kNC_Charset == property)</span>
<a href="#l5.926"></a><span id="l5.926" class="difflineminus">-    rv = createCharsetNode(folder, target);</span>
<a href="#l5.927"></a><span id="l5.927" class="difflineminus">-  else if (kNC_BiffState == property)</span>
<a href="#l5.928"></a><span id="l5.928" class="difflineminus">-    rv = createBiffStateNodeFromFolder(folder, target);</span>
<a href="#l5.929"></a><span id="l5.929" class="difflineminus">-  else if (kNC_HasUnreadMessages == property)</span>
<a href="#l5.930"></a><span id="l5.930" class="difflineminus">-    rv = createHasUnreadMessagesNode(folder, false, target);</span>
<a href="#l5.931"></a><span id="l5.931" class="difflineminus">-  else if (kNC_NewMessages == property)</span>
<a href="#l5.932"></a><span id="l5.932" class="difflineminus">-    rv = createNewMessagesNode(folder, target);</span>
<a href="#l5.933"></a><span id="l5.933" class="difflineminus">-  else if (kNC_SubfoldersHaveUnreadMessages == property)</span>
<a href="#l5.934"></a><span id="l5.934" class="difflineminus">-    rv = createHasUnreadMessagesNode(folder, true, target);</span>
<a href="#l5.935"></a><span id="l5.935" class="difflineminus">-  else if (kNC_Child == property)</span>
<a href="#l5.936"></a><span id="l5.936" class="difflineminus">-    rv = createFolderChildNode(folder, target);</span>
<a href="#l5.937"></a><span id="l5.937" class="difflineminus">-  else if (kNC_NoSelect == property)</span>
<a href="#l5.938"></a><span id="l5.938" class="difflineminus">-    rv = createFolderNoSelectNode(folder, target);</span>
<a href="#l5.939"></a><span id="l5.939" class="difflineminus">-  else if (kNC_VirtualFolder == property)</span>
<a href="#l5.940"></a><span id="l5.940" class="difflineminus">-    rv = createFolderVirtualNode(folder, target);</span>
<a href="#l5.941"></a><span id="l5.941" class="difflineminus">-  else if (kNC_InVFEditSearchScope == property)</span>
<a href="#l5.942"></a><span id="l5.942" class="difflineminus">-    rv = createInVFEditSearchScopeNode(folder, target);</span>
<a href="#l5.943"></a><span id="l5.943" class="difflineminus">-  else if (kNC_ImapShared == property)</span>
<a href="#l5.944"></a><span id="l5.944" class="difflineminus">-    rv = createFolderImapSharedNode(folder, target);</span>
<a href="#l5.945"></a><span id="l5.945" class="difflineminus">-  else if (kNC_Synchronize == property)</span>
<a href="#l5.946"></a><span id="l5.946" class="difflineminus">-    rv = createFolderSynchronizeNode(folder, target);</span>
<a href="#l5.947"></a><span id="l5.947" class="difflineminus">-  else if (kNC_SyncDisabled == property)</span>
<a href="#l5.948"></a><span id="l5.948" class="difflineminus">-    rv = createFolderSyncDisabledNode(folder, target);</span>
<a href="#l5.949"></a><span id="l5.949" class="difflineminus">-  else if (kNC_CanSearchMessages == property)</span>
<a href="#l5.950"></a><span id="l5.950" class="difflineminus">-    rv = createCanSearchMessages(folder, target);</span>
<a href="#l5.951"></a><span id="l5.951" class="difflineminus">-  return NS_FAILED(rv) ? NS_RDF_NO_VALUE : rv;</span>
<a href="#l5.952"></a><span id="l5.952" class="difflineminus">-}</span>
<a href="#l5.953"></a><span id="l5.953" class="difflineminus">-</span>
<a href="#l5.954"></a><span id="l5.954" class="difflineminus">-nsresult</span>
<a href="#l5.955"></a><span id="l5.955" class="difflineminus">-nsMsgFolderDataSource::createFolderNameNode(nsIMsgFolder *folder,</span>
<a href="#l5.956"></a><span id="l5.956" class="difflineminus">-                                            nsIRDFNode **target, bool sort)</span>
<a href="#l5.957"></a><span id="l5.957" class="difflineminus">-{</span>
<a href="#l5.958"></a><span id="l5.958" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.959"></a><span id="l5.959" class="difflineminus">-  if (sort)</span>
<a href="#l5.960"></a><span id="l5.960" class="difflineminus">-  {</span>
<a href="#l5.961"></a><span id="l5.961" class="difflineminus">-    uint8_t *sortKey=nullptr;</span>
<a href="#l5.962"></a><span id="l5.962" class="difflineminus">-    uint32_t sortKeyLength;</span>
<a href="#l5.963"></a><span id="l5.963" class="difflineminus">-    rv = folder-&gt;GetSortKey(&amp;sortKeyLength, &amp;sortKey);</span>
<a href="#l5.964"></a><span id="l5.964" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.965"></a><span id="l5.965" class="difflineminus">-    createBlobNode(sortKey, sortKeyLength, target, getRDFService());</span>
<a href="#l5.966"></a><span id="l5.966" class="difflineminus">-    PR_Free(sortKey);</span>
<a href="#l5.967"></a><span id="l5.967" class="difflineminus">-  }</span>
<a href="#l5.968"></a><span id="l5.968" class="difflineminus">-  else</span>
<a href="#l5.969"></a><span id="l5.969" class="difflineminus">-  {</span>
<a href="#l5.970"></a><span id="l5.970" class="difflineminus">-    nsString name;</span>
<a href="#l5.971"></a><span id="l5.971" class="difflineminus">-    rv = folder-&gt;GetName(name);</span>
<a href="#l5.972"></a><span id="l5.972" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l5.973"></a><span id="l5.973" class="difflineminus">-      return rv;</span>
<a href="#l5.974"></a><span id="l5.974" class="difflineminus">-    createNode(name.get(), target, getRDFService());</span>
<a href="#l5.975"></a><span id="l5.975" class="difflineminus">-  }</span>
<a href="#l5.976"></a><span id="l5.976" class="difflineminus">-</span>
<a href="#l5.977"></a><span id="l5.977" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.978"></a><span id="l5.978" class="difflineminus">-}</span>
<a href="#l5.979"></a><span id="l5.979" class="difflineminus">-</span>
<a href="#l5.980"></a><span id="l5.980" class="difflineminus">-nsresult nsMsgFolderDataSource::GetFolderDisplayName(nsIMsgFolder *folder, nsString&amp; folderName)</span>
<a href="#l5.981"></a><span id="l5.981" class="difflineminus">-{</span>
<a href="#l5.982"></a><span id="l5.982" class="difflineminus">-  return folder-&gt;GetAbbreviatedName(folderName);</span>
<a href="#l5.983"></a><span id="l5.983" class="difflineminus">-}</span>
<a href="#l5.984"></a><span id="l5.984" class="difflineminus">-</span>
<a href="#l5.985"></a><span id="l5.985" class="difflineminus">-nsresult</span>
<a href="#l5.986"></a><span id="l5.986" class="difflineminus">-nsMsgFolderDataSource::createFolderTreeNameNode(nsIMsgFolder *folder,</span>
<a href="#l5.987"></a><span id="l5.987" class="difflineminus">-                                                nsIRDFNode **target)</span>
<a href="#l5.988"></a><span id="l5.988" class="difflineminus">-{</span>
<a href="#l5.989"></a><span id="l5.989" class="difflineminus">-  nsString name;</span>
<a href="#l5.990"></a><span id="l5.990" class="difflineminus">-  nsresult rv = GetFolderDisplayName(folder, name);</span>
<a href="#l5.991"></a><span id="l5.991" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.992"></a><span id="l5.992" class="difflineminus">-  nsAutoString nameString(name);</span>
<a href="#l5.993"></a><span id="l5.993" class="difflineminus">-  int32_t unreadMessages;</span>
<a href="#l5.994"></a><span id="l5.994" class="difflineminus">-</span>
<a href="#l5.995"></a><span id="l5.995" class="difflineminus">-  rv = folder-&gt;GetNumUnread(false, &amp;unreadMessages);</span>
<a href="#l5.996"></a><span id="l5.996" class="difflineminus">-  if(NS_SUCCEEDED(rv))</span>
<a href="#l5.997"></a><span id="l5.997" class="difflineminus">-    CreateUnreadMessagesNameString(unreadMessages, nameString);</span>
<a href="#l5.998"></a><span id="l5.998" class="difflineminus">-</span>
<a href="#l5.999"></a><span id="l5.999" class="difflineminus">-  createNode(nameString.get(), target, getRDFService());</span>
<a href="#l5.1000"></a><span id="l5.1000" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1001"></a><span id="l5.1001" class="difflineminus">-}</span>
<a href="#l5.1002"></a><span id="l5.1002" class="difflineminus">-</span>
<a href="#l5.1003"></a><span id="l5.1003" class="difflineminus">-nsresult nsMsgFolderDataSource::createFolderTreeSimpleNameNode(nsIMsgFolder * folder, nsIRDFNode **target)</span>
<a href="#l5.1004"></a><span id="l5.1004" class="difflineminus">-{</span>
<a href="#l5.1005"></a><span id="l5.1005" class="difflineminus">-  nsString name;</span>
<a href="#l5.1006"></a><span id="l5.1006" class="difflineminus">-  nsresult rv = GetFolderDisplayName(folder, name);</span>
<a href="#l5.1007"></a><span id="l5.1007" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1008"></a><span id="l5.1008" class="difflineminus">-</span>
<a href="#l5.1009"></a><span id="l5.1009" class="difflineminus">-  createNode(name.get(), target, getRDFService());</span>
<a href="#l5.1010"></a><span id="l5.1010" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1011"></a><span id="l5.1011" class="difflineminus">-}</span>
<a href="#l5.1012"></a><span id="l5.1012" class="difflineminus">-</span>
<a href="#l5.1013"></a><span id="l5.1013" class="difflineminus">-nsresult nsMsgFolderDataSource::CreateUnreadMessagesNameString(int32_t unreadMessages, nsAutoString &amp;nameString)</span>
<a href="#l5.1014"></a><span id="l5.1014" class="difflineminus">-{</span>
<a href="#l5.1015"></a><span id="l5.1015" class="difflineminus">-  //Only do this if unread messages are positive</span>
<a href="#l5.1016"></a><span id="l5.1016" class="difflineminus">-  if(unreadMessages &gt; 0)</span>
<a href="#l5.1017"></a><span id="l5.1017" class="difflineminus">-  {</span>
<a href="#l5.1018"></a><span id="l5.1018" class="difflineminus">-    nameString.AppendLiteral(u&quot; (&quot;);</span>
<a href="#l5.1019"></a><span id="l5.1019" class="difflineminus">-    nameString.AppendInt(unreadMessages);</span>
<a href="#l5.1020"></a><span id="l5.1020" class="difflineminus">-    nameString.Append(u')');</span>
<a href="#l5.1021"></a><span id="l5.1021" class="difflineminus">-  }</span>
<a href="#l5.1022"></a><span id="l5.1022" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1023"></a><span id="l5.1023" class="difflineminus">-}</span>
<a href="#l5.1024"></a><span id="l5.1024" class="difflineminus">-</span>
<a href="#l5.1025"></a><span id="l5.1025" class="difflineminus">-nsresult</span>
<a href="#l5.1026"></a><span id="l5.1026" class="difflineminus">-nsMsgFolderDataSource::createFolderSpecialNode(nsIMsgFolder *folder,</span>
<a href="#l5.1027"></a><span id="l5.1027" class="difflineminus">-                                               nsIRDFNode **target)</span>
<a href="#l5.1028"></a><span id="l5.1028" class="difflineminus">-{</span>
<a href="#l5.1029"></a><span id="l5.1029" class="difflineminus">-  uint32_t flags;</span>
<a href="#l5.1030"></a><span id="l5.1030" class="difflineminus">-  nsresult rv = folder-&gt;GetFlags(&amp;flags);</span>
<a href="#l5.1031"></a><span id="l5.1031" class="difflineminus">-  if(NS_FAILED(rv))</span>
<a href="#l5.1032"></a><span id="l5.1032" class="difflineminus">-    return rv;</span>
<a href="#l5.1033"></a><span id="l5.1033" class="difflineminus">-</span>
<a href="#l5.1034"></a><span id="l5.1034" class="difflineminus">-  nsAutoString specialFolderString;</span>
<a href="#l5.1035"></a><span id="l5.1035" class="difflineminus">-  if (flags &amp; nsMsgFolderFlags::Inbox)</span>
<a href="#l5.1036"></a><span id="l5.1036" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Inbox&quot;);</span>
<a href="#l5.1037"></a><span id="l5.1037" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::Trash)</span>
<a href="#l5.1038"></a><span id="l5.1038" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Trash&quot;);</span>
<a href="#l5.1039"></a><span id="l5.1039" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::Queue)</span>
<a href="#l5.1040"></a><span id="l5.1040" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Outbox&quot;);</span>
<a href="#l5.1041"></a><span id="l5.1041" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::SentMail)</span>
<a href="#l5.1042"></a><span id="l5.1042" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Sent&quot;);</span>
<a href="#l5.1043"></a><span id="l5.1043" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::Drafts)</span>
<a href="#l5.1044"></a><span id="l5.1044" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Drafts&quot;);</span>
<a href="#l5.1045"></a><span id="l5.1045" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::Templates)</span>
<a href="#l5.1046"></a><span id="l5.1046" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Templates&quot;);</span>
<a href="#l5.1047"></a><span id="l5.1047" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::Junk)</span>
<a href="#l5.1048"></a><span id="l5.1048" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Junk&quot;);</span>
<a href="#l5.1049"></a><span id="l5.1049" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::Virtual)</span>
<a href="#l5.1050"></a><span id="l5.1050" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Virtual&quot;);</span>
<a href="#l5.1051"></a><span id="l5.1051" class="difflineminus">-  else if (flags &amp; nsMsgFolderFlags::Archive)</span>
<a href="#l5.1052"></a><span id="l5.1052" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;Archives&quot;);</span>
<a href="#l5.1053"></a><span id="l5.1053" class="difflineminus">-  else {</span>
<a href="#l5.1054"></a><span id="l5.1054" class="difflineminus">-    // XXX why do this at all? or just &quot;&quot;</span>
<a href="#l5.1055"></a><span id="l5.1055" class="difflineminus">-    specialFolderString.AssignLiteral(&quot;none&quot;);</span>
<a href="#l5.1056"></a><span id="l5.1056" class="difflineminus">-  }</span>
<a href="#l5.1057"></a><span id="l5.1057" class="difflineminus">-</span>
<a href="#l5.1058"></a><span id="l5.1058" class="difflineminus">-  createNode(specialFolderString.get(), target, getRDFService());</span>
<a href="#l5.1059"></a><span id="l5.1059" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1060"></a><span id="l5.1060" class="difflineminus">-}</span>
<a href="#l5.1061"></a><span id="l5.1061" class="difflineminus">-</span>
<a href="#l5.1062"></a><span id="l5.1062" class="difflineminus">-nsresult</span>
<a href="#l5.1063"></a><span id="l5.1063" class="difflineminus">-nsMsgFolderDataSource::createFolderServerTypeNode(nsIMsgFolder* folder,</span>
<a href="#l5.1064"></a><span id="l5.1064" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1065"></a><span id="l5.1065" class="difflineminus">-{</span>
<a href="#l5.1066"></a><span id="l5.1066" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1067"></a><span id="l5.1067" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.1068"></a><span id="l5.1068" class="difflineminus">-  rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.1069"></a><span id="l5.1069" class="difflineminus">-  if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l5.1070"></a><span id="l5.1070" class="difflineminus">-</span>
<a href="#l5.1071"></a><span id="l5.1071" class="difflineminus">-  nsCString serverType;</span>
<a href="#l5.1072"></a><span id="l5.1072" class="difflineminus">-  rv = server-&gt;GetType(serverType);</span>
<a href="#l5.1073"></a><span id="l5.1073" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1074"></a><span id="l5.1074" class="difflineminus">-</span>
<a href="#l5.1075"></a><span id="l5.1075" class="difflineminus">-  createNode(NS_ConvertASCIItoUTF16(serverType).get(), target, getRDFService());</span>
<a href="#l5.1076"></a><span id="l5.1076" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1077"></a><span id="l5.1077" class="difflineminus">-}</span>
<a href="#l5.1078"></a><span id="l5.1078" class="difflineminus">-</span>
<a href="#l5.1079"></a><span id="l5.1079" class="difflineminus">-nsresult</span>
<a href="#l5.1080"></a><span id="l5.1080" class="difflineminus">-nsMsgFolderDataSource::createServerIsDeferredNode(nsIMsgFolder* folder,</span>
<a href="#l5.1081"></a><span id="l5.1081" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1082"></a><span id="l5.1082" class="difflineminus">-{</span>
<a href="#l5.1083"></a><span id="l5.1083" class="difflineminus">-  bool isDeferred = false;</span>
<a href="#l5.1084"></a><span id="l5.1084" class="difflineminus">-  nsCOMPtr &lt;nsIMsgIncomingServer&gt; incomingServer;</span>
<a href="#l5.1085"></a><span id="l5.1085" class="difflineminus">-  folder-&gt;GetServer(getter_AddRefs(incomingServer));</span>
<a href="#l5.1086"></a><span id="l5.1086" class="difflineminus">-  if (incomingServer)</span>
<a href="#l5.1087"></a><span id="l5.1087" class="difflineminus">-  {</span>
<a href="#l5.1088"></a><span id="l5.1088" class="difflineminus">-    nsCOMPtr &lt;nsIPop3IncomingServer&gt; pop3Server = do_QueryInterface(incomingServer);</span>
<a href="#l5.1089"></a><span id="l5.1089" class="difflineminus">-    if (pop3Server)</span>
<a href="#l5.1090"></a><span id="l5.1090" class="difflineminus">-    {</span>
<a href="#l5.1091"></a><span id="l5.1091" class="difflineminus">-      nsCString deferredToServer;</span>
<a href="#l5.1092"></a><span id="l5.1092" class="difflineminus">-      pop3Server-&gt;GetDeferredToAccount(deferredToServer);</span>
<a href="#l5.1093"></a><span id="l5.1093" class="difflineminus">-      isDeferred = !deferredToServer.IsEmpty();</span>
<a href="#l5.1094"></a><span id="l5.1094" class="difflineminus">-    }</span>
<a href="#l5.1095"></a><span id="l5.1095" class="difflineminus">-  }</span>
<a href="#l5.1096"></a><span id="l5.1096" class="difflineminus">-  NS_IF_ADDREF(*target = isDeferred ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1097"></a><span id="l5.1097" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1098"></a><span id="l5.1098" class="difflineminus">-}</span>
<a href="#l5.1099"></a><span id="l5.1099" class="difflineminus">-</span>
<a href="#l5.1100"></a><span id="l5.1100" class="difflineminus">-nsresult</span>
<a href="#l5.1101"></a><span id="l5.1101" class="difflineminus">-nsMsgFolderDataSource::createFolderCanCreateFoldersOnServerNode(nsIMsgFolder* folder,</span>
<a href="#l5.1102"></a><span id="l5.1102" class="difflineminus">-                                                                 nsIRDFNode **target)</span>
<a href="#l5.1103"></a><span id="l5.1103" class="difflineminus">-{</span>
<a href="#l5.1104"></a><span id="l5.1104" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1105"></a><span id="l5.1105" class="difflineminus">-</span>
<a href="#l5.1106"></a><span id="l5.1106" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.1107"></a><span id="l5.1107" class="difflineminus">-  rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.1108"></a><span id="l5.1108" class="difflineminus">-  if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l5.1109"></a><span id="l5.1109" class="difflineminus">-</span>
<a href="#l5.1110"></a><span id="l5.1110" class="difflineminus">-  bool canCreateFoldersOnServer;</span>
<a href="#l5.1111"></a><span id="l5.1111" class="difflineminus">-  rv = server-&gt;GetCanCreateFoldersOnServer(&amp;canCreateFoldersOnServer);</span>
<a href="#l5.1112"></a><span id="l5.1112" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1113"></a><span id="l5.1113" class="difflineminus">-</span>
<a href="#l5.1114"></a><span id="l5.1114" class="difflineminus">-  NS_IF_ADDREF(*target = canCreateFoldersOnServer ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1115"></a><span id="l5.1115" class="difflineminus">-</span>
<a href="#l5.1116"></a><span id="l5.1116" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1117"></a><span id="l5.1117" class="difflineminus">-}</span>
<a href="#l5.1118"></a><span id="l5.1118" class="difflineminus">-</span>
<a href="#l5.1119"></a><span id="l5.1119" class="difflineminus">-nsresult</span>
<a href="#l5.1120"></a><span id="l5.1120" class="difflineminus">-nsMsgFolderDataSource::createFolderCanFileMessagesOnServerNode(nsIMsgFolder* folder,</span>
<a href="#l5.1121"></a><span id="l5.1121" class="difflineminus">-                                                                 nsIRDFNode **target)</span>
<a href="#l5.1122"></a><span id="l5.1122" class="difflineminus">-{</span>
<a href="#l5.1123"></a><span id="l5.1123" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1124"></a><span id="l5.1124" class="difflineminus">-</span>
<a href="#l5.1125"></a><span id="l5.1125" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.1126"></a><span id="l5.1126" class="difflineminus">-  rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.1127"></a><span id="l5.1127" class="difflineminus">-  if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l5.1128"></a><span id="l5.1128" class="difflineminus">-</span>
<a href="#l5.1129"></a><span id="l5.1129" class="difflineminus">-  bool canFileMessagesOnServer;</span>
<a href="#l5.1130"></a><span id="l5.1130" class="difflineminus">-  rv = server-&gt;GetCanFileMessagesOnServer(&amp;canFileMessagesOnServer);</span>
<a href="#l5.1131"></a><span id="l5.1131" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1132"></a><span id="l5.1132" class="difflineminus">-</span>
<a href="#l5.1133"></a><span id="l5.1133" class="difflineminus">-  NS_IF_ADDREF(*target = canFileMessagesOnServer ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1134"></a><span id="l5.1134" class="difflineminus">-</span>
<a href="#l5.1135"></a><span id="l5.1135" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1136"></a><span id="l5.1136" class="difflineminus">-}</span>
<a href="#l5.1137"></a><span id="l5.1137" class="difflineminus">-</span>
<a href="#l5.1138"></a><span id="l5.1138" class="difflineminus">-</span>
<a href="#l5.1139"></a><span id="l5.1139" class="difflineminus">-nsresult</span>
<a href="#l5.1140"></a><span id="l5.1140" class="difflineminus">-nsMsgFolderDataSource::createFolderIsServerNode(nsIMsgFolder* folder,</span>
<a href="#l5.1141"></a><span id="l5.1141" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1142"></a><span id="l5.1142" class="difflineminus">-{</span>
<a href="#l5.1143"></a><span id="l5.1143" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1144"></a><span id="l5.1144" class="difflineminus">-  bool isServer;</span>
<a href="#l5.1145"></a><span id="l5.1145" class="difflineminus">-  rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1146"></a><span id="l5.1146" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1147"></a><span id="l5.1147" class="difflineminus">-</span>
<a href="#l5.1148"></a><span id="l5.1148" class="difflineminus">-  *target = nullptr;</span>
<a href="#l5.1149"></a><span id="l5.1149" class="difflineminus">-</span>
<a href="#l5.1150"></a><span id="l5.1150" class="difflineminus">-  NS_IF_ADDREF(*target = isServer ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1151"></a><span id="l5.1151" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1152"></a><span id="l5.1152" class="difflineminus">-}</span>
<a href="#l5.1153"></a><span id="l5.1153" class="difflineminus">-</span>
<a href="#l5.1154"></a><span id="l5.1154" class="difflineminus">-nsresult</span>
<a href="#l5.1155"></a><span id="l5.1155" class="difflineminus">-nsMsgFolderDataSource::createFolderNoSelectNode(nsIMsgFolder* folder,</span>
<a href="#l5.1156"></a><span id="l5.1156" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1157"></a><span id="l5.1157" class="difflineminus">-{</span>
<a href="#l5.1158"></a><span id="l5.1158" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1159"></a><span id="l5.1159" class="difflineminus">-  bool noSelect;</span>
<a href="#l5.1160"></a><span id="l5.1160" class="difflineminus">-  rv = folder-&gt;GetNoSelect(&amp;noSelect);</span>
<a href="#l5.1161"></a><span id="l5.1161" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1162"></a><span id="l5.1162" class="difflineminus">-</span>
<a href="#l5.1163"></a><span id="l5.1163" class="difflineminus">-  NS_IF_ADDREF(*target = noSelect ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1164"></a><span id="l5.1164" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1165"></a><span id="l5.1165" class="difflineminus">-}</span>
<a href="#l5.1166"></a><span id="l5.1166" class="difflineminus">-</span>
<a href="#l5.1167"></a><span id="l5.1167" class="difflineminus">-nsresult</span>
<a href="#l5.1168"></a><span id="l5.1168" class="difflineminus">-nsMsgFolderDataSource::createInVFEditSearchScopeNode(nsIMsgFolder* folder,</span>
<a href="#l5.1169"></a><span id="l5.1169" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1170"></a><span id="l5.1170" class="difflineminus">-{</span>
<a href="#l5.1171"></a><span id="l5.1171" class="difflineminus">-  bool inVFEditSearchScope = false;</span>
<a href="#l5.1172"></a><span id="l5.1172" class="difflineminus">-  folder-&gt;GetInVFEditSearchScope(&amp;inVFEditSearchScope);</span>
<a href="#l5.1173"></a><span id="l5.1173" class="difflineminus">-</span>
<a href="#l5.1174"></a><span id="l5.1174" class="difflineminus">-  NS_IF_ADDREF(*target = inVFEditSearchScope ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1175"></a><span id="l5.1175" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1176"></a><span id="l5.1176" class="difflineminus">-}</span>
<a href="#l5.1177"></a><span id="l5.1177" class="difflineminus">-</span>
<a href="#l5.1178"></a><span id="l5.1178" class="difflineminus">-nsresult</span>
<a href="#l5.1179"></a><span id="l5.1179" class="difflineminus">-nsMsgFolderDataSource::createFolderVirtualNode(nsIMsgFolder* folder,</span>
<a href="#l5.1180"></a><span id="l5.1180" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1181"></a><span id="l5.1181" class="difflineminus">-{</span>
<a href="#l5.1182"></a><span id="l5.1182" class="difflineminus">-  uint32_t folderFlags;</span>
<a href="#l5.1183"></a><span id="l5.1183" class="difflineminus">-  folder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l5.1184"></a><span id="l5.1184" class="difflineminus">-</span>
<a href="#l5.1185"></a><span id="l5.1185" class="difflineminus">-  NS_IF_ADDREF(*target = (folderFlags &amp; nsMsgFolderFlags::Virtual) ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1186"></a><span id="l5.1186" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1187"></a><span id="l5.1187" class="difflineminus">-}</span>
<a href="#l5.1188"></a><span id="l5.1188" class="difflineminus">-</span>
<a href="#l5.1189"></a><span id="l5.1189" class="difflineminus">-</span>
<a href="#l5.1190"></a><span id="l5.1190" class="difflineminus">-nsresult</span>
<a href="#l5.1191"></a><span id="l5.1191" class="difflineminus">-nsMsgFolderDataSource::createFolderImapSharedNode(nsIMsgFolder* folder,</span>
<a href="#l5.1192"></a><span id="l5.1192" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1193"></a><span id="l5.1193" class="difflineminus">-{</span>
<a href="#l5.1194"></a><span id="l5.1194" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1195"></a><span id="l5.1195" class="difflineminus">-  bool imapShared;</span>
<a href="#l5.1196"></a><span id="l5.1196" class="difflineminus">-  rv = folder-&gt;GetImapShared(&amp;imapShared);</span>
<a href="#l5.1197"></a><span id="l5.1197" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1198"></a><span id="l5.1198" class="difflineminus">-</span>
<a href="#l5.1199"></a><span id="l5.1199" class="difflineminus">-  NS_IF_ADDREF(*target = imapShared ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1200"></a><span id="l5.1200" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1201"></a><span id="l5.1201" class="difflineminus">-}</span>
<a href="#l5.1202"></a><span id="l5.1202" class="difflineminus">-</span>
<a href="#l5.1203"></a><span id="l5.1203" class="difflineminus">-</span>
<a href="#l5.1204"></a><span id="l5.1204" class="difflineminus">-nsresult</span>
<a href="#l5.1205"></a><span id="l5.1205" class="difflineminus">-nsMsgFolderDataSource::createFolderSynchronizeNode(nsIMsgFolder* folder,</span>
<a href="#l5.1206"></a><span id="l5.1206" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1207"></a><span id="l5.1207" class="difflineminus">-{</span>
<a href="#l5.1208"></a><span id="l5.1208" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1209"></a><span id="l5.1209" class="difflineminus">-  bool sync;</span>
<a href="#l5.1210"></a><span id="l5.1210" class="difflineminus">-  rv = folder-&gt;GetFlag(nsMsgFolderFlags::Offline, &amp;sync);</span>
<a href="#l5.1211"></a><span id="l5.1211" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1212"></a><span id="l5.1212" class="difflineminus">-</span>
<a href="#l5.1213"></a><span id="l5.1213" class="difflineminus">-  NS_IF_ADDREF(*target = sync ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1214"></a><span id="l5.1214" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1215"></a><span id="l5.1215" class="difflineminus">-}</span>
<a href="#l5.1216"></a><span id="l5.1216" class="difflineminus">-</span>
<a href="#l5.1217"></a><span id="l5.1217" class="difflineminus">-nsresult</span>
<a href="#l5.1218"></a><span id="l5.1218" class="difflineminus">-nsMsgFolderDataSource::createFolderSyncDisabledNode(nsIMsgFolder* folder,</span>
<a href="#l5.1219"></a><span id="l5.1219" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1220"></a><span id="l5.1220" class="difflineminus">-{</span>
<a href="#l5.1221"></a><span id="l5.1221" class="difflineminus">-</span>
<a href="#l5.1222"></a><span id="l5.1222" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1223"></a><span id="l5.1223" class="difflineminus">-  bool isServer;</span>
<a href="#l5.1224"></a><span id="l5.1224" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.1225"></a><span id="l5.1225" class="difflineminus">-</span>
<a href="#l5.1226"></a><span id="l5.1226" class="difflineminus">-  rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1227"></a><span id="l5.1227" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1228"></a><span id="l5.1228" class="difflineminus">-</span>
<a href="#l5.1229"></a><span id="l5.1229" class="difflineminus">-  rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.1230"></a><span id="l5.1230" class="difflineminus">-  if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l5.1231"></a><span id="l5.1231" class="difflineminus">-</span>
<a href="#l5.1232"></a><span id="l5.1232" class="difflineminus">-  nsCString serverType;</span>
<a href="#l5.1233"></a><span id="l5.1233" class="difflineminus">-  rv = server-&gt;GetType(serverType);</span>
<a href="#l5.1234"></a><span id="l5.1234" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1235"></a><span id="l5.1235" class="difflineminus">-</span>
<a href="#l5.1236"></a><span id="l5.1236" class="difflineminus">-  NS_IF_ADDREF(*target = (isServer || MsgLowerCaseEqualsLiteral(serverType, &quot;none&quot;) ||</span>
<a href="#l5.1237"></a><span id="l5.1237" class="difflineminus">-                                      MsgLowerCaseEqualsLiteral(serverType, &quot;pop3&quot;)) ?</span>
<a href="#l5.1238"></a><span id="l5.1238" class="difflineminus">-              kTrueLiteral : kFalseLiteral</span>
<a href="#l5.1239"></a><span id="l5.1239" class="difflineminus">-  );</span>
<a href="#l5.1240"></a><span id="l5.1240" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1241"></a><span id="l5.1241" class="difflineminus">-}</span>
<a href="#l5.1242"></a><span id="l5.1242" class="difflineminus">-</span>
<a href="#l5.1243"></a><span id="l5.1243" class="difflineminus">-nsresult</span>
<a href="#l5.1244"></a><span id="l5.1244" class="difflineminus">-nsMsgFolderDataSource::createCanSearchMessages(nsIMsgFolder* folder,</span>
<a href="#l5.1245"></a><span id="l5.1245" class="difflineminus">-                                                                 nsIRDFNode **target)</span>
<a href="#l5.1246"></a><span id="l5.1246" class="difflineminus">-{</span>
<a href="#l5.1247"></a><span id="l5.1247" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1248"></a><span id="l5.1248" class="difflineminus">-</span>
<a href="#l5.1249"></a><span id="l5.1249" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.1250"></a><span id="l5.1250" class="difflineminus">-  rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.1251"></a><span id="l5.1251" class="difflineminus">-  if (NS_FAILED(rv) || !server) return NS_ERROR_FAILURE;</span>
<a href="#l5.1252"></a><span id="l5.1252" class="difflineminus">-</span>
<a href="#l5.1253"></a><span id="l5.1253" class="difflineminus">-  bool canSearchMessages;</span>
<a href="#l5.1254"></a><span id="l5.1254" class="difflineminus">-  rv = server-&gt;GetCanSearchMessages(&amp;canSearchMessages);</span>
<a href="#l5.1255"></a><span id="l5.1255" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1256"></a><span id="l5.1256" class="difflineminus">-</span>
<a href="#l5.1257"></a><span id="l5.1257" class="difflineminus">-  NS_IF_ADDREF(*target = canSearchMessages ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1258"></a><span id="l5.1258" class="difflineminus">-</span>
<a href="#l5.1259"></a><span id="l5.1259" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1260"></a><span id="l5.1260" class="difflineminus">-}</span>
<a href="#l5.1261"></a><span id="l5.1261" class="difflineminus">-</span>
<a href="#l5.1262"></a><span id="l5.1262" class="difflineminus">-nsresult</span>
<a href="#l5.1263"></a><span id="l5.1263" class="difflineminus">-nsMsgFolderDataSource::createFolderOpenNode(nsIMsgFolder *folder, nsIRDFNode **target)</span>
<a href="#l5.1264"></a><span id="l5.1264" class="difflineminus">-{</span>
<a href="#l5.1265"></a><span id="l5.1265" class="difflineminus">-  NS_ENSURE_ARG_POINTER(target);</span>
<a href="#l5.1266"></a><span id="l5.1266" class="difflineminus">-</span>
<a href="#l5.1267"></a><span id="l5.1267" class="difflineminus">-  // call GetSubFolders() to ensure mFlags is set correctly</span>
<a href="#l5.1268"></a><span id="l5.1268" class="difflineminus">-  // from the folder cache on startup</span>
<a href="#l5.1269"></a><span id="l5.1269" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; subFolders;</span>
<a href="#l5.1270"></a><span id="l5.1270" class="difflineminus">-  nsresult rv = folder-&gt;GetSubFolders(getter_AddRefs(subFolders));</span>
<a href="#l5.1271"></a><span id="l5.1271" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l5.1272"></a><span id="l5.1272" class="difflineminus">-    return NS_RDF_NO_VALUE;</span>
<a href="#l5.1273"></a><span id="l5.1273" class="difflineminus">-</span>
<a href="#l5.1274"></a><span id="l5.1274" class="difflineminus">-  bool closed;</span>
<a href="#l5.1275"></a><span id="l5.1275" class="difflineminus">-  rv = folder-&gt;GetFlag(nsMsgFolderFlags::Elided, &amp;closed);</span>
<a href="#l5.1276"></a><span id="l5.1276" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l5.1277"></a><span id="l5.1277" class="difflineminus">-    return rv;</span>
<a href="#l5.1278"></a><span id="l5.1278" class="difflineminus">-</span>
<a href="#l5.1279"></a><span id="l5.1279" class="difflineminus">-  NS_IF_ADDREF(*target = closed ? kFalseLiteral : kTrueLiteral);</span>
<a href="#l5.1280"></a><span id="l5.1280" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1281"></a><span id="l5.1281" class="difflineminus">-}</span>
<a href="#l5.1282"></a><span id="l5.1282" class="difflineminus">-</span>
<a href="#l5.1283"></a><span id="l5.1283" class="difflineminus">-nsresult</span>
<a href="#l5.1284"></a><span id="l5.1284" class="difflineminus">-nsMsgFolderDataSource::createFolderIsSecureNode(nsIMsgFolder* folder,</span>
<a href="#l5.1285"></a><span id="l5.1285" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1286"></a><span id="l5.1286" class="difflineminus">-{</span>
<a href="#l5.1287"></a><span id="l5.1287" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1288"></a><span id="l5.1288" class="difflineminus">-  bool isSecure = false;</span>
<a href="#l5.1289"></a><span id="l5.1289" class="difflineminus">-</span>
<a href="#l5.1290"></a><span id="l5.1290" class="difflineminus">-  nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.1291"></a><span id="l5.1291" class="difflineminus">-  rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.1292"></a><span id="l5.1292" class="difflineminus">-</span>
<a href="#l5.1293"></a><span id="l5.1293" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; server) {</span>
<a href="#l5.1294"></a><span id="l5.1294" class="difflineminus">-    rv = server-&gt;GetIsSecure(&amp;isSecure);</span>
<a href="#l5.1295"></a><span id="l5.1295" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1296"></a><span id="l5.1296" class="difflineminus">-  }</span>
<a href="#l5.1297"></a><span id="l5.1297" class="difflineminus">-</span>
<a href="#l5.1298"></a><span id="l5.1298" class="difflineminus">-  NS_IF_ADDREF(*target = isSecure ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1299"></a><span id="l5.1299" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1300"></a><span id="l5.1300" class="difflineminus">-}</span>
<a href="#l5.1301"></a><span id="l5.1301" class="difflineminus">-</span>
<a href="#l5.1302"></a><span id="l5.1302" class="difflineminus">-</span>
<a href="#l5.1303"></a><span id="l5.1303" class="difflineminus">-nsresult</span>
<a href="#l5.1304"></a><span id="l5.1304" class="difflineminus">-nsMsgFolderDataSource::createFolderCanSubscribeNode(nsIMsgFolder* folder,</span>
<a href="#l5.1305"></a><span id="l5.1305" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1306"></a><span id="l5.1306" class="difflineminus">-{</span>
<a href="#l5.1307"></a><span id="l5.1307" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1308"></a><span id="l5.1308" class="difflineminus">-  bool canSubscribe;</span>
<a href="#l5.1309"></a><span id="l5.1309" class="difflineminus">-  rv = folder-&gt;GetCanSubscribe(&amp;canSubscribe);</span>
<a href="#l5.1310"></a><span id="l5.1310" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1311"></a><span id="l5.1311" class="difflineminus">-</span>
<a href="#l5.1312"></a><span id="l5.1312" class="difflineminus">-  NS_IF_ADDREF(*target = canSubscribe ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1313"></a><span id="l5.1313" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1314"></a><span id="l5.1314" class="difflineminus">-}</span>
<a href="#l5.1315"></a><span id="l5.1315" class="difflineminus">-</span>
<a href="#l5.1316"></a><span id="l5.1316" class="difflineminus">-nsresult</span>
<a href="#l5.1317"></a><span id="l5.1317" class="difflineminus">-nsMsgFolderDataSource::createFolderSupportsOfflineNode(nsIMsgFolder* folder,</span>
<a href="#l5.1318"></a><span id="l5.1318" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1319"></a><span id="l5.1319" class="difflineminus">-{</span>
<a href="#l5.1320"></a><span id="l5.1320" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1321"></a><span id="l5.1321" class="difflineminus">-  bool supportsOffline;</span>
<a href="#l5.1322"></a><span id="l5.1322" class="difflineminus">-  rv = folder-&gt;GetSupportsOffline(&amp;supportsOffline);</span>
<a href="#l5.1323"></a><span id="l5.1323" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.1324"></a><span id="l5.1324" class="difflineminus">-</span>
<a href="#l5.1325"></a><span id="l5.1325" class="difflineminus">-  NS_IF_ADDREF(*target = supportsOffline ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1326"></a><span id="l5.1326" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1327"></a><span id="l5.1327" class="difflineminus">-}</span>
<a href="#l5.1328"></a><span id="l5.1328" class="difflineminus">-</span>
<a href="#l5.1329"></a><span id="l5.1329" class="difflineminus">-nsresult</span>
<a href="#l5.1330"></a><span id="l5.1330" class="difflineminus">-nsMsgFolderDataSource::createFolderCanFileMessagesNode(nsIMsgFolder* folder,</span>
<a href="#l5.1331"></a><span id="l5.1331" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1332"></a><span id="l5.1332" class="difflineminus">-{</span>
<a href="#l5.1333"></a><span id="l5.1333" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1334"></a><span id="l5.1334" class="difflineminus">-  bool canFileMessages;</span>
<a href="#l5.1335"></a><span id="l5.1335" class="difflineminus">-  rv = folder-&gt;GetCanFileMessages(&amp;canFileMessages);</span>
<a href="#l5.1336"></a><span id="l5.1336" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1337"></a><span id="l5.1337" class="difflineminus">-</span>
<a href="#l5.1338"></a><span id="l5.1338" class="difflineminus">-  NS_IF_ADDREF(*target = canFileMessages ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1339"></a><span id="l5.1339" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1340"></a><span id="l5.1340" class="difflineminus">-}</span>
<a href="#l5.1341"></a><span id="l5.1341" class="difflineminus">-</span>
<a href="#l5.1342"></a><span id="l5.1342" class="difflineminus">-nsresult</span>
<a href="#l5.1343"></a><span id="l5.1343" class="difflineminus">-nsMsgFolderDataSource::createFolderCanCreateSubfoldersNode(nsIMsgFolder* folder,</span>
<a href="#l5.1344"></a><span id="l5.1344" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1345"></a><span id="l5.1345" class="difflineminus">-{</span>
<a href="#l5.1346"></a><span id="l5.1346" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1347"></a><span id="l5.1347" class="difflineminus">-  bool canCreateSubfolders;</span>
<a href="#l5.1348"></a><span id="l5.1348" class="difflineminus">-  rv = folder-&gt;GetCanCreateSubfolders(&amp;canCreateSubfolders);</span>
<a href="#l5.1349"></a><span id="l5.1349" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1350"></a><span id="l5.1350" class="difflineminus">-</span>
<a href="#l5.1351"></a><span id="l5.1351" class="difflineminus">-  NS_IF_ADDREF(*target = canCreateSubfolders ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1352"></a><span id="l5.1352" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1353"></a><span id="l5.1353" class="difflineminus">-}</span>
<a href="#l5.1354"></a><span id="l5.1354" class="difflineminus">-</span>
<a href="#l5.1355"></a><span id="l5.1355" class="difflineminus">-nsresult</span>
<a href="#l5.1356"></a><span id="l5.1356" class="difflineminus">-nsMsgFolderDataSource::createFolderCanRenameNode(nsIMsgFolder* folder,</span>
<a href="#l5.1357"></a><span id="l5.1357" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1358"></a><span id="l5.1358" class="difflineminus">-{</span>
<a href="#l5.1359"></a><span id="l5.1359" class="difflineminus">-  bool canRename;</span>
<a href="#l5.1360"></a><span id="l5.1360" class="difflineminus">-  nsresult rv = folder-&gt;GetCanRename(&amp;canRename);</span>
<a href="#l5.1361"></a><span id="l5.1361" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1362"></a><span id="l5.1362" class="difflineminus">-</span>
<a href="#l5.1363"></a><span id="l5.1363" class="difflineminus">-  NS_IF_ADDREF(*target = canRename ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1364"></a><span id="l5.1364" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1365"></a><span id="l5.1365" class="difflineminus">-}</span>
<a href="#l5.1366"></a><span id="l5.1366" class="difflineminus">-</span>
<a href="#l5.1367"></a><span id="l5.1367" class="difflineminus">-nsresult</span>
<a href="#l5.1368"></a><span id="l5.1368" class="difflineminus">-nsMsgFolderDataSource::createFolderCanCompactNode(nsIMsgFolder* folder,</span>
<a href="#l5.1369"></a><span id="l5.1369" class="difflineminus">-                                                  nsIRDFNode **target)</span>
<a href="#l5.1370"></a><span id="l5.1370" class="difflineminus">-{</span>
<a href="#l5.1371"></a><span id="l5.1371" class="difflineminus">-  bool canCompact;</span>
<a href="#l5.1372"></a><span id="l5.1372" class="difflineminus">-  nsresult rv = folder-&gt;GetCanCompact(&amp;canCompact);</span>
<a href="#l5.1373"></a><span id="l5.1373" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1374"></a><span id="l5.1374" class="difflineminus">-</span>
<a href="#l5.1375"></a><span id="l5.1375" class="difflineminus">-  NS_IF_ADDREF(*target = canCompact ? kTrueLiteral : kFalseLiteral);</span>
<a href="#l5.1376"></a><span id="l5.1376" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1377"></a><span id="l5.1377" class="difflineminus">-}</span>
<a href="#l5.1378"></a><span id="l5.1378" class="difflineminus">-</span>
<a href="#l5.1379"></a><span id="l5.1379" class="difflineminus">-</span>
<a href="#l5.1380"></a><span id="l5.1380" class="difflineminus">-nsresult</span>
<a href="#l5.1381"></a><span id="l5.1381" class="difflineminus">-nsMsgFolderDataSource::createTotalMessagesNode(nsIMsgFolder *folder,</span>
<a href="#l5.1382"></a><span id="l5.1382" class="difflineminus">-                                               nsIRDFNode **target)</span>
<a href="#l5.1383"></a><span id="l5.1383" class="difflineminus">-{</span>
<a href="#l5.1384"></a><span id="l5.1384" class="difflineminus">-</span>
<a href="#l5.1385"></a><span id="l5.1385" class="difflineminus">-  bool isServer;</span>
<a href="#l5.1386"></a><span id="l5.1386" class="difflineminus">-  nsresult rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1387"></a><span id="l5.1387" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1388"></a><span id="l5.1388" class="difflineminus">-</span>
<a href="#l5.1389"></a><span id="l5.1389" class="difflineminus">-  int32_t totalMessages;</span>
<a href="#l5.1390"></a><span id="l5.1390" class="difflineminus">-  if(isServer)</span>
<a href="#l5.1391"></a><span id="l5.1391" class="difflineminus">-    totalMessages = kDisplayBlankCount;</span>
<a href="#l5.1392"></a><span id="l5.1392" class="difflineminus">-  else</span>
<a href="#l5.1393"></a><span id="l5.1393" class="difflineminus">-  {</span>
<a href="#l5.1394"></a><span id="l5.1394" class="difflineminus">-    rv = folder-&gt;GetTotalMessages(false, &amp;totalMessages);</span>
<a href="#l5.1395"></a><span id="l5.1395" class="difflineminus">-    if(NS_FAILED(rv)) return rv;</span>
<a href="#l5.1396"></a><span id="l5.1396" class="difflineminus">-  }</span>
<a href="#l5.1397"></a><span id="l5.1397" class="difflineminus">-  GetNumMessagesNode(totalMessages, target);</span>
<a href="#l5.1398"></a><span id="l5.1398" class="difflineminus">-</span>
<a href="#l5.1399"></a><span id="l5.1399" class="difflineminus">-  return rv;</span>
<a href="#l5.1400"></a><span id="l5.1400" class="difflineminus">-}</span>
<a href="#l5.1401"></a><span id="l5.1401" class="difflineminus">-</span>
<a href="#l5.1402"></a><span id="l5.1402" class="difflineminus">-nsresult</span>
<a href="#l5.1403"></a><span id="l5.1403" class="difflineminus">-nsMsgFolderDataSource::createFolderSizeNode(nsIMsgFolder *folder, nsIRDFNode **target)</span>
<a href="#l5.1404"></a><span id="l5.1404" class="difflineminus">-{</span>
<a href="#l5.1405"></a><span id="l5.1405" class="difflineminus">-  bool isServer;</span>
<a href="#l5.1406"></a><span id="l5.1406" class="difflineminus">-  nsresult rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1407"></a><span id="l5.1407" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1408"></a><span id="l5.1408" class="difflineminus">-</span>
<a href="#l5.1409"></a><span id="l5.1409" class="difflineminus">-  int64_t folderSize;</span>
<a href="#l5.1410"></a><span id="l5.1410" class="difflineminus">-  if (isServer) {</span>
<a href="#l5.1411"></a><span id="l5.1411" class="difflineminus">-    folderSize = kDisplayBlankCount64;</span>
<a href="#l5.1412"></a><span id="l5.1412" class="difflineminus">-  }</span>
<a href="#l5.1413"></a><span id="l5.1413" class="difflineminus">-  else</span>
<a href="#l5.1414"></a><span id="l5.1414" class="difflineminus">-  {</span>
<a href="#l5.1415"></a><span id="l5.1415" class="difflineminus">-    // XXX todo, we are asserting here for news</span>
<a href="#l5.1416"></a><span id="l5.1416" class="difflineminus">-    // for offline news, we'd know the size on disk, right? Yes, bug 851275.</span>
<a href="#l5.1417"></a><span id="l5.1417" class="difflineminus">-    rv = folder-&gt;GetSizeOnDisk(&amp;folderSize);</span>
<a href="#l5.1418"></a><span id="l5.1418" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1419"></a><span id="l5.1419" class="difflineminus">-  }</span>
<a href="#l5.1420"></a><span id="l5.1420" class="difflineminus">-</span>
<a href="#l5.1421"></a><span id="l5.1421" class="difflineminus">-  return GetFolderSizeNode(folderSize, target);</span>
<a href="#l5.1422"></a><span id="l5.1422" class="difflineminus">-}</span>
<a href="#l5.1423"></a><span id="l5.1423" class="difflineminus">-</span>
<a href="#l5.1424"></a><span id="l5.1424" class="difflineminus">-nsresult</span>
<a href="#l5.1425"></a><span id="l5.1425" class="difflineminus">-nsMsgFolderDataSource::createCharsetNode(nsIMsgFolder *folder, nsIRDFNode **target)</span>
<a href="#l5.1426"></a><span id="l5.1426" class="difflineminus">-{</span>
<a href="#l5.1427"></a><span id="l5.1427" class="difflineminus">-  nsCString charset;</span>
<a href="#l5.1428"></a><span id="l5.1428" class="difflineminus">-  nsresult rv = folder-&gt;GetCharset(charset);</span>
<a href="#l5.1429"></a><span id="l5.1429" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l5.1430"></a><span id="l5.1430" class="difflineminus">-    createNode(NS_ConvertASCIItoUTF16(charset).get(), target, getRDFService());</span>
<a href="#l5.1431"></a><span id="l5.1431" class="difflineminus">-  else</span>
<a href="#l5.1432"></a><span id="l5.1432" class="difflineminus">-    createNode(EmptyString().get(), target, getRDFService());</span>
<a href="#l5.1433"></a><span id="l5.1433" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1434"></a><span id="l5.1434" class="difflineminus">-}</span>
<a href="#l5.1435"></a><span id="l5.1435" class="difflineminus">-</span>
<a href="#l5.1436"></a><span id="l5.1436" class="difflineminus">-nsresult</span>
<a href="#l5.1437"></a><span id="l5.1437" class="difflineminus">-nsMsgFolderDataSource::createBiffStateNodeFromFolder(nsIMsgFolder *folder, nsIRDFNode **target)</span>
<a href="#l5.1438"></a><span id="l5.1438" class="difflineminus">-{</span>
<a href="#l5.1439"></a><span id="l5.1439" class="difflineminus">-  uint32_t biffState;</span>
<a href="#l5.1440"></a><span id="l5.1440" class="difflineminus">-  nsresult rv = folder-&gt;GetBiffState(&amp;biffState);</span>
<a href="#l5.1441"></a><span id="l5.1441" class="difflineminus">-  if(NS_FAILED(rv)) return rv;</span>
<a href="#l5.1442"></a><span id="l5.1442" class="difflineminus">-</span>
<a href="#l5.1443"></a><span id="l5.1443" class="difflineminus">-  rv = createBiffStateNodeFromFlag(biffState, target);</span>
<a href="#l5.1444"></a><span id="l5.1444" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.1445"></a><span id="l5.1445" class="difflineminus">-</span>
<a href="#l5.1446"></a><span id="l5.1446" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1447"></a><span id="l5.1447" class="difflineminus">-}</span>
<a href="#l5.1448"></a><span id="l5.1448" class="difflineminus">-</span>
<a href="#l5.1449"></a><span id="l5.1449" class="difflineminus">-nsresult</span>
<a href="#l5.1450"></a><span id="l5.1450" class="difflineminus">-nsMsgFolderDataSource::createBiffStateNodeFromFlag(uint32_t flag, nsIRDFNode **target)</span>
<a href="#l5.1451"></a><span id="l5.1451" class="difflineminus">-{</span>
<a href="#l5.1452"></a><span id="l5.1452" class="difflineminus">-  const char16_t *biffStateStr;</span>
<a href="#l5.1453"></a><span id="l5.1453" class="difflineminus">-</span>
<a href="#l5.1454"></a><span id="l5.1454" class="difflineminus">-  switch (flag) {</span>
<a href="#l5.1455"></a><span id="l5.1455" class="difflineminus">-    case nsIMsgFolder::nsMsgBiffState_NewMail:</span>
<a href="#l5.1456"></a><span id="l5.1456" class="difflineminus">-      biffStateStr = u&quot;NewMail&quot;;</span>
<a href="#l5.1457"></a><span id="l5.1457" class="difflineminus">-      break;</span>
<a href="#l5.1458"></a><span id="l5.1458" class="difflineminus">-    case nsIMsgFolder::nsMsgBiffState_NoMail:</span>
<a href="#l5.1459"></a><span id="l5.1459" class="difflineminus">-      biffStateStr = u&quot;NoMail&quot;;</span>
<a href="#l5.1460"></a><span id="l5.1460" class="difflineminus">-      break;</span>
<a href="#l5.1461"></a><span id="l5.1461" class="difflineminus">-    default:</span>
<a href="#l5.1462"></a><span id="l5.1462" class="difflineminus">-      biffStateStr = u&quot;UnknownMail&quot;;</span>
<a href="#l5.1463"></a><span id="l5.1463" class="difflineminus">-      break;</span>
<a href="#l5.1464"></a><span id="l5.1464" class="difflineminus">-  }</span>
<a href="#l5.1465"></a><span id="l5.1465" class="difflineminus">-</span>
<a href="#l5.1466"></a><span id="l5.1466" class="difflineminus">-  createNode(biffStateStr, target, getRDFService());</span>
<a href="#l5.1467"></a><span id="l5.1467" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1468"></a><span id="l5.1468" class="difflineminus">-}</span>
<a href="#l5.1469"></a><span id="l5.1469" class="difflineminus">-</span>
<a href="#l5.1470"></a><span id="l5.1470" class="difflineminus">-nsresult</span>
<a href="#l5.1471"></a><span id="l5.1471" class="difflineminus">-nsMsgFolderDataSource::createUnreadMessagesNode(nsIMsgFolder *folder,</span>
<a href="#l5.1472"></a><span id="l5.1472" class="difflineminus">-                        nsIRDFNode **target)</span>
<a href="#l5.1473"></a><span id="l5.1473" class="difflineminus">-{</span>
<a href="#l5.1474"></a><span id="l5.1474" class="difflineminus">-  bool isServer;</span>
<a href="#l5.1475"></a><span id="l5.1475" class="difflineminus">-  nsresult rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1476"></a><span id="l5.1476" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1477"></a><span id="l5.1477" class="difflineminus">-</span>
<a href="#l5.1478"></a><span id="l5.1478" class="difflineminus">-  int32_t totalUnreadMessages;</span>
<a href="#l5.1479"></a><span id="l5.1479" class="difflineminus">-  if(isServer)</span>
<a href="#l5.1480"></a><span id="l5.1480" class="difflineminus">-    totalUnreadMessages = kDisplayBlankCount;</span>
<a href="#l5.1481"></a><span id="l5.1481" class="difflineminus">-  else</span>
<a href="#l5.1482"></a><span id="l5.1482" class="difflineminus">-  {</span>
<a href="#l5.1483"></a><span id="l5.1483" class="difflineminus">-    rv = folder-&gt;GetNumUnread(false, &amp;totalUnreadMessages);</span>
<a href="#l5.1484"></a><span id="l5.1484" class="difflineminus">-    if(NS_FAILED(rv)) return rv;</span>
<a href="#l5.1485"></a><span id="l5.1485" class="difflineminus">-  }</span>
<a href="#l5.1486"></a><span id="l5.1486" class="difflineminus">-  GetNumMessagesNode(totalUnreadMessages, target);</span>
<a href="#l5.1487"></a><span id="l5.1487" class="difflineminus">-</span>
<a href="#l5.1488"></a><span id="l5.1488" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1489"></a><span id="l5.1489" class="difflineminus">-}</span>
<a href="#l5.1490"></a><span id="l5.1490" class="difflineminus">-</span>
<a href="#l5.1491"></a><span id="l5.1491" class="difflineminus">-nsresult</span>
<a href="#l5.1492"></a><span id="l5.1492" class="difflineminus">-nsMsgFolderDataSource::createHasUnreadMessagesNode(nsIMsgFolder *folder, bool aIncludeSubfolders, nsIRDFNode **target)</span>
<a href="#l5.1493"></a><span id="l5.1493" class="difflineminus">-{</span>
<a href="#l5.1494"></a><span id="l5.1494" class="difflineminus">-  bool isServer;</span>
<a href="#l5.1495"></a><span id="l5.1495" class="difflineminus">-  nsresult rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1496"></a><span id="l5.1496" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1497"></a><span id="l5.1497" class="difflineminus">-</span>
<a href="#l5.1498"></a><span id="l5.1498" class="difflineminus">-  *target = kFalseLiteral;</span>
<a href="#l5.1499"></a><span id="l5.1499" class="difflineminus">-</span>
<a href="#l5.1500"></a><span id="l5.1500" class="difflineminus">-  int32_t totalUnreadMessages;</span>
<a href="#l5.1501"></a><span id="l5.1501" class="difflineminus">-  if(!isServer)</span>
<a href="#l5.1502"></a><span id="l5.1502" class="difflineminus">-  {</span>
<a href="#l5.1503"></a><span id="l5.1503" class="difflineminus">-    rv = folder-&gt;GetNumUnread(aIncludeSubfolders, &amp;totalUnreadMessages);</span>
<a href="#l5.1504"></a><span id="l5.1504" class="difflineminus">-    if(NS_FAILED(rv)) return rv;</span>
<a href="#l5.1505"></a><span id="l5.1505" class="difflineminus">-    // if we're including sub-folders, we're trying to find out if child folders</span>
<a href="#l5.1506"></a><span id="l5.1506" class="difflineminus">-    // have unread. If so, we subtract the unread msgs in the current folder.</span>
<a href="#l5.1507"></a><span id="l5.1507" class="difflineminus">-    if (aIncludeSubfolders)</span>
<a href="#l5.1508"></a><span id="l5.1508" class="difflineminus">-    {</span>
<a href="#l5.1509"></a><span id="l5.1509" class="difflineminus">-      int32_t numUnreadInFolder;</span>
<a href="#l5.1510"></a><span id="l5.1510" class="difflineminus">-      rv = folder-&gt;GetNumUnread(false, &amp;numUnreadInFolder);</span>
<a href="#l5.1511"></a><span id="l5.1511" class="difflineminus">-      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1512"></a><span id="l5.1512" class="difflineminus">-      // don't subtract if numUnread is negative (which means we don't know the unread count)</span>
<a href="#l5.1513"></a><span id="l5.1513" class="difflineminus">-      if (numUnreadInFolder &gt; 0)</span>
<a href="#l5.1514"></a><span id="l5.1514" class="difflineminus">-        totalUnreadMessages -= numUnreadInFolder;</span>
<a href="#l5.1515"></a><span id="l5.1515" class="difflineminus">-    }</span>
<a href="#l5.1516"></a><span id="l5.1516" class="difflineminus">-    *target = (totalUnreadMessages &gt; 0) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l5.1517"></a><span id="l5.1517" class="difflineminus">-  }</span>
<a href="#l5.1518"></a><span id="l5.1518" class="difflineminus">-</span>
<a href="#l5.1519"></a><span id="l5.1519" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l5.1520"></a><span id="l5.1520" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1521"></a><span id="l5.1521" class="difflineminus">-}</span>
<a href="#l5.1522"></a><span id="l5.1522" class="difflineminus">-</span>
<a href="#l5.1523"></a><span id="l5.1523" class="difflineminus">-nsresult</span>
<a href="#l5.1524"></a><span id="l5.1524" class="difflineminus">-nsMsgFolderDataSource::OnUnreadMessagePropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue)</span>
<a href="#l5.1525"></a><span id="l5.1525" class="difflineminus">-{</span>
<a href="#l5.1526"></a><span id="l5.1526" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryInterface(folderResource);</span>
<a href="#l5.1527"></a><span id="l5.1527" class="difflineminus">-  if(folder)</span>
<a href="#l5.1528"></a><span id="l5.1528" class="difflineminus">-  {</span>
<a href="#l5.1529"></a><span id="l5.1529" class="difflineminus">-    //First send a regular unread message changed notification</span>
<a href="#l5.1530"></a><span id="l5.1530" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; newNode;</span>
<a href="#l5.1531"></a><span id="l5.1531" class="difflineminus">-</span>
<a href="#l5.1532"></a><span id="l5.1532" class="difflineminus">-    GetNumMessagesNode(newValue, getter_AddRefs(newNode));</span>
<a href="#l5.1533"></a><span id="l5.1533" class="difflineminus">-    NotifyPropertyChanged(folderResource, kNC_TotalUnreadMessages, newNode);</span>
<a href="#l5.1534"></a><span id="l5.1534" class="difflineminus">-</span>
<a href="#l5.1535"></a><span id="l5.1535" class="difflineminus">-    //Now see if hasUnreadMessages has changed</span>
<a href="#l5.1536"></a><span id="l5.1536" class="difflineminus">-    if(oldValue &lt;=0 &amp;&amp; newValue &gt;0)</span>
<a href="#l5.1537"></a><span id="l5.1537" class="difflineminus">-    {</span>
<a href="#l5.1538"></a><span id="l5.1538" class="difflineminus">-      NotifyPropertyChanged(folderResource, kNC_HasUnreadMessages, kTrueLiteral);</span>
<a href="#l5.1539"></a><span id="l5.1539" class="difflineminus">-      NotifyAncestors(folder, kNC_SubfoldersHaveUnreadMessages, kTrueLiteral);</span>
<a href="#l5.1540"></a><span id="l5.1540" class="difflineminus">-    }</span>
<a href="#l5.1541"></a><span id="l5.1541" class="difflineminus">-    else if(oldValue &gt; 0 &amp;&amp; newValue &lt;= 0)</span>
<a href="#l5.1542"></a><span id="l5.1542" class="difflineminus">-    {</span>
<a href="#l5.1543"></a><span id="l5.1543" class="difflineminus">-      NotifyPropertyChanged(folderResource, kNC_HasUnreadMessages, kFalseLiteral);</span>
<a href="#l5.1544"></a><span id="l5.1544" class="difflineminus">-      // this isn't quite right - parents could still have other children with</span>
<a href="#l5.1545"></a><span id="l5.1545" class="difflineminus">-      // unread messages. NotifyAncestors will have to figure that out...</span>
<a href="#l5.1546"></a><span id="l5.1546" class="difflineminus">-      NotifyAncestors(folder, kNC_SubfoldersHaveUnreadMessages, kFalseLiteral);</span>
<a href="#l5.1547"></a><span id="l5.1547" class="difflineminus">-    }</span>
<a href="#l5.1548"></a><span id="l5.1548" class="difflineminus">-</span>
<a href="#l5.1549"></a><span id="l5.1549" class="difflineminus">-    //We will have to change the folderTreeName if the unread column is hidden</span>
<a href="#l5.1550"></a><span id="l5.1550" class="difflineminus">-    NotifyFolderTreeNameChanged(folder, folderResource, newValue);</span>
<a href="#l5.1551"></a><span id="l5.1551" class="difflineminus">-  }</span>
<a href="#l5.1552"></a><span id="l5.1552" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1553"></a><span id="l5.1553" class="difflineminus">-}</span>
<a href="#l5.1554"></a><span id="l5.1554" class="difflineminus">-</span>
<a href="#l5.1555"></a><span id="l5.1555" class="difflineminus">-nsresult</span>
<a href="#l5.1556"></a><span id="l5.1556" class="difflineminus">-nsMsgFolderDataSource::NotifyFolderNameChanged(nsIMsgFolder* aFolder, nsIRDFResource *folderResource)</span>
<a href="#l5.1557"></a><span id="l5.1557" class="difflineminus">-{</span>
<a href="#l5.1558"></a><span id="l5.1558" class="difflineminus">-  nsString name;</span>
<a href="#l5.1559"></a><span id="l5.1559" class="difflineminus">-  nsresult rv = aFolder-&gt;GetName(name);</span>
<a href="#l5.1560"></a><span id="l5.1560" class="difflineminus">-</span>
<a href="#l5.1561"></a><span id="l5.1561" class="difflineminus">-  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.1562"></a><span id="l5.1562" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; newNameNode;</span>
<a href="#l5.1563"></a><span id="l5.1563" class="difflineminus">-    createNode(name.get(), getter_AddRefs(newNameNode), getRDFService());</span>
<a href="#l5.1564"></a><span id="l5.1564" class="difflineminus">-    NotifyPropertyChanged(folderResource, kNC_Name, newNameNode);</span>
<a href="#l5.1565"></a><span id="l5.1565" class="difflineminus">-  }</span>
<a href="#l5.1566"></a><span id="l5.1566" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1567"></a><span id="l5.1567" class="difflineminus">-}</span>
<a href="#l5.1568"></a><span id="l5.1568" class="difflineminus">-</span>
<a href="#l5.1569"></a><span id="l5.1569" class="difflineminus">-nsresult</span>
<a href="#l5.1570"></a><span id="l5.1570" class="difflineminus">-nsMsgFolderDataSource::NotifyFolderTreeSimpleNameChanged(nsIMsgFolder* aFolder, nsIRDFResource *folderResource)</span>
<a href="#l5.1571"></a><span id="l5.1571" class="difflineminus">-{</span>
<a href="#l5.1572"></a><span id="l5.1572" class="difflineminus">-  nsString abbreviatedName;</span>
<a href="#l5.1573"></a><span id="l5.1573" class="difflineminus">-  nsresult rv = GetFolderDisplayName(aFolder, abbreviatedName);</span>
<a href="#l5.1574"></a><span id="l5.1574" class="difflineminus">-  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.1575"></a><span id="l5.1575" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; newNameNode;</span>
<a href="#l5.1576"></a><span id="l5.1576" class="difflineminus">-    createNode(abbreviatedName.get(), getter_AddRefs(newNameNode), getRDFService());</span>
<a href="#l5.1577"></a><span id="l5.1577" class="difflineminus">-    NotifyPropertyChanged(folderResource, kNC_FolderTreeSimpleName, newNameNode);</span>
<a href="#l5.1578"></a><span id="l5.1578" class="difflineminus">-  }</span>
<a href="#l5.1579"></a><span id="l5.1579" class="difflineminus">-</span>
<a href="#l5.1580"></a><span id="l5.1580" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1581"></a><span id="l5.1581" class="difflineminus">-}</span>
<a href="#l5.1582"></a><span id="l5.1582" class="difflineminus">-</span>
<a href="#l5.1583"></a><span id="l5.1583" class="difflineminus">-nsresult</span>
<a href="#l5.1584"></a><span id="l5.1584" class="difflineminus">-nsMsgFolderDataSource::NotifyFolderTreeNameChanged(nsIMsgFolder* aFolder,</span>
<a href="#l5.1585"></a><span id="l5.1585" class="difflineminus">-                                                   nsIRDFResource* aFolderResource,</span>
<a href="#l5.1586"></a><span id="l5.1586" class="difflineminus">-                                                   int32_t aUnreadMessages)</span>
<a href="#l5.1587"></a><span id="l5.1587" class="difflineminus">-{</span>
<a href="#l5.1588"></a><span id="l5.1588" class="difflineminus">-  nsString name;</span>
<a href="#l5.1589"></a><span id="l5.1589" class="difflineminus">-  nsresult rv = GetFolderDisplayName(aFolder, name);</span>
<a href="#l5.1590"></a><span id="l5.1590" class="difflineminus">-  if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.1591"></a><span id="l5.1591" class="difflineminus">-    nsAutoString newNameString(name);</span>
<a href="#l5.1592"></a><span id="l5.1592" class="difflineminus">-    CreateUnreadMessagesNameString(aUnreadMessages, newNameString);</span>
<a href="#l5.1593"></a><span id="l5.1593" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; newNameNode;</span>
<a href="#l5.1594"></a><span id="l5.1594" class="difflineminus">-    createNode(newNameString.get(), getter_AddRefs(newNameNode), getRDFService());</span>
<a href="#l5.1595"></a><span id="l5.1595" class="difflineminus">-    NotifyPropertyChanged(aFolderResource, kNC_FolderTreeName, newNameNode);</span>
<a href="#l5.1596"></a><span id="l5.1596" class="difflineminus">-  }</span>
<a href="#l5.1597"></a><span id="l5.1597" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1598"></a><span id="l5.1598" class="difflineminus">-}</span>
<a href="#l5.1599"></a><span id="l5.1599" class="difflineminus">-</span>
<a href="#l5.1600"></a><span id="l5.1600" class="difflineminus">-nsresult</span>
<a href="#l5.1601"></a><span id="l5.1601" class="difflineminus">-nsMsgFolderDataSource::NotifyAncestors(nsIMsgFolder *aFolder, nsIRDFResource *aPropertyResource, nsIRDFNode *aNode)</span>
<a href="#l5.1602"></a><span id="l5.1602" class="difflineminus">-{</span>
<a href="#l5.1603"></a><span id="l5.1603" class="difflineminus">-  bool isServer = false;</span>
<a href="#l5.1604"></a><span id="l5.1604" class="difflineminus">-  nsresult rv = aFolder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1605"></a><span id="l5.1605" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.1606"></a><span id="l5.1606" class="difflineminus">-</span>
<a href="#l5.1607"></a><span id="l5.1607" class="difflineminus">-  if (isServer)</span>
<a href="#l5.1608"></a><span id="l5.1608" class="difflineminus">-    // done, stop</span>
<a href="#l5.1609"></a><span id="l5.1609" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.1610"></a><span id="l5.1610" class="difflineminus">-</span>
<a href="#l5.1611"></a><span id="l5.1611" class="difflineminus">-  nsCOMPtr &lt;nsIMsgFolder&gt; parentMsgFolder;</span>
<a href="#l5.1612"></a><span id="l5.1612" class="difflineminus">-  rv = aFolder-&gt;GetParent(getter_AddRefs(parentMsgFolder));</span>
<a href="#l5.1613"></a><span id="l5.1613" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.1614"></a><span id="l5.1614" class="difflineminus">-  if (!parentMsgFolder)</span>
<a href="#l5.1615"></a><span id="l5.1615" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.1616"></a><span id="l5.1616" class="difflineminus">-</span>
<a href="#l5.1617"></a><span id="l5.1617" class="difflineminus">-  rv = parentMsgFolder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1618"></a><span id="l5.1618" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.1619"></a><span id="l5.1619" class="difflineminus">-</span>
<a href="#l5.1620"></a><span id="l5.1620" class="difflineminus">-  // don't need to notify servers either.</span>
<a href="#l5.1621"></a><span id="l5.1621" class="difflineminus">-  if (isServer)</span>
<a href="#l5.1622"></a><span id="l5.1622" class="difflineminus">-    // done, stop</span>
<a href="#l5.1623"></a><span id="l5.1623" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.1624"></a><span id="l5.1624" class="difflineminus">-</span>
<a href="#l5.1625"></a><span id="l5.1625" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; parentFolderResource = do_QueryInterface(parentMsgFolder,&amp;rv);</span>
<a href="#l5.1626"></a><span id="l5.1626" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.1627"></a><span id="l5.1627" class="difflineminus">-</span>
<a href="#l5.1628"></a><span id="l5.1628" class="difflineminus">-  // if we're setting the subFoldersHaveUnreadMessages property to false, check</span>
<a href="#l5.1629"></a><span id="l5.1629" class="difflineminus">-  // if the folder really doesn't have subfolders with unread messages.</span>
<a href="#l5.1630"></a><span id="l5.1630" class="difflineminus">-  if (aPropertyResource == kNC_SubfoldersHaveUnreadMessages &amp;&amp; aNode == kFalseLiteral)</span>
<a href="#l5.1631"></a><span id="l5.1631" class="difflineminus">-  {</span>
<a href="#l5.1632"></a><span id="l5.1632" class="difflineminus">-    nsCOMPtr &lt;nsIRDFNode&gt; unreadMsgsNode;</span>
<a href="#l5.1633"></a><span id="l5.1633" class="difflineminus">-    createHasUnreadMessagesNode(parentMsgFolder, true, getter_AddRefs(unreadMsgsNode));</span>
<a href="#l5.1634"></a><span id="l5.1634" class="difflineminus">-    aNode = unreadMsgsNode;</span>
<a href="#l5.1635"></a><span id="l5.1635" class="difflineminus">-  }</span>
<a href="#l5.1636"></a><span id="l5.1636" class="difflineminus">-  NotifyPropertyChanged(parentFolderResource, aPropertyResource, aNode);</span>
<a href="#l5.1637"></a><span id="l5.1637" class="difflineminus">-</span>
<a href="#l5.1638"></a><span id="l5.1638" class="difflineminus">-  return NotifyAncestors(parentMsgFolder, aPropertyResource, aNode);</span>
<a href="#l5.1639"></a><span id="l5.1639" class="difflineminus">-}</span>
<a href="#l5.1640"></a><span id="l5.1640" class="difflineminus">-</span>
<a href="#l5.1641"></a><span id="l5.1641" class="difflineminus">-// New Messages</span>
<a href="#l5.1642"></a><span id="l5.1642" class="difflineminus">-</span>
<a href="#l5.1643"></a><span id="l5.1643" class="difflineminus">-nsresult</span>
<a href="#l5.1644"></a><span id="l5.1644" class="difflineminus">-nsMsgFolderDataSource::createNewMessagesNode(nsIMsgFolder *folder, nsIRDFNode **target)</span>
<a href="#l5.1645"></a><span id="l5.1645" class="difflineminus">-{</span>
<a href="#l5.1646"></a><span id="l5.1646" class="difflineminus">-</span>
<a href="#l5.1647"></a><span id="l5.1647" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1648"></a><span id="l5.1648" class="difflineminus">-</span>
<a href="#l5.1649"></a><span id="l5.1649" class="difflineminus">-  bool isServer;</span>
<a href="#l5.1650"></a><span id="l5.1650" class="difflineminus">-  rv = folder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l5.1651"></a><span id="l5.1651" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1652"></a><span id="l5.1652" class="difflineminus">-</span>
<a href="#l5.1653"></a><span id="l5.1653" class="difflineminus">-  *target = kFalseLiteral;</span>
<a href="#l5.1654"></a><span id="l5.1654" class="difflineminus">-</span>
<a href="#l5.1655"></a><span id="l5.1655" class="difflineminus">-  //int32_t totalNewMessages;</span>
<a href="#l5.1656"></a><span id="l5.1656" class="difflineminus">-  bool isNewMessages;</span>
<a href="#l5.1657"></a><span id="l5.1657" class="difflineminus">-  if(!isServer)</span>
<a href="#l5.1658"></a><span id="l5.1658" class="difflineminus">-  {</span>
<a href="#l5.1659"></a><span id="l5.1659" class="difflineminus">-    rv = folder-&gt;GetHasNewMessages(&amp;isNewMessages);</span>
<a href="#l5.1660"></a><span id="l5.1660" class="difflineminus">-    if(NS_FAILED(rv)) return rv;</span>
<a href="#l5.1661"></a><span id="l5.1661" class="difflineminus">-    *target = (isNewMessages) ? kTrueLiteral : kFalseLiteral;</span>
<a href="#l5.1662"></a><span id="l5.1662" class="difflineminus">-  }</span>
<a href="#l5.1663"></a><span id="l5.1663" class="difflineminus">-  NS_IF_ADDREF(*target);</span>
<a href="#l5.1664"></a><span id="l5.1664" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1665"></a><span id="l5.1665" class="difflineminus">-}</span>
<a href="#l5.1666"></a><span id="l5.1666" class="difflineminus">-</span>
<a href="#l5.1667"></a><span id="l5.1667" class="difflineminus">-/**</span>
<a href="#l5.1668"></a><span id="l5.1668" class="difflineminus">-nsresult</span>
<a href="#l5.1669"></a><span id="l5.1669" class="difflineminus">-nsMsgFolderDataSource::OnUnreadMessagePropertyChanged(nsIMsgFolder *folder, int32_t oldValue, int32_t newValue)</span>
<a href="#l5.1670"></a><span id="l5.1670" class="difflineminus">-{</span>
<a href="#l5.1671"></a><span id="l5.1671" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; folderResource = do_QueryInterface(folder);</span>
<a href="#l5.1672"></a><span id="l5.1672" class="difflineminus">-  if(folderResource)</span>
<a href="#l5.1673"></a><span id="l5.1673" class="difflineminus">-  {</span>
<a href="#l5.1674"></a><span id="l5.1674" class="difflineminus">-    //First send a regular unread message changed notification</span>
<a href="#l5.1675"></a><span id="l5.1675" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; newNode;</span>
<a href="#l5.1676"></a><span id="l5.1676" class="difflineminus">-</span>
<a href="#l5.1677"></a><span id="l5.1677" class="difflineminus">-    GetNumMessagesNode(newValue, getter_AddRefs(newNode));</span>
<a href="#l5.1678"></a><span id="l5.1678" class="difflineminus">-    NotifyPropertyChanged(folderResource, kNC_TotalUnreadMessages, newNode);</span>
<a href="#l5.1679"></a><span id="l5.1679" class="difflineminus">-</span>
<a href="#l5.1680"></a><span id="l5.1680" class="difflineminus">-    //Now see if hasUnreadMessages has changed</span>
<a href="#l5.1681"></a><span id="l5.1681" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; oldHasUnreadMessages;</span>
<a href="#l5.1682"></a><span id="l5.1682" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; newHasUnreadMessages;</span>
<a href="#l5.1683"></a><span id="l5.1683" class="difflineminus">-    if(oldValue &lt;=0 &amp;&amp; newValue &gt;0)</span>
<a href="#l5.1684"></a><span id="l5.1684" class="difflineminus">-    {</span>
<a href="#l5.1685"></a><span id="l5.1685" class="difflineminus">-      oldHasUnreadMessages = kFalseLiteral;</span>
<a href="#l5.1686"></a><span id="l5.1686" class="difflineminus">-      newHasUnreadMessages = kTrueLiteral;</span>
<a href="#l5.1687"></a><span id="l5.1687" class="difflineminus">-      NotifyPropertyChanged(folderResource, kNC_HasUnreadMessages, newHasUnreadMessages);</span>
<a href="#l5.1688"></a><span id="l5.1688" class="difflineminus">-    }</span>
<a href="#l5.1689"></a><span id="l5.1689" class="difflineminus">-    else if(oldValue &gt; 0 &amp;&amp; newValue &lt;= 0)</span>
<a href="#l5.1690"></a><span id="l5.1690" class="difflineminus">-    {</span>
<a href="#l5.1691"></a><span id="l5.1691" class="difflineminus">-      newHasUnreadMessages = kFalseLiteral;</span>
<a href="#l5.1692"></a><span id="l5.1692" class="difflineminus">-      NotifyPropertyChanged(folderResource, kNC_HasUnreadMessages, newHasUnreadMessages);</span>
<a href="#l5.1693"></a><span id="l5.1693" class="difflineminus">-    }</span>
<a href="#l5.1694"></a><span id="l5.1694" class="difflineminus">-  }</span>
<a href="#l5.1695"></a><span id="l5.1695" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1696"></a><span id="l5.1696" class="difflineminus">-}</span>
<a href="#l5.1697"></a><span id="l5.1697" class="difflineminus">-</span>
<a href="#l5.1698"></a><span id="l5.1698" class="difflineminus">-**/</span>
<a href="#l5.1699"></a><span id="l5.1699" class="difflineminus">-nsresult</span>
<a href="#l5.1700"></a><span id="l5.1700" class="difflineminus">-nsMsgFolderDataSource::OnFolderSortOrderPropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue)</span>
<a href="#l5.1701"></a><span id="l5.1701" class="difflineminus">-{</span>
<a href="#l5.1702"></a><span id="l5.1702" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(folderResource));</span>
<a href="#l5.1703"></a><span id="l5.1703" class="difflineminus">-  if (folder)</span>
<a href="#l5.1704"></a><span id="l5.1704" class="difflineminus">-  {</span>
<a href="#l5.1705"></a><span id="l5.1705" class="difflineminus">-    nsCOMPtr&lt;nsIRDFNode&gt; newNode;</span>
<a href="#l5.1706"></a><span id="l5.1706" class="difflineminus">-    createFolderNameNode(folder, getter_AddRefs(newNode), true);</span>
<a href="#l5.1707"></a><span id="l5.1707" class="difflineminus">-    NotifyPropertyChanged(folderResource, kNC_FolderTreeNameSort, newNode);</span>
<a href="#l5.1708"></a><span id="l5.1708" class="difflineminus">-  }</span>
<a href="#l5.1709"></a><span id="l5.1709" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1710"></a><span id="l5.1710" class="difflineminus">-}</span>
<a href="#l5.1711"></a><span id="l5.1711" class="difflineminus">-</span>
<a href="#l5.1712"></a><span id="l5.1712" class="difflineminus">-nsresult</span>
<a href="#l5.1713"></a><span id="l5.1713" class="difflineminus">-nsMsgFolderDataSource::OnFolderSizePropertyChanged(nsIRDFResource *folderResource, int64_t oldValue, int64_t newValue)</span>
<a href="#l5.1714"></a><span id="l5.1714" class="difflineminus">-{</span>
<a href="#l5.1715"></a><span id="l5.1715" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt; newNode;</span>
<a href="#l5.1716"></a><span id="l5.1716" class="difflineminus">-  GetFolderSizeNode(newValue, getter_AddRefs(newNode));</span>
<a href="#l5.1717"></a><span id="l5.1717" class="difflineminus">-  NotifyPropertyChanged(folderResource, kNC_FolderSize, newNode);</span>
<a href="#l5.1718"></a><span id="l5.1718" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1719"></a><span id="l5.1719" class="difflineminus">-}</span>
<a href="#l5.1720"></a><span id="l5.1720" class="difflineminus">-</span>
<a href="#l5.1721"></a><span id="l5.1721" class="difflineminus">-nsresult</span>
<a href="#l5.1722"></a><span id="l5.1722" class="difflineminus">-nsMsgFolderDataSource::OnTotalMessagePropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue)</span>
<a href="#l5.1723"></a><span id="l5.1723" class="difflineminus">-{</span>
<a href="#l5.1724"></a><span id="l5.1724" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt; newNode;</span>
<a href="#l5.1725"></a><span id="l5.1725" class="difflineminus">-  GetNumMessagesNode(newValue, getter_AddRefs(newNode));</span>
<a href="#l5.1726"></a><span id="l5.1726" class="difflineminus">-  NotifyPropertyChanged(folderResource, kNC_TotalMessages, newNode);</span>
<a href="#l5.1727"></a><span id="l5.1727" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1728"></a><span id="l5.1728" class="difflineminus">-}</span>
<a href="#l5.1729"></a><span id="l5.1729" class="difflineminus">-</span>
<a href="#l5.1730"></a><span id="l5.1730" class="difflineminus">-nsresult</span>
<a href="#l5.1731"></a><span id="l5.1731" class="difflineminus">-nsMsgFolderDataSource::GetNumMessagesNode(int32_t aNumMessages, nsIRDFNode **node)</span>
<a href="#l5.1732"></a><span id="l5.1732" class="difflineminus">-{</span>
<a href="#l5.1733"></a><span id="l5.1733" class="difflineminus">-  uint32_t numMessages = aNumMessages;</span>
<a href="#l5.1734"></a><span id="l5.1734" class="difflineminus">-  if(numMessages == kDisplayQuestionCount)</span>
<a href="#l5.1735"></a><span id="l5.1735" class="difflineminus">-    createNode(u&quot;???&quot;, node, getRDFService());</span>
<a href="#l5.1736"></a><span id="l5.1736" class="difflineminus">-  else if (numMessages == kDisplayBlankCount || numMessages == 0)</span>
<a href="#l5.1737"></a><span id="l5.1737" class="difflineminus">-    createNode(EmptyString().get(), node, getRDFService());</span>
<a href="#l5.1738"></a><span id="l5.1738" class="difflineminus">-  else</span>
<a href="#l5.1739"></a><span id="l5.1739" class="difflineminus">-    createIntNode(numMessages, node, getRDFService());</span>
<a href="#l5.1740"></a><span id="l5.1740" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1741"></a><span id="l5.1741" class="difflineminus">-}</span>
<a href="#l5.1742"></a><span id="l5.1742" class="difflineminus">-</span>
<a href="#l5.1743"></a><span id="l5.1743" class="difflineminus">-nsresult</span>
<a href="#l5.1744"></a><span id="l5.1744" class="difflineminus">-nsMsgFolderDataSource::GetFolderSizeNode(int64_t aFolderSize, nsIRDFNode **aNode)</span>
<a href="#l5.1745"></a><span id="l5.1745" class="difflineminus">-{</span>
<a href="#l5.1746"></a><span id="l5.1746" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1747"></a><span id="l5.1747" class="difflineminus">-  if (aFolderSize == kDisplayBlankCount64 || aFolderSize == 0)</span>
<a href="#l5.1748"></a><span id="l5.1748" class="difflineminus">-    createNode(EmptyString().get(), aNode, getRDFService());</span>
<a href="#l5.1749"></a><span id="l5.1749" class="difflineminus">-  else if (aFolderSize == kDisplayQuestionCount64)</span>
<a href="#l5.1750"></a><span id="l5.1750" class="difflineminus">-    createNode(u&quot;???&quot;, aNode, getRDFService());</span>
<a href="#l5.1751"></a><span id="l5.1751" class="difflineminus">-  else</span>
<a href="#l5.1752"></a><span id="l5.1752" class="difflineminus">-  {</span>
<a href="#l5.1753"></a><span id="l5.1753" class="difflineminus">-    nsAutoString sizeString;</span>
<a href="#l5.1754"></a><span id="l5.1754" class="difflineminus">-    rv = FormatFileSize(aFolderSize, true, sizeString);</span>
<a href="#l5.1755"></a><span id="l5.1755" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1756"></a><span id="l5.1756" class="difflineminus">-</span>
<a href="#l5.1757"></a><span id="l5.1757" class="difflineminus">-    createNode(sizeString.get(), aNode, getRDFService());</span>
<a href="#l5.1758"></a><span id="l5.1758" class="difflineminus">-  }</span>
<a href="#l5.1759"></a><span id="l5.1759" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.1760"></a><span id="l5.1760" class="difflineminus">-}</span>
<a href="#l5.1761"></a><span id="l5.1761" class="difflineminus">-</span>
<a href="#l5.1762"></a><span id="l5.1762" class="difflineminus">-nsresult</span>
<a href="#l5.1763"></a><span id="l5.1763" class="difflineminus">-nsMsgFolderDataSource::createFolderChildNode(nsIMsgFolder *folder,</span>
<a href="#l5.1764"></a><span id="l5.1764" class="difflineminus">-                                             nsIRDFNode **target)</span>
<a href="#l5.1765"></a><span id="l5.1765" class="difflineminus">-{</span>
<a href="#l5.1766"></a><span id="l5.1766" class="difflineminus">-  nsCOMPtr&lt;nsISimpleEnumerator&gt; subFolders;</span>
<a href="#l5.1767"></a><span id="l5.1767" class="difflineminus">-  nsresult rv = folder-&gt;GetSubFolders(getter_AddRefs(subFolders));</span>
<a href="#l5.1768"></a><span id="l5.1768" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l5.1769"></a><span id="l5.1769" class="difflineminus">-    return NS_RDF_NO_VALUE;</span>
<a href="#l5.1770"></a><span id="l5.1770" class="difflineminus">-</span>
<a href="#l5.1771"></a><span id="l5.1771" class="difflineminus">-  bool hasMore;</span>
<a href="#l5.1772"></a><span id="l5.1772" class="difflineminus">-  rv = subFolders-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l5.1773"></a><span id="l5.1773" class="difflineminus">-  if (NS_FAILED(rv) || !hasMore)</span>
<a href="#l5.1774"></a><span id="l5.1774" class="difflineminus">-    return NS_RDF_NO_VALUE;</span>
<a href="#l5.1775"></a><span id="l5.1775" class="difflineminus">-</span>
<a href="#l5.1776"></a><span id="l5.1776" class="difflineminus">-  nsCOMPtr&lt;nsISupports&gt; firstFolder;</span>
<a href="#l5.1777"></a><span id="l5.1777" class="difflineminus">-  rv = subFolders-&gt;GetNext(getter_AddRefs(firstFolder));</span>
<a href="#l5.1778"></a><span id="l5.1778" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l5.1779"></a><span id="l5.1779" class="difflineminus">-    return NS_RDF_NO_VALUE;</span>
<a href="#l5.1780"></a><span id="l5.1780" class="difflineminus">-</span>
<a href="#l5.1781"></a><span id="l5.1781" class="difflineminus">-  return CallQueryInterface(firstFolder, target);</span>
<a href="#l5.1782"></a><span id="l5.1782" class="difflineminus">-}</span>
<a href="#l5.1783"></a><span id="l5.1783" class="difflineminus">-</span>
<a href="#l5.1784"></a><span id="l5.1784" class="difflineminus">-#if 0</span>
<a href="#l5.1785"></a><span id="l5.1785" class="difflineminus">-nsresult nsMsgFolderDataSource::DoCopyToFolder(nsIMsgFolder *dstFolder, nsISupportsArray *arguments,</span>
<a href="#l5.1786"></a><span id="l5.1786" class="difflineminus">-                         nsIMsgWindow *msgWindow, bool isMove)</span>
<a href="#l5.1787"></a><span id="l5.1787" class="difflineminus">-{</span>
<a href="#l5.1788"></a><span id="l5.1788" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1789"></a><span id="l5.1789" class="difflineminus">-  uint32_t itemCount;</span>
<a href="#l5.1790"></a><span id="l5.1790" class="difflineminus">-  rv = arguments-&gt;Count(&amp;itemCount);</span>
<a href="#l5.1791"></a><span id="l5.1791" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1792"></a><span id="l5.1792" class="difflineminus">-</span>
<a href="#l5.1793"></a><span id="l5.1793" class="difflineminus">-  //need source folder and at least one item to copy</span>
<a href="#l5.1794"></a><span id="l5.1794" class="difflineminus">-  if(itemCount &lt; 2)</span>
<a href="#l5.1795"></a><span id="l5.1795" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l5.1796"></a><span id="l5.1796" class="difflineminus">-</span>
<a href="#l5.1797"></a><span id="l5.1797" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder(do_QueryElementAt(arguments, 0));</span>
<a href="#l5.1798"></a><span id="l5.1798" class="difflineminus">-  if(!srcFolder)</span>
<a href="#l5.1799"></a><span id="l5.1799" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l5.1800"></a><span id="l5.1800" class="difflineminus">-</span>
<a href="#l5.1801"></a><span id="l5.1801" class="difflineminus">-  nsCOMPtr&lt;nsIMutableArray&gt; messageArray(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l5.1802"></a><span id="l5.1802" class="difflineminus">-</span>
<a href="#l5.1803"></a><span id="l5.1803" class="difflineminus">-  // Remove first element</span>
<a href="#l5.1804"></a><span id="l5.1804" class="difflineminus">-  for(uint32_t i = 1; i &lt; itemCount; i++)</span>
<a href="#l5.1805"></a><span id="l5.1805" class="difflineminus">-  {</span>
<a href="#l5.1806"></a><span id="l5.1806" class="difflineminus">-    nsCOMPtr&lt;nsIMsgDBHdr&gt; message(do_QueryElementAt(arguments, i));</span>
<a href="#l5.1807"></a><span id="l5.1807" class="difflineminus">-    if (message)</span>
<a href="#l5.1808"></a><span id="l5.1808" class="difflineminus">-    {</span>
<a href="#l5.1809"></a><span id="l5.1809" class="difflineminus">-      messageArray-&gt;AppendElement(message);</span>
<a href="#l5.1810"></a><span id="l5.1810" class="difflineminus">-    }</span>
<a href="#l5.1811"></a><span id="l5.1811" class="difflineminus">-  }</span>
<a href="#l5.1812"></a><span id="l5.1812" class="difflineminus">-</span>
<a href="#l5.1813"></a><span id="l5.1813" class="difflineminus">-  //Call copyservice with dstFolder, srcFolder, messages, isMove, and txnManager</span>
<a href="#l5.1814"></a><span id="l5.1814" class="difflineminus">-  nsCOMPtr&lt;nsIMsgCopyService&gt; copyService =</span>
<a href="#l5.1815"></a><span id="l5.1815" class="difflineminus">-    do_GetService(NS_MSGCOPYSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l5.1816"></a><span id="l5.1816" class="difflineminus">-  NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l5.1817"></a><span id="l5.1817" class="difflineminus">-</span>
<a href="#l5.1818"></a><span id="l5.1818" class="difflineminus">-  return copyService-&gt;CopyMessages(srcFolder, messageArray, dstFolder, isMove,</span>
<a href="#l5.1819"></a><span id="l5.1819" class="difflineminus">-    nullptr, msgWindow, true/* allowUndo */);</span>
<a href="#l5.1820"></a><span id="l5.1820" class="difflineminus">-}</span>
<a href="#l5.1821"></a><span id="l5.1821" class="difflineminus">-</span>
<a href="#l5.1822"></a><span id="l5.1822" class="difflineminus">-nsresult nsMsgFolderDataSource::DoFolderCopyToFolder(nsIMsgFolder *dstFolder, nsISupportsArray *arguments,</span>
<a href="#l5.1823"></a><span id="l5.1823" class="difflineminus">-                                                     nsIMsgWindow *msgWindow, bool isMoveFolder)</span>
<a href="#l5.1824"></a><span id="l5.1824" class="difflineminus">-{</span>
<a href="#l5.1825"></a><span id="l5.1825" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.1826"></a><span id="l5.1826" class="difflineminus">-  uint32_t itemCount;</span>
<a href="#l5.1827"></a><span id="l5.1827" class="difflineminus">-  rv = arguments-&gt;Count(&amp;itemCount);</span>
<a href="#l5.1828"></a><span id="l5.1828" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1829"></a><span id="l5.1829" class="difflineminus">-</span>
<a href="#l5.1830"></a><span id="l5.1830" class="difflineminus">-  //need at least one item to copy</span>
<a href="#l5.1831"></a><span id="l5.1831" class="difflineminus">-  if(itemCount &lt; 1)</span>
<a href="#l5.1832"></a><span id="l5.1832" class="difflineminus">-    return NS_ERROR_FAILURE;</span>
<a href="#l5.1833"></a><span id="l5.1833" class="difflineminus">-</span>
<a href="#l5.1834"></a><span id="l5.1834" class="difflineminus">-  if (!isMoveFolder)   // copy folder not on the same server</span>
<a href="#l5.1835"></a><span id="l5.1835" class="difflineminus">-  {</span>
<a href="#l5.1836"></a><span id="l5.1836" class="difflineminus">-    // Create an nsIMutableArray from the nsISupportsArray</span>
<a href="#l5.1837"></a><span id="l5.1837" class="difflineminus">-    nsCOMPtr&lt;nsIMutableArray&gt; folderArray(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l5.1838"></a><span id="l5.1838" class="difflineminus">-    for (uint32_t i = 0; i &lt; itemCount; i++)</span>
<a href="#l5.1839"></a><span id="l5.1839" class="difflineminus">-    {</span>
<a href="#l5.1840"></a><span id="l5.1840" class="difflineminus">-      nsCOMPtr&lt;nsISupports&gt; element(do_QueryElementAt(arguments, i, &amp;rv));</span>
<a href="#l5.1841"></a><span id="l5.1841" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l5.1842"></a><span id="l5.1842" class="difflineminus">-        folderArray-&gt;AppendElement(element);</span>
<a href="#l5.1843"></a><span id="l5.1843" class="difflineminus">-    }</span>
<a href="#l5.1844"></a><span id="l5.1844" class="difflineminus">-</span>
<a href="#l5.1845"></a><span id="l5.1845" class="difflineminus">-    //Call copyservice with dstFolder, srcFolder, folders and isMoveFolder</span>
<a href="#l5.1846"></a><span id="l5.1846" class="difflineminus">-    nsCOMPtr&lt;nsIMsgCopyService&gt; copyService = do_GetService(NS_MSGCOPYSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l5.1847"></a><span id="l5.1847" class="difflineminus">-    if(NS_SUCCEEDED(rv))</span>
<a href="#l5.1848"></a><span id="l5.1848" class="difflineminus">-    {</span>
<a href="#l5.1849"></a><span id="l5.1849" class="difflineminus">-      rv = copyService-&gt;CopyFolders(folderArray, dstFolder, isMoveFolder,</span>
<a href="#l5.1850"></a><span id="l5.1850" class="difflineminus">-        nullptr, msgWindow);</span>
<a href="#l5.1851"></a><span id="l5.1851" class="difflineminus">-</span>
<a href="#l5.1852"></a><span id="l5.1852" class="difflineminus">-    }</span>
<a href="#l5.1853"></a><span id="l5.1853" class="difflineminus">-  }</span>
<a href="#l5.1854"></a><span id="l5.1854" class="difflineminus">-  else    //within the same server therefore no need for copy service</span>
<a href="#l5.1855"></a><span id="l5.1855" class="difflineminus">-  {</span>
<a href="#l5.1856"></a><span id="l5.1856" class="difflineminus">-</span>
<a href="#l5.1857"></a><span id="l5.1857" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l5.1858"></a><span id="l5.1858" class="difflineminus">-    for (uint32_t i=0;i&lt; itemCount; i++)</span>
<a href="#l5.1859"></a><span id="l5.1859" class="difflineminus">-    {</span>
<a href="#l5.1860"></a><span id="l5.1860" class="difflineminus">-      msgFolder = do_QueryElementAt(arguments, i, &amp;rv);</span>
<a href="#l5.1861"></a><span id="l5.1861" class="difflineminus">-      if (NS_SUCCEEDED(rv))</span>
<a href="#l5.1862"></a><span id="l5.1862" class="difflineminus">-      {</span>
<a href="#l5.1863"></a><span id="l5.1863" class="difflineminus">-        rv = dstFolder-&gt;CopyFolder(msgFolder, isMoveFolder , msgWindow, nullptr);</span>
<a href="#l5.1864"></a><span id="l5.1864" class="difflineminus">-        NS_ASSERTION((NS_SUCCEEDED(rv)),&quot;Copy folder failed.&quot;);</span>
<a href="#l5.1865"></a><span id="l5.1865" class="difflineminus">-      }</span>
<a href="#l5.1866"></a><span id="l5.1866" class="difflineminus">-    }</span>
<a href="#l5.1867"></a><span id="l5.1867" class="difflineminus">-  }</span>
<a href="#l5.1868"></a><span id="l5.1868" class="difflineminus">-</span>
<a href="#l5.1869"></a><span id="l5.1869" class="difflineminus">-  return rv;</span>
<a href="#l5.1870"></a><span id="l5.1870" class="difflineminus">-  //return NS_OK;</span>
<a href="#l5.1871"></a><span id="l5.1871" class="difflineminus">-}</span>
<a href="#l5.1872"></a><span id="l5.1872" class="difflineminus">-</span>
<a href="#l5.1873"></a><span id="l5.1873" class="difflineminus">-nsresult nsMsgFolderDataSource::DoDeleteFromFolder(nsIMsgFolder *folder, nsISupportsArray *arguments,</span>
<a href="#l5.1874"></a><span id="l5.1874" class="difflineminus">-                                                   nsIMsgWindow *msgWindow, bool reallyDelete)</span>
<a href="#l5.1875"></a><span id="l5.1875" class="difflineminus">-{</span>
<a href="#l5.1876"></a><span id="l5.1876" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l5.1877"></a><span id="l5.1877" class="difflineminus">-  uint32_t itemCount;</span>
<a href="#l5.1878"></a><span id="l5.1878" class="difflineminus">-  rv = arguments-&gt;Count(&amp;itemCount);</span>
<a href="#l5.1879"></a><span id="l5.1879" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1880"></a><span id="l5.1880" class="difflineminus">-</span>
<a href="#l5.1881"></a><span id="l5.1881" class="difflineminus">-  nsCOMPtr&lt;nsIMutableArray&gt; messageArray(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l5.1882"></a><span id="l5.1882" class="difflineminus">-  nsCOMPtr&lt;nsIMutableArray&gt; folderArray(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l5.1883"></a><span id="l5.1883" class="difflineminus">-</span>
<a href="#l5.1884"></a><span id="l5.1884" class="difflineminus">-  //Split up deleted items into different type arrays to be passed to the folder</span>
<a href="#l5.1885"></a><span id="l5.1885" class="difflineminus">-  //for deletion.</span>
<a href="#l5.1886"></a><span id="l5.1886" class="difflineminus">-  for(uint32_t item = 0; item &lt; itemCount; item++)</span>
<a href="#l5.1887"></a><span id="l5.1887" class="difflineminus">-  {</span>
<a href="#l5.1888"></a><span id="l5.1888" class="difflineminus">-    nsCOMPtr&lt;nsISupports&gt; supports(do_QueryElementAt(arguments, item));</span>
<a href="#l5.1889"></a><span id="l5.1889" class="difflineminus">-    nsCOMPtr&lt;nsIMsgDBHdr&gt; deletedMessage(do_QueryInterface(supports));</span>
<a href="#l5.1890"></a><span id="l5.1890" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; deletedFolder(do_QueryInterface(supports));</span>
<a href="#l5.1891"></a><span id="l5.1891" class="difflineminus">-    if (deletedMessage)</span>
<a href="#l5.1892"></a><span id="l5.1892" class="difflineminus">-    {</span>
<a href="#l5.1893"></a><span id="l5.1893" class="difflineminus">-      messageArray-&gt;AppendElement(supports);</span>
<a href="#l5.1894"></a><span id="l5.1894" class="difflineminus">-    }</span>
<a href="#l5.1895"></a><span id="l5.1895" class="difflineminus">-    else if(deletedFolder)</span>
<a href="#l5.1896"></a><span id="l5.1896" class="difflineminus">-    {</span>
<a href="#l5.1897"></a><span id="l5.1897" class="difflineminus">-      folderArray-&gt;AppendElement(supports);</span>
<a href="#l5.1898"></a><span id="l5.1898" class="difflineminus">-    }</span>
<a href="#l5.1899"></a><span id="l5.1899" class="difflineminus">-  }</span>
<a href="#l5.1900"></a><span id="l5.1900" class="difflineminus">-  uint32_t cnt;</span>
<a href="#l5.1901"></a><span id="l5.1901" class="difflineminus">-  rv = messageArray-&gt;GetLength(&amp;cnt);</span>
<a href="#l5.1902"></a><span id="l5.1902" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1903"></a><span id="l5.1903" class="difflineminus">-  if (cnt &gt; 0)</span>
<a href="#l5.1904"></a><span id="l5.1904" class="difflineminus">-    rv = folder-&gt;DeleteMessages(messageArray, msgWindow, reallyDelete, false, nullptr, true /*allowUndo*/);</span>
<a href="#l5.1905"></a><span id="l5.1905" class="difflineminus">-</span>
<a href="#l5.1906"></a><span id="l5.1906" class="difflineminus">-  rv = folderArray-&gt;GetLength(&amp;cnt);</span>
<a href="#l5.1907"></a><span id="l5.1907" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l5.1908"></a><span id="l5.1908" class="difflineminus">-  if (cnt &gt; 0)</span>
<a href="#l5.1909"></a><span id="l5.1909" class="difflineminus">-  {</span>
<a href="#l5.1910"></a><span id="l5.1910" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; folderToDelete = do_QueryElementAt(folderArray, 0);</span>
<a href="#l5.1911"></a><span id="l5.1911" class="difflineminus">-    uint32_t folderFlags = 0;</span>
<a href="#l5.1912"></a><span id="l5.1912" class="difflineminus">-    if (folderToDelete)</span>
<a href="#l5.1913"></a><span id="l5.1913" class="difflineminus">-    {</span>
<a href="#l5.1914"></a><span id="l5.1914" class="difflineminus">-      folderToDelete-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l5.1915"></a><span id="l5.1915" class="difflineminus">-      if (folderFlags &amp; nsMsgFolderFlags::Virtual)</span>
<a href="#l5.1916"></a><span id="l5.1916" class="difflineminus">-      {</span>
<a href="#l5.1917"></a><span id="l5.1917" class="difflineminus">-        NS_ENSURE_ARG_POINTER(msgWindow);</span>
<a href="#l5.1918"></a><span id="l5.1918" class="difflineminus">-        nsCOMPtr&lt;nsIStringBundleService&gt; sBundleService =</span>
<a href="#l5.1919"></a><span id="l5.1919" class="difflineminus">-          mozilla::services::GetStringBundleService();</span>
<a href="#l5.1920"></a><span id="l5.1920" class="difflineminus">-        NS_ENSURE_TRUE(sBundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l5.1921"></a><span id="l5.1921" class="difflineminus">-        nsCOMPtr&lt;nsIStringBundle&gt; sMessengerStringBundle;</span>
<a href="#l5.1922"></a><span id="l5.1922" class="difflineminus">-        nsString confirmMsg;</span>
<a href="#l5.1923"></a><span id="l5.1923" class="difflineminus">-        rv = sBundleService-&gt;CreateBundle(MESSENGER_STRING_URL, getter_AddRefs(sMessengerStringBundle));</span>
<a href="#l5.1924"></a><span id="l5.1924" class="difflineminus">-        NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.1925"></a><span id="l5.1925" class="difflineminus">-        sMessengerStringBundle-&gt;GetStringFromName(&quot;confirmSavedSearchDeleteMessage&quot;, confirmMsg);</span>
<a href="#l5.1926"></a><span id="l5.1926" class="difflineminus">-</span>
<a href="#l5.1927"></a><span id="l5.1927" class="difflineminus">-        nsCOMPtr&lt;nsIPrompt&gt; dialog;</span>
<a href="#l5.1928"></a><span id="l5.1928" class="difflineminus">-        rv = msgWindow-&gt;GetPromptDialog(getter_AddRefs(dialog));</span>
<a href="#l5.1929"></a><span id="l5.1929" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l5.1930"></a><span id="l5.1930" class="difflineminus">-        {</span>
<a href="#l5.1931"></a><span id="l5.1931" class="difflineminus">-          bool dialogResult;</span>
<a href="#l5.1932"></a><span id="l5.1932" class="difflineminus">-          rv = dialog-&gt;Confirm(nullptr, confirmMsg.get(), &amp;dialogResult);</span>
<a href="#l5.1933"></a><span id="l5.1933" class="difflineminus">-          if (!dialogResult)</span>
<a href="#l5.1934"></a><span id="l5.1934" class="difflineminus">-            return NS_OK;</span>
<a href="#l5.1935"></a><span id="l5.1935" class="difflineminus">-        }</span>
<a href="#l5.1936"></a><span id="l5.1936" class="difflineminus">-      }</span>
<a href="#l5.1937"></a><span id="l5.1937" class="difflineminus">-    }</span>
<a href="#l5.1938"></a><span id="l5.1938" class="difflineminus">-    rv = folder-&gt;DeleteSubFolders(folderArray, msgWindow);</span>
<a href="#l5.1939"></a><span id="l5.1939" class="difflineminus">-  }</span>
<a href="#l5.1940"></a><span id="l5.1940" class="difflineminus">-  return rv;</span>
<a href="#l5.1941"></a><span id="l5.1941" class="difflineminus">-}</span>
<a href="#l5.1942"></a><span id="l5.1942" class="difflineminus">-</span>
<a href="#l5.1943"></a><span id="l5.1943" class="difflineminus">-nsresult nsMsgFolderDataSource::DoNewFolder(nsIMsgFolder *folder, nsISupportsArray *arguments, nsIMsgWindow *window)</span>
<a href="#l5.1944"></a><span id="l5.1944" class="difflineminus">-{</span>
<a href="#l5.1945"></a><span id="l5.1945" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l5.1946"></a><span id="l5.1946" class="difflineminus">-  nsCOMPtr&lt;nsIRDFLiteral&gt; literal = do_QueryElementAt(arguments, 0, &amp;rv);</span>
<a href="#l5.1947"></a><span id="l5.1947" class="difflineminus">-  if(NS_SUCCEEDED(rv))</span>
<a href="#l5.1948"></a><span id="l5.1948" class="difflineminus">-  {</span>
<a href="#l5.1949"></a><span id="l5.1949" class="difflineminus">-    nsString name;</span>
<a href="#l5.1950"></a><span id="l5.1950" class="difflineminus">-    literal-&gt;GetValue(getter_Copies(name));</span>
<a href="#l5.1951"></a><span id="l5.1951" class="difflineminus">-    rv = folder-&gt;CreateSubfolder(name, window);</span>
<a href="#l5.1952"></a><span id="l5.1952" class="difflineminus">-  }</span>
<a href="#l5.1953"></a><span id="l5.1953" class="difflineminus">-  return rv;</span>
<a href="#l5.1954"></a><span id="l5.1954" class="difflineminus">-}</span>
<a href="#l5.1955"></a><span id="l5.1955" class="difflineminus">-#endif</span>
<a href="#l5.1956"></a><span id="l5.1956" class="difflineminus">-</span>
<a href="#l5.1957"></a><span id="l5.1957" class="difflineminus">-nsresult nsMsgFolderDataSource::DoFolderAssert(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target)</span>
<a href="#l5.1958"></a><span id="l5.1958" class="difflineminus">-{</span>
<a href="#l5.1959"></a><span id="l5.1959" class="difflineminus">-  nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l5.1960"></a><span id="l5.1960" class="difflineminus">-</span>
<a href="#l5.1961"></a><span id="l5.1961" class="difflineminus">-  if (kNC_Charset == property)</span>
<a href="#l5.1962"></a><span id="l5.1962" class="difflineminus">-  {</span>
<a href="#l5.1963"></a><span id="l5.1963" class="difflineminus">-    nsCOMPtr&lt;nsIRDFLiteral&gt; literal(do_QueryInterface(target));</span>
<a href="#l5.1964"></a><span id="l5.1964" class="difflineminus">-    if(literal)</span>
<a href="#l5.1965"></a><span id="l5.1965" class="difflineminus">-    {</span>
<a href="#l5.1966"></a><span id="l5.1966" class="difflineminus">-      const char16_t* value;</span>
<a href="#l5.1967"></a><span id="l5.1967" class="difflineminus">-      rv = literal-&gt;GetValueConst(&amp;value);</span>
<a href="#l5.1968"></a><span id="l5.1968" class="difflineminus">-      if(NS_SUCCEEDED(rv))</span>
<a href="#l5.1969"></a><span id="l5.1969" class="difflineminus">-        rv = folder-&gt;SetCharset(NS_LossyConvertUTF16toASCII(value));</span>
<a href="#l5.1970"></a><span id="l5.1970" class="difflineminus">-    }</span>
<a href="#l5.1971"></a><span id="l5.1971" class="difflineminus">-    else</span>
<a href="#l5.1972"></a><span id="l5.1972" class="difflineminus">-      rv = NS_ERROR_FAILURE;</span>
<a href="#l5.1973"></a><span id="l5.1973" class="difflineminus">-  }</span>
<a href="#l5.1974"></a><span id="l5.1974" class="difflineminus">-  else if (kNC_Open == property &amp;&amp; target == kTrueLiteral)</span>
<a href="#l5.1975"></a><span id="l5.1975" class="difflineminus">-      rv = folder-&gt;ClearFlag(nsMsgFolderFlags::Elided);</span>
<a href="#l5.1976"></a><span id="l5.1976" class="difflineminus">-</span>
<a href="#l5.1977"></a><span id="l5.1977" class="difflineminus">-  return rv;</span>
<a href="#l5.1978"></a><span id="l5.1978" class="difflineminus">-}</span>
<a href="#l5.1979"></a><span id="l5.1979" class="difflineminus">-</span>
<a href="#l5.1980"></a><span id="l5.1980" class="difflineminus">-nsresult nsMsgFolderDataSource::DoFolderUnassert(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target)</span>
<a href="#l5.1981"></a><span id="l5.1981" class="difflineminus">-{</span>
<a href="#l5.1982"></a><span id="l5.1982" class="difflineminus">-  nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l5.1983"></a><span id="l5.1983" class="difflineminus">-</span>
<a href="#l5.1984"></a><span id="l5.1984" class="difflineminus">-  if((kNC_Open == property) &amp;&amp; target == kTrueLiteral)</span>
<a href="#l5.1985"></a><span id="l5.1985" class="difflineminus">-      rv = folder-&gt;SetFlag(nsMsgFolderFlags::Elided);</span>
<a href="#l5.1986"></a><span id="l5.1986" class="difflineminus">-</span>
<a href="#l5.1987"></a><span id="l5.1987" class="difflineminus">-  return rv;</span>
<a href="#l5.1988"></a><span id="l5.1988" class="difflineminus">-}</span>
<a href="#l5.1989"></a><span id="l5.1989" class="difflineminus">-</span>
<a href="#l5.1990"></a><span id="l5.1990" class="difflineminus">-nsresult nsMsgFolderDataSource::DoFolderHasAssertion(nsIMsgFolder *folder,</span>
<a href="#l5.1991"></a><span id="l5.1991" class="difflineminus">-                                                     nsIRDFResource *property,</span>
<a href="#l5.1992"></a><span id="l5.1992" class="difflineminus">-                                                     nsIRDFNode *target,</span>
<a href="#l5.1993"></a><span id="l5.1993" class="difflineminus">-                                                     bool tv,</span>
<a href="#l5.1994"></a><span id="l5.1994" class="difflineminus">-                                                     bool *hasAssertion)</span>
<a href="#l5.1995"></a><span id="l5.1995" class="difflineminus">-{</span>
<a href="#l5.1996"></a><span id="l5.1996" class="difflineminus">-  nsresult rv = NS_OK;</span>
<a href="#l5.1997"></a><span id="l5.1997" class="difflineminus">-  if(!hasAssertion)</span>
<a href="#l5.1998"></a><span id="l5.1998" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l5.1999"></a><span id="l5.1999" class="difflineminus">-</span>
<a href="#l5.2000"></a><span id="l5.2000" class="difflineminus">-  //We're not keeping track of negative assertions on folders.</span>
<a href="#l5.2001"></a><span id="l5.2001" class="difflineminus">-  if(!tv)</span>
<a href="#l5.2002"></a><span id="l5.2002" class="difflineminus">-  {</span>
<a href="#l5.2003"></a><span id="l5.2003" class="difflineminus">-    *hasAssertion = false;</span>
<a href="#l5.2004"></a><span id="l5.2004" class="difflineminus">-    return NS_OK;</span>
<a href="#l5.2005"></a><span id="l5.2005" class="difflineminus">-  }</span>
<a href="#l5.2006"></a><span id="l5.2006" class="difflineminus">-</span>
<a href="#l5.2007"></a><span id="l5.2007" class="difflineminus">-  if (kNC_Child == property)</span>
<a href="#l5.2008"></a><span id="l5.2008" class="difflineminus">-  {</span>
<a href="#l5.2009"></a><span id="l5.2009" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; childFolder(do_QueryInterface(target, &amp;rv));</span>
<a href="#l5.2010"></a><span id="l5.2010" class="difflineminus">-    if(NS_SUCCEEDED(rv))</span>
<a href="#l5.2011"></a><span id="l5.2011" class="difflineminus">-    {</span>
<a href="#l5.2012"></a><span id="l5.2012" class="difflineminus">-      nsCOMPtr&lt;nsIMsgFolder&gt; childsParent;</span>
<a href="#l5.2013"></a><span id="l5.2013" class="difflineminus">-      rv = childFolder-&gt;GetParent(getter_AddRefs(childsParent));</span>
<a href="#l5.2014"></a><span id="l5.2014" class="difflineminus">-      *hasAssertion = (NS_SUCCEEDED(rv) &amp;&amp; childsParent &amp;&amp; folder</span>
<a href="#l5.2015"></a><span id="l5.2015" class="difflineminus">-        &amp;&amp; (childsParent.get() == folder));</span>
<a href="#l5.2016"></a><span id="l5.2016" class="difflineminus">-    }</span>
<a href="#l5.2017"></a><span id="l5.2017" class="difflineminus">-  }</span>
<a href="#l5.2018"></a><span id="l5.2018" class="difflineminus">-  else if ((kNC_Name == property) ||</span>
<a href="#l5.2019"></a><span id="l5.2019" class="difflineminus">-    (kNC_Open == property) ||</span>
<a href="#l5.2020"></a><span id="l5.2020" class="difflineminus">-    (kNC_FolderTreeName == property) ||</span>
<a href="#l5.2021"></a><span id="l5.2021" class="difflineminus">-    (kNC_FolderTreeSimpleName == property) ||</span>
<a href="#l5.2022"></a><span id="l5.2022" class="difflineminus">-    (kNC_SpecialFolder == property) ||</span>
<a href="#l5.2023"></a><span id="l5.2023" class="difflineminus">-    (kNC_ServerType == property) ||</span>
<a href="#l5.2024"></a><span id="l5.2024" class="difflineminus">-    (kNC_IsDeferred == property) ||</span>
<a href="#l5.2025"></a><span id="l5.2025" class="difflineminus">-    (kNC_CanCreateFoldersOnServer == property) ||</span>
<a href="#l5.2026"></a><span id="l5.2026" class="difflineminus">-    (kNC_CanFileMessagesOnServer == property) ||</span>
<a href="#l5.2027"></a><span id="l5.2027" class="difflineminus">-    (kNC_IsServer == property) ||</span>
<a href="#l5.2028"></a><span id="l5.2028" class="difflineminus">-    (kNC_IsSecure == property) ||</span>
<a href="#l5.2029"></a><span id="l5.2029" class="difflineminus">-    (kNC_CanSubscribe == property) ||</span>
<a href="#l5.2030"></a><span id="l5.2030" class="difflineminus">-    (kNC_SupportsOffline == property) ||</span>
<a href="#l5.2031"></a><span id="l5.2031" class="difflineminus">-    (kNC_CanFileMessages == property) ||</span>
<a href="#l5.2032"></a><span id="l5.2032" class="difflineminus">-    (kNC_CanCreateSubfolders == property) ||</span>
<a href="#l5.2033"></a><span id="l5.2033" class="difflineminus">-    (kNC_CanRename == property) ||</span>
<a href="#l5.2034"></a><span id="l5.2034" class="difflineminus">-    (kNC_CanCompact == property) ||</span>
<a href="#l5.2035"></a><span id="l5.2035" class="difflineminus">-    (kNC_TotalMessages == property) ||</span>
<a href="#l5.2036"></a><span id="l5.2036" class="difflineminus">-    (kNC_TotalUnreadMessages == property) ||</span>
<a href="#l5.2037"></a><span id="l5.2037" class="difflineminus">-    (kNC_FolderSize == property) ||</span>
<a href="#l5.2038"></a><span id="l5.2038" class="difflineminus">-    (kNC_Charset == property) ||</span>
<a href="#l5.2039"></a><span id="l5.2039" class="difflineminus">-    (kNC_BiffState == property) ||</span>
<a href="#l5.2040"></a><span id="l5.2040" class="difflineminus">-    (kNC_HasUnreadMessages == property) ||</span>
<a href="#l5.2041"></a><span id="l5.2041" class="difflineminus">-    (kNC_NoSelect == property)  ||</span>
<a href="#l5.2042"></a><span id="l5.2042" class="difflineminus">-    (kNC_Synchronize == property) ||</span>
<a href="#l5.2043"></a><span id="l5.2043" class="difflineminus">-    (kNC_SyncDisabled == property) ||</span>
<a href="#l5.2044"></a><span id="l5.2044" class="difflineminus">-    (kNC_VirtualFolder == property) ||</span>
<a href="#l5.2045"></a><span id="l5.2045" class="difflineminus">-    (kNC_CanSearchMessages == property))</span>
<a href="#l5.2046"></a><span id="l5.2046" class="difflineminus">-  {</span>
<a href="#l5.2047"></a><span id="l5.2047" class="difflineminus">-    nsCOMPtr&lt;nsIRDFResource&gt; folderResource(do_QueryInterface(folder, &amp;rv));</span>
<a href="#l5.2048"></a><span id="l5.2048" class="difflineminus">-</span>
<a href="#l5.2049"></a><span id="l5.2049" class="difflineminus">-    if(NS_FAILED(rv))</span>
<a href="#l5.2050"></a><span id="l5.2050" class="difflineminus">-      return rv;</span>
<a href="#l5.2051"></a><span id="l5.2051" class="difflineminus">-</span>
<a href="#l5.2052"></a><span id="l5.2052" class="difflineminus">-    rv = GetTargetHasAssertion(this, folderResource, property, tv, target, hasAssertion);</span>
<a href="#l5.2053"></a><span id="l5.2053" class="difflineminus">-  }</span>
<a href="#l5.2054"></a><span id="l5.2054" class="difflineminus">-  else</span>
<a href="#l5.2055"></a><span id="l5.2055" class="difflineminus">-    *hasAssertion = false;</span>
<a href="#l5.2056"></a><span id="l5.2056" class="difflineminus">-  return rv;</span>
<a href="#l5.2057"></a><span id="l5.2057" class="difflineminus">-}</span>
<a href="#l5.2058"></a><span id="l5.2058" class="difflineminus">-</span>
<a href="#l5.2059"></a><span id="l5.2059" class="difflineminus">-nsMsgFlatFolderDataSource::nsMsgFlatFolderDataSource()</span>
<a href="#l5.2060"></a><span id="l5.2060" class="difflineminus">-{</span>
<a href="#l5.2061"></a><span id="l5.2061" class="difflineminus">-  m_builtFolders = false;</span>
<a href="#l5.2062"></a><span id="l5.2062" class="difflineminus">-}</span>
<a href="#l5.2063"></a><span id="l5.2063" class="difflineminus">-</span>
<a href="#l5.2064"></a><span id="l5.2064" class="difflineminus">-nsMsgFlatFolderDataSource::~nsMsgFlatFolderDataSource()</span>
<a href="#l5.2065"></a><span id="l5.2065" class="difflineminus">-{</span>
<a href="#l5.2066"></a><span id="l5.2066" class="difflineminus">-}</span>
<a href="#l5.2067"></a><span id="l5.2067" class="difflineminus">-</span>
<a href="#l5.2068"></a><span id="l5.2068" class="difflineminus">-nsresult nsMsgFlatFolderDataSource::Init()</span>
<a href="#l5.2069"></a><span id="l5.2069" class="difflineminus">-{</span>
<a href="#l5.2070"></a><span id="l5.2070" class="difflineminus">-  nsIRDFService* rdf = getRDFService();</span>
<a href="#l5.2071"></a><span id="l5.2071" class="difflineminus">-  NS_ENSURE_TRUE(rdf, NS_ERROR_FAILURE);</span>
<a href="#l5.2072"></a><span id="l5.2072" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt; source;</span>
<a href="#l5.2073"></a><span id="l5.2073" class="difflineminus">-  nsAutoCString dsUri(m_dsName);</span>
<a href="#l5.2074"></a><span id="l5.2074" class="difflineminus">-  dsUri.AppendLiteral(&quot;:/&quot;);</span>
<a href="#l5.2075"></a><span id="l5.2075" class="difflineminus">-  rdf-&gt;GetResource(dsUri, getter_AddRefs(m_rootResource));</span>
<a href="#l5.2076"></a><span id="l5.2076" class="difflineminus">-</span>
<a href="#l5.2077"></a><span id="l5.2077" class="difflineminus">-  return nsMsgFolderDataSource::Init();</span>
<a href="#l5.2078"></a><span id="l5.2078" class="difflineminus">-}</span>
<a href="#l5.2079"></a><span id="l5.2079" class="difflineminus">-</span>
<a href="#l5.2080"></a><span id="l5.2080" class="difflineminus">-void nsMsgFlatFolderDataSource::Cleanup()</span>
<a href="#l5.2081"></a><span id="l5.2081" class="difflineminus">-{</span>
<a href="#l5.2082"></a><span id="l5.2082" class="difflineminus">-  m_folders.Clear();</span>
<a href="#l5.2083"></a><span id="l5.2083" class="difflineminus">-  m_builtFolders = false;</span>
<a href="#l5.2084"></a><span id="l5.2084" class="difflineminus">-  nsMsgFolderDataSource::Cleanup();</span>
<a href="#l5.2085"></a><span id="l5.2085" class="difflineminus">-}</span>
<a href="#l5.2086"></a><span id="l5.2086" class="difflineminus">-</span>
<a href="#l5.2087"></a><span id="l5.2087" class="difflineminus">-NS_IMETHODIMP nsMsgFlatFolderDataSource::GetTarget(nsIRDFResource* source,</span>
<a href="#l5.2088"></a><span id="l5.2088" class="difflineminus">-                       nsIRDFResource* property,</span>
<a href="#l5.2089"></a><span id="l5.2089" class="difflineminus">-                       bool tv,</span>
<a href="#l5.2090"></a><span id="l5.2090" class="difflineminus">-                       nsIRDFNode** target)</span>
<a href="#l5.2091"></a><span id="l5.2091" class="difflineminus">-{</span>
<a href="#l5.2092"></a><span id="l5.2092" class="difflineminus">-  return (property == kNC_Child)</span>
<a href="#l5.2093"></a><span id="l5.2093" class="difflineminus">-    ? NS_RDF_NO_VALUE</span>
<a href="#l5.2094"></a><span id="l5.2094" class="difflineminus">-    : nsMsgFolderDataSource::GetTarget(source, property, tv, target);</span>
<a href="#l5.2095"></a><span id="l5.2095" class="difflineminus">-}</span>
<a href="#l5.2096"></a><span id="l5.2096" class="difflineminus">-</span>
<a href="#l5.2097"></a><span id="l5.2097" class="difflineminus">-</span>
<a href="#l5.2098"></a><span id="l5.2098" class="difflineminus">-NS_IMETHODIMP nsMsgFlatFolderDataSource::GetTargets(nsIRDFResource* source,</span>
<a href="#l5.2099"></a><span id="l5.2099" class="difflineminus">-                                                nsIRDFResource* property,</span>
<a href="#l5.2100"></a><span id="l5.2100" class="difflineminus">-                                                bool tv,</span>
<a href="#l5.2101"></a><span id="l5.2101" class="difflineminus">-                                                nsISimpleEnumerator** targets)</span>
<a href="#l5.2102"></a><span id="l5.2102" class="difflineminus">-{</span>
<a href="#l5.2103"></a><span id="l5.2103" class="difflineminus">-  if (kNC_Child != property)</span>
<a href="#l5.2104"></a><span id="l5.2104" class="difflineminus">-    return nsMsgFolderDataSource::GetTargets(source, property, tv, targets);</span>
<a href="#l5.2105"></a><span id="l5.2105" class="difflineminus">-</span>
<a href="#l5.2106"></a><span id="l5.2106" class="difflineminus">-  if(!targets)</span>
<a href="#l5.2107"></a><span id="l5.2107" class="difflineminus">-    return NS_ERROR_NULL_POINTER;</span>
<a href="#l5.2108"></a><span id="l5.2108" class="difflineminus">-</span>
<a href="#l5.2109"></a><span id="l5.2109" class="difflineminus">-  if (ResourceIsOurRoot(source))</span>
<a href="#l5.2110"></a><span id="l5.2110" class="difflineminus">-  {</span>
<a href="#l5.2111"></a><span id="l5.2111" class="difflineminus">-    EnsureFolders();</span>
<a href="#l5.2112"></a><span id="l5.2112" class="difflineminus">-    return NS_NewArrayEnumerator(targets, m_folders);</span>
<a href="#l5.2113"></a><span id="l5.2113" class="difflineminus">-  }</span>
<a href="#l5.2114"></a><span id="l5.2114" class="difflineminus">-  return NS_NewSingletonEnumerator(targets, property);</span>
<a href="#l5.2115"></a><span id="l5.2115" class="difflineminus">-}</span>
<a href="#l5.2116"></a><span id="l5.2116" class="difflineminus">-</span>
<a href="#l5.2117"></a><span id="l5.2117" class="difflineminus">-void nsMsgFlatFolderDataSource::EnsureFolders()</span>
<a href="#l5.2118"></a><span id="l5.2118" class="difflineminus">-{</span>
<a href="#l5.2119"></a><span id="l5.2119" class="difflineminus">-  if (m_builtFolders)</span>
<a href="#l5.2120"></a><span id="l5.2120" class="difflineminus">-    return;</span>
<a href="#l5.2121"></a><span id="l5.2121" class="difflineminus">-</span>
<a href="#l5.2122"></a><span id="l5.2122" class="difflineminus">-  m_builtFolders = true; // in case something goes wrong</span>
<a href="#l5.2123"></a><span id="l5.2123" class="difflineminus">-</span>
<a href="#l5.2124"></a><span id="l5.2124" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.2125"></a><span id="l5.2125" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l5.2126"></a><span id="l5.2126" class="difflineminus">-  NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l5.2127"></a><span id="l5.2127" class="difflineminus">-</span>
<a href="#l5.2128"></a><span id="l5.2128" class="difflineminus">-  nsCOMPtr&lt;nsIArray&gt; allFolders;</span>
<a href="#l5.2129"></a><span id="l5.2129" class="difflineminus">-  rv = accountManager-&gt;GetAllFolders(getter_AddRefs(allFolders));</span>
<a href="#l5.2130"></a><span id="l5.2130" class="difflineminus">-  if (NS_FAILED(rv) || !allFolders)</span>
<a href="#l5.2131"></a><span id="l5.2131" class="difflineminus">-    return;</span>
<a href="#l5.2132"></a><span id="l5.2132" class="difflineminus">-</span>
<a href="#l5.2133"></a><span id="l5.2133" class="difflineminus">-  uint32_t count;</span>
<a href="#l5.2134"></a><span id="l5.2134" class="difflineminus">-  rv = allFolders-&gt;GetLength(&amp;count);</span>
<a href="#l5.2135"></a><span id="l5.2135" class="difflineminus">-  NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l5.2136"></a><span id="l5.2136" class="difflineminus">-</span>
<a href="#l5.2137"></a><span id="l5.2137" class="difflineminus">-  for (uint32_t i = 0; i &lt; count; i++)</span>
<a href="#l5.2138"></a><span id="l5.2138" class="difflineminus">-  {</span>
<a href="#l5.2139"></a><span id="l5.2139" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; curFolder = do_QueryElementAt(allFolders, i);</span>
<a href="#l5.2140"></a><span id="l5.2140" class="difflineminus">-    if (WantsThisFolder(curFolder))</span>
<a href="#l5.2141"></a><span id="l5.2141" class="difflineminus">-      m_folders.AppendObject(curFolder);</span>
<a href="#l5.2142"></a><span id="l5.2142" class="difflineminus">-  }</span>
<a href="#l5.2143"></a><span id="l5.2143" class="difflineminus">-}</span>
<a href="#l5.2144"></a><span id="l5.2144" class="difflineminus">-</span>
<a href="#l5.2145"></a><span id="l5.2145" class="difflineminus">-</span>
<a href="#l5.2146"></a><span id="l5.2146" class="difflineminus">-NS_IMETHODIMP nsMsgFlatFolderDataSource::GetURI(nsACString&amp; aUri)</span>
<a href="#l5.2147"></a><span id="l5.2147" class="difflineminus">-{</span>
<a href="#l5.2148"></a><span id="l5.2148" class="difflineminus">-  aUri.AssignLiteral(&quot;rdf:&quot;);</span>
<a href="#l5.2149"></a><span id="l5.2149" class="difflineminus">-  aUri.Append(m_dsName);</span>
<a href="#l5.2150"></a><span id="l5.2150" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.2151"></a><span id="l5.2151" class="difflineminus">-}</span>
<a href="#l5.2152"></a><span id="l5.2152" class="difflineminus">-</span>
<a href="#l5.2153"></a><span id="l5.2153" class="difflineminus">-NS_IMETHODIMP nsMsgFlatFolderDataSource::HasAssertion(nsIRDFResource* source,</span>
<a href="#l5.2154"></a><span id="l5.2154" class="difflineminus">-                            nsIRDFResource* property,</span>
<a href="#l5.2155"></a><span id="l5.2155" class="difflineminus">-                            nsIRDFNode* target,</span>
<a href="#l5.2156"></a><span id="l5.2156" class="difflineminus">-                            bool tv,</span>
<a href="#l5.2157"></a><span id="l5.2157" class="difflineminus">-                            bool* hasAssertion)</span>
<a href="#l5.2158"></a><span id="l5.2158" class="difflineminus">-{</span>
<a href="#l5.2159"></a><span id="l5.2159" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.2160"></a><span id="l5.2160" class="difflineminus">-</span>
<a href="#l5.2161"></a><span id="l5.2161" class="difflineminus">-  nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(source, &amp;rv));</span>
<a href="#l5.2162"></a><span id="l5.2162" class="difflineminus">-  // we need to check if the folder belongs in this datasource.</span>
<a href="#l5.2163"></a><span id="l5.2163" class="difflineminus">-  if (NS_SUCCEEDED(rv) &amp;&amp; property != kNC_Open &amp;&amp; property != kNC_Child)</span>
<a href="#l5.2164"></a><span id="l5.2164" class="difflineminus">-  {</span>
<a href="#l5.2165"></a><span id="l5.2165" class="difflineminus">-    if (WantsThisFolder(folder) &amp;&amp; (kNC_Child != property))</span>
<a href="#l5.2166"></a><span id="l5.2166" class="difflineminus">-      return DoFolderHasAssertion(folder, property, target, tv, hasAssertion);</span>
<a href="#l5.2167"></a><span id="l5.2167" class="difflineminus">-  }</span>
<a href="#l5.2168"></a><span id="l5.2168" class="difflineminus">-  else if (property == kNC_Child &amp;&amp; ResourceIsOurRoot(source)) // check if source is us</span>
<a href="#l5.2169"></a><span id="l5.2169" class="difflineminus">-  {</span>
<a href="#l5.2170"></a><span id="l5.2170" class="difflineminus">-    folder = do_QueryInterface(target);</span>
<a href="#l5.2171"></a><span id="l5.2171" class="difflineminus">-    if (folder)</span>
<a href="#l5.2172"></a><span id="l5.2172" class="difflineminus">-    {</span>
<a href="#l5.2173"></a><span id="l5.2173" class="difflineminus">-      nsCOMPtr&lt;nsIMsgFolder&gt; parentMsgFolder;</span>
<a href="#l5.2174"></a><span id="l5.2174" class="difflineminus">-      folder-&gt;GetParent(getter_AddRefs(parentMsgFolder));</span>
<a href="#l5.2175"></a><span id="l5.2175" class="difflineminus">-      // a folder without a parent must be getting deleted as part of</span>
<a href="#l5.2176"></a><span id="l5.2176" class="difflineminus">-      // the rename operation and is thus a folder we are</span>
<a href="#l5.2177"></a><span id="l5.2177" class="difflineminus">-      // no longer interested in</span>
<a href="#l5.2178"></a><span id="l5.2178" class="difflineminus">-      if (parentMsgFolder &amp;&amp; WantsThisFolder(folder))</span>
<a href="#l5.2179"></a><span id="l5.2179" class="difflineminus">-      {</span>
<a href="#l5.2180"></a><span id="l5.2180" class="difflineminus">-        *hasAssertion = true;</span>
<a href="#l5.2181"></a><span id="l5.2181" class="difflineminus">-        return NS_OK;</span>
<a href="#l5.2182"></a><span id="l5.2182" class="difflineminus">-      }</span>
<a href="#l5.2183"></a><span id="l5.2183" class="difflineminus">-    }</span>
<a href="#l5.2184"></a><span id="l5.2184" class="difflineminus">-  }</span>
<a href="#l5.2185"></a><span id="l5.2185" class="difflineminus">-  *hasAssertion = false;</span>
<a href="#l5.2186"></a><span id="l5.2186" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.2187"></a><span id="l5.2187" class="difflineminus">-}</span>
<a href="#l5.2188"></a><span id="l5.2188" class="difflineminus">-</span>
<a href="#l5.2189"></a><span id="l5.2189" class="difflineminus">-nsresult nsMsgFlatFolderDataSource::OnItemAddedOrRemoved(nsIMsgFolder *parentItem, nsISupports *item, bool added)</span>
<a href="#l5.2190"></a><span id="l5.2190" class="difflineminus">-{</span>
<a href="#l5.2191"></a><span id="l5.2191" class="difflineminus">-  // When a folder is added or removed, parentItem is the parent folder and item is the folder being</span>
<a href="#l5.2192"></a><span id="l5.2192" class="difflineminus">-  // added or removed. In a flat data source, there is no arc in the graph between the parent folder</span>
<a href="#l5.2193"></a><span id="l5.2193" class="difflineminus">-  // and the folder being added or removed. Our flat data source root (i.e. mailnewsunreadfolders:/) has</span>
<a href="#l5.2194"></a><span id="l5.2194" class="difflineminus">-  // an arc with the child property to every folder in the data source.  We must change parentItem</span>
<a href="#l5.2195"></a><span id="l5.2195" class="difflineminus">-  // to be our data source root before calling nsMsgFolderDataSource::OnItemAddedOrRemoved. This ensures</span>
<a href="#l5.2196"></a><span id="l5.2196" class="difflineminus">-  // that datasource listeners such as the template builder properly handle add and remove</span>
<a href="#l5.2197"></a><span id="l5.2197" class="difflineminus">-  // notifications on the flat datasource.</span>
<a href="#l5.2198"></a><span id="l5.2198" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt; itemNode(do_QueryInterface(item));</span>
<a href="#l5.2199"></a><span id="l5.2199" class="difflineminus">-  if (itemNode)</span>
<a href="#l5.2200"></a><span id="l5.2200" class="difflineminus">-    NotifyObservers(m_rootResource, kNC_Child, itemNode, nullptr, added, false);</span>
<a href="#l5.2201"></a><span id="l5.2201" class="difflineminus">-  return NS_OK;</span>
<a href="#l5.2202"></a><span id="l5.2202" class="difflineminus">-}</span>
<a href="#l5.2203"></a><span id="l5.2203" class="difflineminus">-</span>
<a href="#l5.2204"></a><span id="l5.2204" class="difflineminus">-bool nsMsgFlatFolderDataSource::ResourceIsOurRoot(nsIRDFResource *resource)</span>
<a href="#l5.2205"></a><span id="l5.2205" class="difflineminus">-{</span>
<a href="#l5.2206"></a><span id="l5.2206" class="difflineminus">-  return m_rootResource.get() == resource;</span>
<a href="#l5.2207"></a><span id="l5.2207" class="difflineminus">-}</span>
<a href="#l5.2208"></a><span id="l5.2208" class="difflineminus">-</span>
<a href="#l5.2209"></a><span id="l5.2209" class="difflineminus">-bool nsMsgFlatFolderDataSource::WantsThisFolder(nsIMsgFolder *folder)</span>
<a href="#l5.2210"></a><span id="l5.2210" class="difflineminus">-{</span>
<a href="#l5.2211"></a><span id="l5.2211" class="difflineminus">-  EnsureFolders();</span>
<a href="#l5.2212"></a><span id="l5.2212" class="difflineminus">-  return m_folders.Contains(folder);</span>
<a href="#l5.2213"></a><span id="l5.2213" class="difflineminus">-}</span>
<a href="#l5.2214"></a><span id="l5.2214" class="difflineminus">-</span>
<a href="#l5.2215"></a><span id="l5.2215" class="difflineminus">-nsresult nsMsgFlatFolderDataSource::GetFolderDisplayName(nsIMsgFolder *folder, nsString&amp; folderName)</span>
<a href="#l5.2216"></a><span id="l5.2216" class="difflineminus">-{</span>
<a href="#l5.2217"></a><span id="l5.2217" class="difflineminus">-  folder-&gt;GetName(folderName);</span>
<a href="#l5.2218"></a><span id="l5.2218" class="difflineminus">-  uint32_t foldersCount = m_folders.Count();</span>
<a href="#l5.2219"></a><span id="l5.2219" class="difflineminus">-  nsString otherFolderName;</span>
<a href="#l5.2220"></a><span id="l5.2220" class="difflineminus">-  for (uint32_t index = 0; index &lt; foldersCount; index++)</span>
<a href="#l5.2221"></a><span id="l5.2221" class="difflineminus">-  {</span>
<a href="#l5.2222"></a><span id="l5.2222" class="difflineminus">-    if (folder == m_folders[index]) // ignore ourselves.</span>
<a href="#l5.2223"></a><span id="l5.2223" class="difflineminus">-      continue;</span>
<a href="#l5.2224"></a><span id="l5.2224" class="difflineminus">-    m_folders[index]-&gt;GetName(otherFolderName);</span>
<a href="#l5.2225"></a><span id="l5.2225" class="difflineminus">-    if (otherFolderName.Equals(folderName))</span>
<a href="#l5.2226"></a><span id="l5.2226" class="difflineminus">-    {</span>
<a href="#l5.2227"></a><span id="l5.2227" class="difflineminus">-      nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l5.2228"></a><span id="l5.2228" class="difflineminus">-      folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l5.2229"></a><span id="l5.2229" class="difflineminus">-      if (server)</span>
<a href="#l5.2230"></a><span id="l5.2230" class="difflineminus">-      {</span>
<a href="#l5.2231"></a><span id="l5.2231" class="difflineminus">-        nsString serverName;</span>
<a href="#l5.2232"></a><span id="l5.2232" class="difflineminus">-        server-&gt;GetPrettyName(serverName);</span>
<a href="#l5.2233"></a><span id="l5.2233" class="difflineminus">-        folderName.AppendLiteral(&quot; - &quot;);</span>
<a href="#l5.2234"></a><span id="l5.2234" class="difflineminus">-        folderName.Append(serverName);</span>
<a href="#l5.2235"></a><span id="l5.2235" class="difflineminus">-        return NS_OK;</span>
<a href="#l5.2236"></a><span id="l5.2236" class="difflineminus">-      }</span>
<a href="#l5.2237"></a><span id="l5.2237" class="difflineminus">-    }</span>
<a href="#l5.2238"></a><span id="l5.2238" class="difflineminus">-  }</span>
<a href="#l5.2239"></a><span id="l5.2239" class="difflineminus">-  // check if folder name is unique - if not, append account name</span>
<a href="#l5.2240"></a><span id="l5.2240" class="difflineminus">-  return folder-&gt;GetAbbreviatedName(folderName);</span>
<a href="#l5.2241"></a><span id="l5.2241" class="difflineminus">-}</span>
<a href="#l5.2242"></a><span id="l5.2242" class="difflineminus">-</span>
<a href="#l5.2243"></a><span id="l5.2243" class="difflineminus">-</span>
<a href="#l5.2244"></a><span id="l5.2244" class="difflineminus">-bool nsMsgUnreadFoldersDataSource::WantsThisFolder(nsIMsgFolder *folder)</span>
<a href="#l5.2245"></a><span id="l5.2245" class="difflineminus">-{</span>
<a href="#l5.2246"></a><span id="l5.2246" class="difflineminus">-  int32_t numUnread;</span>
<a href="#l5.2247"></a><span id="l5.2247" class="difflineminus">-  folder-&gt;GetNumUnread(false, &amp;numUnread);</span>
<a href="#l5.2248"></a><span id="l5.2248" class="difflineminus">-  return numUnread &gt; 0;</span>
<a href="#l5.2249"></a><span id="l5.2249" class="difflineminus">-}</span>
<a href="#l5.2250"></a><span id="l5.2250" class="difflineminus">-</span>
<a href="#l5.2251"></a><span id="l5.2251" class="difflineminus">-nsresult nsMsgUnreadFoldersDataSource::NotifyPropertyChanged(nsIRDFResource *resource,</span>
<a href="#l5.2252"></a><span id="l5.2252" class="difflineminus">-                    nsIRDFResource *property, nsIRDFNode *newNode,</span>
<a href="#l5.2253"></a><span id="l5.2253" class="difflineminus">-                    nsIRDFNode *oldNode)</span>
<a href="#l5.2254"></a><span id="l5.2254" class="difflineminus">-{</span>
<a href="#l5.2255"></a><span id="l5.2255" class="difflineminus">-  // check if it's the has unread property that's changed; if so, see if we need</span>
<a href="#l5.2256"></a><span id="l5.2256" class="difflineminus">-  // to add this folder to the view.</span>
<a href="#l5.2257"></a><span id="l5.2257" class="difflineminus">-  // Then, call base class.</span>
<a href="#l5.2258"></a><span id="l5.2258" class="difflineminus">-  if (kNC_HasUnreadMessages == property)</span>
<a href="#l5.2259"></a><span id="l5.2259" class="difflineminus">-  {</span>
<a href="#l5.2260"></a><span id="l5.2260" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(resource));</span>
<a href="#l5.2261"></a><span id="l5.2261" class="difflineminus">-    if (folder)</span>
<a href="#l5.2262"></a><span id="l5.2262" class="difflineminus">-    {</span>
<a href="#l5.2263"></a><span id="l5.2263" class="difflineminus">-      int32_t numUnread;</span>
<a href="#l5.2264"></a><span id="l5.2264" class="difflineminus">-      folder-&gt;GetNumUnread(false, &amp;numUnread);</span>
<a href="#l5.2265"></a><span id="l5.2265" class="difflineminus">-      if (numUnread &gt; 0)</span>
<a href="#l5.2266"></a><span id="l5.2266" class="difflineminus">-      {</span>
<a href="#l5.2267"></a><span id="l5.2267" class="difflineminus">-        if (!m_folders.Contains(folder))</span>
<a href="#l5.2268"></a><span id="l5.2268" class="difflineminus">-          m_folders.AppendObject(folder);</span>
<a href="#l5.2269"></a><span id="l5.2269" class="difflineminus">-        NotifyObservers(kNC_UnreadFolders, kNC_Child, resource, nullptr, true, false);</span>
<a href="#l5.2270"></a><span id="l5.2270" class="difflineminus">-      }</span>
<a href="#l5.2271"></a><span id="l5.2271" class="difflineminus">-    }</span>
<a href="#l5.2272"></a><span id="l5.2272" class="difflineminus">-  }</span>
<a href="#l5.2273"></a><span id="l5.2273" class="difflineminus">-  return nsMsgFolderDataSource::NotifyPropertyChanged(resource, property,</span>
<a href="#l5.2274"></a><span id="l5.2274" class="difflineminus">-                                                newNode, oldNode);</span>
<a href="#l5.2275"></a><span id="l5.2275" class="difflineminus">-}</span>
<a href="#l5.2276"></a><span id="l5.2276" class="difflineminus">-</span>
<a href="#l5.2277"></a><span id="l5.2277" class="difflineminus">-bool nsMsgFavoriteFoldersDataSource::WantsThisFolder(nsIMsgFolder *folder)</span>
<a href="#l5.2278"></a><span id="l5.2278" class="difflineminus">-{</span>
<a href="#l5.2279"></a><span id="l5.2279" class="difflineminus">-  uint32_t folderFlags;</span>
<a href="#l5.2280"></a><span id="l5.2280" class="difflineminus">-  folder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l5.2281"></a><span id="l5.2281" class="difflineminus">-  return folderFlags &amp; nsMsgFolderFlags::Favorite;</span>
<a href="#l5.2282"></a><span id="l5.2282" class="difflineminus">-}</span>
<a href="#l5.2283"></a><span id="l5.2283" class="difflineminus">-</span>
<a href="#l5.2284"></a><span id="l5.2284" class="difflineminus">-</span>
<a href="#l5.2285"></a><span id="l5.2285" class="difflineminus">-void nsMsgRecentFoldersDataSource::Cleanup()</span>
<a href="#l5.2286"></a><span id="l5.2286" class="difflineminus">-{</span>
<a href="#l5.2287"></a><span id="l5.2287" class="difflineminus">-  m_cutOffDate = 0;</span>
<a href="#l5.2288"></a><span id="l5.2288" class="difflineminus">-  nsMsgFlatFolderDataSource::Cleanup();</span>
<a href="#l5.2289"></a><span id="l5.2289" class="difflineminus">-}</span>
<a href="#l5.2290"></a><span id="l5.2290" class="difflineminus">-</span>
<a href="#l5.2291"></a><span id="l5.2291" class="difflineminus">-</span>
<a href="#l5.2292"></a><span id="l5.2292" class="difflineminus">-void nsMsgRecentFoldersDataSource::EnsureFolders()</span>
<a href="#l5.2293"></a><span id="l5.2293" class="difflineminus">-{</span>
<a href="#l5.2294"></a><span id="l5.2294" class="difflineminus">-  if (m_builtFolders)</span>
<a href="#l5.2295"></a><span id="l5.2295" class="difflineminus">-    return;</span>
<a href="#l5.2296"></a><span id="l5.2296" class="difflineminus">-</span>
<a href="#l5.2297"></a><span id="l5.2297" class="difflineminus">-  m_builtFolders = true; // in case something goes wrong</span>
<a href="#l5.2298"></a><span id="l5.2298" class="difflineminus">-</span>
<a href="#l5.2299"></a><span id="l5.2299" class="difflineminus">-  nsresult rv;</span>
<a href="#l5.2300"></a><span id="l5.2300" class="difflineminus">-  nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l5.2301"></a><span id="l5.2301" class="difflineminus">-  NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l5.2302"></a><span id="l5.2302" class="difflineminus">-</span>
<a href="#l5.2303"></a><span id="l5.2303" class="difflineminus">-  nsCOMPtr&lt;nsIArray&gt; allFolders;</span>
<a href="#l5.2304"></a><span id="l5.2304" class="difflineminus">-  rv = accountManager-&gt;GetAllFolders(getter_AddRefs(allFolders));</span>
<a href="#l5.2305"></a><span id="l5.2305" class="difflineminus">-  if (NS_FAILED(rv) || !allFolders)</span>
<a href="#l5.2306"></a><span id="l5.2306" class="difflineminus">-    return;</span>
<a href="#l5.2307"></a><span id="l5.2307" class="difflineminus">-</span>
<a href="#l5.2308"></a><span id="l5.2308" class="difflineminus">-  uint32_t count;</span>
<a href="#l5.2309"></a><span id="l5.2309" class="difflineminus">-  rv = allFolders-&gt;GetLength(&amp;count);</span>
<a href="#l5.2310"></a><span id="l5.2310" class="difflineminus">-  NS_ENSURE_SUCCESS_VOID(rv);</span>
<a href="#l5.2311"></a><span id="l5.2311" class="difflineminus">-</span>
<a href="#l5.2312"></a><span id="l5.2312" class="difflineminus">-  for (uint32_t i = 0; i &lt; count; i++)</span>
<a href="#l5.2313"></a><span id="l5.2313" class="difflineminus">-  {</span>
<a href="#l5.2314"></a><span id="l5.2314" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; curFolder = do_QueryElementAt(allFolders, i);</span>
<a href="#l5.2315"></a><span id="l5.2315" class="difflineminus">-    nsCString dateStr;</span>
<a href="#l5.2316"></a><span id="l5.2316" class="difflineminus">-    curFolder-&gt;GetStringProperty(MRU_TIME_PROPERTY, dateStr);</span>
<a href="#l5.2317"></a><span id="l5.2317" class="difflineminus">-    uint32_t curFolderDate = (uint32_t) dateStr.ToInteger(&amp;rv);</span>
<a href="#l5.2318"></a><span id="l5.2318" class="difflineminus">-    if (NS_FAILED(rv))</span>
<a href="#l5.2319"></a><span id="l5.2319" class="difflineminus">-      curFolderDate = 0;</span>
<a href="#l5.2320"></a><span id="l5.2320" class="difflineminus">-</span>
<a href="#l5.2321"></a><span id="l5.2321" class="difflineminus">-    if (curFolderDate &gt; m_cutOffDate)</span>
<a href="#l5.2322"></a><span id="l5.2322" class="difflineminus">-    {</span>
<a href="#l5.2323"></a><span id="l5.2323" class="difflineminus">-      // if m_folders is &quot;full&quot;, replace oldest folder with this folder,</span>
<a href="#l5.2324"></a><span id="l5.2324" class="difflineminus">-      // and adjust m_cutOffDate so that it's the mrutime</span>
<a href="#l5.2325"></a><span id="l5.2325" class="difflineminus">-      // of the &quot;new&quot; oldest folder.</span>
<a href="#l5.2326"></a><span id="l5.2326" class="difflineminus">-      uint32_t curFaveFoldersCount = m_folders.Count();</span>
<a href="#l5.2327"></a><span id="l5.2327" class="difflineminus">-      if (curFaveFoldersCount &gt; m_maxNumFolders)</span>
<a href="#l5.2328"></a><span id="l5.2328" class="difflineminus">-      {</span>
<a href="#l5.2329"></a><span id="l5.2329" class="difflineminus">-        uint32_t indexOfOldestFolder = 0;</span>
<a href="#l5.2330"></a><span id="l5.2330" class="difflineminus">-        uint32_t oldestFaveDate = 0;</span>
<a href="#l5.2331"></a><span id="l5.2331" class="difflineminus">-        uint32_t newOldestFaveDate = 0;</span>
<a href="#l5.2332"></a><span id="l5.2332" class="difflineminus">-        for (uint32_t index = 0; index &lt; curFaveFoldersCount; )</span>
<a href="#l5.2333"></a><span id="l5.2333" class="difflineminus">-        {</span>
<a href="#l5.2334"></a><span id="l5.2334" class="difflineminus">-          nsCString curFaveFolderDateStr;</span>
<a href="#l5.2335"></a><span id="l5.2335" class="difflineminus">-          m_folders[index]-&gt;GetStringProperty(MRU_TIME_PROPERTY, curFaveFolderDateStr);</span>
<a href="#l5.2336"></a><span id="l5.2336" class="difflineminus">-          uint32_t curFaveFolderDate = (uint32_t) curFaveFolderDateStr.ToInteger(&amp;rv);</span>
<a href="#l5.2337"></a><span id="l5.2337" class="difflineminus">-          if (!oldestFaveDate || curFaveFolderDate &lt; oldestFaveDate)</span>
<a href="#l5.2338"></a><span id="l5.2338" class="difflineminus">-          {</span>
<a href="#l5.2339"></a><span id="l5.2339" class="difflineminus">-            indexOfOldestFolder = index;</span>
<a href="#l5.2340"></a><span id="l5.2340" class="difflineminus">-            newOldestFaveDate = oldestFaveDate;</span>
<a href="#l5.2341"></a><span id="l5.2341" class="difflineminus">-            oldestFaveDate = curFaveFolderDate;</span>
<a href="#l5.2342"></a><span id="l5.2342" class="difflineminus">-          }</span>
<a href="#l5.2343"></a><span id="l5.2343" class="difflineminus">-          if (!newOldestFaveDate || (index != indexOfOldestFolder</span>
<a href="#l5.2344"></a><span id="l5.2344" class="difflineminus">-              &amp;&amp; curFaveFolderDate &lt; newOldestFaveDate)) {</span>
<a href="#l5.2345"></a><span id="l5.2345" class="difflineminus">-            newOldestFaveDate = curFaveFolderDate;</span>
<a href="#l5.2346"></a><span id="l5.2346" class="difflineminus">-          }</span>
<a href="#l5.2347"></a><span id="l5.2347" class="difflineminus">-          index++;</span>
<a href="#l5.2348"></a><span id="l5.2348" class="difflineminus">-        }</span>
<a href="#l5.2349"></a><span id="l5.2349" class="difflineminus">-        if (curFolderDate &gt; oldestFaveDate &amp;&amp; !m_folders.Contains(curFolder))</span>
<a href="#l5.2350"></a><span id="l5.2350" class="difflineminus">-          m_folders.ReplaceObjectAt(curFolder, indexOfOldestFolder);</span>
<a href="#l5.2351"></a><span id="l5.2351" class="difflineminus">-</span>
<a href="#l5.2352"></a><span id="l5.2352" class="difflineminus">-        NS_ASSERTION(newOldestFaveDate &gt;= m_cutOffDate, &quot;cutoff date should be getting bigger&quot;);</span>
<a href="#l5.2353"></a><span id="l5.2353" class="difflineminus">-        m_cutOffDate = newOldestFaveDate;</span>
<a href="#l5.2354"></a><span id="l5.2354" class="difflineminus">-      }</span>
<a href="#l5.2355"></a><span id="l5.2355" class="difflineminus">-      else if (!m_folders.Contains(curFolder))</span>
<a href="#l5.2356"></a><span id="l5.2356" class="difflineminus">-        m_folders.AppendObject(curFolder);</span>
<a href="#l5.2357"></a><span id="l5.2357" class="difflineminus">-    }</span>
<a href="#l5.2358"></a><span id="l5.2358" class="difflineminus">-#ifdef DEBUG_David_Bienvenu</span>
<a href="#l5.2359"></a><span id="l5.2359" class="difflineminus">-    else</span>
<a href="#l5.2360"></a><span id="l5.2360" class="difflineminus">-    {</span>
<a href="#l5.2361"></a><span id="l5.2361" class="difflineminus">-      for (uint32_t index = 0; index &lt; m_folders.Count(); index++)</span>
<a href="#l5.2362"></a><span id="l5.2362" class="difflineminus">-      {</span>
<a href="#l5.2363"></a><span id="l5.2363" class="difflineminus">-        nsCString curFaveFolderDateStr;</span>
<a href="#l5.2364"></a><span id="l5.2364" class="difflineminus">-        m_folders[index]-&gt;GetStringProperty(MRU_TIME_PROPERTY, curFaveFolderDateStr);</span>
<a href="#l5.2365"></a><span id="l5.2365" class="difflineminus">-        uint32_t curFaveFolderDate = (uint32_t) curFaveFolderDateStr.ToInteger(&amp;rv);</span>
<a href="#l5.2366"></a><span id="l5.2366" class="difflineminus">-        NS_ASSERTION(curFaveFolderDate &gt; curFolderDate, &quot;folder newer then faves but not added&quot;);</span>
<a href="#l5.2367"></a><span id="l5.2367" class="difflineminus">-      }</span>
<a href="#l5.2368"></a><span id="l5.2368" class="difflineminus">-    }</span>
<a href="#l5.2369"></a><span id="l5.2369" class="difflineminus">-#endif</span>
<a href="#l5.2370"></a><span id="l5.2370" class="difflineminus">-  }</span>
<a href="#l5.2371"></a><span id="l5.2371" class="difflineminus">-}</span>
<a href="#l5.2372"></a><span id="l5.2372" class="difflineminus">-</span>
<a href="#l5.2373"></a><span id="l5.2373" class="difflineminus">-NS_IMETHODIMP nsMsgRecentFoldersDataSource::OnItemAdded(nsIMsgFolder *parentItem, nsISupports *item)</span>
<a href="#l5.2374"></a><span id="l5.2374" class="difflineminus">-{</span>
<a href="#l5.2375"></a><span id="l5.2375" class="difflineminus">-  // if we've already built the recent folder array, we should add this item to the array</span>
<a href="#l5.2376"></a><span id="l5.2376" class="difflineminus">-  // since just added items are by definition new.</span>
<a href="#l5.2377"></a><span id="l5.2377" class="difflineminus">-  // I think this means newly discovered imap folders (ones w/o msf files) will</span>
<a href="#l5.2378"></a><span id="l5.2378" class="difflineminus">-  // get added, but maybe that's OK.</span>
<a href="#l5.2379"></a><span id="l5.2379" class="difflineminus">-  if (m_builtFolders)</span>
<a href="#l5.2380"></a><span id="l5.2380" class="difflineminus">-  {</span>
<a href="#l5.2381"></a><span id="l5.2381" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(item));</span>
<a href="#l5.2382"></a><span id="l5.2382" class="difflineminus">-    if (folder &amp;&amp; !m_folders.Contains(folder))</span>
<a href="#l5.2383"></a><span id="l5.2383" class="difflineminus">-    {</span>
<a href="#l5.2384"></a><span id="l5.2384" class="difflineminus">-      m_folders.AppendObject(folder);</span>
<a href="#l5.2385"></a><span id="l5.2385" class="difflineminus">-      nsCOMPtr&lt;nsIRDFResource&gt; resource = do_QueryInterface(item);</span>
<a href="#l5.2386"></a><span id="l5.2386" class="difflineminus">-      NotifyObservers(kNC_RecentFolders, kNC_Child, resource, nullptr, true, false);</span>
<a href="#l5.2387"></a><span id="l5.2387" class="difflineminus">-    }</span>
<a href="#l5.2388"></a><span id="l5.2388" class="difflineminus">-  }</span>
<a href="#l5.2389"></a><span id="l5.2389" class="difflineminus">-  return nsMsgFlatFolderDataSource::OnItemAdded(parentItem, item);</span>
<a href="#l5.2390"></a><span id="l5.2390" class="difflineminus">-}</span>
<a href="#l5.2391"></a><span id="l5.2391" class="difflineminus">-</span>
<a href="#l5.2392"></a><span id="l5.2392" class="difflineminus">-nsresult nsMsgRecentFoldersDataSource::NotifyPropertyChanged(nsIRDFResource *resource,</span>
<a href="#l5.2393"></a><span id="l5.2393" class="difflineminus">-                    nsIRDFResource *property, nsIRDFNode *newNode,</span>
<a href="#l5.2394"></a><span id="l5.2394" class="difflineminus">-                    nsIRDFNode *oldNode)</span>
<a href="#l5.2395"></a><span id="l5.2395" class="difflineminus">-{</span>
<a href="#l5.2396"></a><span id="l5.2396" class="difflineminus">-  // check if it's the has new property that's changed; if so, see if we need</span>
<a href="#l5.2397"></a><span id="l5.2397" class="difflineminus">-  // to add this folder to the view.</span>
<a href="#l5.2398"></a><span id="l5.2398" class="difflineminus">-  // Then, call base class.</span>
<a href="#l5.2399"></a><span id="l5.2399" class="difflineminus">-  if (kNC_NewMessages == property)</span>
<a href="#l5.2400"></a><span id="l5.2400" class="difflineminus">-  {</span>
<a href="#l5.2401"></a><span id="l5.2401" class="difflineminus">-    nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(resource));</span>
<a href="#l5.2402"></a><span id="l5.2402" class="difflineminus">-    if (folder)</span>
<a href="#l5.2403"></a><span id="l5.2403" class="difflineminus">-    {</span>
<a href="#l5.2404"></a><span id="l5.2404" class="difflineminus">-      bool hasNewMessages;</span>
<a href="#l5.2405"></a><span id="l5.2405" class="difflineminus">-      folder-&gt;GetHasNewMessages(&amp;hasNewMessages);</span>
<a href="#l5.2406"></a><span id="l5.2406" class="difflineminus">-      if (hasNewMessages)</span>
<a href="#l5.2407"></a><span id="l5.2407" class="difflineminus">-      {</span>
<a href="#l5.2408"></a><span id="l5.2408" class="difflineminus">-        if (!m_folders.Contains(folder))</span>
<a href="#l5.2409"></a><span id="l5.2409" class="difflineminus">-        {</span>
<a href="#l5.2410"></a><span id="l5.2410" class="difflineminus">-          m_folders.AppendObject(folder);</span>
<a href="#l5.2411"></a><span id="l5.2411" class="difflineminus">-          NotifyObservers(kNC_RecentFolders, kNC_Child, resource, nullptr, true, false);</span>
<a href="#l5.2412"></a><span id="l5.2412" class="difflineminus">-        }</span>
<a href="#l5.2413"></a><span id="l5.2413" class="difflineminus">-      }</span>
<a href="#l5.2414"></a><span id="l5.2414" class="difflineminus">-    }</span>
<a href="#l5.2415"></a><span id="l5.2415" class="difflineminus">-  }</span>
<a href="#l5.2416"></a><span id="l5.2416" class="difflineminus">-  return nsMsgFolderDataSource::NotifyPropertyChanged(resource, property,</span>
<a href="#l5.2417"></a><span id="l5.2417" class="difflineminus">-                                                newNode, oldNode);</span>
<a href="#l5.2418"></a><span id="l5.2418" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">deleted file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderDataSource.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ /dev/null</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -1,348 +0,0 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-#include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-#include &quot;nsIRDFDataSource.h&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-#include &quot;nsIRDFService.h&quot;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-#include &quot;nsIFolderListener.h&quot;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-#include &quot;nsMsgRDFDataSource.h&quot;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-#include &quot;nsITransactionManager.h&quot;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-#include &quot;nsCOMArray.h&quot;</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-#include &quot;nsIMutableArray.h&quot;</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-#include &quot;nsString.h&quot;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-#if 0</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-// Disable deprecation warnings generated by nsISupportsArray and associated</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-// classes.</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-#if defined(__GNUC__)</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-#elif defined(_MSC_VER)</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-#pragma warning (disable : 4996)</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-#endif</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-#include &quot;nsISupportsArray.h&quot;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-#endif</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-/**</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">- * The mail data source.</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">- */</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-class nsMsgFolderDataSource : public nsMsgRDFDataSource,</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-                              public nsIFolderListener</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-{</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-public:</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-  NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-  NS_DECL_NSIFOLDERLISTENER</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-  nsMsgFolderDataSource(void);</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-  virtual nsresult Init() override;</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-  virtual void Cleanup() override;</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-  // nsIRDFDataSource methods</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-  NS_IMETHOD GetURI(nsACString&amp; uri) override;</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-  NS_IMETHOD GetSource(nsIRDFResource* property,</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-                       nsIRDFNode* target,</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-                       bool tv,</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-                       nsIRDFResource** source /* out */) override;</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-  NS_IMETHOD GetTarget(nsIRDFResource* source,</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-                       nsIRDFResource* property,</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-                       bool tv,</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-                       nsIRDFNode** target) override;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-  NS_IMETHOD GetSources(nsIRDFResource* property,</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-                        nsIRDFNode* target,</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-                        bool tv,</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-                        nsISimpleEnumerator** sources) override;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-  NS_IMETHOD GetTargets(nsIRDFResource* source,</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-                        nsIRDFResource* property,</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-                        bool tv,</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-                        nsISimpleEnumerator** targets) override;</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-  NS_IMETHOD Assert(nsIRDFResource* source,</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-                    nsIRDFResource* property,</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-                    nsIRDFNode* target,</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-                    bool tv) override;</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-  NS_IMETHOD Unassert(nsIRDFResource* source,</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-                      nsIRDFResource* property,</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-                      nsIRDFNode* target) override;</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-  NS_IMETHOD HasAssertion(nsIRDFResource* source,</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-                          nsIRDFResource* property,</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-                          nsIRDFNode* target,</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-                          bool tv,</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-                          bool* hasAssertion) override;</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-  NS_IMETHOD HasArcOut(nsIRDFResource *aSource, nsIRDFResource *aArc,</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-                       bool *result) override;</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-  NS_IMETHOD ArcLabelsIn(nsIRDFNode* node,</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineminus">-                         nsISimpleEnumerator** labels) override;</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-  NS_IMETHOD ArcLabelsOut(nsIRDFResource* source,</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-                          nsISimpleEnumerator** labels) override;</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-  NS_IMETHOD GetAllResources(nsISimpleEnumerator** aResult) override;</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-  NS_IMETHOD GetAllCmds(nsIRDFResource* source,</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineminus">-                            nsISimpleEnumerator/*&lt;nsIRDFResource&gt;*/** commands</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineminus">-                        ) override;</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-  NS_IMETHOD IsCommandEnabled(nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-                              nsIRDFResource*   aCommand,</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-                              nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aArguments,</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-                              bool* aResult) override;</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">-</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineminus">-  NS_IMETHOD DoCommand(nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aSources,</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineminus">-                       nsIRDFResource*   aCommand,</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineminus">-                       nsISupports/*nsISupportsArray&lt;nsIRDFResource&gt;*/* aArguments) override;</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineminus">-protected:</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineminus">-  virtual ~nsMsgFolderDataSource();</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineminus">-</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineminus">-  nsresult GetSenderName(nsAutoString&amp; sender, nsAutoString *senderUserName);</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineminus">-</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineminus">-  nsresult createFolderNode(nsIMsgFolder *folder, nsIRDFResource* property,</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineminus">-                            nsIRDFNode **target);</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineminus">-  nsresult createFolderNameNode(nsIMsgFolder *folder, nsIRDFNode **target, bool sort);</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineminus">-  nsresult createFolderOpenNode(nsIMsgFolder *folder,nsIRDFNode **target);</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-  nsresult createFolderTreeNameNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineminus">-  nsresult createFolderTreeSimpleNameNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineminus">-  nsresult createFolderSpecialNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineminus">-  nsresult createFolderServerTypeNode(nsIMsgFolder *folder,</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineminus">-  nsresult createServerIsDeferredNode(nsIMsgFolder* folder,</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineminus">-  nsresult createFolderCanCreateFoldersOnServerNode(nsIMsgFolder *folder,</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineminus">-  nsresult createFolderCanFileMessagesOnServerNode(nsIMsgFolder *folder,</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineminus">-  nsresult createFolderIsServerNode(nsIMsgFolder *folder,</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineminus">-  nsresult createFolderIsSecureNode(nsIMsgFolder *folder,</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineminus">-  nsresult createFolderCanSubscribeNode(nsIMsgFolder *folder,</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineminus">-  nsresult createFolderSupportsOfflineNode(nsIMsgFolder *folder,</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineminus">-  nsresult createFolderCanFileMessagesNode(nsIMsgFolder *folder,</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineminus">-  nsresult createFolderCanCreateSubfoldersNode(nsIMsgFolder *folder,</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineminus">-  nsresult createFolderCanRenameNode(nsIMsgFolder *folder,</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineminus">-  nsresult createFolderCanCompactNode(nsIMsgFolder *folder,</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineminus">-                                     nsIRDFNode **target);</span>
<a href="#l6.144"></a><span id="l6.144" class="difflineminus">-  nsresult createTotalMessagesNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.145"></a><span id="l6.145" class="difflineminus">-  nsresult createUnreadMessagesNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.146"></a><span id="l6.146" class="difflineminus">-  nsresult createFolderSizeNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.147"></a><span id="l6.147" class="difflineminus">-  nsresult createCharsetNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.148"></a><span id="l6.148" class="difflineminus">-  nsresult createBiffStateNodeFromFolder(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.149"></a><span id="l6.149" class="difflineminus">-  nsresult createBiffStateNodeFromFlag(uint32_t flag, nsIRDFNode **target);</span>
<a href="#l6.150"></a><span id="l6.150" class="difflineminus">-  nsresult createHasUnreadMessagesNode(nsIMsgFolder *folder, bool aIncludeSubfolders, nsIRDFNode **target);</span>
<a href="#l6.151"></a><span id="l6.151" class="difflineminus">-  nsresult createNewMessagesNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.152"></a><span id="l6.152" class="difflineminus">-  nsresult createFolderNoSelectNode(nsIMsgFolder *folder,</span>
<a href="#l6.153"></a><span id="l6.153" class="difflineminus">-                                    nsIRDFNode **target);</span>
<a href="#l6.154"></a><span id="l6.154" class="difflineminus">-  nsresult createFolderVirtualNode(nsIMsgFolder *folder,</span>
<a href="#l6.155"></a><span id="l6.155" class="difflineminus">-                                    nsIRDFNode **target);</span>
<a href="#l6.156"></a><span id="l6.156" class="difflineminus">-  nsresult createInVFEditSearchScopeNode(nsIMsgFolder* folder,</span>
<a href="#l6.157"></a><span id="l6.157" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.158"></a><span id="l6.158" class="difflineminus">-  nsresult createFolderImapSharedNode(nsIMsgFolder *folder,</span>
<a href="#l6.159"></a><span id="l6.159" class="difflineminus">-                                    nsIRDFNode **target);</span>
<a href="#l6.160"></a><span id="l6.160" class="difflineminus">-  nsresult createFolderSynchronizeNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.161"></a><span id="l6.161" class="difflineminus">-  nsresult createFolderSyncDisabledNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.162"></a><span id="l6.162" class="difflineminus">-  nsresult createCanSearchMessages(nsIMsgFolder *folder,</span>
<a href="#l6.163"></a><span id="l6.163" class="difflineminus">-                                      nsIRDFNode **target);</span>
<a href="#l6.164"></a><span id="l6.164" class="difflineminus">-  nsresult createFolderChildNode(nsIMsgFolder *folder, nsIRDFNode **target);</span>
<a href="#l6.165"></a><span id="l6.165" class="difflineminus">-</span>
<a href="#l6.166"></a><span id="l6.166" class="difflineminus">-  nsresult getFolderArcLabelsOut(nsCOMArray&lt;nsIRDFResource&gt; &amp;aArcs);</span>
<a href="#l6.167"></a><span id="l6.167" class="difflineminus">-</span>
<a href="#l6.168"></a><span id="l6.168" class="difflineminus">-#if 0</span>
<a href="#l6.169"></a><span id="l6.169" class="difflineminus">-  nsresult DoDeleteFromFolder(nsIMsgFolder *folder,</span>
<a href="#l6.170"></a><span id="l6.170" class="difflineminus">-                nsISupportsArray *arguments, nsIMsgWindow *msgWindow, bool reallyDelete);</span>
<a href="#l6.171"></a><span id="l6.171" class="difflineminus">-</span>
<a href="#l6.172"></a><span id="l6.172" class="difflineminus">-  nsresult DoCopyToFolder(nsIMsgFolder *dstFolder, nsISupportsArray *arguments,</span>
<a href="#l6.173"></a><span id="l6.173" class="difflineminus">-              nsIMsgWindow *msgWindow, bool isMove);</span>
<a href="#l6.174"></a><span id="l6.174" class="difflineminus">-</span>
<a href="#l6.175"></a><span id="l6.175" class="difflineminus">-  nsresult DoFolderCopyToFolder(nsIMsgFolder *dstFolder, nsISupportsArray *arguments,</span>
<a href="#l6.176"></a><span id="l6.176" class="difflineminus">-              nsIMsgWindow *msgWindow, bool isMoveFolder);</span>
<a href="#l6.177"></a><span id="l6.177" class="difflineminus">-</span>
<a href="#l6.178"></a><span id="l6.178" class="difflineminus">-  nsresult DoNewFolder(nsIMsgFolder *folder, nsISupportsArray *arguments,</span>
<a href="#l6.179"></a><span id="l6.179" class="difflineminus">-                        nsIMsgWindow *window);</span>
<a href="#l6.180"></a><span id="l6.180" class="difflineminus">-#endif</span>
<a href="#l6.181"></a><span id="l6.181" class="difflineminus">-</span>
<a href="#l6.182"></a><span id="l6.182" class="difflineminus">-  nsresult DoFolderAssert(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target);</span>
<a href="#l6.183"></a><span id="l6.183" class="difflineminus">-  nsresult DoFolderUnassert(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target);</span>
<a href="#l6.184"></a><span id="l6.184" class="difflineminus">-</span>
<a href="#l6.185"></a><span id="l6.185" class="difflineminus">-  nsresult DoFolderHasAssertion(nsIMsgFolder *folder, nsIRDFResource *property, nsIRDFNode *target,</span>
<a href="#l6.186"></a><span id="l6.186" class="difflineminus">-                                bool tv, bool *hasAssertion);</span>
<a href="#l6.187"></a><span id="l6.187" class="difflineminus">-</span>
<a href="#l6.188"></a><span id="l6.188" class="difflineminus">-  nsresult GetBiffStateString(uint32_t biffState, nsAutoCString &amp; biffStateStr);</span>
<a href="#l6.189"></a><span id="l6.189" class="difflineminus">-</span>
<a href="#l6.190"></a><span id="l6.190" class="difflineminus">-  nsresult CreateUnreadMessagesNameString(int32_t unreadMessages, nsAutoString &amp;nameString);</span>
<a href="#l6.191"></a><span id="l6.191" class="difflineminus">-  nsresult CreateArcsOutEnumerator();</span>
<a href="#l6.192"></a><span id="l6.192" class="difflineminus">-</span>
<a href="#l6.193"></a><span id="l6.193" class="difflineminus">-  virtual nsresult OnItemAddedOrRemoved(nsIMsgFolder *parentItem, nsISupports *item, bool added);</span>
<a href="#l6.194"></a><span id="l6.194" class="difflineminus">-</span>
<a href="#l6.195"></a><span id="l6.195" class="difflineminus">-  nsresult OnUnreadMessagePropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue);</span>
<a href="#l6.196"></a><span id="l6.196" class="difflineminus">-  nsresult OnTotalMessagePropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue);</span>
<a href="#l6.197"></a><span id="l6.197" class="difflineminus">-  nsresult OnFolderSizePropertyChanged(nsIRDFResource *folderResource, int64_t oldValue, int64_t newValue);</span>
<a href="#l6.198"></a><span id="l6.198" class="difflineminus">-  nsresult OnFolderSortOrderPropertyChanged(nsIRDFResource *folderResource, int32_t oldValue, int32_t newValue);</span>
<a href="#l6.199"></a><span id="l6.199" class="difflineminus">-  nsresult NotifyFolderTreeNameChanged(nsIMsgFolder *folder, nsIRDFResource *folderResource, int32_t aUnreadMessages);</span>
<a href="#l6.200"></a><span id="l6.200" class="difflineminus">-  nsresult NotifyFolderTreeSimpleNameChanged(nsIMsgFolder *folder, nsIRDFResource *folderResource);</span>
<a href="#l6.201"></a><span id="l6.201" class="difflineminus">-  nsresult NotifyFolderNameChanged(nsIMsgFolder *folder, nsIRDFResource *folderResource);</span>
<a href="#l6.202"></a><span id="l6.202" class="difflineminus">-  nsresult NotifyAncestors(nsIMsgFolder *aFolder, nsIRDFResource *aPropertyResource, nsIRDFNode *aNode);</span>
<a href="#l6.203"></a><span id="l6.203" class="difflineminus">-  nsresult GetNumMessagesNode(int32_t numMessages, nsIRDFNode **node);</span>
<a href="#l6.204"></a><span id="l6.204" class="difflineminus">-  nsresult GetFolderSizeNode(int64_t folderSize, nsIRDFNode **node);</span>
<a href="#l6.205"></a><span id="l6.205" class="difflineminus">-  nsresult CreateLiterals(nsIRDFService *rdf);</span>
<a href="#l6.206"></a><span id="l6.206" class="difflineminus">-</span>
<a href="#l6.207"></a><span id="l6.207" class="difflineminus">-  virtual nsresult GetFolderDisplayName(nsIMsgFolder *folder, nsString&amp; folderName);</span>
<a href="#l6.208"></a><span id="l6.208" class="difflineminus">-</span>
<a href="#l6.209"></a><span id="l6.209" class="difflineminus">-  static nsIRDFResource* kNC_Child;</span>
<a href="#l6.210"></a><span id="l6.210" class="difflineminus">-  static nsIRDFResource* kNC_Folder;</span>
<a href="#l6.211"></a><span id="l6.211" class="difflineminus">-  static nsIRDFResource* kNC_Name;</span>
<a href="#l6.212"></a><span id="l6.212" class="difflineminus">-  static nsIRDFResource* kNC_Open;</span>
<a href="#l6.213"></a><span id="l6.213" class="difflineminus">-  static nsIRDFResource* kNC_FolderTreeName;</span>
<a href="#l6.214"></a><span id="l6.214" class="difflineminus">-  static nsIRDFResource* kNC_FolderTreeSimpleName;</span>
<a href="#l6.215"></a><span id="l6.215" class="difflineminus">-  static nsIRDFResource* kNC_NameSort;</span>
<a href="#l6.216"></a><span id="l6.216" class="difflineminus">-  static nsIRDFResource* kNC_FolderTreeNameSort;</span>
<a href="#l6.217"></a><span id="l6.217" class="difflineminus">-  static nsIRDFResource* kNC_Columns;</span>
<a href="#l6.218"></a><span id="l6.218" class="difflineminus">-  static nsIRDFResource* kNC_MSGFolderRoot;</span>
<a href="#l6.219"></a><span id="l6.219" class="difflineminus">-  static nsIRDFResource* kNC_SpecialFolder;</span>
<a href="#l6.220"></a><span id="l6.220" class="difflineminus">-  static nsIRDFResource* kNC_ServerType;</span>
<a href="#l6.221"></a><span id="l6.221" class="difflineminus">-  static nsIRDFResource* kNC_IsDeferred;</span>
<a href="#l6.222"></a><span id="l6.222" class="difflineminus">-  static nsIRDFResource* kNC_CanCreateFoldersOnServer;</span>
<a href="#l6.223"></a><span id="l6.223" class="difflineminus">-  static nsIRDFResource* kNC_CanFileMessagesOnServer;</span>
<a href="#l6.224"></a><span id="l6.224" class="difflineminus">-  static nsIRDFResource* kNC_IsServer;</span>
<a href="#l6.225"></a><span id="l6.225" class="difflineminus">-  static nsIRDFResource* kNC_IsSecure;</span>
<a href="#l6.226"></a><span id="l6.226" class="difflineminus">-  static nsIRDFResource* kNC_CanSubscribe;</span>
<a href="#l6.227"></a><span id="l6.227" class="difflineminus">-  static nsIRDFResource* kNC_SupportsOffline;</span>
<a href="#l6.228"></a><span id="l6.228" class="difflineminus">-  static nsIRDFResource* kNC_CanFileMessages;</span>
<a href="#l6.229"></a><span id="l6.229" class="difflineminus">-  static nsIRDFResource* kNC_CanCreateSubfolders;</span>
<a href="#l6.230"></a><span id="l6.230" class="difflineminus">-  static nsIRDFResource* kNC_CanRename;</span>
<a href="#l6.231"></a><span id="l6.231" class="difflineminus">-  static nsIRDFResource* kNC_CanCompact;</span>
<a href="#l6.232"></a><span id="l6.232" class="difflineminus">-  static nsIRDFResource* kNC_TotalMessages;</span>
<a href="#l6.233"></a><span id="l6.233" class="difflineminus">-  static nsIRDFResource* kNC_TotalUnreadMessages;</span>
<a href="#l6.234"></a><span id="l6.234" class="difflineminus">-  static nsIRDFResource* kNC_FolderSize;</span>
<a href="#l6.235"></a><span id="l6.235" class="difflineminus">-  static nsIRDFResource* kNC_Charset;</span>
<a href="#l6.236"></a><span id="l6.236" class="difflineminus">-  static nsIRDFResource* kNC_BiffState;</span>
<a href="#l6.237"></a><span id="l6.237" class="difflineminus">-  static nsIRDFResource* kNC_HasUnreadMessages;</span>
<a href="#l6.238"></a><span id="l6.238" class="difflineminus">-  static nsIRDFResource* kNC_NewMessages;</span>
<a href="#l6.239"></a><span id="l6.239" class="difflineminus">-  static nsIRDFResource* kNC_SubfoldersHaveUnreadMessages;</span>
<a href="#l6.240"></a><span id="l6.240" class="difflineminus">-  static nsIRDFResource* kNC_NoSelect;</span>
<a href="#l6.241"></a><span id="l6.241" class="difflineminus">-  static nsIRDFResource* kNC_ImapShared;</span>
<a href="#l6.242"></a><span id="l6.242" class="difflineminus">-  static nsIRDFResource* kNC_Synchronize;</span>
<a href="#l6.243"></a><span id="l6.243" class="difflineminus">-  static nsIRDFResource* kNC_SyncDisabled;</span>
<a href="#l6.244"></a><span id="l6.244" class="difflineminus">-  static nsIRDFResource* kNC_CanSearchMessages;</span>
<a href="#l6.245"></a><span id="l6.245" class="difflineminus">-  static nsIRDFResource* kNC_VirtualFolder;</span>
<a href="#l6.246"></a><span id="l6.246" class="difflineminus">-  static nsIRDFResource* kNC_InVFEditSearchScope;</span>
<a href="#l6.247"></a><span id="l6.247" class="difflineminus">-  static nsIRDFResource* kNC_UnreadFolders; // maybe should be in nsMsgFlatFolderDataSource?</span>
<a href="#l6.248"></a><span id="l6.248" class="difflineminus">-  static nsIRDFResource* kNC_FavoriteFolders; // maybe should be in nsMsgFlatFolderDataSource?</span>
<a href="#l6.249"></a><span id="l6.249" class="difflineminus">-  static nsIRDFResource* kNC_RecentFolders; // maybe should be in nsMsgFlatFolderDataSource?</span>
<a href="#l6.250"></a><span id="l6.250" class="difflineminus">-  // commands</span>
<a href="#l6.251"></a><span id="l6.251" class="difflineminus">-  static nsIRDFResource* kNC_Delete;</span>
<a href="#l6.252"></a><span id="l6.252" class="difflineminus">-  static nsIRDFResource* kNC_ReallyDelete;</span>
<a href="#l6.253"></a><span id="l6.253" class="difflineminus">-  static nsIRDFResource* kNC_NewFolder;</span>
<a href="#l6.254"></a><span id="l6.254" class="difflineminus">-  static nsIRDFResource* kNC_GetNewMessages;</span>
<a href="#l6.255"></a><span id="l6.255" class="difflineminus">-  static nsIRDFResource* kNC_Copy;</span>
<a href="#l6.256"></a><span id="l6.256" class="difflineminus">-  static nsIRDFResource* kNC_Move;</span>
<a href="#l6.257"></a><span id="l6.257" class="difflineminus">-  static nsIRDFResource* kNC_CopyFolder;</span>
<a href="#l6.258"></a><span id="l6.258" class="difflineminus">-  static nsIRDFResource* kNC_MoveFolder;</span>
<a href="#l6.259"></a><span id="l6.259" class="difflineminus">-  static nsIRDFResource* kNC_MarkAllMessagesRead;</span>
<a href="#l6.260"></a><span id="l6.260" class="difflineminus">-  static nsIRDFResource* kNC_Compact;</span>
<a href="#l6.261"></a><span id="l6.261" class="difflineminus">-  static nsIRDFResource* kNC_CompactAll;</span>
<a href="#l6.262"></a><span id="l6.262" class="difflineminus">-  static nsIRDFResource* kNC_Rename;</span>
<a href="#l6.263"></a><span id="l6.263" class="difflineminus">-  static nsIRDFResource* kNC_EmptyTrash;</span>
<a href="#l6.264"></a><span id="l6.264" class="difflineminus">-  static nsIRDFResource* kNC_DownloadFlagged;</span>
<a href="#l6.265"></a><span id="l6.265" class="difflineminus">-  //Cached literals</span>
<a href="#l6.266"></a><span id="l6.266" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt; kTrueLiteral;</span>
<a href="#l6.267"></a><span id="l6.267" class="difflineminus">-  nsCOMPtr&lt;nsIRDFNode&gt; kFalseLiteral;</span>
<a href="#l6.268"></a><span id="l6.268" class="difflineminus">-</span>
<a href="#l6.269"></a><span id="l6.269" class="difflineminus">-  static nsrefcnt gFolderResourceRefCnt;</span>
<a href="#l6.270"></a><span id="l6.270" class="difflineminus">-</span>
<a href="#l6.271"></a><span id="l6.271" class="difflineminus">-  nsCOMArray&lt;nsIRDFResource&gt; kFolderArcsOutArray;</span>
<a href="#l6.272"></a><span id="l6.272" class="difflineminus">-</span>
<a href="#l6.273"></a><span id="l6.273" class="difflineminus">-};</span>
<a href="#l6.274"></a><span id="l6.274" class="difflineminus">-</span>
<a href="#l6.275"></a><span id="l6.275" class="difflineminus">-</span>
<a href="#l6.276"></a><span id="l6.276" class="difflineminus">-class nsMsgFlatFolderDataSource : public nsMsgFolderDataSource</span>
<a href="#l6.277"></a><span id="l6.277" class="difflineminus">-{</span>
<a href="#l6.278"></a><span id="l6.278" class="difflineminus">-public:</span>
<a href="#l6.279"></a><span id="l6.279" class="difflineminus">-  // constructor could take a filter to filter out folders.</span>
<a href="#l6.280"></a><span id="l6.280" class="difflineminus">-  nsMsgFlatFolderDataSource();</span>
<a href="#l6.281"></a><span id="l6.281" class="difflineminus">-  virtual ~nsMsgFlatFolderDataSource();</span>
<a href="#l6.282"></a><span id="l6.282" class="difflineminus">-  virtual nsresult Init() override;</span>
<a href="#l6.283"></a><span id="l6.283" class="difflineminus">-  virtual void Cleanup() override;</span>
<a href="#l6.284"></a><span id="l6.284" class="difflineminus">-</span>
<a href="#l6.285"></a><span id="l6.285" class="difflineminus">-  NS_IMETHOD GetURI(nsACString&amp; uri) override;</span>
<a href="#l6.286"></a><span id="l6.286" class="difflineminus">-  NS_IMETHOD GetTargets(nsIRDFResource* source,</span>
<a href="#l6.287"></a><span id="l6.287" class="difflineminus">-                        nsIRDFResource* property,</span>
<a href="#l6.288"></a><span id="l6.288" class="difflineminus">-                        bool tv,</span>
<a href="#l6.289"></a><span id="l6.289" class="difflineminus">-                        nsISimpleEnumerator** targets) override;</span>
<a href="#l6.290"></a><span id="l6.290" class="difflineminus">-  NS_IMETHOD GetTarget(nsIRDFResource* source,</span>
<a href="#l6.291"></a><span id="l6.291" class="difflineminus">-                       nsIRDFResource* property,</span>
<a href="#l6.292"></a><span id="l6.292" class="difflineminus">-                       bool tv,</span>
<a href="#l6.293"></a><span id="l6.293" class="difflineminus">-                       nsIRDFNode** target) override;</span>
<a href="#l6.294"></a><span id="l6.294" class="difflineminus">-</span>
<a href="#l6.295"></a><span id="l6.295" class="difflineminus">-  NS_IMETHOD HasAssertion(nsIRDFResource* source,</span>
<a href="#l6.296"></a><span id="l6.296" class="difflineminus">-                            nsIRDFResource* property,</span>
<a href="#l6.297"></a><span id="l6.297" class="difflineminus">-                            nsIRDFNode* target,</span>
<a href="#l6.298"></a><span id="l6.298" class="difflineminus">-                            bool tv,</span>
<a href="#l6.299"></a><span id="l6.299" class="difflineminus">-                            bool* hasAssertion) override;</span>
<a href="#l6.300"></a><span id="l6.300" class="difflineminus">-protected:</span>
<a href="#l6.301"></a><span id="l6.301" class="difflineminus">-  virtual nsresult GetFolderDisplayName(nsIMsgFolder *folder,</span>
<a href="#l6.302"></a><span id="l6.302" class="difflineminus">-                                        nsString&amp; folderName) override;</span>
<a href="#l6.303"></a><span id="l6.303" class="difflineminus">-  virtual void EnsureFolders();</span>
<a href="#l6.304"></a><span id="l6.304" class="difflineminus">-  virtual bool WantsThisFolder(nsIMsgFolder *folder);</span>
<a href="#l6.305"></a><span id="l6.305" class="difflineminus">-          bool ResourceIsOurRoot(nsIRDFResource *resource);</span>
<a href="#l6.306"></a><span id="l6.306" class="difflineminus">-  virtual nsresult OnItemAddedOrRemoved(nsIMsgFolder *parentItem, nsISupports *item,</span>
<a href="#l6.307"></a><span id="l6.307" class="difflineminus">-                                        bool added) override;</span>
<a href="#l6.308"></a><span id="l6.308" class="difflineminus">-</span>
<a href="#l6.309"></a><span id="l6.309" class="difflineminus">-  nsCOMArray &lt;nsIMsgFolder&gt; m_folders;</span>
<a href="#l6.310"></a><span id="l6.310" class="difflineminus">-  nsCOMPtr&lt;nsIRDFResource&gt;  m_rootResource; // the resource for our root</span>
<a href="#l6.311"></a><span id="l6.311" class="difflineminus">-  nsCString m_dsName;</span>
<a href="#l6.312"></a><span id="l6.312" class="difflineminus">-  bool m_builtFolders;</span>
<a href="#l6.313"></a><span id="l6.313" class="difflineminus">-};</span>
<a href="#l6.314"></a><span id="l6.314" class="difflineminus">-</span>
<a href="#l6.315"></a><span id="l6.315" class="difflineminus">-</span>
<a href="#l6.316"></a><span id="l6.316" class="difflineminus">-class nsMsgUnreadFoldersDataSource : public nsMsgFlatFolderDataSource</span>
<a href="#l6.317"></a><span id="l6.317" class="difflineminus">-{</span>
<a href="#l6.318"></a><span id="l6.318" class="difflineminus">-public:</span>
<a href="#l6.319"></a><span id="l6.319" class="difflineminus">-  nsMsgUnreadFoldersDataSource() {m_dsName = &quot;mailnewsunreadfolders&quot;;}</span>
<a href="#l6.320"></a><span id="l6.320" class="difflineminus">-  virtual ~nsMsgUnreadFoldersDataSource() {}</span>
<a href="#l6.321"></a><span id="l6.321" class="difflineminus">-  virtual nsresult NotifyPropertyChanged(nsIRDFResource *resource,</span>
<a href="#l6.322"></a><span id="l6.322" class="difflineminus">-                    nsIRDFResource *propertyResource, nsIRDFNode *newNode,</span>
<a href="#l6.323"></a><span id="l6.323" class="difflineminus">-                    nsIRDFNode *oldNode = nullptr) override;</span>
<a href="#l6.324"></a><span id="l6.324" class="difflineminus">-protected:</span>
<a href="#l6.325"></a><span id="l6.325" class="difflineminus">-  virtual bool WantsThisFolder(nsIMsgFolder *folder) override;</span>
<a href="#l6.326"></a><span id="l6.326" class="difflineminus">-};</span>
<a href="#l6.327"></a><span id="l6.327" class="difflineminus">-</span>
<a href="#l6.328"></a><span id="l6.328" class="difflineminus">-class nsMsgFavoriteFoldersDataSource : public nsMsgFlatFolderDataSource</span>
<a href="#l6.329"></a><span id="l6.329" class="difflineminus">-{</span>
<a href="#l6.330"></a><span id="l6.330" class="difflineminus">-public:</span>
<a href="#l6.331"></a><span id="l6.331" class="difflineminus">-  nsMsgFavoriteFoldersDataSource() {m_dsName = &quot;mailnewsfavefolders&quot;;}</span>
<a href="#l6.332"></a><span id="l6.332" class="difflineminus">-  virtual ~nsMsgFavoriteFoldersDataSource() {}</span>
<a href="#l6.333"></a><span id="l6.333" class="difflineminus">-protected:</span>
<a href="#l6.334"></a><span id="l6.334" class="difflineminus">-  virtual bool WantsThisFolder(nsIMsgFolder *folder) override;</span>
<a href="#l6.335"></a><span id="l6.335" class="difflineminus">-};</span>
<a href="#l6.336"></a><span id="l6.336" class="difflineminus">-</span>
<a href="#l6.337"></a><span id="l6.337" class="difflineminus">-class nsMsgRecentFoldersDataSource : public nsMsgFlatFolderDataSource</span>
<a href="#l6.338"></a><span id="l6.338" class="difflineminus">-{</span>
<a href="#l6.339"></a><span id="l6.339" class="difflineminus">-public:</span>
<a href="#l6.340"></a><span id="l6.340" class="difflineminus">-  nsMsgRecentFoldersDataSource() {m_dsName = &quot;mailnewsrecentfolders&quot;;</span>
<a href="#l6.341"></a><span id="l6.341" class="difflineminus">-                                  m_cutOffDate = 0; m_maxNumFolders = 15;}</span>
<a href="#l6.342"></a><span id="l6.342" class="difflineminus">-  virtual ~nsMsgRecentFoldersDataSource() {}</span>
<a href="#l6.343"></a><span id="l6.343" class="difflineminus">-  virtual nsresult NotifyPropertyChanged(nsIRDFResource *resource,</span>
<a href="#l6.344"></a><span id="l6.344" class="difflineminus">-                    nsIRDFResource *property, nsIRDFNode *newNode,</span>
<a href="#l6.345"></a><span id="l6.345" class="difflineminus">-                    nsIRDFNode *oldNode) override;</span>
<a href="#l6.346"></a><span id="l6.346" class="difflineminus">-  NS_IMETHOD OnItemAdded(nsIMsgFolder *parentItem, nsISupports *item) override;</span>
<a href="#l6.347"></a><span id="l6.347" class="difflineminus">-  virtual void Cleanup() override;</span>
<a href="#l6.348"></a><span id="l6.348" class="difflineminus">-protected:</span>
<a href="#l6.349"></a><span id="l6.349" class="difflineminus">-  virtual void EnsureFolders() override;</span>
<a href="#l6.350"></a><span id="l6.350" class="difflineminus">-  uint32_t m_cutOffDate;</span>
<a href="#l6.351"></a><span id="l6.351" class="difflineminus">-  uint32_t m_maxNumFolders;</span>
<a href="#l6.352"></a><span id="l6.352" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -54,18 +54,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> #include &quot;nsMessengerBootstrap.h&quot;</span>
<a href="#l7.5"></a><span id="l7.5"> #include &quot;nsMessenger.h&quot;</span>
<a href="#l7.6"></a><span id="l7.6"> #include &quot;nsIContentViewer.h&quot;</span>
<a href="#l7.7"></a><span id="l7.7"> #include &quot;nsMsgMailSession.h&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> #include &quot;nsMsgAccount.h&quot;</span>
<a href="#l7.9"></a><span id="l7.9"> #include &quot;nsMsgAccountManager.h&quot;</span>
<a href="#l7.10"></a><span id="l7.10"> #include &quot;nsMsgIdentity.h&quot;</span>
<a href="#l7.11"></a><span id="l7.11"> #include &quot;nsMsgIncomingServer.h&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-#include &quot;nsMsgFolderDataSource.h&quot;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-#include &quot;nsMsgAccountManagerDS.h&quot;</span>
<a href="#l7.14"></a><span id="l7.14"> #include &quot;nsMsgBiffManager.h&quot;</span>
<a href="#l7.15"></a><span id="l7.15"> #include &quot;nsMsgPurgeService.h&quot;</span>
<a href="#l7.16"></a><span id="l7.16"> #include &quot;nsStatusBarBiffManager.h&quot;</span>
<a href="#l7.17"></a><span id="l7.17"> #include &quot;nsMsgKeyArray.h&quot;</span>
<a href="#l7.18"></a><span id="l7.18"> #include &quot;nsCopyMessageStreamListener.h&quot;</span>
<a href="#l7.19"></a><span id="l7.19"> #include &quot;nsMsgCopyService.h&quot;</span>
<a href="#l7.20"></a><span id="l7.20"> #include &quot;nsMsgFolderCache.h&quot;</span>
<a href="#l7.21"></a><span id="l7.21"> #include &quot;nsMsgStatusFeedback.h&quot;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -324,21 +322,16 @@</span>
<a href="#l7.23"></a><span id="l7.23"> using namespace mozilla::mailnews;</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMessengerBootstrap)</span>
<a href="#l7.26"></a><span id="l7.26"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgMailSession, Init)</span>
<a href="#l7.27"></a><span id="l7.27"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMessenger)</span>
<a href="#l7.28"></a><span id="l7.28"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgAccountManager, Init)</span>
<a href="#l7.29"></a><span id="l7.29"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgAccount)</span>
<a href="#l7.30"></a><span id="l7.30"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgIdentity)</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgFolderDataSource, Init)</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgUnreadFoldersDataSource, Init)</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgFavoriteFoldersDataSource, Init)</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgRecentFoldersDataSource, Init)</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgAccountManagerDataSource, Init)</span>
<a href="#l7.36"></a><span id="l7.36"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgSearchSession)</span>
<a href="#l7.37"></a><span id="l7.37"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgSearchTerm)</span>
<a href="#l7.38"></a><span id="l7.38"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgSearchValidityManager)</span>
<a href="#l7.39"></a><span id="l7.39"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgFilterService)</span>
<a href="#l7.40"></a><span id="l7.40"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsMsgBiffManager, Init)</span>
<a href="#l7.41"></a><span id="l7.41"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMsgPurgeService)</span>
<a href="#l7.42"></a><span id="l7.42"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsStatusBarBiffManager, Init)</span>
<a href="#l7.43"></a><span id="l7.43"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsCopyMessageStreamListener)</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineat">@@ -386,21 +379,16 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(MailNewsD</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46"> NS_DEFINE_NAMED_CID(NS_MESSENGERBOOTSTRAP_CID);</span>
<a href="#l7.47"></a><span id="l7.47"> NS_DEFINE_NAMED_CID(NS_MESSENGERWINDOWSERVICE_CID);</span>
<a href="#l7.48"></a><span id="l7.48"> NS_DEFINE_NAMED_CID(NS_MSGMAILSESSION_CID);</span>
<a href="#l7.49"></a><span id="l7.49"> NS_DEFINE_NAMED_CID(NS_MESSENGER_CID);</span>
<a href="#l7.50"></a><span id="l7.50"> NS_DEFINE_NAMED_CID(NS_MSGACCOUNTMANAGER_CID);</span>
<a href="#l7.51"></a><span id="l7.51"> NS_DEFINE_NAMED_CID(NS_MSGACCOUNT_CID);</span>
<a href="#l7.52"></a><span id="l7.52"> NS_DEFINE_NAMED_CID(NS_MSGIDENTITY_CID);</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_MAILNEWSFOLDERDATASOURCE_CID);</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_MAILNEWSUNREADFOLDERDATASOURCE_CID);</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_MAILNEWSFAVORITEFOLDERDATASOURCE_CID);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_MAILNEWSRECENTFOLDERDATASOURCE_CID);</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-NS_DEFINE_NAMED_CID(NS_MSGACCOUNTMANAGERDATASOURCE_CID);</span>
<a href="#l7.58"></a><span id="l7.58"> NS_DEFINE_NAMED_CID(NS_MSGFILTERSERVICE_CID);</span>
<a href="#l7.59"></a><span id="l7.59"> NS_DEFINE_NAMED_CID(NS_MSGSEARCHSESSION_CID);</span>
<a href="#l7.60"></a><span id="l7.60"> NS_DEFINE_NAMED_CID(NS_MSGSEARCHTERM_CID);</span>
<a href="#l7.61"></a><span id="l7.61"> NS_DEFINE_NAMED_CID(NS_MSGSEARCHVALIDITYMANAGER_CID);</span>
<a href="#l7.62"></a><span id="l7.62"> NS_DEFINE_NAMED_CID(NS_MSGBIFFMANAGER_CID);</span>
<a href="#l7.63"></a><span id="l7.63"> NS_DEFINE_NAMED_CID(NS_MSGPURGESERVICE_CID);</span>
<a href="#l7.64"></a><span id="l7.64"> NS_DEFINE_NAMED_CID(NS_STATUSBARBIFFMANAGER_CID);</span>
<a href="#l7.65"></a><span id="l7.65"> NS_DEFINE_NAMED_CID(NS_COPYMESSAGESTREAMLISTENER_CID);</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineat">@@ -857,21 +845,16 @@ const mozilla::Module::CIDEntry kMailNew</span>
<a href="#l7.67"></a><span id="l7.67">   // MailNews Base Entries</span>
<a href="#l7.68"></a><span id="l7.68">   { &amp;kNS_MESSENGERBOOTSTRAP_CID, false, NULL, nsMessengerBootstrapConstructor },</span>
<a href="#l7.69"></a><span id="l7.69">   { &amp;kNS_MESSENGERWINDOWSERVICE_CID, false, NULL, nsMessengerBootstrapConstructor},</span>
<a href="#l7.70"></a><span id="l7.70">   { &amp;kNS_MSGMAILSESSION_CID, false, NULL, nsMsgMailSessionConstructor},</span>
<a href="#l7.71"></a><span id="l7.71">   { &amp;kNS_MESSENGER_CID, false, NULL,nsMessengerConstructor},</span>
<a href="#l7.72"></a><span id="l7.72">   { &amp;kNS_MSGACCOUNTMANAGER_CID, false, NULL, nsMsgAccountManagerConstructor},</span>
<a href="#l7.73"></a><span id="l7.73">   { &amp;kNS_MSGACCOUNT_CID, false, NULL, nsMsgAccountConstructor},</span>
<a href="#l7.74"></a><span id="l7.74">   { &amp;kNS_MSGIDENTITY_CID, false, NULL, nsMsgIdentityConstructor},</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-  { &amp;kNS_MAILNEWSFOLDERDATASOURCE_CID, false, NULL, nsMsgFolderDataSourceConstructor},</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-  { &amp;kNS_MAILNEWSUNREADFOLDERDATASOURCE_CID, false, NULL, nsMsgUnreadFoldersDataSourceConstructor},</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-  { &amp;kNS_MAILNEWSFAVORITEFOLDERDATASOURCE_CID, false, NULL, nsMsgFavoriteFoldersDataSourceConstructor},</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-  { &amp;kNS_MAILNEWSRECENTFOLDERDATASOURCE_CID, false, NULL, nsMsgRecentFoldersDataSourceConstructor},</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-  { &amp;kNS_MSGACCOUNTMANAGERDATASOURCE_CID, false, NULL, nsMsgAccountManagerDataSourceConstructor},</span>
<a href="#l7.80"></a><span id="l7.80">   { &amp;kNS_MSGFILTERSERVICE_CID, false, NULL, nsMsgFilterServiceConstructor},</span>
<a href="#l7.81"></a><span id="l7.81">   { &amp;kNS_MSGSEARCHSESSION_CID, false, NULL, nsMsgSearchSessionConstructor},</span>
<a href="#l7.82"></a><span id="l7.82">   { &amp;kNS_MSGSEARCHTERM_CID, false, NULL, nsMsgSearchTermConstructor},</span>
<a href="#l7.83"></a><span id="l7.83">   { &amp;kNS_MSGSEARCHVALIDITYMANAGER_CID, false, NULL, nsMsgSearchValidityManagerConstructor},</span>
<a href="#l7.84"></a><span id="l7.84">   { &amp;kNS_MSGBIFFMANAGER_CID, false, NULL, nsMsgBiffManagerConstructor},</span>
<a href="#l7.85"></a><span id="l7.85">   { &amp;kNS_MSGPURGESERVICE_CID, false, NULL, nsMsgPurgeServiceConstructor},</span>
<a href="#l7.86"></a><span id="l7.86">   { &amp;kNS_STATUSBARBIFFMANAGER_CID, false, NULL, nsStatusBarBiffManagerConstructor},</span>
<a href="#l7.87"></a><span id="l7.87">   { &amp;kNS_COPYMESSAGESTREAMLISTENER_CID, false, NULL, nsCopyMessageStreamListenerConstructor},</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineat">@@ -1072,21 +1055,16 @@ const mozilla::Module::ContractIDEntry k</span>
<a href="#l7.89"></a><span id="l7.89">   // MailNews Base Entries</span>
<a href="#l7.90"></a><span id="l7.90">   { NS_MESSENGERBOOTSTRAP_CONTRACTID, &amp;kNS_MESSENGERBOOTSTRAP_CID },</span>
<a href="#l7.91"></a><span id="l7.91">   { NS_MESSENGERWINDOWSERVICE_CONTRACTID, &amp;kNS_MESSENGERWINDOWSERVICE_CID },</span>
<a href="#l7.92"></a><span id="l7.92">   { NS_MSGMAILSESSION_CONTRACTID, &amp;kNS_MSGMAILSESSION_CID },</span>
<a href="#l7.93"></a><span id="l7.93">   { NS_MESSENGER_CONTRACTID, &amp;kNS_MESSENGER_CID },</span>
<a href="#l7.94"></a><span id="l7.94">   { NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;kNS_MSGACCOUNTMANAGER_CID },</span>
<a href="#l7.95"></a><span id="l7.95">   { NS_MSGACCOUNT_CONTRACTID, &amp;kNS_MSGACCOUNT_CID },</span>
<a href="#l7.96"></a><span id="l7.96">   { NS_MSGIDENTITY_CONTRACTID, &amp;kNS_MSGIDENTITY_CID },</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-  { NS_MAILNEWSFOLDERDATASOURCE_CONTRACTID, &amp;kNS_MAILNEWSFOLDERDATASOURCE_CID },</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-  { NS_MAILNEWSUNREADFOLDERDATASOURCE_CONTRACTID, &amp;kNS_MAILNEWSUNREADFOLDERDATASOURCE_CID },</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-  { NS_MAILNEWSFAVORITEFOLDERDATASOURCE_CONTRACTID, &amp;kNS_MAILNEWSFAVORITEFOLDERDATASOURCE_CID },</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-  { NS_MAILNEWSRECENTFOLDERDATASOURCE_CONTRACTID, &amp;kNS_MAILNEWSRECENTFOLDERDATASOURCE_CID },</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">-  { NS_RDF_DATASOURCE_CONTRACTID_PREFIX &quot;msgaccountmanager&quot;, &amp;kNS_MSGACCOUNTMANAGERDATASOURCE_CID },</span>
<a href="#l7.102"></a><span id="l7.102">   { NS_MSGFILTERSERVICE_CONTRACTID, &amp;kNS_MSGFILTERSERVICE_CID },</span>
<a href="#l7.103"></a><span id="l7.103">   { NS_MSGSEARCHSESSION_CONTRACTID, &amp;kNS_MSGSEARCHSESSION_CID },</span>
<a href="#l7.104"></a><span id="l7.104">   { NS_MSGSEARCHTERM_CONTRACTID, &amp;kNS_MSGSEARCHTERM_CID },</span>
<a href="#l7.105"></a><span id="l7.105">   { NS_MSGSEARCHVALIDITYMANAGER_CONTRACTID, &amp;kNS_MSGSEARCHVALIDITYMANAGER_CID },</span>
<a href="#l7.106"></a><span id="l7.106">   { NS_MSGBIFFMANAGER_CONTRACTID, &amp;kNS_MSGBIFFMANAGER_CID },</span>
<a href="#l7.107"></a><span id="l7.107">   { NS_MSGPURGESERVICE_CONTRACTID, &amp;kNS_MSGPURGESERVICE_CID },</span>
<a href="#l7.108"></a><span id="l7.108">   { NS_STATUSBARBIFFMANAGER_CONTRACTID, &amp;kNS_STATUSBARBIFFMANAGER_CID },</span>
<a href="#l7.109"></a><span id="l7.109">   { NS_COPYMESSAGESTREAMLISTENER_CONTRACTID, &amp;kNS_COPYMESSAGESTREAMLISTENER_CID },</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

