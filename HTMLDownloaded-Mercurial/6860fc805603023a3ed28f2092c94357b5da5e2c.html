<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29512:6860fc805603023a3ed28f2092c94357b5da5e2c</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6860fc805603023a3ed28f2092c94357b5da5e2c" />
<meta property="og:url" content="/comm-central/rev/6860fc805603023a3ed28f2092c94357b5da5e2c" />
<meta property="og:description" content="Bug 1630184 - Add name validation for address books and mailing lists. r=darktrojan" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6860fc805603023a3ed28f2092c94357b5da5e2c 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6860fc805603023a3ed28f2092c94357b5da5e2c">shortlog</a> |
<a href="/comm-central/log/6860fc805603023a3ed28f2092c94357b5da5e2c">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6860fc805603023a3ed28f2092c94357b5da5e2c">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6860fc805603023a3ed28f2092c94357b5da5e2c">files</a> |
changeset |
<a href="/comm-central/raw-rev/6860fc805603023a3ed28f2092c94357b5da5e2c">raw</a>  | <a href="/comm-central/archive/6860fc805603023a3ed28f2092c94357b5da5e2c.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1630184">Bug 1630184</a> - Add name validation for address books and mailing lists. r=darktrojan
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#98;&#100;&#97;&#108;&#108;&#97;&#104;&#32;&#65;&#102;&#105;&#102;&#121;&#32;&#60;&#97;&#98;&#100;&#97;&#108;&#108;&#97;&#104;&#46;&#107;&#104;&#97;&#108;&#101;&#100;&#46;&#97;&#108;&#105;&#46;&#57;&#51;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 06 May 2020 08:21:38 +0000</td></tr>

<tr>
 <td>changeset 29512</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6860fc805603023a3ed28f2092c94357b5da5e2c">6860fc805603023a3ed28f2092c94357b5da5e2c</a></td>
</tr>



<tr>
<td>parent 29511</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9e77ad8193b3f3d3a39b74b422130ce633816479">9e77ad8193b3f3d3a39b74b422130ce633816479</a>
</td>
</tr>

<tr>
<td>child 29513</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c5def570bb4b97b043bf35eda9df5f08fe996109">c5def570bb4b97b043bf35eda9df5f08fe996109</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6860fc805603023a3ed28f2092c94357b5da5e2c">17408</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 07 May 2020 22:59:10 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6860fc805603 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6860fc805603023a3ed28f2092c94357b5da5e2c">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6860fc805603023a3ed28f2092c94357b5da5e2c&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6860fc805603023a3ed28f2092c94357b5da5e2c&newProject=comm-central&newRevision=6860fc805603023a3ed28f2092c94357b5da5e2c&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6860fc805603023a3ed28f2092c94357b5da5e2c&newProject=comm-central&newRevision=6860fc805603023a3ed28f2092c94357b5da5e2c&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6860fc805603023a3ed28f2092c94357b5da5e2c&newProject=comm-central&newRevision=6860fc805603023a3ed28f2092c94357b5da5e2c&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1630184">1630184</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1630184">Bug 1630184</a> - Add name validation for address books and mailing lists. r=darktrojan

Add name validation for both address books and mailing lists and add tests for the mail extensions to ensure it works
for both normal creation in the TB Address book window and for the mail extension.

Differential Revision: <a href="https://phabricator.services.mozilla.com/D74002">https://phabricator.services.mozilla.com/D74002</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6860fc805603023a3ed28f2092c94357b5da5e2c/mail/components/extensions/test/xpcshell/test_ext_addressBook.js">mail/components/extensions/test/xpcshell/test_ext_addressBook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6860fc805603023a3ed28f2092c94357b5da5e2c/mail/components/extensions/test/xpcshell/test_ext_addressBook.js">file</a> |
<a href="/comm-central/annotate/6860fc805603023a3ed28f2092c94357b5da5e2c/mail/components/extensions/test/xpcshell/test_ext_addressBook.js">annotate</a> |
<a href="/comm-central/diff/6860fc805603023a3ed28f2092c94357b5da5e2c/mail/components/extensions/test/xpcshell/test_ext_addressBook.js">diff</a> |
<a href="/comm-central/comparison/6860fc805603023a3ed28f2092c94357b5da5e2c/mail/components/extensions/test/xpcshell/test_ext_addressBook.js">comparison</a> |
<a href="/comm-central/log/6860fc805603023a3ed28f2092c94357b5da5e2c/mail/components/extensions/test/xpcshell/test_ext_addressBook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">file</a> |
<a href="/comm-central/annotate/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">annotate</a> |
<a href="/comm-central/diff/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">diff</a> |
<a href="/comm-central/comparison/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">comparison</a> |
<a href="/comm-central/log/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm">mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm">file</a> |
<a href="/comm-central/annotate/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm">annotate</a> |
<a href="/comm-central/diff/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm">diff</a> |
<a href="/comm-central/comparison/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm">comparison</a> |
<a href="/comm-central/log/6860fc805603023a3ed28f2092c94357b5da5e2c/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/extensions/test/xpcshell/test_ext_addressBook.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/extensions/test/xpcshell/test_ext_addressBook.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -187,16 +187,23 @@ add_task(async function test_addressBook</span>
<a href="#l1.4"></a><span id="l1.4">           browser.test.assertEq(</span>
<a href="#l1.5"></a><span id="l1.5">             `addressBook with id=${newBookId} could not be found.`,</span>
<a href="#l1.6"></a><span id="l1.6">             ex.message,</span>
<a href="#l1.7"></a><span id="l1.7">             `browser.addressBooks.${operation} threw exception`</span>
<a href="#l1.8"></a><span id="l1.8">           );</span>
<a href="#l1.9"></a><span id="l1.9">         }</span>
<a href="#l1.10"></a><span id="l1.10">       }</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+      // Test the prevention of creating new address book with an empty name</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+      await browser.test.assertRejects(</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+        browser.addressBooks.create({ name: &quot;&quot; }),</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+        &quot;An unexpected error occurred&quot;,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+        &quot;browser.addressBooks.create threw exception&quot;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+      );</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+</span>
<a href="#l1.19"></a><span id="l1.19">       browser.test.assertEq(0, events.length, &quot;No events left unconsumed&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">       browser.test.log(&quot;Completed addressBookTest&quot;);</span>
<a href="#l1.21"></a><span id="l1.21">     }</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23">     async function contactsTest() {</span>
<a href="#l1.24"></a><span id="l1.24">       browser.test.log(&quot;Starting contactsTest&quot;);</span>
<a href="#l1.25"></a><span id="l1.25">       let contacts = await browser.contacts.list(firstBookId);</span>
<a href="#l1.26"></a><span id="l1.26">       browser.test.assertTrue(Array.isArray(contacts));</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineat">@@ -327,16 +334,41 @@ add_task(async function test_addressBook</span>
<a href="#l1.28"></a><span id="l1.28">       browser.test.assertEq(6, Object.keys(newAddressList).length);</span>
<a href="#l1.29"></a><span id="l1.29">       browser.test.assertEq(newMailingListId, newAddressList.id);</span>
<a href="#l1.30"></a><span id="l1.30">       browser.test.assertEq(firstBookId, newAddressList.parentId);</span>
<a href="#l1.31"></a><span id="l1.31">       browser.test.assertEq(&quot;mailingList&quot;, newAddressList.type);</span>
<a href="#l1.32"></a><span id="l1.32">       browser.test.assertEq(&quot;name&quot;, newAddressList.name);</span>
<a href="#l1.33"></a><span id="l1.33">       browser.test.assertEq(&quot;&quot;, newAddressList.nickName);</span>
<a href="#l1.34"></a><span id="l1.34">       browser.test.assertEq(&quot;&quot;, newAddressList.description);</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+      // Test that a valid name is ensured for an existing mail list</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+      await browser.test.assertRejects(</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+        browser.mailingLists.update(newMailingListId, {</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+          name: &quot;&quot;,</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+        }),</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+        &quot;An unexpected error occurred&quot;,</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+        &quot;browser.mailingLists.update threw exception&quot;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+      );</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+      await browser.test.assertRejects(</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+        browser.mailingLists.update(newMailingListId, {</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+          name: &quot;Two  spaces invalid name&quot;,</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+        }),</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+        &quot;An unexpected error occurred&quot;,</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+        &quot;browser.mailingLists.update threw exception&quot;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+      );</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+      await browser.test.assertRejects(</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+        browser.mailingLists.update(newMailingListId, {</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+          name: &quot;&gt;&lt;&lt;&lt;&quot;,</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+        }),</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+        &quot;An unexpected error occurred&quot;,</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+        &quot;browser.mailingLists.update threw exception&quot;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+      );</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+</span>
<a href="#l1.61"></a><span id="l1.61">       await browser.mailingLists.update(newMailingListId, {</span>
<a href="#l1.62"></a><span id="l1.62">         name: &quot;name!&quot;,</span>
<a href="#l1.63"></a><span id="l1.63">         nickName: &quot;nickname!&quot;,</span>
<a href="#l1.64"></a><span id="l1.64">         description: &quot;description!&quot;,</span>
<a href="#l1.65"></a><span id="l1.65">       });</span>
<a href="#l1.66"></a><span id="l1.66">       checkEvents([</span>
<a href="#l1.67"></a><span id="l1.67">         &quot;mailingLists&quot;,</span>
<a href="#l1.68"></a><span id="l1.68">         &quot;onUpdated&quot;,</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineat">@@ -437,16 +469,41 @@ add_task(async function test_addressBook</span>
<a href="#l1.70"></a><span id="l1.70">           browser.test.assertEq(</span>
<a href="#l1.71"></a><span id="l1.71">             `mailingList with id=${newMailingListId} could not be found.`,</span>
<a href="#l1.72"></a><span id="l1.72">             ex.message,</span>
<a href="#l1.73"></a><span id="l1.73">             `browser.mailingLists.${operation} threw exception`</span>
<a href="#l1.74"></a><span id="l1.74">           );</span>
<a href="#l1.75"></a><span id="l1.75">         }</span>
<a href="#l1.76"></a><span id="l1.76">       }</span>
<a href="#l1.77"></a><span id="l1.77"> </span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+      // Test that a valid name is ensured for a new mail list</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+      await browser.test.assertRejects(</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+        browser.mailingLists.create(firstBookId, {</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+          name: &quot;&quot;,</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+        }),</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+        &quot;An unexpected error occurred&quot;,</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+        &quot;browser.mailingLists.update threw exception&quot;</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+      );</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+      await browser.test.assertRejects(</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+        browser.mailingLists.create(firstBookId, {</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+          name: &quot;Two  spaces invalid name&quot;,</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+        }),</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+        &quot;An unexpected error occurred&quot;,</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+        &quot;browser.mailingLists.update threw exception&quot;</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+      );</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+      await browser.test.assertRejects(</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+        browser.mailingLists.create(firstBookId, {</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+          name: &quot;&gt;&lt;&lt;&lt;&quot;,</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+        }),</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+        &quot;An unexpected error occurred&quot;,</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+        &quot;browser.mailingLists.update threw exception&quot;</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+      );</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+</span>
<a href="#l1.103"></a><span id="l1.103">       browser.test.assertEq(0, events.length, &quot;No events left unconsumed&quot;);</span>
<a href="#l1.104"></a><span id="l1.104">       browser.test.log(&quot;Completed mailingListsTest&quot;);</span>
<a href="#l1.105"></a><span id="l1.105">     }</span>
<a href="#l1.106"></a><span id="l1.106"> </span>
<a href="#l1.107"></a><span id="l1.107">     async function contactRemovalTest() {</span>
<a href="#l1.108"></a><span id="l1.108">       browser.test.log(&quot;Starting contactRemovalTest&quot;);</span>
<a href="#l1.109"></a><span id="l1.109">       await browser.contacts.delete(newContactId);</span>
<a href="#l1.110"></a><span id="l1.110">       checkEvents([&quot;contacts&quot;, &quot;onDeleted&quot;, firstBookId, newContactId]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1033,16 +1033,42 @@ AddrBookDirectoryInner.prototype = {</span>
<a href="#l2.4"></a><span id="l2.4">       this.getBoolValue(&quot;enable_autocomplete&quot;, true)</span>
<a href="#l2.5"></a><span id="l2.5">     );</span>
<a href="#l2.6"></a><span id="l2.6">   },</span>
<a href="#l2.7"></a><span id="l2.7">   addMailList(list) {</span>
<a href="#l2.8"></a><span id="l2.8">     if (!list.isMailList) {</span>
<a href="#l2.9"></a><span id="l2.9">       throw Components.Exception(&quot;&quot;, Cr.NS_ERROR_UNEXPECTED);</span>
<a href="#l2.10"></a><span id="l2.10">     }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+    // Check if the new name is empty.</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    if (!list.dirName) {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+      throw new Components.Exception(</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+        &quot;Invalid mailing list name&quot;,</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+        Cr.NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+      );</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+    }</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+    // Check if the new name contains 2 spaces.</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+    if (list.dirName.match(&quot;  &quot;)) {</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      throw new Components.Exception(</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+        &quot;Invalid mailing list name&quot;,</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+        Cr.NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+      );</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+    }</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+    // Check if the new name contains the following special characters.</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+    for (let char of ',;&quot;&lt;&gt;') {</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+      if (list.dirName.includes(char)) {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+        throw new Components.Exception(</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+          &quot;Invalid mailing list name&quot;,</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+          Cr.NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+        );</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+      }</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+    }</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+</span>
<a href="#l2.38"></a><span id="l2.38">     let newList = new AddrBookMailingList(</span>
<a href="#l2.39"></a><span id="l2.39">       newUID(),</span>
<a href="#l2.40"></a><span id="l2.40">       this,</span>
<a href="#l2.41"></a><span id="l2.41">       this._getNextListId(),</span>
<a href="#l2.42"></a><span id="l2.42">       list.dirName || &quot;&quot;,</span>
<a href="#l2.43"></a><span id="l2.43">       list.listNickName || &quot;&quot;,</span>
<a href="#l2.44"></a><span id="l2.44">       list.description || &quot;&quot;</span>
<a href="#l2.45"></a><span id="l2.45">     );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/jsaddrbook/AddrBookMailingList.jsm</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -172,16 +172,42 @@ AddrBookMailingList.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4">         this.addCard(card);</span>
<a href="#l3.5"></a><span id="l3.5">         Services.obs.notifyObservers(</span>
<a href="#l3.6"></a><span id="l3.6">           card,</span>
<a href="#l3.7"></a><span id="l3.7">           &quot;addrbook-list-member-added&quot;,</span>
<a href="#l3.8"></a><span id="l3.8">           self._uid</span>
<a href="#l3.9"></a><span id="l3.9">         );</span>
<a href="#l3.10"></a><span id="l3.10">       },</span>
<a href="#l3.11"></a><span id="l3.11">       editMailListToDatabase(listCard) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+        // Check if the new name is empty.</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+        if (!self._name) {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+          throw new Components.Exception(</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+            &quot;Invalid mailing list name&quot;,</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+            Cr.NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+          );</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+        }</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+        // Check if the new name contains 2 spaces.</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+        if (self._name.match(&quot;  &quot;)) {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+          throw new Components.Exception(</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+            &quot;Invalid mailing list name&quot;,</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+            Cr.NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+          );</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+        }</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+        // Check if the new name contains the following special characters.</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+        for (let char of ',;&quot;&lt;&gt;') {</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+          if (self._name.includes(char)) {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+            throw new Components.Exception(</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+              &quot;Invalid mailing list name&quot;,</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+              Cr.NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+            );</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+          }</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+        }</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+</span>
<a href="#l3.38"></a><span id="l3.38">         self._parent._saveList(self);</span>
<a href="#l3.39"></a><span id="l3.39">         Services.obs.notifyObservers(this, &quot;addrbook-list-updated&quot;);</span>
<a href="#l3.40"></a><span id="l3.40">       },</span>
<a href="#l3.41"></a><span id="l3.41">     };</span>
<a href="#l3.42"></a><span id="l3.42">   },</span>
<a href="#l3.43"></a><span id="l3.43">   get asCard() {</span>
<a href="#l3.44"></a><span id="l3.44">     let self = this;</span>
<a href="#l3.45"></a><span id="l3.45">     return {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

