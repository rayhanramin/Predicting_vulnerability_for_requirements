<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 7324:99b7adef97b71fc9f97eced939a49fcef0630dd4</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 99b7adef97b71fc9f97eced939a49fcef0630dd4" />
<meta property="og:url" content="/comm-central/rev/99b7adef97b71fc9f97eced939a49fcef0630dd4" />
<meta property="og:description" content="Bug 638801 - Add an extra onLoad argument to contentTab and chromeTab arguments" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 99b7adef97b71fc9f97eced939a49fcef0630dd4 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/99b7adef97b71fc9f97eced939a49fcef0630dd4">shortlog</a> |
<a href="/comm-central/log/99b7adef97b71fc9f97eced939a49fcef0630dd4">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/99b7adef97b71fc9f97eced939a49fcef0630dd4">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/99b7adef97b71fc9f97eced939a49fcef0630dd4">files</a> |
changeset |
<a href="/comm-central/raw-rev/99b7adef97b71fc9f97eced939a49fcef0630dd4">raw</a>  | <a href="/comm-central/archive/99b7adef97b71fc9f97eced939a49fcef0630dd4.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=638801">Bug 638801</a> - Add an extra onLoad argument to contentTab and chromeTab arguments
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#110;&#97;&#116;&#104;&#97;&#110;&#32;&#80;&#114;&#111;&#116;&#122;&#101;&#110;&#107;&#111;&#32;&#60;&#106;&#111;&#110;&#97;&#116;&#104;&#97;&#110;&#46;&#112;&#114;&#111;&#116;&#122;&#101;&#110;&#107;&#111;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 11 Mar 2011 17:58:56 +0100</td></tr>

<tr>
 <td>changeset 7324</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/99b7adef97b71fc9f97eced939a49fcef0630dd4">99b7adef97b71fc9f97eced939a49fcef0630dd4</a></td>
</tr>



<tr>
<td>parent 7323</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a23f326c9da279c0804607e3144e0250b472fd08">a23f326c9da279c0804607e3144e0250b472fd08</a>
</td>
</tr>

<tr>
<td>child 7325</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/325c8df6ba18fdef77f2d235406e922d0becde91">325c8df6ba18fdef77f2d235406e922d0becde91</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=99b7adef97b71fc9f97eced939a49fcef0630dd4">5610</a></td></tr>
<tr><td>push user</td><td>jonathan.protzenko@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 11 Mar 2011 17:02:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@48607b9988f3 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=48607b9988f322906b4b3f4f9e34152074d5da5a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=48607b9988f322906b4b3f4f9e34152074d5da5a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=48607b9988f322906b4b3f4f9e34152074d5da5a&newProject=comm-central&newRevision=99b7adef97b71fc9f97eced939a49fcef0630dd4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=48607b9988f322906b4b3f4f9e34152074d5da5a&newProject=comm-central&newRevision=99b7adef97b71fc9f97eced939a49fcef0630dd4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=48607b9988f322906b4b3f4f9e34152074d5da5a&newProject=comm-central&newRevision=99b7adef97b71fc9f97eced939a49fcef0630dd4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=638801">638801</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=638801">Bug 638801</a> - Add an extra onLoad argument to contentTab and chromeTab arguments

The idea is that there's no reliable way for outer code to pass objects into
inner chrome from inside the chrome tab. This bug fixes the restriction by
adding an extra onLoad parameter to a content tab's arguments.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99b7adef97b71fc9f97eced939a49fcef0630dd4/mail/base/content/specialTabs.js">mail/base/content/specialTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99b7adef97b71fc9f97eced939a49fcef0630dd4/mail/base/content/specialTabs.js">file</a> |
<a href="/comm-central/annotate/99b7adef97b71fc9f97eced939a49fcef0630dd4/mail/base/content/specialTabs.js">annotate</a> |
<a href="/comm-central/diff/99b7adef97b71fc9f97eced939a49fcef0630dd4/mail/base/content/specialTabs.js">diff</a> |
<a href="/comm-central/comparison/99b7adef97b71fc9f97eced939a49fcef0630dd4/mail/base/content/specialTabs.js">comparison</a> |
<a href="/comm-central/log/99b7adef97b71fc9f97eced939a49fcef0630dd4/mail/base/content/specialTabs.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/specialTabs.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/specialTabs.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -349,17 +349,31 @@ var specialTabs = {</span>
<a href="#l1.4"></a><span id="l1.4">           // Ensure we go to the correct location on the page.</span>
<a href="#l1.5"></a><span id="l1.5">           tabInfo[selectedIndex].browser</span>
<a href="#l1.6"></a><span id="l1.6">                                 .setAttribute(&quot;src&quot;, aContentPage);</span>
<a href="#l1.7"></a><span id="l1.7">           return selectedIndex;</span>
<a href="#l1.8"></a><span id="l1.8">         }</span>
<a href="#l1.9"></a><span id="l1.9">       }</span>
<a href="#l1.10"></a><span id="l1.10">       return -1;</span>
<a href="#l1.11"></a><span id="l1.11">     },</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    openTab: function onTabOpened(aTab, aArgs) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    /**</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+     * This is the internal function used by content tabs to open a new tab. To</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+     * open a contentTab, use specialTabs.openTab(&quot;contentTab&quot;, aArgs)</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+     *</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+     * @param aArgs The options that content tabs accept.</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+     * @param aArgs.contentPage A string that holds the URL that is to be opened</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+     * @param aArgs.clickHandler The click handler for that content tab. See the</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+     *  &quot;Content Tabs&quot; article on MDC.</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+     * @param aArgs.onLoad A function that takes an Event and a DOMNode. It is</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+     *  called when the content page is done loading. The first argument is the</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+     *  load event, and the second argument is the xul:browser that holds the</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+     *  contentPage. You can access the inner tab's window object by accessing</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+     *  the second parameter's contentWindow property.</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+     */</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+    openTab: function contentTab_onTabOpened(aTab, aArgs) {</span>
<a href="#l1.28"></a><span id="l1.28">       if (!&quot;contentPage&quot; in aArgs)</span>
<a href="#l1.29"></a><span id="l1.29">         throw(&quot;contentPage must be specified&quot;);</span>
<a href="#l1.30"></a><span id="l1.30"> </span>
<a href="#l1.31"></a><span id="l1.31">       // First clone the page and set up the basics.</span>
<a href="#l1.32"></a><span id="l1.32">       let clone = document.getElementById(&quot;contentTab&quot;).firstChild.cloneNode(true);</span>
<a href="#l1.33"></a><span id="l1.33"> </span>
<a href="#l1.34"></a><span id="l1.34">       clone.setAttribute(&quot;id&quot;, &quot;contentTab&quot; + this.lastBrowserId);</span>
<a href="#l1.35"></a><span id="l1.35">       clone.setAttribute(&quot;collapsed&quot;, false);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineat">@@ -394,16 +408,21 @@ var specialTabs = {</span>
<a href="#l1.37"></a><span id="l1.37">                                 &quot;contentTabBrowser&quot; + this.lastBrowserId);</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">       // Default to reload being disabled.</span>
<a href="#l1.40"></a><span id="l1.40">       aTab.reloadEnabled = false;</span>
<a href="#l1.41"></a><span id="l1.41"> </span>
<a href="#l1.42"></a><span id="l1.42">       // Now set up the listeners.</span>
<a href="#l1.43"></a><span id="l1.43">       this._setUpTitleListener(aTab);</span>
<a href="#l1.44"></a><span id="l1.44">       this._setUpCloseWindowListener(aTab);</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+      if (&quot;onLoad&quot; in aArgs) {</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+        aTab.browser.addEventListener(&quot;load&quot;, function _contentTab_onLoad (event) {</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+          aArgs.onLoad(event, aTab.browser);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+        }, true);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+      }</span>
<a href="#l1.50"></a><span id="l1.50"> </span>
<a href="#l1.51"></a><span id="l1.51">       // Create a filter and hook it up to our browser</span>
<a href="#l1.52"></a><span id="l1.52">       let filter = Components.classes[&quot;@mozilla.org/appshell/component/browser-status-filter;1&quot;]</span>
<a href="#l1.53"></a><span id="l1.53">                              .createInstance(Components.interfaces.nsIWebProgress);</span>
<a href="#l1.54"></a><span id="l1.54">       aTab.filter = filter;</span>
<a href="#l1.55"></a><span id="l1.55">       aTab.browser.webProgress.addProgressListener(filter, Components.interfaces.nsIWebProgress.NOTIFY_ALL);</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57">       // Wire up a progress listener to the filter for this browser</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineat">@@ -792,17 +811,31 @@ var specialTabs = {</span>
<a href="#l1.59"></a><span id="l1.59">           // Ensure we go to the correct location on the page.</span>
<a href="#l1.60"></a><span id="l1.60">           tabInfo[selectedIndex].browser</span>
<a href="#l1.61"></a><span id="l1.61">                                 .setAttribute(&quot;src&quot;, achromePage);</span>
<a href="#l1.62"></a><span id="l1.62">           return selectedIndex;</span>
<a href="#l1.63"></a><span id="l1.63">         }</span>
<a href="#l1.64"></a><span id="l1.64">       }</span>
<a href="#l1.65"></a><span id="l1.65">       return -1;</span>
<a href="#l1.66"></a><span id="l1.66">     },</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-    openTab: function onTabOpened(aTab, aArgs) {</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+    /**</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+     * This is the internal function used by chrome tabs to open a new tab. To</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+     * open a chromeTab, use specialTabs.openTab(&quot;chromeTab&quot;, aArgs)</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+     *</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+     * @param aArgs The options that chrome tabs accept.</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+     * @param aArgs.chromePage A string that holds the URL that is to be opened</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+     * @param aArgs.clickHandler The click handler for that chrome tab. See the</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+     *  &quot;Content Tabs&quot; article on MDC.</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+     * @param aArgs.onLoad A function that takes an Event and a DOMNode. It is</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+     *  called when the chrome page is done loading. The first argument is the</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+     *  load event, and the second argument is the xul:browser that holds the</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+     *  chromePage. You can access the inner tab's window object by accessing</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+     *  the second parameter's chromeWindow property.</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+     */</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+    openTab: function chromeTab_onTabOpened(aTab, aArgs) {</span>
<a href="#l1.83"></a><span id="l1.83">       if (!&quot;chromePage&quot; in aArgs)</span>
<a href="#l1.84"></a><span id="l1.84">         throw(&quot;chromePage must be specified&quot;);</span>
<a href="#l1.85"></a><span id="l1.85"> </span>
<a href="#l1.86"></a><span id="l1.86">       // First clone the page and set up the basics.</span>
<a href="#l1.87"></a><span id="l1.87">       let clone = document.getElementById(&quot;chromeTab&quot;).firstChild.cloneNode(true);</span>
<a href="#l1.88"></a><span id="l1.88"> </span>
<a href="#l1.89"></a><span id="l1.89">       clone.setAttribute(&quot;id&quot;, &quot;chromeTab&quot; + this.lastBrowserId);</span>
<a href="#l1.90"></a><span id="l1.90">       clone.setAttribute(&quot;collapsed&quot;, false);</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineat">@@ -824,16 +857,21 @@ var specialTabs = {</span>
<a href="#l1.92"></a><span id="l1.92">                                 aArgs.clickHandler :</span>
<a href="#l1.93"></a><span id="l1.93">                                 &quot;specialTabs.defaultClickHandler(event);&quot;);</span>
<a href="#l1.94"></a><span id="l1.94"> </span>
<a href="#l1.95"></a><span id="l1.95">       aTab.browser.setAttribute(&quot;id&quot;, &quot;chromeTabBrowser&quot; + this.lastBrowserId);</span>
<a href="#l1.96"></a><span id="l1.96"> </span>
<a href="#l1.97"></a><span id="l1.97">       // Now set up the listeners.</span>
<a href="#l1.98"></a><span id="l1.98">       this._setUpTitleListener(aTab);</span>
<a href="#l1.99"></a><span id="l1.99">       this._setUpCloseWindowListener(aTab);</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+      if (&quot;onLoad&quot; in aArgs) {</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+        aTab.browser.addEventListener(&quot;load&quot;, function _chromeTab_onLoad (event) {</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+          aArgs.onLoad(event, aTab.browser);</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+        }, true);</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+      }</span>
<a href="#l1.105"></a><span id="l1.105"> </span>
<a href="#l1.106"></a><span id="l1.106">       // Now start loading the content.</span>
<a href="#l1.107"></a><span id="l1.107">       aTab.title = this.loadingTabString;</span>
<a href="#l1.108"></a><span id="l1.108">       aTab.browser.loadURI(aArgs.chromePage);</span>
<a href="#l1.109"></a><span id="l1.109"> </span>
<a href="#l1.110"></a><span id="l1.110">       this.lastBrowserId++;</span>
<a href="#l1.111"></a><span id="l1.111">     },</span>
<a href="#l1.112"></a><span id="l1.112">     closeTab: function onTabClosed(aTab) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

