<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20095:880d5e4d567c33a4424cae66ac72fc523a663efd</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 880d5e4d567c33a4424cae66ac72fc523a663efd" />
<meta property="og:url" content="/comm-central/rev/880d5e4d567c33a4424cae66ac72fc523a663efd" />
<meta property="og:description" content="Bug 1280898 - Set up eslint for calendar files - enable no-case-declarations rule. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 880d5e4d567c33a4424cae66ac72fc523a663efd 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/880d5e4d567c33a4424cae66ac72fc523a663efd">shortlog</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/880d5e4d567c33a4424cae66ac72fc523a663efd">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd">files</a> |
changeset |
<a href="/comm-central/raw-rev/880d5e4d567c33a4424cae66ac72fc523a663efd">raw</a>  | <a href="/comm-central/archive/880d5e4d567c33a4424cae66ac72fc523a663efd.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-case-declarations rule. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#101;&#115;&#108;&#105;&#110;&#116;&#32;&#60;&#101;&#115;&#108;&#105;&#110;&#116;&#64;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#46;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 08 Jul 2016 18:36:48 +0200</td></tr>

<tr>
 <td>changeset 20095</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/880d5e4d567c33a4424cae66ac72fc523a663efd">880d5e4d567c33a4424cae66ac72fc523a663efd</a></td>
</tr>



<tr>
<td>parent 20094</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/311e2a727825d2b098d19ff265a9153f0eca1ebe">311e2a727825d2b098d19ff265a9153f0eca1ebe</a>
</td>
</tr>

<tr>
<td>child 20096</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2d001923cb988f8f6a7108093f5388e9b627bc01">2d001923cb988f8f6a7108093f5388e9b627bc01</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=880d5e4d567c33a4424cae66ac72fc523a663efd">12312</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 17 Sep 2016 23:42:54 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2d001923cb98 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2d001923cb988f8f6a7108093f5388e9b627bc01">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2d001923cb988f8f6a7108093f5388e9b627bc01&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d001923cb988f8f6a7108093f5388e9b627bc01&newProject=comm-central&newRevision=311e2a727825d2b098d19ff265a9153f0eca1ebe&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d001923cb988f8f6a7108093f5388e9b627bc01&newProject=comm-central&newRevision=311e2a727825d2b098d19ff265a9153f0eca1ebe&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2d001923cb988f8f6a7108093f5388e9b627bc01&newProject=comm-central&newRevision=311e2a727825d2b098d19ff265a9153f0eca1ebe&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">1280898</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280898">Bug 1280898</a> - Set up eslint for calendar files - enable no-case-declarations rule. r=MakeMyDay

MozReview-Commit-ID: 4A9kFNothg2</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/.eslintrc">calendar/.eslintrc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/.eslintrc">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/.eslintrc">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/.eslintrc">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/.eslintrc">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/.eslintrc">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-clipboard.js">calendar/base/content/calendar-clipboard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-clipboard.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-clipboard.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-clipboard.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-clipboard.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-clipboard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-editing.js">calendar/base/content/calendar-task-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-editing.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-editing.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-editing.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-editing.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/itip/calItipEmailTransport.js">calendar/itip/calItipEmailTransport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/itip/calItipEmailTransport.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/itip/calItipEmailTransport.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/itip/calItipEmailTransport.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/itip/calItipEmailTransport.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/itip/calItipEmailTransport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-panel.js">calendar/lightning/content/lightning-item-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-panel.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-panel.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-panel.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-panel.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/lightning/content/lightning-item-panel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/880d5e4d567c33a4424cae66ac72fc523a663efd/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/.eslintrc</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/.eslintrc</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -454,13 +454,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">         /* coordinates */ &quot;x&quot;, &quot;y&quot;,</span>
<a href="#l1.5"></a><span id="l1.5">         /* regexes */ &quot;re&quot;,</span>
<a href="#l1.6"></a><span id="l1.6">         /* known words */ &quot;rc&quot;, &quot;rv&quot;, &quot;id&quot;, &quot;OS&quot;, &quot;os&quot;, &quot;db&quot;,</span>
<a href="#l1.7"></a><span id="l1.7">         /* mail/calendar words */ &quot;to&quot;, &quot;cc&quot;,</span>
<a href="#l1.8"></a><span id="l1.8">         /* Components */ &quot;Ci&quot;, &quot;Cc&quot;, &quot;Cu&quot;, &quot;Cr&quot;,</span>
<a href="#l1.9"></a><span id="l1.9">       ]</span>
<a href="#l1.10"></a><span id="l1.10">     }],</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    // Disallow lexical declarations in case/default clauses</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    &quot;no-case-declarations&quot;: 2,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15">     // The following rules will not be enabled currently, but are kept here for</span>
<a href="#l1.16"></a><span id="l1.16">     // easier updates in the future.</span>
<a href="#l1.17"></a><span id="l1.17">     &quot;no-else-return&quot;: 0,</span>
<a href="#l1.18"></a><span id="l1.18">   }</span>
<a href="#l1.19"></a><span id="l1.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-clipboard.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-clipboard.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -121,17 +121,17 @@ function pasteFromClipboard() {</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">     // Ask transferable for the best flavor.</span>
<a href="#l2.6"></a><span id="l2.6">     let flavor = {};</span>
<a href="#l2.7"></a><span id="l2.7">     let data = {};</span>
<a href="#l2.8"></a><span id="l2.8">     trans.getAnyTransferData(flavor, data, {});</span>
<a href="#l2.9"></a><span id="l2.9">     data = data.value.QueryInterface(Components.interfaces.nsISupportsString).data;</span>
<a href="#l2.10"></a><span id="l2.10">     switch (flavor.value) {</span>
<a href="#l2.11"></a><span id="l2.11">         case &quot;text/calendar&quot;:</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        case &quot;text/unicode&quot;:</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        case &quot;text/unicode&quot;: {</span>
<a href="#l2.14"></a><span id="l2.14">             let destCal = getSelectedCalendar();</span>
<a href="#l2.15"></a><span id="l2.15">             if (!destCal) {</span>
<a href="#l2.16"></a><span id="l2.16">                 return;</span>
<a href="#l2.17"></a><span id="l2.17">             }</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">             let icsParser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l2.20"></a><span id="l2.20">                                       .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l2.21"></a><span id="l2.21">             try {</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -189,12 +189,13 @@ function pasteFromClipboard() {</span>
<a href="#l2.23"></a><span id="l2.23">                 newItem.id = cal.getUUID();</span>
<a href="#l2.24"></a><span id="l2.24">                 if (offset) {</span>
<a href="#l2.25"></a><span id="l2.25">                     cal.shiftItem(newItem, offset);</span>
<a href="#l2.26"></a><span id="l2.26">                 }</span>
<a href="#l2.27"></a><span id="l2.27">                 doTransaction(&quot;add&quot;, newItem, destCal, null, null);</span>
<a href="#l2.28"></a><span id="l2.28">             }</span>
<a href="#l2.29"></a><span id="l2.29">             endBatchTransaction();</span>
<a href="#l2.30"></a><span id="l2.30">             break;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+        }</span>
<a href="#l2.32"></a><span id="l2.32">         default:</span>
<a href="#l2.33"></a><span id="l2.33">             break;</span>
<a href="#l2.34"></a><span id="l2.34">     }</span>
<a href="#l2.35"></a><span id="l2.35"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -3387,22 +3387,23 @@</span>
<a href="#l3.4"></a><span id="l3.4">                   labelbox.date = date;</span>
<a href="#l3.5"></a><span id="l3.5">               }</span>
<a href="#l3.6"></a><span id="l3.6">               // Set attributes for date relations and for the time indicator.</span>
<a href="#l3.7"></a><span id="l3.7">               let headerDayBox = document.getAnonymousElementByAttribute(</span>
<a href="#l3.8"></a><span id="l3.8">                                      this, &quot;anonid&quot;, &quot;headerdaybox&quot;);</span>
<a href="#l3.9"></a><span id="l3.9">               headerDayBox.removeAttribute(&quot;todaylastinview&quot;);</span>
<a href="#l3.10"></a><span id="l3.10">               dayEventsBox.timeIndicatorBox.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l3.11"></a><span id="l3.11">               switch (date.compare(today)) {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                  case -1:</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                  case -1: {</span>
<a href="#l3.14"></a><span id="l3.14">                       dayHeaderBox.setAttribute(&quot;relation&quot;, &quot;past&quot;);</span>
<a href="#l3.15"></a><span id="l3.15">                       dayEventsBox.setAttribute(&quot;relation&quot;, &quot;past&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">                       labelbox.setAttribute(&quot;relation&quot;, &quot;past&quot;);</span>
<a href="#l3.17"></a><span id="l3.17">                       break;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-                  case 0:</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+                  }</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+                  case 0: {</span>
<a href="#l3.21"></a><span id="l3.21">                       let relation_ = this.numVisibleDates == 1 ? &quot;today1day&quot; : &quot;today&quot;;</span>
<a href="#l3.22"></a><span id="l3.22">                       dayHeaderBox.setAttribute(&quot;relation&quot;, relation_);</span>
<a href="#l3.23"></a><span id="l3.23">                       dayEventsBox.setAttribute(&quot;relation&quot;, relation_);</span>
<a href="#l3.24"></a><span id="l3.24">                       labelbox.setAttribute(&quot;relation&quot;, relation_);</span>
<a href="#l3.25"></a><span id="l3.25">                       setBooleanAttribute(dayEventsBox.timeIndicatorBox, &quot;hidden&quot;, this.mTimeIndicatorInterval == 0);</span>
<a href="#l3.26"></a><span id="l3.26">                       updateTimeIndicator = true;</span>
<a href="#l3.27"></a><span id="l3.27"> </span>
<a href="#l3.28"></a><span id="l3.28">                       // Due to equalsize=always being set on the dayboxes</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineat">@@ -3410,21 +3411,23 @@</span>
<a href="#l3.30"></a><span id="l3.30">                       // the last daybox correctly. To work around this, we're</span>
<a href="#l3.31"></a><span id="l3.31">                       // setting an attribute we can use in CSS. For more</span>
<a href="#l3.32"></a><span id="l3.32">                       // information about this hack, see bug 455045</span>
<a href="#l3.33"></a><span id="l3.33">                       if (dayHeaderBox == headerdaybox.childNodes[headerdaybox.childNodes.length - 1] &amp;&amp;</span>
<a href="#l3.34"></a><span id="l3.34">                           this.numVisibleDates &gt; 1) {</span>
<a href="#l3.35"></a><span id="l3.35">                           headerDayBox.setAttribute(&quot;todaylastinview&quot;, &quot;true&quot;);</span>
<a href="#l3.36"></a><span id="l3.36">                       }</span>
<a href="#l3.37"></a><span id="l3.37">                       break;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-                  case 1:</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+                  }</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+                  case 1: {</span>
<a href="#l3.41"></a><span id="l3.41">                       dayHeaderBox.setAttribute(&quot;relation&quot;, &quot;future&quot;);</span>
<a href="#l3.42"></a><span id="l3.42">                       dayEventsBox.setAttribute(&quot;relation&quot;, &quot;future&quot;);</span>
<a href="#l3.43"></a><span id="l3.43">                       labelbox.setAttribute(&quot;relation&quot;, &quot;future&quot;);</span>
<a href="#l3.44"></a><span id="l3.44">                       break;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+                  }</span>
<a href="#l3.46"></a><span id="l3.46">               }</span>
<a href="#l3.47"></a><span id="l3.47">               // We don't want to actually mess with our original dates, plus</span>
<a href="#l3.48"></a><span id="l3.48">               // they're likely to be immutable.</span>
<a href="#l3.49"></a><span id="l3.49">               let date2 = date.clone();</span>
<a href="#l3.50"></a><span id="l3.50">               date2.isDate = true;</span>
<a href="#l3.51"></a><span id="l3.51">               date2.makeImmutable();</span>
<a href="#l3.52"></a><span id="l3.52">               this.mDateColumns.push({ date: date2, column: dayEventsBox, header: dayHeaderBox });</span>
<a href="#l3.53"></a><span id="l3.53">               counter++;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-task-editing.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-editing.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -186,21 +186,23 @@ var taskEdit = {</span>
<a href="#l4.4"></a><span id="l4.4">         onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l4.5"></a><span id="l4.5">             if (aCalendar.id != getSelectedCalendar().id) {</span>
<a href="#l4.6"></a><span id="l4.6">                 // Optimization: if the given calendar isn't the default calendar,</span>
<a href="#l4.7"></a><span id="l4.7">                 // then we don't need to change any readonly/disabled states.</span>
<a href="#l4.8"></a><span id="l4.8">                 return;</span>
<a href="#l4.9"></a><span id="l4.9">             }</span>
<a href="#l4.10"></a><span id="l4.10">             switch (aName) {</span>
<a href="#l4.11"></a><span id="l4.11">                 case &quot;readOnly&quot;:</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                case &quot;disabled&quot;:</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                case &quot;disabled&quot;: {</span>
<a href="#l4.14"></a><span id="l4.14">                     let taskEditFields = document.getElementsByAttribute(&quot;class&quot;, &quot;task-edit-field&quot;);</span>
<a href="#l4.15"></a><span id="l4.15">                     for (let i = 0; i &lt; taskEditFields.length; i++) {</span>
<a href="#l4.16"></a><span id="l4.16">                         taskEdit.onBlur({ target: taskEditFields[i] });</span>
<a href="#l4.17"></a><span id="l4.17">                     }</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+                    break;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+                }</span>
<a href="#l4.20"></a><span id="l4.20">             }</span>
<a href="#l4.21"></a><span id="l4.21">         },</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">         onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l4.24"></a><span id="l4.24">             // Since the old value is not used directly in onPropertyChanged,</span>
<a href="#l4.25"></a><span id="l4.25">             // but should not be the same as the value, set it to a different</span>
<a href="#l4.26"></a><span id="l4.26">             // value.</span>
<a href="#l4.27"></a><span id="l4.27">             this.onPropertyChanged(aCalendar, aName, null, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -699,25 +699,26 @@</span>
<a href="#l5.4"></a><span id="l5.4">           getImgSrc: function(aRow, aCol) {</span>
<a href="#l5.5"></a><span id="l5.5">               return null;</span>
<a href="#l5.6"></a><span id="l5.6">           },</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8">           // The progress mode for a given cell. This method is only called for</span>
<a href="#l5.9"></a><span id="l5.9">           // columns of type |progressmeter|.</span>
<a href="#l5.10"></a><span id="l5.10">           getProgressMode: function(aRow, aCol) {</span>
<a href="#l5.11"></a><span id="l5.11">               switch (aCol.element.getAttribute(&quot;itemproperty&quot;)) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                  case &quot;percentComplete&quot;:</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+                  case &quot;percentComplete&quot;: {</span>
<a href="#l5.14"></a><span id="l5.14">                       let task = this.binding.mTaskArray[aRow];</span>
<a href="#l5.15"></a><span id="l5.15">                       if (aCol.element.boxObject.width &gt; 75 &amp;&amp;</span>
<a href="#l5.16"></a><span id="l5.16">                           task.percentComplete &gt; 0) {</span>
<a href="#l5.17"></a><span id="l5.17">                           // XXX Would be nice if we could use relative widths,</span>
<a href="#l5.18"></a><span id="l5.18">                           // i.e &quot;15ex&quot;, but there is no scriptable interface.</span>
<a href="#l5.19"></a><span id="l5.19">                           return Components.interfaces.nsITreeView.PROGRESS_NORMAL;</span>
<a href="#l5.20"></a><span id="l5.20">                       }</span>
<a href="#l5.21"></a><span id="l5.21">                       break;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+                  }</span>
<a href="#l5.23"></a><span id="l5.23">               }</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25">               return Components.interfaces.nsITreeView.PROGRESS_NONE;</span>
<a href="#l5.26"></a><span id="l5.26">           },</span>
<a href="#l5.27"></a><span id="l5.27"> </span>
<a href="#l5.28"></a><span id="l5.28">           /**</span>
<a href="#l5.29"></a><span id="l5.29">            * Task Tree Events</span>
<a href="#l5.30"></a><span id="l5.30">            */</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineat">@@ -741,37 +742,40 @@</span>
<a href="#l5.32"></a><span id="l5.32">                       createTodoWithDialog(null, null, null, null, initialDate);</span>
<a href="#l5.33"></a><span id="l5.33">                   }</span>
<a href="#l5.34"></a><span id="l5.34">               }</span>
<a href="#l5.35"></a><span id="l5.35">           },</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37">           onKeyPress: function(event) {</span>
<a href="#l5.38"></a><span id="l5.38">               const kKE = Components.interfaces.nsIDOMKeyEvent;</span>
<a href="#l5.39"></a><span id="l5.39">               switch (event.keyCode || event.which) {</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-                  case kKE.DOM_VK_DELETE:</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+                  case kKE.DOM_VK_DELETE: {</span>
<a href="#l5.42"></a><span id="l5.42">                       document.popupNode = this.binding;</span>
<a href="#l5.43"></a><span id="l5.43">                       document.getElementById(&quot;calendar_delete_todo_command&quot;).doCommand();</span>
<a href="#l5.44"></a><span id="l5.44">                       event.preventDefault();</span>
<a href="#l5.45"></a><span id="l5.45">                       event.stopPropagation();</span>
<a href="#l5.46"></a><span id="l5.46">                       break;</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-                  case kKE.DOM_VK_SPACE:</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+                  }</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+                  case kKE.DOM_VK_SPACE: {</span>
<a href="#l5.50"></a><span id="l5.50">                       if (this.tree.currentIndex &gt; -1) {</span>
<a href="#l5.51"></a><span id="l5.51">                           let col = document.getAnonymousElementByAttribute(</span>
<a href="#l5.52"></a><span id="l5.52">                               this.binding, &quot;itemproperty&quot;, &quot;completed&quot;);</span>
<a href="#l5.53"></a><span id="l5.53">                           this.cycleCell(</span>
<a href="#l5.54"></a><span id="l5.54">                               this.tree.currentIndex,</span>
<a href="#l5.55"></a><span id="l5.55">                               { element: col });</span>
<a href="#l5.56"></a><span id="l5.56">                       }</span>
<a href="#l5.57"></a><span id="l5.57">                       break;</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineminus">-                  case kKE.DOM_VK_RETURN:</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+                  }</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+                  case kKE.DOM_VK_RETURN: {</span>
<a href="#l5.61"></a><span id="l5.61">                       let index = this.tree.currentIndex;</span>
<a href="#l5.62"></a><span id="l5.62">                       if (index &gt; -1) {</span>
<a href="#l5.63"></a><span id="l5.63">                           modifyEventWithDialog(this.binding.mTaskArray[index]);</span>
<a href="#l5.64"></a><span id="l5.64">                       }</span>
<a href="#l5.65"></a><span id="l5.65">                       break;</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+                  }</span>
<a href="#l5.67"></a><span id="l5.67">               }</span>
<a href="#l5.68"></a><span id="l5.68">           },</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70">           // Set the context menu on mousedown to change it before it is opened</span>
<a href="#l5.71"></a><span id="l5.71">           onMouseDown: function(event) {</span>
<a href="#l5.72"></a><span id="l5.72">               let tree = document.getAnonymousElementByAttribute(this.binding,</span>
<a href="#l5.73"></a><span id="l5.73">                                                                  &quot;anonid&quot;,</span>
<a href="#l5.74"></a><span id="l5.74">                                                                  &quot;calendar-task-tree&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -59,49 +59,54 @@ var taskDetailsView = {</span>
<a href="#l6.4"></a><span id="l6.4">             displayElement(&quot;calendar-task-details-priority-low&quot;, priority &gt;= 6 &amp;&amp; priority &lt;= 9);</span>
<a href="#l6.5"></a><span id="l6.5">             displayElement(&quot;calendar-task-details-priority-normal&quot;, priority == 5);</span>
<a href="#l6.6"></a><span id="l6.6">             displayElement(&quot;calendar-task-details-priority-high&quot;, priority &gt;= 1 &amp;&amp; priority &lt;= 4);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">             let status = item.getProperty(&quot;STATUS&quot;);</span>
<a href="#l6.9"></a><span id="l6.9">             if (displayElement(&quot;calendar-task-details-status-row&quot;, status &amp;&amp; status.length &gt; 0)) {</span>
<a href="#l6.10"></a><span id="l6.10">                 let statusDetails = document.getElementById(&quot;calendar-task-details-status&quot;);</span>
<a href="#l6.11"></a><span id="l6.11">                 switch (status) {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                    case &quot;NEEDS-ACTION&quot;:</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                    case &quot;NEEDS-ACTION&quot;: {</span>
<a href="#l6.14"></a><span id="l6.14">                         statusDetails.value = calGetString(</span>
<a href="#l6.15"></a><span id="l6.15">                             &quot;calendar&quot;,</span>
<a href="#l6.16"></a><span id="l6.16">                             &quot;taskDetailsStatusNeedsAction&quot;);</span>
<a href="#l6.17"></a><span id="l6.17">                         break;</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">-                    case &quot;IN-PROCESS&quot;:</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+                    }</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+                    case &quot;IN-PROCESS&quot;: {</span>
<a href="#l6.21"></a><span id="l6.21">                         let percent = 0;</span>
<a href="#l6.22"></a><span id="l6.22">                         let property = item.getProperty(&quot;PERCENT-COMPLETE&quot;);</span>
<a href="#l6.23"></a><span id="l6.23">                         if (property != null) {</span>
<a href="#l6.24"></a><span id="l6.24">                             percent = parseInt(property, 10);</span>
<a href="#l6.25"></a><span id="l6.25">                         }</span>
<a href="#l6.26"></a><span id="l6.26">                         statusDetails.value = calGetString(</span>
<a href="#l6.27"></a><span id="l6.27">                             &quot;calendar&quot;,</span>
<a href="#l6.28"></a><span id="l6.28">                             &quot;taskDetailsStatusInProgress&quot;, [percent]);</span>
<a href="#l6.29"></a><span id="l6.29">                         break;</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-                    case &quot;COMPLETED&quot;:</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+                    }</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+                    case &quot;COMPLETED&quot;: {</span>
<a href="#l6.33"></a><span id="l6.33">                         if (item.completedDate) {</span>
<a href="#l6.34"></a><span id="l6.34">                             let completedDate = item.completedDate.getInTimezone(</span>
<a href="#l6.35"></a><span id="l6.35">                                                     calendarDefaultTimezone());</span>
<a href="#l6.36"></a><span id="l6.36">                             statusDetails.value = calGetString(</span>
<a href="#l6.37"></a><span id="l6.37">                                 &quot;calendar&quot;,</span>
<a href="#l6.38"></a><span id="l6.38">                                 &quot;taskDetailsStatusCompletedOn&quot;,</span>
<a href="#l6.39"></a><span id="l6.39">                                 [dateFormatter.formatDateTime(completedDate)]);</span>
<a href="#l6.40"></a><span id="l6.40">                         }</span>
<a href="#l6.41"></a><span id="l6.41">                         break;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-                    case &quot;CANCELLED&quot;:</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+                    }</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+                    case &quot;CANCELLED&quot;: {</span>
<a href="#l6.45"></a><span id="l6.45">                         statusDetails.value = calGetString(</span>
<a href="#l6.46"></a><span id="l6.46">                             &quot;calendar&quot;,</span>
<a href="#l6.47"></a><span id="l6.47">                             &quot;taskDetailsStatusCancelled&quot;);</span>
<a href="#l6.48"></a><span id="l6.48">                         break;</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-                    default:</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+                    }</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+                    default: {</span>
<a href="#l6.52"></a><span id="l6.52">                         displayElement(&quot;calendar-task-details-status-row&quot;, false);</span>
<a href="#l6.53"></a><span id="l6.53">                         break;</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+                    }</span>
<a href="#l6.55"></a><span id="l6.55">                 }</span>
<a href="#l6.56"></a><span id="l6.56">             }</span>
<a href="#l6.57"></a><span id="l6.57">             let categories = item.getCategories({});</span>
<a href="#l6.58"></a><span id="l6.58">             if (displayElement(&quot;calendar-task-details-category-row&quot;, categories.length &gt; 0)) {</span>
<a href="#l6.59"></a><span id="l6.59">                 document.getElementById(&quot;calendar-task-details-category&quot;).value = categories.join(&quot;, &quot;);</span>
<a href="#l6.60"></a><span id="l6.60">             }</span>
<a href="#l6.61"></a><span id="l6.61">             document.getElementById(&quot;task-start-row&quot;).Item = item;</span>
<a href="#l6.62"></a><span id="l6.62">             document.getElementById(&quot;task-due-row&quot;).Item = item;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -756,45 +756,47 @@ var unifinderTreeView = {</span>
<a href="#l7.4"></a><span id="l7.4">     getCellValue: function(aRow, aCol) {</span>
<a href="#l7.5"></a><span id="l7.5">         return null;</span>
<a href="#l7.6"></a><span id="l7.6">     },</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">     getCellText: function(row, column) {</span>
<a href="#l7.9"></a><span id="l7.9">         let calendarEvent = this.eventArray[row];</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">         switch (column.element.getAttribute(&quot;itemproperty&quot;)) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-            case &quot;title&quot;:</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+            case &quot;title&quot;: {</span>
<a href="#l7.14"></a><span id="l7.14">                 return (calendarEvent.title ? calendarEvent.title.replace(/\n/g, &quot; &quot;) : &quot;&quot;);</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-            case &quot;startDate&quot;:</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+            }</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+            case &quot;startDate&quot;: {</span>
<a href="#l7.18"></a><span id="l7.18">                 return formatUnifinderEventDateTime(calendarEvent.startDate);</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-            case &quot;endDate&quot;:</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+            }</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+            case &quot;endDate&quot;: {</span>
<a href="#l7.23"></a><span id="l7.23">                 let eventEndDate = calendarEvent.endDate.clone();</span>
<a href="#l7.24"></a><span id="l7.24">                 // XXX reimplement</span>
<a href="#l7.25"></a><span id="l7.25">                 // let eventEndDate = getCurrentNextOrPreviousRecurrence(calendarEvent);</span>
<a href="#l7.26"></a><span id="l7.26">                 if (calendarEvent.startDate.isDate) {</span>
<a href="#l7.27"></a><span id="l7.27">                     // display enddate is ical enddate - 1</span>
<a href="#l7.28"></a><span id="l7.28">                     eventEndDate.day = eventEndDate.day - 1;</span>
<a href="#l7.29"></a><span id="l7.29">                 }</span>
<a href="#l7.30"></a><span id="l7.30">                 return formatUnifinderEventDateTime(eventEndDate);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-            case &quot;categories&quot;:</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+            }</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+            case &quot;categories&quot;: {</span>
<a href="#l7.35"></a><span id="l7.35">                 return calendarEvent.getCategories({}).join(&quot;, &quot;);</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineminus">-</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineminus">-            case &quot;location&quot;:</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+            }</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+            case &quot;location&quot;: {</span>
<a href="#l7.40"></a><span id="l7.40">                 return calendarEvent.getProperty(&quot;LOCATION&quot;);</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineminus">-            case &quot;status&quot;:</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+            }</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+            case &quot;status&quot;: {</span>
<a href="#l7.45"></a><span id="l7.45">                 return getEventStatusString(calendarEvent);</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-            case &quot;calendar&quot;:</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+            }</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+            case &quot;calendar&quot;: {</span>
<a href="#l7.50"></a><span id="l7.50">                 return calendarEvent.calendar.name;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-            default:</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+            }</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+            default: {</span>
<a href="#l7.55"></a><span id="l7.55">                 return false;</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+            }</span>
<a href="#l7.57"></a><span id="l7.57">         }</span>
<a href="#l7.58"></a><span id="l7.58">     },</span>
<a href="#l7.59"></a><span id="l7.59"> </span>
<a href="#l7.60"></a><span id="l7.60">     setTree: function(tree) {</span>
<a href="#l7.61"></a><span id="l7.61">         this.tree = tree;</span>
<a href="#l7.62"></a><span id="l7.62">     },</span>
<a href="#l7.63"></a><span id="l7.63"> </span>
<a href="#l7.64"></a><span id="l7.64">     toggleOpenState: function(aRow) {},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1118,17 +1118,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5">       &lt;handler event=&quot;keydown&quot;&gt;&lt;![CDATA[</span>
<a href="#l8.6"></a><span id="l8.6">         if (this.mIsReadOnly || this.mIsInvitation) {</span>
<a href="#l8.7"></a><span id="l8.7">             return;</span>
<a href="#l8.8"></a><span id="l8.8">         }</span>
<a href="#l8.9"></a><span id="l8.9">         if (event.originalTarget.localName == &quot;input&quot;) {</span>
<a href="#l8.10"></a><span id="l8.10">             switch (event.keyCode) {</span>
<a href="#l8.11"></a><span id="l8.11">                 case KeyEvent.DOM_VK_DELETE:</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                case KeyEvent.DOM_VK_BACK_SPACE:</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                case KeyEvent.DOM_VK_BACK_SPACE: {</span>
<a href="#l8.14"></a><span id="l8.14">                     let curRowId = this.getRowByInputElement(event.originalTarget);</span>
<a href="#l8.15"></a><span id="l8.15">                     let allSelected = (event.originalTarget.textLength ==</span>
<a href="#l8.16"></a><span id="l8.16">                                        event.originalTarget.selectionEnd -</span>
<a href="#l8.17"></a><span id="l8.17">                                        event.originalTarget.selectionStart);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">                     if (!event.originalTarget.value ||</span>
<a href="#l8.20"></a><span id="l8.20">                         event.originalTarget.textLength &lt; 2 ||</span>
<a href="#l8.21"></a><span id="l8.21">                         allSelected) {</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -1154,16 +1154,17 @@</span>
<a href="#l8.23"></a><span id="l8.23">                         if (targetRowId != curRowId) {</span>
<a href="#l8.24"></a><span id="l8.24">                             cPos = input.textLength;</span>
<a href="#l8.25"></a><span id="l8.25">                         }</span>
<a href="#l8.26"></a><span id="l8.26">                         input.setSelectionRange(cPos, cPos);</span>
<a href="#l8.27"></a><span id="l8.27">                     }</span>
<a href="#l8.28"></a><span id="l8.28"> </span>
<a href="#l8.29"></a><span id="l8.29">                     event.stopPropagation();</span>
<a href="#l8.30"></a><span id="l8.30">                     break;</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+                }</span>
<a href="#l8.32"></a><span id="l8.32">             }</span>
<a href="#l8.33"></a><span id="l8.33">         }</span>
<a href="#l8.34"></a><span id="l8.34">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">       &lt;handler event=&quot;keypress&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l8.37"></a><span id="l8.37">         // In case we're currently showing the autocompletion popup</span>
<a href="#l8.38"></a><span id="l8.38">         // don't care about keypress-events and let them go. Otherwise</span>
<a href="#l8.39"></a><span id="l8.39">         // this event indicates the user wants to travel between</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -277,118 +277,123 @@ function onSave(item) {</span>
<a href="#l9.4"></a><span id="l9.4">         recurrenceInfo.item = item;</span>
<a href="#l9.5"></a><span id="l9.5">     } else {</span>
<a href="#l9.6"></a><span id="l9.6">         recurrenceInfo = createRecurrenceInfo(item);</span>
<a href="#l9.7"></a><span id="l9.7">     }</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">     let recRule = createRecurrenceRule();</span>
<a href="#l9.10"></a><span id="l9.10">     const ALL_WEEKDAYS = [2, 3, 4, 5, 6, 7, 1]; // The sequence MO,TU,WE,TH,FR,SA,SU.</span>
<a href="#l9.11"></a><span id="l9.11">     switch (deckNumber) {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    case 0: {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-        recRule.type = &quot;DAILY&quot;;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-        let dailyGroup = document.getElementById(&quot;daily-group&quot;);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-        if (dailyGroup.selectedIndex == 0) {</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-            let ndays = Math.max(1, Number(getElementValue(&quot;daily-days&quot;)));</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-            recRule.interval = ndays;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-        } else {</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-            recRule.interval = 1;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-            let onDays = [2, 3, 4, 5, 6];</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-            recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+        case 0: {</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+            recRule.type = &quot;DAILY&quot;;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+            let dailyGroup = document.getElementById(&quot;daily-group&quot;);</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+            if (dailyGroup.selectedIndex == 0) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+                let ndays = Math.max(1, Number(getElementValue(&quot;daily-days&quot;)));</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+                recRule.interval = ndays;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+            } else {</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+                recRule.interval = 1;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+                let onDays = [2, 3, 4, 5, 6];</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+                recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+            }</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+            break;</span>
<a href="#l9.34"></a><span id="l9.34">         }</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-        break;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-    }</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-    case 1: {</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-        recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-        let ndays = Number(getElementValue(&quot;weekly-weeks&quot;));</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-        recRule.interval = ndays;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-        let onDays = document.getElementById(&quot;daypicker-weekday&quot;).days;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-        if (onDays.length &gt; 0) {</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-            recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+        case 1: {</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+            recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+            let ndays = Number(getElementValue(&quot;weekly-weeks&quot;));</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+            recRule.interval = ndays;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+            let onDays = document.getElementById(&quot;daypicker-weekday&quot;).days;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+            if (onDays.length &gt; 0) {</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+                recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+            }</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+            break;</span>
<a href="#l9.53"></a><span id="l9.53">         }</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-        break;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-    }</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-    case 2:</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-        recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-        let monthInterval = Number(getElementValue(&quot;monthly-interval&quot;));</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-        recRule.interval = monthInterval;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-        let monthlyGroup = document.getElementById(&quot;monthly-group&quot;);</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-        if (monthlyGroup.selectedIndex == 0) {</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-            let monthlyOrdinal = Number(getElementValue(&quot;monthly-monthlyOrdinal&quot;));</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-            let monthlyDOW = Number(getElementValue(&quot;monthly-weekday&quot;));</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-            if (monthlyDOW &lt; 0) {</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-                if (monthlyOrdinal == 0) {</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-                    // Monthly rule &quot;Every day of the month&quot;.</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-                    recRule.setComponent(&quot;BYDAY&quot;, 7, ALL_WEEKDAYS);</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+        case 2: {</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+            recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+            let monthInterval = Number(getElementValue(&quot;monthly-interval&quot;));</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+            recRule.interval = monthInterval;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+            let monthlyGroup = document.getElementById(&quot;monthly-group&quot;);</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+            if (monthlyGroup.selectedIndex == 0) {</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+                let monthlyOrdinal = Number(getElementValue(&quot;monthly-monthlyOrdinal&quot;));</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+                let monthlyDOW = Number(getElementValue(&quot;monthly-weekday&quot;));</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+                if (monthlyDOW &lt; 0) {</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+                    if (monthlyOrdinal == 0) {</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+                        // Monthly rule &quot;Every day of the month&quot;.</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+                        recRule.setComponent(&quot;BYDAY&quot;, 7, ALL_WEEKDAYS);</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+                    } else {</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+                        // One of the first five days or the last day of the month.</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+                        recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [monthlyOrdinal]);</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+                    }</span>
<a href="#l9.84"></a><span id="l9.84">                 } else {</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-                    // One of the first five days or the last day of the month.</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-                    recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [monthlyOrdinal]);</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+                    let sign = monthlyOrdinal &lt; 0 ? -1 : 1;</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+                    let onDays = [(Math.abs(monthlyOrdinal) * 8 + monthlyDOW) * sign];</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+                    recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.90"></a><span id="l9.90">                 }</span>
<a href="#l9.91"></a><span id="l9.91">             } else {</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-                let sign = monthlyOrdinal &lt; 0 ? -1 : 1;</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-                let onDays = [(Math.abs(monthlyOrdinal) * 8 + monthlyDOW) * sign];</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-                recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+                let monthlyDays = document.getElementById(&quot;monthly-days&quot;).days;</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+                if (monthlyDays.length &gt; 0) {</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+                    recRule.setComponent(&quot;BYMONTHDAY&quot;, monthlyDays.length, monthlyDays);</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+                }</span>
<a href="#l9.99"></a><span id="l9.99">             }</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineminus">-        } else {</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineminus">-            let monthlyDays = document.getElementById(&quot;monthly-days&quot;).days;</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineminus">-            if (monthlyDays.length &gt; 0) {</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-                recRule.setComponent(&quot;BYMONTHDAY&quot;, monthlyDays.length, monthlyDays);</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-            }</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+            break;</span>
<a href="#l9.106"></a><span id="l9.106">         }</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineminus">-        break;</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">-    case 3:</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-        recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-        let yearInterval = Number(getElementValue(&quot;yearly-interval&quot;));</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">-        recRule.interval = yearInterval;</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-        let yearlyGroup = document.getElementById(&quot;yearly-group&quot;);</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineminus">-        if (yearlyGroup.selectedIndex == 0) {</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineminus">-            let yearlyByMonth = [Number(getElementValue(&quot;yearly-month-ordinal&quot;))];</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineminus">-            recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineminus">-            let yearlyByDay = [Number(getElementValue(&quot;yearly-days&quot;))];</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-            recRule.setComponent(&quot;BYMONTHDAY&quot;, yearlyByDay.length, yearlyByDay);</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-        } else {</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineminus">-            let yearlyByMonth = [Number(getElementValue(&quot;yearly-month-rule&quot;))];</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineminus">-            recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineminus">-            let yearlyOrdinal = Number(getElementValue(&quot;yearly-ordinal&quot;));</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineminus">-            let yearlyDOW = Number(getElementValue(&quot;yearly-weekday&quot;));</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-            if (yearlyDOW &lt; 0) {</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-                if (yearlyOrdinal == 0) {</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-                    // Yearly rule &quot;Every day of a month&quot;.</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineminus">-                    recRule.setComponent(&quot;BYDAY&quot;, 7, ALL_WEEKDAYS);</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+        case 3: {</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+            recRule.type = &quot;YEARLY&quot;;</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineplus">+            let yearInterval = Number(getElementValue(&quot;yearly-interval&quot;));</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineplus">+            recRule.interval = yearInterval;</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineplus">+            let yearlyGroup = document.getElementById(&quot;yearly-group&quot;);</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+            if (yearlyGroup.selectedIndex == 0) {</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+                let yearlyByMonth = [Number(getElementValue(&quot;yearly-month-ordinal&quot;))];</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+                recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineplus">+                let yearlyByDay = [Number(getElementValue(&quot;yearly-days&quot;))];</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineplus">+                recRule.setComponent(&quot;BYMONTHDAY&quot;, yearlyByDay.length, yearlyByDay);</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineplus">+            } else {</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+                let yearlyByMonth = [Number(getElementValue(&quot;yearly-month-rule&quot;))];</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+                recRule.setComponent(&quot;BYMONTH&quot;, yearlyByMonth.length, yearlyByMonth);</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+                let yearlyOrdinal = Number(getElementValue(&quot;yearly-ordinal&quot;));</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+                let yearlyDOW = Number(getElementValue(&quot;yearly-weekday&quot;));</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineplus">+                if (yearlyDOW &lt; 0) {</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineplus">+                    if (yearlyOrdinal == 0) {</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+                        // Yearly rule &quot;Every day of a month&quot;.</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+                        recRule.setComponent(&quot;BYDAY&quot;, 7, ALL_WEEKDAYS);</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+                    } else {</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineplus">+                        // One of the first five days or the last of a month.</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineplus">+                        recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [yearlyOrdinal]);</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineplus">+                    }</span>
<a href="#l9.150"></a><span id="l9.150">                 } else {</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineminus">-                    // One of the first five days or the last of a month.</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-                    recRule.setComponent(&quot;BYMONTHDAY&quot;, 1, [yearlyOrdinal]);</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineplus">+                    let sign = yearlyOrdinal &lt; 0 ? -1 : 1;</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+                    let onDays = [(Math.abs(yearlyOrdinal) * 8 + yearlyDOW) * sign];</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineplus">+                    recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.156"></a><span id="l9.156">                 }</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-            } else {</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-                let sign = yearlyOrdinal &lt; 0 ? -1 : 1;</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineminus">-                let onDays = [(Math.abs(yearlyOrdinal) * 8 + yearlyDOW) * sign];</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineminus">-                recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l9.161"></a><span id="l9.161">             }</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+            break;</span>
<a href="#l9.163"></a><span id="l9.163">         }</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineminus">-        break;</span>
<a href="#l9.165"></a><span id="l9.165">     }</span>
<a href="#l9.166"></a><span id="l9.166"> </span>
<a href="#l9.167"></a><span id="l9.167">     // Figure out how long this event is supposed to last</span>
<a href="#l9.168"></a><span id="l9.168">     switch (document.getElementById(&quot;recurrence-duration&quot;).selectedItem.value) {</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineminus">-        case &quot;forever&quot;:</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineplus">+        case &quot;forever&quot;: {</span>
<a href="#l9.171"></a><span id="l9.171">             recRule.count = -1;</span>
<a href="#l9.172"></a><span id="l9.172">             break;</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineminus">-        case &quot;ntimes&quot;:</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+        }</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+        case &quot;ntimes&quot;: {</span>
<a href="#l9.176"></a><span id="l9.176">             recRule.count = Math.max(1, getElementValue(&quot;repeat-ntimes-count&quot;));</span>
<a href="#l9.177"></a><span id="l9.177">             break;</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineminus">-        case &quot;until&quot;:</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineplus">+        }</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineplus">+        case &quot;until&quot;: {</span>
<a href="#l9.181"></a><span id="l9.181">             let untilDate = cal.jsDateToDateTime(getElementValue(&quot;repeat-until-date&quot;), gStartTime.timezone);</span>
<a href="#l9.182"></a><span id="l9.182">             untilDate.isDate = gStartTime.isDate; // enforce same value type as DTSTART</span>
<a href="#l9.183"></a><span id="l9.183">             if (!gStartTime.isDate) {</span>
<a href="#l9.184"></a><span id="l9.184">                 // correct UNTIL to exactly match start date's hour, minute, second:</span>
<a href="#l9.185"></a><span id="l9.185">                 untilDate.hour = gStartTime.hour;</span>
<a href="#l9.186"></a><span id="l9.186">                 untilDate.minute = gStartTime.minute;</span>
<a href="#l9.187"></a><span id="l9.187">                 untilDate.second = gStartTime.second;</span>
<a href="#l9.188"></a><span id="l9.188">             }</span>
<a href="#l9.189"></a><span id="l9.189">             recRule.untilDate = untilDate;</span>
<a href="#l9.190"></a><span id="l9.190">             break;</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineplus">+        }</span>
<a href="#l9.192"></a><span id="l9.192">     }</span>
<a href="#l9.193"></a><span id="l9.193"> </span>
<a href="#l9.194"></a><span id="l9.194">     if (recRule.interval &lt; 1) {</span>
<a href="#l9.195"></a><span id="l9.195">         return null;</span>
<a href="#l9.196"></a><span id="l9.196">     }</span>
<a href="#l9.197"></a><span id="l9.197"> </span>
<a href="#l9.198"></a><span id="l9.198">     recurrenceInfo.insertRecurrenceItemAt(recRule, 0);</span>
<a href="#l9.199"></a><span id="l9.199">     return recurrenceInfo;</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineat">@@ -669,45 +674,48 @@ function updateRecurrencePattern() {</span>
<a href="#l9.201"></a><span id="l9.201">     let args = window.arguments[0];</span>
<a href="#l9.202"></a><span id="l9.202">     let item = args.calendarEvent;</span>
<a href="#l9.203"></a><span id="l9.203">     if (item.parentItem != item || gIsReadOnly) {</span>
<a href="#l9.204"></a><span id="l9.204">         return;</span>
<a href="#l9.205"></a><span id="l9.205">     }</span>
<a href="#l9.206"></a><span id="l9.206"> </span>
<a href="#l9.207"></a><span id="l9.207">     switch (Number(getElementValue(&quot;period-list&quot;))) {</span>
<a href="#l9.208"></a><span id="l9.208">         // daily</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineminus">-        case 0:</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineplus">+        case 0: {</span>
<a href="#l9.211"></a><span id="l9.211">             let dailyGroup = document.getElementById(&quot;daily-group&quot;);</span>
<a href="#l9.212"></a><span id="l9.212">             let dailyDays = document.getElementById(&quot;daily-days&quot;);</span>
<a href="#l9.213"></a><span id="l9.213">             dailyDays.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l9.214"></a><span id="l9.214">             if (dailyGroup.selectedIndex == 1) {</span>
<a href="#l9.215"></a><span id="l9.215">                 dailyDays.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.216"></a><span id="l9.216">             }</span>
<a href="#l9.217"></a><span id="l9.217">             break;</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineplus">+        }</span>
<a href="#l9.219"></a><span id="l9.219">         // weekly</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineminus">-        case 1:</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineplus">+        case 1: {</span>
<a href="#l9.222"></a><span id="l9.222">             break;</span>
<a href="#l9.223"></a><span id="l9.223" class="difflineplus">+        }</span>
<a href="#l9.224"></a><span id="l9.224">         // monthly</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineminus">-        case 2:</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineplus">+        case 2: {</span>
<a href="#l9.227"></a><span id="l9.227">             let monthlyGroup = document.getElementById(&quot;monthly-group&quot;);</span>
<a href="#l9.228"></a><span id="l9.228">             let monthlyOrdinal = document.getElementById(&quot;monthly-ordinal&quot;);</span>
<a href="#l9.229"></a><span id="l9.229">             let monthlyWeekday = document.getElementById(&quot;monthly-weekday&quot;);</span>
<a href="#l9.230"></a><span id="l9.230">             let monthlyDays = document.getElementById(&quot;monthly-days&quot;);</span>
<a href="#l9.231"></a><span id="l9.231">             monthlyOrdinal.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l9.232"></a><span id="l9.232">             monthlyWeekday.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l9.233"></a><span id="l9.233">             monthlyDays.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l9.234"></a><span id="l9.234">             if (monthlyGroup.selectedIndex == 0) {</span>
<a href="#l9.235"></a><span id="l9.235">                 monthlyDays.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.236"></a><span id="l9.236">             } else {</span>
<a href="#l9.237"></a><span id="l9.237">                 monthlyOrdinal.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.238"></a><span id="l9.238">                 monthlyWeekday.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.239"></a><span id="l9.239">             }</span>
<a href="#l9.240"></a><span id="l9.240">             break;</span>
<a href="#l9.241"></a><span id="l9.241" class="difflineplus">+        }</span>
<a href="#l9.242"></a><span id="l9.242">         // yearly</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineminus">-        case 3:</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineplus">+        case 3: {</span>
<a href="#l9.245"></a><span id="l9.245">             let yearlyGroup = document.getElementById(&quot;yearly-group&quot;);</span>
<a href="#l9.246"></a><span id="l9.246">             let yearlyDays = document.getElementById(&quot;yearly-days&quot;);</span>
<a href="#l9.247"></a><span id="l9.247">             let yearlyMonthOrdinal = document.getElementById(&quot;yearly-month-ordinal&quot;);</span>
<a href="#l9.248"></a><span id="l9.248">             let yearlyPeriodOfMonthLabel = document.getElementById(&quot;yearly-period-of-month-label&quot;);</span>
<a href="#l9.249"></a><span id="l9.249">             let yearlyOrdinal = document.getElementById(&quot;yearly-ordinal&quot;);</span>
<a href="#l9.250"></a><span id="l9.250">             let yearlyWeekday = document.getElementById(&quot;yearly-weekday&quot;);</span>
<a href="#l9.251"></a><span id="l9.251">             let yearlyMonthRule = document.getElementById(&quot;yearly-month-rule&quot;);</span>
<a href="#l9.252"></a><span id="l9.252">             let yearlyPeriodOfLabel = document.getElementById(&quot;yearly-period-of-label&quot;);</span>
<a href="#l9.253"></a><span id="l9.253" class="difflineat">@@ -724,16 +732,17 @@ function updateRecurrencePattern() {</span>
<a href="#l9.254"></a><span id="l9.254">                 yearlyMonthRule.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.255"></a><span id="l9.255">                 yearlyPeriodOfLabel.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.256"></a><span id="l9.256">             } else {</span>
<a href="#l9.257"></a><span id="l9.257">                 yearlyDays.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.258"></a><span id="l9.258">                 yearlyMonthOrdinal.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.259"></a><span id="l9.259">                 yearlyPeriodOfMonthLabel.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l9.260"></a><span id="l9.260">             }</span>
<a href="#l9.261"></a><span id="l9.261">             break;</span>
<a href="#l9.262"></a><span id="l9.262" class="difflineplus">+        }</span>
<a href="#l9.263"></a><span id="l9.263">     }</span>
<a href="#l9.264"></a><span id="l9.264"> }</span>
<a href="#l9.265"></a><span id="l9.265"> </span>
<a href="#l9.266"></a><span id="l9.266"> /**</span>
<a href="#l9.267"></a><span id="l9.267">  * This function changes the order for certain elements using a locale string.</span>
<a href="#l9.268"></a><span id="l9.268">  * This is needed for some locales that expect a different wording order.</span>
<a href="#l9.269"></a><span id="l9.269">  *</span>
<a href="#l9.270"></a><span id="l9.270">  * @param aPropKey      The locale property key to get the order from</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -80,63 +80,67 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l10.4"></a><span id="l10.4">     settings.end = null;</span>
<a href="#l10.5"></a><span id="l10.5">     settings.eventList = [];</span>
<a href="#l10.6"></a><span id="l10.6">     settings.printEvents = document.getElementById(&quot;events&quot;).checked;</span>
<a href="#l10.7"></a><span id="l10.7">     settings.printTasks = document.getElementById(&quot;tasks&quot;).checked;</span>
<a href="#l10.8"></a><span id="l10.8">     settings.printCompletedTasks = document.getElementById(&quot;completed-tasks&quot;).checked;</span>
<a href="#l10.9"></a><span id="l10.9">     settings.printTasksWithNoDueDate = document.getElementById(&quot;tasks-with-no-due-date&quot;).checked;</span>
<a href="#l10.10"></a><span id="l10.10">     let theView = getCalendarView();</span>
<a href="#l10.11"></a><span id="l10.11">     switch (document.getElementById(&quot;view-field&quot;).selectedItem.value) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    case &quot;currentView&quot;:</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-    case &quot;&quot;: // just in case</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-        settings.start = theView.startDay.clone();</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-        settings.end = theView.endDay.clone();</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-        settings.end.day += 1;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-        settings.start.isDate = false;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-        settings.end.isDate = false;</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-        break;</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-    case &quot;selected&quot;: {</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-        let selectedItems = theView.getSelectedItems({});</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-        settings.eventList = selectedItems.filter((item) =&gt; {</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-            if (cal.isEvent(item) &amp;&amp; !settings.printEvents) {</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-                return false;</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-            }</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-            if (cal.isToDo(item) &amp;&amp; !settings.printTasks) {</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-                return false;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-            }</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-            return true;</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-        });</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+        case &quot;currentView&quot;:</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+        case &quot;&quot;: { // just in case</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+            settings.start = theView.startDay.clone();</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+            settings.end = theView.endDay.clone();</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+            settings.end.day += 1;</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+            settings.start.isDate = false;</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+            settings.end.isDate = false;</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+            break;</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+        }</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+        case &quot;selected&quot;: {</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+            let selectedItems = theView.getSelectedItems({});</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+            settings.eventList = selectedItems.filter((item) =&gt; {</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+                if (cal.isEvent(item) &amp;&amp; !settings.printEvents) {</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+                    return false;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+                }</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+                if (cal.isToDo(item) &amp;&amp; !settings.printTasks) {</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+                    return false;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+                }</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+                return true;</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+            });</span>
<a href="#l10.51"></a><span id="l10.51"> </span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-        // If tasks should be printed, also include selected tasks from the</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-        // opening window.</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-        if (settings.printTasks) {</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-            let selectedTasks = window.opener.getSelectedTasks();</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-            for (let task of selectedTasks) {</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-                settings.eventList.push(task);</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+            // If tasks should be printed, also include selected tasks from the</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+            // opening window.</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+            if (settings.printTasks) {</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+                let selectedTasks = window.opener.getSelectedTasks();</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+                for (let task of selectedTasks) {</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+                    settings.eventList.push(task);</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+                }</span>
<a href="#l10.65"></a><span id="l10.65">             }</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-        }</span>
<a href="#l10.67"></a><span id="l10.67"> </span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-        // We've set the event list above, no need to fetch items below.</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-        requiresFetch = false;</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-        break;</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-    }</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-    case &quot;custom&quot;:</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-        // We return the time from the timepickers using the selected</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-        // timezone, as not doing so in timezones with a positive offset</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-        // from UTC may cause the printout to include the wrong days.</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-        let currentTimezone = cal.calendarDefaultTimezone();</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-        settings.start = cal.jsDateToDateTime(document.getElementById(&quot;start-date-picker&quot;).value);</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-        settings.start = settings.start.getInTimezone(currentTimezone);</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-        settings.end = cal.jsDateToDateTime(document.getElementById(&quot;end-date-picker&quot;).value);</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-        settings.end = settings.end.getInTimezone(currentTimezone);</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-        settings.end = settings.end.clone();</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-        settings.end.day += 1;</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-        break;</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-    default:</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-        dump(&quot;Error : no case in printDialog.js::printCalendar()&quot;);</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+            // We've set the event list above, no need to fetch items below.</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+            requiresFetch = false;</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+            break;</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+        }</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+        case &quot;custom&quot;: {</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+            // We return the time from the timepickers using the selected</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+            // timezone, as not doing so in timezones with a positive offset</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+            // from UTC may cause the printout to include the wrong days.</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+            let currentTimezone = cal.calendarDefaultTimezone();</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+            settings.start = cal.jsDateToDateTime(document.getElementById(&quot;start-date-picker&quot;).value);</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+            settings.start = settings.start.getInTimezone(currentTimezone);</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+            settings.end = cal.jsDateToDateTime(document.getElementById(&quot;end-date-picker&quot;).value);</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+            settings.end = settings.end.getInTimezone(currentTimezone);</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+            settings.end = settings.end.clone();</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+            settings.end.day += 1;</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+            break;</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+        }</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+        default: {</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+            dump(&quot;Error : no case in printDialog.js::printCalendar()&quot;);</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+            break;</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+        }</span>
<a href="#l10.107"></a><span id="l10.107">     }</span>
<a href="#l10.108"></a><span id="l10.108"> </span>
<a href="#l10.109"></a><span id="l10.109">     // Some filters above might have filled the events list themselves. If not,</span>
<a href="#l10.110"></a><span id="l10.110">     // then fetch the items here.</span>
<a href="#l10.111"></a><span id="l10.111">     if (requiresFetch) {</span>
<a href="#l10.112"></a><span id="l10.112">         let listener = {</span>
<a href="#l10.113"></a><span id="l10.113">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l10.114"></a><span id="l10.114">             onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -245,30 +245,33 @@</span>
<a href="#l11.4"></a><span id="l11.4">          &lt;parameter name=&quot;direction&quot;/&gt;</span>
<a href="#l11.5"></a><span id="l11.5">          &lt;parameter name=&quot;scrollOffset&quot;/&gt;</span>
<a href="#l11.6"></a><span id="l11.6">          &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.7"></a><span id="l11.7">            // Update the year popup</span>
<a href="#l11.8"></a><span id="l11.8">            let years = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;years-popup&quot;).firstChild.childNodes;</span>
<a href="#l11.9"></a><span id="l11.9">            let current = this.getAttribute(&quot;year&quot;);</span>
<a href="#l11.10"></a><span id="l11.10">            let offset;</span>
<a href="#l11.11"></a><span id="l11.11">            switch (direction) {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-               case &quot;reset&quot;:</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+               case &quot;reset&quot;: {</span>
<a href="#l11.14"></a><span id="l11.14">                    let middleyear = years[Math.floor(years.length / 2)].getAttribute(&quot;value&quot;);</span>
<a href="#l11.15"></a><span id="l11.15">                    if (current &lt;= (years.length / 2)) {</span>
<a href="#l11.16"></a><span id="l11.16">                        offset = 1 - years[1].getAttribute(&quot;value&quot;);</span>
<a href="#l11.17"></a><span id="l11.17">                    } else {</span>
<a href="#l11.18"></a><span id="l11.18">                        offset = current - middleyear;</span>
<a href="#l11.19"></a><span id="l11.19">                    }</span>
<a href="#l11.20"></a><span id="l11.20">                    break;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">-               case &quot;up&quot;:</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+               }</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+               case &quot;up&quot;: {</span>
<a href="#l11.24"></a><span id="l11.24">                    offset = -Math.abs(scrollOffset) || -1;</span>
<a href="#l11.25"></a><span id="l11.25">                    break;</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-               case &quot;down&quot;:</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+               }</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+               case &quot;down&quot;: {</span>
<a href="#l11.29"></a><span id="l11.29">                    offset = Math.abs(scrollOffset) || 1;</span>
<a href="#l11.30"></a><span id="l11.30">                    break;</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+               }</span>
<a href="#l11.32"></a><span id="l11.32">            }</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34">            // Disable the up arrow when we get to the year 1.</span>
<a href="#l11.35"></a><span id="l11.35">            years[0].disabled = (parseInt(years[1].getAttribute(&quot;value&quot;), 10) + offset &lt; 2);</span>
<a href="#l11.36"></a><span id="l11.36"> </span>
<a href="#l11.37"></a><span id="l11.37">            if (!offset) {</span>
<a href="#l11.38"></a><span id="l11.38">                // No need to loop through when the offset is zero.</span>
<a href="#l11.39"></a><span id="l11.39">                return;</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineat">@@ -290,27 +293,29 @@</span>
<a href="#l11.41"></a><span id="l11.41">       &lt;!-- handle click from nested months popup and years popup --&gt;</span>
<a href="#l11.42"></a><span id="l11.42">       &lt;handler event=&quot;click&quot;&gt;</span>
<a href="#l11.43"></a><span id="l11.43">         &lt;![CDATA[</span>
<a href="#l11.44"></a><span id="l11.44">           let element = event.originalTarget;</span>
<a href="#l11.45"></a><span id="l11.45">           let popup = getParentNodeOrThis(element, &quot;menupopup&quot;);</span>
<a href="#l11.46"></a><span id="l11.46">           if (popup) {</span>
<a href="#l11.47"></a><span id="l11.47">               let anonid = popup.getAttribute(&quot;anonid&quot;);</span>
<a href="#l11.48"></a><span id="l11.48">               switch (anonid) {</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-                  case &quot;months-popup&quot;:</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+                  case &quot;months-popup&quot;: {</span>
<a href="#l11.51"></a><span id="l11.51">                       this.hidePopupList();</span>
<a href="#l11.52"></a><span id="l11.52">                       this.kMinimonth.switchMonth(element.getAttribute(&quot;index&quot;));</span>
<a href="#l11.53"></a><span id="l11.53">                       break;</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-                  case &quot;years-popup&quot;:</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+                  }</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+                  case &quot;years-popup&quot;: {</span>
<a href="#l11.57"></a><span id="l11.57">                       this.hidePopupList();</span>
<a href="#l11.58"></a><span id="l11.58">                       let value = element.getAttribute(&quot;value&quot;);</span>
<a href="#l11.59"></a><span id="l11.59">                       if (value) {</span>
<a href="#l11.60"></a><span id="l11.60">                           this.kMinimonth.switchYear(value);</span>
<a href="#l11.61"></a><span id="l11.61">                       }</span>
<a href="#l11.62"></a><span id="l11.62">                       break;</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+                  }</span>
<a href="#l11.64"></a><span id="l11.64">               }</span>
<a href="#l11.65"></a><span id="l11.65">           }</span>
<a href="#l11.66"></a><span id="l11.66">         ]]&gt;</span>
<a href="#l11.67"></a><span id="l11.67">       &lt;/handler&gt;</span>
<a href="#l11.68"></a><span id="l11.68">     &lt;/handlers&gt;</span>
<a href="#l11.69"></a><span id="l11.69">   &lt;/binding&gt;</span>
<a href="#l11.70"></a><span id="l11.70"> </span>
<a href="#l11.71"></a><span id="l11.71">   &lt;binding id=&quot;minimonth&quot; extends=&quot;xul:box&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -188,30 +188,33 @@ calCachedCalendar.prototype = {</span>
<a href="#l12.4"></a><span id="l12.4">                 let calType = Preferences.get(&quot;calendar.cache.type&quot;, &quot;storage&quot;);</span>
<a href="#l12.5"></a><span id="l12.5">                 // While technically, the above deleteCalendar should delete the</span>
<a href="#l12.6"></a><span id="l12.6">                 // whole calendar, this is nothing more than deleting all events</span>
<a href="#l12.7"></a><span id="l12.7">                 // todos and properties. Therefore the initialization can be</span>
<a href="#l12.8"></a><span id="l12.8">                 // skipped.</span>
<a href="#l12.9"></a><span id="l12.9">                 let cachedCalendar = Components.classes[&quot;@mozilla.org/calendar/calendar;1?type=&quot; + calType]</span>
<a href="#l12.10"></a><span id="l12.10">                                                .createInstance(Components.interfaces.calICalendar);</span>
<a href="#l12.11"></a><span id="l12.11">                 switch (calType) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-                    case &quot;memory&quot;:</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                    case &quot;memory&quot;: {</span>
<a href="#l12.14"></a><span id="l12.14">                         if (this.supportsChangeLog) {</span>
<a href="#l12.15"></a><span id="l12.15">                             // start with full sync:</span>
<a href="#l12.16"></a><span id="l12.16">                             this.mUncachedCalendar.resetLog();</span>
<a href="#l12.17"></a><span id="l12.17">                         }</span>
<a href="#l12.18"></a><span id="l12.18">                         break;</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-                    case &quot;storage&quot;:</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+                    }</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+                    case &quot;storage&quot;: {</span>
<a href="#l12.22"></a><span id="l12.22">                         let file = getCalendarDirectory();</span>
<a href="#l12.23"></a><span id="l12.23">                         file.append(&quot;cache.sqlite&quot;);</span>
<a href="#l12.24"></a><span id="l12.24">                         cachedCalendar.uri = Services.io.newFileURI(file);</span>
<a href="#l12.25"></a><span id="l12.25">                         cachedCalendar.id = this.id;</span>
<a href="#l12.26"></a><span id="l12.26">                         break;</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-                    default:</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+                    }</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+                    default: {</span>
<a href="#l12.30"></a><span id="l12.30">                         throw new Error(&quot;unsupported cache calendar type: &quot; + calType);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+                    }</span>
<a href="#l12.32"></a><span id="l12.32">                 }</span>
<a href="#l12.33"></a><span id="l12.33">                 cachedCalendar.transientProperties = true;</span>
<a href="#l12.34"></a><span id="l12.34">                 cachedCalendar.setProperty(&quot;relaxedMode&quot;, true);</span>
<a href="#l12.35"></a><span id="l12.35">                 cachedCalendar.superCalendar = this;</span>
<a href="#l12.36"></a><span id="l12.36">                 if (!this.mCachedObserver) {</span>
<a href="#l12.37"></a><span id="l12.37">                     this.mCachedObserver = new calCachedCalendarObserverHelper(this, true);</span>
<a href="#l12.38"></a><span id="l12.38">                 }</span>
<a href="#l12.39"></a><span id="l12.39">                 cachedCalendar.addObserver(this.mCachedObserver);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -91,33 +91,35 @@ calCalendarManager.prototype = {</span>
<a href="#l13.4"></a><span id="l13.4">     },</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6">     cleanupOfflineObservers: function() {</span>
<a href="#l13.7"></a><span id="l13.7">         Services.obs.removeObserver(this, &quot;network:offline-status-changed&quot;);</span>
<a href="#l13.8"></a><span id="l13.8">     },</span>
<a href="#l13.9"></a><span id="l13.9"> </span>
<a href="#l13.10"></a><span id="l13.10">     observe: function(aSubject, aTopic, aData) {</span>
<a href="#l13.11"></a><span id="l13.11">         switch (aTopic) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            case &quot;timer-callback&quot;:</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+            case &quot;timer-callback&quot;: {</span>
<a href="#l13.14"></a><span id="l13.14">                 // Refresh all the calendars that can be refreshed.</span>
<a href="#l13.15"></a><span id="l13.15">                 for (let calendar of this.getCalendars({})) {</span>
<a href="#l13.16"></a><span id="l13.16">                     if (!calendar.getProperty(&quot;disabled&quot;) &amp;&amp; calendar.canRefresh) {</span>
<a href="#l13.17"></a><span id="l13.17">                         calendar.refresh();</span>
<a href="#l13.18"></a><span id="l13.18">                     }</span>
<a href="#l13.19"></a><span id="l13.19">                 }</span>
<a href="#l13.20"></a><span id="l13.20">                 break;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-            case &quot;network:offline-status-changed&quot;:</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+            }</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+            case &quot;network:offline-status-changed&quot;: {</span>
<a href="#l13.24"></a><span id="l13.24">                 for (let id in this.mCache) {</span>
<a href="#l13.25"></a><span id="l13.25">                     let calendar = this.mCache[id];</span>
<a href="#l13.26"></a><span id="l13.26">                     if (calendar instanceof calCachedCalendar) {</span>
<a href="#l13.27"></a><span id="l13.27">                         calendar.onOfflineStatusChanged(aData == &quot;offline&quot;);</span>
<a href="#l13.28"></a><span id="l13.28">                     }</span>
<a href="#l13.29"></a><span id="l13.29">                 }</span>
<a href="#l13.30"></a><span id="l13.30">                 break;</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-            case &quot;http-on-examine-response&quot;:</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+            }</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+            case &quot;http-on-examine-response&quot;: {</span>
<a href="#l13.34"></a><span id="l13.34">                 try {</span>
<a href="#l13.35"></a><span id="l13.35">                     let channel = aSubject.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l13.36"></a><span id="l13.36">                     if (channel.notificationCallbacks) {</span>
<a href="#l13.37"></a><span id="l13.37">                         // We use the notification callbacks to get the calendar interface,</span>
<a href="#l13.38"></a><span id="l13.38">                         // which likely works for our requests since getInterface is called</span>
<a href="#l13.39"></a><span id="l13.39">                         // from the calendar provider context.</span>
<a href="#l13.40"></a><span id="l13.40">                         let authHeader = channel.getResponseHeader(&quot;WWW-Authenticate&quot;);</span>
<a href="#l13.41"></a><span id="l13.41">                         let calendar = channel.notificationCallbacks</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineat">@@ -138,17 +140,18 @@ calCalendarManager.prototype = {</span>
<a href="#l13.43"></a><span id="l13.43">                         throw e;</span>
<a href="#l13.44"></a><span id="l13.44">                     }</span>
<a href="#l13.45"></a><span id="l13.45">                     // Possible reasons we got here:</span>
<a href="#l13.46"></a><span id="l13.46">                     // - Its not a http channel (wtf? Oh well)</span>
<a href="#l13.47"></a><span id="l13.47">                     // - The owner is not a calICalendar (looks like its not our deal)</span>
<a href="#l13.48"></a><span id="l13.48">                     // - The WWW-Authenticate header is missing (thats ok)</span>
<a href="#l13.49"></a><span id="l13.49">                 }</span>
<a href="#l13.50"></a><span id="l13.50">                 break;</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-            case &quot;http-on-modify-request&quot;:</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+            }</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+            case &quot;http-on-modify-request&quot;: {</span>
<a href="#l13.54"></a><span id="l13.54">                 // Unfortunately, the ability to do this with a general pref has</span>
<a href="#l13.55"></a><span id="l13.55">                 // been removed. Calendar servers might still want to know what</span>
<a href="#l13.56"></a><span id="l13.56">                 // client is used for access, so add our UA String to each</span>
<a href="#l13.57"></a><span id="l13.57">                 // request.</span>
<a href="#l13.58"></a><span id="l13.58">                 let httpChannel = aSubject.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l13.59"></a><span id="l13.59">                 try {</span>
<a href="#l13.60"></a><span id="l13.60">                     // NOTE: For some reason, this observer call doesn't have</span>
<a href="#l13.61"></a><span id="l13.61">                     // the &quot;cal&quot; namespace defined</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineat">@@ -166,16 +169,17 @@ calCalendarManager.prototype = {</span>
<a href="#l13.63"></a><span id="l13.63">                 } catch (e) {</span>
<a href="#l13.64"></a><span id="l13.64">                     if (e.result != Components.results.NS_ERROR_NOT_AVAILABLE) {</span>
<a href="#l13.65"></a><span id="l13.65">                         throw e;</span>
<a href="#l13.66"></a><span id="l13.66">                     }</span>
<a href="#l13.67"></a><span id="l13.67">                     // We swallow this error since it means the User Agent</span>
<a href="#l13.68"></a><span id="l13.68">                     // header is not set. We don't want to force it to be set.</span>
<a href="#l13.69"></a><span id="l13.69">                 }</span>
<a href="#l13.70"></a><span id="l13.70">                 break;</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+            }</span>
<a href="#l13.72"></a><span id="l13.72">         }</span>
<a href="#l13.73"></a><span id="l13.73">     },</span>
<a href="#l13.74"></a><span id="l13.74"> </span>
<a href="#l13.75"></a><span id="l13.75">     //</span>
<a href="#l13.76"></a><span id="l13.76">     // DB migration code begins here</span>
<a href="#l13.77"></a><span id="l13.77">     //</span>
<a href="#l13.78"></a><span id="l13.78"> </span>
<a href="#l13.79"></a><span id="l13.79">     upgradeDB: function(oldVersion, db) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -756,57 +756,60 @@ function guessSystemTimezone() {</span>
<a href="#l14.4"></a><span id="l14.4">             let msg = &quot;ics-service doesn't recognize own tzid: &quot; + tzId + &quot;\n&quot; + ex;</span>
<a href="#l14.5"></a><span id="l14.5">             Components.utils.reportError(msg);</span>
<a href="#l14.6"></a><span id="l14.6">         }</span>
<a href="#l14.7"></a><span id="l14.7">     }</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">     // If reach here, there were no score=3 matches, so Warn in console.</span>
<a href="#l14.10"></a><span id="l14.10">     try {</span>
<a href="#l14.11"></a><span id="l14.11">         switch (probableTZScore) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        case 0:</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-            cal.WARN(calProperties.GetStringFromName(&quot;warningUsingFloatingTZNoMatch&quot;));</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-            break;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-        case 1: case 2:</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineminus">-            let tzId = probableTZId;</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineminus">-            let timezone = tzSvc.getTimezone(tzId);</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-            let subComp = timezone.icalComponent;</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-            let standard = findCurrentTimePeriod(timezone, subComp, &quot;STANDARD&quot;);</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-            let standardTZOffset = getIcalString(standard, &quot;TZOFFSETTO&quot;);</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-            let daylight = findCurrentTimePeriod(timezone, subComp, &quot;DAYLIGHT&quot;);</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-            let daylightTZOffset = getIcalString(daylight, &quot;TZOFFSETTO&quot;);</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-            let warningDetail;</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-            if (probableTZScore == 1) {</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-                // score 1 means has daylight time,</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-                // but transitions start on different weekday from os timezone.</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-                let standardStart = getIcalString(standard, &quot;DTSTART&quot;);</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-                let standardStartWeekday = weekday(standardStart, timezone);</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-                let standardRule = getIcalString(standard, &quot;RRULE&quot;);</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-                let standardText =</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-                    &quot;  Standard: &quot; + standardStart + &quot; &quot; + standardStartWeekday + &quot;\n&quot; +</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-                    &quot;            &quot; + standardRule + &quot;\n&quot;;</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-                let daylightStart = getIcalString(daylight, &quot;DTSTART&quot;);</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-                let daylightStartWeekday = weekday(daylightStart, timezone);</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-                let daylightRule = getIcalString(daylight, &quot;RRULE&quot;);</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-                let daylightText =</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-                    &quot;  Daylight: &quot; + daylightStart + &quot; &quot; + daylightStartWeekday + &quot;\n&quot; +</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-                    &quot;            &quot; + daylightRule + &quot;\n&quot;;</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-                warningDetail =</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-                    (standardStart &lt; daylightStart</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-                      ? standardText + daylightText</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-                      : daylightText + standardText) +</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineminus">-                     calProperties.GetStringFromName(&quot;TZAlmostMatchesOSDifferAtMostAWeek&quot;);</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-            } else {</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineminus">-                warningDetail = calProperties.GetStringFromName(&quot;TZSeemsToMatchOS&quot;);</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+            case 0: {</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+                cal.WARN(calProperties.GetStringFromName(&quot;warningUsingFloatingTZNoMatch&quot;));</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+                break;</span>
<a href="#l14.49"></a><span id="l14.49">             }</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-            let offsetString = standardTZOffset +</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-                                 (daylightTZOffset ? &quot;/&quot; + daylightTZOffset : &quot;&quot;);</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-            let warningMsg = calProperties.formatStringFromName(&quot;WarningUsingGuessedTZ&quot;,</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-                              [tzId, offsetString, warningDetail, probableTZSource], 4);</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-            cal.WARN(warningMsg);</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineminus">-            break;</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+            case 1:</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+            case 2: {</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+                let tzId = probableTZId;</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+                let timezone = tzSvc.getTimezone(tzId);</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+                let subComp = timezone.icalComponent;</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+                let standard = findCurrentTimePeriod(timezone, subComp, &quot;STANDARD&quot;);</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+                let standardTZOffset = getIcalString(standard, &quot;TZOFFSETTO&quot;);</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+                let daylight = findCurrentTimePeriod(timezone, subComp, &quot;DAYLIGHT&quot;);</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+                let daylightTZOffset = getIcalString(daylight, &quot;TZOFFSETTO&quot;);</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+                let warningDetail;</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+                if (probableTZScore == 1) {</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+                    // score 1 means has daylight time,</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+                    // but transitions start on different weekday from os timezone.</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+                    let standardStart = getIcalString(standard, &quot;DTSTART&quot;);</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+                    let standardStartWeekday = weekday(standardStart, timezone);</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+                    let standardRule = getIcalString(standard, &quot;RRULE&quot;);</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+                    let standardText =</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+                        &quot;  Standard: &quot; + standardStart + &quot; &quot; + standardStartWeekday + &quot;\n&quot; +</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+                        &quot;            &quot; + standardRule + &quot;\n&quot;;</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+                    let daylightStart = getIcalString(daylight, &quot;DTSTART&quot;);</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+                    let daylightStartWeekday = weekday(daylightStart, timezone);</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+                    let daylightRule = getIcalString(daylight, &quot;RRULE&quot;);</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+                    let daylightText =</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+                        &quot;  Daylight: &quot; + daylightStart + &quot; &quot; + daylightStartWeekday + &quot;\n&quot; +</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+                        &quot;            &quot; + daylightRule + &quot;\n&quot;;</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+                    warningDetail =</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+                        (standardStart &lt; daylightStart</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+                          ? standardText + daylightText</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+                          : daylightText + standardText) +</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+                         calProperties.GetStringFromName(&quot;TZAlmostMatchesOSDifferAtMostAWeek&quot;);</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+                } else {</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+                    warningDetail = calProperties.GetStringFromName(&quot;TZSeemsToMatchOS&quot;);</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+                }</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+                let offsetString = standardTZOffset +</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+                                     (daylightTZOffset ? &quot;/&quot; + daylightTZOffset : &quot;&quot;);</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+                let warningMsg = calProperties.formatStringFromName(&quot;WarningUsingGuessedTZ&quot;,</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+                                  [tzId, offsetString, warningDetail, probableTZSource], 4);</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+                cal.WARN(warningMsg);</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+                break;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+            }</span>
<a href="#l14.96"></a><span id="l14.96">         }</span>
<a href="#l14.97"></a><span id="l14.97">     } catch (ex) { // don't abort if error occurs warning user</span>
<a href="#l14.98"></a><span id="l14.98">         Components.utils.reportError(ex);</span>
<a href="#l14.99"></a><span id="l14.99">     }</span>
<a href="#l14.100"></a><span id="l14.100"> </span>
<a href="#l14.101"></a><span id="l14.101">     // return the guessed timezone</span>
<a href="#l14.102"></a><span id="l14.102">     return probableTZId;</span>
<a href="#l14.103"></a><span id="l14.103"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/itip/calItipEmailTransport.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/itip/calItipEmailTransport.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -65,17 +65,17 @@ calItipEmailTransport.prototype = {</span>
<a href="#l15.4"></a><span id="l15.4">         // Get ourselves some default text - when we handle organizer properly</span>
<a href="#l15.5"></a><span id="l15.5">         // We'll need a way to configure the Common Name attribute and we should</span>
<a href="#l15.6"></a><span id="l15.6">         // use it here rather than the email address</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">         let summary = item.getProperty(&quot;SUMMARY&quot;) || &quot;&quot;;</span>
<a href="#l15.9"></a><span id="l15.9">         let subject = &quot;&quot;;</span>
<a href="#l15.10"></a><span id="l15.10">         let body = &quot;&quot;;</span>
<a href="#l15.11"></a><span id="l15.11">         switch (aItipItem.responseMethod) {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-            case &quot;REQUEST&quot;:</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+            case &quot;REQUEST&quot;: {</span>
<a href="#l15.14"></a><span id="l15.14">                 let usePrefixes = Preferences.get(</span>
<a href="#l15.15"></a><span id="l15.15">                     &quot;calendar.itip.useInvitationSubjectPrefixes&quot;,</span>
<a href="#l15.16"></a><span id="l15.16">                     true</span>
<a href="#l15.17"></a><span id="l15.17">                 );</span>
<a href="#l15.18"></a><span id="l15.18">                 if (usePrefixes) {</span>
<a href="#l15.19"></a><span id="l15.19">                     let seq = item.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l15.20"></a><span id="l15.20">                     let subjectKey = seq &amp;&amp; seq &gt; 0</span>
<a href="#l15.21"></a><span id="l15.21">                         ? &quot;itipRequestUpdatedSubject&quot;</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -91,30 +91,32 @@ calItipEmailTransport.prototype = {</span>
<a href="#l15.23"></a><span id="l15.23">                 }</span>
<a href="#l15.24"></a><span id="l15.24">                 body = cal.calGetString(</span>
<a href="#l15.25"></a><span id="l15.25">                     &quot;lightning&quot;,</span>
<a href="#l15.26"></a><span id="l15.26">                     &quot;itipRequestBody&quot;,</span>
<a href="#l15.27"></a><span id="l15.27">                     [item.organizer ? item.organizer.toString() : &quot;&quot;, summary],</span>
<a href="#l15.28"></a><span id="l15.28">                     &quot;lightning&quot;</span>
<a href="#l15.29"></a><span id="l15.29">                 );</span>
<a href="#l15.30"></a><span id="l15.30">                 break;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-            case &quot;CANCEL&quot;:</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+            }</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+            case &quot;CANCEL&quot;: {</span>
<a href="#l15.34"></a><span id="l15.34">                 subject = cal.calGetString(</span>
<a href="#l15.35"></a><span id="l15.35">                     &quot;lightning&quot;,</span>
<a href="#l15.36"></a><span id="l15.36">                     &quot;itipCancelSubject&quot;,</span>
<a href="#l15.37"></a><span id="l15.37">                     [summary],</span>
<a href="#l15.38"></a><span id="l15.38">                     &quot;lightning&quot;</span>
<a href="#l15.39"></a><span id="l15.39">                 );</span>
<a href="#l15.40"></a><span id="l15.40">                 body = cal.calGetString(</span>
<a href="#l15.41"></a><span id="l15.41">                     &quot;lightning&quot;,</span>
<a href="#l15.42"></a><span id="l15.42">                     &quot;itipCancelBody&quot;,</span>
<a href="#l15.43"></a><span id="l15.43">                     [item.organizer ? item.organizer.toString() : &quot;&quot;, summary],</span>
<a href="#l15.44"></a><span id="l15.44">                     &quot;lightning&quot;</span>
<a href="#l15.45"></a><span id="l15.45">                 );</span>
<a href="#l15.46"></a><span id="l15.46">                 break;</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+            }</span>
<a href="#l15.48"></a><span id="l15.48">             case &quot;REPLY&quot;: {</span>
<a href="#l15.49"></a><span id="l15.49">                 // Get my participation status</span>
<a href="#l15.50"></a><span id="l15.50">                 let att = cal.getInvitedAttendee(item, aItipItem.targetCalendar);</span>
<a href="#l15.51"></a><span id="l15.51">                 if (!att &amp;&amp; aItipItem.identity) {</span>
<a href="#l15.52"></a><span id="l15.52">                     att = item.getAttendeeById(&quot;mailto:&quot; + aItipItem.identity);</span>
<a href="#l15.53"></a><span id="l15.53">                 }</span>
<a href="#l15.54"></a><span id="l15.54">                 if (!att) { // should not happen anymore</span>
<a href="#l15.55"></a><span id="l15.55">                     return false;</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineat">@@ -310,26 +312,28 @@ calItipEmailTransport.prototype = {</span>
<a href="#l15.57"></a><span id="l15.57">                                             null  /* nsIMsgDBHdr msgToReplace */,</span>
<a href="#l15.58"></a><span id="l15.58">                                             null  /* nsIMsgSendListener aListener */,</span>
<a href="#l15.59"></a><span id="l15.59">                                             null  /* nsIMsgStatusFeedback aStatusFeedback */,</span>
<a href="#l15.60"></a><span id="l15.60">                                             &quot;&quot;    /* password */);</span>
<a href="#l15.61"></a><span id="l15.61">                     return true;</span>
<a href="#l15.62"></a><span id="l15.62">                 }</span>
<a href="#l15.63"></a><span id="l15.63">                 break;</span>
<a href="#l15.64"></a><span id="l15.64">             }</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-            case Components.interfaces.calIItipItem.NONE:</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+            case Components.interfaces.calIItipItem.NONE: {</span>
<a href="#l15.67"></a><span id="l15.67">                 cal.LOG(&quot;sendXpcomMail: Found NONE autoResponse type.&quot;);</span>
<a href="#l15.68"></a><span id="l15.68"> </span>
<a href="#l15.69"></a><span id="l15.69">                 // No response</span>
<a href="#l15.70"></a><span id="l15.70">                 break;</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-            default:</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineplus">+            }</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+            default: {</span>
<a href="#l15.74"></a><span id="l15.74">                 // Unknown autoResponse type</span>
<a href="#l15.75"></a><span id="l15.75">                 throw new Error(&quot;sendXpcomMail: &quot; +</span>
<a href="#l15.76"></a><span id="l15.76">                                 &quot;Unknown autoResponse type: &quot; +</span>
<a href="#l15.77"></a><span id="l15.77">                                 aItem.autoResponse);</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+            }</span>
<a href="#l15.79"></a><span id="l15.79">         }</span>
<a href="#l15.80"></a><span id="l15.80">         return false;</span>
<a href="#l15.81"></a><span id="l15.81">     },</span>
<a href="#l15.82"></a><span id="l15.82"> </span>
<a href="#l15.83"></a><span id="l15.83">     _createTempImipFile: function(compatMode, aToList, aSubject, aBody, aItem, aIdentity, aMessageId) {</span>
<a href="#l15.84"></a><span id="l15.84">         try {</span>
<a href="#l15.85"></a><span id="l15.85">             let itemList = aItem.getItemList({});</span>
<a href="#l15.86"></a><span id="l15.86">             let serializer = Components.classes[&quot;@mozilla.org/calendar/ics-serializer;1&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -186,64 +186,68 @@ function receiveMessage(aEvent) {</span>
<a href="#l16.4"></a><span id="l16.4">     }</span>
<a href="#l16.5"></a><span id="l16.5">     switch (aEvent.data.command) {</span>
<a href="#l16.6"></a><span id="l16.6">         case &quot;editAttendees&quot;: editAttendees(); break;</span>
<a href="#l16.7"></a><span id="l16.7">         case &quot;attachURL&quot;: attachURL(); break;</span>
<a href="#l16.8"></a><span id="l16.8">         case &quot;onCommandDeleteItem&quot;: onCommandDeleteItem(); break;</span>
<a href="#l16.9"></a><span id="l16.9">         case &quot;onCommandSave&quot;: onCommandSave(aEvent.data.isClosing); break;</span>
<a href="#l16.10"></a><span id="l16.10">         case &quot;onAccept&quot;: onAccept(); break;</span>
<a href="#l16.11"></a><span id="l16.11">         case &quot;onCancel&quot;: onCancel(aEvent.data.iframeId); break;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        case &quot;editConfigState&quot;:</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+        case &quot;editConfigState&quot;: {</span>
<a href="#l16.14"></a><span id="l16.14">             Object.assign(gConfig, aEvent.data.argument);</span>
<a href="#l16.15"></a><span id="l16.15">             updateConfigState(aEvent.data.argument);</span>
<a href="#l16.16"></a><span id="l16.16">             if (gNewItemUI) {</span>
<a href="#l16.17"></a><span id="l16.17">                 gTopComponent.importState(aEvent.data.argument);</span>
<a href="#l16.18"></a><span id="l16.18">             }</span>
<a href="#l16.19"></a><span id="l16.19">             break;</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-        case &quot;editToDoStatus&quot;:</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+        }</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+        case &quot;editToDoStatus&quot;: {</span>
<a href="#l16.23"></a><span id="l16.23">             let textbox = document.getElementById(&quot;percent-complete-textbox&quot;);</span>
<a href="#l16.24"></a><span id="l16.24">             setElementValue(textbox, aEvent.data.value);</span>
<a href="#l16.25"></a><span id="l16.25">             updateToDoStatus(&quot;percent-changed&quot;);</span>
<a href="#l16.26"></a><span id="l16.26">             break;</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+        }</span>
<a href="#l16.28"></a><span id="l16.28">         case &quot;postponeTask&quot;:</span>
<a href="#l16.29"></a><span id="l16.29">             postponeTask(aEvent.data.value);</span>
<a href="#l16.30"></a><span id="l16.30">             break;</span>
<a href="#l16.31"></a><span id="l16.31">         case &quot;toggleTimezoneLinks&quot;:</span>
<a href="#l16.32"></a><span id="l16.32">             gTimezonesEnabled = aEvent.data.checked;</span>
<a href="#l16.33"></a><span id="l16.33">             updateDateTime();</span>
<a href="#l16.34"></a><span id="l16.34">             /*</span>
<a href="#l16.35"></a><span id="l16.35">             // Not implemented in react-code.js yet</span>
<a href="#l16.36"></a><span id="l16.36">             if (gNewItemUI) {</span>
<a href="#l16.37"></a><span id="l16.37">                 gTopComponent.importState({ timezonesEnabled: aEvent.data.checked });</span>
<a href="#l16.38"></a><span id="l16.38">             }</span>
<a href="#l16.39"></a><span id="l16.39">             */</span>
<a href="#l16.40"></a><span id="l16.40">             break;</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-        case &quot;toggleLink&quot;:</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+        case &quot;toggleLink&quot;: {</span>
<a href="#l16.43"></a><span id="l16.43">             let newUrl = window.calendarItem.getProperty(&quot;URL&quot;) || &quot;&quot;;</span>
<a href="#l16.44"></a><span id="l16.44">             let newShow = showOrHideItemURL(aEvent.data.checked, newUrl);</span>
<a href="#l16.45"></a><span id="l16.45">             // Disable command if there is no url</span>
<a href="#l16.46"></a><span id="l16.46">             if (!newUrl.length) {</span>
<a href="#l16.47"></a><span id="l16.47">                 sendMessage({ command: &quot;disableLinkCommand&quot; });</span>
<a href="#l16.48"></a><span id="l16.48">             }</span>
<a href="#l16.49"></a><span id="l16.49">             if (gNewItemUI) {</span>
<a href="#l16.50"></a><span id="l16.50">                 gTopComponent.importState({</span>
<a href="#l16.51"></a><span id="l16.51">                     url: newUrl,</span>
<a href="#l16.52"></a><span id="l16.52">                     showUrl: newShow</span>
<a href="#l16.53"></a><span id="l16.53">                 });</span>
<a href="#l16.54"></a><span id="l16.54">             } else {</span>
<a href="#l16.55"></a><span id="l16.55">                 updateItemURL(newShow, newUrl);</span>
<a href="#l16.56"></a><span id="l16.56">             }</span>
<a href="#l16.57"></a><span id="l16.57">             break;</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-        case &quot;closingWindowWithTabs&quot;:</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+        }</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+        case &quot;closingWindowWithTabs&quot;: {</span>
<a href="#l16.61"></a><span id="l16.61">             let response = onCancel(aEvent.data.id, true);</span>
<a href="#l16.62"></a><span id="l16.62">             sendMessage({</span>
<a href="#l16.63"></a><span id="l16.63">                 command: &quot;replyToClosingWindowWithTabs&quot;,</span>
<a href="#l16.64"></a><span id="l16.64">                 response: response</span>
<a href="#l16.65"></a><span id="l16.65">             });</span>
<a href="#l16.66"></a><span id="l16.66">             break;</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+        }</span>
<a href="#l16.68"></a><span id="l16.68">         case &quot;attachFileByAccountKey&quot;:</span>
<a href="#l16.69"></a><span id="l16.69">             attachFileByAccountKey(aEvent.data.accountKey);</span>
<a href="#l16.70"></a><span id="l16.70">             break;</span>
<a href="#l16.71"></a><span id="l16.71">     }</span>
<a href="#l16.72"></a><span id="l16.72"> }</span>
<a href="#l16.73"></a><span id="l16.73"> </span>
<a href="#l16.74"></a><span id="l16.74"> /**</span>
<a href="#l16.75"></a><span id="l16.75">  * Sets up the event dialog from the window arguments, also setting up all</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineat">@@ -2697,18 +2701,17 @@ function updateRepeat(aSuppressDialogs, </span>
<a href="#l16.77"></a><span id="l16.77">             case &quot;daily&quot;:</span>
<a href="#l16.78"></a><span id="l16.78">               recRule.type = &quot;DAILY&quot;;</span>
<a href="#l16.79"></a><span id="l16.79">               break;</span>
<a href="#l16.80"></a><span id="l16.80">             case &quot;weekly&quot;:</span>
<a href="#l16.81"></a><span id="l16.81">               recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l16.82"></a><span id="l16.82">               break;</span>
<a href="#l16.83"></a><span id="l16.83">             case &quot;every.weekday&quot;:</span>
<a href="#l16.84"></a><span id="l16.84">               recRule.type = &quot;DAILY&quot;;</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineminus">-              let onDays = [2, 3, 4, 5, 6];</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineminus">-              recRule.setComponent(&quot;BYDAY&quot;, onDays.length, onDays);</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+              recRule.setComponent(&quot;BYDAY&quot;, onDays.length, [2, 3, 4, 5, 6]);</span>
<a href="#l16.88"></a><span id="l16.88">               break;</span>
<a href="#l16.89"></a><span id="l16.89">             case &quot;bi.weekly&quot;:</span>
<a href="#l16.90"></a><span id="l16.90">               recRule.type = &quot;WEEKLY&quot;;</span>
<a href="#l16.91"></a><span id="l16.91">               recRule.interval = 2;</span>
<a href="#l16.92"></a><span id="l16.92">               break;</span>
<a href="#l16.93"></a><span id="l16.93">             case &quot;monthly&quot;:</span>
<a href="#l16.94"></a><span id="l16.94">               recRule.type = &quot;MONTHLY&quot;;</span>
<a href="#l16.95"></a><span id="l16.95">               break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-panel.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -103,22 +103,23 @@ var gConfig = {</span>
<a href="#l17.4"></a><span id="l17.4"> function receiveMessage(aEvent) {</span>
<a href="#l17.5"></a><span id="l17.5">     if (aEvent.origin !== &quot;chrome://lightning&quot;) {</span>
<a href="#l17.6"></a><span id="l17.6">         return;</span>
<a href="#l17.7"></a><span id="l17.7">     }</span>
<a href="#l17.8"></a><span id="l17.8">     switch (aEvent.data.command) {</span>
<a href="#l17.9"></a><span id="l17.9">         case &quot;initializeItemMenu&quot;:</span>
<a href="#l17.10"></a><span id="l17.10">             initializeItemMenu(aEvent.data.label, aEvent.data.accessKey);</span>
<a href="#l17.11"></a><span id="l17.11">             break;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-        case &quot;disableLinkCommand&quot;:</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+        case &quot;disableLinkCommand&quot;: {</span>
<a href="#l17.14"></a><span id="l17.14">             let linkCommand = document.getElementById(&quot;cmd_toggle_link&quot;);</span>
<a href="#l17.15"></a><span id="l17.15">             if (linkCommand) {</span>
<a href="#l17.16"></a><span id="l17.16">                 setElementValue(linkCommand, &quot;true&quot;, &quot;disabled&quot;);</span>
<a href="#l17.17"></a><span id="l17.17">             }</span>
<a href="#l17.18"></a><span id="l17.18">             break;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+        }</span>
<a href="#l17.20"></a><span id="l17.20">         case &quot;cancelDialog&quot;:</span>
<a href="#l17.21"></a><span id="l17.21">             document.documentElement.cancelDialog();</span>
<a href="#l17.22"></a><span id="l17.22">             break;</span>
<a href="#l17.23"></a><span id="l17.23">         case &quot;closeWindowOrTab&quot;:</span>
<a href="#l17.24"></a><span id="l17.24">             closeWindowOrTab(aEvent.data.iframeId);</span>
<a href="#l17.25"></a><span id="l17.25">             break;</span>
<a href="#l17.26"></a><span id="l17.26">         case &quot;showCmdStatusNone&quot;:</span>
<a href="#l17.27"></a><span id="l17.27">             document.getElementById(&quot;cmd_status_none&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineat">@@ -134,20 +135,21 @@ function receiveMessage(aEvent) {</span>
<a href="#l17.29"></a><span id="l17.29">             enableAcceptCommand(aEvent.data.argument);</span>
<a href="#l17.30"></a><span id="l17.30">             break;</span>
<a href="#l17.31"></a><span id="l17.31">         case &quot;replyToClosingWindowWithTabs&quot;:</span>
<a href="#l17.32"></a><span id="l17.32">             handleWindowClose(aEvent.data.response);</span>
<a href="#l17.33"></a><span id="l17.33">             break;</span>
<a href="#l17.34"></a><span id="l17.34">         case &quot;removeDisableAndCollapseOnReadonly&quot;:</span>
<a href="#l17.35"></a><span id="l17.35">             removeDisableAndCollapseOnReadonly();</span>
<a href="#l17.36"></a><span id="l17.36">             break;</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-        case &quot;setElementAttribute&quot;:</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+        case &quot;setElementAttribute&quot;: {</span>
<a href="#l17.39"></a><span id="l17.39">             let arg = aEvent.data.argument;</span>
<a href="#l17.40"></a><span id="l17.40">             setElementValue(arg.id, arg.value, arg.attribute);</span>
<a href="#l17.41"></a><span id="l17.41">             break;</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+        }</span>
<a href="#l17.43"></a><span id="l17.43">         case &quot;loadCloudProviders&quot;:</span>
<a href="#l17.44"></a><span id="l17.44">             loadCloudProviders(aEvent.data.items);</span>
<a href="#l17.45"></a><span id="l17.45">             break;</span>
<a href="#l17.46"></a><span id="l17.46">     }</span>
<a href="#l17.47"></a><span id="l17.47"> }</span>
<a href="#l17.48"></a><span id="l17.48"> </span>
<a href="#l17.49"></a><span id="l17.49"> window.addEventListener(&quot;message&quot;, receiveMessage, false);</span>
<a href="#l17.50"></a><span id="l17.50"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -215,17 +215,17 @@ etagsHandler.prototype = {</span>
<a href="#l18.4"></a><span id="l18.4">         }</span>
<a href="#l18.5"></a><span id="l18.5">         if (this.calendar.verboseLogging()) {</span>
<a href="#l18.6"></a><span id="l18.6">             this.logXML += &quot;&lt;&quot; + aQName + &quot;&gt;&quot;;</span>
<a href="#l18.7"></a><span id="l18.7">         }</span>
<a href="#l18.8"></a><span id="l18.8">     },</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">     endElement: function(aUri, aLocalName, aQName) {</span>
<a href="#l18.11"></a><span id="l18.11">         switch (aLocalName) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-            case &quot;response&quot;:</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+            case &quot;response&quot;: {</span>
<a href="#l18.14"></a><span id="l18.14">                 this.tag = null;</span>
<a href="#l18.15"></a><span id="l18.15">                 let resp = this.currentResponse;</span>
<a href="#l18.16"></a><span id="l18.16">                 if (resp.getetag &amp;&amp; resp.getetag.length &amp;&amp;</span>
<a href="#l18.17"></a><span id="l18.17">                     resp.href &amp;&amp; resp.href.length &amp;&amp;</span>
<a href="#l18.18"></a><span id="l18.18">                     resp.getcontenttype &amp;&amp; resp.getcontenttype.length &amp;&amp;</span>
<a href="#l18.19"></a><span id="l18.19">                     !resp.isCollection) {</span>
<a href="#l18.20"></a><span id="l18.20">                     resp.href = this.calendar.ensureDecodedPath(resp.href);</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -248,21 +248,23 @@ etagsHandler.prototype = {</span>
<a href="#l18.23"></a><span id="l18.23">                             if (!itemUid ||</span>
<a href="#l18.24"></a><span id="l18.24">                                 resp.getetag != this.calendar.mItemInfoCache[itemUid].etag) {</span>
<a href="#l18.25"></a><span id="l18.25">                                 this.itemsNeedFetching.push(resp.href);</span>
<a href="#l18.26"></a><span id="l18.26">                             }</span>
<a href="#l18.27"></a><span id="l18.27">                         }</span>
<a href="#l18.28"></a><span id="l18.28">                     }</span>
<a href="#l18.29"></a><span id="l18.29">                 }</span>
<a href="#l18.30"></a><span id="l18.30">                 break;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+            }</span>
<a href="#l18.32"></a><span id="l18.32">             case &quot;href&quot;:</span>
<a href="#l18.33"></a><span id="l18.33">             case &quot;getetag&quot;:</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-            case &quot;getcontenttype&quot;:</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+            case &quot;getcontenttype&quot;: {</span>
<a href="#l18.36"></a><span id="l18.36">                 this.tag = null;</span>
<a href="#l18.37"></a><span id="l18.37">                 break;</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+            }</span>
<a href="#l18.39"></a><span id="l18.39">         }</span>
<a href="#l18.40"></a><span id="l18.40">         if (this.calendar.verboseLogging()) {</span>
<a href="#l18.41"></a><span id="l18.41">             this.logXML += &quot;&lt;/&quot; + aQName + &quot;&gt;&quot;;</span>
<a href="#l18.42"></a><span id="l18.42">         }</span>
<a href="#l18.43"></a><span id="l18.43">     },</span>
<a href="#l18.44"></a><span id="l18.44"> </span>
<a href="#l18.45"></a><span id="l18.45">     startPrefixMapping: function(aPrefix, aUri) { },</span>
<a href="#l18.46"></a><span id="l18.46">     endPrefixMapping: function(aPrefix) { },</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineat">@@ -527,17 +529,17 @@ webDavSyncHandler.prototype = {</span>
<a href="#l18.48"></a><span id="l18.48">         if (this.calendar.verboseLogging()) {</span>
<a href="#l18.49"></a><span id="l18.49">             this.logXML += &quot;&lt;&quot; + aQName + &quot;&gt;&quot;;</span>
<a href="#l18.50"></a><span id="l18.50">         }</span>
<a href="#l18.51"></a><span id="l18.51">     },</span>
<a href="#l18.52"></a><span id="l18.52"> </span>
<a href="#l18.53"></a><span id="l18.53">     endElement: function(aUri, aLocalName, aQName) {</span>
<a href="#l18.54"></a><span id="l18.54">         switch (aLocalName) {</span>
<a href="#l18.55"></a><span id="l18.55">             case &quot;response&quot;: // WebDAV Sync draft 3</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-            case &quot;sync-response&quot;: // WebDAV Sync draft 0,1,2</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+            case &quot;sync-response&quot;: { // WebDAV Sync draft 0,1,2</span>
<a href="#l18.58"></a><span id="l18.58">                 let resp = this.currentResponse;</span>
<a href="#l18.59"></a><span id="l18.59">                 if (resp.href &amp;&amp; resp.href.length) {</span>
<a href="#l18.60"></a><span id="l18.60">                     resp.href = this.calendar.ensureDecodedPath(resp.href);</span>
<a href="#l18.61"></a><span id="l18.61">                 }</span>
<a href="#l18.62"></a><span id="l18.62"> </span>
<a href="#l18.63"></a><span id="l18.63">                 if ((!resp.getcontenttype || resp.getcontenttype == &quot;text/plain&quot;) &amp;&amp;</span>
<a href="#l18.64"></a><span id="l18.64">                     resp.href &amp;&amp;</span>
<a href="#l18.65"></a><span id="l18.65">                     resp.href.endsWith(&quot;.ics&quot;)) {</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineat">@@ -607,22 +609,25 @@ webDavSyncHandler.prototype = {</span>
<a href="#l18.67"></a><span id="l18.67">                     // resources or whose status is not indicating a deleted</span>
<a href="#l18.68"></a><span id="l18.68">                     // resource.</span>
<a href="#l18.69"></a><span id="l18.69">                     cal.WARN(&quot;CalDAV: Unexpected response, status: &quot; + resp.status + &quot;, href: &quot; + resp.href);</span>
<a href="#l18.70"></a><span id="l18.70">                     this.unhandledErrors++;</span>
<a href="#l18.71"></a><span id="l18.71">                 } else {</span>
<a href="#l18.72"></a><span id="l18.72">                     cal.LOG(&quot;CalDAV: Unhandled response element, status: &quot; + resp.status + &quot;, href: &quot; + resp.href + &quot; contenttype:&quot; + resp.getcontenttype);</span>
<a href="#l18.73"></a><span id="l18.73">                 }</span>
<a href="#l18.74"></a><span id="l18.74">                 break;</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-            case &quot;sync-token&quot;:</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineplus">+            }</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineplus">+            case &quot;sync-token&quot;: {</span>
<a href="#l18.78"></a><span id="l18.78">                 this.newSyncToken = this.currentResponse[this.tag];</span>
<a href="#l18.79"></a><span id="l18.79">                 break;</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineminus">-            case &quot;propstat&quot;:</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineplus">+            }</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineplus">+            case &quot;propstat&quot;: {</span>
<a href="#l18.83"></a><span id="l18.83">                 this.isInPropStat = false;</span>
<a href="#l18.84"></a><span id="l18.84">                 break;</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineplus">+            }</span>
<a href="#l18.86"></a><span id="l18.86">         }</span>
<a href="#l18.87"></a><span id="l18.87">         this.tag = null;</span>
<a href="#l18.88"></a><span id="l18.88">         if (this.calendar.verboseLogging()) {</span>
<a href="#l18.89"></a><span id="l18.89">             this.logXML += &quot;&lt;/&quot; + aQName + &quot;&gt;&quot;;</span>
<a href="#l18.90"></a><span id="l18.90">         }</span>
<a href="#l18.91"></a><span id="l18.91">     },</span>
<a href="#l18.92"></a><span id="l18.92"> </span>
<a href="#l18.93"></a><span id="l18.93">     startPrefixMapping: function(aPrefix, aUri) { },</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineat">@@ -880,17 +885,17 @@ multigetSyncHandler.prototype = {</span>
<a href="#l18.95"></a><span id="l18.95">         }</span>
<a href="#l18.96"></a><span id="l18.96">         if (this.calendar.verboseLogging()) {</span>
<a href="#l18.97"></a><span id="l18.97">             this.logXML += &quot;&lt;&quot; + aQName + &quot;&gt;&quot;;</span>
<a href="#l18.98"></a><span id="l18.98">         }</span>
<a href="#l18.99"></a><span id="l18.99">     },</span>
<a href="#l18.100"></a><span id="l18.100"> </span>
<a href="#l18.101"></a><span id="l18.101">     endElement: function(aUri, aLocalName, aQName) {</span>
<a href="#l18.102"></a><span id="l18.102">         switch (aLocalName) {</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-            case &quot;response&quot;:</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineplus">+            case &quot;response&quot;: {</span>
<a href="#l18.105"></a><span id="l18.105">                 let resp = this.currentResponse;</span>
<a href="#l18.106"></a><span id="l18.106">                 if (resp.href &amp;&amp;</span>
<a href="#l18.107"></a><span id="l18.107">                     resp.href.length) {</span>
<a href="#l18.108"></a><span id="l18.108">                     resp.href = this.calendar.ensureDecodedPath(resp.href);</span>
<a href="#l18.109"></a><span id="l18.109">                 }</span>
<a href="#l18.110"></a><span id="l18.110">                 if (resp.href &amp;&amp; resp.href.length &amp;&amp;</span>
<a href="#l18.111"></a><span id="l18.111">                     resp.status &amp;&amp;</span>
<a href="#l18.112"></a><span id="l18.112">                     resp.status.length &amp;&amp;</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineat">@@ -923,19 +928,21 @@ multigetSyncHandler.prototype = {</span>
<a href="#l18.114"></a><span id="l18.114">                         cal.LOG(&quot;CalDAV: skipping item with unmodified etag : &quot; + oldEtag);</span>
<a href="#l18.115"></a><span id="l18.115">                     }</span>
<a href="#l18.116"></a><span id="l18.116">                 } else {</span>
<a href="#l18.117"></a><span id="l18.117">                     cal.WARN(&quot;CalDAV: Unexpected response, status: &quot; +</span>
<a href="#l18.118"></a><span id="l18.118">                              resp.status + &quot;, href: &quot; + resp.href + &quot; calendar-data:\n&quot; + resp.calendardata);</span>
<a href="#l18.119"></a><span id="l18.119">                     this.unhandledErrors++;</span>
<a href="#l18.120"></a><span id="l18.120">                 }</span>
<a href="#l18.121"></a><span id="l18.121">                 break;</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineminus">-            case &quot;propstat&quot;:</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineplus">+            }</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineplus">+            case &quot;propstat&quot;: {</span>
<a href="#l18.125"></a><span id="l18.125">                 this.isInPropStat = false;</span>
<a href="#l18.126"></a><span id="l18.126">                 break;</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineplus">+            }</span>
<a href="#l18.128"></a><span id="l18.128">         }</span>
<a href="#l18.129"></a><span id="l18.129">         this.tag = null;</span>
<a href="#l18.130"></a><span id="l18.130">         if (this.calendar.verboseLogging()) {</span>
<a href="#l18.131"></a><span id="l18.131">             this.logXML += &quot;&lt;/&quot; + aQName + &quot;&gt;&quot;;</span>
<a href="#l18.132"></a><span id="l18.132">         }</span>
<a href="#l18.133"></a><span id="l18.133">     },</span>
<a href="#l18.134"></a><span id="l18.134"> </span>
<a href="#l18.135"></a><span id="l18.135">     startPrefixMapping: function(aPrefix, aUri) { },</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

