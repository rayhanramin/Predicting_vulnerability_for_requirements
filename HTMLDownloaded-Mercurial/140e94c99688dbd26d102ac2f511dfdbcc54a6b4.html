<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 19502:140e94c99688dbd26d102ac2f511dfdbcc54a6b4</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 140e94c99688dbd26d102ac2f511dfdbcc54a6b4" />
<meta property="og:url" content="/comm-central/rev/140e94c99688dbd26d102ac2f511dfdbcc54a6b4" />
<meta property="og:description" content="Bug 430716 - part 1, Use mailnews url override as initial conceptual demo of JsAccount, r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 140e94c99688dbd26d102ac2f511dfdbcc54a6b4 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/140e94c99688dbd26d102ac2f511dfdbcc54a6b4">shortlog</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/140e94c99688dbd26d102ac2f511dfdbcc54a6b4">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4">files</a> |
changeset |
<a href="/comm-central/raw-rev/140e94c99688dbd26d102ac2f511dfdbcc54a6b4">raw</a>  | <a href="/comm-central/archive/140e94c99688dbd26d102ac2f511dfdbcc54a6b4.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=430716">Bug 430716</a> - part 1, Use mailnews url override as initial conceptual demo of JsAccount, r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#32;&#75;&#101;&#110;&#116;&#32;&#74;&#97;&#109;&#101;&#115;&#32;&#60;&#114;&#107;&#101;&#110;&#116;&#64;&#99;&#97;&#115;&#112;&#105;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 19 Apr 2016 16:47:56 -0700</td></tr>

<tr>
 <td>changeset 19502</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/140e94c99688dbd26d102ac2f511dfdbcc54a6b4">140e94c99688dbd26d102ac2f511dfdbcc54a6b4</a></td>
</tr>



<tr>
<td>parent 19501</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7735f47dbe0576b9f10e1d70bd6e8bc25b903bf2">7735f47dbe0576b9f10e1d70bd6e8bc25b903bf2</a>
</td>
</tr>

<tr>
<td>child 19503</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4ce90282d078fd52c9b7503ad4d2dd554164c741">4ce90282d078fd52c9b7503ad4d2dd554164c741</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=140e94c99688dbd26d102ac2f511dfdbcc54a6b4">12011</a></td></tr>
<tr><td>push user</td><td>kent@caspia.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 21 Jun 2016 21:48:15 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@140e94c99688 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4&newProject=comm-central&newRevision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4&newProject=comm-central&newRevision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4&newProject=comm-central&newRevision=140e94c99688dbd26d102ac2f511dfdbcc54a6b4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=430716">430716</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=430716">Bug 430716</a> - part 1, Use mailnews url override as initial conceptual demo of JsAccount, r=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mail/installer/package-manifest.in">mail/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mail/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mail/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mail/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mail/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mail/installer/package-manifest.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JSAccountUtils.jsm">mailnews/jsaccount/modules/JSAccountUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JSAccountUtils.jsm">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JSAccountUtils.jsm">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JSAccountUtils.jsm">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JSAccountUtils.jsm">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JSAccountUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JaBaseUrl.jsm">mailnews/jsaccount/modules/JaBaseUrl.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JaBaseUrl.jsm">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JaBaseUrl.jsm">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JaBaseUrl.jsm">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JaBaseUrl.jsm">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/modules/JaBaseUrl.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/moz.build">mailnews/jsaccount/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/moz.build">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/moz.build">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/moz.build">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/moz.build">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/moz.build">mailnews/jsaccount/public/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/moz.build">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/moz.build">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/moz.build">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/moz.build">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIDelegateList.idl">mailnews/jsaccount/public/msgIDelegateList.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIDelegateList.idl">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIDelegateList.idl">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIDelegateList.idl">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIDelegateList.idl">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIDelegateList.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIOverride.idl">mailnews/jsaccount/public/msgIOverride.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIOverride.idl">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIOverride.idl">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIOverride.idl">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIOverride.idl">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgIOverride.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgJsAccountCID.h">mailnews/jsaccount/public/msgJsAccountCID.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgJsAccountCID.h">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgJsAccountCID.h">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgJsAccountCID.h">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgJsAccountCID.h">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/public/msgJsAccountCID.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/readme.html">mailnews/jsaccount/readme.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/readme.html">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/readme.html">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/readme.html">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/readme.html">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/readme.html">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.cpp">mailnews/jsaccount/src/DelegateList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.cpp">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.cpp">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.cpp">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.cpp">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.h">mailnews/jsaccount/src/DelegateList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.h">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.h">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.h">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.h">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/DelegateList.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.cpp">mailnews/jsaccount/src/JaUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.cpp">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.cpp">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.cpp">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.cpp">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.h">mailnews/jsaccount/src/JaUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.h">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.h">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.h">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.h">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/JaUrl.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/moz.build">mailnews/jsaccount/src/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/moz.build">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/moz.build">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/moz.build">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/moz.build">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/src/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/moz.build">mailnews/jsaccount/test/idl/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/moz.build">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/moz.build">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/moz.build">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/moz.build">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/msgIFooUrl.idl">mailnews/jsaccount/test/idl/msgIFooUrl.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/msgIFooUrl.idl">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/msgIFooUrl.idl">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/msgIFooUrl.idl">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/msgIFooUrl.idl">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/idl/msgIFooUrl.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/moz.build">mailnews/jsaccount/test/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/moz.build">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/moz.build">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/moz.build">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/moz.build">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/head_jsaccount.js">mailnews/jsaccount/test/unit/head_jsaccount.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/head_jsaccount.js">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/head_jsaccount.js">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/head_jsaccount.js">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/head_jsaccount.js">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/head_jsaccount.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/readme.html">mailnews/jsaccount/test/unit/resources/readme.html</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/readme.html">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/readme.html">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/readme.html">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/readme.html">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/readme.html">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testComponents.manifest">mailnews/jsaccount/test/unit/resources/testComponents.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testComponents.manifest">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testComponents.manifest">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testComponents.manifest">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testComponents.manifest">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testComponents.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/tail_jsaccount.js">mailnews/jsaccount/test/unit/tail_jsaccount.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/tail_jsaccount.js">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/tail_jsaccount.js">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/tail_jsaccount.js">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/tail_jsaccount.js">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/tail_jsaccount.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_componentsExist.js">mailnews/jsaccount/test/unit/test_componentsExist.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_componentsExist.js">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_componentsExist.js">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_componentsExist.js">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_componentsExist.js">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_componentsExist.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_fooUrl.js">mailnews/jsaccount/test/unit/test_fooUrl.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_fooUrl.js">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_fooUrl.js">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_fooUrl.js">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_fooUrl.js">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/test_fooUrl.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/xpcshell.ini">mailnews/jsaccount/test/unit/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/jsaccount/test/unit/xpcshell.ini">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/moz.build">mailnews/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/moz.build">file</a> |
<a href="/comm-central/annotate/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/moz.build">annotate</a> |
<a href="/comm-central/diff/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/moz.build">diff</a> |
<a href="/comm-central/comparison/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/moz.build">comparison</a> |
<a href="/comm-central/log/140e94c99688dbd26d102ac2f511dfdbcc54a6b4/mailnews/moz.build">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/installer/package-manifest.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/installer/package-manifest.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -157,16 +157,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> @RESPATH@/components/cloudFileComponents.manifest</span>
<a href="#l1.5"></a><span id="l1.5"> @RESPATH@/components/cloudfile.xpt</span>
<a href="#l1.6"></a><span id="l1.6"> @RESPATH@/components/addrbook.xpt</span>
<a href="#l1.7"></a><span id="l1.7"> @RESPATH@/components/fts3tok.xpt</span>
<a href="#l1.8"></a><span id="l1.8"> @RESPATH@/components/folderLookupService.js</span>
<a href="#l1.9"></a><span id="l1.9"> ; interfaces.manifest doesn't get packaged because it is dynamically</span>
<a href="#l1.10"></a><span id="l1.10"> ; re-created at packaging time when linking the xpts that will actually</span>
<a href="#l1.11"></a><span id="l1.11"> ; go into the package, so the test related interfaces aren't included.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+@RESPATH@/components/msgjsaccount.xpt</span>
<a href="#l1.13"></a><span id="l1.13"> @RESPATH@/components/mime.xpt</span>
<a href="#l1.14"></a><span id="l1.14"> @RESPATH@/components/mimeJSComponents.js</span>
<a href="#l1.15"></a><span id="l1.15"> @RESPATH@/components/msgMime.manifest</span>
<a href="#l1.16"></a><span id="l1.16"> @RESPATH@/components/steel.xpt</span>
<a href="#l1.17"></a><span id="l1.17"> @RESPATH@/components/msgAsyncPrompter.js</span>
<a href="#l1.18"></a><span id="l1.18"> @RESPATH@/components/msgbase.xpt</span>
<a href="#l1.19"></a><span id="l1.19"> @RESPATH@/components/msgBase.manifest</span>
<a href="#l1.20"></a><span id="l1.20"> @RESPATH@/components/msgcompose.xpt</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -186,16 +186,22 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;nsMsgAttachment.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsMsgSend.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsMsgQuote.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsURLFetcher.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsSmtpServer.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsMsgCompUtils.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+//  jsAccount includes</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+#include &quot;msgJsAccountCID.h&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+#include &quot;JaUrl.h&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.18"></a><span id="l2.18"> // imap includes</span>
<a href="#l2.19"></a><span id="l2.19"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.20"></a><span id="l2.20"> #include &quot;nsMsgImapCID.h&quot;</span>
<a href="#l2.21"></a><span id="l2.21"> #include &quot;nsIMAPHostSessionList.h&quot;</span>
<a href="#l2.22"></a><span id="l2.22"> #include &quot;nsImapIncomingServer.h&quot;</span>
<a href="#l2.23"></a><span id="l2.23"> #include &quot;nsImapService.h&quot;</span>
<a href="#l2.24"></a><span id="l2.24"> #include &quot;nsImapMailFolder.h&quot;</span>
<a href="#l2.25"></a><span id="l2.25"> #include &quot;nsImapUrl.h&quot;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineat">@@ -581,16 +587,23 @@ NS_DEFINE_NAMED_CID(NS_SMTPSERVER_CID);</span>
<a href="#l2.27"></a><span id="l2.27"> NS_DEFINE_NAMED_CID(NS_SMTPURL_CID);</span>
<a href="#l2.28"></a><span id="l2.28"> NS_DEFINE_NAMED_CID(NS_MAILTOURL_CID);</span>
<a href="#l2.29"></a><span id="l2.29"> NS_DEFINE_NAMED_CID(NS_MSGQUOTE_CID);</span>
<a href="#l2.30"></a><span id="l2.30"> NS_DEFINE_NAMED_CID(NS_MSGQUOTELISTENER_CID);</span>
<a href="#l2.31"></a><span id="l2.31"> NS_DEFINE_NAMED_CID(NS_URLFETCHER_CID);</span>
<a href="#l2.32"></a><span id="l2.32"> NS_DEFINE_NAMED_CID(NS_MSGCOMPUTILS_CID);</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+// jsAccount factories</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR(JaCppUrlDelegator)</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+NS_DEFINE_NAMED_CID(JACPPURLDELEGATOR_CID);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.42"></a><span id="l2.42"> // imap factories</span>
<a href="#l2.43"></a><span id="l2.43"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.44"></a><span id="l2.44"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsImapUrl)</span>
<a href="#l2.45"></a><span id="l2.45"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsImapProtocol)</span>
<a href="#l2.46"></a><span id="l2.46"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsIMAPHostSessionList, Init)</span>
<a href="#l2.47"></a><span id="l2.47"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsImapIncomingServer)</span>
<a href="#l2.48"></a><span id="l2.48"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsImapService)</span>
<a href="#l2.49"></a><span id="l2.49"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsImapMailFolder)</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineat">@@ -963,16 +976,18 @@ const mozilla::Module::CIDEntry kMailNew</span>
<a href="#l2.51"></a><span id="l2.51">   { &amp;kNS_SMTPSERVICE_CID, false, NULL, nsSmtpServiceConstructor},</span>
<a href="#l2.52"></a><span id="l2.52">   { &amp;kNS_SMTPSERVER_CID, false, NULL, nsSmtpServerConstructor},</span>
<a href="#l2.53"></a><span id="l2.53">   { &amp;kNS_SMTPURL_CID, false, NULL, nsSmtpUrlConstructor},</span>
<a href="#l2.54"></a><span id="l2.54">   { &amp;kNS_MAILTOURL_CID, false, NULL, nsMailtoUrlConstructor},</span>
<a href="#l2.55"></a><span id="l2.55">   { &amp;kNS_MSGQUOTE_CID, false, NULL, nsMsgQuoteConstructor},</span>
<a href="#l2.56"></a><span id="l2.56">   { &amp;kNS_MSGQUOTELISTENER_CID, false, NULL, nsMsgQuoteListenerConstructor},</span>
<a href="#l2.57"></a><span id="l2.57">   { &amp;kNS_URLFETCHER_CID, false, NULL, nsURLFetcherConstructor},</span>
<a href="#l2.58"></a><span id="l2.58">   { &amp;kNS_MSGCOMPUTILS_CID, false, NULL, nsMsgCompUtilsConstructor},</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+  // JsAccount Entries</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+  { &amp;kJACPPURLDELEGATOR_CID, false, nullptr, JaCppUrlDelegatorConstructor },</span>
<a href="#l2.61"></a><span id="l2.61">   // Imap Entries</span>
<a href="#l2.62"></a><span id="l2.62">   { &amp;kNS_IMAPURL_CID, false, NULL, nsImapUrlConstructor },</span>
<a href="#l2.63"></a><span id="l2.63">   { &amp;kNS_IMAPPROTOCOL_CID, false, nullptr, nsImapProtocolConstructor },</span>
<a href="#l2.64"></a><span id="l2.64">   { &amp;kNS_IMAPMOCKCHANNEL_CID, false, nullptr, nsImapMockChannelConstructor },</span>
<a href="#l2.65"></a><span id="l2.65">   { &amp;kNS_IIMAPHOSTSESSIONLIST_CID, false, nullptr, nsIMAPHostSessionListConstructor },</span>
<a href="#l2.66"></a><span id="l2.66">   { &amp;kNS_IMAPINCOMINGSERVER_CID, false, nullptr, nsImapIncomingServerConstructor },</span>
<a href="#l2.67"></a><span id="l2.67">   { &amp;kNS_IMAPRESOURCE_CID, false, nullptr, nsImapMailFolderConstructor },</span>
<a href="#l2.68"></a><span id="l2.68">   { &amp;kNS_IMAPSERVICE_CID, false, nullptr, nsImapServiceConstructor },</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineat">@@ -1179,16 +1194,18 @@ const mozilla::Module::ContractIDEntry k</span>
<a href="#l2.70"></a><span id="l2.70">   { NS_MAILTOHANDLER_CONTRACTID, &amp;kNS_SMTPSERVICE_CID },</span>
<a href="#l2.71"></a><span id="l2.71">   { NS_SMTPSERVER_CONTRACTID, &amp;kNS_SMTPSERVER_CID },</span>
<a href="#l2.72"></a><span id="l2.72">   { NS_SMTPURL_CONTRACTID, &amp;kNS_SMTPURL_CID },</span>
<a href="#l2.73"></a><span id="l2.73">   { NS_MAILTOURL_CONTRACTID, &amp;kNS_MAILTOURL_CID },</span>
<a href="#l2.74"></a><span id="l2.74">   { NS_MSGQUOTE_CONTRACTID, &amp;kNS_MSGQUOTE_CID },</span>
<a href="#l2.75"></a><span id="l2.75">   { NS_MSGQUOTELISTENER_CONTRACTID, &amp;kNS_MSGQUOTELISTENER_CID },</span>
<a href="#l2.76"></a><span id="l2.76">   { NS_URLFETCHER_CONTRACTID, &amp;kNS_URLFETCHER_CID },</span>
<a href="#l2.77"></a><span id="l2.77">   { NS_MSGCOMPUTILS_CONTRACTID, &amp;kNS_MSGCOMPUTILS_CID },</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+  // JsAccount Entries</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+  { JACPPURLDELEGATOR_CONTRACTID, &amp;kJACPPURLDELEGATOR_CID },</span>
<a href="#l2.80"></a><span id="l2.80">   // Imap Entries</span>
<a href="#l2.81"></a><span id="l2.81">   { NS_IMAPINCOMINGSERVER_CONTRACTID, &amp;kNS_IMAPINCOMINGSERVER_CID },</span>
<a href="#l2.82"></a><span id="l2.82">   { NS_RDF_RESOURCE_FACTORY_CONTRACTID_PREFIX &quot;imap&quot;, &amp;kNS_IMAPRESOURCE_CID },</span>
<a href="#l2.83"></a><span id="l2.83">   { &quot;@mozilla.org/messenger/messageservice;1?type=imap-message&quot;, &amp;kNS_IMAPSERVICE_CID },</span>
<a href="#l2.84"></a><span id="l2.84">   { &quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;, &amp;kNS_IMAPSERVICE_CID },</span>
<a href="#l2.85"></a><span id="l2.85">   { NS_IMAPSERVICE_CONTRACTID, &amp;kNS_IMAPSERVICE_CID },</span>
<a href="#l2.86"></a><span id="l2.86">   { NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX &quot;imap&quot;, &amp;kNS_IMAPSERVICE_CID },</span>
<a href="#l2.87"></a><span id="l2.87">   { NS_IMAPPROTOCOLINFO_CONTRACTID, &amp;kNS_IMAPSERVICE_CID },</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineat">@@ -1299,16 +1316,17 @@ static const mozilla::Module::CategoryEn</span>
<a href="#l2.89"></a><span id="l2.89">   { &quot;app-startup&quot;, NS_MESSENGEROSINTEGRATION_CONTRACTID, &quot;service,&quot; NS_MESSENGEROSINTEGRATION_CONTRACTID}</span>
<a href="#l2.90"></a><span id="l2.90"> ,</span>
<a href="#l2.91"></a><span id="l2.91"> #endif</span>
<a href="#l2.92"></a><span id="l2.92">   // Address Book Entries</span>
<a href="#l2.93"></a><span id="l2.93">   { &quot;command-line-handler&quot;, &quot;m-addressbook&quot;, NS_ABMANAGERSTARTUPHANDLER_CONTRACTID },</span>
<a href="#l2.94"></a><span id="l2.94">   // Bayesian Filter Entries</span>
<a href="#l2.95"></a><span id="l2.95">   // Compose Entries</span>
<a href="#l2.96"></a><span id="l2.96">   { &quot;command-line-handler&quot;, &quot;m-compose&quot;, NS_MSGCOMPOSESTARTUPHANDLER_CONTRACTID },</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+  // JsAccount Entries</span>
<a href="#l2.98"></a><span id="l2.98">   // Imap Entries</span>
<a href="#l2.99"></a><span id="l2.99">   // Local Entries</span>
<a href="#l2.100"></a><span id="l2.100">   // msgdb Entries</span>
<a href="#l2.101"></a><span id="l2.101">   // Mime Entries</span>
<a href="#l2.102"></a><span id="l2.102">   { &quot;mime-emitter&quot;, NS_HTML_MIME_EMITTER_CONTRACTID, NS_HTML_MIME_EMITTER_CONTRACTID },</span>
<a href="#l2.103"></a><span id="l2.103">   { &quot;mime-emitter&quot;, NS_XML_MIME_EMITTER_CONTRACTID, NS_XML_MIME_EMITTER_CONTRACTID },</span>
<a href="#l2.104"></a><span id="l2.104">   { &quot;mime-emitter&quot;, NS_PLAIN_MIME_EMITTER_CONTRACTID, NS_PLAIN_MIME_EMITTER_CONTRACTID },</span>
<a href="#l2.105"></a><span id="l2.105">   { &quot;mime-emitter&quot;, NS_RAW_MIME_EMITTER_CONTRACTID, NS_RAW_MIME_EMITTER_CONTRACTID },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mailnews/jsaccount/modules/JSAccountUtils.jsm</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,282 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+/* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+/**</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+ * This file implements helper methods to make the transition of base mailnews</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+ * objects from JS to C++ easier, and also to allow creating specialized</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+ * versions of those accounts using only JS XPCOM implementations.</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+ *</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+ * In C++ land, the XPCOM component is a generic C++ class that does nothing</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+ * but delegate any calls to interfaces known in C++ to either the generic</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+ * C++ implementation (such as nsMsgIncomingServer.cpp) or a JavaScript</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+ * implementation of those methods. Those delegations could be used for either</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+ * method-by-method replacement of the generic C++ methods with JavaScript</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+ * versions, or for specialization of the generic class using JavaScript to</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+ * implement a particular class type. We use a C++ class as the main XPCOM</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+ * version for two related reasons: First, we do not want to go through a</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+ * C++-&gt;js-&gt;C++ XPCOM transition just to execute a C++ method. Second, C++</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+ * inheritance is different from JS inheritance, and sometimes the C++ code</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+ * will ignore the XPCOM parts of the JS, and just execute using C++</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+ * inheritance.</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+ *</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+ * In JavaScript land, the implementation currently uses the XPCOM object for</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+ * JavaScript calls, with the last object in the prototype chain defaulting</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+ * to calling using the CPP object, specified in an instance-specific</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+ * this.cppBase object.</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+ *</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+ * Examples of use can be found in the test files for jsaccount stuff.</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+ */</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+const EXPORTED_SYMBOLS = [&quot;JSAccountUtils&quot;];</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+var JSAccountUtils = {};</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+var Cc = Components.classes;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+var Ci = Components.interfaces;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+var Cu = Components.utils;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+var Cr = Components.results;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Log.jsm&quot;);</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+// Logger definitions.</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+const LOGGER_NAME = &quot;JsAccount&quot;;</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+const PREF_BRANCH_LOG = &quot;mailnews.jsaccount.log&quot;;</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+const PREF_LOG_LEVEL = PREF_BRANCH_LOG + &quot;level&quot;;</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+const PREF_LOG_DUMP = PREF_BRANCH_LOG + &quot;dump&quot;;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+// Set default logging levels.</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+const LOG_LEVEL_DEFAULT = &quot;Info&quot;</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+const LOG_DUMP_DEFAULT = true;</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+var log = configureLogging();</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+/**</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+ *</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+ *  Generic factory to create XPCOM components under JsAccount.</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+ *</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+ *  @param aProperties   This a a const JS object that describes the specific</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+ *                       details of a particular JsAccount XPCOM object:</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+ *     {</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+ *       baseContractID: string contractID used to create the base generic C++</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+ *                       object. This object must implement the interfaces in</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+ *                       baseInterfaces, plus msgIOverride.</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+ *</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+ *       baseInterfaces: JS array of interfaces implemented by the base, generic</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+ *                       C++ object.</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+ *</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+ *       extraInterfaces: JS array of additional interfaces implemented by the</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+ *                        component (accessed using getInterface())</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+ *</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+ *       contractID:     string contract ID for the JS object that will be</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+ *                       created by the factory.</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+ *</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+ *       classID:        Components.ID(CID) for the JS object that will be</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+ *                       created by the factory, where CID is a string uuid.</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+ *      }</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+ *</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+ *   @param aJsDelegateConstructor: a JS contructor class, called using new,</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+ *                                  that will create the JS object to which</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+ *                                  XPCOM methods calls will be delegated.</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+ */</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+JSAccountUtils.jaFactory = function (aProperties, aJsDelegateConstructor)</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+{</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+  let factory = {};</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+  factory.QueryInterface = XPCOMUtils.generateQI([Ci.nsIFactory]);</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+  factory.lockFactory = function() {};</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+  factory.createInstance = function(outer, iid)</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+  {</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+    if (outer != null)</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+      throw Cr.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+    // C++ delegator class.</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+    let delegator = Cc[aProperties.baseContractID]</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+                      .createInstance(Ci.msgIOverride);</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+    // Make sure the delegator JS wrapper knows its interfaces.</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+    aProperties.baseInterfaces.forEach(iface =&gt; delegator instanceof iface);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+    // JavaScript overrides of base class functions.</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+    let jsDelegate = new aJsDelegateConstructor(delegator, aProperties.baseInterfaces);</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+    delegator.jsDelegate = jsDelegate;</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+    // Get the delegate list for this current class. Use OwnProperty in case it</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+    // inherits from another JsAccount class.</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+    let delegateList = null;</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+    if (Object.getPrototypeOf(jsDelegate).hasOwnProperty(&quot;delegateList&quot;)) {</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+      delegateList = Object.getPrototypeOf(jsDelegate).delegateList;</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+    }</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+    if (delegateList instanceof Ci.msgIDelegateList) {</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+      delegator.methodsToDelegate = delegateList;</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+    } else {</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+      // Lazily create and populate the list of methods to delegate.</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+      log.info(&quot;creating delegate list for contractID &quot; + aProperties.contractID);</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+      let delegateList = delegator.methodsToDelegate;</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+      Object.keys(delegator).forEach(name =&gt; {log.debug(&quot;delegator has key &quot; + name);});</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+      // jsMethods contains the methods that may be targets of the C++ delegation to JS.</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+      let jsMethods = Object.getPrototypeOf(delegator.jsDelegate.wrappedJSObject);</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+      for (let name in jsMethods)</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+      {</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+        log.debug(&quot;processing jsDelegate method: &quot; + name);</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+        if (name[0] == '_') { // don't bother with methods explicitly marked as internal.</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+          log.debug(&quot;skipping &quot; + name);</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+          continue;</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+        }</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+        // Other methods to skip.</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+        if ([&quot;QueryInterface&quot;,  // nsISupports</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+             &quot;methodsToDelegate&quot;, &quot;jsDelegate&quot;, &quot;cppBase&quot;, // msgIOverride</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+             &quot;delegateList&quot;, &quot;wrappedJSObject&quot;, // non-XPCOM methods to skip</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+            ].includes(name)) {</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+          log.debug(&quot;skipping &quot; + name);</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+          continue;</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+        }</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+        let jsDescriptor = getPropertyDescriptor(jsMethods, name);</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+        if (!jsDescriptor) {</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+          log.debug(&quot;no jsDescriptor for &quot; + name);</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+          continue;</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+        }</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+        let cppDescriptor = Object.getOwnPropertyDescriptor(delegator, name);</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+        if (!cppDescriptor) {</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+          log.debug(&quot;no cppDescriptor found for &quot; + name);</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+          // It is OK for jsMethods to have methods that are not used in override of C++.</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+          continue;</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+        }</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+        let upperCaseName = name[0].toUpperCase() + name.substr(1);</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+        if ('value' in jsDescriptor) {</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+          log.info(&quot;delegating &quot; + upperCaseName);</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+          delegateList.add(upperCaseName);</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+        }</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+        else {</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+          if (jsDescriptor.set) {</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+            log.info(&quot;delegating Set&quot; + upperCaseName);</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+            delegateList.add(&quot;Set&quot; + upperCaseName);</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+          }</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+          if (jsDescriptor.get) {</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+            log.info(&quot;delegating Get&quot; + upperCaseName);</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+            delegateList.add(&quot;Get&quot; + upperCaseName);</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+          }</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+        }</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+      }</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+      // Save the delegate list for reuse, statically for all instances.</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+      Object.getPrototypeOf(jsDelegate).delegateList = delegateList;</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+    }</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+    for (let iface of aProperties.baseInterfaces)</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+      if (iid.equals(iface)) {</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+        log.debug(&quot;Successfully returning delegator &quot; + delegator);</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+        return delegator;</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+      }</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+    throw Cr.NS_ERROR_NO_INTERFACE;</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+  };</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineplus">+</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+  return factory;</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineplus">+}</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+/**</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+ * Create a JS object that contains calls to each of the methods in a CPP</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+ * base class, that will reference the cpp object defined on a particular</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+ * instance of the object. This is intended to be the last item in the</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineplus">+ * prototype chain for a JsAccount implementation.</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineplus">+ *</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+ * @param aProperties see definition in jsFactory above</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+ *</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+ * @returns a JS object suitable as the prototype of a JsAccount implementation.</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+ */</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineplus">+JSAccountUtils.makeCppDelegator = function(aProperties)</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+{</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+  log.info(&quot;Making cppDelegator for contractID &quot; + aProperties.contractID);</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+  let cppDelegator = {};</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+  let cppDummy = Cc[aProperties.baseContractID].createInstance(Ci.nsISupports);</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+  // Add methods from all interfaces.</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+  for (let iface of aProperties.baseInterfaces)</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+    cppDummy instanceof Ci[iface];</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineplus">+</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineplus">+  for (let method in cppDummy) {</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineplus">+    // skip nsISupports and msgIOverride methods</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineplus">+    if ([&quot;QueryInterface&quot;, &quot;methodsToDelegate&quot;, &quot;jsDelegate&quot;, &quot;cppBase&quot;, &quot;getInterface&quot;].includes(method)) {</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineplus">+      log.config(&quot;Skipping &quot; + method + &quot;\n&quot;);</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineplus">+      continue;</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineplus">+    }</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineplus">+    log.config(&quot;processing &quot; + method + &quot;\n&quot;);</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineplus">+    let descriptor = Object.getOwnPropertyDescriptor(cppDummy, method);</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+    let property = { enumerable: true };</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineplus">+    // We must use Immediately Invoked Function Expressions to pass method, otherwise it is</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineplus">+    // a closure containing just the last value it was set to.</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineplus">+    if ('value' in descriptor) {</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineplus">+      log.debug(&quot;Adding value for &quot; + method);</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineplus">+      property.value = function(aMethod) {</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineplus">+        return function(...args) {</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+          return Reflect.apply(this.cppBase[aMethod], undefined, args);</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+        };</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineplus">+      }(method);</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineplus">+    }</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+    if (descriptor.set) {</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineplus">+      log.debug(&quot;Adding setter for &quot; + method);</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineplus">+      property.set = function(aMethod) {</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineplus">+        return function(aVal) {</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineplus">+          this.cppBase[aMethod] = aVal;</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineplus">+        };</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineplus">+      }(method);</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineplus">+    }</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineplus">+    if (descriptor.get) {</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineplus">+      log.debug(&quot;Adding getter for &quot; + method);</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineplus">+      property.get = function(aMethod) {</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineplus">+        return function() {</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineplus">+          return this.cppBase[aMethod];</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineplus">+        };</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineplus">+      }(method);</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+    }</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineplus">+    Object.defineProperty(cppDelegator, method, property);</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineplus">+  }</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineplus">+  return cppDelegator;</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineplus">+}</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineplus">+</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineplus">+// Utility functions.</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineplus">+</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineplus">+// Iterate over an object and its prototypes to get a property descriptor.</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineplus">+function getPropertyDescriptor(obj, name)</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineplus">+{</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineplus">+  let descriptor = null;</span>
<a href="#l3.254"></a><span id="l3.254" class="difflineplus">+</span>
<a href="#l3.255"></a><span id="l3.255" class="difflineplus">+  // Eventually we will hit an object that will delegate JS calls to a CPP</span>
<a href="#l3.256"></a><span id="l3.256" class="difflineplus">+  // object, which are not JS overrides of CPP methods. Locate this item, and</span>
<a href="#l3.257"></a><span id="l3.257" class="difflineplus">+  // skip, because it will not have _JsPrototypeToDelegate defined.</span>
<a href="#l3.258"></a><span id="l3.258" class="difflineplus">+  while (obj &amp;&amp; (&quot;_JsPrototypeToDelegate&quot; in obj)) {</span>
<a href="#l3.259"></a><span id="l3.259" class="difflineplus">+    descriptor = Object.getOwnPropertyDescriptor(obj, name);</span>
<a href="#l3.260"></a><span id="l3.260" class="difflineplus">+    if (descriptor)</span>
<a href="#l3.261"></a><span id="l3.261" class="difflineplus">+      break;</span>
<a href="#l3.262"></a><span id="l3.262" class="difflineplus">+    obj = Object.getPrototypeOf(obj);</span>
<a href="#l3.263"></a><span id="l3.263" class="difflineplus">+  }</span>
<a href="#l3.264"></a><span id="l3.264" class="difflineplus">+  return descriptor;</span>
<a href="#l3.265"></a><span id="l3.265" class="difflineplus">+}</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineplus">+</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineplus">+// Configure the logger based on the preferences.</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineplus">+function configureLogging()</span>
<a href="#l3.269"></a><span id="l3.269" class="difflineplus">+{</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineplus">+  let log = Log.repository.getLogger(LOGGER_NAME);</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineplus">+</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineplus">+  // Log messages need to go to the browser console.</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineplus">+  let consoleAppender = new Log.ConsoleAppender(new Log.BasicFormatter());</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineplus">+  log.addAppender(consoleAppender);</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineplus">+</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineplus">+  // Make sure the logger keeps up with the logging level preference.</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineplus">+  log.level = Log.Level[Preferences.get(PREF_LOG_LEVEL, LOG_LEVEL_DEFAULT)];</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineplus">+</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineplus">+  // If enabled in the preferences, add a dump appender.</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineplus">+  let logDumping = Preferences.get(PREF_LOG_DUMP, LOG_DUMP_DEFAULT);</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineplus">+  if (logDumping) {</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineplus">+    let dumpAppender = new Log.DumpAppender(new Log.BasicFormatter());</span>
<a href="#l3.283"></a><span id="l3.283" class="difflineplus">+    log.addAppender(dumpAppender);</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineplus">+  }</span>
<a href="#l3.285"></a><span id="l3.285" class="difflineplus">+  return log;</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/mailnews/jsaccount/modules/JaBaseUrl.jsm</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,81 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+/* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+const EXPORTED_SYMBOLS = [&quot;JaBaseUrlProperties&quot;, &quot;JaBaseUrl&quot;];</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+var Cc = Components.classes;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+var Ci = Components.interfaces;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+var Cr = Components.results;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+var Cu = Components.utils;</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+Cu.import(&quot;resource://gre/modules/jsaccount/JSAccountUtils.jsm&quot;);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+// A partial JavaScript implementation of the base server methods.</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+const JaBaseUrlProperties = {</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+  // The CPP object that delgates to CPP or JS.</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  baseContractID:     &quot;@mozilla.org/jacppurldelegator;1&quot;,</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  // Interfaces implemented by the base CPP version of this object.</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+  baseInterfaces:     [ Ci.nsIURI,</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+                        Ci.nsIURL,</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+                        Ci.nsIMsgMailNewsUrl,</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+                        Ci.nsIMsgMessageUrl,</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+                        Ci.msgIOverride,</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+                        Ci.nsISupports,</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                        Ci.nsIInterfaceRequestor,</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+                        ],</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  // We don't typically define this as a creatable component, but if we do use</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+  // these. Subclasses for particular account types require these defined for</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+  // that type.</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+  contractID:         &quot;@mozilla.org/jsaccount/jaurl;1&quot;,</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+  classID:            Components.ID(&quot;{1E7B42CA-E6D9-408F-A4E4-8D2F82AECBBD}&quot;),</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+};</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+function JaBaseUrl(aDelegator, aBaseInterfaces) {</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+// Typical boilerplate to include in all implementations.</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+  // Object delegating method calls to the appropriate XPCOM object.</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+  // Weak because it owns us.</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineplus">+  this._delegatorWeak = Cu.getWeakReference(aDelegator);</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineplus">+</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineplus">+  // Base implementation of methods with no overrides.</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+  this.cppBase = aDelegator.cppBase;</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineplus">+</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineplus">+  // cppBase class sees all interfaces</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+  aBaseInterfaces.forEach(iface =&gt; this.cppBase instanceof iface);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+}</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+JaBaseUrl.prototype = {</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+// Typical boilerplate to include in all implementations.</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+  __proto__: JSAccountUtils.makeCppDelegator(JaBaseUrlProperties),</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+  // Flag this item as CPP needs to delegate to JS.</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+  _JsPrototypeToDelegate: true,</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+  // QI to the interfaces.</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI(JaBaseUrlProperties.baseInterfaces),</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+  // Used to access an instance as JS, bypassing XPCOM.</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+  get wrappedJSObject() {</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+    return this;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+  },</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+  // Accessor to the weak cpp delegator.</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+  get delegator() {</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+    return this._delegatorWeak.get();</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+  },</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+  // Dynamically-generated list of delegate methods.</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+  delegateList: null,</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+  // Implementation in JS  (if any) of methods in XPCOM interfaces.</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mailnews/jsaccount/moz.build</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,17 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+# -*- Mode: python; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+# vim: set filetype=python:</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+DIRS += [</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+  'public',</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  'src'</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+]</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+EXTRA_JS_MODULES.jsaccount += [</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+    'modules/JaBaseUrl.jsm',</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+    'modules/JSAccountUtils.jsm',</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+]</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+TEST_DIRS += ['test']</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mailnews/jsaccount/public/moz.build</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,17 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+# -*- Mode: python; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+# vim: set filetype=python:</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+XPIDL_SOURCES += [</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+    'msgIDelegateList.idl',</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    'msgIOverride.idl',</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+]</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+EXPORTS += [</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+    'msgJsAccountCID.h',</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+]</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+XPIDL_MODULE = 'msgjsaccount'</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/mailnews/jsaccount/public/msgIDelegateList.idl</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,19 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+/* vim:set ts=2 sw=2 sts=2 et cindent: */</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+/**</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+ * This interface provides a list of methods that should be delegated to</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+ * a JsObject rather than a C++ XPCOM base object in JsAccount classes.</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+ */</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+[scriptable, builtinclass, uuid(627D3A34-F8A3-40eb-91FE-E413D6638D27)]</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+interface msgIDelegateList : nsISupports</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+{</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  /// Method name to delegate to JavaScript.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  void add(in string aMethod);</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/mailnews/jsaccount/public/msgIOverride.idl</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,42 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+/* vim:set ts=2 sw=2 sts=2 et cindent: */</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+#include &quot;msgIDelegateList.idl&quot;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+/**</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+ * Mailnews code typically has a C++ base class for objects, which is then</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+ * specialized for each account type with a C++ subclass of the base class.</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+ *</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+ * This interface provides the ability of JavaScript-based account</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+ * implementations to use the same C++ base classes as core objects, but</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+ * use JavaScript to override methods instead of C++.</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+ */</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+[scriptable, uuid(68075269-8BBD-4a09-AC04-3241BF44F633)]</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+interface msgIOverride : nsISupports</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+{</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+  /**</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+   *</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+   * A list of methods in the C++ base class that will be delegated to the JS</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+   * delegate. This is calculated once, and then a fixed value is set to</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+   * all subsequent instances so that it does not need to be recalculated each</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+   * time. If the value has not yet been set, this will return a new instance.</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+   */</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+  attribute msgIDelegateList methodsToDelegate;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+  /**</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+   * JavaScript-based xpcom object that overrides C++ methods.</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+   */</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  attribute nsISupports jsDelegate;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  /**</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+   * C++ class used to implement default functionality. This is used when</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+   * JavaScript methods want to call the base class default action, bypassing a</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+   * possible JS override.</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+   */</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+  readonly attribute nsISupports cppBase;</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/jsaccount/public/msgJsAccountCID.h</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,16 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+/* vim: set ts=8 sts=2 et sw=2 tw=80: */</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+// Contains the definitions of contract IDs for modules in JsAccounts.</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+#ifndef _msgJsAccountCID_H_</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+#define _msgJsAccountCID_H_</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+#define JACPPURLDELEGATOR_CID \</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+{ 0x1a0b778c, 0x2fe6, 0x4012, { 0xb4, 0xf3, 0xe8, 0x1c, 0xc, 0x11, 0x64, 0x9 } }</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+#define JACPPURLDELEGATOR_CONTRACTID &quot;@mozilla.org/jacppurldelegator;1&quot;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mailnews/jsaccount/readme.html</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,56 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+&lt;html&gt;</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+    &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+    &lt;title&gt;JsAccount Usage and Architecture&lt;/title&gt;</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+  &lt;body&gt;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+    &lt;h1&gt;Overview&lt;/h1&gt;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    &lt;p&gt;JsAccount is a technology that allows message account types to be created</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+      in Mozilla Mailnews code using JavaScript. Although this is primarily</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+      targeted at allowing extensions to create new accounts, it might also be</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+      useful as a bridge to convert existing account types from being C++ based</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+      to JavaScript based.&lt;/p&gt;</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+    &lt;h2&gt;Existing C++-based architecture of mailnews accounts&lt;/h2&gt;</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+    &lt;p&gt;In mailnews code, an account type is a set of classes that allow</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+      implementation of a messaging particular protocol. The account type is</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+      given a short string identifier (&quot;imap&quot;, &quot;news&quot;, &quot;pop3&quot;) and is then used</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+      to create objects of the appropriate type by appending that string to the</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+      end of a base XPCOM contractID. So, for example, to create an imap server,</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+      you generate a contractID using a base ID,</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+      NS_MSGINCOMINGSERVER_CONTRACTID_PREFIX</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+      &quot;@mozilla.org/messenger/server;1?type=&quot;, then append &quot;imap&quot; to get:&lt;/p&gt;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+    &lt;p&gt;@mozilla.org/messenger/server;1?type=imap&lt;/p&gt;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+    &lt;p&gt;In the C++ code, there is a base object implementing shared</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+      functionality. An account-specific class inherits that base functionality,</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+      then extends it to represent the account-specific behavior that is needed.</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+      This same basic concept is used to represent a whole series of classes</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+      that are necessary to implement a specific mailnews account type.&lt;/p&gt;</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+    &lt;p&gt;For the server example, there is a base class named</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+      nsMsgIncomingServer.cpp that implements that base interface</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+      nsIMsgIncomingServer.idl. For imap, there is a specific class</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+      nsImapIncomingServer.cpp that inherits from nsMsgIncomingServer.cpp,</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+      overrides some of the methods in nsIMsgIncomingServer.idl, and also</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+      implements an imap-specific interface nsIImapIncomingServer.idl. All of</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+      this works fine using C++ inheritance and polymorphism.&lt;/p&gt;</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+    &lt;p&gt;Although JsAccount is intended mostly for mailnews accounts, the same</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+      basic method of using a base class extended for specific types is also used</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+      in other ways in mailnews code, including for addressbook types and views.</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+      The technology may also be applied to those other object types as well.&lt;/p&gt;</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+    &lt;h2&gt;Role of JsAccount&lt;/h2&gt;</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+    &lt;p&gt;The JavaScript class system works very differently than the C++ system,</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+      and you cannot use normal language constructs to override a C++ class with</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+      a JavaScript class. What JsAccount allows you to do is to create XPCOM</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+      objects in JavaScript, and use those objects to override or extend the</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+      methods from the C++ base class in a way that will function correctly</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+      whether those objects are executed from within C++ code or JavaScript</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+      code. This allows you to create a new account using JavaScript code, while</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+      using the same base class functionality that is used by the core C++</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+      account types. Thus a new account type may be created in JavaScript-based</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+      extension. The technology may also be used to create JavaScript</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+      versions of existing account types in an incremental manner, slowly</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+      converting methods from C++ to JavaScript.&lt;/p&gt;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+    &lt;p&gt;&lt;br&gt;</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+    &lt;/p&gt;</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mailnews/jsaccount/src/DelegateList.cpp</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,33 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+/* vim: set ts=8 sts=2 et sw=2 tw=80: */</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+#include &quot;DelegateList.h&quot;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+// This class is used within JsAccount to allow static storage of a list</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+// of methods to be overridden by JS implementations, in a way that can</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+// be stored and manipulated in JS, but used efficiently in C++.</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+namespace mozilla {</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+namespace mailnews {</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+NS_IMPL_ISUPPORTS(DelegateList, msgIDelegateList)</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+NS_IMETHODIMP DelegateList::Add(const char *aMethodName)</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+{</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+  // __FUNCTION__ is the undecorated function name in gcc, but decorated in</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+  // Windows. __func__ will resolve this when supported in VS 2015.</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+  nsCString prettyFunction;</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+#if defined (_MSC_VER)</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+  prettyFunction.Append(mPrefix);</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+#endif</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+  prettyFunction.Append(nsDependentCString(aMethodName));</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+  mMethods.Put(prettyFunction, true);</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+  return NS_OK;</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+}</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+} // namespace mailnews</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+} // namespace mozilla</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mailnews/jsaccount/src/DelegateList.h</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,52 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+/* vim: set ts=8 sts=2 et sw=2 tw=80: */</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+#ifndef _DelegateList_H_</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+#define _DelegateList_H_</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+#include &quot;nsISupports.h&quot;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+#include &quot;msgIDelegateList.h&quot;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+#include &quot;nsDataHashtable.h&quot;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+namespace mozilla {</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+namespace mailnews {</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+// This class provides a list of method names to delegate to another object.</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+class DelegateList : public msgIDelegateList</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+{</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+public:</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+  NS_DECL_ISUPPORTS</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineplus">+  NS_DECL_MSGIDELEGATELIST</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+  DelegateList(const char *aWindowsPrefix) :</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+    mPrefix(aWindowsPrefix)</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+  { }</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+  nsDataHashtable&lt;nsCStringHashKey, bool&gt; mMethods;</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+protected:</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+  virtual ~DelegateList() { }</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  nsCString mPrefix; // Windows decorated method prefix.</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+};</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+} // namespace mailnews</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+} // namespace mozilla</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineplus">+/*</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+ * This macro is used in forwarding functions.</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+ *   _interface: the interface being forwarded.</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+ *   _jsdelegate: the name of the JS pointer that implements a particular</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+ *                interface.</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+ *</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+ * You must follow the naming convention:</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineplus">+ *   1) use mCppBase as the name of the C++ base class instance.</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+ *   2) use mMethod as the name of the DelegateList object.</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+ **/</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+#define DELEGATE_JS(_interface, _jsdelegate) (\</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+    _jsdelegate &amp;&amp; mMethods &amp;&amp; \</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+    mMethods-&gt;Contains(nsLiteralCString(__FUNCTION__)) ? \</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+       _jsdelegate : nsCOMPtr&lt;_interface&gt;(do_QueryInterface(mCppBase)))</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mailnews/jsaccount/src/JaUrl.cpp</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,198 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+/* vim: set ts=8 sts=2 et sw=2 tw=80: */</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+#include &quot;JaUrl.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+#include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+#include &quot;nsIMessenger.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+#include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+#include &quot;nsISupportsUtils.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+#include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+// This file contains an implementation of mailnews URLs in JsAccount.</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+namespace mozilla {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+namespace mailnews {</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+NS_IMPL_ISUPPORTS_INHERITED(JaBaseCppUrl, nsMsgMailNewsUrl,</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+                            nsIMsgMessageUrl,</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+                            nsIInterfaceRequestor)</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+// nsIMsgMailNewsUrl overrides</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetFolder(nsIMsgFolder **aFolder)</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+{</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  NS_IF_ADDREF(*aFolder = mFolder);</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+}</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::SetFolder(nsIMsgFolder *aFolder)</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+{</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+  mFolder = aFolder;</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+}</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+// nsIMsgMessageUrl implementation</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetUri(char **aUri)</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+{</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+  if (!mUri.IsEmpty())</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+    *aUri = ToNewCString(mUri);</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+  else</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+    return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+}</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::SetUri(const char *aUri)</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+{</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+  mUri = aUri;</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+}</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetMessageFile(nsIFile **aMessageFile)</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+{</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aMessageFile);</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+  NS_IF_ADDREF(*aMessageFile = mMessageFile);</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+}</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::SetMessageFile(nsIFile *aMessageFile)</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+{</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+  mMessageFile = aMessageFile;</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+}</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetAddDummyEnvelope(bool *aAddDummyEnvelope)</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+{</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+    return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+}</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::SetAddDummyEnvelope(bool aAddDummyEnvelope)</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+{</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+    return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+}</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetCanonicalLineEnding(bool *aCanonicalLineEnding)</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+{</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aCanonicalLineEnding);</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+  *aCanonicalLineEnding = mCanonicalLineEnding;</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+}</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::SetCanonicalLineEnding(bool aCanonicalLineEnding)</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+{</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+  mCanonicalLineEnding = aCanonicalLineEnding;</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineplus">+}</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetOriginalSpec(char **aOriginalSpec)</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+{</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+  if (!aOriginalSpec || mOriginalSpec.IsEmpty())</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+    return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+  *aOriginalSpec = ToNewCString(mOriginalSpec);</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+}</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::SetOriginalSpec(const char *aOriginalSpec)</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+{</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+  mOriginalSpec = aOriginalSpec;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+}</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetMessageHeader(nsIMsgDBHdr **aMessageHeader)</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+{</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+  // This routine does a lookup using messenger, assumming that the message URI</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+  // has been set in mUri.</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+  NS_ENSURE_TRUE(!mUri.IsEmpty(), NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+  nsresult rv;</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+  nsCOMPtr&lt;nsIMessenger&gt; messenger(do_CreateInstance(NS_MESSENGER_CONTRACTID, &amp;rv));</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+  nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+  rv = messenger-&gt;MsgHdrFromURI(mUri, getter_AddRefs(msgHdr));</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+  msgHdr.forget(aMessageHeader);</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+}</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineplus">+</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::SetMessageHeader(nsIMsgDBHdr *aMsgHdr)</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineplus">+{</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+  return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineplus">+}</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+// nsIInterfaceRequestor implementation</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+NS_IMETHODIMP JaBaseCppUrl::GetInterface(const nsIID &amp; aIID, void **aSink)</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineplus">+{</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineplus">+  return QueryInterface(aIID, aSink);</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineplus">+}</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineplus">+</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineplus">+// Delegator</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineplus">+NS_IMPL_ISUPPORTS_INHERITED(JaCppUrlDelegator,</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineplus">+                            JaBaseCppUrl,</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineplus">+                            msgIOverride)</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineplus">+</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+// Delegator object to bypass JS method override.</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineplus">+NS_IMPL_ISUPPORTS(JaCppUrlDelegator::Super,</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+                  nsIMsgMailNewsUrl,</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+                  nsIMsgMessageUrl,</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+                  nsIURI,</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+                  nsIURL,</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+                  nsIInterfaceRequestor)</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+JaCppUrlDelegator::JaCppUrlDelegator() :</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+  mCppBase(new Super(this)),</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+  mMethods(nullptr)</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineplus">+{ }</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineplus">+</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+NS_IMETHODIMP JaCppUrlDelegator::SetMethodsToDelegate(msgIDelegateList *aDelegateList)</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineplus">+{</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineplus">+  if (!aDelegateList)</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+  {</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+    NS_WARNING(&quot;Null delegate list&quot;);</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+    return NS_ERROR_NULL_POINTER;</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineplus">+  }</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineplus">+  // We static_cast since we want to use the hash object directly.</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineplus">+  mDelegateList = static_cast&lt;DelegateList*&gt; (aDelegateList);</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineplus">+  mMethods = &amp;(mDelegateList-&gt;mMethods);</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineplus">+}</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineplus">+NS_IMETHODIMP JaCppUrlDelegator::GetMethodsToDelegate(msgIDelegateList **aDelegateList)</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineplus">+{</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+  if (!mDelegateList)</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+    mDelegateList = new DelegateList(&quot;mozilla::mailnews::JaCppUrlDelegator::&quot;);</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineplus">+  mMethods = &amp;(mDelegateList-&gt;mMethods);</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineplus">+  NS_ADDREF(*aDelegateList = mDelegateList);</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineplus">+}</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineplus">+</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineplus">+NS_IMETHODIMP JaCppUrlDelegator::SetJsDelegate(nsISupports *aJsDelegate)</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineplus">+{</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineplus">+  // If these QIs fail, then overrides are not provided for methods in that</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineplus">+  // interface, which is OK.</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineplus">+  mJsISupports = aJsDelegate;</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineplus">+  mJsIMsgMailNewsUrl = do_QueryInterface(aJsDelegate);</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineplus">+  mJsIURI = do_QueryInterface(aJsDelegate);</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineplus">+  mJsIURL = do_QueryInterface(aJsDelegate);</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+  mJsIMsgMessageUrl = do_QueryInterface(aJsDelegate);</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineplus">+  mJsIInterfaceRequestor = do_QueryInterface(aJsDelegate);</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineplus">+}</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineplus">+NS_IMETHODIMP JaCppUrlDelegator::GetJsDelegate(nsISupports **aJsDelegate)</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineplus">+{</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aJsDelegate);</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+  if (mJsISupports)</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineplus">+  {</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineplus">+    NS_ADDREF(*aJsDelegate = mJsISupports);</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineplus">+    return NS_OK;</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineplus">+  }</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+  return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+}</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineplus">+</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineplus">+NS_IMETHODIMP JaCppUrlDelegator::GetCppBase(nsISupports **aCppBase)</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineplus">+{</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; cppBaseSupports;</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineplus">+  cppBaseSupports = NS_ISUPPORTS_CAST(nsIMsgMailNewsUrl*, mCppBase);</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineplus">+  NS_ENSURE_STATE(cppBaseSupports);</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineplus">+  cppBaseSupports.forget(aCppBase);</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineplus">+</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineplus">+  return NS_OK;</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineplus">+}</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineplus">+</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineplus">+} // namespace mailnews</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineplus">+} // namespace mozilla</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/mailnews/jsaccount/src/JaUrl.h</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,117 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+/* vim: set ts=8 sts=2 et sw=2 tw=80: */</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+#ifndef _JaUrl_H_</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+#define _JaUrl_H_</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+#include &quot;DelegateList.h&quot;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+#include &quot;msgCore.h&quot;</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+#include &quot;msgIOverride.h&quot;</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+#include &quot;nsAutoPtr.h&quot;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+#include &quot;nsCycleCollectionParticipant.h&quot;</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+#include &quot;nsDataHashtable.h&quot;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+#include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+#include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+#include &quot;nsISupports.h&quot;</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+#include &quot;nsMsgMailNewsUrl.h&quot;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+#include &quot;nsWeakReference.h&quot;</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+namespace mozilla {</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+namespace mailnews {</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+/* Header file */</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+// This class is an XPCOM component, usable in JS, that calls the methods</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+// in the C++ base class (bypassing any JS override).</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+class JaBaseCppUrl : public nsMsgMailNewsUrl,</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+                     public nsIMsgMessageUrl,</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+                     public nsIInterfaceRequestor</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+{</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+public:</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+  NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+  NS_DECL_NSIMSGMESSAGEURL</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+  NS_DECL_NSIINTERFACEREQUESTOR</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+  JaBaseCppUrl() { }</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+  // nsIMsgMailNewsUrl overrides</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+  NS_IMETHOD GetFolder(nsIMsgFolder **aFolder);</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+  NS_IMETHOD SetFolder(nsIMsgFolder *aFolder);</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+protected:</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+  virtual ~JaBaseCppUrl() { }</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+  // nsIMsgMailUrl variables.</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+  nsCOMPtr&lt;nsIMsgFolder&gt; mFolder;</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+  // nsIMsgMessageUrl variables.</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+  // the uri for the original message, like ews-message://server/folder#123</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+  nsCString mUri;</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mMessageFile;</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+  bool mCanonicalLineEnding;</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+  nsCString mOriginalSpec;</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+};</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+class JaCppUrlDelegator : public JaBaseCppUrl,</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+                          public msgIOverride</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+{</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+public:</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+  NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+  NS_DECL_MSGIOVERRIDE</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+  NS_FORWARD_NSIMSGMAILNEWSURL(DELEGATE_JS(nsIMsgMailNewsUrl, mJsIMsgMailNewsUrl)-&gt;)</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+  NS_FORWARD_NSIURI(DELEGATE_JS(nsIURI, mJsIURI)-&gt;)</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+  NS_FORWARD_NSIURL(DELEGATE_JS(nsIURL, mJsIURL)-&gt;)</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+  NS_FORWARD_NSIMSGMESSAGEURL(DELEGATE_JS(nsIMsgMessageUrl, mJsIMsgMessageUrl)-&gt;)</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+  NS_FORWARD_NSIINTERFACEREQUESTOR(DELEGATE_JS(nsIInterfaceRequestor, mJsIInterfaceRequestor)-&gt;)</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+  JaCppUrlDelegator();</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+  class Super : public nsIMsgMailNewsUrl,</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+                public nsIMsgMessageUrl,</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+                public nsIInterfaceRequestor</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+  {</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+    public:</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+      Super(JaCppUrlDelegator *aFakeThis) {mFakeThis = aFakeThis;}</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+      NS_DECL_ISUPPORTS</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+      NS_FORWARD_NSIMSGMAILNEWSURL(mFakeThis-&gt;JaBaseCppUrl::)</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+      NS_FORWARD_NSIURI(mFakeThis-&gt;JaBaseCppUrl::)</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+      NS_FORWARD_NSIURL(mFakeThis-&gt;JaBaseCppUrl::)</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+      NS_FORWARD_NSIMSGMESSAGEURL(mFakeThis-&gt;JaBaseCppUrl::)</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+      NS_FORWARD_NSIINTERFACEREQUESTOR(mFakeThis-&gt;JaBaseCppUrl::)</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+    private:</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+      virtual ~Super() {}</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+      JaCppUrlDelegator *mFakeThis;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+  };</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+private:</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+  virtual ~JaCppUrlDelegator() {</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+  }</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineplus">+</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+  // Interfaces that may be overridden by JS.</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+  nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mJsIMsgMailNewsUrl;</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineplus">+  nsCOMPtr&lt;nsIURI&gt; mJsIURI;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+  nsCOMPtr&lt;nsIURL&gt; mJsIURL;</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+  nsCOMPtr&lt;nsIMsgMessageUrl&gt; mJsIMsgMessageUrl;</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+  nsCOMPtr&lt;nsIInterfaceRequestor&gt; mJsIInterfaceRequestor;</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+  // Owning reference to the JS override.</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+  nsCOMPtr&lt;nsISupports&gt; mJsISupports;</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+  // Class to bypass JS delegates. nsCOMPtr for when we do cycle collection.</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+  nsCOMPtr&lt;nsIMsgMailNewsUrl&gt; mCppBase;</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+  RefPtr&lt;DelegateList&gt; mDelegateList;</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+  nsDataHashtable&lt;nsCStringHashKey, bool&gt; *mMethods;</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+};</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+} // namespace mailnews</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+} // namespace mozilla</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/mailnews/jsaccount/src/moz.build</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,18 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+# -*- Mode: python; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+# vim: set filetype=python:</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+SOURCES += [</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+    'DelegateList.cpp',</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    'JaUrl.cpp',</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+]</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+EXPORTS += [</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+    'DelegateList.h',</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+    'JaUrl.h',</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+]</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+Library('JsAccount')</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+FINAL_LIBRARY = 'mail'</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/mailnews/jsaccount/test/idl/moz.build</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,14 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+# -*- Mode: python; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+# vim: set filetype=python:</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+# Any copyright is dedicated to the Public Domain.</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+# http://creativecommons.org/publicdomain/zero/1.0/</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+XPIDL_SOURCES += [</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+  'msgIFooUrl.idl',</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+]</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+XPIDL_MODULE = 'testJsAccount'</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+TEST_HARNESS_FILES.xpcshell.mailnews.jsaccount.test.unit.resources += [</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+    '!/dist/bin/components/testJsAccount.xpt',</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mailnews/jsaccount/test/idl/msgIFooUrl.idl</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,19 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+/* vim:set ts=2 sw=2 sts=2 et cindent: */</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+// This is a sample test interface implemented by the URL object.</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+[scriptable, uuid(12CAD9FC-57FC-4AEE-A800-895A289237DD)]</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+interface msgIFooUrl : nsISupports</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+{</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+  /// Foo id for item.</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+  attribute AString itemId;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+  /// Does this url refer to an attachment?</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+  readonly attribute boolean isAttachment;</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+  /// urlType (copy, move, display) from nsIMsgMailNewsUrl</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+  void setUrlType(in unsigned long aType);</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/mailnews/jsaccount/test/moz.build</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+# -*- Mode: python; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+# vim: set filetype=python:</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+# Any copyright is dedicated to the Public Domain.</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+# http://creativecommons.org/publicdomain/zero/1.0/</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+TEST_DIRS += [</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+    'idl',</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+]</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+XPCSHELL_TESTS_MANIFESTS += ['unit/xpcshell.ini']</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/head_jsaccount.js</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,21 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+/* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+var Cc = Components.classes;</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+var Ci = Components.interfaces;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+var Cr = Components.results;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+var CC = Components.Constructor;</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+var Cu = Components.utils;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+Cu.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+Cu.import(&quot;resource://testing-common/mailnews/mailTestUtils.js&quot;);</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+Cu.import(&quot;resource://testing-common/mailnews/localAccountUtils.js&quot;);</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+// Load the test components.</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+do_load_manifest(&quot;resources/testComponents.manifest&quot;)</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+// Ensure the profile directory is set up.</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+do_get_profile();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">new file mode 100644</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineminus">--- /dev/null</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/readme.html</span>
<a href="#l20.4"></a><span id="l20.4" class="difflineat">@@ -0,0 +1,62 @@</span>
<a href="#l20.5"></a><span id="l20.5" class="difflineplus">+&lt;!DOCTYPE html&gt;</span>
<a href="#l20.6"></a><span id="l20.6" class="difflineplus">+&lt;html&gt;</span>
<a href="#l20.7"></a><span id="l20.7" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l20.8"></a><span id="l20.8" class="difflineplus">+    &lt;meta content=&quot;text/html; charset=utf-8&quot; http-equiv=&quot;content-type&quot;&gt;</span>
<a href="#l20.9"></a><span id="l20.9" class="difflineplus">+    &lt;title&gt;JsAccount Usage and Architecture&lt;/title&gt;</span>
<a href="#l20.10"></a><span id="l20.10" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l20.11"></a><span id="l20.11" class="difflineplus">+  &lt;body&gt;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+    &lt;h2&gt;Overview of Testing Objects &lt;/h2&gt;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    This directory contains sample JS components to test the basic JsAccount</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+    concepts, which can also serve as templates for new implementations.&lt;br&gt;</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+    &lt;h3&gt;Component Naming&lt;/h3&gt;</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+    Because there are many different components involved with different roles,</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+    it will be helpful to keep things straight by using a specific naming</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+    convention for objects.</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+    For testing, we consider that we are creating a new account type &quot;foo&quot;. For</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+    the specific case of the JA implementation of an object that implements the</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+    nsIMsgMailNewsUrl interface, we'll use the following naming convention.</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+    Typically C++ classes and JS constructors are capitalized, class instances</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+    are not.&lt;br&gt;</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+    &lt;br&gt;</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+    Names are constructed with the following subparts:&lt;br&gt;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+    &lt;br&gt;</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+    (&lt;strong&gt;Ja)&lt;/strong&gt;(&lt;strong&gt;AccountType&lt;/strong&gt;)(&lt;strong&gt;Language&lt;/strong&gt;)(&lt;strong&gt;ComponentType&lt;/strong&gt;)(&lt;strong&gt;Role&lt;/strong&gt;)</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+    &lt;br&gt;</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+    &lt;h4&gt;Common parts of names&lt;/h4&gt;</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+    &lt;ul&gt;</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+      &lt;li&gt;&lt;strong&gt;Ja&lt;/strong&gt;: All objects or classes begin with Ja&lt;/li&gt;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+      &lt;li&gt;&lt;strong&gt;AccountType&lt;/strong&gt;: the type of account being created (here</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineplus">+        &lt;strong&gt;Foo&lt;/strong&gt;), or &lt;strong&gt;Base&lt;/strong&gt; for the generic</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+        implementation that is the base class of all types. May be *blank* if</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+        the object is used for both base types and specific types.&lt;/li&gt;</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+      &lt;li&gt;</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+        &lt;strong&gt;Language&lt;/strong&gt;: Use &lt;strong&gt;Cpp&lt;/strong&gt; with objects and</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+        classes implemented using C++, leave blank for JS versions.</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+      &lt;/li&gt;</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+      &lt;li&gt;</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineplus">+        &lt;strong&gt;ComponentType&lt;/strong&gt;: the standard MailNews term for objects</span>
<a href="#l20.42"></a><span id="l20.42" class="difflineplus">+        that implement a particular interface. The legacy .cpp base components</span>
<a href="#l20.43"></a><span id="l20.43" class="difflineplus">+        are typically named:&lt;br&gt;</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineplus">+        &lt;strong&gt;(nsMsg)(ComponentType&lt;/strong&gt;).cpp&lt;br&gt;</span>
<a href="#l20.45"></a><span id="l20.45" class="difflineplus">+        for example &lt;strong&gt;nsMsgIncomingServer&lt;/strong&gt;.cpp. This may be</span>
<a href="#l20.46"></a><span id="l20.46" class="difflineplus">+        shortened where appropriate, for example we use &lt;strong&gt;Url&lt;/strong&gt;</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineplus">+        instead of &lt;strong&gt;MailNewsUrl&lt;/strong&gt; as the &lt;strong&gt;Ja&lt;/strong&gt;</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+        prefix implies that this is an implementation of MailNews objects.&lt;/li&gt;</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+      &lt;li&gt;&lt;strong&gt;Role&lt;/strong&gt;: the function of the object within the JA</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+        architecture.&lt;/li&gt;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+      &lt;ul&gt;</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+        &lt;li&gt;&lt;strong&gt;Constructor&lt;/strong&gt;: Creates the object only. &lt;/li&gt;</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+        &lt;li&gt;&lt;strong&gt;Delegator&lt;/strong&gt;: Calls the appropriate object, either a</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineplus">+          JS or C++ variant, that implements a particular XPCOM method.</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+        &lt;/li&gt;</span>
<a href="#l20.56"></a><span id="l20.56" class="difflineplus">+        &lt;li&gt; &lt;strong&gt;Properties&lt;/strong&gt;: JavaScript object that establishes</span>
<a href="#l20.57"></a><span id="l20.57" class="difflineplus">+          properties of a JA implementation class. This is used for automatic</span>
<a href="#l20.58"></a><span id="l20.58" class="difflineplus">+          generation of a list of methods to delegate to the JavaScript classes.&lt;/li&gt;</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineplus">+        &lt;li&gt;(blank): Actual implementation.&lt;/li&gt;</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineplus">+      &lt;/ul&gt;</span>
<a href="#l20.61"></a><span id="l20.61" class="difflineplus">+    &lt;/ul&gt;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineplus">+    Example: The C++ class that delegates the implementation of</span>
<a href="#l20.63"></a><span id="l20.63" class="difflineplus">+    nsIMsgMailNewsUrl (abbreviated as Url) to either a C++ or JS method is</span>
<a href="#l20.64"></a><span id="l20.64" class="difflineplus">+    called &lt;strong&gt;JaCppUrlDelegator&lt;/strong&gt;.</span>
<a href="#l20.65"></a><span id="l20.65" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l20.66"></a><span id="l20.66" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- /dev/null</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testComponents.manifest</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineplus">+interfaces testJsAccount.xpt</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+component {73F98539-A59F-4F6F-9A72-D83A08646C23} testJaFooUrlComponent.js</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineplus">+contract @mozilla.org/jsaccount/testjafoourl;1 {73F98539-A59F-4F6F-9A72-D83A08646C23}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/resources/testJaFooUrlComponent.js</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,119 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+   http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+/**</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+  One of the goals of JsAccount is to be able to incrementally extend a base</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineplus">+  implementation, possibly adding a new interface. This code demonstrates</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineplus">+  a mailnews URL extended for a hypthetical account type &quot;foo&quot;.</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+**/</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+var Cc = Components.classes;</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+var Ci = Components.interfaces;</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+var Cr = Components.results;</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+var Cu = Components.utils;</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+var CE = Components.Exception;</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+Cu.import(&quot;resource://gre/modules/jsaccount/JSAccountUtils.jsm&quot;);</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+Cu.import(&quot;resource://gre/modules/jsaccount/JaBaseUrl.jsm&quot;);</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+const ATTACHMENT_QUERY = &quot;part=1.&quot;;</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+var FooUrlProperties = {</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+  // Extend the base properties.</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+  __proto__: JaBaseUrlProperties,</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+  contractID: &quot;@mozilla.org/jsaccount/testjafoourl;1&quot;,</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineplus">+  classID: Components.ID(&quot;{73F98539-A59F-4F6F-9A72-D83A08646C23}&quot;),</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+// Add an additional interface only needed by this custom class.</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+  extraInterfaces: [ Ci.msgIFooUrl ],</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineplus">+}</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+// Constructor</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+function FooUrlConstructor() {</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+}</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+// Constructor prototype (not instance prototype).</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineplus">+FooUrlConstructor.prototype = {</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineplus">+  classID: FooUrlProperties.classID,</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+  _xpcom_factory: JSAccountUtils.jaFactory(FooUrlProperties, FooUrl),</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+}</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+// Main class.</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+function FooUrl(aDelegator, aBaseInterfaces) {</span>
<a href="#l22.49"></a><span id="l22.49" class="difflineplus">+</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineplus">+  // Superclass constructor</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+  JaBaseUrl.call(this, aDelegator, aBaseInterfaces);</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineplus">+</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineplus">+  // I'm not sure why I have to call this again, as it is called in the</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineplus">+  // base constructor, but without it this method will not find the</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineplus">+  // interfaces beyond nsISupports.</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineplus">+  aBaseInterfaces.forEach(iface =&gt; this.cppBase instanceof iface);</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+  // instance variables</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineplus">+  this._urlType = -1; // unknown;</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineplus">+  this._itemId = null;</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineplus">+  this._hidden = &quot;IAmHidden&quot;;</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+}</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineplus">+// Extend the base class methods.</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+FooUrl.prototype = {</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineplus">+</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+    // Typical boilerplate to include in all implementations.</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineplus">+  // Extended the JS URL object.</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+  __proto__: JaBaseUrl.prototype,</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineplus">+  // Delegate these methods to CPP.</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineplus">+  _JsPrototypeToDelegate: true,</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineplus">+</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineplus">+    // InterfaceRequestor override, needed if extraInterfaces.</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineplus">+</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+  getInterface: function(iid) {</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineplus">+    for (let iface of FooUrlProperties.extraInterfaces) {</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+      if (iid.equals(iface))</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+        return this;</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineplus">+    }</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineplus">+    return this.delegator.QueryInterface(iid);</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineplus">+  },</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineplus">+</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineplus">+    // nsIURI overrides</span>
<a href="#l22.86"></a><span id="l22.86" class="difflineplus">+</span>
<a href="#l22.87"></a><span id="l22.87" class="difflineplus">+  // Override clone() to always make the pathname capitalized. This is useful</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineplus">+  // to test that a method called from C++, but overridden in JS, gets the JS</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineplus">+  // method, since nsMsgMailNewsUrl::CloneIgnoringRef calls Clone().</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineplus">+  clone: function()</span>
<a href="#l22.91"></a><span id="l22.91" class="difflineplus">+  {</span>
<a href="#l22.92"></a><span id="l22.92" class="difflineplus">+    let uriClone = this.cppBase.clone();</span>
<a href="#l22.93"></a><span id="l22.93" class="difflineplus">+    uriClone.path = uriClone.path.toUpperCase();</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineplus">+    return uriClone;</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineplus">+  },</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineplus">+</span>
<a href="#l22.97"></a><span id="l22.97" class="difflineplus">+    // nsIMsgMailNewsUrl overrides</span>
<a href="#l22.98"></a><span id="l22.98" class="difflineplus">+</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineplus">+  // Override to allow setting from a JS variable.</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineplus">+  IsUrlType(aType) { return aType == this._urlType;},</span>
<a href="#l22.101"></a><span id="l22.101" class="difflineplus">+</span>
<a href="#l22.102"></a><span id="l22.102" class="difflineplus">+    // msgIFooUrl implementation</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineplus">+</span>
<a href="#l22.104"></a><span id="l22.104" class="difflineplus">+  // Foo id for item.</span>
<a href="#l22.105"></a><span id="l22.105" class="difflineplus">+  // attribute AString itemId;</span>
<a href="#l22.106"></a><span id="l22.106" class="difflineplus">+  get itemId() { return this._itemId;},</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineplus">+  set itemId(aVal) {this._itemId = aVal;},</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineplus">+</span>
<a href="#l22.109"></a><span id="l22.109" class="difflineplus">+  // Does this url refer to an attachment?</span>
<a href="#l22.110"></a><span id="l22.110" class="difflineplus">+  //readonly attribute boolean isAttachment;</span>
<a href="#l22.111"></a><span id="l22.111" class="difflineplus">+  get isAttachment() {</span>
<a href="#l22.112"></a><span id="l22.112" class="difflineplus">+    // We look to see if the URL has an attachment query</span>
<a href="#l22.113"></a><span id="l22.113" class="difflineplus">+    let query = this.QueryInterface(Ci.nsIURL).query;</span>
<a href="#l22.114"></a><span id="l22.114" class="difflineplus">+    return (query &amp;&amp; query.indexOf(ATTACHMENT_QUERY) != -1);</span>
<a href="#l22.115"></a><span id="l22.115" class="difflineplus">+  },</span>
<a href="#l22.116"></a><span id="l22.116" class="difflineplus">+</span>
<a href="#l22.117"></a><span id="l22.117" class="difflineplus">+  /// urlType (copy, move, display) from nsIMsgMailNewsUrl</span>
<a href="#l22.118"></a><span id="l22.118" class="difflineplus">+  //void setUrlType(in unsigned long aType);</span>
<a href="#l22.119"></a><span id="l22.119" class="difflineplus">+  setUrlType: function(aType) { this._urlType = aType;},</span>
<a href="#l22.120"></a><span id="l22.120" class="difflineplus">+</span>
<a href="#l22.121"></a><span id="l22.121" class="difflineplus">+}</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineplus">+</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineplus">+var NSGetFactory = XPCOMUtils.generateNSGetFactory([FooUrlConstructor]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">new file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- /dev/null</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/tail_jsaccount.js</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -0,0 +1,6 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineplus">+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineplus">+/* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineplus">+</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineplus">+load(&quot;../../../resources/mailShutdown.js&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/test_componentsExist.js</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,43 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+/* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+// Tests that the components made available by JaAccount can be created with</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+// each supported interface.</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+let tests = [</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+  // JaUrl</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+              [&quot;@mozilla.org/jacppurldelegator;1&quot;, &quot;nsISupports&quot;],</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+              [&quot;@mozilla.org/jacppurldelegator;1&quot;, &quot;nsIMsgMailNewsUrl&quot;],</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+              [&quot;@mozilla.org/jacppurldelegator;1&quot;, &quot;nsIMsgMessageUrl&quot;],</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+              [&quot;@mozilla.org/jacppurldelegator;1&quot;, &quot;nsIURL&quot;],</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+              [&quot;@mozilla.org/jacppurldelegator;1&quot;, &quot;nsIURI&quot;],</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+              [&quot;@mozilla.org/jacppurldelegator;1&quot;, &quot;msgIOverride&quot;],</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+              [&quot;@mozilla.org/jacppurldelegator;1&quot;, &quot;nsIInterfaceRequestor&quot;],</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+  // FooJaUrl</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+              [&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;, &quot;nsISupports&quot;],</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+              [&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;, &quot;nsIMsgMailNewsUrl&quot;],</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+              [&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;, &quot;nsIMsgMessageUrl&quot;],</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+              [&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;, &quot;nsIURL&quot;],</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+              [&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;, &quot;nsIURI&quot;],</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+              [&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;, &quot;msgIOverride&quot;],</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+              [&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;, &quot;nsIInterfaceRequestor&quot;],</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+            ];</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+function run_test()</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+{</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+  for (let [contractID, iface] of tests) {</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+    dump('trying to create component ' + contractID +</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+         ' with interface ' + iface + '\n');</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+    try {</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+      dump(Cc[contractID] + &quot; &quot; + Ci[iface] + '\n');</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+    }</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+    catch (e) {dump(e + '\n');}</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+    let comp = Cc[contractID].createInstance(Ci[iface]);</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+    Assert.ok(comp instanceof Ci[iface]);</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineplus">+  }</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineplus">+</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">new file mode 100644</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- /dev/null</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/test_fooUrl.js</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -0,0 +1,134 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineplus">+/* -*- indent-tabs-mode: nil; js-indent-level: 2 -*- */</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineplus">+/* vim: set ts=2 et sw=2 tw=80 filetype=javascript: */</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineplus">+</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineplus">+// Tests of override functionality using a demo &quot;foo&quot; type url.</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineplus">+</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+Cu.import(&quot;resource://gre/modules/jsaccount/JaBaseUrl.jsm&quot;);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+var extraInterfaces = [</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+                       Ci.msgIFooUrl,</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+                      ];</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineplus">+</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineplus">+function newURL() {</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineplus">+  return Cc[&quot;@mozilla.org/jsaccount/testjafoourl;1&quot;]</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineplus">+           .createInstance(Ci.nsISupports);</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineplus">+}</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineplus">+</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineplus">+var tests = [</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineplus">+  function testExists() {</span>
<a href="#l25.25"></a><span id="l25.25" class="difflineplus">+    // test the existence of components and their interfaces.</span>
<a href="#l25.26"></a><span id="l25.26" class="difflineplus">+    let url = newURL();</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineplus">+    for (let iface of JaBaseUrlProperties.baseInterfaces) {</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineplus">+      Assert.ok(url instanceof iface);</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+      let urlQI = url.QueryInterface(iface);</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineplus">+      Assert.ok(urlQI);</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineplus">+    }</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+    for (let iface of extraInterfaces) {</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+      let fooUrl = url.getInterface(iface);</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+      Assert.ok(fooUrl instanceof iface);</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+      Assert.ok(fooUrl.QueryInterface(iface));</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+    }</span>
<a href="#l25.37"></a><span id="l25.37" class="difflineplus">+  },</span>
<a href="#l25.38"></a><span id="l25.38" class="difflineplus">+  function test_msgIOverride() {</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineplus">+    let url = newURL().QueryInterface(Ci.msgIOverride);</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+    // test of access to wrapped JS object</span>
<a href="#l25.41"></a><span id="l25.41" class="difflineplus">+    Assert.equal(typeof url.jsDelegate._hidden, &quot;undefined&quot;);</span>
<a href="#l25.42"></a><span id="l25.42" class="difflineplus">+    Assert.equal(url.jsDelegate.wrappedJSObject._hidden, &quot;IAmHidden&quot;);</span>
<a href="#l25.43"></a><span id="l25.43" class="difflineplus">+  },</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineplus">+  function test_nsIURI() {</span>
<a href="#l25.45"></a><span id="l25.45" class="difflineplus">+    let url = newURL().QueryInterface(Ci.nsIURI);</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineplus">+</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineplus">+    // test attributes</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineplus">+    Assert.ok(&quot;spec&quot; in url);</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineplus">+    url.spec = &quot;https://test.invalid/folder?isFoo=true&amp;someBar=theBar&quot;;</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineplus">+    Assert.equal(url.host, &quot;test.invalid&quot;);</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineplus">+</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineplus">+    // test non-attributes</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineplus">+    // url.resolve is overridden in nsMsgMailNewsUrl to only work if starts with &quot;#&quot;</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineplus">+    Assert.equal(&quot;https://test.invalid/folder?isFoo=true&amp;someBar=theBar#modules&quot;,</span>
<a href="#l25.55"></a><span id="l25.55" class="difflineplus">+                 url.resolve(&quot;#modules&quot;));</span>
<a href="#l25.56"></a><span id="l25.56" class="difflineplus">+</span>
<a href="#l25.57"></a><span id="l25.57" class="difflineplus">+    // Test JS override of method called virtually in C++.</span>
<a href="#l25.58"></a><span id="l25.58" class="difflineplus">+    // nsMsgMailNewsUrl::CloneIgnoringRef calls Clone(). We overrode the JS to</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineplus">+    // capitalize the path.</span>
<a href="#l25.60"></a><span id="l25.60" class="difflineplus">+    url.spec = &quot;https://test.invalid/folder#modules&quot;;</span>
<a href="#l25.61"></a><span id="l25.61" class="difflineplus">+    Assert.equal(url.clone().spec, &quot;https://test.invalid/FOLDER#MODULES&quot;);</span>
<a href="#l25.62"></a><span id="l25.62" class="difflineplus">+    Assert.equal(url.cloneIgnoringRef().spec, &quot;https://test.invalid/FOLDER&quot;);</span>
<a href="#l25.63"></a><span id="l25.63" class="difflineplus">+</span>
<a href="#l25.64"></a><span id="l25.64" class="difflineplus">+    // Demo of differences between the various versions of the object. The</span>
<a href="#l25.65"></a><span id="l25.65" class="difflineplus">+    // standard XPCOM constructor returns the JS implementation, as was tested</span>
<a href="#l25.66"></a><span id="l25.66" class="difflineplus">+    // above. Try the same tests using the JS delegate, which should give the</span>
<a href="#l25.67"></a><span id="l25.67" class="difflineplus">+    // same (overridden) results (overridden for clone, C++ class</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineplus">+    // for cloneIgnoringRef.</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+    let jsDelegate = url.QueryInterface(Ci.msgIOverride).jsDelegate.wrappedJSObject;</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineplus">+    Assert.equal(jsDelegate.clone().spec, &quot;https://test.invalid/FOLDER#MODULES&quot;);</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineplus">+    Assert.equal(jsDelegate.cloneIgnoringRef().spec, &quot;https://test.invalid/FOLDER&quot;);</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineplus">+</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineplus">+    // Not sure why you would want to do this, but you call also call the C++</span>
<a href="#l25.74"></a><span id="l25.74" class="difflineplus">+    // object that does delegation, and get the same result. This is actually</span>
<a href="#l25.75"></a><span id="l25.75" class="difflineplus">+    // what we expect C++ callers to see.</span>
<a href="#l25.76"></a><span id="l25.76" class="difflineplus">+    let cppDelegator = jsDelegate.delegator.QueryInterface(Ci.nsIURI);</span>
<a href="#l25.77"></a><span id="l25.77" class="difflineplus">+    Assert.equal(cppDelegator.clone().spec, &quot;https://test.invalid/FOLDER#MODULES&quot;);</span>
<a href="#l25.78"></a><span id="l25.78" class="difflineplus">+    Assert.equal(cppDelegator.cloneIgnoringRef().spec, &quot;https://test.invalid/FOLDER&quot;);</span>
<a href="#l25.79"></a><span id="l25.79" class="difflineplus">+</span>
<a href="#l25.80"></a><span id="l25.80" class="difflineplus">+    // The cppBase object will not have the overrides.</span>
<a href="#l25.81"></a><span id="l25.81" class="difflineplus">+    let cppBase = url.QueryInterface(Ci.msgIOverride).cppBase.QueryInterface(Ci.nsIURI); </span>
<a href="#l25.82"></a><span id="l25.82" class="difflineplus">+    Assert.equal(cppBase.clone().spec, &quot;https://test.invalid/folder#modules&quot;);</span>
<a href="#l25.83"></a><span id="l25.83" class="difflineplus">+</span>
<a href="#l25.84"></a><span id="l25.84" class="difflineplus">+    // But then it gets tricky. We can call cloneIgnoringRef in the C++ base</span>
<a href="#l25.85"></a><span id="l25.85" class="difflineplus">+    // but it will use the virtual clone which is overridden.</span>
<a href="#l25.86"></a><span id="l25.86" class="difflineplus">+    Assert.equal(cppBase.cloneIgnoringRef().spec, &quot;https://test.invalid/FOLDER&quot;);</span>
<a href="#l25.87"></a><span id="l25.87" class="difflineplus">+</span>
<a href="#l25.88"></a><span id="l25.88" class="difflineplus">+  },</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineplus">+  function test_nsIURL() {</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineplus">+    let url = newURL().QueryInterface(Ci.nsIURL);</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineplus">+    Assert.ok(&quot;filePath&quot; in url);</span>
<a href="#l25.92"></a><span id="l25.92" class="difflineplus">+    url.spec = &quot;https://test.invalid/folder?isFoo=true&amp;someBar=theBar&quot;;</span>
<a href="#l25.93"></a><span id="l25.93" class="difflineplus">+    Assert.equal(url.query, &quot;isFoo=true&amp;someBar=theBar&quot;);</span>
<a href="#l25.94"></a><span id="l25.94" class="difflineplus">+    // Note that I tried here to test getCommonSpec, but that does not work</span>
<a href="#l25.95"></a><span id="l25.95" class="difflineplus">+    // because nsStandardURL.cpp makes an assumption that the URL is directly</span>
<a href="#l25.96"></a><span id="l25.96" class="difflineplus">+    // an nsStandardURL.cpp.</span>
<a href="#l25.97"></a><span id="l25.97" class="difflineplus">+  },</span>
<a href="#l25.98"></a><span id="l25.98" class="difflineplus">+  function test_nsIMsgMailNewsUrl() {</span>
<a href="#l25.99"></a><span id="l25.99" class="difflineplus">+    let url = newURL().QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l25.100"></a><span id="l25.100" class="difflineplus">+    Assert.ok(&quot;msgWindow&quot; in url);</span>
<a href="#l25.101"></a><span id="l25.101" class="difflineplus">+    url.maxProgress = 23;</span>
<a href="#l25.102"></a><span id="l25.102" class="difflineplus">+    Assert.equal(url.maxProgress, 23);</span>
<a href="#l25.103"></a><span id="l25.103" class="difflineplus">+  },</span>
<a href="#l25.104"></a><span id="l25.104" class="difflineplus">+  function test_nsIMsgMessageUrl() {</span>
<a href="#l25.105"></a><span id="l25.105" class="difflineplus">+    let url = newURL().QueryInterface(Ci.nsIMsgMessageUrl);</span>
<a href="#l25.106"></a><span id="l25.106" class="difflineplus">+    Assert.ok(&quot;originalSpec&quot; in url);</span>
<a href="#l25.107"></a><span id="l25.107" class="difflineplus">+    let appDir = Services.dirsvc.get(&quot;GreD&quot;, Components.interfaces.nsIFile);</span>
<a href="#l25.108"></a><span id="l25.108" class="difflineplus">+    Assert.ok(appDir.path);</span>
<a href="#l25.109"></a><span id="l25.109" class="difflineplus">+    // test attributes</span>
<a href="#l25.110"></a><span id="l25.110" class="difflineplus">+    url.messageFile = appDir;</span>
<a href="#l25.111"></a><span id="l25.111" class="difflineplus">+    Assert.equal(url.messageFile.path, appDir.path);</span>
<a href="#l25.112"></a><span id="l25.112" class="difflineplus">+  },</span>
<a href="#l25.113"></a><span id="l25.113" class="difflineplus">+  function test_msgIFooUrl() {</span>
<a href="#l25.114"></a><span id="l25.114" class="difflineplus">+    let url = newURL().QueryInterface(Ci.nsIInterfaceRequestor);</span>
<a href="#l25.115"></a><span id="l25.115" class="difflineplus">+    let fooUrl = url.getInterface(Ci.msgIFooUrl);</span>
<a href="#l25.116"></a><span id="l25.116" class="difflineplus">+    Assert.ok(fooUrl instanceof Ci.msgIFooUrl);</span>
<a href="#l25.117"></a><span id="l25.117" class="difflineplus">+</span>
<a href="#l25.118"></a><span id="l25.118" class="difflineplus">+    fooUrl.itemId = &quot;theItemId&quot;;</span>
<a href="#l25.119"></a><span id="l25.119" class="difflineplus">+    Assert.equal(fooUrl.itemId, &quot;theItemId&quot;);</span>
<a href="#l25.120"></a><span id="l25.120" class="difflineplus">+</span>
<a href="#l25.121"></a><span id="l25.121" class="difflineplus">+    url.QueryInterface(Ci.nsIURI).spec = &quot;https://foo.invalid/bar/&quot;;</span>
<a href="#l25.122"></a><span id="l25.122" class="difflineplus">+    Assert.ok(!fooUrl.isAttachment);</span>
<a href="#l25.123"></a><span id="l25.123" class="difflineplus">+    url.QueryInterface(Ci.nsIURI).spec = &quot;https://foo.invalid/bar?part=1.4&amp;dummy=stuff&quot;;</span>
<a href="#l25.124"></a><span id="l25.124" class="difflineplus">+    Assert.ok(fooUrl.isAttachment);</span>
<a href="#l25.125"></a><span id="l25.125" class="difflineplus">+</span>
<a href="#l25.126"></a><span id="l25.126" class="difflineplus">+    let msgMailNewsUrl = url.QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l25.127"></a><span id="l25.127" class="difflineplus">+    Assert.ok(!msgMailNewsUrl.IsUrlType(Ci.nsIMsgMailNewsUrl.eMove));</span>
<a href="#l25.128"></a><span id="l25.128" class="difflineplus">+    fooUrl.setUrlType(Ci.nsIMsgMailNewsUrl.eMove);</span>
<a href="#l25.129"></a><span id="l25.129" class="difflineplus">+    Assert.ok(msgMailNewsUrl.IsUrlType(Ci.nsIMsgMailNewsUrl.eMove));</span>
<a href="#l25.130"></a><span id="l25.130" class="difflineplus">+</span>
<a href="#l25.131"></a><span id="l25.131" class="difflineplus">+  },</span>
<a href="#l25.132"></a><span id="l25.132" class="difflineplus">+];</span>
<a href="#l25.133"></a><span id="l25.133" class="difflineplus">+</span>
<a href="#l25.134"></a><span id="l25.134" class="difflineplus">+function run_test()</span>
<a href="#l25.135"></a><span id="l25.135" class="difflineplus">+{</span>
<a href="#l25.136"></a><span id="l25.136" class="difflineplus">+  for (var test of tests)</span>
<a href="#l25.137"></a><span id="l25.137" class="difflineplus">+    test();</span>
<a href="#l25.138"></a><span id="l25.138" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">new file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- /dev/null</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ b/mailnews/jsaccount/test/unit/xpcshell.ini</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -0,0 +1,9 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineplus">+# Any copyright is dedicated to the Public Domain.</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineplus">+# http://creativecommons.org/publicdomain/zero/1.0/</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineplus">+</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineplus">+[DEFAULT]</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineplus">+head = head_jsaccount.js</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineplus">+tail = tail_jsaccount.js</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+support-files = resources/*</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+[test_componentsExist.js]</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+[test_fooUrl.js]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/moz.build</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/moz.build</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -12,16 +12,17 @@ DIRS += [</span>
<a href="#l27.4"></a><span id="l27.4">     'extensions',</span>
<a href="#l27.5"></a><span id="l27.5">     'imap/public',</span>
<a href="#l27.6"></a><span id="l27.6">     'imap/src',</span>
<a href="#l27.7"></a><span id="l27.7">     'import/public',</span>
<a href="#l27.8"></a><span id="l27.8">     'import/src',</span>
<a href="#l27.9"></a><span id="l27.9">     'import/text/src',</span>
<a href="#l27.10"></a><span id="l27.10">     'import/vcard/src',</span>
<a href="#l27.11"></a><span id="l27.11">     'intl',</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+    'jsaccount',</span>
<a href="#l27.13"></a><span id="l27.13">     'local/public',</span>
<a href="#l27.14"></a><span id="l27.14">     'local/src',</span>
<a href="#l27.15"></a><span id="l27.15">     'mime',</span>
<a href="#l27.16"></a><span id="l27.16">     'news',</span>
<a href="#l27.17"></a><span id="l27.17"> ]</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19"> if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'cocoa':</span>
<a href="#l27.20"></a><span id="l27.20">     DIRS += [</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

