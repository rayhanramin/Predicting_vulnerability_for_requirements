<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21328:4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e" />
<meta property="og:url" content="/comm-central/rev/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e" />
<meta property="og:description" content="Bug 1231592 - Implement mail.server.default.forceSelect for misbehaving IMAP servers. Use UidExpunge(). r=jorgk, sr=rkent" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">shortlog</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">files</a> |
changeset |
<a href="/comm-central/raw-rev/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">raw</a>  | <a href="/comm-central/archive/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1231592">Bug 1231592</a> - Implement mail.server.default.forceSelect for misbehaving IMAP servers. Use UidExpunge(). r=jorgk, sr=rkent
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#110;&#101;&#32;&#83;&#109;&#105;&#116;&#104;&#32;&#60;&#103;&#100;&#115;&#64;&#99;&#104;&#97;&#114;&#116;&#101;&#114;&#116;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 15 Mar 2017 14:42:00 +0100</td></tr>

<tr>
 <td>changeset 21328</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e</a></td>
</tr>



<tr>
<td>parent 21327</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/04d93e773a776bb86827873ba9d7a7d1246c7458">04d93e773a776bb86827873ba9d7a7d1246c7458</a>
</td>
</tr>

<tr>
<td>child 21329</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0cf73e610aa1cfa7a7b2d9dc6b13c59a70d21e55">0cf73e610aa1cfa7a7b2d9dc6b13c59a70d21e55</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">12968</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 23 Mar 2017 00:18:33 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@4fd458dcdd4a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e&newProject=comm-central&newRevision=04d93e773a776bb86827873ba9d7a7d1246c7458&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e&newProject=comm-central&newRevision=04d93e773a776bb86827873ba9d7a7d1246c7458&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e&newProject=comm-central&newRevision=04d93e773a776bb86827873ba9d7a7d1246c7458&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a>, <a href="/comm-central/log?rev=reviewer%28rkent%29&revcount=50">rkent</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1231592">1231592</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1231592">Bug 1231592</a> - Implement mail.server.default.forceSelect for misbehaving IMAP servers. Use UidExpunge(). r=jorgk, sr=rkent</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">mail/locales/en-US/chrome/messenger/am-server-advanced.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server-advanced.xul">mailnews/base/prefs/content/am-server-advanced.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server-advanced.xul">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server-advanced.xul">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server-advanced.xul">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server-advanced.xul">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server-advanced.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.js">mailnews/base/prefs/content/am-server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.js">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.js">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.js">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.js">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.xul">mailnews/base/prefs/content/am-server.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.xul">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.xul">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.xul">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.xul">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/base/prefs/content/am-server.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/public/nsIImapIncomingServer.idl">mailnews/imap/public/nsIImapIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/public/nsIImapIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/public/nsIImapIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/public/nsIImapIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/public/nsIImapIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/public/nsIImapIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapIncomingServer.cpp">mailnews/imap/src/nsImapIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.h">mailnews/imap/src/nsImapProtocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.h">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.h">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.h">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.h">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/imap/src/nsImapProtocol.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/mailnews.js">mailnews/mailnews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/mailnews.js">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/mailnews.js">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/mailnews.js">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/mailnews.js">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/mailnews/mailnews.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">file</a> |
<a href="/comm-central/annotate/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">annotate</a> |
<a href="/comm-central/diff/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">diff</a> |
<a href="/comm-central/comparison/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">comparison</a> |
<a href="/comm-central/log/4fd458dcdd4a95a833e577ed0ef2e2b0d176b85e/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/am-server-advanced.dtd</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -7,16 +7,19 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;!ENTITY serverDirectory.label &quot;IMAP server directory:&quot;&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> &lt;!ENTITY serverDirectory.accesskey &quot;d&quot;&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> &lt;!ENTITY usingSubscription.label &quot;Show only subscribed folders&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> &lt;!ENTITY usingSubscription.accesskey &quot;w&quot;&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> &lt;!ENTITY dualUseFolders.label &quot;Server supports folders that contain sub-folders and messages&quot;&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> &lt;!ENTITY dualUseFolders.accesskey &quot;f&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> &lt;!ENTITY maximumConnectionsNumber.label &quot;Maximum number of server connections to cache&quot;&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> &lt;!ENTITY maximumConnectionsNumber.accesskey &quot;M&quot;&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+&lt;!ENTITY forceSelect.label &quot;Send IMAP select to server when checking for new mail&quot;&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+&lt;!ENTITY forceSelect.tooltip &quot;Some servers need an additional IMAP select so new email is reliably received, or is shown as read after it has been read on another device. Selecting this option will cause some increased network traffic.&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+&lt;!ENTITY forceSelect.accesskey &quot;F&quot;&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;!-- LOCALIZATION NOTE (namespaceDesc.label): Do not translate &quot;IMAP&quot; --&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> &lt;!ENTITY namespaceDesc.label &quot;These preferences specify the namespaces on your IMAP server&quot;&gt;</span>
<a href="#l1.17"></a><span id="l1.17"> &lt;!ENTITY personalNamespace.label &quot;Personal namespace:&quot;&gt;</span>
<a href="#l1.18"></a><span id="l1.18"> &lt;!ENTITY personalNamespace.accesskey &quot;P&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19"> &lt;!ENTITY publicNamespace.label &quot;Public (shared):&quot;&gt;</span>
<a href="#l1.20"></a><span id="l1.20"> &lt;!ENTITY publicNamespace.accesskey &quot;u&quot;&gt;</span>
<a href="#l1.21"></a><span id="l1.21"> &lt;!ENTITY otherUsersNamespace.label &quot;Other Users:&quot;&gt;</span>
<a href="#l1.22"></a><span id="l1.22"> &lt;!ENTITY otherUsersNamespace.accesskey &quot;O&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server-advanced.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -92,16 +92,22 @@</span>
<a href="#l2.4"></a><span id="l2.4">           &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l2.5"></a><span id="l2.5">             &lt;separator class=&quot;indent&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6">             &lt;checkbox amsa_persist=&quot;true&quot; id=&quot;overrideNamespaces&quot;</span>
<a href="#l2.7"></a><span id="l2.7">                       label=&quot;&amp;overrideNamespaces.label;&quot;</span>
<a href="#l2.8"></a><span id="l2.8">                       accesskey=&quot;&amp;overrideNamespaces.accesskey;&quot;/&gt;</span>
<a href="#l2.9"></a><span id="l2.9">           &lt;/row&gt;</span>
<a href="#l2.10"></a><span id="l2.10">         &lt;/rows&gt;</span>
<a href="#l2.11"></a><span id="l2.11">       &lt;/grid&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+      &lt;separator class=&quot;groove&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+      &lt;checkbox amsa_persist=&quot;true&quot; id=&quot;forceSelect&quot;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+                label=&quot;&amp;forceSelect.label;&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+                tooltiptext=&quot;&amp;forceSelect.tooltip;&quot;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+                accesskey=&quot;&amp;forceSelect.accesskey;&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18">     &lt;/vbox&gt;</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">     &lt;!-- POP3 Panel --&gt;</span>
<a href="#l2.22"></a><span id="l2.22">     &lt;vbox id=&quot;pop3Panel&quot;&gt;</span>
<a href="#l2.23"></a><span id="l2.23">       &lt;label flex=&quot;1&quot; control=&quot;folderStorage&quot;&gt;&amp;pop3DeferringDesc.label;&lt;/label&gt;</span>
<a href="#l2.24"></a><span id="l2.24">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.25"></a><span id="l2.25">         &lt;radiogroup id=&quot;folderStorage&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -128,16 +128,17 @@ function onAdvanced()</span>
<a href="#l3.4"></a><span id="l3.4">   serverSettings.serverPrettyName = gServer.prettyName;</span>
<a href="#l3.5"></a><span id="l3.5">   serverSettings.account = top.getCurrentAccount();</span>
<a href="#l3.6"></a><span id="l3.6"> </span>
<a href="#l3.7"></a><span id="l3.7">   if (serverType == &quot;imap&quot;)</span>
<a href="#l3.8"></a><span id="l3.8">   {</span>
<a href="#l3.9"></a><span id="l3.9">     serverSettings.dualUseFolders = document.getElementById(&quot;imap.dualUseFolders&quot;).checked;</span>
<a href="#l3.10"></a><span id="l3.10">     serverSettings.usingSubscription = document.getElementById(&quot;imap.usingSubscription&quot;).checked;</span>
<a href="#l3.11"></a><span id="l3.11">     serverSettings.maximumConnectionsNumber = document.getElementById(&quot;imap.maximumConnectionsNumber&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    serverSettings.forceSelect = document.getElementById(&quot;imap.forceSelect&quot;).checked;</span>
<a href="#l3.13"></a><span id="l3.13">     // string prefs</span>
<a href="#l3.14"></a><span id="l3.14">     serverSettings.personalNamespace = document.getElementById(&quot;imap.personalNamespace&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.15"></a><span id="l3.15">     serverSettings.publicNamespace = document.getElementById(&quot;imap.publicNamespace&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">     serverSettings.serverDirectory = document.getElementById(&quot;imap.serverDirectory&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.17"></a><span id="l3.17">     serverSettings.otherUsersNamespace = document.getElementById(&quot;imap.otherUsersNamespace&quot;).getAttribute(&quot;value&quot;);</span>
<a href="#l3.18"></a><span id="l3.18">     serverSettings.overrideNamespaces = document.getElementById(&quot;imap.overrideNamespaces&quot;).checked;</span>
<a href="#l3.19"></a><span id="l3.19">   }</span>
<a href="#l3.20"></a><span id="l3.20">   else if (serverType == &quot;pop3&quot;)</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -149,16 +150,17 @@ function onAdvanced()</span>
<a href="#l3.22"></a><span id="l3.22">   window.openDialog(&quot;chrome://messenger/content/am-server-advanced.xul&quot;,</span>
<a href="#l3.23"></a><span id="l3.23">                     &quot;_blank&quot;, &quot;chrome,modal,titlebar&quot;, serverSettings);</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">   if (serverType == &quot;imap&quot;)</span>
<a href="#l3.26"></a><span id="l3.26">   {</span>
<a href="#l3.27"></a><span id="l3.27">     document.getElementById(&quot;imap.dualUseFolders&quot;).checked = serverSettings.dualUseFolders;</span>
<a href="#l3.28"></a><span id="l3.28">     document.getElementById(&quot;imap.usingSubscription&quot;).checked = serverSettings.usingSubscription;</span>
<a href="#l3.29"></a><span id="l3.29">     document.getElementById(&quot;imap.maximumConnectionsNumber&quot;).setAttribute(&quot;value&quot;, serverSettings.maximumConnectionsNumber);</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+    document.getElementById(&quot;imap.forceSelect&quot;).checked = serverSettings.forceSelect;</span>
<a href="#l3.31"></a><span id="l3.31">     // string prefs</span>
<a href="#l3.32"></a><span id="l3.32">     document.getElementById(&quot;imap.personalNamespace&quot;).setAttribute(&quot;value&quot;, serverSettings.personalNamespace);</span>
<a href="#l3.33"></a><span id="l3.33">     document.getElementById(&quot;imap.publicNamespace&quot;).setAttribute(&quot;value&quot;, serverSettings.publicNamespace);</span>
<a href="#l3.34"></a><span id="l3.34">     document.getElementById(&quot;imap.serverDirectory&quot;).setAttribute(&quot;value&quot;, serverSettings.serverDirectory);</span>
<a href="#l3.35"></a><span id="l3.35">     document.getElementById(&quot;imap.otherUsersNamespace&quot;).setAttribute(&quot;value&quot;, serverSettings.otherUsersNamespace);</span>
<a href="#l3.36"></a><span id="l3.36">     document.getElementById(&quot;imap.overrideNamespaces&quot;).checked = serverSettings.overrideNamespaces;</span>
<a href="#l3.37"></a><span id="l3.37">   }</span>
<a href="#l3.38"></a><span id="l3.38">   else if (serverType == &quot;pop3&quot;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-server.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -323,16 +323,19 @@</span>
<a href="#l4.4"></a><span id="l4.4">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.maximumConnectionsNumber&quot;/&gt;</span>
<a href="#l4.5"></a><span id="l4.5">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.personalNamespace&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.publicNamespace&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.otherUsersNamespace&quot;/&gt;</span>
<a href="#l4.8"></a><span id="l4.8">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.serverDirectory&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9">       &lt;checkbox hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.overrideNamespaces&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                 prefattribute=&quot;value&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                 prefstring=&quot;mail.server.%serverkey%.override_namespaces&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+      &lt;checkbox hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;imap.forceSelect&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                prefattribute=&quot;value&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                prefstring=&quot;mail.server.%serverkey%.forceSelect&quot;/&gt;</span>
<a href="#l4.15"></a><span id="l4.15">     &lt;/hbox&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17">     &lt;!-- NNTP --&gt;</span>
<a href="#l4.18"></a><span id="l4.18">     &lt;hbox hidefor=&quot;pop3,imap,movemail&quot; align=&quot;center&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19">       &lt;checkbox wsm_persist=&quot;true&quot; id=&quot;nntp.notifyOn&quot;</span>
<a href="#l4.20"></a><span id="l4.20">                 label=&quot;&amp;maxMessagesStart.label;&quot;</span>
<a href="#l4.21"></a><span id="l4.21">                 accesskey=&quot;&amp;maxMessagesStart.accesskey;&quot;</span>
<a href="#l4.22"></a><span id="l4.22">                 oncommand=&quot;onCheckItem('nntp.maxArticles', [this.id]);&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/imap/public/nsIImapIncomingServer.idl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/imap/public/nsIImapIncomingServer.idl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -20,16 +20,17 @@ interface nsMsgImapDeleteModels</span>
<a href="#l5.4"></a><span id="l5.4">   const long MoveToTrash = 1;   /* delete moves message to the trash */</span>
<a href="#l5.5"></a><span id="l5.5">   const long DeleteNoTrash = 2; /* delete is shift delete - don't create or use trash */</span>
<a href="#l5.6"></a><span id="l5.6"> };</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> [scriptable, uuid(ea6a0765-07b8-40df-924c-9004ed707251)]</span>
<a href="#l5.9"></a><span id="l5.9"> interface nsIImapIncomingServer : nsISupports {</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   attribute long maximumConnectionsNumber;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+  attribute boolean forceSelect;</span>
<a href="#l5.13"></a><span id="l5.13">   attribute long timeOutLimits;</span>
<a href="#l5.14"></a><span id="l5.14">   attribute ACString adminUrl;</span>
<a href="#l5.15"></a><span id="l5.15">   attribute ACString serverDirectory;</span>
<a href="#l5.16"></a><span id="l5.16">   /// RFC 2971 ID response stored as a pref</span>
<a href="#l5.17"></a><span id="l5.17">   attribute ACString serverIDPref;</span>
<a href="#l5.18"></a><span id="l5.18">   attribute boolean cleanupInboxOnExit;</span>
<a href="#l5.19"></a><span id="l5.19">   attribute nsMsgImapDeleteModel deleteModel;</span>
<a href="#l5.20"></a><span id="l5.20">   attribute boolean dualUseFolders;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -271,16 +271,19 @@ nsImapIncomingServer::GetMaximumConnecti</span>
<a href="#l6.4"></a><span id="l6.4"> }</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> NS_IMETHODIMP</span>
<a href="#l6.7"></a><span id="l6.7"> nsImapIncomingServer::SetMaximumConnectionsNumber(int32_t aMaxConnections)</span>
<a href="#l6.8"></a><span id="l6.8"> {</span>
<a href="#l6.9"></a><span id="l6.9">   return SetIntValue(&quot;max_cached_connections&quot;, aMaxConnections);</span>
<a href="#l6.10"></a><span id="l6.10"> }</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, ForceSelect,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                        &quot;forceSelect&quot;)</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15"> NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, DualUseFolders,</span>
<a href="#l6.16"></a><span id="l6.16">                         &quot;dual_use_folders&quot;)</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18"> NS_IMPL_SERVERPREF_STR(nsImapIncomingServer, AdminUrl,</span>
<a href="#l6.19"></a><span id="l6.19">                        &quot;admin_url&quot;)</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21"> NS_IMPL_SERVERPREF_BOOL(nsImapIncomingServer, CleanupInboxOnExit,</span>
<a href="#l6.22"></a><span id="l6.22">                         &quot;cleanup_inbox_on_exit&quot;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -537,16 +537,17 @@ nsImapProtocol::Initialize(nsIImapHostSe</span>
<a href="#l7.4"></a><span id="l7.4">   nsresult rv = m_downloadLineCache-&gt;GrowBuffer(kDownLoadCacheSize);</span>
<a href="#l7.5"></a><span id="l7.5">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   m_flagState = new nsImapFlagAndUidState(kImapFlagAndUidStateSize);</span>
<a href="#l7.8"></a><span id="l7.8">   if (!m_flagState)</span>
<a href="#l7.9"></a><span id="l7.9">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">   aServer-&gt;GetUseIdle(&amp;m_useIdle);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  aServer-&gt;GetForceSelect(&amp;m_forceSelect);</span>
<a href="#l7.13"></a><span id="l7.13">   aServer-&gt;GetUseCondStore(&amp;m_useCondStore);</span>
<a href="#l7.14"></a><span id="l7.14">   aServer-&gt;GetUseCompressDeflate(&amp;m_useCompressDeflate);</span>
<a href="#l7.15"></a><span id="l7.15">   NS_ADDREF(m_flagState);</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17">   m_hostSessionList = aHostSessionList; // no ref count...host session list has life time &gt; connection</span>
<a href="#l7.18"></a><span id="l7.18">   m_parser.SetHostSessionList(aHostSessionList);</span>
<a href="#l7.19"></a><span id="l7.19">   m_parser.SetFlagState(m_flagState);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21" class="difflineat">@@ -2541,16 +2542,27 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l7.22"></a><span id="l7.22">         }</span>
<a href="#l7.23"></a><span id="l7.23">         HeaderFetchCompleted();</span>
<a href="#l7.24"></a><span id="l7.24">       }</span>
<a href="#l7.25"></a><span id="l7.25">       else</span>
<a href="#l7.26"></a><span id="l7.26">       {</span>
<a href="#l7.27"></a><span id="l7.27">         // get new message counts, if any, from server</span>
<a href="#l7.28"></a><span id="l7.28">         if (m_needNoop)</span>
<a href="#l7.29"></a><span id="l7.29">         {</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+          // For some IMAP servers, to detect new email we must send imap</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+          // SELECT even if already SELECTed on the same mailbox. For other</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+          // servers that simply don't support IDLE, doing select here will</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+          // cause emails to be properly marked &quot;read&quot; after they have been</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+          // read in another email client.</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+          if (m_forceSelect)</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+          {</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+            SelectMailbox(mailboxName.get());</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+            selectIssued = true;</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+          }</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+</span>
<a href="#l7.41"></a><span id="l7.41">           m_noopCount++;</span>
<a href="#l7.42"></a><span id="l7.42">           if ((gPromoteNoopToCheckCount &gt; 0 &amp;&amp; (m_noopCount % gPromoteNoopToCheckCount) == 0) ||</span>
<a href="#l7.43"></a><span id="l7.43">             CheckNeeded())</span>
<a href="#l7.44"></a><span id="l7.44">             Check();</span>
<a href="#l7.45"></a><span id="l7.45">           else</span>
<a href="#l7.46"></a><span id="l7.46">             Noop(); // I think this is needed when we're using a cached connection</span>
<a href="#l7.47"></a><span id="l7.47">           m_needNoop = false;</span>
<a href="#l7.48"></a><span id="l7.48">         }</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineat">@@ -3003,30 +3015,47 @@ void nsImapProtocol::ProcessSelectedStat</span>
<a href="#l7.50"></a><span id="l7.50">             if (DeathSignalReceived())</span>
<a href="#l7.51"></a><span id="l7.51">               copyState = ImapOnlineCopyStateType::kInterruptedState;</span>
<a href="#l7.52"></a><span id="l7.52">             else</span>
<a href="#l7.53"></a><span id="l7.53">               copyState = GetServerStateParser().LastCommandSuccessful() ?</span>
<a href="#l7.54"></a><span id="l7.54">               (ImapOnlineCopyState) ImapOnlineCopyStateType::kSuccessfulCopy :</span>
<a href="#l7.55"></a><span id="l7.55">             (ImapOnlineCopyState) ImapOnlineCopyStateType::kFailedCopy;</span>
<a href="#l7.56"></a><span id="l7.56">             if (m_imapMailFolderSink)</span>
<a href="#l7.57"></a><span id="l7.57">               m_imapMailFolderSink-&gt;OnlineCopyCompleted(this, copyState);</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-            // Don't mark msg 'Deleted' for aol servers since we already issued 'xaol-move' cmd.</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+            // Don't mark message 'Deleted' for AOL servers or standard imap servers</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+            // that support MOVE since we already issued an 'xaol-move' or 'move' command.</span>
<a href="#l7.62"></a><span id="l7.62">             if (GetServerStateParser().LastCommandSuccessful() &amp;&amp;</span>
<a href="#l7.63"></a><span id="l7.63">               (m_imapAction == nsIImapUrl::nsImapOnlineMove) &amp;&amp;</span>
<a href="#l7.64"></a><span id="l7.64">               !(GetServerStateParser().ServerIsAOLServer() ||</span>
<a href="#l7.65"></a><span id="l7.65">                 GetServerStateParser().GetCapabilityFlag() &amp; kHasMoveCapability))</span>
<a href="#l7.66"></a><span id="l7.66">             {</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+              // Simulate MOVE for servers that don't support MOVE: do COPY-DELETE-EXPUNGE.</span>
<a href="#l7.68"></a><span id="l7.68">               Store(messageIdString, &quot;+FLAGS (\\Deleted \\Seen)&quot;,</span>
<a href="#l7.69"></a><span id="l7.69">                 bMessageIdsAreUids);</span>
<a href="#l7.70"></a><span id="l7.70">               bool storeSuccessful = GetServerStateParser().LastCommandSuccessful();</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-              if (gExpungeAfterDelete &amp;&amp; storeSuccessful)</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-                Expunge();</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+              if (storeSuccessful)</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineplus">+              {</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineplus">+                if(gExpungeAfterDelete)</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineplus">+                {</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineplus">+                  // This will expunge all emails marked as deleted in mailbox,</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+                  // not just the ones marked as deleted above.</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineplus">+                  Expunge();</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineplus">+                }</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineplus">+                else</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineplus">+                {</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineplus">+                  // Check if UIDPLUS capable so we can just expunge emails we just</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+                  // copied and marked as deleted. This prevents expunging emails</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+                  // that other clients may have marked as deleted in the mailbox</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+                  // and don't want them to disappear.</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+                  if (GetServerStateParser().GetCapabilityFlag() &amp; kUidplusCapability)</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+                  {</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+                    UidExpunge(messageIdString);</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineplus">+                  }</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineplus">+                }</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineplus">+              }</span>
<a href="#l7.95"></a><span id="l7.95">               if (m_imapMailFolderSink)</span>
<a href="#l7.96"></a><span id="l7.96">               {</span>
<a href="#l7.97"></a><span id="l7.97">                 copyState = storeSuccessful ? (ImapOnlineCopyState) ImapOnlineCopyStateType::kSuccessfulDelete</span>
<a href="#l7.98"></a><span id="l7.98">                   : (ImapOnlineCopyState) ImapOnlineCopyStateType::kFailedDelete;</span>
<a href="#l7.99"></a><span id="l7.99">                 m_imapMailFolderSink-&gt;OnlineCopyCompleted(this, copyState);</span>
<a href="#l7.100"></a><span id="l7.100">               }</span>
<a href="#l7.101"></a><span id="l7.101">             }</span>
<a href="#l7.102"></a><span id="l7.102">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -647,16 +647,17 @@ private:</span>
<a href="#l8.4"></a><span id="l8.4">   bool m_needNoop;</span>
<a href="#l8.5"></a><span id="l8.5">   bool m_idle;</span>
<a href="#l8.6"></a><span id="l8.6">   bool m_useIdle;</span>
<a href="#l8.7"></a><span id="l8.7">   int32_t m_noopCount;</span>
<a href="#l8.8"></a><span id="l8.8">   bool    m_autoSubscribe, m_autoUnsubscribe, m_autoSubscribeOnOpen;</span>
<a href="#l8.9"></a><span id="l8.9">   bool m_closeNeededBeforeSelect;</span>
<a href="#l8.10"></a><span id="l8.10">   bool m_retryUrlOnError;</span>
<a href="#l8.11"></a><span id="l8.11">   bool m_preferPlainText;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+  bool m_forceSelect;</span>
<a href="#l8.13"></a><span id="l8.13"> </span>
<a href="#l8.14"></a><span id="l8.14">   int32_t m_uidValidity; // stored uid validity for the selected folder.</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">   enum EMailboxHierarchyNameState {</span>
<a href="#l8.17"></a><span id="l8.17">     kNoOperationInProgress,</span>
<a href="#l8.18"></a><span id="l8.18">       kDiscoverBaseFolderInProgress,</span>
<a href="#l8.19"></a><span id="l8.19">       kDiscoverTrashFolderInProgress,</span>
<a href="#l8.20"></a><span id="l8.20">       kDeleteSubFoldersInProgress,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/mailnews.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/mailnews.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -488,16 +488,21 @@ pref(&quot;mail.server.default.serverFilterNa</span>
<a href="#l9.4"></a><span id="l9.4"> pref(&quot;mail.server.default.serverFilterTrustFlags&quot;, 1); // 1 == trust positives, 2 == trust negatives, 3 == trust both</span>
<a href="#l9.5"></a><span id="l9.5"> pref(&quot;mail.server.default.purgeSpam&quot;, false);</span>
<a href="#l9.6"></a><span id="l9.6"> pref(&quot;mail.server.default.purgeSpamInterval&quot;, 14); // 14 days</span>
<a href="#l9.7"></a><span id="l9.7"> pref(&quot;mail.server.default.check_all_folders_for_new&quot;, false);</span>
<a href="#l9.8"></a><span id="l9.8"> // should we inhibit whitelisting of the email addresses for a server's identities?</span>
<a href="#l9.9"></a><span id="l9.9"> pref(&quot;mail.server.default.inhibitWhiteListingIdentityUser&quot;, true);</span>
<a href="#l9.10"></a><span id="l9.10"> // should we inhibit whitelisting of the domain for a server's identities?</span>
<a href="#l9.11"></a><span id="l9.11"> pref(&quot;mail.server.default.inhibitWhiteListingIdentityDomain&quot;, false);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+// When forceSelect is true, sends extra/redundant imap SELECT when checking for</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+// new mail. Needed by some imap servers. Also, if server does not support IDLE,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+// this can help insure messages are marked as &quot;read&quot; after being read in other</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+// email clients.</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+pref(&quot;mail.server.default.forceSelect&quot;, false);</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18"> // to activate auto-sync feature (preemptive message download for imap) by default</span>
<a href="#l9.19"></a><span id="l9.19"> pref(&quot;mail.server.default.autosync_offline_stores&quot;,true);</span>
<a href="#l9.20"></a><span id="l9.20"> pref(&quot;mail.server.default.offline_download&quot;,true);</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22"> // -1 means no limit, no purging of offline stores.</span>
<a href="#l9.23"></a><span id="l9.23"> pref(&quot;mail.server.default.autosync_max_age_days&quot;, -1);</span>
<a href="#l9.24"></a><span id="l9.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/am-server-advanced.dtd</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -7,16 +7,19 @@</span>
<a href="#l10.4"></a><span id="l10.4"> &lt;!ENTITY serverDirectory.label &quot;IMAP server directory:&quot;&gt;</span>
<a href="#l10.5"></a><span id="l10.5"> &lt;!ENTITY serverDirectory.accesskey &quot;d&quot;&gt;</span>
<a href="#l10.6"></a><span id="l10.6"> &lt;!ENTITY usingSubscription.label &quot;Show only subscribed folders&quot;&gt;</span>
<a href="#l10.7"></a><span id="l10.7"> &lt;!ENTITY usingSubscription.accesskey &quot;w&quot;&gt;</span>
<a href="#l10.8"></a><span id="l10.8"> &lt;!ENTITY dualUseFolders.label &quot;Server supports folders that contain sub-folders and messages&quot;&gt;</span>
<a href="#l10.9"></a><span id="l10.9"> &lt;!ENTITY dualUseFolders.accesskey &quot;f&quot;&gt;</span>
<a href="#l10.10"></a><span id="l10.10"> &lt;!ENTITY maximumConnectionsNumber.label &quot;Maximum number of server connections to cache&quot;&gt;</span>
<a href="#l10.11"></a><span id="l10.11"> &lt;!ENTITY maximumConnectionsNumber.accesskey &quot;M&quot;&gt;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+&lt;!ENTITY forceSelect.label &quot;Send IMAP select to server when checking for new mail&quot;&gt;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+&lt;!ENTITY forceSelect.tooltip &quot;Some servers need an additional IMAP select so new email is reliably received, or is shown as read after it has been read on another device. Selecting this option will cause some increased network traffic.&quot;&gt;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+&lt;!ENTITY forceSelect.accesskey &quot;F&quot;&gt;</span>
<a href="#l10.15"></a><span id="l10.15"> &lt;!-- LOCALIZATION NOTE (namespaceDesc.label): DONT_TRANSLATE &quot;IMAP&quot; --&gt;</span>
<a href="#l10.16"></a><span id="l10.16"> &lt;!ENTITY namespaceDesc.label &quot;These preferences specify the namespaces on your IMAP server&quot;&gt;</span>
<a href="#l10.17"></a><span id="l10.17"> &lt;!ENTITY personalNamespace.label &quot;Personal namespace:&quot;&gt;</span>
<a href="#l10.18"></a><span id="l10.18"> &lt;!ENTITY personalNamespace.accesskey &quot;P&quot;&gt;</span>
<a href="#l10.19"></a><span id="l10.19"> &lt;!ENTITY publicNamespace.label &quot;Public (shared):&quot;&gt;</span>
<a href="#l10.20"></a><span id="l10.20"> &lt;!ENTITY publicNamespace.accesskey &quot;u&quot;&gt;</span>
<a href="#l10.21"></a><span id="l10.21"> &lt;!ENTITY otherUsersNamespace.label &quot;Other Users:&quot;&gt;</span>
<a href="#l10.22"></a><span id="l10.22"> &lt;!ENTITY otherUsersNamespace.accesskey &quot;O&quot;&gt;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

