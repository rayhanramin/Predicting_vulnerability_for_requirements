<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27140:3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4" />
<meta property="og:url" content="/comm-central/rev/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4" />
<meta property="og:description" content="Bug 1498332 - Redesign and rearrange Thunderbird Preferences/Options similarly to Firefox. r=darktrojan, ui-r=aleca" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4">shortlog</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4">files</a> |
changeset |
<a href="/comm-central/raw-rev/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4">raw</a>  | <a href="/comm-central/archive/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498332">Bug 1498332</a> - Redesign and rearrange Thunderbird Preferences/Options similarly to Firefox. r=darktrojan, ui-r=aleca
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#105;&#99;&#104;&#97;&#114;&#100;&#32;&#77;&#97;&#114;&#116;&#105;&#32;&#60;&#114;&#105;&#99;&#104;&#97;&#114;&#100;&#46;&#109;&#97;&#114;&#116;&#105;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 03 Jul 2019 06:38:15 +0200</td></tr>

<tr>
 <td>changeset 27140</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4">3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4</a></td>
</tr>



<tr>
<td>parent 27139</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f4e5910b4eedb90f56141b617c2da533cade625e">f4e5910b4eedb90f56141b617c2da533cade625e</a>
</td>
</tr>

<tr>
<td>child 27141</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4aac8099a1ed6bd83931c4c8514b40605722a129">4aac8099a1ed6bd83931c4c8514b40605722a129</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4">16182</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 17 Jul 2019 09:04:30 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@62bf2165d66e [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=62bf2165d66e05948aed74b548f377dbc6347ce7">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=62bf2165d66e05948aed74b548f377dbc6347ce7&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=62bf2165d66e05948aed74b548f377dbc6347ce7&newProject=comm-central&newRevision=3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=62bf2165d66e05948aed74b548f377dbc6347ce7&newProject=comm-central&newRevision=3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=62bf2165d66e05948aed74b548f377dbc6347ce7&newProject=comm-central&newRevision=3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28darktrojan%29&revcount=50">darktrojan</a>, <a href="/comm-central/log?rev=reviewer%28aleca%29&revcount=50">aleca</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498332">1498332</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1498332">Bug 1498332</a> - Redesign and rearrange Thunderbird Preferences/Options similarly to Firefox. r=darktrojan, ui-r=aleca
Part 1: General pane</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/aboutPreferences.xul">mail/components/preferences/aboutPreferences.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/aboutPreferences.xul">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/aboutPreferences.xul">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/aboutPreferences.xul">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/aboutPreferences.xul">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/aboutPreferences.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.inc.xul">mail/components/preferences/advanced.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.inc.xul">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.inc.xul">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.inc.xul">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.inc.xul">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.js">mail/components/preferences/advanced.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.js">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.js">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.js">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.js">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/advanced.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.js">mail/components/preferences/applicationManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.js">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.js">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.js">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.js">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.xul">mail/components/preferences/applicationManager.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.xul">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.xul">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.xul">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.xul">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applicationManager.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.inc.xul">mail/components/preferences/applications.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.inc.xul">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.inc.xul">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.inc.xul">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.inc.xul">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.js">mail/components/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/compose.inc.xul">mail/components/preferences/compose.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/compose.inc.xul">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/compose.inc.xul">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/compose.inc.xul">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/compose.inc.xul">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/compose.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.inc.xul">mail/components/preferences/display.inc.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.inc.xul">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.inc.xul">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.js">mail/components/preferences/display.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.js">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.js">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/display.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.inc.xul">mail/components/preferences/general.inc.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.inc.xul">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.inc.xul">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.inc.xul">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.inc.xul">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.inc.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.js">mail/components/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.js">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.js">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/jar.mn">mail/components/preferences/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/jar.mn">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/jar.mn">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/jar.mn">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/jar.mn">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/preferences.js">mail/components/preferences/preferences.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/preferences.js">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/preferences.js">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/preferences.js">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/preferences.js">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/components/preferences/preferences.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">mail/locales/en-US/chrome/messenger/preferences/advanced.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/display.dtd">mail/locales/en-US/chrome/messenger/preferences/display.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/display.dtd">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/display.dtd">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/display.dtd">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/display.dtd">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/chrome/messenger/preferences/display.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/messenger/preferences/preferences.ftl">mail/locales/en-US/messenger/preferences/preferences.ftl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/messenger/preferences/preferences.ftl">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/messenger/preferences/preferences.ftl">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/messenger/preferences/preferences.ftl">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/messenger/preferences/preferences.ftl">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/locales/en-US/messenger/preferences/preferences.ftl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/linux/mail/preferences/preferences.css">mail/themes/linux/mail/preferences/preferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/linux/mail/preferences/preferences.css">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/linux/mail/preferences/preferences.css">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/linux/mail/preferences/preferences.css">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/linux/mail/preferences/preferences.css">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/linux/mail/preferences/preferences.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/osx/mail/preferences/preferences.css">mail/themes/osx/mail/preferences/preferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/osx/mail/preferences/preferences.css">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/osx/mail/preferences/preferences.css">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/osx/mail/preferences/preferences.css">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/osx/mail/preferences/preferences.css">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/osx/mail/preferences/preferences.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">mail/themes/shared/mail/incontentprefs/aboutPreferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/shared/mail/incontentprefs/aboutPreferences.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/windows/mail/preferences/preferences.css">mail/themes/windows/mail/preferences/preferences.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/windows/mail/preferences/preferences.css">file</a> |
<a href="/comm-central/annotate/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/windows/mail/preferences/preferences.css">annotate</a> |
<a href="/comm-central/diff/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/windows/mail/preferences/preferences.css">diff</a> |
<a href="/comm-central/comparison/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/windows/mail/preferences/preferences.css">comparison</a> |
<a href="/comm-central/log/3440c68aebee2244ccd45738ce2d7ffbe3e4f5d4/mail/themes/windows/mail/preferences/preferences.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/preferences/aboutPreferences.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/preferences/aboutPreferences.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -27,16 +27,19 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #ifdef XP_UNIX</span>
<a href="#l1.5"></a><span id="l1.5"> #ifndef XP_MACOSX</span>
<a href="#l1.6"></a><span id="l1.6">          title=&quot;&amp;prefWindow.titleGNOME;&quot;&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> #else</span>
<a href="#l1.8"></a><span id="l1.8">          title=&quot;&amp;prefWindow.titleMAC;&quot;&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> #endif</span>
<a href="#l1.10"></a><span id="l1.10"> #endif</span>
<a href="#l1.11"></a><span id="l1.11">   &lt;script src=&quot;chrome://global/content/preferencesBindings.js&quot;/&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+#ifdef MOZ_UPDATER</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/aboutDialog-appUpdater.js&quot;/&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+#endif</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16">   &lt;stringbundle id=&quot;bundleBrand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l1.17"></a><span id="l1.17">   &lt;stringbundle id=&quot;bundlePreferences&quot;</span>
<a href="#l1.18"></a><span id="l1.18">                 src=&quot;chrome://messenger/locale/preferences/preferences.properties&quot;/&gt;</span>
<a href="#l1.19"></a><span id="l1.19">   &lt;linkset&gt;</span>
<a href="#l1.20"></a><span id="l1.20">     &lt;html:link rel=&quot;localization&quot; href=&quot;branding/brand.ftl&quot;/&gt;</span>
<a href="#l1.21"></a><span id="l1.21">     &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/preferences/preferences.ftl&quot;/&gt;</span>
<a href="#l1.22"></a><span id="l1.22">     &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/preferences/fonts.ftl&quot;/&gt;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -59,17 +62,16 @@</span>
<a href="#l1.24"></a><span id="l1.24">             &lt;/hbox&gt;</span>
<a href="#l1.25"></a><span id="l1.25">           &lt;/label&gt;</span>
<a href="#l1.26"></a><span id="l1.26">         &lt;/hbox&gt;</span>
<a href="#l1.27"></a><span id="l1.27">       &lt;/vbox&gt;</span>
<a href="#l1.28"></a><span id="l1.28">       &lt;hbox id=&quot;preferencesContainer&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l1.29"></a><span id="l1.29">         &lt;hbox class=&quot;paneDeckContainer&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l1.30"></a><span id="l1.30">           &lt;hbox id=&quot;paneDeck&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l1.31"></a><span id="l1.31"> #include general.inc.xul</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-#include display.inc.xul</span>
<a href="#l1.33"></a><span id="l1.33"> #include compose.inc.xul</span>
<a href="#l1.34"></a><span id="l1.34"> #include chat.inc.xul</span>
<a href="#l1.35"></a><span id="l1.35"> #include privacy.inc.xul</span>
<a href="#l1.36"></a><span id="l1.36"> #include security.inc.xul</span>
<a href="#l1.37"></a><span id="l1.37"> #include applications.inc.xul</span>
<a href="#l1.38"></a><span id="l1.38">             &lt;prefpane id=&quot;paneLightning&quot; label=&quot;&amp;paneLightning.title;&quot;/&gt;</span>
<a href="#l1.39"></a><span id="l1.39"> #include advanced.inc.xul</span>
<a href="#l1.40"></a><span id="l1.40">           &lt;/hbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/preferences/advanced.inc.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/preferences/advanced.inc.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,178 +1,24 @@</span>
<a href="#l2.4"></a><span id="l2.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l2.7"></a><span id="l2.7">   &lt;prefpane id=&quot;paneAdvanced&quot; label=&quot;&amp;paneAdvanced.title;&quot;&gt;</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineminus">-#ifdef MOZ_UPDATER</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineminus">-    &lt;script src=&quot;chrome://messenger/content/aboutDialog-appUpdater.js&quot;/&gt;</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineminus">-#endif</span>
<a href="#l2.11"></a><span id="l2.11">     &lt;script src=&quot;chrome://messenger/content/preferences/advanced.js&quot;/&gt;</span>
<a href="#l2.12"></a><span id="l2.12">     &lt;script src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-#ifdef HAVE_SHELL_SERVICE</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-    &lt;stringbundle id=&quot;bundlePreferences&quot; src=&quot;chrome://messenger/locale/preferences/preferences.properties&quot;/&gt;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-    &lt;stringbundle id=&quot;bundleBrand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-#endif</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-</span>
<a href="#l2.19"></a><span id="l2.19">     &lt;tabbox id=&quot;advancedPrefs&quot; flex=&quot;1&quot; onselect=&quot;gAdvancedPane.tabSelectionChanged();&quot;&gt;</span>
<a href="#l2.20"></a><span id="l2.20">       &lt;tabs id=&quot;advancedPrefsTabs&quot;&gt;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-        &lt;tab id=&quot;advancedGeneralTab&quot; label=&quot;&amp;itemGeneral.label;&quot;/&gt;</span>
<a href="#l2.22"></a><span id="l2.22"> #ifdef MOZ_DATA_REPORTING</span>
<a href="#l2.23"></a><span id="l2.23">         &lt;tab id=&quot;dataChoicesTab&quot; label=&quot;&amp;dataChoicesTab.label;&quot;/&gt;</span>
<a href="#l2.24"></a><span id="l2.24"> #endif</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-        &lt;tab id=&quot;networkingTab&quot; label=&quot;&amp;itemNetworking.label;&quot;/&gt;</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-#ifdef MOZ_UPDATER</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-        &lt;tab id=&quot;updateTab&quot; label=&quot;&amp;itemUpdate.label;&quot;/&gt;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-#endif</span>
<a href="#l2.29"></a><span id="l2.29">         &lt;tab id=&quot;certificateTab&quot; label=&quot;&amp;itemCertificates.label;&quot;/&gt;</span>
<a href="#l2.30"></a><span id="l2.30">       &lt;/tabs&gt;</span>
<a href="#l2.31"></a><span id="l2.31"> </span>
<a href="#l2.32"></a><span id="l2.32">       &lt;tabpanels id=&quot;advancedPrefsPanels&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-        &lt;!-- General --&gt;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-            &lt;description flex=&quot;1&quot;&gt;&amp;returnReceiptsInfo.label;&lt;/description&gt;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-            &lt;button id=&quot;showReturnReceipts&quot;</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-                    label=&quot;&amp;showReturnReceipts.label;&quot;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-                    accesskey=&quot;&amp;showReturnReceipts.accesskey;&quot;</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-                    oncommand=&quot;gAdvancedPane.showReturnReceipts();&quot;/&gt;</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-          &lt;/hbox&gt;</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-          &lt;!-- Scrolling --&gt;</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-          &lt;groupbox id=&quot;scrollingGroup&quot;&gt;</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;scrolling.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-              &lt;checkbox id=&quot;useAutoScroll&quot;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-                        label=&quot;&amp;useAutoScroll.label;&quot;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-                        accesskey=&quot;&amp;useAutoScroll.accesskey;&quot;</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-                        preference=&quot;general.autoScroll&quot;/&gt;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-              &lt;checkbox id=&quot;useSmoothScrolling&quot;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-                        label=&quot;&amp;useSmoothScrolling.label;&quot;</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-                        accesskey=&quot;&amp;useSmoothScrolling.accesskey;&quot;</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-                        preference=&quot;general.smoothScroll&quot;/&gt;</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-          &lt;!-- Date and time formatting --&gt;</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;dateTimeFormatting.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineminus">-            &lt;radiogroup id=&quot;formatLocale&quot;</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineminus">-                        preference=&quot;intl.regional_prefs.use_os_locales&quot;</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-                        orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineminus">-                &lt;radio id=&quot;appLocale&quot;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineminus">-                       value=&quot;false&quot;/&gt;</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineminus">-                       &lt;!-- label and accesskey will be set dynamically --&gt;</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineminus">-                &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineminus">-                &lt;radio id=&quot;rsLocale&quot;</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-                       value=&quot;true&quot;/&gt;</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineminus">-                       &lt;!-- label and accesskey will be set dynamically --&gt;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-                &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-            &lt;/radiogroup&gt;</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-          &lt;groupbox id=&quot;messengerLanguagesBox&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;languageSelector.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-             &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineminus">-              &lt;description flex=&quot;1&quot;</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineminus">-                           controls=&quot;chooseMessengerLanguage&quot;</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineminus">-                           data-l10n-id=&quot;choose-messenger-language-description&quot;/&gt;</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-                &lt;menulist id=&quot;defaultMessengerLanguage&quot;</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineminus">-                          oncommand=&quot;gAdvancedPane.onMessengerLanguageChange(event)&quot;&gt;</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineminus">-                  &lt;menupopup/&gt;</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineminus">-                &lt;/menulist&gt;</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineminus">-                &lt;button id=&quot;manageMessengerLanguagesButton&quot;</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-                        class=&quot;accessory-button&quot;</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineminus">-                        data-l10n-id=&quot;manage-messenger-languages-button&quot;</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineminus">-                        oncommand=&quot;gAdvancedPane.showMessengerLanguages({search: false})&quot;/&gt;</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineminus">-            &lt;hbox id=&quot;confirmMessengerLanguage&quot;</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineminus">-                  class=&quot;message-bar&quot;</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-                  align=&quot;center&quot;</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-                  hidden=&quot;true&quot;&gt;</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineminus">-              &lt;image class=&quot;message-bar-icon&quot;/&gt;</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-              &lt;vbox class=&quot;message-bar-content-container&quot; align=&quot;stretch&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineminus">-</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineminus">-#ifdef HAVE_SHELL_SERVICE</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineminus">-          &lt;groupbox id=&quot;systemDefaultsGroup&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;systemIntegration.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineminus">-            &lt;hbox id=&quot;checkDefaultBox&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-              &lt;checkbox id=&quot;alwaysCheckDefault&quot;</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-                        preference=&quot;mail.shell.checkDefaultClient&quot;</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineminus">-                        label=&quot;&amp;alwaysCheckDefault.label;&quot;</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineminus">-                        accesskey=&quot;&amp;alwaysCheckDefault.accesskey;&quot;/&gt;</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-              &lt;button id=&quot;checkDefaultButton&quot; label=&quot;&amp;checkDefaultsNow.label;&quot;</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineminus">-                      accesskey=&quot;&amp;checkDefaultsNow.accesskey;&quot;</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineminus">-                      oncommand=&quot;gAdvancedPane.checkDefaultNow();&quot;</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineminus">-                      preference=&quot;pref.general.disable_button.default_mail&quot;/&gt;</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-            &lt;hbox id=&quot;searchIntegrationContainer&quot;&gt;</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-              &lt;checkbox id=&quot;searchIntegration&quot;</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-                        preference=&quot;searchintegration.enable&quot;</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">-                        label=&quot;&amp;searchIntegration.label;&quot;</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineminus">-                        accesskey=&quot;&amp;searchIntegration.accesskey;&quot;/&gt;</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineminus">-#endif</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;configEditDesc.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineminus">-            &lt;vbox&gt;</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineminus">-                &lt;checkbox id=&quot;enableGloda&quot;</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-                          preference=&quot;mailnews.database.global.indexer.enabled&quot;</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineminus">-                          label=&quot;&amp;enableGlodaSearch.label;&quot;</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineminus">-                          accesskey=&quot;&amp;enableGlodaSearch.accesskey;&quot;/&gt;</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineminus">-              &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineminus">-                &lt;label value=&quot;&amp;storeType.label;&quot;</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-                       accesskey=&quot;&amp;storeType.accesskey;&quot;</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineminus">-                       control=&quot;storeTypeMenulist&quot;/&gt;</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-                &lt;menulist id=&quot;storeTypeMenulist&quot;</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineminus">-                          oncommand=&quot;gAdvancedPane.updateDefaultStore(this.selectedItem.value)&quot;&gt;</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineminus">-                  &lt;menupopup id=&quot;storeTypeMenupopup&quot;&gt;</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-                    &lt;menuitem id=&quot;mboxStore&quot;</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineminus">-                              label=&quot;&amp;mboxStore2.label;&quot;</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineminus">-                              value=&quot;@mozilla.org/msgstore/berkeleystore;1&quot;/&gt;</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineminus">-                    &lt;menuitem id=&quot;maildirStore&quot;</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-                              label=&quot;&amp;maildirStore.label;&quot;</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-                              value=&quot;@mozilla.org/msgstore/maildirstore;1&quot;/&gt;</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-                  &lt;/menupopup&gt;</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-                &lt;/menulist&gt;</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineminus">-                &lt;checkbox id=&quot;allowHWAccel&quot;</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineminus">-                          label=&quot;&amp;allowHWAccel.label;&quot;</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineminus">-                          accesskey=&quot;&amp;allowHWAccel.accesskey;&quot;</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineminus">-                          preference=&quot;layers.acceleration.disabled&quot;/&gt;</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-            &lt;vbox&gt;</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineminus">-              &lt;hbox pack=&quot;end&quot;&gt;</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineminus">-                &lt;button id=&quot;configEditor&quot; label=&quot;&amp;configEdit.label;&quot;</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-                        accesskey=&quot;&amp;configEdit.accesskey;&quot;</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineminus">-                        oncommand=&quot;gAdvancedPane.showConfigEdit();&quot;/&gt;</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineminus">-        &lt;/tabpanel&gt;</span>
<a href="#l2.174"></a><span id="l2.174"> </span>
<a href="#l2.175"></a><span id="l2.175"> #ifdef MOZ_DATA_REPORTING</span>
<a href="#l2.176"></a><span id="l2.176">         &lt;!-- Data Choices --&gt;</span>
<a href="#l2.177"></a><span id="l2.177">         &lt;tabpanel id=&quot;dataChoicesPanel&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.178"></a><span id="l2.178"> #ifdef MOZ_TELEMETRY_REPORTING</span>
<a href="#l2.179"></a><span id="l2.179">           &lt;groupbox&gt;</span>
<a href="#l2.180"></a><span id="l2.180">             &lt;label&gt;&lt;html:h2&gt;&amp;telemetrySection.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.181"></a><span id="l2.181">             &lt;description&gt;&amp;telemetryDesc.label;&lt;/description&gt;</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineat">@@ -205,207 +51,16 @@</span>
<a href="#l2.183"></a><span id="l2.183">                      value=&quot;&amp;crashReporterLearnMore.label;&quot;</span>
<a href="#l2.184"></a><span id="l2.184">                      onclick=&quot;gAdvancedPane.openTextLink(event)&quot;/&gt;</span>
<a href="#l2.185"></a><span id="l2.185">             &lt;/hbox&gt;</span>
<a href="#l2.186"></a><span id="l2.186">           &lt;/groupbox&gt;</span>
<a href="#l2.187"></a><span id="l2.187"> #endif</span>
<a href="#l2.188"></a><span id="l2.188">         &lt;/tabpanel&gt;</span>
<a href="#l2.189"></a><span id="l2.189"> #endif</span>
<a href="#l2.190"></a><span id="l2.190"> </span>
<a href="#l2.191"></a><span id="l2.191" class="difflineminus">-        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineminus">-          &lt;!-- Networking &amp; Disk Space --&gt;</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;connectionsInfo.caption;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineminus">-              &lt;description flex=&quot;1&quot; control=&quot;catProxiesButton&quot;&gt;&amp;proxiesConfigure.label;&lt;/description&gt;</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineminus">-              &lt;button id=&quot;catProxiesButton&quot; icon=&quot;network&quot; label=&quot;&amp;showSettings.label;&quot;</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineminus">-                      accesskey=&quot;&amp;showSettings.accesskey;&quot;</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineminus">-                      oncommand=&quot;gAdvancedPane.showConnections();&quot;/&gt;</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineminus">-</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;offlineInfo.caption;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineminus">-              &lt;description flex=&quot;1&quot; control=&quot;offlineSettingsButton&quot;&gt;&amp;offlineInfo.label;&lt;/description&gt;</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineminus">-              &lt;button id=&quot;offlineSettingsButton&quot; label=&quot;&amp;showOffline.label;&quot;</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineminus">-                      accesskey=&quot;&amp;showOffline.accesskey;&quot;</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineminus">-                      oncommand=&quot;gAdvancedPane.showOffline();&quot;/&gt;</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineminus">-</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;Diskspace;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineminus">-              &lt;label id=&quot;actualDiskCacheSize&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineminus">-              &lt;button id=&quot;clearCacheButton&quot; icon=&quot;clear&quot;</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineminus">-                      label=&quot;&amp;clearCacheNow.label;&quot; accesskey=&quot;&amp;clearCacheNow.accesskey;&quot;</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineminus">-                      oncommand=&quot;gAdvancedPane.clearCache();&quot;/&gt;</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineminus">-              &lt;checkbox preference=&quot;browser.cache.disk.smart_size.enabled&quot;</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineminus">-                        id=&quot;allowSmartSize&quot;</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineminus">-                        label=&quot;&amp;overrideSmartCacheSize.label;&quot;</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineminus">-                        accesskey=&quot;&amp;overrideSmartCacheSize.accesskey;&quot;/&gt;</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineminus">-            &lt;hbox align=&quot;center&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineminus">-              &lt;label id=&quot;useCacheBefore&quot; control=&quot;cacheSize&quot;</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-                     accesskey=&quot;&amp;useCacheBefore.accesskey;&quot; value=&quot;&amp;useCacheBefore.label;&quot;/&gt;</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineminus">-              &lt;html:input id=&quot;cacheSize&quot; type=&quot;number&quot; class=&quot;size4&quot; max=&quot;1024&quot;</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineminus">-                          preference=&quot;browser.cache.disk.capacity&quot;</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineminus">-                          aria-labelledby=&quot;useCacheBefore cacheSize useCacheAfter&quot;/&gt;</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineminus">-              &lt;label id=&quot;useCacheAfter&quot; flex=&quot;1&quot;&gt;&amp;useCacheAfter.label;&lt;/label&gt;</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineminus">-                &lt;checkbox id=&quot;offlineCompactFolder&quot;</span>
<a href="#l2.237"></a><span id="l2.237" class="difflineminus">-                          label=&quot;&amp;offlineCompactFolders.label;&quot;</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineminus">-                          accesskey=&quot;&amp;offlineCompactFolders.accesskey;&quot;</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineminus">-                          aria-labelledby=&quot;offlineCompactFolder offlineCompactFolderMin compactFolderMB&quot;</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineminus">-                          preference=&quot;mail.prompt_purge_threshhold&quot;</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineminus">-                          oncommand=&quot;gAdvancedPane.updateCompactOptions(this.checked);&quot;/&gt;</span>
<a href="#l2.242"></a><span id="l2.242" class="difflineminus">-                &lt;html:input id=&quot;offlineCompactFolderMin&quot; type=&quot;number&quot; class=&quot;size4&quot;</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineminus">-                            min=&quot;1&quot; max=&quot;2048&quot; value=&quot;200&quot;</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-                            preference=&quot;mail.purge_threshhold_mb&quot;</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineminus">-                            aria-labelledby=&quot;offlineCompactFolder offlineCompactFolderMin compactFolderMB&quot;/&gt;</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineminus">-                &lt;label id=&quot;compactFolderMB&quot; value=&quot;&amp;offlineCompactFoldersMB.label;&quot;/&gt;</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineminus">-        &lt;/tabpanel&gt;</span>
<a href="#l2.250"></a><span id="l2.250" class="difflineminus">-</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineminus">-#ifdef MOZ_UPDATER</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineminus">-        &lt;!-- Update --&gt;</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineminus">-        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineminus">-          &lt;groupbox id=&quot;updateApp&quot;&gt;</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;updateApp2.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineminus">-            &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineminus">-              &lt;vbox&gt;</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineminus">-                &lt;description&gt;</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineminus">-                  &amp;updateApp.version.pre;&lt;label id=&quot;version&quot;/&gt;&amp;updateApp.version.post;</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineminus">-                  &lt;label is=&quot;text-link&quot; id=&quot;releasenotes&quot; hidden=&quot;true&quot;&gt;&amp;releaseNotes.link;&lt;/label&gt;</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineminus">-                &lt;/description&gt;</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineminus">-                &lt;description id=&quot;distribution&quot; class=&quot;text-blurb&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineminus">-                &lt;description id=&quot;distributionId&quot; class=&quot;text-blurb&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineminus">-              &lt;/vbox&gt;</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineminus">-              &lt;vbox&gt;</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineminus">-                &lt;button id=&quot;showUpdateHistory&quot;</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineminus">-                        label=&quot;&amp;updateHistory.label;&quot;</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineminus">-                        accesskey=&quot;&amp;updateHistory.accesskey;&quot;</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-                        preference=&quot;app.update.disable_button.showUpdateHistory&quot;</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineminus">-                        oncommand=&quot;gAdvancedPane.showUpdates();&quot;/&gt;</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-              &lt;/vbox&gt;</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineminus">-            &lt;vbox id=&quot;updateBox&quot;&gt;</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineminus">-              &lt;deck id=&quot;updateDeck&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineminus">-                &lt;hbox id=&quot;checkForUpdates&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineminus">-                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineminus">-                  &lt;button id=&quot;checkForUpdatesButton&quot; align=&quot;start&quot;</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineminus">-                          label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineminus">-                          accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineminus">-                          oncommand=&quot;gAppUpdater.checkForUpdates();&quot;/&gt;</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-                &lt;hbox id=&quot;downloadAndInstall&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineminus">-                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineminus">-                  &lt;button id=&quot;downloadAndInstallButton&quot;</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-                          oncommand=&quot;gAppUpdater.startDownload();&quot;/&gt;</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineminus">-                          &lt;!-- label and accesskey will be filled by JS --&gt;</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-                &lt;hbox id=&quot;apply&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineminus">-                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineminus">-                  &lt;button id=&quot;updateButton&quot;</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineminus">-                          label=&quot;&amp;update.updateButton.label3;&quot;</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineminus">-                          accesskey=&quot;&amp;update.updateButton.accesskey;&quot;</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineminus">-                          oncommand=&quot;gAppUpdater.buttonRestartAfterDownload();&quot;/&gt;</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineminus">-                &lt;hbox id=&quot;checkingForUpdates&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineminus">-                  &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.checkingForUpdates;&lt;/label&gt;</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineminus">-                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineminus">-                  &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineminus">-                          accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineminus">-                          disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineminus">-                &lt;hbox id=&quot;downloading&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineminus">-                  &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.downloading.start;&lt;/label&gt;</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineminus">-                  &lt;label id=&quot;downloadStatus&quot;/&gt;&lt;label&gt;&amp;update.downloading.end;&lt;/label&gt;</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineminus">-                &lt;hbox id=&quot;applying&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineminus">-                  &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.applying;&lt;/label&gt;</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineminus">-               &lt;hbox id=&quot;downloadFailed&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineminus">-                  &lt;label&gt;&amp;update.failed.start;&lt;/label&gt;</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineminus">-                  &lt;label is=&quot;text-link&quot; id=&quot;failedLink&quot;&gt;&amp;update.failed.linkText;&lt;/label&gt;</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineminus">-                  &lt;label&gt;&amp;update.failed.end;&lt;/label&gt;</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineminus">-                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineminus">-                  &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineminus">-                          accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineminus">-                          oncommand=&quot;gAppUpdater.checkForUpdates();&quot;/&gt;</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineminus">-                &lt;hbox id=&quot;policyDisabled&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineminus">-                  &lt;label&gt;&amp;update.adminDisabled;&lt;/label&gt;</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineminus">-                &lt;hbox id=&quot;noUpdatesFound&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineminus">-                  &lt;label&gt;&amp;update.noUpdatesFound;&lt;/label&gt;</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineminus">-                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineminus">-                  &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineminus">-                          accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineminus">-                          oncommand=&quot;gAppUpdater.checkForUpdates();&quot;/&gt;</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineminus">-                &lt;hbox id=&quot;otherInstanceHandlingUpdates&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineminus">-                  &lt;label&gt;&amp;update.otherInstanceHandlingUpdates;&lt;/label&gt;</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineminus">-                &lt;hbox id=&quot;manualUpdate&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineminus">-                  &lt;label&gt;&amp;update.manual.start;&lt;/label&gt;&lt;label is=&quot;text-link&quot; id=&quot;manualLink&quot;&gt;</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineminus">-                    &amp;update.manual.linkText;</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineminus">-                  &lt;/label&gt;</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineminus">-                  &lt;label&gt;&amp;update.manual.end;&lt;/label&gt;</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineminus">-                  &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineminus">-                  &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineminus">-                          accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineminus">-                          disabled=&quot;true&quot;/&gt;</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineminus">-                &lt;hbox id=&quot;unsupportedSystem&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineminus">-                  &lt;label&gt;&amp;update.unsupported.start;&lt;/label&gt;</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineminus">-                  &lt;label is=&quot;text-link&quot; id=&quot;unsupportedLink&quot;&gt;&amp;update.unsupported.linkText;&lt;/label&gt;</span>
<a href="#l2.345"></a><span id="l2.345" class="difflineminus">-                  &lt;label&gt;&amp;update.unsupported.end;&lt;/label&gt;</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineminus">-                &lt;hbox id=&quot;restarting&quot; align=&quot;center&quot;&gt;</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineminus">-                  &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.restarting;&lt;/label&gt;</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineminus">-              &lt;/deck&gt;</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l2.352"></a><span id="l2.352" class="difflineminus">-            &lt;separator/&gt;</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineminus">-            &lt;description id=&quot;updateAllowDescription&quot;&gt;&amp;updateAppAllow.description;&lt;/description&gt;</span>
<a href="#l2.354"></a><span id="l2.354" class="difflineminus">-            &lt;vbox id=&quot;updateSettingsContainer&quot;&gt;</span>
<a href="#l2.355"></a><span id="l2.355" class="difflineminus">-              &lt;radiogroup id=&quot;updateRadioGroup&quot;</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineminus">-                          align=&quot;start&quot;&gt;</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineminus">-                &lt;radio id=&quot;autoDesktop&quot;</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineminus">-                       value=&quot;true&quot;</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineminus">-                       label=&quot;&amp;updateAuto.label;&quot;</span>
<a href="#l2.360"></a><span id="l2.360" class="difflineminus">-                       accesskey=&quot;&amp;updateAuto.accesskey;&quot;/&gt;</span>
<a href="#l2.361"></a><span id="l2.361" class="difflineminus">-                &lt;radio id=&quot;manualDesktop&quot;</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineminus">-                       value=&quot;false&quot;</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineminus">-                       label=&quot;&amp;updateCheck.label;&quot;</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineminus">-                       accesskey=&quot;&amp;updateCheck.accesskey;&quot;/&gt;</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineminus">-              &lt;/radiogroup&gt;</span>
<a href="#l2.366"></a><span id="l2.366" class="difflineminus">-              &lt;description id=&quot;updateSettingCrossUserWarning&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineminus">-                &amp;updateCrossUserSettingWarning.description;</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineminus">-              &lt;/description&gt;</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l2.371"></a><span id="l2.371" class="difflineminus">-</span>
<a href="#l2.372"></a><span id="l2.372" class="difflineminus">-#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineminus">-          &lt;separator/&gt;</span>
<a href="#l2.374"></a><span id="l2.374" class="difflineminus">-          &lt;checkbox id=&quot;useService&quot;</span>
<a href="#l2.375"></a><span id="l2.375" class="difflineminus">-                    label=&quot;&amp;useService.label;&quot;</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineminus">-                    accesskey=&quot;&amp;useService.accesskey;&quot;</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineminus">-                    preference=&quot;app.update.service.enabled&quot;/&gt;</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineminus">-#endif</span>
<a href="#l2.379"></a><span id="l2.379" class="difflineminus">-        &lt;/tabpanel&gt;</span>
<a href="#l2.380"></a><span id="l2.380" class="difflineminus">-#endif</span>
<a href="#l2.381"></a><span id="l2.381" class="difflineminus">-</span>
<a href="#l2.382"></a><span id="l2.382">         &lt;!-- Certificates --&gt;</span>
<a href="#l2.383"></a><span id="l2.383">         &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l2.384"></a><span id="l2.384">           &lt;description id=&quot;CertSelectionDesc&quot; control=&quot;certSelection&quot;&gt;&amp;certSelection.description;&lt;/description&gt;</span>
<a href="#l2.385"></a><span id="l2.385"> </span>
<a href="#l2.386"></a><span id="l2.386">           &lt;!--</span>
<a href="#l2.387"></a><span id="l2.387">             The values on these radio buttons may look like l12y issues, but</span>
<a href="#l2.388"></a><span id="l2.388">             they're not - this preference uses *those strings* as its values.</span>
<a href="#l2.389"></a><span id="l2.389">             I KID YOU NOT.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/preferences/advanced.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/preferences/advanced.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,510 +1,78 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l3.5"></a><span id="l3.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> &quot;use strict&quot;;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-/* import-globals-from ../../base/content/aboutDialog-appUpdater.js */</span>
<a href="#l3.12"></a><span id="l3.12"> /* import-globals-from preferences.js */</span>
<a href="#l3.13"></a><span id="l3.13"> /* import-globals-from subdialogs.js */</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> // Load DownloadUtils module for convertByteUnits</span>
<a href="#l3.16"></a><span id="l3.16"> var {DownloadUtils} = ChromeUtils.import(&quot;resource://gre/modules/DownloadUtils.jsm&quot;);</span>
<a href="#l3.17"></a><span id="l3.17"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.18"></a><span id="l3.18"> var {AppConstants} = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l3.19"></a><span id="l3.19"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.20"></a><span id="l3.20"> var {L10nRegistry} = ChromeUtils.import(&quot;resource://gre/modules/L10nRegistry.jsm&quot;);</span>
<a href="#l3.21"></a><span id="l3.21"> var {Localization} = ChromeUtils.import(&quot;resource://gre/modules/Localization.jsm&quot;);</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-var {UpdateUtils} = ChromeUtils.import(&quot;resource://gre/modules/UpdateUtils.jsm&quot;);</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-const AUTO_UPDATE_CHANGED_TOPIC = &quot;auto-update-config-change&quot;;</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26"> Preferences.addAll([</span>
<a href="#l3.27"></a><span id="l3.27">   { id: &quot;mail.preferences.advanced.selectedTabIndex&quot;, type: &quot;int&quot; },</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-  { id: &quot;general.autoScroll&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-  { id: &quot;general.smoothScroll&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-  { id: &quot;intl.regional_prefs.use_os_locales&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-  { id: &quot;mailnews.database.global.indexer.enabled&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-  { id: &quot;layers.acceleration.disabled&quot;, type: &quot;bool&quot;, inverted: true },</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-  { id: &quot;searchintegration.enable&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-  { id: &quot;mail.prompt_purge_threshhold&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-  { id: &quot;mail.purge_threshhold_mb&quot;, type: &quot;int&quot; },</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-  { id: &quot;browser.cache.disk.capacity&quot;, type: &quot;int&quot; },</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-  { id: &quot;browser.cache.disk.smart_size.enabled&quot;, inverted: true, type: &quot;bool&quot; },</span>
<a href="#l3.38"></a><span id="l3.38">   { id: &quot;security.default_personal_cert&quot;, type: &quot;string&quot; },</span>
<a href="#l3.39"></a><span id="l3.39">   { id: &quot;security.disable_button.openCertManager&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.40"></a><span id="l3.40">   { id: &quot;security.disable_button.openDeviceManager&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.41"></a><span id="l3.41">   { id: &quot;security.OCSP.enabled&quot;, type: &quot;int&quot; },</span>
<a href="#l3.42"></a><span id="l3.42"> ]);</span>
<a href="#l3.43"></a><span id="l3.43"> </span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-if (AppConstants.HAVE_SHELL_SERVICE) {</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-  Preferences.addAll([</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-    { id: &quot;mail.shell.checkDefaultClient&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-    { id: &quot;pref.general.disable_button.default_mail&quot;, type: &quot;bool&quot; },</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-  ]);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-}</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-</span>
<a href="#l3.51"></a><span id="l3.51"> if (AppConstants.MOZ_TELEMETRY_REPORTING) {</span>
<a href="#l3.52"></a><span id="l3.52">   Preferences.add({ id: &quot;toolkit.telemetry.enabled&quot;, type: &quot;bool&quot; });</span>
<a href="#l3.53"></a><span id="l3.53"> }</span>
<a href="#l3.54"></a><span id="l3.54"> </span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-if (AppConstants.MOZ_UPDATER) {</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-  Preferences.add({ id: &quot;app.update.disable_button.showUpdateHistory&quot;, type: &quot;bool&quot; });</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-  if (AppConstants.MOZ_MAINTENANCE_SERVICE) {</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-    Preferences.add({ id: &quot;app.update.service.enabled&quot;, type: &quot;bool&quot; });</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-  }</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-}</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-</span>
<a href="#l3.62"></a><span id="l3.62"> document.getElementById(&quot;paneAdvanced&quot;)</span>
<a href="#l3.63"></a><span id="l3.63">         .addEventListener(&quot;paneload&quot;, function() { gAdvancedPane.init(); });</span>
<a href="#l3.64"></a><span id="l3.64"> </span>
<a href="#l3.65"></a><span id="l3.65"> var gAdvancedPane = {</span>
<a href="#l3.66"></a><span id="l3.66">   mPane: null,</span>
<a href="#l3.67"></a><span id="l3.67">   mInitialized: false,</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-  mShellServiceWorking: false,</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-  mBundle: null,</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-  requestingLocales: null,</span>
<a href="#l3.71"></a><span id="l3.71"> </span>
<a href="#l3.72"></a><span id="l3.72">   init() {</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-    function setEventListener(aId, aEventType, aCallback) {</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-      document.getElementById(aId)</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-        .addEventListener(aEventType, aCallback.bind(gAdvancedPane));</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-    }</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-</span>
<a href="#l3.78"></a><span id="l3.78">     this.mPane = document.getElementById(&quot;paneAdvanced&quot;);</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-    this.updateCompactOptions();</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-    this.mBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-    this.formatLocaleSetLabels();</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-    if (Services.prefs.getBoolPref(&quot;intl.multilingual.enabled&quot;)) {</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-      this.initMessengerLocale();</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-    }</span>
<a href="#l3.86"></a><span id="l3.86"> </span>
<a href="#l3.87"></a><span id="l3.87">     if (!((&quot;arguments&quot; in window) &amp;&amp; window.arguments[1])) {</span>
<a href="#l3.88"></a><span id="l3.88">       // If no tab was specified, select the last used tab.</span>
<a href="#l3.89"></a><span id="l3.89">       let preference = Preferences.get(&quot;mail.preferences.advanced.selectedTabIndex&quot;);</span>
<a href="#l3.90"></a><span id="l3.90">       if (preference.value)</span>
<a href="#l3.91"></a><span id="l3.91">         document.getElementById(&quot;advancedPrefs&quot;).selectedIndex = preference.value;</span>
<a href="#l3.92"></a><span id="l3.92">     }</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-    if (AppConstants.MOZ_UPDATER)</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineminus">-      this.updateReadPrefs();</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineminus">-    // Default store type initialization.</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineminus">-    let storeTypeElement = document.getElementById(&quot;storeTypeMenulist&quot;);</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineminus">-    // set the menuitem to match the account</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineminus">-    let defaultStoreID = Services.prefs.getCharPref(&quot;mail.serverDefaultStoreContractID&quot;);</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineminus">-    let targetItem = storeTypeElement.getElementsByAttribute(&quot;value&quot;, defaultStoreID);</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineminus">-    storeTypeElement.selectedItem = targetItem[0];</span>
<a href="#l3.102"></a><span id="l3.102"> </span>
<a href="#l3.103"></a><span id="l3.103">     if (AppConstants.MOZ_CRASHREPORTER)</span>
<a href="#l3.104"></a><span id="l3.104">       this.initSubmitCrashes();</span>
<a href="#l3.105"></a><span id="l3.105">     this.initTelemetry();</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-    this.updateActualCacheSize();</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineminus">-    // Search integration -- check whether we should hide or disable integration</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-    let hideSearchUI = false;</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineminus">-    let disableSearchUI = false;</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineminus">-    const {SearchIntegration} = ChromeUtils.import(&quot;resource:///modules/SearchIntegration.jsm&quot;);</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineminus">-    if (SearchIntegration) {</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineminus">-      if (SearchIntegration.osVersionTooLow)</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineminus">-        hideSearchUI = true;</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineminus">-      else if (SearchIntegration.osComponentsNotRunning)</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineminus">-        disableSearchUI = true;</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineminus">-    } else {</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-      hideSearchUI = true;</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineminus">-    }</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-    if (hideSearchUI) {</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineminus">-      document.getElementById(&quot;searchIntegrationContainer&quot;).hidden = true;</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineminus">-    } else if (disableSearchUI) {</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-      let searchCheckbox = document.getElementById(&quot;searchIntegration&quot;);</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineminus">-      searchCheckbox.checked = false;</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-      Preferences.get(&quot;searchintegration.enable&quot;).disabled = true;</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineminus">-    }</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineminus">-</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-    // If the shell service is not working, disable the &quot;Check now&quot; button</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineminus">-    // and &quot;perform check at startup&quot; checkbox.</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-    try {</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-      Cc[&quot;@mozilla.org/mail/shell-service;1&quot;].getService(Ci.nsIShellService);</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineminus">-      this.mShellServiceWorking = true;</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-    } catch (ex) {</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineminus">-      // The elements may not exist if HAVE_SHELL_SERVICE is off.</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineminus">-      if (document.getElementById(&quot;alwaysCheckDefault&quot;)) {</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-        document.getElementById(&quot;alwaysCheckDefault&quot;).disabled = true;</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineminus">-        document.getElementById(&quot;alwaysCheckDefault&quot;).checked = false;</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-      }</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineminus">-      if (document.getElementById(&quot;checkDefaultButton&quot;))</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-        document.getElementById(&quot;checkDefaultButton&quot;).disabled = true;</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-      this.mShellServiceWorking = false;</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-    }</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-    if (AppConstants.MOZ_UPDATER) {</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-      gAppUpdater = new appUpdater(); // eslint-disable-line no-global-assign</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-      if (Services.policies &amp;&amp; !Services.policies.isAllowed(&quot;appUpdate&quot;)) {</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-          document.getElementById(&quot;updateAllowDescription&quot;).hidden = true;</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-          document.getElementById(&quot;updateRadioGroup&quot;).hidden = true;</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-        if (AppConstants.MOZ_MAINTENANCE_SERVICE) {</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-          document.getElementById(&quot;useService&quot;).hidden = true;</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-        }</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-      } else {</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineminus">-        // Start with no option selected since we are still reading the value</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineminus">-        document.getElementById(&quot;autoDesktop&quot;).removeAttribute(&quot;selected&quot;);</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineminus">-        document.getElementById(&quot;manualDesktop&quot;).removeAttribute(&quot;selected&quot;);</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-        // Start reading the correct value from the disk</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineminus">-        this.updateReadPrefs();</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineminus">-        setEventListener(&quot;updateRadioGroup&quot;, &quot;command&quot;,</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineminus">-                         gAdvancedPane.updateWritePrefs);</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineminus">-      }</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineminus">-</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineminus">-      let distroId = Services.prefs.getCharPref(&quot;distribution.id&quot;, &quot;&quot;);</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineminus">-      if (distroId) {</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineminus">-        let distroVersion = Services.prefs.getCharPref(&quot;distribution.version&quot;);</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineminus">-</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineminus">-        let distroIdField = document.getElementById(&quot;distributionId&quot;);</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineminus">-        distroIdField.value = distroId + &quot; - &quot; + distroVersion;</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineminus">-        distroIdField.style.display = &quot;block&quot;;</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineminus">-</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineminus">-        let distroAbout = Services.prefs.getStringPref(&quot;distribution.about&quot;, &quot;&quot;);</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-        if (distroAbout) {</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-          let distroField = document.getElementById(&quot;distribution&quot;);</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-          distroField.value = distroAbout;</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineminus">-          distroField.style.display = &quot;block&quot;;</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineminus">-        }</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-      }</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineminus">-</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineminus">-      if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-        // On Windows, the Application Update setting is an installation-</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-        // specific preference, not a profile-specific one. Show a warning to</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineminus">-        // inform users of this.</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineminus">-        let updateContainer = document.getElementById(&quot;updateSettingsContainer&quot;);</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineminus">-        updateContainer.classList.add(&quot;updateSettingCrossUserWarningContainer&quot;);</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-        document.getElementById(&quot;updateSettingCrossUserWarning&quot;).hidden = false;</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineminus">-      }</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineminus">-</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineminus">-      if (AppConstants.MOZ_MAINTENANCE_SERVICE) {</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineminus">-        // Check to see if the maintenance service is installed.</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineminus">-        // If it isn't installed, don't show the preference at all.</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineminus">-        let installed;</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineminus">-        try {</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-          let wrk = Cc[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-                    .createInstance(Ci.nsIWindowsRegKey);</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineminus">-          wrk.open(wrk.ROOT_KEY_LOCAL_MACHINE,</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineminus">-                   &quot;SOFTWARE\\Mozilla\\MaintenanceService&quot;,</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineminus">-                   wrk.ACCESS_READ | wrk.WOW64_64);</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineminus">-          installed = wrk.readIntValue(&quot;Installed&quot;);</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineminus">-          wrk.close();</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineminus">-        } catch (e) {</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineminus">-        }</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineminus">-        if (installed != 1) {</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineminus">-          document.getElementById(&quot;useService&quot;).hidden = true;</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineminus">-        }</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineminus">-      }</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineminus">-</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineminus">-      let version = AppConstants.MOZ_APP_VERSION_DISPLAY;</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineminus">-</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineminus">-      // Include the build ID and display warning if this is an &quot;a#&quot; (nightly) build</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineminus">-      if (/a\d+$/.test(version)) {</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineminus">-        let buildID = Services.appinfo.appBuildID;</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineminus">-        let year = buildID.slice(0, 4);</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineminus">-        let month = buildID.slice(4, 6);</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineminus">-        let day = buildID.slice(6, 8);</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-        version += ` (${year}-${month}-${day})`;</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineminus">-      }</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineminus">-</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineminus">-      // Append &quot;(32-bit)&quot; or &quot;(64-bit)&quot; build architecture to the version number:</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineminus">-      let bundle = Services.strings.createBundle(&quot;chrome://messenger/locale/messenger.properties&quot;);</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineminus">-      let archResource = Services.appinfo.is64Bit</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineminus">-                         ? &quot;aboutDialog.architecture.sixtyFourBit&quot;</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineminus">-                         : &quot;aboutDialog.architecture.thirtyTwoBit&quot;;</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineminus">-      let arch = bundle.GetStringFromName(archResource);</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineminus">-      version += ` (${arch})`;</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineminus">-</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-      document.getElementById(&quot;version&quot;).textContent = version;</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineminus">-</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineminus">-      if (!AppConstants.NIGHTLY_BUILD) {</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineminus">-        // Show a release notes link if we have a URL.</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineminus">-        let relNotesLink = document.getElementById(&quot;releasenotes&quot;);</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineminus">-        let relNotesPrefType = Services.prefs.getPrefType(&quot;app.releaseNotesURL&quot;);</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineminus">-        if (relNotesPrefType != Services.prefs.PREF_INVALID) {</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineminus">-          let relNotesURL = Services.urlFormatter.formatURLPref(&quot;app.releaseNotesURL&quot;);</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineminus">-          if (relNotesURL != &quot;about:blank&quot;) {</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineminus">-            relNotesLink.href = relNotesURL;</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineminus">-            relNotesLink.hidden = false;</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineminus">-          }</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineminus">-        }</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineminus">-      }</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineminus">-      // Initialize Application section.</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineminus">-</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineminus">-      // Listen for window unload so we can remove our preference observers.</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineminus">-      window.addEventListener(&quot;unload&quot;, this);</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineminus">-</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineminus">-      Services.obs.addObserver(this, AUTO_UPDATE_CHANGED_TOPIC);</span>
<a href="#l3.246"></a><span id="l3.246" class="difflineminus">-    }</span>
<a href="#l3.247"></a><span id="l3.247" class="difflineminus">-</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineminus">-    Preferences.addSyncFromPrefListener(document.getElementById(&quot;allowSmartSize&quot;),</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineminus">-      () =&gt; this.readSmartSizeEnabled());</span>
<a href="#l3.250"></a><span id="l3.250" class="difflineminus">-</span>
<a href="#l3.251"></a><span id="l3.251" class="difflineminus">-    let element = document.getElementById(&quot;cacheSize&quot;);</span>
<a href="#l3.252"></a><span id="l3.252" class="difflineminus">-    Preferences.addSyncFromPrefListener(element, () =&gt; this.readCacheSize());</span>
<a href="#l3.253"></a><span id="l3.253" class="difflineminus">-    Preferences.addSyncToPrefListener(element, () =&gt; this.writeCacheSize());</span>
<a href="#l3.254"></a><span id="l3.254"> </span>
<a href="#l3.255"></a><span id="l3.255">     element = document.getElementById(&quot;enableOCSP&quot;);</span>
<a href="#l3.256"></a><span id="l3.256">     Preferences.addSyncFromPrefListener(element, () =&gt; this.readEnableOCSP());</span>
<a href="#l3.257"></a><span id="l3.257">     Preferences.addSyncToPrefListener(element, () =&gt; this.writeEnableOCSP());</span>
<a href="#l3.258"></a><span id="l3.258"> </span>
<a href="#l3.259"></a><span id="l3.259">     this.mInitialized = true;</span>
<a href="#l3.260"></a><span id="l3.260">   },</span>
<a href="#l3.261"></a><span id="l3.261"> </span>
<a href="#l3.262"></a><span id="l3.262">   tabSelectionChanged() {</span>
<a href="#l3.263"></a><span id="l3.263">     if (this.mInitialized) {</span>
<a href="#l3.264"></a><span id="l3.264">       Preferences.get(&quot;mail.preferences.advanced.selectedTabIndex&quot;)</span>
<a href="#l3.265"></a><span id="l3.265">                  .valueFromPreferences = document.getElementById(&quot;advancedPrefs&quot;).selectedIndex;</span>
<a href="#l3.266"></a><span id="l3.266">     }</span>
<a href="#l3.267"></a><span id="l3.267">   },</span>
<a href="#l3.268"></a><span id="l3.268"> </span>
<a href="#l3.269"></a><span id="l3.269" class="difflineminus">-  /**</span>
<a href="#l3.270"></a><span id="l3.270" class="difflineminus">-   * Checks whether Thunderbird is currently registered with the operating</span>
<a href="#l3.271"></a><span id="l3.271" class="difflineminus">-   * system as the default app for mail, rss and news.  If Thunderbird is not</span>
<a href="#l3.272"></a><span id="l3.272" class="difflineminus">-   * currently the default app, the user is given the option of making it the</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineminus">-   * default for each type; otherwise, the user is informed that Thunderbird is</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineminus">-   * already the default.</span>
<a href="#l3.275"></a><span id="l3.275" class="difflineminus">-   */</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineminus">-  checkDefaultNow(aAppType) {</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineminus">-    if (!this.mShellServiceWorking)</span>
<a href="#l3.278"></a><span id="l3.278" class="difflineminus">-      return;</span>
<a href="#l3.279"></a><span id="l3.279" class="difflineminus">-</span>
<a href="#l3.280"></a><span id="l3.280" class="difflineminus">-    // otherwise, bring up the default client dialog</span>
<a href="#l3.281"></a><span id="l3.281" class="difflineminus">-    gSubDialog.open(&quot;chrome://messenger/content/systemIntegrationDialog.xul&quot;,</span>
<a href="#l3.282"></a><span id="l3.282" class="difflineminus">-                    &quot;resizable=no&quot;, &quot;calledFromPrefs&quot;);</span>
<a href="#l3.283"></a><span id="l3.283" class="difflineminus">-  },</span>
<a href="#l3.284"></a><span id="l3.284" class="difflineminus">-</span>
<a href="#l3.285"></a><span id="l3.285" class="difflineminus">-  showConfigEdit() {</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineminus">-    gSubDialog.open(&quot;chrome://global/content/config.xul&quot;);</span>
<a href="#l3.287"></a><span id="l3.287" class="difflineminus">-  },</span>
<a href="#l3.288"></a><span id="l3.288" class="difflineminus">-</span>
<a href="#l3.289"></a><span id="l3.289" class="difflineminus">-  /**</span>
<a href="#l3.290"></a><span id="l3.290" class="difflineminus">-   * Set the default store contract ID.</span>
<a href="#l3.291"></a><span id="l3.291" class="difflineminus">-   */</span>
<a href="#l3.292"></a><span id="l3.292" class="difflineminus">-  updateDefaultStore(storeID) {</span>
<a href="#l3.293"></a><span id="l3.293" class="difflineminus">-    Services.prefs.setCharPref(&quot;mail.serverDefaultStoreContractID&quot;, storeID);</span>
<a href="#l3.294"></a><span id="l3.294" class="difflineminus">-  },</span>
<a href="#l3.295"></a><span id="l3.295" class="difflineminus">-</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineminus">-  // NETWORK TAB</span>
<a href="#l3.297"></a><span id="l3.297" class="difflineminus">-</span>
<a href="#l3.298"></a><span id="l3.298" class="difflineminus">-  /*</span>
<a href="#l3.299"></a><span id="l3.299" class="difflineminus">-   * Preferences:</span>
<a href="#l3.300"></a><span id="l3.300" class="difflineminus">-   *</span>
<a href="#l3.301"></a><span id="l3.301" class="difflineminus">-   * browser.cache.disk.capacity</span>
<a href="#l3.302"></a><span id="l3.302" class="difflineminus">-   * - the size of the browser cache in KB</span>
<a href="#l3.303"></a><span id="l3.303" class="difflineminus">-   */</span>
<a href="#l3.304"></a><span id="l3.304" class="difflineminus">-</span>
<a href="#l3.305"></a><span id="l3.305" class="difflineminus">-  // Retrieves the amount of space currently used by disk cache</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineminus">-  updateActualCacheSize() {</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineminus">-    let actualSizeLabel = document.getElementById(&quot;actualDiskCacheSize&quot;);</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineminus">-    let prefStrBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l3.309"></a><span id="l3.309" class="difflineminus">-</span>
<a href="#l3.310"></a><span id="l3.310" class="difflineminus">-    // Needs to root the observer since cache service keeps only a weak reference.</span>
<a href="#l3.311"></a><span id="l3.311" class="difflineminus">-    this.observer = {</span>
<a href="#l3.312"></a><span id="l3.312" class="difflineminus">-      onNetworkCacheDiskConsumption(consumption) {</span>
<a href="#l3.313"></a><span id="l3.313" class="difflineminus">-        let size = DownloadUtils.convertByteUnits(consumption);</span>
<a href="#l3.314"></a><span id="l3.314" class="difflineminus">-        // The XBL binding for the string bundle may have been destroyed if</span>
<a href="#l3.315"></a><span id="l3.315" class="difflineminus">-        // the page was closed before this callback was executed.</span>
<a href="#l3.316"></a><span id="l3.316" class="difflineminus">-        if (!prefStrBundle.getFormattedString) {</span>
<a href="#l3.317"></a><span id="l3.317" class="difflineminus">-          return;</span>
<a href="#l3.318"></a><span id="l3.318" class="difflineminus">-        }</span>
<a href="#l3.319"></a><span id="l3.319" class="difflineminus">-        actualSizeLabel.value = prefStrBundle.getFormattedString(&quot;actualDiskCacheSize&quot;, size);</span>
<a href="#l3.320"></a><span id="l3.320" class="difflineminus">-      },</span>
<a href="#l3.321"></a><span id="l3.321" class="difflineminus">-</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineminus">-      QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineminus">-        Ci.nsICacheStorageConsumptionObserver,</span>
<a href="#l3.324"></a><span id="l3.324" class="difflineminus">-        Ci.nsISupportsWeakReference,</span>
<a href="#l3.325"></a><span id="l3.325" class="difflineminus">-      ]),</span>
<a href="#l3.326"></a><span id="l3.326" class="difflineminus">-    };</span>
<a href="#l3.327"></a><span id="l3.327" class="difflineminus">-</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineminus">-    actualSizeLabel.value = prefStrBundle.getString(&quot;actualDiskCacheSizeCalculated&quot;);</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineminus">-</span>
<a href="#l3.330"></a><span id="l3.330" class="difflineminus">-    try {</span>
<a href="#l3.331"></a><span id="l3.331" class="difflineminus">-      Services.cache2.asyncGetDiskConsumption(this.observer);</span>
<a href="#l3.332"></a><span id="l3.332" class="difflineminus">-    } catch (e) {}</span>
<a href="#l3.333"></a><span id="l3.333" class="difflineminus">-  },</span>
<a href="#l3.334"></a><span id="l3.334" class="difflineminus">-</span>
<a href="#l3.335"></a><span id="l3.335" class="difflineminus">-  updateCacheSizeUI(smartSizeEnabled) {</span>
<a href="#l3.336"></a><span id="l3.336" class="difflineminus">-    document.getElementById(&quot;useCacheBefore&quot;).disabled = smartSizeEnabled;</span>
<a href="#l3.337"></a><span id="l3.337" class="difflineminus">-    document.getElementById(&quot;cacheSize&quot;).disabled = smartSizeEnabled;</span>
<a href="#l3.338"></a><span id="l3.338" class="difflineminus">-    document.getElementById(&quot;useCacheAfter&quot;).disabled = smartSizeEnabled;</span>
<a href="#l3.339"></a><span id="l3.339" class="difflineminus">-  },</span>
<a href="#l3.340"></a><span id="l3.340" class="difflineminus">-</span>
<a href="#l3.341"></a><span id="l3.341" class="difflineminus">-  readSmartSizeEnabled() {</span>
<a href="#l3.342"></a><span id="l3.342" class="difflineminus">-    // The smart_size.enabled preference element is inverted=&quot;true&quot;, so its</span>
<a href="#l3.343"></a><span id="l3.343" class="difflineminus">-    // value is the opposite of the actual pref value</span>
<a href="#l3.344"></a><span id="l3.344" class="difflineminus">-    var disabled = Preferences.get(&quot;browser.cache.disk.smart_size.enabled&quot;).value;</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineminus">-    this.updateCacheSizeUI(!disabled);</span>
<a href="#l3.346"></a><span id="l3.346" class="difflineminus">-  },</span>
<a href="#l3.347"></a><span id="l3.347" class="difflineminus">-</span>
<a href="#l3.348"></a><span id="l3.348" class="difflineminus">-  /**</span>
<a href="#l3.349"></a><span id="l3.349" class="difflineminus">-   * Converts the cache size from units of KB to units of MB and returns that</span>
<a href="#l3.350"></a><span id="l3.350" class="difflineminus">-   * value.</span>
<a href="#l3.351"></a><span id="l3.351" class="difflineminus">-   */</span>
<a href="#l3.352"></a><span id="l3.352" class="difflineminus">-  readCacheSize() {</span>
<a href="#l3.353"></a><span id="l3.353" class="difflineminus">-    var preference = Preferences.get(&quot;browser.cache.disk.capacity&quot;);</span>
<a href="#l3.354"></a><span id="l3.354" class="difflineminus">-    return preference.value / 1024;</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineminus">-  },</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineminus">-</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineminus">-  /**</span>
<a href="#l3.358"></a><span id="l3.358" class="difflineminus">-   * Converts the cache size as specified in UI (in MB) to KB and returns that</span>
<a href="#l3.359"></a><span id="l3.359" class="difflineminus">-   * value.</span>
<a href="#l3.360"></a><span id="l3.360" class="difflineminus">-   */</span>
<a href="#l3.361"></a><span id="l3.361" class="difflineminus">-  writeCacheSize() {</span>
<a href="#l3.362"></a><span id="l3.362" class="difflineminus">-    var cacheSize = document.getElementById(&quot;cacheSize&quot;);</span>
<a href="#l3.363"></a><span id="l3.363" class="difflineminus">-    var intValue = parseInt(cacheSize.value, 10);</span>
<a href="#l3.364"></a><span id="l3.364" class="difflineminus">-    return isNaN(intValue) ? 0 : intValue * 1024;</span>
<a href="#l3.365"></a><span id="l3.365" class="difflineminus">-  },</span>
<a href="#l3.366"></a><span id="l3.366" class="difflineminus">-</span>
<a href="#l3.367"></a><span id="l3.367" class="difflineminus">-  /**</span>
<a href="#l3.368"></a><span id="l3.368" class="difflineminus">-   * Clears the cache.</span>
<a href="#l3.369"></a><span id="l3.369" class="difflineminus">-   */</span>
<a href="#l3.370"></a><span id="l3.370" class="difflineminus">-  clearCache() {</span>
<a href="#l3.371"></a><span id="l3.371" class="difflineminus">-    try {</span>
<a href="#l3.372"></a><span id="l3.372" class="difflineminus">-      Services.cache2.clear();</span>
<a href="#l3.373"></a><span id="l3.373" class="difflineminus">-    } catch (ex) {}</span>
<a href="#l3.374"></a><span id="l3.374" class="difflineminus">-    this.updateActualCacheSize();</span>
<a href="#l3.375"></a><span id="l3.375" class="difflineminus">-  },</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineminus">-</span>
<a href="#l3.377"></a><span id="l3.377" class="difflineminus">-  /**</span>
<a href="#l3.378"></a><span id="l3.378" class="difflineminus">-   * Selects the correct item in the update radio group</span>
<a href="#l3.379"></a><span id="l3.379" class="difflineminus">-   */</span>
<a href="#l3.380"></a><span id="l3.380" class="difflineminus">-  async updateReadPrefs() {</span>
<a href="#l3.381"></a><span id="l3.381" class="difflineminus">-    if (AppConstants.MOZ_UPDATER &amp;&amp;</span>
<a href="#l3.382"></a><span id="l3.382" class="difflineminus">-        (!Services.policies || Services.policies.isAllowed(&quot;appUpdate&quot;))) {</span>
<a href="#l3.383"></a><span id="l3.383" class="difflineminus">-      let radiogroup = document.getElementById(&quot;updateRadioGroup&quot;);</span>
<a href="#l3.384"></a><span id="l3.384" class="difflineminus">-      radiogroup.disabled = true;</span>
<a href="#l3.385"></a><span id="l3.385" class="difflineminus">-      try {</span>
<a href="#l3.386"></a><span id="l3.386" class="difflineminus">-        let enabled = await UpdateUtils.getAppUpdateAutoEnabled();</span>
<a href="#l3.387"></a><span id="l3.387" class="difflineminus">-        radiogroup.value = enabled;</span>
<a href="#l3.388"></a><span id="l3.388" class="difflineminus">-        radiogroup.disabled = false;</span>
<a href="#l3.389"></a><span id="l3.389" class="difflineminus">-      } catch (error) {</span>
<a href="#l3.390"></a><span id="l3.390" class="difflineminus">-        Cu.reportError(error);</span>
<a href="#l3.391"></a><span id="l3.391" class="difflineminus">-      }</span>
<a href="#l3.392"></a><span id="l3.392" class="difflineminus">-    }</span>
<a href="#l3.393"></a><span id="l3.393" class="difflineminus">-  },</span>
<a href="#l3.394"></a><span id="l3.394" class="difflineminus">-</span>
<a href="#l3.395"></a><span id="l3.395" class="difflineminus">-  /**</span>
<a href="#l3.396"></a><span id="l3.396" class="difflineminus">-   * Writes the value of the update radio group to the disk</span>
<a href="#l3.397"></a><span id="l3.397" class="difflineminus">-   */</span>
<a href="#l3.398"></a><span id="l3.398" class="difflineminus">-  async updateWritePrefs() {</span>
<a href="#l3.399"></a><span id="l3.399" class="difflineminus">-    if (AppConstants.MOZ_UPDATER &amp;&amp;</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineminus">-        (!Services.policies || Services.policies.isAllowed(&quot;appUpdate&quot;))) {</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineminus">-      let radiogroup = document.getElementById(&quot;updateRadioGroup&quot;);</span>
<a href="#l3.402"></a><span id="l3.402" class="difflineminus">-      let updateAutoValue = (radiogroup.value == &quot;true&quot;);</span>
<a href="#l3.403"></a><span id="l3.403" class="difflineminus">-      radiogroup.disabled = true;</span>
<a href="#l3.404"></a><span id="l3.404" class="difflineminus">-      try {</span>
<a href="#l3.405"></a><span id="l3.405" class="difflineminus">-        await UpdateUtils.setAppUpdateAutoEnabled(updateAutoValue);</span>
<a href="#l3.406"></a><span id="l3.406" class="difflineminus">-        radiogroup.disabled = false;</span>
<a href="#l3.407"></a><span id="l3.407" class="difflineminus">-      } catch (error) {</span>
<a href="#l3.408"></a><span id="l3.408" class="difflineminus">-        Cu.reportError(error);</span>
<a href="#l3.409"></a><span id="l3.409" class="difflineminus">-        await this.updateReadPrefs();</span>
<a href="#l3.410"></a><span id="l3.410" class="difflineminus">-        await this.reportUpdatePrefWriteError(error);</span>
<a href="#l3.411"></a><span id="l3.411" class="difflineminus">-        return;</span>
<a href="#l3.412"></a><span id="l3.412" class="difflineminus">-      }</span>
<a href="#l3.413"></a><span id="l3.413" class="difflineminus">-</span>
<a href="#l3.414"></a><span id="l3.414" class="difflineminus">-      // If the value was changed to false the user should be given the option</span>
<a href="#l3.415"></a><span id="l3.415" class="difflineminus">-      // to discard an update if there is one.</span>
<a href="#l3.416"></a><span id="l3.416" class="difflineminus">-      if (!updateAutoValue) {</span>
<a href="#l3.417"></a><span id="l3.417" class="difflineminus">-        await this.checkUpdateInProgress();</span>
<a href="#l3.418"></a><span id="l3.418" class="difflineminus">-      }</span>
<a href="#l3.419"></a><span id="l3.419" class="difflineminus">-    }</span>
<a href="#l3.420"></a><span id="l3.420" class="difflineminus">-  },</span>
<a href="#l3.421"></a><span id="l3.421" class="difflineminus">-</span>
<a href="#l3.422"></a><span id="l3.422" class="difflineminus">-  async reportUpdatePrefWriteError(error) {</span>
<a href="#l3.423"></a><span id="l3.423" class="difflineminus">-    let [title, message] = await document.l10n.formatValues([</span>
<a href="#l3.424"></a><span id="l3.424" class="difflineminus">-      {id: &quot;update-setting-write-failure-title&quot;},</span>
<a href="#l3.425"></a><span id="l3.425" class="difflineminus">-      {id: &quot;update-setting-write-failure-message&quot;, args: {path: error.path}},</span>
<a href="#l3.426"></a><span id="l3.426" class="difflineminus">-    ]);</span>
<a href="#l3.427"></a><span id="l3.427" class="difflineminus">-</span>
<a href="#l3.428"></a><span id="l3.428" class="difflineminus">-    // Set up the Ok Button</span>
<a href="#l3.429"></a><span id="l3.429" class="difflineminus">-    let buttonFlags = (Services.prompt.BUTTON_POS_0 *</span>
<a href="#l3.430"></a><span id="l3.430" class="difflineminus">-                       Services.prompt.BUTTON_TITLE_OK);</span>
<a href="#l3.431"></a><span id="l3.431" class="difflineminus">-    Services.prompt.confirmEx(window, title, message, buttonFlags,</span>
<a href="#l3.432"></a><span id="l3.432" class="difflineminus">-                              null, null, null, null, {});</span>
<a href="#l3.433"></a><span id="l3.433" class="difflineminus">-  },</span>
<a href="#l3.434"></a><span id="l3.434" class="difflineminus">-</span>
<a href="#l3.435"></a><span id="l3.435" class="difflineminus">-  async checkUpdateInProgress() {</span>
<a href="#l3.436"></a><span id="l3.436" class="difflineminus">-    let um = Cc[&quot;@mozilla.org/updates/update-manager;1&quot;].</span>
<a href="#l3.437"></a><span id="l3.437" class="difflineminus">-             getService(Ci.nsIUpdateManager);</span>
<a href="#l3.438"></a><span id="l3.438" class="difflineminus">-    if (!um.activeUpdate) {</span>
<a href="#l3.439"></a><span id="l3.439" class="difflineminus">-      return;</span>
<a href="#l3.440"></a><span id="l3.440" class="difflineminus">-    }</span>
<a href="#l3.441"></a><span id="l3.441" class="difflineminus">-</span>
<a href="#l3.442"></a><span id="l3.442" class="difflineminus">-    let [</span>
<a href="#l3.443"></a><span id="l3.443" class="difflineminus">-      title, message, okButton, cancelButton,</span>
<a href="#l3.444"></a><span id="l3.444" class="difflineminus">-    ] = await document.l10n.formatValues([</span>
<a href="#l3.445"></a><span id="l3.445" class="difflineminus">-      {id: &quot;update-in-progress-title&quot;},</span>
<a href="#l3.446"></a><span id="l3.446" class="difflineminus">-      {id: &quot;update-in-progress-message&quot;},</span>
<a href="#l3.447"></a><span id="l3.447" class="difflineminus">-      {id: &quot;update-in-progress-ok-button&quot;},</span>
<a href="#l3.448"></a><span id="l3.448" class="difflineminus">-      {id: &quot;update-in-progress-cancel-button&quot;},</span>
<a href="#l3.449"></a><span id="l3.449" class="difflineminus">-    ]);</span>
<a href="#l3.450"></a><span id="l3.450" class="difflineminus">-</span>
<a href="#l3.451"></a><span id="l3.451" class="difflineminus">-    // Continue is the cancel button which is BUTTON_POS_1 and is set as the</span>
<a href="#l3.452"></a><span id="l3.452" class="difflineminus">-    // default so pressing escape or using a platform standard method of closing</span>
<a href="#l3.453"></a><span id="l3.453" class="difflineminus">-    // the UI will not discard the update.</span>
<a href="#l3.454"></a><span id="l3.454" class="difflineminus">-    let buttonFlags =</span>
<a href="#l3.455"></a><span id="l3.455" class="difflineminus">-      (Ci.nsIPrompt.BUTTON_TITLE_IS_STRING * Ci.nsIPrompt.BUTTON_POS_0) +</span>
<a href="#l3.456"></a><span id="l3.456" class="difflineminus">-      (Ci.nsIPrompt.BUTTON_TITLE_IS_STRING * Ci.nsIPrompt.BUTTON_POS_1) +</span>
<a href="#l3.457"></a><span id="l3.457" class="difflineminus">-      Ci.nsIPrompt.BUTTON_POS_1_DEFAULT;</span>
<a href="#l3.458"></a><span id="l3.458" class="difflineminus">-</span>
<a href="#l3.459"></a><span id="l3.459" class="difflineminus">-    let rv = Services.prompt.confirmEx(window, title, message, buttonFlags,</span>
<a href="#l3.460"></a><span id="l3.460" class="difflineminus">-      okButton, cancelButton, null, null, {});</span>
<a href="#l3.461"></a><span id="l3.461" class="difflineminus">-    if (rv != 1) {</span>
<a href="#l3.462"></a><span id="l3.462" class="difflineminus">-      let aus = Cc[&quot;@mozilla.org/updates/update-service;1&quot;].</span>
<a href="#l3.463"></a><span id="l3.463" class="difflineminus">-                getService(Ci.nsIApplicationUpdateService);</span>
<a href="#l3.464"></a><span id="l3.464" class="difflineminus">-      aus.stopDownload();</span>
<a href="#l3.465"></a><span id="l3.465" class="difflineminus">-      um.cleanupActiveUpdate();</span>
<a href="#l3.466"></a><span id="l3.466" class="difflineminus">-    }</span>
<a href="#l3.467"></a><span id="l3.467" class="difflineminus">-  },</span>
<a href="#l3.468"></a><span id="l3.468" class="difflineminus">-</span>
<a href="#l3.469"></a><span id="l3.469" class="difflineminus">-  showUpdates() {</span>
<a href="#l3.470"></a><span id="l3.470" class="difflineminus">-    gSubDialog.open(&quot;chrome://mozapps/content/update/history.xul&quot;);</span>
<a href="#l3.471"></a><span id="l3.471" class="difflineminus">-  },</span>
<a href="#l3.472"></a><span id="l3.472" class="difflineminus">-</span>
<a href="#l3.473"></a><span id="l3.473" class="difflineminus">-  updateCompactOptions() {</span>
<a href="#l3.474"></a><span id="l3.474" class="difflineminus">-    document.getElementById(&quot;offlineCompactFolderMin&quot;).disabled =</span>
<a href="#l3.475"></a><span id="l3.475" class="difflineminus">-      !Preferences.get(&quot;mail.prompt_purge_threshhold&quot;).value ||</span>
<a href="#l3.476"></a><span id="l3.476" class="difflineminus">-      Preferences.get(&quot;mail.purge_threshhold_mb&quot;).locked;</span>
<a href="#l3.477"></a><span id="l3.477" class="difflineminus">-  },</span>
<a href="#l3.478"></a><span id="l3.478" class="difflineminus">-</span>
<a href="#l3.479"></a><span id="l3.479">   updateSubmitCrashReports(aChecked) {</span>
<a href="#l3.480"></a><span id="l3.480">     Cc[&quot;@mozilla.org/toolkit/crash-reporter;1&quot;]</span>
<a href="#l3.481"></a><span id="l3.481">       .getService(Ci.nsICrashReporter)</span>
<a href="#l3.482"></a><span id="l3.482">       .submitReports = aChecked;</span>
<a href="#l3.483"></a><span id="l3.483">   },</span>
<a href="#l3.484"></a><span id="l3.484" class="difflineminus">-  /**</span>
<a href="#l3.485"></a><span id="l3.485" class="difflineminus">-   * Display the return receipts configuration dialog.</span>
<a href="#l3.486"></a><span id="l3.486" class="difflineminus">-   */</span>
<a href="#l3.487"></a><span id="l3.487" class="difflineminus">-  showReturnReceipts() {</span>
<a href="#l3.488"></a><span id="l3.488" class="difflineminus">-    gSubDialog.open(&quot;chrome://messenger/content/preferences/receipts.xul&quot;,</span>
<a href="#l3.489"></a><span id="l3.489" class="difflineminus">-                    &quot;resizable=no&quot;);</span>
<a href="#l3.490"></a><span id="l3.490" class="difflineminus">-  },</span>
<a href="#l3.491"></a><span id="l3.491" class="difflineminus">-</span>
<a href="#l3.492"></a><span id="l3.492" class="difflineminus">-  /**</span>
<a href="#l3.493"></a><span id="l3.493" class="difflineminus">-   * Display the the connection settings dialog.</span>
<a href="#l3.494"></a><span id="l3.494" class="difflineminus">-   */</span>
<a href="#l3.495"></a><span id="l3.495" class="difflineminus">-  showConnections() {</span>
<a href="#l3.496"></a><span id="l3.496" class="difflineminus">-    gSubDialog.open(&quot;chrome://messenger/content/preferences/connection.xul&quot;);</span>
<a href="#l3.497"></a><span id="l3.497" class="difflineminus">-  },</span>
<a href="#l3.498"></a><span id="l3.498" class="difflineminus">-</span>
<a href="#l3.499"></a><span id="l3.499" class="difflineminus">-  /**</span>
<a href="#l3.500"></a><span id="l3.500" class="difflineminus">-   * Display the the offline settings dialog.</span>
<a href="#l3.501"></a><span id="l3.501" class="difflineminus">-   */</span>
<a href="#l3.502"></a><span id="l3.502" class="difflineminus">-  showOffline() {</span>
<a href="#l3.503"></a><span id="l3.503" class="difflineminus">-    gSubDialog.open(&quot;chrome://messenger/content/preferences/offline.xul&quot;,</span>
<a href="#l3.504"></a><span id="l3.504" class="difflineminus">-                    &quot;resizable=no&quot;);</span>
<a href="#l3.505"></a><span id="l3.505" class="difflineminus">-  },</span>
<a href="#l3.506"></a><span id="l3.506"> </span>
<a href="#l3.507"></a><span id="l3.507">   /**</span>
<a href="#l3.508"></a><span id="l3.508">    * Display the user's certificates and associated options.</span>
<a href="#l3.509"></a><span id="l3.509">    */</span>
<a href="#l3.510"></a><span id="l3.510">   showCertificates() {</span>
<a href="#l3.511"></a><span id="l3.511">     gSubDialog.open(&quot;chrome://pippki/content/certManager.xul&quot;);</span>
<a href="#l3.512"></a><span id="l3.512">   },</span>
<a href="#l3.513"></a><span id="l3.513"> </span>
<a href="#l3.514"></a><span id="l3.514" class="difflineat">@@ -531,28 +99,16 @@ var gAdvancedPane = {</span>
<a href="#l3.515"></a><span id="l3.515"> </span>
<a href="#l3.516"></a><span id="l3.516">   /**</span>
<a href="#l3.517"></a><span id="l3.517">    * Display a dialog from which the user can manage his security devices.</span>
<a href="#l3.518"></a><span id="l3.518">    */</span>
<a href="#l3.519"></a><span id="l3.519">   showSecurityDevices() {</span>
<a href="#l3.520"></a><span id="l3.520">     gSubDialog.open(&quot;chrome://pippki/content/device_manager.xul&quot;);</span>
<a href="#l3.521"></a><span id="l3.521">   },</span>
<a href="#l3.522"></a><span id="l3.522"> </span>
<a href="#l3.523"></a><span id="l3.523" class="difflineminus">-  /**</span>
<a href="#l3.524"></a><span id="l3.524" class="difflineminus">-   * When the user toggles the layers.acceleration.disabled pref,</span>
<a href="#l3.525"></a><span id="l3.525" class="difflineminus">-   * sync its new value to the gfx.direct2d.disabled pref too.</span>
<a href="#l3.526"></a><span id="l3.526" class="difflineminus">-   * Note that layers.acceleration.disabled is inverted.</span>
<a href="#l3.527"></a><span id="l3.527" class="difflineminus">-   */</span>
<a href="#l3.528"></a><span id="l3.528" class="difflineminus">-  updateHardwareAcceleration() {</span>
<a href="#l3.529"></a><span id="l3.529" class="difflineminus">-    if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l3.530"></a><span id="l3.530" class="difflineminus">-      let preference = Preferences.get(&quot;layers.acceleration.disabled&quot;);</span>
<a href="#l3.531"></a><span id="l3.531" class="difflineminus">-      Services.prefs.setBoolPref(&quot;gfx.direct2d.disabled&quot;, !preference.value);</span>
<a href="#l3.532"></a><span id="l3.532" class="difflineminus">-    }</span>
<a href="#l3.533"></a><span id="l3.533" class="difflineminus">-  },</span>
<a href="#l3.534"></a><span id="l3.534" class="difflineminus">-</span>
<a href="#l3.535"></a><span id="l3.535">   // DATA CHOICES TAB</span>
<a href="#l3.536"></a><span id="l3.536"> </span>
<a href="#l3.537"></a><span id="l3.537">   /**</span>
<a href="#l3.538"></a><span id="l3.538">    * Open a text link.</span>
<a href="#l3.539"></a><span id="l3.539">    */</span>
<a href="#l3.540"></a><span id="l3.540">   openTextLink(evt) {</span>
<a href="#l3.541"></a><span id="l3.541">     // Opening links behind a modal dialog is poor form. Work around flawed</span>
<a href="#l3.542"></a><span id="l3.542">     // text-link handling by opening in browser if we'd instead get a content</span>
<a href="#l3.543"></a><span id="l3.543" class="difflineat">@@ -610,239 +166,9 @@ var gAdvancedPane = {</span>
<a href="#l3.544"></a><span id="l3.544">    *</span>
<a href="#l3.545"></a><span id="l3.545">    * In all cases, set up the Learn More link sanely</span>
<a href="#l3.546"></a><span id="l3.546">    */</span>
<a href="#l3.547"></a><span id="l3.547">   initTelemetry() {</span>
<a href="#l3.548"></a><span id="l3.548">     if (AppConstants.MOZ_TELEMETRY_REPORTING)</span>
<a href="#l3.549"></a><span id="l3.549">       this._setupLearnMoreLink(&quot;toolkit.telemetry.infoURL&quot;, &quot;telemetryLearnMore&quot;);</span>
<a href="#l3.550"></a><span id="l3.550">   },</span>
<a href="#l3.551"></a><span id="l3.551"> </span>
<a href="#l3.552"></a><span id="l3.552" class="difflineminus">-  formatLocaleSetLabels() {</span>
<a href="#l3.553"></a><span id="l3.553" class="difflineminus">-    const osprefs =</span>
<a href="#l3.554"></a><span id="l3.554" class="difflineminus">-      Cc[&quot;@mozilla.org/intl/ospreferences;1&quot;]</span>
<a href="#l3.555"></a><span id="l3.555" class="difflineminus">-        .getService(Ci.mozIOSPreferences);</span>
<a href="#l3.556"></a><span id="l3.556" class="difflineminus">-    let appLocale = Services.locale.appLocalesAsBCP47[0];</span>
<a href="#l3.557"></a><span id="l3.557" class="difflineminus">-    let rsLocale = osprefs.regionalPrefsLocales[0];</span>
<a href="#l3.558"></a><span id="l3.558" class="difflineminus">-    let names = Services.intl.getLocaleDisplayNames(undefined, [appLocale, rsLocale]);</span>
<a href="#l3.559"></a><span id="l3.559" class="difflineminus">-    let appLocaleRadio = document.getElementById(&quot;appLocale&quot;);</span>
<a href="#l3.560"></a><span id="l3.560" class="difflineminus">-    let rsLocaleRadio = document.getElementById(&quot;rsLocale&quot;);</span>
<a href="#l3.561"></a><span id="l3.561" class="difflineminus">-    let appLocaleLabel = this.mBundle.getFormattedString(&quot;appLocale.label&quot;,</span>
<a href="#l3.562"></a><span id="l3.562" class="difflineminus">-                                                         [names[0]]);</span>
<a href="#l3.563"></a><span id="l3.563" class="difflineminus">-    let rsLocaleLabel = this.mBundle.getFormattedString(&quot;rsLocale.label&quot;,</span>
<a href="#l3.564"></a><span id="l3.564" class="difflineminus">-                                                        [names[1]]);</span>
<a href="#l3.565"></a><span id="l3.565" class="difflineminus">-    appLocaleRadio.setAttribute(&quot;label&quot;, appLocaleLabel);</span>
<a href="#l3.566"></a><span id="l3.566" class="difflineminus">-    rsLocaleRadio.setAttribute(&quot;label&quot;, rsLocaleLabel);</span>
<a href="#l3.567"></a><span id="l3.567" class="difflineminus">-    appLocaleRadio.accessKey = this.mBundle.getString(&quot;appLocale.accesskey&quot;);</span>
<a href="#l3.568"></a><span id="l3.568" class="difflineminus">-    rsLocaleRadio.accessKey = this.mBundle.getString(&quot;rsLocale.accesskey&quot;);</span>
<a href="#l3.569"></a><span id="l3.569" class="difflineminus">-  },</span>
<a href="#l3.570"></a><span id="l3.570" class="difflineminus">-</span>
<a href="#l3.571"></a><span id="l3.571" class="difflineminus">-  // Load the preferences string bundle for other locales with fallbacks.</span>
<a href="#l3.572"></a><span id="l3.572" class="difflineminus">-  getBundleForLocales(newLocales) {</span>
<a href="#l3.573"></a><span id="l3.573" class="difflineminus">-    let locales = Array.from(new Set([</span>
<a href="#l3.574"></a><span id="l3.574" class="difflineminus">-      ...newLocales,</span>
<a href="#l3.575"></a><span id="l3.575" class="difflineminus">-      ...Services.locale.requestedLocales,</span>
<a href="#l3.576"></a><span id="l3.576" class="difflineminus">-      Services.locale.lastFallbackLocale,</span>
<a href="#l3.577"></a><span id="l3.577" class="difflineminus">-    ]));</span>
<a href="#l3.578"></a><span id="l3.578" class="difflineminus">-    function generateBundles(resourceIds) {</span>
<a href="#l3.579"></a><span id="l3.579" class="difflineminus">-      return L10nRegistry.generateBundles(locales, resourceIds);</span>
<a href="#l3.580"></a><span id="l3.580" class="difflineminus">-    }</span>
<a href="#l3.581"></a><span id="l3.581" class="difflineminus">-    return new Localization([</span>
<a href="#l3.582"></a><span id="l3.582" class="difflineminus">-      &quot;messenger/preferences/preferences.ftl&quot;,</span>
<a href="#l3.583"></a><span id="l3.583" class="difflineminus">-      &quot;branding/brand.ftl&quot;,</span>
<a href="#l3.584"></a><span id="l3.584" class="difflineminus">-    ], generateBundles);</span>
<a href="#l3.585"></a><span id="l3.585" class="difflineminus">-  },</span>
<a href="#l3.586"></a><span id="l3.586" class="difflineminus">-</span>
<a href="#l3.587"></a><span id="l3.587" class="difflineminus">-  initMessengerLocale() {</span>
<a href="#l3.588"></a><span id="l3.588" class="difflineminus">-    gAdvancedPane.setMessengerLocales(Services.locale.requestedLocale);</span>
<a href="#l3.589"></a><span id="l3.589" class="difflineminus">-  },</span>
<a href="#l3.590"></a><span id="l3.590" class="difflineminus">-</span>
<a href="#l3.591"></a><span id="l3.591" class="difflineminus">-  /**</span>
<a href="#l3.592"></a><span id="l3.592" class="difflineminus">-   * Update the available list of locales and select the locale that the user</span>
<a href="#l3.593"></a><span id="l3.593" class="difflineminus">-   * is &quot;selecting&quot;. This could be the currently requested locale or a locale</span>
<a href="#l3.594"></a><span id="l3.594" class="difflineminus">-   * that the user would like to switch to after confirmation.</span>
<a href="#l3.595"></a><span id="l3.595" class="difflineminus">-   */</span>
<a href="#l3.596"></a><span id="l3.596" class="difflineminus">-  async setMessengerLocales(selected) {</span>
<a href="#l3.597"></a><span id="l3.597" class="difflineminus">-    let available = await getAvailableLocales();</span>
<a href="#l3.598"></a><span id="l3.598" class="difflineminus">-    let localeNames = Services.intl.getLocaleDisplayNames(undefined, available);</span>
<a href="#l3.599"></a><span id="l3.599" class="difflineminus">-    let locales = available.map((code, i) =&gt; ({code, name: localeNames[i]}));</span>
<a href="#l3.600"></a><span id="l3.600" class="difflineminus">-    locales.sort((a, b) =&gt; a.name &gt; b.name);</span>
<a href="#l3.601"></a><span id="l3.601" class="difflineminus">-</span>
<a href="#l3.602"></a><span id="l3.602" class="difflineminus">-    let fragment = document.createDocumentFragment();</span>
<a href="#l3.603"></a><span id="l3.603" class="difflineminus">-    for (let {code, name} of locales) {</span>
<a href="#l3.604"></a><span id="l3.604" class="difflineminus">-      let menuitem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l3.605"></a><span id="l3.605" class="difflineminus">-      menuitem.setAttribute(&quot;value&quot;, code);</span>
<a href="#l3.606"></a><span id="l3.606" class="difflineminus">-      menuitem.setAttribute(&quot;label&quot;, name);</span>
<a href="#l3.607"></a><span id="l3.607" class="difflineminus">-      fragment.appendChild(menuitem);</span>
<a href="#l3.608"></a><span id="l3.608" class="difflineminus">-    }</span>
<a href="#l3.609"></a><span id="l3.609" class="difflineminus">-</span>
<a href="#l3.610"></a><span id="l3.610" class="difflineminus">-    // Add an option to search for more languages if downloading is supported.</span>
<a href="#l3.611"></a><span id="l3.611" class="difflineminus">-    if (Services.prefs.getBoolPref(&quot;intl.multilingual.downloadEnabled&quot;)) {</span>
<a href="#l3.612"></a><span id="l3.612" class="difflineminus">-      let menuitem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l3.613"></a><span id="l3.613" class="difflineminus">-      menuitem.id = &quot;defaultMessengerLanguageSearch&quot;;</span>
<a href="#l3.614"></a><span id="l3.614" class="difflineminus">-      menuitem.setAttribute(</span>
<a href="#l3.615"></a><span id="l3.615" class="difflineminus">-        &quot;label&quot;, await document.l10n.formatValue(&quot;messenger-languages-search&quot;));</span>
<a href="#l3.616"></a><span id="l3.616" class="difflineminus">-      menuitem.setAttribute(&quot;value&quot;, &quot;search&quot;);</span>
<a href="#l3.617"></a><span id="l3.617" class="difflineminus">-      menuitem.addEventListener(&quot;command&quot;, () =&gt; {</span>
<a href="#l3.618"></a><span id="l3.618" class="difflineminus">-        gAdvancedPane.showMessengerLanguages({search: true});</span>
<a href="#l3.619"></a><span id="l3.619" class="difflineminus">-      });</span>
<a href="#l3.620"></a><span id="l3.620" class="difflineminus">-      fragment.appendChild(menuitem);</span>
<a href="#l3.621"></a><span id="l3.621" class="difflineminus">-    }</span>
<a href="#l3.622"></a><span id="l3.622" class="difflineminus">-</span>
<a href="#l3.623"></a><span id="l3.623" class="difflineminus">-    let menulist = document.getElementById(&quot;defaultMessengerLanguage&quot;);</span>
<a href="#l3.624"></a><span id="l3.624" class="difflineminus">-    let menupopup = menulist.querySelector(&quot;menupopup&quot;);</span>
<a href="#l3.625"></a><span id="l3.625" class="difflineminus">-    menupopup.textContent = &quot;&quot;;</span>
<a href="#l3.626"></a><span id="l3.626" class="difflineminus">-    menupopup.appendChild(fragment);</span>
<a href="#l3.627"></a><span id="l3.627" class="difflineminus">-    menulist.value = selected;</span>
<a href="#l3.628"></a><span id="l3.628" class="difflineminus">-</span>
<a href="#l3.629"></a><span id="l3.629" class="difflineminus">-    document.getElementById(&quot;messengerLanguagesBox&quot;).hidden = false;</span>
<a href="#l3.630"></a><span id="l3.630" class="difflineminus">-  },</span>
<a href="#l3.631"></a><span id="l3.631" class="difflineminus">-</span>
<a href="#l3.632"></a><span id="l3.632" class="difflineminus">-  showMessengerLanguages({search}) {</span>
<a href="#l3.633"></a><span id="l3.633" class="difflineminus">-    let opts = {selected: gAdvancedPane.selectedLocales, search};</span>
<a href="#l3.634"></a><span id="l3.634" class="difflineminus">-    gSubDialog.open(</span>
<a href="#l3.635"></a><span id="l3.635" class="difflineminus">-      &quot;chrome://messenger/content/preferences/messengerLanguages.xul&quot;,</span>
<a href="#l3.636"></a><span id="l3.636" class="difflineminus">-      null, opts, this.messengerLanguagesClosed);</span>
<a href="#l3.637"></a><span id="l3.637" class="difflineminus">-  },</span>
<a href="#l3.638"></a><span id="l3.638" class="difflineminus">-</span>
<a href="#l3.639"></a><span id="l3.639" class="difflineminus">-  /* Show or hide the confirm change message bar based on the updated ordering. */</span>
<a href="#l3.640"></a><span id="l3.640" class="difflineminus">-  messengerLanguagesClosed() {</span>
<a href="#l3.641"></a><span id="l3.641" class="difflineminus">-    let selected = this.gMessengerLanguagesDialog.selected;</span>
<a href="#l3.642"></a><span id="l3.642" class="difflineminus">-    let active = Services.locale.appLocalesAsBCP47;</span>
<a href="#l3.643"></a><span id="l3.643" class="difflineminus">-</span>
<a href="#l3.644"></a><span id="l3.644" class="difflineminus">-    // Prepare for changing the locales if they are different than the current locales.</span>
<a href="#l3.645"></a><span id="l3.645" class="difflineminus">-    if (selected &amp;&amp; selected.join(&quot;,&quot;) != active.join(&quot;,&quot;)) {</span>
<a href="#l3.646"></a><span id="l3.646" class="difflineminus">-      gAdvancedPane.showConfirmLanguageChangeMessageBar(selected);</span>
<a href="#l3.647"></a><span id="l3.647" class="difflineminus">-      gAdvancedPane.setMessengerLocales(selected[0]);</span>
<a href="#l3.648"></a><span id="l3.648" class="difflineminus">-      return;</span>
<a href="#l3.649"></a><span id="l3.649" class="difflineminus">-    }</span>
<a href="#l3.650"></a><span id="l3.650" class="difflineminus">-</span>
<a href="#l3.651"></a><span id="l3.651" class="difflineminus">-    // They matched, so we can reset the UI.</span>
<a href="#l3.652"></a><span id="l3.652" class="difflineminus">-    gAdvancedPane.setMessengerLocales(Services.locale.appLocaleAsBCP47);</span>
<a href="#l3.653"></a><span id="l3.653" class="difflineminus">-    gAdvancedPane.hideConfirmLanguageChangeMessageBar();</span>
<a href="#l3.654"></a><span id="l3.654" class="difflineminus">-  },</span>
<a href="#l3.655"></a><span id="l3.655" class="difflineminus">-</span>
<a href="#l3.656"></a><span id="l3.656" class="difflineminus">-  /* Show the confirmation message bar to allow a restart into the new locales. */</span>
<a href="#l3.657"></a><span id="l3.657" class="difflineminus">-  async showConfirmLanguageChangeMessageBar(locales) {</span>
<a href="#l3.658"></a><span id="l3.658" class="difflineminus">-    let messageBar = document.getElementById(&quot;confirmMessengerLanguage&quot;);</span>
<a href="#l3.659"></a><span id="l3.659" class="difflineminus">-</span>
<a href="#l3.660"></a><span id="l3.660" class="difflineminus">-    // Get the bundle for the new locale.</span>
<a href="#l3.661"></a><span id="l3.661" class="difflineminus">-    let newBundle = this.getBundleForLocales(locales);</span>
<a href="#l3.662"></a><span id="l3.662" class="difflineminus">-</span>
<a href="#l3.663"></a><span id="l3.663" class="difflineminus">-    // Find the messages and labels.</span>
<a href="#l3.664"></a><span id="l3.664" class="difflineminus">-    let messages = await Promise.all([newBundle, document.l10n].map(</span>
<a href="#l3.665"></a><span id="l3.665" class="difflineminus">-      async (bundle) =&gt; bundle.formatValue(&quot;confirm-messenger-language-change-description&quot;)));</span>
<a href="#l3.666"></a><span id="l3.666" class="difflineminus">-    let buttonLabels = await Promise.all([newBundle, document.l10n].map(</span>
<a href="#l3.667"></a><span id="l3.667" class="difflineminus">-      async (bundle) =&gt; bundle.formatValue(&quot;confirm-messenger-language-change-button&quot;)));</span>
<a href="#l3.668"></a><span id="l3.668" class="difflineminus">-</span>
<a href="#l3.669"></a><span id="l3.669" class="difflineminus">-    // If both the message and label are the same, just include one row.</span>
<a href="#l3.670"></a><span id="l3.670" class="difflineminus">-    if (messages[0] == messages[1] &amp;&amp; buttonLabels[0] == buttonLabels[1]) {</span>
<a href="#l3.671"></a><span id="l3.671" class="difflineminus">-      messages.pop();</span>
<a href="#l3.672"></a><span id="l3.672" class="difflineminus">-      buttonLabels.pop();</span>
<a href="#l3.673"></a><span id="l3.673" class="difflineminus">-    }</span>
<a href="#l3.674"></a><span id="l3.674" class="difflineminus">-</span>
<a href="#l3.675"></a><span id="l3.675" class="difflineminus">-    let contentContainer = messageBar.querySelector(&quot;.message-bar-content-container&quot;);</span>
<a href="#l3.676"></a><span id="l3.676" class="difflineminus">-    contentContainer.textContent = &quot;&quot;;</span>
<a href="#l3.677"></a><span id="l3.677" class="difflineminus">-</span>
<a href="#l3.678"></a><span id="l3.678" class="difflineminus">-    for (let i = 0; i &lt; messages.length; i++) {</span>
<a href="#l3.679"></a><span id="l3.679" class="difflineminus">-      let messageContainer = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l3.680"></a><span id="l3.680" class="difflineminus">-      messageContainer.classList.add(&quot;message-bar-content&quot;);</span>
<a href="#l3.681"></a><span id="l3.681" class="difflineminus">-      messageContainer.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l3.682"></a><span id="l3.682" class="difflineminus">-      messageContainer.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<a href="#l3.683"></a><span id="l3.683" class="difflineminus">-</span>
<a href="#l3.684"></a><span id="l3.684" class="difflineminus">-      let description = document.createXULElement(&quot;description&quot;);</span>
<a href="#l3.685"></a><span id="l3.685" class="difflineminus">-      description.classList.add(&quot;message-bar-description&quot;);</span>
<a href="#l3.686"></a><span id="l3.686" class="difflineminus">-      description.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l3.687"></a><span id="l3.687" class="difflineminus">-      description.textContent = messages[i];</span>
<a href="#l3.688"></a><span id="l3.688" class="difflineminus">-      messageContainer.appendChild(description);</span>
<a href="#l3.689"></a><span id="l3.689" class="difflineminus">-</span>
<a href="#l3.690"></a><span id="l3.690" class="difflineminus">-      let button = document.createXULElement(&quot;button&quot;);</span>
<a href="#l3.691"></a><span id="l3.691" class="difflineminus">-      button.addEventListener(&quot;command&quot;, gAdvancedPane.confirmLanguageChange);</span>
<a href="#l3.692"></a><span id="l3.692" class="difflineminus">-      button.classList.add(&quot;message-bar-button&quot;);</span>
<a href="#l3.693"></a><span id="l3.693" class="difflineminus">-      button.setAttribute(&quot;locales&quot;, locales.join(&quot;,&quot;));</span>
<a href="#l3.694"></a><span id="l3.694" class="difflineminus">-      button.setAttribute(&quot;label&quot;, buttonLabels[i]);</span>
<a href="#l3.695"></a><span id="l3.695" class="difflineminus">-      messageContainer.appendChild(button);</span>
<a href="#l3.696"></a><span id="l3.696" class="difflineminus">-</span>
<a href="#l3.697"></a><span id="l3.697" class="difflineminus">-      contentContainer.appendChild(messageContainer);</span>
<a href="#l3.698"></a><span id="l3.698" class="difflineminus">-    }</span>
<a href="#l3.699"></a><span id="l3.699" class="difflineminus">-</span>
<a href="#l3.700"></a><span id="l3.700" class="difflineminus">-    messageBar.hidden = false;</span>
<a href="#l3.701"></a><span id="l3.701" class="difflineminus">-    this.selectedLocales = locales;</span>
<a href="#l3.702"></a><span id="l3.702" class="difflineminus">-  },</span>
<a href="#l3.703"></a><span id="l3.703" class="difflineminus">-</span>
<a href="#l3.704"></a><span id="l3.704" class="difflineminus">-  hideConfirmLanguageChangeMessageBar() {</span>
<a href="#l3.705"></a><span id="l3.705" class="difflineminus">-    let messageBar = document.getElementById(&quot;confirmMessengerLanguage&quot;);</span>
<a href="#l3.706"></a><span id="l3.706" class="difflineminus">-    messageBar.hidden = true;</span>
<a href="#l3.707"></a><span id="l3.707" class="difflineminus">-    let contentContainer = messageBar.querySelector(&quot;.message-bar-content-container&quot;);</span>
<a href="#l3.708"></a><span id="l3.708" class="difflineminus">-    contentContainer.textContent = &quot;&quot;;</span>
<a href="#l3.709"></a><span id="l3.709" class="difflineminus">-    this.requestingLocales = null;</span>
<a href="#l3.710"></a><span id="l3.710" class="difflineminus">-  },</span>
<a href="#l3.711"></a><span id="l3.711" class="difflineminus">-</span>
<a href="#l3.712"></a><span id="l3.712" class="difflineminus">-  /* Confirm the locale change and restart the Thunderbird in the new locale. */</span>
<a href="#l3.713"></a><span id="l3.713" class="difflineminus">-  confirmLanguageChange(event) {</span>
<a href="#l3.714"></a><span id="l3.714" class="difflineminus">-    let localesString = (event.target.getAttribute(&quot;locales&quot;) || &quot;&quot;).trim();</span>
<a href="#l3.715"></a><span id="l3.715" class="difflineminus">-    if (!localesString || localesString.length == 0) {</span>
<a href="#l3.716"></a><span id="l3.716" class="difflineminus">-      return;</span>
<a href="#l3.717"></a><span id="l3.717" class="difflineminus">-    }</span>
<a href="#l3.718"></a><span id="l3.718" class="difflineminus">-    let locales = localesString.split(&quot;,&quot;);</span>
<a href="#l3.719"></a><span id="l3.719" class="difflineminus">-    Services.locale.requestedLocales = locales;</span>
<a href="#l3.720"></a><span id="l3.720" class="difflineminus">-</span>
<a href="#l3.721"></a><span id="l3.721" class="difflineminus">-    // Restart with the new locale.</span>
<a href="#l3.722"></a><span id="l3.722" class="difflineminus">-    let cancelQuit = Cc[&quot;@mozilla.org/supports-PRBool;1&quot;].createInstance(Ci.nsISupportsPRBool);</span>
<a href="#l3.723"></a><span id="l3.723" class="difflineminus">-    Services.obs.notifyObservers(cancelQuit, &quot;quit-application-requested&quot;, &quot;restart&quot;);</span>
<a href="#l3.724"></a><span id="l3.724" class="difflineminus">-    if (!cancelQuit.data) {</span>
<a href="#l3.725"></a><span id="l3.725" class="difflineminus">-      Services.startup.quit(Services.startup.eAttemptQuit | Services.startup.eRestart);</span>
<a href="#l3.726"></a><span id="l3.726" class="difflineminus">-    }</span>
<a href="#l3.727"></a><span id="l3.727" class="difflineminus">-  },</span>
<a href="#l3.728"></a><span id="l3.728" class="difflineminus">-</span>
<a href="#l3.729"></a><span id="l3.729" class="difflineminus">-  /* Show or hide the confirm change message bar based on the new locale. */</span>
<a href="#l3.730"></a><span id="l3.730" class="difflineminus">-  onMessengerLanguageChange(event) {</span>
<a href="#l3.731"></a><span id="l3.731" class="difflineminus">-    let locale = event.target.value;</span>
<a href="#l3.732"></a><span id="l3.732" class="difflineminus">-</span>
<a href="#l3.733"></a><span id="l3.733" class="difflineminus">-    if (locale == &quot;search&quot;) {</span>
<a href="#l3.734"></a><span id="l3.734" class="difflineminus">-      return;</span>
<a href="#l3.735"></a><span id="l3.735" class="difflineminus">-    } else if (locale == Services.locale.appLocaleAsBCP47) {</span>
<a href="#l3.736"></a><span id="l3.736" class="difflineminus">-      this.hideConfirmLanguageChangeMessageBar();</span>
<a href="#l3.737"></a><span id="l3.737" class="difflineminus">-      return;</span>
<a href="#l3.738"></a><span id="l3.738" class="difflineminus">-    }</span>
<a href="#l3.739"></a><span id="l3.739" class="difflineminus">-</span>
<a href="#l3.740"></a><span id="l3.740" class="difflineminus">-    let locales = Array.from(new Set([</span>
<a href="#l3.741"></a><span id="l3.741" class="difflineminus">-      locale,</span>
<a href="#l3.742"></a><span id="l3.742" class="difflineminus">-      ...Services.locale.requestedLocales,</span>
<a href="#l3.743"></a><span id="l3.743" class="difflineminus">-    ]).values());</span>
<a href="#l3.744"></a><span id="l3.744" class="difflineminus">-    this.showConfirmLanguageChangeMessageBar(locales);</span>
<a href="#l3.745"></a><span id="l3.745" class="difflineminus">-  },</span>
<a href="#l3.746"></a><span id="l3.746" class="difflineminus">-</span>
<a href="#l3.747"></a><span id="l3.747" class="difflineminus">-  destroy() {</span>
<a href="#l3.748"></a><span id="l3.748" class="difflineminus">-    window.removeEventListener(&quot;unload&quot;, this);</span>
<a href="#l3.749"></a><span id="l3.749" class="difflineminus">-</span>
<a href="#l3.750"></a><span id="l3.750" class="difflineminus">-    Services.obs.removeObserver(this, AUTO_UPDATE_CHANGED_TOPIC);</span>
<a href="#l3.751"></a><span id="l3.751" class="difflineminus">-  },</span>
<a href="#l3.752"></a><span id="l3.752" class="difflineminus">-</span>
<a href="#l3.753"></a><span id="l3.753" class="difflineminus">-  // nsISupports</span>
<a href="#l3.754"></a><span id="l3.754" class="difflineminus">-</span>
<a href="#l3.755"></a><span id="l3.755" class="difflineminus">-  QueryInterface: ChromeUtils.generateQI([Ci.nsIObserver]),</span>
<a href="#l3.756"></a><span id="l3.756" class="difflineminus">-</span>
<a href="#l3.757"></a><span id="l3.757" class="difflineminus">-  // nsIObserver</span>
<a href="#l3.758"></a><span id="l3.758" class="difflineminus">-</span>
<a href="#l3.759"></a><span id="l3.759" class="difflineminus">-  async observe(aSubject, aTopic, aData) {</span>
<a href="#l3.760"></a><span id="l3.760" class="difflineminus">-    if (aTopic == AUTO_UPDATE_CHANGED_TOPIC) {</span>
<a href="#l3.761"></a><span id="l3.761" class="difflineminus">-      if (aData != &quot;true&quot; &amp;&amp; aData != &quot;false&quot;) {</span>
<a href="#l3.762"></a><span id="l3.762" class="difflineminus">-        throw new Error(&quot;Invalid preference value for app.update.auto&quot;);</span>
<a href="#l3.763"></a><span id="l3.763" class="difflineminus">-      }</span>
<a href="#l3.764"></a><span id="l3.764" class="difflineminus">-      document.getElementById(&quot;updateRadioGroup&quot;).value = aData;</span>
<a href="#l3.765"></a><span id="l3.765" class="difflineminus">-    }</span>
<a href="#l3.766"></a><span id="l3.766" class="difflineminus">-  },</span>
<a href="#l3.767"></a><span id="l3.767" class="difflineminus">-</span>
<a href="#l3.768"></a><span id="l3.768" class="difflineminus">-  // EventListener</span>
<a href="#l3.769"></a><span id="l3.769" class="difflineminus">-</span>
<a href="#l3.770"></a><span id="l3.770" class="difflineminus">-  handleEvent(aEvent) {</span>
<a href="#l3.771"></a><span id="l3.771" class="difflineminus">-    if (aEvent.type == &quot;unload&quot;) {</span>
<a href="#l3.772"></a><span id="l3.772" class="difflineminus">-      this.destroy();</span>
<a href="#l3.773"></a><span id="l3.773" class="difflineminus">-      if (AppConstants.MOZ_UPDATER) {</span>
<a href="#l3.774"></a><span id="l3.774" class="difflineminus">-        onUnload();</span>
<a href="#l3.775"></a><span id="l3.775" class="difflineminus">-      }</span>
<a href="#l3.776"></a><span id="l3.776" class="difflineminus">-    }</span>
<a href="#l3.777"></a><span id="l3.777" class="difflineminus">-  },</span>
<a href="#l3.778"></a><span id="l3.778" class="difflineminus">-</span>
<a href="#l3.779"></a><span id="l3.779"> };</span>
<a href="#l3.780"></a><span id="l3.780" class="difflineminus">-</span>
<a href="#l3.781"></a><span id="l3.781" class="difflineminus">-Preferences.get(&quot;layers.acceleration.disabled&quot;).on(&quot;change&quot;, gAdvancedPane.updateHardwareAcceleration);</span>
<a href="#l3.782"></a><span id="l3.782" class="difflineminus">-Preferences.get(&quot;mail.prompt_purge_threshhold&quot;).on(&quot;change&quot;, gAdvancedPane.updateCompactOptions);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/preferences/applicationManager.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/preferences/applicationManager.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,46 +1,46 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> // applications.js</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">-/* globals gApplicationsPane */</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+/* globals gGeneralPane */</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12"> var gAppManagerDialog = {</span>
<a href="#l4.13"></a><span id="l4.13">   _removed: [],</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">   init() {</span>
<a href="#l4.16"></a><span id="l4.16">     this.handlerInfo = window.arguments[0];</span>
<a href="#l4.17"></a><span id="l4.17">     var bundle = document.getElementById(&quot;appManagerBundle&quot;);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-    gApplicationsPane._prefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+    gGeneralPane._prefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l4.20"></a><span id="l4.20">     var description = this.handlerInfo.typeDescription;</span>
<a href="#l4.21"></a><span id="l4.21">     var key = (this.handlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) ?</span>
<a href="#l4.22"></a><span id="l4.22">                 &quot;handleFile&quot; : &quot;handleProtocol&quot;;</span>
<a href="#l4.23"></a><span id="l4.23">     var contentText = bundle.getFormattedString(key, [description]);</span>
<a href="#l4.24"></a><span id="l4.24">     contentText = bundle.getFormattedString(&quot;descriptionApplications&quot;, [contentText]);</span>
<a href="#l4.25"></a><span id="l4.25">     document.getElementById(&quot;appDescription&quot;).textContent = contentText;</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27">     var list = document.getElementById(&quot;appList&quot;);</span>
<a href="#l4.28"></a><span id="l4.28">     var apps = this.handlerInfo.possibleApplicationHandlers.enumerate();</span>
<a href="#l4.29"></a><span id="l4.29">     while (apps.hasMoreElements()) {</span>
<a href="#l4.30"></a><span id="l4.30">       let app = apps.getNext();</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-      if (!gApplicationsPane.isValidHandlerApp(app))</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+      if (!gGeneralPane.isValidHandlerApp(app))</span>
<a href="#l4.33"></a><span id="l4.33">         continue;</span>
<a href="#l4.34"></a><span id="l4.34"> </span>
<a href="#l4.35"></a><span id="l4.35">       app.QueryInterface(Ci.nsIHandlerApp);</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37">       // Ensure the XBL binding is created eagerly.</span>
<a href="#l4.38"></a><span id="l4.38">       // eslint-disable-next-line no-undef</span>
<a href="#l4.39"></a><span id="l4.39">       list.appendChild(MozXULElement.parseXULToFragment(&quot;&lt;richlistitem/&gt;&quot;));</span>
<a href="#l4.40"></a><span id="l4.40">       let item = list.lastChild;</span>
<a href="#l4.41"></a><span id="l4.41">       item.app = app;</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43">       let image = document.createXULElement(&quot;image&quot;);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-      image.setAttribute(&quot;src&quot;, gApplicationsPane._getIconURLForHandlerApp(app));</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+      image.setAttribute(&quot;src&quot;, gGeneralPane._getIconURLForHandlerApp(app));</span>
<a href="#l4.46"></a><span id="l4.46">       item.appendChild(image);</span>
<a href="#l4.47"></a><span id="l4.47"> </span>
<a href="#l4.48"></a><span id="l4.48">       let label = document.createXULElement(&quot;label&quot;);</span>
<a href="#l4.49"></a><span id="l4.49">       label.setAttribute(&quot;value&quot;, app.name);</span>
<a href="#l4.50"></a><span id="l4.50">       item.appendChild(label);</span>
<a href="#l4.51"></a><span id="l4.51">     }</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53">     list.selectedIndex = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/preferences/applicationManager.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/preferences/applicationManager.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -11,17 +11,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l5.5"></a><span id="l5.5">         buttons=&quot;accept,cancel&quot;</span>
<a href="#l5.6"></a><span id="l5.6">         onload=&quot;gAppManagerDialog.init();&quot;</span>
<a href="#l5.7"></a><span id="l5.7">         title=&quot;&amp;appManager.title;&quot;</span>
<a href="#l5.8"></a><span id="l5.8">         style=&quot;&amp;appManager.style;&quot;</span>
<a href="#l5.9"></a><span id="l5.9">         persist=&quot;screenX screenY&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   &lt;script src=&quot;chrome://global/content/preferencesBindings.js&quot;/&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  &lt;script src=&quot;chrome://messenger/content/preferences/applications.js&quot;/&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/preferences/general.js&quot;/&gt;</span>
<a href="#l5.14"></a><span id="l5.14">   &lt;script src=&quot;chrome://messenger/content/preferences/applicationManager.js&quot;/&gt;</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16">   &lt;commandset id=&quot;appManagerCommandSet&quot;&gt;</span>
<a href="#l5.17"></a><span id="l5.17">     &lt;command id=&quot;cmd_delete&quot;</span>
<a href="#l5.18"></a><span id="l5.18">              oncommand=&quot;gAppManagerDialog.remove();&quot;</span>
<a href="#l5.19"></a><span id="l5.19">              disabled=&quot;true&quot;/&gt;</span>
<a href="#l5.20"></a><span id="l5.20">   &lt;/commandset&gt;</span>
<a href="#l5.21"></a><span id="l5.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/preferences/applications.inc.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/preferences/applications.inc.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,106 +1,23 @@</span>
<a href="#l6.4"></a><span id="l6.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l6.7"></a><span id="l6.7">   &lt;prefpane id=&quot;paneApplications&quot; label=&quot;&amp;paneAttachments.title;&quot;&gt;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">-    &lt;script&gt;</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">-    &lt;![CDATA[</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">-#ifdef MOZ_WIDGET_GTK</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      var ICON_URL_APP      = &quot;moz-icon://dummy.exe?size=16&quot;;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-#else</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-      var ICON_URL_APP      = &quot;chrome://messenger/skin/preferences/application.png&quot;;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-#endif</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-    ]]&gt;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-    &lt;/script&gt;</span>
<a href="#l6.18"></a><span id="l6.18">     &lt;script src=&quot;chrome://messenger/content/preferences/applications.js&quot;/&gt;</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-    &lt;commandset id=&quot;appPaneCommandSet&quot;&gt;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-      &lt;command id=&quot;cmd_delete&quot;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">-               oncommand=&quot;gApplicationsPane.onDelete();&quot;/&gt;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">-    &lt;/commandset&gt;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-    &lt;keyset id=&quot;appPaneKeyset&quot;&gt;</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">-      &lt;key keycode=&quot;VK_BACK&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">-      &lt;key keycode=&quot;VK_DELETE&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-    &lt;/keyset&gt;</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">-</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-    &lt;keyset&gt;</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-      &lt;key key=&quot;&amp;focusSearch1.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-           oncommand=&quot;gApplicationsPane.focusFilterBox();&quot;/&gt;</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-      &lt;key key=&quot;&amp;focusSearch2.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-           oncommand=&quot;gApplicationsPane.focusFilterBox();&quot;/&gt;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-    &lt;/keyset&gt;</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-</span>
<a href="#l6.38"></a><span id="l6.38">     &lt;tabbox id=&quot;attachmentPrefs&quot; flex=&quot;1&quot; onselect=&quot;gApplicationsTabController.tabSelectionChanged();&quot;&gt;</span>
<a href="#l6.39"></a><span id="l6.39">       &lt;tabs id=&quot;attachmentPrefsTabs&quot;&gt;</span>
<a href="#l6.40"></a><span id="l6.40">         &lt;tab id=&quot;attachmentsInTab&quot; label=&quot;&amp;attachments.incoming.label;&quot;/&gt;</span>
<a href="#l6.41"></a><span id="l6.41">         &lt;tab id=&quot;attachmentsOutTab&quot; label=&quot;&amp;attachments.outgoing.label;&quot;/&gt;</span>
<a href="#l6.42"></a><span id="l6.42">       &lt;/tabs&gt;</span>
<a href="#l6.43"></a><span id="l6.43"> </span>
<a href="#l6.44"></a><span id="l6.44">       &lt;tabpanels id=&quot;attachmentPrefsPanels&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l6.45"></a><span id="l6.45">         &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-          &lt;hbox&gt;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-            &lt;textbox is=&quot;search-textbox&quot; id=&quot;filter&quot;</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-                     flex=&quot;1&quot;</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-                     placeholder=&quot;&amp;filter.placeholder;&quot;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-                     aria-controls=&quot;handlersView&quot;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-                     oncommand=&quot;gApplicationsPane.rebuildView();&quot;/&gt;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-          &lt;/hbox&gt;</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-          &lt;listheader equalsize=&quot;always&quot;&gt;</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-            &lt;treecol id=&quot;typeColumn&quot; label=&quot;&amp;typeColumn.label;&quot; value=&quot;type&quot;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-                      accesskey=&quot;&amp;typeColumn.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-                      flex=&quot;1&quot; onclick=&quot;gApplicationsPane.sort(event);&quot;</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-                      sortDirection=&quot;ascending&quot; sort=&quot;typeDescription&quot;/&gt;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-            &lt;treecol id=&quot;actionColumn&quot; label=&quot;&amp;actionColumn2.label;&quot; value=&quot;action&quot;</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-                      accesskey=&quot;&amp;actionColumn2.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-                      flex=&quot;1&quot; onclick=&quot;gApplicationsPane.sort(event);&quot;/&gt;</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-          &lt;/listheader&gt;</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineminus">-          &lt;richlistbox id=&quot;handlersView&quot;</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-                       preference=&quot;pref.downloads.disable_button.edit_actions&quot;/&gt;</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineminus">-</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineminus">-          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineminus">-</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-          &lt;script src=&quot;chrome://messenger/content/preferences/downloads.js&quot;/&gt;</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-          &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-            &lt;radiogroup id=&quot;saveWhere&quot; flex=&quot;1&quot;</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-                        preference=&quot;browser.download.useDownloadDir&quot;&gt;</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-            &lt;hbox id=&quot;saveToRow&quot; align=&quot;center&quot;&gt;</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-              &lt;radio id=&quot;saveTo&quot; value=&quot;true&quot;</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineminus">-                     label=&quot;&amp;saveTo.label;&quot;</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineminus">-                     accesskey=&quot;&amp;saveTo.accesskey;&quot;</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-                     aria-labelledby=&quot;saveTo downloadFolder&quot;/&gt;</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineminus">-              &lt;textbox id=&quot;downloadFolder&quot; flex=&quot;1&quot;</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineminus">-                       type=&quot;filefield&quot;</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-                       readonly=&quot;true&quot;</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-                       aria-labelledby=&quot;saveTo&quot;/&gt;</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineminus">-              &lt;button id=&quot;chooseFolder&quot; oncommand=&quot;gDownloadDirSection.chooseFolder();&quot;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineminus">-                      accesskey=&quot;&amp;chooseFolderMac.accesskey;&quot;</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineminus">-                      label=&quot;&amp;chooseFolderMac.label;&quot;/&gt;</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineminus">-#else</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineminus">-                      accesskey=&quot;&amp;chooseFolderWin.accesskey;&quot;</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineminus">-                      label=&quot;&amp;chooseFolderWin.label;&quot;/&gt;</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineminus">-#endif</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-              &lt;radio id=&quot;alwaysAsk&quot;</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-                     value=&quot;false&quot;</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineminus">-                     label=&quot;&amp;alwaysAsk.label;&quot;</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineminus">-                     accesskey=&quot;&amp;alwaysAsk.accesskey;&quot;/&gt;</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-            &lt;/radiogroup&gt;</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-          &lt;/vbox&gt;</span>
<a href="#l6.102"></a><span id="l6.102">         &lt;/tabpanel&gt;</span>
<a href="#l6.103"></a><span id="l6.103"> </span>
<a href="#l6.104"></a><span id="l6.104">         &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l6.105"></a><span id="l6.105">           &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l6.106"></a><span id="l6.106">             &lt;hbox id=&quot;cloudFileToggleAndThreshold&quot; align=&quot;center&quot;&gt;</span>
<a href="#l6.107"></a><span id="l6.107">               &lt;checkbox id=&quot;enableThreshold&quot;</span>
<a href="#l6.108"></a><span id="l6.108">                         label=&quot;&amp;enableCloudFileAccountOffer.label;&quot;</span>
<a href="#l6.109"></a><span id="l6.109">                         preference=&quot;mail.compose.big_attachments.notify&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/preferences/applications.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/preferences/applications.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -5,460 +5,37 @@</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> &quot;use strict&quot;;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> /* import-globals-from preferences.js */</span>
<a href="#l7.8"></a><span id="l7.8"> /* import-globals-from subdialogs.js */</span>
<a href="#l7.9"></a><span id="l7.9"> /* import-globals-from ../../../../toolkit/content/preferencesBindings.js */</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> // applications.inc.xul</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-/* globals ICON_URL_APP */</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-// ------------------------------</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-// Constants &amp; Enumeration Values</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-// For CSS. Can be one of &quot;ask&quot;, &quot;save&quot;, or &quot;feed&quot;. If absent, the icon URL</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-// was set by us to a custom handler icon and CSS should not try to override it.</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-var APP_ICON_ATTR_NAME = &quot;appHandlerIcon&quot;;</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21"> var gNodeToObjectMap = new WeakMap();</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23"> // CloudFile account tools used by gCloudFileTab.</span>
<a href="#l7.24"></a><span id="l7.24"> var {cloudFileAccounts} = ChromeUtils.import(&quot;resource:///modules/cloudFileAccounts.jsm&quot;);</span>
<a href="#l7.25"></a><span id="l7.25"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineminus">-var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineminus">-var {AppConstants} = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-XPCOMUtils.defineLazyServiceGetters(this, {</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  gHandlerService: [&quot;@mozilla.org/uriloader/handler-service;1&quot;, &quot;nsIHandlerService&quot;],</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  gMIMEService: [&quot;@mozilla.org/mime;1&quot;, &quot;nsIMIMEService&quot;],</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-});</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34"> Preferences.addAll([</span>
<a href="#l7.35"></a><span id="l7.35">   { id: &quot;mail.preferences.applications.selectedTabIndex&quot;, type: &quot;int&quot; },</span>
<a href="#l7.36"></a><span id="l7.36">   { id: &quot;mail.compose.big_attachments.notify&quot;, type: &quot;bool&quot; },</span>
<a href="#l7.37"></a><span id="l7.37">   { id: &quot;mail.compose.big_attachments.threshold_kb&quot;, type: &quot;int&quot; },</span>
<a href="#l7.38"></a><span id="l7.38"> ]);</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40"> if (document.getElementById(&quot;paneApplications&quot;))</span>
<a href="#l7.41"></a><span id="l7.41">   document.getElementById(&quot;paneApplications&quot;)</span>
<a href="#l7.42"></a><span id="l7.42">           .addEventListener(&quot;paneload&quot;, () =&gt; gApplicationsTabController.init());</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44"> // ---------</span>
<a href="#l7.45"></a><span id="l7.45"> // Utilities</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47" class="difflineminus">-function getDisplayNameForFile(aFile) {</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-  if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineminus">-    if (aFile instanceof Ci.nsILocalFileWin) {</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-      try {</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-        return aFile.getVersionInfoField(&quot;FileDescription&quot;);</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineminus">-      } catch (ex) {</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineminus">-        // fall through to the file name</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-      }</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-    }</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineminus">-  } else if (AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-    if (aFile instanceof Ci.nsILocalFileMac) {</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-      try {</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-        return aFile.bundleDisplayName;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-      } catch (ex) {</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-        // fall through to the file name</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-      }</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineminus">-    }</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineminus">-  }</span>
<a href="#l7.65"></a><span id="l7.65"> </span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-  return aFile.leafName;</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-}</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-function getLocalHandlerApp(aFile) {</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineminus">-  var localHandlerApp = Cc[&quot;@mozilla.org/uriloader/local-handler-app;1&quot;]</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineminus">-                          .createInstance(Ci.nsILocalHandlerApp);</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineminus">-  localHandlerApp.name = getDisplayNameForFile(aFile);</span>
<a href="#l7.73"></a><span id="l7.73" class="difflineminus">-  localHandlerApp.executable = aFile;</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineminus">-  return localHandlerApp;</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineminus">-}</span>
<a href="#l7.77"></a><span id="l7.77" class="difflineminus">-</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineminus">-// eslint-disable-next-line no-undef</span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-let gHandlerListItemFragment = MozXULElement.parseXULToFragment(`</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineminus">-  &lt;richlistitem&gt;</span>
<a href="#l7.81"></a><span id="l7.81" class="difflineminus">-    &lt;hbox flex=&quot;1&quot; equalsize=&quot;always&quot;&gt;</span>
<a href="#l7.82"></a><span id="l7.82" class="difflineminus">-      &lt;hbox class=&quot;typeContainer&quot; flex=&quot;1&quot; align=&quot;center&quot;&gt;</span>
<a href="#l7.83"></a><span id="l7.83" class="difflineminus">-        &lt;image class=&quot;typeIcon&quot; width=&quot;16&quot; height=&quot;16&quot;</span>
<a href="#l7.84"></a><span id="l7.84" class="difflineminus">-               src=&quot;moz-icon://goat?size=16&quot;/&gt;</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-        &lt;label class=&quot;typeDescription&quot; flex=&quot;1&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-      &lt;hbox class=&quot;actionContainer&quot; flex=&quot;1&quot; align=&quot;center&quot;&gt;</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-        &lt;image class=&quot;actionIcon&quot; width=&quot;16&quot; height=&quot;16&quot;/&gt;</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineminus">-        &lt;label class=&quot;actionDescription&quot; flex=&quot;1&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineminus">-      &lt;hbox class=&quot;actionsMenuContainer&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l7.92"></a><span id="l7.92" class="difflineminus">-        &lt;menulist class=&quot;actionsMenu&quot; flex=&quot;1&quot; crop=&quot;end&quot; selectedIndex=&quot;1&quot;&gt;</span>
<a href="#l7.93"></a><span id="l7.93" class="difflineminus">-          &lt;menupopup/&gt;</span>
<a href="#l7.94"></a><span id="l7.94" class="difflineminus">-        &lt;/menulist&gt;</span>
<a href="#l7.95"></a><span id="l7.95" class="difflineminus">-      &lt;/hbox&gt;</span>
<a href="#l7.96"></a><span id="l7.96" class="difflineminus">-    &lt;/hbox&gt;</span>
<a href="#l7.97"></a><span id="l7.97" class="difflineminus">-  &lt;/richlistitem&gt;</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-`);</span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-/**</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineminus">- * This is associated to &lt;richlistitem&gt; elements in the handlers view.</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineminus">- */</span>
<a href="#l7.103"></a><span id="l7.103" class="difflineminus">-class HandlerListItem {</span>
<a href="#l7.104"></a><span id="l7.104" class="difflineminus">-  static forNode(node) {</span>
<a href="#l7.105"></a><span id="l7.105" class="difflineminus">-    return gNodeToObjectMap.get(node);</span>
<a href="#l7.106"></a><span id="l7.106" class="difflineminus">-  }</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineminus">-  constructor(handlerInfoWrapper) {</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-    this.handlerInfoWrapper = handlerInfoWrapper;</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineminus">-    }</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineminus">-</span>
<a href="#l7.112"></a><span id="l7.112" class="difflineminus">-  setOrRemoveAttributes(iterable) {</span>
<a href="#l7.113"></a><span id="l7.113" class="difflineminus">-    for (let [selector, name, value] of iterable) {</span>
<a href="#l7.114"></a><span id="l7.114" class="difflineminus">-      let node = selector ? this.node.querySelector(selector) : this.node;</span>
<a href="#l7.115"></a><span id="l7.115" class="difflineminus">-      if (value) {</span>
<a href="#l7.116"></a><span id="l7.116" class="difflineminus">-        node.setAttribute(name, value);</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineminus">-      } else {</span>
<a href="#l7.118"></a><span id="l7.118" class="difflineminus">-        node.removeAttribute(name);</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineminus">-      }</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineminus">-    }</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineminus">-  }</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineminus">-</span>
<a href="#l7.123"></a><span id="l7.123" class="difflineminus">-  connectAndAppendToList(list) {</span>
<a href="#l7.124"></a><span id="l7.124" class="difflineminus">-    list.appendChild(document.importNode(gHandlerListItemFragment, true));</span>
<a href="#l7.125"></a><span id="l7.125" class="difflineminus">-    this.node = list.lastChild;</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineminus">-    gNodeToObjectMap.set(this.node, this);</span>
<a href="#l7.127"></a><span id="l7.127" class="difflineminus">-</span>
<a href="#l7.128"></a><span id="l7.128" class="difflineminus">-    this.node.querySelector(&quot;.actionsMenu&quot;).addEventListener(&quot;command&quot;,</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineminus">-      event =&gt; gApplicationsPane.onSelectAction(event.originalTarget));</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineminus">-</span>
<a href="#l7.131"></a><span id="l7.131" class="difflineminus">-    let typeDescription = this.handlerInfoWrapper.typeDescription;</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineminus">-    this.setOrRemoveAttributes([</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-      [null, &quot;type&quot;, this.handlerInfoWrapper.type],</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineminus">-      [&quot;.typeContainer&quot;, &quot;tooltiptext&quot;, typeDescription],</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineminus">-      [&quot;.typeDescription&quot;, &quot;value&quot;, typeDescription],</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineminus">-      [&quot;.typeIcon&quot;, &quot;src&quot;, this.handlerInfoWrapper.smallIcon],</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineminus">-    ]);</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineminus">-    this.refreshAction();</span>
<a href="#l7.139"></a><span id="l7.139" class="difflineminus">-    this.showActionsMenu = false;</span>
<a href="#l7.140"></a><span id="l7.140" class="difflineminus">-  }</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineminus">-</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineminus">-  refreshAction() {</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineminus">-    let { actionIconClass, actionDescription } = this.handlerInfoWrapper;</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineminus">-    this.setOrRemoveAttributes([</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineminus">-      [null, APP_ICON_ATTR_NAME, actionIconClass],</span>
<a href="#l7.146"></a><span id="l7.146" class="difflineminus">-      [&quot;.actionContainer&quot;, &quot;tooltiptext&quot;, actionDescription],</span>
<a href="#l7.147"></a><span id="l7.147" class="difflineminus">-      [&quot;.actionDescription&quot;, &quot;value&quot;, actionDescription],</span>
<a href="#l7.148"></a><span id="l7.148" class="difflineminus">-      [&quot;.actionIcon&quot;, &quot;src&quot;, actionIconClass ? null :</span>
<a href="#l7.149"></a><span id="l7.149" class="difflineminus">-                             this.handlerInfoWrapper.actionIcon],</span>
<a href="#l7.150"></a><span id="l7.150" class="difflineminus">-    ]);</span>
<a href="#l7.151"></a><span id="l7.151" class="difflineminus">-  }</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineminus">-</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineminus">-  set showActionsMenu(value) {</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineminus">-    this.setOrRemoveAttributes([</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineminus">-      [&quot;.actionContainer&quot;, &quot;hidden&quot;, value],</span>
<a href="#l7.156"></a><span id="l7.156" class="difflineminus">-      [&quot;.actionsMenuContainer&quot;, &quot;hidden&quot;, !value],</span>
<a href="#l7.157"></a><span id="l7.157" class="difflineminus">-    ]);</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineminus">-  }</span>
<a href="#l7.159"></a><span id="l7.159" class="difflineminus">-}</span>
<a href="#l7.160"></a><span id="l7.160" class="difflineminus">-</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineminus">-/**</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineminus">- * This object wraps nsIHandlerInfo with some additional functionality</span>
<a href="#l7.163"></a><span id="l7.163" class="difflineminus">- * the Applications prefpane needs to display and allow modification of</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineminus">- * the list of handled types.</span>
<a href="#l7.165"></a><span id="l7.165" class="difflineminus">- *</span>
<a href="#l7.166"></a><span id="l7.166" class="difflineminus">- * We create an instance of this wrapper for each entry we might display</span>
<a href="#l7.167"></a><span id="l7.167" class="difflineminus">- * in the prefpane, and we compose the instances from various sources,</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineminus">- * including the handler service.</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineminus">- *</span>
<a href="#l7.170"></a><span id="l7.170" class="difflineminus">- * We don't implement all the original nsIHandlerInfo functionality,</span>
<a href="#l7.171"></a><span id="l7.171" class="difflineminus">- * just the stuff that the prefpane needs.</span>
<a href="#l7.172"></a><span id="l7.172" class="difflineminus">- */</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineminus">-class HandlerInfoWrapper {</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineminus">-  constructor(type, handlerInfo) {</span>
<a href="#l7.175"></a><span id="l7.175" class="difflineminus">-    this.type = type;</span>
<a href="#l7.176"></a><span id="l7.176" class="difflineminus">-    this.wrappedHandlerInfo = handlerInfo;</span>
<a href="#l7.177"></a><span id="l7.177" class="difflineminus">-    this.disambiguateDescription = false;</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineminus">-  }</span>
<a href="#l7.179"></a><span id="l7.179" class="difflineminus">-</span>
<a href="#l7.180"></a><span id="l7.180" class="difflineminus">-  get description() {</span>
<a href="#l7.181"></a><span id="l7.181" class="difflineminus">-    if (this.wrappedHandlerInfo.description)</span>
<a href="#l7.182"></a><span id="l7.182" class="difflineminus">-      return this.wrappedHandlerInfo.description;</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineminus">-</span>
<a href="#l7.184"></a><span id="l7.184" class="difflineminus">-    if (this.primaryExtension) {</span>
<a href="#l7.185"></a><span id="l7.185" class="difflineminus">-      var extension = this.primaryExtension.toUpperCase();</span>
<a href="#l7.186"></a><span id="l7.186" class="difflineminus">-      return document.getElementById(&quot;bundlePreferences&quot;)</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineminus">-                     .getFormattedString(&quot;fileEnding&quot;, [extension]);</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineminus">-    }</span>
<a href="#l7.189"></a><span id="l7.189" class="difflineminus">-    return this.type;</span>
<a href="#l7.190"></a><span id="l7.190" class="difflineminus">-  }</span>
<a href="#l7.191"></a><span id="l7.191" class="difflineminus">-</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineminus">-  /**</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineminus">-   * Describe, in a human-readable fashion, the type represented by the given</span>
<a href="#l7.194"></a><span id="l7.194" class="difflineminus">-   * handler info object.  Normally this is just the description, but if more</span>
<a href="#l7.195"></a><span id="l7.195" class="difflineminus">-   * than one object presents the same description, &quot;disambiguateDescription&quot;</span>
<a href="#l7.196"></a><span id="l7.196" class="difflineminus">-   * is set and we annotate the duplicate descriptions with the type itself</span>
<a href="#l7.197"></a><span id="l7.197" class="difflineminus">-   * to help users distinguish between those types.</span>
<a href="#l7.198"></a><span id="l7.198" class="difflineminus">-   */</span>
<a href="#l7.199"></a><span id="l7.199" class="difflineminus">-  get typeDescription() {</span>
<a href="#l7.200"></a><span id="l7.200" class="difflineminus">-    if (this.disambiguateDescription) {</span>
<a href="#l7.201"></a><span id="l7.201" class="difflineminus">-      return this._prefsBundle.getFormattedString(</span>
<a href="#l7.202"></a><span id="l7.202" class="difflineminus">-        &quot;typeDetailsWithTypeAndExt&quot;, [this.description, this.type]);</span>
<a href="#l7.203"></a><span id="l7.203" class="difflineminus">-    }</span>
<a href="#l7.204"></a><span id="l7.204" class="difflineminus">-</span>
<a href="#l7.205"></a><span id="l7.205" class="difflineminus">-    return this.description;</span>
<a href="#l7.206"></a><span id="l7.206" class="difflineminus">-  }</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineminus">-</span>
<a href="#l7.208"></a><span id="l7.208" class="difflineminus">-  /**</span>
<a href="#l7.209"></a><span id="l7.209" class="difflineminus">-   * Describe, in a human-readable fashion, the preferred action to take on</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineminus">-   * the type represented by the given handler info object.</span>
<a href="#l7.211"></a><span id="l7.211" class="difflineminus">-   */</span>
<a href="#l7.212"></a><span id="l7.212" class="difflineminus">-  get actionDescription() {</span>
<a href="#l7.213"></a><span id="l7.213" class="difflineminus">-    // alwaysAskBeforeHandling overrides the preferred action, so if that flag</span>
<a href="#l7.214"></a><span id="l7.214" class="difflineminus">-    // is set, then describe that behavior instead.  For most types, this is</span>
<a href="#l7.215"></a><span id="l7.215" class="difflineminus">-    // the &quot;alwaysAsk&quot; string, but for the feed type we show something special.</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineminus">-    if (this.alwaysAskBeforeHandling) {</span>
<a href="#l7.217"></a><span id="l7.217" class="difflineminus">-      return gApplicationsPane._prefsBundle.getString(&quot;alwaysAsk&quot;);</span>
<a href="#l7.218"></a><span id="l7.218" class="difflineminus">-    }</span>
<a href="#l7.219"></a><span id="l7.219" class="difflineminus">-</span>
<a href="#l7.220"></a><span id="l7.220" class="difflineminus">-    switch (this.preferredAction) {</span>
<a href="#l7.221"></a><span id="l7.221" class="difflineminus">-      case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l7.222"></a><span id="l7.222" class="difflineminus">-        return gApplicationsPane._prefsBundle.getString(&quot;saveFile&quot;);</span>
<a href="#l7.223"></a><span id="l7.223" class="difflineminus">-</span>
<a href="#l7.224"></a><span id="l7.224" class="difflineminus">-      case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l7.225"></a><span id="l7.225" class="difflineminus">-        var preferredApp = this.preferredApplicationHandler;</span>
<a href="#l7.226"></a><span id="l7.226" class="difflineminus">-        var name;</span>
<a href="#l7.227"></a><span id="l7.227" class="difflineminus">-        if (preferredApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l7.228"></a><span id="l7.228" class="difflineminus">-          name = getDisplayNameForFile(preferredApp.executable);</span>
<a href="#l7.229"></a><span id="l7.229" class="difflineminus">-        else</span>
<a href="#l7.230"></a><span id="l7.230" class="difflineminus">-          name = preferredApp.name;</span>
<a href="#l7.231"></a><span id="l7.231" class="difflineminus">-        return gApplicationsPane._prefsBundle.getFormattedString(&quot;useApp&quot;, [name]);</span>
<a href="#l7.232"></a><span id="l7.232" class="difflineminus">-</span>
<a href="#l7.233"></a><span id="l7.233" class="difflineminus">-      case Ci.nsIHandlerInfo.handleInternally:</span>
<a href="#l7.234"></a><span id="l7.234" class="difflineminus">-        if (this instanceof InternalHandlerInfoWrapper) {</span>
<a href="#l7.235"></a><span id="l7.235" class="difflineminus">-          return gApplicationsPane._prefsBundle.getFormattedString(&quot;previewInApp&quot;,</span>
<a href="#l7.236"></a><span id="l7.236" class="difflineminus">-            [gApplicationsPane._brandShortName]);</span>
<a href="#l7.237"></a><span id="l7.237" class="difflineminus">-        }</span>
<a href="#l7.238"></a><span id="l7.238" class="difflineminus">-</span>
<a href="#l7.239"></a><span id="l7.239" class="difflineminus">-        // For other types, handleInternally looks like either useHelperApp</span>
<a href="#l7.240"></a><span id="l7.240" class="difflineminus">-        // or useSystemDefault depending on whether or not there's a preferred</span>
<a href="#l7.241"></a><span id="l7.241" class="difflineminus">-        // handler app.</span>
<a href="#l7.242"></a><span id="l7.242" class="difflineminus">-        if (gApplicationsPane.isValidHandlerApp(this.preferredApplicationHandler))</span>
<a href="#l7.243"></a><span id="l7.243" class="difflineminus">-          return this.preferredApplicationHandler.name;</span>
<a href="#l7.244"></a><span id="l7.244" class="difflineminus">-</span>
<a href="#l7.245"></a><span id="l7.245" class="difflineminus">-        return this.defaultDescription;</span>
<a href="#l7.246"></a><span id="l7.246" class="difflineminus">-</span>
<a href="#l7.247"></a><span id="l7.247" class="difflineminus">-      // XXX Why don't we say the app will handle the type internally?</span>
<a href="#l7.248"></a><span id="l7.248" class="difflineminus">-      // Is it because the app can't actually do that?  But if that's true,</span>
<a href="#l7.249"></a><span id="l7.249" class="difflineminus">-      // then why would a preferredAction ever get set to this value</span>
<a href="#l7.250"></a><span id="l7.250" class="difflineminus">-      // in the first place?</span>
<a href="#l7.251"></a><span id="l7.251" class="difflineminus">-</span>
<a href="#l7.252"></a><span id="l7.252" class="difflineminus">-      case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l7.253"></a><span id="l7.253" class="difflineminus">-        return gApplicationsPane._prefsBundle.getFormattedString(&quot;useDefault&quot;,</span>
<a href="#l7.254"></a><span id="l7.254" class="difflineminus">-          [this.defaultDescription]);</span>
<a href="#l7.255"></a><span id="l7.255" class="difflineminus">-</span>
<a href="#l7.256"></a><span id="l7.256" class="difflineminus">-      default:</span>
<a href="#l7.257"></a><span id="l7.257" class="difflineminus">-        throw new Error(`Unexpected preferredAction: ${this.preferredAction}`);</span>
<a href="#l7.258"></a><span id="l7.258" class="difflineminus">-    }</span>
<a href="#l7.259"></a><span id="l7.259" class="difflineminus">-  }</span>
<a href="#l7.260"></a><span id="l7.260" class="difflineminus">-</span>
<a href="#l7.261"></a><span id="l7.261" class="difflineminus">-  get actionIconClass() {</span>
<a href="#l7.262"></a><span id="l7.262" class="difflineminus">-    if (this.alwaysAskBeforeHandling) {</span>
<a href="#l7.263"></a><span id="l7.263" class="difflineminus">-      return &quot;ask&quot;;</span>
<a href="#l7.264"></a><span id="l7.264" class="difflineminus">-    }</span>
<a href="#l7.265"></a><span id="l7.265" class="difflineminus">-</span>
<a href="#l7.266"></a><span id="l7.266" class="difflineminus">-    switch (this.preferredAction) {</span>
<a href="#l7.267"></a><span id="l7.267" class="difflineminus">-      case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l7.268"></a><span id="l7.268" class="difflineminus">-        return &quot;save&quot;;</span>
<a href="#l7.269"></a><span id="l7.269" class="difflineminus">-</span>
<a href="#l7.270"></a><span id="l7.270" class="difflineminus">-      case Ci.nsIHandlerInfo.handleInternally:</span>
<a href="#l7.271"></a><span id="l7.271" class="difflineminus">-        if (this instanceof InternalHandlerInfoWrapper) {</span>
<a href="#l7.272"></a><span id="l7.272" class="difflineminus">-          return &quot;ask&quot;;</span>
<a href="#l7.273"></a><span id="l7.273" class="difflineminus">-        }</span>
<a href="#l7.274"></a><span id="l7.274" class="difflineminus">-    }</span>
<a href="#l7.275"></a><span id="l7.275" class="difflineminus">-</span>
<a href="#l7.276"></a><span id="l7.276" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l7.277"></a><span id="l7.277" class="difflineminus">-  }</span>
<a href="#l7.278"></a><span id="l7.278" class="difflineminus">-</span>
<a href="#l7.279"></a><span id="l7.279" class="difflineminus">-  get actionIcon() {</span>
<a href="#l7.280"></a><span id="l7.280" class="difflineminus">-    switch (this.preferredAction) {</span>
<a href="#l7.281"></a><span id="l7.281" class="difflineminus">-      case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l7.282"></a><span id="l7.282" class="difflineminus">-        return this.iconURLForSystemDefault;</span>
<a href="#l7.283"></a><span id="l7.283" class="difflineminus">-</span>
<a href="#l7.284"></a><span id="l7.284" class="difflineminus">-      case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l7.285"></a><span id="l7.285" class="difflineminus">-        let preferredApp = this.preferredApplicationHandler;</span>
<a href="#l7.286"></a><span id="l7.286" class="difflineminus">-        if (gApplicationsPane.isValidHandlerApp(preferredApp)) {</span>
<a href="#l7.287"></a><span id="l7.287" class="difflineminus">-          return gApplicationsPane._getIconURLForHandlerApp(preferredApp);</span>
<a href="#l7.288"></a><span id="l7.288" class="difflineminus">-        }</span>
<a href="#l7.289"></a><span id="l7.289" class="difflineminus">-      // Explicit fall-through</span>
<a href="#l7.290"></a><span id="l7.290" class="difflineminus">-</span>
<a href="#l7.291"></a><span id="l7.291" class="difflineminus">-      // This should never happen, but if preferredAction is set to some weird</span>
<a href="#l7.292"></a><span id="l7.292" class="difflineminus">-      // value, then fall back to the generic application icon.</span>
<a href="#l7.293"></a><span id="l7.293" class="difflineminus">-      default:</span>
<a href="#l7.294"></a><span id="l7.294" class="difflineminus">-        return ICON_URL_APP;</span>
<a href="#l7.295"></a><span id="l7.295" class="difflineminus">-    }</span>
<a href="#l7.296"></a><span id="l7.296" class="difflineminus">-  }</span>
<a href="#l7.297"></a><span id="l7.297" class="difflineminus">-</span>
<a href="#l7.298"></a><span id="l7.298" class="difflineminus">-  get iconURLForSystemDefault() {</span>
<a href="#l7.299"></a><span id="l7.299" class="difflineminus">-    // Handler info objects for MIME types on some OSes implement a property bag</span>
<a href="#l7.300"></a><span id="l7.300" class="difflineminus">-    // interface from which we can get an icon for the default app, so if we're</span>
<a href="#l7.301"></a><span id="l7.301" class="difflineminus">-    // dealing with a MIME type on one of those OSes, then try to get the icon.</span>
<a href="#l7.302"></a><span id="l7.302" class="difflineminus">-    if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l7.303"></a><span id="l7.303" class="difflineminus">-        this.wrappedHandlerInfo instanceof Ci.nsIPropertyBag) {</span>
<a href="#l7.304"></a><span id="l7.304" class="difflineminus">-      try {</span>
<a href="#l7.305"></a><span id="l7.305" class="difflineminus">-        let url = this.wrappedHandlerInfo.getProperty(&quot;defaultApplicationIconURL&quot;);</span>
<a href="#l7.306"></a><span id="l7.306" class="difflineminus">-        if (url) {</span>
<a href="#l7.307"></a><span id="l7.307" class="difflineminus">-          return url + &quot;?size=16&quot;;</span>
<a href="#l7.308"></a><span id="l7.308" class="difflineminus">-        }</span>
<a href="#l7.309"></a><span id="l7.309" class="difflineminus">-      } catch (ex) { }</span>
<a href="#l7.310"></a><span id="l7.310" class="difflineminus">-    }</span>
<a href="#l7.311"></a><span id="l7.311" class="difflineminus">-</span>
<a href="#l7.312"></a><span id="l7.312" class="difflineminus">-    // If this isn't a MIME type object on an OS that supports retrieving</span>
<a href="#l7.313"></a><span id="l7.313" class="difflineminus">-    // the icon, or if we couldn't retrieve the icon for some other reason,</span>
<a href="#l7.314"></a><span id="l7.314" class="difflineminus">-    // then use a generic icon.</span>
<a href="#l7.315"></a><span id="l7.315" class="difflineminus">-    return ICON_URL_APP;</span>
<a href="#l7.316"></a><span id="l7.316" class="difflineminus">-  }</span>
<a href="#l7.317"></a><span id="l7.317" class="difflineminus">-</span>
<a href="#l7.318"></a><span id="l7.318" class="difflineminus">-  get preferredApplicationHandler() {</span>
<a href="#l7.319"></a><span id="l7.319" class="difflineminus">-    return this.wrappedHandlerInfo.preferredApplicationHandler;</span>
<a href="#l7.320"></a><span id="l7.320" class="difflineminus">-  }</span>
<a href="#l7.321"></a><span id="l7.321" class="difflineminus">-</span>
<a href="#l7.322"></a><span id="l7.322" class="difflineminus">-  set preferredApplicationHandler(aNewValue) {</span>
<a href="#l7.323"></a><span id="l7.323" class="difflineminus">-    this.wrappedHandlerInfo.preferredApplicationHandler = aNewValue;</span>
<a href="#l7.324"></a><span id="l7.324" class="difflineminus">-</span>
<a href="#l7.325"></a><span id="l7.325" class="difflineminus">-    // Make sure the preferred handler is in the set of possible handlers.</span>
<a href="#l7.326"></a><span id="l7.326" class="difflineminus">-    if (aNewValue)</span>
<a href="#l7.327"></a><span id="l7.327" class="difflineminus">-      this.addPossibleApplicationHandler(aNewValue);</span>
<a href="#l7.328"></a><span id="l7.328" class="difflineminus">-  }</span>
<a href="#l7.329"></a><span id="l7.329" class="difflineminus">-</span>
<a href="#l7.330"></a><span id="l7.330" class="difflineminus">-  get possibleApplicationHandlers() {</span>
<a href="#l7.331"></a><span id="l7.331" class="difflineminus">-    return this.wrappedHandlerInfo.possibleApplicationHandlers;</span>
<a href="#l7.332"></a><span id="l7.332" class="difflineminus">-  }</span>
<a href="#l7.333"></a><span id="l7.333" class="difflineminus">-</span>
<a href="#l7.334"></a><span id="l7.334" class="difflineminus">-  addPossibleApplicationHandler(aNewHandler) {</span>
<a href="#l7.335"></a><span id="l7.335" class="difflineminus">-    var possibleApps = this.possibleApplicationHandlers.enumerate();</span>
<a href="#l7.336"></a><span id="l7.336" class="difflineminus">-    while (possibleApps.hasMoreElements()) {</span>
<a href="#l7.337"></a><span id="l7.337" class="difflineminus">-      if (possibleApps.getNext().equals(aNewHandler))</span>
<a href="#l7.338"></a><span id="l7.338" class="difflineminus">-        return;</span>
<a href="#l7.339"></a><span id="l7.339" class="difflineminus">-    }</span>
<a href="#l7.340"></a><span id="l7.340" class="difflineminus">-    this.possibleApplicationHandlers.appendElement(aNewHandler);</span>
<a href="#l7.341"></a><span id="l7.341" class="difflineminus">-  }</span>
<a href="#l7.342"></a><span id="l7.342" class="difflineminus">-</span>
<a href="#l7.343"></a><span id="l7.343" class="difflineminus">-  removePossibleApplicationHandler(aHandler) {</span>
<a href="#l7.344"></a><span id="l7.344" class="difflineminus">-    var defaultApp = this.preferredApplicationHandler;</span>
<a href="#l7.345"></a><span id="l7.345" class="difflineminus">-    if (defaultApp &amp;&amp; aHandler.equals(defaultApp)) {</span>
<a href="#l7.346"></a><span id="l7.346" class="difflineminus">-      // If the app we remove was the default app, we must make sure</span>
<a href="#l7.347"></a><span id="l7.347" class="difflineminus">-      // it won't be used anymore</span>
<a href="#l7.348"></a><span id="l7.348" class="difflineminus">-      this.alwaysAskBeforeHandling = true;</span>
<a href="#l7.349"></a><span id="l7.349" class="difflineminus">-      this.preferredApplicationHandler = null;</span>
<a href="#l7.350"></a><span id="l7.350" class="difflineminus">-    }</span>
<a href="#l7.351"></a><span id="l7.351" class="difflineminus">-</span>
<a href="#l7.352"></a><span id="l7.352" class="difflineminus">-    var handlers = this.possibleApplicationHandlers;</span>
<a href="#l7.353"></a><span id="l7.353" class="difflineminus">-    for (var i = 0; i &lt; handlers.length; ++i) {</span>
<a href="#l7.354"></a><span id="l7.354" class="difflineminus">-      var handler = handlers.queryElementAt(i, Ci.nsIHandlerApp);</span>
<a href="#l7.355"></a><span id="l7.355" class="difflineminus">-      if (handler.equals(aHandler)) {</span>
<a href="#l7.356"></a><span id="l7.356" class="difflineminus">-        handlers.removeElementAt(i);</span>
<a href="#l7.357"></a><span id="l7.357" class="difflineminus">-        break;</span>
<a href="#l7.358"></a><span id="l7.358" class="difflineminus">-      }</span>
<a href="#l7.359"></a><span id="l7.359" class="difflineminus">-    }</span>
<a href="#l7.360"></a><span id="l7.360" class="difflineminus">-  }</span>
<a href="#l7.361"></a><span id="l7.361" class="difflineminus">-</span>
<a href="#l7.362"></a><span id="l7.362" class="difflineminus">-  get hasDefaultHandler() {</span>
<a href="#l7.363"></a><span id="l7.363" class="difflineminus">-    return this.wrappedHandlerInfo.hasDefaultHandler;</span>
<a href="#l7.364"></a><span id="l7.364" class="difflineminus">-  }</span>
<a href="#l7.365"></a><span id="l7.365" class="difflineminus">-</span>
<a href="#l7.366"></a><span id="l7.366" class="difflineminus">-  get defaultDescription() {</span>
<a href="#l7.367"></a><span id="l7.367" class="difflineminus">-    return this.wrappedHandlerInfo.defaultDescription;</span>
<a href="#l7.368"></a><span id="l7.368" class="difflineminus">-  }</span>
<a href="#l7.369"></a><span id="l7.369" class="difflineminus">-</span>
<a href="#l7.370"></a><span id="l7.370" class="difflineminus">-  // What to do with content of this type.</span>
<a href="#l7.371"></a><span id="l7.371" class="difflineminus">-  get preferredAction() {</span>
<a href="#l7.372"></a><span id="l7.372" class="difflineminus">-    // If the action is to use a helper app, but we don't have a preferred</span>
<a href="#l7.373"></a><span id="l7.373" class="difflineminus">-    // handler app, then switch to using the system default, if any; otherwise</span>
<a href="#l7.374"></a><span id="l7.374" class="difflineminus">-    // fall back to saving to disk, which is the default action in nsMIMEInfo.</span>
<a href="#l7.375"></a><span id="l7.375" class="difflineminus">-    // Note: &quot;save to disk&quot; is an invalid value for protocol info objects,</span>
<a href="#l7.376"></a><span id="l7.376" class="difflineminus">-    // but the alwaysAskBeforeHandling getter will detect that situation</span>
<a href="#l7.377"></a><span id="l7.377" class="difflineminus">-    // and always return true in that case to override this invalid value.</span>
<a href="#l7.378"></a><span id="l7.378" class="difflineminus">-    if (this.wrappedHandlerInfo.preferredAction ==</span>
<a href="#l7.379"></a><span id="l7.379" class="difflineminus">-          Ci.nsIHandlerInfo.useHelperApp &amp;&amp;</span>
<a href="#l7.380"></a><span id="l7.380" class="difflineminus">-        !gApplicationsPane.isValidHandlerApp(this.preferredApplicationHandler)) {</span>
<a href="#l7.381"></a><span id="l7.381" class="difflineminus">-      if (this.wrappedHandlerInfo.hasDefaultHandler)</span>
<a href="#l7.382"></a><span id="l7.382" class="difflineminus">-        return Ci.nsIHandlerInfo.useSystemDefault;</span>
<a href="#l7.383"></a><span id="l7.383" class="difflineminus">-      return Ci.nsIHandlerInfo.saveToDisk;</span>
<a href="#l7.384"></a><span id="l7.384" class="difflineminus">-    }</span>
<a href="#l7.385"></a><span id="l7.385" class="difflineminus">-</span>
<a href="#l7.386"></a><span id="l7.386" class="difflineminus">-    return this.wrappedHandlerInfo.preferredAction;</span>
<a href="#l7.387"></a><span id="l7.387" class="difflineminus">-  }</span>
<a href="#l7.388"></a><span id="l7.388" class="difflineminus">-</span>
<a href="#l7.389"></a><span id="l7.389" class="difflineminus">-  set preferredAction(aNewValue) {</span>
<a href="#l7.390"></a><span id="l7.390" class="difflineminus">-    this.wrappedHandlerInfo.preferredAction = aNewValue;</span>
<a href="#l7.391"></a><span id="l7.391" class="difflineminus">-  }</span>
<a href="#l7.392"></a><span id="l7.392" class="difflineminus">-</span>
<a href="#l7.393"></a><span id="l7.393" class="difflineminus">-  get alwaysAskBeforeHandling() {</span>
<a href="#l7.394"></a><span id="l7.394" class="difflineminus">-    // If this is a protocol type and the preferred action is &quot;save to disk&quot;,</span>
<a href="#l7.395"></a><span id="l7.395" class="difflineminus">-    // which is invalid for such types, then return true here to override that</span>
<a href="#l7.396"></a><span id="l7.396" class="difflineminus">-    // action.  This could happen when the preferred action is to use a helper</span>
<a href="#l7.397"></a><span id="l7.397" class="difflineminus">-    // app, but the preferredApplicationHandler is invalid, and there isn't</span>
<a href="#l7.398"></a><span id="l7.398" class="difflineminus">-    // a default handler, so the preferredAction getter returns save to disk</span>
<a href="#l7.399"></a><span id="l7.399" class="difflineminus">-    // instead.</span>
<a href="#l7.400"></a><span id="l7.400" class="difflineminus">-    if (!(this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) &amp;&amp;</span>
<a href="#l7.401"></a><span id="l7.401" class="difflineminus">-        this.preferredAction == Ci.nsIHandlerInfo.saveToDisk)</span>
<a href="#l7.402"></a><span id="l7.402" class="difflineminus">-      return true;</span>
<a href="#l7.403"></a><span id="l7.403" class="difflineminus">-</span>
<a href="#l7.404"></a><span id="l7.404" class="difflineminus">-    return this.wrappedHandlerInfo.alwaysAskBeforeHandling;</span>
<a href="#l7.405"></a><span id="l7.405" class="difflineminus">-  }</span>
<a href="#l7.406"></a><span id="l7.406" class="difflineminus">-</span>
<a href="#l7.407"></a><span id="l7.407" class="difflineminus">-  set alwaysAskBeforeHandling(aNewValue) {</span>
<a href="#l7.408"></a><span id="l7.408" class="difflineminus">-    this.wrappedHandlerInfo.alwaysAskBeforeHandling = aNewValue;</span>
<a href="#l7.409"></a><span id="l7.409" class="difflineminus">-  }</span>
<a href="#l7.410"></a><span id="l7.410" class="difflineminus">-</span>
<a href="#l7.411"></a><span id="l7.411" class="difflineminus">-  // The primary file extension associated with this type, if any.</span>
<a href="#l7.412"></a><span id="l7.412" class="difflineminus">-  get primaryExtension() {</span>
<a href="#l7.413"></a><span id="l7.413" class="difflineminus">-    try {</span>
<a href="#l7.414"></a><span id="l7.414" class="difflineminus">-      if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l7.415"></a><span id="l7.415" class="difflineminus">-          this.wrappedHandlerInfo.primaryExtension)</span>
<a href="#l7.416"></a><span id="l7.416" class="difflineminus">-        return this.wrappedHandlerInfo.primaryExtension;</span>
<a href="#l7.417"></a><span id="l7.417" class="difflineminus">-    } catch (ex) {}</span>
<a href="#l7.418"></a><span id="l7.418" class="difflineminus">-</span>
<a href="#l7.419"></a><span id="l7.419" class="difflineminus">-    return null;</span>
<a href="#l7.420"></a><span id="l7.420" class="difflineminus">-  }</span>
<a href="#l7.421"></a><span id="l7.421" class="difflineminus">-</span>
<a href="#l7.422"></a><span id="l7.422" class="difflineminus">-  // -------</span>
<a href="#l7.423"></a><span id="l7.423" class="difflineminus">-  // Storage</span>
<a href="#l7.424"></a><span id="l7.424" class="difflineminus">-</span>
<a href="#l7.425"></a><span id="l7.425" class="difflineminus">-  store() {</span>
<a href="#l7.426"></a><span id="l7.426" class="difflineminus">-    gHandlerService.store(this.wrappedHandlerInfo);</span>
<a href="#l7.427"></a><span id="l7.427" class="difflineminus">-  }</span>
<a href="#l7.428"></a><span id="l7.428" class="difflineminus">-</span>
<a href="#l7.429"></a><span id="l7.429" class="difflineminus">-  remove() {</span>
<a href="#l7.430"></a><span id="l7.430" class="difflineminus">-    gHandlerService.remove(this.wrappedHandlerInfo);</span>
<a href="#l7.431"></a><span id="l7.431" class="difflineminus">-  }</span>
<a href="#l7.432"></a><span id="l7.432" class="difflineminus">-</span>
<a href="#l7.433"></a><span id="l7.433" class="difflineminus">-  // -----</span>
<a href="#l7.434"></a><span id="l7.434" class="difflineminus">-  // Icons</span>
<a href="#l7.435"></a><span id="l7.435" class="difflineminus">-</span>
<a href="#l7.436"></a><span id="l7.436" class="difflineminus">-  get smallIcon() {</span>
<a href="#l7.437"></a><span id="l7.437" class="difflineminus">-    return this._getIcon(16);</span>
<a href="#l7.438"></a><span id="l7.438" class="difflineminus">-  }</span>
<a href="#l7.439"></a><span id="l7.439" class="difflineminus">-</span>
<a href="#l7.440"></a><span id="l7.440" class="difflineminus">-  get largeIcon() {</span>
<a href="#l7.441"></a><span id="l7.441" class="difflineminus">-    return this._getIcon(32);</span>
<a href="#l7.442"></a><span id="l7.442" class="difflineminus">-  }</span>
<a href="#l7.443"></a><span id="l7.443" class="difflineminus">-</span>
<a href="#l7.444"></a><span id="l7.444" class="difflineminus">-  _getIcon(aSize) {</span>
<a href="#l7.445"></a><span id="l7.445" class="difflineminus">-    if (this.primaryExtension)</span>
<a href="#l7.446"></a><span id="l7.446" class="difflineminus">-      return &quot;moz-icon://goat.&quot; + this.primaryExtension + &quot;?size=&quot; + aSize;</span>
<a href="#l7.447"></a><span id="l7.447" class="difflineminus">-</span>
<a href="#l7.448"></a><span id="l7.448" class="difflineminus">-    if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo)</span>
<a href="#l7.449"></a><span id="l7.449" class="difflineminus">-      return &quot;moz-icon://goat?size=&quot; + aSize + &quot;&amp;contentType=&quot; + this.type;</span>
<a href="#l7.450"></a><span id="l7.450" class="difflineminus">-</span>
<a href="#l7.451"></a><span id="l7.451" class="difflineminus">-    // FIXME: consider returning some generic icon when we can't get a URL for</span>
<a href="#l7.452"></a><span id="l7.452" class="difflineminus">-    // one (for example in the case of protocol schemes).  Filed as bug 395141.</span>
<a href="#l7.453"></a><span id="l7.453" class="difflineminus">-    return null;</span>
<a href="#l7.454"></a><span id="l7.454" class="difflineminus">-  }</span>
<a href="#l7.455"></a><span id="l7.455" class="difflineminus">-}</span>
<a href="#l7.456"></a><span id="l7.456"> </span>
<a href="#l7.457"></a><span id="l7.457"> var gApplicationsTabController = {</span>
<a href="#l7.458"></a><span id="l7.458">   mInitialized: false,</span>
<a href="#l7.459"></a><span id="l7.459">   // We default to displaying the Outgoing tab, which is the tab at index 1</span>
<a href="#l7.460"></a><span id="l7.460">   // of the attachmentPrefs tabs.</span>
<a href="#l7.461"></a><span id="l7.461">   mDefaultIndex: 1,</span>
<a href="#l7.462"></a><span id="l7.462"> </span>
<a href="#l7.463"></a><span id="l7.463">   init() {</span>
<a href="#l7.464"></a><span id="l7.464" class="difflineat">@@ -883,729 +460,19 @@ var gCloudFileTab = {</span>
<a href="#l7.465"></a><span id="l7.465"> };</span>
<a href="#l7.466"></a><span id="l7.466"> </span>
<a href="#l7.467"></a><span id="l7.467"> Preferences.get(&quot;mail.compose.big_attachments.notify&quot;).on(&quot;change&quot;, gCloudFileTab.updateThreshold);</span>
<a href="#l7.468"></a><span id="l7.468"> </span>
<a href="#l7.469"></a><span id="l7.469"> // -------------------</span>
<a href="#l7.470"></a><span id="l7.470"> // Prefpane Controller</span>
<a href="#l7.471"></a><span id="l7.471"> </span>
<a href="#l7.472"></a><span id="l7.472"> var gApplicationsPane = {</span>
<a href="#l7.473"></a><span id="l7.473" class="difflineminus">-  // The set of types the app knows how to handle.  A hash of HandlerInfoWrapper</span>
<a href="#l7.474"></a><span id="l7.474" class="difflineminus">-  // objects, indexed by type.</span>
<a href="#l7.475"></a><span id="l7.475" class="difflineminus">-  _handledTypes: {},</span>
<a href="#l7.476"></a><span id="l7.476" class="difflineminus">-</span>
<a href="#l7.477"></a><span id="l7.477" class="difflineminus">-  // The list of types we can show, sorted by the sort column/direction.</span>
<a href="#l7.478"></a><span id="l7.478" class="difflineminus">-  // An array of HandlerInfoWrapper objects.  We build this list when we first</span>
<a href="#l7.479"></a><span id="l7.479" class="difflineminus">-  // load the data and then rebuild it when users change a pref that affects</span>
<a href="#l7.480"></a><span id="l7.480" class="difflineminus">-  // what types we can show or change the sort column/direction.</span>
<a href="#l7.481"></a><span id="l7.481" class="difflineminus">-  // Note: this isn't necessarily the list of types we *will* show; if the user</span>
<a href="#l7.482"></a><span id="l7.482" class="difflineminus">-  // provides a filter string, we'll only show the subset of types in this list</span>
<a href="#l7.483"></a><span id="l7.483" class="difflineminus">-  // that match that string.</span>
<a href="#l7.484"></a><span id="l7.484" class="difflineminus">-  _visibleTypes: [],</span>
<a href="#l7.485"></a><span id="l7.485" class="difflineminus">-</span>
<a href="#l7.486"></a><span id="l7.486" class="difflineminus">-  // Map whose keys are string descriptions and values are references to the</span>
<a href="#l7.487"></a><span id="l7.487" class="difflineminus">-  // first visible HandlerInfoWrapper that has this description. We use this</span>
<a href="#l7.488"></a><span id="l7.488" class="difflineminus">-  // to determine whether or not to annotate descriptions with their types to</span>
<a href="#l7.489"></a><span id="l7.489" class="difflineminus">-  // distinguish duplicate descriptions from each other.</span>
<a href="#l7.490"></a><span id="l7.490" class="difflineminus">-  _visibleDescriptions: new Map(),</span>
<a href="#l7.491"></a><span id="l7.491" class="difflineminus">-</span>
<a href="#l7.492"></a><span id="l7.492" class="difflineminus">-  // -----------------------------------</span>
<a href="#l7.493"></a><span id="l7.493" class="difflineminus">-  // Convenience &amp; Performance Shortcuts</span>
<a href="#l7.494"></a><span id="l7.494" class="difflineminus">-</span>
<a href="#l7.495"></a><span id="l7.495" class="difflineminus">-  // These get defined by init().</span>
<a href="#l7.496"></a><span id="l7.496" class="difflineminus">-  _brandShortName: null,</span>
<a href="#l7.497"></a><span id="l7.497" class="difflineminus">-  _prefsBundle: null,</span>
<a href="#l7.498"></a><span id="l7.498" class="difflineminus">-  _list: null,</span>
<a href="#l7.499"></a><span id="l7.499" class="difflineminus">-  _filter: null,</span>
<a href="#l7.500"></a><span id="l7.500"> </span>
<a href="#l7.501"></a><span id="l7.501">   // ----------------------------</span>
<a href="#l7.502"></a><span id="l7.502">   // Initialization &amp; Destruction</span>
<a href="#l7.503"></a><span id="l7.503"> </span>
<a href="#l7.504"></a><span id="l7.504">   init() {</span>
<a href="#l7.505"></a><span id="l7.505">     // Initialize shortcuts to some commonly accessed elements &amp; values.</span>
<a href="#l7.506"></a><span id="l7.506" class="difflineminus">-    this._brandShortName =</span>
<a href="#l7.507"></a><span id="l7.507" class="difflineminus">-      document.getElementById(&quot;bundleBrand&quot;).getString(&quot;brandShortName&quot;);</span>
<a href="#l7.508"></a><span id="l7.508" class="difflineminus">-    this._prefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l7.509"></a><span id="l7.509" class="difflineminus">-    this._list = document.getElementById(&quot;handlersView&quot;);</span>
<a href="#l7.510"></a><span id="l7.510" class="difflineminus">-    this._filter = document.getElementById(&quot;filter&quot;);</span>
<a href="#l7.511"></a><span id="l7.511" class="difflineminus">-</span>
<a href="#l7.512"></a><span id="l7.512" class="difflineminus">-    // Figure out how we should be sorting the list.  We persist sort settings</span>
<a href="#l7.513"></a><span id="l7.513" class="difflineminus">-    // across sessions, so we can't assume the default sort column/direction.</span>
<a href="#l7.514"></a><span id="l7.514" class="difflineminus">-    // XXX should we be using the XUL sort service instead?</span>
<a href="#l7.515"></a><span id="l7.515" class="difflineminus">-    this._sortColumn = document.getElementById(&quot;typeColumn&quot;);</span>
<a href="#l7.516"></a><span id="l7.516" class="difflineminus">-    if (document.getElementById(&quot;actionColumn&quot;).hasAttribute(&quot;sortDirection&quot;)) {</span>
<a href="#l7.517"></a><span id="l7.517" class="difflineminus">-      this._sortColumn = document.getElementById(&quot;actionColumn&quot;);</span>
<a href="#l7.518"></a><span id="l7.518" class="difflineminus">-      // The typeColumn element always has a sortDirection attribute,</span>
<a href="#l7.519"></a><span id="l7.519" class="difflineminus">-      // either because it was persisted or because the default value</span>
<a href="#l7.520"></a><span id="l7.520" class="difflineminus">-      // from the xul file was used.  If we are sorting on the other</span>
<a href="#l7.521"></a><span id="l7.521" class="difflineminus">-      // column, we should remove it.</span>
<a href="#l7.522"></a><span id="l7.522" class="difflineminus">-      document.getElementById(&quot;typeColumn&quot;).removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l7.523"></a><span id="l7.523" class="difflineminus">-    }</span>
<a href="#l7.524"></a><span id="l7.524" class="difflineminus">-</span>
<a href="#l7.525"></a><span id="l7.525" class="difflineminus">-    // By doing this in a timeout, we let the preferences dialog resize itself</span>
<a href="#l7.526"></a><span id="l7.526" class="difflineminus">-    // to an appropriate size before we add a bunch of items to the list.</span>
<a href="#l7.527"></a><span id="l7.527" class="difflineminus">-    // Otherwise, if there are many items, and the Applications prefpane</span>
<a href="#l7.528"></a><span id="l7.528" class="difflineminus">-    // is the one that gets displayed when the user first opens the dialog,</span>
<a href="#l7.529"></a><span id="l7.529" class="difflineminus">-    // the dialog might stretch too much in an attempt to fit them all in.</span>
<a href="#l7.530"></a><span id="l7.530" class="difflineminus">-    // XXX Shouldn't we perhaps just set a max-height on the richlistbox?</span>
<a href="#l7.531"></a><span id="l7.531" class="difflineminus">-    var _delayedPaneLoad = function(self) {</span>
<a href="#l7.532"></a><span id="l7.532" class="difflineminus">-      self._initListEventHandlers();</span>
<a href="#l7.533"></a><span id="l7.533" class="difflineminus">-      self._loadData();</span>
<a href="#l7.534"></a><span id="l7.534" class="difflineminus">-      self._rebuildVisibleTypes();</span>
<a href="#l7.535"></a><span id="l7.535" class="difflineminus">-      self._sortVisibleTypes();</span>
<a href="#l7.536"></a><span id="l7.536" class="difflineminus">-      self._rebuildView();</span>
<a href="#l7.537"></a><span id="l7.537" class="difflineminus">-</span>
<a href="#l7.538"></a><span id="l7.538" class="difflineminus">-      // Notify observers that the UI is now ready</span>
<a href="#l7.539"></a><span id="l7.539" class="difflineminus">-      Services.obs.notifyObservers(window, &quot;app-handler-pane-loaded&quot;);</span>
<a href="#l7.540"></a><span id="l7.540" class="difflineminus">-    };</span>
<a href="#l7.541"></a><span id="l7.541" class="difflineminus">-    setTimeout(_delayedPaneLoad, 0, this);</span>
<a href="#l7.542"></a><span id="l7.542">   },</span>
<a href="#l7.543"></a><span id="l7.543"> </span>
<a href="#l7.544"></a><span id="l7.544">   // ---------------------------</span>
<a href="#l7.545"></a><span id="l7.545">   // Composed Model Construction</span>
<a href="#l7.546"></a><span id="l7.546" class="difflineminus">-</span>
<a href="#l7.547"></a><span id="l7.547" class="difflineminus">-  _loadData() {</span>
<a href="#l7.548"></a><span id="l7.548" class="difflineminus">-    this._loadApplicationHandlers();</span>
<a href="#l7.549"></a><span id="l7.549" class="difflineminus">-  },</span>
<a href="#l7.550"></a><span id="l7.550" class="difflineminus">-</span>
<a href="#l7.551"></a><span id="l7.551" class="difflineminus">-  /**</span>
<a href="#l7.552"></a><span id="l7.552" class="difflineminus">-   * Load the set of handlers defined by the application datastore.</span>
<a href="#l7.553"></a><span id="l7.553" class="difflineminus">-   */</span>
<a href="#l7.554"></a><span id="l7.554" class="difflineminus">-  _loadApplicationHandlers() {</span>
<a href="#l7.555"></a><span id="l7.555" class="difflineminus">-    var wrappedHandlerInfos = gHandlerService.enumerate();</span>
<a href="#l7.556"></a><span id="l7.556" class="difflineminus">-    while (wrappedHandlerInfos.hasMoreElements()) {</span>
<a href="#l7.557"></a><span id="l7.557" class="difflineminus">-      let wrappedHandlerInfo =</span>
<a href="#l7.558"></a><span id="l7.558" class="difflineminus">-        wrappedHandlerInfos.getNext().QueryInterface(Ci.nsIHandlerInfo);</span>
<a href="#l7.559"></a><span id="l7.559" class="difflineminus">-      let type = wrappedHandlerInfo.type;</span>
<a href="#l7.560"></a><span id="l7.560" class="difflineminus">-</span>
<a href="#l7.561"></a><span id="l7.561" class="difflineminus">-      let handlerInfoWrapper;</span>
<a href="#l7.562"></a><span id="l7.562" class="difflineminus">-      if (type in this._handledTypes) {</span>
<a href="#l7.563"></a><span id="l7.563" class="difflineminus">-        handlerInfoWrapper = this._handledTypes[type];</span>
<a href="#l7.564"></a><span id="l7.564" class="difflineminus">-      } else {</span>
<a href="#l7.565"></a><span id="l7.565" class="difflineminus">-        handlerInfoWrapper = new HandlerInfoWrapper(type, wrappedHandlerInfo);</span>
<a href="#l7.566"></a><span id="l7.566" class="difflineminus">-        this._handledTypes[type] = handlerInfoWrapper;</span>
<a href="#l7.567"></a><span id="l7.567" class="difflineminus">-      }</span>
<a href="#l7.568"></a><span id="l7.568" class="difflineminus">-    }</span>
<a href="#l7.569"></a><span id="l7.569" class="difflineminus">-  },</span>
<a href="#l7.570"></a><span id="l7.570" class="difflineminus">-</span>
<a href="#l7.571"></a><span id="l7.571" class="difflineminus">-  // -----------------</span>
<a href="#l7.572"></a><span id="l7.572" class="difflineminus">-  // View Construction</span>
<a href="#l7.573"></a><span id="l7.573" class="difflineminus">-</span>
<a href="#l7.574"></a><span id="l7.574" class="difflineminus">-  selectedHandlerListItem: null,</span>
<a href="#l7.575"></a><span id="l7.575" class="difflineminus">-</span>
<a href="#l7.576"></a><span id="l7.576" class="difflineminus">-  _initListEventHandlers() {</span>
<a href="#l7.577"></a><span id="l7.577" class="difflineminus">-    this._list.addEventListener(&quot;select&quot;, event =&gt; {</span>
<a href="#l7.578"></a><span id="l7.578" class="difflineminus">-      if (event.target != this._list) {</span>
<a href="#l7.579"></a><span id="l7.579" class="difflineminus">-        return;</span>
<a href="#l7.580"></a><span id="l7.580" class="difflineminus">-      }</span>
<a href="#l7.581"></a><span id="l7.581" class="difflineminus">-</span>
<a href="#l7.582"></a><span id="l7.582" class="difflineminus">-      let handlerListItem = this._list.selectedItem &amp;&amp;</span>
<a href="#l7.583"></a><span id="l7.583" class="difflineminus">-                            HandlerListItem.forNode(this._list.selectedItem);</span>
<a href="#l7.584"></a><span id="l7.584" class="difflineminus">-      if (this.selectedHandlerListItem == handlerListItem) {</span>
<a href="#l7.585"></a><span id="l7.585" class="difflineminus">-        return;</span>
<a href="#l7.586"></a><span id="l7.586" class="difflineminus">-      }</span>
<a href="#l7.587"></a><span id="l7.587" class="difflineminus">-</span>
<a href="#l7.588"></a><span id="l7.588" class="difflineminus">-      if (this.selectedHandlerListItem) {</span>
<a href="#l7.589"></a><span id="l7.589" class="difflineminus">-        this.selectedHandlerListItem.showActionsMenu = false;</span>
<a href="#l7.590"></a><span id="l7.590" class="difflineminus">-      }</span>
<a href="#l7.591"></a><span id="l7.591" class="difflineminus">-      this.selectedHandlerListItem = handlerListItem;</span>
<a href="#l7.592"></a><span id="l7.592" class="difflineminus">-      if (handlerListItem) {</span>
<a href="#l7.593"></a><span id="l7.593" class="difflineminus">-        this.rebuildActionsMenu();</span>
<a href="#l7.594"></a><span id="l7.594" class="difflineminus">-        handlerListItem.showActionsMenu = true;</span>
<a href="#l7.595"></a><span id="l7.595" class="difflineminus">-      }</span>
<a href="#l7.596"></a><span id="l7.596" class="difflineminus">-    });</span>
<a href="#l7.597"></a><span id="l7.597" class="difflineminus">-  },</span>
<a href="#l7.598"></a><span id="l7.598" class="difflineminus">-</span>
<a href="#l7.599"></a><span id="l7.599" class="difflineminus">-  _rebuildVisibleTypes() {</span>
<a href="#l7.600"></a><span id="l7.600" class="difflineminus">-    // Reset the list of visible types and the visible type description.</span>
<a href="#l7.601"></a><span id="l7.601" class="difflineminus">-    this._visibleTypes.length = 0;</span>
<a href="#l7.602"></a><span id="l7.602" class="difflineminus">-    this._visibleDescriptions.clear();</span>
<a href="#l7.603"></a><span id="l7.603" class="difflineminus">-</span>
<a href="#l7.604"></a><span id="l7.604" class="difflineminus">-    for (let type in this._handledTypes) {</span>
<a href="#l7.605"></a><span id="l7.605" class="difflineminus">-      let handlerInfo = this._handledTypes[type];</span>
<a href="#l7.606"></a><span id="l7.606" class="difflineminus">-</span>
<a href="#l7.607"></a><span id="l7.607" class="difflineminus">-      // We couldn't find any reason to exclude the type, so include it.</span>
<a href="#l7.608"></a><span id="l7.608" class="difflineminus">-      this._visibleTypes.push(handlerInfo);</span>
<a href="#l7.609"></a><span id="l7.609" class="difflineminus">-</span>
<a href="#l7.610"></a><span id="l7.610" class="difflineminus">-      let otherHandlerInfo = this._visibleDescriptions</span>
<a href="#l7.611"></a><span id="l7.611" class="difflineminus">-                                 .get(handlerInfo.description);</span>
<a href="#l7.612"></a><span id="l7.612" class="difflineminus">-      if (!otherHandlerInfo) {</span>
<a href="#l7.613"></a><span id="l7.613" class="difflineminus">-        // This is the first type with this description that we encountered</span>
<a href="#l7.614"></a><span id="l7.614" class="difflineminus">-        // while rebuilding the _visibleTypes array this time. Make sure the</span>
<a href="#l7.615"></a><span id="l7.615" class="difflineminus">-        // flag is reset so we won't add the type to the description.</span>
<a href="#l7.616"></a><span id="l7.616" class="difflineminus">-        handlerInfo.disambiguateDescription = false;</span>
<a href="#l7.617"></a><span id="l7.617" class="difflineminus">-        this._visibleDescriptions.set(handlerInfo.description, handlerInfo);</span>
<a href="#l7.618"></a><span id="l7.618" class="difflineminus">-      } else {</span>
<a href="#l7.619"></a><span id="l7.619" class="difflineminus">-        // There is at least another type with this description. Make sure we</span>
<a href="#l7.620"></a><span id="l7.620" class="difflineminus">-        // add the type to the description on both HandlerInfoWrapper objects.</span>
<a href="#l7.621"></a><span id="l7.621" class="difflineminus">-        handlerInfo.disambiguateDescription = true;</span>
<a href="#l7.622"></a><span id="l7.622" class="difflineminus">-        otherHandlerInfo.disambiguateDescription = true;</span>
<a href="#l7.623"></a><span id="l7.623" class="difflineminus">-      }</span>
<a href="#l7.624"></a><span id="l7.624" class="difflineminus">-    }</span>
<a href="#l7.625"></a><span id="l7.625" class="difflineminus">-  },</span>
<a href="#l7.626"></a><span id="l7.626" class="difflineminus">-</span>
<a href="#l7.627"></a><span id="l7.627" class="difflineminus">-  _rebuildView() {</span>
<a href="#l7.628"></a><span id="l7.628" class="difflineminus">-    let lastSelectedType = this.selectedHandlerListItem &amp;&amp;</span>
<a href="#l7.629"></a><span id="l7.629" class="difflineminus">-                           this.selectedHandlerListItem.handlerInfoWrapper.type;</span>
<a href="#l7.630"></a><span id="l7.630" class="difflineminus">-    this.selectedHandlerListItem = null;</span>
<a href="#l7.631"></a><span id="l7.631" class="difflineminus">-</span>
<a href="#l7.632"></a><span id="l7.632" class="difflineminus">-    // Clear the list of entries.</span>
<a href="#l7.633"></a><span id="l7.633" class="difflineminus">-    this._list.textContent = &quot;&quot;;</span>
<a href="#l7.634"></a><span id="l7.634" class="difflineminus">-</span>
<a href="#l7.635"></a><span id="l7.635" class="difflineminus">-    var visibleTypes = this._visibleTypes;</span>
<a href="#l7.636"></a><span id="l7.636" class="difflineminus">-</span>
<a href="#l7.637"></a><span id="l7.637" class="difflineminus">-    // If the user is filtering the list, then only show matching types.</span>
<a href="#l7.638"></a><span id="l7.638" class="difflineminus">-    if (this._filter.value)</span>
<a href="#l7.639"></a><span id="l7.639" class="difflineminus">-      visibleTypes = visibleTypes.filter(this._matchesFilter, this);</span>
<a href="#l7.640"></a><span id="l7.640" class="difflineminus">-</span>
<a href="#l7.641"></a><span id="l7.641" class="difflineminus">-    for (let visibleType of visibleTypes) {</span>
<a href="#l7.642"></a><span id="l7.642" class="difflineminus">-      let item = new HandlerListItem(visibleType);</span>
<a href="#l7.643"></a><span id="l7.643" class="difflineminus">-      item.connectAndAppendToList(this._list);</span>
<a href="#l7.644"></a><span id="l7.644" class="difflineminus">-</span>
<a href="#l7.645"></a><span id="l7.645" class="difflineminus">-      if (visibleType.type === lastSelectedType) {</span>
<a href="#l7.646"></a><span id="l7.646" class="difflineminus">-        this._list.selectedItem = item.node;</span>
<a href="#l7.647"></a><span id="l7.647" class="difflineminus">-      }</span>
<a href="#l7.648"></a><span id="l7.648" class="difflineminus">-    }</span>
<a href="#l7.649"></a><span id="l7.649" class="difflineminus">-  },</span>
<a href="#l7.650"></a><span id="l7.650" class="difflineminus">-</span>
<a href="#l7.651"></a><span id="l7.651" class="difflineminus">-  _matchesFilter(aType) {</span>
<a href="#l7.652"></a><span id="l7.652" class="difflineminus">-    var filterValue = this._filter.value.toLowerCase();</span>
<a href="#l7.653"></a><span id="l7.653" class="difflineminus">-    return aType.typeDescription.toLowerCase().includes(filterValue) ||</span>
<a href="#l7.654"></a><span id="l7.654" class="difflineminus">-           aType.actionDescription.toLowerCase().includes(filterValue);</span>
<a href="#l7.655"></a><span id="l7.655" class="difflineminus">-  },</span>
<a href="#l7.656"></a><span id="l7.656" class="difflineminus">-</span>
<a href="#l7.657"></a><span id="l7.657" class="difflineminus">- /**</span>
<a href="#l7.658"></a><span id="l7.658" class="difflineminus">-  * Get the details for the type represented by the given handler info</span>
<a href="#l7.659"></a><span id="l7.659" class="difflineminus">-  * object.</span>
<a href="#l7.660"></a><span id="l7.660" class="difflineminus">-  *</span>
<a href="#l7.661"></a><span id="l7.661" class="difflineminus">-  * @param aHandlerInfo {nsIHandlerInfo} the type to get the extensions for.</span>
<a href="#l7.662"></a><span id="l7.662" class="difflineminus">-  * @return {string} the extensions for the type</span>
<a href="#l7.663"></a><span id="l7.663" class="difflineminus">-  */</span>
<a href="#l7.664"></a><span id="l7.664" class="difflineminus">-  _typeDetails(aHandlerInfo) {</span>
<a href="#l7.665"></a><span id="l7.665" class="difflineminus">-    let exts = [];</span>
<a href="#l7.666"></a><span id="l7.666" class="difflineminus">-    if (aHandlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) {</span>
<a href="#l7.667"></a><span id="l7.667" class="difflineminus">-      let extIter = aHandlerInfo.wrappedHandlerInfo.getFileExtensions();</span>
<a href="#l7.668"></a><span id="l7.668" class="difflineminus">-      while (extIter.hasMore()) {</span>
<a href="#l7.669"></a><span id="l7.669" class="difflineminus">-        let ext = &quot;.&quot; + extIter.getNext();</span>
<a href="#l7.670"></a><span id="l7.670" class="difflineminus">-        if (!exts.includes(ext))</span>
<a href="#l7.671"></a><span id="l7.671" class="difflineminus">-          exts.push(ext);</span>
<a href="#l7.672"></a><span id="l7.672" class="difflineminus">-      }</span>
<a href="#l7.673"></a><span id="l7.673" class="difflineminus">-    }</span>
<a href="#l7.674"></a><span id="l7.674" class="difflineminus">-    exts.sort();</span>
<a href="#l7.675"></a><span id="l7.675" class="difflineminus">-    exts = exts.join(&quot;, &quot;);</span>
<a href="#l7.676"></a><span id="l7.676" class="difflineminus">-    if (this._visibleDescriptions.has(aHandlerInfo.description)) {</span>
<a href="#l7.677"></a><span id="l7.677" class="difflineminus">-      if (exts)</span>
<a href="#l7.678"></a><span id="l7.678" class="difflineminus">-        return this._prefsBundle.getFormattedString(&quot;typeDetailsWithTypeAndExt&quot;,</span>
<a href="#l7.679"></a><span id="l7.679" class="difflineminus">-                                                    [aHandlerInfo.type,</span>
<a href="#l7.680"></a><span id="l7.680" class="difflineminus">-                                                     exts]);</span>
<a href="#l7.681"></a><span id="l7.681" class="difflineminus">-      return this._prefsBundle.getFormattedString(&quot;typeDetailsWithTypeOrExt&quot;,</span>
<a href="#l7.682"></a><span id="l7.682" class="difflineminus">-                                                  [ aHandlerInfo.type]);</span>
<a href="#l7.683"></a><span id="l7.683" class="difflineminus">-    }</span>
<a href="#l7.684"></a><span id="l7.684" class="difflineminus">-    if (exts)</span>
<a href="#l7.685"></a><span id="l7.685" class="difflineminus">-      return this._prefsBundle.getFormattedString(&quot;typeDetailsWithTypeOrExt&quot;,</span>
<a href="#l7.686"></a><span id="l7.686" class="difflineminus">-                                                  [exts]);</span>
<a href="#l7.687"></a><span id="l7.687" class="difflineminus">-    return exts;</span>
<a href="#l7.688"></a><span id="l7.688" class="difflineminus">-  },</span>
<a href="#l7.689"></a><span id="l7.689" class="difflineminus">-</span>
<a href="#l7.690"></a><span id="l7.690" class="difflineminus">-  /**</span>
<a href="#l7.691"></a><span id="l7.691" class="difflineminus">-   * Whether or not the given handler app is valid.</span>
<a href="#l7.692"></a><span id="l7.692" class="difflineminus">-   * @param aHandlerApp {nsIHandlerApp} the handler app in question</span>
<a href="#l7.693"></a><span id="l7.693" class="difflineminus">-   * @return {boolean} whether or not it's valid</span>
<a href="#l7.694"></a><span id="l7.694" class="difflineminus">-   */</span>
<a href="#l7.695"></a><span id="l7.695" class="difflineminus">-  isValidHandlerApp(aHandlerApp) {</span>
<a href="#l7.696"></a><span id="l7.696" class="difflineminus">-    if (!aHandlerApp)</span>
<a href="#l7.697"></a><span id="l7.697" class="difflineminus">-      return false;</span>
<a href="#l7.698"></a><span id="l7.698" class="difflineminus">-</span>
<a href="#l7.699"></a><span id="l7.699" class="difflineminus">-    if (aHandlerApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l7.700"></a><span id="l7.700" class="difflineminus">-      return this._isValidHandlerExecutable(aHandlerApp.executable);</span>
<a href="#l7.701"></a><span id="l7.701" class="difflineminus">-</span>
<a href="#l7.702"></a><span id="l7.702" class="difflineminus">-    if (aHandlerApp instanceof Ci.nsIWebHandlerApp)</span>
<a href="#l7.703"></a><span id="l7.703" class="difflineminus">-      return aHandlerApp.uriTemplate;</span>
<a href="#l7.704"></a><span id="l7.704" class="difflineminus">-</span>
<a href="#l7.705"></a><span id="l7.705" class="difflineminus">-    if (aHandlerApp instanceof Ci.nsIWebContentHandlerInfo)</span>
<a href="#l7.706"></a><span id="l7.706" class="difflineminus">-      return aHandlerApp.uri;</span>
<a href="#l7.707"></a><span id="l7.707" class="difflineminus">-</span>
<a href="#l7.708"></a><span id="l7.708" class="difflineminus">-    return false;</span>
<a href="#l7.709"></a><span id="l7.709" class="difflineminus">-  },</span>
<a href="#l7.710"></a><span id="l7.710" class="difflineminus">-</span>
<a href="#l7.711"></a><span id="l7.711" class="difflineminus">-  _isValidHandlerExecutable(aExecutable) {</span>
<a href="#l7.712"></a><span id="l7.712" class="difflineminus">-    let isExecutable = aExecutable &amp;&amp;</span>
<a href="#l7.713"></a><span id="l7.713" class="difflineminus">-                       aExecutable.exists() &amp;&amp;</span>
<a href="#l7.714"></a><span id="l7.714" class="difflineminus">-                       aExecutable.isExecutable();</span>
<a href="#l7.715"></a><span id="l7.715" class="difflineminus">-// XXXben - we need to compare this with the running instance executable</span>
<a href="#l7.716"></a><span id="l7.716" class="difflineminus">-//          just don't know how to do that via script...</span>
<a href="#l7.717"></a><span id="l7.717" class="difflineminus">-// XXXmano TBD: can probably add this to nsIShellService</span>
<a href="#l7.718"></a><span id="l7.718" class="difflineminus">-    if (AppConstants.platform == &quot;win&quot;)</span>
<a href="#l7.719"></a><span id="l7.719" class="difflineminus">-      return isExecutable &amp;&amp; (aExecutable.leafName != (AppConstants.MOZ_APP_NAME + &quot;.exe&quot;));</span>
<a href="#l7.720"></a><span id="l7.720" class="difflineminus">-</span>
<a href="#l7.721"></a><span id="l7.721" class="difflineminus">-    if (AppConstants.platform == &quot;macosx&quot;)</span>
<a href="#l7.722"></a><span id="l7.722" class="difflineminus">-      return isExecutable &amp;&amp; (aExecutable.leafName != AppConstants.MOZ_MACBUNDLE_NAME);</span>
<a href="#l7.723"></a><span id="l7.723" class="difflineminus">-</span>
<a href="#l7.724"></a><span id="l7.724" class="difflineminus">-    return isExecutable &amp;&amp; (aExecutable.leafName != (AppConstants.MOZ_APP_NAME + &quot;-bin&quot;));</span>
<a href="#l7.725"></a><span id="l7.725" class="difflineminus">-  },</span>
<a href="#l7.726"></a><span id="l7.726" class="difflineminus">-</span>
<a href="#l7.727"></a><span id="l7.727" class="difflineminus">-  /**</span>
<a href="#l7.728"></a><span id="l7.728" class="difflineminus">-   * Rebuild the actions menu for the selected entry.  Gets called by</span>
<a href="#l7.729"></a><span id="l7.729" class="difflineminus">-   * the richlistitem constructor when an entry in the list gets selected.</span>
<a href="#l7.730"></a><span id="l7.730" class="difflineminus">-   */</span>
<a href="#l7.731"></a><span id="l7.731" class="difflineminus">-  rebuildActionsMenu() {</span>
<a href="#l7.732"></a><span id="l7.732" class="difflineminus">-    var typeItem = this._list.selectedItem;</span>
<a href="#l7.733"></a><span id="l7.733" class="difflineminus">-</span>
<a href="#l7.734"></a><span id="l7.734" class="difflineminus">-    if (!typeItem)</span>
<a href="#l7.735"></a><span id="l7.735" class="difflineminus">-      return;</span>
<a href="#l7.736"></a><span id="l7.736" class="difflineminus">-</span>
<a href="#l7.737"></a><span id="l7.737" class="difflineminus">-    var handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l7.738"></a><span id="l7.738" class="difflineminus">-    var menu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l7.739"></a><span id="l7.739" class="difflineminus">-    var menuPopup = menu.menupopup;</span>
<a href="#l7.740"></a><span id="l7.740" class="difflineminus">-</span>
<a href="#l7.741"></a><span id="l7.741" class="difflineminus">-    // Clear out existing items.</span>
<a href="#l7.742"></a><span id="l7.742" class="difflineminus">-    while (menuPopup.hasChildNodes())</span>
<a href="#l7.743"></a><span id="l7.743" class="difflineminus">-      menuPopup.lastChild.remove();</span>
<a href="#l7.744"></a><span id="l7.744" class="difflineminus">-</span>
<a href="#l7.745"></a><span id="l7.745" class="difflineminus">-    var askMenuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l7.746"></a><span id="l7.746" class="difflineminus">-    askMenuItem.setAttribute(&quot;alwaysAsk&quot;, &quot;true&quot;);</span>
<a href="#l7.747"></a><span id="l7.747" class="difflineminus">-    {</span>
<a href="#l7.748"></a><span id="l7.748" class="difflineminus">-      let label = this._prefsBundle.getString(&quot;alwaysAsk&quot;);</span>
<a href="#l7.749"></a><span id="l7.749" class="difflineminus">-      askMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l7.750"></a><span id="l7.750" class="difflineminus">-      askMenuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l7.751"></a><span id="l7.751" class="difflineminus">-      askMenuItem.setAttribute(APP_ICON_ATTR_NAME, &quot;ask&quot;);</span>
<a href="#l7.752"></a><span id="l7.752" class="difflineminus">-      menuPopup.appendChild(askMenuItem);</span>
<a href="#l7.753"></a><span id="l7.753" class="difflineminus">-    }</span>
<a href="#l7.754"></a><span id="l7.754" class="difflineminus">-</span>
<a href="#l7.755"></a><span id="l7.755" class="difflineminus">-    // Create a menu item for saving to disk.</span>
<a href="#l7.756"></a><span id="l7.756" class="difflineminus">-    // Note: this option isn't available to protocol types, since we don't know</span>
<a href="#l7.757"></a><span id="l7.757" class="difflineminus">-    // what it means to save a URL having a certain scheme to disk.</span>
<a href="#l7.758"></a><span id="l7.758" class="difflineminus">-    if ((handlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo)) {</span>
<a href="#l7.759"></a><span id="l7.759" class="difflineminus">-      var saveMenuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l7.760"></a><span id="l7.760" class="difflineminus">-      saveMenuItem.setAttribute(&quot;action&quot;, Ci.nsIHandlerInfo.saveToDisk);</span>
<a href="#l7.761"></a><span id="l7.761" class="difflineminus">-      let label = this._prefsBundle.getString(&quot;saveFile&quot;);</span>
<a href="#l7.762"></a><span id="l7.762" class="difflineminus">-      saveMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l7.763"></a><span id="l7.763" class="difflineminus">-      saveMenuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l7.764"></a><span id="l7.764" class="difflineminus">-      saveMenuItem.setAttribute(APP_ICON_ATTR_NAME, &quot;save&quot;);</span>
<a href="#l7.765"></a><span id="l7.765" class="difflineminus">-      menuPopup.appendChild(saveMenuItem);</span>
<a href="#l7.766"></a><span id="l7.766" class="difflineminus">-    }</span>
<a href="#l7.767"></a><span id="l7.767" class="difflineminus">-</span>
<a href="#l7.768"></a><span id="l7.768" class="difflineminus">-    // Add a separator to distinguish these items from the helper app items</span>
<a href="#l7.769"></a><span id="l7.769" class="difflineminus">-    // that follow them.</span>
<a href="#l7.770"></a><span id="l7.770" class="difflineminus">-    let menuItem = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l7.771"></a><span id="l7.771" class="difflineminus">-    menuPopup.appendChild(menuItem);</span>
<a href="#l7.772"></a><span id="l7.772" class="difflineminus">-</span>
<a href="#l7.773"></a><span id="l7.773" class="difflineminus">-    // Create a menu item for the OS default application, if any.</span>
<a href="#l7.774"></a><span id="l7.774" class="difflineminus">-    if (handlerInfo.hasDefaultHandler) {</span>
<a href="#l7.775"></a><span id="l7.775" class="difflineminus">-      var defaultMenuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l7.776"></a><span id="l7.776" class="difflineminus">-      defaultMenuItem.setAttribute(&quot;action&quot;, Ci.nsIHandlerInfo.useSystemDefault);</span>
<a href="#l7.777"></a><span id="l7.777" class="difflineminus">-      let label = this._prefsBundle.getFormattedString(&quot;useDefault&quot;,</span>
<a href="#l7.778"></a><span id="l7.778" class="difflineminus">-                                                       [handlerInfo.defaultDescription]);</span>
<a href="#l7.779"></a><span id="l7.779" class="difflineminus">-      defaultMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l7.780"></a><span id="l7.780" class="difflineminus">-      defaultMenuItem.setAttribute(&quot;tooltiptext&quot;, handlerInfo.defaultDescription);</span>
<a href="#l7.781"></a><span id="l7.781" class="difflineminus">-      defaultMenuItem.setAttribute(&quot;image&quot;, handlerInfo.iconURLForSystemDefault);</span>
<a href="#l7.782"></a><span id="l7.782" class="difflineminus">-</span>
<a href="#l7.783"></a><span id="l7.783" class="difflineminus">-      menuPopup.appendChild(defaultMenuItem);</span>
<a href="#l7.784"></a><span id="l7.784" class="difflineminus">-    }</span>
<a href="#l7.785"></a><span id="l7.785" class="difflineminus">-</span>
<a href="#l7.786"></a><span id="l7.786" class="difflineminus">-    // Create menu items for possible handlers.</span>
<a href="#l7.787"></a><span id="l7.787" class="difflineminus">-    let preferredApp = handlerInfo.preferredApplicationHandler;</span>
<a href="#l7.788"></a><span id="l7.788" class="difflineminus">-    let possibleApps = handlerInfo.possibleApplicationHandlers.enumerate();</span>
<a href="#l7.789"></a><span id="l7.789" class="difflineminus">-    var possibleAppMenuItems = [];</span>
<a href="#l7.790"></a><span id="l7.790" class="difflineminus">-    while (possibleApps.hasMoreElements()) {</span>
<a href="#l7.791"></a><span id="l7.791" class="difflineminus">-      let possibleApp = possibleApps.getNext();</span>
<a href="#l7.792"></a><span id="l7.792" class="difflineminus">-      if (!gApplicationsPane.isValidHandlerApp(possibleApp))</span>
<a href="#l7.793"></a><span id="l7.793" class="difflineminus">-        continue;</span>
<a href="#l7.794"></a><span id="l7.794" class="difflineminus">-</span>
<a href="#l7.795"></a><span id="l7.795" class="difflineminus">-      let menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l7.796"></a><span id="l7.796" class="difflineminus">-      menuItem.setAttribute(&quot;action&quot;, Ci.nsIHandlerInfo.useHelperApp);</span>
<a href="#l7.797"></a><span id="l7.797" class="difflineminus">-      let label;</span>
<a href="#l7.798"></a><span id="l7.798" class="difflineminus">-      if (possibleApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l7.799"></a><span id="l7.799" class="difflineminus">-        label = getDisplayNameForFile(possibleApp.executable);</span>
<a href="#l7.800"></a><span id="l7.800" class="difflineminus">-      else</span>
<a href="#l7.801"></a><span id="l7.801" class="difflineminus">-        label = possibleApp.name;</span>
<a href="#l7.802"></a><span id="l7.802" class="difflineminus">-      label = this._prefsBundle.getFormattedString(&quot;useApp&quot;, [label]);</span>
<a href="#l7.803"></a><span id="l7.803" class="difflineminus">-      menuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l7.804"></a><span id="l7.804" class="difflineminus">-      menuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l7.805"></a><span id="l7.805" class="difflineminus">-      menuItem.setAttribute(&quot;image&quot;, gApplicationsPane</span>
<a href="#l7.806"></a><span id="l7.806" class="difflineminus">-                            ._getIconURLForHandlerApp(possibleApp));</span>
<a href="#l7.807"></a><span id="l7.807" class="difflineminus">-</span>
<a href="#l7.808"></a><span id="l7.808" class="difflineminus">-      // Attach the handler app object to the menu item so we can use it</span>
<a href="#l7.809"></a><span id="l7.809" class="difflineminus">-      // to make changes to the datastore when the user selects the item.</span>
<a href="#l7.810"></a><span id="l7.810" class="difflineminus">-      menuItem.handlerApp = possibleApp;</span>
<a href="#l7.811"></a><span id="l7.811" class="difflineminus">-</span>
<a href="#l7.812"></a><span id="l7.812" class="difflineminus">-      menuPopup.appendChild(menuItem);</span>
<a href="#l7.813"></a><span id="l7.813" class="difflineminus">-      possibleAppMenuItems.push(menuItem);</span>
<a href="#l7.814"></a><span id="l7.814" class="difflineminus">-    }</span>
<a href="#l7.815"></a><span id="l7.815" class="difflineminus">-</span>
<a href="#l7.816"></a><span id="l7.816" class="difflineminus">-    // Create a menu item for selecting a local application.</span>
<a href="#l7.817"></a><span id="l7.817" class="difflineminus">-    let createItem = true;</span>
<a href="#l7.818"></a><span id="l7.818" class="difflineminus">-    if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l7.819"></a><span id="l7.819" class="difflineminus">-      // On Windows, selecting an application to open another application</span>
<a href="#l7.820"></a><span id="l7.820" class="difflineminus">-      // would be meaningless so we special case executables.</span>
<a href="#l7.821"></a><span id="l7.821" class="difflineminus">-      var executableType = Cc[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l7.822"></a><span id="l7.822" class="difflineminus">-                             .getService(Ci.nsIMIMEService)</span>
<a href="#l7.823"></a><span id="l7.823" class="difflineminus">-                             .getTypeFromExtension(&quot;exe&quot;);</span>
<a href="#l7.824"></a><span id="l7.824" class="difflineminus">-      if (handlerInfo.type == executableType)</span>
<a href="#l7.825"></a><span id="l7.825" class="difflineminus">-        createItem = false;</span>
<a href="#l7.826"></a><span id="l7.826" class="difflineminus">-    }</span>
<a href="#l7.827"></a><span id="l7.827" class="difflineminus">-</span>
<a href="#l7.828"></a><span id="l7.828" class="difflineminus">-    if (createItem) {</span>
<a href="#l7.829"></a><span id="l7.829" class="difflineminus">-      let menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l7.830"></a><span id="l7.830" class="difflineminus">-      menuItem.setAttribute(&quot;oncommand&quot;, &quot;gApplicationsPane.chooseApp(event)&quot;);</span>
<a href="#l7.831"></a><span id="l7.831" class="difflineminus">-      let label = this._prefsBundle.getString(&quot;useOtherApp&quot;);</span>
<a href="#l7.832"></a><span id="l7.832" class="difflineminus">-      menuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l7.833"></a><span id="l7.833" class="difflineminus">-      menuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l7.834"></a><span id="l7.834" class="difflineminus">-      menuPopup.appendChild(menuItem);</span>
<a href="#l7.835"></a><span id="l7.835" class="difflineminus">-    }</span>
<a href="#l7.836"></a><span id="l7.836" class="difflineminus">-</span>
<a href="#l7.837"></a><span id="l7.837" class="difflineminus">-    // Create a menu item for managing applications.</span>
<a href="#l7.838"></a><span id="l7.838" class="difflineminus">-    if (possibleAppMenuItems.length) {</span>
<a href="#l7.839"></a><span id="l7.839" class="difflineminus">-      let menuItem = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l7.840"></a><span id="l7.840" class="difflineminus">-      menuPopup.appendChild(menuItem);</span>
<a href="#l7.841"></a><span id="l7.841" class="difflineminus">-      menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l7.842"></a><span id="l7.842" class="difflineminus">-      menuItem.setAttribute(&quot;oncommand&quot;, &quot;gApplicationsPane.manageApp(event)&quot;);</span>
<a href="#l7.843"></a><span id="l7.843" class="difflineminus">-      menuItem.setAttribute(&quot;label&quot;, this._prefsBundle.getString(&quot;manageApp&quot;));</span>
<a href="#l7.844"></a><span id="l7.844" class="difflineminus">-      menuPopup.appendChild(menuItem);</span>
<a href="#l7.845"></a><span id="l7.845" class="difflineminus">-    }</span>
<a href="#l7.846"></a><span id="l7.846" class="difflineminus">-</span>
<a href="#l7.847"></a><span id="l7.847" class="difflineminus">-    menuItem = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l7.848"></a><span id="l7.848" class="difflineminus">-    menuPopup.appendChild(menuItem);</span>
<a href="#l7.849"></a><span id="l7.849" class="difflineminus">-    menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l7.850"></a><span id="l7.850" class="difflineminus">-    menuItem.setAttribute(&quot;oncommand&quot;, &quot;gApplicationsPane.confirmDelete(event)&quot;);</span>
<a href="#l7.851"></a><span id="l7.851" class="difflineminus">-    menuItem.setAttribute(&quot;label&quot;, this._prefsBundle.getString(&quot;delete&quot;));</span>
<a href="#l7.852"></a><span id="l7.852" class="difflineminus">-    menuPopup.appendChild(menuItem);</span>
<a href="#l7.853"></a><span id="l7.853" class="difflineminus">-</span>
<a href="#l7.854"></a><span id="l7.854" class="difflineminus">-    // Select the item corresponding to the preferred action.  If the always</span>
<a href="#l7.855"></a><span id="l7.855" class="difflineminus">-    // ask flag is set, it overrides the preferred action.  Otherwise we pick</span>
<a href="#l7.856"></a><span id="l7.856" class="difflineminus">-    // the item identified by the preferred action (when the preferred action</span>
<a href="#l7.857"></a><span id="l7.857" class="difflineminus">-    // is to use a helper app, we have to pick the specific helper app item).</span>
<a href="#l7.858"></a><span id="l7.858" class="difflineminus">-    if (handlerInfo.alwaysAskBeforeHandling) {</span>
<a href="#l7.859"></a><span id="l7.859" class="difflineminus">-      menu.selectedItem = askMenuItem;</span>
<a href="#l7.860"></a><span id="l7.860" class="difflineminus">-    } else {</span>
<a href="#l7.861"></a><span id="l7.861" class="difflineminus">-      switch (handlerInfo.preferredAction) {</span>
<a href="#l7.862"></a><span id="l7.862" class="difflineminus">-        case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l7.863"></a><span id="l7.863" class="difflineminus">-          menu.selectedItem = defaultMenuItem;</span>
<a href="#l7.864"></a><span id="l7.864" class="difflineminus">-          break;</span>
<a href="#l7.865"></a><span id="l7.865" class="difflineminus">-        case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l7.866"></a><span id="l7.866" class="difflineminus">-          if (preferredApp)</span>
<a href="#l7.867"></a><span id="l7.867" class="difflineminus">-            menu.selectedItem =</span>
<a href="#l7.868"></a><span id="l7.868" class="difflineminus">-              possibleAppMenuItems.filter(v =&gt; v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l7.869"></a><span id="l7.869" class="difflineminus">-          break;</span>
<a href="#l7.870"></a><span id="l7.870" class="difflineminus">-        case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l7.871"></a><span id="l7.871" class="difflineminus">-          menu.selectedItem = saveMenuItem;</span>
<a href="#l7.872"></a><span id="l7.872" class="difflineminus">-          break;</span>
<a href="#l7.873"></a><span id="l7.873" class="difflineminus">-      }</span>
<a href="#l7.874"></a><span id="l7.874" class="difflineminus">-    }</span>
<a href="#l7.875"></a><span id="l7.875" class="difflineminus">-    // menu.selectedItem may be null if the preferredAction is</span>
<a href="#l7.876"></a><span id="l7.876" class="difflineminus">-    // useSystemDefault, but handlerInfo.hasDefaultHandler returns false.</span>
<a href="#l7.877"></a><span id="l7.877" class="difflineminus">-    // For now, we'll just use the askMenuItem to avoid ugly exceptions.</span>
<a href="#l7.878"></a><span id="l7.878" class="difflineminus">-    menu.previousSelectedItem = menu.selectedItem || askMenuItem;</span>
<a href="#l7.879"></a><span id="l7.879" class="difflineminus">-  },</span>
<a href="#l7.880"></a><span id="l7.880" class="difflineminus">-</span>
<a href="#l7.881"></a><span id="l7.881" class="difflineminus">-  // -------------------</span>
<a href="#l7.882"></a><span id="l7.882" class="difflineminus">-  // Sorting &amp; Filtering</span>
<a href="#l7.883"></a><span id="l7.883" class="difflineminus">-</span>
<a href="#l7.884"></a><span id="l7.884" class="difflineminus">-  _sortColumn: null,</span>
<a href="#l7.885"></a><span id="l7.885" class="difflineminus">-</span>
<a href="#l7.886"></a><span id="l7.886" class="difflineminus">-  /**</span>
<a href="#l7.887"></a><span id="l7.887" class="difflineminus">-   * Sort the list when the user clicks on a column header.</span>
<a href="#l7.888"></a><span id="l7.888" class="difflineminus">-   */</span>
<a href="#l7.889"></a><span id="l7.889" class="difflineminus">-  sort(event) {</span>
<a href="#l7.890"></a><span id="l7.890" class="difflineminus">-    var column = event.target;</span>
<a href="#l7.891"></a><span id="l7.891" class="difflineminus">-</span>
<a href="#l7.892"></a><span id="l7.892" class="difflineminus">-    // If the user clicked on a new sort column, remove the direction indicator</span>
<a href="#l7.893"></a><span id="l7.893" class="difflineminus">-    // from the old column.</span>
<a href="#l7.894"></a><span id="l7.894" class="difflineminus">-    if (this._sortColumn &amp;&amp; this._sortColumn != column)</span>
<a href="#l7.895"></a><span id="l7.895" class="difflineminus">-      this._sortColumn.removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l7.896"></a><span id="l7.896" class="difflineminus">-</span>
<a href="#l7.897"></a><span id="l7.897" class="difflineminus">-    this._sortColumn = column;</span>
<a href="#l7.898"></a><span id="l7.898" class="difflineminus">-</span>
<a href="#l7.899"></a><span id="l7.899" class="difflineminus">-    // Set (or switch) the sort direction indicator.</span>
<a href="#l7.900"></a><span id="l7.900" class="difflineminus">-    if (column.getAttribute(&quot;sortDirection&quot;) == &quot;ascending&quot;)</span>
<a href="#l7.901"></a><span id="l7.901" class="difflineminus">-      column.setAttribute(&quot;sortDirection&quot;, &quot;descending&quot;);</span>
<a href="#l7.902"></a><span id="l7.902" class="difflineminus">-    else</span>
<a href="#l7.903"></a><span id="l7.903" class="difflineminus">-      column.setAttribute(&quot;sortDirection&quot;, &quot;ascending&quot;);</span>
<a href="#l7.904"></a><span id="l7.904" class="difflineminus">-</span>
<a href="#l7.905"></a><span id="l7.905" class="difflineminus">-    this._sortVisibleTypes();</span>
<a href="#l7.906"></a><span id="l7.906" class="difflineminus">-    this._rebuildView();</span>
<a href="#l7.907"></a><span id="l7.907" class="difflineminus">-  },</span>
<a href="#l7.908"></a><span id="l7.908" class="difflineminus">-</span>
<a href="#l7.909"></a><span id="l7.909" class="difflineminus">-  /**</span>
<a href="#l7.910"></a><span id="l7.910" class="difflineminus">-   * Sort the list of visible types by the current sort column/direction.</span>
<a href="#l7.911"></a><span id="l7.911" class="difflineminus">-   */</span>
<a href="#l7.912"></a><span id="l7.912" class="difflineminus">-  _sortVisibleTypes() {</span>
<a href="#l7.913"></a><span id="l7.913" class="difflineminus">-    if (!this._sortColumn)</span>
<a href="#l7.914"></a><span id="l7.914" class="difflineminus">-      return;</span>
<a href="#l7.915"></a><span id="l7.915" class="difflineminus">-</span>
<a href="#l7.916"></a><span id="l7.916" class="difflineminus">-    function sortByType(a, b) {</span>
<a href="#l7.917"></a><span id="l7.917" class="difflineminus">-      return a.typeDescription.toLowerCase()</span>
<a href="#l7.918"></a><span id="l7.918" class="difflineminus">-              .localeCompare(b.typeDescription.toLowerCase());</span>
<a href="#l7.919"></a><span id="l7.919" class="difflineminus">-    }</span>
<a href="#l7.920"></a><span id="l7.920" class="difflineminus">-</span>
<a href="#l7.921"></a><span id="l7.921" class="difflineminus">-    function sortByAction(a, b) {</span>
<a href="#l7.922"></a><span id="l7.922" class="difflineminus">-      return a.actionDescription.toLowerCase()</span>
<a href="#l7.923"></a><span id="l7.923" class="difflineminus">-              .localeCompare(b.actionDescription.toLowerCase());</span>
<a href="#l7.924"></a><span id="l7.924" class="difflineminus">-    }</span>
<a href="#l7.925"></a><span id="l7.925" class="difflineminus">-</span>
<a href="#l7.926"></a><span id="l7.926" class="difflineminus">-    switch (this._sortColumn.getAttribute(&quot;value&quot;)) {</span>
<a href="#l7.927"></a><span id="l7.927" class="difflineminus">-      case &quot;type&quot;:</span>
<a href="#l7.928"></a><span id="l7.928" class="difflineminus">-        this._visibleTypes.sort(sortByType);</span>
<a href="#l7.929"></a><span id="l7.929" class="difflineminus">-        break;</span>
<a href="#l7.930"></a><span id="l7.930" class="difflineminus">-      case &quot;action&quot;:</span>
<a href="#l7.931"></a><span id="l7.931" class="difflineminus">-        this._visibleTypes.sort(sortByAction);</span>
<a href="#l7.932"></a><span id="l7.932" class="difflineminus">-        break;</span>
<a href="#l7.933"></a><span id="l7.933" class="difflineminus">-    }</span>
<a href="#l7.934"></a><span id="l7.934" class="difflineminus">-</span>
<a href="#l7.935"></a><span id="l7.935" class="difflineminus">-    if (this._sortColumn.getAttribute(&quot;sortDirection&quot;) == &quot;descending&quot;)</span>
<a href="#l7.936"></a><span id="l7.936" class="difflineminus">-      this._visibleTypes.reverse();</span>
<a href="#l7.937"></a><span id="l7.937" class="difflineminus">-  },</span>
<a href="#l7.938"></a><span id="l7.938" class="difflineminus">-</span>
<a href="#l7.939"></a><span id="l7.939" class="difflineminus">-  focusFilterBox() {</span>
<a href="#l7.940"></a><span id="l7.940" class="difflineminus">-    this._filter.focus();</span>
<a href="#l7.941"></a><span id="l7.941" class="difflineminus">-    this._filter.select();</span>
<a href="#l7.942"></a><span id="l7.942" class="difflineminus">-  },</span>
<a href="#l7.943"></a><span id="l7.943" class="difflineminus">-</span>
<a href="#l7.944"></a><span id="l7.944" class="difflineminus">-  // -------</span>
<a href="#l7.945"></a><span id="l7.945" class="difflineminus">-  // Changes</span>
<a href="#l7.946"></a><span id="l7.946" class="difflineminus">-</span>
<a href="#l7.947"></a><span id="l7.947" class="difflineminus">-  // Whether or not we are currently storing the action selected by the user.</span>
<a href="#l7.948"></a><span id="l7.948" class="difflineminus">-  // We use this to suppress notification-triggered updates to the list when</span>
<a href="#l7.949"></a><span id="l7.949" class="difflineminus">-  // we make changes that may spawn such updates, specifically when we change</span>
<a href="#l7.950"></a><span id="l7.950" class="difflineminus">-  // the action for the feed type, which results in feed preference updates,</span>
<a href="#l7.951"></a><span id="l7.951" class="difflineminus">-  // which spawn &quot;pref changed&quot; notifications that would otherwise cause us</span>
<a href="#l7.952"></a><span id="l7.952" class="difflineminus">-  // to rebuild the view unnecessarily.</span>
<a href="#l7.953"></a><span id="l7.953" class="difflineminus">-  _storingAction: false,</span>
<a href="#l7.954"></a><span id="l7.954" class="difflineminus">-</span>
<a href="#l7.955"></a><span id="l7.955" class="difflineminus">-  onSelectAction(aActionItem) {</span>
<a href="#l7.956"></a><span id="l7.956" class="difflineminus">-    this._storingAction = true;</span>
<a href="#l7.957"></a><span id="l7.957" class="difflineminus">-</span>
<a href="#l7.958"></a><span id="l7.958" class="difflineminus">-    let typeItem = this._list.selectedItem;</span>
<a href="#l7.959"></a><span id="l7.959" class="difflineminus">-    let menu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l7.960"></a><span id="l7.960" class="difflineminus">-    menu.previousSelectedItem = aActionItem;</span>
<a href="#l7.961"></a><span id="l7.961" class="difflineminus">-    try {</span>
<a href="#l7.962"></a><span id="l7.962" class="difflineminus">-      this._storeAction(aActionItem);</span>
<a href="#l7.963"></a><span id="l7.963" class="difflineminus">-    } finally {</span>
<a href="#l7.964"></a><span id="l7.964" class="difflineminus">-      this._storingAction = false;</span>
<a href="#l7.965"></a><span id="l7.965" class="difflineminus">-    }</span>
<a href="#l7.966"></a><span id="l7.966" class="difflineminus">-  },</span>
<a href="#l7.967"></a><span id="l7.967" class="difflineminus">-</span>
<a href="#l7.968"></a><span id="l7.968" class="difflineminus">-  _storeAction(aActionItem) {</span>
<a href="#l7.969"></a><span id="l7.969" class="difflineminus">-    var handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l7.970"></a><span id="l7.970" class="difflineminus">-</span>
<a href="#l7.971"></a><span id="l7.971" class="difflineminus">-    if (aActionItem.hasAttribute(&quot;alwaysAsk&quot;)) {</span>
<a href="#l7.972"></a><span id="l7.972" class="difflineminus">-      handlerInfo.alwaysAskBeforeHandling = true;</span>
<a href="#l7.973"></a><span id="l7.973" class="difflineminus">-    } else if (aActionItem.hasAttribute(&quot;action&quot;)) {</span>
<a href="#l7.974"></a><span id="l7.974" class="difflineminus">-      let action = parseInt(aActionItem.getAttribute(&quot;action&quot;));</span>
<a href="#l7.975"></a><span id="l7.975" class="difflineminus">-</span>
<a href="#l7.976"></a><span id="l7.976" class="difflineminus">-      // Set the preferred application handler.</span>
<a href="#l7.977"></a><span id="l7.977" class="difflineminus">-      // We leave the existing preferred app in the list when we set</span>
<a href="#l7.978"></a><span id="l7.978" class="difflineminus">-      // the preferred action to something other than useHelperApp so that</span>
<a href="#l7.979"></a><span id="l7.979" class="difflineminus">-      // legacy datastores that don't have the preferred app in the list</span>
<a href="#l7.980"></a><span id="l7.980" class="difflineminus">-      // of possible apps still include the preferred app in the list of apps</span>
<a href="#l7.981"></a><span id="l7.981" class="difflineminus">-      // the user can choose to handle the type.</span>
<a href="#l7.982"></a><span id="l7.982" class="difflineminus">-      if (action == Ci.nsIHandlerInfo.useHelperApp)</span>
<a href="#l7.983"></a><span id="l7.983" class="difflineminus">-        handlerInfo.preferredApplicationHandler = aActionItem.handlerApp;</span>
<a href="#l7.984"></a><span id="l7.984" class="difflineminus">-</span>
<a href="#l7.985"></a><span id="l7.985" class="difflineminus">-      // Set the &quot;always ask&quot; flag.</span>
<a href="#l7.986"></a><span id="l7.986" class="difflineminus">-      handlerInfo.alwaysAskBeforeHandling = false;</span>
<a href="#l7.987"></a><span id="l7.987" class="difflineminus">-</span>
<a href="#l7.988"></a><span id="l7.988" class="difflineminus">-      // Set the preferred action.</span>
<a href="#l7.989"></a><span id="l7.989" class="difflineminus">-      handlerInfo.preferredAction = action;</span>
<a href="#l7.990"></a><span id="l7.990" class="difflineminus">-    }</span>
<a href="#l7.991"></a><span id="l7.991" class="difflineminus">-</span>
<a href="#l7.992"></a><span id="l7.992" class="difflineminus">-    handlerInfo.store();</span>
<a href="#l7.993"></a><span id="l7.993" class="difflineminus">-</span>
<a href="#l7.994"></a><span id="l7.994" class="difflineminus">-    // Update the action label and image to reflect the new preferred action.</span>
<a href="#l7.995"></a><span id="l7.995" class="difflineminus">-    this.selectedHandlerListItem.refreshAction();</span>
<a href="#l7.996"></a><span id="l7.996" class="difflineminus">-  },</span>
<a href="#l7.997"></a><span id="l7.997" class="difflineminus">-</span>
<a href="#l7.998"></a><span id="l7.998" class="difflineminus">-  manageApp(aEvent) {</span>
<a href="#l7.999"></a><span id="l7.999" class="difflineminus">-    // Don't let the normal &quot;on select action&quot; handler get this event,</span>
<a href="#l7.1000"></a><span id="l7.1000" class="difflineminus">-    // as we handle it specially ourselves.</span>
<a href="#l7.1001"></a><span id="l7.1001" class="difflineminus">-    aEvent.stopPropagation();</span>
<a href="#l7.1002"></a><span id="l7.1002" class="difflineminus">-</span>
<a href="#l7.1003"></a><span id="l7.1003" class="difflineminus">-    var handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l7.1004"></a><span id="l7.1004" class="difflineminus">-</span>
<a href="#l7.1005"></a><span id="l7.1005" class="difflineminus">-    let closingCallback = () =&gt; {</span>
<a href="#l7.1006"></a><span id="l7.1006" class="difflineminus">-      // Rebuild the actions menu so that we revert to the previous selection,</span>
<a href="#l7.1007"></a><span id="l7.1007" class="difflineminus">-      // or &quot;Always ask&quot; if the previous default application has been removed.</span>
<a href="#l7.1008"></a><span id="l7.1008" class="difflineminus">-      this.rebuildActionsMenu();</span>
<a href="#l7.1009"></a><span id="l7.1009" class="difflineminus">-</span>
<a href="#l7.1010"></a><span id="l7.1010" class="difflineminus">-      // Update the richlistitem too. Will be visible when selecting another row.</span>
<a href="#l7.1011"></a><span id="l7.1011" class="difflineminus">-      this.selectedHandlerListItem.refreshAction();</span>
<a href="#l7.1012"></a><span id="l7.1012" class="difflineminus">-    };</span>
<a href="#l7.1013"></a><span id="l7.1013" class="difflineminus">-</span>
<a href="#l7.1014"></a><span id="l7.1014" class="difflineminus">-    gSubDialog.open(</span>
<a href="#l7.1015"></a><span id="l7.1015" class="difflineminus">-      &quot;chrome://messenger/content/preferences/applicationManager.xul&quot;,</span>
<a href="#l7.1016"></a><span id="l7.1016" class="difflineminus">-      &quot;resizable=no&quot;, handlerInfo, closingCallback);</span>
<a href="#l7.1017"></a><span id="l7.1017" class="difflineminus">-  },</span>
<a href="#l7.1018"></a><span id="l7.1018" class="difflineminus">-</span>
<a href="#l7.1019"></a><span id="l7.1019" class="difflineminus">-  chooseApp(aEvent) {</span>
<a href="#l7.1020"></a><span id="l7.1020" class="difflineminus">-    // Don't let the normal &quot;on select action&quot; handler get this event,</span>
<a href="#l7.1021"></a><span id="l7.1021" class="difflineminus">-    // as we handle it specially ourselves.</span>
<a href="#l7.1022"></a><span id="l7.1022" class="difflineminus">-    aEvent.stopPropagation();</span>
<a href="#l7.1023"></a><span id="l7.1023" class="difflineminus">-</span>
<a href="#l7.1024"></a><span id="l7.1024" class="difflineminus">-    var handlerApp;</span>
<a href="#l7.1025"></a><span id="l7.1025" class="difflineminus">-    let onSelectionDone = function() {</span>
<a href="#l7.1026"></a><span id="l7.1026" class="difflineminus">-      // Rebuild the actions menu whether the user picked an app or canceled.</span>
<a href="#l7.1027"></a><span id="l7.1027" class="difflineminus">-      // If they picked an app, we want to add the app to the menu and select it.</span>
<a href="#l7.1028"></a><span id="l7.1028" class="difflineminus">-      // If they canceled, we want to go back to their previous selection.</span>
<a href="#l7.1029"></a><span id="l7.1029" class="difflineminus">-      this.rebuildActionsMenu();</span>
<a href="#l7.1030"></a><span id="l7.1030" class="difflineminus">-</span>
<a href="#l7.1031"></a><span id="l7.1031" class="difflineminus">-      // If the user picked a new app from the menu, select it.</span>
<a href="#l7.1032"></a><span id="l7.1032" class="difflineminus">-      if (handlerApp) {</span>
<a href="#l7.1033"></a><span id="l7.1033" class="difflineminus">-        let typeItem = this._list.selectedItem;</span>
<a href="#l7.1034"></a><span id="l7.1034" class="difflineminus">-        let actionsMenu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l7.1035"></a><span id="l7.1035" class="difflineminus">-        let menuItems = actionsMenu.menupopup.childNodes;</span>
<a href="#l7.1036"></a><span id="l7.1036" class="difflineminus">-        for (let i = 0; i &lt; menuItems.length; i++) {</span>
<a href="#l7.1037"></a><span id="l7.1037" class="difflineminus">-          let menuItem = menuItems[i];</span>
<a href="#l7.1038"></a><span id="l7.1038" class="difflineminus">-          if (menuItem.handlerApp &amp;&amp; menuItem.handlerApp.equals(handlerApp)) {</span>
<a href="#l7.1039"></a><span id="l7.1039" class="difflineminus">-            actionsMenu.selectedIndex = i;</span>
<a href="#l7.1040"></a><span id="l7.1040" class="difflineminus">-            this.onSelectAction(menuItem);</span>
<a href="#l7.1041"></a><span id="l7.1041" class="difflineminus">-            break;</span>
<a href="#l7.1042"></a><span id="l7.1042" class="difflineminus">-          }</span>
<a href="#l7.1043"></a><span id="l7.1043" class="difflineminus">-        }</span>
<a href="#l7.1044"></a><span id="l7.1044" class="difflineminus">-      }</span>
<a href="#l7.1045"></a><span id="l7.1045" class="difflineminus">-    }.bind(this);</span>
<a href="#l7.1046"></a><span id="l7.1046" class="difflineminus">-</span>
<a href="#l7.1047"></a><span id="l7.1047" class="difflineminus">-    if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l7.1048"></a><span id="l7.1048" class="difflineminus">-      let params = {};</span>
<a href="#l7.1049"></a><span id="l7.1049" class="difflineminus">-      let handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l7.1050"></a><span id="l7.1050" class="difflineminus">-</span>
<a href="#l7.1051"></a><span id="l7.1051" class="difflineminus">-      params.mimeInfo = handlerInfo.wrappedHandlerInfo;</span>
<a href="#l7.1052"></a><span id="l7.1052" class="difflineminus">-</span>
<a href="#l7.1053"></a><span id="l7.1053" class="difflineminus">-      params.title         = this._prefsBundle.getString(&quot;fpTitleChooseApp&quot;);</span>
<a href="#l7.1054"></a><span id="l7.1054" class="difflineminus">-      params.description   = handlerInfo.description;</span>
<a href="#l7.1055"></a><span id="l7.1055" class="difflineminus">-      params.filename      = null;</span>
<a href="#l7.1056"></a><span id="l7.1056" class="difflineminus">-      params.handlerApp    = null;</span>
<a href="#l7.1057"></a><span id="l7.1057" class="difflineminus">-</span>
<a href="#l7.1058"></a><span id="l7.1058" class="difflineminus">-      function closingCallback() {</span>
<a href="#l7.1059"></a><span id="l7.1059" class="difflineminus">-        if (params.handlerApp &amp;&amp;</span>
<a href="#l7.1060"></a><span id="l7.1060" class="difflineminus">-            params.handlerApp.executable &amp;&amp;</span>
<a href="#l7.1061"></a><span id="l7.1061" class="difflineminus">-            params.handlerApp.executable.isFile()) {</span>
<a href="#l7.1062"></a><span id="l7.1062" class="difflineminus">-          handlerApp = params.handlerApp;</span>
<a href="#l7.1063"></a><span id="l7.1063" class="difflineminus">-</span>
<a href="#l7.1064"></a><span id="l7.1064" class="difflineminus">-          // Add the app to the type's list of possible handlers.</span>
<a href="#l7.1065"></a><span id="l7.1065" class="difflineminus">-          handlerInfo.addPossibleApplicationHandler(handlerApp);</span>
<a href="#l7.1066"></a><span id="l7.1066" class="difflineminus">-        }</span>
<a href="#l7.1067"></a><span id="l7.1067" class="difflineminus">-        onSelectionDone();</span>
<a href="#l7.1068"></a><span id="l7.1068" class="difflineminus">-      }</span>
<a href="#l7.1069"></a><span id="l7.1069" class="difflineminus">-</span>
<a href="#l7.1070"></a><span id="l7.1070" class="difflineminus">-      gSubDialog.open(&quot;chrome://global/content/appPicker.xul&quot;,</span>
<a href="#l7.1071"></a><span id="l7.1071" class="difflineminus">-                      &quot;resizable=no&quot;, params, closingCallback);</span>
<a href="#l7.1072"></a><span id="l7.1072" class="difflineminus">-    } else {</span>
<a href="#l7.1073"></a><span id="l7.1073" class="difflineminus">-      const nsIFilePicker = Ci.nsIFilePicker;</span>
<a href="#l7.1074"></a><span id="l7.1074" class="difflineminus">-      let fp = Cc[&quot;@mozilla.org/filepicker;1&quot;].createInstance(nsIFilePicker);</span>
<a href="#l7.1075"></a><span id="l7.1075" class="difflineminus">-      let winTitle = this._prefsBundle.getString(&quot;fpTitleChooseApp&quot;);</span>
<a href="#l7.1076"></a><span id="l7.1076" class="difflineminus">-      fp.init(window, winTitle, nsIFilePicker.modeOpen);</span>
<a href="#l7.1077"></a><span id="l7.1077" class="difflineminus">-      fp.appendFilters(nsIFilePicker.filterApps);</span>
<a href="#l7.1078"></a><span id="l7.1078" class="difflineminus">-</span>
<a href="#l7.1079"></a><span id="l7.1079" class="difflineminus">-      // Prompt the user to pick an app.  If they pick one, and it's a valid</span>
<a href="#l7.1080"></a><span id="l7.1080" class="difflineminus">-      // selection, then add it to the list of possible handlers.</span>
<a href="#l7.1081"></a><span id="l7.1081" class="difflineminus">-</span>
<a href="#l7.1082"></a><span id="l7.1082" class="difflineminus">-      fp.open(rv =&gt; {</span>
<a href="#l7.1083"></a><span id="l7.1083" class="difflineminus">-        if (rv == nsIFilePicker.returnOK &amp;&amp; fp.file &amp;&amp;</span>
<a href="#l7.1084"></a><span id="l7.1084" class="difflineminus">-            this._isValidHandlerExecutable(fp.file)) {</span>
<a href="#l7.1085"></a><span id="l7.1085" class="difflineminus">-          handlerApp = Cc[&quot;@mozilla.org/uriloader/local-handler-app;1&quot;]</span>
<a href="#l7.1086"></a><span id="l7.1086" class="difflineminus">-                         .createInstance(Ci.nsILocalHandlerApp);</span>
<a href="#l7.1087"></a><span id="l7.1087" class="difflineminus">-          handlerApp.name = getDisplayNameForFile(fp.file);</span>
<a href="#l7.1088"></a><span id="l7.1088" class="difflineminus">-          handlerApp.executable = fp.file;</span>
<a href="#l7.1089"></a><span id="l7.1089" class="difflineminus">-</span>
<a href="#l7.1090"></a><span id="l7.1090" class="difflineminus">-          // Add the app to the type's list of possible handlers.</span>
<a href="#l7.1091"></a><span id="l7.1091" class="difflineminus">-          let handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l7.1092"></a><span id="l7.1092" class="difflineminus">-          handlerInfo.addPossibleApplicationHandler(handlerApp);</span>
<a href="#l7.1093"></a><span id="l7.1093" class="difflineminus">-        }</span>
<a href="#l7.1094"></a><span id="l7.1094" class="difflineminus">-        onSelectionDone();</span>
<a href="#l7.1095"></a><span id="l7.1095" class="difflineminus">-      });</span>
<a href="#l7.1096"></a><span id="l7.1096" class="difflineminus">-    }</span>
<a href="#l7.1097"></a><span id="l7.1097" class="difflineminus">-  },</span>
<a href="#l7.1098"></a><span id="l7.1098" class="difflineminus">-</span>
<a href="#l7.1099"></a><span id="l7.1099" class="difflineminus">-  confirmDelete(aEvent) {</span>
<a href="#l7.1100"></a><span id="l7.1100" class="difflineminus">-    aEvent.stopPropagation();</span>
<a href="#l7.1101"></a><span id="l7.1101" class="difflineminus">-    if (Services.prompt.confirm(null,</span>
<a href="#l7.1102"></a><span id="l7.1102" class="difflineminus">-                                this._prefsBundle.getString(&quot;confirmDeleteTitle&quot;),</span>
<a href="#l7.1103"></a><span id="l7.1103" class="difflineminus">-                                this._prefsBundle.getString(&quot;confirmDeleteText&quot;))) {</span>
<a href="#l7.1104"></a><span id="l7.1104" class="difflineminus">-      this.onDelete(aEvent);</span>
<a href="#l7.1105"></a><span id="l7.1105" class="difflineminus">-    } else {</span>
<a href="#l7.1106"></a><span id="l7.1106" class="difflineminus">-      // They hit cancel, so return them to the previously selected item.</span>
<a href="#l7.1107"></a><span id="l7.1107" class="difflineminus">-      let typeItem = this._list.selectedItem;</span>
<a href="#l7.1108"></a><span id="l7.1108" class="difflineminus">-      let menu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l7.1109"></a><span id="l7.1109" class="difflineminus">-      menu.selectedItem = menu.previousSelectedItem;</span>
<a href="#l7.1110"></a><span id="l7.1110" class="difflineminus">-    }</span>
<a href="#l7.1111"></a><span id="l7.1111" class="difflineminus">-  },</span>
<a href="#l7.1112"></a><span id="l7.1112" class="difflineminus">-</span>
<a href="#l7.1113"></a><span id="l7.1113" class="difflineminus">-  onDelete(aEvent) {</span>
<a href="#l7.1114"></a><span id="l7.1114" class="difflineminus">-    // We want to delete if either the request came from the confirmDelete</span>
<a href="#l7.1115"></a><span id="l7.1115" class="difflineminus">-    // method (which is the only thing that populates the aEvent parameter),</span>
<a href="#l7.1116"></a><span id="l7.1116" class="difflineminus">-    // or we've hit the delete/backspace key while the list has focus.</span>
<a href="#l7.1117"></a><span id="l7.1117" class="difflineminus">-    if ((aEvent || document.commandDispatcher.focusedElement == this._list) &amp;&amp;</span>
<a href="#l7.1118"></a><span id="l7.1118" class="difflineminus">-        this._list.selectedIndex != -1) {</span>
<a href="#l7.1119"></a><span id="l7.1119" class="difflineminus">-      let typeItem = this._list.getItemAtIndex(this._list.selectedIndex);</span>
<a href="#l7.1120"></a><span id="l7.1120" class="difflineminus">-      let handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l7.1121"></a><span id="l7.1121" class="difflineminus">-      let index = this._visibleTypes.indexOf(handlerInfo);</span>
<a href="#l7.1122"></a><span id="l7.1122" class="difflineminus">-      if (index != -1)</span>
<a href="#l7.1123"></a><span id="l7.1123" class="difflineminus">-        this._visibleTypes.splice(index, 1);</span>
<a href="#l7.1124"></a><span id="l7.1124" class="difflineminus">-      handlerInfo.remove();</span>
<a href="#l7.1125"></a><span id="l7.1125" class="difflineminus">-      delete this._handledTypes[typeItem.type];</span>
<a href="#l7.1126"></a><span id="l7.1126" class="difflineminus">-      typeItem.remove();</span>
<a href="#l7.1127"></a><span id="l7.1127" class="difflineminus">-    }</span>
<a href="#l7.1128"></a><span id="l7.1128" class="difflineminus">-  },</span>
<a href="#l7.1129"></a><span id="l7.1129" class="difflineminus">-</span>
<a href="#l7.1130"></a><span id="l7.1130" class="difflineminus">-  _getIconURLForHandlerApp(aHandlerApp) {</span>
<a href="#l7.1131"></a><span id="l7.1131" class="difflineminus">-    if (aHandlerApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l7.1132"></a><span id="l7.1132" class="difflineminus">-      return this._getIconURLForFile(aHandlerApp.executable);</span>
<a href="#l7.1133"></a><span id="l7.1133" class="difflineminus">-</span>
<a href="#l7.1134"></a><span id="l7.1134" class="difflineminus">-    if (aHandlerApp instanceof Ci.nsIWebHandlerApp)</span>
<a href="#l7.1135"></a><span id="l7.1135" class="difflineminus">-      return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l7.1136"></a><span id="l7.1136" class="difflineminus">-</span>
<a href="#l7.1137"></a><span id="l7.1137" class="difflineminus">-    if (aHandlerApp instanceof Ci.nsIWebContentHandlerInfo)</span>
<a href="#l7.1138"></a><span id="l7.1138" class="difflineminus">-      return this._getIconURLForWebApp(aHandlerApp.uri);</span>
<a href="#l7.1139"></a><span id="l7.1139" class="difflineminus">-</span>
<a href="#l7.1140"></a><span id="l7.1140" class="difflineminus">-    // We know nothing about other kinds of handler apps.</span>
<a href="#l7.1141"></a><span id="l7.1141" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l7.1142"></a><span id="l7.1142" class="difflineminus">-  },</span>
<a href="#l7.1143"></a><span id="l7.1143" class="difflineminus">-</span>
<a href="#l7.1144"></a><span id="l7.1144" class="difflineminus">-  _getIconURLForFile(aFile) {</span>
<a href="#l7.1145"></a><span id="l7.1145" class="difflineminus">-    let urlSpec = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l7.1146"></a><span id="l7.1146" class="difflineminus">-      .QueryInterface(Ci.nsIFileProtocolHandler)</span>
<a href="#l7.1147"></a><span id="l7.1147" class="difflineminus">-      .getURLSpecFromFile(aFile);</span>
<a href="#l7.1148"></a><span id="l7.1148" class="difflineminus">-</span>
<a href="#l7.1149"></a><span id="l7.1149" class="difflineminus">-    return &quot;moz-icon://&quot; + urlSpec + &quot;?size=16&quot;;</span>
<a href="#l7.1150"></a><span id="l7.1150" class="difflineminus">-  },</span>
<a href="#l7.1151"></a><span id="l7.1151" class="difflineminus">-</span>
<a href="#l7.1152"></a><span id="l7.1152" class="difflineminus">-  _getIconURLForWebApp(aWebAppURITemplate) {</span>
<a href="#l7.1153"></a><span id="l7.1153" class="difflineminus">-    var uri = Services.io.newURI(aWebAppURITemplate);</span>
<a href="#l7.1154"></a><span id="l7.1154" class="difflineminus">-</span>
<a href="#l7.1155"></a><span id="l7.1155" class="difflineminus">-    // Unfortunately we can't use the favicon service to get the favicon,</span>
<a href="#l7.1156"></a><span id="l7.1156" class="difflineminus">-    // because the service looks in the annotations table for a record with</span>
<a href="#l7.1157"></a><span id="l7.1157" class="difflineminus">-    // the exact URL we give it, and users won't have such records for URLs</span>
<a href="#l7.1158"></a><span id="l7.1158" class="difflineminus">-    // they don't visit, and users won't visit the web app's URL template,</span>
<a href="#l7.1159"></a><span id="l7.1159" class="difflineminus">-    // they'll only visit URLs derived from that template (i.e. with %s</span>
<a href="#l7.1160"></a><span id="l7.1160" class="difflineminus">-    // in the template replaced by the URL of the content being handled).</span>
<a href="#l7.1161"></a><span id="l7.1161" class="difflineminus">-</span>
<a href="#l7.1162"></a><span id="l7.1162" class="difflineminus">-    if (/^https?/.test(uri.scheme))</span>
<a href="#l7.1163"></a><span id="l7.1163" class="difflineminus">-      return uri.prePath + &quot;/favicon.ico&quot;;</span>
<a href="#l7.1164"></a><span id="l7.1164" class="difflineminus">-</span>
<a href="#l7.1165"></a><span id="l7.1165" class="difflineminus">-    return /^https?/.test(uri.scheme) ? uri.resolve(&quot;/favicon.ico&quot;) : &quot;&quot;;</span>
<a href="#l7.1166"></a><span id="l7.1166" class="difflineminus">-  },</span>
<a href="#l7.1167"></a><span id="l7.1167"> };</span>
<a href="#l7.1168"></a><span id="l7.1168" class="difflineminus">-</span>
<a href="#l7.1169"></a><span id="l7.1169" class="difflineminus">-/**</span>
<a href="#l7.1170"></a><span id="l7.1170" class="difflineminus">- * InternalHandlerInfoWrapper provides a basic mechanism to create an internal</span>
<a href="#l7.1171"></a><span id="l7.1171" class="difflineminus">- * mime type handler that can be enabled/disabled in the applications preference</span>
<a href="#l7.1172"></a><span id="l7.1172" class="difflineminus">- * menu.</span>
<a href="#l7.1173"></a><span id="l7.1173" class="difflineminus">- */</span>
<a href="#l7.1174"></a><span id="l7.1174" class="difflineminus">-class InternalHandlerInfoWrapper extends HandlerInfoWrapper {</span>
<a href="#l7.1175"></a><span id="l7.1175" class="difflineminus">-  constructor(mimeType) {</span>
<a href="#l7.1176"></a><span id="l7.1176" class="difflineminus">-    super(mimeType, gMIMEService.getFromTypeAndExtension(mimeType, null));</span>
<a href="#l7.1177"></a><span id="l7.1177" class="difflineminus">-  }</span>
<a href="#l7.1178"></a><span id="l7.1178" class="difflineminus">-</span>
<a href="#l7.1179"></a><span id="l7.1179" class="difflineminus">-  // Override store so we so we can notify any code listening for registration</span>
<a href="#l7.1180"></a><span id="l7.1180" class="difflineminus">-  // or unregistration of this handler.</span>
<a href="#l7.1181"></a><span id="l7.1181" class="difflineminus">-  store() {</span>
<a href="#l7.1182"></a><span id="l7.1182" class="difflineminus">-    super.store();</span>
<a href="#l7.1183"></a><span id="l7.1183" class="difflineminus">-    Services.obs.notifyObservers(null, this._handlerChanged);</span>
<a href="#l7.1184"></a><span id="l7.1184" class="difflineminus">-  }</span>
<a href="#l7.1185"></a><span id="l7.1185" class="difflineminus">-</span>
<a href="#l7.1186"></a><span id="l7.1186" class="difflineminus">-  get enabled() {</span>
<a href="#l7.1187"></a><span id="l7.1187" class="difflineminus">-    throw Cr.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l7.1188"></a><span id="l7.1188" class="difflineminus">-  }</span>
<a href="#l7.1189"></a><span id="l7.1189" class="difflineminus">-</span>
<a href="#l7.1190"></a><span id="l7.1190" class="difflineminus">-  get description() {</span>
<a href="#l7.1191"></a><span id="l7.1191" class="difflineminus">-    return gApplicationsPane._prefsBundle.getString(this._appPrefLabel);</span>
<a href="#l7.1192"></a><span id="l7.1192" class="difflineminus">-  }</span>
<a href="#l7.1193"></a><span id="l7.1193" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/preferences/compose.inc.xul</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/preferences/compose.inc.xul</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l8.4"></a><span id="l8.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l8.7"></a><span id="l8.7">   &lt;prefpane id=&quot;paneCompose&quot; label=&quot;&amp;paneComposition.title;&quot;&gt;</span>
<a href="#l8.8"></a><span id="l8.8">     &lt;script src=&quot;chrome://messenger/content/preferences/compose.js&quot;/&gt;</span>
<a href="#l8.9"></a><span id="l8.9">     &lt;script src=&quot;chrome://global/content/contentAreaUtils.js&quot;/&gt;</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+    &lt;script src=&quot;chrome://messenger/content/preferences/downloads.js&quot;/&gt;</span>
<a href="#l8.11"></a><span id="l8.11">     &lt;script src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l8.12"></a><span id="l8.12"> </span>
<a href="#l8.13"></a><span id="l8.13">     &lt;stringbundle id=&quot;bundle_addressBook&quot; src=&quot;chrome://messenger/locale/addressbook/addressBook.properties&quot;/&gt;</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">     &lt;tabbox id=&quot;composePrefs&quot; flex=&quot;1&quot; onselect=&quot;gComposePane.tabSelectionChanged();&quot;&gt;</span>
<a href="#l8.16"></a><span id="l8.16">       &lt;tabs id=&quot;composePrefsTabs&quot;&gt;</span>
<a href="#l8.17"></a><span id="l8.17">         &lt;tab id=&quot;generalTab&quot; label=&quot;&amp;itemGeneral.label;&quot;/&gt;</span>
<a href="#l8.18"></a><span id="l8.18">         &lt;tab id=&quot;addressingTab&quot; label=&quot;&amp;itemAutoComplete.label;&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">deleted file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- a/mail/components/preferences/display.inc.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ /dev/null</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -1,215 +0,0 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">-# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">-  &lt;prefpane id=&quot;paneDisplay&quot; label=&quot;&amp;paneDisplay.title;&quot;&gt;</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-    &lt;script src=&quot;chrome://mozapps/content/preferences/fontbuilder.js&quot;/&gt;</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-    &lt;script src=&quot;chrome://messenger/content/preferences/display.js&quot;/&gt;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">-</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    &lt;tabbox id=&quot;displayPrefs&quot; flex=&quot;1&quot; onselect=&quot;gDisplayPane.tabSelectionChanged();&quot;&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-      &lt;tabs id=&quot;displayPrefsTabs&quot;&gt;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-        &lt;tab id=&quot;formattingTab&quot; label=&quot;&amp;itemFormatting.label;&quot;/&gt;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-        &lt;tab id=&quot;tagTab&quot; label=&quot;&amp;itemTags.label;&quot;/&gt;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-        &lt;tab id=&quot;displayTab&quot; label=&quot;&amp;itemAdvanced.label;&quot;/&gt;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-      &lt;/tabs&gt;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-      &lt;tabpanels id=&quot;displayPrefsPanels&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-          &lt;!-- Fonts and Colors --&gt;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-          &lt;groupbox id=&quot;fontsGroup&quot;&gt;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;fontsAndColors1.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-            &lt;hbox id=&quot;fontSettings&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-              &lt;vbox id=&quot;fontRow&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-                &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-                  &lt;label accesskey=&quot;&amp;defaultFont.accesskey;&quot; control=&quot;defaultFont&quot;&gt;&amp;defaultFont.label;&lt;/label&gt;</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-                  &lt;menulist id=&quot;defaultFont&quot; flex=&quot;1&quot; sizetopopup=&quot;pref&quot; crop=&quot;center&quot;&gt;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-                    &lt;menupopup crop=&quot;center&quot;/&gt;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-                  &lt;/menulist&gt;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-                  &lt;label accesskey=&quot;&amp;defaultSize.accesskey;&quot; control=&quot;defaultFontSize&quot;&gt;&amp;defaultSize.label;&lt;/label&gt;</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-                  &lt;menulist id=&quot;defaultFontSize&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-                    &lt;menupopup crop=&quot;center&quot;&gt;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-                      &lt;menuitem value=&quot;9&quot; label=&quot;9&quot;/&gt;</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-                      &lt;menuitem value=&quot;10&quot; label=&quot;10&quot;/&gt;</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-                      &lt;menuitem value=&quot;11&quot; label=&quot;11&quot;/&gt;</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-                      &lt;menuitem value=&quot;12&quot; label=&quot;12&quot;/&gt;</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-                      &lt;menuitem value=&quot;13&quot; label=&quot;13&quot;/&gt;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-                      &lt;menuitem value=&quot;14&quot; label=&quot;14&quot;/&gt;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-                      &lt;menuitem value=&quot;15&quot; label=&quot;15&quot;/&gt;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-                      &lt;menuitem value=&quot;16&quot; label=&quot;16&quot;/&gt;</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-                      &lt;menuitem value=&quot;17&quot; label=&quot;17&quot;/&gt;</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-                      &lt;menuitem value=&quot;18&quot; label=&quot;18&quot;/&gt;</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-                      &lt;menuitem value=&quot;20&quot; label=&quot;20&quot;/&gt;</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-                      &lt;menuitem value=&quot;22&quot; label=&quot;22&quot;/&gt;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineminus">-                      &lt;menuitem value=&quot;24&quot; label=&quot;24&quot;/&gt;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-                      &lt;menuitem value=&quot;26&quot; label=&quot;26&quot;/&gt;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-                      &lt;menuitem value=&quot;28&quot; label=&quot;28&quot;/&gt;</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-                      &lt;menuitem value=&quot;30&quot; label=&quot;30&quot;/&gt;</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-                      &lt;menuitem value=&quot;32&quot; label=&quot;32&quot;/&gt;</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">-                      &lt;menuitem value=&quot;34&quot; label=&quot;34&quot;/&gt;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">-                      &lt;menuitem value=&quot;36&quot; label=&quot;36&quot;/&gt;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-                      &lt;menuitem value=&quot;40&quot; label=&quot;40&quot;/&gt;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-                      &lt;menuitem value=&quot;44&quot; label=&quot;44&quot;/&gt;</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-                      &lt;menuitem value=&quot;48&quot; label=&quot;48&quot;/&gt;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-                      &lt;menuitem value=&quot;56&quot; label=&quot;56&quot;/&gt;</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-                      &lt;menuitem value=&quot;64&quot; label=&quot;64&quot;/&gt;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-                      &lt;menuitem value=&quot;72&quot; label=&quot;72&quot;/&gt;</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-                    &lt;/menupopup&gt;</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-                  &lt;/menulist&gt;</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-              &lt;/vbox&gt;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-              &lt;vbox id=&quot;colorsRow&quot;&gt;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-                &lt;hbox&gt;</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-                  &lt;spacer style=&quot;width: 15px&quot;/&gt;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-                  &lt;button id=&quot;advancedFonts&quot; flex=&quot;1&quot; label=&quot;&amp;fontOptions.label;&quot; icon=&quot;select-font&quot;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-                          accesskey=&quot;&amp;fontOptions.accesskey;&quot; oncommand=&quot;gDisplayPane.configureFonts();&quot;/&gt;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-                &lt;hbox&gt;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineminus">-                  &lt;spacer style=&quot;width: 15px&quot;/&gt;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineminus">-                  &lt;button id=&quot;colors&quot; flex=&quot;1&quot; icon=&quot;select-color&quot; label=&quot;&amp;colorButton.label;&quot;</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineminus">-                          accesskey=&quot;&amp;colorButton.accesskey;&quot; oncommand=&quot;gDisplayPane.configureColors();&quot;/&gt;</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">-              &lt;/vbox&gt;</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">-</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;displayWidth.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-              &lt;checkbox id=&quot;displayGlyph&quot;</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-                        label=&quot;&amp;convertEmoticons.label;&quot;</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-                        preference=&quot;mail.display_glyph&quot;</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-                        accesskey=&quot;&amp;convertEmoticons.accesskey;&quot;/&gt;</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-            &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineminus">-</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-            &lt;label control=&quot;displayText&quot;&gt;&amp;displayText.label;&lt;/label&gt;</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-            &lt;hbox id=&quot;displayText&quot; class=&quot;indent&quot; align=&quot;center&quot; role=&quot;group&quot;&gt;</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineminus">-              &lt;label value=&quot;&amp;style.label;&quot; accesskey=&quot;&amp;style.accesskey;&quot; control=&quot;mailQuotedStyle&quot;/&gt;</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineminus">-              &lt;menulist id=&quot;mailQuotedStyle&quot; preference=&quot;mail.quoted_style&quot;&gt;</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineminus">-                &lt;menupopup&gt;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineminus">-                  &lt;menuitem value=&quot;0&quot; label=&quot;&amp;regularStyle.label;&quot;/&gt;</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineminus">-                  &lt;menuitem value=&quot;1&quot; label=&quot;&amp;bold.label;&quot;/&gt;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineminus">-                  &lt;menuitem value=&quot;2&quot; label=&quot;&amp;italic.label;&quot;/&gt;</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineminus">-                  &lt;menuitem value=&quot;3&quot; label=&quot;&amp;boldItalic.label;&quot;/&gt;</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineminus">-                &lt;/menupopup&gt;</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineminus">-              &lt;/menulist&gt;</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineminus">-              &lt;label value=&quot;&amp;size.label;&quot; accesskey=&quot;&amp;size.accesskey;&quot; control=&quot;mailQuotedSize&quot;/&gt;</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-              &lt;menulist id=&quot;mailQuotedSize&quot; preference=&quot;mail.quoted_size&quot;&gt;</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineminus">-                &lt;menupopup&gt;</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineminus">-                  &lt;menuitem value=&quot;0&quot; label=&quot;&amp;regularSize.label;&quot;/&gt;</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineminus">-                  &lt;menuitem value=&quot;1&quot; label=&quot;&amp;bigger.label;&quot;/&gt;</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">-                  &lt;menuitem value=&quot;2&quot; label=&quot;&amp;smaller.label;&quot;/&gt;</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">-                &lt;/menupopup&gt;</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-              &lt;/menulist&gt;</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">-              &lt;label value=&quot;&amp;quotedTextColor.label;&quot; accesskey=&quot;&amp;quotedTextColor.accesskey;&quot; control=&quot;citationmenu&quot;/&gt;</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-              &lt;html:input type=&quot;color&quot; id=&quot;citationmenu&quot; preference=&quot;mail.citation_color&quot;/&gt;</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineminus">-</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineminus">-        &lt;/tabpanel&gt;</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineminus">-          &lt;label control=&quot;tagList&quot;&gt;&amp;displayTagsText.label;&lt;/label&gt;</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineminus">-          &lt;hbox&gt;</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineminus">-            &lt;richlistbox id=&quot;tagList&quot;</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineminus">-                         flex=&quot;1&quot;</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-                         height=&quot;300px&quot;</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-                         ondblclick=&quot;gDisplayPane.editTag();&quot;</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-                         onselect=&quot;gDisplayPane.onSelect();&quot;/&gt;</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineminus">-            &lt;vbox&gt;</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineminus">-              &lt;button label=&quot;&amp;newTagButton.label;&quot; accesskey=&quot;&amp;newTagButton.accesskey;&quot;</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineminus">-                      oncommand=&quot;gDisplayPane.addTag();&quot;/&gt;</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">-              &lt;button id=&quot;editTagButton&quot; disabled=&quot;true&quot;</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">-                      label=&quot;&amp;editTagButton1.label;&quot;</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-                      accesskey=&quot;&amp;editTagButton1.accesskey;&quot;</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-                      oncommand=&quot;gDisplayPane.editTag();&quot;/&gt;</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineminus">-              &lt;button id=&quot;removeTagButton&quot; disabled=&quot;true&quot;</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-                      label=&quot;&amp;removeTagButton.label;&quot;</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineminus">-                      accesskey=&quot;&amp;removeTagButton.accesskey;&quot;</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineminus">-                      oncommand=&quot;gDisplayPane.removeTag();&quot;/&gt;</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineminus">-          &lt;/hbox&gt;</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineminus">-        &lt;/tabpanel&gt;</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineminus">-</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineminus">-        &lt;!-- Advanced --&gt;</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineminus">-        &lt;tabpanel orient=&quot;vertical&quot;&gt;</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;reading.caption;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineminus">-            &lt;vbox&gt;</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineminus">-                &lt;checkbox id=&quot;automaticallyMarkAsRead&quot;</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineminus">-                          preference=&quot;mailnews.mark_message_read.auto&quot;</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-                          label=&quot;&amp;autoMarkAsRead.label;&quot;</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineminus">-                          accesskey=&quot;&amp;autoMarkAsRead.accesskey;&quot;/&gt;</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineminus">-              &lt;radiogroup id=&quot;markAsReadAutoPreferences&quot; orient=&quot;vertical&quot;</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-                          class=&quot;indent&quot;</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">-                          align=&quot;start&quot;</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-                          preference=&quot;mailnews.mark_message_read.delay&quot;&gt;</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-                &lt;radio id=&quot;mark_read_immediately&quot;</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineminus">-                       label=&quot;&amp;markAsReadNoDelay.label;&quot;</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineminus">-                       value=&quot;false&quot;</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-                       accesskey=&quot;&amp;markAsReadNoDelay.accesskey;&quot;/&gt;</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineminus">-                &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineminus">-                  &lt;radio id=&quot;markAsReadAfterDelay&quot; value=&quot;true&quot;</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineminus">-                         label=&quot;&amp;markAsReadDelay.label;&quot;</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineminus">-                         accesskey=&quot;&amp;markAsReadDelay.accesskey;&quot;/&gt;</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineminus">-                  &lt;html:input id=&quot;markAsReadDelay&quot; type=&quot;number&quot; class=&quot;size3&quot;</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineminus">-                              min=&quot;1&quot; max=&quot;2147483&quot;</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineminus">-                              preference=&quot;mailnews.mark_message_read.delay.interval&quot;</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineminus">-                              aria-labelledby=&quot;markAsReadAfterDelay markAsReadDelay secondsLabel&quot;/&gt;</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineminus">-                  &lt;label id=&quot;secondsLabel&quot; value=&quot;&amp;secondsLabel.label;&quot;/&gt;</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-              &lt;/radiogroup&gt;</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineminus">-</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineminus">-            &lt;vbox&gt;</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineminus">-                &lt;label value=&quot;&amp;openMsgIn.label;&quot;</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineminus">-                       control=&quot;mailOpenMessageBehavior&quot;/&gt;</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineminus">-</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineminus">-                &lt;radiogroup id=&quot;mailOpenMessageBehavior&quot; class=&quot;indent&quot;</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineminus">-                            preference=&quot;mail.openMessageBehavior&quot;</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineminus">-                            orient=&quot;horizontal&quot;&gt;</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-                  &lt;radio id=&quot;newTab&quot; value=&quot;2&quot; label=&quot;&amp;openMsgInNewTab.label;&quot;</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-                         accesskey=&quot;&amp;openMsgInNewTab.accesskey;&quot;/&gt;</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineminus">-                  &lt;radio id=&quot;newWindow&quot; value=&quot;0&quot; label=&quot;&amp;reuseExpRadio0.label;&quot;</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-                         accesskey=&quot;&amp;reuseExpRadio0.accesskey;&quot;/&gt;</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineminus">-                  &lt;radio id=&quot;existingWindow&quot; value=&quot;1&quot;</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineminus">-                         label=&quot;&amp;reuseExpRadio1.label;&quot;</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineminus">-                         accesskey=&quot;&amp;reuseExpRadio1.accesskey;&quot;/&gt;</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineminus">-                &lt;/radiogroup&gt;</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineminus">-              &lt;hbox&gt;</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineminus">-                &lt;checkbox id=&quot;closeMsgOnMoveOrDelete&quot;</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineminus">-                          label=&quot;&amp;closeMsgOnMoveOrDelete.label;&quot;</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineminus">-                          accesskey=&quot;&amp;closeMsgOnMoveOrDelete.accesskey;&quot;</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-                          preference=&quot;mail.close_message_window.on_delete&quot;/&gt;</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineminus">-              &lt;/hbox&gt;</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineminus">-            &lt;/vbox&gt;</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineminus">-</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineminus">-</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineminus">-          &lt;groupbox&gt;</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineminus">-            &lt;label&gt;&lt;html:h2&gt;&amp;display.caption;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineminus">-</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineminus">-            &lt;hbox&gt;</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineminus">-              &lt;checkbox id=&quot;showCondensedAddresses&quot;</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineminus">-                        label=&quot;&amp;showCondensedAddresses.label;&quot;</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineminus">-                        accesskey=&quot;&amp;showCondensedAddresses.accesskey;&quot;</span>
<a href="#l9.211"></a><span id="l9.211" class="difflineminus">-                        preference=&quot;mail.showCondensedAddresses&quot;/&gt;</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineminus">-            &lt;/hbox&gt;</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineminus">-          &lt;/groupbox&gt;</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineminus">-</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineminus">-        &lt;/tabpanel&gt;</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineminus">-      &lt;/tabpanels&gt;</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-    &lt;/tabbox&gt;</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineminus">-    &lt;separator/&gt;</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineminus">-  &lt;/prefpane&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- a/mail/components/preferences/display.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ /dev/null</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -1,354 +0,0 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-/* -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-&quot;use strict&quot;;</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">-</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-/* import-globals-from ../../../../toolkit/mozapps/preferences/fontbuilder.js */</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-/* import-globals-from preferences.js */</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-/* import-globals-from subdialogs.js */</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-var {TagUtils} = ChromeUtils.import(&quot;resource:///modules/TagUtils.jsm&quot;);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-Preferences.addAll([</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-  { id: &quot;mail.preferences.display.selectedTabIndex&quot;, type: &quot;int&quot; },</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">-  { id: &quot;mail.fixed_width_messages&quot;, type: &quot;bool&quot; },</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-  { id: &quot;mail.quoted_style&quot;, type: &quot;int&quot; },</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-  { id: &quot;mail.quoted_size&quot;, type: &quot;int&quot; },</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-  { id: &quot;mail.citation_color&quot;, type: &quot;string&quot; },</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-  { id: &quot;mail.display_glyph&quot;, type: &quot;bool&quot; },</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-  { id: &quot;mailnews.labels.description.1&quot;, type: &quot;wstring&quot; },</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-  { id: &quot;mailnews.labels.color.1&quot;, type: &quot;string&quot; },</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">-  { id: &quot;mailnews.labels.description.2&quot;, type: &quot;wstring&quot; },</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-  { id: &quot;mailnews.labels.color.2&quot;, type: &quot;string&quot; },</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">-  { id: &quot;mailnews.labels.description.3&quot;, type: &quot;wstring&quot; },</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-  { id: &quot;mailnews.labels.color.3&quot;, type: &quot;string&quot; },</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-  { id: &quot;mailnews.labels.description.4&quot;, type: &quot;wstring&quot; },</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  { id: &quot;mailnews.labels.color.4&quot;, type: &quot;string&quot; },</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-  { id: &quot;mailnews.labels.description.5&quot;, type: &quot;wstring&quot; },</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-  { id: &quot;mailnews.labels.color.5&quot;, type: &quot;string&quot; },</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-  { id: &quot;font.language.group&quot;, type: &quot;wstring&quot; },</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">-  { id: &quot;mail.showCondensedAddresses&quot;, type: &quot;bool&quot; },</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">-  { id: &quot;mailnews.mark_message_read.auto&quot;, type: &quot;bool&quot; },</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-  { id: &quot;mailnews.mark_message_read.delay&quot;, type: &quot;bool&quot; },</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">-  { id: &quot;mailnews.mark_message_read.delay.interval&quot;, type: &quot;int&quot; },</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-  { id: &quot;mail.openMessageBehavior&quot;, type: &quot;int&quot; },</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-  { id: &quot;mail.close_message_window.on_delete&quot;, type: &quot;bool&quot; },</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">-]);</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">-</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-document.getElementById(&quot;paneDisplay&quot;)</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-        .addEventListener(&quot;paneload&quot;, function() { gDisplayPane.init(); });</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-var gDisplayPane = {</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-  mInitialized: false,</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-  mTagListBox:  null,</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-  init() {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-    if (!((&quot;arguments&quot; in window) &amp;&amp; window.arguments[1])) {</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-      // If no tab was specified, select the last used tab.</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-      let preference = Preferences.get(&quot;mail.preferences.display.selectedTabIndex&quot;);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-      if (preference.value)</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-        document.getElementById(&quot;displayPrefs&quot;).selectedIndex = preference.value;</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-    }</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-    this._rebuildFonts();</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-    this.updateMarkAsReadOptions();</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-    var menulist = document.getElementById(&quot;defaultFont&quot;);</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-    if (menulist.selectedIndex == -1) {</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-      // Prepend menuitem with empty name and value.</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-      let item = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-      item.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-      item.setAttribute(&quot;value&quot;, &quot;&quot;);</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-      menulist.menupopup.insertBefore(item, menulist.menupopup.firstChild);</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-      menulist.selectedIndex = 0;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-    }</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-    Preferences.addSyncFromPrefListener(menulist, () =&gt; this.readFontSelection());</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-    this.mInitialized = true;</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-    document.getElementById(&quot;citationmenu&quot;).value =</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-      Preferences.get(&quot;mail.citation_color&quot;).value;</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-    this.mTagListBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-    this.buildTagList();</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-  },</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-  // FONTS</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-  /**</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-   * Populates the default font list in UI.</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-   */</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-  _rebuildFonts() {</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-    var langGroupPref = Preferences.get(&quot;font.language.group&quot;);</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-    var isSerif = gDisplayPane._readDefaultFontTypeForLanguage(langGroupPref.value) == &quot;serif&quot;;</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-    gDisplayPane._selectDefaultLanguageGroup(langGroupPref.value, isSerif);</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-  },</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-  /**</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-   * Select the default language group.</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-   */</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-  _selectDefaultLanguageGroupPromise: Promise.resolve(),</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-  _selectDefaultLanguageGroup(aLanguageGroup, aIsSerif) {</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-    this._selectDefaultLanguageGroupPromise = (async () =&gt; {</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-      // Avoid overlapping language group selections by awaiting the resolution</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-      // of the previous one.  We do this because this function is re-entrant,</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-      // as inserting &lt;preference&gt; elements into the DOM sometimes triggers a call</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-      // back into this function.  And since this function is also asynchronous,</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-      // that call can enter this function before the previous run has completed,</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-      // which would corrupt the font menulists.  Awaiting the previous call's</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-      // resolution avoids that fate.</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-      await this._selectDefaultLanguageGroupPromise;</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-      const kFontNameFmtSerif         = &quot;font.name.serif.%LANG%&quot;;</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-      const kFontNameFmtSansSerif     = &quot;font.name.sans-serif.%LANG%&quot;;</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-      const kFontNameListFmtSerif     = &quot;font.name-list.serif.%LANG%&quot;;</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-      const kFontNameListFmtSansSerif = &quot;font.name-list.sans-serif.%LANG%&quot;;</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-      const kFontSizeFmtVariable      = &quot;font.size.variable.%LANG%&quot;;</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineminus">-</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineminus">-      // Make sure font.name-list is created before font.name so that it's</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineminus">-      // available at the time readFontSelection below is called.</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineminus">-      var prefs = [{format: aIsSerif ? kFontNameListFmtSerif : kFontNameListFmtSansSerif,</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-                    type: &quot;unichar&quot;,</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-                    element: null,</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-                    fonttype: aIsSerif ? &quot;serif&quot; : &quot;sans-serif&quot; },</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-                   {format: aIsSerif ? kFontNameFmtSerif : kFontNameFmtSansSerif,</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineminus">-                    type: &quot;fontname&quot;,</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineminus">-                    element: &quot;defaultFont&quot;,</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineminus">-                    fonttype: aIsSerif ? &quot;serif&quot; : &quot;sans-serif&quot; },</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineminus">-                   {format: kFontSizeFmtVariable,</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineminus">-                    type: &quot;int&quot;,</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-                    element: &quot;defaultFontSize&quot;,</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineminus">-                    fonttype: null }];</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineminus">-</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-      for (var i = 0; i &lt; prefs.length; ++i) {</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-        var preference = Preferences.get(prefs[i].format.replace(/%LANG%/, aLanguageGroup));</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-        if (!preference) {</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineminus">-          preference = Preferences.add({</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineminus">-            id: prefs[i].format.replace(/%LANG%/, aLanguageGroup),</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineminus">-            type: prefs[i].type,</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineminus">-          });</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-        }</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineminus">-</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineminus">-        if (!prefs[i].element)</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-          continue;</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineminus">-        var element = document.getElementById(prefs[i].element);</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineminus">-        if (element) {</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineminus">-          // Make sure we have the font list ready for readFontSelection below to</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineminus">-          // work. readFontSelection gets called at onsyncfrompreference, but the</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-          // exact semantics of when it is called (whether during setAttribute or</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineminus">-          // during setElementValue) aren't obvious.</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineminus">-          if (prefs[i].fonttype)</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineminus">-            await FontBuilder.buildFontList(aLanguageGroup, prefs[i].fonttype, element);</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineminus">-</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-          element.setAttribute(&quot;preference&quot;, preference.id);</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineminus">-</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-          preference.setElementValue(element);</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineminus">-        }</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-      }</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineminus">-    })().catch(Cu.reportError);</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineminus">-  },</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineminus">-</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineminus">-  /**</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineminus">-   * Returns the type of the current default font for the language denoted by</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineminus">-   * aLanguageGroup.</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineminus">-   */</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineminus">-  _readDefaultFontTypeForLanguage(aLanguageGroup) {</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineminus">-    const kDefaultFontType = &quot;font.default.%LANG%&quot;;</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-    var defaultFontTypePref = kDefaultFontType.replace(/%LANG%/, aLanguageGroup);</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineminus">-    var preference = Preferences.get(defaultFontTypePref);</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-    if (!preference) {</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-      Preferences.add({</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineminus">-        id: defaultFontTypePref,</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineminus">-        type: &quot;string&quot;,</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineminus">-        name: defaultFontTypePref,</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-      }).on(&quot;change&quot;, gDisplayPane._rebuildFonts);</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineminus">-    }</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineminus">-</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineminus">-    // We should return preference.value here, but we can't wait for the binding to load,</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineminus">-    // or things get really messy. Fortunately this will give the same answer.</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineminus">-    return Services.prefs.getCharPref(defaultFontTypePref);</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineminus">-  },</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineminus">-</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineminus">-  /**</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineminus">-   * Determine the appropriate value to select for defaultFont, for the</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineminus">-   * following cases:</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineminus">-   * - there is no setting</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineminus">-   * - the font selected by the user is no longer present (e.g. deleted from</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineminus">-   *   fonts folder)</span>
<a href="#l10.185"></a><span id="l10.185" class="difflineminus">-   */</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineminus">-  readFontSelection() {</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineminus">-    let element = document.getElementById(&quot;defaultFont&quot;);</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineminus">-    let preference = Preferences.get(element.getAttribute(&quot;preference&quot;));</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineminus">-    if (preference.value) {</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineminus">-      let fontItem = element.querySelector('[value=&quot;' + preference.value + '&quot;]');</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineminus">-</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineminus">-      // There is a setting that actually is in the list. Respect it.</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineminus">-      if (fontItem)</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineminus">-        return undefined;</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineminus">-    }</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineminus">-</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineminus">-    let defaultValue = element.firstChild.firstChild.getAttribute(&quot;value&quot;);</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineminus">-    let languagePref = Preferences.get(&quot;font.language.group&quot;);</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineminus">-    let defaultType = this._readDefaultFontTypeForLanguage(languagePref.value);</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineminus">-    let listPref = Preferences.get(&quot;font.name-list.&quot; + defaultType + &quot;.&quot; + languagePref.value);</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineminus">-    if (!listPref)</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineminus">-      return defaultValue;</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineminus">-</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineminus">-    let fontNames = listPref.value.split(&quot;,&quot;);</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineminus">-</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineminus">-    for (let fontName of fontNames) {</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineminus">-      let fontItem = element.querySelector('[value=&quot;' + fontName.trim() + '&quot;]');</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineminus">-      if (fontItem)</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineminus">-        return fontItem.getAttribute(&quot;value&quot;);</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineminus">-    }</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineminus">-    return defaultValue;</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineminus">-  },</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineminus">-</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineminus">-  tabSelectionChanged() {</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineminus">-    if (this.mInitialized)</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineminus">-      Preferences.get(&quot;mail.preferences.display.selectedTabIndex&quot;)</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineminus">-                 .valueFromPreferences = document.getElementById(&quot;displayPrefs&quot;).selectedIndex;</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineminus">-  },</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineminus">-</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineminus">-  /**</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineminus">-   * Displays the fonts dialog, where web page font names and sizes can be</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineminus">-   * configured.</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineminus">-   */</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineminus">-  configureFonts() {</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineminus">-    gSubDialog.open(&quot;chrome://messenger/content/preferences/fonts.xul&quot;);</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineminus">-  },</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineminus">-</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineminus">-  /**</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineminus">-   * Displays the colors dialog, where default web page/link/etc. colors can be</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineminus">-   * configured.</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineminus">-   */</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineminus">-  configureColors() {</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineminus">-    gSubDialog.open(&quot;chrome://messenger/content/preferences/colors.xul&quot;,</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineminus">-                    &quot;resizable=no&quot;);</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineminus">-  },</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineminus">-</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineminus">-</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineminus">-  // appends the tag to the tag list box</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineminus">-  appendTagItem(aTagName, aKey, aColor) {</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineminus">-    let item = this.mTagListBox.appendItem(aTagName, aKey);</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineminus">-    item.style.color = aColor;</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineminus">-    return item;</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineminus">-  },</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineminus">-</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineminus">-  buildTagList() {</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineminus">-    let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineminus">-    for (let i = 0; i &lt; tagArray.length; ++i) {</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineminus">-      let taginfo = tagArray[i];</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineminus">-      this.appendTagItem(taginfo.tag, taginfo.key, taginfo.color);</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineminus">-    }</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineminus">-  },</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineminus">-</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineminus">-  removeTag() {</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineminus">-    var index = this.mTagListBox.selectedIndex;</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineminus">-    if (index &gt;= 0) {</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineminus">-      var itemToRemove = this.mTagListBox.getItemAtIndex(index);</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineminus">-      MailServices.tags.deleteKey(itemToRemove.getAttribute(&quot;value&quot;));</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineminus">-      itemToRemove.remove();</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineminus">-      var numItemsInListBox = this.mTagListBox.getRowCount();</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineminus">-      this.mTagListBox.selectedIndex = index &lt; numItemsInListBox ? index : numItemsInListBox - 1;</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineminus">-    }</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineminus">-  },</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineminus">-</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineminus">-  /**</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineminus">-   * Open the edit tag dialog</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineminus">-   */</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineminus">-  editTag() {</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineminus">-    var index = this.mTagListBox.selectedIndex;</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineminus">-    if (index &gt;= 0) {</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineminus">-      var tagElToEdit = this.mTagListBox.getItemAtIndex(index);</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineminus">-      var args = {result: &quot;&quot;, keyToEdit: tagElToEdit.getAttribute(&quot;value&quot;), okCallback: editTagCallback};</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineminus">-      gSubDialog.open(&quot;chrome://messenger/content/newTagDialog.xul&quot;, &quot;resizable=no&quot;, args);</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineminus">-    }</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineminus">-  },</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineminus">-</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineminus">-  addTag() {</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineminus">-    var args = {result: &quot;&quot;, okCallback: addTagCallback};</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineminus">-    gSubDialog.open(&quot;chrome://messenger/content/newTagDialog.xul&quot;, &quot;resizable=no&quot;, args);</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineminus">-  },</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineminus">-</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineminus">-  onSelect() {</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineminus">-    let btnEdit = document.getElementById(&quot;editTagButton&quot;);</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineminus">-    let listBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineminus">-</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineminus">-    if (listBox.selectedCount &gt; 0)</span>
<a href="#l10.286"></a><span id="l10.286" class="difflineminus">-      btnEdit.disabled = false;</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineminus">-    else</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineminus">-      btnEdit.disabled = true;</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineminus">-</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineminus">-    document.getElementById(&quot;removeTagButton&quot;).disabled = btnEdit.disabled;</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineminus">-  },</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineminus">-</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineminus">-  /**</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineminus">-   * Enable/disable the options of automatic marking as read depending on the</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineminus">-   * state of the automatic marking feature.</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineminus">-   */</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineminus">-  updateMarkAsReadOptions() {</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineminus">-    let enableRadioGroup = Preferences.get(&quot;mailnews.mark_message_read.auto&quot;).value;</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineminus">-    let autoMarkAsPref = Preferences.get(&quot;mailnews.mark_message_read.delay&quot;);</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineminus">-    let autoMarkDisabled = !enableRadioGroup || autoMarkAsPref.locked;</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineminus">-    document.getElementById(&quot;markAsReadAutoPreferences&quot;).disabled = autoMarkDisabled;</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineminus">-    document.getElementById(&quot;secondsLabel&quot;).disabled = autoMarkDisabled;</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineminus">-    gDisplayPane.updateMarkAsReadTextbox();</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineminus">-  },</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineminus">-</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineminus">-  /**</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineminus">-   * Automatically enable/disable delay textbox depending on state of the</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineminus">-   * Mark As Read On Delay feature.</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineminus">-   */</span>
<a href="#l10.310"></a><span id="l10.310" class="difflineminus">-  updateMarkAsReadTextbox() {</span>
<a href="#l10.311"></a><span id="l10.311" class="difflineminus">-    let radioGroupEnabled = Preferences.get(&quot;mailnews.mark_message_read.auto&quot;).value;</span>
<a href="#l10.312"></a><span id="l10.312" class="difflineminus">-    let textBoxEnabled = Preferences.get(&quot;mailnews.mark_message_read.delay&quot;).value;</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineminus">-    let intervalPref = Preferences.get(&quot;mailnews.mark_message_read.delay.interval&quot;);</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineminus">-</span>
<a href="#l10.315"></a><span id="l10.315" class="difflineminus">-    let delayTextbox = document.getElementById(&quot;markAsReadDelay&quot;);</span>
<a href="#l10.316"></a><span id="l10.316" class="difflineminus">-    delayTextbox.disabled = !radioGroupEnabled || !textBoxEnabled || intervalPref.locked;</span>
<a href="#l10.317"></a><span id="l10.317" class="difflineminus">-    if (document.activeElement.id == &quot;markAsReadAutoPreferences&quot;) {</span>
<a href="#l10.318"></a><span id="l10.318" class="difflineminus">-      delayTextbox.focus();</span>
<a href="#l10.319"></a><span id="l10.319" class="difflineminus">-    }</span>
<a href="#l10.320"></a><span id="l10.320" class="difflineminus">-  },</span>
<a href="#l10.321"></a><span id="l10.321" class="difflineminus">-};</span>
<a href="#l10.322"></a><span id="l10.322" class="difflineminus">-</span>
<a href="#l10.323"></a><span id="l10.323" class="difflineminus">-function addTagCallback(aName, aColor) {</span>
<a href="#l10.324"></a><span id="l10.324" class="difflineminus">-  MailServices.tags.addTag(aName, aColor, &quot;&quot;);</span>
<a href="#l10.325"></a><span id="l10.325" class="difflineminus">-</span>
<a href="#l10.326"></a><span id="l10.326" class="difflineminus">-  // Add to style sheet.</span>
<a href="#l10.327"></a><span id="l10.327" class="difflineminus">-  let key = MailServices.tags.getKeyForTag(aName);</span>
<a href="#l10.328"></a><span id="l10.328" class="difflineminus">-  TagUtils.addTagToAllDocumentSheets(key, aColor);</span>
<a href="#l10.329"></a><span id="l10.329" class="difflineminus">-</span>
<a href="#l10.330"></a><span id="l10.330" class="difflineminus">-  var item = gDisplayPane.appendTagItem(aName, key, aColor);</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineminus">-  var tagListBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineminus">-  tagListBox.ensureElementIsVisible(item);</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineminus">-  tagListBox.selectItem(item);</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineminus">-  tagListBox.focus();</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineminus">-}</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineminus">-</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineminus">-function editTagCallback() {</span>
<a href="#l10.338"></a><span id="l10.338" class="difflineminus">-  // update the values of the selected item</span>
<a href="#l10.339"></a><span id="l10.339" class="difflineminus">-  let tagListEl = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l10.340"></a><span id="l10.340" class="difflineminus">-  let index = tagListEl.selectedIndex;</span>
<a href="#l10.341"></a><span id="l10.341" class="difflineminus">-  if (index &lt; 0)</span>
<a href="#l10.342"></a><span id="l10.342" class="difflineminus">-    return;</span>
<a href="#l10.343"></a><span id="l10.343" class="difflineminus">-</span>
<a href="#l10.344"></a><span id="l10.344" class="difflineminus">-  let tagElToEdit = tagListEl.getItemAtIndex(index);</span>
<a href="#l10.345"></a><span id="l10.345" class="difflineminus">-  let key = tagElToEdit.getAttribute(&quot;value&quot;);</span>
<a href="#l10.346"></a><span id="l10.346" class="difflineminus">-  let color = MailServices.tags.getColorForKey(key);</span>
<a href="#l10.347"></a><span id="l10.347" class="difflineminus">-  // update the color and label elements</span>
<a href="#l10.348"></a><span id="l10.348" class="difflineminus">-  tagElToEdit.setAttribute(&quot;label&quot;, MailServices.tags.getTagForKey(key));</span>
<a href="#l10.349"></a><span id="l10.349" class="difflineminus">-  tagElToEdit.style.color = color;</span>
<a href="#l10.350"></a><span id="l10.350" class="difflineminus">-</span>
<a href="#l10.351"></a><span id="l10.351" class="difflineminus">-  // Add to style sheet. We simply add the new color, the rule is added at the</span>
<a href="#l10.352"></a><span id="l10.352" class="difflineminus">-  // end and will overrule the previous rule.</span>
<a href="#l10.353"></a><span id="l10.353" class="difflineminus">-  TagUtils.addTagToAllDocumentSheets(key, color);</span>
<a href="#l10.354"></a><span id="l10.354" class="difflineminus">-}</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineminus">-</span>
<a href="#l10.356"></a><span id="l10.356" class="difflineminus">-Preferences.get(&quot;font.language.group&quot;).on(&quot;change&quot;, gDisplayPane._rebuildFonts);</span>
<a href="#l10.357"></a><span id="l10.357" class="difflineminus">-Preferences.get(&quot;mailnews.mark_message_read.auto&quot;).on(&quot;change&quot;, gDisplayPane.updateMarkAsReadOptions);</span>
<a href="#l10.358"></a><span id="l10.358" class="difflineminus">-Preferences.get(&quot;mailnews.mark_message_read.delay&quot;).on(&quot;change&quot;, gDisplayPane.updateMarkAsReadTextbox);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/preferences/general.inc.xul</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/preferences/general.inc.xul</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,18 +1,45 @@</span>
<a href="#l11.4"></a><span id="l11.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l11.7"></a><span id="l11.7">   &lt;prefpane id=&quot;paneGeneral&quot; label=&quot;&amp;paneGeneral.title;&quot;&gt;</span>
<a href="#l11.8"></a><span id="l11.8">     &lt;script src=&quot;chrome://communicator/content/utilityOverlay.js&quot;/&gt;</span>
<a href="#l11.9"></a><span id="l11.9">     &lt;script src=&quot;chrome://messenger/content/preferences/general.js&quot;/&gt;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+    &lt;script src=&quot;chrome://mozapps/content/preferences/fontbuilder.js&quot;/&gt;</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+    &lt;commandset id=&quot;appPaneCommandSet&quot;&gt;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+      &lt;command id=&quot;cmd_delete&quot;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+               oncommand=&quot;gGeneralPane.onDelete();&quot;/&gt;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+    &lt;/commandset&gt;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+    &lt;keyset id=&quot;appPaneKeyset&quot;&gt;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+      &lt;key keycode=&quot;VK_BACK&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+      &lt;key keycode=&quot;VK_DELETE&quot; modifiers=&quot;any&quot; command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+    &lt;/keyset&gt;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+    &lt;keyset&gt;</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+      &lt;key key=&quot;&amp;focusSearch1.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+           oncommand=&quot;gGeneralPane.focusFilterBox();&quot;/&gt;</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+      &lt;key key=&quot;&amp;focusSearch2.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+           oncommand=&quot;gGeneralPane.focusFilterBox();&quot;/&gt;</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+    &lt;/keyset&gt;</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29">     &lt;stringbundle id=&quot;bundlePreferences&quot; src=&quot;chrome://messenger/locale/preferences/preferences.properties&quot;/&gt;</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+#ifdef HAVE_SHELL_SERVICE</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+    &lt;stringbundle id=&quot;bundleBrand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+#endif</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-    &lt;groupbox&gt;</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+    &lt;hbox id=&quot;generalCategory&quot;</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;pane-general-title&quot;/&gt;</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.42"></a><span id="l11.42">       &lt;label&gt;&lt;html:h2&gt;&amp;messengerStartPage.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.43"></a><span id="l11.43">         &lt;hbox align=&quot;start&quot;&gt;</span>
<a href="#l11.44"></a><span id="l11.44">           &lt;checkbox id=&quot;mailnewsStartPageEnabled&quot; label=&quot;&amp;enableStartPage.label;&quot;</span>
<a href="#l11.45"></a><span id="l11.45">                     preference=&quot;mailnews.start_page.enabled&quot;</span>
<a href="#l11.46"></a><span id="l11.46">                     accesskey=&quot;&amp;enableStartPage.accesskey;&quot;/&gt;</span>
<a href="#l11.47"></a><span id="l11.47">         &lt;/hbox&gt;</span>
<a href="#l11.48"></a><span id="l11.48">         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.49"></a><span id="l11.49">           &lt;label value=&quot;&amp;location.label;&quot; accesskey=&quot;&amp;location1.accesskey;&quot; control=&quot;mailnewsStartPageUrl&quot;/&gt;</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineat">@@ -20,34 +47,217 @@</span>
<a href="#l11.51"></a><span id="l11.51">                    preference=&quot;mailnews.start_page.url&quot;/&gt;</span>
<a href="#l11.52"></a><span id="l11.52">           &lt;button label=&quot;&amp;useDefault.label;&quot; accesskey=&quot;&amp;useDefault.accesskey;&quot;</span>
<a href="#l11.53"></a><span id="l11.53">                   oncommand=&quot;gGeneralPane.restoreDefaultStartPage();&quot;&gt;</span>
<a href="#l11.54"></a><span id="l11.54">             &lt;observes element=&quot;mailnewsStartPageUrl&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l11.55"></a><span id="l11.55">           &lt;/button&gt;</span>
<a href="#l11.56"></a><span id="l11.56">         &lt;/hbox&gt;</span>
<a href="#l11.57"></a><span id="l11.57">     &lt;/groupbox&gt;</span>
<a href="#l11.58"></a><span id="l11.58"> </span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-    &lt;groupbox&gt;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.61"></a><span id="l11.61">       &lt;label&gt;&lt;html:h2 &gt;&amp;defaultSearchEngine.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.62"></a><span id="l11.62">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.63"></a><span id="l11.63">         &lt;menulist id=&quot;defaultWebSearch&quot;&gt;</span>
<a href="#l11.64"></a><span id="l11.64">           &lt;menupopup id=&quot;defaultWebSearchPopup&quot;/&gt;</span>
<a href="#l11.65"></a><span id="l11.65">         &lt;/menulist&gt;</span>
<a href="#l11.66"></a><span id="l11.66">         &lt;button id=&quot;addSearchEngine&quot;</span>
<a href="#l11.67"></a><span id="l11.67">                 label=&quot;&amp;addSearchEngine.label;&quot;</span>
<a href="#l11.68"></a><span id="l11.68">                 accesskey=&quot;&amp;addSearchEngine.accesskey;&quot;</span>
<a href="#l11.69"></a><span id="l11.69">                 oncommand=&quot;gGeneralPane.addSearchEngine();&quot;/&gt;</span>
<a href="#l11.70"></a><span id="l11.70">         &lt;button id=&quot;removeSearchEngine&quot;</span>
<a href="#l11.71"></a><span id="l11.71">                 label=&quot;&amp;removeSearchEngine.label;&quot;</span>
<a href="#l11.72"></a><span id="l11.72">                 accesskey=&quot;&amp;removeSearchEngine.accesskey;&quot;</span>
<a href="#l11.73"></a><span id="l11.73">                 oncommand=&quot;gGeneralPane.removeSearchEngine();&quot;/&gt;</span>
<a href="#l11.74"></a><span id="l11.74">       &lt;/hbox&gt;</span>
<a href="#l11.75"></a><span id="l11.75">     &lt;/groupbox&gt;</span>
<a href="#l11.76"></a><span id="l11.76"> </span>
<a href="#l11.77"></a><span id="l11.77" class="difflineminus">-    &lt;groupbox&gt;</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+#ifdef HAVE_SHELL_SERVICE</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+    &lt;groupbox id=&quot;systemDefaultsGroup&quot; data-category=&quot;paneGeneral&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;systemIntegration.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+      &lt;hbox id=&quot;checkDefaultBox&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+        &lt;checkbox id=&quot;alwaysCheckDefault&quot;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+                  preference=&quot;mail.shell.checkDefaultClient&quot;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+                  label=&quot;&amp;alwaysCheckDefault.label;&quot;</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+                  accesskey=&quot;&amp;alwaysCheckDefault.accesskey;&quot;/&gt;</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+        &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+        &lt;button id=&quot;checkDefaultButton&quot; label=&quot;&amp;checkDefaultsNow.label;&quot;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+                accesskey=&quot;&amp;checkDefaultsNow.accesskey;&quot;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+                oncommand=&quot;gGeneralPane.checkDefaultNow();&quot;</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+                preference=&quot;pref.general.disable_button.default_mail&quot;/&gt;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+      &lt;hbox id=&quot;searchIntegrationContainer&quot;&gt;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+        &lt;checkbox id=&quot;searchIntegration&quot;</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+                  preference=&quot;searchintegration.enable&quot;</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+                  label=&quot;&amp;searchIntegration.label;&quot;</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+                  accesskey=&quot;&amp;searchIntegration.accesskey;&quot;/&gt;</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+#endif</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+    &lt;hbox id=&quot;languageAndAppearanceCategory&quot;</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;general-language-and-appearance-header&quot;/&gt;</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+    &lt;!-- Fonts and Colors --&gt;</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+    &lt;groupbox id=&quot;fontsGroup&quot; data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;fontsAndColors1.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+      &lt;hbox id=&quot;fontSettings&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineplus">+        &lt;vbox id=&quot;fontRow&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+            &lt;label accesskey=&quot;&amp;defaultFont.accesskey;&quot; control=&quot;defaultFont&quot;&gt;&amp;defaultFont.label;&lt;/label&gt;</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+            &lt;menulist id=&quot;defaultFont&quot; flex=&quot;1&quot; sizetopopup=&quot;pref&quot; crop=&quot;center&quot;&gt;</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+              &lt;menupopup crop=&quot;center&quot;/&gt;</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+            &lt;label accesskey=&quot;&amp;defaultSize.accesskey;&quot; control=&quot;defaultFontSize&quot;&gt;&amp;defaultSize.label;&lt;/label&gt;</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+            &lt;menulist id=&quot;defaultFontSize&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+              &lt;menupopup crop=&quot;center&quot;&gt;</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+                &lt;menuitem value=&quot;9&quot; label=&quot;9&quot;/&gt;</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineplus">+                &lt;menuitem value=&quot;10&quot; label=&quot;10&quot;/&gt;</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineplus">+                &lt;menuitem value=&quot;11&quot; label=&quot;11&quot;/&gt;</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineplus">+                &lt;menuitem value=&quot;12&quot; label=&quot;12&quot;/&gt;</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+                &lt;menuitem value=&quot;13&quot; label=&quot;13&quot;/&gt;</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+                &lt;menuitem value=&quot;14&quot; label=&quot;14&quot;/&gt;</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+                &lt;menuitem value=&quot;15&quot; label=&quot;15&quot;/&gt;</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineplus">+                &lt;menuitem value=&quot;16&quot; label=&quot;16&quot;/&gt;</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+                &lt;menuitem value=&quot;17&quot; label=&quot;17&quot;/&gt;</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+                &lt;menuitem value=&quot;18&quot; label=&quot;18&quot;/&gt;</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+                &lt;menuitem value=&quot;20&quot; label=&quot;20&quot;/&gt;</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+                &lt;menuitem value=&quot;22&quot; label=&quot;22&quot;/&gt;</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+                &lt;menuitem value=&quot;24&quot; label=&quot;24&quot;/&gt;</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineplus">+                &lt;menuitem value=&quot;26&quot; label=&quot;26&quot;/&gt;</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+                &lt;menuitem value=&quot;28&quot; label=&quot;28&quot;/&gt;</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+                &lt;menuitem value=&quot;30&quot; label=&quot;30&quot;/&gt;</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineplus">+                &lt;menuitem value=&quot;32&quot; label=&quot;32&quot;/&gt;</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineplus">+                &lt;menuitem value=&quot;34&quot; label=&quot;34&quot;/&gt;</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineplus">+                &lt;menuitem value=&quot;36&quot; label=&quot;36&quot;/&gt;</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineplus">+                &lt;menuitem value=&quot;40&quot; label=&quot;40&quot;/&gt;</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+                &lt;menuitem value=&quot;44&quot; label=&quot;44&quot;/&gt;</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineplus">+                &lt;menuitem value=&quot;48&quot; label=&quot;48&quot;/&gt;</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+                &lt;menuitem value=&quot;56&quot; label=&quot;56&quot;/&gt;</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+                &lt;menuitem value=&quot;64&quot; label=&quot;64&quot;/&gt;</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+                &lt;menuitem value=&quot;72&quot; label=&quot;72&quot;/&gt;</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineplus">+        &lt;vbox id=&quot;colorsRow&quot;&gt;</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+          &lt;button id=&quot;advancedFonts&quot; flex=&quot;1&quot; label=&quot;&amp;fontOptions.label;&quot; icon=&quot;select-font&quot;</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineplus">+                  accesskey=&quot;&amp;fontOptions.accesskey;&quot; oncommand=&quot;gGeneralPane.configureFonts();&quot;/&gt;</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineplus">+          &lt;button id=&quot;colors&quot; flex=&quot;1&quot; icon=&quot;select-color&quot; label=&quot;&amp;colorButton.label;&quot;</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+                  accesskey=&quot;&amp;colorButton.accesskey;&quot; oncommand=&quot;gGeneralPane.configureColors();&quot;/&gt;</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+        &lt;label&gt;&lt;html:h2&gt;&amp;displayWidth.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+        &lt;checkbox id=&quot;displayGlyph&quot;</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineplus">+                  label=&quot;&amp;convertEmoticons.label;&quot;</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+                  preference=&quot;mail.display_glyph&quot;</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineplus">+                  accesskey=&quot;&amp;convertEmoticons.accesskey;&quot;/&gt;</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineplus">+        &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineplus">+</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineplus">+      &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+      &lt;label control=&quot;displayText&quot;&gt;&amp;displayText.label;&lt;/label&gt;</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+      &lt;hbox id=&quot;displayText&quot; class=&quot;indent&quot; align=&quot;center&quot; role=&quot;group&quot;&gt;</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+        &lt;label value=&quot;&amp;style.label;&quot; accesskey=&quot;&amp;style.accesskey;&quot; control=&quot;mailQuotedStyle&quot;/&gt;</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+        &lt;menulist id=&quot;mailQuotedStyle&quot; preference=&quot;mail.quoted_style&quot;&gt;</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+          &lt;menupopup&gt;</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+            &lt;menuitem value=&quot;0&quot; label=&quot;&amp;regularStyle.label;&quot;/&gt;</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+            &lt;menuitem value=&quot;1&quot; label=&quot;&amp;bold.label;&quot;/&gt;</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+            &lt;menuitem value=&quot;2&quot; label=&quot;&amp;italic.label;&quot;/&gt;</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineplus">+            &lt;menuitem value=&quot;3&quot; label=&quot;&amp;boldItalic.label;&quot;/&gt;</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineplus">+        &lt;label value=&quot;&amp;size.label;&quot; accesskey=&quot;&amp;size.accesskey;&quot; control=&quot;mailQuotedSize&quot;/&gt;</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+        &lt;menulist id=&quot;mailQuotedSize&quot; preference=&quot;mail.quoted_size&quot;&gt;</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+          &lt;menupopup&gt;</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineplus">+            &lt;menuitem value=&quot;0&quot; label=&quot;&amp;regularSize.label;&quot;/&gt;</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+            &lt;menuitem value=&quot;1&quot; label=&quot;&amp;bigger.label;&quot;/&gt;</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineplus">+            &lt;menuitem value=&quot;2&quot; label=&quot;&amp;smaller.label;&quot;/&gt;</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+        &lt;label value=&quot;&amp;quotedTextColor.label;&quot; accesskey=&quot;&amp;quotedTextColor.accesskey;&quot; control=&quot;citationmenu&quot;/&gt;</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineplus">+        &lt;html:input type=&quot;color&quot; id=&quot;citationmenu&quot; preference=&quot;mail.citation_color&quot;/&gt;</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineplus">+</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineplus">+    &lt;!-- Date and time formatting --&gt;</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;dateTimeFormatting.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+      &lt;radiogroup id=&quot;formatLocale&quot; align=&quot;start&quot;</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+                  preference=&quot;intl.regional_prefs.use_os_locales&quot;</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+                  orient=&quot;vertical&quot;&gt;</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineplus">+        &lt;radio id=&quot;appLocale&quot;</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineplus">+               value=&quot;false&quot;/&gt;</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineplus">+               &lt;!-- label and accesskey will be set dynamically --&gt;</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineplus">+        &lt;radio id=&quot;rsLocale&quot;</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineplus">+               value=&quot;true&quot;/&gt;</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineplus">+               &lt;!-- label and accesskey will be set dynamically --&gt;</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineplus">+      &lt;/radiogroup&gt;</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineplus">+</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+    &lt;groupbox id=&quot;messengerLanguagesBox&quot; data-category=&quot;paneGeneral&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;languageSelector.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineplus">+        &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l11.212"></a><span id="l11.212" class="difflineplus">+        &lt;description flex=&quot;1&quot;</span>
<a href="#l11.213"></a><span id="l11.213" class="difflineplus">+                     controls=&quot;chooseMessengerLanguage&quot;</span>
<a href="#l11.214"></a><span id="l11.214" class="difflineplus">+                     data-l10n-id=&quot;choose-messenger-language-description&quot;/&gt;</span>
<a href="#l11.215"></a><span id="l11.215" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.216"></a><span id="l11.216" class="difflineplus">+          &lt;menulist id=&quot;defaultMessengerLanguage&quot;</span>
<a href="#l11.217"></a><span id="l11.217" class="difflineplus">+                    oncommand=&quot;gGeneralPane.onMessengerLanguageChange(event)&quot;&gt;</span>
<a href="#l11.218"></a><span id="l11.218" class="difflineplus">+            &lt;menupopup/&gt;</span>
<a href="#l11.219"></a><span id="l11.219" class="difflineplus">+          &lt;/menulist&gt;</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineplus">+          &lt;button id=&quot;manageMessengerLanguagesButton&quot;</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineplus">+                  class=&quot;accessory-button&quot;</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+                  data-l10n-id=&quot;manage-messenger-languages-button&quot;</span>
<a href="#l11.223"></a><span id="l11.223" class="difflineplus">+                  oncommand=&quot;gGeneralPane.showMessengerLanguages({search: false})&quot;/&gt;</span>
<a href="#l11.224"></a><span id="l11.224" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.225"></a><span id="l11.225" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.226"></a><span id="l11.226" class="difflineplus">+      &lt;hbox id=&quot;confirmMessengerLanguage&quot;</span>
<a href="#l11.227"></a><span id="l11.227" class="difflineplus">+            class=&quot;message-bar&quot;</span>
<a href="#l11.228"></a><span id="l11.228" class="difflineplus">+            align=&quot;center&quot;</span>
<a href="#l11.229"></a><span id="l11.229" class="difflineplus">+            hidden=&quot;true&quot;&gt;</span>
<a href="#l11.230"></a><span id="l11.230" class="difflineplus">+        &lt;image class=&quot;message-bar-icon&quot;/&gt;</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineplus">+        &lt;vbox class=&quot;message-bar-content-container&quot; align=&quot;stretch&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.233"></a><span id="l11.233" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.234"></a><span id="l11.234" class="difflineplus">+</span>
<a href="#l11.235"></a><span id="l11.235" class="difflineplus">+    &lt;!-- Scrolling --&gt;</span>
<a href="#l11.236"></a><span id="l11.236" class="difflineplus">+    &lt;groupbox id=&quot;scrollingGroup&quot; data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.237"></a><span id="l11.237" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;scrolling.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.238"></a><span id="l11.238" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.239"></a><span id="l11.239" class="difflineplus">+        &lt;checkbox id=&quot;useAutoScroll&quot;</span>
<a href="#l11.240"></a><span id="l11.240" class="difflineplus">+                  label=&quot;&amp;useAutoScroll.label;&quot;</span>
<a href="#l11.241"></a><span id="l11.241" class="difflineplus">+                  accesskey=&quot;&amp;useAutoScroll.accesskey;&quot;</span>
<a href="#l11.242"></a><span id="l11.242" class="difflineplus">+                  preference=&quot;general.autoScroll&quot;/&gt;</span>
<a href="#l11.243"></a><span id="l11.243" class="difflineplus">+        &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.244"></a><span id="l11.244" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.245"></a><span id="l11.245" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.246"></a><span id="l11.246" class="difflineplus">+        &lt;checkbox id=&quot;useSmoothScrolling&quot;</span>
<a href="#l11.247"></a><span id="l11.247" class="difflineplus">+                  label=&quot;&amp;useSmoothScrolling.label;&quot;</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineplus">+                  accesskey=&quot;&amp;useSmoothScrolling.accesskey;&quot;</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineplus">+                  preference=&quot;general.smoothScroll&quot;/&gt;</span>
<a href="#l11.250"></a><span id="l11.250" class="difflineplus">+        &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.251"></a><span id="l11.251" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.252"></a><span id="l11.252" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.253"></a><span id="l11.253" class="difflineplus">+</span>
<a href="#l11.254"></a><span id="l11.254" class="difflineplus">+</span>
<a href="#l11.255"></a><span id="l11.255" class="difflineplus">+    &lt;hbox id=&quot;incomingMailCategory&quot;</span>
<a href="#l11.256"></a><span id="l11.256" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.257"></a><span id="l11.257" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.258"></a><span id="l11.258" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;general-incoming-mail-header&quot;/&gt;</span>
<a href="#l11.259"></a><span id="l11.259" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.260"></a><span id="l11.260" class="difflineplus">+</span>
<a href="#l11.261"></a><span id="l11.261" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.262"></a><span id="l11.262">       &lt;label&gt;&lt;html:h2&gt;&amp;newMessagesArrive.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.263"></a><span id="l11.263"> #ifdef XP_MACOSX</span>
<a href="#l11.264"></a><span id="l11.264">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.265"></a><span id="l11.265">         &lt;description flex=&quot;1&quot;&gt;&amp;changeDockIconOptions.label;&lt;/description&gt;</span>
<a href="#l11.266"></a><span id="l11.266">         &lt;button id=&quot;dockOptions&quot; label=&quot;&amp;dockOptions.label;&quot;</span>
<a href="#l11.267"></a><span id="l11.267">                 accesskey=&quot;&amp;dockOptions.accesskey;&quot;</span>
<a href="#l11.268"></a><span id="l11.268">                 oncommand=&quot;gGeneralPane.configureDockOptions();&quot;/&gt;</span>
<a href="#l11.269"></a><span id="l11.269">       &lt;/hbox&gt;</span>
<a href="#l11.270"></a><span id="l11.270" class="difflineat">@@ -120,9 +330,434 @@</span>
<a href="#l11.271"></a><span id="l11.271">         &lt;button id=&quot;browseForSound&quot;</span>
<a href="#l11.272"></a><span id="l11.272">                 label=&quot;&amp;browse.label;&quot;</span>
<a href="#l11.273"></a><span id="l11.273">                 accesskey=&quot;&amp;browse.accesskey;&quot;</span>
<a href="#l11.274"></a><span id="l11.274">                 oncommand=&quot;gGeneralPane.browseForSoundFile();&quot;&gt;</span>
<a href="#l11.275"></a><span id="l11.275">           &lt;observes element=&quot;soundUrlLocation&quot; attribute=&quot;disabled&quot;/&gt;</span>
<a href="#l11.276"></a><span id="l11.276">         &lt;/button&gt;</span>
<a href="#l11.277"></a><span id="l11.277">       &lt;/hbox&gt;</span>
<a href="#l11.278"></a><span id="l11.278">     &lt;/groupbox&gt;</span>
<a href="#l11.279"></a><span id="l11.279" class="difflineplus">+</span>
<a href="#l11.280"></a><span id="l11.280" class="difflineplus">+    &lt;hbox id=&quot;filesAttachmentCategory&quot;</span>
<a href="#l11.281"></a><span id="l11.281" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.282"></a><span id="l11.282" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.283"></a><span id="l11.283" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;general-files-and-attachment-header&quot;/&gt;</span>
<a href="#l11.284"></a><span id="l11.284" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.285"></a><span id="l11.285" class="difflineplus">+</span>
<a href="#l11.286"></a><span id="l11.286" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.287"></a><span id="l11.287" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.288"></a><span id="l11.288" class="difflineplus">+        &lt;textbox is=&quot;search-textbox&quot; id=&quot;filter&quot;</span>
<a href="#l11.289"></a><span id="l11.289" class="difflineplus">+                 flex=&quot;1&quot;</span>
<a href="#l11.290"></a><span id="l11.290" class="difflineplus">+                 placeholder=&quot;&amp;filter.placeholder;&quot;</span>
<a href="#l11.291"></a><span id="l11.291" class="difflineplus">+                 aria-controls=&quot;handlersView&quot;</span>
<a href="#l11.292"></a><span id="l11.292" class="difflineplus">+                 oncommand=&quot;gGeneralPane.rebuildView();&quot;/&gt;</span>
<a href="#l11.293"></a><span id="l11.293" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.294"></a><span id="l11.294" class="difflineplus">+</span>
<a href="#l11.295"></a><span id="l11.295" class="difflineplus">+      &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l11.296"></a><span id="l11.296" class="difflineplus">+</span>
<a href="#l11.297"></a><span id="l11.297" class="difflineplus">+      &lt;listheader equalsize=&quot;always&quot;&gt;</span>
<a href="#l11.298"></a><span id="l11.298" class="difflineplus">+        &lt;treecol id=&quot;typeColumn&quot; label=&quot;&amp;typeColumn.label;&quot; value=&quot;type&quot;</span>
<a href="#l11.299"></a><span id="l11.299" class="difflineplus">+                 accesskey=&quot;&amp;typeColumn.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l11.300"></a><span id="l11.300" class="difflineplus">+                 flex=&quot;1&quot; onclick=&quot;gGeneralPane.sort(event);&quot;</span>
<a href="#l11.301"></a><span id="l11.301" class="difflineplus">+                 sortDirection=&quot;ascending&quot; sort=&quot;typeDescription&quot;/&gt;</span>
<a href="#l11.302"></a><span id="l11.302" class="difflineplus">+        &lt;treecol id=&quot;actionColumn&quot; label=&quot;&amp;actionColumn2.label;&quot; value=&quot;action&quot;</span>
<a href="#l11.303"></a><span id="l11.303" class="difflineplus">+                 accesskey=&quot;&amp;actionColumn2.accesskey;&quot; persist=&quot;sortDirection&quot;</span>
<a href="#l11.304"></a><span id="l11.304" class="difflineplus">+                 flex=&quot;1&quot; onclick=&quot;gGeneralPane.sort(event);&quot;/&gt;</span>
<a href="#l11.305"></a><span id="l11.305" class="difflineplus">+      &lt;/listheader&gt;</span>
<a href="#l11.306"></a><span id="l11.306" class="difflineplus">+      &lt;richlistbox id=&quot;handlersView&quot; height=&quot;180px&quot;</span>
<a href="#l11.307"></a><span id="l11.307" class="difflineplus">+                   preference=&quot;pref.downloads.disable_button.edit_actions&quot;/&gt;</span>
<a href="#l11.308"></a><span id="l11.308" class="difflineplus">+</span>
<a href="#l11.309"></a><span id="l11.309" class="difflineplus">+      &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l11.310"></a><span id="l11.310" class="difflineplus">+</span>
<a href="#l11.311"></a><span id="l11.311" class="difflineplus">+      &lt;vbox align=&quot;start&quot;&gt;</span>
<a href="#l11.312"></a><span id="l11.312" class="difflineplus">+        &lt;radiogroup id=&quot;saveWhere&quot; flex=&quot;1&quot;</span>
<a href="#l11.313"></a><span id="l11.313" class="difflineplus">+                    preference=&quot;browser.download.useDownloadDir&quot;&gt;</span>
<a href="#l11.314"></a><span id="l11.314" class="difflineplus">+          &lt;hbox id=&quot;saveToRow&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.315"></a><span id="l11.315" class="difflineplus">+            &lt;radio id=&quot;saveTo&quot; value=&quot;true&quot;</span>
<a href="#l11.316"></a><span id="l11.316" class="difflineplus">+                   label=&quot;&amp;saveTo.label;&quot;</span>
<a href="#l11.317"></a><span id="l11.317" class="difflineplus">+                   accesskey=&quot;&amp;saveTo.accesskey;&quot;</span>
<a href="#l11.318"></a><span id="l11.318" class="difflineplus">+                   aria-labelledby=&quot;saveTo downloadFolder&quot;/&gt;</span>
<a href="#l11.319"></a><span id="l11.319" class="difflineplus">+            &lt;textbox id=&quot;downloadFolder&quot; flex=&quot;1&quot;</span>
<a href="#l11.320"></a><span id="l11.320" class="difflineplus">+                     type=&quot;filefield&quot;</span>
<a href="#l11.321"></a><span id="l11.321" class="difflineplus">+                     readonly=&quot;true&quot;</span>
<a href="#l11.322"></a><span id="l11.322" class="difflineplus">+                     aria-labelledby=&quot;saveTo&quot;/&gt;</span>
<a href="#l11.323"></a><span id="l11.323" class="difflineplus">+            &lt;button id=&quot;chooseFolder&quot; oncommand=&quot;gDownloadDirSection.chooseFolder();&quot;</span>
<a href="#l11.324"></a><span id="l11.324" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l11.325"></a><span id="l11.325" class="difflineplus">+                    accesskey=&quot;&amp;chooseFolderMac.accesskey;&quot;</span>
<a href="#l11.326"></a><span id="l11.326" class="difflineplus">+                    label=&quot;&amp;chooseFolderMac.label;&quot;/&gt;</span>
<a href="#l11.327"></a><span id="l11.327" class="difflineplus">+#else</span>
<a href="#l11.328"></a><span id="l11.328" class="difflineplus">+                    accesskey=&quot;&amp;chooseFolderWin.accesskey;&quot;</span>
<a href="#l11.329"></a><span id="l11.329" class="difflineplus">+                    label=&quot;&amp;chooseFolderWin.label;&quot;/&gt;</span>
<a href="#l11.330"></a><span id="l11.330" class="difflineplus">+#endif</span>
<a href="#l11.331"></a><span id="l11.331" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.332"></a><span id="l11.332" class="difflineplus">+          &lt;hbox&gt;</span>
<a href="#l11.333"></a><span id="l11.333" class="difflineplus">+            &lt;radio id=&quot;alwaysAsk&quot;</span>
<a href="#l11.334"></a><span id="l11.334" class="difflineplus">+                   value=&quot;false&quot;</span>
<a href="#l11.335"></a><span id="l11.335" class="difflineplus">+                   label=&quot;&amp;alwaysAsk.label;&quot;</span>
<a href="#l11.336"></a><span id="l11.336" class="difflineplus">+                   accesskey=&quot;&amp;alwaysAsk.accesskey;&quot;/&gt;</span>
<a href="#l11.337"></a><span id="l11.337" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.338"></a><span id="l11.338" class="difflineplus">+        &lt;/radiogroup&gt;</span>
<a href="#l11.339"></a><span id="l11.339" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.340"></a><span id="l11.340" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.341"></a><span id="l11.341" class="difflineplus">+</span>
<a href="#l11.342"></a><span id="l11.342" class="difflineplus">+    &lt;hbox id=&quot;tagsCategory&quot;</span>
<a href="#l11.343"></a><span id="l11.343" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.344"></a><span id="l11.344" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.345"></a><span id="l11.345" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;general-tags-header&quot;/&gt;</span>
<a href="#l11.346"></a><span id="l11.346" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.347"></a><span id="l11.347" class="difflineplus">+</span>
<a href="#l11.348"></a><span id="l11.348" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.349"></a><span id="l11.349" class="difflineplus">+      &lt;label control=&quot;tagList&quot;&gt;&amp;displayTagsText.label;&lt;/label&gt;</span>
<a href="#l11.350"></a><span id="l11.350" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.351"></a><span id="l11.351" class="difflineplus">+        &lt;richlistbox id=&quot;tagList&quot;</span>
<a href="#l11.352"></a><span id="l11.352" class="difflineplus">+                     flex=&quot;1&quot;</span>
<a href="#l11.353"></a><span id="l11.353" class="difflineplus">+                     height=&quot;180px&quot;</span>
<a href="#l11.354"></a><span id="l11.354" class="difflineplus">+                     ondblclick=&quot;gGeneralPane.editTag();&quot;</span>
<a href="#l11.355"></a><span id="l11.355" class="difflineplus">+                     onselect=&quot;gGeneralPane.onSelectTag();&quot;/&gt;</span>
<a href="#l11.356"></a><span id="l11.356" class="difflineplus">+        &lt;vbox id=&quot;tagButtons&quot;&gt;</span>
<a href="#l11.357"></a><span id="l11.357" class="difflineplus">+          &lt;button label=&quot;&amp;newTagButton.label;&quot; accesskey=&quot;&amp;newTagButton.accesskey;&quot;</span>
<a href="#l11.358"></a><span id="l11.358" class="difflineplus">+                  oncommand=&quot;gGeneralPane.addTag();&quot;/&gt;</span>
<a href="#l11.359"></a><span id="l11.359" class="difflineplus">+          &lt;button id=&quot;editTagButton&quot; disabled=&quot;true&quot;</span>
<a href="#l11.360"></a><span id="l11.360" class="difflineplus">+                  label=&quot;&amp;editTagButton1.label;&quot;</span>
<a href="#l11.361"></a><span id="l11.361" class="difflineplus">+                  accesskey=&quot;&amp;editTagButton1.accesskey;&quot;</span>
<a href="#l11.362"></a><span id="l11.362" class="difflineplus">+                  oncommand=&quot;gGeneralPane.editTag();&quot;/&gt;</span>
<a href="#l11.363"></a><span id="l11.363" class="difflineplus">+          &lt;button id=&quot;removeTagButton&quot; disabled=&quot;true&quot;</span>
<a href="#l11.364"></a><span id="l11.364" class="difflineplus">+                  label=&quot;&amp;removeTagButton.label;&quot;</span>
<a href="#l11.365"></a><span id="l11.365" class="difflineplus">+                  accesskey=&quot;&amp;removeTagButton.accesskey;&quot;</span>
<a href="#l11.366"></a><span id="l11.366" class="difflineplus">+                  oncommand=&quot;gGeneralPane.removeTag();&quot;/&gt;</span>
<a href="#l11.367"></a><span id="l11.367" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l11.368"></a><span id="l11.368" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.369"></a><span id="l11.369" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.370"></a><span id="l11.370" class="difflineplus">+</span>
<a href="#l11.371"></a><span id="l11.371" class="difflineplus">+</span>
<a href="#l11.372"></a><span id="l11.372" class="difflineplus">+    &lt;hbox id=&quot;readingAndDisplayCategory&quot;</span>
<a href="#l11.373"></a><span id="l11.373" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.374"></a><span id="l11.374" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.375"></a><span id="l11.375" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;general-reading-and-display-header&quot;/&gt;</span>
<a href="#l11.376"></a><span id="l11.376" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.377"></a><span id="l11.377" class="difflineplus">+</span>
<a href="#l11.378"></a><span id="l11.378" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.379"></a><span id="l11.379" class="difflineplus">+      &lt;vbox&gt;</span>
<a href="#l11.380"></a><span id="l11.380" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.381"></a><span id="l11.381" class="difflineplus">+          &lt;checkbox id=&quot;automaticallyMarkAsRead&quot;</span>
<a href="#l11.382"></a><span id="l11.382" class="difflineplus">+                    preference=&quot;mailnews.mark_message_read.auto&quot;</span>
<a href="#l11.383"></a><span id="l11.383" class="difflineplus">+                    label=&quot;&amp;autoMarkAsRead.label;&quot;</span>
<a href="#l11.384"></a><span id="l11.384" class="difflineplus">+                    accesskey=&quot;&amp;autoMarkAsRead.accesskey;&quot;/&gt;</span>
<a href="#l11.385"></a><span id="l11.385" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.386"></a><span id="l11.386" class="difflineplus">+</span>
<a href="#l11.387"></a><span id="l11.387" class="difflineplus">+        &lt;radiogroup id=&quot;markAsReadAutoPreferences&quot; orient=&quot;vertical&quot;</span>
<a href="#l11.388"></a><span id="l11.388" class="difflineplus">+                    class=&quot;indent&quot;</span>
<a href="#l11.389"></a><span id="l11.389" class="difflineplus">+                    align=&quot;start&quot;</span>
<a href="#l11.390"></a><span id="l11.390" class="difflineplus">+                    preference=&quot;mailnews.mark_message_read.delay&quot;&gt;</span>
<a href="#l11.391"></a><span id="l11.391" class="difflineplus">+          &lt;radio id=&quot;mark_read_immediately&quot;</span>
<a href="#l11.392"></a><span id="l11.392" class="difflineplus">+                 label=&quot;&amp;markAsReadNoDelay.label;&quot;</span>
<a href="#l11.393"></a><span id="l11.393" class="difflineplus">+                 value=&quot;false&quot;</span>
<a href="#l11.394"></a><span id="l11.394" class="difflineplus">+                 accesskey=&quot;&amp;markAsReadNoDelay.accesskey;&quot;/&gt;</span>
<a href="#l11.395"></a><span id="l11.395" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.396"></a><span id="l11.396" class="difflineplus">+            &lt;radio id=&quot;markAsReadAfterDelay&quot; value=&quot;true&quot;</span>
<a href="#l11.397"></a><span id="l11.397" class="difflineplus">+                   label=&quot;&amp;markAsReadDelay.label;&quot;</span>
<a href="#l11.398"></a><span id="l11.398" class="difflineplus">+                   accesskey=&quot;&amp;markAsReadDelay.accesskey;&quot;/&gt;</span>
<a href="#l11.399"></a><span id="l11.399" class="difflineplus">+            &lt;html:input id=&quot;markAsReadDelay&quot; type=&quot;number&quot; class=&quot;size3&quot;</span>
<a href="#l11.400"></a><span id="l11.400" class="difflineplus">+                        min=&quot;1&quot; max=&quot;2147483&quot;</span>
<a href="#l11.401"></a><span id="l11.401" class="difflineplus">+                        preference=&quot;mailnews.mark_message_read.delay.interval&quot;</span>
<a href="#l11.402"></a><span id="l11.402" class="difflineplus">+                        aria-labelledby=&quot;markAsReadAfterDelay markAsReadDelay secondsLabel&quot;/&gt;</span>
<a href="#l11.403"></a><span id="l11.403" class="difflineplus">+            &lt;label id=&quot;secondsLabel&quot; value=&quot;&amp;secondsLabel.label;&quot;/&gt;</span>
<a href="#l11.404"></a><span id="l11.404" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.405"></a><span id="l11.405" class="difflineplus">+        &lt;/radiogroup&gt;</span>
<a href="#l11.406"></a><span id="l11.406" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.407"></a><span id="l11.407" class="difflineplus">+</span>
<a href="#l11.408"></a><span id="l11.408" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l11.409"></a><span id="l11.409" class="difflineplus">+</span>
<a href="#l11.410"></a><span id="l11.410" class="difflineplus">+      &lt;vbox&gt;</span>
<a href="#l11.411"></a><span id="l11.411" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.412"></a><span id="l11.412" class="difflineplus">+          &lt;label value=&quot;&amp;openMsgIn.label;&quot;</span>
<a href="#l11.413"></a><span id="l11.413" class="difflineplus">+                 control=&quot;mailOpenMessageBehavior&quot;/&gt;</span>
<a href="#l11.414"></a><span id="l11.414" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.415"></a><span id="l11.415" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.416"></a><span id="l11.416" class="difflineplus">+          &lt;radiogroup id=&quot;mailOpenMessageBehavior&quot; class=&quot;indent&quot;</span>
<a href="#l11.417"></a><span id="l11.417" class="difflineplus">+                      preference=&quot;mail.openMessageBehavior&quot;</span>
<a href="#l11.418"></a><span id="l11.418" class="difflineplus">+                      orient=&quot;horizontal&quot;&gt;</span>
<a href="#l11.419"></a><span id="l11.419" class="difflineplus">+            &lt;radio id=&quot;newTab&quot; value=&quot;2&quot; label=&quot;&amp;openMsgInNewTab.label;&quot;</span>
<a href="#l11.420"></a><span id="l11.420" class="difflineplus">+                   accesskey=&quot;&amp;openMsgInNewTab.accesskey;&quot;/&gt;</span>
<a href="#l11.421"></a><span id="l11.421" class="difflineplus">+            &lt;radio id=&quot;newWindow&quot; value=&quot;0&quot; label=&quot;&amp;reuseExpRadio0.label;&quot;</span>
<a href="#l11.422"></a><span id="l11.422" class="difflineplus">+                   accesskey=&quot;&amp;reuseExpRadio0.accesskey;&quot;/&gt;</span>
<a href="#l11.423"></a><span id="l11.423" class="difflineplus">+            &lt;radio id=&quot;existingWindow&quot; value=&quot;1&quot;</span>
<a href="#l11.424"></a><span id="l11.424" class="difflineplus">+                   label=&quot;&amp;reuseExpRadio1.label;&quot;</span>
<a href="#l11.425"></a><span id="l11.425" class="difflineplus">+                   accesskey=&quot;&amp;reuseExpRadio1.accesskey;&quot;/&gt;</span>
<a href="#l11.426"></a><span id="l11.426" class="difflineplus">+          &lt;/radiogroup&gt;</span>
<a href="#l11.427"></a><span id="l11.427" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.428"></a><span id="l11.428" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.429"></a><span id="l11.429" class="difflineplus">+          &lt;checkbox id=&quot;closeMsgOnMoveOrDelete&quot;</span>
<a href="#l11.430"></a><span id="l11.430" class="difflineplus">+                    label=&quot;&amp;closeMsgOnMoveOrDelete.label;&quot;</span>
<a href="#l11.431"></a><span id="l11.431" class="difflineplus">+                    accesskey=&quot;&amp;closeMsgOnMoveOrDelete.accesskey;&quot;</span>
<a href="#l11.432"></a><span id="l11.432" class="difflineplus">+                    preference=&quot;mail.close_message_window.on_delete&quot;/&gt;</span>
<a href="#l11.433"></a><span id="l11.433" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.434"></a><span id="l11.434" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.435"></a><span id="l11.435" class="difflineplus">+</span>
<a href="#l11.436"></a><span id="l11.436" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l11.437"></a><span id="l11.437" class="difflineplus">+</span>
<a href="#l11.438"></a><span id="l11.438" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.439"></a><span id="l11.439" class="difflineplus">+        &lt;label value=&quot;&amp;displayName.label;&quot;/&gt;</span>
<a href="#l11.440"></a><span id="l11.440" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.441"></a><span id="l11.441" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.442"></a><span id="l11.442" class="difflineplus">+        &lt;checkbox id=&quot;showCondensedAddresses&quot;</span>
<a href="#l11.443"></a><span id="l11.443" class="difflineplus">+                  label=&quot;&amp;showCondensedAddresses.label;&quot;</span>
<a href="#l11.444"></a><span id="l11.444" class="difflineplus">+                  accesskey=&quot;&amp;showCondensedAddresses.accesskey;&quot;</span>
<a href="#l11.445"></a><span id="l11.445" class="difflineplus">+                  preference=&quot;mail.showCondensedAddresses&quot;/&gt;</span>
<a href="#l11.446"></a><span id="l11.446" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.447"></a><span id="l11.447" class="difflineplus">+</span>
<a href="#l11.448"></a><span id="l11.448" class="difflineplus">+      &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l11.449"></a><span id="l11.449" class="difflineplus">+</span>
<a href="#l11.450"></a><span id="l11.450" class="difflineplus">+      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.451"></a><span id="l11.451" class="difflineplus">+        &lt;description flex=&quot;1&quot;&gt;&amp;returnReceiptsInfo.label;&lt;/description&gt;</span>
<a href="#l11.452"></a><span id="l11.452" class="difflineplus">+        &lt;button id=&quot;showReturnReceipts&quot;</span>
<a href="#l11.453"></a><span id="l11.453" class="difflineplus">+                label=&quot;&amp;showReturnReceipts.label;&quot;</span>
<a href="#l11.454"></a><span id="l11.454" class="difflineplus">+                accesskey=&quot;&amp;showReturnReceipts.accesskey;&quot;</span>
<a href="#l11.455"></a><span id="l11.455" class="difflineplus">+                oncommand=&quot;gGeneralPane.showReturnReceipts();&quot;/&gt;</span>
<a href="#l11.456"></a><span id="l11.456" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.457"></a><span id="l11.457" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.458"></a><span id="l11.458" class="difflineplus">+</span>
<a href="#l11.459"></a><span id="l11.459" class="difflineplus">+#ifdef MOZ_UPDATER</span>
<a href="#l11.460"></a><span id="l11.460" class="difflineplus">+    &lt;hbox id=&quot;updatesCategory&quot;</span>
<a href="#l11.461"></a><span id="l11.461" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.462"></a><span id="l11.462" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.463"></a><span id="l11.463" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;general-updates-header&quot;/&gt;</span>
<a href="#l11.464"></a><span id="l11.464" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.465"></a><span id="l11.465" class="difflineplus">+</span>
<a href="#l11.466"></a><span id="l11.466" class="difflineplus">+    &lt;!-- Update --&gt;</span>
<a href="#l11.467"></a><span id="l11.467" class="difflineplus">+    &lt;groupbox id=&quot;updateApp&quot; data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.468"></a><span id="l11.468" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;updateApp2.label;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.469"></a><span id="l11.469" class="difflineplus">+      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.470"></a><span id="l11.470" class="difflineplus">+        &lt;vbox&gt;</span>
<a href="#l11.471"></a><span id="l11.471" class="difflineplus">+          &lt;description&gt;</span>
<a href="#l11.472"></a><span id="l11.472" class="difflineplus">+            &amp;updateApp.version.pre;&lt;label id=&quot;version&quot;/&gt;&amp;updateApp.version.post;</span>
<a href="#l11.473"></a><span id="l11.473" class="difflineplus">+            &lt;label is=&quot;text-link&quot; id=&quot;releasenotes&quot; hidden=&quot;true&quot;&gt;&amp;releaseNotes.link;&lt;/label&gt;</span>
<a href="#l11.474"></a><span id="l11.474" class="difflineplus">+          &lt;/description&gt;</span>
<a href="#l11.475"></a><span id="l11.475" class="difflineplus">+          &lt;description id=&quot;distribution&quot; class=&quot;text-blurb&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l11.476"></a><span id="l11.476" class="difflineplus">+          &lt;description id=&quot;distributionId&quot; class=&quot;text-blurb&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l11.477"></a><span id="l11.477" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l11.478"></a><span id="l11.478" class="difflineplus">+        &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.479"></a><span id="l11.479" class="difflineplus">+        &lt;vbox&gt;</span>
<a href="#l11.480"></a><span id="l11.480" class="difflineplus">+          &lt;button id=&quot;showUpdateHistory&quot;</span>
<a href="#l11.481"></a><span id="l11.481" class="difflineplus">+                  label=&quot;&amp;updateHistory.label;&quot;</span>
<a href="#l11.482"></a><span id="l11.482" class="difflineplus">+                  accesskey=&quot;&amp;updateHistory.accesskey;&quot;</span>
<a href="#l11.483"></a><span id="l11.483" class="difflineplus">+                  preference=&quot;app.update.disable_button.showUpdateHistory&quot;</span>
<a href="#l11.484"></a><span id="l11.484" class="difflineplus">+                  oncommand=&quot;gGeneralPane.showUpdates();&quot;/&gt;</span>
<a href="#l11.485"></a><span id="l11.485" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l11.486"></a><span id="l11.486" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.487"></a><span id="l11.487" class="difflineplus">+      &lt;vbox id=&quot;updateBox&quot;&gt;</span>
<a href="#l11.488"></a><span id="l11.488" class="difflineplus">+        &lt;deck id=&quot;updateDeck&quot; orient=&quot;vertical&quot;&gt;</span>
<a href="#l11.489"></a><span id="l11.489" class="difflineplus">+          &lt;hbox id=&quot;checkForUpdates&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.490"></a><span id="l11.490" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.491"></a><span id="l11.491" class="difflineplus">+            &lt;button id=&quot;checkForUpdatesButton&quot; align=&quot;start&quot;</span>
<a href="#l11.492"></a><span id="l11.492" class="difflineplus">+                    label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l11.493"></a><span id="l11.493" class="difflineplus">+                    accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l11.494"></a><span id="l11.494" class="difflineplus">+                    oncommand=&quot;gAppUpdater.checkForUpdates();&quot;/&gt;</span>
<a href="#l11.495"></a><span id="l11.495" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.496"></a><span id="l11.496" class="difflineplus">+          &lt;hbox id=&quot;downloadAndInstall&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.497"></a><span id="l11.497" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.498"></a><span id="l11.498" class="difflineplus">+            &lt;button id=&quot;downloadAndInstallButton&quot;</span>
<a href="#l11.499"></a><span id="l11.499" class="difflineplus">+                    oncommand=&quot;gAppUpdater.startDownload();&quot;/&gt;</span>
<a href="#l11.500"></a><span id="l11.500" class="difflineplus">+                    &lt;!-- label and accesskey will be filled by JS --&gt;</span>
<a href="#l11.501"></a><span id="l11.501" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.502"></a><span id="l11.502" class="difflineplus">+          &lt;hbox id=&quot;apply&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.503"></a><span id="l11.503" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.504"></a><span id="l11.504" class="difflineplus">+            &lt;button id=&quot;updateButton&quot;</span>
<a href="#l11.505"></a><span id="l11.505" class="difflineplus">+                    label=&quot;&amp;update.updateButton.label3;&quot;</span>
<a href="#l11.506"></a><span id="l11.506" class="difflineplus">+                    accesskey=&quot;&amp;update.updateButton.accesskey;&quot;</span>
<a href="#l11.507"></a><span id="l11.507" class="difflineplus">+                    oncommand=&quot;gAppUpdater.buttonRestartAfterDownload();&quot;/&gt;</span>
<a href="#l11.508"></a><span id="l11.508" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.509"></a><span id="l11.509" class="difflineplus">+          &lt;hbox id=&quot;checkingForUpdates&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.510"></a><span id="l11.510" class="difflineplus">+            &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.checkingForUpdates;&lt;/label&gt;</span>
<a href="#l11.511"></a><span id="l11.511" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.512"></a><span id="l11.512" class="difflineplus">+            &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l11.513"></a><span id="l11.513" class="difflineplus">+                    accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l11.514"></a><span id="l11.514" class="difflineplus">+                    disabled=&quot;true&quot;/&gt;</span>
<a href="#l11.515"></a><span id="l11.515" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.516"></a><span id="l11.516" class="difflineplus">+          &lt;hbox id=&quot;downloading&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.517"></a><span id="l11.517" class="difflineplus">+            &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.downloading.start;&lt;/label&gt;</span>
<a href="#l11.518"></a><span id="l11.518" class="difflineplus">+            &lt;label id=&quot;downloadStatus&quot;/&gt;&lt;label&gt;&amp;update.downloading.end;&lt;/label&gt;</span>
<a href="#l11.519"></a><span id="l11.519" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.520"></a><span id="l11.520" class="difflineplus">+          &lt;hbox id=&quot;applying&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.521"></a><span id="l11.521" class="difflineplus">+            &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.applying;&lt;/label&gt;</span>
<a href="#l11.522"></a><span id="l11.522" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.523"></a><span id="l11.523" class="difflineplus">+         &lt;hbox id=&quot;downloadFailed&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.524"></a><span id="l11.524" class="difflineplus">+            &lt;label&gt;&amp;update.failed.start;&lt;/label&gt;</span>
<a href="#l11.525"></a><span id="l11.525" class="difflineplus">+            &lt;label is=&quot;text-link&quot; id=&quot;failedLink&quot;&gt;&amp;update.failed.linkText;&lt;/label&gt;</span>
<a href="#l11.526"></a><span id="l11.526" class="difflineplus">+            &lt;label&gt;&amp;update.failed.end;&lt;/label&gt;</span>
<a href="#l11.527"></a><span id="l11.527" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.528"></a><span id="l11.528" class="difflineplus">+            &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l11.529"></a><span id="l11.529" class="difflineplus">+                    accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l11.530"></a><span id="l11.530" class="difflineplus">+                    oncommand=&quot;gAppUpdater.checkForUpdates();&quot;/&gt;</span>
<a href="#l11.531"></a><span id="l11.531" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.532"></a><span id="l11.532" class="difflineplus">+          &lt;hbox id=&quot;policyDisabled&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.533"></a><span id="l11.533" class="difflineplus">+            &lt;label&gt;&amp;update.adminDisabled;&lt;/label&gt;</span>
<a href="#l11.534"></a><span id="l11.534" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.535"></a><span id="l11.535" class="difflineplus">+          &lt;hbox id=&quot;noUpdatesFound&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.536"></a><span id="l11.536" class="difflineplus">+            &lt;label&gt;&amp;update.noUpdatesFound;&lt;/label&gt;</span>
<a href="#l11.537"></a><span id="l11.537" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.538"></a><span id="l11.538" class="difflineplus">+            &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l11.539"></a><span id="l11.539" class="difflineplus">+                    accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l11.540"></a><span id="l11.540" class="difflineplus">+                    oncommand=&quot;gAppUpdater.checkForUpdates();&quot;/&gt;</span>
<a href="#l11.541"></a><span id="l11.541" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.542"></a><span id="l11.542" class="difflineplus">+          &lt;hbox id=&quot;otherInstanceHandlingUpdates&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.543"></a><span id="l11.543" class="difflineplus">+            &lt;label&gt;&amp;update.otherInstanceHandlingUpdates;&lt;/label&gt;</span>
<a href="#l11.544"></a><span id="l11.544" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.545"></a><span id="l11.545" class="difflineplus">+          &lt;hbox id=&quot;manualUpdate&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.546"></a><span id="l11.546" class="difflineplus">+            &lt;label&gt;&amp;update.manual.start;&lt;/label&gt;&lt;label is=&quot;text-link&quot; id=&quot;manualLink&quot;&gt;</span>
<a href="#l11.547"></a><span id="l11.547" class="difflineplus">+              &amp;update.manual.linkText;</span>
<a href="#l11.548"></a><span id="l11.548" class="difflineplus">+            &lt;/label&gt;</span>
<a href="#l11.549"></a><span id="l11.549" class="difflineplus">+            &lt;label&gt;&amp;update.manual.end;&lt;/label&gt;</span>
<a href="#l11.550"></a><span id="l11.550" class="difflineplus">+            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l11.551"></a><span id="l11.551" class="difflineplus">+            &lt;button label=&quot;&amp;update.checkForUpdatesButton.label;&quot;</span>
<a href="#l11.552"></a><span id="l11.552" class="difflineplus">+                    accesskey=&quot;&amp;update.checkForUpdatesButton.accesskey;&quot;</span>
<a href="#l11.553"></a><span id="l11.553" class="difflineplus">+                    disabled=&quot;true&quot;/&gt;</span>
<a href="#l11.554"></a><span id="l11.554" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.555"></a><span id="l11.555" class="difflineplus">+          &lt;hbox id=&quot;unsupportedSystem&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.556"></a><span id="l11.556" class="difflineplus">+            &lt;label&gt;&amp;update.unsupported.start;&lt;/label&gt;</span>
<a href="#l11.557"></a><span id="l11.557" class="difflineplus">+            &lt;label is=&quot;text-link&quot; id=&quot;unsupportedLink&quot;&gt;&amp;update.unsupported.linkText;&lt;/label&gt;</span>
<a href="#l11.558"></a><span id="l11.558" class="difflineplus">+            &lt;label&gt;&amp;update.unsupported.end;&lt;/label&gt;</span>
<a href="#l11.559"></a><span id="l11.559" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.560"></a><span id="l11.560" class="difflineplus">+          &lt;hbox id=&quot;restarting&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.561"></a><span id="l11.561" class="difflineplus">+            &lt;image class=&quot;update-throbber&quot;/&gt;&lt;label&gt;&amp;update.restarting;&lt;/label&gt;</span>
<a href="#l11.562"></a><span id="l11.562" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.563"></a><span id="l11.563" class="difflineplus">+        &lt;/deck&gt;</span>
<a href="#l11.564"></a><span id="l11.564" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.565"></a><span id="l11.565" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l11.566"></a><span id="l11.566" class="difflineplus">+      &lt;description id=&quot;updateAllowDescription&quot;&gt;&amp;updateAppAllow.description;&lt;/description&gt;</span>
<a href="#l11.567"></a><span id="l11.567" class="difflineplus">+      &lt;vbox id=&quot;updateSettingsContainer&quot;&gt;</span>
<a href="#l11.568"></a><span id="l11.568" class="difflineplus">+        &lt;radiogroup id=&quot;updateRadioGroup&quot;</span>
<a href="#l11.569"></a><span id="l11.569" class="difflineplus">+                    align=&quot;start&quot;&gt;</span>
<a href="#l11.570"></a><span id="l11.570" class="difflineplus">+          &lt;radio id=&quot;autoDesktop&quot;</span>
<a href="#l11.571"></a><span id="l11.571" class="difflineplus">+                 value=&quot;true&quot;</span>
<a href="#l11.572"></a><span id="l11.572" class="difflineplus">+                 label=&quot;&amp;updateAuto.label;&quot;</span>
<a href="#l11.573"></a><span id="l11.573" class="difflineplus">+                 accesskey=&quot;&amp;updateAuto.accesskey;&quot;/&gt;</span>
<a href="#l11.574"></a><span id="l11.574" class="difflineplus">+          &lt;radio id=&quot;manualDesktop&quot;</span>
<a href="#l11.575"></a><span id="l11.575" class="difflineplus">+                 value=&quot;false&quot;</span>
<a href="#l11.576"></a><span id="l11.576" class="difflineplus">+                 label=&quot;&amp;updateCheck.label;&quot;</span>
<a href="#l11.577"></a><span id="l11.577" class="difflineplus">+                 accesskey=&quot;&amp;updateCheck.accesskey;&quot;/&gt;</span>
<a href="#l11.578"></a><span id="l11.578" class="difflineplus">+        &lt;/radiogroup&gt;</span>
<a href="#l11.579"></a><span id="l11.579" class="difflineplus">+        &lt;description id=&quot;updateSettingCrossUserWarning&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l11.580"></a><span id="l11.580" class="difflineplus">+          &amp;updateCrossUserSettingWarning.description;</span>
<a href="#l11.581"></a><span id="l11.581" class="difflineplus">+        &lt;/description&gt;</span>
<a href="#l11.582"></a><span id="l11.582" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.583"></a><span id="l11.583" class="difflineplus">+</span>
<a href="#l11.584"></a><span id="l11.584" class="difflineplus">+#ifdef MOZ_MAINTENANCE_SERVICE</span>
<a href="#l11.585"></a><span id="l11.585" class="difflineplus">+      &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l11.586"></a><span id="l11.586" class="difflineplus">+      &lt;checkbox id=&quot;useService&quot;</span>
<a href="#l11.587"></a><span id="l11.587" class="difflineplus">+                label=&quot;&amp;useService.label;&quot;</span>
<a href="#l11.588"></a><span id="l11.588" class="difflineplus">+                accesskey=&quot;&amp;useService.accesskey;&quot;</span>
<a href="#l11.589"></a><span id="l11.589" class="difflineplus">+                preference=&quot;app.update.service.enabled&quot;/&gt;</span>
<a href="#l11.590"></a><span id="l11.590" class="difflineplus">+#endif</span>
<a href="#l11.591"></a><span id="l11.591" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.592"></a><span id="l11.592" class="difflineplus">+#endif</span>
<a href="#l11.593"></a><span id="l11.593" class="difflineplus">+</span>
<a href="#l11.594"></a><span id="l11.594" class="difflineplus">+    &lt;hbox id=&quot;networkAndDiskspaceCategory&quot;</span>
<a href="#l11.595"></a><span id="l11.595" class="difflineplus">+          class=&quot;subcategory&quot;</span>
<a href="#l11.596"></a><span id="l11.596" class="difflineplus">+          data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.597"></a><span id="l11.597" class="difflineplus">+      &lt;html:h1 data-l10n-id=&quot;general-network-and-diskspace-header&quot;/&gt;</span>
<a href="#l11.598"></a><span id="l11.598" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l11.599"></a><span id="l11.599" class="difflineplus">+</span>
<a href="#l11.600"></a><span id="l11.600" class="difflineplus">+    &lt;!-- Networking &amp; Disk Space --&gt;</span>
<a href="#l11.601"></a><span id="l11.601" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.602"></a><span id="l11.602" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;connectionsInfo.caption;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.603"></a><span id="l11.603" class="difflineplus">+      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.604"></a><span id="l11.604" class="difflineplus">+        &lt;description flex=&quot;1&quot; control=&quot;catProxiesButton&quot;&gt;&amp;proxiesConfigure.label;&lt;/description&gt;</span>
<a href="#l11.605"></a><span id="l11.605" class="difflineplus">+        &lt;button id=&quot;catProxiesButton&quot; icon=&quot;network&quot; label=&quot;&amp;showSettings.label;&quot;</span>
<a href="#l11.606"></a><span id="l11.606" class="difflineplus">+                accesskey=&quot;&amp;showSettings.accesskey;&quot;</span>
<a href="#l11.607"></a><span id="l11.607" class="difflineplus">+                oncommand=&quot;gGeneralPane.showConnections();&quot;/&gt;</span>
<a href="#l11.608"></a><span id="l11.608" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.609"></a><span id="l11.609" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.610"></a><span id="l11.610" class="difflineplus">+</span>
<a href="#l11.611"></a><span id="l11.611" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.612"></a><span id="l11.612" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;offlineInfo.caption;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.613"></a><span id="l11.613" class="difflineplus">+      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.614"></a><span id="l11.614" class="difflineplus">+        &lt;description flex=&quot;1&quot; control=&quot;offlineSettingsButton&quot;&gt;&amp;offlineInfo.label;&lt;/description&gt;</span>
<a href="#l11.615"></a><span id="l11.615" class="difflineplus">+        &lt;button id=&quot;offlineSettingsButton&quot; label=&quot;&amp;showOffline.label;&quot;</span>
<a href="#l11.616"></a><span id="l11.616" class="difflineplus">+                accesskey=&quot;&amp;showOffline.accesskey;&quot;</span>
<a href="#l11.617"></a><span id="l11.617" class="difflineplus">+                oncommand=&quot;gGeneralPane.showOffline();&quot;/&gt;</span>
<a href="#l11.618"></a><span id="l11.618" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.619"></a><span id="l11.619" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.620"></a><span id="l11.620" class="difflineplus">+</span>
<a href="#l11.621"></a><span id="l11.621" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.622"></a><span id="l11.622" class="difflineplus">+      &lt;label&gt;&lt;html:h2&gt;&amp;Diskspace;&lt;/html:h2&gt;&lt;/label&gt;</span>
<a href="#l11.623"></a><span id="l11.623" class="difflineplus">+      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.624"></a><span id="l11.624" class="difflineplus">+        &lt;label id=&quot;actualDiskCacheSize&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l11.625"></a><span id="l11.625" class="difflineplus">+        &lt;button id=&quot;clearCacheButton&quot; icon=&quot;clear&quot;</span>
<a href="#l11.626"></a><span id="l11.626" class="difflineplus">+                label=&quot;&amp;clearCacheNow.label;&quot; accesskey=&quot;&amp;clearCacheNow.accesskey;&quot;</span>
<a href="#l11.627"></a><span id="l11.627" class="difflineplus">+                oncommand=&quot;gGeneralPane.clearCache();&quot;/&gt;</span>
<a href="#l11.628"></a><span id="l11.628" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.629"></a><span id="l11.629" class="difflineplus">+      &lt;hbox&gt;</span>
<a href="#l11.630"></a><span id="l11.630" class="difflineplus">+        &lt;checkbox preference=&quot;browser.cache.disk.smart_size.enabled&quot;</span>
<a href="#l11.631"></a><span id="l11.631" class="difflineplus">+                  id=&quot;allowSmartSize&quot;</span>
<a href="#l11.632"></a><span id="l11.632" class="difflineplus">+                  label=&quot;&amp;overrideSmartCacheSize.label;&quot;</span>
<a href="#l11.633"></a><span id="l11.633" class="difflineplus">+                  accesskey=&quot;&amp;overrideSmartCacheSize.accesskey;&quot;/&gt;</span>
<a href="#l11.634"></a><span id="l11.634" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.635"></a><span id="l11.635" class="difflineplus">+      &lt;hbox align=&quot;center&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l11.636"></a><span id="l11.636" class="difflineplus">+        &lt;label id=&quot;useCacheBefore&quot; control=&quot;cacheSize&quot;</span>
<a href="#l11.637"></a><span id="l11.637" class="difflineplus">+               accesskey=&quot;&amp;useCacheBefore.accesskey;&quot; value=&quot;&amp;useCacheBefore.label;&quot;/&gt;</span>
<a href="#l11.638"></a><span id="l11.638" class="difflineplus">+        &lt;html:input id=&quot;cacheSize&quot; type=&quot;number&quot; class=&quot;size4&quot; max=&quot;1024&quot;</span>
<a href="#l11.639"></a><span id="l11.639" class="difflineplus">+                    preference=&quot;browser.cache.disk.capacity&quot;</span>
<a href="#l11.640"></a><span id="l11.640" class="difflineplus">+                    aria-labelledby=&quot;useCacheBefore cacheSize useCacheAfter&quot;/&gt;</span>
<a href="#l11.641"></a><span id="l11.641" class="difflineplus">+        &lt;label id=&quot;useCacheAfter&quot; flex=&quot;1&quot;&gt;&amp;useCacheAfter.label;&lt;/label&gt;</span>
<a href="#l11.642"></a><span id="l11.642" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.643"></a><span id="l11.643" class="difflineplus">+      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.644"></a><span id="l11.644" class="difflineplus">+          &lt;checkbox id=&quot;offlineCompactFolder&quot;</span>
<a href="#l11.645"></a><span id="l11.645" class="difflineplus">+                    label=&quot;&amp;offlineCompactFolders.label;&quot;</span>
<a href="#l11.646"></a><span id="l11.646" class="difflineplus">+                    accesskey=&quot;&amp;offlineCompactFolders.accesskey;&quot;</span>
<a href="#l11.647"></a><span id="l11.647" class="difflineplus">+                    aria-labelledby=&quot;offlineCompactFolder offlineCompactFolderMin compactFolderMB&quot;</span>
<a href="#l11.648"></a><span id="l11.648" class="difflineplus">+                    preference=&quot;mail.prompt_purge_threshhold&quot;</span>
<a href="#l11.649"></a><span id="l11.649" class="difflineplus">+                    oncommand=&quot;gGeneralPane.updateCompactOptions(this.checked);&quot;/&gt;</span>
<a href="#l11.650"></a><span id="l11.650" class="difflineplus">+          &lt;html:input id=&quot;offlineCompactFolderMin&quot; type=&quot;number&quot; class=&quot;size4&quot;</span>
<a href="#l11.651"></a><span id="l11.651" class="difflineplus">+                      min=&quot;1&quot; max=&quot;2048&quot; value=&quot;200&quot;</span>
<a href="#l11.652"></a><span id="l11.652" class="difflineplus">+                      preference=&quot;mail.purge_threshhold_mb&quot;</span>
<a href="#l11.653"></a><span id="l11.653" class="difflineplus">+                      aria-labelledby=&quot;offlineCompactFolder offlineCompactFolderMin compactFolderMB&quot;/&gt;</span>
<a href="#l11.654"></a><span id="l11.654" class="difflineplus">+          &lt;label id=&quot;compactFolderMB&quot; value=&quot;&amp;offlineCompactFoldersMB.label;&quot;/&gt;</span>
<a href="#l11.655"></a><span id="l11.655" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.656"></a><span id="l11.656" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.657"></a><span id="l11.657" class="difflineplus">+</span>
<a href="#l11.658"></a><span id="l11.658" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.659"></a><span id="l11.659" class="difflineplus">+      &lt;label&gt;&lt;html:h2 data-l10n-id=&quot;general-indexing-label&quot;/&gt;&lt;/label&gt;</span>
<a href="#l11.660"></a><span id="l11.660" class="difflineplus">+      &lt;vbox&gt;</span>
<a href="#l11.661"></a><span id="l11.661" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.662"></a><span id="l11.662" class="difflineplus">+          &lt;checkbox id=&quot;enableGloda&quot;</span>
<a href="#l11.663"></a><span id="l11.663" class="difflineplus">+                    preference=&quot;mailnews.database.global.indexer.enabled&quot;</span>
<a href="#l11.664"></a><span id="l11.664" class="difflineplus">+                    label=&quot;&amp;enableGlodaSearch.label;&quot;</span>
<a href="#l11.665"></a><span id="l11.665" class="difflineplus">+                    accesskey=&quot;&amp;enableGlodaSearch.accesskey;&quot;/&gt;</span>
<a href="#l11.666"></a><span id="l11.666" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.667"></a><span id="l11.667" class="difflineplus">+        &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.668"></a><span id="l11.668" class="difflineplus">+          &lt;label value=&quot;&amp;storeType.label;&quot;</span>
<a href="#l11.669"></a><span id="l11.669" class="difflineplus">+                 accesskey=&quot;&amp;storeType.accesskey;&quot;</span>
<a href="#l11.670"></a><span id="l11.670" class="difflineplus">+                 control=&quot;storeTypeMenulist&quot;/&gt;</span>
<a href="#l11.671"></a><span id="l11.671" class="difflineplus">+          &lt;menulist id=&quot;storeTypeMenulist&quot;</span>
<a href="#l11.672"></a><span id="l11.672" class="difflineplus">+                    oncommand=&quot;gGeneralPane.updateDefaultStore(this.selectedItem.value)&quot;&gt;</span>
<a href="#l11.673"></a><span id="l11.673" class="difflineplus">+            &lt;menupopup id=&quot;storeTypeMenupopup&quot;&gt;</span>
<a href="#l11.674"></a><span id="l11.674" class="difflineplus">+              &lt;menuitem id=&quot;mboxStore&quot;</span>
<a href="#l11.675"></a><span id="l11.675" class="difflineplus">+                        label=&quot;&amp;mboxStore2.label;&quot;</span>
<a href="#l11.676"></a><span id="l11.676" class="difflineplus">+                        value=&quot;@mozilla.org/msgstore/berkeleystore;1&quot;/&gt;</span>
<a href="#l11.677"></a><span id="l11.677" class="difflineplus">+              &lt;menuitem id=&quot;maildirStore&quot;</span>
<a href="#l11.678"></a><span id="l11.678" class="difflineplus">+                        label=&quot;&amp;maildirStore.label;&quot;</span>
<a href="#l11.679"></a><span id="l11.679" class="difflineplus">+                        value=&quot;@mozilla.org/msgstore/maildirstore;1&quot;/&gt;</span>
<a href="#l11.680"></a><span id="l11.680" class="difflineplus">+            &lt;/menupopup&gt;</span>
<a href="#l11.681"></a><span id="l11.681" class="difflineplus">+          &lt;/menulist&gt;</span>
<a href="#l11.682"></a><span id="l11.682" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.683"></a><span id="l11.683" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.684"></a><span id="l11.684" class="difflineplus">+          &lt;checkbox id=&quot;allowHWAccel&quot;</span>
<a href="#l11.685"></a><span id="l11.685" class="difflineplus">+                    label=&quot;&amp;allowHWAccel.label;&quot;</span>
<a href="#l11.686"></a><span id="l11.686" class="difflineplus">+                    accesskey=&quot;&amp;allowHWAccel.accesskey;&quot;</span>
<a href="#l11.687"></a><span id="l11.687" class="difflineplus">+                    preference=&quot;layers.acceleration.disabled&quot;/&gt;</span>
<a href="#l11.688"></a><span id="l11.688" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.689"></a><span id="l11.689" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.690"></a><span id="l11.690" class="difflineplus">+      &lt;vbox&gt;</span>
<a href="#l11.691"></a><span id="l11.691" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.692"></a><span id="l11.692" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.693"></a><span id="l11.693" class="difflineplus">+</span>
<a href="#l11.694"></a><span id="l11.694" class="difflineplus">+    &lt;separator class=&quot;thin&quot; data-category=&quot;paneGeneral&quot;/&gt;</span>
<a href="#l11.695"></a><span id="l11.695" class="difflineplus">+</span>
<a href="#l11.696"></a><span id="l11.696" class="difflineplus">+    &lt;groupbox data-category=&quot;paneGeneral&quot;&gt;</span>
<a href="#l11.697"></a><span id="l11.697" class="difflineplus">+      &lt;hbox pack=&quot;end&quot;&gt;</span>
<a href="#l11.698"></a><span id="l11.698" class="difflineplus">+        &lt;button id=&quot;configEditor&quot; label=&quot;&amp;configEdit.label;&quot;</span>
<a href="#l11.699"></a><span id="l11.699" class="difflineplus">+                accesskey=&quot;&amp;configEdit.accesskey;&quot;</span>
<a href="#l11.700"></a><span id="l11.700" class="difflineplus">+                oncommand=&quot;gGeneralPane.showConfigEdit();&quot;/&gt;</span>
<a href="#l11.701"></a><span id="l11.701" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.702"></a><span id="l11.702" class="difflineplus">+    &lt;/groupbox&gt;</span>
<a href="#l11.703"></a><span id="l11.703" class="difflineplus">+</span>
<a href="#l11.704"></a><span id="l11.704">   &lt;/prefpane&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/preferences/general.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/preferences/general.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,60 +1,388 @@</span>
<a href="#l12.4"></a><span id="l12.4"> /* -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l12.5"></a><span id="l12.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.7"></a><span id="l12.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9"> &quot;use strict&quot;;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+/* import-globals-from ../../base/content/aboutDialog-appUpdater.js */</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+/* import-globals-from ../../../../toolkit/mozapps/preferences/fontbuilder.js */</span>
<a href="#l12.13"></a><span id="l12.13"> /* import-globals-from preferences.js */</span>
<a href="#l12.14"></a><span id="l12.14"> /* import-globals-from subdialogs.js */</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+// ------------------------------</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+// Constants &amp; Enumeration Values</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+// For CSS. Can be one of &quot;ask&quot;, &quot;save&quot;, or &quot;feed&quot;. If absent, the icon URL</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+// was set by us to a custom handler icon and CSS should not try to override it.</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+var APP_ICON_ATTR_NAME = &quot;appHandlerIcon&quot;;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+var gNodeToObjectMap = new WeakMap();</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineplus">+var {DownloadUtils} = ChromeUtils.import(&quot;resource://gre/modules/DownloadUtils.jsm&quot;);</span>
<a href="#l12.25"></a><span id="l12.25" class="difflineplus">+var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l12.26"></a><span id="l12.26"> var {AppConstants} = ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineplus">+var {L10nRegistry} = ChromeUtils.import(&quot;resource://gre/modules/L10nRegistry.jsm&quot;);</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineplus">+var {Localization} = ChromeUtils.import(&quot;resource://gre/modules/Localization.jsm&quot;);</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineplus">+var {UpdateUtils} = ChromeUtils.import(&quot;resource://gre/modules/UpdateUtils.jsm&quot;);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+var {TagUtils} = ChromeUtils.import(&quot;resource:///modules/TagUtils.jsm&quot;);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+XPCOMUtils.defineLazyServiceGetters(this, {</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+  gHandlerService: [&quot;@mozilla.org/uriloader/handler-service;1&quot;, &quot;nsIHandlerService&quot;],</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  gMIMEService: [&quot;@mozilla.org/mime;1&quot;, &quot;nsIMIMEService&quot;],</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+});</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineplus">+const AUTO_UPDATE_CHANGED_TOPIC = &quot;auto-update-config-change&quot;;</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40"> Preferences.addAll([</span>
<a href="#l12.41"></a><span id="l12.41">   { id: &quot;mail.pane_config.dynamic&quot;, type: &quot;int&quot; },</span>
<a href="#l12.42"></a><span id="l12.42">   { id: &quot;mailnews.reuse_message_window&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.43"></a><span id="l12.43">   { id: &quot;mailnews.start_page.enabled&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.44"></a><span id="l12.44">   { id: &quot;mailnews.start_page.url&quot;, type: &quot;string&quot; },</span>
<a href="#l12.45"></a><span id="l12.45">   { id: &quot;mail.biff.show_tray_icon&quot;, type: &quot;bool&quot;  },</span>
<a href="#l12.46"></a><span id="l12.46">   { id: &quot;mail.biff.play_sound&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.47"></a><span id="l12.47">   { id: &quot;mail.biff.play_sound.type&quot;, type: &quot;int&quot; },</span>
<a href="#l12.48"></a><span id="l12.48">   { id: &quot;mail.biff.play_sound.url&quot;, type: &quot;string&quot; },</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+  { id: &quot;general.autoScroll&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+  { id: &quot;general.smoothScroll&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+  { id: &quot;mail.fixed_width_messages&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+  { id: &quot;mail.quoted_style&quot;, type: &quot;int&quot; },</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+  { id: &quot;mail.quoted_size&quot;, type: &quot;int&quot; },</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+  { id: &quot;mail.citation_color&quot;, type: &quot;string&quot; },</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+  { id: &quot;mail.display_glyph&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+  { id: &quot;font.language.group&quot;, type: &quot;wstring&quot; },</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+  { id: &quot;intl.regional_prefs.use_os_locales&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+  { id: &quot;mailnews.database.global.indexer.enabled&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+  { id: &quot;mailnews.labels.description.1&quot;, type: &quot;wstring&quot; },</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+  { id: &quot;mailnews.labels.color.1&quot;, type: &quot;string&quot; },</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+  { id: &quot;mailnews.labels.description.2&quot;, type: &quot;wstring&quot; },</span>
<a href="#l12.62"></a><span id="l12.62" class="difflineplus">+  { id: &quot;mailnews.labels.color.2&quot;, type: &quot;string&quot; },</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineplus">+  { id: &quot;mailnews.labels.description.3&quot;, type: &quot;wstring&quot; },</span>
<a href="#l12.64"></a><span id="l12.64" class="difflineplus">+  { id: &quot;mailnews.labels.color.3&quot;, type: &quot;string&quot; },</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineplus">+  { id: &quot;mailnews.labels.description.4&quot;, type: &quot;wstring&quot; },</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+  { id: &quot;mailnews.labels.color.4&quot;, type: &quot;string&quot; },</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+  { id: &quot;mailnews.labels.description.5&quot;, type: &quot;wstring&quot; },</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+  { id: &quot;mailnews.labels.color.5&quot;, type: &quot;string&quot; },</span>
<a href="#l12.69"></a><span id="l12.69" class="difflineplus">+  { id: &quot;mail.showCondensedAddresses&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineplus">+  { id: &quot;mailnews.mark_message_read.auto&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+  { id: &quot;mailnews.mark_message_read.delay&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+  { id: &quot;mailnews.mark_message_read.delay.interval&quot;, type: &quot;int&quot; },</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+  { id: &quot;mail.openMessageBehavior&quot;, type: &quot;int&quot; },</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+  { id: &quot;mail.close_message_window.on_delete&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+  { id: &quot;mail.prompt_purge_threshhold&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.76"></a><span id="l12.76" class="difflineplus">+  { id: &quot;mail.purge_threshhold_mb&quot;, type: &quot;int&quot; },</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineplus">+  { id: &quot;browser.cache.disk.capacity&quot;, type: &quot;int&quot; },</span>
<a href="#l12.78"></a><span id="l12.78" class="difflineplus">+  { id: &quot;browser.cache.disk.smart_size.enabled&quot;, inverted: true, type: &quot;bool&quot; },</span>
<a href="#l12.79"></a><span id="l12.79" class="difflineplus">+  { id: &quot;layers.acceleration.disabled&quot;, type: &quot;bool&quot;, inverted: true },</span>
<a href="#l12.80"></a><span id="l12.80" class="difflineplus">+  { id: &quot;searchintegration.enable&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.81"></a><span id="l12.81"> ]);</span>
<a href="#l12.82"></a><span id="l12.82"> if (AppConstants.platform != &quot;macosx&quot;) {</span>
<a href="#l12.83"></a><span id="l12.83">   Preferences.add({ id: &quot;mail.biff.show_alert&quot;, type: &quot;bool&quot; });</span>
<a href="#l12.84"></a><span id="l12.84"> }</span>
<a href="#l12.85"></a><span id="l12.85"> </span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-document.getElementById(&quot;paneGeneral&quot;)</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-        .addEventListener(&quot;paneload&quot;, function() { gGeneralPane.init(); });</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+var ICON_URL_APP = &quot;&quot;;</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+if (AppConstants.MOZ_WIDGET_GTK) {</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineplus">+  ICON_URL_APP = &quot;moz-icon://dummy.exe?size=16&quot;;</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineplus">+} else {</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+  ICON_URL_APP = &quot;chrome://messenger/skin/preferences/application.png&quot;;</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+}</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+if (AppConstants.HAVE_SHELL_SERVICE) {</span>
<a href="#l12.97"></a><span id="l12.97" class="difflineplus">+  Preferences.addAll([</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineplus">+    { id: &quot;mail.shell.checkDefaultClient&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.99"></a><span id="l12.99" class="difflineplus">+    { id: &quot;pref.general.disable_button.default_mail&quot;, type: &quot;bool&quot; },</span>
<a href="#l12.100"></a><span id="l12.100" class="difflineplus">+  ]);</span>
<a href="#l12.101"></a><span id="l12.101" class="difflineplus">+}</span>
<a href="#l12.102"></a><span id="l12.102" class="difflineplus">+</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineplus">+if (AppConstants.MOZ_UPDATER) {</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+  Preferences.add({ id: &quot;app.update.disable_button.showUpdateHistory&quot;, type: &quot;bool&quot; });</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineplus">+  if (AppConstants.MOZ_MAINTENANCE_SERVICE) {</span>
<a href="#l12.106"></a><span id="l12.106" class="difflineplus">+    Preferences.add({ id: &quot;app.update.service.enabled&quot;, type: &quot;bool&quot; });</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineplus">+  }</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineplus">+}</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineplus">+</span>
<a href="#l12.110"></a><span id="l12.110" class="difflineplus">+if (document.getElementById(&quot;paneGeneral&quot;)) {</span>
<a href="#l12.111"></a><span id="l12.111" class="difflineplus">+  document.getElementById(&quot;paneGeneral&quot;)</span>
<a href="#l12.112"></a><span id="l12.112" class="difflineplus">+          .addEventListener(&quot;paneload&quot;, function() { gGeneralPane.init(); });</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineplus">+}</span>
<a href="#l12.114"></a><span id="l12.114"> </span>
<a href="#l12.115"></a><span id="l12.115"> var gGeneralPane = {</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineplus">+  // The set of types the app knows how to handle.  A hash of HandlerInfoWrapper</span>
<a href="#l12.117"></a><span id="l12.117" class="difflineplus">+  // objects, indexed by type.</span>
<a href="#l12.118"></a><span id="l12.118" class="difflineplus">+  _handledTypes: {},</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineplus">+</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+  // The list of types we can show, sorted by the sort column/direction.</span>
<a href="#l12.121"></a><span id="l12.121" class="difflineplus">+  // An array of HandlerInfoWrapper objects.  We build this list when we first</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineplus">+  // load the data and then rebuild it when users change a pref that affects</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+  // what types we can show or change the sort column/direction.</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineplus">+  // Note: this isn't necessarily the list of types we *will* show; if the user</span>
<a href="#l12.125"></a><span id="l12.125" class="difflineplus">+  // provides a filter string, we'll only show the subset of types in this list</span>
<a href="#l12.126"></a><span id="l12.126" class="difflineplus">+  // that match that string.</span>
<a href="#l12.127"></a><span id="l12.127" class="difflineplus">+  _visibleTypes: [],</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineplus">+</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+  // Map whose keys are string descriptions and values are references to the</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+  // first visible HandlerInfoWrapper that has this description. We use this</span>
<a href="#l12.131"></a><span id="l12.131" class="difflineplus">+  // to determine whether or not to annotate descriptions with their types to</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineplus">+  // distinguish duplicate descriptions from each other.</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineplus">+  _visibleDescriptions: new Map(),</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineplus">+</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineplus">+  // -----------------------------------</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineplus">+  // Convenience &amp; Performance Shortcuts</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineplus">+</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineplus">+  // These get defined by init().</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineplus">+  _brandShortName: null,</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+  _list: null,</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineplus">+  _filter: null,</span>
<a href="#l12.142"></a><span id="l12.142">   mPane: null,</span>
<a href="#l12.143"></a><span id="l12.143">   mStartPageUrl: &quot;&quot;,</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineplus">+  mShellServiceWorking: false,</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineplus">+  mBundle: null,</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+  mTagListBox:  null,</span>
<a href="#l12.147"></a><span id="l12.147" class="difflineplus">+  requestingLocales: null,</span>
<a href="#l12.148"></a><span id="l12.148"> </span>
<a href="#l12.149"></a><span id="l12.149">   init() {</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+    function setEventListener(aId, aEventType, aCallback) {</span>
<a href="#l12.151"></a><span id="l12.151" class="difflineplus">+      document.getElementById(aId)</span>
<a href="#l12.152"></a><span id="l12.152" class="difflineplus">+        .addEventListener(aEventType, aCallback.bind(gGeneralPane));</span>
<a href="#l12.153"></a><span id="l12.153" class="difflineplus">+    }</span>
<a href="#l12.154"></a><span id="l12.154" class="difflineplus">+</span>
<a href="#l12.155"></a><span id="l12.155">     this.mPane = document.getElementById(&quot;paneGeneral&quot;);</span>
<a href="#l12.156"></a><span id="l12.156" class="difflineplus">+    this.mBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l12.157"></a><span id="l12.157" class="difflineplus">+    this._brandShortName =</span>
<a href="#l12.158"></a><span id="l12.158" class="difflineplus">+      document.getElementById(&quot;bundleBrand&quot;).getString(&quot;brandShortName&quot;);</span>
<a href="#l12.159"></a><span id="l12.159" class="difflineplus">+    this._prefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l12.160"></a><span id="l12.160" class="difflineplus">+    this._list = document.getElementById(&quot;handlersView&quot;);</span>
<a href="#l12.161"></a><span id="l12.161" class="difflineplus">+    this._filter = document.getElementById(&quot;filter&quot;);</span>
<a href="#l12.162"></a><span id="l12.162"> </span>
<a href="#l12.163"></a><span id="l12.163">     this.updateStartPage();</span>
<a href="#l12.164"></a><span id="l12.164">     this.updatePlaySound(</span>
<a href="#l12.165"></a><span id="l12.165">       !Preferences.get(&quot;mail.biff.play_sound&quot;).value,</span>
<a href="#l12.166"></a><span id="l12.166">       Preferences.get(&quot;mail.biff.play_sound.url&quot;).value,</span>
<a href="#l12.167"></a><span id="l12.167">       Preferences.get(&quot;mail.biff.play_sound.type&quot;).value</span>
<a href="#l12.168"></a><span id="l12.168">     );</span>
<a href="#l12.169"></a><span id="l12.169">     if (AppConstants.platform != &quot;macosx&quot;) {</span>
<a href="#l12.170"></a><span id="l12.170">       this.updateCustomizeAlert();</span>
<a href="#l12.171"></a><span id="l12.171">     }</span>
<a href="#l12.172"></a><span id="l12.172">     this.updateWebSearch();</span>
<a href="#l12.173"></a><span id="l12.173"> </span>
<a href="#l12.174"></a><span id="l12.174" class="difflineminus">-    let element = document.getElementById(&quot;mailnewsStartPageUrl&quot;);</span>
<a href="#l12.175"></a><span id="l12.175" class="difflineminus">-    Preferences.addSyncFromPrefListener(element, () =&gt; this.readStartPageUrl());</span>
<a href="#l12.176"></a><span id="l12.176" class="difflineminus">-    Preferences.addSyncToPrefListener(element, () =&gt; this.writeStartPageUrl());</span>
<a href="#l12.177"></a><span id="l12.177" class="difflineminus">-    Preferences.addSyncFromPrefListener(document.getElementById(&quot;soundUrlLocation&quot;),</span>
<a href="#l12.178"></a><span id="l12.178" class="difflineminus">-      () =&gt; this.readSoundLocation());</span>
<a href="#l12.179"></a><span id="l12.179" class="difflineplus">+    // Search integration -- check whether we should hide or disable integration</span>
<a href="#l12.180"></a><span id="l12.180" class="difflineplus">+    let hideSearchUI = false;</span>
<a href="#l12.181"></a><span id="l12.181" class="difflineplus">+    let disableSearchUI = false;</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineplus">+    const {SearchIntegration} = ChromeUtils.import(&quot;resource:///modules/SearchIntegration.jsm&quot;);</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineplus">+    if (SearchIntegration) {</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineplus">+      if (SearchIntegration.osVersionTooLow)</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineplus">+        hideSearchUI = true;</span>
<a href="#l12.186"></a><span id="l12.186" class="difflineplus">+      else if (SearchIntegration.osComponentsNotRunning)</span>
<a href="#l12.187"></a><span id="l12.187" class="difflineplus">+        disableSearchUI = true;</span>
<a href="#l12.188"></a><span id="l12.188" class="difflineplus">+    } else {</span>
<a href="#l12.189"></a><span id="l12.189" class="difflineplus">+      hideSearchUI = true;</span>
<a href="#l12.190"></a><span id="l12.190" class="difflineplus">+    }</span>
<a href="#l12.191"></a><span id="l12.191" class="difflineplus">+</span>
<a href="#l12.192"></a><span id="l12.192" class="difflineplus">+    if (hideSearchUI) {</span>
<a href="#l12.193"></a><span id="l12.193" class="difflineplus">+      document.getElementById(&quot;searchIntegrationContainer&quot;).hidden = true;</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineplus">+    } else if (disableSearchUI) {</span>
<a href="#l12.195"></a><span id="l12.195" class="difflineplus">+      let searchCheckbox = document.getElementById(&quot;searchIntegration&quot;);</span>
<a href="#l12.196"></a><span id="l12.196" class="difflineplus">+      searchCheckbox.checked = false;</span>
<a href="#l12.197"></a><span id="l12.197" class="difflineplus">+      Preferences.get(&quot;searchintegration.enable&quot;).disabled = true;</span>
<a href="#l12.198"></a><span id="l12.198" class="difflineplus">+    }</span>
<a href="#l12.199"></a><span id="l12.199" class="difflineplus">+</span>
<a href="#l12.200"></a><span id="l12.200" class="difflineplus">+    // If the shell service is not working, disable the &quot;Check now&quot; button</span>
<a href="#l12.201"></a><span id="l12.201" class="difflineplus">+    // and &quot;perform check at startup&quot; checkbox.</span>
<a href="#l12.202"></a><span id="l12.202" class="difflineplus">+    try {</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineplus">+      Cc[&quot;@mozilla.org/mail/shell-service;1&quot;].getService(Ci.nsIShellService);</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+      this.mShellServiceWorking = true;</span>
<a href="#l12.205"></a><span id="l12.205" class="difflineplus">+    } catch (ex) {</span>
<a href="#l12.206"></a><span id="l12.206" class="difflineplus">+      // The elements may not exist if HAVE_SHELL_SERVICE is off.</span>
<a href="#l12.207"></a><span id="l12.207" class="difflineplus">+      if (document.getElementById(&quot;alwaysCheckDefault&quot;)) {</span>
<a href="#l12.208"></a><span id="l12.208" class="difflineplus">+        document.getElementById(&quot;alwaysCheckDefault&quot;).disabled = true;</span>
<a href="#l12.209"></a><span id="l12.209" class="difflineplus">+        document.getElementById(&quot;alwaysCheckDefault&quot;).checked = false;</span>
<a href="#l12.210"></a><span id="l12.210" class="difflineplus">+      }</span>
<a href="#l12.211"></a><span id="l12.211" class="difflineplus">+      if (document.getElementById(&quot;checkDefaultButton&quot;))</span>
<a href="#l12.212"></a><span id="l12.212" class="difflineplus">+        document.getElementById(&quot;checkDefaultButton&quot;).disabled = true;</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineplus">+      this.mShellServiceWorking = false;</span>
<a href="#l12.214"></a><span id="l12.214" class="difflineplus">+    }</span>
<a href="#l12.215"></a><span id="l12.215" class="difflineplus">+    this._rebuildFonts();</span>
<a href="#l12.216"></a><span id="l12.216" class="difflineplus">+</span>
<a href="#l12.217"></a><span id="l12.217" class="difflineplus">+    var menulist = document.getElementById(&quot;defaultFont&quot;);</span>
<a href="#l12.218"></a><span id="l12.218" class="difflineplus">+    if (menulist.selectedIndex == -1) {</span>
<a href="#l12.219"></a><span id="l12.219" class="difflineplus">+      // Prepend menuitem with empty name and value.</span>
<a href="#l12.220"></a><span id="l12.220" class="difflineplus">+      let item = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.221"></a><span id="l12.221" class="difflineplus">+      item.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineplus">+      item.setAttribute(&quot;value&quot;, &quot;&quot;);</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineplus">+      menulist.menupopup.insertBefore(item, menulist.menupopup.firstChild);</span>
<a href="#l12.224"></a><span id="l12.224" class="difflineplus">+      menulist.selectedIndex = 0;</span>
<a href="#l12.225"></a><span id="l12.225" class="difflineplus">+    }</span>
<a href="#l12.226"></a><span id="l12.226" class="difflineplus">+</span>
<a href="#l12.227"></a><span id="l12.227" class="difflineplus">+    this.formatLocaleSetLabels();</span>
<a href="#l12.228"></a><span id="l12.228" class="difflineplus">+</span>
<a href="#l12.229"></a><span id="l12.229" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;intl.multilingual.enabled&quot;)) {</span>
<a href="#l12.230"></a><span id="l12.230" class="difflineplus">+      this.initMessengerLocale();</span>
<a href="#l12.231"></a><span id="l12.231" class="difflineplus">+    }</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineplus">+</span>
<a href="#l12.233"></a><span id="l12.233" class="difflineplus">+    this.mTagListBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l12.234"></a><span id="l12.234" class="difflineplus">+    this.buildTagList();</span>
<a href="#l12.235"></a><span id="l12.235" class="difflineplus">+    this.updateMarkAsReadOptions();</span>
<a href="#l12.236"></a><span id="l12.236" class="difflineplus">+</span>
<a href="#l12.237"></a><span id="l12.237" class="difflineplus">+    document.getElementById(&quot;citationmenu&quot;).value =</span>
<a href="#l12.238"></a><span id="l12.238" class="difflineplus">+      Preferences.get(&quot;mail.citation_color&quot;).value;</span>
<a href="#l12.239"></a><span id="l12.239" class="difflineplus">+</span>
<a href="#l12.240"></a><span id="l12.240" class="difflineplus">+    // Figure out how we should be sorting the list.  We persist sort settings</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineplus">+    // across sessions, so we can't assume the default sort column/direction.</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineplus">+    // XXX should we be using the XUL sort service instead?</span>
<a href="#l12.243"></a><span id="l12.243" class="difflineplus">+    this._sortColumn = document.getElementById(&quot;typeColumn&quot;);</span>
<a href="#l12.244"></a><span id="l12.244" class="difflineplus">+    if (document.getElementById(&quot;actionColumn&quot;).hasAttribute(&quot;sortDirection&quot;)) {</span>
<a href="#l12.245"></a><span id="l12.245" class="difflineplus">+      this._sortColumn = document.getElementById(&quot;actionColumn&quot;);</span>
<a href="#l12.246"></a><span id="l12.246" class="difflineplus">+      // The typeColumn element always has a sortDirection attribute,</span>
<a href="#l12.247"></a><span id="l12.247" class="difflineplus">+      // either because it was persisted or because the default value</span>
<a href="#l12.248"></a><span id="l12.248" class="difflineplus">+      // from the xul file was used.  If we are sorting on the other</span>
<a href="#l12.249"></a><span id="l12.249" class="difflineplus">+      // column, we should remove it.</span>
<a href="#l12.250"></a><span id="l12.250" class="difflineplus">+      document.getElementById(&quot;typeColumn&quot;).removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l12.251"></a><span id="l12.251" class="difflineplus">+    }</span>
<a href="#l12.252"></a><span id="l12.252" class="difflineplus">+</span>
<a href="#l12.253"></a><span id="l12.253" class="difflineplus">+    // By doing this in a timeout, we let the preferences dialog resize itself</span>
<a href="#l12.254"></a><span id="l12.254" class="difflineplus">+    // to an appropriate size before we add a bunch of items to the list.</span>
<a href="#l12.255"></a><span id="l12.255" class="difflineplus">+    // Otherwise, if there are many items, and the Applications prefpane</span>
<a href="#l12.256"></a><span id="l12.256" class="difflineplus">+    // is the one that gets displayed when the user first opens the dialog,</span>
<a href="#l12.257"></a><span id="l12.257" class="difflineplus">+    // the dialog might stretch too much in an attempt to fit them all in.</span>
<a href="#l12.258"></a><span id="l12.258" class="difflineplus">+    // XXX Shouldn't we perhaps just set a max-height on the richlistbox?</span>
<a href="#l12.259"></a><span id="l12.259" class="difflineplus">+    var _delayedPaneLoad = function(self) {</span>
<a href="#l12.260"></a><span id="l12.260" class="difflineplus">+      self._initListEventHandlers();</span>
<a href="#l12.261"></a><span id="l12.261" class="difflineplus">+      self._loadAppHandlerData();</span>
<a href="#l12.262"></a><span id="l12.262" class="difflineplus">+      self._rebuildVisibleTypes();</span>
<a href="#l12.263"></a><span id="l12.263" class="difflineplus">+      self._sortVisibleTypes();</span>
<a href="#l12.264"></a><span id="l12.264" class="difflineplus">+      self._rebuildView();</span>
<a href="#l12.265"></a><span id="l12.265" class="difflineplus">+</span>
<a href="#l12.266"></a><span id="l12.266" class="difflineplus">+      // Notify observers that the UI is now ready</span>
<a href="#l12.267"></a><span id="l12.267" class="difflineplus">+      Services.obs.notifyObservers(window, &quot;app-handler-pane-loaded&quot;);</span>
<a href="#l12.268"></a><span id="l12.268" class="difflineplus">+    };</span>
<a href="#l12.269"></a><span id="l12.269" class="difflineplus">+    this.updateActualCacheSize();</span>
<a href="#l12.270"></a><span id="l12.270" class="difflineplus">+    this.updateCompactOptions();</span>
<a href="#l12.271"></a><span id="l12.271" class="difflineplus">+</span>
<a href="#l12.272"></a><span id="l12.272" class="difflineplus">+    // Default store type initialization.</span>
<a href="#l12.273"></a><span id="l12.273" class="difflineplus">+    let storeTypeElement = document.getElementById(&quot;storeTypeMenulist&quot;);</span>
<a href="#l12.274"></a><span id="l12.274" class="difflineplus">+    // set the menuitem to match the account</span>
<a href="#l12.275"></a><span id="l12.275" class="difflineplus">+    let defaultStoreID = Services.prefs.getCharPref(&quot;mail.serverDefaultStoreContractID&quot;);</span>
<a href="#l12.276"></a><span id="l12.276" class="difflineplus">+    let targetItem = storeTypeElement.getElementsByAttribute(&quot;value&quot;, defaultStoreID);</span>
<a href="#l12.277"></a><span id="l12.277" class="difflineplus">+    storeTypeElement.selectedItem = targetItem[0];</span>
<a href="#l12.278"></a><span id="l12.278" class="difflineplus">+    setTimeout(_delayedPaneLoad, 0, this);</span>
<a href="#l12.279"></a><span id="l12.279" class="difflineplus">+</span>
<a href="#l12.280"></a><span id="l12.280" class="difflineplus">+    if (AppConstants.MOZ_UPDATER) {</span>
<a href="#l12.281"></a><span id="l12.281" class="difflineplus">+      this.updateReadPrefs();</span>
<a href="#l12.282"></a><span id="l12.282" class="difflineplus">+      gAppUpdater = new appUpdater(); // eslint-disable-line no-global-assign</span>
<a href="#l12.283"></a><span id="l12.283" class="difflineplus">+      if (Services.policies &amp;&amp; !Services.policies.isAllowed(&quot;appUpdate&quot;)) {</span>
<a href="#l12.284"></a><span id="l12.284" class="difflineplus">+          document.getElementById(&quot;updateAllowDescription&quot;).hidden = true;</span>
<a href="#l12.285"></a><span id="l12.285" class="difflineplus">+          document.getElementById(&quot;updateRadioGroup&quot;).hidden = true;</span>
<a href="#l12.286"></a><span id="l12.286" class="difflineplus">+        if (AppConstants.MOZ_MAINTENANCE_SERVICE) {</span>
<a href="#l12.287"></a><span id="l12.287" class="difflineplus">+          document.getElementById(&quot;useService&quot;).hidden = true;</span>
<a href="#l12.288"></a><span id="l12.288" class="difflineplus">+        }</span>
<a href="#l12.289"></a><span id="l12.289" class="difflineplus">+      } else {</span>
<a href="#l12.290"></a><span id="l12.290" class="difflineplus">+        // Start with no option selected since we are still reading the value</span>
<a href="#l12.291"></a><span id="l12.291" class="difflineplus">+        document.getElementById(&quot;autoDesktop&quot;).removeAttribute(&quot;selected&quot;);</span>
<a href="#l12.292"></a><span id="l12.292" class="difflineplus">+        document.getElementById(&quot;manualDesktop&quot;).removeAttribute(&quot;selected&quot;);</span>
<a href="#l12.293"></a><span id="l12.293" class="difflineplus">+        // Start reading the correct value from the disk</span>
<a href="#l12.294"></a><span id="l12.294" class="difflineplus">+        this.updateReadPrefs();</span>
<a href="#l12.295"></a><span id="l12.295" class="difflineplus">+        setEventListener(&quot;updateRadioGroup&quot;, &quot;command&quot;,</span>
<a href="#l12.296"></a><span id="l12.296" class="difflineplus">+                         gGeneralPane.updateWritePrefs);</span>
<a href="#l12.297"></a><span id="l12.297" class="difflineplus">+      }</span>
<a href="#l12.298"></a><span id="l12.298" class="difflineplus">+</span>
<a href="#l12.299"></a><span id="l12.299" class="difflineplus">+      let distroId = Services.prefs.getCharPref(&quot;distribution.id&quot;, &quot;&quot;);</span>
<a href="#l12.300"></a><span id="l12.300" class="difflineplus">+      if (distroId) {</span>
<a href="#l12.301"></a><span id="l12.301" class="difflineplus">+        let distroVersion = Services.prefs.getCharPref(&quot;distribution.version&quot;);</span>
<a href="#l12.302"></a><span id="l12.302" class="difflineplus">+</span>
<a href="#l12.303"></a><span id="l12.303" class="difflineplus">+        let distroIdField = document.getElementById(&quot;distributionId&quot;);</span>
<a href="#l12.304"></a><span id="l12.304" class="difflineplus">+        distroIdField.value = distroId + &quot; - &quot; + distroVersion;</span>
<a href="#l12.305"></a><span id="l12.305" class="difflineplus">+        distroIdField.style.display = &quot;block&quot;;</span>
<a href="#l12.306"></a><span id="l12.306" class="difflineplus">+</span>
<a href="#l12.307"></a><span id="l12.307" class="difflineplus">+        let distroAbout = Services.prefs.getStringPref(&quot;distribution.about&quot;, &quot;&quot;);</span>
<a href="#l12.308"></a><span id="l12.308" class="difflineplus">+        if (distroAbout) {</span>
<a href="#l12.309"></a><span id="l12.309" class="difflineplus">+          let distroField = document.getElementById(&quot;distribution&quot;);</span>
<a href="#l12.310"></a><span id="l12.310" class="difflineplus">+          distroField.value = distroAbout;</span>
<a href="#l12.311"></a><span id="l12.311" class="difflineplus">+          distroField.style.display = &quot;block&quot;;</span>
<a href="#l12.312"></a><span id="l12.312" class="difflineplus">+        }</span>
<a href="#l12.313"></a><span id="l12.313" class="difflineplus">+      }</span>
<a href="#l12.314"></a><span id="l12.314" class="difflineplus">+</span>
<a href="#l12.315"></a><span id="l12.315" class="difflineplus">+      if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l12.316"></a><span id="l12.316" class="difflineplus">+        // On Windows, the Application Update setting is an installation-</span>
<a href="#l12.317"></a><span id="l12.317" class="difflineplus">+        // specific preference, not a profile-specific one. Show a warning to</span>
<a href="#l12.318"></a><span id="l12.318" class="difflineplus">+        // inform users of this.</span>
<a href="#l12.319"></a><span id="l12.319" class="difflineplus">+        let updateContainer = document.getElementById(&quot;updateSettingsContainer&quot;);</span>
<a href="#l12.320"></a><span id="l12.320" class="difflineplus">+        updateContainer.classList.add(&quot;updateSettingCrossUserWarningContainer&quot;);</span>
<a href="#l12.321"></a><span id="l12.321" class="difflineplus">+        document.getElementById(&quot;updateSettingCrossUserWarning&quot;).hidden = false;</span>
<a href="#l12.322"></a><span id="l12.322" class="difflineplus">+      }</span>
<a href="#l12.323"></a><span id="l12.323" class="difflineplus">+</span>
<a href="#l12.324"></a><span id="l12.324" class="difflineplus">+      if (AppConstants.MOZ_MAINTENANCE_SERVICE) {</span>
<a href="#l12.325"></a><span id="l12.325" class="difflineplus">+        // Check to see if the maintenance service is installed.</span>
<a href="#l12.326"></a><span id="l12.326" class="difflineplus">+        // If it isn't installed, don't show the preference at all.</span>
<a href="#l12.327"></a><span id="l12.327" class="difflineplus">+        let installed;</span>
<a href="#l12.328"></a><span id="l12.328" class="difflineplus">+        try {</span>
<a href="#l12.329"></a><span id="l12.329" class="difflineplus">+          let wrk = Cc[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l12.330"></a><span id="l12.330" class="difflineplus">+                    .createInstance(Ci.nsIWindowsRegKey);</span>
<a href="#l12.331"></a><span id="l12.331" class="difflineplus">+          wrk.open(wrk.ROOT_KEY_LOCAL_MACHINE,</span>
<a href="#l12.332"></a><span id="l12.332" class="difflineplus">+                   &quot;SOFTWARE\\Mozilla\\MaintenanceService&quot;,</span>
<a href="#l12.333"></a><span id="l12.333" class="difflineplus">+                   wrk.ACCESS_READ | wrk.WOW64_64);</span>
<a href="#l12.334"></a><span id="l12.334" class="difflineplus">+          installed = wrk.readIntValue(&quot;Installed&quot;);</span>
<a href="#l12.335"></a><span id="l12.335" class="difflineplus">+          wrk.close();</span>
<a href="#l12.336"></a><span id="l12.336" class="difflineplus">+        } catch (e) {</span>
<a href="#l12.337"></a><span id="l12.337" class="difflineplus">+        }</span>
<a href="#l12.338"></a><span id="l12.338" class="difflineplus">+        if (installed != 1) {</span>
<a href="#l12.339"></a><span id="l12.339" class="difflineplus">+          document.getElementById(&quot;useService&quot;).hidden = true;</span>
<a href="#l12.340"></a><span id="l12.340" class="difflineplus">+        }</span>
<a href="#l12.341"></a><span id="l12.341" class="difflineplus">+      }</span>
<a href="#l12.342"></a><span id="l12.342" class="difflineplus">+</span>
<a href="#l12.343"></a><span id="l12.343" class="difflineplus">+      let version = AppConstants.MOZ_APP_VERSION_DISPLAY;</span>
<a href="#l12.344"></a><span id="l12.344" class="difflineplus">+</span>
<a href="#l12.345"></a><span id="l12.345" class="difflineplus">+      // Include the build ID and display warning if this is an &quot;a#&quot; (nightly) build</span>
<a href="#l12.346"></a><span id="l12.346" class="difflineplus">+      if (/a\d+$/.test(version)) {</span>
<a href="#l12.347"></a><span id="l12.347" class="difflineplus">+        let buildID = Services.appinfo.appBuildID;</span>
<a href="#l12.348"></a><span id="l12.348" class="difflineplus">+        let year = buildID.slice(0, 4);</span>
<a href="#l12.349"></a><span id="l12.349" class="difflineplus">+        let month = buildID.slice(4, 6);</span>
<a href="#l12.350"></a><span id="l12.350" class="difflineplus">+        let day = buildID.slice(6, 8);</span>
<a href="#l12.351"></a><span id="l12.351" class="difflineplus">+        version += ` (${year}-${month}-${day})`;</span>
<a href="#l12.352"></a><span id="l12.352" class="difflineplus">+      }</span>
<a href="#l12.353"></a><span id="l12.353" class="difflineplus">+</span>
<a href="#l12.354"></a><span id="l12.354" class="difflineplus">+      // Append &quot;(32-bit)&quot; or &quot;(64-bit)&quot; build architecture to the version number:</span>
<a href="#l12.355"></a><span id="l12.355" class="difflineplus">+      let bundle = Services.strings.createBundle(&quot;chrome://messenger/locale/messenger.properties&quot;);</span>
<a href="#l12.356"></a><span id="l12.356" class="difflineplus">+      let archResource = Services.appinfo.is64Bit</span>
<a href="#l12.357"></a><span id="l12.357" class="difflineplus">+                         ? &quot;aboutDialog.architecture.sixtyFourBit&quot;</span>
<a href="#l12.358"></a><span id="l12.358" class="difflineplus">+                         : &quot;aboutDialog.architecture.thirtyTwoBit&quot;;</span>
<a href="#l12.359"></a><span id="l12.359" class="difflineplus">+      let arch = bundle.GetStringFromName(archResource);</span>
<a href="#l12.360"></a><span id="l12.360" class="difflineplus">+      version += ` (${arch})`;</span>
<a href="#l12.361"></a><span id="l12.361" class="difflineplus">+</span>
<a href="#l12.362"></a><span id="l12.362" class="difflineplus">+      document.getElementById(&quot;version&quot;).textContent = version;</span>
<a href="#l12.363"></a><span id="l12.363" class="difflineplus">+</span>
<a href="#l12.364"></a><span id="l12.364" class="difflineplus">+      if (!AppConstants.NIGHTLY_BUILD) {</span>
<a href="#l12.365"></a><span id="l12.365" class="difflineplus">+        // Show a release notes link if we have a URL.</span>
<a href="#l12.366"></a><span id="l12.366" class="difflineplus">+        let relNotesLink = document.getElementById(&quot;releasenotes&quot;);</span>
<a href="#l12.367"></a><span id="l12.367" class="difflineplus">+        let relNotesPrefType = Services.prefs.getPrefType(&quot;app.releaseNotesURL&quot;);</span>
<a href="#l12.368"></a><span id="l12.368" class="difflineplus">+        if (relNotesPrefType != Services.prefs.PREF_INVALID) {</span>
<a href="#l12.369"></a><span id="l12.369" class="difflineplus">+          let relNotesURL = Services.urlFormatter.formatURLPref(&quot;app.releaseNotesURL&quot;);</span>
<a href="#l12.370"></a><span id="l12.370" class="difflineplus">+          if (relNotesURL != &quot;about:blank&quot;) {</span>
<a href="#l12.371"></a><span id="l12.371" class="difflineplus">+            relNotesLink.href = relNotesURL;</span>
<a href="#l12.372"></a><span id="l12.372" class="difflineplus">+            relNotesLink.hidden = false;</span>
<a href="#l12.373"></a><span id="l12.373" class="difflineplus">+          }</span>
<a href="#l12.374"></a><span id="l12.374" class="difflineplus">+        }</span>
<a href="#l12.375"></a><span id="l12.375" class="difflineplus">+      }</span>
<a href="#l12.376"></a><span id="l12.376" class="difflineplus">+      // Initialize Application section.</span>
<a href="#l12.377"></a><span id="l12.377" class="difflineplus">+</span>
<a href="#l12.378"></a><span id="l12.378" class="difflineplus">+      // Listen for window unload so we can remove our preference observers.</span>
<a href="#l12.379"></a><span id="l12.379" class="difflineplus">+      window.addEventListener(&quot;unload&quot;, this);</span>
<a href="#l12.380"></a><span id="l12.380" class="difflineplus">+</span>
<a href="#l12.381"></a><span id="l12.381" class="difflineplus">+      Services.obs.addObserver(this, AUTO_UPDATE_CHANGED_TOPIC);</span>
<a href="#l12.382"></a><span id="l12.382" class="difflineplus">+    }</span>
<a href="#l12.383"></a><span id="l12.383" class="difflineplus">+</span>
<a href="#l12.384"></a><span id="l12.384" class="difflineplus">+    Preferences.addSyncFromPrefListener(document.getElementById(&quot;allowSmartSize&quot;),</span>
<a href="#l12.385"></a><span id="l12.385" class="difflineplus">+      () =&gt; this.readSmartSizeEnabled());</span>
<a href="#l12.386"></a><span id="l12.386" class="difflineplus">+</span>
<a href="#l12.387"></a><span id="l12.387" class="difflineplus">+    let element = document.getElementById(&quot;cacheSize&quot;);</span>
<a href="#l12.388"></a><span id="l12.388" class="difflineplus">+    Preferences.addSyncFromPrefListener(element, () =&gt; this.readCacheSize());</span>
<a href="#l12.389"></a><span id="l12.389" class="difflineplus">+    Preferences.addSyncToPrefListener(element, () =&gt; this.writeCacheSize());</span>
<a href="#l12.390"></a><span id="l12.390" class="difflineplus">+    Preferences.addSyncFromPrefListener(menulist, () =&gt; this.readFontSelection());</span>
<a href="#l12.391"></a><span id="l12.391">   },</span>
<a href="#l12.392"></a><span id="l12.392"> </span>
<a href="#l12.393"></a><span id="l12.393">   /**</span>
<a href="#l12.394"></a><span id="l12.394">    * Restores the default start page as the user's start page</span>
<a href="#l12.395"></a><span id="l12.395">    */</span>
<a href="#l12.396"></a><span id="l12.396">   restoreDefaultStartPage() {</span>
<a href="#l12.397"></a><span id="l12.397">     var startPage = Preferences.get(&quot;mailnews.start_page.url&quot;);</span>
<a href="#l12.398"></a><span id="l12.398">     startPage.value = startPage.defaultValue;</span>
<a href="#l12.399"></a><span id="l12.399" class="difflineat">@@ -290,14 +618,1811 @@ var gGeneralPane = {</span>
<a href="#l12.400"></a><span id="l12.400">         item.remove();</span>
<a href="#l12.401"></a><span id="l12.401">         engineList.selectedIndex = 0;</span>
<a href="#l12.402"></a><span id="l12.402">         await Services.search.setDefault(engineList.selectedItem.engine);</span>
<a href="#l12.403"></a><span id="l12.403">         this.updateRemoveButton();</span>
<a href="#l12.404"></a><span id="l12.404">         break;</span>
<a href="#l12.405"></a><span id="l12.405">       }</span>
<a href="#l12.406"></a><span id="l12.406">     }</span>
<a href="#l12.407"></a><span id="l12.407">   },</span>
<a href="#l12.408"></a><span id="l12.408" class="difflineplus">+</span>
<a href="#l12.409"></a><span id="l12.409" class="difflineplus">+  /**</span>
<a href="#l12.410"></a><span id="l12.410" class="difflineplus">+   * Checks whether Thunderbird is currently registered with the operating</span>
<a href="#l12.411"></a><span id="l12.411" class="difflineplus">+   * system as the default app for mail, rss and news.  If Thunderbird is not</span>
<a href="#l12.412"></a><span id="l12.412" class="difflineplus">+   * currently the default app, the user is given the option of making it the</span>
<a href="#l12.413"></a><span id="l12.413" class="difflineplus">+   * default for each type; otherwise, the user is informed that Thunderbird is</span>
<a href="#l12.414"></a><span id="l12.414" class="difflineplus">+   * already the default.</span>
<a href="#l12.415"></a><span id="l12.415" class="difflineplus">+   */</span>
<a href="#l12.416"></a><span id="l12.416" class="difflineplus">+  checkDefaultNow(aAppType) {</span>
<a href="#l12.417"></a><span id="l12.417" class="difflineplus">+    if (!this.mShellServiceWorking)</span>
<a href="#l12.418"></a><span id="l12.418" class="difflineplus">+      return;</span>
<a href="#l12.419"></a><span id="l12.419" class="difflineplus">+</span>
<a href="#l12.420"></a><span id="l12.420" class="difflineplus">+    // otherwise, bring up the default client dialog</span>
<a href="#l12.421"></a><span id="l12.421" class="difflineplus">+    gSubDialog.open(&quot;chrome://messenger/content/systemIntegrationDialog.xul&quot;,</span>
<a href="#l12.422"></a><span id="l12.422" class="difflineplus">+                    &quot;resizable=no&quot;, &quot;calledFromPrefs&quot;);</span>
<a href="#l12.423"></a><span id="l12.423" class="difflineplus">+  },</span>
<a href="#l12.424"></a><span id="l12.424" class="difflineplus">+</span>
<a href="#l12.425"></a><span id="l12.425" class="difflineplus">+  // FONTS</span>
<a href="#l12.426"></a><span id="l12.426" class="difflineplus">+</span>
<a href="#l12.427"></a><span id="l12.427" class="difflineplus">+  /**</span>
<a href="#l12.428"></a><span id="l12.428" class="difflineplus">+   * Populates the default font list in UI.</span>
<a href="#l12.429"></a><span id="l12.429" class="difflineplus">+   */</span>
<a href="#l12.430"></a><span id="l12.430" class="difflineplus">+  _rebuildFonts() {</span>
<a href="#l12.431"></a><span id="l12.431" class="difflineplus">+    var langGroupPref = Preferences.get(&quot;font.language.group&quot;);</span>
<a href="#l12.432"></a><span id="l12.432" class="difflineplus">+    var isSerif = gGeneralPane._readDefaultFontTypeForLanguage(langGroupPref.value) == &quot;serif&quot;;</span>
<a href="#l12.433"></a><span id="l12.433" class="difflineplus">+    gGeneralPane._selectDefaultLanguageGroup(langGroupPref.value, isSerif);</span>
<a href="#l12.434"></a><span id="l12.434" class="difflineplus">+  },</span>
<a href="#l12.435"></a><span id="l12.435" class="difflineplus">+</span>
<a href="#l12.436"></a><span id="l12.436" class="difflineplus">+  /**</span>
<a href="#l12.437"></a><span id="l12.437" class="difflineplus">+   * Select the default language group.</span>
<a href="#l12.438"></a><span id="l12.438" class="difflineplus">+   */</span>
<a href="#l12.439"></a><span id="l12.439" class="difflineplus">+  _selectDefaultLanguageGroupPromise: Promise.resolve(),</span>
<a href="#l12.440"></a><span id="l12.440" class="difflineplus">+</span>
<a href="#l12.441"></a><span id="l12.441" class="difflineplus">+  _selectDefaultLanguageGroup(aLanguageGroup, aIsSerif) {</span>
<a href="#l12.442"></a><span id="l12.442" class="difflineplus">+    this._selectDefaultLanguageGroupPromise = (async () =&gt; {</span>
<a href="#l12.443"></a><span id="l12.443" class="difflineplus">+      // Avoid overlapping language group selections by awaiting the resolution</span>
<a href="#l12.444"></a><span id="l12.444" class="difflineplus">+      // of the previous one.  We do this because this function is re-entrant,</span>
<a href="#l12.445"></a><span id="l12.445" class="difflineplus">+      // as inserting &lt;preference&gt; elements into the DOM sometimes triggers a call</span>
<a href="#l12.446"></a><span id="l12.446" class="difflineplus">+      // back into this function.  And since this function is also asynchronous,</span>
<a href="#l12.447"></a><span id="l12.447" class="difflineplus">+      // that call can enter this function before the previous run has completed,</span>
<a href="#l12.448"></a><span id="l12.448" class="difflineplus">+      // which would corrupt the font menulists.  Awaiting the previous call's</span>
<a href="#l12.449"></a><span id="l12.449" class="difflineplus">+      // resolution avoids that fate.</span>
<a href="#l12.450"></a><span id="l12.450" class="difflineplus">+      await this._selectDefaultLanguageGroupPromise;</span>
<a href="#l12.451"></a><span id="l12.451" class="difflineplus">+</span>
<a href="#l12.452"></a><span id="l12.452" class="difflineplus">+      const kFontNameFmtSerif         = &quot;font.name.serif.%LANG%&quot;;</span>
<a href="#l12.453"></a><span id="l12.453" class="difflineplus">+      const kFontNameFmtSansSerif     = &quot;font.name.sans-serif.%LANG%&quot;;</span>
<a href="#l12.454"></a><span id="l12.454" class="difflineplus">+      const kFontNameListFmtSerif     = &quot;font.name-list.serif.%LANG%&quot;;</span>
<a href="#l12.455"></a><span id="l12.455" class="difflineplus">+      const kFontNameListFmtSansSerif = &quot;font.name-list.sans-serif.%LANG%&quot;;</span>
<a href="#l12.456"></a><span id="l12.456" class="difflineplus">+      const kFontSizeFmtVariable      = &quot;font.size.variable.%LANG%&quot;;</span>
<a href="#l12.457"></a><span id="l12.457" class="difflineplus">+</span>
<a href="#l12.458"></a><span id="l12.458" class="difflineplus">+      // Make sure font.name-list is created before font.name so that it's</span>
<a href="#l12.459"></a><span id="l12.459" class="difflineplus">+      // available at the time readFontSelection below is called.</span>
<a href="#l12.460"></a><span id="l12.460" class="difflineplus">+      var prefs = [{format: aIsSerif ? kFontNameListFmtSerif : kFontNameListFmtSansSerif,</span>
<a href="#l12.461"></a><span id="l12.461" class="difflineplus">+                    type: &quot;unichar&quot;,</span>
<a href="#l12.462"></a><span id="l12.462" class="difflineplus">+                    element: null,</span>
<a href="#l12.463"></a><span id="l12.463" class="difflineplus">+                    fonttype: aIsSerif ? &quot;serif&quot; : &quot;sans-serif&quot; },</span>
<a href="#l12.464"></a><span id="l12.464" class="difflineplus">+                   {format: aIsSerif ? kFontNameFmtSerif : kFontNameFmtSansSerif,</span>
<a href="#l12.465"></a><span id="l12.465" class="difflineplus">+                    type: &quot;fontname&quot;,</span>
<a href="#l12.466"></a><span id="l12.466" class="difflineplus">+                    element: &quot;defaultFont&quot;,</span>
<a href="#l12.467"></a><span id="l12.467" class="difflineplus">+                    fonttype: aIsSerif ? &quot;serif&quot; : &quot;sans-serif&quot; },</span>
<a href="#l12.468"></a><span id="l12.468" class="difflineplus">+                   {format: kFontSizeFmtVariable,</span>
<a href="#l12.469"></a><span id="l12.469" class="difflineplus">+                    type: &quot;int&quot;,</span>
<a href="#l12.470"></a><span id="l12.470" class="difflineplus">+                    element: &quot;defaultFontSize&quot;,</span>
<a href="#l12.471"></a><span id="l12.471" class="difflineplus">+                    fonttype: null }];</span>
<a href="#l12.472"></a><span id="l12.472" class="difflineplus">+</span>
<a href="#l12.473"></a><span id="l12.473" class="difflineplus">+      for (var i = 0; i &lt; prefs.length; ++i) {</span>
<a href="#l12.474"></a><span id="l12.474" class="difflineplus">+        var preference = Preferences.get(prefs[i].format.replace(/%LANG%/, aLanguageGroup));</span>
<a href="#l12.475"></a><span id="l12.475" class="difflineplus">+        if (!preference) {</span>
<a href="#l12.476"></a><span id="l12.476" class="difflineplus">+          preference = Preferences.add({</span>
<a href="#l12.477"></a><span id="l12.477" class="difflineplus">+            id: prefs[i].format.replace(/%LANG%/, aLanguageGroup),</span>
<a href="#l12.478"></a><span id="l12.478" class="difflineplus">+            type: prefs[i].type,</span>
<a href="#l12.479"></a><span id="l12.479" class="difflineplus">+          });</span>
<a href="#l12.480"></a><span id="l12.480" class="difflineplus">+        }</span>
<a href="#l12.481"></a><span id="l12.481" class="difflineplus">+</span>
<a href="#l12.482"></a><span id="l12.482" class="difflineplus">+        if (!prefs[i].element)</span>
<a href="#l12.483"></a><span id="l12.483" class="difflineplus">+          continue;</span>
<a href="#l12.484"></a><span id="l12.484" class="difflineplus">+</span>
<a href="#l12.485"></a><span id="l12.485" class="difflineplus">+        var element = document.getElementById(prefs[i].element);</span>
<a href="#l12.486"></a><span id="l12.486" class="difflineplus">+        if (element) {</span>
<a href="#l12.487"></a><span id="l12.487" class="difflineplus">+          // Make sure we have the font list ready for readFontSelection below to</span>
<a href="#l12.488"></a><span id="l12.488" class="difflineplus">+          // work. readFontSelection gets called at onsyncfrompreference, but the</span>
<a href="#l12.489"></a><span id="l12.489" class="difflineplus">+          // exact semantics of when it is called (whether during setAttribute or</span>
<a href="#l12.490"></a><span id="l12.490" class="difflineplus">+          // during setElementValue) aren't obvious.</span>
<a href="#l12.491"></a><span id="l12.491" class="difflineplus">+          if (prefs[i].fonttype)</span>
<a href="#l12.492"></a><span id="l12.492" class="difflineplus">+            await FontBuilder.buildFontList(aLanguageGroup, prefs[i].fonttype, element);</span>
<a href="#l12.493"></a><span id="l12.493" class="difflineplus">+</span>
<a href="#l12.494"></a><span id="l12.494" class="difflineplus">+          element.setAttribute(&quot;preference&quot;, preference.id);</span>
<a href="#l12.495"></a><span id="l12.495" class="difflineplus">+</span>
<a href="#l12.496"></a><span id="l12.496" class="difflineplus">+          preference.setElementValue(element);</span>
<a href="#l12.497"></a><span id="l12.497" class="difflineplus">+        }</span>
<a href="#l12.498"></a><span id="l12.498" class="difflineplus">+      }</span>
<a href="#l12.499"></a><span id="l12.499" class="difflineplus">+    })().catch(Cu.reportError);</span>
<a href="#l12.500"></a><span id="l12.500" class="difflineplus">+  },</span>
<a href="#l12.501"></a><span id="l12.501" class="difflineplus">+</span>
<a href="#l12.502"></a><span id="l12.502" class="difflineplus">+  /**</span>
<a href="#l12.503"></a><span id="l12.503" class="difflineplus">+   * Displays the fonts dialog, where web page font names and sizes can be</span>
<a href="#l12.504"></a><span id="l12.504" class="difflineplus">+   * configured.</span>
<a href="#l12.505"></a><span id="l12.505" class="difflineplus">+   */</span>
<a href="#l12.506"></a><span id="l12.506" class="difflineplus">+  configureFonts() {</span>
<a href="#l12.507"></a><span id="l12.507" class="difflineplus">+    gSubDialog.open(&quot;chrome://messenger/content/preferences/fonts.xul&quot;);</span>
<a href="#l12.508"></a><span id="l12.508" class="difflineplus">+  },</span>
<a href="#l12.509"></a><span id="l12.509" class="difflineplus">+</span>
<a href="#l12.510"></a><span id="l12.510" class="difflineplus">+  /**</span>
<a href="#l12.511"></a><span id="l12.511" class="difflineplus">+   * Displays the colors dialog, where default web page/link/etc. colors can be</span>
<a href="#l12.512"></a><span id="l12.512" class="difflineplus">+   * configured.</span>
<a href="#l12.513"></a><span id="l12.513" class="difflineplus">+   */</span>
<a href="#l12.514"></a><span id="l12.514" class="difflineplus">+  configureColors() {</span>
<a href="#l12.515"></a><span id="l12.515" class="difflineplus">+    gSubDialog.open(&quot;chrome://messenger/content/preferences/colors.xul&quot;,</span>
<a href="#l12.516"></a><span id="l12.516" class="difflineplus">+                    &quot;resizable=no&quot;);</span>
<a href="#l12.517"></a><span id="l12.517" class="difflineplus">+  },</span>
<a href="#l12.518"></a><span id="l12.518" class="difflineplus">+</span>
<a href="#l12.519"></a><span id="l12.519" class="difflineplus">+  /**</span>
<a href="#l12.520"></a><span id="l12.520" class="difflineplus">+   * Returns the type of the current default font for the language denoted by</span>
<a href="#l12.521"></a><span id="l12.521" class="difflineplus">+   * aLanguageGroup.</span>
<a href="#l12.522"></a><span id="l12.522" class="difflineplus">+   */</span>
<a href="#l12.523"></a><span id="l12.523" class="difflineplus">+  _readDefaultFontTypeForLanguage(aLanguageGroup) {</span>
<a href="#l12.524"></a><span id="l12.524" class="difflineplus">+    const kDefaultFontType = &quot;font.default.%LANG%&quot;;</span>
<a href="#l12.525"></a><span id="l12.525" class="difflineplus">+    var defaultFontTypePref = kDefaultFontType.replace(/%LANG%/, aLanguageGroup);</span>
<a href="#l12.526"></a><span id="l12.526" class="difflineplus">+    var preference = Preferences.get(defaultFontTypePref);</span>
<a href="#l12.527"></a><span id="l12.527" class="difflineplus">+    if (!preference) {</span>
<a href="#l12.528"></a><span id="l12.528" class="difflineplus">+      Preferences.add({</span>
<a href="#l12.529"></a><span id="l12.529" class="difflineplus">+        id: defaultFontTypePref,</span>
<a href="#l12.530"></a><span id="l12.530" class="difflineplus">+        type: &quot;string&quot;,</span>
<a href="#l12.531"></a><span id="l12.531" class="difflineplus">+        name: defaultFontTypePref,</span>
<a href="#l12.532"></a><span id="l12.532" class="difflineplus">+      }).on(&quot;change&quot;, gGeneralPane._rebuildFonts);</span>
<a href="#l12.533"></a><span id="l12.533" class="difflineplus">+    }</span>
<a href="#l12.534"></a><span id="l12.534" class="difflineplus">+</span>
<a href="#l12.535"></a><span id="l12.535" class="difflineplus">+    // We should return preference.value here, but we can't wait for the binding to load,</span>
<a href="#l12.536"></a><span id="l12.536" class="difflineplus">+    // or things get really messy. Fortunately this will give the same answer.</span>
<a href="#l12.537"></a><span id="l12.537" class="difflineplus">+    return Services.prefs.getCharPref(defaultFontTypePref);</span>
<a href="#l12.538"></a><span id="l12.538" class="difflineplus">+  },</span>
<a href="#l12.539"></a><span id="l12.539" class="difflineplus">+</span>
<a href="#l12.540"></a><span id="l12.540" class="difflineplus">+  /**</span>
<a href="#l12.541"></a><span id="l12.541" class="difflineplus">+   * Determine the appropriate value to select for defaultFont, for the</span>
<a href="#l12.542"></a><span id="l12.542" class="difflineplus">+   * following cases:</span>
<a href="#l12.543"></a><span id="l12.543" class="difflineplus">+   * - there is no setting</span>
<a href="#l12.544"></a><span id="l12.544" class="difflineplus">+   * - the font selected by the user is no longer present (e.g. deleted from</span>
<a href="#l12.545"></a><span id="l12.545" class="difflineplus">+   *   fonts folder)</span>
<a href="#l12.546"></a><span id="l12.546" class="difflineplus">+   */</span>
<a href="#l12.547"></a><span id="l12.547" class="difflineplus">+  readFontSelection() {</span>
<a href="#l12.548"></a><span id="l12.548" class="difflineplus">+    let element = document.getElementById(&quot;defaultFont&quot;);</span>
<a href="#l12.549"></a><span id="l12.549" class="difflineplus">+    let preference = Preferences.get(element.getAttribute(&quot;preference&quot;));</span>
<a href="#l12.550"></a><span id="l12.550" class="difflineplus">+    if (preference.value) {</span>
<a href="#l12.551"></a><span id="l12.551" class="difflineplus">+      let fontItem = element.querySelector('[value=&quot;' + preference.value + '&quot;]');</span>
<a href="#l12.552"></a><span id="l12.552" class="difflineplus">+</span>
<a href="#l12.553"></a><span id="l12.553" class="difflineplus">+      // There is a setting that actually is in the list. Respect it.</span>
<a href="#l12.554"></a><span id="l12.554" class="difflineplus">+      if (fontItem)</span>
<a href="#l12.555"></a><span id="l12.555" class="difflineplus">+        return undefined;</span>
<a href="#l12.556"></a><span id="l12.556" class="difflineplus">+    }</span>
<a href="#l12.557"></a><span id="l12.557" class="difflineplus">+</span>
<a href="#l12.558"></a><span id="l12.558" class="difflineplus">+    let defaultValue = element.firstChild.firstChild.getAttribute(&quot;value&quot;);</span>
<a href="#l12.559"></a><span id="l12.559" class="difflineplus">+    let languagePref = Preferences.get(&quot;font.language.group&quot;);</span>
<a href="#l12.560"></a><span id="l12.560" class="difflineplus">+    let defaultType = this._readDefaultFontTypeForLanguage(languagePref.value);</span>
<a href="#l12.561"></a><span id="l12.561" class="difflineplus">+    let listPref = Preferences.get(&quot;font.name-list.&quot; + defaultType + &quot;.&quot; + languagePref.value);</span>
<a href="#l12.562"></a><span id="l12.562" class="difflineplus">+    if (!listPref)</span>
<a href="#l12.563"></a><span id="l12.563" class="difflineplus">+      return defaultValue;</span>
<a href="#l12.564"></a><span id="l12.564" class="difflineplus">+</span>
<a href="#l12.565"></a><span id="l12.565" class="difflineplus">+    let fontNames = listPref.value.split(&quot;,&quot;);</span>
<a href="#l12.566"></a><span id="l12.566" class="difflineplus">+</span>
<a href="#l12.567"></a><span id="l12.567" class="difflineplus">+    for (let fontName of fontNames) {</span>
<a href="#l12.568"></a><span id="l12.568" class="difflineplus">+      let fontItem = element.querySelector('[value=&quot;' + fontName.trim() + '&quot;]');</span>
<a href="#l12.569"></a><span id="l12.569" class="difflineplus">+      if (fontItem)</span>
<a href="#l12.570"></a><span id="l12.570" class="difflineplus">+        return fontItem.getAttribute(&quot;value&quot;);</span>
<a href="#l12.571"></a><span id="l12.571" class="difflineplus">+    }</span>
<a href="#l12.572"></a><span id="l12.572" class="difflineplus">+    return defaultValue;</span>
<a href="#l12.573"></a><span id="l12.573" class="difflineplus">+  },</span>
<a href="#l12.574"></a><span id="l12.574" class="difflineplus">+</span>
<a href="#l12.575"></a><span id="l12.575" class="difflineplus">+  formatLocaleSetLabels() {</span>
<a href="#l12.576"></a><span id="l12.576" class="difflineplus">+    const osprefs =</span>
<a href="#l12.577"></a><span id="l12.577" class="difflineplus">+      Cc[&quot;@mozilla.org/intl/ospreferences;1&quot;]</span>
<a href="#l12.578"></a><span id="l12.578" class="difflineplus">+        .getService(Ci.mozIOSPreferences);</span>
<a href="#l12.579"></a><span id="l12.579" class="difflineplus">+    let appLocale = Services.locale.appLocalesAsBCP47[0];</span>
<a href="#l12.580"></a><span id="l12.580" class="difflineplus">+    let rsLocale = osprefs.regionalPrefsLocales[0];</span>
<a href="#l12.581"></a><span id="l12.581" class="difflineplus">+    let names = Services.intl.getLocaleDisplayNames(undefined, [appLocale, rsLocale]);</span>
<a href="#l12.582"></a><span id="l12.582" class="difflineplus">+    let appLocaleRadio = document.getElementById(&quot;appLocale&quot;);</span>
<a href="#l12.583"></a><span id="l12.583" class="difflineplus">+    let rsLocaleRadio = document.getElementById(&quot;rsLocale&quot;);</span>
<a href="#l12.584"></a><span id="l12.584" class="difflineplus">+    let appLocaleLabel = this.mBundle.getFormattedString(&quot;appLocale.label&quot;,</span>
<a href="#l12.585"></a><span id="l12.585" class="difflineplus">+                                                         [names[0]]);</span>
<a href="#l12.586"></a><span id="l12.586" class="difflineplus">+    let rsLocaleLabel = this.mBundle.getFormattedString(&quot;rsLocale.label&quot;,</span>
<a href="#l12.587"></a><span id="l12.587" class="difflineplus">+                                                        [names[1]]);</span>
<a href="#l12.588"></a><span id="l12.588" class="difflineplus">+    appLocaleRadio.setAttribute(&quot;label&quot;, appLocaleLabel);</span>
<a href="#l12.589"></a><span id="l12.589" class="difflineplus">+    rsLocaleRadio.setAttribute(&quot;label&quot;, rsLocaleLabel);</span>
<a href="#l12.590"></a><span id="l12.590" class="difflineplus">+    appLocaleRadio.accessKey = this.mBundle.getString(&quot;appLocale.accesskey&quot;);</span>
<a href="#l12.591"></a><span id="l12.591" class="difflineplus">+    rsLocaleRadio.accessKey = this.mBundle.getString(&quot;rsLocale.accesskey&quot;);</span>
<a href="#l12.592"></a><span id="l12.592" class="difflineplus">+  },</span>
<a href="#l12.593"></a><span id="l12.593" class="difflineplus">+</span>
<a href="#l12.594"></a><span id="l12.594" class="difflineplus">+  // Load the preferences string bundle for other locales with fallbacks.</span>
<a href="#l12.595"></a><span id="l12.595" class="difflineplus">+  getBundleForLocales(newLocales) {</span>
<a href="#l12.596"></a><span id="l12.596" class="difflineplus">+    let locales = Array.from(new Set([</span>
<a href="#l12.597"></a><span id="l12.597" class="difflineplus">+      ...newLocales,</span>
<a href="#l12.598"></a><span id="l12.598" class="difflineplus">+      ...Services.locale.requestedLocales,</span>
<a href="#l12.599"></a><span id="l12.599" class="difflineplus">+      Services.locale.lastFallbackLocale,</span>
<a href="#l12.600"></a><span id="l12.600" class="difflineplus">+    ]));</span>
<a href="#l12.601"></a><span id="l12.601" class="difflineplus">+    function generateBundles(resourceIds) {</span>
<a href="#l12.602"></a><span id="l12.602" class="difflineplus">+      return L10nRegistry.generateBundles(locales, resourceIds);</span>
<a href="#l12.603"></a><span id="l12.603" class="difflineplus">+    }</span>
<a href="#l12.604"></a><span id="l12.604" class="difflineplus">+    return new Localization([</span>
<a href="#l12.605"></a><span id="l12.605" class="difflineplus">+      &quot;messenger/preferences/preferences.ftl&quot;,</span>
<a href="#l12.606"></a><span id="l12.606" class="difflineplus">+      &quot;branding/brand.ftl&quot;,</span>
<a href="#l12.607"></a><span id="l12.607" class="difflineplus">+    ], generateBundles);</span>
<a href="#l12.608"></a><span id="l12.608" class="difflineplus">+  },</span>
<a href="#l12.609"></a><span id="l12.609" class="difflineplus">+</span>
<a href="#l12.610"></a><span id="l12.610" class="difflineplus">+  initMessengerLocale() {</span>
<a href="#l12.611"></a><span id="l12.611" class="difflineplus">+    gGeneralPane.setMessengerLocales(Services.locale.requestedLocale);</span>
<a href="#l12.612"></a><span id="l12.612" class="difflineplus">+  },</span>
<a href="#l12.613"></a><span id="l12.613" class="difflineplus">+</span>
<a href="#l12.614"></a><span id="l12.614" class="difflineplus">+  /**</span>
<a href="#l12.615"></a><span id="l12.615" class="difflineplus">+   * Update the available list of locales and select the locale that the user</span>
<a href="#l12.616"></a><span id="l12.616" class="difflineplus">+   * is &quot;selecting&quot;. This could be the currently requested locale or a locale</span>
<a href="#l12.617"></a><span id="l12.617" class="difflineplus">+   * that the user would like to switch to after confirmation.</span>
<a href="#l12.618"></a><span id="l12.618" class="difflineplus">+   */</span>
<a href="#l12.619"></a><span id="l12.619" class="difflineplus">+  async setMessengerLocales(selected) {</span>
<a href="#l12.620"></a><span id="l12.620" class="difflineplus">+    let available = await getAvailableLocales();</span>
<a href="#l12.621"></a><span id="l12.621" class="difflineplus">+    let localeNames = Services.intl.getLocaleDisplayNames(undefined, available);</span>
<a href="#l12.622"></a><span id="l12.622" class="difflineplus">+    let locales = available.map((code, i) =&gt; ({code, name: localeNames[i]}));</span>
<a href="#l12.623"></a><span id="l12.623" class="difflineplus">+    locales.sort((a, b) =&gt; a.name &gt; b.name);</span>
<a href="#l12.624"></a><span id="l12.624" class="difflineplus">+</span>
<a href="#l12.625"></a><span id="l12.625" class="difflineplus">+    let fragment = document.createDocumentFragment();</span>
<a href="#l12.626"></a><span id="l12.626" class="difflineplus">+    for (let {code, name} of locales) {</span>
<a href="#l12.627"></a><span id="l12.627" class="difflineplus">+      let menuitem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.628"></a><span id="l12.628" class="difflineplus">+      menuitem.setAttribute(&quot;value&quot;, code);</span>
<a href="#l12.629"></a><span id="l12.629" class="difflineplus">+      menuitem.setAttribute(&quot;label&quot;, name);</span>
<a href="#l12.630"></a><span id="l12.630" class="difflineplus">+      fragment.appendChild(menuitem);</span>
<a href="#l12.631"></a><span id="l12.631" class="difflineplus">+    }</span>
<a href="#l12.632"></a><span id="l12.632" class="difflineplus">+</span>
<a href="#l12.633"></a><span id="l12.633" class="difflineplus">+    // Add an option to search for more languages if downloading is supported.</span>
<a href="#l12.634"></a><span id="l12.634" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;intl.multilingual.downloadEnabled&quot;)) {</span>
<a href="#l12.635"></a><span id="l12.635" class="difflineplus">+      let menuitem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.636"></a><span id="l12.636" class="difflineplus">+      menuitem.id = &quot;defaultMessengerLanguageSearch&quot;;</span>
<a href="#l12.637"></a><span id="l12.637" class="difflineplus">+      menuitem.setAttribute(</span>
<a href="#l12.638"></a><span id="l12.638" class="difflineplus">+        &quot;label&quot;, await document.l10n.formatValue(&quot;messenger-languages-search&quot;));</span>
<a href="#l12.639"></a><span id="l12.639" class="difflineplus">+      menuitem.setAttribute(&quot;value&quot;, &quot;search&quot;);</span>
<a href="#l12.640"></a><span id="l12.640" class="difflineplus">+      menuitem.addEventListener(&quot;command&quot;, () =&gt; {</span>
<a href="#l12.641"></a><span id="l12.641" class="difflineplus">+        gGeneralPane.showMessengerLanguages({search: true});</span>
<a href="#l12.642"></a><span id="l12.642" class="difflineplus">+      });</span>
<a href="#l12.643"></a><span id="l12.643" class="difflineplus">+      fragment.appendChild(menuitem);</span>
<a href="#l12.644"></a><span id="l12.644" class="difflineplus">+    }</span>
<a href="#l12.645"></a><span id="l12.645" class="difflineplus">+</span>
<a href="#l12.646"></a><span id="l12.646" class="difflineplus">+    let menulist = document.getElementById(&quot;defaultMessengerLanguage&quot;);</span>
<a href="#l12.647"></a><span id="l12.647" class="difflineplus">+    let menupopup = menulist.querySelector(&quot;menupopup&quot;);</span>
<a href="#l12.648"></a><span id="l12.648" class="difflineplus">+    menupopup.textContent = &quot;&quot;;</span>
<a href="#l12.649"></a><span id="l12.649" class="difflineplus">+    menupopup.appendChild(fragment);</span>
<a href="#l12.650"></a><span id="l12.650" class="difflineplus">+    menulist.value = selected;</span>
<a href="#l12.651"></a><span id="l12.651" class="difflineplus">+</span>
<a href="#l12.652"></a><span id="l12.652" class="difflineplus">+    document.getElementById(&quot;messengerLanguagesBox&quot;).hidden = false;</span>
<a href="#l12.653"></a><span id="l12.653" class="difflineplus">+  },</span>
<a href="#l12.654"></a><span id="l12.654" class="difflineplus">+</span>
<a href="#l12.655"></a><span id="l12.655" class="difflineplus">+  showMessengerLanguages({search}) {</span>
<a href="#l12.656"></a><span id="l12.656" class="difflineplus">+    let opts = {selected: gGeneralPane.selectedLocales, search};</span>
<a href="#l12.657"></a><span id="l12.657" class="difflineplus">+    gSubDialog.open(</span>
<a href="#l12.658"></a><span id="l12.658" class="difflineplus">+      &quot;chrome://messenger/content/preferences/messengerLanguages.xul&quot;,</span>
<a href="#l12.659"></a><span id="l12.659" class="difflineplus">+      null, opts, this.messengerLanguagesClosed);</span>
<a href="#l12.660"></a><span id="l12.660" class="difflineplus">+  },</span>
<a href="#l12.661"></a><span id="l12.661" class="difflineplus">+</span>
<a href="#l12.662"></a><span id="l12.662" class="difflineplus">+  /* Show or hide the confirm change message bar based on the updated ordering. */</span>
<a href="#l12.663"></a><span id="l12.663" class="difflineplus">+  messengerLanguagesClosed() {</span>
<a href="#l12.664"></a><span id="l12.664" class="difflineplus">+    let selected = this.gMessengerLanguagesDialog.selected;</span>
<a href="#l12.665"></a><span id="l12.665" class="difflineplus">+    let active = Services.locale.appLocalesAsBCP47;</span>
<a href="#l12.666"></a><span id="l12.666" class="difflineplus">+</span>
<a href="#l12.667"></a><span id="l12.667" class="difflineplus">+    // Prepare for changing the locales if they are different than the current locales.</span>
<a href="#l12.668"></a><span id="l12.668" class="difflineplus">+    if (selected &amp;&amp; selected.join(&quot;,&quot;) != active.join(&quot;,&quot;)) {</span>
<a href="#l12.669"></a><span id="l12.669" class="difflineplus">+      gGeneralPane.showConfirmLanguageChangeMessageBar(selected);</span>
<a href="#l12.670"></a><span id="l12.670" class="difflineplus">+      gGeneralPane.setMessengerLocales(selected[0]);</span>
<a href="#l12.671"></a><span id="l12.671" class="difflineplus">+      return;</span>
<a href="#l12.672"></a><span id="l12.672" class="difflineplus">+    }</span>
<a href="#l12.673"></a><span id="l12.673" class="difflineplus">+</span>
<a href="#l12.674"></a><span id="l12.674" class="difflineplus">+    // They matched, so we can reset the UI.</span>
<a href="#l12.675"></a><span id="l12.675" class="difflineplus">+    gGeneralPane.setMessengerLocales(Services.locale.appLocaleAsBCP47);</span>
<a href="#l12.676"></a><span id="l12.676" class="difflineplus">+    gGeneralPane.hideConfirmLanguageChangeMessageBar();</span>
<a href="#l12.677"></a><span id="l12.677" class="difflineplus">+  },</span>
<a href="#l12.678"></a><span id="l12.678" class="difflineplus">+</span>
<a href="#l12.679"></a><span id="l12.679" class="difflineplus">+  /* Show the confirmation message bar to allow a restart into the new locales. */</span>
<a href="#l12.680"></a><span id="l12.680" class="difflineplus">+  async showConfirmLanguageChangeMessageBar(locales) {</span>
<a href="#l12.681"></a><span id="l12.681" class="difflineplus">+    let messageBar = document.getElementById(&quot;confirmMessengerLanguage&quot;);</span>
<a href="#l12.682"></a><span id="l12.682" class="difflineplus">+</span>
<a href="#l12.683"></a><span id="l12.683" class="difflineplus">+    // Get the bundle for the new locale.</span>
<a href="#l12.684"></a><span id="l12.684" class="difflineplus">+    let newBundle = this.getBundleForLocales(locales);</span>
<a href="#l12.685"></a><span id="l12.685" class="difflineplus">+</span>
<a href="#l12.686"></a><span id="l12.686" class="difflineplus">+    // Find the messages and labels.</span>
<a href="#l12.687"></a><span id="l12.687" class="difflineplus">+    let messages = await Promise.all([newBundle, document.l10n].map(</span>
<a href="#l12.688"></a><span id="l12.688" class="difflineplus">+      async (bundle) =&gt; bundle.formatValue(&quot;confirm-messenger-language-change-description&quot;)));</span>
<a href="#l12.689"></a><span id="l12.689" class="difflineplus">+    let buttonLabels = await Promise.all([newBundle, document.l10n].map(</span>
<a href="#l12.690"></a><span id="l12.690" class="difflineplus">+      async (bundle) =&gt; bundle.formatValue(&quot;confirm-messenger-language-change-button&quot;)));</span>
<a href="#l12.691"></a><span id="l12.691" class="difflineplus">+</span>
<a href="#l12.692"></a><span id="l12.692" class="difflineplus">+    // If both the message and label are the same, just include one row.</span>
<a href="#l12.693"></a><span id="l12.693" class="difflineplus">+    if (messages[0] == messages[1] &amp;&amp; buttonLabels[0] == buttonLabels[1]) {</span>
<a href="#l12.694"></a><span id="l12.694" class="difflineplus">+      messages.pop();</span>
<a href="#l12.695"></a><span id="l12.695" class="difflineplus">+      buttonLabels.pop();</span>
<a href="#l12.696"></a><span id="l12.696" class="difflineplus">+    }</span>
<a href="#l12.697"></a><span id="l12.697" class="difflineplus">+</span>
<a href="#l12.698"></a><span id="l12.698" class="difflineplus">+    let contentContainer = messageBar.querySelector(&quot;.message-bar-content-container&quot;);</span>
<a href="#l12.699"></a><span id="l12.699" class="difflineplus">+    contentContainer.textContent = &quot;&quot;;</span>
<a href="#l12.700"></a><span id="l12.700" class="difflineplus">+</span>
<a href="#l12.701"></a><span id="l12.701" class="difflineplus">+    for (let i = 0; i &lt; messages.length; i++) {</span>
<a href="#l12.702"></a><span id="l12.702" class="difflineplus">+      let messageContainer = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l12.703"></a><span id="l12.703" class="difflineplus">+      messageContainer.classList.add(&quot;message-bar-content&quot;);</span>
<a href="#l12.704"></a><span id="l12.704" class="difflineplus">+      messageContainer.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l12.705"></a><span id="l12.705" class="difflineplus">+      messageContainer.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<a href="#l12.706"></a><span id="l12.706" class="difflineplus">+</span>
<a href="#l12.707"></a><span id="l12.707" class="difflineplus">+      let description = document.createXULElement(&quot;description&quot;);</span>
<a href="#l12.708"></a><span id="l12.708" class="difflineplus">+      description.classList.add(&quot;message-bar-description&quot;);</span>
<a href="#l12.709"></a><span id="l12.709" class="difflineplus">+      description.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l12.710"></a><span id="l12.710" class="difflineplus">+      description.textContent = messages[i];</span>
<a href="#l12.711"></a><span id="l12.711" class="difflineplus">+      messageContainer.appendChild(description);</span>
<a href="#l12.712"></a><span id="l12.712" class="difflineplus">+</span>
<a href="#l12.713"></a><span id="l12.713" class="difflineplus">+      let button = document.createXULElement(&quot;button&quot;);</span>
<a href="#l12.714"></a><span id="l12.714" class="difflineplus">+      button.addEventListener(&quot;command&quot;, gGeneralPane.confirmLanguageChange);</span>
<a href="#l12.715"></a><span id="l12.715" class="difflineplus">+      button.classList.add(&quot;message-bar-button&quot;);</span>
<a href="#l12.716"></a><span id="l12.716" class="difflineplus">+      button.setAttribute(&quot;locales&quot;, locales.join(&quot;,&quot;));</span>
<a href="#l12.717"></a><span id="l12.717" class="difflineplus">+      button.setAttribute(&quot;label&quot;, buttonLabels[i]);</span>
<a href="#l12.718"></a><span id="l12.718" class="difflineplus">+      messageContainer.appendChild(button);</span>
<a href="#l12.719"></a><span id="l12.719" class="difflineplus">+</span>
<a href="#l12.720"></a><span id="l12.720" class="difflineplus">+      contentContainer.appendChild(messageContainer);</span>
<a href="#l12.721"></a><span id="l12.721" class="difflineplus">+    }</span>
<a href="#l12.722"></a><span id="l12.722" class="difflineplus">+</span>
<a href="#l12.723"></a><span id="l12.723" class="difflineplus">+    messageBar.hidden = false;</span>
<a href="#l12.724"></a><span id="l12.724" class="difflineplus">+    this.selectedLocales = locales;</span>
<a href="#l12.725"></a><span id="l12.725" class="difflineplus">+  },</span>
<a href="#l12.726"></a><span id="l12.726" class="difflineplus">+</span>
<a href="#l12.727"></a><span id="l12.727" class="difflineplus">+  hideConfirmLanguageChangeMessageBar() {</span>
<a href="#l12.728"></a><span id="l12.728" class="difflineplus">+    let messageBar = document.getElementById(&quot;confirmMessengerLanguage&quot;);</span>
<a href="#l12.729"></a><span id="l12.729" class="difflineplus">+    messageBar.hidden = true;</span>
<a href="#l12.730"></a><span id="l12.730" class="difflineplus">+    let contentContainer = messageBar.querySelector(&quot;.message-bar-content-container&quot;);</span>
<a href="#l12.731"></a><span id="l12.731" class="difflineplus">+    contentContainer.textContent = &quot;&quot;;</span>
<a href="#l12.732"></a><span id="l12.732" class="difflineplus">+    this.requestingLocales = null;</span>
<a href="#l12.733"></a><span id="l12.733" class="difflineplus">+  },</span>
<a href="#l12.734"></a><span id="l12.734" class="difflineplus">+</span>
<a href="#l12.735"></a><span id="l12.735" class="difflineplus">+  /* Confirm the locale change and restart the Thunderbird in the new locale. */</span>
<a href="#l12.736"></a><span id="l12.736" class="difflineplus">+  confirmLanguageChange(event) {</span>
<a href="#l12.737"></a><span id="l12.737" class="difflineplus">+    let localesString = (event.target.getAttribute(&quot;locales&quot;) || &quot;&quot;).trim();</span>
<a href="#l12.738"></a><span id="l12.738" class="difflineplus">+    if (!localesString || localesString.length == 0) {</span>
<a href="#l12.739"></a><span id="l12.739" class="difflineplus">+      return;</span>
<a href="#l12.740"></a><span id="l12.740" class="difflineplus">+    }</span>
<a href="#l12.741"></a><span id="l12.741" class="difflineplus">+    let locales = localesString.split(&quot;,&quot;);</span>
<a href="#l12.742"></a><span id="l12.742" class="difflineplus">+    Services.locale.requestedLocales = locales;</span>
<a href="#l12.743"></a><span id="l12.743" class="difflineplus">+</span>
<a href="#l12.744"></a><span id="l12.744" class="difflineplus">+    // Restart with the new locale.</span>
<a href="#l12.745"></a><span id="l12.745" class="difflineplus">+    let cancelQuit = Cc[&quot;@mozilla.org/supports-PRBool;1&quot;].createInstance(Ci.nsISupportsPRBool);</span>
<a href="#l12.746"></a><span id="l12.746" class="difflineplus">+    Services.obs.notifyObservers(cancelQuit, &quot;quit-application-requested&quot;, &quot;restart&quot;);</span>
<a href="#l12.747"></a><span id="l12.747" class="difflineplus">+    if (!cancelQuit.data) {</span>
<a href="#l12.748"></a><span id="l12.748" class="difflineplus">+      Services.startup.quit(Services.startup.eAttemptQuit | Services.startup.eRestart);</span>
<a href="#l12.749"></a><span id="l12.749" class="difflineplus">+    }</span>
<a href="#l12.750"></a><span id="l12.750" class="difflineplus">+  },</span>
<a href="#l12.751"></a><span id="l12.751" class="difflineplus">+</span>
<a href="#l12.752"></a><span id="l12.752" class="difflineplus">+  /* Show or hide the confirm change message bar based on the new locale. */</span>
<a href="#l12.753"></a><span id="l12.753" class="difflineplus">+  onMessengerLanguageChange(event) {</span>
<a href="#l12.754"></a><span id="l12.754" class="difflineplus">+    let locale = event.target.value;</span>
<a href="#l12.755"></a><span id="l12.755" class="difflineplus">+</span>
<a href="#l12.756"></a><span id="l12.756" class="difflineplus">+    if (locale == &quot;search&quot;) {</span>
<a href="#l12.757"></a><span id="l12.757" class="difflineplus">+      return;</span>
<a href="#l12.758"></a><span id="l12.758" class="difflineplus">+    } else if (locale == Services.locale.appLocaleAsBCP47) {</span>
<a href="#l12.759"></a><span id="l12.759" class="difflineplus">+      this.hideConfirmLanguageChangeMessageBar();</span>
<a href="#l12.760"></a><span id="l12.760" class="difflineplus">+      return;</span>
<a href="#l12.761"></a><span id="l12.761" class="difflineplus">+    }</span>
<a href="#l12.762"></a><span id="l12.762" class="difflineplus">+</span>
<a href="#l12.763"></a><span id="l12.763" class="difflineplus">+    let locales = Array.from(new Set([</span>
<a href="#l12.764"></a><span id="l12.764" class="difflineplus">+      locale,</span>
<a href="#l12.765"></a><span id="l12.765" class="difflineplus">+      ...Services.locale.requestedLocales,</span>
<a href="#l12.766"></a><span id="l12.766" class="difflineplus">+    ]).values());</span>
<a href="#l12.767"></a><span id="l12.767" class="difflineplus">+    this.showConfirmLanguageChangeMessageBar(locales);</span>
<a href="#l12.768"></a><span id="l12.768" class="difflineplus">+  },</span>
<a href="#l12.769"></a><span id="l12.769" class="difflineplus">+</span>
<a href="#l12.770"></a><span id="l12.770" class="difflineplus">+  // appends the tag to the tag list box</span>
<a href="#l12.771"></a><span id="l12.771" class="difflineplus">+  appendTagItem(aTagName, aKey, aColor) {</span>
<a href="#l12.772"></a><span id="l12.772" class="difflineplus">+    let item = this.mTagListBox.appendItem(aTagName, aKey);</span>
<a href="#l12.773"></a><span id="l12.773" class="difflineplus">+    item.style.color = aColor;</span>
<a href="#l12.774"></a><span id="l12.774" class="difflineplus">+    return item;</span>
<a href="#l12.775"></a><span id="l12.775" class="difflineplus">+  },</span>
<a href="#l12.776"></a><span id="l12.776" class="difflineplus">+</span>
<a href="#l12.777"></a><span id="l12.777" class="difflineplus">+  buildTagList() {</span>
<a href="#l12.778"></a><span id="l12.778" class="difflineplus">+    let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l12.779"></a><span id="l12.779" class="difflineplus">+    for (let i = 0; i &lt; tagArray.length; ++i) {</span>
<a href="#l12.780"></a><span id="l12.780" class="difflineplus">+      let taginfo = tagArray[i];</span>
<a href="#l12.781"></a><span id="l12.781" class="difflineplus">+      this.appendTagItem(taginfo.tag, taginfo.key, taginfo.color);</span>
<a href="#l12.782"></a><span id="l12.782" class="difflineplus">+    }</span>
<a href="#l12.783"></a><span id="l12.783" class="difflineplus">+  },</span>
<a href="#l12.784"></a><span id="l12.784" class="difflineplus">+</span>
<a href="#l12.785"></a><span id="l12.785" class="difflineplus">+  removeTag() {</span>
<a href="#l12.786"></a><span id="l12.786" class="difflineplus">+    var index = this.mTagListBox.selectedIndex;</span>
<a href="#l12.787"></a><span id="l12.787" class="difflineplus">+    if (index &gt;= 0) {</span>
<a href="#l12.788"></a><span id="l12.788" class="difflineplus">+      var itemToRemove = this.mTagListBox.getItemAtIndex(index);</span>
<a href="#l12.789"></a><span id="l12.789" class="difflineplus">+      MailServices.tags.deleteKey(itemToRemove.getAttribute(&quot;value&quot;));</span>
<a href="#l12.790"></a><span id="l12.790" class="difflineplus">+      itemToRemove.remove();</span>
<a href="#l12.791"></a><span id="l12.791" class="difflineplus">+      var numItemsInListBox = this.mTagListBox.getRowCount();</span>
<a href="#l12.792"></a><span id="l12.792" class="difflineplus">+      this.mTagListBox.selectedIndex = index &lt; numItemsInListBox ? index : numItemsInListBox - 1;</span>
<a href="#l12.793"></a><span id="l12.793" class="difflineplus">+    }</span>
<a href="#l12.794"></a><span id="l12.794" class="difflineplus">+  },</span>
<a href="#l12.795"></a><span id="l12.795" class="difflineplus">+</span>
<a href="#l12.796"></a><span id="l12.796" class="difflineplus">+  /**</span>
<a href="#l12.797"></a><span id="l12.797" class="difflineplus">+   * Open the edit tag dialog</span>
<a href="#l12.798"></a><span id="l12.798" class="difflineplus">+   */</span>
<a href="#l12.799"></a><span id="l12.799" class="difflineplus">+  editTag() {</span>
<a href="#l12.800"></a><span id="l12.800" class="difflineplus">+    var index = this.mTagListBox.selectedIndex;</span>
<a href="#l12.801"></a><span id="l12.801" class="difflineplus">+    if (index &gt;= 0) {</span>
<a href="#l12.802"></a><span id="l12.802" class="difflineplus">+      var tagElToEdit = this.mTagListBox.getItemAtIndex(index);</span>
<a href="#l12.803"></a><span id="l12.803" class="difflineplus">+      var args = {result: &quot;&quot;, keyToEdit: tagElToEdit.getAttribute(&quot;value&quot;), okCallback: editTagCallback};</span>
<a href="#l12.804"></a><span id="l12.804" class="difflineplus">+      gSubDialog.open(&quot;chrome://messenger/content/newTagDialog.xul&quot;, &quot;resizable=no&quot;, args);</span>
<a href="#l12.805"></a><span id="l12.805" class="difflineplus">+    }</span>
<a href="#l12.806"></a><span id="l12.806" class="difflineplus">+  },</span>
<a href="#l12.807"></a><span id="l12.807" class="difflineplus">+</span>
<a href="#l12.808"></a><span id="l12.808" class="difflineplus">+  addTag() {</span>
<a href="#l12.809"></a><span id="l12.809" class="difflineplus">+    var args = {result: &quot;&quot;, okCallback: addTagCallback};</span>
<a href="#l12.810"></a><span id="l12.810" class="difflineplus">+    gSubDialog.open(&quot;chrome://messenger/content/newTagDialog.xul&quot;, &quot;resizable=no&quot;, args);</span>
<a href="#l12.811"></a><span id="l12.811" class="difflineplus">+  },</span>
<a href="#l12.812"></a><span id="l12.812" class="difflineplus">+</span>
<a href="#l12.813"></a><span id="l12.813" class="difflineplus">+  onSelectTag() {</span>
<a href="#l12.814"></a><span id="l12.814" class="difflineplus">+    let btnEdit = document.getElementById(&quot;editTagButton&quot;);</span>
<a href="#l12.815"></a><span id="l12.815" class="difflineplus">+    let listBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l12.816"></a><span id="l12.816" class="difflineplus">+</span>
<a href="#l12.817"></a><span id="l12.817" class="difflineplus">+    if (listBox.selectedCount &gt; 0)</span>
<a href="#l12.818"></a><span id="l12.818" class="difflineplus">+      btnEdit.disabled = false;</span>
<a href="#l12.819"></a><span id="l12.819" class="difflineplus">+    else</span>
<a href="#l12.820"></a><span id="l12.820" class="difflineplus">+      btnEdit.disabled = true;</span>
<a href="#l12.821"></a><span id="l12.821" class="difflineplus">+</span>
<a href="#l12.822"></a><span id="l12.822" class="difflineplus">+    document.getElementById(&quot;removeTagButton&quot;).disabled = btnEdit.disabled;</span>
<a href="#l12.823"></a><span id="l12.823" class="difflineplus">+  },</span>
<a href="#l12.824"></a><span id="l12.824" class="difflineplus">+</span>
<a href="#l12.825"></a><span id="l12.825" class="difflineplus">+  /**</span>
<a href="#l12.826"></a><span id="l12.826" class="difflineplus">+   * Enable/disable the options of automatic marking as read depending on the</span>
<a href="#l12.827"></a><span id="l12.827" class="difflineplus">+   * state of the automatic marking feature.</span>
<a href="#l12.828"></a><span id="l12.828" class="difflineplus">+   */</span>
<a href="#l12.829"></a><span id="l12.829" class="difflineplus">+  updateMarkAsReadOptions() {</span>
<a href="#l12.830"></a><span id="l12.830" class="difflineplus">+    let enableRadioGroup = Preferences.get(&quot;mailnews.mark_message_read.auto&quot;).value;</span>
<a href="#l12.831"></a><span id="l12.831" class="difflineplus">+    let autoMarkAsPref = Preferences.get(&quot;mailnews.mark_message_read.delay&quot;);</span>
<a href="#l12.832"></a><span id="l12.832" class="difflineplus">+    let autoMarkDisabled = !enableRadioGroup || autoMarkAsPref.locked;</span>
<a href="#l12.833"></a><span id="l12.833" class="difflineplus">+    document.getElementById(&quot;markAsReadAutoPreferences&quot;).disabled = autoMarkDisabled;</span>
<a href="#l12.834"></a><span id="l12.834" class="difflineplus">+    document.getElementById(&quot;secondsLabel&quot;).disabled = autoMarkDisabled;</span>
<a href="#l12.835"></a><span id="l12.835" class="difflineplus">+    gGeneralPane.updateMarkAsReadTextbox();</span>
<a href="#l12.836"></a><span id="l12.836" class="difflineplus">+  },</span>
<a href="#l12.837"></a><span id="l12.837" class="difflineplus">+</span>
<a href="#l12.838"></a><span id="l12.838" class="difflineplus">+  /**</span>
<a href="#l12.839"></a><span id="l12.839" class="difflineplus">+   * Automatically enable/disable delay textbox depending on state of the</span>
<a href="#l12.840"></a><span id="l12.840" class="difflineplus">+   * Mark As Read On Delay feature.</span>
<a href="#l12.841"></a><span id="l12.841" class="difflineplus">+   */</span>
<a href="#l12.842"></a><span id="l12.842" class="difflineplus">+  updateMarkAsReadTextbox() {</span>
<a href="#l12.843"></a><span id="l12.843" class="difflineplus">+    let radioGroupEnabled = Preferences.get(&quot;mailnews.mark_message_read.auto&quot;).value;</span>
<a href="#l12.844"></a><span id="l12.844" class="difflineplus">+    let textBoxEnabled = Preferences.get(&quot;mailnews.mark_message_read.delay&quot;).value;</span>
<a href="#l12.845"></a><span id="l12.845" class="difflineplus">+    let intervalPref = Preferences.get(&quot;mailnews.mark_message_read.delay.interval&quot;);</span>
<a href="#l12.846"></a><span id="l12.846" class="difflineplus">+</span>
<a href="#l12.847"></a><span id="l12.847" class="difflineplus">+    let delayTextbox = document.getElementById(&quot;markAsReadDelay&quot;);</span>
<a href="#l12.848"></a><span id="l12.848" class="difflineplus">+    delayTextbox.disabled = !radioGroupEnabled || !textBoxEnabled || intervalPref.locked;</span>
<a href="#l12.849"></a><span id="l12.849" class="difflineplus">+    if (document.activeElement.id == &quot;markAsReadAutoPreferences&quot;) {</span>
<a href="#l12.850"></a><span id="l12.850" class="difflineplus">+      delayTextbox.focus();</span>
<a href="#l12.851"></a><span id="l12.851" class="difflineplus">+    }</span>
<a href="#l12.852"></a><span id="l12.852" class="difflineplus">+  },</span>
<a href="#l12.853"></a><span id="l12.853" class="difflineplus">+</span>
<a href="#l12.854"></a><span id="l12.854" class="difflineplus">+  /**</span>
<a href="#l12.855"></a><span id="l12.855" class="difflineplus">+   * Display the return receipts configuration dialog.</span>
<a href="#l12.856"></a><span id="l12.856" class="difflineplus">+   */</span>
<a href="#l12.857"></a><span id="l12.857" class="difflineplus">+  showReturnReceipts() {</span>
<a href="#l12.858"></a><span id="l12.858" class="difflineplus">+    gSubDialog.open(&quot;chrome://messenger/content/preferences/receipts.xul&quot;,</span>
<a href="#l12.859"></a><span id="l12.859" class="difflineplus">+                    &quot;resizable=no&quot;);</span>
<a href="#l12.860"></a><span id="l12.860" class="difflineplus">+  },</span>
<a href="#l12.861"></a><span id="l12.861" class="difflineplus">+</span>
<a href="#l12.862"></a><span id="l12.862" class="difflineplus">+  showConfigEdit() {</span>
<a href="#l12.863"></a><span id="l12.863" class="difflineplus">+    gSubDialog.open(&quot;chrome://global/content/config.xul&quot;);</span>
<a href="#l12.864"></a><span id="l12.864" class="difflineplus">+  },</span>
<a href="#l12.865"></a><span id="l12.865" class="difflineplus">+</span>
<a href="#l12.866"></a><span id="l12.866" class="difflineplus">+  /**</span>
<a href="#l12.867"></a><span id="l12.867" class="difflineplus">+   * Display the the connection settings dialog.</span>
<a href="#l12.868"></a><span id="l12.868" class="difflineplus">+   */</span>
<a href="#l12.869"></a><span id="l12.869" class="difflineplus">+  showConnections() {</span>
<a href="#l12.870"></a><span id="l12.870" class="difflineplus">+    gSubDialog.open(&quot;chrome://messenger/content/preferences/connection.xul&quot;);</span>
<a href="#l12.871"></a><span id="l12.871" class="difflineplus">+  },</span>
<a href="#l12.872"></a><span id="l12.872" class="difflineplus">+</span>
<a href="#l12.873"></a><span id="l12.873" class="difflineplus">+  /**</span>
<a href="#l12.874"></a><span id="l12.874" class="difflineplus">+   * Display the the offline settings dialog.</span>
<a href="#l12.875"></a><span id="l12.875" class="difflineplus">+   */</span>
<a href="#l12.876"></a><span id="l12.876" class="difflineplus">+  showOffline() {</span>
<a href="#l12.877"></a><span id="l12.877" class="difflineplus">+    gSubDialog.open(&quot;chrome://messenger/content/preferences/offline.xul&quot;,</span>
<a href="#l12.878"></a><span id="l12.878" class="difflineplus">+                    &quot;resizable=no&quot;);</span>
<a href="#l12.879"></a><span id="l12.879" class="difflineplus">+  },</span>
<a href="#l12.880"></a><span id="l12.880" class="difflineplus">+</span>
<a href="#l12.881"></a><span id="l12.881" class="difflineplus">+  /*</span>
<a href="#l12.882"></a><span id="l12.882" class="difflineplus">+   * browser.cache.disk.capacity</span>
<a href="#l12.883"></a><span id="l12.883" class="difflineplus">+   * - the size of the browser cache in KB</span>
<a href="#l12.884"></a><span id="l12.884" class="difflineplus">+   */</span>
<a href="#l12.885"></a><span id="l12.885" class="difflineplus">+</span>
<a href="#l12.886"></a><span id="l12.886" class="difflineplus">+  // Retrieves the amount of space currently used by disk cache</span>
<a href="#l12.887"></a><span id="l12.887" class="difflineplus">+  updateActualCacheSize() {</span>
<a href="#l12.888"></a><span id="l12.888" class="difflineplus">+    let actualSizeLabel = document.getElementById(&quot;actualDiskCacheSize&quot;);</span>
<a href="#l12.889"></a><span id="l12.889" class="difflineplus">+    let prefStrBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l12.890"></a><span id="l12.890" class="difflineplus">+</span>
<a href="#l12.891"></a><span id="l12.891" class="difflineplus">+    // Needs to root the observer since cache service keeps only a weak reference.</span>
<a href="#l12.892"></a><span id="l12.892" class="difflineplus">+    this.observer = {</span>
<a href="#l12.893"></a><span id="l12.893" class="difflineplus">+      onNetworkCacheDiskConsumption(consumption) {</span>
<a href="#l12.894"></a><span id="l12.894" class="difflineplus">+        let size = DownloadUtils.convertByteUnits(consumption);</span>
<a href="#l12.895"></a><span id="l12.895" class="difflineplus">+        // The XBL binding for the string bundle may have been destroyed if</span>
<a href="#l12.896"></a><span id="l12.896" class="difflineplus">+        // the page was closed before this callback was executed.</span>
<a href="#l12.897"></a><span id="l12.897" class="difflineplus">+        if (!prefStrBundle.getFormattedString) {</span>
<a href="#l12.898"></a><span id="l12.898" class="difflineplus">+          return;</span>
<a href="#l12.899"></a><span id="l12.899" class="difflineplus">+        }</span>
<a href="#l12.900"></a><span id="l12.900" class="difflineplus">+        actualSizeLabel.value = prefStrBundle.getFormattedString(&quot;actualDiskCacheSize&quot;, size);</span>
<a href="#l12.901"></a><span id="l12.901" class="difflineplus">+      },</span>
<a href="#l12.902"></a><span id="l12.902" class="difflineplus">+</span>
<a href="#l12.903"></a><span id="l12.903" class="difflineplus">+      QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l12.904"></a><span id="l12.904" class="difflineplus">+        Ci.nsICacheStorageConsumptionObserver,</span>
<a href="#l12.905"></a><span id="l12.905" class="difflineplus">+        Ci.nsISupportsWeakReference,</span>
<a href="#l12.906"></a><span id="l12.906" class="difflineplus">+      ]),</span>
<a href="#l12.907"></a><span id="l12.907" class="difflineplus">+    };</span>
<a href="#l12.908"></a><span id="l12.908" class="difflineplus">+</span>
<a href="#l12.909"></a><span id="l12.909" class="difflineplus">+    actualSizeLabel.value = prefStrBundle.getString(&quot;actualDiskCacheSizeCalculated&quot;);</span>
<a href="#l12.910"></a><span id="l12.910" class="difflineplus">+</span>
<a href="#l12.911"></a><span id="l12.911" class="difflineplus">+    try {</span>
<a href="#l12.912"></a><span id="l12.912" class="difflineplus">+      Services.cache2.asyncGetDiskConsumption(this.observer);</span>
<a href="#l12.913"></a><span id="l12.913" class="difflineplus">+    } catch (e) {}</span>
<a href="#l12.914"></a><span id="l12.914" class="difflineplus">+  },</span>
<a href="#l12.915"></a><span id="l12.915" class="difflineplus">+</span>
<a href="#l12.916"></a><span id="l12.916" class="difflineplus">+  updateCacheSizeUI(smartSizeEnabled) {</span>
<a href="#l12.917"></a><span id="l12.917" class="difflineplus">+    document.getElementById(&quot;useCacheBefore&quot;).disabled = smartSizeEnabled;</span>
<a href="#l12.918"></a><span id="l12.918" class="difflineplus">+    document.getElementById(&quot;cacheSize&quot;).disabled = smartSizeEnabled;</span>
<a href="#l12.919"></a><span id="l12.919" class="difflineplus">+    document.getElementById(&quot;useCacheAfter&quot;).disabled = smartSizeEnabled;</span>
<a href="#l12.920"></a><span id="l12.920" class="difflineplus">+  },</span>
<a href="#l12.921"></a><span id="l12.921" class="difflineplus">+</span>
<a href="#l12.922"></a><span id="l12.922" class="difflineplus">+  readSmartSizeEnabled() {</span>
<a href="#l12.923"></a><span id="l12.923" class="difflineplus">+    // The smart_size.enabled preference element is inverted=&quot;true&quot;, so its</span>
<a href="#l12.924"></a><span id="l12.924" class="difflineplus">+    // value is the opposite of the actual pref value</span>
<a href="#l12.925"></a><span id="l12.925" class="difflineplus">+    var disabled = Preferences.get(&quot;browser.cache.disk.smart_size.enabled&quot;).value;</span>
<a href="#l12.926"></a><span id="l12.926" class="difflineplus">+    this.updateCacheSizeUI(!disabled);</span>
<a href="#l12.927"></a><span id="l12.927" class="difflineplus">+  },</span>
<a href="#l12.928"></a><span id="l12.928" class="difflineplus">+</span>
<a href="#l12.929"></a><span id="l12.929" class="difflineplus">+  /**</span>
<a href="#l12.930"></a><span id="l12.930" class="difflineplus">+   * Converts the cache size from units of KB to units of MB and returns that</span>
<a href="#l12.931"></a><span id="l12.931" class="difflineplus">+   * value.</span>
<a href="#l12.932"></a><span id="l12.932" class="difflineplus">+   */</span>
<a href="#l12.933"></a><span id="l12.933" class="difflineplus">+  readCacheSize() {</span>
<a href="#l12.934"></a><span id="l12.934" class="difflineplus">+    var preference = Preferences.get(&quot;browser.cache.disk.capacity&quot;);</span>
<a href="#l12.935"></a><span id="l12.935" class="difflineplus">+    return preference.value / 1024;</span>
<a href="#l12.936"></a><span id="l12.936" class="difflineplus">+  },</span>
<a href="#l12.937"></a><span id="l12.937" class="difflineplus">+</span>
<a href="#l12.938"></a><span id="l12.938" class="difflineplus">+  /**</span>
<a href="#l12.939"></a><span id="l12.939" class="difflineplus">+   * Converts the cache size as specified in UI (in MB) to KB and returns that</span>
<a href="#l12.940"></a><span id="l12.940" class="difflineplus">+   * value.</span>
<a href="#l12.941"></a><span id="l12.941" class="difflineplus">+   */</span>
<a href="#l12.942"></a><span id="l12.942" class="difflineplus">+  writeCacheSize() {</span>
<a href="#l12.943"></a><span id="l12.943" class="difflineplus">+    var cacheSize = document.getElementById(&quot;cacheSize&quot;);</span>
<a href="#l12.944"></a><span id="l12.944" class="difflineplus">+    var intValue = parseInt(cacheSize.value, 10);</span>
<a href="#l12.945"></a><span id="l12.945" class="difflineplus">+    return isNaN(intValue) ? 0 : intValue * 1024;</span>
<a href="#l12.946"></a><span id="l12.946" class="difflineplus">+  },</span>
<a href="#l12.947"></a><span id="l12.947" class="difflineplus">+</span>
<a href="#l12.948"></a><span id="l12.948" class="difflineplus">+  /**</span>
<a href="#l12.949"></a><span id="l12.949" class="difflineplus">+   * Clears the cache.</span>
<a href="#l12.950"></a><span id="l12.950" class="difflineplus">+   */</span>
<a href="#l12.951"></a><span id="l12.951" class="difflineplus">+  clearCache() {</span>
<a href="#l12.952"></a><span id="l12.952" class="difflineplus">+    try {</span>
<a href="#l12.953"></a><span id="l12.953" class="difflineplus">+      Services.cache2.clear();</span>
<a href="#l12.954"></a><span id="l12.954" class="difflineplus">+    } catch (ex) {}</span>
<a href="#l12.955"></a><span id="l12.955" class="difflineplus">+    this.updateActualCacheSize();</span>
<a href="#l12.956"></a><span id="l12.956" class="difflineplus">+  },</span>
<a href="#l12.957"></a><span id="l12.957" class="difflineplus">+</span>
<a href="#l12.958"></a><span id="l12.958" class="difflineplus">+  updateCompactOptions() {</span>
<a href="#l12.959"></a><span id="l12.959" class="difflineplus">+    document.getElementById(&quot;offlineCompactFolderMin&quot;).disabled =</span>
<a href="#l12.960"></a><span id="l12.960" class="difflineplus">+      !Preferences.get(&quot;mail.prompt_purge_threshhold&quot;).value ||</span>
<a href="#l12.961"></a><span id="l12.961" class="difflineplus">+      Preferences.get(&quot;mail.purge_threshhold_mb&quot;).locked;</span>
<a href="#l12.962"></a><span id="l12.962" class="difflineplus">+  },</span>
<a href="#l12.963"></a><span id="l12.963" class="difflineplus">+</span>
<a href="#l12.964"></a><span id="l12.964" class="difflineplus">+  /**</span>
<a href="#l12.965"></a><span id="l12.965" class="difflineplus">+   * Set the default store contract ID.</span>
<a href="#l12.966"></a><span id="l12.966" class="difflineplus">+   */</span>
<a href="#l12.967"></a><span id="l12.967" class="difflineplus">+  updateDefaultStore(storeID) {</span>
<a href="#l12.968"></a><span id="l12.968" class="difflineplus">+    Services.prefs.setCharPref(&quot;mail.serverDefaultStoreContractID&quot;, storeID);</span>
<a href="#l12.969"></a><span id="l12.969" class="difflineplus">+  },</span>
<a href="#l12.970"></a><span id="l12.970" class="difflineplus">+</span>
<a href="#l12.971"></a><span id="l12.971" class="difflineplus">+  /**</span>
<a href="#l12.972"></a><span id="l12.972" class="difflineplus">+   * When the user toggles the layers.acceleration.disabled pref,</span>
<a href="#l12.973"></a><span id="l12.973" class="difflineplus">+   * sync its new value to the gfx.direct2d.disabled pref too.</span>
<a href="#l12.974"></a><span id="l12.974" class="difflineplus">+   * Note that layers.acceleration.disabled is inverted.</span>
<a href="#l12.975"></a><span id="l12.975" class="difflineplus">+   */</span>
<a href="#l12.976"></a><span id="l12.976" class="difflineplus">+  updateHardwareAcceleration() {</span>
<a href="#l12.977"></a><span id="l12.977" class="difflineplus">+    if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l12.978"></a><span id="l12.978" class="difflineplus">+      let preference = Preferences.get(&quot;layers.acceleration.disabled&quot;);</span>
<a href="#l12.979"></a><span id="l12.979" class="difflineplus">+      Services.prefs.setBoolPref(&quot;gfx.direct2d.disabled&quot;, !preference.value);</span>
<a href="#l12.980"></a><span id="l12.980" class="difflineplus">+    }</span>
<a href="#l12.981"></a><span id="l12.981" class="difflineplus">+  },</span>
<a href="#l12.982"></a><span id="l12.982" class="difflineplus">+</span>
<a href="#l12.983"></a><span id="l12.983" class="difflineplus">+  /**</span>
<a href="#l12.984"></a><span id="l12.984" class="difflineplus">+   * Selects the correct item in the update radio group</span>
<a href="#l12.985"></a><span id="l12.985" class="difflineplus">+   */</span>
<a href="#l12.986"></a><span id="l12.986" class="difflineplus">+  async updateReadPrefs() {</span>
<a href="#l12.987"></a><span id="l12.987" class="difflineplus">+    if (AppConstants.MOZ_UPDATER &amp;&amp;</span>
<a href="#l12.988"></a><span id="l12.988" class="difflineplus">+        (!Services.policies || Services.policies.isAllowed(&quot;appUpdate&quot;))) {</span>
<a href="#l12.989"></a><span id="l12.989" class="difflineplus">+      let radiogroup = document.getElementById(&quot;updateRadioGroup&quot;);</span>
<a href="#l12.990"></a><span id="l12.990" class="difflineplus">+      radiogroup.disabled = true;</span>
<a href="#l12.991"></a><span id="l12.991" class="difflineplus">+      try {</span>
<a href="#l12.992"></a><span id="l12.992" class="difflineplus">+        let enabled = await UpdateUtils.getAppUpdateAutoEnabled();</span>
<a href="#l12.993"></a><span id="l12.993" class="difflineplus">+        radiogroup.value = enabled;</span>
<a href="#l12.994"></a><span id="l12.994" class="difflineplus">+        radiogroup.disabled = false;</span>
<a href="#l12.995"></a><span id="l12.995" class="difflineplus">+      } catch (error) {</span>
<a href="#l12.996"></a><span id="l12.996" class="difflineplus">+        Cu.reportError(error);</span>
<a href="#l12.997"></a><span id="l12.997" class="difflineplus">+      }</span>
<a href="#l12.998"></a><span id="l12.998" class="difflineplus">+    }</span>
<a href="#l12.999"></a><span id="l12.999" class="difflineplus">+  },</span>
<a href="#l12.1000"></a><span id="l12.1000" class="difflineplus">+</span>
<a href="#l12.1001"></a><span id="l12.1001" class="difflineplus">+  /**</span>
<a href="#l12.1002"></a><span id="l12.1002" class="difflineplus">+   * Writes the value of the update radio group to the disk</span>
<a href="#l12.1003"></a><span id="l12.1003" class="difflineplus">+   */</span>
<a href="#l12.1004"></a><span id="l12.1004" class="difflineplus">+  async updateWritePrefs() {</span>
<a href="#l12.1005"></a><span id="l12.1005" class="difflineplus">+    if (AppConstants.MOZ_UPDATER &amp;&amp;</span>
<a href="#l12.1006"></a><span id="l12.1006" class="difflineplus">+        (!Services.policies || Services.policies.isAllowed(&quot;appUpdate&quot;))) {</span>
<a href="#l12.1007"></a><span id="l12.1007" class="difflineplus">+      let radiogroup = document.getElementById(&quot;updateRadioGroup&quot;);</span>
<a href="#l12.1008"></a><span id="l12.1008" class="difflineplus">+      let updateAutoValue = (radiogroup.value == &quot;true&quot;);</span>
<a href="#l12.1009"></a><span id="l12.1009" class="difflineplus">+      radiogroup.disabled = true;</span>
<a href="#l12.1010"></a><span id="l12.1010" class="difflineplus">+      try {</span>
<a href="#l12.1011"></a><span id="l12.1011" class="difflineplus">+        await UpdateUtils.setAppUpdateAutoEnabled(updateAutoValue);</span>
<a href="#l12.1012"></a><span id="l12.1012" class="difflineplus">+        radiogroup.disabled = false;</span>
<a href="#l12.1013"></a><span id="l12.1013" class="difflineplus">+      } catch (error) {</span>
<a href="#l12.1014"></a><span id="l12.1014" class="difflineplus">+        Cu.reportError(error);</span>
<a href="#l12.1015"></a><span id="l12.1015" class="difflineplus">+        await this.updateReadPrefs();</span>
<a href="#l12.1016"></a><span id="l12.1016" class="difflineplus">+        await this.reportUpdatePrefWriteError(error);</span>
<a href="#l12.1017"></a><span id="l12.1017" class="difflineplus">+        return;</span>
<a href="#l12.1018"></a><span id="l12.1018" class="difflineplus">+      }</span>
<a href="#l12.1019"></a><span id="l12.1019" class="difflineplus">+</span>
<a href="#l12.1020"></a><span id="l12.1020" class="difflineplus">+      // If the value was changed to false the user should be given the option</span>
<a href="#l12.1021"></a><span id="l12.1021" class="difflineplus">+      // to discard an update if there is one.</span>
<a href="#l12.1022"></a><span id="l12.1022" class="difflineplus">+      if (!updateAutoValue) {</span>
<a href="#l12.1023"></a><span id="l12.1023" class="difflineplus">+        await this.checkUpdateInProgress();</span>
<a href="#l12.1024"></a><span id="l12.1024" class="difflineplus">+      }</span>
<a href="#l12.1025"></a><span id="l12.1025" class="difflineplus">+    }</span>
<a href="#l12.1026"></a><span id="l12.1026" class="difflineplus">+  },</span>
<a href="#l12.1027"></a><span id="l12.1027" class="difflineplus">+</span>
<a href="#l12.1028"></a><span id="l12.1028" class="difflineplus">+  async reportUpdatePrefWriteError(error) {</span>
<a href="#l12.1029"></a><span id="l12.1029" class="difflineplus">+    let [title, message] = await document.l10n.formatValues([</span>
<a href="#l12.1030"></a><span id="l12.1030" class="difflineplus">+      {id: &quot;update-setting-write-failure-title&quot;},</span>
<a href="#l12.1031"></a><span id="l12.1031" class="difflineplus">+      {id: &quot;update-setting-write-failure-message&quot;, args: {path: error.path}},</span>
<a href="#l12.1032"></a><span id="l12.1032" class="difflineplus">+    ]);</span>
<a href="#l12.1033"></a><span id="l12.1033" class="difflineplus">+</span>
<a href="#l12.1034"></a><span id="l12.1034" class="difflineplus">+    // Set up the Ok Button</span>
<a href="#l12.1035"></a><span id="l12.1035" class="difflineplus">+    let buttonFlags = (Services.prompt.BUTTON_POS_0 *</span>
<a href="#l12.1036"></a><span id="l12.1036" class="difflineplus">+                       Services.prompt.BUTTON_TITLE_OK);</span>
<a href="#l12.1037"></a><span id="l12.1037" class="difflineplus">+    Services.prompt.confirmEx(window, title, message, buttonFlags,</span>
<a href="#l12.1038"></a><span id="l12.1038" class="difflineplus">+                              null, null, null, null, {});</span>
<a href="#l12.1039"></a><span id="l12.1039" class="difflineplus">+  },</span>
<a href="#l12.1040"></a><span id="l12.1040" class="difflineplus">+</span>
<a href="#l12.1041"></a><span id="l12.1041" class="difflineplus">+  async checkUpdateInProgress() {</span>
<a href="#l12.1042"></a><span id="l12.1042" class="difflineplus">+    let um = Cc[&quot;@mozilla.org/updates/update-manager;1&quot;].</span>
<a href="#l12.1043"></a><span id="l12.1043" class="difflineplus">+             getService(Ci.nsIUpdateManager);</span>
<a href="#l12.1044"></a><span id="l12.1044" class="difflineplus">+    if (!um.activeUpdate) {</span>
<a href="#l12.1045"></a><span id="l12.1045" class="difflineplus">+      return;</span>
<a href="#l12.1046"></a><span id="l12.1046" class="difflineplus">+    }</span>
<a href="#l12.1047"></a><span id="l12.1047" class="difflineplus">+</span>
<a href="#l12.1048"></a><span id="l12.1048" class="difflineplus">+    let [</span>
<a href="#l12.1049"></a><span id="l12.1049" class="difflineplus">+      title, message, okButton, cancelButton,</span>
<a href="#l12.1050"></a><span id="l12.1050" class="difflineplus">+    ] = await document.l10n.formatValues([</span>
<a href="#l12.1051"></a><span id="l12.1051" class="difflineplus">+      {id: &quot;update-in-progress-title&quot;},</span>
<a href="#l12.1052"></a><span id="l12.1052" class="difflineplus">+      {id: &quot;update-in-progress-message&quot;},</span>
<a href="#l12.1053"></a><span id="l12.1053" class="difflineplus">+      {id: &quot;update-in-progress-ok-button&quot;},</span>
<a href="#l12.1054"></a><span id="l12.1054" class="difflineplus">+      {id: &quot;update-in-progress-cancel-button&quot;},</span>
<a href="#l12.1055"></a><span id="l12.1055" class="difflineplus">+    ]);</span>
<a href="#l12.1056"></a><span id="l12.1056" class="difflineplus">+</span>
<a href="#l12.1057"></a><span id="l12.1057" class="difflineplus">+    // Continue is the cancel button which is BUTTON_POS_1 and is set as the</span>
<a href="#l12.1058"></a><span id="l12.1058" class="difflineplus">+    // default so pressing escape or using a platform standard method of closing</span>
<a href="#l12.1059"></a><span id="l12.1059" class="difflineplus">+    // the UI will not discard the update.</span>
<a href="#l12.1060"></a><span id="l12.1060" class="difflineplus">+    let buttonFlags =</span>
<a href="#l12.1061"></a><span id="l12.1061" class="difflineplus">+      (Ci.nsIPrompt.BUTTON_TITLE_IS_STRING * Ci.nsIPrompt.BUTTON_POS_0) +</span>
<a href="#l12.1062"></a><span id="l12.1062" class="difflineplus">+      (Ci.nsIPrompt.BUTTON_TITLE_IS_STRING * Ci.nsIPrompt.BUTTON_POS_1) +</span>
<a href="#l12.1063"></a><span id="l12.1063" class="difflineplus">+      Ci.nsIPrompt.BUTTON_POS_1_DEFAULT;</span>
<a href="#l12.1064"></a><span id="l12.1064" class="difflineplus">+</span>
<a href="#l12.1065"></a><span id="l12.1065" class="difflineplus">+    let rv = Services.prompt.confirmEx(window, title, message, buttonFlags,</span>
<a href="#l12.1066"></a><span id="l12.1066" class="difflineplus">+      okButton, cancelButton, null, null, {});</span>
<a href="#l12.1067"></a><span id="l12.1067" class="difflineplus">+    if (rv != 1) {</span>
<a href="#l12.1068"></a><span id="l12.1068" class="difflineplus">+      let aus = Cc[&quot;@mozilla.org/updates/update-service;1&quot;].</span>
<a href="#l12.1069"></a><span id="l12.1069" class="difflineplus">+                getService(Ci.nsIApplicationUpdateService);</span>
<a href="#l12.1070"></a><span id="l12.1070" class="difflineplus">+      aus.stopDownload();</span>
<a href="#l12.1071"></a><span id="l12.1071" class="difflineplus">+      um.cleanupActiveUpdate();</span>
<a href="#l12.1072"></a><span id="l12.1072" class="difflineplus">+    }</span>
<a href="#l12.1073"></a><span id="l12.1073" class="difflineplus">+  },</span>
<a href="#l12.1074"></a><span id="l12.1074" class="difflineplus">+</span>
<a href="#l12.1075"></a><span id="l12.1075" class="difflineplus">+  showUpdates() {</span>
<a href="#l12.1076"></a><span id="l12.1076" class="difflineplus">+    gSubDialog.open(&quot;chrome://mozapps/content/update/history.xul&quot;);</span>
<a href="#l12.1077"></a><span id="l12.1077" class="difflineplus">+  },</span>
<a href="#l12.1078"></a><span id="l12.1078" class="difflineplus">+</span>
<a href="#l12.1079"></a><span id="l12.1079" class="difflineplus">+  _loadAppHandlerData() {</span>
<a href="#l12.1080"></a><span id="l12.1080" class="difflineplus">+    this._loadApplicationHandlers();</span>
<a href="#l12.1081"></a><span id="l12.1081" class="difflineplus">+  },</span>
<a href="#l12.1082"></a><span id="l12.1082" class="difflineplus">+</span>
<a href="#l12.1083"></a><span id="l12.1083" class="difflineplus">+  /**</span>
<a href="#l12.1084"></a><span id="l12.1084" class="difflineplus">+   * Load the set of handlers defined by the application datastore.</span>
<a href="#l12.1085"></a><span id="l12.1085" class="difflineplus">+   */</span>
<a href="#l12.1086"></a><span id="l12.1086" class="difflineplus">+  _loadApplicationHandlers() {</span>
<a href="#l12.1087"></a><span id="l12.1087" class="difflineplus">+    var wrappedHandlerInfos = gHandlerService.enumerate();</span>
<a href="#l12.1088"></a><span id="l12.1088" class="difflineplus">+    while (wrappedHandlerInfos.hasMoreElements()) {</span>
<a href="#l12.1089"></a><span id="l12.1089" class="difflineplus">+      let wrappedHandlerInfo =</span>
<a href="#l12.1090"></a><span id="l12.1090" class="difflineplus">+        wrappedHandlerInfos.getNext().QueryInterface(Ci.nsIHandlerInfo);</span>
<a href="#l12.1091"></a><span id="l12.1091" class="difflineplus">+      let type = wrappedHandlerInfo.type;</span>
<a href="#l12.1092"></a><span id="l12.1092" class="difflineplus">+</span>
<a href="#l12.1093"></a><span id="l12.1093" class="difflineplus">+      let handlerInfoWrapper;</span>
<a href="#l12.1094"></a><span id="l12.1094" class="difflineplus">+      if (type in this._handledTypes) {</span>
<a href="#l12.1095"></a><span id="l12.1095" class="difflineplus">+        handlerInfoWrapper = this._handledTypes[type];</span>
<a href="#l12.1096"></a><span id="l12.1096" class="difflineplus">+      } else {</span>
<a href="#l12.1097"></a><span id="l12.1097" class="difflineplus">+        handlerInfoWrapper = new HandlerInfoWrapper(type, wrappedHandlerInfo);</span>
<a href="#l12.1098"></a><span id="l12.1098" class="difflineplus">+        this._handledTypes[type] = handlerInfoWrapper;</span>
<a href="#l12.1099"></a><span id="l12.1099" class="difflineplus">+      }</span>
<a href="#l12.1100"></a><span id="l12.1100" class="difflineplus">+    }</span>
<a href="#l12.1101"></a><span id="l12.1101" class="difflineplus">+  },</span>
<a href="#l12.1102"></a><span id="l12.1102" class="difflineplus">+</span>
<a href="#l12.1103"></a><span id="l12.1103" class="difflineplus">+  // -----------------</span>
<a href="#l12.1104"></a><span id="l12.1104" class="difflineplus">+  // View Construction</span>
<a href="#l12.1105"></a><span id="l12.1105" class="difflineplus">+</span>
<a href="#l12.1106"></a><span id="l12.1106" class="difflineplus">+  selectedHandlerListItem: null,</span>
<a href="#l12.1107"></a><span id="l12.1107" class="difflineplus">+</span>
<a href="#l12.1108"></a><span id="l12.1108" class="difflineplus">+  _initListEventHandlers() {</span>
<a href="#l12.1109"></a><span id="l12.1109" class="difflineplus">+    this._list.addEventListener(&quot;select&quot;, event =&gt; {</span>
<a href="#l12.1110"></a><span id="l12.1110" class="difflineplus">+      if (event.target != this._list) {</span>
<a href="#l12.1111"></a><span id="l12.1111" class="difflineplus">+        return;</span>
<a href="#l12.1112"></a><span id="l12.1112" class="difflineplus">+      }</span>
<a href="#l12.1113"></a><span id="l12.1113" class="difflineplus">+</span>
<a href="#l12.1114"></a><span id="l12.1114" class="difflineplus">+      let handlerListItem = this._list.selectedItem &amp;&amp;</span>
<a href="#l12.1115"></a><span id="l12.1115" class="difflineplus">+                            HandlerListItem.forNode(this._list.selectedItem);</span>
<a href="#l12.1116"></a><span id="l12.1116" class="difflineplus">+      if (this.selectedHandlerListItem == handlerListItem) {</span>
<a href="#l12.1117"></a><span id="l12.1117" class="difflineplus">+        return;</span>
<a href="#l12.1118"></a><span id="l12.1118" class="difflineplus">+      }</span>
<a href="#l12.1119"></a><span id="l12.1119" class="difflineplus">+</span>
<a href="#l12.1120"></a><span id="l12.1120" class="difflineplus">+      if (this.selectedHandlerListItem) {</span>
<a href="#l12.1121"></a><span id="l12.1121" class="difflineplus">+        this.selectedHandlerListItem.showActionsMenu = false;</span>
<a href="#l12.1122"></a><span id="l12.1122" class="difflineplus">+      }</span>
<a href="#l12.1123"></a><span id="l12.1123" class="difflineplus">+      this.selectedHandlerListItem = handlerListItem;</span>
<a href="#l12.1124"></a><span id="l12.1124" class="difflineplus">+      if (handlerListItem) {</span>
<a href="#l12.1125"></a><span id="l12.1125" class="difflineplus">+        this.rebuildActionsMenu();</span>
<a href="#l12.1126"></a><span id="l12.1126" class="difflineplus">+        handlerListItem.showActionsMenu = true;</span>
<a href="#l12.1127"></a><span id="l12.1127" class="difflineplus">+      }</span>
<a href="#l12.1128"></a><span id="l12.1128" class="difflineplus">+    });</span>
<a href="#l12.1129"></a><span id="l12.1129" class="difflineplus">+  },</span>
<a href="#l12.1130"></a><span id="l12.1130" class="difflineplus">+</span>
<a href="#l12.1131"></a><span id="l12.1131" class="difflineplus">+  _rebuildVisibleTypes() {</span>
<a href="#l12.1132"></a><span id="l12.1132" class="difflineplus">+    // Reset the list of visible types and the visible type description.</span>
<a href="#l12.1133"></a><span id="l12.1133" class="difflineplus">+    this._visibleTypes.length = 0;</span>
<a href="#l12.1134"></a><span id="l12.1134" class="difflineplus">+    this._visibleDescriptions.clear();</span>
<a href="#l12.1135"></a><span id="l12.1135" class="difflineplus">+</span>
<a href="#l12.1136"></a><span id="l12.1136" class="difflineplus">+    for (let type in this._handledTypes) {</span>
<a href="#l12.1137"></a><span id="l12.1137" class="difflineplus">+      let handlerInfo = this._handledTypes[type];</span>
<a href="#l12.1138"></a><span id="l12.1138" class="difflineplus">+</span>
<a href="#l12.1139"></a><span id="l12.1139" class="difflineplus">+      // We couldn't find any reason to exclude the type, so include it.</span>
<a href="#l12.1140"></a><span id="l12.1140" class="difflineplus">+      this._visibleTypes.push(handlerInfo);</span>
<a href="#l12.1141"></a><span id="l12.1141" class="difflineplus">+</span>
<a href="#l12.1142"></a><span id="l12.1142" class="difflineplus">+      let otherHandlerInfo = this._visibleDescriptions</span>
<a href="#l12.1143"></a><span id="l12.1143" class="difflineplus">+                                 .get(handlerInfo.description);</span>
<a href="#l12.1144"></a><span id="l12.1144" class="difflineplus">+      if (!otherHandlerInfo) {</span>
<a href="#l12.1145"></a><span id="l12.1145" class="difflineplus">+        // This is the first type with this description that we encountered</span>
<a href="#l12.1146"></a><span id="l12.1146" class="difflineplus">+        // while rebuilding the _visibleTypes array this time. Make sure the</span>
<a href="#l12.1147"></a><span id="l12.1147" class="difflineplus">+        // flag is reset so we won't add the type to the description.</span>
<a href="#l12.1148"></a><span id="l12.1148" class="difflineplus">+        handlerInfo.disambiguateDescription = false;</span>
<a href="#l12.1149"></a><span id="l12.1149" class="difflineplus">+        this._visibleDescriptions.set(handlerInfo.description, handlerInfo);</span>
<a href="#l12.1150"></a><span id="l12.1150" class="difflineplus">+      } else {</span>
<a href="#l12.1151"></a><span id="l12.1151" class="difflineplus">+        // There is at least another type with this description. Make sure we</span>
<a href="#l12.1152"></a><span id="l12.1152" class="difflineplus">+        // add the type to the description on both HandlerInfoWrapper objects.</span>
<a href="#l12.1153"></a><span id="l12.1153" class="difflineplus">+        handlerInfo.disambiguateDescription = true;</span>
<a href="#l12.1154"></a><span id="l12.1154" class="difflineplus">+        otherHandlerInfo.disambiguateDescription = true;</span>
<a href="#l12.1155"></a><span id="l12.1155" class="difflineplus">+      }</span>
<a href="#l12.1156"></a><span id="l12.1156" class="difflineplus">+    }</span>
<a href="#l12.1157"></a><span id="l12.1157" class="difflineplus">+  },</span>
<a href="#l12.1158"></a><span id="l12.1158" class="difflineplus">+</span>
<a href="#l12.1159"></a><span id="l12.1159" class="difflineplus">+  _rebuildView() {</span>
<a href="#l12.1160"></a><span id="l12.1160" class="difflineplus">+    let lastSelectedType = this.selectedHandlerListItem &amp;&amp;</span>
<a href="#l12.1161"></a><span id="l12.1161" class="difflineplus">+                           this.selectedHandlerListItem.handlerInfoWrapper.type;</span>
<a href="#l12.1162"></a><span id="l12.1162" class="difflineplus">+    this.selectedHandlerListItem = null;</span>
<a href="#l12.1163"></a><span id="l12.1163" class="difflineplus">+</span>
<a href="#l12.1164"></a><span id="l12.1164" class="difflineplus">+    // Clear the list of entries.</span>
<a href="#l12.1165"></a><span id="l12.1165" class="difflineplus">+    this._list.textContent = &quot;&quot;;</span>
<a href="#l12.1166"></a><span id="l12.1166" class="difflineplus">+</span>
<a href="#l12.1167"></a><span id="l12.1167" class="difflineplus">+    var visibleTypes = this._visibleTypes;</span>
<a href="#l12.1168"></a><span id="l12.1168" class="difflineplus">+</span>
<a href="#l12.1169"></a><span id="l12.1169" class="difflineplus">+    // If the user is filtering the list, then only show matching types.</span>
<a href="#l12.1170"></a><span id="l12.1170" class="difflineplus">+    if (this._filter.value)</span>
<a href="#l12.1171"></a><span id="l12.1171" class="difflineplus">+      visibleTypes = visibleTypes.filter(this._matchesFilter, this);</span>
<a href="#l12.1172"></a><span id="l12.1172" class="difflineplus">+</span>
<a href="#l12.1173"></a><span id="l12.1173" class="difflineplus">+    for (let visibleType of visibleTypes) {</span>
<a href="#l12.1174"></a><span id="l12.1174" class="difflineplus">+      let item = new HandlerListItem(visibleType);</span>
<a href="#l12.1175"></a><span id="l12.1175" class="difflineplus">+      item.connectAndAppendToList(this._list);</span>
<a href="#l12.1176"></a><span id="l12.1176" class="difflineplus">+</span>
<a href="#l12.1177"></a><span id="l12.1177" class="difflineplus">+      if (visibleType.type === lastSelectedType) {</span>
<a href="#l12.1178"></a><span id="l12.1178" class="difflineplus">+        this._list.selectedItem = item.node;</span>
<a href="#l12.1179"></a><span id="l12.1179" class="difflineplus">+      }</span>
<a href="#l12.1180"></a><span id="l12.1180" class="difflineplus">+    }</span>
<a href="#l12.1181"></a><span id="l12.1181" class="difflineplus">+  },</span>
<a href="#l12.1182"></a><span id="l12.1182" class="difflineplus">+</span>
<a href="#l12.1183"></a><span id="l12.1183" class="difflineplus">+  _matchesFilter(aType) {</span>
<a href="#l12.1184"></a><span id="l12.1184" class="difflineplus">+    var filterValue = this._filter.value.toLowerCase();</span>
<a href="#l12.1185"></a><span id="l12.1185" class="difflineplus">+    return aType.typeDescription.toLowerCase().includes(filterValue) ||</span>
<a href="#l12.1186"></a><span id="l12.1186" class="difflineplus">+           aType.actionDescription.toLowerCase().includes(filterValue);</span>
<a href="#l12.1187"></a><span id="l12.1187" class="difflineplus">+  },</span>
<a href="#l12.1188"></a><span id="l12.1188" class="difflineplus">+</span>
<a href="#l12.1189"></a><span id="l12.1189" class="difflineplus">+ /**</span>
<a href="#l12.1190"></a><span id="l12.1190" class="difflineplus">+  * Get the details for the type represented by the given handler info</span>
<a href="#l12.1191"></a><span id="l12.1191" class="difflineplus">+  * object.</span>
<a href="#l12.1192"></a><span id="l12.1192" class="difflineplus">+  *</span>
<a href="#l12.1193"></a><span id="l12.1193" class="difflineplus">+  * @param aHandlerInfo {nsIHandlerInfo} the type to get the extensions for.</span>
<a href="#l12.1194"></a><span id="l12.1194" class="difflineplus">+  * @return {string} the extensions for the type</span>
<a href="#l12.1195"></a><span id="l12.1195" class="difflineplus">+  */</span>
<a href="#l12.1196"></a><span id="l12.1196" class="difflineplus">+  _typeDetails(aHandlerInfo) {</span>
<a href="#l12.1197"></a><span id="l12.1197" class="difflineplus">+    let exts = [];</span>
<a href="#l12.1198"></a><span id="l12.1198" class="difflineplus">+    if (aHandlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) {</span>
<a href="#l12.1199"></a><span id="l12.1199" class="difflineplus">+      let extIter = aHandlerInfo.wrappedHandlerInfo.getFileExtensions();</span>
<a href="#l12.1200"></a><span id="l12.1200" class="difflineplus">+      while (extIter.hasMore()) {</span>
<a href="#l12.1201"></a><span id="l12.1201" class="difflineplus">+        let ext = &quot;.&quot; + extIter.getNext();</span>
<a href="#l12.1202"></a><span id="l12.1202" class="difflineplus">+        if (!exts.includes(ext))</span>
<a href="#l12.1203"></a><span id="l12.1203" class="difflineplus">+          exts.push(ext);</span>
<a href="#l12.1204"></a><span id="l12.1204" class="difflineplus">+      }</span>
<a href="#l12.1205"></a><span id="l12.1205" class="difflineplus">+    }</span>
<a href="#l12.1206"></a><span id="l12.1206" class="difflineplus">+    exts.sort();</span>
<a href="#l12.1207"></a><span id="l12.1207" class="difflineplus">+    exts = exts.join(&quot;, &quot;);</span>
<a href="#l12.1208"></a><span id="l12.1208" class="difflineplus">+    if (this._visibleDescriptions.has(aHandlerInfo.description)) {</span>
<a href="#l12.1209"></a><span id="l12.1209" class="difflineplus">+      if (exts)</span>
<a href="#l12.1210"></a><span id="l12.1210" class="difflineplus">+        return this._prefsBundle.getFormattedString(&quot;typeDetailsWithTypeAndExt&quot;,</span>
<a href="#l12.1211"></a><span id="l12.1211" class="difflineplus">+                                                    [aHandlerInfo.type,</span>
<a href="#l12.1212"></a><span id="l12.1212" class="difflineplus">+                                                     exts]);</span>
<a href="#l12.1213"></a><span id="l12.1213" class="difflineplus">+      return this._prefsBundle.getFormattedString(&quot;typeDetailsWithTypeOrExt&quot;,</span>
<a href="#l12.1214"></a><span id="l12.1214" class="difflineplus">+                                                  [ aHandlerInfo.type]);</span>
<a href="#l12.1215"></a><span id="l12.1215" class="difflineplus">+    }</span>
<a href="#l12.1216"></a><span id="l12.1216" class="difflineplus">+    if (exts)</span>
<a href="#l12.1217"></a><span id="l12.1217" class="difflineplus">+      return this._prefsBundle.getFormattedString(&quot;typeDetailsWithTypeOrExt&quot;,</span>
<a href="#l12.1218"></a><span id="l12.1218" class="difflineplus">+                                                  [exts]);</span>
<a href="#l12.1219"></a><span id="l12.1219" class="difflineplus">+    return exts;</span>
<a href="#l12.1220"></a><span id="l12.1220" class="difflineplus">+  },</span>
<a href="#l12.1221"></a><span id="l12.1221" class="difflineplus">+</span>
<a href="#l12.1222"></a><span id="l12.1222" class="difflineplus">+  /**</span>
<a href="#l12.1223"></a><span id="l12.1223" class="difflineplus">+   * Whether or not the given handler app is valid.</span>
<a href="#l12.1224"></a><span id="l12.1224" class="difflineplus">+   * @param aHandlerApp {nsIHandlerApp} the handler app in question</span>
<a href="#l12.1225"></a><span id="l12.1225" class="difflineplus">+   * @return {boolean} whether or not it's valid</span>
<a href="#l12.1226"></a><span id="l12.1226" class="difflineplus">+   */</span>
<a href="#l12.1227"></a><span id="l12.1227" class="difflineplus">+  isValidHandlerApp(aHandlerApp) {</span>
<a href="#l12.1228"></a><span id="l12.1228" class="difflineplus">+    if (!aHandlerApp)</span>
<a href="#l12.1229"></a><span id="l12.1229" class="difflineplus">+      return false;</span>
<a href="#l12.1230"></a><span id="l12.1230" class="difflineplus">+</span>
<a href="#l12.1231"></a><span id="l12.1231" class="difflineplus">+    if (aHandlerApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l12.1232"></a><span id="l12.1232" class="difflineplus">+      return this._isValidHandlerExecutable(aHandlerApp.executable);</span>
<a href="#l12.1233"></a><span id="l12.1233" class="difflineplus">+</span>
<a href="#l12.1234"></a><span id="l12.1234" class="difflineplus">+    if (aHandlerApp instanceof Ci.nsIWebHandlerApp)</span>
<a href="#l12.1235"></a><span id="l12.1235" class="difflineplus">+      return aHandlerApp.uriTemplate;</span>
<a href="#l12.1236"></a><span id="l12.1236" class="difflineplus">+</span>
<a href="#l12.1237"></a><span id="l12.1237" class="difflineplus">+    if (aHandlerApp instanceof Ci.nsIWebContentHandlerInfo)</span>
<a href="#l12.1238"></a><span id="l12.1238" class="difflineplus">+      return aHandlerApp.uri;</span>
<a href="#l12.1239"></a><span id="l12.1239" class="difflineplus">+</span>
<a href="#l12.1240"></a><span id="l12.1240" class="difflineplus">+    return false;</span>
<a href="#l12.1241"></a><span id="l12.1241" class="difflineplus">+  },</span>
<a href="#l12.1242"></a><span id="l12.1242" class="difflineplus">+</span>
<a href="#l12.1243"></a><span id="l12.1243" class="difflineplus">+  _isValidHandlerExecutable(aExecutable) {</span>
<a href="#l12.1244"></a><span id="l12.1244" class="difflineplus">+    let isExecutable = aExecutable &amp;&amp;</span>
<a href="#l12.1245"></a><span id="l12.1245" class="difflineplus">+                       aExecutable.exists() &amp;&amp;</span>
<a href="#l12.1246"></a><span id="l12.1246" class="difflineplus">+                       aExecutable.isExecutable();</span>
<a href="#l12.1247"></a><span id="l12.1247" class="difflineplus">+// XXXben - we need to compare this with the running instance executable</span>
<a href="#l12.1248"></a><span id="l12.1248" class="difflineplus">+//          just don't know how to do that via script...</span>
<a href="#l12.1249"></a><span id="l12.1249" class="difflineplus">+// XXXmano TBD: can probably add this to nsIShellService</span>
<a href="#l12.1250"></a><span id="l12.1250" class="difflineplus">+    if (AppConstants.platform == &quot;win&quot;)</span>
<a href="#l12.1251"></a><span id="l12.1251" class="difflineplus">+      return isExecutable &amp;&amp; (aExecutable.leafName != (AppConstants.MOZ_APP_NAME + &quot;.exe&quot;));</span>
<a href="#l12.1252"></a><span id="l12.1252" class="difflineplus">+</span>
<a href="#l12.1253"></a><span id="l12.1253" class="difflineplus">+    if (AppConstants.platform == &quot;macosx&quot;)</span>
<a href="#l12.1254"></a><span id="l12.1254" class="difflineplus">+      return isExecutable &amp;&amp; (aExecutable.leafName != AppConstants.MOZ_MACBUNDLE_NAME);</span>
<a href="#l12.1255"></a><span id="l12.1255" class="difflineplus">+</span>
<a href="#l12.1256"></a><span id="l12.1256" class="difflineplus">+    return isExecutable &amp;&amp; (aExecutable.leafName != (AppConstants.MOZ_APP_NAME + &quot;-bin&quot;));</span>
<a href="#l12.1257"></a><span id="l12.1257" class="difflineplus">+  },</span>
<a href="#l12.1258"></a><span id="l12.1258" class="difflineplus">+</span>
<a href="#l12.1259"></a><span id="l12.1259" class="difflineplus">+  /**</span>
<a href="#l12.1260"></a><span id="l12.1260" class="difflineplus">+   * Rebuild the actions menu for the selected entry.  Gets called by</span>
<a href="#l12.1261"></a><span id="l12.1261" class="difflineplus">+   * the richlistitem constructor when an entry in the list gets selected.</span>
<a href="#l12.1262"></a><span id="l12.1262" class="difflineplus">+   */</span>
<a href="#l12.1263"></a><span id="l12.1263" class="difflineplus">+  rebuildActionsMenu() {</span>
<a href="#l12.1264"></a><span id="l12.1264" class="difflineplus">+    var typeItem = this._list.selectedItem;</span>
<a href="#l12.1265"></a><span id="l12.1265" class="difflineplus">+</span>
<a href="#l12.1266"></a><span id="l12.1266" class="difflineplus">+    if (!typeItem)</span>
<a href="#l12.1267"></a><span id="l12.1267" class="difflineplus">+      return;</span>
<a href="#l12.1268"></a><span id="l12.1268" class="difflineplus">+</span>
<a href="#l12.1269"></a><span id="l12.1269" class="difflineplus">+    var handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l12.1270"></a><span id="l12.1270" class="difflineplus">+    var menu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l12.1271"></a><span id="l12.1271" class="difflineplus">+    var menuPopup = menu.menupopup;</span>
<a href="#l12.1272"></a><span id="l12.1272" class="difflineplus">+</span>
<a href="#l12.1273"></a><span id="l12.1273" class="difflineplus">+    // Clear out existing items.</span>
<a href="#l12.1274"></a><span id="l12.1274" class="difflineplus">+    while (menuPopup.hasChildNodes())</span>
<a href="#l12.1275"></a><span id="l12.1275" class="difflineplus">+      menuPopup.lastChild.remove();</span>
<a href="#l12.1276"></a><span id="l12.1276" class="difflineplus">+</span>
<a href="#l12.1277"></a><span id="l12.1277" class="difflineplus">+    var askMenuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1278"></a><span id="l12.1278" class="difflineplus">+    askMenuItem.setAttribute(&quot;alwaysAsk&quot;, &quot;true&quot;);</span>
<a href="#l12.1279"></a><span id="l12.1279" class="difflineplus">+    {</span>
<a href="#l12.1280"></a><span id="l12.1280" class="difflineplus">+      let label = this._prefsBundle.getString(&quot;alwaysAsk&quot;);</span>
<a href="#l12.1281"></a><span id="l12.1281" class="difflineplus">+      askMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.1282"></a><span id="l12.1282" class="difflineplus">+      askMenuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l12.1283"></a><span id="l12.1283" class="difflineplus">+      askMenuItem.setAttribute(APP_ICON_ATTR_NAME, &quot;ask&quot;);</span>
<a href="#l12.1284"></a><span id="l12.1284" class="difflineplus">+      menuPopup.appendChild(askMenuItem);</span>
<a href="#l12.1285"></a><span id="l12.1285" class="difflineplus">+    }</span>
<a href="#l12.1286"></a><span id="l12.1286" class="difflineplus">+</span>
<a href="#l12.1287"></a><span id="l12.1287" class="difflineplus">+    // Create a menu item for saving to disk.</span>
<a href="#l12.1288"></a><span id="l12.1288" class="difflineplus">+    // Note: this option isn't available to protocol types, since we don't know</span>
<a href="#l12.1289"></a><span id="l12.1289" class="difflineplus">+    // what it means to save a URL having a certain scheme to disk.</span>
<a href="#l12.1290"></a><span id="l12.1290" class="difflineplus">+    if ((handlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo)) {</span>
<a href="#l12.1291"></a><span id="l12.1291" class="difflineplus">+      var saveMenuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1292"></a><span id="l12.1292" class="difflineplus">+      saveMenuItem.setAttribute(&quot;action&quot;, Ci.nsIHandlerInfo.saveToDisk);</span>
<a href="#l12.1293"></a><span id="l12.1293" class="difflineplus">+      let label = this._prefsBundle.getString(&quot;saveFile&quot;);</span>
<a href="#l12.1294"></a><span id="l12.1294" class="difflineplus">+      saveMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.1295"></a><span id="l12.1295" class="difflineplus">+      saveMenuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l12.1296"></a><span id="l12.1296" class="difflineplus">+      saveMenuItem.setAttribute(APP_ICON_ATTR_NAME, &quot;save&quot;);</span>
<a href="#l12.1297"></a><span id="l12.1297" class="difflineplus">+      menuPopup.appendChild(saveMenuItem);</span>
<a href="#l12.1298"></a><span id="l12.1298" class="difflineplus">+    }</span>
<a href="#l12.1299"></a><span id="l12.1299" class="difflineplus">+</span>
<a href="#l12.1300"></a><span id="l12.1300" class="difflineplus">+    // Add a separator to distinguish these items from the helper app items</span>
<a href="#l12.1301"></a><span id="l12.1301" class="difflineplus">+    // that follow them.</span>
<a href="#l12.1302"></a><span id="l12.1302" class="difflineplus">+    let menuItem = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.1303"></a><span id="l12.1303" class="difflineplus">+    menuPopup.appendChild(menuItem);</span>
<a href="#l12.1304"></a><span id="l12.1304" class="difflineplus">+</span>
<a href="#l12.1305"></a><span id="l12.1305" class="difflineplus">+    // Create a menu item for the OS default application, if any.</span>
<a href="#l12.1306"></a><span id="l12.1306" class="difflineplus">+    if (handlerInfo.hasDefaultHandler) {</span>
<a href="#l12.1307"></a><span id="l12.1307" class="difflineplus">+      var defaultMenuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1308"></a><span id="l12.1308" class="difflineplus">+      defaultMenuItem.setAttribute(&quot;action&quot;, Ci.nsIHandlerInfo.useSystemDefault);</span>
<a href="#l12.1309"></a><span id="l12.1309" class="difflineplus">+      let label = this._prefsBundle.getFormattedString(&quot;useDefault&quot;,</span>
<a href="#l12.1310"></a><span id="l12.1310" class="difflineplus">+                                                       [handlerInfo.defaultDescription]);</span>
<a href="#l12.1311"></a><span id="l12.1311" class="difflineplus">+      defaultMenuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.1312"></a><span id="l12.1312" class="difflineplus">+      defaultMenuItem.setAttribute(&quot;tooltiptext&quot;, handlerInfo.defaultDescription);</span>
<a href="#l12.1313"></a><span id="l12.1313" class="difflineplus">+      defaultMenuItem.setAttribute(&quot;image&quot;, handlerInfo.iconURLForSystemDefault);</span>
<a href="#l12.1314"></a><span id="l12.1314" class="difflineplus">+</span>
<a href="#l12.1315"></a><span id="l12.1315" class="difflineplus">+      menuPopup.appendChild(defaultMenuItem);</span>
<a href="#l12.1316"></a><span id="l12.1316" class="difflineplus">+    }</span>
<a href="#l12.1317"></a><span id="l12.1317" class="difflineplus">+</span>
<a href="#l12.1318"></a><span id="l12.1318" class="difflineplus">+    // Create menu items for possible handlers.</span>
<a href="#l12.1319"></a><span id="l12.1319" class="difflineplus">+    let preferredApp = handlerInfo.preferredApplicationHandler;</span>
<a href="#l12.1320"></a><span id="l12.1320" class="difflineplus">+    let possibleApps = handlerInfo.possibleApplicationHandlers.enumerate();</span>
<a href="#l12.1321"></a><span id="l12.1321" class="difflineplus">+    var possibleAppMenuItems = [];</span>
<a href="#l12.1322"></a><span id="l12.1322" class="difflineplus">+    while (possibleApps.hasMoreElements()) {</span>
<a href="#l12.1323"></a><span id="l12.1323" class="difflineplus">+      let possibleApp = possibleApps.getNext();</span>
<a href="#l12.1324"></a><span id="l12.1324" class="difflineplus">+      if (!gGeneralPane.isValidHandlerApp(possibleApp))</span>
<a href="#l12.1325"></a><span id="l12.1325" class="difflineplus">+        continue;</span>
<a href="#l12.1326"></a><span id="l12.1326" class="difflineplus">+</span>
<a href="#l12.1327"></a><span id="l12.1327" class="difflineplus">+      let menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1328"></a><span id="l12.1328" class="difflineplus">+      menuItem.setAttribute(&quot;action&quot;, Ci.nsIHandlerInfo.useHelperApp);</span>
<a href="#l12.1329"></a><span id="l12.1329" class="difflineplus">+      let label;</span>
<a href="#l12.1330"></a><span id="l12.1330" class="difflineplus">+      if (possibleApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l12.1331"></a><span id="l12.1331" class="difflineplus">+        label = getDisplayNameForFile(possibleApp.executable);</span>
<a href="#l12.1332"></a><span id="l12.1332" class="difflineplus">+      else</span>
<a href="#l12.1333"></a><span id="l12.1333" class="difflineplus">+        label = possibleApp.name;</span>
<a href="#l12.1334"></a><span id="l12.1334" class="difflineplus">+      label = this._prefsBundle.getFormattedString(&quot;useApp&quot;, [label]);</span>
<a href="#l12.1335"></a><span id="l12.1335" class="difflineplus">+      menuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.1336"></a><span id="l12.1336" class="difflineplus">+      menuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l12.1337"></a><span id="l12.1337" class="difflineplus">+      menuItem.setAttribute(&quot;image&quot;, gGeneralPane</span>
<a href="#l12.1338"></a><span id="l12.1338" class="difflineplus">+                            ._getIconURLForHandlerApp(possibleApp));</span>
<a href="#l12.1339"></a><span id="l12.1339" class="difflineplus">+</span>
<a href="#l12.1340"></a><span id="l12.1340" class="difflineplus">+      // Attach the handler app object to the menu item so we can use it</span>
<a href="#l12.1341"></a><span id="l12.1341" class="difflineplus">+      // to make changes to the datastore when the user selects the item.</span>
<a href="#l12.1342"></a><span id="l12.1342" class="difflineplus">+      menuItem.handlerApp = possibleApp;</span>
<a href="#l12.1343"></a><span id="l12.1343" class="difflineplus">+</span>
<a href="#l12.1344"></a><span id="l12.1344" class="difflineplus">+      menuPopup.appendChild(menuItem);</span>
<a href="#l12.1345"></a><span id="l12.1345" class="difflineplus">+      possibleAppMenuItems.push(menuItem);</span>
<a href="#l12.1346"></a><span id="l12.1346" class="difflineplus">+    }</span>
<a href="#l12.1347"></a><span id="l12.1347" class="difflineplus">+</span>
<a href="#l12.1348"></a><span id="l12.1348" class="difflineplus">+    // Create a menu item for selecting a local application.</span>
<a href="#l12.1349"></a><span id="l12.1349" class="difflineplus">+    let createItem = true;</span>
<a href="#l12.1350"></a><span id="l12.1350" class="difflineplus">+    if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l12.1351"></a><span id="l12.1351" class="difflineplus">+      // On Windows, selecting an application to open another application</span>
<a href="#l12.1352"></a><span id="l12.1352" class="difflineplus">+      // would be meaningless so we special case executables.</span>
<a href="#l12.1353"></a><span id="l12.1353" class="difflineplus">+      var executableType = Cc[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l12.1354"></a><span id="l12.1354" class="difflineplus">+                             .getService(Ci.nsIMIMEService)</span>
<a href="#l12.1355"></a><span id="l12.1355" class="difflineplus">+                             .getTypeFromExtension(&quot;exe&quot;);</span>
<a href="#l12.1356"></a><span id="l12.1356" class="difflineplus">+      if (handlerInfo.type == executableType)</span>
<a href="#l12.1357"></a><span id="l12.1357" class="difflineplus">+        createItem = false;</span>
<a href="#l12.1358"></a><span id="l12.1358" class="difflineplus">+    }</span>
<a href="#l12.1359"></a><span id="l12.1359" class="difflineplus">+</span>
<a href="#l12.1360"></a><span id="l12.1360" class="difflineplus">+    if (createItem) {</span>
<a href="#l12.1361"></a><span id="l12.1361" class="difflineplus">+      let menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1362"></a><span id="l12.1362" class="difflineplus">+      menuItem.setAttribute(&quot;oncommand&quot;, &quot;gGeneralPane.chooseApp(event)&quot;);</span>
<a href="#l12.1363"></a><span id="l12.1363" class="difflineplus">+      let label = this._prefsBundle.getString(&quot;useOtherApp&quot;);</span>
<a href="#l12.1364"></a><span id="l12.1364" class="difflineplus">+      menuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l12.1365"></a><span id="l12.1365" class="difflineplus">+      menuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l12.1366"></a><span id="l12.1366" class="difflineplus">+      menuPopup.appendChild(menuItem);</span>
<a href="#l12.1367"></a><span id="l12.1367" class="difflineplus">+    }</span>
<a href="#l12.1368"></a><span id="l12.1368" class="difflineplus">+</span>
<a href="#l12.1369"></a><span id="l12.1369" class="difflineplus">+    // Create a menu item for managing applications.</span>
<a href="#l12.1370"></a><span id="l12.1370" class="difflineplus">+    if (possibleAppMenuItems.length) {</span>
<a href="#l12.1371"></a><span id="l12.1371" class="difflineplus">+      let menuItem = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.1372"></a><span id="l12.1372" class="difflineplus">+      menuPopup.appendChild(menuItem);</span>
<a href="#l12.1373"></a><span id="l12.1373" class="difflineplus">+      menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1374"></a><span id="l12.1374" class="difflineplus">+      menuItem.setAttribute(&quot;oncommand&quot;, &quot;gGeneralPane.manageApp(event)&quot;);</span>
<a href="#l12.1375"></a><span id="l12.1375" class="difflineplus">+      menuItem.setAttribute(&quot;label&quot;, this._prefsBundle.getString(&quot;manageApp&quot;));</span>
<a href="#l12.1376"></a><span id="l12.1376" class="difflineplus">+      menuPopup.appendChild(menuItem);</span>
<a href="#l12.1377"></a><span id="l12.1377" class="difflineplus">+    }</span>
<a href="#l12.1378"></a><span id="l12.1378" class="difflineplus">+</span>
<a href="#l12.1379"></a><span id="l12.1379" class="difflineplus">+    menuItem = document.createXULElement(&quot;menuseparator&quot;);</span>
<a href="#l12.1380"></a><span id="l12.1380" class="difflineplus">+    menuPopup.appendChild(menuItem);</span>
<a href="#l12.1381"></a><span id="l12.1381" class="difflineplus">+    menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l12.1382"></a><span id="l12.1382" class="difflineplus">+    menuItem.setAttribute(&quot;oncommand&quot;, &quot;gGeneralPane.confirmDelete(event)&quot;);</span>
<a href="#l12.1383"></a><span id="l12.1383" class="difflineplus">+    menuItem.setAttribute(&quot;label&quot;, this._prefsBundle.getString(&quot;delete&quot;));</span>
<a href="#l12.1384"></a><span id="l12.1384" class="difflineplus">+    menuPopup.appendChild(menuItem);</span>
<a href="#l12.1385"></a><span id="l12.1385" class="difflineplus">+</span>
<a href="#l12.1386"></a><span id="l12.1386" class="difflineplus">+    // Select the item corresponding to the preferred action.  If the always</span>
<a href="#l12.1387"></a><span id="l12.1387" class="difflineplus">+    // ask flag is set, it overrides the preferred action.  Otherwise we pick</span>
<a href="#l12.1388"></a><span id="l12.1388" class="difflineplus">+    // the item identified by the preferred action (when the preferred action</span>
<a href="#l12.1389"></a><span id="l12.1389" class="difflineplus">+    // is to use a helper app, we have to pick the specific helper app item).</span>
<a href="#l12.1390"></a><span id="l12.1390" class="difflineplus">+    if (handlerInfo.alwaysAskBeforeHandling) {</span>
<a href="#l12.1391"></a><span id="l12.1391" class="difflineplus">+      menu.selectedItem = askMenuItem;</span>
<a href="#l12.1392"></a><span id="l12.1392" class="difflineplus">+    } else {</span>
<a href="#l12.1393"></a><span id="l12.1393" class="difflineplus">+      switch (handlerInfo.preferredAction) {</span>
<a href="#l12.1394"></a><span id="l12.1394" class="difflineplus">+        case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l12.1395"></a><span id="l12.1395" class="difflineplus">+          menu.selectedItem = defaultMenuItem;</span>
<a href="#l12.1396"></a><span id="l12.1396" class="difflineplus">+          break;</span>
<a href="#l12.1397"></a><span id="l12.1397" class="difflineplus">+        case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l12.1398"></a><span id="l12.1398" class="difflineplus">+          if (preferredApp)</span>
<a href="#l12.1399"></a><span id="l12.1399" class="difflineplus">+            menu.selectedItem =</span>
<a href="#l12.1400"></a><span id="l12.1400" class="difflineplus">+              possibleAppMenuItems.filter(v =&gt; v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l12.1401"></a><span id="l12.1401" class="difflineplus">+          break;</span>
<a href="#l12.1402"></a><span id="l12.1402" class="difflineplus">+        case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l12.1403"></a><span id="l12.1403" class="difflineplus">+          menu.selectedItem = saveMenuItem;</span>
<a href="#l12.1404"></a><span id="l12.1404" class="difflineplus">+          break;</span>
<a href="#l12.1405"></a><span id="l12.1405" class="difflineplus">+      }</span>
<a href="#l12.1406"></a><span id="l12.1406" class="difflineplus">+    }</span>
<a href="#l12.1407"></a><span id="l12.1407" class="difflineplus">+    // menu.selectedItem may be null if the preferredAction is</span>
<a href="#l12.1408"></a><span id="l12.1408" class="difflineplus">+    // useSystemDefault, but handlerInfo.hasDefaultHandler returns false.</span>
<a href="#l12.1409"></a><span id="l12.1409" class="difflineplus">+    // For now, we'll just use the askMenuItem to avoid ugly exceptions.</span>
<a href="#l12.1410"></a><span id="l12.1410" class="difflineplus">+    menu.previousSelectedItem = menu.selectedItem || askMenuItem;</span>
<a href="#l12.1411"></a><span id="l12.1411" class="difflineplus">+  },</span>
<a href="#l12.1412"></a><span id="l12.1412" class="difflineplus">+</span>
<a href="#l12.1413"></a><span id="l12.1413" class="difflineplus">+  // -------------------</span>
<a href="#l12.1414"></a><span id="l12.1414" class="difflineplus">+  // Sorting &amp; Filtering</span>
<a href="#l12.1415"></a><span id="l12.1415" class="difflineplus">+</span>
<a href="#l12.1416"></a><span id="l12.1416" class="difflineplus">+  _sortColumn: null,</span>
<a href="#l12.1417"></a><span id="l12.1417" class="difflineplus">+</span>
<a href="#l12.1418"></a><span id="l12.1418" class="difflineplus">+  /**</span>
<a href="#l12.1419"></a><span id="l12.1419" class="difflineplus">+   * Sort the list when the user clicks on a column header.</span>
<a href="#l12.1420"></a><span id="l12.1420" class="difflineplus">+   */</span>
<a href="#l12.1421"></a><span id="l12.1421" class="difflineplus">+  sort(event) {</span>
<a href="#l12.1422"></a><span id="l12.1422" class="difflineplus">+    var column = event.target;</span>
<a href="#l12.1423"></a><span id="l12.1423" class="difflineplus">+</span>
<a href="#l12.1424"></a><span id="l12.1424" class="difflineplus">+    // If the user clicked on a new sort column, remove the direction indicator</span>
<a href="#l12.1425"></a><span id="l12.1425" class="difflineplus">+    // from the old column.</span>
<a href="#l12.1426"></a><span id="l12.1426" class="difflineplus">+    if (this._sortColumn &amp;&amp; this._sortColumn != column)</span>
<a href="#l12.1427"></a><span id="l12.1427" class="difflineplus">+      this._sortColumn.removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l12.1428"></a><span id="l12.1428" class="difflineplus">+</span>
<a href="#l12.1429"></a><span id="l12.1429" class="difflineplus">+    this._sortColumn = column;</span>
<a href="#l12.1430"></a><span id="l12.1430" class="difflineplus">+</span>
<a href="#l12.1431"></a><span id="l12.1431" class="difflineplus">+    // Set (or switch) the sort direction indicator.</span>
<a href="#l12.1432"></a><span id="l12.1432" class="difflineplus">+    if (column.getAttribute(&quot;sortDirection&quot;) == &quot;ascending&quot;)</span>
<a href="#l12.1433"></a><span id="l12.1433" class="difflineplus">+      column.setAttribute(&quot;sortDirection&quot;, &quot;descending&quot;);</span>
<a href="#l12.1434"></a><span id="l12.1434" class="difflineplus">+    else</span>
<a href="#l12.1435"></a><span id="l12.1435" class="difflineplus">+      column.setAttribute(&quot;sortDirection&quot;, &quot;ascending&quot;);</span>
<a href="#l12.1436"></a><span id="l12.1436" class="difflineplus">+</span>
<a href="#l12.1437"></a><span id="l12.1437" class="difflineplus">+    this._sortVisibleTypes();</span>
<a href="#l12.1438"></a><span id="l12.1438" class="difflineplus">+    this._rebuildView();</span>
<a href="#l12.1439"></a><span id="l12.1439" class="difflineplus">+  },</span>
<a href="#l12.1440"></a><span id="l12.1440" class="difflineplus">+</span>
<a href="#l12.1441"></a><span id="l12.1441" class="difflineplus">+  /**</span>
<a href="#l12.1442"></a><span id="l12.1442" class="difflineplus">+   * Sort the list of visible types by the current sort column/direction.</span>
<a href="#l12.1443"></a><span id="l12.1443" class="difflineplus">+   */</span>
<a href="#l12.1444"></a><span id="l12.1444" class="difflineplus">+  _sortVisibleTypes() {</span>
<a href="#l12.1445"></a><span id="l12.1445" class="difflineplus">+    if (!this._sortColumn)</span>
<a href="#l12.1446"></a><span id="l12.1446" class="difflineplus">+      return;</span>
<a href="#l12.1447"></a><span id="l12.1447" class="difflineplus">+</span>
<a href="#l12.1448"></a><span id="l12.1448" class="difflineplus">+    function sortByType(a, b) {</span>
<a href="#l12.1449"></a><span id="l12.1449" class="difflineplus">+      return a.typeDescription.toLowerCase()</span>
<a href="#l12.1450"></a><span id="l12.1450" class="difflineplus">+              .localeCompare(b.typeDescription.toLowerCase());</span>
<a href="#l12.1451"></a><span id="l12.1451" class="difflineplus">+    }</span>
<a href="#l12.1452"></a><span id="l12.1452" class="difflineplus">+</span>
<a href="#l12.1453"></a><span id="l12.1453" class="difflineplus">+    function sortByAction(a, b) {</span>
<a href="#l12.1454"></a><span id="l12.1454" class="difflineplus">+      return a.actionDescription.toLowerCase()</span>
<a href="#l12.1455"></a><span id="l12.1455" class="difflineplus">+              .localeCompare(b.actionDescription.toLowerCase());</span>
<a href="#l12.1456"></a><span id="l12.1456" class="difflineplus">+    }</span>
<a href="#l12.1457"></a><span id="l12.1457" class="difflineplus">+</span>
<a href="#l12.1458"></a><span id="l12.1458" class="difflineplus">+    switch (this._sortColumn.getAttribute(&quot;value&quot;)) {</span>
<a href="#l12.1459"></a><span id="l12.1459" class="difflineplus">+      case &quot;type&quot;:</span>
<a href="#l12.1460"></a><span id="l12.1460" class="difflineplus">+        this._visibleTypes.sort(sortByType);</span>
<a href="#l12.1461"></a><span id="l12.1461" class="difflineplus">+        break;</span>
<a href="#l12.1462"></a><span id="l12.1462" class="difflineplus">+      case &quot;action&quot;:</span>
<a href="#l12.1463"></a><span id="l12.1463" class="difflineplus">+        this._visibleTypes.sort(sortByAction);</span>
<a href="#l12.1464"></a><span id="l12.1464" class="difflineplus">+        break;</span>
<a href="#l12.1465"></a><span id="l12.1465" class="difflineplus">+    }</span>
<a href="#l12.1466"></a><span id="l12.1466" class="difflineplus">+</span>
<a href="#l12.1467"></a><span id="l12.1467" class="difflineplus">+    if (this._sortColumn.getAttribute(&quot;sortDirection&quot;) == &quot;descending&quot;)</span>
<a href="#l12.1468"></a><span id="l12.1468" class="difflineplus">+      this._visibleTypes.reverse();</span>
<a href="#l12.1469"></a><span id="l12.1469" class="difflineplus">+  },</span>
<a href="#l12.1470"></a><span id="l12.1470" class="difflineplus">+</span>
<a href="#l12.1471"></a><span id="l12.1471" class="difflineplus">+  focusFilterBox() {</span>
<a href="#l12.1472"></a><span id="l12.1472" class="difflineplus">+    this._filter.focus();</span>
<a href="#l12.1473"></a><span id="l12.1473" class="difflineplus">+    this._filter.select();</span>
<a href="#l12.1474"></a><span id="l12.1474" class="difflineplus">+  },</span>
<a href="#l12.1475"></a><span id="l12.1475" class="difflineplus">+</span>
<a href="#l12.1476"></a><span id="l12.1476" class="difflineplus">+  // -------</span>
<a href="#l12.1477"></a><span id="l12.1477" class="difflineplus">+  // Changes</span>
<a href="#l12.1478"></a><span id="l12.1478" class="difflineplus">+</span>
<a href="#l12.1479"></a><span id="l12.1479" class="difflineplus">+  // Whether or not we are currently storing the action selected by the user.</span>
<a href="#l12.1480"></a><span id="l12.1480" class="difflineplus">+  // We use this to suppress notification-triggered updates to the list when</span>
<a href="#l12.1481"></a><span id="l12.1481" class="difflineplus">+  // we make changes that may spawn such updates, specifically when we change</span>
<a href="#l12.1482"></a><span id="l12.1482" class="difflineplus">+  // the action for the feed type, which results in feed preference updates,</span>
<a href="#l12.1483"></a><span id="l12.1483" class="difflineplus">+  // which spawn &quot;pref changed&quot; notifications that would otherwise cause us</span>
<a href="#l12.1484"></a><span id="l12.1484" class="difflineplus">+  // to rebuild the view unnecessarily.</span>
<a href="#l12.1485"></a><span id="l12.1485" class="difflineplus">+  _storingAction: false,</span>
<a href="#l12.1486"></a><span id="l12.1486" class="difflineplus">+</span>
<a href="#l12.1487"></a><span id="l12.1487" class="difflineplus">+  onSelectAction(aActionItem) {</span>
<a href="#l12.1488"></a><span id="l12.1488" class="difflineplus">+    this._storingAction = true;</span>
<a href="#l12.1489"></a><span id="l12.1489" class="difflineplus">+</span>
<a href="#l12.1490"></a><span id="l12.1490" class="difflineplus">+    let typeItem = this._list.selectedItem;</span>
<a href="#l12.1491"></a><span id="l12.1491" class="difflineplus">+    let menu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l12.1492"></a><span id="l12.1492" class="difflineplus">+    menu.previousSelectedItem = aActionItem;</span>
<a href="#l12.1493"></a><span id="l12.1493" class="difflineplus">+    try {</span>
<a href="#l12.1494"></a><span id="l12.1494" class="difflineplus">+      this._storeAction(aActionItem);</span>
<a href="#l12.1495"></a><span id="l12.1495" class="difflineplus">+    } finally {</span>
<a href="#l12.1496"></a><span id="l12.1496" class="difflineplus">+      this._storingAction = false;</span>
<a href="#l12.1497"></a><span id="l12.1497" class="difflineplus">+    }</span>
<a href="#l12.1498"></a><span id="l12.1498" class="difflineplus">+  },</span>
<a href="#l12.1499"></a><span id="l12.1499" class="difflineplus">+</span>
<a href="#l12.1500"></a><span id="l12.1500" class="difflineplus">+  _storeAction(aActionItem) {</span>
<a href="#l12.1501"></a><span id="l12.1501" class="difflineplus">+    var handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l12.1502"></a><span id="l12.1502" class="difflineplus">+</span>
<a href="#l12.1503"></a><span id="l12.1503" class="difflineplus">+    if (aActionItem.hasAttribute(&quot;alwaysAsk&quot;)) {</span>
<a href="#l12.1504"></a><span id="l12.1504" class="difflineplus">+      handlerInfo.alwaysAskBeforeHandling = true;</span>
<a href="#l12.1505"></a><span id="l12.1505" class="difflineplus">+    } else if (aActionItem.hasAttribute(&quot;action&quot;)) {</span>
<a href="#l12.1506"></a><span id="l12.1506" class="difflineplus">+      let action = parseInt(aActionItem.getAttribute(&quot;action&quot;));</span>
<a href="#l12.1507"></a><span id="l12.1507" class="difflineplus">+</span>
<a href="#l12.1508"></a><span id="l12.1508" class="difflineplus">+      // Set the preferred application handler.</span>
<a href="#l12.1509"></a><span id="l12.1509" class="difflineplus">+      // We leave the existing preferred app in the list when we set</span>
<a href="#l12.1510"></a><span id="l12.1510" class="difflineplus">+      // the preferred action to something other than useHelperApp so that</span>
<a href="#l12.1511"></a><span id="l12.1511" class="difflineplus">+      // legacy datastores that don't have the preferred app in the list</span>
<a href="#l12.1512"></a><span id="l12.1512" class="difflineplus">+      // of possible apps still include the preferred app in the list of apps</span>
<a href="#l12.1513"></a><span id="l12.1513" class="difflineplus">+      // the user can choose to handle the type.</span>
<a href="#l12.1514"></a><span id="l12.1514" class="difflineplus">+      if (action == Ci.nsIHandlerInfo.useHelperApp)</span>
<a href="#l12.1515"></a><span id="l12.1515" class="difflineplus">+        handlerInfo.preferredApplicationHandler = aActionItem.handlerApp;</span>
<a href="#l12.1516"></a><span id="l12.1516" class="difflineplus">+</span>
<a href="#l12.1517"></a><span id="l12.1517" class="difflineplus">+      // Set the &quot;always ask&quot; flag.</span>
<a href="#l12.1518"></a><span id="l12.1518" class="difflineplus">+      handlerInfo.alwaysAskBeforeHandling = false;</span>
<a href="#l12.1519"></a><span id="l12.1519" class="difflineplus">+</span>
<a href="#l12.1520"></a><span id="l12.1520" class="difflineplus">+      // Set the preferred action.</span>
<a href="#l12.1521"></a><span id="l12.1521" class="difflineplus">+      handlerInfo.preferredAction = action;</span>
<a href="#l12.1522"></a><span id="l12.1522" class="difflineplus">+    }</span>
<a href="#l12.1523"></a><span id="l12.1523" class="difflineplus">+</span>
<a href="#l12.1524"></a><span id="l12.1524" class="difflineplus">+    handlerInfo.store();</span>
<a href="#l12.1525"></a><span id="l12.1525" class="difflineplus">+</span>
<a href="#l12.1526"></a><span id="l12.1526" class="difflineplus">+    // Update the action label and image to reflect the new preferred action.</span>
<a href="#l12.1527"></a><span id="l12.1527" class="difflineplus">+    this.selectedHandlerListItem.refreshAction();</span>
<a href="#l12.1528"></a><span id="l12.1528" class="difflineplus">+  },</span>
<a href="#l12.1529"></a><span id="l12.1529" class="difflineplus">+</span>
<a href="#l12.1530"></a><span id="l12.1530" class="difflineplus">+  manageApp(aEvent) {</span>
<a href="#l12.1531"></a><span id="l12.1531" class="difflineplus">+    // Don't let the normal &quot;on select action&quot; handler get this event,</span>
<a href="#l12.1532"></a><span id="l12.1532" class="difflineplus">+    // as we handle it specially ourselves.</span>
<a href="#l12.1533"></a><span id="l12.1533" class="difflineplus">+    aEvent.stopPropagation();</span>
<a href="#l12.1534"></a><span id="l12.1534" class="difflineplus">+</span>
<a href="#l12.1535"></a><span id="l12.1535" class="difflineplus">+    var handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l12.1536"></a><span id="l12.1536" class="difflineplus">+</span>
<a href="#l12.1537"></a><span id="l12.1537" class="difflineplus">+    let closingCallback = () =&gt; {</span>
<a href="#l12.1538"></a><span id="l12.1538" class="difflineplus">+      // Rebuild the actions menu so that we revert to the previous selection,</span>
<a href="#l12.1539"></a><span id="l12.1539" class="difflineplus">+      // or &quot;Always ask&quot; if the previous default application has been removed.</span>
<a href="#l12.1540"></a><span id="l12.1540" class="difflineplus">+      this.rebuildActionsMenu();</span>
<a href="#l12.1541"></a><span id="l12.1541" class="difflineplus">+</span>
<a href="#l12.1542"></a><span id="l12.1542" class="difflineplus">+      // Update the richlistitem too. Will be visible when selecting another row.</span>
<a href="#l12.1543"></a><span id="l12.1543" class="difflineplus">+      this.selectedHandlerListItem.refreshAction();</span>
<a href="#l12.1544"></a><span id="l12.1544" class="difflineplus">+    };</span>
<a href="#l12.1545"></a><span id="l12.1545" class="difflineplus">+</span>
<a href="#l12.1546"></a><span id="l12.1546" class="difflineplus">+    gSubDialog.open(</span>
<a href="#l12.1547"></a><span id="l12.1547" class="difflineplus">+      &quot;chrome://messenger/content/preferences/applicationManager.xul&quot;,</span>
<a href="#l12.1548"></a><span id="l12.1548" class="difflineplus">+      &quot;resizable=no&quot;, handlerInfo, closingCallback);</span>
<a href="#l12.1549"></a><span id="l12.1549" class="difflineplus">+  },</span>
<a href="#l12.1550"></a><span id="l12.1550" class="difflineplus">+</span>
<a href="#l12.1551"></a><span id="l12.1551" class="difflineplus">+  chooseApp(aEvent) {</span>
<a href="#l12.1552"></a><span id="l12.1552" class="difflineplus">+    // Don't let the normal &quot;on select action&quot; handler get this event,</span>
<a href="#l12.1553"></a><span id="l12.1553" class="difflineplus">+    // as we handle it specially ourselves.</span>
<a href="#l12.1554"></a><span id="l12.1554" class="difflineplus">+    aEvent.stopPropagation();</span>
<a href="#l12.1555"></a><span id="l12.1555" class="difflineplus">+</span>
<a href="#l12.1556"></a><span id="l12.1556" class="difflineplus">+    var handlerApp;</span>
<a href="#l12.1557"></a><span id="l12.1557" class="difflineplus">+    let onSelectionDone = function() {</span>
<a href="#l12.1558"></a><span id="l12.1558" class="difflineplus">+      // Rebuild the actions menu whether the user picked an app or canceled.</span>
<a href="#l12.1559"></a><span id="l12.1559" class="difflineplus">+      // If they picked an app, we want to add the app to the menu and select it.</span>
<a href="#l12.1560"></a><span id="l12.1560" class="difflineplus">+      // If they canceled, we want to go back to their previous selection.</span>
<a href="#l12.1561"></a><span id="l12.1561" class="difflineplus">+      this.rebuildActionsMenu();</span>
<a href="#l12.1562"></a><span id="l12.1562" class="difflineplus">+</span>
<a href="#l12.1563"></a><span id="l12.1563" class="difflineplus">+      // If the user picked a new app from the menu, select it.</span>
<a href="#l12.1564"></a><span id="l12.1564" class="difflineplus">+      if (handlerApp) {</span>
<a href="#l12.1565"></a><span id="l12.1565" class="difflineplus">+        let typeItem = this._list.selectedItem;</span>
<a href="#l12.1566"></a><span id="l12.1566" class="difflineplus">+        let actionsMenu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l12.1567"></a><span id="l12.1567" class="difflineplus">+        let menuItems = actionsMenu.menupopup.childNodes;</span>
<a href="#l12.1568"></a><span id="l12.1568" class="difflineplus">+        for (let i = 0; i &lt; menuItems.length; i++) {</span>
<a href="#l12.1569"></a><span id="l12.1569" class="difflineplus">+          let menuItem = menuItems[i];</span>
<a href="#l12.1570"></a><span id="l12.1570" class="difflineplus">+          if (menuItem.handlerApp &amp;&amp; menuItem.handlerApp.equals(handlerApp)) {</span>
<a href="#l12.1571"></a><span id="l12.1571" class="difflineplus">+            actionsMenu.selectedIndex = i;</span>
<a href="#l12.1572"></a><span id="l12.1572" class="difflineplus">+            this.onSelectAction(menuItem);</span>
<a href="#l12.1573"></a><span id="l12.1573" class="difflineplus">+            break;</span>
<a href="#l12.1574"></a><span id="l12.1574" class="difflineplus">+          }</span>
<a href="#l12.1575"></a><span id="l12.1575" class="difflineplus">+        }</span>
<a href="#l12.1576"></a><span id="l12.1576" class="difflineplus">+      }</span>
<a href="#l12.1577"></a><span id="l12.1577" class="difflineplus">+    }.bind(this);</span>
<a href="#l12.1578"></a><span id="l12.1578" class="difflineplus">+</span>
<a href="#l12.1579"></a><span id="l12.1579" class="difflineplus">+    if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l12.1580"></a><span id="l12.1580" class="difflineplus">+      let params = {};</span>
<a href="#l12.1581"></a><span id="l12.1581" class="difflineplus">+      let handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l12.1582"></a><span id="l12.1582" class="difflineplus">+</span>
<a href="#l12.1583"></a><span id="l12.1583" class="difflineplus">+      params.mimeInfo = handlerInfo.wrappedHandlerInfo;</span>
<a href="#l12.1584"></a><span id="l12.1584" class="difflineplus">+</span>
<a href="#l12.1585"></a><span id="l12.1585" class="difflineplus">+      params.title         = this._prefsBundle.getString(&quot;fpTitleChooseApp&quot;);</span>
<a href="#l12.1586"></a><span id="l12.1586" class="difflineplus">+      params.description   = handlerInfo.description;</span>
<a href="#l12.1587"></a><span id="l12.1587" class="difflineplus">+      params.filename      = null;</span>
<a href="#l12.1588"></a><span id="l12.1588" class="difflineplus">+      params.handlerApp    = null;</span>
<a href="#l12.1589"></a><span id="l12.1589" class="difflineplus">+</span>
<a href="#l12.1590"></a><span id="l12.1590" class="difflineplus">+      function closingCallback() {</span>
<a href="#l12.1591"></a><span id="l12.1591" class="difflineplus">+        if (params.handlerApp &amp;&amp;</span>
<a href="#l12.1592"></a><span id="l12.1592" class="difflineplus">+            params.handlerApp.executable &amp;&amp;</span>
<a href="#l12.1593"></a><span id="l12.1593" class="difflineplus">+            params.handlerApp.executable.isFile()) {</span>
<a href="#l12.1594"></a><span id="l12.1594" class="difflineplus">+          handlerApp = params.handlerApp;</span>
<a href="#l12.1595"></a><span id="l12.1595" class="difflineplus">+</span>
<a href="#l12.1596"></a><span id="l12.1596" class="difflineplus">+          // Add the app to the type's list of possible handlers.</span>
<a href="#l12.1597"></a><span id="l12.1597" class="difflineplus">+          handlerInfo.addPossibleApplicationHandler(handlerApp);</span>
<a href="#l12.1598"></a><span id="l12.1598" class="difflineplus">+        }</span>
<a href="#l12.1599"></a><span id="l12.1599" class="difflineplus">+        onSelectionDone();</span>
<a href="#l12.1600"></a><span id="l12.1600" class="difflineplus">+      }</span>
<a href="#l12.1601"></a><span id="l12.1601" class="difflineplus">+</span>
<a href="#l12.1602"></a><span id="l12.1602" class="difflineplus">+      gSubDialog.open(&quot;chrome://global/content/appPicker.xul&quot;,</span>
<a href="#l12.1603"></a><span id="l12.1603" class="difflineplus">+                      &quot;resizable=no&quot;, params, closingCallback);</span>
<a href="#l12.1604"></a><span id="l12.1604" class="difflineplus">+    } else {</span>
<a href="#l12.1605"></a><span id="l12.1605" class="difflineplus">+      const nsIFilePicker = Ci.nsIFilePicker;</span>
<a href="#l12.1606"></a><span id="l12.1606" class="difflineplus">+      let fp = Cc[&quot;@mozilla.org/filepicker;1&quot;].createInstance(nsIFilePicker);</span>
<a href="#l12.1607"></a><span id="l12.1607" class="difflineplus">+      let winTitle = this._prefsBundle.getString(&quot;fpTitleChooseApp&quot;);</span>
<a href="#l12.1608"></a><span id="l12.1608" class="difflineplus">+      fp.init(window, winTitle, nsIFilePicker.modeOpen);</span>
<a href="#l12.1609"></a><span id="l12.1609" class="difflineplus">+      fp.appendFilters(nsIFilePicker.filterApps);</span>
<a href="#l12.1610"></a><span id="l12.1610" class="difflineplus">+</span>
<a href="#l12.1611"></a><span id="l12.1611" class="difflineplus">+      // Prompt the user to pick an app.  If they pick one, and it's a valid</span>
<a href="#l12.1612"></a><span id="l12.1612" class="difflineplus">+      // selection, then add it to the list of possible handlers.</span>
<a href="#l12.1613"></a><span id="l12.1613" class="difflineplus">+</span>
<a href="#l12.1614"></a><span id="l12.1614" class="difflineplus">+      fp.open(rv =&gt; {</span>
<a href="#l12.1615"></a><span id="l12.1615" class="difflineplus">+        if (rv == nsIFilePicker.returnOK &amp;&amp; fp.file &amp;&amp;</span>
<a href="#l12.1616"></a><span id="l12.1616" class="difflineplus">+            this._isValidHandlerExecutable(fp.file)) {</span>
<a href="#l12.1617"></a><span id="l12.1617" class="difflineplus">+          handlerApp = Cc[&quot;@mozilla.org/uriloader/local-handler-app;1&quot;]</span>
<a href="#l12.1618"></a><span id="l12.1618" class="difflineplus">+                         .createInstance(Ci.nsILocalHandlerApp);</span>
<a href="#l12.1619"></a><span id="l12.1619" class="difflineplus">+          handlerApp.name = getDisplayNameForFile(fp.file);</span>
<a href="#l12.1620"></a><span id="l12.1620" class="difflineplus">+          handlerApp.executable = fp.file;</span>
<a href="#l12.1621"></a><span id="l12.1621" class="difflineplus">+</span>
<a href="#l12.1622"></a><span id="l12.1622" class="difflineplus">+          // Add the app to the type's list of possible handlers.</span>
<a href="#l12.1623"></a><span id="l12.1623" class="difflineplus">+          let handlerInfo = this.selectedHandlerListItem.handlerInfoWrapper;</span>
<a href="#l12.1624"></a><span id="l12.1624" class="difflineplus">+          handlerInfo.addPossibleApplicationHandler(handlerApp);</span>
<a href="#l12.1625"></a><span id="l12.1625" class="difflineplus">+        }</span>
<a href="#l12.1626"></a><span id="l12.1626" class="difflineplus">+        onSelectionDone();</span>
<a href="#l12.1627"></a><span id="l12.1627" class="difflineplus">+      });</span>
<a href="#l12.1628"></a><span id="l12.1628" class="difflineplus">+    }</span>
<a href="#l12.1629"></a><span id="l12.1629" class="difflineplus">+  },</span>
<a href="#l12.1630"></a><span id="l12.1630" class="difflineplus">+</span>
<a href="#l12.1631"></a><span id="l12.1631" class="difflineplus">+  confirmDelete(aEvent) {</span>
<a href="#l12.1632"></a><span id="l12.1632" class="difflineplus">+    aEvent.stopPropagation();</span>
<a href="#l12.1633"></a><span id="l12.1633" class="difflineplus">+    if (Services.prompt.confirm(null,</span>
<a href="#l12.1634"></a><span id="l12.1634" class="difflineplus">+                                this._prefsBundle.getString(&quot;confirmDeleteTitle&quot;),</span>
<a href="#l12.1635"></a><span id="l12.1635" class="difflineplus">+                                this._prefsBundle.getString(&quot;confirmDeleteText&quot;))) {</span>
<a href="#l12.1636"></a><span id="l12.1636" class="difflineplus">+      this.onDelete(aEvent);</span>
<a href="#l12.1637"></a><span id="l12.1637" class="difflineplus">+    } else {</span>
<a href="#l12.1638"></a><span id="l12.1638" class="difflineplus">+      // They hit cancel, so return them to the previously selected item.</span>
<a href="#l12.1639"></a><span id="l12.1639" class="difflineplus">+      let typeItem = this._list.selectedItem;</span>
<a href="#l12.1640"></a><span id="l12.1640" class="difflineplus">+      let menu = typeItem.querySelector(&quot;.actionsMenu&quot;);</span>
<a href="#l12.1641"></a><span id="l12.1641" class="difflineplus">+      menu.selectedItem = menu.previousSelectedItem;</span>
<a href="#l12.1642"></a><span id="l12.1642" class="difflineplus">+    }</span>
<a href="#l12.1643"></a><span id="l12.1643" class="difflineplus">+  },</span>
<a href="#l12.1644"></a><span id="l12.1644" class="difflineplus">+</span>
<a href="#l12.1645"></a><span id="l12.1645" class="difflineplus">+  onDelete(aEvent) {</span>
<a href="#l12.1646"></a><span id="l12.1646" class="difflineplus">+    // We want to delete if either the request came from the confirmDelete</span>
<a href="#l12.1647"></a><span id="l12.1647" class="difflineplus">+    // method (which is the only thing that populates the aEvent parameter),</span>
<a href="#l12.1648"></a><span id="l12.1648" class="difflineplus">+    // or we've hit the delete/backspace key while the list has focus.</span>
<a href="#l12.1649"></a><span id="l12.1649" class="difflineplus">+    if ((aEvent || document.commandDispatcher.focusedElement == this._list) &amp;&amp;</span>
<a href="#l12.1650"></a><span id="l12.1650" class="difflineplus">+        this._list.selectedIndex != -1) {</span>
<a href="#l12.1651"></a><span id="l12.1651" class="difflineplus">+      let typeItem = this._list.getItemAtIndex(this._list.selectedIndex);</span>
<a href="#l12.1652"></a><span id="l12.1652" class="difflineplus">+      let handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l12.1653"></a><span id="l12.1653" class="difflineplus">+      let index = this._visibleTypes.indexOf(handlerInfo);</span>
<a href="#l12.1654"></a><span id="l12.1654" class="difflineplus">+      if (index != -1)</span>
<a href="#l12.1655"></a><span id="l12.1655" class="difflineplus">+        this._visibleTypes.splice(index, 1);</span>
<a href="#l12.1656"></a><span id="l12.1656" class="difflineplus">+      handlerInfo.remove();</span>
<a href="#l12.1657"></a><span id="l12.1657" class="difflineplus">+      delete this._handledTypes[typeItem.type];</span>
<a href="#l12.1658"></a><span id="l12.1658" class="difflineplus">+      typeItem.remove();</span>
<a href="#l12.1659"></a><span id="l12.1659" class="difflineplus">+    }</span>
<a href="#l12.1660"></a><span id="l12.1660" class="difflineplus">+  },</span>
<a href="#l12.1661"></a><span id="l12.1661" class="difflineplus">+</span>
<a href="#l12.1662"></a><span id="l12.1662" class="difflineplus">+  _getIconURLForHandlerApp(aHandlerApp) {</span>
<a href="#l12.1663"></a><span id="l12.1663" class="difflineplus">+    if (aHandlerApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l12.1664"></a><span id="l12.1664" class="difflineplus">+      return this._getIconURLForFile(aHandlerApp.executable);</span>
<a href="#l12.1665"></a><span id="l12.1665" class="difflineplus">+</span>
<a href="#l12.1666"></a><span id="l12.1666" class="difflineplus">+    if (aHandlerApp instanceof Ci.nsIWebHandlerApp)</span>
<a href="#l12.1667"></a><span id="l12.1667" class="difflineplus">+      return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l12.1668"></a><span id="l12.1668" class="difflineplus">+</span>
<a href="#l12.1669"></a><span id="l12.1669" class="difflineplus">+    if (aHandlerApp instanceof Ci.nsIWebContentHandlerInfo)</span>
<a href="#l12.1670"></a><span id="l12.1670" class="difflineplus">+      return this._getIconURLForWebApp(aHandlerApp.uri);</span>
<a href="#l12.1671"></a><span id="l12.1671" class="difflineplus">+</span>
<a href="#l12.1672"></a><span id="l12.1672" class="difflineplus">+    // We know nothing about other kinds of handler apps.</span>
<a href="#l12.1673"></a><span id="l12.1673" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l12.1674"></a><span id="l12.1674" class="difflineplus">+  },</span>
<a href="#l12.1675"></a><span id="l12.1675" class="difflineplus">+</span>
<a href="#l12.1676"></a><span id="l12.1676" class="difflineplus">+  _getIconURLForFile(aFile) {</span>
<a href="#l12.1677"></a><span id="l12.1677" class="difflineplus">+    let urlSpec = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l12.1678"></a><span id="l12.1678" class="difflineplus">+      .QueryInterface(Ci.nsIFileProtocolHandler)</span>
<a href="#l12.1679"></a><span id="l12.1679" class="difflineplus">+      .getURLSpecFromFile(aFile);</span>
<a href="#l12.1680"></a><span id="l12.1680" class="difflineplus">+</span>
<a href="#l12.1681"></a><span id="l12.1681" class="difflineplus">+    return &quot;moz-icon://&quot; + urlSpec + &quot;?size=16&quot;;</span>
<a href="#l12.1682"></a><span id="l12.1682" class="difflineplus">+  },</span>
<a href="#l12.1683"></a><span id="l12.1683" class="difflineplus">+</span>
<a href="#l12.1684"></a><span id="l12.1684" class="difflineplus">+  _getIconURLForWebApp(aWebAppURITemplate) {</span>
<a href="#l12.1685"></a><span id="l12.1685" class="difflineplus">+    var uri = Services.io.newURI(aWebAppURITemplate);</span>
<a href="#l12.1686"></a><span id="l12.1686" class="difflineplus">+</span>
<a href="#l12.1687"></a><span id="l12.1687" class="difflineplus">+    // Unfortunately we can't use the favicon service to get the favicon,</span>
<a href="#l12.1688"></a><span id="l12.1688" class="difflineplus">+    // because the service looks in the annotations table for a record with</span>
<a href="#l12.1689"></a><span id="l12.1689" class="difflineplus">+    // the exact URL we give it, and users won't have such records for URLs</span>
<a href="#l12.1690"></a><span id="l12.1690" class="difflineplus">+    // they don't visit, and users won't visit the web app's URL template,</span>
<a href="#l12.1691"></a><span id="l12.1691" class="difflineplus">+    // they'll only visit URLs derived from that template (i.e. with %s</span>
<a href="#l12.1692"></a><span id="l12.1692" class="difflineplus">+    // in the template replaced by the URL of the content being handled).</span>
<a href="#l12.1693"></a><span id="l12.1693" class="difflineplus">+</span>
<a href="#l12.1694"></a><span id="l12.1694" class="difflineplus">+    if (/^https?/.test(uri.scheme))</span>
<a href="#l12.1695"></a><span id="l12.1695" class="difflineplus">+      return uri.prePath + &quot;/favicon.ico&quot;;</span>
<a href="#l12.1696"></a><span id="l12.1696" class="difflineplus">+</span>
<a href="#l12.1697"></a><span id="l12.1697" class="difflineplus">+    return /^https?/.test(uri.scheme) ? uri.resolve(&quot;/favicon.ico&quot;) : &quot;&quot;;</span>
<a href="#l12.1698"></a><span id="l12.1698" class="difflineplus">+  },</span>
<a href="#l12.1699"></a><span id="l12.1699" class="difflineplus">+</span>
<a href="#l12.1700"></a><span id="l12.1700" class="difflineplus">+  destroy() {</span>
<a href="#l12.1701"></a><span id="l12.1701" class="difflineplus">+    window.removeEventListener(&quot;unload&quot;, this);</span>
<a href="#l12.1702"></a><span id="l12.1702" class="difflineplus">+</span>
<a href="#l12.1703"></a><span id="l12.1703" class="difflineplus">+    Services.obs.removeObserver(this, AUTO_UPDATE_CHANGED_TOPIC);</span>
<a href="#l12.1704"></a><span id="l12.1704" class="difflineplus">+  },</span>
<a href="#l12.1705"></a><span id="l12.1705" class="difflineplus">+</span>
<a href="#l12.1706"></a><span id="l12.1706" class="difflineplus">+  // nsISupports</span>
<a href="#l12.1707"></a><span id="l12.1707" class="difflineplus">+</span>
<a href="#l12.1708"></a><span id="l12.1708" class="difflineplus">+  QueryInterface: ChromeUtils.generateQI([Ci.nsIObserver]),</span>
<a href="#l12.1709"></a><span id="l12.1709" class="difflineplus">+</span>
<a href="#l12.1710"></a><span id="l12.1710" class="difflineplus">+  // nsIObserver</span>
<a href="#l12.1711"></a><span id="l12.1711" class="difflineplus">+</span>
<a href="#l12.1712"></a><span id="l12.1712" class="difflineplus">+  async observe(aSubject, aTopic, aData) {</span>
<a href="#l12.1713"></a><span id="l12.1713" class="difflineplus">+    if (aTopic == AUTO_UPDATE_CHANGED_TOPIC) {</span>
<a href="#l12.1714"></a><span id="l12.1714" class="difflineplus">+      if (aData != &quot;true&quot; &amp;&amp; aData != &quot;false&quot;) {</span>
<a href="#l12.1715"></a><span id="l12.1715" class="difflineplus">+        throw new Error(&quot;Invalid preference value for app.update.auto&quot;);</span>
<a href="#l12.1716"></a><span id="l12.1716" class="difflineplus">+      }</span>
<a href="#l12.1717"></a><span id="l12.1717" class="difflineplus">+      document.getElementById(&quot;updateRadioGroup&quot;).value = aData;</span>
<a href="#l12.1718"></a><span id="l12.1718" class="difflineplus">+    }</span>
<a href="#l12.1719"></a><span id="l12.1719" class="difflineplus">+  },</span>
<a href="#l12.1720"></a><span id="l12.1720" class="difflineplus">+</span>
<a href="#l12.1721"></a><span id="l12.1721" class="difflineplus">+  // EventListener</span>
<a href="#l12.1722"></a><span id="l12.1722" class="difflineplus">+</span>
<a href="#l12.1723"></a><span id="l12.1723" class="difflineplus">+  handleEvent(aEvent) {</span>
<a href="#l12.1724"></a><span id="l12.1724" class="difflineplus">+    if (aEvent.type == &quot;unload&quot;) {</span>
<a href="#l12.1725"></a><span id="l12.1725" class="difflineplus">+      this.destroy();</span>
<a href="#l12.1726"></a><span id="l12.1726" class="difflineplus">+      if (AppConstants.MOZ_UPDATER) {</span>
<a href="#l12.1727"></a><span id="l12.1727" class="difflineplus">+        onUnload();</span>
<a href="#l12.1728"></a><span id="l12.1728" class="difflineplus">+      }</span>
<a href="#l12.1729"></a><span id="l12.1729" class="difflineplus">+    }</span>
<a href="#l12.1730"></a><span id="l12.1730" class="difflineplus">+  },</span>
<a href="#l12.1731"></a><span id="l12.1731"> };</span>
<a href="#l12.1732"></a><span id="l12.1732"> </span>
<a href="#l12.1733"></a><span id="l12.1733" class="difflineplus">+function getDisplayNameForFile(aFile) {</span>
<a href="#l12.1734"></a><span id="l12.1734" class="difflineplus">+  if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l12.1735"></a><span id="l12.1735" class="difflineplus">+    if (aFile instanceof Ci.nsILocalFileWin) {</span>
<a href="#l12.1736"></a><span id="l12.1736" class="difflineplus">+      try {</span>
<a href="#l12.1737"></a><span id="l12.1737" class="difflineplus">+        return aFile.getVersionInfoField(&quot;FileDescription&quot;);</span>
<a href="#l12.1738"></a><span id="l12.1738" class="difflineplus">+      } catch (ex) {</span>
<a href="#l12.1739"></a><span id="l12.1739" class="difflineplus">+        // fall through to the file name</span>
<a href="#l12.1740"></a><span id="l12.1740" class="difflineplus">+      }</span>
<a href="#l12.1741"></a><span id="l12.1741" class="difflineplus">+    }</span>
<a href="#l12.1742"></a><span id="l12.1742" class="difflineplus">+  } else if (AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l12.1743"></a><span id="l12.1743" class="difflineplus">+    if (aFile instanceof Ci.nsILocalFileMac) {</span>
<a href="#l12.1744"></a><span id="l12.1744" class="difflineplus">+      try {</span>
<a href="#l12.1745"></a><span id="l12.1745" class="difflineplus">+        return aFile.bundleDisplayName;</span>
<a href="#l12.1746"></a><span id="l12.1746" class="difflineplus">+      } catch (ex) {</span>
<a href="#l12.1747"></a><span id="l12.1747" class="difflineplus">+        // fall through to the file name</span>
<a href="#l12.1748"></a><span id="l12.1748" class="difflineplus">+      }</span>
<a href="#l12.1749"></a><span id="l12.1749" class="difflineplus">+    }</span>
<a href="#l12.1750"></a><span id="l12.1750" class="difflineplus">+  }</span>
<a href="#l12.1751"></a><span id="l12.1751" class="difflineplus">+</span>
<a href="#l12.1752"></a><span id="l12.1752" class="difflineplus">+  return aFile.leafName;</span>
<a href="#l12.1753"></a><span id="l12.1753" class="difflineplus">+}</span>
<a href="#l12.1754"></a><span id="l12.1754" class="difflineplus">+</span>
<a href="#l12.1755"></a><span id="l12.1755" class="difflineplus">+function getLocalHandlerApp(aFile) {</span>
<a href="#l12.1756"></a><span id="l12.1756" class="difflineplus">+  var localHandlerApp = Cc[&quot;@mozilla.org/uriloader/local-handler-app;1&quot;]</span>
<a href="#l12.1757"></a><span id="l12.1757" class="difflineplus">+                          .createInstance(Ci.nsILocalHandlerApp);</span>
<a href="#l12.1758"></a><span id="l12.1758" class="difflineplus">+  localHandlerApp.name = getDisplayNameForFile(aFile);</span>
<a href="#l12.1759"></a><span id="l12.1759" class="difflineplus">+  localHandlerApp.executable = aFile;</span>
<a href="#l12.1760"></a><span id="l12.1760" class="difflineplus">+</span>
<a href="#l12.1761"></a><span id="l12.1761" class="difflineplus">+  return localHandlerApp;</span>
<a href="#l12.1762"></a><span id="l12.1762" class="difflineplus">+}</span>
<a href="#l12.1763"></a><span id="l12.1763" class="difflineplus">+</span>
<a href="#l12.1764"></a><span id="l12.1764" class="difflineplus">+// eslint-disable-next-line no-undef</span>
<a href="#l12.1765"></a><span id="l12.1765" class="difflineplus">+let gHandlerListItemFragment = MozXULElement.parseXULToFragment(`</span>
<a href="#l12.1766"></a><span id="l12.1766" class="difflineplus">+  &lt;richlistitem&gt;</span>
<a href="#l12.1767"></a><span id="l12.1767" class="difflineplus">+    &lt;hbox flex=&quot;1&quot; equalsize=&quot;always&quot;&gt;</span>
<a href="#l12.1768"></a><span id="l12.1768" class="difflineplus">+      &lt;hbox class=&quot;typeContainer&quot; flex=&quot;1&quot; align=&quot;center&quot;&gt;</span>
<a href="#l12.1769"></a><span id="l12.1769" class="difflineplus">+        &lt;image class=&quot;typeIcon&quot; width=&quot;16&quot; height=&quot;16&quot;</span>
<a href="#l12.1770"></a><span id="l12.1770" class="difflineplus">+               src=&quot;moz-icon://goat?size=16&quot;/&gt;</span>
<a href="#l12.1771"></a><span id="l12.1771" class="difflineplus">+        &lt;label class=&quot;typeDescription&quot; flex=&quot;1&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l12.1772"></a><span id="l12.1772" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l12.1773"></a><span id="l12.1773" class="difflineplus">+      &lt;hbox class=&quot;actionContainer&quot; flex=&quot;1&quot; align=&quot;center&quot;&gt;</span>
<a href="#l12.1774"></a><span id="l12.1774" class="difflineplus">+        &lt;image class=&quot;actionIcon&quot; width=&quot;16&quot; height=&quot;16&quot;/&gt;</span>
<a href="#l12.1775"></a><span id="l12.1775" class="difflineplus">+        &lt;label class=&quot;actionDescription&quot; flex=&quot;1&quot; crop=&quot;end&quot;/&gt;</span>
<a href="#l12.1776"></a><span id="l12.1776" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l12.1777"></a><span id="l12.1777" class="difflineplus">+      &lt;hbox class=&quot;actionsMenuContainer&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l12.1778"></a><span id="l12.1778" class="difflineplus">+        &lt;menulist class=&quot;actionsMenu&quot; flex=&quot;1&quot; crop=&quot;end&quot; selectedIndex=&quot;1&quot;&gt;</span>
<a href="#l12.1779"></a><span id="l12.1779" class="difflineplus">+          &lt;menupopup/&gt;</span>
<a href="#l12.1780"></a><span id="l12.1780" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l12.1781"></a><span id="l12.1781" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l12.1782"></a><span id="l12.1782" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l12.1783"></a><span id="l12.1783" class="difflineplus">+  &lt;/richlistitem&gt;</span>
<a href="#l12.1784"></a><span id="l12.1784" class="difflineplus">+`);</span>
<a href="#l12.1785"></a><span id="l12.1785" class="difflineplus">+</span>
<a href="#l12.1786"></a><span id="l12.1786" class="difflineplus">+/**</span>
<a href="#l12.1787"></a><span id="l12.1787" class="difflineplus">+ * This is associated to &lt;richlistitem&gt; elements in the handlers view.</span>
<a href="#l12.1788"></a><span id="l12.1788" class="difflineplus">+ */</span>
<a href="#l12.1789"></a><span id="l12.1789" class="difflineplus">+class HandlerListItem {</span>
<a href="#l12.1790"></a><span id="l12.1790" class="difflineplus">+  static forNode(node) {</span>
<a href="#l12.1791"></a><span id="l12.1791" class="difflineplus">+    return gNodeToObjectMap.get(node);</span>
<a href="#l12.1792"></a><span id="l12.1792" class="difflineplus">+  }</span>
<a href="#l12.1793"></a><span id="l12.1793" class="difflineplus">+</span>
<a href="#l12.1794"></a><span id="l12.1794" class="difflineplus">+  constructor(handlerInfoWrapper) {</span>
<a href="#l12.1795"></a><span id="l12.1795" class="difflineplus">+    this.handlerInfoWrapper = handlerInfoWrapper;</span>
<a href="#l12.1796"></a><span id="l12.1796" class="difflineplus">+    }</span>
<a href="#l12.1797"></a><span id="l12.1797" class="difflineplus">+</span>
<a href="#l12.1798"></a><span id="l12.1798" class="difflineplus">+  setOrRemoveAttributes(iterable) {</span>
<a href="#l12.1799"></a><span id="l12.1799" class="difflineplus">+    for (let [selector, name, value] of iterable) {</span>
<a href="#l12.1800"></a><span id="l12.1800" class="difflineplus">+      let node = selector ? this.node.querySelector(selector) : this.node;</span>
<a href="#l12.1801"></a><span id="l12.1801" class="difflineplus">+      if (value) {</span>
<a href="#l12.1802"></a><span id="l12.1802" class="difflineplus">+        node.setAttribute(name, value);</span>
<a href="#l12.1803"></a><span id="l12.1803" class="difflineplus">+      } else {</span>
<a href="#l12.1804"></a><span id="l12.1804" class="difflineplus">+        node.removeAttribute(name);</span>
<a href="#l12.1805"></a><span id="l12.1805" class="difflineplus">+      }</span>
<a href="#l12.1806"></a><span id="l12.1806" class="difflineplus">+    }</span>
<a href="#l12.1807"></a><span id="l12.1807" class="difflineplus">+  }</span>
<a href="#l12.1808"></a><span id="l12.1808" class="difflineplus">+</span>
<a href="#l12.1809"></a><span id="l12.1809" class="difflineplus">+  connectAndAppendToList(list) {</span>
<a href="#l12.1810"></a><span id="l12.1810" class="difflineplus">+    list.appendChild(document.importNode(gHandlerListItemFragment, true));</span>
<a href="#l12.1811"></a><span id="l12.1811" class="difflineplus">+    this.node = list.lastChild;</span>
<a href="#l12.1812"></a><span id="l12.1812" class="difflineplus">+    gNodeToObjectMap.set(this.node, this);</span>
<a href="#l12.1813"></a><span id="l12.1813" class="difflineplus">+</span>
<a href="#l12.1814"></a><span id="l12.1814" class="difflineplus">+    this.node.querySelector(&quot;.actionsMenu&quot;).addEventListener(&quot;command&quot;,</span>
<a href="#l12.1815"></a><span id="l12.1815" class="difflineplus">+      event =&gt; gGeneralPane.onSelectAction(event.originalTarget));</span>
<a href="#l12.1816"></a><span id="l12.1816" class="difflineplus">+</span>
<a href="#l12.1817"></a><span id="l12.1817" class="difflineplus">+    let typeDescription = this.handlerInfoWrapper.typeDescription;</span>
<a href="#l12.1818"></a><span id="l12.1818" class="difflineplus">+    this.setOrRemoveAttributes([</span>
<a href="#l12.1819"></a><span id="l12.1819" class="difflineplus">+      [null, &quot;type&quot;, this.handlerInfoWrapper.type],</span>
<a href="#l12.1820"></a><span id="l12.1820" class="difflineplus">+      [&quot;.typeContainer&quot;, &quot;tooltiptext&quot;, typeDescription],</span>
<a href="#l12.1821"></a><span id="l12.1821" class="difflineplus">+      [&quot;.typeDescription&quot;, &quot;value&quot;, typeDescription],</span>
<a href="#l12.1822"></a><span id="l12.1822" class="difflineplus">+      [&quot;.typeIcon&quot;, &quot;src&quot;, this.handlerInfoWrapper.smallIcon],</span>
<a href="#l12.1823"></a><span id="l12.1823" class="difflineplus">+    ]);</span>
<a href="#l12.1824"></a><span id="l12.1824" class="difflineplus">+    this.refreshAction();</span>
<a href="#l12.1825"></a><span id="l12.1825" class="difflineplus">+    this.showActionsMenu = false;</span>
<a href="#l12.1826"></a><span id="l12.1826" class="difflineplus">+  }</span>
<a href="#l12.1827"></a><span id="l12.1827" class="difflineplus">+</span>
<a href="#l12.1828"></a><span id="l12.1828" class="difflineplus">+  refreshAction() {</span>
<a href="#l12.1829"></a><span id="l12.1829" class="difflineplus">+    let { actionIconClass, actionDescription } = this.handlerInfoWrapper;</span>
<a href="#l12.1830"></a><span id="l12.1830" class="difflineplus">+    this.setOrRemoveAttributes([</span>
<a href="#l12.1831"></a><span id="l12.1831" class="difflineplus">+      [null, APP_ICON_ATTR_NAME, actionIconClass],</span>
<a href="#l12.1832"></a><span id="l12.1832" class="difflineplus">+      [&quot;.actionContainer&quot;, &quot;tooltiptext&quot;, actionDescription],</span>
<a href="#l12.1833"></a><span id="l12.1833" class="difflineplus">+      [&quot;.actionDescription&quot;, &quot;value&quot;, actionDescription],</span>
<a href="#l12.1834"></a><span id="l12.1834" class="difflineplus">+      [&quot;.actionIcon&quot;, &quot;src&quot;, actionIconClass ? null :</span>
<a href="#l12.1835"></a><span id="l12.1835" class="difflineplus">+                             this.handlerInfoWrapper.actionIcon],</span>
<a href="#l12.1836"></a><span id="l12.1836" class="difflineplus">+    ]);</span>
<a href="#l12.1837"></a><span id="l12.1837" class="difflineplus">+  }</span>
<a href="#l12.1838"></a><span id="l12.1838" class="difflineplus">+</span>
<a href="#l12.1839"></a><span id="l12.1839" class="difflineplus">+  set showActionsMenu(value) {</span>
<a href="#l12.1840"></a><span id="l12.1840" class="difflineplus">+    this.setOrRemoveAttributes([</span>
<a href="#l12.1841"></a><span id="l12.1841" class="difflineplus">+      [&quot;.actionContainer&quot;, &quot;hidden&quot;, value],</span>
<a href="#l12.1842"></a><span id="l12.1842" class="difflineplus">+      [&quot;.actionsMenuContainer&quot;, &quot;hidden&quot;, !value],</span>
<a href="#l12.1843"></a><span id="l12.1843" class="difflineplus">+    ]);</span>
<a href="#l12.1844"></a><span id="l12.1844" class="difflineplus">+  }</span>
<a href="#l12.1845"></a><span id="l12.1845" class="difflineplus">+}</span>
<a href="#l12.1846"></a><span id="l12.1846" class="difflineplus">+</span>
<a href="#l12.1847"></a><span id="l12.1847" class="difflineplus">+/**</span>
<a href="#l12.1848"></a><span id="l12.1848" class="difflineplus">+ * This object wraps nsIHandlerInfo with some additional functionality</span>
<a href="#l12.1849"></a><span id="l12.1849" class="difflineplus">+ * the Applications prefpane needs to display and allow modification of</span>
<a href="#l12.1850"></a><span id="l12.1850" class="difflineplus">+ * the list of handled types.</span>
<a href="#l12.1851"></a><span id="l12.1851" class="difflineplus">+ *</span>
<a href="#l12.1852"></a><span id="l12.1852" class="difflineplus">+ * We create an instance of this wrapper for each entry we might display</span>
<a href="#l12.1853"></a><span id="l12.1853" class="difflineplus">+ * in the prefpane, and we compose the instances from various sources,</span>
<a href="#l12.1854"></a><span id="l12.1854" class="difflineplus">+ * including the handler service.</span>
<a href="#l12.1855"></a><span id="l12.1855" class="difflineplus">+ *</span>
<a href="#l12.1856"></a><span id="l12.1856" class="difflineplus">+ * We don't implement all the original nsIHandlerInfo functionality,</span>
<a href="#l12.1857"></a><span id="l12.1857" class="difflineplus">+ * just the stuff that the prefpane needs.</span>
<a href="#l12.1858"></a><span id="l12.1858" class="difflineplus">+ */</span>
<a href="#l12.1859"></a><span id="l12.1859" class="difflineplus">+class HandlerInfoWrapper {</span>
<a href="#l12.1860"></a><span id="l12.1860" class="difflineplus">+  constructor(type, handlerInfo) {</span>
<a href="#l12.1861"></a><span id="l12.1861" class="difflineplus">+    this.type = type;</span>
<a href="#l12.1862"></a><span id="l12.1862" class="difflineplus">+    this.wrappedHandlerInfo = handlerInfo;</span>
<a href="#l12.1863"></a><span id="l12.1863" class="difflineplus">+    this.disambiguateDescription = false;</span>
<a href="#l12.1864"></a><span id="l12.1864" class="difflineplus">+  }</span>
<a href="#l12.1865"></a><span id="l12.1865" class="difflineplus">+</span>
<a href="#l12.1866"></a><span id="l12.1866" class="difflineplus">+  get description() {</span>
<a href="#l12.1867"></a><span id="l12.1867" class="difflineplus">+    if (this.wrappedHandlerInfo.description)</span>
<a href="#l12.1868"></a><span id="l12.1868" class="difflineplus">+      return this.wrappedHandlerInfo.description;</span>
<a href="#l12.1869"></a><span id="l12.1869" class="difflineplus">+</span>
<a href="#l12.1870"></a><span id="l12.1870" class="difflineplus">+    if (this.primaryExtension) {</span>
<a href="#l12.1871"></a><span id="l12.1871" class="difflineplus">+      var extension = this.primaryExtension.toUpperCase();</span>
<a href="#l12.1872"></a><span id="l12.1872" class="difflineplus">+      return document.getElementById(&quot;bundlePreferences&quot;)</span>
<a href="#l12.1873"></a><span id="l12.1873" class="difflineplus">+                     .getFormattedString(&quot;fileEnding&quot;, [extension]);</span>
<a href="#l12.1874"></a><span id="l12.1874" class="difflineplus">+    }</span>
<a href="#l12.1875"></a><span id="l12.1875" class="difflineplus">+    return this.type;</span>
<a href="#l12.1876"></a><span id="l12.1876" class="difflineplus">+  }</span>
<a href="#l12.1877"></a><span id="l12.1877" class="difflineplus">+</span>
<a href="#l12.1878"></a><span id="l12.1878" class="difflineplus">+  /**</span>
<a href="#l12.1879"></a><span id="l12.1879" class="difflineplus">+   * Describe, in a human-readable fashion, the type represented by the given</span>
<a href="#l12.1880"></a><span id="l12.1880" class="difflineplus">+   * handler info object.  Normally this is just the description, but if more</span>
<a href="#l12.1881"></a><span id="l12.1881" class="difflineplus">+   * than one object presents the same description, &quot;disambiguateDescription&quot;</span>
<a href="#l12.1882"></a><span id="l12.1882" class="difflineplus">+   * is set and we annotate the duplicate descriptions with the type itself</span>
<a href="#l12.1883"></a><span id="l12.1883" class="difflineplus">+   * to help users distinguish between those types.</span>
<a href="#l12.1884"></a><span id="l12.1884" class="difflineplus">+   */</span>
<a href="#l12.1885"></a><span id="l12.1885" class="difflineplus">+  get typeDescription() {</span>
<a href="#l12.1886"></a><span id="l12.1886" class="difflineplus">+    if (this.disambiguateDescription) {</span>
<a href="#l12.1887"></a><span id="l12.1887" class="difflineplus">+      return this.mBundle.getFormattedString(</span>
<a href="#l12.1888"></a><span id="l12.1888" class="difflineplus">+        &quot;typeDetailsWithTypeAndExt&quot;, [this.description, this.type]);</span>
<a href="#l12.1889"></a><span id="l12.1889" class="difflineplus">+    }</span>
<a href="#l12.1890"></a><span id="l12.1890" class="difflineplus">+</span>
<a href="#l12.1891"></a><span id="l12.1891" class="difflineplus">+    return this.description;</span>
<a href="#l12.1892"></a><span id="l12.1892" class="difflineplus">+  }</span>
<a href="#l12.1893"></a><span id="l12.1893" class="difflineplus">+</span>
<a href="#l12.1894"></a><span id="l12.1894" class="difflineplus">+  /**</span>
<a href="#l12.1895"></a><span id="l12.1895" class="difflineplus">+   * Describe, in a human-readable fashion, the preferred action to take on</span>
<a href="#l12.1896"></a><span id="l12.1896" class="difflineplus">+   * the type represented by the given handler info object.</span>
<a href="#l12.1897"></a><span id="l12.1897" class="difflineplus">+   */</span>
<a href="#l12.1898"></a><span id="l12.1898" class="difflineplus">+  get actionDescription() {</span>
<a href="#l12.1899"></a><span id="l12.1899" class="difflineplus">+    // alwaysAskBeforeHandling overrides the preferred action, so if that flag</span>
<a href="#l12.1900"></a><span id="l12.1900" class="difflineplus">+    // is set, then describe that behavior instead.  For most types, this is</span>
<a href="#l12.1901"></a><span id="l12.1901" class="difflineplus">+    // the &quot;alwaysAsk&quot; string, but for the feed type we show something special.</span>
<a href="#l12.1902"></a><span id="l12.1902" class="difflineplus">+    if (this.alwaysAskBeforeHandling) {</span>
<a href="#l12.1903"></a><span id="l12.1903" class="difflineplus">+      return gGeneralPane.mBundle.getString(&quot;alwaysAsk&quot;);</span>
<a href="#l12.1904"></a><span id="l12.1904" class="difflineplus">+    }</span>
<a href="#l12.1905"></a><span id="l12.1905" class="difflineplus">+</span>
<a href="#l12.1906"></a><span id="l12.1906" class="difflineplus">+    switch (this.preferredAction) {</span>
<a href="#l12.1907"></a><span id="l12.1907" class="difflineplus">+      case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l12.1908"></a><span id="l12.1908" class="difflineplus">+        return gGeneralPane.mBundle.getString(&quot;saveFile&quot;);</span>
<a href="#l12.1909"></a><span id="l12.1909" class="difflineplus">+</span>
<a href="#l12.1910"></a><span id="l12.1910" class="difflineplus">+      case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l12.1911"></a><span id="l12.1911" class="difflineplus">+        var preferredApp = this.preferredApplicationHandler;</span>
<a href="#l12.1912"></a><span id="l12.1912" class="difflineplus">+        var name;</span>
<a href="#l12.1913"></a><span id="l12.1913" class="difflineplus">+        if (preferredApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l12.1914"></a><span id="l12.1914" class="difflineplus">+          name = getDisplayNameForFile(preferredApp.executable);</span>
<a href="#l12.1915"></a><span id="l12.1915" class="difflineplus">+        else</span>
<a href="#l12.1916"></a><span id="l12.1916" class="difflineplus">+          name = preferredApp.name;</span>
<a href="#l12.1917"></a><span id="l12.1917" class="difflineplus">+        return gGeneralPane.mBundle.getFormattedString(&quot;useApp&quot;, [name]);</span>
<a href="#l12.1918"></a><span id="l12.1918" class="difflineplus">+</span>
<a href="#l12.1919"></a><span id="l12.1919" class="difflineplus">+      case Ci.nsIHandlerInfo.handleInternally:</span>
<a href="#l12.1920"></a><span id="l12.1920" class="difflineplus">+        if (this instanceof InternalHandlerInfoWrapper) {</span>
<a href="#l12.1921"></a><span id="l12.1921" class="difflineplus">+          return gGeneralPane.mBundle.getFormattedString(&quot;previewInApp&quot;,</span>
<a href="#l12.1922"></a><span id="l12.1922" class="difflineplus">+            [gGeneralPane._brandShortName]);</span>
<a href="#l12.1923"></a><span id="l12.1923" class="difflineplus">+        }</span>
<a href="#l12.1924"></a><span id="l12.1924" class="difflineplus">+</span>
<a href="#l12.1925"></a><span id="l12.1925" class="difflineplus">+        // For other types, handleInternally looks like either useHelperApp</span>
<a href="#l12.1926"></a><span id="l12.1926" class="difflineplus">+        // or useSystemDefault depending on whether or not there's a preferred</span>
<a href="#l12.1927"></a><span id="l12.1927" class="difflineplus">+        // handler app.</span>
<a href="#l12.1928"></a><span id="l12.1928" class="difflineplus">+        if (gGeneralPane.isValidHandlerApp(this.preferredApplicationHandler))</span>
<a href="#l12.1929"></a><span id="l12.1929" class="difflineplus">+          return this.preferredApplicationHandler.name;</span>
<a href="#l12.1930"></a><span id="l12.1930" class="difflineplus">+</span>
<a href="#l12.1931"></a><span id="l12.1931" class="difflineplus">+        return this.defaultDescription;</span>
<a href="#l12.1932"></a><span id="l12.1932" class="difflineplus">+</span>
<a href="#l12.1933"></a><span id="l12.1933" class="difflineplus">+      // XXX Why don't we say the app will handle the type internally?</span>
<a href="#l12.1934"></a><span id="l12.1934" class="difflineplus">+      // Is it because the app can't actually do that?  But if that's true,</span>
<a href="#l12.1935"></a><span id="l12.1935" class="difflineplus">+      // then why would a preferredAction ever get set to this value</span>
<a href="#l12.1936"></a><span id="l12.1936" class="difflineplus">+      // in the first place?</span>
<a href="#l12.1937"></a><span id="l12.1937" class="difflineplus">+</span>
<a href="#l12.1938"></a><span id="l12.1938" class="difflineplus">+      case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l12.1939"></a><span id="l12.1939" class="difflineplus">+        return gGeneralPane.mBundle.getFormattedString(&quot;useDefault&quot;,</span>
<a href="#l12.1940"></a><span id="l12.1940" class="difflineplus">+          [this.defaultDescription]);</span>
<a href="#l12.1941"></a><span id="l12.1941" class="difflineplus">+</span>
<a href="#l12.1942"></a><span id="l12.1942" class="difflineplus">+      default:</span>
<a href="#l12.1943"></a><span id="l12.1943" class="difflineplus">+        throw new Error(`Unexpected preferredAction: ${this.preferredAction}`);</span>
<a href="#l12.1944"></a><span id="l12.1944" class="difflineplus">+    }</span>
<a href="#l12.1945"></a><span id="l12.1945" class="difflineplus">+  }</span>
<a href="#l12.1946"></a><span id="l12.1946" class="difflineplus">+</span>
<a href="#l12.1947"></a><span id="l12.1947" class="difflineplus">+  get actionIconClass() {</span>
<a href="#l12.1948"></a><span id="l12.1948" class="difflineplus">+    if (this.alwaysAskBeforeHandling) {</span>
<a href="#l12.1949"></a><span id="l12.1949" class="difflineplus">+      return &quot;ask&quot;;</span>
<a href="#l12.1950"></a><span id="l12.1950" class="difflineplus">+    }</span>
<a href="#l12.1951"></a><span id="l12.1951" class="difflineplus">+</span>
<a href="#l12.1952"></a><span id="l12.1952" class="difflineplus">+    switch (this.preferredAction) {</span>
<a href="#l12.1953"></a><span id="l12.1953" class="difflineplus">+      case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l12.1954"></a><span id="l12.1954" class="difflineplus">+        return &quot;save&quot;;</span>
<a href="#l12.1955"></a><span id="l12.1955" class="difflineplus">+</span>
<a href="#l12.1956"></a><span id="l12.1956" class="difflineplus">+      case Ci.nsIHandlerInfo.handleInternally:</span>
<a href="#l12.1957"></a><span id="l12.1957" class="difflineplus">+        if (this instanceof InternalHandlerInfoWrapper) {</span>
<a href="#l12.1958"></a><span id="l12.1958" class="difflineplus">+          return &quot;ask&quot;;</span>
<a href="#l12.1959"></a><span id="l12.1959" class="difflineplus">+        }</span>
<a href="#l12.1960"></a><span id="l12.1960" class="difflineplus">+    }</span>
<a href="#l12.1961"></a><span id="l12.1961" class="difflineplus">+</span>
<a href="#l12.1962"></a><span id="l12.1962" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l12.1963"></a><span id="l12.1963" class="difflineplus">+  }</span>
<a href="#l12.1964"></a><span id="l12.1964" class="difflineplus">+</span>
<a href="#l12.1965"></a><span id="l12.1965" class="difflineplus">+  get actionIcon() {</span>
<a href="#l12.1966"></a><span id="l12.1966" class="difflineplus">+    switch (this.preferredAction) {</span>
<a href="#l12.1967"></a><span id="l12.1967" class="difflineplus">+      case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l12.1968"></a><span id="l12.1968" class="difflineplus">+        return this.iconURLForSystemDefault;</span>
<a href="#l12.1969"></a><span id="l12.1969" class="difflineplus">+</span>
<a href="#l12.1970"></a><span id="l12.1970" class="difflineplus">+      case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l12.1971"></a><span id="l12.1971" class="difflineplus">+        let preferredApp = this.preferredApplicationHandler;</span>
<a href="#l12.1972"></a><span id="l12.1972" class="difflineplus">+        if (gGeneralPane.isValidHandlerApp(preferredApp)) {</span>
<a href="#l12.1973"></a><span id="l12.1973" class="difflineplus">+          return gGeneralPane._getIconURLForHandlerApp(preferredApp);</span>
<a href="#l12.1974"></a><span id="l12.1974" class="difflineplus">+        }</span>
<a href="#l12.1975"></a><span id="l12.1975" class="difflineplus">+      // Explicit fall-through</span>
<a href="#l12.1976"></a><span id="l12.1976" class="difflineplus">+</span>
<a href="#l12.1977"></a><span id="l12.1977" class="difflineplus">+      // This should never happen, but if preferredAction is set to some weird</span>
<a href="#l12.1978"></a><span id="l12.1978" class="difflineplus">+      // value, then fall back to the generic application icon.</span>
<a href="#l12.1979"></a><span id="l12.1979" class="difflineplus">+      default:</span>
<a href="#l12.1980"></a><span id="l12.1980" class="difflineplus">+        return ICON_URL_APP;</span>
<a href="#l12.1981"></a><span id="l12.1981" class="difflineplus">+    }</span>
<a href="#l12.1982"></a><span id="l12.1982" class="difflineplus">+  }</span>
<a href="#l12.1983"></a><span id="l12.1983" class="difflineplus">+</span>
<a href="#l12.1984"></a><span id="l12.1984" class="difflineplus">+  get iconURLForSystemDefault() {</span>
<a href="#l12.1985"></a><span id="l12.1985" class="difflineplus">+    // Handler info objects for MIME types on some OSes implement a property bag</span>
<a href="#l12.1986"></a><span id="l12.1986" class="difflineplus">+    // interface from which we can get an icon for the default app, so if we're</span>
<a href="#l12.1987"></a><span id="l12.1987" class="difflineplus">+    // dealing with a MIME type on one of those OSes, then try to get the icon.</span>
<a href="#l12.1988"></a><span id="l12.1988" class="difflineplus">+    if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l12.1989"></a><span id="l12.1989" class="difflineplus">+        this.wrappedHandlerInfo instanceof Ci.nsIPropertyBag) {</span>
<a href="#l12.1990"></a><span id="l12.1990" class="difflineplus">+      try {</span>
<a href="#l12.1991"></a><span id="l12.1991" class="difflineplus">+        let url = this.wrappedHandlerInfo.getProperty(&quot;defaultApplicationIconURL&quot;);</span>
<a href="#l12.1992"></a><span id="l12.1992" class="difflineplus">+        if (url) {</span>
<a href="#l12.1993"></a><span id="l12.1993" class="difflineplus">+          return url + &quot;?size=16&quot;;</span>
<a href="#l12.1994"></a><span id="l12.1994" class="difflineplus">+        }</span>
<a href="#l12.1995"></a><span id="l12.1995" class="difflineplus">+      } catch (ex) { }</span>
<a href="#l12.1996"></a><span id="l12.1996" class="difflineplus">+    }</span>
<a href="#l12.1997"></a><span id="l12.1997" class="difflineplus">+</span>
<a href="#l12.1998"></a><span id="l12.1998" class="difflineplus">+    // If this isn't a MIME type object on an OS that supports retrieving</span>
<a href="#l12.1999"></a><span id="l12.1999" class="difflineplus">+    // the icon, or if we couldn't retrieve the icon for some other reason,</span>
<a href="#l12.2000"></a><span id="l12.2000" class="difflineplus">+    // then use a generic icon.</span>
<a href="#l12.2001"></a><span id="l12.2001" class="difflineplus">+    return ICON_URL_APP;</span>
<a href="#l12.2002"></a><span id="l12.2002" class="difflineplus">+  }</span>
<a href="#l12.2003"></a><span id="l12.2003" class="difflineplus">+</span>
<a href="#l12.2004"></a><span id="l12.2004" class="difflineplus">+  get preferredApplicationHandler() {</span>
<a href="#l12.2005"></a><span id="l12.2005" class="difflineplus">+    return this.wrappedHandlerInfo.preferredApplicationHandler;</span>
<a href="#l12.2006"></a><span id="l12.2006" class="difflineplus">+  }</span>
<a href="#l12.2007"></a><span id="l12.2007" class="difflineplus">+</span>
<a href="#l12.2008"></a><span id="l12.2008" class="difflineplus">+  set preferredApplicationHandler(aNewValue) {</span>
<a href="#l12.2009"></a><span id="l12.2009" class="difflineplus">+    this.wrappedHandlerInfo.preferredApplicationHandler = aNewValue;</span>
<a href="#l12.2010"></a><span id="l12.2010" class="difflineplus">+</span>
<a href="#l12.2011"></a><span id="l12.2011" class="difflineplus">+    // Make sure the preferred handler is in the set of possible handlers.</span>
<a href="#l12.2012"></a><span id="l12.2012" class="difflineplus">+    if (aNewValue)</span>
<a href="#l12.2013"></a><span id="l12.2013" class="difflineplus">+      this.addPossibleApplicationHandler(aNewValue);</span>
<a href="#l12.2014"></a><span id="l12.2014" class="difflineplus">+  }</span>
<a href="#l12.2015"></a><span id="l12.2015" class="difflineplus">+</span>
<a href="#l12.2016"></a><span id="l12.2016" class="difflineplus">+  get possibleApplicationHandlers() {</span>
<a href="#l12.2017"></a><span id="l12.2017" class="difflineplus">+    return this.wrappedHandlerInfo.possibleApplicationHandlers;</span>
<a href="#l12.2018"></a><span id="l12.2018" class="difflineplus">+  }</span>
<a href="#l12.2019"></a><span id="l12.2019" class="difflineplus">+</span>
<a href="#l12.2020"></a><span id="l12.2020" class="difflineplus">+  addPossibleApplicationHandler(aNewHandler) {</span>
<a href="#l12.2021"></a><span id="l12.2021" class="difflineplus">+    var possibleApps = this.possibleApplicationHandlers.enumerate();</span>
<a href="#l12.2022"></a><span id="l12.2022" class="difflineplus">+    while (possibleApps.hasMoreElements()) {</span>
<a href="#l12.2023"></a><span id="l12.2023" class="difflineplus">+      if (possibleApps.getNext().equals(aNewHandler))</span>
<a href="#l12.2024"></a><span id="l12.2024" class="difflineplus">+        return;</span>
<a href="#l12.2025"></a><span id="l12.2025" class="difflineplus">+    }</span>
<a href="#l12.2026"></a><span id="l12.2026" class="difflineplus">+    this.possibleApplicationHandlers.appendElement(aNewHandler);</span>
<a href="#l12.2027"></a><span id="l12.2027" class="difflineplus">+  }</span>
<a href="#l12.2028"></a><span id="l12.2028" class="difflineplus">+</span>
<a href="#l12.2029"></a><span id="l12.2029" class="difflineplus">+  removePossibleApplicationHandler(aHandler) {</span>
<a href="#l12.2030"></a><span id="l12.2030" class="difflineplus">+    var defaultApp = this.preferredApplicationHandler;</span>
<a href="#l12.2031"></a><span id="l12.2031" class="difflineplus">+    if (defaultApp &amp;&amp; aHandler.equals(defaultApp)) {</span>
<a href="#l12.2032"></a><span id="l12.2032" class="difflineplus">+      // If the app we remove was the default app, we must make sure</span>
<a href="#l12.2033"></a><span id="l12.2033" class="difflineplus">+      // it won't be used anymore</span>
<a href="#l12.2034"></a><span id="l12.2034" class="difflineplus">+      this.alwaysAskBeforeHandling = true;</span>
<a href="#l12.2035"></a><span id="l12.2035" class="difflineplus">+      this.preferredApplicationHandler = null;</span>
<a href="#l12.2036"></a><span id="l12.2036" class="difflineplus">+    }</span>
<a href="#l12.2037"></a><span id="l12.2037" class="difflineplus">+</span>
<a href="#l12.2038"></a><span id="l12.2038" class="difflineplus">+    var handlers = this.possibleApplicationHandlers;</span>
<a href="#l12.2039"></a><span id="l12.2039" class="difflineplus">+    for (var i = 0; i &lt; handlers.length; ++i) {</span>
<a href="#l12.2040"></a><span id="l12.2040" class="difflineplus">+      var handler = handlers.queryElementAt(i, Ci.nsIHandlerApp);</span>
<a href="#l12.2041"></a><span id="l12.2041" class="difflineplus">+      if (handler.equals(aHandler)) {</span>
<a href="#l12.2042"></a><span id="l12.2042" class="difflineplus">+        handlers.removeElementAt(i);</span>
<a href="#l12.2043"></a><span id="l12.2043" class="difflineplus">+        break;</span>
<a href="#l12.2044"></a><span id="l12.2044" class="difflineplus">+      }</span>
<a href="#l12.2045"></a><span id="l12.2045" class="difflineplus">+    }</span>
<a href="#l12.2046"></a><span id="l12.2046" class="difflineplus">+  }</span>
<a href="#l12.2047"></a><span id="l12.2047" class="difflineplus">+</span>
<a href="#l12.2048"></a><span id="l12.2048" class="difflineplus">+  get hasDefaultHandler() {</span>
<a href="#l12.2049"></a><span id="l12.2049" class="difflineplus">+    return this.wrappedHandlerInfo.hasDefaultHandler;</span>
<a href="#l12.2050"></a><span id="l12.2050" class="difflineplus">+  }</span>
<a href="#l12.2051"></a><span id="l12.2051" class="difflineplus">+</span>
<a href="#l12.2052"></a><span id="l12.2052" class="difflineplus">+  get defaultDescription() {</span>
<a href="#l12.2053"></a><span id="l12.2053" class="difflineplus">+    return this.wrappedHandlerInfo.defaultDescription;</span>
<a href="#l12.2054"></a><span id="l12.2054" class="difflineplus">+  }</span>
<a href="#l12.2055"></a><span id="l12.2055" class="difflineplus">+</span>
<a href="#l12.2056"></a><span id="l12.2056" class="difflineplus">+  // What to do with content of this type.</span>
<a href="#l12.2057"></a><span id="l12.2057" class="difflineplus">+  get preferredAction() {</span>
<a href="#l12.2058"></a><span id="l12.2058" class="difflineplus">+    // If the action is to use a helper app, but we don't have a preferred</span>
<a href="#l12.2059"></a><span id="l12.2059" class="difflineplus">+    // handler app, then switch to using the system default, if any; otherwise</span>
<a href="#l12.2060"></a><span id="l12.2060" class="difflineplus">+    // fall back to saving to disk, which is the default action in nsMIMEInfo.</span>
<a href="#l12.2061"></a><span id="l12.2061" class="difflineplus">+    // Note: &quot;save to disk&quot; is an invalid value for protocol info objects,</span>
<a href="#l12.2062"></a><span id="l12.2062" class="difflineplus">+    // but the alwaysAskBeforeHandling getter will detect that situation</span>
<a href="#l12.2063"></a><span id="l12.2063" class="difflineplus">+    // and always return true in that case to override this invalid value.</span>
<a href="#l12.2064"></a><span id="l12.2064" class="difflineplus">+    if (this.wrappedHandlerInfo.preferredAction ==</span>
<a href="#l12.2065"></a><span id="l12.2065" class="difflineplus">+          Ci.nsIHandlerInfo.useHelperApp &amp;&amp;</span>
<a href="#l12.2066"></a><span id="l12.2066" class="difflineplus">+        !gGeneralPane.isValidHandlerApp(this.preferredApplicationHandler)) {</span>
<a href="#l12.2067"></a><span id="l12.2067" class="difflineplus">+      if (this.wrappedHandlerInfo.hasDefaultHandler)</span>
<a href="#l12.2068"></a><span id="l12.2068" class="difflineplus">+        return Ci.nsIHandlerInfo.useSystemDefault;</span>
<a href="#l12.2069"></a><span id="l12.2069" class="difflineplus">+      return Ci.nsIHandlerInfo.saveToDisk;</span>
<a href="#l12.2070"></a><span id="l12.2070" class="difflineplus">+    }</span>
<a href="#l12.2071"></a><span id="l12.2071" class="difflineplus">+</span>
<a href="#l12.2072"></a><span id="l12.2072" class="difflineplus">+    return this.wrappedHandlerInfo.preferredAction;</span>
<a href="#l12.2073"></a><span id="l12.2073" class="difflineplus">+  }</span>
<a href="#l12.2074"></a><span id="l12.2074" class="difflineplus">+</span>
<a href="#l12.2075"></a><span id="l12.2075" class="difflineplus">+  set preferredAction(aNewValue) {</span>
<a href="#l12.2076"></a><span id="l12.2076" class="difflineplus">+    this.wrappedHandlerInfo.preferredAction = aNewValue;</span>
<a href="#l12.2077"></a><span id="l12.2077" class="difflineplus">+  }</span>
<a href="#l12.2078"></a><span id="l12.2078" class="difflineplus">+</span>
<a href="#l12.2079"></a><span id="l12.2079" class="difflineplus">+  get alwaysAskBeforeHandling() {</span>
<a href="#l12.2080"></a><span id="l12.2080" class="difflineplus">+    // If this is a protocol type and the preferred action is &quot;save to disk&quot;,</span>
<a href="#l12.2081"></a><span id="l12.2081" class="difflineplus">+    // which is invalid for such types, then return true here to override that</span>
<a href="#l12.2082"></a><span id="l12.2082" class="difflineplus">+    // action.  This could happen when the preferred action is to use a helper</span>
<a href="#l12.2083"></a><span id="l12.2083" class="difflineplus">+    // app, but the preferredApplicationHandler is invalid, and there isn't</span>
<a href="#l12.2084"></a><span id="l12.2084" class="difflineplus">+    // a default handler, so the preferredAction getter returns save to disk</span>
<a href="#l12.2085"></a><span id="l12.2085" class="difflineplus">+    // instead.</span>
<a href="#l12.2086"></a><span id="l12.2086" class="difflineplus">+    if (!(this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) &amp;&amp;</span>
<a href="#l12.2087"></a><span id="l12.2087" class="difflineplus">+        this.preferredAction == Ci.nsIHandlerInfo.saveToDisk)</span>
<a href="#l12.2088"></a><span id="l12.2088" class="difflineplus">+      return true;</span>
<a href="#l12.2089"></a><span id="l12.2089" class="difflineplus">+</span>
<a href="#l12.2090"></a><span id="l12.2090" class="difflineplus">+    return this.wrappedHandlerInfo.alwaysAskBeforeHandling;</span>
<a href="#l12.2091"></a><span id="l12.2091" class="difflineplus">+  }</span>
<a href="#l12.2092"></a><span id="l12.2092" class="difflineplus">+</span>
<a href="#l12.2093"></a><span id="l12.2093" class="difflineplus">+  set alwaysAskBeforeHandling(aNewValue) {</span>
<a href="#l12.2094"></a><span id="l12.2094" class="difflineplus">+    this.wrappedHandlerInfo.alwaysAskBeforeHandling = aNewValue;</span>
<a href="#l12.2095"></a><span id="l12.2095" class="difflineplus">+  }</span>
<a href="#l12.2096"></a><span id="l12.2096" class="difflineplus">+</span>
<a href="#l12.2097"></a><span id="l12.2097" class="difflineplus">+  // The primary file extension associated with this type, if any.</span>
<a href="#l12.2098"></a><span id="l12.2098" class="difflineplus">+  get primaryExtension() {</span>
<a href="#l12.2099"></a><span id="l12.2099" class="difflineplus">+    try {</span>
<a href="#l12.2100"></a><span id="l12.2100" class="difflineplus">+      if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l12.2101"></a><span id="l12.2101" class="difflineplus">+          this.wrappedHandlerInfo.primaryExtension)</span>
<a href="#l12.2102"></a><span id="l12.2102" class="difflineplus">+        return this.wrappedHandlerInfo.primaryExtension;</span>
<a href="#l12.2103"></a><span id="l12.2103" class="difflineplus">+    } catch (ex) {}</span>
<a href="#l12.2104"></a><span id="l12.2104" class="difflineplus">+</span>
<a href="#l12.2105"></a><span id="l12.2105" class="difflineplus">+    return null;</span>
<a href="#l12.2106"></a><span id="l12.2106" class="difflineplus">+  }</span>
<a href="#l12.2107"></a><span id="l12.2107" class="difflineplus">+</span>
<a href="#l12.2108"></a><span id="l12.2108" class="difflineplus">+  // -------</span>
<a href="#l12.2109"></a><span id="l12.2109" class="difflineplus">+  // Storage</span>
<a href="#l12.2110"></a><span id="l12.2110" class="difflineplus">+</span>
<a href="#l12.2111"></a><span id="l12.2111" class="difflineplus">+  store() {</span>
<a href="#l12.2112"></a><span id="l12.2112" class="difflineplus">+    gHandlerService.store(this.wrappedHandlerInfo);</span>
<a href="#l12.2113"></a><span id="l12.2113" class="difflineplus">+  }</span>
<a href="#l12.2114"></a><span id="l12.2114" class="difflineplus">+</span>
<a href="#l12.2115"></a><span id="l12.2115" class="difflineplus">+  remove() {</span>
<a href="#l12.2116"></a><span id="l12.2116" class="difflineplus">+    gHandlerService.remove(this.wrappedHandlerInfo);</span>
<a href="#l12.2117"></a><span id="l12.2117" class="difflineplus">+  }</span>
<a href="#l12.2118"></a><span id="l12.2118" class="difflineplus">+</span>
<a href="#l12.2119"></a><span id="l12.2119" class="difflineplus">+  // -----</span>
<a href="#l12.2120"></a><span id="l12.2120" class="difflineplus">+  // Icons</span>
<a href="#l12.2121"></a><span id="l12.2121" class="difflineplus">+</span>
<a href="#l12.2122"></a><span id="l12.2122" class="difflineplus">+  get smallIcon() {</span>
<a href="#l12.2123"></a><span id="l12.2123" class="difflineplus">+    return this._getIcon(16);</span>
<a href="#l12.2124"></a><span id="l12.2124" class="difflineplus">+  }</span>
<a href="#l12.2125"></a><span id="l12.2125" class="difflineplus">+</span>
<a href="#l12.2126"></a><span id="l12.2126" class="difflineplus">+  get largeIcon() {</span>
<a href="#l12.2127"></a><span id="l12.2127" class="difflineplus">+    return this._getIcon(32);</span>
<a href="#l12.2128"></a><span id="l12.2128" class="difflineplus">+  }</span>
<a href="#l12.2129"></a><span id="l12.2129" class="difflineplus">+</span>
<a href="#l12.2130"></a><span id="l12.2130" class="difflineplus">+  _getIcon(aSize) {</span>
<a href="#l12.2131"></a><span id="l12.2131" class="difflineplus">+    if (this.primaryExtension)</span>
<a href="#l12.2132"></a><span id="l12.2132" class="difflineplus">+      return &quot;moz-icon://goat.&quot; + this.primaryExtension + &quot;?size=&quot; + aSize;</span>
<a href="#l12.2133"></a><span id="l12.2133" class="difflineplus">+</span>
<a href="#l12.2134"></a><span id="l12.2134" class="difflineplus">+    if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo)</span>
<a href="#l12.2135"></a><span id="l12.2135" class="difflineplus">+      return &quot;moz-icon://goat?size=&quot; + aSize + &quot;&amp;contentType=&quot; + this.type;</span>
<a href="#l12.2136"></a><span id="l12.2136" class="difflineplus">+</span>
<a href="#l12.2137"></a><span id="l12.2137" class="difflineplus">+    // FIXME: consider returning some generic icon when we can't get a URL for</span>
<a href="#l12.2138"></a><span id="l12.2138" class="difflineplus">+    // one (for example in the case of protocol schemes).  Filed as bug 395141.</span>
<a href="#l12.2139"></a><span id="l12.2139" class="difflineplus">+    return null;</span>
<a href="#l12.2140"></a><span id="l12.2140" class="difflineplus">+  }</span>
<a href="#l12.2141"></a><span id="l12.2141" class="difflineplus">+}</span>
<a href="#l12.2142"></a><span id="l12.2142" class="difflineplus">+</span>
<a href="#l12.2143"></a><span id="l12.2143" class="difflineplus">+/**</span>
<a href="#l12.2144"></a><span id="l12.2144" class="difflineplus">+ * InternalHandlerInfoWrapper provides a basic mechanism to create an internal</span>
<a href="#l12.2145"></a><span id="l12.2145" class="difflineplus">+ * mime type handler that can be enabled/disabled in the applications preference</span>
<a href="#l12.2146"></a><span id="l12.2146" class="difflineplus">+ * menu.</span>
<a href="#l12.2147"></a><span id="l12.2147" class="difflineplus">+ */</span>
<a href="#l12.2148"></a><span id="l12.2148" class="difflineplus">+class InternalHandlerInfoWrapper extends HandlerInfoWrapper {</span>
<a href="#l12.2149"></a><span id="l12.2149" class="difflineplus">+  constructor(mimeType) {</span>
<a href="#l12.2150"></a><span id="l12.2150" class="difflineplus">+    super(mimeType, gMIMEService.getFromTypeAndExtension(mimeType, null));</span>
<a href="#l12.2151"></a><span id="l12.2151" class="difflineplus">+  }</span>
<a href="#l12.2152"></a><span id="l12.2152" class="difflineplus">+</span>
<a href="#l12.2153"></a><span id="l12.2153" class="difflineplus">+  // Override store so we so we can notify any code listening for registration</span>
<a href="#l12.2154"></a><span id="l12.2154" class="difflineplus">+  // or unregistration of this handler.</span>
<a href="#l12.2155"></a><span id="l12.2155" class="difflineplus">+  store() {</span>
<a href="#l12.2156"></a><span id="l12.2156" class="difflineplus">+    super.store();</span>
<a href="#l12.2157"></a><span id="l12.2157" class="difflineplus">+    Services.obs.notifyObservers(null, this._handlerChanged);</span>
<a href="#l12.2158"></a><span id="l12.2158" class="difflineplus">+  }</span>
<a href="#l12.2159"></a><span id="l12.2159" class="difflineplus">+</span>
<a href="#l12.2160"></a><span id="l12.2160" class="difflineplus">+  get enabled() {</span>
<a href="#l12.2161"></a><span id="l12.2161" class="difflineplus">+    throw Cr.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l12.2162"></a><span id="l12.2162" class="difflineplus">+  }</span>
<a href="#l12.2163"></a><span id="l12.2163" class="difflineplus">+</span>
<a href="#l12.2164"></a><span id="l12.2164" class="difflineplus">+  get description() {</span>
<a href="#l12.2165"></a><span id="l12.2165" class="difflineplus">+    return gGeneralPane._prefsBundle.getString(this._appPrefLabel);</span>
<a href="#l12.2166"></a><span id="l12.2166" class="difflineplus">+  }</span>
<a href="#l12.2167"></a><span id="l12.2167" class="difflineplus">+}</span>
<a href="#l12.2168"></a><span id="l12.2168" class="difflineplus">+</span>
<a href="#l12.2169"></a><span id="l12.2169" class="difflineplus">+function addTagCallback(aName, aColor) {</span>
<a href="#l12.2170"></a><span id="l12.2170" class="difflineplus">+  MailServices.tags.addTag(aName, aColor, &quot;&quot;);</span>
<a href="#l12.2171"></a><span id="l12.2171" class="difflineplus">+</span>
<a href="#l12.2172"></a><span id="l12.2172" class="difflineplus">+  // Add to style sheet.</span>
<a href="#l12.2173"></a><span id="l12.2173" class="difflineplus">+  let key = MailServices.tags.getKeyForTag(aName);</span>
<a href="#l12.2174"></a><span id="l12.2174" class="difflineplus">+  TagUtils.addTagToAllDocumentSheets(key, aColor);</span>
<a href="#l12.2175"></a><span id="l12.2175" class="difflineplus">+</span>
<a href="#l12.2176"></a><span id="l12.2176" class="difflineplus">+  var item = gGeneralPane.appendTagItem(aName, key, aColor);</span>
<a href="#l12.2177"></a><span id="l12.2177" class="difflineplus">+  var tagListBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l12.2178"></a><span id="l12.2178" class="difflineplus">+  tagListBox.ensureElementIsVisible(item);</span>
<a href="#l12.2179"></a><span id="l12.2179" class="difflineplus">+  tagListBox.selectItem(item);</span>
<a href="#l12.2180"></a><span id="l12.2180" class="difflineplus">+  tagListBox.focus();</span>
<a href="#l12.2181"></a><span id="l12.2181" class="difflineplus">+}</span>
<a href="#l12.2182"></a><span id="l12.2182" class="difflineplus">+</span>
<a href="#l12.2183"></a><span id="l12.2183" class="difflineplus">+function editTagCallback() {</span>
<a href="#l12.2184"></a><span id="l12.2184" class="difflineplus">+  // update the values of the selected item</span>
<a href="#l12.2185"></a><span id="l12.2185" class="difflineplus">+  let tagListEl = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l12.2186"></a><span id="l12.2186" class="difflineplus">+  let index = tagListEl.selectedIndex;</span>
<a href="#l12.2187"></a><span id="l12.2187" class="difflineplus">+  if (index &lt; 0)</span>
<a href="#l12.2188"></a><span id="l12.2188" class="difflineplus">+    return;</span>
<a href="#l12.2189"></a><span id="l12.2189" class="difflineplus">+</span>
<a href="#l12.2190"></a><span id="l12.2190" class="difflineplus">+  let tagElToEdit = tagListEl.getItemAtIndex(index);</span>
<a href="#l12.2191"></a><span id="l12.2191" class="difflineplus">+  let key = tagElToEdit.getAttribute(&quot;value&quot;);</span>
<a href="#l12.2192"></a><span id="l12.2192" class="difflineplus">+  let color = MailServices.tags.getColorForKey(key);</span>
<a href="#l12.2193"></a><span id="l12.2193" class="difflineplus">+  // update the color and label elements</span>
<a href="#l12.2194"></a><span id="l12.2194" class="difflineplus">+  tagElToEdit.setAttribute(&quot;label&quot;, MailServices.tags.getTagForKey(key));</span>
<a href="#l12.2195"></a><span id="l12.2195" class="difflineplus">+  tagElToEdit.style.color = color;</span>
<a href="#l12.2196"></a><span id="l12.2196" class="difflineplus">+</span>
<a href="#l12.2197"></a><span id="l12.2197" class="difflineplus">+  // Add to style sheet. We simply add the new color, the rule is added at the</span>
<a href="#l12.2198"></a><span id="l12.2198" class="difflineplus">+  // end and will overrule the previous rule.</span>
<a href="#l12.2199"></a><span id="l12.2199" class="difflineplus">+  TagUtils.addTagToAllDocumentSheets(key, color);</span>
<a href="#l12.2200"></a><span id="l12.2200" class="difflineplus">+}</span>
<a href="#l12.2201"></a><span id="l12.2201" class="difflineplus">+</span>
<a href="#l12.2202"></a><span id="l12.2202"> Preferences.get(&quot;mailnews.start_page.enabled&quot;).on(&quot;change&quot;, gGeneralPane.updateStartPage);</span>
<a href="#l12.2203"></a><span id="l12.2203" class="difflineplus">+Preferences.get(&quot;font.language.group&quot;).on(&quot;change&quot;, gGeneralPane._rebuildFonts);</span>
<a href="#l12.2204"></a><span id="l12.2204" class="difflineplus">+Preferences.get(&quot;mailnews.mark_message_read.auto&quot;).on(&quot;change&quot;, gGeneralPane.updateMarkAsReadOptions);</span>
<a href="#l12.2205"></a><span id="l12.2205" class="difflineplus">+Preferences.get(&quot;mailnews.mark_message_read.delay&quot;).on(&quot;change&quot;, gGeneralPane.updateMarkAsReadTextbox);</span>
<a href="#l12.2206"></a><span id="l12.2206" class="difflineplus">+Preferences.get(&quot;mail.prompt_purge_threshhold&quot;).on(&quot;change&quot;, gGeneralPane.updateCompactOptions);</span>
<a href="#l12.2207"></a><span id="l12.2207" class="difflineplus">+Preferences.get(&quot;layers.acceleration.disabled&quot;).on(&quot;change&quot;, gGeneralPane.updateHardwareAcceleration);</span>
<a href="#l12.2208"></a><span id="l12.2208"> if (AppConstants.platform != &quot;macosx&quot;) {</span>
<a href="#l12.2209"></a><span id="l12.2209">   Preferences.get(&quot;mail.biff.show_alert&quot;).on(&quot;change&quot;, gGeneralPane.updateCustomizeAlert);</span>
<a href="#l12.2210"></a><span id="l12.2210"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/preferences/jar.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/preferences/jar.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -6,17 +6,16 @@ messenger.jar:</span>
<a href="#l13.4"></a><span id="l13.4"> *   content/messenger/preferences/aboutPreferences.xul</span>
<a href="#l13.5"></a><span id="l13.5">     content/messenger/preferences/preferences.js</span>
<a href="#l13.6"></a><span id="l13.6">     content/messenger/preferences/preferencesTab.js</span>
<a href="#l13.7"></a><span id="l13.7">     content/messenger/preferences/general.js</span>
<a href="#l13.8"></a><span id="l13.8"> #ifdef XP_MACOSX</span>
<a href="#l13.9"></a><span id="l13.9">     content/messenger/preferences/dockoptions.js</span>
<a href="#l13.10"></a><span id="l13.10">     content/messenger/preferences/dockoptions.xul</span>
<a href="#l13.11"></a><span id="l13.11"> #endif</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    content/messenger/preferences/display.js</span>
<a href="#l13.13"></a><span id="l13.13">     content/messenger/preferences/chat.js</span>
<a href="#l13.14"></a><span id="l13.14">     content/messenger/preferences/messagestyle.js</span>
<a href="#l13.15"></a><span id="l13.15">     content/messenger/preferences/messengerLanguages.js</span>
<a href="#l13.16"></a><span id="l13.16">     content/messenger/preferences/messengerLanguages.xul</span>
<a href="#l13.17"></a><span id="l13.17">     content/messenger/preferences/colors.js</span>
<a href="#l13.18"></a><span id="l13.18"> *   content/messenger/preferences/colors.xul</span>
<a href="#l13.19"></a><span id="l13.19">     content/messenger/preferences/compose.js</span>
<a href="#l13.20"></a><span id="l13.20">     content/messenger/preferences/privacy.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/preferences/preferences.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/preferences/preferences.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -33,17 +33,17 @@ var selector = document.getElementById(&quot;</span>
<a href="#l14.4"></a><span id="l14.4">     // Expose preference group choice to accessibility APIs as an unchecked list item</span>
<a href="#l14.5"></a><span id="l14.5">     // The parent group is exposed to accessibility APIs as a list</span>
<a href="#l14.6"></a><span id="l14.6">     if (pane.image) {</span>
<a href="#l14.7"></a><span id="l14.7">       radio.setAttribute(&quot;src&quot;, pane.image);</span>
<a href="#l14.8"></a><span id="l14.8">     }</span>
<a href="#l14.9"></a><span id="l14.9">     radio.style.listStyleImage = pane.style.listStyleImage;</span>
<a href="#l14.10"></a><span id="l14.10">     selector.appendChild(radio);</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    pane.dispatchEvent(new CustomEvent(&quot;paneload&quot;));</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+    setTimeout(function() { pane.dispatchEvent(new CustomEvent(&quot;paneload&quot;)); }, 1);</span>
<a href="#l14.14"></a><span id="l14.14">   }</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">   if (prefPanes.length == 1) {</span>
<a href="#l14.17"></a><span id="l14.17">     selector.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l14.18"></a><span id="l14.18">   }</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">   window.addEventListener(&quot;DOMContentLoaded&quot;, function() {</span>
<a href="#l14.21"></a><span id="l14.21">     if (document.documentElement.hasAttribute(&quot;lastSelected&quot;)) {</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -88,16 +88,17 @@ function showPane(paneID) {</span>
<a href="#l14.23"></a><span id="l14.23">       return;</span>
<a href="#l14.24"></a><span id="l14.24">     }</span>
<a href="#l14.25"></a><span id="l14.25">     currentlySelected.removeAttribute(&quot;selected&quot;);</span>
<a href="#l14.26"></a><span id="l14.26">   }</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28">   selector.value = paneID;</span>
<a href="#l14.29"></a><span id="l14.29">   pane.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l14.30"></a><span id="l14.30">   pane.dispatchEvent(new CustomEvent(&quot;paneSelected&quot;, { bubbles: true }));</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+  document.getElementById(&quot;preferencesContainer&quot;).scrollTo(0, 0);</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33">   document.documentElement.setAttribute(&quot;lastSelected&quot;, paneID);</span>
<a href="#l14.34"></a><span id="l14.34">   Services.xulStore.persist(document.documentElement, &quot;lastSelected&quot;);</span>
<a href="#l14.35"></a><span id="l14.35"> }</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37"> /**</span>
<a href="#l14.38"></a><span id="l14.38">  * Selects the specified preferences pane</span>
<a href="#l14.39"></a><span id="l14.39">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/advanced.dtd</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -28,17 +28,16 @@</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5"> &lt;!ENTITY systemIntegration.label       &quot;System Integration&quot;&gt;</span>
<a href="#l15.6"></a><span id="l15.6"> &lt;!ENTITY alwaysCheckDefault.label      &quot;Always check to see if &amp;brandShortName; is the default mail client on startup&quot;&gt;</span>
<a href="#l15.7"></a><span id="l15.7"> &lt;!ENTITY alwaysCheckDefault.accesskey  &quot;A&quot;&gt;</span>
<a href="#l15.8"></a><span id="l15.8"> &lt;!ENTITY searchIntegration.label       &quot;Allow &amp;searchIntegration.engineName; to search messages&quot;&gt;</span>
<a href="#l15.9"></a><span id="l15.9"> &lt;!ENTITY searchIntegration.accesskey   &quot;S&quot;&gt;</span>
<a href="#l15.10"></a><span id="l15.10"> &lt;!ENTITY checkDefaultsNow.label        &quot;Check Now&quot;&gt;</span>
<a href="#l15.11"></a><span id="l15.11"> &lt;!ENTITY checkDefaultsNow.accesskey    &quot;N&quot;&gt;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-&lt;!ENTITY configEditDesc.label          &quot;Advanced Configuration&quot;&gt;</span>
<a href="#l15.13"></a><span id="l15.13"> &lt;!ENTITY configEdit.label              &quot;Config Editor&quot;&gt;</span>
<a href="#l15.14"></a><span id="l15.14"> &lt;!ENTITY configEdit.accesskey          &quot;C&quot;&gt;</span>
<a href="#l15.15"></a><span id="l15.15"> &lt;!ENTITY returnReceiptsInfo.label      &quot;Determine how &amp;brandShortName; handles return receipts&quot;&gt;</span>
<a href="#l15.16"></a><span id="l15.16"> &lt;!ENTITY showReturnReceipts.label      &quot;Return Receipts&quot;&gt;</span>
<a href="#l15.17"></a><span id="l15.17"> &lt;!ENTITY showReturnReceipts.accesskey  &quot;R&quot;&gt;</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19"> &lt;!-- Data Choices --&gt;</span>
<a href="#l15.20"></a><span id="l15.20"> &lt;!ENTITY telemetrySection.label          &quot;Telemetry&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/display.dtd</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/display.dtd</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -43,17 +43,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> &lt;!ENTITY defaultSize.accesskey   &quot;S&quot;&gt;</span>
<a href="#l16.5"></a><span id="l16.5"> &lt;!ENTITY fontOptions.accesskey   &quot;A&quot;&gt;</span>
<a href="#l16.6"></a><span id="l16.6"> &lt;!ENTITY fontOptions.label       &quot;Advanced&quot;&gt;</span>
<a href="#l16.7"></a><span id="l16.7"> &lt;!ENTITY colorButton.label       &quot;Colors&quot;&gt;</span>
<a href="#l16.8"></a><span id="l16.8"> &lt;!ENTITY colorButton.accesskey   &quot;C&quot;&gt;</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10"> &lt;!-- Advanced --&gt;</span>
<a href="#l16.11"></a><span id="l16.11"> &lt;!ENTITY reading.caption                  &quot;Reading&quot;&gt;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-&lt;!ENTITY display.caption                  &quot;Display&quot;&gt;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+&lt;!ENTITY displayName.label                &quot;Display name:&quot;&gt;</span>
<a href="#l16.14"></a><span id="l16.14"> &lt;!ENTITY showCondensedAddresses.label     &quot;Show only display name for people in my address book&quot;&gt;</span>
<a href="#l16.15"></a><span id="l16.15"> &lt;!ENTITY showCondensedAddresses.accesskey &quot;S&quot;&gt;</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17"> &lt;!ENTITY autoMarkAsRead.label             &quot;Automatically mark messages as read&quot;&gt;</span>
<a href="#l16.18"></a><span id="l16.18"> &lt;!ENTITY autoMarkAsRead.accesskey         &quot;A&quot;&gt;</span>
<a href="#l16.19"></a><span id="l16.19"> &lt;!ENTITY markAsReadNoDelay.label          &quot;Immediately on display&quot;&gt;</span>
<a href="#l16.20"></a><span id="l16.20"> &lt;!ENTITY markAsReadNoDelay.accesskey      &quot;o&quot;&gt;</span>
<a href="#l16.21"></a><span id="l16.21"> &lt;!-- LOCALIZATION NOTE (markAsReadDelay.label): This will concatenate to</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/locales/en-US/messenger/preferences/preferences.ftl</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/locales/en-US/messenger/preferences/preferences.ftl</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1,12 +1,33 @@</span>
<a href="#l17.4"></a><span id="l17.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.5"></a><span id="l17.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.6"></a><span id="l17.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+pane-general-title = General</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+category-general =</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+    .tooltiptext = { pane-general-title }</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+general-language-and-appearance-header = Language &amp; Appearance</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+general-incoming-mail-header = Incoming Mails</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+general-files-and-attachment-header = Files &amp; Attachments</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+general-tags-header = Tags</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+general-reading-and-display-header = Reading &amp; Display</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+general-updates-header = Updates</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+general-network-and-diskspace-header = Network &amp; Disk Space</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+general-indexing-label = Indexing</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+</span>
<a href="#l17.29"></a><span id="l17.29"> choose-messenger-language-description = Choose the languages used to display menus, messages, and notifications from { -brand-short-name }.</span>
<a href="#l17.30"></a><span id="l17.30"> manage-messenger-languages-button =</span>
<a href="#l17.31"></a><span id="l17.31">   .label = Set Alternatives</span>
<a href="#l17.32"></a><span id="l17.32">   .accesskey = l</span>
<a href="#l17.33"></a><span id="l17.33"> confirm-messenger-language-change-description = Restart { -brand-short-name } to apply these changes</span>
<a href="#l17.34"></a><span id="l17.34"> confirm-messenger-language-change-button = Apply and Restart</span>
<a href="#l17.35"></a><span id="l17.35"> </span>
<a href="#l17.36"></a><span id="l17.36"> update-setting-write-failure-title = Error saving Update preferences</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/themes/linux/mail/preferences/preferences.css</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/themes/linux/mail/preferences/preferences.css</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -24,21 +24,16 @@ menulist &gt; .menulist-label-box &gt; .menuli</span>
<a href="#l18.4"></a><span id="l18.4">   margin-inline-start: 5px;</span>
<a href="#l18.5"></a><span id="l18.5">   margin-inline-end: 5px;</span>
<a href="#l18.6"></a><span id="l18.6"> }</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> menulist &gt; menupopup &gt; menuitem &gt; .menu-iconic-left {</span>
<a href="#l18.9"></a><span id="l18.9">   margin-inline-end: 5px !important;</span>
<a href="#l18.10"></a><span id="l18.10"> }</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-/* Attachments Pane */</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-#handlersView {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-  -moz-box-flex: 1;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-}</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-</span>
<a href="#l18.17"></a><span id="l18.17"> /* Modeless Window Dialogs */</span>
<a href="#l18.18"></a><span id="l18.18"> .windowDialog,</span>
<a href="#l18.19"></a><span id="l18.19"> .windowDialog prefpane {</span>
<a href="#l18.20"></a><span id="l18.20">   padding: 0px;</span>
<a href="#l18.21"></a><span id="l18.21"> }</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23"> .contentPane {</span>
<a href="#l18.24"></a><span id="l18.24">   margin: 9px 8px 5px;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/themes/osx/mail/preferences/preferences.css</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/themes/osx/mail/preferences/preferences.css</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -17,21 +17,16 @@</span>
<a href="#l19.4"></a><span id="l19.4">   line-height: 1.3em;</span>
<a href="#l19.5"></a><span id="l19.5">   margin-bottom: 4px !important;</span>
<a href="#l19.6"></a><span id="l19.6"> }</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> menulist &gt; menupopup &gt; menuitem {</span>
<a href="#l19.9"></a><span id="l19.9">   font: -moz-pull-down-menu;</span>
<a href="#l19.10"></a><span id="l19.10"> }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-/* Attachments Pane */</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-#handlersView {</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-  -moz-box-flex: 1;</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-}</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-</span>
<a href="#l19.17"></a><span id="l19.17"> #browserStartupHomepage {</span>
<a href="#l19.18"></a><span id="l19.18">   padding-top: 2px;</span>
<a href="#l19.19"></a><span id="l19.19">   padding-bottom: 3px;</span>
<a href="#l19.20"></a><span id="l19.20">   padding-inline-start: 4px;</span>
<a href="#l19.21"></a><span id="l19.21">   padding-inline-end: 2px;</span>
<a href="#l19.22"></a><span id="l19.22"> }</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24"> caption {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/themes/shared/mail/incontentprefs/aboutPreferences.css</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/themes/shared/mail/incontentprefs/aboutPreferences.css</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -29,27 +29,56 @@</span>
<a href="#l20.4"></a><span id="l20.4">   position: relative;</span>
<a href="#l20.5"></a><span id="l20.5"> }</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> #pref-category-box {</span>
<a href="#l20.8"></a><span id="l20.8">   background-color: var(--in-content-categories-background);</span>
<a href="#l20.9"></a><span id="l20.9">   width: 240px;</span>
<a href="#l20.10"></a><span id="l20.10"> }</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+/* Subcategory title */</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+/**</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+ * The first subcategory title for each category should not have margin-top.</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+ */</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+.subcategory:not([hidden]) ~ .subcategory {</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+  margin-top: 16px;</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+  padding-top: 16px;</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+  border-top: 1px solid var(--in-content-border-color);</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+}</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineplus">+groupbox[data-category] {</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineplus">+  margin: 0 0 32px;</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineplus">+}</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+html|h1 {</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineplus">+  margin: 0 0 8px;</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineplus">+  font-size: 1.46em;</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+  font-weight: 300;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+  line-height: 1.3em;</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineplus">+}</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+</span>
<a href="#l20.35"></a><span id="l20.35"> html|h2 {</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-  font-size: 1.14em;</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-  margin: 4px 0 !important;</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+  margin: 16px 0 4px;</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+  font-size: 1.1em;</span>
<a href="#l20.40"></a><span id="l20.40"> }</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42"> html|h3 {</span>
<a href="#l20.43"></a><span id="l20.43">   font-size: 1em;</span>
<a href="#l20.44"></a><span id="l20.44">   font-weight: 600;</span>
<a href="#l20.45"></a><span id="l20.45">   margin: 4px 0 !important;</span>
<a href="#l20.46"></a><span id="l20.46"> }</span>
<a href="#l20.47"></a><span id="l20.47"> </span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+description,</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineplus">+label {</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+  line-height: 1.8em;</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+  margin: 0;</span>
<a href="#l20.52"></a><span id="l20.52" class="difflineplus">+}</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineplus">+</span>
<a href="#l20.54"></a><span id="l20.54"> #preferencesContainer {</span>
<a href="#l20.55"></a><span id="l20.55">   padding: 40px 28px;</span>
<a href="#l20.56"></a><span id="l20.56">   overflow: auto;</span>
<a href="#l20.57"></a><span id="l20.57"> }</span>
<a href="#l20.58"></a><span id="l20.58"> </span>
<a href="#l20.59"></a><span id="l20.59"> #MailPreferences prefpane {</span>
<a href="#l20.60"></a><span id="l20.60">   max-width: 800px;</span>
<a href="#l20.61"></a><span id="l20.61">   padding: 0;</span>
<a href="#l20.62"></a><span id="l20.62" class="difflineat">@@ -237,20 +266,16 @@ textbox[type=&quot;filefield&quot;] {</span>
<a href="#l20.63"></a><span id="l20.63"> textbox[type=&quot;filefield&quot;]:-moz-locale-dir(rtl) {</span>
<a href="#l20.64"></a><span id="l20.64">   background-position-x: right 8px;</span>
<a href="#l20.65"></a><span id="l20.65"> }</span>
<a href="#l20.66"></a><span id="l20.66"> </span>
<a href="#l20.67"></a><span id="l20.67"> textbox[type=&quot;filefield&quot;][disabled=&quot;true&quot;] {</span>
<a href="#l20.68"></a><span id="l20.68">   color: var(--in-content-text-color);</span>
<a href="#l20.69"></a><span id="l20.69"> }</span>
<a href="#l20.70"></a><span id="l20.70"> </span>
<a href="#l20.71"></a><span id="l20.71" class="difflineminus">-textbox + button {</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-  margin-inline-start: -4px;</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-}</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-</span>
<a href="#l20.75"></a><span id="l20.75"> html|input[type=&quot;number&quot;] {</span>
<a href="#l20.76"></a><span id="l20.76">   margin-inline-start: 4px;</span>
<a href="#l20.77"></a><span id="l20.77">   padding: 1px;</span>
<a href="#l20.78"></a><span id="l20.78"> }</span>
<a href="#l20.79"></a><span id="l20.79"> /* sizes: chars + 8px padding + 1px borders + spin buttons 25+2+10px  */</span>
<a href="#l20.80"></a><span id="l20.80"> html|input[type=&quot;number&quot;].size2 {</span>
<a href="#l20.81"></a><span id="l20.81">   width: calc(2ch + 55px);</span>
<a href="#l20.82"></a><span id="l20.82"> }</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineat">@@ -316,16 +341,17 @@ tab:-moz-focusring &gt; .tab-middle {</span>
<a href="#l20.84"></a><span id="l20.84"> /* Applications Pane Styles */</span>
<a href="#l20.85"></a><span id="l20.85"> </span>
<a href="#l20.86"></a><span id="l20.86"> #applications-content {</span>
<a href="#l20.87"></a><span id="l20.87">   padding: 15px;</span>
<a href="#l20.88"></a><span id="l20.88"> }</span>
<a href="#l20.89"></a><span id="l20.89"> </span>
<a href="#l20.90"></a><span id="l20.90"> #filter {</span>
<a href="#l20.91"></a><span id="l20.91">   margin-inline-start: 0;</span>
<a href="#l20.92"></a><span id="l20.92" class="difflineplus">+  margin-inline-end: 0;</span>
<a href="#l20.93"></a><span id="l20.93"> }</span>
<a href="#l20.94"></a><span id="l20.94"> </span>
<a href="#l20.95"></a><span id="l20.95"> #handlersView &gt; richlistitem {</span>
<a href="#l20.96"></a><span id="l20.96">   min-height: 36px !important;</span>
<a href="#l20.97"></a><span id="l20.97">   padding: 0;</span>
<a href="#l20.98"></a><span id="l20.98"> }</span>
<a href="#l20.99"></a><span id="l20.99"> </span>
<a href="#l20.100"></a><span id="l20.100"> .shortDetails {</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineat">@@ -511,22 +537,32 @@ richlistbox richlistitem:hover {</span>
<a href="#l20.102"></a><span id="l20.102">   background-color: var(--in-content-item-hover);</span>
<a href="#l20.103"></a><span id="l20.103"> }</span>
<a href="#l20.104"></a><span id="l20.104"> </span>
<a href="#l20.105"></a><span id="l20.105"> richlistbox:focus &gt; richlistitem[selected=&quot;true&quot;] {</span>
<a href="#l20.106"></a><span id="l20.106">   background-color: var(--in-content-item-selected);</span>
<a href="#l20.107"></a><span id="l20.107">   color: var(--in-content-selected-text) !important;</span>
<a href="#l20.108"></a><span id="l20.108"> }</span>
<a href="#l20.109"></a><span id="l20.109"> </span>
<a href="#l20.110"></a><span id="l20.110" class="difflineplus">+#defaultWebSearch {</span>
<a href="#l20.111"></a><span id="l20.111" class="difflineplus">+  margin-inline-start: 0;</span>
<a href="#l20.112"></a><span id="l20.112" class="difflineplus">+  margin-inline-end: 4px;</span>
<a href="#l20.113"></a><span id="l20.113" class="difflineplus">+}</span>
<a href="#l20.114"></a><span id="l20.114" class="difflineplus">+</span>
<a href="#l20.115"></a><span id="l20.115" class="difflineplus">+#defaultFontSize {</span>
<a href="#l20.116"></a><span id="l20.116" class="difflineplus">+  margin-inline-end: 4px;</span>
<a href="#l20.117"></a><span id="l20.117" class="difflineplus">+}</span>
<a href="#l20.118"></a><span id="l20.118" class="difflineplus">+</span>
<a href="#l20.119"></a><span id="l20.119"> #messengerLanguagesDialogPane {</span>
<a href="#l20.120"></a><span id="l20.120">   min-height: 360px;</span>
<a href="#l20.121"></a><span id="l20.121"> }</span>
<a href="#l20.122"></a><span id="l20.122"> </span>
<a href="#l20.123"></a><span id="l20.123"> #defaultMessengerLanguage {</span>
<a href="#l20.124"></a><span id="l20.124">   margin-inline-start: 0;</span>
<a href="#l20.125"></a><span id="l20.125" class="difflineplus">+  margin-inline-end: 4px;</span>
<a href="#l20.126"></a><span id="l20.126">   min-width: 20em;</span>
<a href="#l20.127"></a><span id="l20.127"> }</span>
<a href="#l20.128"></a><span id="l20.128"> </span>
<a href="#l20.129"></a><span id="l20.129"> #MessengerLanguagesDialog &gt; .dialog-button-box &gt; .dialog-button[dlgtype=&quot;accept&quot;] {</span>
<a href="#l20.130"></a><span id="l20.130">   margin-inline-end: 0;</span>
<a href="#l20.131"></a><span id="l20.131"> }</span>
<a href="#l20.132"></a><span id="l20.132"> </span>
<a href="#l20.133"></a><span id="l20.133"> #availableLocales {</span>
<a href="#l20.134"></a><span id="l20.134" class="difflineat">@@ -546,16 +582,24 @@ richlistbox:focus &gt; richlistitem[selecte</span>
<a href="#l20.135"></a><span id="l20.135">   margin: 0;</span>
<a href="#l20.136"></a><span id="l20.136">   margin-inline-start: 4px;</span>
<a href="#l20.137"></a><span id="l20.137"> }</span>
<a href="#l20.138"></a><span id="l20.138"> </span>
<a href="#l20.139"></a><span id="l20.139"> .action-button {</span>
<a href="#l20.140"></a><span id="l20.140">   margin-inline-end: 0;</span>
<a href="#l20.141"></a><span id="l20.141"> }</span>
<a href="#l20.142"></a><span id="l20.142"> </span>
<a href="#l20.143"></a><span id="l20.143" class="difflineplus">+#tagList {</span>
<a href="#l20.144"></a><span id="l20.144" class="difflineplus">+  margin-inline-end: 4px;</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineplus">+}</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineplus">+</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineplus">+#tagButtons &gt; button:first-child {</span>
<a href="#l20.148"></a><span id="l20.148" class="difflineplus">+  margin-top: 0;</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineplus">+}</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineplus">+</span>
<a href="#l20.151"></a><span id="l20.151"> /* Menulist styles */</span>
<a href="#l20.152"></a><span id="l20.152"> .label-item {</span>
<a href="#l20.153"></a><span id="l20.153">   font-size: .8em;</span>
<a href="#l20.154"></a><span id="l20.154"> }</span>
<a href="#l20.155"></a><span id="l20.155"> </span>
<a href="#l20.156"></a><span id="l20.156"> /**</span>
<a href="#l20.157"></a><span id="l20.157">  * Dialog</span>
<a href="#l20.158"></a><span id="l20.158">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/themes/windows/mail/preferences/preferences.css</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/themes/windows/mail/preferences/preferences.css</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -16,21 +16,16 @@</span>
<a href="#l21.4"></a><span id="l21.4"> </span>
<a href="#l21.5"></a><span id="l21.5"> @media (-moz-windows-default-theme) {</span>
<a href="#l21.6"></a><span id="l21.6">   menulist &gt; .menulist-label-box &gt; .menulist-icon[src] {</span>
<a href="#l21.7"></a><span id="l21.7">     margin-inline-start: 7px;</span>
<a href="#l21.8"></a><span id="l21.8">     margin-inline-end: 10px;</span>
<a href="#l21.9"></a><span id="l21.9">   }</span>
<a href="#l21.10"></a><span id="l21.10"> }</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-/* Attachments Pane */</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-#handlersView {</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-  -moz-box-flex: 1;</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-}</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-</span>
<a href="#l21.17"></a><span id="l21.17"> /* Modeless Window Dialogs */</span>
<a href="#l21.18"></a><span id="l21.18"> .windowDialog,</span>
<a href="#l21.19"></a><span id="l21.19"> .windowDialog prefpane {</span>
<a href="#l21.20"></a><span id="l21.20">   padding: 0px;</span>
<a href="#l21.21"></a><span id="l21.21"> }</span>
<a href="#l21.22"></a><span id="l21.22"> </span>
<a href="#l21.23"></a><span id="l21.23"> .contentPane {</span>
<a href="#l21.24"></a><span id="l21.24">   margin: 9px 8px 5px;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

