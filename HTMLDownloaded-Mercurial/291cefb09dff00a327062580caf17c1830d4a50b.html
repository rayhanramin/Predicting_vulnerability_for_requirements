<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21651:291cefb09dff00a327062580caf17c1830d4a50b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 291cefb09dff00a327062580caf17c1830d4a50b" />
<meta property="og:url" content="/comm-central/rev/291cefb09dff00a327062580caf17c1830d4a50b" />
<meta property="og:description" content="Bug 1347211 - Remove some deprecated functions from calUtils.js. r=MakeMyDay" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 291cefb09dff00a327062580caf17c1830d4a50b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/291cefb09dff00a327062580caf17c1830d4a50b">shortlog</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/291cefb09dff00a327062580caf17c1830d4a50b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b">files</a> |
changeset |
<a href="/comm-central/raw-rev/291cefb09dff00a327062580caf17c1830d4a50b">raw</a>  | <a href="/comm-central/archive/291cefb09dff00a327062580caf17c1830d4a50b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1347211">Bug 1347211</a> - Remove some deprecated functions from calUtils.js. r=MakeMyDay
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 08 Jun 2017 00:02:05 +0200</td></tr>

<tr>
 <td>changeset 21651</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/291cefb09dff00a327062580caf17c1830d4a50b">291cefb09dff00a327062580caf17c1830d4a50b</a></td>
</tr>



<tr>
<td>parent 21650</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4bafb6c2ddaf96fce9afed6ad76793224927207e">4bafb6c2ddaf96fce9afed6ad76793224927207e</a>
</td>
</tr>

<tr>
<td>child 21652</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3e3745b52dc53eb74efd73d3107a81e2e13f94be">3e3745b52dc53eb74efd73d3107a81e2e13f94be</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=291cefb09dff00a327062580caf17c1830d4a50b">13196</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 09 Jun 2017 15:32:08 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@291cefb09dff [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=291cefb09dff00a327062580caf17c1830d4a50b">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=291cefb09dff00a327062580caf17c1830d4a50b&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=291cefb09dff00a327062580caf17c1830d4a50b&newProject=comm-central&newRevision=316de32a421766cd3481da2915a4ecb90730cb86&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=291cefb09dff00a327062580caf17c1830d4a50b&newProject=comm-central&newRevision=316de32a421766cd3481da2915a4ecb90730cb86&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=291cefb09dff00a327062580caf17c1830d4a50b&newProject=comm-central&newRevision=316de32a421766cd3481da2915a4ecb90730cb86&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28MakeMyDay%29&revcount=50">MakeMyDay</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1347211">1347211</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1347211">Bug 1347211</a> - Remove some deprecated functions from calUtils.js. r=MakeMyDay</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-dnd-listener.js">calendar/base/content/calendar-dnd-listener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-dnd-listener.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-dnd-listener.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-dnd-listener.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-dnd-listener.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-dnd-listener.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-migration-dialog.js">calendar/base/content/dialogs/calendar-migration-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-migration-dialog.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-migration-dialog.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-migration-dialog.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-migration-dialog.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/content/dialogs/calendar-migration-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAlarmMonitor.js">calendar/base/src/calAlarmMonitor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAlarmMonitor.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAlarmMonitor.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAlarmMonitor.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAlarmMonitor.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAlarmMonitor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAttachment.js">calendar/base/src/calAttachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAttachment.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAttachment.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAttachment.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAttachment.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calAttachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/calendarCreation.js">calendar/resources/content/calendarCreation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/calendarCreation.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/calendarCreation.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/calendarCreation.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/calendarCreation.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/calendarCreation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/mozmill/shared-modules/test-calendar-utils.js">calendar/test/mozmill/shared-modules/test-calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/mozmill/shared-modules/test-calendar-utils.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/mozmill/shared-modules/test-calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/mozmill/shared-modules/test-calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/mozmill/shared-modules/test-calendar-utils.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/mozmill/shared-modules/test-calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_alarm.js">calendar/test/unit/test_alarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_alarm.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_alarm.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_alarm.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_alarm.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_alarm.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_attachment.js">calendar/test/unit/test_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_attachment.js">file</a> |
<a href="/comm-central/annotate/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_attachment.js">annotate</a> |
<a href="/comm-central/diff/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_attachment.js">diff</a> |
<a href="/comm-central/comparison/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_attachment.js">comparison</a> |
<a href="/comm-central/log/291cefb09dff00a327062580caf17c1830d4a50b/calendar/test/unit/test_attachment.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -250,17 +250,17 @@ calDNDBaseObserver.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">                 parser.parseString(data);</span>
<a href="#l1.5"></a><span id="l1.5">                 this.onDropItems(parser.getItems({}).concat(parser.getParentlessItems({})));</span>
<a href="#l1.6"></a><span id="l1.6">                 break;</span>
<a href="#l1.7"></a><span id="l1.7">             case &quot;text/unicode&quot;:</span>
<a href="#l1.8"></a><span id="l1.8">                 var droppedUrl = this.retrieveURLFromData(data, bestFlavor.value);</span>
<a href="#l1.9"></a><span id="l1.9">                 if (!droppedUrl)</span>
<a href="#l1.10"></a><span id="l1.10">                     return;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-                var url = cal.makeURL(droppedUrl);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+                var url = Services.io.newURI(droppedUrl);</span>
<a href="#l1.14"></a><span id="l1.14"> </span>
<a href="#l1.15"></a><span id="l1.15">                 var localFileInstance = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l1.16"></a><span id="l1.16">                                         .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l1.17"></a><span id="l1.17">                 localFileInstance.initWithPath(url.path);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">                 var inputStream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l1.20"></a><span id="l1.20">                                   .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l1.21"></a><span id="l1.21">                 inputStream.init(localFileInstance,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -110,17 +110,17 @@ function loadCalendarManager() {</span>
<a href="#l2.4"></a><span id="l2.4"> }</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> /**</span>
<a href="#l2.7"></a><span id="l2.7">  * Creates the initial &quot;Home&quot; calendar if no calendar exists.</span>
<a href="#l2.8"></a><span id="l2.8">  */</span>
<a href="#l2.9"></a><span id="l2.9"> function initHomeCalendar() {</span>
<a href="#l2.10"></a><span id="l2.10">     let calMgr = cal.getCalendarManager();</span>
<a href="#l2.11"></a><span id="l2.11">     let composite = cal.getCompositeCalendar(window);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    let url = cal.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    let url = Services.io.newURI(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l2.14"></a><span id="l2.14">     let homeCalendar = calMgr.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l2.15"></a><span id="l2.15">     homeCalendar.name = cal.calGetString(&quot;calendar&quot;, &quot;homeCalendarName&quot;);</span>
<a href="#l2.16"></a><span id="l2.16">     calMgr.registerCalendar(homeCalendar);</span>
<a href="#l2.17"></a><span id="l2.17">     Preferences.set(&quot;calendar.list.sortOrder&quot;, homeCalendar.id);</span>
<a href="#l2.18"></a><span id="l2.18">     composite.addCalendar(homeCalendar);</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">     // Wrapping this in a try/catch block, as if any of the migration code</span>
<a href="#l2.21"></a><span id="l2.21">     // fails, the app may not load.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -529,17 +529,17 @@ function updateLink() {</span>
<a href="#l3.4"></a><span id="l3.4">     if ((linkCommand &amp;&amp; linkCommand.getAttribute(&quot;checked&quot;) != &quot;true&quot;) ||</span>
<a href="#l3.5"></a><span id="l3.5">         !itemUrlString.length) {</span>
<a href="#l3.6"></a><span id="l3.6">         // Hide if there is no url, or the menuitem was chosen so that the url</span>
<a href="#l3.7"></a><span id="l3.7">         // should be hidden</span>
<a href="#l3.8"></a><span id="l3.8">         hideOrShow(false);</span>
<a href="#l3.9"></a><span id="l3.9">     } else {</span>
<a href="#l3.10"></a><span id="l3.10">         let handler, uri;</span>
<a href="#l3.11"></a><span id="l3.11">         try {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            uri = cal.makeURL(itemUrlString);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+            uri = Services.io.newURI(itemUrlString);</span>
<a href="#l3.14"></a><span id="l3.14">             handler = Services.io.getProtocolHandler(uri.scheme);</span>
<a href="#l3.15"></a><span id="l3.15">         } catch (e) {</span>
<a href="#l3.16"></a><span id="l3.16">             // No protocol handler for the given protocol, or invalid uri</span>
<a href="#l3.17"></a><span id="l3.17">             hideOrShow(false);</span>
<a href="#l3.18"></a><span id="l3.18">             return;</span>
<a href="#l3.19"></a><span id="l3.19">         }</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">         // Only show if its either an internal protcol handler, or its external</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -270,17 +270,17 @@ var gDataMigrator = {</span>
<a href="#l4.4"></a><span id="l4.4">                     migLOG(&quot;not remote&quot;);</span>
<a href="#l4.5"></a><span id="l4.5">                     var localFile = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l4.6"></a><span id="l4.6">                                     .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l4.7"></a><span id="l4.7">                     localFile.initWithPath(getRDFAttr(node, &quot;path&quot;));</span>
<a href="#l4.8"></a><span id="l4.8">                     calendar = gDataMigrator.importICSToStorage(localFile);</span>
<a href="#l4.9"></a><span id="l4.9">                 } else {</span>
<a href="#l4.10"></a><span id="l4.10">                     // Remote subscription</span>
<a href="#l4.11"></a><span id="l4.11">                     // XXX check for duplicates</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                    var url = cal.makeURL(getRDFAttr(node, &quot;remotePath&quot;));</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                    var url = Services.io.newURI(getRDFAttr(node, &quot;remotePath&quot;));</span>
<a href="#l4.14"></a><span id="l4.14">                     calendar = calManager.createCalendar(&quot;ics&quot;, url);</span>
<a href="#l4.15"></a><span id="l4.15">                 }</span>
<a href="#l4.16"></a><span id="l4.16">                 calendar.name = getRDFAttr(node, &quot;name&quot;);</span>
<a href="#l4.17"></a><span id="l4.17">                 calendar.setProperty(&quot;color&quot;, getRDFAttr(node, &quot;color&quot;));</span>
<a href="#l4.18"></a><span id="l4.18">                 calManager.registerCalendar(calendar);</span>
<a href="#l4.19"></a><span id="l4.19">                 cal.getCompositeCalendar(window).addCalendar(calendar);</span>
<a href="#l4.20"></a><span id="l4.20">             }</span>
<a href="#l4.21"></a><span id="l4.21">             aCallback();</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -535,17 +535,17 @@ var gDataMigrator = {</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">     /**</span>
<a href="#l4.25"></a><span id="l4.25">      * Creates and registers a storage calendar and imports the given ics file into it.</span>
<a href="#l4.26"></a><span id="l4.26">      *</span>
<a href="#l4.27"></a><span id="l4.27">      * @param icsFile     The nsI(Local)File to import.</span>
<a href="#l4.28"></a><span id="l4.28">      */</span>
<a href="#l4.29"></a><span id="l4.29">     importICSToStorage: function migrateIcsStorage(icsFile) {</span>
<a href="#l4.30"></a><span id="l4.30">         const uri = 'moz-storage-calendar://';</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-        let calendar = cal.getCalendarManager().createCalendar(&quot;storage&quot;, cal.makeURL(uri));</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+        let calendar = cal.getCalendarManager().createCalendar(&quot;storage&quot;, Services.io.newURI(uri));</span>
<a href="#l4.33"></a><span id="l4.33">         let icsImporter = Components.classes[&quot;@mozilla.org/calendar/import;1?type=ics&quot;]</span>
<a href="#l4.34"></a><span id="l4.34">                                     .getService(Components.interfaces.calIImporter);</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36">         let inputStream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;]</span>
<a href="#l4.37"></a><span id="l4.37">                                     .createInstance(Components.interfaces.nsIFileInputStream);</span>
<a href="#l4.38"></a><span id="l4.38">         let items = [];</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">         calendar.id = cal.getUUID();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -897,33 +897,33 @@ var cal = {</span>
<a href="#l5.4"></a><span id="l5.4">                     func(subject, topic, data);</span>
<a href="#l5.5"></a><span id="l5.5">                 }</span>
<a href="#l5.6"></a><span id="l5.6">             }</span>
<a href="#l5.7"></a><span id="l5.7">         };</span>
<a href="#l5.8"></a><span id="l5.8">         Services.obs.addObserver(observer, topic, false /* don't hold weakly */);</span>
<a href="#l5.9"></a><span id="l5.9">     },</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">     /**</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-     * Wraps an instance. Replaces calInstanceOf from calUtils.js</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+     * Wraps an instance, making sure the xpcom wrapped object is used.</span>
<a href="#l5.14"></a><span id="l5.14">      *</span>
<a href="#l5.15"></a><span id="l5.15">      * @param aObj the object under consideration</span>
<a href="#l5.16"></a><span id="l5.16">      * @param aInterface the interface to be wrapped</span>
<a href="#l5.17"></a><span id="l5.17">      *</span>
<a href="#l5.18"></a><span id="l5.18">      * Use this function to QueryInterface the object to a particular interface.</span>
<a href="#l5.19"></a><span id="l5.19">      * You may only expect the return value to be wrapped, not the original passed object.</span>
<a href="#l5.20"></a><span id="l5.20">      * For example:</span>
<a href="#l5.21"></a><span id="l5.21">      * // BAD USAGE:</span>
<a href="#l5.22"></a><span id="l5.22">      * if (cal.wrapInstance(foo, Ci.nsIBar)) {</span>
<a href="#l5.23"></a><span id="l5.23">      *   foo.barMethod();</span>
<a href="#l5.24"></a><span id="l5.24">      * }</span>
<a href="#l5.25"></a><span id="l5.25">      * // GOOD USAGE:</span>
<a href="#l5.26"></a><span id="l5.26">      * foo = cal.wrapInstance(foo, Ci.nsIBar);</span>
<a href="#l5.27"></a><span id="l5.27">      * if (foo) {</span>
<a href="#l5.28"></a><span id="l5.28">      *   foo.barMethod();</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-     *   }</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+     * }</span>
<a href="#l5.31"></a><span id="l5.31">      *</span>
<a href="#l5.32"></a><span id="l5.32">      */</span>
<a href="#l5.33"></a><span id="l5.33">     wrapInstance: function(aObj, aInterface) {</span>
<a href="#l5.34"></a><span id="l5.34">         if (!aObj) {</span>
<a href="#l5.35"></a><span id="l5.35">             return null;</span>
<a href="#l5.36"></a><span id="l5.36">         }</span>
<a href="#l5.37"></a><span id="l5.37"> </span>
<a href="#l5.38"></a><span id="l5.38">         try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -97,17 +97,17 @@ calAlarmMonitor.prototype = {</span>
<a href="#l6.4"></a><span id="l6.4">                 this.mAlarmSoundCount++;</span>
<a href="#l6.5"></a><span id="l6.5">             }</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">             if (maxAlarmSoundCount &gt; this.mAlarmSoundCount) {</span>
<a href="#l6.8"></a><span id="l6.8">                 // Only ring the alarm sound if we haven't hit the max count.</span>
<a href="#l6.9"></a><span id="l6.9">                 try {</span>
<a href="#l6.10"></a><span id="l6.10">                     let soundURL = Preferences.get(&quot;calendar.alarms.soundURL&quot;, null);</span>
<a href="#l6.11"></a><span id="l6.11">                     if (soundURL &amp;&amp; soundURL.length &gt; 0) {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                        soundURL = cal.makeURL(soundURL);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+                        soundURL = Services.io.newURI(soundURL);</span>
<a href="#l6.14"></a><span id="l6.14">                         this.mSound.play(soundURL);</span>
<a href="#l6.15"></a><span id="l6.15">                     } else {</span>
<a href="#l6.16"></a><span id="l6.16">                         this.mSound.beep();</span>
<a href="#l6.17"></a><span id="l6.17">                     }</span>
<a href="#l6.18"></a><span id="l6.18">                 } catch (exc) {</span>
<a href="#l6.19"></a><span id="l6.19">                     cal.ERROR(&quot;Error playing alarm sound: &quot; + exc);</span>
<a href="#l6.20"></a><span id="l6.20">                 }</span>
<a href="#l6.21"></a><span id="l6.21">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/src/calAttachment.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/src/calAttachment.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l7.9"></a><span id="l7.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.11"></a><span id="l7.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12"> </span>
<a href="#l7.13"></a><span id="l7.13"> //</span>
<a href="#l7.14"></a><span id="l7.14"> // calAttachment.js</span>
<a href="#l7.15"></a><span id="l7.15"> //</span>
<a href="#l7.16"></a><span id="l7.16"> function calAttachment() {</span>
<a href="#l7.17"></a><span id="l7.17">     this.wrappedJSObject = this;</span>
<a href="#l7.18"></a><span id="l7.18">     this.mProperties = new cal.calPropertyBag();</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineat">@@ -51,17 +52,17 @@ calAttachment.prototype = {</span>
<a href="#l7.20"></a><span id="l7.20">      */</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22">     get uri() {</span>
<a href="#l7.23"></a><span id="l7.23">         let uri = null;</span>
<a href="#l7.24"></a><span id="l7.24">         if (this.getParameter(&quot;VALUE&quot;) != &quot;BINARY&quot;) {</span>
<a href="#l7.25"></a><span id="l7.25">             // If this is not binary data, its likely an uri. Attempt to convert</span>
<a href="#l7.26"></a><span id="l7.26">             // and throw otherwise.</span>
<a href="#l7.27"></a><span id="l7.27">             try {</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-                uri = cal.makeURL(this.mData);</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+                uri = Services.io.newURI(this.mData);</span>
<a href="#l7.30"></a><span id="l7.30">             } catch (e) {</span>
<a href="#l7.31"></a><span id="l7.31">                 // Its possible that the uri contains malformed data. Often</span>
<a href="#l7.32"></a><span id="l7.32">                 // callers don't expect an exception here, so we just catch</span>
<a href="#l7.33"></a><span id="l7.33">                 // it and return null.</span>
<a href="#l7.34"></a><span id="l7.34">             }</span>
<a href="#l7.35"></a><span id="l7.35">         }</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">         return uri;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -674,17 +674,17 @@ calCalendarManager.prototype = {</span>
<a href="#l8.4"></a><span id="l8.4">                 let curi = Preferences.get(calBranch + &quot;.uri&quot;, null);</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">                 try {</span>
<a href="#l8.7"></a><span id="l8.7">                     if (!ctype || !curi) { // sanity check</span>
<a href="#l8.8"></a><span id="l8.8">                         Services.prefs.deleteBranch(calBranch + &quot;.&quot;);</span>
<a href="#l8.9"></a><span id="l8.9">                         continue;</span>
<a href="#l8.10"></a><span id="l8.10">                     }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                    let uri = cal.makeURL(curi);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                    let uri = Services.io.newURI(curi);</span>
<a href="#l8.14"></a><span id="l8.14">                     let calendar = this.createCalendar(ctype, uri);</span>
<a href="#l8.15"></a><span id="l8.15">                     if (calendar) {</span>
<a href="#l8.16"></a><span id="l8.16">                         calendar.id = id;</span>
<a href="#l8.17"></a><span id="l8.17">                         if (calendar.getProperty(&quot;auto-enabled&quot;)) {</span>
<a href="#l8.18"></a><span id="l8.18">                             calendar.deleteProperty(&quot;disabled&quot;);</span>
<a href="#l8.19"></a><span id="l8.19">                             calendar.deleteProperty(&quot;auto-enabled&quot;);</span>
<a href="#l8.20"></a><span id="l8.20">                         }</span>
<a href="#l8.21"></a><span id="l8.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -12,28 +12,26 @@</span>
<a href="#l9.4"></a><span id="l9.4">  *          createAttachment, createAlarm, createRelation,</span>
<a href="#l9.5"></a><span id="l9.5">  *          createRecurrenceDate, createRecurrenceRule, createRecurrenceInfo,</span>
<a href="#l9.6"></a><span id="l9.6">  *          getCalendarManager, getIcsService, getCalendarSearchService,</span>
<a href="#l9.7"></a><span id="l9.7">  *          getFreeBusyService, getWeekInfoService, getDateFormatter, UTC,</span>
<a href="#l9.8"></a><span id="l9.8">  *          floating, saveRecentTimezone, getCalendarDirectory,</span>
<a href="#l9.9"></a><span id="l9.9">  *          isCalendarWritable, userCanAddItemsToCalendar,</span>
<a href="#l9.10"></a><span id="l9.10">  *          userCanDeleteItemsFromCalendar, attendeeMatchesAddresses,</span>
<a href="#l9.11"></a><span id="l9.11">  *          userCanRespondToInvitation, openCalendarWizard,</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">- *          openCalendarProperties, calPrint, makeURL, calRadioGroupSelectItem,</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">- *          isItemSupported, calInstanceOf, getPrefSafe, setPref,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">- *          setLocalizedPref, getLocalizedPref, getPrefCategoriesArray,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+ *          openCalendarProperties, calPrint, calRadioGroupSelectItem,</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+ *          isItemSupported, getPrefCategoriesArray,</span>
<a href="#l9.17"></a><span id="l9.17">  *          setPrefCategoriesFromArray, compareItems, calTryWrappedJSObject,</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">- *          compareArrays, doQueryInterface, setDefaultStartEndHour, LOG, WARN,</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">- *          ERROR, showError, getContrastingTextColor, calGetEndDateProp,</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">- *          checkIfInRange, getProgressAtom, sendMailTo, sameDay,</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">- *          calSetProdidVersion, applyAttributeToMenuChildren,</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">- *          isPropertyValueSame, getParentNodeOrThis,</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">- *          getParentNodeOrThisByAttribute, setItemProperty,</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">- *          calIterateEmailIdentities, compareItemContent, binaryInsert,</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">- *          getCompositeCalendar, findItemWindow</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+ *          compareArrays, setDefaultStartEndHour, LOG, WARN, ERROR, showError,</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+ *          getContrastingTextColor, calGetEndDateProp, checkIfInRange,</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+ *          getProgressAtom, sendMailTo, sameDay, calSetProdidVersion,</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+ *          applyAttributeToMenuChildren, isPropertyValueSame,</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+ *          getParentNodeOrThis, getParentNodeOrThisByAttribute,</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+ *          setItemProperty, calIterateEmailIdentities, compareItemContent,</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+ *          binaryInsert, getCompositeCalendar, findItemWindow</span>
<a href="#l9.33"></a><span id="l9.33">  */</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l9.36"></a><span id="l9.36"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l9.37"></a><span id="l9.37"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l9.38"></a><span id="l9.38"> Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l9.39"></a><span id="l9.39"> Components.utils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l9.40"></a><span id="l9.40"> </span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -395,27 +393,16 @@ function calPrint(aWindow) {</span>
<a href="#l9.42"></a><span id="l9.42">                        &quot;centerscreen,chrome,resizable&quot;);</span>
<a href="#l9.43"></a><span id="l9.43"> }</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45"> /**</span>
<a href="#l9.46"></a><span id="l9.46">  * Other functions</span>
<a href="#l9.47"></a><span id="l9.47">  */</span>
<a href="#l9.48"></a><span id="l9.48"> </span>
<a href="#l9.49"></a><span id="l9.49"> /**</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">- * Takes a string and returns an nsIURI</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">- *</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">- * @param aUriString  the string of the address to for the spec of the nsIURI</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineminus">- *</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineminus">- * @returns  an nsIURI whose spec is aUriString</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">- */</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineminus">-function makeURL(aUriString) {</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineminus">-    return Services.io.newURI(aUriString);</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineminus">-}</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-/**</span>
<a href="#l9.61"></a><span id="l9.61">  * Returns a calIDateTime that corresponds to the current time in the user's</span>
<a href="#l9.62"></a><span id="l9.62">  * default timezone.</span>
<a href="#l9.63"></a><span id="l9.63">  */</span>
<a href="#l9.64"></a><span id="l9.64"> function now() {</span>
<a href="#l9.65"></a><span id="l9.65">     let date = cal.jsDateToDateTime(new Date());</span>
<a href="#l9.66"></a><span id="l9.66">     return date.getInTimezone(calendarDefaultTimezone());</span>
<a href="#l9.67"></a><span id="l9.67"> }</span>
<a href="#l9.68"></a><span id="l9.68"> </span>
<a href="#l9.69"></a><span id="l9.69" class="difflineat">@@ -450,29 +437,16 @@ function isItemSupported(aItem, aCalenda</span>
<a href="#l9.70"></a><span id="l9.70">         return (aCalendar.getProperty(&quot;capabilities.tasks.supported&quot;) !== false);</span>
<a href="#l9.71"></a><span id="l9.71">     } else if (isEvent(aItem)) {</span>
<a href="#l9.72"></a><span id="l9.72">         return (aCalendar.getProperty(&quot;capabilities.events.supported&quot;) !== false);</span>
<a href="#l9.73"></a><span id="l9.73">     }</span>
<a href="#l9.74"></a><span id="l9.74">     return false;</span>
<a href="#l9.75"></a><span id="l9.75"> }</span>
<a href="#l9.76"></a><span id="l9.76"> </span>
<a href="#l9.77"></a><span id="l9.77"> /**</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">- * @deprecated This function has been replaced by cal.wrapInstance()</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">- */</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-function calInstanceOf(aObject, aInterface) {</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">-    if (!calInstanceOf.warningIssued) {</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">-        cal.WARN(&quot;Use of calInstanceOf() is deprecated and will be removed &quot; +</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">-                 &quot;with the next release. Use cal.wrapInstance() instead.\n&quot; +</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">-                 cal.STACK(10));</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-        calInstanceOf.warningIssued = true;</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-    }</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-    return (cal.wrapInstance(aObject, aInterface) != null);</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-}</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-/**</span>
<a href="#l9.91"></a><span id="l9.91">  * Determines whether or not the aObject is a calIEvent</span>
<a href="#l9.92"></a><span id="l9.92">  *</span>
<a href="#l9.93"></a><span id="l9.93">  * @param aObject  the object to test</span>
<a href="#l9.94"></a><span id="l9.94">  * @returns        true if the object is a calIEvent, false otherwise</span>
<a href="#l9.95"></a><span id="l9.95">  */</span>
<a href="#l9.96"></a><span id="l9.96"> function isEvent(aObject) {</span>
<a href="#l9.97"></a><span id="l9.97">     return (cal.wrapInstance(aObject, Components.interfaces.calIEvent) != null);</span>
<a href="#l9.98"></a><span id="l9.98"> }</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineat">@@ -483,98 +457,16 @@ function isEvent(aObject) {</span>
<a href="#l9.100"></a><span id="l9.100">  * @param aObject  the object to test</span>
<a href="#l9.101"></a><span id="l9.101">  * @returns        true if the object is a calITodo, false otherwise</span>
<a href="#l9.102"></a><span id="l9.102">  */</span>
<a href="#l9.103"></a><span id="l9.103"> function isToDo(aObject) {</span>
<a href="#l9.104"></a><span id="l9.104">     return (cal.wrapInstance(aObject, Components.interfaces.calITodo) != null);</span>
<a href="#l9.105"></a><span id="l9.105"> }</span>
<a href="#l9.106"></a><span id="l9.106"> </span>
<a href="#l9.107"></a><span id="l9.107"> /**</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineminus">- * Normal get*Pref calls will throw if the pref is undefined.  This function</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineminus">- * will get a bool, int, or string pref.  If the pref is undefined, it will</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">- * return aDefault.</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineminus">- *</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">- * @param aPrefName   the (full) name of preference to get</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineminus">- * @param aDefault    (optional) the value to return if the pref is undefined</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineminus">- */</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineminus">-function getPrefSafe(aPrefName, aDefault) {</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineminus">-    if (!getPrefSafe.warningIssued) {</span>
<a href="#l9.117"></a><span id="l9.117" class="difflineminus">-        cal.WARN(&quot;Use of getPrefSafe() is deprecated and will be removed &quot; +</span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-                 &quot;with the next release. Use Preferences.get() instead.\n&quot; +</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineminus">-                 cal.STACK(10));</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineminus">-        getPrefSafe.warningIssued = true;</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineminus">-    }</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineminus">-</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-    return Preferences.get(aPrefName, aDefault);</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineminus">-}</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineminus">-/**</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineminus">- * Wrapper for setting prefs of various types.</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineminus">- *</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">- * @param aPrefName   the (full) name of preference to set</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">- * @param aPrefValue  the value to set the pref to</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">- * @param aPrefType   (optional) the type of preference to set.</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">- *                    Valid values are: BOOL, INT, and CHAR</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineminus">- */</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-function setPref(aPrefName, aPrefValue, aPrefType) {</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineminus">-    if (!setPref.warningIssued) {</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineminus">-        cal.WARN(&quot;Use of setPref() is deprecated and will be removed &quot; +</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineminus">-                 &quot;with the next release. Use Preferences.set() instead.\n&quot; +</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineminus">-                 cal.STACK(10));</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineminus">-        setPref.warningIssued = true;</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineminus">-    }</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineminus">-</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineminus">-    let prefValue = aPrefValue;</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineminus">-</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineminus">-    if (aPrefType == &quot;BOOL&quot;) {</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineminus">-        prefValue = Boolean(prefValue);</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineminus">-    } else if (aPrefType == &quot;INT&quot;) {</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineminus">-        prefValue = Number(prefValue);</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineminus">-    } else if (aPrefType == &quot;CHAR&quot;) {</span>
<a href="#l9.149"></a><span id="l9.149" class="difflineminus">-        prefValue = String(prefValue);</span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-    }</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineminus">-</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-    return Preferences.set(aPrefName, prefValue);</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-}</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineminus">-</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-/**</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">- * Helper function to set a localized (complex) pref from a given string</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">- *</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">- * @param aPrefName   the (full) name of preference to set</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineminus">- * @param aString     the string to which the preference value should be set</span>
<a href="#l9.160"></a><span id="l9.160" class="difflineminus">- */</span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-function setLocalizedPref(aPrefName, aString) {</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineminus">-    if (!setLocalizedPref.warningIssued) {</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineminus">-        cal.WARN(&quot;Use of setLocalizedPref() is deprecated and will be removed &quot; +</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineminus">-                 &quot;with the next release. Use Preferences.set() instead.\n&quot; +</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineminus">-                 cal.STACK(10));</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineminus">-        setLocalizedPref.warningIssued = true;</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineminus">-    }</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineminus">-</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineminus">-    return Preferences.set(aPrefName, aString);</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineminus">-}</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineminus">-</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-/**</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineminus">- * Like getPrefSafe, except for complex prefs (those used for localized data).</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineminus">- *</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineminus">- * @param aPrefName   the (full) name of preference to get</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineminus">- * @param aDefault    (optional) the value to return if the pref is undefined</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineminus">- */</span>
<a href="#l9.178"></a><span id="l9.178" class="difflineminus">-function getLocalizedPref(aPrefName, aDefault) {</span>
<a href="#l9.179"></a><span id="l9.179" class="difflineminus">-    if (!getLocalizedPref.warningIssued) {</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineminus">-        cal.WARN(&quot;Use of getLocalizedPref() is deprecated and will be removed &quot; +</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineminus">-                 &quot;with the next release. Use Preferences.get() instead.\n&quot; +</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineminus">-                 cal.STACK(10));</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineminus">-        getLocalizedPref.warningIssued = true;</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineminus">-    }</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-    return Preferences.get(aPrefName, aDefault);</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineminus">-}</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineminus">-/**</span>
<a href="#l9.190"></a><span id="l9.190">  * Get array of category names from preferences or locale default,</span>
<a href="#l9.191"></a><span id="l9.191">  * unescaping any commas in each category name.</span>
<a href="#l9.192"></a><span id="l9.192">  * @return array of category names</span>
<a href="#l9.193"></a><span id="l9.193">  */</span>
<a href="#l9.194"></a><span id="l9.194"> function getPrefCategoriesArray() {</span>
<a href="#l9.195"></a><span id="l9.195">     let categories = Preferences.get(&quot;calendar.categories.names&quot;, null);</span>
<a href="#l9.196"></a><span id="l9.196"> </span>
<a href="#l9.197"></a><span id="l9.197">     // If no categories are configured load a default set from properties file</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineat">@@ -803,69 +695,16 @@ function compareArrays(aOne, aTwo, compa</span>
<a href="#l9.199"></a><span id="l9.199">         if (!compareFunc(aOne[i], aTwo[i])) {</span>
<a href="#l9.200"></a><span id="l9.200">             return false;</span>
<a href="#l9.201"></a><span id="l9.201">         }</span>
<a href="#l9.202"></a><span id="l9.202">     }</span>
<a href="#l9.203"></a><span id="l9.203">     return true;</span>
<a href="#l9.204"></a><span id="l9.204"> }</span>
<a href="#l9.205"></a><span id="l9.205"> </span>
<a href="#l9.206"></a><span id="l9.206"> /**</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineminus">- * Takes care of all QueryInterface business, including calling the QI of any</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineminus">- * existing parent prototypes.</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineminus">- *</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineminus">- * @deprecated</span>
<a href="#l9.211"></a><span id="l9.211" class="difflineminus">- * @param aSelf         The object the QueryInterface is being made to</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineminus">- * @param aProto        Caller's prototype object</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineminus">- * @param aIID          The IID to check for</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineminus">- * @param aList         (Optional if aClassInfo is specified) An array of</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineminus">- *                        interfaces from Components.interfaces</span>
<a href="#l9.216"></a><span id="l9.216" class="difflineminus">- * @param aClassInfo    (Optional) an Object containing the class info for this</span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">- *                        prototype.</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineminus">- */</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineminus">-function doQueryInterface(aSelf, aProto, aIID, aList, aClassInfo) {</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineminus">-    if (!doQueryInterface.warningIssued) {</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineminus">-        cal.WARN(&quot;Use of doQueryInterface() is deprecated and will be removed &quot; +</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineminus">-                 &quot;with the next release. Use XPCOMUtils.generateQI() instead.\n&quot; +</span>
<a href="#l9.223"></a><span id="l9.223" class="difflineminus">-                 cal.STACK(10));</span>
<a href="#l9.224"></a><span id="l9.224" class="difflineminus">-        doQueryInterface.warningIssued = true;</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineminus">-    }</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineminus">-</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineminus">-    if (aClassInfo) {</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineminus">-        if (aIID.equals(Components.interfaces.nsIClassInfo)) {</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineminus">-            return aClassInfo;</span>
<a href="#l9.230"></a><span id="l9.230" class="difflineminus">-        }</span>
<a href="#l9.231"></a><span id="l9.231" class="difflineminus">-        if (!aList) {</span>
<a href="#l9.232"></a><span id="l9.232" class="difflineminus">-            aList = aClassInfo.getInterfaces({});</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineminus">-        }</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineminus">-    }</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineminus">-</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineminus">-    if (aList) {</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineminus">-        for (let iid of aList) {</span>
<a href="#l9.238"></a><span id="l9.238" class="difflineminus">-            if (aIID.equals(iid)) {</span>
<a href="#l9.239"></a><span id="l9.239" class="difflineminus">-                return aSelf;</span>
<a href="#l9.240"></a><span id="l9.240" class="difflineminus">-            }</span>
<a href="#l9.241"></a><span id="l9.241" class="difflineminus">-        }</span>
<a href="#l9.242"></a><span id="l9.242" class="difflineminus">-    }</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineminus">-</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineminus">-    if (aIID.equals(Components.interfaces.nsISupports)) {</span>
<a href="#l9.245"></a><span id="l9.245" class="difflineminus">-        return aSelf;</span>
<a href="#l9.246"></a><span id="l9.246" class="difflineminus">-    }</span>
<a href="#l9.247"></a><span id="l9.247" class="difflineminus">-</span>
<a href="#l9.248"></a><span id="l9.248" class="difflineminus">-    if (aProto) {</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineminus">-        let base = aProto.__proto__;</span>
<a href="#l9.250"></a><span id="l9.250" class="difflineminus">-        if (base &amp;&amp; base.QueryInterface) {</span>
<a href="#l9.251"></a><span id="l9.251" class="difflineminus">-            // Try to QI the base prototype</span>
<a href="#l9.252"></a><span id="l9.252" class="difflineminus">-            return base.QueryInterface.call(aSelf, aIID);</span>
<a href="#l9.253"></a><span id="l9.253" class="difflineminus">-        }</span>
<a href="#l9.254"></a><span id="l9.254" class="difflineminus">-    }</span>
<a href="#l9.255"></a><span id="l9.255" class="difflineminus">-</span>
<a href="#l9.256"></a><span id="l9.256" class="difflineminus">-    throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l9.257"></a><span id="l9.257" class="difflineminus">-}</span>
<a href="#l9.258"></a><span id="l9.258" class="difflineminus">-</span>
<a href="#l9.259"></a><span id="l9.259" class="difflineminus">-/**</span>
<a href="#l9.260"></a><span id="l9.260">  * Many computations want to work only with date-times, not with dates.  This</span>
<a href="#l9.261"></a><span id="l9.261">  * method will return a proper datetime (set to midnight) for a date object.  If</span>
<a href="#l9.262"></a><span id="l9.262">  * the object is already a datetime, it will simply be returned.</span>
<a href="#l9.263"></a><span id="l9.263">  *</span>
<a href="#l9.264"></a><span id="l9.264">  * @param aDate  the date or datetime to check</span>
<a href="#l9.265"></a><span id="l9.265">  */</span>
<a href="#l9.266"></a><span id="l9.266"> function ensureDateTime(aDate) {</span>
<a href="#l9.267"></a><span id="l9.267">     if (!aDate || !aDate.isDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1954,19 +1954,19 @@ function attachURL() {</span>
<a href="#l10.4"></a><span id="l10.4">                                    cal.calGetString(&quot;calendar-event-dialog&quot;,</span>
<a href="#l10.5"></a><span id="l10.5">                                                     &quot;specifyLinkLocation&quot;),</span>
<a href="#l10.6"></a><span id="l10.6">                                    cal.calGetString(&quot;calendar-event-dialog&quot;,</span>
<a href="#l10.7"></a><span id="l10.7">                                                     &quot;enterLinkLocation&quot;),</span>
<a href="#l10.8"></a><span id="l10.8">                                    result,</span>
<a href="#l10.9"></a><span id="l10.9">                                    null,</span>
<a href="#l10.10"></a><span id="l10.10">                                    { value: 0 })) {</span>
<a href="#l10.11"></a><span id="l10.11">             try {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-                // If something bogus was entered, cal.makeURL may fail.</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+                // If something bogus was entered, Services.io.newURI may fail.</span>
<a href="#l10.14"></a><span id="l10.14">                 let attachment = cal.createAttachment();</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-                attachment.uri = cal.makeURL(result.value);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+                attachment.uri = Services.io.newURI(result.value);</span>
<a href="#l10.17"></a><span id="l10.17">                 addAttachment(attachment);</span>
<a href="#l10.18"></a><span id="l10.18">             } catch (e) {</span>
<a href="#l10.19"></a><span id="l10.19">                 // TODO We might want to show a warning instead of just not</span>
<a href="#l10.20"></a><span id="l10.20">                 // adding the file</span>
<a href="#l10.21"></a><span id="l10.21">             }</span>
<a href="#l10.22"></a><span id="l10.22">         }</span>
<a href="#l10.23"></a><span id="l10.23">     }</span>
<a href="#l10.24"></a><span id="l10.24"> }</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineat">@@ -2034,17 +2034,17 @@ function attachFile(cloudProvider) {</span>
<a href="#l10.26"></a><span id="l10.26">         if (!(uriSpec in gAttachMap)) {</span>
<a href="#l10.27"></a><span id="l10.27">             // If the attachment hasn't been added, then set the last display</span>
<a href="#l10.28"></a><span id="l10.28">             // directory.</span>
<a href="#l10.29"></a><span id="l10.29">             lastDirectory(uriSpec);</span>
<a href="#l10.30"></a><span id="l10.30"> </span>
<a href="#l10.31"></a><span id="l10.31">             // ... and add the attachment.</span>
<a href="#l10.32"></a><span id="l10.32">             let attachment = cal.createAttachment();</span>
<a href="#l10.33"></a><span id="l10.33">             if (cloudProvider) {</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-                attachment.uri = cal.makeURL(uriSpec);</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+                attachment.uri = Services.io.newURI(uriSpec);</span>
<a href="#l10.36"></a><span id="l10.36">             } else {</span>
<a href="#l10.37"></a><span id="l10.37">                 // TODO read file into attachment</span>
<a href="#l10.38"></a><span id="l10.38">             }</span>
<a href="#l10.39"></a><span id="l10.39">             addAttachment(attachment, cloudProvider);</span>
<a href="#l10.40"></a><span id="l10.40">         }</span>
<a href="#l10.41"></a><span id="l10.41">     }</span>
<a href="#l10.42"></a><span id="l10.42"> }</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44" class="difflineat">@@ -2054,17 +2054,17 @@ function attachFile(cloudProvider) {</span>
<a href="#l10.45"></a><span id="l10.45">  * @param aFileUri    (optional) If passed, the last directory will be set and</span>
<a href="#l10.46"></a><span id="l10.46">  *                                 returned. If null, the last chosen directory</span>
<a href="#l10.47"></a><span id="l10.47">  *                                 will be returned.</span>
<a href="#l10.48"></a><span id="l10.48">  * @return            The last directory that was set with this function.</span>
<a href="#l10.49"></a><span id="l10.49">  */</span>
<a href="#l10.50"></a><span id="l10.50"> function lastDirectory(aFileUri) {</span>
<a href="#l10.51"></a><span id="l10.51">     if (aFileUri) {</span>
<a href="#l10.52"></a><span id="l10.52">         // Act similar to a setter, save the passed uri.</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-        let uri = cal.makeURL(aFileUri);</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+        let uri = Services.io.newURI(aFileUri);</span>
<a href="#l10.55"></a><span id="l10.55">         let file = uri.QueryInterface(Components.interfaces.nsIFileURL).file;</span>
<a href="#l10.56"></a><span id="l10.56">         lastDirectory.mValue = file.parent.QueryInterface(Components.interfaces.nsILocalFile);</span>
<a href="#l10.57"></a><span id="l10.57">     }</span>
<a href="#l10.58"></a><span id="l10.58"> </span>
<a href="#l10.59"></a><span id="l10.59">     // In any case, return the value</span>
<a href="#l10.60"></a><span id="l10.60">     return (lastDirectory.mValue === undefined ? null : lastDirectory.mValue);</span>
<a href="#l10.61"></a><span id="l10.61"> }</span>
<a href="#l10.62"></a><span id="l10.62"> </span>
<a href="#l10.63"></a><span id="l10.63" class="difflineat">@@ -2102,17 +2102,17 @@ function uploadCloudAttachment(attachmen</span>
<a href="#l10.64"></a><span id="l10.64">     cloudProvider.uploadFile(file, {</span>
<a href="#l10.65"></a><span id="l10.65">         onStartRequest: function() {</span>
<a href="#l10.66"></a><span id="l10.66">             listItem.setAttribute(&quot;image&quot;, &quot;chrome://global/skin/icons/loading.png&quot;);</span>
<a href="#l10.67"></a><span id="l10.67">         },</span>
<a href="#l10.68"></a><span id="l10.68"> </span>
<a href="#l10.69"></a><span id="l10.69">         onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l10.70"></a><span id="l10.70">             if (Components.isSuccessCode(aStatusCode)) {</span>
<a href="#l10.71"></a><span id="l10.71">                 delete gAttachMap[attachment.hashId];</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-                attachment.uri = cal.makeURL(cloudProvider.urlForFile(file));</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+                attachment.uri = Services.io.newURI(cloudProvider.urlForFile(file));</span>
<a href="#l10.74"></a><span id="l10.74">                 attachment.setParameter(&quot;FILENAME&quot;, file.leafName);</span>
<a href="#l10.75"></a><span id="l10.75">                 attachment.setParameter(&quot;PROVIDER&quot;, cloudProvider.type);</span>
<a href="#l10.76"></a><span id="l10.76">                 listItem.setAttribute(&quot;label&quot;, file.leafName);</span>
<a href="#l10.77"></a><span id="l10.77">                 gAttachMap[attachment.hashId] = attachment;</span>
<a href="#l10.78"></a><span id="l10.78">                 listItem.setAttribute(&quot;image&quot;, cloudProvider.iconClass);</span>
<a href="#l10.79"></a><span id="l10.79">                 updateAttachment();</span>
<a href="#l10.80"></a><span id="l10.80">             } else {</span>
<a href="#l10.81"></a><span id="l10.81">                 cal.ERROR(&quot;[calendar-event-dialog] Uploading cloud attachment &quot; +</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineat">@@ -3480,17 +3480,17 @@ function updateAttachment() {</span>
<a href="#l10.83"></a><span id="l10.83">  * @param {string} aUrl    The url in question</span>
<a href="#l10.84"></a><span id="l10.84">  * @return {boolean}       Returns true for show and false for hide</span>
<a href="#l10.85"></a><span id="l10.85">  */</span>
<a href="#l10.86"></a><span id="l10.86"> function showOrHideItemURL(aShow, aUrl) {</span>
<a href="#l10.87"></a><span id="l10.87">     if (aShow &amp;&amp; aUrl.length) {</span>
<a href="#l10.88"></a><span id="l10.88">         let handler;</span>
<a href="#l10.89"></a><span id="l10.89">         let uri;</span>
<a href="#l10.90"></a><span id="l10.90">         try {</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-            uri = cal.makeURL(aUrl);</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+            uri = Services.io.newURI(aUrl);</span>
<a href="#l10.93"></a><span id="l10.93">             handler = Services.io.getProtocolHandler(uri.scheme);</span>
<a href="#l10.94"></a><span id="l10.94">         } catch (e) {</span>
<a href="#l10.95"></a><span id="l10.95">             // No protocol handler for the given protocol, or invalid uri</span>
<a href="#l10.96"></a><span id="l10.96">             // hideOrShow(false);</span>
<a href="#l10.97"></a><span id="l10.97">             return false;</span>
<a href="#l10.98"></a><span id="l10.98">         }</span>
<a href="#l10.99"></a><span id="l10.99">         // Only show if its either an internal protcol handler, or its external</span>
<a href="#l10.100"></a><span id="l10.100">         // and there is an external app for the scheme</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -526,18 +526,17 @@ calDavCalendar.prototype = {</span>
<a href="#l11.4"></a><span id="l11.4">         // Build a string containing the full path, decoded, so it looks like</span>
<a href="#l11.5"></a><span id="l11.5">         // this:</span>
<a href="#l11.6"></a><span id="l11.6">         // /some path/insert string.ics</span>
<a href="#l11.7"></a><span id="l11.7">         let decodedPath = this.ensureDecodedPath(baseUri.path) + (aInsertString || &quot;&quot;);</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">         // Build the nsIURI by specifying a string with a fully encoded path</span>
<a href="#l11.10"></a><span id="l11.10">         // the end result will be something like this:</span>
<a href="#l11.11"></a><span id="l11.11">         // http://caldav.example.com:8080/some%20path/insert%20string.ics</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        let url = cal.makeURL(baseUri.prePath + this.ensureEncodedPath(decodedPath) + (this.mUriParams || &quot;&quot;));</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-        return url;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+        return Services.io.newURI(baseUri.prePath + this.ensureEncodedPath(decodedPath) + (this.mUriParams || &quot;&quot;));</span>
<a href="#l11.15"></a><span id="l11.15">     },</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">     get mLocationPath() {</span>
<a href="#l11.18"></a><span id="l11.18">         return this.ensureDecodedPath(this.calendarUri.path);</span>
<a href="#l11.19"></a><span id="l11.19">     },</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">     getItemLocationPath: function(aItem) {</span>
<a href="#l11.22"></a><span id="l11.22">         if (aItem.id &amp;&amp;</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineat">@@ -2163,17 +2162,17 @@ calDavCalendar.prototype = {</span>
<a href="#l11.24"></a><span id="l11.24">                     &quot;&lt;/D:prop&gt;&quot; +</span>
<a href="#l11.25"></a><span id="l11.25">                 &quot;&lt;/D:principal-property-search&gt;&quot;;</span>
<a href="#l11.26"></a><span id="l11.26">             queryMethod = &quot;REPORT&quot;;</span>
<a href="#l11.27"></a><span id="l11.27">             queryDepth = 1;</span>
<a href="#l11.28"></a><span id="l11.28">         }</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30">         // We want a trailing slash, ensure it.</span>
<a href="#l11.31"></a><span id="l11.31">         let nextNS = aNameSpaceList.pop().replace(/([^\/])$/, &quot;$1/&quot;);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-        let requestUri = cal.makeURL(this.calendarUri.prePath + this.ensureEncodedPath(nextNS));</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+        let requestUri = Services.io.newURI(this.calendarUri.prePath + this.ensureEncodedPath(nextNS));</span>
<a href="#l11.34"></a><span id="l11.34"> </span>
<a href="#l11.35"></a><span id="l11.35">         if (this.verboseLogging()) {</span>
<a href="#l11.36"></a><span id="l11.36">             cal.LOG(&quot;CalDAV: send: &quot; + queryMethod + &quot; &quot; + requestUri.spec + &quot;\n&quot; + queryXml);</span>
<a href="#l11.37"></a><span id="l11.37">         }</span>
<a href="#l11.38"></a><span id="l11.38"> </span>
<a href="#l11.39"></a><span id="l11.39">         let streamListener = {};</span>
<a href="#l11.40"></a><span id="l11.40">         streamListener.onStreamComplete = function(aLoader, aContext, aStatus, aResultLength, aResult) {</span>
<a href="#l11.41"></a><span id="l11.41">             let request = aLoader.request.QueryInterface(Components.interfaces.nsIHttpChannel);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1441,17 +1441,17 @@ upgrade.v22 = function(db, version) {</span>
<a href="#l12.4"></a><span id="l12.4">     try {</span>
<a href="#l12.5"></a><span id="l12.5">         // Update attachments to using icalString directly</span>
<a href="#l12.6"></a><span id="l12.6">         createFunction(db, &quot;translateAttachment&quot;, 3, {</span>
<a href="#l12.7"></a><span id="l12.7">             onFunctionCall: function(storArgs) {</span>
<a href="#l12.8"></a><span id="l12.8">                 try {</span>
<a href="#l12.9"></a><span id="l12.9">                     let [aData, aFmtType, aEncoding] = mapStorageArgs(storArgs);</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">                     let attach = cal.createAttachment();</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-                    attach.uri = cal.makeURL(aData);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                    attach.uri = Services.io.newURI(aData);</span>
<a href="#l12.14"></a><span id="l12.14">                     attach.formatType = aFmtType;</span>
<a href="#l12.15"></a><span id="l12.15">                     attach.encoding = aEncoding;</span>
<a href="#l12.16"></a><span id="l12.16">                     return attach.icalString;</span>
<a href="#l12.17"></a><span id="l12.17">                 } catch (e) {</span>
<a href="#l12.18"></a><span id="l12.18">                     cal.ERROR(&quot;Error converting attachment: &quot; + e);</span>
<a href="#l12.19"></a><span id="l12.19">                     throw e;</span>
<a href="#l12.20"></a><span id="l12.20">                 }</span>
<a href="#l12.21"></a><span id="l12.21">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -66,17 +66,17 @@ function getWcapSessionFor(calendar, uri</span>
<a href="#l13.4"></a><span id="l13.4">                 break;</span>
<a href="#l13.5"></a><span id="l13.5">             }</span>
<a href="#l13.6"></a><span id="l13.6">         }</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">         if (defaultCal) {</span>
<a href="#l13.9"></a><span id="l13.9">             session.defaultCalendar = defaultCal;</span>
<a href="#l13.10"></a><span id="l13.10">             // eslint-disable-next-line array-bracket-spacing</span>
<a href="#l13.11"></a><span id="l13.11">             let [defaultSpec, ] = splitUriParams(defaultCal.uri);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-            session.uri = cal.makeURL(defaultSpec);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+            session.uri = Services.io.newURI(defaultSpec);</span>
<a href="#l13.14"></a><span id="l13.14">             session.credentials.userId = defaultCal.getProperty(&quot;user_id&quot;);</span>
<a href="#l13.15"></a><span id="l13.15">             log(&quot;default calendar found.&quot;, defaultCal);</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">             // check and fix changing urls (autoconf) of subscribed calendars here:</span>
<a href="#l13.18"></a><span id="l13.18">             for (let regCal of registeredCalendars) {</span>
<a href="#l13.19"></a><span id="l13.19">                 if (!regCal.isDefaultCalendar) {</span>
<a href="#l13.20"></a><span id="l13.20">                     let [spec, params] = splitUriParams(regCal.uri);</span>
<a href="#l13.21"></a><span id="l13.21">                     if (spec != defaultSpec) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/resources/content/calendarCreation.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/resources/content/calendarCreation.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -3,16 +3,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.5"></a><span id="l14.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> /* exported initLocationPage, initCustomizePage, onSelectProvider,</span>
<a href="#l14.8"></a><span id="l14.8">  *          onInitialAdvance, doCreateCalendar, setCanRewindFalse</span>
<a href="#l14.9"></a><span id="l14.9">  */</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l14.13"></a><span id="l14.13"> </span>
<a href="#l14.14"></a><span id="l14.14"> var gCalendar;</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> var errorConstants = {</span>
<a href="#l14.17"></a><span id="l14.17">     SUCCESS: 0,</span>
<a href="#l14.18"></a><span id="l14.18">     INVALID_URI: 1,</span>
<a href="#l14.19"></a><span id="l14.19">     ALREADY_EXISTS: 2</span>
<a href="#l14.20"></a><span id="l14.20"> };</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineat">@@ -217,17 +218,17 @@ function initNameFromURI() {</span>
<a href="#l14.22"></a><span id="l14.22">  * @param aUri              The string to parse as an uri.</span>
<a href="#l14.23"></a><span id="l14.23">  * @return [error, uri]     |error| is the error code from errorConstants,</span>
<a href="#l14.24"></a><span id="l14.24">  *                          |uri| the parsed nsIURI, or null on error.</span>
<a href="#l14.25"></a><span id="l14.25">  */</span>
<a href="#l14.26"></a><span id="l14.26"> function parseUri(aUri) {</span>
<a href="#l14.27"></a><span id="l14.27">     let uri;</span>
<a href="#l14.28"></a><span id="l14.28">     try {</span>
<a href="#l14.29"></a><span id="l14.29">         // Test if the entered uri can be parsed.</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-        uri = cal.makeURL(aUri);</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+        uri = Services.io.newURI(aUri);</span>
<a href="#l14.32"></a><span id="l14.32">     } catch (ex) {</span>
<a href="#l14.33"></a><span id="l14.33">         return [errorConstants.INVALID_URI, null];</span>
<a href="#l14.34"></a><span id="l14.34">     }</span>
<a href="#l14.35"></a><span id="l14.35"> </span>
<a href="#l14.36"></a><span id="l14.36">     let calManager = cal.getCalendarManager();</span>
<a href="#l14.37"></a><span id="l14.37">     let cals = calManager.getCalendars({});</span>
<a href="#l14.38"></a><span id="l14.38">     let type = document.getElementById(&quot;calendar-type&quot;).selectedItem.value;</span>
<a href="#l14.39"></a><span id="l14.39">     if (type != &quot;local&quot; &amp;&amp; cals.some(calendar =&gt; calendar.uri.spec == uri.spec)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -118,17 +118,17 @@ function publishEntireCalendarDialogResp</span>
<a href="#l15.4"></a><span id="l15.4">                          0, null, null, getListener);</span>
<a href="#l15.5"></a><span id="l15.5"> }</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7"> function publishItemArray(aItemArray, aPath, aProgressDialog) {</span>
<a href="#l15.8"></a><span id="l15.8">     let outputStream;</span>
<a href="#l15.9"></a><span id="l15.9">     let inputStream;</span>
<a href="#l15.10"></a><span id="l15.10">     let storageStream;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    let icsURL = cal.makeURL(aPath);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+    let icsURL = Services.io.newURI(aPath);</span>
<a href="#l15.14"></a><span id="l15.14"> </span>
<a href="#l15.15"></a><span id="l15.15">     let channel = Services.io.newChannelFromURI2(icsURL,</span>
<a href="#l15.16"></a><span id="l15.16">                                                  null,</span>
<a href="#l15.17"></a><span id="l15.17">                                                  Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l15.18"></a><span id="l15.18">                                                  null,</span>
<a href="#l15.19"></a><span id="l15.19">                                                  Components.interfaces.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l15.20"></a><span id="l15.20">                                                  Components.interfaces.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l15.21"></a><span id="l15.21">     if (icsURL.schemeIs(&quot;webcal&quot;)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -452,17 +452,17 @@ function deleteCalendars(controller, nam</span>
<a href="#l16.4"></a><span id="l16.4">  * @param name          calendar name</span>
<a href="#l16.5"></a><span id="l16.5">  */</span>
<a href="#l16.6"></a><span id="l16.6"> function createCalendar(controller, name) {</span>
<a href="#l16.7"></a><span id="l16.7">     let { lookup, eid } = helpersForController(controller);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">     let defaultView = eid(&quot;messengerWindow&quot;).getNode().ownerDocument.defaultView;</span>
<a href="#l16.10"></a><span id="l16.10">     let manager = defaultView.cal.getCalendarManager();</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    let url = defaultView.cal.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    let url = Services.io.newURI(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l16.14"></a><span id="l16.14">     let calendar = manager.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l16.15"></a><span id="l16.15">     calendar.name = name;</span>
<a href="#l16.16"></a><span id="l16.16">     manager.registerCalendar(calendar);</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18">     let calendarTree = lookup(`</span>
<a href="#l16.19"></a><span id="l16.19">         /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;tabmail&quot;)/</span>
<a href="#l16.20"></a><span id="l16.20">         id(&quot;tabpanelcontainer&quot;)/id(&quot;calendarTabPanel&quot;)/id(&quot;calendarContent&quot;)/</span>
<a href="#l16.21"></a><span id="l16.21">         id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/unit/test_alarm.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/unit/test_alarm.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -147,19 +147,19 @@ function test_audio_alarm() {</span>
<a href="#l17.4"></a><span id="l17.4">         alarm.addAttendee(attendee);</span>
<a href="#l17.5"></a><span id="l17.5">         do_throw(&quot;AUDIO alarm should not be able to save attendees&quot;);</span>
<a href="#l17.6"></a><span id="l17.6">     } catch (e) {</span>
<a href="#l17.7"></a><span id="l17.7">         // TODO looks like this test is disabled. Why?</span>
<a href="#l17.8"></a><span id="l17.8">     }</span>
<a href="#l17.9"></a><span id="l17.9"> </span>
<a href="#l17.10"></a><span id="l17.10">     // Test attachments</span>
<a href="#l17.11"></a><span id="l17.11">     let sound = cal.createAttachment();</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    sound.uri = cal.makeURL(&quot;file:///sound.wav&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    sound.uri = Services.io.newURI(&quot;file:///sound.wav&quot;);</span>
<a href="#l17.14"></a><span id="l17.14">     let sound2 = cal.createAttachment();</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-    sound2.uri = cal.makeURL(&quot;file:///sound2.wav&quot;);</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+    sound2.uri = Services.io.newURI(&quot;file:///sound2.wav&quot;);</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">     // Adding an attachment should work</span>
<a href="#l17.19"></a><span id="l17.19">     alarm.addAttachment(sound);</span>
<a href="#l17.20"></a><span id="l17.20">     let addedAttachments = alarm.getAttachments({});</span>
<a href="#l17.21"></a><span id="l17.21">     equal(addedAttachments.length, 1);</span>
<a href="#l17.22"></a><span id="l17.22">     equal(addedAttachments[0], sound);</span>
<a href="#l17.23"></a><span id="l17.23">     ok(alarm.icalString.includes(&quot;ATTACH:file:///sound.wav&quot;));</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25" class="difflineat">@@ -222,19 +222,19 @@ function test_custom_alarm() {</span>
<a href="#l17.26"></a><span id="l17.26">     alarm.deleteAttendee(attendee1);</span>
<a href="#l17.27"></a><span id="l17.27">     equal(alarm.getAttendees({}).length, 1);</span>
<a href="#l17.28"></a><span id="l17.28"> </span>
<a href="#l17.29"></a><span id="l17.29">     alarm.clearAttendees();</span>
<a href="#l17.30"></a><span id="l17.30">     equal(alarm.getAttendees({}).length, 0);</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32">     // Test for attachments</span>
<a href="#l17.33"></a><span id="l17.33">     let attach1 = cal.createAttachment();</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-    attach1.uri = cal.makeURL(&quot;file:///example.txt&quot;);</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+    attach1.uri = Services.io.newURI(&quot;file:///example.txt&quot;);</span>
<a href="#l17.36"></a><span id="l17.36">     let attach2 = cal.createAttachment();</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-    attach2.uri = cal.makeURL(&quot;file:///example2.txt&quot;);</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+    attach2.uri = Services.io.newURI(&quot;file:///example2.txt&quot;);</span>
<a href="#l17.39"></a><span id="l17.39"> </span>
<a href="#l17.40"></a><span id="l17.40">     alarm.addAttachment(attach1);</span>
<a href="#l17.41"></a><span id="l17.41">     alarm.addAttachment(attach2);</span>
<a href="#l17.42"></a><span id="l17.42"> </span>
<a href="#l17.43"></a><span id="l17.43">     let addedAttachments = alarm.getAttachments({});</span>
<a href="#l17.44"></a><span id="l17.44">     equal(addedAttachments.length, 2);</span>
<a href="#l17.45"></a><span id="l17.45">     equal(addedAttachments[0], attach1);</span>
<a href="#l17.46"></a><span id="l17.46">     equal(addedAttachments[1], attach2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/unit/test_attachment.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/unit/test_attachment.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -21,17 +21,17 @@ function test_hashes() {</span>
<a href="#l18.4"></a><span id="l18.4">     notEqual(hash1, attach.hashId);</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">     attach.rawData = &quot;hello&quot;;</span>
<a href="#l18.7"></a><span id="l18.7">     equal(hash1, attach.hashId);</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">     // Setting raw data should give us a BINARY attachment</span>
<a href="#l18.10"></a><span id="l18.10">     equal(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    attach.uri = cal.makeURL(&quot;http://hello&quot;);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    attach.uri = Services.io.newURI(&quot;http://hello&quot;);</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">     // Setting an uri should delete the value parameter</span>
<a href="#l18.16"></a><span id="l18.16">     equal(attach.getParameter(&quot;VALUE&quot;), null);</span>
<a href="#l18.17"></a><span id="l18.17"> }</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19"> function test_uriattach() {</span>
<a href="#l18.20"></a><span id="l18.20">     let attach = cal.createAttachment();</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -41,17 +41,17 @@ function test_uriattach() {</span>
<a href="#l18.23"></a><span id="l18.23">                    &quot;ATTACH;FMTTYPE=x-moz/test:http://hello\r\n&quot; +</span>
<a href="#l18.24"></a><span id="l18.24">                    &quot;END:VEVENT&quot;;</span>
<a href="#l18.25"></a><span id="l18.25">     let prop = e.icalComponent.getFirstProperty(&quot;ATTACH&quot;);</span>
<a href="#l18.26"></a><span id="l18.26">     attach.icalProperty = prop;</span>
<a href="#l18.27"></a><span id="l18.27"> </span>
<a href="#l18.28"></a><span id="l18.28">     notEqual(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l18.29"></a><span id="l18.29">     equal(attach.formatType, &quot;x-moz/test&quot;);</span>
<a href="#l18.30"></a><span id="l18.30">     equal(attach.getParameter(&quot;FMTTYPE&quot;), &quot;x-moz/test&quot;);</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    equal(attach.uri.spec, cal.makeURL(&quot;http://hello&quot;).spec);</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    equal(attach.uri.spec, Services.io.newURI(&quot;http://hello&quot;).spec);</span>
<a href="#l18.33"></a><span id="l18.33">     equal(attach.rawData, &quot;http://hello&quot;);</span>
<a href="#l18.34"></a><span id="l18.34"> }</span>
<a href="#l18.35"></a><span id="l18.35"> </span>
<a href="#l18.36"></a><span id="l18.36"> function test_binaryattach() {</span>
<a href="#l18.37"></a><span id="l18.37">     let attach = cal.createAttachment();</span>
<a href="#l18.38"></a><span id="l18.38">     let e = cal.createEvent();</span>
<a href="#l18.39"></a><span id="l18.39"> </span>
<a href="#l18.40"></a><span id="l18.40">     let attachString =</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

