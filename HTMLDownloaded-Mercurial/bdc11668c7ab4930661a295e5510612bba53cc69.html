<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17557:bdc11668c7ab4930661a295e5510612bba53cc69</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ bdc11668c7ab4930661a295e5510612bba53cc69" />
<meta property="og:url" content="/comm-central/rev/bdc11668c7ab4930661a295e5510612bba53cc69" />
<meta property="og:description" content="Bug 849540, part 2: Implement an OAuth2 SASL module helper, r=rkent." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / bdc11668c7ab4930661a295e5510612bba53cc69 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/bdc11668c7ab4930661a295e5510612bba53cc69">shortlog</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/bdc11668c7ab4930661a295e5510612bba53cc69">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69">files</a> |
changeset |
<a href="/comm-central/raw-rev/bdc11668c7ab4930661a295e5510612bba53cc69">raw</a>  | <a href="/comm-central/archive/bdc11668c7ab4930661a295e5510612bba53cc69.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=849540">Bug 849540</a>, part 2: Implement an OAuth2 SASL module helper, r=rkent.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#115;&#104;&#117;&#97;&#32;&#67;&#114;&#97;&#110;&#109;&#101;&#114;&#32;&#60;&#80;&#105;&#100;&#103;&#101;&#111;&#116;&#49;&#56;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 23 Feb 2015 01:01:11 -0600</td></tr>

<tr>
 <td>changeset 17557</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/bdc11668c7ab4930661a295e5510612bba53cc69">bdc11668c7ab4930661a295e5510612bba53cc69</a></td>
</tr>



<tr>
<td>parent 17556</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/47051fbe6edd14406a3f72501b6b6797c8aef79d">47051fbe6edd14406a3f72501b6b6797c8aef79d</a>
</td>
</tr>

<tr>
<td>child 17558</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1e5560a1eb9688fb79d6a885de4883ce1afd7f80">1e5560a1eb9688fb79d6a885de4883ce1afd7f80</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=bdc11668c7ab4930661a295e5510612bba53cc69">10804</a></td></tr>
<tr><td>push user</td><td>Pidgeot18@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 23 Feb 2015 07:03:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@bdc11668c7ab [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bdc11668c7ab4930661a295e5510612bba53cc69">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=bdc11668c7ab4930661a295e5510612bba53cc69&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bdc11668c7ab4930661a295e5510612bba53cc69&newProject=comm-central&newRevision=47051fbe6edd14406a3f72501b6b6797c8aef79d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bdc11668c7ab4930661a295e5510612bba53cc69&newProject=comm-central&newRevision=47051fbe6edd14406a3f72501b6b6797c8aef79d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=bdc11668c7ab4930661a295e5510612bba53cc69&newProject=comm-central&newRevision=47051fbe6edd14406a3f72501b6b6797c8aef79d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28rkent%29&revcount=50">rkent</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=849540">849540</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=849540">Bug 849540</a>, part 2: Implement an OAuth2 SASL module helper, r=rkent.

The code added in msgOAuth2Module.js is glue functionality to use the
configuration preferences to run the OAuth2.jsm logon process. It also makes the
process usable from C++, so that it can be consumed by IMAP and SMTP
implementations.

At present, the value for GMail is hardcoded. This is hopefully a temporary
measure until dynamic client configuration is supported, at which point it can
be removed. Unfortunately, this also requires us to hardcode the identifier for
the client instead of using, say, navigator.appName.

CLOSED TREE push for SeaMonkey localization changes.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/bdc11668c7ab4930661a295e5510612bba53cc69/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/bdc11668c7ab4930661a295e5510612bba53cc69/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/moz.build">mailnews/base/public/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/moz.build">file</a> |
<a href="/comm-central/annotate/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/moz.build">annotate</a> |
<a href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/moz.build">diff</a> |
<a href="/comm-central/comparison/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/moz.build">comparison</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/msgIOAuth2Module.idl">mailnews/base/public/msgIOAuth2Module.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/msgIOAuth2Module.idl">file</a> |
<a href="/comm-central/annotate/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/msgIOAuth2Module.idl">annotate</a> |
<a href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/msgIOAuth2Module.idl">diff</a> |
<a href="/comm-central/comparison/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/msgIOAuth2Module.idl">comparison</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/public/msgIOAuth2Module.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/moz.build">mailnews/base/src/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/moz.build">file</a> |
<a href="/comm-central/annotate/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/moz.build">annotate</a> |
<a href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/moz.build">diff</a> |
<a href="/comm-central/comparison/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/moz.build">comparison</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgBase.manifest">mailnews/base/src/msgBase.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgBase.manifest">file</a> |
<a href="/comm-central/annotate/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgBase.manifest">annotate</a> |
<a href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgBase.manifest">diff</a> |
<a href="/comm-central/comparison/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgBase.manifest">comparison</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgBase.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgOAuth2Module.js">mailnews/base/src/msgOAuth2Module.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgOAuth2Module.js">file</a> |
<a href="/comm-central/annotate/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgOAuth2Module.js">annotate</a> |
<a href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgOAuth2Module.js">diff</a> |
<a href="/comm-central/comparison/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgOAuth2Module.js">comparison</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69/mailnews/base/src/msgOAuth2Module.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/suite/locales/en-US/chrome/mailnews/messenger.properties">suite/locales/en-US/chrome/mailnews/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/bdc11668c7ab4930661a295e5510612bba53cc69/suite/locales/en-US/chrome/mailnews/messenger.properties">file</a> |
<a href="/comm-central/annotate/bdc11668c7ab4930661a295e5510612bba53cc69/suite/locales/en-US/chrome/mailnews/messenger.properties">annotate</a> |
<a href="/comm-central/diff/bdc11668c7ab4930661a295e5510612bba53cc69/suite/locales/en-US/chrome/mailnews/messenger.properties">diff</a> |
<a href="/comm-central/comparison/bdc11668c7ab4930661a295e5510612bba53cc69/suite/locales/en-US/chrome/mailnews/messenger.properties">comparison</a> |
<a href="/comm-central/log/bdc11668c7ab4930661a295e5510612bba53cc69/suite/locales/en-US/chrome/mailnews/messenger.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -125,16 +125,22 @@ authPasswordCleartextViaSSL=Normal passw</span>
<a href="#l1.4"></a><span id="l1.4"> authPasswordEncrypted=Encrypted password</span>
<a href="#l1.5"></a><span id="l1.5"> authKerberos=Kerberos / GSSAPI</span>
<a href="#l1.6"></a><span id="l1.6"> authExternal=TLS Certificate</span>
<a href="#l1.7"></a><span id="l1.7"> authNTLM=NTLM</span>
<a href="#l1.8"></a><span id="l1.8"> authOAuth2=OAuth2</span>
<a href="#l1.9"></a><span id="l1.9"> authAnySecure=Any secure method (deprecated)</span>
<a href="#l1.10"></a><span id="l1.10"> authAny=Any method (insecure)</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+# OAuth2 window title</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+# LOCALIZATION NOTE(oauth2WindowTitle):</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+# %1$S is the username (or full email address) used for authentication.</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+# %2$S is the hostname of the account being authenticated.</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+oauth2WindowTitle=Enter credentials for %1$S on %2$S</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+</span>
<a href="#l1.18"></a><span id="l1.18"> # LOCALIZATION NOTE(serverType-nntp): Do not translate &quot;NNTP&quot; in the line below</span>
<a href="#l1.19"></a><span id="l1.19"> serverType-nntp=News Server (NNTP)</span>
<a href="#l1.20"></a><span id="l1.20"> # LOCALIZATION NOTE(serverType-pop3): Do not translate &quot;POP&quot; in the line below</span>
<a href="#l1.21"></a><span id="l1.21"> serverType-pop3=POP Mail Server</span>
<a href="#l1.22"></a><span id="l1.22"> # LOCALIZATION NOTE(serverType-imap): Do not translate &quot;IMAP&quot; in the line below</span>
<a href="#l1.23"></a><span id="l1.23"> serverType-imap=IMAP Mail Server</span>
<a href="#l1.24"></a><span id="l1.24"> serverType-none=Local Mail Store</span>
<a href="#l1.25"></a><span id="l1.25"> # LOCALIZATION NOTE(serverType-movemail): DONT_TRANSLATE</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/public/moz.build</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/public/moz.build</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> XPIDL_SOURCES += [</span>
<a href="#l2.9"></a><span id="l2.9">     'MailNewsTypes2.idl',</span>
<a href="#l2.10"></a><span id="l2.10">     'mozINewMailListener.idl',</span>
<a href="#l2.11"></a><span id="l2.11">     'mozINewMailNotificationService.idl',</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+    'msgIOAuth2Module.idl',</span>
<a href="#l2.13"></a><span id="l2.13">     'nsICopyMessageListener.idl',</span>
<a href="#l2.14"></a><span id="l2.14">     'nsICopyMsgStreamListener.idl',</span>
<a href="#l2.15"></a><span id="l2.15">     'nsIFolderListener.idl',</span>
<a href="#l2.16"></a><span id="l2.16">     'nsIFolderLookupService.idl',</span>
<a href="#l2.17"></a><span id="l2.17">     'nsIIncomingServerListener.idl',</span>
<a href="#l2.18"></a><span id="l2.18">     'nsIMapiRegistry.idl',</span>
<a href="#l2.19"></a><span id="l2.19">     'nsIMessenger.idl',</span>
<a href="#l2.20"></a><span id="l2.20">     'nsIMessengerMigrator.idl',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mailnews/base/public/msgIOAuth2Module.idl</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,59 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+/* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+#include &quot;nsISupports.idl&quot;</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+interface nsIMsgIncomingServer;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+interface nsISmtpServer;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+/**</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+ * A listener callback for OAuth2 SASL authentication. This would be represented</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+ * as a promise, but this needs to be consumed by C++ code.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+ */</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+[scriptable, uuid(9a088b49-bc13-4f99-9478-053a6a43e370)]</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+interface msgIOAuth2ModuleListener : nsISupports {</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+  /// Called on successful OAuth2 authentication with the bearer token to use.</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+  void onSuccess(in ACString aBearerToken);</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+  /// Called on failed OAuth2 authentication.</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+  void onFailure(in nsresult aError);</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+};</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+/**</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+ * An interface for managing the responsibilities of using OAuth2 to produce a</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+ * bearer token, for use in SASL steps.</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+ */</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+[scriptable, uuid(68c275f8-cfa7-4622-b279-af290616cae6)]</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+interface msgIOAuth2Module : nsISupports {</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+  /**</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+   * Initialize the OAuth2 parameters from an SMTP server, and return whether or</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+   * not we can authenticate with OAuth2.</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+   */</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+  bool initFromSmtp(in nsISmtpServer aSmtpServer);</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+  /**</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+   * Initialize the OAuth2 parameters from an incoming server, and return</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+   * whether or not we can authenticate with OAuth2.</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+   */</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  bool initFromMail(in nsIMsgIncomingServer aServer);</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+  /**</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+   * Connect to the OAuth2 server to get an access token.</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+   * @param aWithUI   If false, do not allow a dialog to be popped up to query</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+   *                  for a password.</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+   * @param aCallback Listener that handles the async response.</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+   */</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+  void connect(in boolean aWithUI, in msgIOAuth2ModuleListener aCallback);</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+  /**</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+   * Return the base64-encoded string to send as the client initial response for</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+   * SASL XOAUTH2.</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+   */</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+  ACString buildXOAuth2String();</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+};</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+%{C++</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+#define MSGIOAUTH2MODULE_CONTRACTID &quot;@mozilla.org/mail/oauth2-module;1&quot;</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+%}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/src/moz.build</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/src/moz.build</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -63,16 +63,17 @@ if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'gtk2</span>
<a href="#l4.4"></a><span id="l4.4">     SOURCES += ['nsMessengerUnixIntegration.cpp']</span>
<a href="#l4.5"></a><span id="l4.5"> elif CONFIG['MOZ_WIDGET_TOOLKIT'] == 'cocoa':</span>
<a href="#l4.6"></a><span id="l4.6">     SOURCES += ['nsMessengerOSXIntegration.mm']</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> EXTRA_COMPONENTS += [</span>
<a href="#l4.9"></a><span id="l4.9">     'folderLookupService.js',</span>
<a href="#l4.10"></a><span id="l4.10">     'msgAsyncPrompter.js',</span>
<a href="#l4.11"></a><span id="l4.11">     'msgBase.manifest',</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+    'msgOAuth2Module.js',</span>
<a href="#l4.13"></a><span id="l4.13">     'newMailNotificationService.js',</span>
<a href="#l4.14"></a><span id="l4.14">     'nsMailNewsCommandLineHandler.js',</span>
<a href="#l4.15"></a><span id="l4.15"> ]</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17"> EXTRA_JS_MODULES += [</span>
<a href="#l4.18"></a><span id="l4.18">     'virtualFolderWrapper.js',</span>
<a href="#l4.19"></a><span id="l4.19"> ]</span>
<a href="#l4.20"></a><span id="l4.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/src/msgBase.manifest</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/src/msgBase.manifest</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -3,8 +3,10 @@ contract @mozilla.org/messenger/msgAsync</span>
<a href="#l5.4"></a><span id="l5.4"> component {2f86d554-f9d9-4e76-8eb7-243f047333ee} nsMailNewsCommandLineHandler.js</span>
<a href="#l5.5"></a><span id="l5.5"> contract @mozilla.org/commandlinehandler/general-startup;1?type=mail {2f86d554-f9d9-4e76-8eb7-243f047333ee}</span>
<a href="#l5.6"></a><span id="l5.6"> category command-line-handler m-mail @mozilla.org/commandlinehandler/general-startup;1?type=mail</span>
<a href="#l5.7"></a><span id="l5.7"> component {740880E6-E299-4165-B82F-DF1DCAB3AE22} newMailNotificationService.js</span>
<a href="#l5.8"></a><span id="l5.8"> contract @mozilla.org/newMailNotificationService;1 {740880E6-E299-4165-B82F-DF1DCAB3AE22}</span>
<a href="#l5.9"></a><span id="l5.9"> category profile-after-change NewMailNotificationService @mozilla.org/newMailNotificationService;1 </span>
<a href="#l5.10"></a><span id="l5.10"> component {a30be08c-afc8-4fed-9af7-79778a23db23} folderLookupService.js</span>
<a href="#l5.11"></a><span id="l5.11"> contract @mozilla.org/mail/folder-lookup;1 {a30be08c-afc8-4fed-9af7-79778a23db23}</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+component {b63d8e4c-bf60-439b-be0e-7c9f67291042} msgOAuth2Module.js</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+contract @mozilla.org/mail/oauth2-module;1 {b63d8e4c-bf60-439b-be0e-7c9f67291042}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mailnews/base/src/msgOAuth2Module.js</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,139 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+const Cc = Components.classes;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+const Ci = Components.interfaces;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+const Cr = Components.results;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/OAuth2.jsm&quot;);</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+function OAuth2Module() {</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+  this._refreshToken = '';</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+}</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+OAuth2Module.prototype = {</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+  // XPCOM registration stuff</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Ci.msgIOAuth2Module]),</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+  classID: Components.ID(&quot;{b63d8e4c-bf60-439b-be0e-7c9f67291042}&quot;),</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+  _loadOAuthClientDetails(aIssuer) {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+    if (aIssuer == &quot;accounts.google.com&quot;) {</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+      // For the moment, these details are hard-coded, since Google does not</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+      // provide dynamic client registration. Don't copy these values for your</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+      // own application--register it yourself. This code (and possibly even the</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+      // registration itself) will disappear when this is switched to dynamic</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+      // client registration.</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+      this._appKey = '572172754692-vfo2oqvu2oju9be729s915glghp1vpfj.apps.googleusercontent.com';</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+      this._appSecret = 'YpeuM0eYPQe_r98HZ7p16zUm';</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+      this._authURI = &quot;https://accounts.google.com/o/oauth2/auth&quot;;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+      this._tokenURI = &quot;https://www.googleapis.com/oauth2/v3/token&quot;;</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+    } else {</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+      throw Cr.NS_ERROR_INVALID_ARGUMENT;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+    }</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+  },</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+  initFromSmtp(aServer) {</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+    return this._initPrefs(&quot;mail.smtpserver.&quot; + aServer.key + &quot;.&quot;,</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+      aServer.username, aServer.hostname);</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+  },</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+  initFromMail(aServer) {</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+    return this._initPrefs(&quot;mail.server.&quot; + aServer.key + &quot;.&quot;,</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+      aServer.username, aServer.realHostName);</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+  },</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+  _initPrefs(root, aUsername, aHostname) {</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+    // Load all of the parameters from preferences.</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+    let issuer = Preferences.get(root + &quot;oauth2.issuer&quot;, &quot;&quot;);</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+    let scope = Preferences.get(root + &quot;oauth2.scope&quot;, &quot;&quot;);</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+    // These properties are absolutely essential to OAuth2 support. If we don't</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+    // have them, we don't support OAuth2.</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+    if (!issuer || !scope)</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+      return false;</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+    // Find the app key we need for the OAuth2 string. Eventually, this should</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+    // be using dynamic client registration, but there are no current</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+    // implementations that we can test this with.</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+    this._loadOAuthClientDetails(issuer);</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+    // Username is needed to generate the XOAUTH2 string.</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+    this._username = aUsername;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+    // LoginURL is needed to save the refresh token in the password manager.</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+    this._loginUrl = &quot;oauth://&quot; + issuer;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+    // We use the scope to indicate the realm.</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+    this._scope = scope;</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+    // Define the OAuth property and store it.</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+    this._oauth = new OAuth2(this._authURI, scope, this._appKey,</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+      this._appSecret);</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+    this._oauth.authURI = this._authURI;</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+    this._oauth.tokenURI = this._tokenURI;</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+    // Try hinting the username...</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+    this._oauth.extraAuthParams = [</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+      [&quot;login_hint&quot;, aUsername]</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+    ];</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+    // Set the window title to something more useful than &quot;Unnamed&quot;</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+    this._oauth.requestWindowTitle =</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+      Services.strings.createBundle(&quot;chrome://messenger/locale/messenger.properties&quot;)</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+                      .formatStringFromName(&quot;oauth2WindowTitle&quot;,</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+                                            [aUsername, aHostname], 2);</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+    // This stores the refresh token in the login manager.</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+    Object.defineProperty(this._oauth, &quot;refreshToken&quot;, {</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineplus">+      get: () =&gt; this.refreshToken,</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineplus">+      set: (token) =&gt; this.refreshToken = token</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+    });</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+    return true;</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+  },</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+  get refreshToken() {</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+    let loginMgr = Cc[&quot;@mozilla.org/login-manager;1&quot;]</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineplus">+                     .getService(Ci.nsILoginManager);</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineplus">+    let logins = loginMgr.findLogins({}, this._loginUrl, null, this._scope);</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+    for (let login of logins) {</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+      if (login.username == this._username)</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+        return login.password;</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+    }</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+    return '';</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+  },</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+  set refreshToken(token) {</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+    let loginMgr = Cc[&quot;@mozilla.org/login-manager;1&quot;]</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+                     .getService(Ci.nsILoginManager);</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineplus">+    // Check if we already have a login with this username, and modify the</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+    // password on that, if we do.</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+    let logins = loginMgr.findLogins({}, this._loginUrl, null, this._scope);</span>
<a href="#l6.116"></a><span id="l6.116" class="difflineplus">+    for (let login of logins) {</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineplus">+      if (login.username == this._username)</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+        loginMgr.modifyLogin(login, {password: token});</span>
<a href="#l6.119"></a><span id="l6.119" class="difflineplus">+      return token;</span>
<a href="#l6.120"></a><span id="l6.120" class="difflineplus">+    }</span>
<a href="#l6.121"></a><span id="l6.121" class="difflineplus">+</span>
<a href="#l6.122"></a><span id="l6.122" class="difflineplus">+    // Otherwise, we need a new login, so create one and fill it in.</span>
<a href="#l6.123"></a><span id="l6.123" class="difflineplus">+    let login = Cc[&quot;@mozilla.org/login-manager/loginInfo;1&quot;]</span>
<a href="#l6.124"></a><span id="l6.124" class="difflineplus">+                  .createInstance(Ci.nsILoginInfo);</span>
<a href="#l6.125"></a><span id="l6.125" class="difflineplus">+    login.init(this._loginUrl, null, this._scope, this._username, token,</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineplus">+      '', '');</span>
<a href="#l6.127"></a><span id="l6.127" class="difflineplus">+    loginMgr.addLogin(login);</span>
<a href="#l6.128"></a><span id="l6.128" class="difflineplus">+    return token;</span>
<a href="#l6.129"></a><span id="l6.129" class="difflineplus">+  },</span>
<a href="#l6.130"></a><span id="l6.130" class="difflineplus">+</span>
<a href="#l6.131"></a><span id="l6.131" class="difflineplus">+  connect(aWithUI, aListener) {</span>
<a href="#l6.132"></a><span id="l6.132" class="difflineplus">+    this._oauth.connect(() =&gt; aListener.onSuccess(this._oauth.accessToken),</span>
<a href="#l6.133"></a><span id="l6.133" class="difflineplus">+                        x =&gt; aListener.onFailure(x),</span>
<a href="#l6.134"></a><span id="l6.134" class="difflineplus">+                        aWithUI, false);</span>
<a href="#l6.135"></a><span id="l6.135" class="difflineplus">+  },</span>
<a href="#l6.136"></a><span id="l6.136" class="difflineplus">+</span>
<a href="#l6.137"></a><span id="l6.137" class="difflineplus">+  buildXOAuth2String() {</span>
<a href="#l6.138"></a><span id="l6.138" class="difflineplus">+    return btoa(&quot;user=&quot; + this._username + &quot;\x01auth=Bearer &quot; +</span>
<a href="#l6.139"></a><span id="l6.139" class="difflineplus">+      this._oauth.accessToken + &quot;\x01\x01&quot;);</span>
<a href="#l6.140"></a><span id="l6.140" class="difflineplus">+  },</span>
<a href="#l6.141"></a><span id="l6.141" class="difflineplus">+};</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineplus">+</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+var NSGetFactory = XPCOMUtils.generateNSGetFactory([OAuth2Module]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/messenger.properties</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -123,16 +123,22 @@ authPasswordCleartextViaSSL=Normal passw</span>
<a href="#l7.4"></a><span id="l7.4"> authPasswordEncrypted=Encrypted password</span>
<a href="#l7.5"></a><span id="l7.5"> authKerberos=Kerberos / GSSAPI</span>
<a href="#l7.6"></a><span id="l7.6"> authExternal=TLS Certificate</span>
<a href="#l7.7"></a><span id="l7.7"> authNTLM=NTLM</span>
<a href="#l7.8"></a><span id="l7.8"> authOAuth2=OAuth2</span>
<a href="#l7.9"></a><span id="l7.9"> authAnySecure=Any secure method (deprecated)</span>
<a href="#l7.10"></a><span id="l7.10"> authAny=Any method (insecure)</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+# OAuth2 window title</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+# LOCALIZATION NOTE(oauth2WindowTitle):</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+# %1$S is the username (or full email address) used for authentication.</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+# %2$S is the hostname of the account being authenticated.</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+oauth2WindowTitle=Enter credentials for %1$S on %2$S</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+</span>
<a href="#l7.18"></a><span id="l7.18"> # LOCALIZATION NOTE(serverType-nntp): Do not translate &quot;NNTP&quot; in the line below</span>
<a href="#l7.19"></a><span id="l7.19"> serverType-nntp=News Server (NNTP)</span>
<a href="#l7.20"></a><span id="l7.20"> # LOCALIZATION NOTE(serverType-pop3): Do not translate &quot;POP&quot; in the line below</span>
<a href="#l7.21"></a><span id="l7.21"> serverType-pop3=POP Mail Server</span>
<a href="#l7.22"></a><span id="l7.22"> # LOCALIZATION NOTE(serverType-imap): Do not translate &quot;IMAP&quot; in the line below</span>
<a href="#l7.23"></a><span id="l7.23"> serverType-imap=IMAP Mail Server</span>
<a href="#l7.24"></a><span id="l7.24"> serverType-none=Local Mail Store</span>
<a href="#l7.25"></a><span id="l7.25"> # LOCALIZATION NOTE(serverType-movemail): DONT_TRANSLATE</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

