<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17547:ea9366c0757233c1e7bee1a3e4275bb697cf4f5a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ea9366c0757233c1e7bee1a3e4275bb697cf4f5a" />
<meta property="og:url" content="/comm-central/rev/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a" />
<meta property="og:description" content="Fix bug 1022342 - Make use of Assert.jsm in xpcshell tests. r=philipp" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ea9366c0757233c1e7bee1a3e4275bb697cf4f5a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">shortlog</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">files</a> |
changeset |
<a href="/comm-central/raw-rev/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">raw</a>  | <a href="/comm-central/archive/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1022342">bug 1022342</a> - Make use of Assert.jsm in xpcshell tests. r=philipp
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#117;&#115;&#104;&#97;&#110;&#32;&#74;&#111;&#115;&#104;&#105;&#32;&#60;&#48;&#111;&#51;&#107;&#111;&#48;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 23 Feb 2015 01:24:29 +0100</td></tr>

<tr>
 <td>changeset 17547</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">ea9366c0757233c1e7bee1a3e4275bb697cf4f5a</a></td>
</tr>



<tr>
<td>parent 17546</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/11bbc7e7b180ab0d4883031cc10f5a53734b10ec">11bbc7e7b180ab0d4883031cc10f5a53734b10ec</a>
</td>
</tr>

<tr>
<td>child 17548</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a39af5933cc112d73dfe116da2030353bcacdd9c">a39af5933cc112d73dfe116da2030353bcacdd9c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ea9366c0757233c1e7bee1a3e4275bb697cf4f5a">10802</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Mon, 23 Feb 2015 00:49:52 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@b50441dcdf0d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b50441dcdf0d63a642d784b223f6cee0f4195f6f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&newProject=comm-central&newRevision=9903ed277c05c6ad56f7a652aad43a19d24a98d6&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&newProject=comm-central&newRevision=9903ed277c05c6ad56f7a652aad43a19d24a98d6&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b50441dcdf0d63a642d784b223f6cee0f4195f6f&newProject=comm-central&newRevision=9903ed277c05c6ad56f7a652aad43a19d24a98d6&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1022342">1022342</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1022342">bug 1022342</a> - Make use of Assert.jsm in xpcshell tests. r=philipp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarm.js">calendar/test/unit/test_alarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarm.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarm.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarm.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarm.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarmservice.js">calendar/test/unit/test_alarmservice.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarmservice.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarmservice.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarmservice.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarmservice.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_alarmservice.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attachment.js">calendar/test/unit/test_attachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attachment.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attachment.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attachment.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attachment.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attachment.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attendee.js">calendar/test/unit/test_attendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attendee.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attendee.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attendee.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attendee.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_attendee.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug272411.js">calendar/test/unit/test_bug272411.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug272411.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug272411.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug272411.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug272411.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug272411.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug343792.js">calendar/test/unit/test_bug343792.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug343792.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug343792.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug343792.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug343792.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug343792.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug350845.js">calendar/test/unit/test_bug350845.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug350845.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug350845.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug350845.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug350845.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug350845.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug356207.js">calendar/test/unit/test_bug356207.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug356207.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug356207.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug356207.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug356207.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug356207.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug485571.js">calendar/test/unit/test_bug485571.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug485571.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug485571.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug485571.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug485571.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug485571.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug494140.js">calendar/test/unit/test_bug494140.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug494140.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug494140.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug494140.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug494140.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug494140.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug523860.js">calendar/test/unit/test_bug523860.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug523860.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug523860.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug523860.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug523860.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug523860.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug653924.js">calendar/test/unit/test_bug653924.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug653924.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug653924.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug653924.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug653924.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug653924.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug668222.js">calendar/test/unit/test_bug668222.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug668222.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug668222.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug668222.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug668222.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug668222.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug759324.js">calendar/test/unit/test_bug759324.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug759324.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug759324.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug759324.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug759324.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_bug759324.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_calmgr.js">calendar/test/unit/test_calmgr.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_calmgr.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_calmgr.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_calmgr.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_calmgr.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_calmgr.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime.js">calendar/test/unit/test_datetime.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime_before_1970.js">calendar/test/unit/test_datetime_before_1970.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime_before_1970.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime_before_1970.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime_before_1970.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime_before_1970.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_datetime_before_1970.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_deleted_items.js">calendar/test/unit/test_deleted_items.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_deleted_items.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_deleted_items.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_deleted_items.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_deleted_items.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_deleted_items.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_duration.js">calendar/test/unit/test_duration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_duration.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_duration.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_duration.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_duration.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_duration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_extract.js">calendar/test/unit/test_extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_extract.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_extract.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_extract.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_extract.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_extract.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy.js">calendar/test/unit/test_freebusy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy_service.js">calendar/test/unit/test_freebusy_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy_service.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy_service.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy_service.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy_service.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_freebusy_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_gdata_provider.js">calendar/test/unit/test_gdata_provider.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_gdata_provider.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_gdata_provider.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_gdata_provider.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_gdata_provider.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_gdata_provider.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_hashedarray.js">calendar/test/unit/test_hashedarray.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_hashedarray.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_hashedarray.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_hashedarray.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_hashedarray.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_hashedarray.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics.js">calendar/test/unit/test_ics.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_parser.js">calendar/test/unit/test_ics_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_parser.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_parser.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_parser.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_parser.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_parser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_service.js">calendar/test/unit/test_ics_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_service.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_service.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_service.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_service.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_ics_service.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_items.js">calendar/test/unit/test_items.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_items.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_items.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_items.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_items.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_items.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_providers.js">calendar/test/unit/test_providers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_providers.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_providers.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_providers.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_providers.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_providers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_recur.js">calendar/test/unit/test_recur.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_recur.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_recur.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_recur.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_recur.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_recur.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_relation.js">calendar/test/unit/test_relation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_relation.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_relation.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_relation.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_relation.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_relation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_rfc3339_parser.js">calendar/test/unit/test_rfc3339_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_rfc3339_parser.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_rfc3339_parser.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_rfc3339_parser.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_rfc3339_parser.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_rfc3339_parser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_search_service.js">calendar/test/unit/test_search_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_search_service.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_search_service.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_search_service.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_search_service.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_search_service.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_startup_service.js">calendar/test/unit/test_startup_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_startup_service.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_startup_service.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_startup_service.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_startup_service.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_startup_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_storage.js">calendar/test/unit/test_storage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_storage.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_storage.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_storage.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_storage.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_storage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_timezone.js">calendar/test/unit/test_timezone.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_timezone.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_timezone.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_timezone.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_timezone.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_timezone.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_utils.js">calendar/test/unit/test_utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_utils.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_utils.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_utils.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_utils.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_webcal.js">calendar/test/unit/test_webcal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_webcal.js">file</a> |
<a href="/comm-central/annotate/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_webcal.js">annotate</a> |
<a href="/comm-central/diff/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_webcal.js">diff</a> |
<a href="/comm-central/comparison/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_webcal.js">comparison</a> |
<a href="/comm-central/log/ea9366c0757233c1e7bee1a3e4275bb697cf4f5a/calendar/test/unit/test_webcal.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -182,55 +182,22 @@ function compareItemsSpecific(aLeftItem,</span>
<a href="#l1.4"></a><span id="l1.4">         // left out:  &quot;id&quot;, &quot;calendar&quot;, &quot;lastModifiedTime&quot;, &quot;generation&quot;,</span>
<a href="#l1.5"></a><span id="l1.5">         // &quot;stampTime&quot; as these are expected to change</span>
<a href="#l1.6"></a><span id="l1.6">         aPropArray = [&quot;start&quot;, &quot;end&quot;, &quot;duration&quot;,</span>
<a href="#l1.7"></a><span id="l1.7">                       &quot;title&quot;, &quot;priority&quot;, &quot;privacy&quot;, &quot;creationDate&quot;,</span>
<a href="#l1.8"></a><span id="l1.8">                       &quot;status&quot;, &quot;alarmLastAck&quot;,</span>
<a href="#l1.9"></a><span id="l1.9">                       &quot;recurrenceStartDate&quot;];</span>
<a href="#l1.10"></a><span id="l1.10">     }</span>
<a href="#l1.11"></a><span id="l1.11">     for (var i = 0; i &lt; aPropArray.length; i++) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        do_check_eq(getProps(aLeftItem, aPropArray[i]),</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                    getProps(aRightItem,aPropArray[i]),</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-                    Components.stack.caller);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+        equal(getProps(aLeftItem, aPropArray[i]),</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+              getProps(aRightItem, aPropArray[i]),</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+              Components.stack.caller);</span>
<a href="#l1.18"></a><span id="l1.18">     }</span>
<a href="#l1.19"></a><span id="l1.19"> }</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-/**</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">- * Test whether specified function throws exception with expected</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">- * result.</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">- *</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">- * @param func</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">- *        Function to be tested.</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">- * @param result</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">- *        Expected result. &lt;code&gt;null&lt;/code&gt; for no throws.</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">- * @param stack</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">- *        Optional stack object to be printed. &lt;code&gt;null&lt;/code&gt; for</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">- *        Components#stack#caller.</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">- */</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-function do_check_throws(func, result, stack)</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-{</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-  if (!stack)</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-    stack = Components.stack.caller;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-  try {</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-    func();</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-  } catch (exc) {</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-    if (exc.result == result || exc == result) {</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-      let msg = stack.filename + &quot; | [&quot; + stack.name + &quot; : &quot; +</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-           stack.lineNumber + &quot;] &quot; + exc.result + &quot; == &quot; + result + &quot;\n&quot;;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-      do_report_result(true, msg, stack);</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-      return;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-    }</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-    do_throw(&quot;expected result &quot; + result + &quot;, caught &quot; + (exc.result || exc), stack);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-  }</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-  if (result) {</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-    do_throw(&quot;expected result &quot; + result + &quot;, none thrown&quot;, stack);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-  }</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-}</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55"> /**</span>
<a href="#l1.56"></a><span id="l1.56">  * Unfold ics lines by removing any \r\n or \n followed by a linear whitespace</span>
<a href="#l1.57"></a><span id="l1.57">  * (space or htab).</span>
<a href="#l1.58"></a><span id="l1.58">  *</span>
<a href="#l1.59"></a><span id="l1.59">  * @param aLine     The line to unfold</span>
<a href="#l1.60"></a><span id="l1.60">  * @return          The unfolded line</span>
<a href="#l1.61"></a><span id="l1.61">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/test/unit/test_alarm.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/test/unit/test_alarm.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -40,323 +40,323 @@ function test_initial_creation() {</span>
<a href="#l2.4"></a><span id="l2.4">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.5"></a><span id="l2.5"> }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> function test_display_alarm() {</span>
<a href="#l2.8"></a><span id="l2.8">     dump(&quot;Testing DISPLAY alarms...&quot;);</span>
<a href="#l2.9"></a><span id="l2.9">     let alarm = cal.createAlarm();</span>
<a href="#l2.10"></a><span id="l2.10">     // Set ACTION to DISPLAY, make sure this was not rejected</span>
<a href="#l2.11"></a><span id="l2.11">     alarm.action = &quot;DISPLAY&quot;;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    do_check_eq(alarm.action, &quot;DISPLAY&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    equal(alarm.action, &quot;DISPLAY&quot;);</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">     // Set a Description, REQUIRED for ACTION:DISPLAY</span>
<a href="#l2.16"></a><span id="l2.16">     alarm.description = &quot;test&quot;;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-    do_check_eq(alarm.description, &quot;test&quot;);</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+    equal(alarm.description, &quot;test&quot;);</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">     // SUMMARY is not valid for ACTION:DISPLAY</span>
<a href="#l2.21"></a><span id="l2.21">     alarm.summary = &quot;test&quot;;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-    do_check_eq(alarm.summary, null);</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+    equal(alarm.summary, null);</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25">     // No attendees allowed</span>
<a href="#l2.26"></a><span id="l2.26">     let attendee = cal.createAttendee();</span>
<a href="#l2.27"></a><span id="l2.27">     attendee.id = &quot;mailto:horst&quot;;</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+    throws(function() {</span>
<a href="#l2.31"></a><span id="l2.31">         // DISPLAY alarm should not be able to save attendees</span>
<a href="#l2.32"></a><span id="l2.32">         alarm.addAttendee(attendee);</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-    }, Components.results.NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+    }, /Alarm type AUDIO\/DISPLAY may not have attendees/);</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+    throws(function() {</span>
<a href="#l2.38"></a><span id="l2.38">         // DISPLAY alarm should not be able to save attachment</span>
<a href="#l2.39"></a><span id="l2.39">         alarm.addAttachment(cal.createAttachment());</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-    }, Components.results.NS_ERROR_XPC_JAVASCRIPT_ERROR_WITH_DETAILS);</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+    }, /Alarm type DISPLAY may not have attachments/);</span>
<a href="#l2.42"></a><span id="l2.42"> </span>
<a href="#l2.43"></a><span id="l2.43">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.44"></a><span id="l2.44"> }</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46"> function test_email_alarm() {</span>
<a href="#l2.47"></a><span id="l2.47">     dump(&quot;Testing EMAIL alarms...&quot;);</span>
<a href="#l2.48"></a><span id="l2.48">     let alarm = cal.createAlarm();</span>
<a href="#l2.49"></a><span id="l2.49">     // Set ACTION to DISPLAY, make sure this was not rejected</span>
<a href="#l2.50"></a><span id="l2.50">     alarm.action = &quot;EMAIL&quot;;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-    do_check_eq(alarm.action, &quot;EMAIL&quot;);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    equal(alarm.action, &quot;EMAIL&quot;);</span>
<a href="#l2.53"></a><span id="l2.53"> </span>
<a href="#l2.54"></a><span id="l2.54">     // Set a Description, REQUIRED for ACTION:EMAIL</span>
<a href="#l2.55"></a><span id="l2.55">     alarm.description = &quot;description&quot;;</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-    do_check_eq(alarm.description, &quot;description&quot;);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+    equal(alarm.description, &quot;description&quot;);</span>
<a href="#l2.58"></a><span id="l2.58"> </span>
<a href="#l2.59"></a><span id="l2.59">     // Set a Summary, REQUIRED for ACTION:EMAIL</span>
<a href="#l2.60"></a><span id="l2.60">     alarm.summary = &quot;summary&quot;;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-    do_check_eq(alarm.summary, &quot;summary&quot;);</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+    equal(alarm.summary, &quot;summary&quot;);</span>
<a href="#l2.63"></a><span id="l2.63"> </span>
<a href="#l2.64"></a><span id="l2.64">     // Set an offset of some sort</span>
<a href="#l2.65"></a><span id="l2.65">     alarm.related = Components.interfaces.calIAlarm.ALARM_RELATED_START;</span>
<a href="#l2.66"></a><span id="l2.66">     alarm.offset = cal.createDuration();</span>
<a href="#l2.67"></a><span id="l2.67"> </span>
<a href="#l2.68"></a><span id="l2.68">     // Check for at least one attendee</span>
<a href="#l2.69"></a><span id="l2.69">     let attendee1 = cal.createAttendee();</span>
<a href="#l2.70"></a><span id="l2.70">     attendee1.id = &quot;mailto:horst&quot;;</span>
<a href="#l2.71"></a><span id="l2.71">     let attendee2 = cal.createAttendee();</span>
<a href="#l2.72"></a><span id="l2.72">     attendee2.id = &quot;mailto:gustav&quot;;</span>
<a href="#l2.73"></a><span id="l2.73"> </span>
<a href="#l2.74"></a><span id="l2.74" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+    equal(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.76"></a><span id="l2.76">     alarm.addAttendee(attendee1);</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+    equal(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.79"></a><span id="l2.79">     alarm.addAttendee(attendee2);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 2);</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    equal(alarm.getAttendees({}).length, 2);</span>
<a href="#l2.82"></a><span id="l2.82">     alarm.addAttendee(attendee1);</span>
<a href="#l2.83"></a><span id="l2.83">     let addedAttendees = alarm.getAttendees({});</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-    do_check_eq(addedAttendees.length, 2);</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-    do_check_eq(addedAttendees[0], attendee2);</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineminus">-    do_check_eq(addedAttendees[1], attendee1);</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+    equal(addedAttendees.length, 2);</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+    equal(addedAttendees[0], attendee2);</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+    equal(addedAttendees[1], attendee1);</span>
<a href="#l2.90"></a><span id="l2.90"> </span>
<a href="#l2.91"></a><span id="l2.91" class="difflineminus">-    do_check_true(!!alarm.icalComponent.serializeToICS().match(/mailto:horst/));</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineminus">-    do_check_true(!!alarm.icalComponent.serializeToICS().match(/mailto:gustav/));</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+    ok(!!alarm.icalComponent.serializeToICS().match(/mailto:horst/));</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+    ok(!!alarm.icalComponent.serializeToICS().match(/mailto:gustav/));</span>
<a href="#l2.95"></a><span id="l2.95"> </span>
<a href="#l2.96"></a><span id="l2.96">     alarm.deleteAttendee(attendee1);</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+    equal(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.99"></a><span id="l2.99"> </span>
<a href="#l2.100"></a><span id="l2.100">     alarm.clearAttendees();</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+    equal(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.103"></a><span id="l2.103"> </span>
<a href="#l2.104"></a><span id="l2.104">     // TODO test attachments</span>
<a href="#l2.105"></a><span id="l2.105">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.106"></a><span id="l2.106"> }</span>
<a href="#l2.107"></a><span id="l2.107"> </span>
<a href="#l2.108"></a><span id="l2.108"> function test_audio_alarm() {</span>
<a href="#l2.109"></a><span id="l2.109">     dump(&quot;Testing AUDIO alarms...&quot;);</span>
<a href="#l2.110"></a><span id="l2.110">     let alarm = cal.createAlarm();</span>
<a href="#l2.111"></a><span id="l2.111">     alarm.related = Components.interfaces.calIAlarm.ALARM_RELATED_ABSOLUTE;</span>
<a href="#l2.112"></a><span id="l2.112">     alarm.alarmDate = cal.createDateTime();</span>
<a href="#l2.113"></a><span id="l2.113">     // Set ACTION to AUDIO, make sure this was not rejected</span>
<a href="#l2.114"></a><span id="l2.114">     alarm.action = &quot;AUDIO&quot;;</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineminus">-    do_check_eq(alarm.action, &quot;AUDIO&quot;);</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+    equal(alarm.action, &quot;AUDIO&quot;);</span>
<a href="#l2.117"></a><span id="l2.117"> </span>
<a href="#l2.118"></a><span id="l2.118">     // No Description for ACTION:AUDIO</span>
<a href="#l2.119"></a><span id="l2.119">     alarm.description = &quot;description&quot;;</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineminus">-    do_check_eq(alarm.description, null);</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+    equal(alarm.description, null);</span>
<a href="#l2.122"></a><span id="l2.122"> </span>
<a href="#l2.123"></a><span id="l2.123">     // No Summary, for ACTION:AUDIO</span>
<a href="#l2.124"></a><span id="l2.124">     alarm.summary = &quot;summary&quot;;</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineminus">-    do_check_eq(alarm.summary, null);</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+    equal(alarm.summary, null);</span>
<a href="#l2.127"></a><span id="l2.127"> </span>
<a href="#l2.128"></a><span id="l2.128">     // No attendees allowed</span>
<a href="#l2.129"></a><span id="l2.129">     let attendee = cal.createAttendee();</span>
<a href="#l2.130"></a><span id="l2.130">     attendee.id = &quot;mailto:horst&quot;;</span>
<a href="#l2.131"></a><span id="l2.131"> </span>
<a href="#l2.132"></a><span id="l2.132">     try {</span>
<a href="#l2.133"></a><span id="l2.133">         alarm.addAttendee(attendee);</span>
<a href="#l2.134"></a><span id="l2.134">         do_throw(&quot;AUDIO alarm should not be able to save attendees&quot;);</span>
<a href="#l2.135"></a><span id="l2.135">     } catch (e) {}</span>
<a href="#l2.136"></a><span id="l2.136"> </span>
<a href="#l2.137"></a><span id="l2.137">     // No attendee yet, should not be initialized</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+    throws(function() {</span>
<a href="#l2.140"></a><span id="l2.140">         alarm.icalComponent;</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineminus">-    }, Components.results.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+    }, /Component not initialized/);</span>
<a href="#l2.143"></a><span id="l2.143"> </span>
<a href="#l2.144"></a><span id="l2.144">     // Test attachments</span>
<a href="#l2.145"></a><span id="l2.145">     let sound = cal.createAttachment();</span>
<a href="#l2.146"></a><span id="l2.146">     sound.uri = makeURL(&quot;file:///sound.wav&quot;);</span>
<a href="#l2.147"></a><span id="l2.147">     let sound2 = cal.createAttachment();</span>
<a href="#l2.148"></a><span id="l2.148">     sound2.uri = makeURL(&quot;file:///sound2.wav&quot;);</span>
<a href="#l2.149"></a><span id="l2.149"> </span>
<a href="#l2.150"></a><span id="l2.150">     // Adding an attachment should work</span>
<a href="#l2.151"></a><span id="l2.151">     alarm.addAttachment(sound);</span>
<a href="#l2.152"></a><span id="l2.152">     let addedAttachments = alarm.getAttachments({});</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineminus">-    do_check_eq(addedAttachments.length, 1);</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineminus">-    do_check_eq(addedAttachments[0], sound);</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineminus">-    do_check_true(alarm.icalString.indexOf(&quot;ATTACH:file:///sound.wav&quot;) &gt; -1);</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+    equal(addedAttachments.length, 1);</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+    equal(addedAttachments[0], sound);</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineplus">+    ok(alarm.icalString.indexOf(&quot;ATTACH:file:///sound.wav&quot;) &gt; -1);</span>
<a href="#l2.159"></a><span id="l2.159"> </span>
<a href="#l2.160"></a><span id="l2.160">     // Adding twice shouldn't change anything</span>
<a href="#l2.161"></a><span id="l2.161">     alarm.addAttachment(sound);</span>
<a href="#l2.162"></a><span id="l2.162">     addedAttachments = alarm.getAttachments({});</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineminus">-    do_check_eq(addedAttachments.length, 1);</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineminus">-    do_check_eq(addedAttachments[0], sound);</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineplus">+    equal(addedAttachments.length, 1);</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+    equal(addedAttachments[0], sound);</span>
<a href="#l2.167"></a><span id="l2.167"> </span>
<a href="#l2.168"></a><span id="l2.168">     try {</span>
<a href="#l2.169"></a><span id="l2.169">         alarm.addAttachment(sound2);</span>
<a href="#l2.170"></a><span id="l2.170">         do_throw(&quot;Adding a second alarm should fail for type AUDIO&quot;);</span>
<a href="#l2.171"></a><span id="l2.171">     } catch (e) {}</span>
<a href="#l2.172"></a><span id="l2.172"> </span>
<a href="#l2.173"></a><span id="l2.173">     // Deleting should work</span>
<a href="#l2.174"></a><span id="l2.174">     alarm.deleteAttachment(sound);</span>
<a href="#l2.175"></a><span id="l2.175">     addedAttachments = alarm.getAttachments({});</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineminus">-    do_check_eq(addedAttachments.length, 0);</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+    equal(addedAttachments.length, 0);</span>
<a href="#l2.178"></a><span id="l2.178"> </span>
<a href="#l2.179"></a><span id="l2.179">     // As well as clearing</span>
<a href="#l2.180"></a><span id="l2.180">     alarm.addAttachment(sound);</span>
<a href="#l2.181"></a><span id="l2.181">     alarm.clearAttachments();</span>
<a href="#l2.182"></a><span id="l2.182">     addedAttachments = alarm.getAttachments({});</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineminus">-    do_check_eq(addedAttachments.length, 0);</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+    equal(addedAttachments.length, 0);</span>
<a href="#l2.185"></a><span id="l2.185"> </span>
<a href="#l2.186"></a><span id="l2.186">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.187"></a><span id="l2.187"> }</span>
<a href="#l2.188"></a><span id="l2.188"> </span>
<a href="#l2.189"></a><span id="l2.189"> function test_custom_alarm() {</span>
<a href="#l2.190"></a><span id="l2.190">     dump(&quot;Testing X-SMS (custom) alarms...&quot;);</span>
<a href="#l2.191"></a><span id="l2.191">     let alarm = cal.createAlarm();</span>
<a href="#l2.192"></a><span id="l2.192">     // Set ACTION to a custom value, make sure this was not rejected</span>
<a href="#l2.193"></a><span id="l2.193">     alarm.action = &quot;X-SMS&quot;</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineminus">-    do_check_eq(alarm.action, &quot;X-SMS&quot;);</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineplus">+    equal(alarm.action, &quot;X-SMS&quot;);</span>
<a href="#l2.196"></a><span id="l2.196"> </span>
<a href="#l2.197"></a><span id="l2.197">     // There is no restriction on DESCRIPTION for custom alarms</span>
<a href="#l2.198"></a><span id="l2.198">     alarm.description = &quot;description&quot;;</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineminus">-    do_check_eq(alarm.description, &quot;description&quot;);</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+    equal(alarm.description, &quot;description&quot;);</span>
<a href="#l2.201"></a><span id="l2.201"> </span>
<a href="#l2.202"></a><span id="l2.202">     // There is no restriction on SUMMARY for custom alarms</span>
<a href="#l2.203"></a><span id="l2.203">     alarm.summary = &quot;summary&quot;;</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineminus">-    do_check_eq(alarm.summary, &quot;summary&quot;);</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+    equal(alarm.summary, &quot;summary&quot;);</span>
<a href="#l2.206"></a><span id="l2.206"> </span>
<a href="#l2.207"></a><span id="l2.207">     // Test for attendees</span>
<a href="#l2.208"></a><span id="l2.208">     let attendee1 = cal.createAttendee();</span>
<a href="#l2.209"></a><span id="l2.209">     attendee1.id = &quot;mailto:horst&quot;;</span>
<a href="#l2.210"></a><span id="l2.210">     let attendee2 = cal.createAttendee();</span>
<a href="#l2.211"></a><span id="l2.211">     attendee2.id = &quot;mailto:gustav&quot;;</span>
<a href="#l2.212"></a><span id="l2.212"> </span>
<a href="#l2.213"></a><span id="l2.213" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+    equal(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.215"></a><span id="l2.215">     alarm.addAttendee(attendee1);</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+    equal(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.218"></a><span id="l2.218">     alarm.addAttendee(attendee2);</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 2);</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineplus">+    equal(alarm.getAttendees({}).length, 2);</span>
<a href="#l2.221"></a><span id="l2.221">     alarm.addAttendee(attendee1);</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 2);</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineplus">+    equal(alarm.getAttendees({}).length, 2);</span>
<a href="#l2.224"></a><span id="l2.224"> </span>
<a href="#l2.225"></a><span id="l2.225">     alarm.deleteAttendee(attendee1);</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineplus">+    equal(alarm.getAttendees({}).length, 1);</span>
<a href="#l2.228"></a><span id="l2.228"> </span>
<a href="#l2.229"></a><span id="l2.229">     alarm.clearAttendees();</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineminus">-    do_check_eq(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineplus">+    equal(alarm.getAttendees({}).length, 0);</span>
<a href="#l2.232"></a><span id="l2.232"> </span>
<a href="#l2.233"></a><span id="l2.233">     // Test for attachments</span>
<a href="#l2.234"></a><span id="l2.234">     let attach1 = cal.createAttachment();</span>
<a href="#l2.235"></a><span id="l2.235">     attach1.uri = makeURL(&quot;file:///example.txt&quot;);</span>
<a href="#l2.236"></a><span id="l2.236">     let attach2 = cal.createAttachment();</span>
<a href="#l2.237"></a><span id="l2.237">     attach2.uri = makeURL(&quot;file:///example2.txt&quot;);</span>
<a href="#l2.238"></a><span id="l2.238"> </span>
<a href="#l2.239"></a><span id="l2.239">     alarm.addAttachment(attach1);</span>
<a href="#l2.240"></a><span id="l2.240">     alarm.addAttachment(attach2);</span>
<a href="#l2.241"></a><span id="l2.241"> </span>
<a href="#l2.242"></a><span id="l2.242">     let addedAttachments = alarm.getAttachments({});</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineminus">-    do_check_eq(addedAttachments.length, 2);</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-    do_check_eq(addedAttachments[0], attach1);</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineminus">-    do_check_eq(addedAttachments[1], attach2);</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineplus">+    equal(addedAttachments.length, 2);</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineplus">+    equal(addedAttachments[0], attach1);</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineplus">+    equal(addedAttachments[1], attach2);</span>
<a href="#l2.249"></a><span id="l2.249"> </span>
<a href="#l2.250"></a><span id="l2.250">     alarm.deleteAttachment(attach1);</span>
<a href="#l2.251"></a><span id="l2.251">     addedAttachments = alarm.getAttachments({});</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineminus">-    do_check_eq(addedAttachments.length, 1);</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineplus">+    equal(addedAttachments.length, 1);</span>
<a href="#l2.254"></a><span id="l2.254"> </span>
<a href="#l2.255"></a><span id="l2.255">     alarm.clearAttachments();</span>
<a href="#l2.256"></a><span id="l2.256">     addedAttachments = alarm.getAttachments({});</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineminus">-    do_check_eq(addedAttachments.length, 0);</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineplus">+    equal(addedAttachments.length, 0);</span>
<a href="#l2.259"></a><span id="l2.259"> }</span>
<a href="#l2.260"></a><span id="l2.260"> </span>
<a href="#l2.261"></a><span id="l2.261"> // Check if any combination of REPEAT and DURATION work as expected.</span>
<a href="#l2.262"></a><span id="l2.262"> function test_repeat() {</span>
<a href="#l2.263"></a><span id="l2.263">     dump(&quot;Testing REPEAT and DURATION properties...&quot;);</span>
<a href="#l2.264"></a><span id="l2.264">     let message;</span>
<a href="#l2.265"></a><span id="l2.265">     let alarm = cal.createAlarm();</span>
<a href="#l2.266"></a><span id="l2.266"> </span>
<a href="#l2.267"></a><span id="l2.267">     // Check initial value</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineminus">-    do_check_eq(alarm.repeat, 0);</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineminus">-    do_check_eq(alarm.repeatOffset, null);</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-    do_check_eq(alarm.repeatDate, null);</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineplus">+    equal(alarm.repeat, 0);</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineplus">+    equal(alarm.repeatOffset, null);</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineplus">+    equal(alarm.repeatDate, null);</span>
<a href="#l2.274"></a><span id="l2.274"> </span>
<a href="#l2.275"></a><span id="l2.275">     // Should not be able to get REPEAT when DURATION is not set</span>
<a href="#l2.276"></a><span id="l2.276">     alarm.repeat = 1;</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineminus">-    do_check_eq(alarm.repeat, 0);</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineplus">+    equal(alarm.repeat, 0);</span>
<a href="#l2.279"></a><span id="l2.279"> </span>
<a href="#l2.280"></a><span id="l2.280">     // Both REPEAT and DURATION should be accessible, when the two are set.</span>
<a href="#l2.281"></a><span id="l2.281">     alarm.repeatOffset = createDuration();</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineminus">-    do_check_neq(alarm.repeatOffset, null);</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-    do_check_neq(alarm.repeat, 0);</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineplus">+    notEqual(alarm.repeatOffset, null);</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineplus">+    notEqual(alarm.repeat, 0);</span>
<a href="#l2.286"></a><span id="l2.286"> </span>
<a href="#l2.287"></a><span id="l2.287">     // Should not be able to get DURATION when REPEAT is not set</span>
<a href="#l2.288"></a><span id="l2.288">     alarm.repeat = null;</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-    do_check_eq(alarm.repeatOffset, null);</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineplus">+    equal(alarm.repeatOffset, null);</span>
<a href="#l2.291"></a><span id="l2.291"> </span>
<a href="#l2.292"></a><span id="l2.292">     // Should be able to unset alarm DURATION attribute. (REPEAT already tested above)</span>
<a href="#l2.293"></a><span id="l2.293">     try {</span>
<a href="#l2.294"></a><span id="l2.294">         alarm.repeatOffset = null;</span>
<a href="#l2.295"></a><span id="l2.295">     } catch (e) {</span>
<a href="#l2.296"></a><span id="l2.296">         do_throw(&quot;Could not set repeatOffset attribute to null&quot; + e);</span>
<a href="#l2.297"></a><span id="l2.297">     }</span>
<a href="#l2.298"></a><span id="l2.298"> </span>
<a href="#l2.299"></a><span id="l2.299">     // Check unset value</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineminus">-    do_check_eq(alarm.repeat, 0);</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineminus">-    do_check_eq(alarm.repeatOffset, null);</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineplus">+    equal(alarm.repeat, 0);</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineplus">+    equal(alarm.repeatOffset, null);</span>
<a href="#l2.304"></a><span id="l2.304"> </span>
<a href="#l2.305"></a><span id="l2.305">     // Check repeatDate</span>
<a href="#l2.306"></a><span id="l2.306">     alarm = cal.createAlarm();</span>
<a href="#l2.307"></a><span id="l2.307">     alarm.related = Components.interfaces.calIAlarm.ALARM_RELATED_ABSOLUTE;</span>
<a href="#l2.308"></a><span id="l2.308">     alarm.alarmDate = cal.createDateTime();</span>
<a href="#l2.309"></a><span id="l2.309">     alarm.repeat = 1;</span>
<a href="#l2.310"></a><span id="l2.310">     alarm.repeatOffset = cal.createDuration();</span>
<a href="#l2.311"></a><span id="l2.311">     alarm.repeatOffset.inSeconds = 3600;</span>
<a href="#l2.312"></a><span id="l2.312"> </span>
<a href="#l2.313"></a><span id="l2.313">     let dt = alarm.alarmDate.clone();</span>
<a href="#l2.314"></a><span id="l2.314">     dt.second += 3600;</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineminus">-    do_check_eq(alarm.repeatDate.icalString, dt.icalString);</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineplus">+    equal(alarm.repeatDate.icalString, dt.icalString);</span>
<a href="#l2.317"></a><span id="l2.317"> </span>
<a href="#l2.318"></a><span id="l2.318">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.319"></a><span id="l2.319"> }</span>
<a href="#l2.320"></a><span id="l2.320"> </span>
<a href="#l2.321"></a><span id="l2.321"> function test_xprop() {</span>
<a href="#l2.322"></a><span id="l2.322">     dump(&quot;Testing X-Props...&quot;);</span>
<a href="#l2.323"></a><span id="l2.323">     let alarm = cal.createAlarm();</span>
<a href="#l2.324"></a><span id="l2.324">     alarm.setProperty(&quot;X-PROP&quot;, &quot;X-VALUE&quot;);</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineminus">-    do_check_true(alarm.hasProperty(&quot;X-PROP&quot;));</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineminus">-    do_check_eq(alarm.getProperty(&quot;X-PROP&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineplus">+    ok(alarm.hasProperty(&quot;X-PROP&quot;));</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineplus">+    equal(alarm.getProperty(&quot;X-PROP&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l2.329"></a><span id="l2.329">     alarm.deleteProperty(&quot;X-PROP&quot;);</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineminus">-    do_check_false(alarm.hasProperty(&quot;X-PROP&quot;));</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineminus">-    do_check_eq(alarm.getProperty(&quot;X-PROP&quot;), null);</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineplus">+    ok(!alarm.hasProperty(&quot;X-PROP&quot;));</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineplus">+    equal(alarm.getProperty(&quot;X-PROP&quot;), null);</span>
<a href="#l2.334"></a><span id="l2.334"> </span>
<a href="#l2.335"></a><span id="l2.335">     // also check X-MOZ-LASTACK prop</span>
<a href="#l2.336"></a><span id="l2.336">     let dt = cal.createDateTime();</span>
<a href="#l2.337"></a><span id="l2.337">     alarm.setProperty(&quot;X-MOZ-LASTACK&quot;, dt.icalString);</span>
<a href="#l2.338"></a><span id="l2.338">     alarm.action = &quot;DISPLAY&quot;;</span>
<a href="#l2.339"></a><span id="l2.339">     alarm.description = &quot;test&quot;;</span>
<a href="#l2.340"></a><span id="l2.340">     alarm.related = Ci.calIAlarm.ALARM_RELATED_START</span>
<a href="#l2.341"></a><span id="l2.341">     alarm.offset = createDuration(&quot;-PT5M&quot;);</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineminus">-    do_check_true(alarm.icalComponent.serializeToICS().indexOf(dt.icalString) &gt; -1);</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineplus">+    ok(alarm.icalComponent.serializeToICS().indexOf(dt.icalString) &gt; -1);</span>
<a href="#l2.344"></a><span id="l2.344"> </span>
<a href="#l2.345"></a><span id="l2.345">     alarm.deleteProperty(&quot;X-MOZ-LASTACK&quot;);</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineminus">-    do_check_false(alarm.icalComponent.serializeToICS().indexOf(dt.icalString) &gt; -1);</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineplus">+    ok(!alarm.icalComponent.serializeToICS().indexOf(dt.icalString) &gt; -1);</span>
<a href="#l2.348"></a><span id="l2.348">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.349"></a><span id="l2.349"> }</span>
<a href="#l2.350"></a><span id="l2.350"> </span>
<a href="#l2.351"></a><span id="l2.351"> function test_dates() {</span>
<a href="#l2.352"></a><span id="l2.352">     dump(&quot;Testing alarm dates...&quot;);</span>
<a href="#l2.353"></a><span id="l2.353">     let passed;</span>
<a href="#l2.354"></a><span id="l2.354">     // Initial value</span>
<a href="#l2.355"></a><span id="l2.355">     let alarm = cal.createAlarm();</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineminus">-    do_check_eq(alarm.alarmDate, null);</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineminus">-    do_check_eq(alarm.offset, null);</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineplus">+    equal(alarm.alarmDate, null);</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineplus">+    equal(alarm.offset, null);</span>
<a href="#l2.360"></a><span id="l2.360"> </span>
<a href="#l2.361"></a><span id="l2.361">     // Set an offset and check it</span>
<a href="#l2.362"></a><span id="l2.362">     alarm.related = Ci.calIAlarm.ALARM_RELATED_START</span>
<a href="#l2.363"></a><span id="l2.363">     let offset = createDuration(&quot;-PT5M&quot;);</span>
<a href="#l2.364"></a><span id="l2.364">     alarm.offset = offset;</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineminus">-    do_check_eq(alarm.alarmDate, null);</span>
<a href="#l2.366"></a><span id="l2.366" class="difflineminus">-    do_check_eq(alarm.offset, offset);</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineplus">+    equal(alarm.alarmDate, null);</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineplus">+    equal(alarm.offset, offset);</span>
<a href="#l2.369"></a><span id="l2.369">     try {</span>
<a href="#l2.370"></a><span id="l2.370">         alarm.alarmDate = createDateTime();</span>
<a href="#l2.371"></a><span id="l2.371">         passed = false;</span>
<a href="#l2.372"></a><span id="l2.372">     } catch (e) {</span>
<a href="#l2.373"></a><span id="l2.373">         passed = true;</span>
<a href="#l2.374"></a><span id="l2.374">     }</span>
<a href="#l2.375"></a><span id="l2.375">     if (!passed) {</span>
<a href="#l2.376"></a><span id="l2.376">         do_throw(&quot;Setting alarmDate when alarm is relative should not succeed&quot;);</span>
<a href="#l2.377"></a><span id="l2.377">     }</span>
<a href="#l2.378"></a><span id="l2.378"> </span>
<a href="#l2.379"></a><span id="l2.379">     // Set an absolute time and check it</span>
<a href="#l2.380"></a><span id="l2.380">     alarm.related = Ci.calIAlarm.ALARM_RELATED_ABSOLUTE;</span>
<a href="#l2.381"></a><span id="l2.381">     let alarmDate = createDate(2007, 0, 1, true, 2, 0, 0);</span>
<a href="#l2.382"></a><span id="l2.382">     alarm.alarmDate = alarmDate;</span>
<a href="#l2.383"></a><span id="l2.383" class="difflineminus">-    do_check_eq(alarm.alarmDate, alarmDate);</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineminus">-    do_check_eq(alarm.offset, null);</span>
<a href="#l2.385"></a><span id="l2.385" class="difflineplus">+    equal(alarm.alarmDate, alarmDate);</span>
<a href="#l2.386"></a><span id="l2.386" class="difflineplus">+    equal(alarm.offset, null);</span>
<a href="#l2.387"></a><span id="l2.387">     try {</span>
<a href="#l2.388"></a><span id="l2.388">         alarm.offset = createDuration();</span>
<a href="#l2.389"></a><span id="l2.389">         passed = false;</span>
<a href="#l2.390"></a><span id="l2.390">     } catch (e) {</span>
<a href="#l2.391"></a><span id="l2.391">         passed = true;</span>
<a href="#l2.392"></a><span id="l2.392">     }</span>
<a href="#l2.393"></a><span id="l2.393">     if (!passed) {</span>
<a href="#l2.394"></a><span id="l2.394">         do_throw(&quot;Setting offset when alarm is absolute should not succeed&quot;);</span>
<a href="#l2.395"></a><span id="l2.395" class="difflineat">@@ -392,43 +392,43 @@ function test_immutable() {</span>
<a href="#l2.396"></a><span id="l2.396"> </span>
<a href="#l2.397"></a><span id="l2.397">     // Set up some extra props</span>
<a href="#l2.398"></a><span id="l2.398">     alarm.setProperty(&quot;X-FOO&quot;, &quot;X-VAL&quot;);</span>
<a href="#l2.399"></a><span id="l2.399">     alarm.setProperty(&quot;X-DATEPROP&quot;, cal.createDateTime());</span>
<a href="#l2.400"></a><span id="l2.400">     alarm.addAttendee(cal.createAttendee());</span>
<a href="#l2.401"></a><span id="l2.401"> </span>
<a href="#l2.402"></a><span id="l2.402">     let passed = false;</span>
<a href="#l2.403"></a><span id="l2.403">     // Initial checks</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineminus">-    do_check_true(alarm.isMutable);</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineplus">+    ok(alarm.isMutable);</span>
<a href="#l2.406"></a><span id="l2.406">     alarm.makeImmutable();</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineminus">-    do_check_false(alarm.isMutable);</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineplus">+    ok(!alarm.isMutable);</span>
<a href="#l2.409"></a><span id="l2.409">     alarm.makeImmutable();</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineminus">-    do_check_false(alarm.isMutable);</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineplus">+    ok(!alarm.isMutable);</span>
<a href="#l2.412"></a><span id="l2.412"> </span>
<a href="#l2.413"></a><span id="l2.413">     // Check each attribute</span>
<a href="#l2.414"></a><span id="l2.414">     for (let prop in propMap) {</span>
<a href="#l2.415"></a><span id="l2.415">         try {</span>
<a href="#l2.416"></a><span id="l2.416">             alarm[prop] = propMap[prop];</span>
<a href="#l2.417"></a><span id="l2.417">         } catch (e) {</span>
<a href="#l2.418"></a><span id="l2.418" class="difflineminus">-            do_check_eq(e.result, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineplus">+            equal(e.result, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l2.420"></a><span id="l2.420">             continue;</span>
<a href="#l2.421"></a><span id="l2.421">         }</span>
<a href="#l2.422"></a><span id="l2.422">         do_throw(&quot;Attribute &quot; + prop + &quot; was writable while item was immutable&quot;);</span>
<a href="#l2.423"></a><span id="l2.423">     }</span>
<a href="#l2.424"></a><span id="l2.424"> </span>
<a href="#l2.425"></a><span id="l2.425">     // Functions</span>
<a href="#l2.426"></a><span id="l2.426" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.427"></a><span id="l2.427" class="difflineplus">+    throws(function() {</span>
<a href="#l2.428"></a><span id="l2.428">         alarm.setProperty(&quot;X-FOO&quot;, &quot;changed&quot;);</span>
<a href="#l2.429"></a><span id="l2.429" class="difflineminus">-    }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l2.430"></a><span id="l2.430" class="difflineplus">+    }, /Can not modify immutable data container/);</span>
<a href="#l2.431"></a><span id="l2.431"> </span>
<a href="#l2.432"></a><span id="l2.432" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineplus">+    throws(function() {</span>
<a href="#l2.434"></a><span id="l2.434">         alarm.deleteProperty(&quot;X-FOO&quot;);</span>
<a href="#l2.435"></a><span id="l2.435" class="difflineminus">-    }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineplus">+    }, /Can not modify immutable data container/);</span>
<a href="#l2.437"></a><span id="l2.437"> </span>
<a href="#l2.438"></a><span id="l2.438" class="difflineminus">-    do_check_false(alarm.getProperty(&quot;X-DATEPROP&quot;).isMutable);</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineplus">+    ok(!alarm.getProperty(&quot;X-DATEPROP&quot;).isMutable);</span>
<a href="#l2.440"></a><span id="l2.440"> </span>
<a href="#l2.441"></a><span id="l2.441">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.442"></a><span id="l2.442"> }</span>
<a href="#l2.443"></a><span id="l2.443"> </span>
<a href="#l2.444"></a><span id="l2.444"> function test_clone() {</span>
<a href="#l2.445"></a><span id="l2.445">     dump(&quot;Testing cloning alarms...&quot;);</span>
<a href="#l2.446"></a><span id="l2.446">     let alarm = cal.createAlarm();</span>
<a href="#l2.447"></a><span id="l2.447">     // Set up each attribute</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineat">@@ -440,72 +440,72 @@ function test_clone() {</span>
<a href="#l2.449"></a><span id="l2.449">     alarm.setProperty(&quot;X-FOO&quot;, &quot;X-VAL&quot;);</span>
<a href="#l2.450"></a><span id="l2.450">     alarm.setProperty(&quot;X-DATEPROP&quot;, cal.createDateTime());</span>
<a href="#l2.451"></a><span id="l2.451">     alarm.addAttendee(cal.createAttendee());</span>
<a href="#l2.452"></a><span id="l2.452"> </span>
<a href="#l2.453"></a><span id="l2.453">     // Make a copy</span>
<a href="#l2.454"></a><span id="l2.454">     let newAlarm = alarm.clone();</span>
<a href="#l2.455"></a><span id="l2.455">     newAlarm.makeImmutable();</span>
<a href="#l2.456"></a><span id="l2.456">     newAlarm = newAlarm.clone();</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineminus">-    do_check_true(newAlarm.isMutable);</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineplus">+    ok(newAlarm.isMutable);</span>
<a href="#l2.459"></a><span id="l2.459"> </span>
<a href="#l2.460"></a><span id="l2.460">     // Check if item is still the same</span>
<a href="#l2.461"></a><span id="l2.461">     // TODO This is not quite optimal, maybe someone can find a better way to do</span>
<a href="#l2.462"></a><span id="l2.462">     // the comparisons.</span>
<a href="#l2.463"></a><span id="l2.463">     for (let prop in propMap) {</span>
<a href="#l2.464"></a><span id="l2.464">         if (prop == &quot;item&quot;) {</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineminus">-            do_check_eq(alarm.item.icalString, newAlarm.item.icalString)</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineplus">+            equal(alarm.item.icalString, newAlarm.item.icalString)</span>
<a href="#l2.467"></a><span id="l2.467">         } else {</span>
<a href="#l2.468"></a><span id="l2.468">             if ((alarm[prop] instanceof Ci.nsISupports &amp;&amp;</span>
<a href="#l2.469"></a><span id="l2.469">                  alarm[prop].icalString != newAlarm[prop].icalString) ||</span>
<a href="#l2.470"></a><span id="l2.470">                 !(alarm[prop] instanceof Ci.nsISupports) &amp;&amp;</span>
<a href="#l2.471"></a><span id="l2.471">                   alarm[prop] != newAlarm[prop]) {</span>
<a href="#l2.472"></a><span id="l2.472">                 do_throw(prop + &quot; differs, &quot; + alarm[prop] + &quot; == &quot; + newAlarm[prop]);</span>
<a href="#l2.473"></a><span id="l2.473">             }</span>
<a href="#l2.474"></a><span id="l2.474">         }</span>
<a href="#l2.475"></a><span id="l2.475">     }</span>
<a href="#l2.476"></a><span id="l2.476"> </span>
<a href="#l2.477"></a><span id="l2.477">     // Check if changes on the cloned object do not affect the original object.</span>
<a href="#l2.478"></a><span id="l2.478">     for (let prop in clonePropMap) {</span>
<a href="#l2.479"></a><span id="l2.479">         newAlarm[prop] = clonePropMap[prop];</span>
<a href="#l2.480"></a><span id="l2.480">         dump(&quot;Checking &quot; + prop + &quot;...&quot;);</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineminus">-        do_check_neq(alarm[prop], newAlarm[prop]);</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineplus">+        notEqual(alarm[prop], newAlarm[prop]);</span>
<a href="#l2.483"></a><span id="l2.483">         dump(&quot;OK!\n&quot;);</span>
<a href="#l2.484"></a><span id="l2.484">         break;</span>
<a href="#l2.485"></a><span id="l2.485">     }</span>
<a href="#l2.486"></a><span id="l2.486"> </span>
<a href="#l2.487"></a><span id="l2.487">     // Check x props</span>
<a href="#l2.488"></a><span id="l2.488">     alarm.setProperty(&quot;X-FOO&quot;, &quot;BAR&quot;);</span>
<a href="#l2.489"></a><span id="l2.489" class="difflineminus">-    do_check_eq(alarm.getProperty(&quot;X-FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l2.490"></a><span id="l2.490" class="difflineplus">+    equal(alarm.getProperty(&quot;X-FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l2.491"></a><span id="l2.491">     let dt = alarm.getProperty(&quot;X-DATEPROP&quot;);</span>
<a href="#l2.492"></a><span id="l2.492" class="difflineminus">-    do_check_eq(dt.isMutable, true);</span>
<a href="#l2.493"></a><span id="l2.493" class="difflineplus">+    equal(dt.isMutable, true);</span>
<a href="#l2.494"></a><span id="l2.494"> </span>
<a href="#l2.495"></a><span id="l2.495">     // Test xprop params</span>
<a href="#l2.496"></a><span id="l2.496">     alarm.icalString =</span>
<a href="#l2.497"></a><span id="l2.497">         &quot;BEGIN:VALARM\n&quot; +</span>
<a href="#l2.498"></a><span id="l2.498">         &quot;ACTION:DISPLAY\n&quot; +</span>
<a href="#l2.499"></a><span id="l2.499">         &quot;TRIGGER:-PT15M\n&quot; +</span>
<a href="#l2.500"></a><span id="l2.500">         &quot;X-FOO;X-PARAM=PARAMVAL:BAR\n&quot; +</span>
<a href="#l2.501"></a><span id="l2.501">         &quot;DESCRIPTION:TEST\n&quot; +</span>
<a href="#l2.502"></a><span id="l2.502">         &quot;END:VALARM&quot;;</span>
<a href="#l2.503"></a><span id="l2.503"> </span>
<a href="#l2.504"></a><span id="l2.504">     newAlarm = alarm.clone();</span>
<a href="#l2.505"></a><span id="l2.505" class="difflineminus">-    do_check_eq(alarm.icalString, newAlarm.icalString);</span>
<a href="#l2.506"></a><span id="l2.506" class="difflineplus">+    equal(alarm.icalString, newAlarm.icalString);</span>
<a href="#l2.507"></a><span id="l2.507"> </span>
<a href="#l2.508"></a><span id="l2.508">     dump(&quot;Done\n&quot;);</span>
<a href="#l2.509"></a><span id="l2.509"> }</span>
<a href="#l2.510"></a><span id="l2.510"> </span>
<a href="#l2.511"></a><span id="l2.511"> function test_serialize() {</span>
<a href="#l2.512"></a><span id="l2.512">     // most checks done by other tests, these don't fit into categories</span>
<a href="#l2.513"></a><span id="l2.513">     let alarm = cal.createAlarm();</span>
<a href="#l2.514"></a><span id="l2.514">     let srv = cal.getIcsService();</span>
<a href="#l2.515"></a><span id="l2.515"> </span>
<a href="#l2.516"></a><span id="l2.516" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.517"></a><span id="l2.517" class="difflineplus">+    throws(function() {</span>
<a href="#l2.518"></a><span id="l2.518">         alarm.icalComponent = srv.createIcalComponent(&quot;BARF&quot;);</span>
<a href="#l2.519"></a><span id="l2.519" class="difflineminus">-    }, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l2.520"></a><span id="l2.520" class="difflineplus">+    }, /0x80070057/ , &quot;Invalid Argument&quot;);</span>
<a href="#l2.521"></a><span id="l2.521"> </span>
<a href="#l2.522"></a><span id="l2.522">     function addProp(k,v) { let p = srv.createIcalProperty(k); p.value = v; comp.addProperty(p) }</span>
<a href="#l2.523"></a><span id="l2.523">     function addActionDisplay() addProp(&quot;ACTION&quot;, &quot;DISPLAY&quot;);</span>
<a href="#l2.524"></a><span id="l2.524">     function addActionEmail() addProp(&quot;ACTION&quot;, &quot;EMAIL&quot;);</span>
<a href="#l2.525"></a><span id="l2.525">     function addTrigger() addProp(&quot;TRIGGER&quot;, &quot;-PT15M&quot;);</span>
<a href="#l2.526"></a><span id="l2.526">     function addDescr() addProp(&quot;DESCRIPTION&quot;, &quot;TEST&quot;);</span>
<a href="#l2.527"></a><span id="l2.527">     function addDuration() addProp(&quot;DURATION&quot;, &quot;-PT15M&quot;);</span>
<a href="#l2.528"></a><span id="l2.528">     function addRepeat() addProp(&quot;REPEAT&quot;, &quot;1&quot;);</span>
<a href="#l2.529"></a><span id="l2.529" class="difflineat">@@ -521,44 +521,44 @@ function test_serialize() {</span>
<a href="#l2.530"></a><span id="l2.530">     // Attachments and attendees</span>
<a href="#l2.531"></a><span id="l2.531">     comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l2.532"></a><span id="l2.532">     addActionEmail(); addTrigger(); addDescr();</span>
<a href="#l2.533"></a><span id="l2.533">     addAttendee(); addAttachment();</span>
<a href="#l2.534"></a><span id="l2.534">     alarm.icalComponent = comp;</span>
<a href="#l2.535"></a><span id="l2.535">     alarm.toString();</span>
<a href="#l2.536"></a><span id="l2.536"> </span>
<a href="#l2.537"></a><span id="l2.537">     // Missing action</span>
<a href="#l2.538"></a><span id="l2.538" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.539"></a><span id="l2.539" class="difflineplus">+    throws(function() {</span>
<a href="#l2.540"></a><span id="l2.540">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l2.541"></a><span id="l2.541">         addTrigger(); addDescr();</span>
<a href="#l2.542"></a><span id="l2.542">         alarm.icalComponent = comp;</span>
<a href="#l2.543"></a><span id="l2.543" class="difflineminus">-    }, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l2.544"></a><span id="l2.544" class="difflineplus">+    }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l2.545"></a><span id="l2.545"> </span>
<a href="#l2.546"></a><span id="l2.546">     // Missing trigger</span>
<a href="#l2.547"></a><span id="l2.547" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.548"></a><span id="l2.548" class="difflineplus">+    throws(function() {</span>
<a href="#l2.549"></a><span id="l2.549">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l2.550"></a><span id="l2.550">         addActionDisplay(); addDescr();</span>
<a href="#l2.551"></a><span id="l2.551">         alarm.icalComponent = comp;</span>
<a href="#l2.552"></a><span id="l2.552" class="difflineminus">-    }, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l2.553"></a><span id="l2.553" class="difflineplus">+    }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l2.554"></a><span id="l2.554"> </span>
<a href="#l2.555"></a><span id="l2.555">     // Missing duration with repeat</span>
<a href="#l2.556"></a><span id="l2.556" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.557"></a><span id="l2.557" class="difflineplus">+    throws(function() {</span>
<a href="#l2.558"></a><span id="l2.558">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l2.559"></a><span id="l2.559">         addActionDisplay(); addTrigger(); addDescr();</span>
<a href="#l2.560"></a><span id="l2.560">         addRepeat();</span>
<a href="#l2.561"></a><span id="l2.561">         alarm.icalComponent = comp;</span>
<a href="#l2.562"></a><span id="l2.562" class="difflineminus">-    }, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l2.563"></a><span id="l2.563" class="difflineplus">+    }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l2.564"></a><span id="l2.564"> </span>
<a href="#l2.565"></a><span id="l2.565">     // Missing repeat with duration</span>
<a href="#l2.566"></a><span id="l2.566" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l2.567"></a><span id="l2.567" class="difflineplus">+    throws(function() {</span>
<a href="#l2.568"></a><span id="l2.568">         comp = srv.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l2.569"></a><span id="l2.569">         addActionDisplay(); addTrigger(); addDescr();</span>
<a href="#l2.570"></a><span id="l2.570">         addDuration();</span>
<a href="#l2.571"></a><span id="l2.571">         alarm.icalComponent = comp;</span>
<a href="#l2.572"></a><span id="l2.572" class="difflineminus">-    }, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l2.573"></a><span id="l2.573" class="difflineplus">+    }, /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l2.574"></a><span id="l2.574"> </span>
<a href="#l2.575"></a><span id="l2.575"> }</span>
<a href="#l2.576"></a><span id="l2.576"> </span>
<a href="#l2.577"></a><span id="l2.577"> function test_strings() {</span>
<a href="#l2.578"></a><span id="l2.578">     // Serializing the string shouldn't throw, but we don't really care about</span>
<a href="#l2.579"></a><span id="l2.579">     // the string itself.</span>
<a href="#l2.580"></a><span id="l2.580">     let alarm = cal.createAlarm();</span>
<a href="#l2.581"></a><span id="l2.581">     alarm.action = &quot;DISPLAY&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/test/unit/test_alarmservice.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmservice.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l3.6"></a><span id="l3.6"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> const EXPECT_NONE = 0;</span>
<a href="#l3.9"></a><span id="l3.9"> const EXPECT_FIRED = 1;</span>
<a href="#l3.10"></a><span id="l3.10"> const EXPECT_TIMER = 2;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-function do_check_xor(a, b) do_check_true((a &amp;&amp; !b) || (!a &amp;&amp; b));</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+function do_check_xor(a, b) ok((a &amp;&amp; !b) || (!a &amp;&amp; b));</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> let alarmObserver = {</span>
<a href="#l3.16"></a><span id="l3.16">     service: null,</span>
<a href="#l3.17"></a><span id="l3.17">     firedMap: {},</span>
<a href="#l3.18"></a><span id="l3.18">     expectedMap: {},</span>
<a href="#l3.19"></a><span id="l3.19">     pendingOps: {},</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">     onAlarm: function obs_onAlarm(aItem, aAlarm) {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -106,20 +106,20 @@ function run_test() {</span>
<a href="#l3.23"></a><span id="l3.23">         }});</span>
<a href="#l3.24"></a><span id="l3.24">     }});</span>
<a href="#l3.25"></a><span id="l3.25"> }</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> function initializeAlarmService() {</span>
<a href="#l3.28"></a><span id="l3.28">     alarmObserver.service = Components.classes[&quot;@mozilla.org/calendar/alarm-service;1&quot;]</span>
<a href="#l3.29"></a><span id="l3.29">                                        .getService(Components.interfaces.calIAlarmService)</span>
<a href="#l3.30"></a><span id="l3.30">                                        .wrappedJSObject;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    do_check_false(alarmObserver.service.mStarted);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    ok(!alarmObserver.service.mStarted);</span>
<a href="#l3.33"></a><span id="l3.33"> </span>
<a href="#l3.34"></a><span id="l3.34">     alarmObserver.service.startup();</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-    do_check_true(alarmObserver.service.mStarted);</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+    ok(alarmObserver.service.mStarted);</span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38">     // we need to replace the existing observers with our observer</span>
<a href="#l3.39"></a><span id="l3.39">     for each (let obs in alarmObserver.service.mObservers.mInterfaces) {</span>
<a href="#l3.40"></a><span id="l3.40">         alarmObserver.service.removeObserver(obs);</span>
<a href="#l3.41"></a><span id="l3.41">     }</span>
<a href="#l3.42"></a><span id="l3.42">     alarmObserver.service.addObserver(alarmObserver);</span>
<a href="#l3.43"></a><span id="l3.43"> }</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45" class="difflineat">@@ -286,17 +286,17 @@ function doAcknowledgeTest(aCalendar) {</span>
<a href="#l3.46"></a><span id="l3.46"> </span>
<a href="#l3.47"></a><span id="l3.47">     // test snooze alarm</span>
<a href="#l3.48"></a><span id="l3.48">     alarmObserver.service.snoozeAlarm(item, alarm, cal.createDuration(&quot;PT1H&quot;));</span>
<a href="#l3.49"></a><span id="l3.49">     alarmObserver.expectResult(aCalendar, item, alarm, EXPECT_TIMER);</span>
<a href="#l3.50"></a><span id="l3.50">     alarmObserver.checkExpected();</span>
<a href="#l3.51"></a><span id="l3.51"> </span>
<a href="#l3.52"></a><span id="l3.52">     // the snoozed alarm timer delay should be close to an hour</span>
<a href="#l3.53"></a><span id="l3.53">     let tmr = alarmObserver.getTimer(aCalendar.id, item.hashId, alarm.icalString);</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-    do_check_true(Math.abs(tmr.delay - 3600000) &lt;= 1000);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+    ok(Math.abs(tmr.delay - 3600000) &lt;= 1000);</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57">     // test dismiss alarm</span>
<a href="#l3.58"></a><span id="l3.58">     alarmObserver.service.dismissAlarm(item2, alarm2);</span>
<a href="#l3.59"></a><span id="l3.59">     alarmObserver.expectResult(aCalendar, item2, alarm2, EXPECT_NONE);</span>
<a href="#l3.60"></a><span id="l3.60">     alarmObserver.checkExpected();</span>
<a href="#l3.61"></a><span id="l3.61"> }</span>
<a href="#l3.62"></a><span id="l3.62"> </span>
<a href="#l3.63"></a><span id="l3.63"> function doRunTest(aOnCalendarCreated, aOnAlarmsLoaded) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/test/unit/test_attachment.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/test/unit/test_attachment.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -13,98 +13,98 @@ function run_test() {</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> function test_hashes() {</span>
<a href="#l4.6"></a><span id="l4.6">     let attach = cal.createAttachment();</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">     attach.rawData = &quot;hello&quot;;</span>
<a href="#l4.9"></a><span id="l4.9">     let hash1 = attach.hashId;</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">     attach.rawData = &quot;world&quot;;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    do_check_neq(hash1, attach.hashId);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    notEqual(hash1, attach.hashId);</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">     attach.rawData = &quot;hello&quot;;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-    do_check_eq(hash1, attach.hashId);</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+    equal(hash1, attach.hashId);</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">     // Setting raw data should give us a BINARY attachment</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-    do_check_eq(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+    equal(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">     attach.uri = makeURL(&quot;http://hello&quot;);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">     // Setting an uri should delete the value parameter</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-    do_check_eq(attach.getParameter(&quot;VALUE&quot;), null);</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+    equal(attach.getParameter(&quot;VALUE&quot;), null);</span>
<a href="#l4.28"></a><span id="l4.28"> }</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30"> function test_uriattach() {</span>
<a href="#l4.31"></a><span id="l4.31">     let attach = cal.createAttachment();</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33">     // Attempt to set a property and check its values</span>
<a href="#l4.34"></a><span id="l4.34">     let e = cal.createEvent();</span>
<a href="#l4.35"></a><span id="l4.35">     e.icalString = &quot;BEGIN:VEVENT\r\n&quot; +</span>
<a href="#l4.36"></a><span id="l4.36">                    &quot;ATTACH;FMTTYPE=x-moz/test:http://hello\r\n&quot; +</span>
<a href="#l4.37"></a><span id="l4.37">                    &quot;END:VEVENT&quot;;</span>
<a href="#l4.38"></a><span id="l4.38">     let prop = e.icalComponent.getFirstProperty(&quot;ATTACH&quot;);</span>
<a href="#l4.39"></a><span id="l4.39">     attach.icalProperty = prop;</span>
<a href="#l4.40"></a><span id="l4.40"> </span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-    do_check_neq(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-    do_check_eq(attach.formatType, &quot;x-moz/test&quot;);</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-    do_check_eq(attach.getParameter(&quot;FMTTYPE&quot;), &quot;x-moz/test&quot;);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-    do_check_eq(attach.uri.spec, makeURL(&quot;http://hello&quot;).spec);</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-    do_check_eq(attach.rawData, &quot;http://hello&quot;);</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+    notEqual(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+    equal(attach.formatType, &quot;x-moz/test&quot;);</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineplus">+    equal(attach.getParameter(&quot;FMTTYPE&quot;), &quot;x-moz/test&quot;);</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+    equal(attach.uri.spec, makeURL(&quot;http://hello&quot;).spec);</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+    equal(attach.rawData, &quot;http://hello&quot;);</span>
<a href="#l4.51"></a><span id="l4.51"> }</span>
<a href="#l4.52"></a><span id="l4.52"> </span>
<a href="#l4.53"></a><span id="l4.53"> function test_binaryattach() {</span>
<a href="#l4.54"></a><span id="l4.54">     let attach = cal.createAttachment();</span>
<a href="#l4.55"></a><span id="l4.55">     let e = cal.createEvent();</span>
<a href="#l4.56"></a><span id="l4.56"> </span>
<a href="#l4.57"></a><span id="l4.57">     let attachString =</span>
<a href="#l4.58"></a><span id="l4.58">         &quot;ATTACH;ENCODING=BASE64;FMTTYPE=x-moz/test2;VALUE=BINARY:aHR0cDovL2hlbGxvMg==\r\n&quot;;</span>
<a href="#l4.59"></a><span id="l4.59">     let icalString =</span>
<a href="#l4.60"></a><span id="l4.60">         &quot;BEGIN:VEVENT\r\n&quot; +</span>
<a href="#l4.61"></a><span id="l4.61">         attachString +</span>
<a href="#l4.62"></a><span id="l4.62">         &quot;END:VEVENT&quot;;</span>
<a href="#l4.63"></a><span id="l4.63">     e.icalString = icalString;</span>
<a href="#l4.64"></a><span id="l4.64">     let prop = e.icalComponent.getFirstProperty(&quot;ATTACH&quot;);</span>
<a href="#l4.65"></a><span id="l4.65">     attach.icalProperty = prop;</span>
<a href="#l4.66"></a><span id="l4.66"> </span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-    do_check_eq(attach.formatType, &quot;x-moz/test2&quot;);</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-    do_check_eq(attach.getParameter(&quot;FMTTYPE&quot;), &quot;x-moz/test2&quot;);</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-    do_check_eq(attach.encoding, &quot;BASE64&quot;);</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-    do_check_eq(attach.getParameter(&quot;ENCODING&quot;), &quot;BASE64&quot;);</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-    do_check_eq(attach.uri, null);</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-    do_check_eq(attach.rawData, &quot;aHR0cDovL2hlbGxvMg==&quot;);</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-    do_check_eq(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+    equal(attach.formatType, &quot;x-moz/test2&quot;);</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+    equal(attach.getParameter(&quot;FMTTYPE&quot;), &quot;x-moz/test2&quot;);</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+    equal(attach.encoding, &quot;BASE64&quot;);</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+    equal(attach.getParameter(&quot;ENCODING&quot;), &quot;BASE64&quot;);</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+    equal(attach.uri, null);</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+    equal(attach.rawData, &quot;aHR0cDovL2hlbGxvMg==&quot;);</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+    equal(attach.getParameter(&quot;VALUE&quot;), &quot;BINARY&quot;);</span>
<a href="#l4.81"></a><span id="l4.81"> </span>
<a href="#l4.82"></a><span id="l4.82">     let propIcalString = attach.icalProperty.icalString;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-    do_check_true(!!propIcalString.match(/ENCODING=BASE64/));</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-    do_check_true(!!propIcalString.match(/FMTTYPE=x-moz\/test2/));</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-    do_check_true(!!propIcalString.match(/VALUE=BINARY/));</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineminus">-    do_check_true(!!propIcalString.replace(&quot;\r\n &quot;, &quot;&quot;).match(/:aHR0cDovL2hlbGxvMg==/));</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+    ok(!!propIcalString.match(/ENCODING=BASE64/));</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+    ok(!!propIcalString.match(/FMTTYPE=x-moz\/test2/));</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+    ok(!!propIcalString.match(/VALUE=BINARY/));</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+    ok(!!propIcalString.replace(&quot;\r\n &quot;, &quot;&quot;).match(/:aHR0cDovL2hlbGxvMg==/));</span>
<a href="#l4.91"></a><span id="l4.91"> </span>
<a href="#l4.92"></a><span id="l4.92">     propIcalString = attach.clone().icalProperty.icalString;</span>
<a href="#l4.93"></a><span id="l4.93"> </span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-    do_check_true(!!propIcalString.match(/ENCODING=BASE64/));</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-    do_check_true(!!propIcalString.match(/FMTTYPE=x-moz\/test2/));</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineminus">-    do_check_true(!!propIcalString.match(/VALUE=BINARY/));</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineminus">-    do_check_true(!!propIcalString.replace(&quot;\r\n &quot;, &quot;&quot;).match(/:aHR0cDovL2hlbGxvMg==/));</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+    ok(!!propIcalString.match(/ENCODING=BASE64/));</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+    ok(!!propIcalString.match(/FMTTYPE=x-moz\/test2/));</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+    ok(!!propIcalString.match(/VALUE=BINARY/));</span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+    ok(!!propIcalString.replace(&quot;\r\n &quot;, &quot;&quot;).match(/:aHR0cDovL2hlbGxvMg==/));</span>
<a href="#l4.102"></a><span id="l4.102"> }</span>
<a href="#l4.103"></a><span id="l4.103"> </span>
<a href="#l4.104"></a><span id="l4.104"> function test_serialize() {</span>
<a href="#l4.105"></a><span id="l4.105">     let attach = cal.createAttachment();</span>
<a href="#l4.106"></a><span id="l4.106">     attach.formatType = &quot;x-moz/test2&quot;;</span>
<a href="#l4.107"></a><span id="l4.107">     attach.uri = Services.io.newURI(&quot;data:text/plain,&quot;, null, null);</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-    do_check_eq(attach.icalString, &quot;ATTACH;FMTTYPE=x-moz/test2:data:text/plain,\r\n&quot;);</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+    equal(attach.icalString, &quot;ATTACH;FMTTYPE=x-moz/test2:data:text/plain,\r\n&quot;);</span>
<a href="#l4.110"></a><span id="l4.110"> </span>
<a href="#l4.111"></a><span id="l4.111">     attach = cal.createAttachment();</span>
<a href="#l4.112"></a><span id="l4.112">     attach.encoding = &quot;BASE64&quot;;</span>
<a href="#l4.113"></a><span id="l4.113">     attach.uri = Services.io.newURI(&quot;data:text/plain,&quot;, null, null);</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-    do_check_eq(attach.icalString, &quot;ATTACH;ENCODING=BASE64:data:text/plain,\r\n&quot;);</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+    equal(attach.icalString, &quot;ATTACH;ENCODING=BASE64:data:text/plain,\r\n&quot;);</span>
<a href="#l4.116"></a><span id="l4.116"> </span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+    throws(function() {</span>
<a href="#l4.119"></a><span id="l4.119">         attach.icalString = &quot;X-STICKER:smiley&quot;;</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">-    }, Components.results.NS_ERROR_ILLEGAL_VALUE);</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+    }, /Illegal value/);</span>
<a href="#l4.122"></a><span id="l4.122"> </span>
<a href="#l4.123"></a><span id="l4.123">     attach = cal.createAttachment();</span>
<a href="#l4.124"></a><span id="l4.124">     attach.uri = Services.io.newURI(&quot;data:text/plain,&quot;, null, null);</span>
<a href="#l4.125"></a><span id="l4.125">     attach.setParameter(&quot;X-PROP&quot;, &quot;VAL&quot;);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-    do_check_eq(attach.icalString, &quot;ATTACH;X-PROP=VAL:data:text/plain,\r\n&quot;);</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+    equal(attach.icalString, &quot;ATTACH;X-PROP=VAL:data:text/plain,\r\n&quot;);</span>
<a href="#l4.128"></a><span id="l4.128">     attach.setParameter(&quot;X-PROP&quot;, null);</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-    do_check_eq(attach.icalString, &quot;ATTACH:data:text/plain,\r\n&quot;);</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+    equal(attach.icalString, &quot;ATTACH:data:text/plain,\r\n&quot;);</span>
<a href="#l4.131"></a><span id="l4.131"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/test/unit/test_attendee.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/test/unit/test_attendee.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -10,61 +10,61 @@ function run_test() {</span>
<a href="#l5.4"></a><span id="l5.4">     test_properties();</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> function test_values() {</span>
<a href="#l5.8"></a><span id="l5.8">     function findAttendeesInResults(event, expectedAttendees) {</span>
<a href="#l5.9"></a><span id="l5.9">         let countObj = {};</span>
<a href="#l5.10"></a><span id="l5.10">         // Getting all attendees</span>
<a href="#l5.11"></a><span id="l5.11">         let allAttendees = event.getAttendees(countObj);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-        do_check_eq(countObj.value, allAttendees.length);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+        equal(countObj.value, allAttendees.length);</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-        do_check_eq(allAttendees.length, expectedAttendees.length);</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+        equal(allAttendees.length, expectedAttendees.length);</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">         // Check if all expected attendees are found</span>
<a href="#l5.19"></a><span id="l5.19">         for (let i = 0; i &lt; expectedAttendees.length; i++) {</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-            do_check_neq(allAttendees.indexOf(expectedAttendees[i]), -1);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+            notEqual(allAttendees.indexOf(expectedAttendees[i]), -1);</span>
<a href="#l5.22"></a><span id="l5.22">         }</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">         // Check if all found attendees are expected</span>
<a href="#l5.25"></a><span id="l5.25">         for (let i = 0; i &lt; allAttendees.length; i++) {</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-            do_check_neq(expectedAttendees.indexOf(allAttendees[i]), -1);</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+            notEqual(expectedAttendees.indexOf(allAttendees[i]), -1);</span>
<a href="#l5.28"></a><span id="l5.28">         }</span>
<a href="#l5.29"></a><span id="l5.29">     }</span>
<a href="#l5.30"></a><span id="l5.30">     function findById(event, id, a) {</span>
<a href="#l5.31"></a><span id="l5.31">         let foundAttendee = event.getAttendeeById(id);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-        do_check_eq(foundAttendee, a);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+        equal(foundAttendee, a);</span>
<a href="#l5.34"></a><span id="l5.34">     }</span>
<a href="#l5.35"></a><span id="l5.35">     function testImmutability(a, properties) {</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-        do_check_false(a.isMutable);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+         ok(!a.isMutable);</span>
<a href="#l5.38"></a><span id="l5.38">         // Check if setting a property throws. It should.</span>
<a href="#l5.39"></a><span id="l5.39">         for (let i = 0; i &lt; properties.length; i++) {</span>
<a href="#l5.40"></a><span id="l5.40">             let old = a[properties[i]];</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-            do_check_throws(function() {</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+            throws(function() {</span>
<a href="#l5.43"></a><span id="l5.43">                 a[properties[i]] = old + 1;</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-            }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+            }, /Can not modify immutable data container/);</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-            do_check_eq(a[properties[i]], old);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+            equal(a[properties[i]], old);</span>
<a href="#l5.49"></a><span id="l5.49">         }</span>
<a href="#l5.50"></a><span id="l5.50">     }</span>
<a href="#l5.51"></a><span id="l5.51"> </span>
<a href="#l5.52"></a><span id="l5.52">     const cIA = Components.interfaces.calIAttendee;</span>
<a href="#l5.53"></a><span id="l5.53"> </span>
<a href="#l5.54"></a><span id="l5.54">     // Create Attendee</span>
<a href="#l5.55"></a><span id="l5.55">     var a1 = cal.createAttendee();</span>
<a href="#l5.56"></a><span id="l5.56">     // Testing attendee set/get.</span>
<a href="#l5.57"></a><span id="l5.57">     var properties = [&quot;id&quot;, &quot;commonName&quot;, &quot;rsvp&quot;, &quot;role&quot;, &quot;participationStatus&quot;,</span>
<a href="#l5.58"></a><span id="l5.58">                       &quot;userType&quot;];</span>
<a href="#l5.59"></a><span id="l5.59">     var values = [&quot;myid&quot;, &quot;mycn&quot;, &quot;TRUE&quot;, &quot;CHAIR&quot;, &quot;DECLINED&quot;, &quot;RESOURCE&quot;];</span>
<a href="#l5.60"></a><span id="l5.60">     // Make sure test is valid</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-    do_check_eq(properties.length, values.length);</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+    equal(properties.length, values.length);</span>
<a href="#l5.63"></a><span id="l5.63"> </span>
<a href="#l5.64"></a><span id="l5.64">     for (var i = 0; i &lt; properties.length; i++) {</span>
<a href="#l5.65"></a><span id="l5.65">         a1[properties[i]] = values[i];</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-        do_check_eq(a1[properties[i]], values[i]);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+        equal(a1[properties[i]], values[i]);</span>
<a href="#l5.68"></a><span id="l5.68">     }</span>
<a href="#l5.69"></a><span id="l5.69"> </span>
<a href="#l5.70"></a><span id="l5.70">     // Create event</span>
<a href="#l5.71"></a><span id="l5.71">     var event = cal.createEvent();</span>
<a href="#l5.72"></a><span id="l5.72"> </span>
<a href="#l5.73"></a><span id="l5.73">     // Add attendee to event</span>
<a href="#l5.74"></a><span id="l5.74">     event.addAttendee(a1);</span>
<a href="#l5.75"></a><span id="l5.75"> </span>
<a href="#l5.76"></a><span id="l5.76" class="difflineat">@@ -85,101 +85,101 @@ function test_values() {</span>
<a href="#l5.77"></a><span id="l5.77">     // Testing cascaded immutability (event -&gt; attendee)</span>
<a href="#l5.78"></a><span id="l5.78">     event.makeImmutable();</span>
<a href="#l5.79"></a><span id="l5.79">     testImmutability(a2, properties);</span>
<a href="#l5.80"></a><span id="l5.80"> </span>
<a href="#l5.81"></a><span id="l5.81">     // Testing cloning</span>
<a href="#l5.82"></a><span id="l5.82">     var ec = event.clone();</span>
<a href="#l5.83"></a><span id="l5.83">     var clonedatts = ec.getAttendees({});</span>
<a href="#l5.84"></a><span id="l5.84">     var atts = event.getAttendees({});</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-    do_check_eq(atts.length, clonedatts.length)</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+    equal(atts.length, clonedatts.length)</span>
<a href="#l5.87"></a><span id="l5.87"> </span>
<a href="#l5.88"></a><span id="l5.88">     for (i = 0; i &lt; clonedatts.length; i++) {</span>
<a href="#l5.89"></a><span id="l5.89">         // The attributes should not be equal</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-        do_check_neq(atts[i], clonedatts[i]);</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+        notEqual(atts[i], clonedatts[i]);</span>
<a href="#l5.92"></a><span id="l5.92">         // But the ids should</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-        do_check_eq(atts[i].id, clonedatts[i].id)</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+        equal(atts[i].id, clonedatts[i].id)</span>
<a href="#l5.95"></a><span id="l5.95">     }</span>
<a href="#l5.96"></a><span id="l5.96"> </span>
<a href="#l5.97"></a><span id="l5.97">     // Make sure organizers are also cloned correctly</span>
<a href="#l5.98"></a><span id="l5.98">     let a3 = cal.createAttendee();</span>
<a href="#l5.99"></a><span id="l5.99">     a3.id = &quot;horst&quot;;</span>
<a href="#l5.100"></a><span id="l5.100">     a3.isOrganizer = true;</span>
<a href="#l5.101"></a><span id="l5.101">     let a4 = a3.clone();</span>
<a href="#l5.102"></a><span id="l5.102"> </span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-    do_check_true(a4.isOrganizer)</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineplus">+    ok(a4.isOrganizer)</span>
<a href="#l5.105"></a><span id="l5.105">     a3.isOrganizer = false;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-    do_check_true(a4.isOrganizer)</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineplus">+    ok(a4.isOrganizer)</span>
<a href="#l5.108"></a><span id="l5.108"> }</span>
<a href="#l5.109"></a><span id="l5.109"> </span>
<a href="#l5.110"></a><span id="l5.110"> function test_serialize() {</span>
<a href="#l5.111"></a><span id="l5.111">     let a = cal.createAttendee();</span>
<a href="#l5.112"></a><span id="l5.112"> </span>
<a href="#l5.113"></a><span id="l5.113" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+    throws(function() {</span>
<a href="#l5.115"></a><span id="l5.115">         a.icalProperty;</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-    }, Components.results.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+    }, /Component not initialized/);</span>
<a href="#l5.118"></a><span id="l5.118"> </span>
<a href="#l5.119"></a><span id="l5.119">     a.id = &quot;horst&quot;;</span>
<a href="#l5.120"></a><span id="l5.120">     a.commonName = &quot;Horst&quot;;</span>
<a href="#l5.121"></a><span id="l5.121">     a.rsvp = &quot;TRUE&quot;;</span>
<a href="#l5.122"></a><span id="l5.122"> </span>
<a href="#l5.123"></a><span id="l5.123">     a.isOrganizer = false;</span>
<a href="#l5.124"></a><span id="l5.124"> </span>
<a href="#l5.125"></a><span id="l5.125">     a.role = &quot;CHAIR&quot;;</span>
<a href="#l5.126"></a><span id="l5.126">     a.participationStatus = &quot;DECLINED&quot;;</span>
<a href="#l5.127"></a><span id="l5.127">     a.userType = &quot;RESOURCE&quot;;</span>
<a href="#l5.128"></a><span id="l5.128"> </span>
<a href="#l5.129"></a><span id="l5.129">     a.setProperty(&quot;X-NAME&quot;, &quot;X-VALUE&quot;);</span>
<a href="#l5.130"></a><span id="l5.130"> </span>
<a href="#l5.131"></a><span id="l5.131">     let prop = a.icalProperty;</span>
<a href="#l5.132"></a><span id="l5.132">     dump(prop.icalString);</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-    do_check_eq(prop.value, &quot;horst&quot;);</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-    do_check_eq(prop.propertyName, &quot;ATTENDEE&quot;);</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;CN&quot;), &quot;Horst&quot;);</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;RSVP&quot;), &quot;TRUE&quot;);</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;ROLE&quot;), &quot;CHAIR&quot;);</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;PARTSTAT&quot;), &quot;DECLINED&quot;);</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;CUTYPE&quot;), &quot;RESOURCE&quot;);</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;X-NAME&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+    equal(prop.value, &quot;horst&quot;);</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+    equal(prop.propertyName, &quot;ATTENDEE&quot;);</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+    equal(prop.getParameter(&quot;CN&quot;), &quot;Horst&quot;);</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+    equal(prop.getParameter(&quot;RSVP&quot;), &quot;TRUE&quot;);</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+    equal(prop.getParameter(&quot;ROLE&quot;), &quot;CHAIR&quot;);</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+    equal(prop.getParameter(&quot;PARTSTAT&quot;), &quot;DECLINED&quot;);</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+    equal(prop.getParameter(&quot;CUTYPE&quot;), &quot;RESOURCE&quot;);</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+    equal(prop.getParameter(&quot;X-NAME&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l5.149"></a><span id="l5.149"> </span>
<a href="#l5.150"></a><span id="l5.150">     a.isOrganizer = true;</span>
<a href="#l5.151"></a><span id="l5.151">     prop = a.icalProperty;</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineminus">-    do_check_eq(prop.value, &quot;horst&quot;);</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineminus">-    do_check_eq(prop.propertyName, &quot;ORGANIZER&quot;);</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;CN&quot;), &quot;Horst&quot;);</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;RSVP&quot;), &quot;TRUE&quot;);</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;ROLE&quot;), &quot;CHAIR&quot;);</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;PARTSTAT&quot;), &quot;DECLINED&quot;);</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;CUTYPE&quot;), &quot;RESOURCE&quot;);</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;X-NAME&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+    equal(prop.value, &quot;horst&quot;);</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+    equal(prop.propertyName, &quot;ORGANIZER&quot;);</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+    equal(prop.getParameter(&quot;CN&quot;), &quot;Horst&quot;);</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+    equal(prop.getParameter(&quot;RSVP&quot;), &quot;TRUE&quot;);</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+    equal(prop.getParameter(&quot;ROLE&quot;), &quot;CHAIR&quot;);</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+    equal(prop.getParameter(&quot;PARTSTAT&quot;), &quot;DECLINED&quot;);</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+    equal(prop.getParameter(&quot;CUTYPE&quot;), &quot;RESOURCE&quot;);</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+    equal(prop.getParameter(&quot;X-NAME&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l5.168"></a><span id="l5.168"> </span>
<a href="#l5.169"></a><span id="l5.169"> }</span>
<a href="#l5.170"></a><span id="l5.170"> </span>
<a href="#l5.171"></a><span id="l5.171"> function test_properties() {</span>
<a href="#l5.172"></a><span id="l5.172">     let a = cal.createAttendee();</span>
<a href="#l5.173"></a><span id="l5.173"> </span>
<a href="#l5.174"></a><span id="l5.174" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+    throws(function() {</span>
<a href="#l5.176"></a><span id="l5.176">         a.icalProperty;</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineminus">-    }, Components.results.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineplus">+    }, /Component not initialized/);</span>
<a href="#l5.179"></a><span id="l5.179"> </span>
<a href="#l5.180"></a><span id="l5.180">     a.id = &quot;horst&quot;;</span>
<a href="#l5.181"></a><span id="l5.181">     a.commonName = &quot;Horst&quot;;</span>
<a href="#l5.182"></a><span id="l5.182">     a.rsvp = &quot;TRUE&quot;;</span>
<a href="#l5.183"></a><span id="l5.183"> </span>
<a href="#l5.184"></a><span id="l5.184">     a.isOrganizer = false;</span>
<a href="#l5.185"></a><span id="l5.185"> </span>
<a href="#l5.186"></a><span id="l5.186">     a.role = &quot;CHAIR&quot;;</span>
<a href="#l5.187"></a><span id="l5.187">     a.participationStatus = &quot;DECLINED&quot;;</span>
<a href="#l5.188"></a><span id="l5.188">     a.userType = &quot;RESOURCE&quot;;</span>
<a href="#l5.189"></a><span id="l5.189"> </span>
<a href="#l5.190"></a><span id="l5.190">     // Only X-Props should show up in the enumerator</span>
<a href="#l5.191"></a><span id="l5.191">     a.setProperty(&quot;X-NAME&quot;, &quot;X-VALUE&quot;);</span>
<a href="#l5.192"></a><span id="l5.192">     for (let x in fixIterator(a.propertyEnumerator, Components.interfaces.nsIProperty)) {</span>
<a href="#l5.193"></a><span id="l5.193" class="difflineminus">-        do_check_eq(x.name, &quot;X-NAME&quot;);</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineminus">-        do_check_eq(x.value, &quot;X-VALUE&quot;);</span>
<a href="#l5.195"></a><span id="l5.195" class="difflineplus">+        equal(x.name, &quot;X-NAME&quot;);</span>
<a href="#l5.196"></a><span id="l5.196" class="difflineplus">+        equal(x.value, &quot;X-VALUE&quot;);</span>
<a href="#l5.197"></a><span id="l5.197">     }</span>
<a href="#l5.198"></a><span id="l5.198"> </span>
<a href="#l5.199"></a><span id="l5.199">     a.deleteProperty(&quot;X-NAME&quot;);</span>
<a href="#l5.200"></a><span id="l5.200">     for (let x in fixIterator(a.propertyEnumerator, Components.interfaces.nsIProperty)) {</span>
<a href="#l5.201"></a><span id="l5.201">         do_throw(&quot;Unexpected property &quot; + x.name + &quot; = &quot; + x.value);</span>
<a href="#l5.202"></a><span id="l5.202">     }</span>
<a href="#l5.203"></a><span id="l5.203"> </span>
<a href="#l5.204"></a><span id="l5.204">     a.setProperty(&quot;X-NAME&quot;, &quot;X-VALUE&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/test/unit/test_bug272411.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/test/unit/test_bug272411.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -6,10 +6,10 @@ function run_test() {</span>
<a href="#l6.4"></a><span id="l6.4">     let jsd = new Date();</span>
<a href="#l6.5"></a><span id="l6.5">     let cdt = cal.jsDateToDateTime(jsd);</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">     let cdtTime = cal.dateTimeToJsDate(cdt).getTime() / 1000;</span>
<a href="#l6.8"></a><span id="l6.8">     let jsdTime = Math.floor(jsd.getTime() / 1000);</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">     // calIDateTime is only accurate to the second, milliseconds need to be</span>
<a href="#l6.11"></a><span id="l6.11">     // stripped.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    do_check_eq(cdtTime, jsdTime);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    equal(cdtTime, jsdTime);</span>
<a href="#l6.14"></a><span id="l6.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/test/unit/test_bug343792.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/test/unit/test_bug343792.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -49,14 +49,14 @@ function run_test() {</span>
<a href="#l7.4"></a><span id="l7.4">         &quot;END:VCALENDAR&quot;;</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6">     let event = createEventFromIcalString(icalString);</span>
<a href="#l7.7"></a><span id="l7.7">     let start = createDate(2009, 4, 1);</span>
<a href="#l7.8"></a><span id="l7.8">     let end   = createDate(2009, 4, 30);</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10">     // the following call caused a never ending loop:</span>
<a href="#l7.11"></a><span id="l7.11">     let occurrenceDates = event.recurrenceInfo.getOccurrenceDates(start, end, 0, {});</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    do_check_eq(occurrenceDates.length, 4);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    equal(occurrenceDates.length, 4);</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">     // the following call caused a never ending loop:</span>
<a href="#l7.16"></a><span id="l7.16">     let occurrences = event.recurrenceInfo.getOccurrences(start, end, 0, {});</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-    do_check_eq(occurrences.length, 4);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+    equal(occurrences.length, 4);</span>
<a href="#l7.19"></a><span id="l7.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/test/unit/test_bug350845.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/test/unit/test_bug350845.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -5,43 +5,43 @@</span>
<a href="#l8.4"></a><span id="l8.4"> function run_test() {</span>
<a href="#l8.5"></a><span id="l8.5">     let event = createEventFromIcalString(</span>
<a href="#l8.6"></a><span id="l8.6">         &quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l8.7"></a><span id="l8.7">         &quot;UID:182d2719-fe2a-44c1-9210-0286b16c0538\n&quot; +</span>
<a href="#l8.8"></a><span id="l8.8">         &quot;X-FOO;X-BAR=BAZ:QUUX\n&quot; +</span>
<a href="#l8.9"></a><span id="l8.9">         &quot;END:VEVENT&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">     // Test getters for imported event</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    do_check_eq(event.getProperty(&quot;X-FOO&quot;), &quot;QUUX&quot;);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-    do_check_true(event.hasProperty(&quot;X-FOO&quot;));</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-    do_check_eq(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;BAZ&quot;);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-    do_check_true(event.hasPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;));</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+    equal(event.getProperty(&quot;X-FOO&quot;), &quot;QUUX&quot;);</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+    ok(event.hasProperty(&quot;X-FOO&quot;));</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+    equal(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;BAZ&quot;);</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+    ok(event.hasPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;));</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">     // Test setters</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+    throws(function() {</span>
<a href="#l8.24"></a><span id="l8.24">       event.setPropertyParameter(&quot;X-UNKNOWN&quot;, &quot;UNKNOWN&quot;, &quot;VALUE&quot;);</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-    }, Components.results.NS_ERROR_XPC_JS_THREW_STRING);</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+    }, /Property X-UNKNOWN not set/);</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">     // More setters</span>
<a href="#l8.29"></a><span id="l8.29">     event.setPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;, &quot;FNORD&quot;);</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-    do_check_eq(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;FNORD&quot;);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-    do_check_neq(event.icalString.match(/^X-FOO;X-BAR=FNORD:QUUX$/m), null);</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    equal(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), &quot;FNORD&quot;);</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+    notEqual(event.icalString.match(/^X-FOO;X-BAR=FNORD:QUUX$/m), null);</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35">     // Enumerator</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+    throws(function() {</span>
<a href="#l8.38"></a><span id="l8.38">       event.getParameterEnumerator(&quot;X-UNKNOWN&quot;);</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-    }, Components.results.NS_ERROR_XPC_JS_THREW_STRING);</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+    }, /Property X-UNKNOWN not set/);</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42">     // More enumerator</span>
<a href="#l8.43"></a><span id="l8.43">     let enume = event.getParameterEnumerator(&quot;X-FOO&quot;);</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-    do_check_true(enume.hasMoreElements());</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+    ok(enume.hasMoreElements());</span>
<a href="#l8.46"></a><span id="l8.46">     let xbar = enume.getNext().QueryInterface(Components.interfaces.nsIProperty);</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    do_check_eq(xbar.name, &quot;X-BAR&quot;);</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    do_check_eq(xbar.value, &quot;FNORD&quot;);</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-    do_check_false(enume.hasMoreElements());</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+    equal(xbar.name, &quot;X-BAR&quot;);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+    equal(xbar.value, &quot;FNORD&quot;);</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+    ok(!enume.hasMoreElements());</span>
<a href="#l8.53"></a><span id="l8.53"> </span>
<a href="#l8.54"></a><span id="l8.54">     // Deletion of parameters when deleting properties</span>
<a href="#l8.55"></a><span id="l8.55">     event.deleteProperty(&quot;X-FOO&quot;);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-    do_check_false(event.hasProperty(&quot;X-FOO&quot;));</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    ok(!event.hasProperty(&quot;X-FOO&quot;));</span>
<a href="#l8.58"></a><span id="l8.58">     event.setProperty(&quot;X-FOO&quot;, &quot;SNORK&quot;);</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-    do_check_eq(event.getProperty(&quot;X-FOO&quot;), &quot;SNORK&quot;);</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-    do_check_eq(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), null);</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+    equal(event.getProperty(&quot;X-FOO&quot;), &quot;SNORK&quot;);</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+    equal(event.getPropertyParameter(&quot;X-FOO&quot;, &quot;X-BAR&quot;), null);</span>
<a href="#l8.63"></a><span id="l8.63"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/test/unit/test_bug356207.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/test/unit/test_bug356207.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -30,14 +30,14 @@ function run_test() {</span>
<a href="#l9.4"></a><span id="l9.4">         &quot;END:VCALENDAR&quot;;</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">     let event = createEventFromIcalString(icalString);</span>
<a href="#l9.7"></a><span id="l9.7">     let start = createDate(2009,  0,  1);</span>
<a href="#l9.8"></a><span id="l9.8">     let end   = createDate(2009, 11, 31);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">     // the following call caused a never ending loop:</span>
<a href="#l9.11"></a><span id="l9.11">     let occurrenceDates = event.recurrenceInfo.getOccurrenceDates(start, end, 0, {});</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    do_check_eq(occurrenceDates.length, 2);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    equal(occurrenceDates.length, 2);</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">     // the following call caused a never ending loop:</span>
<a href="#l9.16"></a><span id="l9.16">     let occurrences = event.recurrenceInfo.getOccurrences(start, end, 0, {});</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-    do_check_eq(occurrences.length, 2);</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+    equal(occurrences.length, 2);</span>
<a href="#l9.19"></a><span id="l9.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/test/unit/test_bug485571.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/test/unit/test_bug485571.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -60,20 +60,20 @@ function run_test() {</span>
<a href="#l10.4"></a><span id="l10.4">                    &quot;TRIGGER;VALUE=DATE-TIME:20090430T080000Z\n&quot; +</span>
<a href="#l10.5"></a><span id="l10.5">                    &quot;DESCRIPTION:TEST\n&quot; +</span>
<a href="#l10.6"></a><span id="l10.6">                    &quot;END:VALARM&quot;);</span>
<a href="#l10.7"></a><span id="l10.7"> }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> function check_relative(aIcalString, aRelated) {</span>
<a href="#l10.10"></a><span id="l10.10">     let alarm = cal.createAlarm();</span>
<a href="#l10.11"></a><span id="l10.11">     alarm.icalString = aIcalString;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    do_check_eq(alarm.related, aRelated);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-    do_check_eq(alarm.alarmDate, null);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-    do_check_neq(alarm.offset, null);</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+    equal(alarm.related, aRelated);</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+    equal(alarm.alarmDate, null);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+    notEqual(alarm.offset, null);</span>
<a href="#l10.18"></a><span id="l10.18"> }</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> function check_absolute(aIcalString) {</span>
<a href="#l10.21"></a><span id="l10.21">     let alarm = cal.createAlarm();</span>
<a href="#l10.22"></a><span id="l10.22">     alarm.icalString = aIcalString;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-    do_check_eq(alarm.related, Ci.calIAlarm.ALARM_RELATED_ABSOLUTE);</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-    do_check_neq(alarm.alarmDate, null);</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">-    do_check_eq(alarm.offset, null);</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+    equal(alarm.related, Ci.calIAlarm.ALARM_RELATED_ABSOLUTE);</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+    notEqual(alarm.alarmDate, null);</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+    equal(alarm.offset, null);</span>
<a href="#l10.29"></a><span id="l10.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/test/unit/test_bug494140.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/test/unit/test_bug494140.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -24,37 +24,37 @@ function run_test() {</span>
<a href="#l11.4"></a><span id="l11.4">                                          &quot;BEGIN:VALARM\r\n&quot; +</span>
<a href="#l11.5"></a><span id="l11.5">                                          &quot;ACTION:DISPLAY\r\n&quot; +</span>
<a href="#l11.6"></a><span id="l11.6">                                          &quot;TRIGGER;VALUE=DURATION:-PT10M\r\n&quot; +</span>
<a href="#l11.7"></a><span id="l11.7">                                          &quot;DESCRIPTION:Mozilla Alarm: Test\r\n&quot; +</span>
<a href="#l11.8"></a><span id="l11.8">                                          &quot;END:VALARM\r\n&quot; +</span>
<a href="#l11.9"></a><span id="l11.9">                                          &quot;END:VEVENT&quot;);</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">     // There should be one alarm, one relation and one attachment</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    do_check_eq(item.getAlarms({}).length, 1);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    do_check_eq(item.getRelations({}).length, 1);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-    do_check_eq(item.getAttachments({}).length, 1);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+    equal(item.getAlarms({}).length, 1);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+    equal(item.getRelations({}).length, 1);</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+    equal(item.getAttachments({}).length, 1);</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19">     // Change the occurrence to another day</span>
<a href="#l11.20"></a><span id="l11.20">     let occ = item.recurrenceInfo.getOccurrenceFor(cal.createDateTime(&quot;20090604T073000Z&quot;));</span>
<a href="#l11.21"></a><span id="l11.21">     occ.startDate = cal.createDateTime(&quot;20090618T073000Z&quot;);</span>
<a href="#l11.22"></a><span id="l11.22">     item.recurrenceInfo.modifyException(occ, true);</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">     // There should still be one alarm, one relation and one attachment</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-    do_check_eq(item.getAlarms({}).length, 1);</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-    do_check_eq(item.getRelations({}).length, 1);</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">-    do_check_eq(item.getAttachments({}).length, 1);</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+    equal(item.getAlarms({}).length, 1);</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+    equal(item.getRelations({}).length, 1);</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+    equal(item.getAttachments({}).length, 1);</span>
<a href="#l11.31"></a><span id="l11.31"> </span>
<a href="#l11.32"></a><span id="l11.32">     // Add the item to the storage calendar and retrieve it again</span>
<a href="#l11.33"></a><span id="l11.33">     storageCal.adoptItem(item, null);</span>
<a href="#l11.34"></a><span id="l11.34">     let retrievedItem;</span>
<a href="#l11.35"></a><span id="l11.35">     storageCal.getItem(&quot;c1a6cfe7-7fbb-4bfb-a00d-861e07c649a5&quot;, {</span>
<a href="#l11.36"></a><span id="l11.36">         onGetResult: function onGetResult(cal, stat, type, detail, count, items) {</span>
<a href="#l11.37"></a><span id="l11.37">             retrievedItem = items[0];</span>
<a href="#l11.38"></a><span id="l11.38">         },</span>
<a href="#l11.39"></a><span id="l11.39">         onOperationComplete: function() {}</span>
<a href="#l11.40"></a><span id="l11.40">     });</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42">     // There should still be one alarm, one relation and one attachment</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-    do_check_eq(item.getAlarms({}).length, 1);</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-    do_check_eq(item.getRelations({}).length, 1);</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-    do_check_eq(item.getAttachments({}).length, 1);</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+    equal(item.getAlarms({}).length, 1);</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+    equal(item.getRelations({}).length, 1);</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+    equal(item.getAttachments({}).length, 1);</span>
<a href="#l11.49"></a><span id="l11.49"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/test/unit/test_bug523860.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/test/unit/test_bug523860.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -6,10 +6,10 @@ Components.utils.import(&quot;resource://cale</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> function run_test() {</span>
<a href="#l12.6"></a><span id="l12.6">     // In bug 523860, we found out that in the spec doublequotes should not be</span>
<a href="#l12.7"></a><span id="l12.7">     // escaped.</span>
<a href="#l12.8"></a><span id="l12.8">     let prop = cal.getIcsService().createIcalProperty(&quot;DESCRIPTION&quot;);</span>
<a href="#l12.9"></a><span id="l12.9">     let expected = &quot;A String with \&quot;quotes\&quot; and 'other quotes'&quot;;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">     prop.value = expected;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    do_check_eq(prop.icalString, &quot;DESCRIPTION:&quot; + expected + &quot;\r\n&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    equal(prop.icalString, &quot;DESCRIPTION:&quot; + expected + &quot;\r\n&quot;);</span>
<a href="#l12.14"></a><span id="l12.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/test/unit/test_bug653924.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/test/unit/test_bug653924.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -2,12 +2,12 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.5"></a><span id="l13.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> function run_test() {</span>
<a href="#l13.8"></a><span id="l13.8">     let evt = cal.createEvent();</span>
<a href="#l13.9"></a><span id="l13.9">     let rel = cal.createRelation();</span>
<a href="#l13.10"></a><span id="l13.10">     evt.addRelation(rel);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    do_check_eq(1, evt.icalString.match(/RELATED-TO/g).length);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    equal(1, evt.icalString.match(/RELATED-TO/g).length);</span>
<a href="#l13.14"></a><span id="l13.14">     evt.icalString = evt.icalString;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-    do_check_eq(1, evt.icalString.match(/RELATED-TO/g).length);</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+    equal(1, evt.icalString.match(/RELATED-TO/g).length);</span>
<a href="#l13.17"></a><span id="l13.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/test/unit/test_bug668222.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/test/unit/test_bug668222.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -3,20 +3,20 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> function run_test() {</span>
<a href="#l14.7"></a><span id="l14.7">     let attendee = cal.createAttendee();</span>
<a href="#l14.8"></a><span id="l14.8">     attendee.id = &quot;mailto:somebody&quot;;</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">     // Set the property and make sure its there</span>
<a href="#l14.11"></a><span id="l14.11">     attendee.setProperty(&quot;SCHEDULE-AGENT&quot;, &quot;CLIENT&quot;);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    do_check_eq(attendee.getProperty(&quot;SCHEDULE-AGENT&quot;), &quot;CLIENT&quot;);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+    equal(attendee.getProperty(&quot;SCHEDULE-AGENT&quot;), &quot;CLIENT&quot;);</span>
<a href="#l14.14"></a><span id="l14.14"> </span>
<a href="#l14.15"></a><span id="l14.15">     // Reserialize the property, this has caused the property to go away</span>
<a href="#l14.16"></a><span id="l14.16">     // in the past.</span>
<a href="#l14.17"></a><span id="l14.17">     attendee.icalProperty = attendee.icalProperty;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-    do_check_eq(attendee.getProperty(&quot;SCHEDULE-AGENT&quot;), &quot;CLIENT&quot;);</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+    equal(attendee.getProperty(&quot;SCHEDULE-AGENT&quot;), &quot;CLIENT&quot;);</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">     // Also make sure there are no promoted properties set. This does not</span>
<a href="#l14.22"></a><span id="l14.22">     // technically belong to this bug, but I almost caused this error while</span>
<a href="#l14.23"></a><span id="l14.23">     // writing the patch.</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-    do_check_true(attendee.icalProperty.icalString.indexOf(&quot;RSVP&quot;) &lt; 0);</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+    ok(attendee.icalProperty.icalString.indexOf(&quot;RSVP&quot;) &lt; 0);</span>
<a href="#l14.26"></a><span id="l14.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/test/unit/test_bug759324.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/test/unit/test_bug759324.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -27,47 +27,47 @@ function run_test() {</span>
<a href="#l15.4"></a><span id="l15.4">     do_test_pending();</span>
<a href="#l15.5"></a><span id="l15.5">     storage.addItem(item, { onOperationComplete: checkAddedItem });</span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7">     function checkAddedItem(c, s, o, i, addedItem) {</span>
<a href="#l15.8"></a><span id="l15.8"> </span>
<a href="#l15.9"></a><span id="l15.9">         let seq = addedItem.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l15.10"></a><span id="l15.10">         let rec = addedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        do_check_eq(seq, 3);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-        do_check_eq(rec.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+        equal(seq, 3);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+        equal(rec.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17">         let changedItem = addedItem.clone();</span>
<a href="#l15.18"></a><span id="l15.18">         changedItem.setProperty(&quot;SEQUENCE&quot;, parseInt(seq, 10) + 1);</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20">         storage.modifyItem(changedItem, addedItem, { onOperationComplete: checkModifiedItem });</span>
<a href="#l15.21"></a><span id="l15.21">     }</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23">     function checkModifiedItem(c, s, o, i, changedItem) {</span>
<a href="#l15.24"></a><span id="l15.24">         let seq = changedItem.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l15.25"></a><span id="l15.25">         let rec = changedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-        do_check_eq(seq, 4);</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-        do_check_eq(rec.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+        equal(seq, 4);</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+        equal(rec.getProperty(&quot;SEQUENCE&quot;), seq);</span>
<a href="#l15.31"></a><span id="l15.31"> </span>
<a href="#l15.32"></a><span id="l15.32">         // Now check with the pref off</span>
<a href="#l15.33"></a><span id="l15.33">         storage.deleteProperty(&quot;capabilities.propagate-sequence&quot;);</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35">         let changedItem2 = changedItem.clone();</span>
<a href="#l15.36"></a><span id="l15.36">         changedItem2.setProperty(&quot;SEQUENCE&quot;, parseInt(seq, 10) + 1);</span>
<a href="#l15.37"></a><span id="l15.37"> </span>
<a href="#l15.38"></a><span id="l15.38">         storage.modifyItem(changedItem2, changedItem, { onOperationComplete: checkNormalItem });</span>
<a href="#l15.39"></a><span id="l15.39"> </span>
<a href="#l15.40"></a><span id="l15.40">     }</span>
<a href="#l15.41"></a><span id="l15.41"> </span>
<a href="#l15.42"></a><span id="l15.42">     function checkNormalItem(c, s, o, i, changedItem) {</span>
<a href="#l15.43"></a><span id="l15.43">         let seq = changedItem.getProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l15.44"></a><span id="l15.44">         let rec = changedItem.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l15.45"></a><span id="l15.45"> </span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-        do_check_eq(seq, 5);</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-        do_check_eq(rec.getProperty(&quot;SEQUENCE&quot;), 4);</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+        equal(seq, 5);</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+        equal(rec.getProperty(&quot;SEQUENCE&quot;), 4);</span>
<a href="#l15.50"></a><span id="l15.50">         completeTest();</span>
<a href="#l15.51"></a><span id="l15.51">     }</span>
<a href="#l15.52"></a><span id="l15.52"> </span>
<a href="#l15.53"></a><span id="l15.53">     function completeTest() {</span>
<a href="#l15.54"></a><span id="l15.54">         do_test_finished();</span>
<a href="#l15.55"></a><span id="l15.55">     }</span>
<a href="#l15.56"></a><span id="l15.56"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/unit/test_calmgr.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/unit/test_calmgr.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -17,22 +17,22 @@ function run_test() {</span>
<a href="#l16.4"></a><span id="l16.4">     add_test(test_calprefs);</span>
<a href="#l16.5"></a><span id="l16.5">     cal.getCalendarManager().startup({ onResult: function() {</span>
<a href="#l16.6"></a><span id="l16.6">         run_next_test();</span>
<a href="#l16.7"></a><span id="l16.7">     }});</span>
<a href="#l16.8"></a><span id="l16.8"> }</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10"> function test_calobserver() {</span>
<a href="#l16.11"></a><span id="l16.11">     function checkCounters(add, modify, del, alladd, allmodify, alldel) {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        do_check_eq(calcounter.addItem, add);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-        do_check_eq(calcounter.modifyItem, modify);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-        do_check_eq(calcounter.deleteItem, del);</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-        do_check_eq(allcounter.addItem, alladd === undefined ? add : alladd);</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-        do_check_eq(allcounter.modifyItem, allmodify === undefined ? modify : allmodify);</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-        do_check_eq(allcounter.deleteItem, alldel === undefined ? del : alldel);</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+        equal(calcounter.addItem, add);</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+        equal(calcounter.modifyItem, modify);</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+        equal(calcounter.deleteItem, del);</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+        equal(allcounter.addItem, alladd === undefined ? add : alladd);</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+        equal(allcounter.modifyItem, allmodify === undefined ? modify : allmodify);</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+        equal(allcounter.deleteItem, alldel === undefined ? del : alldel);</span>
<a href="#l16.24"></a><span id="l16.24">         resetCounters();</span>
<a href="#l16.25"></a><span id="l16.25">     }</span>
<a href="#l16.26"></a><span id="l16.26">     function resetCounters() {</span>
<a href="#l16.27"></a><span id="l16.27">         calcounter = { addItem: 0, modifyItem: 0, deleteItem: 0 };</span>
<a href="#l16.28"></a><span id="l16.28">         allcounter = { addItem: 0, modifyItem: 0, deleteItem: 0 };</span>
<a href="#l16.29"></a><span id="l16.29">     }</span>
<a href="#l16.30"></a><span id="l16.30"> </span>
<a href="#l16.31"></a><span id="l16.31">     // First of all we need a local calendar to work on and some variables</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineat">@@ -98,24 +98,24 @@ function test_calobserver() {</span>
<a href="#l16.33"></a><span id="l16.33">     checkCounters(0, 0, 0);</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35">     // We are done now, start the next test</span>
<a href="#l16.36"></a><span id="l16.36">     run_next_test();</span>
<a href="#l16.37"></a><span id="l16.37"> }</span>
<a href="#l16.38"></a><span id="l16.38"> </span>
<a href="#l16.39"></a><span id="l16.39"> function test_registration() {</span>
<a href="#l16.40"></a><span id="l16.40">     function checkCalendarCount(net, rdonly, all) {</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineminus">-        do_check_eq(calmgr.networkCalendarCount, net);</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-        do_check_eq(calmgr.readOnlyCalendarCount , rdonly);</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-        do_check_eq(calmgr.calendarCount, all);</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+        equal(calmgr.networkCalendarCount, net);</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+        equal(calmgr.readOnlyCalendarCount , rdonly);</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+        equal(calmgr.calendarCount, all);</span>
<a href="#l16.47"></a><span id="l16.47">     }</span>
<a href="#l16.48"></a><span id="l16.48">     function checkRegistration(reg, unreg, del) {</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-        do_check_eq(registered, reg);</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-        do_check_eq(unregistered, unreg);</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-        do_check_eq(deleted, del);</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+        equal(registered, reg);</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+        equal(unregistered, unreg);</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+        equal(deleted, del);</span>
<a href="#l16.55"></a><span id="l16.55">         registered = false;</span>
<a href="#l16.56"></a><span id="l16.56">         unregistered = false;</span>
<a href="#l16.57"></a><span id="l16.57">         deleted = false;</span>
<a href="#l16.58"></a><span id="l16.58">     }</span>
<a href="#l16.59"></a><span id="l16.59"> </span>
<a href="#l16.60"></a><span id="l16.60">     // Initially there should be no calendars</span>
<a href="#l16.61"></a><span id="l16.61">     let calmgr = cal.getCalendarManager();</span>
<a href="#l16.62"></a><span id="l16.62">     checkCalendarCount(0, 0, 0);</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineat">@@ -134,65 +134,65 @@ function test_registration() {</span>
<a href="#l16.64"></a><span id="l16.64">             if (aCalendar.id == memory.id) unregistered = true;</span>
<a href="#l16.65"></a><span id="l16.65">         },</span>
<a href="#l16.66"></a><span id="l16.66">         onCalendarDeleting: function onCalendarDeleting(aCalendar) {</span>
<a href="#l16.67"></a><span id="l16.67">             if (aCalendar.id == memory.id) deleted = true;</span>
<a href="#l16.68"></a><span id="l16.68">         }</span>
<a href="#l16.69"></a><span id="l16.69">     });</span>
<a href="#l16.70"></a><span id="l16.70">     let calobs = cal.createAdapter(Components.interfaces.calIObserver, {</span>
<a href="#l16.71"></a><span id="l16.71">         onPropertyChanged: function onPropertyChanging(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineminus">-            do_check_eq(aCalendar.id, memory.id);</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineminus">-            do_check_eq(aName, &quot;readOnly&quot;);</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+            equal(aCalendar.id, memory.id);</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+            equal(aName, &quot;readOnly&quot;);</span>
<a href="#l16.76"></a><span id="l16.76">             readOnly = aValue;</span>
<a href="#l16.77"></a><span id="l16.77">         }</span>
<a href="#l16.78"></a><span id="l16.78">     });</span>
<a href="#l16.79"></a><span id="l16.79">     memory.addObserver(calobs);</span>
<a href="#l16.80"></a><span id="l16.80">     calmgr.addObserver(mgrobs);</span>
<a href="#l16.81"></a><span id="l16.81"> </span>
<a href="#l16.82"></a><span id="l16.82">     // Register the calendar and check if its counted and observed</span>
<a href="#l16.83"></a><span id="l16.83">     calmgr.registerCalendar(memory);</span>
<a href="#l16.84"></a><span id="l16.84">     checkRegistration(true, false, false);</span>
<a href="#l16.85"></a><span id="l16.85">     checkCalendarCount(0, 0, 1);</span>
<a href="#l16.86"></a><span id="l16.86"> </span>
<a href="#l16.87"></a><span id="l16.87">     // The calendar should now have an id</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineminus">-    do_check_neq(memory.id, null);</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+    notEqual(memory.id, null);</span>
<a href="#l16.90"></a><span id="l16.90"> </span>
<a href="#l16.91"></a><span id="l16.91">     // And be in the list of calendars</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineminus">-    do_check_true(memory == calmgr.getCalendarById(memory.id));</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineminus">-    do_check_true(calmgr.getCalendars({}).some(function(x) x.id == memory.id));</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+    equal(memory, calmgr.getCalendarById(memory.id));</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+    ok(calmgr.getCalendars({}).some(function(x) x.id == memory.id));</span>
<a href="#l16.96"></a><span id="l16.96"> </span>
<a href="#l16.97"></a><span id="l16.97">     // Make it readonly and check if the observer caught it</span>
<a href="#l16.98"></a><span id="l16.98">     memory.setProperty(&quot;readOnly&quot;, true);</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineminus">-    do_check_eq(readOnly, true);</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+    equal(readOnly, true);</span>
<a href="#l16.101"></a><span id="l16.101"> </span>
<a href="#l16.102"></a><span id="l16.102">     // Now unregister it</span>
<a href="#l16.103"></a><span id="l16.103">     calmgr.unregisterCalendar(memory);</span>
<a href="#l16.104"></a><span id="l16.104">     checkRegistration(false, true, false);</span>
<a href="#l16.105"></a><span id="l16.105">     checkCalendarCount(0, 0, 0);</span>
<a href="#l16.106"></a><span id="l16.106"> </span>
<a href="#l16.107"></a><span id="l16.107">     // The calendar shouldn't be in the list of ids</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineminus">-    do_check_eq(calmgr.getCalendarById(memory.id), null);</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineminus">-    do_check_true(calmgr.getCalendars({}).every(function(x) x.id != memory.id));</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+    equal(calmgr.getCalendarById(memory.id), null);</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineplus">+    ok(calmgr.getCalendars({}).every(function(x) x.id != memory.id));</span>
<a href="#l16.112"></a><span id="l16.112"> </span>
<a href="#l16.113"></a><span id="l16.113">     // And finally delete it</span>
<a href="#l16.114"></a><span id="l16.114">     calmgr.deleteCalendar(memory);</span>
<a href="#l16.115"></a><span id="l16.115">     checkRegistration(false, false, true);</span>
<a href="#l16.116"></a><span id="l16.116">     checkCalendarCount(0, 0, 0);</span>
<a href="#l16.117"></a><span id="l16.117"> </span>
<a href="#l16.118"></a><span id="l16.118">     // Now remove the observer again</span>
<a href="#l16.119"></a><span id="l16.119">     calmgr.removeObserver(mgrobs);</span>
<a href="#l16.120"></a><span id="l16.120">     memory.removeObserver(calobs);</span>
<a href="#l16.121"></a><span id="l16.121"> </span>
<a href="#l16.122"></a><span id="l16.122">     // Check if removing it actually worked</span>
<a href="#l16.123"></a><span id="l16.123">     calmgr.registerCalendar(memory);</span>
<a href="#l16.124"></a><span id="l16.124">     calmgr.unregisterCalendar(memory);</span>
<a href="#l16.125"></a><span id="l16.125">     calmgr.deleteCalendar(memory);</span>
<a href="#l16.126"></a><span id="l16.126">     memory.setProperty(&quot;readOnly&quot;, false);</span>
<a href="#l16.127"></a><span id="l16.127">     checkRegistration(false, false, false);</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineminus">-    do_check_eq(readOnly, true);</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineplus">+    equal(readOnly, true);</span>
<a href="#l16.130"></a><span id="l16.130">     checkCalendarCount(0, 0, 0);</span>
<a href="#l16.131"></a><span id="l16.131"> </span>
<a href="#l16.132"></a><span id="l16.132">     // We are done now, start the next test</span>
<a href="#l16.133"></a><span id="l16.133">     run_next_test();</span>
<a href="#l16.134"></a><span id="l16.134"> }</span>
<a href="#l16.135"></a><span id="l16.135"> </span>
<a href="#l16.136"></a><span id="l16.136"> function test_calprefs() {</span>
<a href="#l16.137"></a><span id="l16.137">     let prop;</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineat">@@ -210,49 +210,49 @@ function test_calprefs() {</span>
<a href="#l16.139"></a><span id="l16.139"> </span>
<a href="#l16.140"></a><span id="l16.140">     // Before checking the value, reinitialize the memory calendar with the</span>
<a href="#l16.141"></a><span id="l16.141">     // same id to make sure the pref value isn't just cached</span>
<a href="#l16.142"></a><span id="l16.142">     memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-memory-calendar://&quot;, null, null));</span>
<a href="#l16.143"></a><span id="l16.143">     memory.id = memid;</span>
<a href="#l16.144"></a><span id="l16.144"> </span>
<a href="#l16.145"></a><span id="l16.145">     // First test the standard types</span>
<a href="#l16.146"></a><span id="l16.146">     prop = memory.getProperty(&quot;stringpref&quot;);</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineminus">-    do_check_eq(typeof prop, &quot;string&quot;);</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineminus">-    do_check_eq(prop, &quot;abc&quot;)</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineplus">+    equal(typeof prop, &quot;string&quot;);</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineplus">+    equal(prop, &quot;abc&quot;)</span>
<a href="#l16.151"></a><span id="l16.151"> </span>
<a href="#l16.152"></a><span id="l16.152">     prop = memory.getProperty(&quot;boolpref&quot;);</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineminus">-    do_check_eq(typeof prop, &quot;boolean&quot;);</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineminus">-    do_check_eq(prop, true);</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineplus">+    equal(typeof prop, &quot;boolean&quot;);</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineplus">+    equal(prop, true);</span>
<a href="#l16.157"></a><span id="l16.157"> </span>
<a href="#l16.158"></a><span id="l16.158">     prop = memory.getProperty(&quot;intpref&quot;);</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineminus">-    do_check_eq(typeof prop, &quot;number&quot;);</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineminus">-    do_check_eq(prop, 123);</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineplus">+    equal(typeof prop, &quot;number&quot;);</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineplus">+    equal(prop, 123);</span>
<a href="#l16.163"></a><span id="l16.163"> </span>
<a href="#l16.164"></a><span id="l16.164">     // These two are a special case test for bug 979262</span>
<a href="#l16.165"></a><span id="l16.165">     prop = memory.getProperty(&quot;bigintpref&quot;);</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineminus">-    do_check_eq(typeof prop, &quot;number&quot;);</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineminus">-    do_check_eq(prop, 1394548721296);</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+    equal(typeof prop, &quot;number&quot;);</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineplus">+    equal(prop, 1394548721296);</span>
<a href="#l16.170"></a><span id="l16.170"> </span>
<a href="#l16.171"></a><span id="l16.171">     prop = memory.getProperty(&quot;floatpref&quot;);</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineminus">-    do_check_eq(typeof prop, &quot;number&quot;);</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineminus">-    do_check_eq(prop, 0.5);</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineplus">+    equal(typeof prop, &quot;number&quot;);</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineplus">+    equal(prop, 0.5);</span>
<a href="#l16.176"></a><span id="l16.176"> </span>
<a href="#l16.177"></a><span id="l16.177">     // Check if changing pref types works. We need to reset the calendar again</span>
<a href="#l16.178"></a><span id="l16.178">     // because retrieving the value just cached it again.</span>
<a href="#l16.179"></a><span id="l16.179">     memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-memory-calendar://&quot;, null, null));</span>
<a href="#l16.180"></a><span id="l16.180">     memory.id = memid;</span>
<a href="#l16.181"></a><span id="l16.181"> </span>
<a href="#l16.182"></a><span id="l16.182">     calmgr.setCalendarPref_(memory, &quot;boolpref&quot;, &quot;kinda true&quot;);</span>
<a href="#l16.183"></a><span id="l16.183">     prop = memory.getProperty(&quot;boolpref&quot;);</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineminus">-    do_check_eq(typeof prop, &quot;string&quot;);</span>
<a href="#l16.185"></a><span id="l16.185" class="difflineminus">-    do_check_eq(prop, &quot;kinda true&quot;)</span>
<a href="#l16.186"></a><span id="l16.186" class="difflineplus">+    equal(typeof prop, &quot;string&quot;);</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineplus">+    equal(prop, &quot;kinda true&quot;)</span>
<a href="#l16.188"></a><span id="l16.188"> </span>
<a href="#l16.189"></a><span id="l16.189">     // Check if unsetting a pref works</span>
<a href="#l16.190"></a><span id="l16.190">     memory.setProperty(&quot;intpref&quot;, null);</span>
<a href="#l16.191"></a><span id="l16.191">     memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-memory-calendar://&quot;, null, null));</span>
<a href="#l16.192"></a><span id="l16.192">     memory.id = memid;</span>
<a href="#l16.193"></a><span id="l16.193">     prop = memory.getProperty(&quot;intpref&quot;);</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineminus">-    do_check_true(prop === null);</span>
<a href="#l16.195"></a><span id="l16.195" class="difflineplus">+    ok(prop === null);</span>
<a href="#l16.196"></a><span id="l16.196"> </span>
<a href="#l16.197"></a><span id="l16.197"> </span>
<a href="#l16.198"></a><span id="l16.198">     // We are done now, start the next test</span>
<a href="#l16.199"></a><span id="l16.199">     run_next_test();</span>
<a href="#l16.200"></a><span id="l16.200"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/unit/test_datetime.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/unit/test_datetime.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -17,91 +17,91 @@ function really_run_test() {</span>
<a href="#l17.4"></a><span id="l17.4">         return cal.getTimezoneService().getTimezone(tzid);</span>
<a href="#l17.5"></a><span id="l17.5">     }</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">     let cd = cal.createDateTime();</span>
<a href="#l17.8"></a><span id="l17.8">     cd.resetTo(2005, 10, 13,</span>
<a href="#l17.9"></a><span id="l17.9">                10, 0, 0,</span>
<a href="#l17.10"></a><span id="l17.10">                getMozTimezone(&quot;/mozilla.org/20050126_1/America/Bogota&quot;));</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    do_check_eq(cd.hour, 10);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    do_check_eq(cd.icalString, &quot;20051113T100000&quot;);</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+    equal(cd.hour, 10);</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+    equal(cd.icalString, &quot;20051113T100000&quot;);</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">     let cd_floating = cd.getInTimezone(cal.floating());</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineminus">-    do_check_eq(cd_floating.hour, 10);</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+    equal(cd_floating.hour, 10);</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21"> </span>
<a href="#l17.22"></a><span id="l17.22">     let cd_utc = cd.getInTimezone(cal.UTC());</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-    do_check_eq(cd_utc.hour, 15);</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-    do_check_eq(cd_utc.icalString, &quot;20051113T150000Z&quot;);</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+    equal(cd_utc.hour, 15);</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+    equal(cd_utc.icalString, &quot;20051113T150000Z&quot;);</span>
<a href="#l17.27"></a><span id="l17.27"> </span>
<a href="#l17.28"></a><span id="l17.28">     cd.hour = 25;</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-    do_check_eq(cd.hour, 1);</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-    do_check_eq(cd.day, 14);</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+    equal(cd.hour, 1);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+    equal(cd.day, 14);</span>
<a href="#l17.33"></a><span id="l17.33"> </span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35">     // Test nativeTime on dates</span>
<a href="#l17.36"></a><span id="l17.36">     // setting .isDate to be true on a date should not change its nativeTime</span>
<a href="#l17.37"></a><span id="l17.37">     // bug 315954,</span>
<a href="#l17.38"></a><span id="l17.38">     cd.hour = 0;</span>
<a href="#l17.39"></a><span id="l17.39">     let cd_allday = cd.clone();</span>
<a href="#l17.40"></a><span id="l17.40">     cd_allday.isDate = true;</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-    do_check_eq(cd.nativeTime, cd_allday.nativeTime);</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+    equal(cd.nativeTime, cd_allday.nativeTime);</span>
<a href="#l17.43"></a><span id="l17.43"> </span>
<a href="#l17.44"></a><span id="l17.44">     // Daylight savings test</span>
<a href="#l17.45"></a><span id="l17.45">     cd.resetTo(2006, 2, 26,</span>
<a href="#l17.46"></a><span id="l17.46">                1, 0, 0,</span>
<a href="#l17.47"></a><span id="l17.47">                getMozTimezone(&quot;/mozilla.org/20050126_1/Europe/Amsterdam&quot;));</span>
<a href="#l17.48"></a><span id="l17.48"> </span>
<a href="#l17.49"></a><span id="l17.49" class="difflineminus">-    do_check_eq(cd.weekday, 0);</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-    do_check_eq(cd.timezoneOffset, 1*3600);</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+    equal(cd.weekday, 0);</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+    equal(cd.timezoneOffset, 1*3600);</span>
<a href="#l17.53"></a><span id="l17.53"> </span>
<a href="#l17.54"></a><span id="l17.54">     cd.day += 1;</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-    do_check_eq(cd.timezoneOffset, 2*3600);</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+    equal(cd.timezoneOffset, 2*3600);</span>
<a href="#l17.57"></a><span id="l17.57"> </span>
<a href="#l17.58"></a><span id="l17.58">     // Bug 398724 - Problems with floating all-day items</span>
<a href="#l17.59"></a><span id="l17.59">     let event = cal.createEvent(&quot;BEGIN:VEVENT\nUID:45674d53-229f-48c6-9f3b-f2b601e7ae4d\nSUMMARY:New Event\nDTSTART;VALUE=DATE:20071003\nDTEND;VALUE=DATE:20071004\nEND:VEVENT&quot;);</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-    do_check_true(event.startDate.timezone.isFloating);</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-    do_check_true(event.endDate.timezone.isFloating);</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+    ok(event.startDate.timezone.isFloating);</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+    ok(event.endDate.timezone.isFloating);</span>
<a href="#l17.64"></a><span id="l17.64"> </span>
<a href="#l17.65"></a><span id="l17.65">     // Bug 392853 - Same times, different timezones, but subtractDate says times are PT0S apart</span>
<a href="#l17.66"></a><span id="l17.66">     const zeroLength = cal.createDuration();</span>
<a href="#l17.67"></a><span id="l17.67">     const a = cal.jsDateToDateTime(new Date());</span>
<a href="#l17.68"></a><span id="l17.68">     a.timezone = getMozTimezone(&quot;/mozilla.org/20071231_1/Europe/Berlin&quot;);</span>
<a href="#l17.69"></a><span id="l17.69"> </span>
<a href="#l17.70"></a><span id="l17.70">     let b = a.clone();</span>
<a href="#l17.71"></a><span id="l17.71">     b.timezone = getMozTimezone(&quot;/mozilla.org/20071231_1/America/New_York&quot;);</span>
<a href="#l17.72"></a><span id="l17.72"> </span>
<a href="#l17.73"></a><span id="l17.73">     let duration = a.subtractDate(b);</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineminus">-    do_check_neq(duration.compare(zeroLength), 0);</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineminus">-    do_check_neq(a.compare(b), 0);</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+    notEqual(duration.compare(zeroLength), 0);</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+    notEqual(a.compare(b), 0);</span>
<a href="#l17.78"></a><span id="l17.78"> </span>
<a href="#l17.79"></a><span id="l17.79">     // Should lead to zero length duration</span>
<a href="#l17.80"></a><span id="l17.80">     b = a.getInTimezone(getMozTimezone(&quot;/mozilla.org/20071231_1/America/New_York&quot;));</span>
<a href="#l17.81"></a><span id="l17.81">     duration = a.subtractDate(b);</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineminus">-    do_check_eq(duration.compare(zeroLength), 0);</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineminus">-    do_check_eq(a.compare(b), 0);</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+    equal(duration.compare(zeroLength), 0);</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+    equal(a.compare(b), 0);</span>
<a href="#l17.86"></a><span id="l17.86"> </span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-    do_check_eq(b.timezone.displayName, &quot;America/New York&quot;);</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineminus">-    do_check_eq(b.timezone.latitude, &quot;+0404251&quot;);</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-    do_check_eq(b.timezone.longitude, &quot;-0740023&quot;);</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+    equal(b.timezone.displayName, &quot;America/New York&quot;);</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+    equal(b.timezone.latitude, &quot;+0404251&quot;);</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+    equal(b.timezone.longitude, &quot;-0740023&quot;);</span>
<a href="#l17.93"></a><span id="l17.93"> </span>
<a href="#l17.94"></a><span id="l17.94">     // check aliases</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineminus">-    do_check_eq(getMozTimezone(&quot;/mozilla.org/xyz/Asia/Calcutta&quot;).tzid, &quot;Asia/Kolkata&quot;);</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineminus">-    do_check_eq(getMozTimezone(&quot;Asia/Calcutta&quot;).tzid, &quot;Asia/Kolkata&quot;);</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+    equal(getMozTimezone(&quot;/mozilla.org/xyz/Asia/Calcutta&quot;).tzid, &quot;Asia/Kolkata&quot;);</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+    equal(getMozTimezone(&quot;Asia/Calcutta&quot;).tzid, &quot;Asia/Kolkata&quot;);</span>
<a href="#l17.99"></a><span id="l17.99"> </span>
<a href="#l17.100"></a><span id="l17.100">     // A newly created date should be in UTC, as should its clone</span>
<a href="#l17.101"></a><span id="l17.101">     let utc = cal.createDateTime();</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineminus">-    do_check_eq(utc.timezone.tzid, &quot;UTC&quot;);</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineminus">-    do_check_eq(utc.clone().timezone.tzid, &quot;UTC&quot;);</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-    do_check_eq(utc.timezoneOffset, 0);</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+    equal(utc.timezone.tzid, &quot;UTC&quot;);</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+    equal(utc.clone().timezone.tzid, &quot;UTC&quot;);</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+    equal(utc.timezoneOffset, 0);</span>
<a href="#l17.108"></a><span id="l17.108"> </span>
<a href="#l17.109"></a><span id="l17.109">     // Bug 794477 - setting jsdate across compartments needs to work</span>
<a href="#l17.110"></a><span id="l17.110">     let someDate = new Date();</span>
<a href="#l17.111"></a><span id="l17.111">     let createdDate = cal.jsDateToDateTime(someDate).getInTimezone(cal.calendarDefaultTimezone());</span>
<a href="#l17.112"></a><span id="l17.112">     someDate.setMilliseconds(0);</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineminus">-    do_check_eq(someDate.getTime(), cal.dateTimeToJsDate(createdDate).getTime());</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineplus">+    equal(someDate.getTime(), cal.dateTimeToJsDate(createdDate).getTime());</span>
<a href="#l17.115"></a><span id="l17.115"> </span>
<a href="#l17.116"></a><span id="l17.116">     // Comparing a date-time with a date of the same day should be 0</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineminus">-    do_check_eq(cal.createDateTime(&quot;20120101T120000&quot;).compare(cal.createDateTime(&quot;20120101&quot;)), 0);</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineminus">-    do_check_eq(cal.createDateTime(&quot;20120101&quot;).compare(cal.createDateTime(&quot;20120101T120000&quot;)), 0);</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+    equal(cal.createDateTime(&quot;20120101T120000&quot;).compare(cal.createDateTime(&quot;20120101&quot;)), 0);</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineplus">+    equal(cal.createDateTime(&quot;20120101&quot;).compare(cal.createDateTime(&quot;20120101T120000&quot;)), 0);</span>
<a href="#l17.121"></a><span id="l17.121"> }</span>
<a href="#l17.122"></a><span id="l17.122"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/unit/test_datetime_before_1970.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/unit/test_datetime_before_1970.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -4,29 +4,29 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5"> function run_test() {</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">     // Bug 769938 - dates before 1970 are not handled correctly</span>
<a href="#l18.8"></a><span id="l18.8">     // due to signed vs. unsigned mismatch in PRTime in xpconnect</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">     let dateTime1950 = cal.createDateTime();</span>
<a href="#l18.11"></a><span id="l18.11">     dateTime1950.year = 1950;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    do_check_eq(dateTime1950.year, 1950);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    equal(dateTime1950.year, 1950);</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">     let dateTime1955 = cal.jsDateToDateTime(new Date(1955, 06, 15));</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-    do_check_eq(dateTime1955.year, 1955);</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+    equal(dateTime1955.year, 1955);</span>
<a href="#l18.18"></a><span id="l18.18">     </span>
<a href="#l18.19"></a><span id="l18.19">     let dateTime1965 = cal.createDateTime();</span>
<a href="#l18.20"></a><span id="l18.20">     dateTime1965.nativeTime = -150000000000000;</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineminus">-    do_check_eq(dateTime1965.year, 1965);</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineminus">-    do_check_eq(dateTime1965.nativeTime, -150000000000000);</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+    equal(dateTime1965.year, 1965);</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+    equal(dateTime1965.nativeTime, -150000000000000);</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26">     let dateTime1990 = cal.createDateTime();</span>
<a href="#l18.27"></a><span id="l18.27">     dateTime1990.year = 1990;</span>
<a href="#l18.28"></a><span id="l18.28"> </span>
<a href="#l18.29"></a><span id="l18.29">     let dateTime2050 = cal.createDateTime();</span>
<a href="#l18.30"></a><span id="l18.30">     dateTime2050.year = 2050;</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-    do_check_true(dateTime1950.nativeTime &lt; dateTime1955.nativeTime);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineminus">-    do_check_true(dateTime1955.nativeTime &lt; dateTime1965.nativeTime);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineminus">-    do_check_true(dateTime1965.nativeTime &lt; dateTime1990.nativeTime);</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineminus">-    do_check_true(dateTime1990.nativeTime &lt; dateTime2050.nativeTime);</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+    ok(dateTime1950.nativeTime &lt; dateTime1955.nativeTime);</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+    ok(dateTime1955.nativeTime &lt; dateTime1965.nativeTime);</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+    ok(dateTime1965.nativeTime &lt; dateTime1990.nativeTime);</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+    ok(dateTime1990.nativeTime &lt; dateTime2050.nativeTime);</span>
<a href="#l18.40"></a><span id="l18.40"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/test/unit/test_deleted_items.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/test/unit/test_deleted_items.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -33,73 +33,73 @@ function check_delmgr_call(aFunc) {</span>
<a href="#l19.4"></a><span id="l19.4">     });</span>
<a href="#l19.5"></a><span id="l19.5"> }</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> add_task(function test_deleted_items() {</span>
<a href="#l19.8"></a><span id="l19.8">     let calmgr = cal.getCalendarManager();</span>
<a href="#l19.9"></a><span id="l19.9">     let delmgr = Components.classes[&quot;@mozilla.org/calendar/deleted-items-manager;1&quot;]</span>
<a href="#l19.10"></a><span id="l19.10">                            .getService(Components.interfaces.calIDeletedItems);</span>
<a href="#l19.11"></a><span id="l19.11">     // No items have been deleted, retrieving one should return null.</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(&quot;random&quot;));</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(&quot;random&quot;, &quot;random&quot;));</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+    equal(delmgr.getDeletedDate(&quot;random&quot;), null);</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+    equal(delmgr.getDeletedDate(&quot;random&quot;, &quot;random&quot;), null);</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17">     // Make sure the cache is initially flushed and that this doesn't throw an</span>
<a href="#l19.18"></a><span id="l19.18">     // error.</span>
<a href="#l19.19"></a><span id="l19.19">     yield check_delmgr_call(function() delmgr.flush());</span>
<a href="#l19.20"></a><span id="l19.20"> </span>
<a href="#l19.21"></a><span id="l19.21">     let memory = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(&quot;moz-storage-calendar://&quot;, null, null));</span>
<a href="#l19.22"></a><span id="l19.22">     calmgr.registerCalendar(memory);</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24">     let item = cal.createEvent();</span>
<a href="#l19.25"></a><span id="l19.25">     item.id = &quot;test-item-1&quot;;</span>
<a href="#l19.26"></a><span id="l19.26">     item.startDate = cal.now();</span>
<a href="#l19.27"></a><span id="l19.27">     item.endDate = cal.now();</span>
<a href="#l19.28"></a><span id="l19.28"> </span>
<a href="#l19.29"></a><span id="l19.29">     // Add the item, it still shouldn't be in the deleted database.</span>
<a href="#l19.30"></a><span id="l19.30">     yield check_delmgr_call(function() memory.addItem(item, null));</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(item.id));</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(item.id, memory.id));</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id), null);</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id, memory.id), null);</span>
<a href="#l19.35"></a><span id="l19.35"> </span>
<a href="#l19.36"></a><span id="l19.36">     // We need to stop time so we have something to compare with.</span>
<a href="#l19.37"></a><span id="l19.37">     let referenceDate = cal.createDateTime(&quot;20120726T112045&quot;); referenceDate.timezone = cal.calendarDefaultTimezone();</span>
<a href="#l19.38"></a><span id="l19.38">     let futureDate = cal.createDateTime(&quot;20380101T000000&quot;);  futureDate.timezone = cal.calendarDefaultTimezone();</span>
<a href="#l19.39"></a><span id="l19.39">     let useFutureDate = false;</span>
<a href="#l19.40"></a><span id="l19.40">     let oldNowFunction = cal.now;</span>
<a href="#l19.41"></a><span id="l19.41">     cal.now = function test_specific_now() {</span>
<a href="#l19.42"></a><span id="l19.42">         return (useFutureDate ? futureDate : referenceDate).clone();</span>
<a href="#l19.43"></a><span id="l19.43">     }</span>
<a href="#l19.44"></a><span id="l19.44"> </span>
<a href="#l19.45"></a><span id="l19.45">     // Deleting an item should trigger it being marked for deletion.</span>
<a href="#l19.46"></a><span id="l19.46">     yield check_delmgr_call(function() memory.deleteItem(item, null));</span>
<a href="#l19.47"></a><span id="l19.47"> </span>
<a href="#l19.48"></a><span id="l19.48">     // Now check if it was deleted at our reference date.</span>
<a href="#l19.49"></a><span id="l19.49">     let deltime = delmgr.getDeletedDate(item.id);</span>
<a href="#l19.50"></a><span id="l19.50" class="difflineminus">-    do_check_neq(deltime, null);</span>
<a href="#l19.51"></a><span id="l19.51" class="difflineminus">-    do_check_eq(deltime.compare(referenceDate), 0);</span>
<a href="#l19.52"></a><span id="l19.52" class="difflineplus">+    notEqual(deltime, null);</span>
<a href="#l19.53"></a><span id="l19.53" class="difflineplus">+    equal(deltime.compare(referenceDate), 0);</span>
<a href="#l19.54"></a><span id="l19.54"> </span>
<a href="#l19.55"></a><span id="l19.55">     // The same with the calendar.</span>
<a href="#l19.56"></a><span id="l19.56">     deltime = delmgr.getDeletedDate(item.id, memory.id);</span>
<a href="#l19.57"></a><span id="l19.57" class="difflineminus">-    do_check_neq(deltime, null);</span>
<a href="#l19.58"></a><span id="l19.58" class="difflineminus">-    do_check_eq(deltime.compare(referenceDate), 0);</span>
<a href="#l19.59"></a><span id="l19.59" class="difflineplus">+    notEqual(deltime, null);</span>
<a href="#l19.60"></a><span id="l19.60" class="difflineplus">+    equal(deltime.compare(referenceDate), 0);</span>
<a href="#l19.61"></a><span id="l19.61"> </span>
<a href="#l19.62"></a><span id="l19.62">     // Item should not be found in other calendars.</span>
<a href="#l19.63"></a><span id="l19.63" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(item.id, &quot;random&quot;));</span>
<a href="#l19.64"></a><span id="l19.64" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id, &quot;random&quot;), null);</span>
<a href="#l19.65"></a><span id="l19.65"> </span>
<a href="#l19.66"></a><span id="l19.66">     // Check if flushing works, we need to travel time for that.</span>
<a href="#l19.67"></a><span id="l19.67">     useFutureDate = true;</span>
<a href="#l19.68"></a><span id="l19.68">     yield check_delmgr_call(function() delmgr.flush());</span>
<a href="#l19.69"></a><span id="l19.69" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(item.id));</span>
<a href="#l19.70"></a><span id="l19.70" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(item.id, memory.id));</span>
<a href="#l19.71"></a><span id="l19.71" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id), null);</span>
<a href="#l19.72"></a><span id="l19.72" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id, memory.id), null);</span>
<a href="#l19.73"></a><span id="l19.73"> </span>
<a href="#l19.74"></a><span id="l19.74">     // Start over with our past time.</span>
<a href="#l19.75"></a><span id="l19.75">     useFutureDate = false;</span>
<a href="#l19.76"></a><span id="l19.76"> </span>
<a href="#l19.77"></a><span id="l19.77">     // Add, delete, add. Item should no longer be deleted.</span>
<a href="#l19.78"></a><span id="l19.78">     yield check_delmgr_call(function() memory.addItem(item, null));</span>
<a href="#l19.79"></a><span id="l19.79" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(item.id));</span>
<a href="#l19.80"></a><span id="l19.80" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id), null);</span>
<a href="#l19.81"></a><span id="l19.81">     yield check_delmgr_call(function() memory.deleteItem(item, null));</span>
<a href="#l19.82"></a><span id="l19.82" class="difflineminus">-    do_check_eq(delmgr.getDeletedDate(item.id).compare(referenceDate), 0);</span>
<a href="#l19.83"></a><span id="l19.83" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id).compare(referenceDate), 0);</span>
<a href="#l19.84"></a><span id="l19.84">     yield check_delmgr_call(function() memory.addItem(item, null));</span>
<a href="#l19.85"></a><span id="l19.85" class="difflineminus">-    do_check_null(delmgr.getDeletedDate(item.id));</span>
<a href="#l19.86"></a><span id="l19.86" class="difflineplus">+    equal(delmgr.getDeletedDate(item.id), null);</span>
<a href="#l19.87"></a><span id="l19.87"> </span>
<a href="#l19.88"></a><span id="l19.88">     // Revert now function, in case more tests are written.</span>
<a href="#l19.89"></a><span id="l19.89">     cal.now = oldNowFunction;</span>
<a href="#l19.90"></a><span id="l19.90"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/test/unit/test_duration.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/test/unit/test_duration.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -1,10 +1,10 @@</span>
<a href="#l20.4"></a><span id="l20.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.5"></a><span id="l20.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.6"></a><span id="l20.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8"> function run_test() {</span>
<a href="#l20.9"></a><span id="l20.9">     let a = cal.createDuration(&quot;PT1S&quot;);</span>
<a href="#l20.10"></a><span id="l20.10">     let b = cal.createDuration(&quot;PT3S&quot;);</span>
<a href="#l20.11"></a><span id="l20.11">     a.addDuration(b);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    do_check_eq(a.icalString, &quot;PT4S&quot;);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+    equal(a.icalString, &quot;PT4S&quot;);</span>
<a href="#l20.14"></a><span id="l20.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/test/unit/test_extract.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/test/unit/test_extract.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -23,191 +23,191 @@ function test_event_start_end() {</span>
<a href="#l21.4"></a><span id="l21.4">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.5"></a><span id="l21.5">     let title = &quot;Wednesday meetup&quot;;</span>
<a href="#l21.6"></a><span id="l21.6">     let content = &quot;We'll meet at 2 pm and discuss until 3 pm.&quot;;</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.9"></a><span id="l21.9">     let guessed = extractor.guessStart();</span>
<a href="#l21.10"></a><span id="l21.10">     let endGuess = extractor.guessEnd(guessed);</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-    do_check_eq(guessed.day, 3);</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-    do_check_eq(guessed.hour, 14);</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-    do_check_eq(guessed.minute, 0);</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+    equal(guessed.day, 3);</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+    equal(guessed.hour, 14);</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+    equal(guessed.minute, 0);</span>
<a href="#l21.22"></a><span id="l21.22"> </span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-    do_check_eq(endGuess.year, 2012);</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineminus">-    do_check_eq(endGuess.month, 10);</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineminus">-    do_check_eq(endGuess.day, 3);</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-    do_check_eq(endGuess.hour, 15);</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-    do_check_eq(endGuess.minute, 0);</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+    equal(endGuess.year, 2012);</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+    equal(endGuess.month, 10);</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+    equal(endGuess.day, 3);</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+    equal(endGuess.hour, 15);</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+    equal(endGuess.minute, 0);</span>
<a href="#l21.33"></a><span id="l21.33"> }</span>
<a href="#l21.34"></a><span id="l21.34"> </span>
<a href="#l21.35"></a><span id="l21.35"> function test_event_start_duration() {</span>
<a href="#l21.36"></a><span id="l21.36">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.37"></a><span id="l21.37">     let title = &quot;Wednesday meetup&quot;;</span>
<a href="#l21.38"></a><span id="l21.38">     let content = &quot;We'll meet at 2 pm and discuss for 30 minutes.&quot;;</span>
<a href="#l21.39"></a><span id="l21.39"> </span>
<a href="#l21.40"></a><span id="l21.40">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.41"></a><span id="l21.41">     let guessed = extractor.guessStart();</span>
<a href="#l21.42"></a><span id="l21.42">     let endGuess = extractor.guessEnd(guessed);</span>
<a href="#l21.43"></a><span id="l21.43"> </span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-    do_check_eq(guessed.day, 3);</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-    do_check_eq(guessed.hour, 14);</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-    do_check_eq(guessed.minute, 0);</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineplus">+    equal(guessed.day, 3);</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineplus">+    equal(guessed.hour, 14);</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+    equal(guessed.minute, 0);</span>
<a href="#l21.54"></a><span id="l21.54"> </span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-    do_check_eq(endGuess.year, 2012);</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-    do_check_eq(endGuess.month, 10);</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-    do_check_eq(endGuess.day, 3);</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineminus">-    do_check_eq(endGuess.hour, 14);</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-    do_check_eq(endGuess.minute, 30);</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineplus">+    equal(endGuess.year, 2012);</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+    equal(endGuess.month, 10);</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+    equal(endGuess.day, 3);</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+    equal(endGuess.hour, 14);</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+    equal(endGuess.minute, 30);</span>
<a href="#l21.65"></a><span id="l21.65"> }</span>
<a href="#l21.66"></a><span id="l21.66"> </span>
<a href="#l21.67"></a><span id="l21.67"> function test_event_start_end_whitespace() {</span>
<a href="#l21.68"></a><span id="l21.68">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.69"></a><span id="l21.69">     let title = &quot;Wednesday meetup&quot;;</span>
<a href="#l21.70"></a><span id="l21.70">     let content = &quot;We'll meet at2pm and discuss until\r\n3pm.&quot;;</span>
<a href="#l21.71"></a><span id="l21.71"> </span>
<a href="#l21.72"></a><span id="l21.72">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.73"></a><span id="l21.73">     let guessed = extractor.guessStart();</span>
<a href="#l21.74"></a><span id="l21.74">     let endGuess = extractor.guessEnd(guessed);</span>
<a href="#l21.75"></a><span id="l21.75"> </span>
<a href="#l21.76"></a><span id="l21.76" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineminus">-    do_check_eq(guessed.day, 3);</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineminus">-    do_check_eq(guessed.hour, 14);</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineminus">-    do_check_eq(guessed.minute, 0);</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.82"></a><span id="l21.82" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineplus">+    equal(guessed.day, 3);</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+    equal(guessed.hour, 14);</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineplus">+    equal(guessed.minute, 0);</span>
<a href="#l21.86"></a><span id="l21.86"> </span>
<a href="#l21.87"></a><span id="l21.87" class="difflineminus">-    do_check_eq(endGuess.year, 2012);</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineminus">-    do_check_eq(endGuess.month, 10);</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineminus">-    do_check_eq(endGuess.day, 3);</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-    do_check_eq(endGuess.hour, 15);</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineminus">-    do_check_eq(endGuess.minute, 0);</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineplus">+    equal(endGuess.year, 2012);</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+    equal(endGuess.month, 10);</span>
<a href="#l21.94"></a><span id="l21.94" class="difflineplus">+    equal(endGuess.day, 3);</span>
<a href="#l21.95"></a><span id="l21.95" class="difflineplus">+    equal(endGuess.hour, 15);</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineplus">+    equal(endGuess.minute, 0);</span>
<a href="#l21.97"></a><span id="l21.97"> }</span>
<a href="#l21.98"></a><span id="l21.98"> </span>
<a href="#l21.99"></a><span id="l21.99"> function test_event_without_date() {</span>
<a href="#l21.100"></a><span id="l21.100">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.101"></a><span id="l21.101">     let title = &quot;Meetup&quot;;</span>
<a href="#l21.102"></a><span id="l21.102">     let content = &quot;We'll meet at 2 pm and discuss until 3 pm.&quot;;</span>
<a href="#l21.103"></a><span id="l21.103"> </span>
<a href="#l21.104"></a><span id="l21.104">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.105"></a><span id="l21.105">     let guessed = extractor.guessStart();</span>
<a href="#l21.106"></a><span id="l21.106">     let endGuess = extractor.guessEnd(guessed);</span>
<a href="#l21.107"></a><span id="l21.107"> </span>
<a href="#l21.108"></a><span id="l21.108" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineminus">-    do_check_eq(guessed.day, 1);</span>
<a href="#l21.111"></a><span id="l21.111" class="difflineminus">-    do_check_eq(guessed.hour, 14);</span>
<a href="#l21.112"></a><span id="l21.112" class="difflineminus">-    do_check_eq(guessed.minute, 0);</span>
<a href="#l21.113"></a><span id="l21.113" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.114"></a><span id="l21.114" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineplus">+    equal(guessed.day, 1);</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineplus">+    equal(guessed.hour, 14);</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+    equal(guessed.minute, 0);</span>
<a href="#l21.118"></a><span id="l21.118"> </span>
<a href="#l21.119"></a><span id="l21.119" class="difflineminus">-    do_check_eq(endGuess.year, 2012);</span>
<a href="#l21.120"></a><span id="l21.120" class="difflineminus">-    do_check_eq(endGuess.month, 10);</span>
<a href="#l21.121"></a><span id="l21.121" class="difflineminus">-    do_check_eq(endGuess.day, 1);</span>
<a href="#l21.122"></a><span id="l21.122" class="difflineminus">-    do_check_eq(endGuess.hour, 15);</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineminus">-    do_check_eq(endGuess.minute, 0);</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineplus">+    equal(endGuess.year, 2012);</span>
<a href="#l21.125"></a><span id="l21.125" class="difflineplus">+    equal(endGuess.month, 10);</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineplus">+    equal(endGuess.day, 1);</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineplus">+    equal(endGuess.hour, 15);</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineplus">+    equal(endGuess.minute, 0);</span>
<a href="#l21.129"></a><span id="l21.129"> }</span>
<a href="#l21.130"></a><span id="l21.130"> </span>
<a href="#l21.131"></a><span id="l21.131"> function test_event_next_year() {</span>
<a href="#l21.132"></a><span id="l21.132">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.133"></a><span id="l21.133">     let title = &quot;Open day&quot;;</span>
<a href="#l21.134"></a><span id="l21.134">     let content = &quot;FYI: Next open day is planned for February 5th.&quot;;</span>
<a href="#l21.135"></a><span id="l21.135"> </span>
<a href="#l21.136"></a><span id="l21.136">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.137"></a><span id="l21.137">     let guessed = extractor.guessStart();</span>
<a href="#l21.138"></a><span id="l21.138">     let endGuess = extractor.guessEnd(guessed);</span>
<a href="#l21.139"></a><span id="l21.139"> </span>
<a href="#l21.140"></a><span id="l21.140" class="difflineminus">-    do_check_eq(guessed.year, 2013);</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineminus">-    do_check_eq(guessed.month, 2);</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineminus">-    do_check_eq(guessed.day, 5);</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineminus">-    do_check_eq(guessed.hour, undefined);</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineminus">-    do_check_eq(guessed.minute, undefined);</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineplus">+    equal(guessed.year, 2013);</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineplus">+    equal(guessed.month, 2);</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineplus">+    equal(guessed.day, 5);</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineplus">+    equal(guessed.hour, undefined);</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineplus">+    equal(guessed.minute, undefined);</span>
<a href="#l21.150"></a><span id="l21.150"> </span>
<a href="#l21.151"></a><span id="l21.151" class="difflineminus">-    do_check_eq(endGuess.year, undefined);</span>
<a href="#l21.152"></a><span id="l21.152" class="difflineminus">-    do_check_eq(endGuess.month, undefined);</span>
<a href="#l21.153"></a><span id="l21.153" class="difflineminus">-    do_check_eq(endGuess.day, undefined);</span>
<a href="#l21.154"></a><span id="l21.154" class="difflineminus">-    do_check_eq(endGuess.hour, undefined);</span>
<a href="#l21.155"></a><span id="l21.155" class="difflineminus">-    do_check_eq(endGuess.minute, undefined);</span>
<a href="#l21.156"></a><span id="l21.156" class="difflineplus">+    equal(endGuess.year, undefined);</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineplus">+    equal(endGuess.month, undefined);</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineplus">+    equal(endGuess.day, undefined);</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineplus">+    equal(endGuess.hour, undefined);</span>
<a href="#l21.160"></a><span id="l21.160" class="difflineplus">+    equal(endGuess.minute, undefined);</span>
<a href="#l21.161"></a><span id="l21.161"> }</span>
<a href="#l21.162"></a><span id="l21.162"> </span>
<a href="#l21.163"></a><span id="l21.163"> function test_task_due() {</span>
<a href="#l21.164"></a><span id="l21.164">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.165"></a><span id="l21.165">     let title = &quot;Assignment deadline&quot;;</span>
<a href="#l21.166"></a><span id="l21.166">     let content = &quot;This is a reminder that all assignments must be sent in by October 5th!.&quot;;</span>
<a href="#l21.167"></a><span id="l21.167"> </span>
<a href="#l21.168"></a><span id="l21.168">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.169"></a><span id="l21.169">     let guessed = extractor.guessStart(true);</span>
<a href="#l21.170"></a><span id="l21.170">     let endGuess = extractor.guessEnd(guessed, true);</span>
<a href="#l21.171"></a><span id="l21.171"> </span>
<a href="#l21.172"></a><span id="l21.172" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.173"></a><span id="l21.173" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.174"></a><span id="l21.174" class="difflineminus">-    do_check_eq(guessed.day, 1);</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineminus">-    do_check_eq(guessed.hour, 9);</span>
<a href="#l21.176"></a><span id="l21.176" class="difflineminus">-    do_check_eq(guessed.minute, 0);</span>
<a href="#l21.177"></a><span id="l21.177" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.178"></a><span id="l21.178" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.179"></a><span id="l21.179" class="difflineplus">+    equal(guessed.day, 1);</span>
<a href="#l21.180"></a><span id="l21.180" class="difflineplus">+    equal(guessed.hour, 9);</span>
<a href="#l21.181"></a><span id="l21.181" class="difflineplus">+    equal(guessed.minute, 0);</span>
<a href="#l21.182"></a><span id="l21.182"> </span>
<a href="#l21.183"></a><span id="l21.183" class="difflineminus">-    do_check_eq(endGuess.year, 2012);</span>
<a href="#l21.184"></a><span id="l21.184" class="difflineminus">-    do_check_eq(endGuess.month, 10);</span>
<a href="#l21.185"></a><span id="l21.185" class="difflineminus">-    do_check_eq(endGuess.day, 5);</span>
<a href="#l21.186"></a><span id="l21.186" class="difflineminus">-    do_check_eq(endGuess.hour, 0);</span>
<a href="#l21.187"></a><span id="l21.187" class="difflineminus">-    do_check_eq(endGuess.minute, 0);</span>
<a href="#l21.188"></a><span id="l21.188" class="difflineplus">+    equal(endGuess.year, 2012);</span>
<a href="#l21.189"></a><span id="l21.189" class="difflineplus">+    equal(endGuess.month, 10);</span>
<a href="#l21.190"></a><span id="l21.190" class="difflineplus">+    equal(endGuess.day, 5);</span>
<a href="#l21.191"></a><span id="l21.191" class="difflineplus">+    equal(endGuess.hour, 0);</span>
<a href="#l21.192"></a><span id="l21.192" class="difflineplus">+    equal(endGuess.minute, 0);</span>
<a href="#l21.193"></a><span id="l21.193"> }</span>
<a href="#l21.194"></a><span id="l21.194"> </span>
<a href="#l21.195"></a><span id="l21.195"> function test_overrides() {</span>
<a href="#l21.196"></a><span id="l21.196">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.197"></a><span id="l21.197">     let title = &quot;Event invitation&quot;;</span>
<a href="#l21.198"></a><span id="l21.198">     let content = &quot;We'll meet 10:11 worromot&quot;;</span>
<a href="#l21.199"></a><span id="l21.199"> </span>
<a href="#l21.200"></a><span id="l21.200">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.201"></a><span id="l21.201">     let guessed = extractor.guessStart(false);</span>
<a href="#l21.202"></a><span id="l21.202">     let endGuess = extractor.guessEnd(guessed, true);</span>
<a href="#l21.203"></a><span id="l21.203"> </span>
<a href="#l21.204"></a><span id="l21.204" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.205"></a><span id="l21.205" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.206"></a><span id="l21.206" class="difflineminus">-    do_check_eq(guessed.day, 1);</span>
<a href="#l21.207"></a><span id="l21.207" class="difflineminus">-    do_check_eq(guessed.hour, 10);</span>
<a href="#l21.208"></a><span id="l21.208" class="difflineminus">-    do_check_eq(guessed.minute, 11);</span>
<a href="#l21.209"></a><span id="l21.209" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.210"></a><span id="l21.210" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.211"></a><span id="l21.211" class="difflineplus">+    equal(guessed.day, 1);</span>
<a href="#l21.212"></a><span id="l21.212" class="difflineplus">+    equal(guessed.hour, 10);</span>
<a href="#l21.213"></a><span id="l21.213" class="difflineplus">+    equal(guessed.minute, 11);</span>
<a href="#l21.214"></a><span id="l21.214"> </span>
<a href="#l21.215"></a><span id="l21.215" class="difflineminus">-    do_check_eq(endGuess.year, undefined);</span>
<a href="#l21.216"></a><span id="l21.216" class="difflineminus">-    do_check_eq(endGuess.month, undefined);</span>
<a href="#l21.217"></a><span id="l21.217" class="difflineminus">-    do_check_eq(endGuess.day, undefined);</span>
<a href="#l21.218"></a><span id="l21.218" class="difflineminus">-    do_check_eq(endGuess.hour, undefined);</span>
<a href="#l21.219"></a><span id="l21.219" class="difflineminus">-    do_check_eq(endGuess.minute, undefined);</span>
<a href="#l21.220"></a><span id="l21.220" class="difflineplus">+    equal(endGuess.year, undefined);</span>
<a href="#l21.221"></a><span id="l21.221" class="difflineplus">+    equal(endGuess.month, undefined);</span>
<a href="#l21.222"></a><span id="l21.222" class="difflineplus">+    equal(endGuess.day, undefined);</span>
<a href="#l21.223"></a><span id="l21.223" class="difflineplus">+    equal(endGuess.hour, undefined);</span>
<a href="#l21.224"></a><span id="l21.224" class="difflineplus">+    equal(endGuess.minute, undefined);</span>
<a href="#l21.225"></a><span id="l21.225"> </span>
<a href="#l21.226"></a><span id="l21.226">     // recognize a custom &quot;tomorrow&quot; and hour.minutes pattern</span>
<a href="#l21.227"></a><span id="l21.227">     let overrides = {&quot;from.hour.minutes&quot;:</span>
<a href="#l21.228"></a><span id="l21.228">                       {&quot;add&quot;: &quot;%2$S:%1$S&quot;, &quot;remove&quot;: &quot;%1$S:%2$S&quot;},</span>
<a href="#l21.229"></a><span id="l21.229">                      &quot;from.tomorrow&quot;:</span>
<a href="#l21.230"></a><span id="l21.230">                       {&quot;add&quot;: &quot;worromot&quot;}};</span>
<a href="#l21.231"></a><span id="l21.231">     Preferences.set(&quot;calendar.patterns.override&quot;, JSON.stringify(overrides));</span>
<a href="#l21.232"></a><span id="l21.232"> </span>
<a href="#l21.233"></a><span id="l21.233">     collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.234"></a><span id="l21.234">     guessed = extractor.guessStart(false);</span>
<a href="#l21.235"></a><span id="l21.235">     endGuess = extractor.guessEnd(guessed, true);</span>
<a href="#l21.236"></a><span id="l21.236"> </span>
<a href="#l21.237"></a><span id="l21.237" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.238"></a><span id="l21.238" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.239"></a><span id="l21.239" class="difflineminus">-    do_check_eq(guessed.day, 2);</span>
<a href="#l21.240"></a><span id="l21.240" class="difflineminus">-    do_check_eq(guessed.hour, 11);</span>
<a href="#l21.241"></a><span id="l21.241" class="difflineminus">-    do_check_eq(guessed.minute, 10);</span>
<a href="#l21.242"></a><span id="l21.242" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.243"></a><span id="l21.243" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.244"></a><span id="l21.244" class="difflineplus">+    equal(guessed.day, 2);</span>
<a href="#l21.245"></a><span id="l21.245" class="difflineplus">+    equal(guessed.hour, 11);</span>
<a href="#l21.246"></a><span id="l21.246" class="difflineplus">+    equal(guessed.minute, 10);</span>
<a href="#l21.247"></a><span id="l21.247"> </span>
<a href="#l21.248"></a><span id="l21.248" class="difflineminus">-    do_check_eq(endGuess.year, undefined);</span>
<a href="#l21.249"></a><span id="l21.249" class="difflineminus">-    do_check_eq(endGuess.month, undefined);</span>
<a href="#l21.250"></a><span id="l21.250" class="difflineminus">-    do_check_eq(endGuess.day, undefined);</span>
<a href="#l21.251"></a><span id="l21.251" class="difflineminus">-    do_check_eq(endGuess.hour, undefined);</span>
<a href="#l21.252"></a><span id="l21.252" class="difflineminus">-    do_check_eq(endGuess.minute, undefined);</span>
<a href="#l21.253"></a><span id="l21.253" class="difflineplus">+    equal(endGuess.year, undefined);</span>
<a href="#l21.254"></a><span id="l21.254" class="difflineplus">+    equal(endGuess.month, undefined);</span>
<a href="#l21.255"></a><span id="l21.255" class="difflineplus">+    equal(endGuess.day, undefined);</span>
<a href="#l21.256"></a><span id="l21.256" class="difflineplus">+    equal(endGuess.hour, undefined);</span>
<a href="#l21.257"></a><span id="l21.257" class="difflineplus">+    equal(endGuess.minute, undefined);</span>
<a href="#l21.258"></a><span id="l21.258"> }</span>
<a href="#l21.259"></a><span id="l21.259"> </span>
<a href="#l21.260"></a><span id="l21.260"> function test_event_start_dollar_sign() {</span>
<a href="#l21.261"></a><span id="l21.261">     let date = new Date(2012, 9, 1, 9, 0);</span>
<a href="#l21.262"></a><span id="l21.262">     let title = &quot;Wednesday sale&quot;;</span>
<a href="#l21.263"></a><span id="l21.263">     let content = &quot;Sale starts at 3 pm and prices start at 2$.&quot;;</span>
<a href="#l21.264"></a><span id="l21.264"> </span>
<a href="#l21.265"></a><span id="l21.265">     let collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l21.266"></a><span id="l21.266">     let guessed = extractor.guessStart();</span>
<a href="#l21.267"></a><span id="l21.267">     let endGuess = extractor.guessEnd(guessed);</span>
<a href="#l21.268"></a><span id="l21.268"> </span>
<a href="#l21.269"></a><span id="l21.269" class="difflineminus">-    do_check_eq(guessed.year, 2012);</span>
<a href="#l21.270"></a><span id="l21.270" class="difflineminus">-    do_check_eq(guessed.month, 10);</span>
<a href="#l21.271"></a><span id="l21.271" class="difflineminus">-    do_check_eq(guessed.day, 3);</span>
<a href="#l21.272"></a><span id="l21.272" class="difflineminus">-    do_check_eq(guessed.hour, 15);</span>
<a href="#l21.273"></a><span id="l21.273" class="difflineminus">-    do_check_eq(guessed.minute, 0);</span>
<a href="#l21.274"></a><span id="l21.274" class="difflineplus">+    equal(guessed.year, 2012);</span>
<a href="#l21.275"></a><span id="l21.275" class="difflineplus">+    equal(guessed.month, 10);</span>
<a href="#l21.276"></a><span id="l21.276" class="difflineplus">+    equal(guessed.day, 3);</span>
<a href="#l21.277"></a><span id="l21.277" class="difflineplus">+    equal(guessed.hour, 15);</span>
<a href="#l21.278"></a><span id="l21.278" class="difflineplus">+    equal(guessed.minute, 0);</span>
<a href="#l21.279"></a><span id="l21.279"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/test/unit/test_freebusy.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/test/unit/test_freebusy.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -18,57 +18,57 @@ function test_freebusy() {</span>
<a href="#l22.4"></a><span id="l22.4">     var fbVal3 = &quot;20080206T220000Z/PT1H&quot;;</span>
<a href="#l22.5"></a><span id="l22.5">     var data =</span>
<a href="#l22.6"></a><span id="l22.6">         &quot;BEGIN:VCALENDAR\n&quot; +</span>
<a href="#l22.7"></a><span id="l22.7">         &quot;BEGIN:VFREEBUSY\n&quot; +</span>
<a href="#l22.8"></a><span id="l22.8">         &quot;FREEBUSY;FBTYPE=BUSY:&quot; + fbVal1 + &quot;,&quot; + fbVal2 + &quot;,&quot; + fbVal3 + &quot;\n&quot; +</span>
<a href="#l22.9"></a><span id="l22.9">         &quot;END:VFREEBUSY\n&quot; +</span>
<a href="#l22.10"></a><span id="l22.10">         &quot;END:VCALENDAR\n&quot;;</span>
<a href="#l22.11"></a><span id="l22.11">     var fbComp = icsService.parseICS(data, null).getFirstSubcomponent(&quot;VFREEBUSY&quot;);</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    do_check_eq(fbComp.getFirstProperty(&quot;FREEBUSY&quot;).value, fbVal1);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-    do_check_eq(fbComp.getNextProperty(&quot;FREEBUSY&quot;).value, fbVal2);</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-    do_check_eq(fbComp.getNextProperty(&quot;FREEBUSY&quot;).value, fbVal3);</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+    equal(fbComp.getFirstProperty(&quot;FREEBUSY&quot;).value, fbVal1);</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+    equal(fbComp.getNextProperty(&quot;FREEBUSY&quot;).value, fbVal2);</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+    equal(fbComp.getNextProperty(&quot;FREEBUSY&quot;).value, fbVal3);</span>
<a href="#l22.18"></a><span id="l22.18"> }</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20"> function test_period() {</span>
<a href="#l22.21"></a><span id="l22.21">     let period = Components.classes[&quot;@mozilla.org/calendar/period;1&quot;]</span>
<a href="#l22.22"></a><span id="l22.22">                            .createInstance(Components.interfaces.calIPeriod);</span>
<a href="#l22.23"></a><span id="l22.23"> </span>
<a href="#l22.24"></a><span id="l22.24">     period.start = cal.createDateTime(&quot;20120101T010101&quot;);</span>
<a href="#l22.25"></a><span id="l22.25">     period.end = cal.createDateTime(&quot;20120101T010102&quot;);</span>
<a href="#l22.26"></a><span id="l22.26"> </span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">-    do_check_eq(period.icalString, &quot;20120101T010101/20120101T010102&quot;);</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">-    do_check_eq(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineplus">+    equal(period.icalString, &quot;20120101T010101/20120101T010102&quot;);</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+    equal(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.31"></a><span id="l22.31"> </span>
<a href="#l22.32"></a><span id="l22.32">     period.icalString = &quot;20120101T010103/20120101T010104&quot;;</span>
<a href="#l22.33"></a><span id="l22.33"> </span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">-    do_check_eq(period.start.icalString, &quot;20120101T010103&quot;);</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineminus">-    do_check_eq(period.end.icalString, &quot;20120101T010104&quot;);</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineminus">-    do_check_eq(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+    equal(period.start.icalString, &quot;20120101T010103&quot;);</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+    equal(period.end.icalString, &quot;20120101T010104&quot;);</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+    equal(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.40"></a><span id="l22.40"> </span>
<a href="#l22.41"></a><span id="l22.41">     period.icalString = &quot;20120101T010105/PT1S&quot;;</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineminus">-    do_check_eq(period.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-    do_check_eq(period.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">-    do_check_eq(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+    equal(period.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+    equal(period.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+    equal(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.48"></a><span id="l22.48"> </span>
<a href="#l22.49"></a><span id="l22.49">     period.makeImmutable();</span>
<a href="#l22.50"></a><span id="l22.50">     if (!Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l22.51"></a><span id="l22.51">         // ical.js doesn't support immutability yet</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-        do_check_throws(function() {</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineplus">+        throws(function() {</span>
<a href="#l22.54"></a><span id="l22.54">             period.start = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-        }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineminus">-        do_check_throws(function() {</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineplus">+        }, /0x80460002/,&quot;Object is Immutable&quot;);</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+        throws(function() {</span>
<a href="#l22.59"></a><span id="l22.59">             period.end = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineminus">-        }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineplus">+        }, /0x80460002/,&quot;Object is Immutable&quot;);</span>
<a href="#l22.62"></a><span id="l22.62">     }</span>
<a href="#l22.63"></a><span id="l22.63"> </span>
<a href="#l22.64"></a><span id="l22.64">     let copy = period.clone();</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineminus">-    do_check_eq(copy.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-    do_check_eq(copy.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-    do_check_eq(copy.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+    equal(copy.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineplus">+    equal(copy.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+    equal(copy.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.71"></a><span id="l22.71"> </span>
<a href="#l22.72"></a><span id="l22.72">     copy.start.icalString = &quot;20120101T010106&quot;;</span>
<a href="#l22.73"></a><span id="l22.73">     copy.end = cal.createDateTime(&quot;20120101T010107&quot;);</span>
<a href="#l22.74"></a><span id="l22.74"> </span>
<a href="#l22.75"></a><span id="l22.75" class="difflineminus">-    do_check_eq(period.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineminus">-    do_check_eq(period.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineminus">-    do_check_eq(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineplus">+    equal(period.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+    equal(period.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+    equal(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l22.81"></a><span id="l22.81"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/test/unit/test_freebusy_service.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/test/unit/test_freebusy_service.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -13,56 +13,56 @@ function run_test() {</span>
<a href="#l23.4"></a><span id="l23.4">     test_found();</span>
<a href="#l23.5"></a><span id="l23.5">     test_failure();</span>
<a href="#l23.6"></a><span id="l23.6">     test_cancel();</span>
<a href="#l23.7"></a><span id="l23.7"> }</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9"> function test_found() {</span>
<a href="#l23.10"></a><span id="l23.10">     _clearProviders();</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    do_check_eq(_countProviders(), 0);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+    equal(_countProviders(), 0);</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15">     let provider1 = {</span>
<a href="#l23.16"></a><span id="l23.16">         id: 1,</span>
<a href="#l23.17"></a><span id="l23.17">         getFreeBusyIntervals: function() {</span>
<a href="#l23.18"></a><span id="l23.18">           aListener.onResult(null, []);</span>
<a href="#l23.19"></a><span id="l23.19">         }</span>
<a href="#l23.20"></a><span id="l23.20">     };</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22">     let provider2 = {</span>
<a href="#l23.23"></a><span id="l23.23">         id: 2,</span>
<a href="#l23.24"></a><span id="l23.24">         called: false,</span>
<a href="#l23.25"></a><span id="l23.25">         getFreeBusyIntervals: function(aCalId, aStart, aEnd, aTypes, aListener) {</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">-            do_check_false(this.called)</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineplus">+            ok(!this.called)</span>
<a href="#l23.28"></a><span id="l23.28">             this.called = true;</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30">             let interval = new cal.FreeBusyInterval(aCalId, cIFI.BUSY, aStart, aEnd);</span>
<a href="#l23.31"></a><span id="l23.31">             aListener.onResult(null, [interval]);</span>
<a href="#l23.32"></a><span id="l23.32">         }</span>
<a href="#l23.33"></a><span id="l23.33">     };</span>
<a href="#l23.34"></a><span id="l23.34">     provider2.wrappedJSObject = provider2;</span>
<a href="#l23.35"></a><span id="l23.35"> </span>
<a href="#l23.36"></a><span id="l23.36">     freebusy.addProvider(provider1);</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-    do_check_eq(_countProviders(), 1);</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineplus">+    equal(_countProviders(), 1);</span>
<a href="#l23.39"></a><span id="l23.39">     freebusy.addProvider(provider2);</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">-    do_check_eq(_countProviders(), 2);</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineplus">+    equal(_countProviders(), 2);</span>
<a href="#l23.42"></a><span id="l23.42">     freebusy.removeProvider(provider1);</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-    do_check_eq(_countProviders(), 1);</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-    do_check_eq(_getFirstProvider().id, 2);</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineplus">+    equal(_countProviders(), 1);</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+    equal(_getFirstProvider().id, 2);</span>
<a href="#l23.47"></a><span id="l23.47"> </span>
<a href="#l23.48"></a><span id="l23.48">     let listener = {</span>
<a href="#l23.49"></a><span id="l23.49">         called: false,</span>
<a href="#l23.50"></a><span id="l23.50">         onResult: function(request, result) {</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineminus">-            do_check_eq(result.length, 1);</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineminus">-            do_check_eq(result[0].interval.start.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineminus">-            do_check_eq(result[0].interval.end.icalString, &quot;20120102T010101&quot;);</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineminus">-            do_check_eq(result[0].freeBusyType, cIFI.BUSY);</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineplus">+            equal(result.length, 1);</span>
<a href="#l23.56"></a><span id="l23.56" class="difflineplus">+            equal(result[0].interval.start.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l23.57"></a><span id="l23.57" class="difflineplus">+            equal(result[0].interval.end.icalString, &quot;20120102T010101&quot;);</span>
<a href="#l23.58"></a><span id="l23.58" class="difflineplus">+            equal(result[0].freeBusyType, cIFI.BUSY);</span>
<a href="#l23.59"></a><span id="l23.59"> </span>
<a href="#l23.60"></a><span id="l23.60" class="difflineminus">-            do_check_eq(result.length, 1);</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineminus">-            do_check_true(provider2.called);</span>
<a href="#l23.62"></a><span id="l23.62" class="difflineplus">+            equal(result.length, 1);</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineplus">+            ok(provider2.called);</span>
<a href="#l23.64"></a><span id="l23.64">             do_test_finished();</span>
<a href="#l23.65"></a><span id="l23.65">         }</span>
<a href="#l23.66"></a><span id="l23.66">     };</span>
<a href="#l23.67"></a><span id="l23.67"> </span>
<a href="#l23.68"></a><span id="l23.68">     do_test_pending();</span>
<a href="#l23.69"></a><span id="l23.69">     freebusy.getFreeBusyIntervals(&quot;email&quot;,</span>
<a href="#l23.70"></a><span id="l23.70">                                   cal.createDateTime(&quot;20120101T010101&quot;),</span>
<a href="#l23.71"></a><span id="l23.71">                                   cal.createDateTime(&quot;20120102T010101&quot;),</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineat">@@ -70,28 +70,28 @@ function test_found() {</span>
<a href="#l23.73"></a><span id="l23.73"> }</span>
<a href="#l23.74"></a><span id="l23.74"> </span>
<a href="#l23.75"></a><span id="l23.75"> function test_failure() {</span>
<a href="#l23.76"></a><span id="l23.76">     _clearProviders();</span>
<a href="#l23.77"></a><span id="l23.77"> </span>
<a href="#l23.78"></a><span id="l23.78">     let provider = {</span>
<a href="#l23.79"></a><span id="l23.79">         called: false,</span>
<a href="#l23.80"></a><span id="l23.80">         getFreeBusyIntervals: function(aCalId, aStart, aEnd, aTypes, aListener) {</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineminus">-            do_check_false(this.called);</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineplus">+            ok(!this.called);</span>
<a href="#l23.83"></a><span id="l23.83">             this.called = true;</span>
<a href="#l23.84"></a><span id="l23.84">             aListener.onResult({ status: Components.results.NS_ERROR_FAILURE }, &quot;notFound&quot;);</span>
<a href="#l23.85"></a><span id="l23.85">         }</span>
<a href="#l23.86"></a><span id="l23.86">     };</span>
<a href="#l23.87"></a><span id="l23.87"> </span>
<a href="#l23.88"></a><span id="l23.88">     let listener = {</span>
<a href="#l23.89"></a><span id="l23.89">         onResult: function(request, result) {</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineminus">-            do_check_false(this.called);</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineminus">-            do_check_eq(result.length, 0);</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineminus">-            do_check_eq(request.status, 0);</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineminus">-            do_check_true(provider.called);</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineplus">+            ok(!this.called);</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineplus">+            equal(result.length, 0);</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineplus">+            equal(request.status, 0);</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineplus">+            ok(provider.called);</span>
<a href="#l23.98"></a><span id="l23.98">             do_test_finished();</span>
<a href="#l23.99"></a><span id="l23.99">         }</span>
<a href="#l23.100"></a><span id="l23.100">     };</span>
<a href="#l23.101"></a><span id="l23.101"> </span>
<a href="#l23.102"></a><span id="l23.102">     freebusy.addProvider(provider);</span>
<a href="#l23.103"></a><span id="l23.103"> </span>
<a href="#l23.104"></a><span id="l23.104">     do_test_pending();</span>
<a href="#l23.105"></a><span id="l23.105">     let op = freebusy.getFreeBusyIntervals(&quot;email&quot;,</span>
<a href="#l23.106"></a><span id="l23.106" class="difflineat">@@ -124,20 +124,20 @@ function test_cancel() {</span>
<a href="#l23.107"></a><span id="l23.107">         cancel: function() {</span>
<a href="#l23.108"></a><span id="l23.108">             this.cancelCalled = true;</span>
<a href="#l23.109"></a><span id="l23.109">         },</span>
<a href="#l23.110"></a><span id="l23.110">     };</span>
<a href="#l23.111"></a><span id="l23.111"> </span>
<a href="#l23.112"></a><span id="l23.112">     let listener = {</span>
<a href="#l23.113"></a><span id="l23.113">         called: false,</span>
<a href="#l23.114"></a><span id="l23.114">         onResult: function(request, result) {</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineminus">-            do_check_eq(result, null);</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineplus">+            equal(result, null);</span>
<a href="#l23.117"></a><span id="l23.117"> </span>
<a href="#l23.118"></a><span id="l23.118">             // If an exception occurs, the operation is not added to the opgroup</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineminus">-            do_check_false(provider.cancelCalled);</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineplus">+            ok(!provider.cancelCalled);</span>
<a href="#l23.121"></a><span id="l23.121">             do_test_finished();</span>
<a href="#l23.122"></a><span id="l23.122">         }</span>
<a href="#l23.123"></a><span id="l23.123">     };</span>
<a href="#l23.124"></a><span id="l23.124"> </span>
<a href="#l23.125"></a><span id="l23.125">     freebusy.addProvider(provider);</span>
<a href="#l23.126"></a><span id="l23.126"> </span>
<a href="#l23.127"></a><span id="l23.127">     do_test_pending();</span>
<a href="#l23.128"></a><span id="l23.128">     let op = freebusy.getFreeBusyIntervals(&quot;email&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/test/unit/test_gdata_provider.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -439,19 +439,19 @@ add_test(function test_migrate_uri() {</span>
<a href="#l24.4"></a><span id="l24.4">     function checkMigrate(fromUri, session, calendarId, tasksId) {</span>
<a href="#l24.5"></a><span id="l24.5">         let uri = Services.io.newURI(fromUri, null, null);</span>
<a href="#l24.6"></a><span id="l24.6">         let client = cal.getCalendarManager().createCalendar(&quot;gdata&quot;, uri);</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8">         if (session) {</span>
<a href="#l24.9"></a><span id="l24.9">             let target = (&quot;googleapi://&quot; + session + &quot;/?&quot; +</span>
<a href="#l24.10"></a><span id="l24.10">                          (calendarId ? &quot;&amp;calendar=&quot; + encodeURIComponent(calendarId) : &quot;&quot;) +</span>
<a href="#l24.11"></a><span id="l24.11">                          (tasksId ? &quot;&amp;tasks=&quot; + encodeURIComponent(tasksId) : &quot;&quot;)).replace(&quot;?&amp;&quot;, &quot;?&quot;);</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-            do_check_eq(client.getProperty(&quot;uri&quot;), target);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+            equal(client.getProperty(&quot;uri&quot;), target);</span>
<a href="#l24.14"></a><span id="l24.14">         } else {</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-            do_check_eq(client.getProperty(&quot;uri&quot;), null);</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+            equal(client.getProperty(&quot;uri&quot;), null);</span>
<a href="#l24.17"></a><span id="l24.17">         }</span>
<a href="#l24.18"></a><span id="l24.18">     }</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">     checkMigrate(&quot;http://www.google.com/calendar/feeds/example%40example.com/public/full&quot;,</span>
<a href="#l24.21"></a><span id="l24.21">                  &quot;example@example.com&quot;, &quot;example@example.com&quot;, null);</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23">     checkMigrate(&quot;webcal://www.google.com/calendar/feeds/example%40example.com/public/full&quot;,</span>
<a href="#l24.24"></a><span id="l24.24">                  &quot;example@example.com&quot;, &quot;example@example.com&quot;, null);</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineat">@@ -464,34 +464,34 @@ add_test(function test_migrate_uri() {</span>
<a href="#l24.26"></a><span id="l24.26">     checkMigrate(&quot;googleapi://session/?calendar=calendarId&amp;tasksId=tasksId&quot;);</span>
<a href="#l24.27"></a><span id="l24.27"> </span>
<a href="#l24.28"></a><span id="l24.28">     run_next_test();</span>
<a href="#l24.29"></a><span id="l24.29"> });</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31"> add_task(function* test_organizerCN() {</span>
<a href="#l24.32"></a><span id="l24.32">     gServer.events = [];</span>
<a href="#l24.33"></a><span id="l24.33">     let client = yield gServer.getClient();</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-    do_check_eq(client.getProperty(&quot;organizerCN&quot;), null);</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+    equal(client.getProperty(&quot;organizerCN&quot;), null);</span>
<a href="#l24.36"></a><span id="l24.36">     gServer.resetClient(client);</span>
<a href="#l24.37"></a><span id="l24.37"> </span>
<a href="#l24.38"></a><span id="l24.38">     gServer.events = [{</span>
<a href="#l24.39"></a><span id="l24.39">        &quot;kind&quot;: &quot;calendar#event&quot;,</span>
<a href="#l24.40"></a><span id="l24.40">        &quot;etag&quot;: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l24.41"></a><span id="l24.41">        &quot;id&quot;: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l24.42"></a><span id="l24.42">        &quot;created&quot;: &quot;2006-06-08T21:04:52.000Z&quot;,</span>
<a href="#l24.43"></a><span id="l24.43">        &quot;updated&quot;: &quot;2006-06-08T21:05:49.138Z&quot;,</span>
<a href="#l24.44"></a><span id="l24.44">        &quot;summary&quot;: &quot;New Event&quot;,</span>
<a href="#l24.45"></a><span id="l24.45">        &quot;creator&quot;: gServer.creator,</span>
<a href="#l24.46"></a><span id="l24.46">        &quot;organizer&quot;: gServer.creator,</span>
<a href="#l24.47"></a><span id="l24.47">        &quot;start&quot;: { &quot;dateTime&quot;: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l24.48"></a><span id="l24.48">        &quot;end&quot;: {&quot;dateTime&quot;: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l24.49"></a><span id="l24.49">        &quot;iCalUID&quot;: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l24.50"></a><span id="l24.50">     }];</span>
<a href="#l24.51"></a><span id="l24.51">     client = yield gServer.getClient();</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-    do_check_eq(client.getProperty(&quot;organizerCN&quot;), gServer.creator.displayName);</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineplus">+    equal(client.getProperty(&quot;organizerCN&quot;), gServer.creator.displayName);</span>
<a href="#l24.54"></a><span id="l24.54">     gServer.resetClient(client);</span>
<a href="#l24.55"></a><span id="l24.55"> });</span>
<a href="#l24.56"></a><span id="l24.56"> </span>
<a href="#l24.57"></a><span id="l24.57"> add_task(function* test_always_readOnly() {</span>
<a href="#l24.58"></a><span id="l24.58">     gServer.events = [{</span>
<a href="#l24.59"></a><span id="l24.59">        &quot;kind&quot;: &quot;calendar#event&quot;,</span>
<a href="#l24.60"></a><span id="l24.60">        &quot;etag&quot;: &quot;\&quot;2299601498276000\&quot;&quot;,</span>
<a href="#l24.61"></a><span id="l24.61">        &quot;id&quot;: &quot;go6ijb0b46hlpbu4eeu92njevo&quot;,</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineat">@@ -502,30 +502,30 @@ add_task(function* test_always_readOnly(</span>
<a href="#l24.63"></a><span id="l24.63">        &quot;organizer&quot;: gServer.creator,</span>
<a href="#l24.64"></a><span id="l24.64">        &quot;start&quot;: { &quot;dateTime&quot;: &quot;2006-06-10T18:00:00+02:00&quot; },</span>
<a href="#l24.65"></a><span id="l24.65">        &quot;end&quot;: {&quot;dateTime&quot;: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l24.66"></a><span id="l24.66">        &quot;iCalUID&quot;: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;</span>
<a href="#l24.67"></a><span id="l24.67">     }];</span>
<a href="#l24.68"></a><span id="l24.68">     gServer.calendarListData.accessRole = &quot;freeBusyReader&quot;;</span>
<a href="#l24.69"></a><span id="l24.69">     let client = yield gServer.getClient();</span>
<a href="#l24.70"></a><span id="l24.70">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineminus">-    do_check_true(client.readOnly)</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+    ok(client.readOnly)</span>
<a href="#l24.73"></a><span id="l24.73">     client.readOnly = false;</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineminus">-    do_check_true(client.readOnly)</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineplus">+    ok(client.readOnly)</span>
<a href="#l24.76"></a><span id="l24.76"> </span>
<a href="#l24.77"></a><span id="l24.77">     let items = yield pclient.getAllItems();</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineminus">-    do_check_neq(items[0].title, &quot;New Event&quot;);</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineplus">+    notEqual(items[0].title, &quot;New Event&quot;);</span>
<a href="#l24.82"></a><span id="l24.82">     gServer.resetClient(client);</span>
<a href="#l24.83"></a><span id="l24.83"> </span>
<a href="#l24.84"></a><span id="l24.84">     gServer.calendarListData.accessRole = &quot;reader&quot;;</span>
<a href="#l24.85"></a><span id="l24.85">     client = yield gServer.getClient();</span>
<a href="#l24.86"></a><span id="l24.86" class="difflineminus">-    do_check_true(client.readOnly)</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineplus">+    ok(client.readOnly)</span>
<a href="#l24.88"></a><span id="l24.88">     client.readOnly = false;</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineminus">-    do_check_true(client.readOnly)</span>
<a href="#l24.90"></a><span id="l24.90" class="difflineplus">+    ok(client.readOnly)</span>
<a href="#l24.91"></a><span id="l24.91">     gServer.resetClient(client);</span>
<a href="#l24.92"></a><span id="l24.92"> });</span>
<a href="#l24.93"></a><span id="l24.93"> </span>
<a href="#l24.94"></a><span id="l24.94"> add_task(function* test_reset_sync() {</span>
<a href="#l24.95"></a><span id="l24.95">     gServer.tasks = [</span>
<a href="#l24.96"></a><span id="l24.96">        {</span>
<a href="#l24.97"></a><span id="l24.97">         &quot;kind&quot;: &quot;tasks#task&quot;,</span>
<a href="#l24.98"></a><span id="l24.98">         &quot;id&quot;: &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;,</span>
<a href="#l24.99"></a><span id="l24.99" class="difflineat">@@ -571,27 +571,27 @@ add_task(function* test_reset_sync() {</span>
<a href="#l24.100"></a><span id="l24.100">        &quot;end&quot;: {&quot;dateTime&quot;: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l24.101"></a><span id="l24.101">        &quot;iCalUID&quot;: &quot;fepf8uf6n7n04w7feukucs9n8e@google.com&quot;</span>
<a href="#l24.102"></a><span id="l24.102">     }];</span>
<a href="#l24.103"></a><span id="l24.103">     let client = yield gServer.getClient();</span>
<a href="#l24.104"></a><span id="l24.104">     let uncached = client.wrappedJSObject.mUncachedCalendar.wrappedJSObject;</span>
<a href="#l24.105"></a><span id="l24.105">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l24.106"></a><span id="l24.106"> </span>
<a href="#l24.107"></a><span id="l24.107">     let items = yield pclient.getAllItems();</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineminus">-    do_check_eq(items.length, 4);</span>
<a href="#l24.109"></a><span id="l24.109" class="difflineplus">+    equal(items.length, 4);</span>
<a href="#l24.110"></a><span id="l24.110"> </span>
<a href="#l24.111"></a><span id="l24.111" class="difflineminus">-    do_check_neq(client.getProperty(&quot;syncToken.events&quot;), &quot;&quot;);</span>
<a href="#l24.112"></a><span id="l24.112" class="difflineminus">-    do_check_neq(client.getProperty(&quot;lastUpdated.tasks&quot;), &quot;&quot;);</span>
<a href="#l24.113"></a><span id="l24.113" class="difflineplus">+    notEqual(client.getProperty(&quot;syncToken.events&quot;), &quot;&quot;);</span>
<a href="#l24.114"></a><span id="l24.114" class="difflineplus">+    notEqual(client.getProperty(&quot;lastUpdated.tasks&quot;), &quot;&quot;);</span>
<a href="#l24.115"></a><span id="l24.115"> </span>
<a href="#l24.116"></a><span id="l24.116">     yield uncached.resetSync();</span>
<a href="#l24.117"></a><span id="l24.117">     items = yield pclient.getAllItems();</span>
<a href="#l24.118"></a><span id="l24.118" class="difflineminus">-    do_check_eq(items.length, 0);</span>
<a href="#l24.119"></a><span id="l24.119" class="difflineplus">+    equal(items.length, 0);</span>
<a href="#l24.120"></a><span id="l24.120"> </span>
<a href="#l24.121"></a><span id="l24.121" class="difflineminus">-    do_check_eq(client.getProperty(&quot;syncToken.events&quot;), &quot;&quot;);</span>
<a href="#l24.122"></a><span id="l24.122" class="difflineminus">-    do_check_eq(client.getProperty(&quot;lastUpdated.tasks&quot;), &quot;&quot;);</span>
<a href="#l24.123"></a><span id="l24.123" class="difflineplus">+    equal(client.getProperty(&quot;syncToken.events&quot;), &quot;&quot;);</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineplus">+    equal(client.getProperty(&quot;lastUpdated.tasks&quot;), &quot;&quot;);</span>
<a href="#l24.125"></a><span id="l24.125"> </span>
<a href="#l24.126"></a><span id="l24.126">     gServer.resetClient(client);</span>
<a href="#l24.127"></a><span id="l24.127"> });</span>
<a href="#l24.128"></a><span id="l24.128"> </span>
<a href="#l24.129"></a><span id="l24.129"> add_task(function* test_basicItems() {</span>
<a href="#l24.130"></a><span id="l24.130">     gServer.events = [</span>
<a href="#l24.131"></a><span id="l24.131">       {</span>
<a href="#l24.132"></a><span id="l24.132">          &quot;kind&quot;: &quot;calendar#event&quot;,</span>
<a href="#l24.133"></a><span id="l24.133" class="difflineat">@@ -660,79 +660,79 @@ add_task(function* test_basicItems() {</span>
<a href="#l24.134"></a><span id="l24.134">         }]</span>
<a href="#l24.135"></a><span id="l24.135">       }</span>
<a href="#l24.136"></a><span id="l24.136">     ];</span>
<a href="#l24.137"></a><span id="l24.137"> </span>
<a href="#l24.138"></a><span id="l24.138">     let client = yield gServer.getClient();</span>
<a href="#l24.139"></a><span id="l24.139">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l24.140"></a><span id="l24.140"> </span>
<a href="#l24.141"></a><span id="l24.141">     let items = yield pclient.getAllItems();</span>
<a href="#l24.142"></a><span id="l24.142" class="difflineminus">-    do_check_eq(items.length, 2);</span>
<a href="#l24.143"></a><span id="l24.143" class="difflineplus">+    equal(items.length, 2);</span>
<a href="#l24.144"></a><span id="l24.144"> </span>
<a href="#l24.145"></a><span id="l24.145">     let event = cal.isEvent(items[0]) ? items[0]: items[1];</span>
<a href="#l24.146"></a><span id="l24.146" class="difflineminus">-    do_check_eq(event.id, &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;);</span>
<a href="#l24.147"></a><span id="l24.147" class="difflineminus">-    do_check_eq(event.getProperty(&quot;STATUS&quot;), &quot;CONFIRMED&quot;);</span>
<a href="#l24.148"></a><span id="l24.148" class="difflineminus">-    do_check_eq(event.getProperty(&quot;URL&quot;), gServer.baseUri + &quot;/calendar/event?eid=eventhash&quot;);</span>
<a href="#l24.149"></a><span id="l24.149" class="difflineminus">-    do_check_eq(event.getProperty(&quot;CREATED&quot;).icalString, &quot;20060608T210452Z&quot;);</span>
<a href="#l24.150"></a><span id="l24.150" class="difflineminus">-    do_check_eq(event.getProperty(&quot;LAST-MODIFIED&quot;).icalString, &quot;20060608T210549Z&quot;);</span>
<a href="#l24.151"></a><span id="l24.151" class="difflineminus">-    do_check_eq(event.title, &quot;New Event&quot;);</span>
<a href="#l24.152"></a><span id="l24.152" class="difflineminus">-    do_check_eq(event.getProperty(&quot;DESCRIPTION&quot;), &quot;description&quot;);</span>
<a href="#l24.153"></a><span id="l24.153" class="difflineminus">-    do_check_eq(event.getProperty(&quot;LOCATION&quot;), &quot;Hard Drive&quot;);</span>
<a href="#l24.154"></a><span id="l24.154" class="difflineminus">-    do_check_eq(event.organizer.id, &quot;mailto:xpcshell@example.com&quot;);</span>
<a href="#l24.155"></a><span id="l24.155" class="difflineminus">-    do_check_eq(event.organizer.commonName, &quot;Eggs P. Seashell&quot;);</span>
<a href="#l24.156"></a><span id="l24.156" class="difflineminus">-    do_check_true(event.organizer.isOrganizer);</span>
<a href="#l24.157"></a><span id="l24.157" class="difflineminus">-    do_check_eq(event.startDate.icalString, &quot;20060610T180000&quot;);</span>
<a href="#l24.158"></a><span id="l24.158" class="difflineminus">-    do_check_eq(event.startDate.timezone.tzid, &quot;Europe/Berlin&quot;);</span>
<a href="#l24.159"></a><span id="l24.159" class="difflineminus">-    do_check_eq(event.endDate.icalString, &quot;20060610T200000&quot;);</span>
<a href="#l24.160"></a><span id="l24.160" class="difflineminus">-    do_check_eq(event.getProperty(&quot;TRANSP&quot;), &quot;TRANSPARENT&quot;);</span>
<a href="#l24.161"></a><span id="l24.161" class="difflineminus">-    do_check_eq(event.privacy, &quot;PRIVATE&quot;);</span>
<a href="#l24.162"></a><span id="l24.162" class="difflineminus">-    do_check_eq(event.getProperty(&quot;SEQUENCE&quot;), 1);</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineplus">+    equal(event.id, &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;);</span>
<a href="#l24.164"></a><span id="l24.164" class="difflineplus">+    equal(event.getProperty(&quot;STATUS&quot;), &quot;CONFIRMED&quot;);</span>
<a href="#l24.165"></a><span id="l24.165" class="difflineplus">+    equal(event.getProperty(&quot;URL&quot;), gServer.baseUri + &quot;/calendar/event?eid=eventhash&quot;);</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineplus">+    equal(event.getProperty(&quot;CREATED&quot;).icalString, &quot;20060608T210452Z&quot;);</span>
<a href="#l24.167"></a><span id="l24.167" class="difflineplus">+    equal(event.getProperty(&quot;LAST-MODIFIED&quot;).icalString, &quot;20060608T210549Z&quot;);</span>
<a href="#l24.168"></a><span id="l24.168" class="difflineplus">+    equal(event.title, &quot;New Event&quot;);</span>
<a href="#l24.169"></a><span id="l24.169" class="difflineplus">+    equal(event.getProperty(&quot;DESCRIPTION&quot;), &quot;description&quot;);</span>
<a href="#l24.170"></a><span id="l24.170" class="difflineplus">+    equal(event.getProperty(&quot;LOCATION&quot;), &quot;Hard Drive&quot;);</span>
<a href="#l24.171"></a><span id="l24.171" class="difflineplus">+    equal(event.organizer.id, &quot;mailto:xpcshell@example.com&quot;);</span>
<a href="#l24.172"></a><span id="l24.172" class="difflineplus">+    equal(event.organizer.commonName, &quot;Eggs P. Seashell&quot;);</span>
<a href="#l24.173"></a><span id="l24.173" class="difflineplus">+    ok(event.organizer.isOrganizer);</span>
<a href="#l24.174"></a><span id="l24.174" class="difflineplus">+    equal(event.startDate.icalString, &quot;20060610T180000&quot;);</span>
<a href="#l24.175"></a><span id="l24.175" class="difflineplus">+    equal(event.startDate.timezone.tzid, &quot;Europe/Berlin&quot;);</span>
<a href="#l24.176"></a><span id="l24.176" class="difflineplus">+    equal(event.endDate.icalString, &quot;20060610T200000&quot;);</span>
<a href="#l24.177"></a><span id="l24.177" class="difflineplus">+    equal(event.getProperty(&quot;TRANSP&quot;), &quot;TRANSPARENT&quot;);</span>
<a href="#l24.178"></a><span id="l24.178" class="difflineplus">+    equal(event.privacy, &quot;PRIVATE&quot;);</span>
<a href="#l24.179"></a><span id="l24.179" class="difflineplus">+    equal(event.getProperty(&quot;SEQUENCE&quot;), 1);</span>
<a href="#l24.180"></a><span id="l24.180">     let alarms = event.getAlarms({});</span>
<a href="#l24.181"></a><span id="l24.181" class="difflineminus">-    do_check_eq(alarms.length, 1);</span>
<a href="#l24.182"></a><span id="l24.182" class="difflineminus">-    do_check_eq(alarms[0].action, &quot;EMAIL&quot;);</span>
<a href="#l24.183"></a><span id="l24.183" class="difflineminus">-    do_check_eq(alarms[0].related, alarms[0].ALARM_RELATED_START);</span>
<a href="#l24.184"></a><span id="l24.184" class="difflineminus">-    do_check_eq(alarms[0].offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l24.185"></a><span id="l24.185" class="difflineminus">-    do_check_null(alarms[0].getProperty(&quot;X-DEFAULT-ALARM&quot;));</span>
<a href="#l24.186"></a><span id="l24.186" class="difflineplus">+    equal(alarms.length, 1);</span>
<a href="#l24.187"></a><span id="l24.187" class="difflineplus">+    equal(alarms[0].action, &quot;EMAIL&quot;);</span>
<a href="#l24.188"></a><span id="l24.188" class="difflineplus">+    equal(alarms[0].related, alarms[0].ALARM_RELATED_START);</span>
<a href="#l24.189"></a><span id="l24.189" class="difflineplus">+    equal(alarms[0].offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l24.190"></a><span id="l24.190" class="difflineplus">+    equal(alarms[0].getProperty(&quot;X-DEFAULT-ALARM&quot;), null);</span>
<a href="#l24.191"></a><span id="l24.191">     let attendees = event.getAttendees({});</span>
<a href="#l24.192"></a><span id="l24.192" class="difflineminus">-    do_check_eq(attendees.length, 1);</span>
<a href="#l24.193"></a><span id="l24.193" class="difflineminus">-    do_check_eq(attendees[0].id, &quot;mailto:attendee@example.com&quot;);</span>
<a href="#l24.194"></a><span id="l24.194" class="difflineminus">-    do_check_eq(attendees[0].commonName, &quot;attendee name&quot;);</span>
<a href="#l24.195"></a><span id="l24.195" class="difflineminus">-    do_check_eq(attendees[0].role, &quot;OPT-PARTICIPANT&quot;);</span>
<a href="#l24.196"></a><span id="l24.196" class="difflineminus">-    do_check_eq(attendees[0].participationStatus, &quot;TENTATIVE&quot;);</span>
<a href="#l24.197"></a><span id="l24.197" class="difflineminus">-    do_check_eq(event.getCategories({}), &quot;foo,bar&quot;);</span>
<a href="#l24.198"></a><span id="l24.198" class="difflineminus">-    do_check_eq(event.alarmLastAck.icalString, &quot;20140101T010101Z&quot;);</span>
<a href="#l24.199"></a><span id="l24.199" class="difflineminus">-    do_check_eq(event.getProperty(&quot;X-MOZ-SNOOZE-TIME&quot;), &quot;20140101T020202Z&quot;);</span>
<a href="#l24.200"></a><span id="l24.200" class="difflineplus">+    equal(attendees.length, 1);</span>
<a href="#l24.201"></a><span id="l24.201" class="difflineplus">+    equal(attendees[0].id, &quot;mailto:attendee@example.com&quot;);</span>
<a href="#l24.202"></a><span id="l24.202" class="difflineplus">+    equal(attendees[0].commonName, &quot;attendee name&quot;);</span>
<a href="#l24.203"></a><span id="l24.203" class="difflineplus">+    equal(attendees[0].role, &quot;OPT-PARTICIPANT&quot;);</span>
<a href="#l24.204"></a><span id="l24.204" class="difflineplus">+    equal(attendees[0].participationStatus, &quot;TENTATIVE&quot;);</span>
<a href="#l24.205"></a><span id="l24.205" class="difflineplus">+    equal(event.getCategories({}), &quot;foo,bar&quot;);</span>
<a href="#l24.206"></a><span id="l24.206" class="difflineplus">+    equal(event.alarmLastAck.icalString, &quot;20140101T010101Z&quot;);</span>
<a href="#l24.207"></a><span id="l24.207" class="difflineplus">+    equal(event.getProperty(&quot;X-MOZ-SNOOZE-TIME&quot;), &quot;20140101T020202Z&quot;);</span>
<a href="#l24.208"></a><span id="l24.208"> </span>
<a href="#l24.209"></a><span id="l24.209">     let task = cal.isToDo(items[0]) ? items[0] : items[1];</span>
<a href="#l24.210"></a><span id="l24.210" class="difflineminus">-    do_check_eq(task.id, &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;);</span>
<a href="#l24.211"></a><span id="l24.211" class="difflineminus">-    do_check_eq(task.title, &quot;New Task&quot;);</span>
<a href="#l24.212"></a><span id="l24.212" class="difflineminus">-    do_check_eq(task.getProperty(&quot;LAST-MODIFIED&quot;).icalString, &quot;20140908T163027Z&quot;);</span>
<a href="#l24.213"></a><span id="l24.213" class="difflineminus">-    do_check_eq(task.getProperty(&quot;X-GOOGLE-SORTKEY&quot;), &quot;00000000000000130998&quot;);</span>
<a href="#l24.214"></a><span id="l24.214" class="difflineminus">-    do_check_true(task.isCompleted);</span>
<a href="#l24.215"></a><span id="l24.215" class="difflineminus">-    do_check_eq(task.dueDate.icalString, &quot;20140904&quot;);</span>
<a href="#l24.216"></a><span id="l24.216" class="difflineminus">-    do_check_eq(task.completedDate.icalString, &quot;20140901T170000Z&quot;);</span>
<a href="#l24.217"></a><span id="l24.217" class="difflineminus">-    do_check_eq(task.getProperty(&quot;DESCRIPTION&quot;), &quot;description&quot;);</span>
<a href="#l24.218"></a><span id="l24.218" class="difflineplus">+    equal(task.id, &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;);</span>
<a href="#l24.219"></a><span id="l24.219" class="difflineplus">+    equal(task.title, &quot;New Task&quot;);</span>
<a href="#l24.220"></a><span id="l24.220" class="difflineplus">+    equal(task.getProperty(&quot;LAST-MODIFIED&quot;).icalString, &quot;20140908T163027Z&quot;);</span>
<a href="#l24.221"></a><span id="l24.221" class="difflineplus">+    equal(task.getProperty(&quot;X-GOOGLE-SORTKEY&quot;), &quot;00000000000000130998&quot;);</span>
<a href="#l24.222"></a><span id="l24.222" class="difflineplus">+    ok(task.isCompleted);</span>
<a href="#l24.223"></a><span id="l24.223" class="difflineplus">+    equal(task.dueDate.icalString, &quot;20140904&quot;);</span>
<a href="#l24.224"></a><span id="l24.224" class="difflineplus">+    equal(task.completedDate.icalString, &quot;20140901T170000Z&quot;);</span>
<a href="#l24.225"></a><span id="l24.225" class="difflineplus">+    equal(task.getProperty(&quot;DESCRIPTION&quot;), &quot;description&quot;);</span>
<a href="#l24.226"></a><span id="l24.226">     let relations = task.getRelations({});</span>
<a href="#l24.227"></a><span id="l24.227" class="difflineminus">-    do_check_eq(relations.length, 1);</span>
<a href="#l24.228"></a><span id="l24.228" class="difflineminus">-    do_check_eq(relations[0].relType, &quot;PARENT&quot;);</span>
<a href="#l24.229"></a><span id="l24.229" class="difflineminus">-    do_check_eq(relations[0].relId, &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo4MDIzOTU2NDc&quot;);</span>
<a href="#l24.230"></a><span id="l24.230" class="difflineplus">+    equal(relations.length, 1);</span>
<a href="#l24.231"></a><span id="l24.231" class="difflineplus">+    equal(relations[0].relType, &quot;PARENT&quot;);</span>
<a href="#l24.232"></a><span id="l24.232" class="difflineplus">+    equal(relations[0].relId, &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo4MDIzOTU2NDc&quot;);</span>
<a href="#l24.233"></a><span id="l24.233">     let attachments = task.getAttachments({});</span>
<a href="#l24.234"></a><span id="l24.234" class="difflineminus">-    do_check_eq(attachments.length, 1);</span>
<a href="#l24.235"></a><span id="l24.235" class="difflineminus">-    do_check_eq(attachments[0].uri.spec, &quot;mailto:something@example.com&quot;);</span>
<a href="#l24.236"></a><span id="l24.236" class="difflineminus">-    do_check_eq(attachments[0].getParameter(&quot;X-GOOGLE-TYPE&quot;), &quot;email&quot;);</span>
<a href="#l24.237"></a><span id="l24.237" class="difflineminus">-    do_check_eq(attachments[0].getParameter(&quot;FILENAME&quot;), &quot;link description&quot;);</span>
<a href="#l24.238"></a><span id="l24.238" class="difflineplus">+    equal(attachments.length, 1);</span>
<a href="#l24.239"></a><span id="l24.239" class="difflineplus">+    equal(attachments[0].uri.spec, &quot;mailto:something@example.com&quot;);</span>
<a href="#l24.240"></a><span id="l24.240" class="difflineplus">+    equal(attachments[0].getParameter(&quot;X-GOOGLE-TYPE&quot;), &quot;email&quot;);</span>
<a href="#l24.241"></a><span id="l24.241" class="difflineplus">+    equal(attachments[0].getParameter(&quot;FILENAME&quot;), &quot;link description&quot;);</span>
<a href="#l24.242"></a><span id="l24.242"> </span>
<a href="#l24.243"></a><span id="l24.243">     gServer.resetClient(client);</span>
<a href="#l24.244"></a><span id="l24.244"> });</span>
<a href="#l24.245"></a><span id="l24.245"> </span>
<a href="#l24.246"></a><span id="l24.246"> add_task(function* test_addModifyDeleteItem() {</span>
<a href="#l24.247"></a><span id="l24.247">     let client = yield gServer.getClient();</span>
<a href="#l24.248"></a><span id="l24.248">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.249"></a><span id="l24.249" class="difflineminus">-    do_check_eq(gServer.events.length, 0);</span>
<a href="#l24.250"></a><span id="l24.250" class="difflineminus">-    do_check_eq(gServer.tasks.length, 0);</span>
<a href="#l24.251"></a><span id="l24.251" class="difflineplus">+    equal(gServer.events.length, 0);</span>
<a href="#l24.252"></a><span id="l24.252" class="difflineplus">+    equal(gServer.tasks.length, 0);</span>
<a href="#l24.253"></a><span id="l24.253"> </span>
<a href="#l24.254"></a><span id="l24.254">     let event = cal.createEvent([</span>
<a href="#l24.255"></a><span id="l24.255">         &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l24.256"></a><span id="l24.256">         &quot;CREATED:20060608T210452Z&quot;,</span>
<a href="#l24.257"></a><span id="l24.257">         &quot;LAST-MODIFIED:20060608T210549Z&quot;,</span>
<a href="#l24.258"></a><span id="l24.258">         &quot;DTSTAMP:20060608T210549Z&quot;,</span>
<a href="#l24.259"></a><span id="l24.259">         &quot;SUMMARY:New Event&quot;,</span>
<a href="#l24.260"></a><span id="l24.260">         &quot;STATUS:CONFIRMED&quot;,</span>
<a href="#l24.261"></a><span id="l24.261" class="difflineat">@@ -770,81 +770,81 @@ add_task(function* test_addModifyDeleteI</span>
<a href="#l24.262"></a><span id="l24.262">         &quot;COMPLETED:20140901T170000Z&quot;,</span>
<a href="#l24.263"></a><span id="l24.263">         &quot;RELATED-TO;RELTYPE=PARENT:MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo4MDIzOTU2NDc&quot;,</span>
<a href="#l24.264"></a><span id="l24.264">         &quot;ATTACH;FILENAME=\&quot;link description\&quot;;X-GOOGLE-TYPE=email:mailto:something@example.com&quot;,</span>
<a href="#l24.265"></a><span id="l24.265">         &quot;END:VTODO&quot;</span>
<a href="#l24.266"></a><span id="l24.266">     ].join(&quot;\r\n&quot;));</span>
<a href="#l24.267"></a><span id="l24.267"> </span>
<a href="#l24.268"></a><span id="l24.268">     // Add an event</span>
<a href="#l24.269"></a><span id="l24.269">     let addedEvent = yield pclient.adoptItem(event);</span>
<a href="#l24.270"></a><span id="l24.270" class="difflineminus">-    do_check_neq(addedEvent.id, null);</span>
<a href="#l24.271"></a><span id="l24.271" class="difflineminus">-    do_check_eq(addedEvent.organizer.id, &quot;mailto:xpcshell@example.com&quot;);</span>
<a href="#l24.272"></a><span id="l24.272" class="difflineplus">+    notEqual(addedEvent.id, null);</span>
<a href="#l24.273"></a><span id="l24.273" class="difflineplus">+    equal(addedEvent.organizer.id, &quot;mailto:xpcshell@example.com&quot;);</span>
<a href="#l24.274"></a><span id="l24.274"> </span>
<a href="#l24.275"></a><span id="l24.275">     let items = yield pclient.getAllItems();</span>
<a href="#l24.276"></a><span id="l24.276" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.277"></a><span id="l24.277" class="difflineminus">-    do_check_eq(items[0].id, addedEvent.id);</span>
<a href="#l24.278"></a><span id="l24.278" class="difflineminus">-    do_check_eq(items[0].organizer.id, &quot;mailto:xpcshell@example.com&quot;);</span>
<a href="#l24.279"></a><span id="l24.279" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.280"></a><span id="l24.280" class="difflineplus">+    equal(items[0].id, addedEvent.id);</span>
<a href="#l24.281"></a><span id="l24.281" class="difflineplus">+    equal(items[0].organizer.id, &quot;mailto:xpcshell@example.com&quot;);</span>
<a href="#l24.282"></a><span id="l24.282"> </span>
<a href="#l24.283"></a><span id="l24.283" class="difflineminus">-    do_check_eq(gServer.events.length, 1)</span>
<a href="#l24.284"></a><span id="l24.284" class="difflineminus">-    do_check_eq(gServer.tasks.length, 0);</span>
<a href="#l24.285"></a><span id="l24.285" class="difflineplus">+    equal(gServer.events.length, 1)</span>
<a href="#l24.286"></a><span id="l24.286" class="difflineplus">+    equal(gServer.tasks.length, 0);</span>
<a href="#l24.287"></a><span id="l24.287"> </span>
<a href="#l24.288"></a><span id="l24.288">     // Add a task</span>
<a href="#l24.289"></a><span id="l24.289">     let addedTask = yield pclient.adoptItem(task);</span>
<a href="#l24.290"></a><span id="l24.290" class="difflineminus">-    do_check_neq(addedTask.id, null);</span>
<a href="#l24.291"></a><span id="l24.291" class="difflineplus">+    notEqual(addedTask.id, null);</span>
<a href="#l24.292"></a><span id="l24.292"> </span>
<a href="#l24.293"></a><span id="l24.293">     items = yield pclient.getAllItems();</span>
<a href="#l24.294"></a><span id="l24.294" class="difflineminus">-    do_check_eq(items.length, 2);</span>
<a href="#l24.295"></a><span id="l24.295" class="difflineminus">-    do_check_eq(items[1].id, addedTask.id);</span>
<a href="#l24.296"></a><span id="l24.296" class="difflineplus">+    equal(items.length, 2);</span>
<a href="#l24.297"></a><span id="l24.297" class="difflineplus">+    equal(items[1].id, addedTask.id);</span>
<a href="#l24.298"></a><span id="l24.298"> </span>
<a href="#l24.299"></a><span id="l24.299" class="difflineminus">-    do_check_eq(gServer.events.length, 1)</span>
<a href="#l24.300"></a><span id="l24.300" class="difflineminus">-    do_check_eq(gServer.tasks.length, 1);</span>
<a href="#l24.301"></a><span id="l24.301" class="difflineplus">+    equal(gServer.events.length, 1)</span>
<a href="#l24.302"></a><span id="l24.302" class="difflineplus">+    equal(gServer.tasks.length, 1);</span>
<a href="#l24.303"></a><span id="l24.303"> </span>
<a href="#l24.304"></a><span id="l24.304">     // Modify an event</span>
<a href="#l24.305"></a><span id="l24.305">     let newEvent = items[0].clone();</span>
<a href="#l24.306"></a><span id="l24.306">     newEvent.title = &quot;changed&quot;;</span>
<a href="#l24.307"></a><span id="l24.307"> </span>
<a href="#l24.308"></a><span id="l24.308">     let modifiedEvent = yield pclient.modifyItem(newEvent, items[0]);</span>
<a href="#l24.309"></a><span id="l24.309" class="difflineminus">-    do_check_eq(modifiedEvent.title, &quot;changed&quot;);</span>
<a href="#l24.310"></a><span id="l24.310" class="difflineminus">-    do_check_neq(modifiedEvent.getProperty(&quot;LAST-MODIFIED&quot;), addedEvent.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.311"></a><span id="l24.311" class="difflineplus">+    equal(modifiedEvent.title, &quot;changed&quot;);</span>
<a href="#l24.312"></a><span id="l24.312" class="difflineplus">+    notEqual(modifiedEvent.getProperty(&quot;LAST-MODIFIED&quot;), addedEvent.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.313"></a><span id="l24.313">     items = yield pclient.getAllItems();</span>
<a href="#l24.314"></a><span id="l24.314" class="difflineminus">-    do_check_eq(items.length, 2);</span>
<a href="#l24.315"></a><span id="l24.315" class="difflineminus">-    do_check_eq(items[0].title, &quot;changed&quot;);</span>
<a href="#l24.316"></a><span id="l24.316" class="difflineminus">-    do_check_eq(items[0].id, addedEvent.id);</span>
<a href="#l24.317"></a><span id="l24.317" class="difflineminus">-    do_check_eq(items[0].getProperty(&quot;LAST-MODIFIED&quot;), modifiedEvent.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.318"></a><span id="l24.318" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.319"></a><span id="l24.319" class="difflineminus">-    do_check_eq(gServer.tasks.length, 1);</span>
<a href="#l24.320"></a><span id="l24.320" class="difflineplus">+    equal(items.length, 2);</span>
<a href="#l24.321"></a><span id="l24.321" class="difflineplus">+    equal(items[0].title, &quot;changed&quot;);</span>
<a href="#l24.322"></a><span id="l24.322" class="difflineplus">+    equal(items[0].id, addedEvent.id);</span>
<a href="#l24.323"></a><span id="l24.323" class="difflineplus">+    equal(items[0].getProperty(&quot;LAST-MODIFIED&quot;), modifiedEvent.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.324"></a><span id="l24.324" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.325"></a><span id="l24.325" class="difflineplus">+    equal(gServer.tasks.length, 1);</span>
<a href="#l24.326"></a><span id="l24.326"> </span>
<a href="#l24.327"></a><span id="l24.327">     // Modify a task</span>
<a href="#l24.328"></a><span id="l24.328">     let newTask = items[1].clone();</span>
<a href="#l24.329"></a><span id="l24.329">     newTask.title = &quot;changed&quot;;</span>
<a href="#l24.330"></a><span id="l24.330"> </span>
<a href="#l24.331"></a><span id="l24.331">     let modifiedTask = yield pclient.modifyItem(newTask, items[1]);</span>
<a href="#l24.332"></a><span id="l24.332" class="difflineminus">-    do_check_eq(modifiedTask.title, &quot;changed&quot;);</span>
<a href="#l24.333"></a><span id="l24.333" class="difflineminus">-    do_check_neq(modifiedTask.getProperty(&quot;LAST-MODIFIED&quot;), addedTask.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.334"></a><span id="l24.334" class="difflineplus">+    equal(modifiedTask.title, &quot;changed&quot;);</span>
<a href="#l24.335"></a><span id="l24.335" class="difflineplus">+    notEqual(modifiedTask.getProperty(&quot;LAST-MODIFIED&quot;), addedTask.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.336"></a><span id="l24.336">     items = yield pclient.getAllItems();</span>
<a href="#l24.337"></a><span id="l24.337" class="difflineminus">-    do_check_eq(items.length, 2);</span>
<a href="#l24.338"></a><span id="l24.338" class="difflineminus">-    do_check_eq(items[1].title, &quot;changed&quot;);</span>
<a href="#l24.339"></a><span id="l24.339" class="difflineminus">-    do_check_eq(items[1].id, addedTask.id);</span>
<a href="#l24.340"></a><span id="l24.340" class="difflineminus">-    do_check_eq(items[1].getProperty(&quot;LAST-MODIFIED&quot;), modifiedTask.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.341"></a><span id="l24.341" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.342"></a><span id="l24.342" class="difflineminus">-    do_check_eq(gServer.tasks.length, 1);</span>
<a href="#l24.343"></a><span id="l24.343" class="difflineplus">+    equal(items.length, 2);</span>
<a href="#l24.344"></a><span id="l24.344" class="difflineplus">+    equal(items[1].title, &quot;changed&quot;);</span>
<a href="#l24.345"></a><span id="l24.345" class="difflineplus">+    equal(items[1].id, addedTask.id);</span>
<a href="#l24.346"></a><span id="l24.346" class="difflineplus">+    equal(items[1].getProperty(&quot;LAST-MODIFIED&quot;), modifiedTask.getProperty(&quot;LAST-MODIFIED&quot;));</span>
<a href="#l24.347"></a><span id="l24.347" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.348"></a><span id="l24.348" class="difflineplus">+    equal(gServer.tasks.length, 1);</span>
<a href="#l24.349"></a><span id="l24.349"> </span>
<a href="#l24.350"></a><span id="l24.350">     // Delete an event</span>
<a href="#l24.351"></a><span id="l24.351">     yield pclient.deleteItem(modifiedEvent);</span>
<a href="#l24.352"></a><span id="l24.352">     items = yield pclient.getAllItems();</span>
<a href="#l24.353"></a><span id="l24.353" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.354"></a><span id="l24.354" class="difflineminus">-    do_check_eq(gServer.events.length, 0);</span>
<a href="#l24.355"></a><span id="l24.355" class="difflineminus">-    do_check_eq(gServer.tasks.length, 1);</span>
<a href="#l24.356"></a><span id="l24.356" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.357"></a><span id="l24.357" class="difflineplus">+    equal(gServer.events.length, 0);</span>
<a href="#l24.358"></a><span id="l24.358" class="difflineplus">+    equal(gServer.tasks.length, 1);</span>
<a href="#l24.359"></a><span id="l24.359"> </span>
<a href="#l24.360"></a><span id="l24.360">     // Delete a task</span>
<a href="#l24.361"></a><span id="l24.361">     yield pclient.deleteItem(modifiedTask);</span>
<a href="#l24.362"></a><span id="l24.362">     items = yield pclient.getAllItems();</span>
<a href="#l24.363"></a><span id="l24.363" class="difflineminus">-    do_check_eq(items.length, 0);</span>
<a href="#l24.364"></a><span id="l24.364" class="difflineminus">-    do_check_eq(gServer.events.length, 0);</span>
<a href="#l24.365"></a><span id="l24.365" class="difflineminus">-    do_check_eq(gServer.tasks.length, 0);</span>
<a href="#l24.366"></a><span id="l24.366" class="difflineplus">+    equal(items.length, 0);</span>
<a href="#l24.367"></a><span id="l24.367" class="difflineplus">+    equal(gServer.events.length, 0);</span>
<a href="#l24.368"></a><span id="l24.368" class="difflineplus">+    equal(gServer.tasks.length, 0);</span>
<a href="#l24.369"></a><span id="l24.369"> </span>
<a href="#l24.370"></a><span id="l24.370">     gServer.resetClient(client);</span>
<a href="#l24.371"></a><span id="l24.371"> });</span>
<a href="#l24.372"></a><span id="l24.372"> </span>
<a href="#l24.373"></a><span id="l24.373"> add_task(function* test_recurring_event() {</span>
<a href="#l24.374"></a><span id="l24.374">     let client = yield gServer.getClient();</span>
<a href="#l24.375"></a><span id="l24.375">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.376"></a><span id="l24.376"> </span>
<a href="#l24.377"></a><span id="l24.377" class="difflineat">@@ -853,29 +853,29 @@ add_task(function* test_recurring_event(</span>
<a href="#l24.378"></a><span id="l24.378">         &quot;SUMMARY:Recurring Event&quot;,</span>
<a href="#l24.379"></a><span id="l24.379">         &quot;DTSTART:20060610T180000Z&quot;,</span>
<a href="#l24.380"></a><span id="l24.380">         &quot;DTEND:20060610T200000Z&quot;,</span>
<a href="#l24.381"></a><span id="l24.381">         &quot;RRULE:FREQ=WEEKLY&quot;,</span>
<a href="#l24.382"></a><span id="l24.382">         &quot;END:VEVENT&quot;</span>
<a href="#l24.383"></a><span id="l24.383">     ].join(&quot;\r\n&quot;));</span>
<a href="#l24.384"></a><span id="l24.384"> </span>
<a href="#l24.385"></a><span id="l24.385">     event = yield pclient.addItem(event);</span>
<a href="#l24.386"></a><span id="l24.386" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.387"></a><span id="l24.387" class="difflineminus">-    do_check_eq(gServer.events[0].recurrence.length, 1);</span>
<a href="#l24.388"></a><span id="l24.388" class="difflineminus">-    do_check_eq(gServer.events[0].recurrence[0], &quot;RRULE:FREQ=WEEKLY&quot;);</span>
<a href="#l24.389"></a><span id="l24.389" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.390"></a><span id="l24.390" class="difflineplus">+    equal(gServer.events[0].recurrence.length, 1);</span>
<a href="#l24.391"></a><span id="l24.391" class="difflineplus">+    equal(gServer.events[0].recurrence[0], &quot;RRULE:FREQ=WEEKLY&quot;);</span>
<a href="#l24.392"></a><span id="l24.392"> </span>
<a href="#l24.393"></a><span id="l24.393">     let occ = event.recurrenceInfo.getNextOccurrence(event.startDate);</span>
<a href="#l24.394"></a><span id="l24.394">     let changedOcc = occ.clone();</span>
<a href="#l24.395"></a><span id="l24.395">     changedOcc.title = &quot;changed&quot;;</span>
<a href="#l24.396"></a><span id="l24.396">     event.recurrenceInfo.modifyException(occ, true);</span>
<a href="#l24.397"></a><span id="l24.397"> </span>
<a href="#l24.398"></a><span id="l24.398">     event = yield pclient.modifyItem(changedOcc, occ);</span>
<a href="#l24.399"></a><span id="l24.399">     occ = event.recurrenceInfo.getNextOccurrence(event.startDate);</span>
<a href="#l24.400"></a><span id="l24.400" class="difflineminus">-    do_check_eq(occ.title, &quot;changed&quot;);</span>
<a href="#l24.401"></a><span id="l24.401" class="difflineminus">-    do_check_eq(gServer.events.length, 2);</span>
<a href="#l24.402"></a><span id="l24.402" class="difflineplus">+    equal(occ.title, &quot;changed&quot;);</span>
<a href="#l24.403"></a><span id="l24.403" class="difflineplus">+    equal(gServer.events.length, 2);</span>
<a href="#l24.404"></a><span id="l24.404"> </span>
<a href="#l24.405"></a><span id="l24.405">     gServer.resetClient(client);</span>
<a href="#l24.406"></a><span id="l24.406"> });</span>
<a href="#l24.407"></a><span id="l24.407"> </span>
<a href="#l24.408"></a><span id="l24.408"> add_task(function* test_import_invitation() {</span>
<a href="#l24.409"></a><span id="l24.409">     Preferences.set(&quot;calendar.google.enableAttendees&quot;, true);</span>
<a href="#l24.410"></a><span id="l24.410">     let client = yield gServer.getClient();</span>
<a href="#l24.411"></a><span id="l24.411">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.412"></a><span id="l24.412" class="difflineat">@@ -894,18 +894,18 @@ add_task(function* test_import_invitatio</span>
<a href="#l24.413"></a><span id="l24.413">         &quot; ROLE=REQ-PARTICIPANT:mailto:xpcshell@example.com&quot;,</span>
<a href="#l24.414"></a><span id="l24.414">         &quot;DTSTART:20060610T180000Z&quot;,</span>
<a href="#l24.415"></a><span id="l24.415">         &quot;DTEND:20060610T200000Z&quot;,</span>
<a href="#l24.416"></a><span id="l24.416">         &quot;SEQUENCE:1&quot;,</span>
<a href="#l24.417"></a><span id="l24.417">         &quot;END:VEVENT&quot;</span>
<a href="#l24.418"></a><span id="l24.418">     ].join(&quot;\r\n&quot;));</span>
<a href="#l24.419"></a><span id="l24.419"> </span>
<a href="#l24.420"></a><span id="l24.420">     let addedItem = yield pclient.adoptItem(event);</span>
<a href="#l24.421"></a><span id="l24.421" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.422"></a><span id="l24.422" class="difflineminus">-    do_check_eq(addedItem.icalString, event.icalString);</span>
<a href="#l24.423"></a><span id="l24.423" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.424"></a><span id="l24.424" class="difflineplus">+    equal(addedItem.icalString, event.icalString);</span>
<a href="#l24.425"></a><span id="l24.425">     gServer.resetClient(client);</span>
<a href="#l24.426"></a><span id="l24.426">     Preferences.set(&quot;calendar.google.enableAttendees&quot;, false);</span>
<a href="#l24.427"></a><span id="l24.427"> });</span>
<a href="#l24.428"></a><span id="l24.428"> </span>
<a href="#l24.429"></a><span id="l24.429"> add_task(function* test_modify_invitation() {</span>
<a href="#l24.430"></a><span id="l24.430">     Preferences.set(&quot;calendar.google.enableAttendees&quot;, true);</span>
<a href="#l24.431"></a><span id="l24.431">     let organizer = {</span>
<a href="#l24.432"></a><span id="l24.432">         &quot;displayName&quot;: &quot;organizer name&quot;,</span>
<a href="#l24.433"></a><span id="l24.433" class="difflineat">@@ -941,33 +941,33 @@ add_task(function* test_modify_invitatio</span>
<a href="#l24.434"></a><span id="l24.434">       }</span>
<a href="#l24.435"></a><span id="l24.435">     ];</span>
<a href="#l24.436"></a><span id="l24.436"> </span>
<a href="#l24.437"></a><span id="l24.437">     // Case #1: User is attendee</span>
<a href="#l24.438"></a><span id="l24.438">     let client = yield gServer.getClient();</span>
<a href="#l24.439"></a><span id="l24.439">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.440"></a><span id="l24.440"> </span>
<a href="#l24.441"></a><span id="l24.441">     let items = yield pclient.getAllItems();</span>
<a href="#l24.442"></a><span id="l24.442" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.443"></a><span id="l24.443" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.444"></a><span id="l24.444"> </span>
<a href="#l24.445"></a><span id="l24.445">     let item = items[0];</span>
<a href="#l24.446"></a><span id="l24.446">     let att = cal.getInvitedAttendee(item);</span>
<a href="#l24.447"></a><span id="l24.447">     let newItem = item.clone();</span>
<a href="#l24.448"></a><span id="l24.448"> </span>
<a href="#l24.449"></a><span id="l24.449" class="difflineminus">-    do_check_neq(att, null);</span>
<a href="#l24.450"></a><span id="l24.450" class="difflineminus">-    do_check_eq(att.id, &quot;mailto:&quot; + attendee.email);</span>
<a href="#l24.451"></a><span id="l24.451" class="difflineminus">-    do_check_eq(att.participationStatus, &quot;NEEDS-ACTION&quot;);</span>
<a href="#l24.452"></a><span id="l24.452" class="difflineplus">+    notEqual(att, null);</span>
<a href="#l24.453"></a><span id="l24.453" class="difflineplus">+    equal(att.id, &quot;mailto:&quot; + attendee.email);</span>
<a href="#l24.454"></a><span id="l24.454" class="difflineplus">+    equal(att.participationStatus, &quot;NEEDS-ACTION&quot;);</span>
<a href="#l24.455"></a><span id="l24.455"> </span>
<a href="#l24.456"></a><span id="l24.456">     newItem.removeAttendee(att);</span>
<a href="#l24.457"></a><span id="l24.457">     att = att.clone();</span>
<a href="#l24.458"></a><span id="l24.458">     att.participationStatus = &quot;ACCEPTED&quot;;</span>
<a href="#l24.459"></a><span id="l24.459">     newItem.addAttendee(att);</span>
<a href="#l24.460"></a><span id="l24.460"> </span>
<a href="#l24.461"></a><span id="l24.461">     let modifiedItem = yield pclient.modifyItem(newItem, items[0]);</span>
<a href="#l24.462"></a><span id="l24.462" class="difflineminus">-    do_check_eq(gServer.lastMethod, &quot;PATCH&quot;);</span>
<a href="#l24.463"></a><span id="l24.463" class="difflineplus">+    equal(gServer.lastMethod, &quot;PATCH&quot;);</span>
<a href="#l24.464"></a><span id="l24.464"> </span>
<a href="#l24.465"></a><span id="l24.465">     // Case #2: User is organizer</span>
<a href="#l24.466"></a><span id="l24.466">     let events = gServer.events;</span>
<a href="#l24.467"></a><span id="l24.467">     gServer.resetClient(client);</span>
<a href="#l24.468"></a><span id="l24.468">     gServer.events = events;</span>
<a href="#l24.469"></a><span id="l24.469"> </span>
<a href="#l24.470"></a><span id="l24.470">     organizer = Object.assign({}, gServer.creator);</span>
<a href="#l24.471"></a><span id="l24.471">     organizer.responseStatus = &quot;accepted&quot;;</span>
<a href="#l24.472"></a><span id="l24.472" class="difflineat">@@ -981,33 +981,33 @@ add_task(function* test_modify_invitatio</span>
<a href="#l24.473"></a><span id="l24.473">     gServer.events[0].organizer = gServer.creator;</span>
<a href="#l24.474"></a><span id="l24.474">     gServer.events[0].creator = gServer.creator;</span>
<a href="#l24.475"></a><span id="l24.475">     gServer.events[0].attendees = [organizer, attendee];</span>
<a href="#l24.476"></a><span id="l24.476"> </span>
<a href="#l24.477"></a><span id="l24.477">     client = yield gServer.getClient();</span>
<a href="#l24.478"></a><span id="l24.478">     pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.479"></a><span id="l24.479"> </span>
<a href="#l24.480"></a><span id="l24.480">     items = yield pclient.getAllItems();</span>
<a href="#l24.481"></a><span id="l24.481" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.482"></a><span id="l24.482" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.483"></a><span id="l24.483"> </span>
<a href="#l24.484"></a><span id="l24.484">     item = items[0];</span>
<a href="#l24.485"></a><span id="l24.485">     let org = item.getAttendeeById(&quot;mailto:&quot; + organizer.email);</span>
<a href="#l24.486"></a><span id="l24.486">     newItem = item.clone();</span>
<a href="#l24.487"></a><span id="l24.487"> </span>
<a href="#l24.488"></a><span id="l24.488" class="difflineminus">-    do_check_neq(org, null);</span>
<a href="#l24.489"></a><span id="l24.489" class="difflineminus">-    do_check_eq(org.id, &quot;mailto:&quot; + organizer.email);</span>
<a href="#l24.490"></a><span id="l24.490" class="difflineminus">-    do_check_eq(org.participationStatus, &quot;ACCEPTED&quot;);</span>
<a href="#l24.491"></a><span id="l24.491" class="difflineplus">+    notEqual(org, null);</span>
<a href="#l24.492"></a><span id="l24.492" class="difflineplus">+    equal(org.id, &quot;mailto:&quot; + organizer.email);</span>
<a href="#l24.493"></a><span id="l24.493" class="difflineplus">+    equal(org.participationStatus, &quot;ACCEPTED&quot;);</span>
<a href="#l24.494"></a><span id="l24.494"> </span>
<a href="#l24.495"></a><span id="l24.495">     newItem.removeAttendee(org);</span>
<a href="#l24.496"></a><span id="l24.496">     org = org.clone();</span>
<a href="#l24.497"></a><span id="l24.497">     org.participationStatus = &quot;TENTATIVE&quot;;</span>
<a href="#l24.498"></a><span id="l24.498">     newItem.addAttendee(org);</span>
<a href="#l24.499"></a><span id="l24.499"> </span>
<a href="#l24.500"></a><span id="l24.500">     modifiedItem = yield pclient.modifyItem(newItem, items[0]);</span>
<a href="#l24.501"></a><span id="l24.501" class="difflineminus">-    do_check_eq(gServer.lastMethod, &quot;PUT&quot;);</span>
<a href="#l24.502"></a><span id="l24.502" class="difflineplus">+    equal(gServer.lastMethod, &quot;PUT&quot;);</span>
<a href="#l24.503"></a><span id="l24.503"> </span>
<a href="#l24.504"></a><span id="l24.504">     gServer.resetClient(client);</span>
<a href="#l24.505"></a><span id="l24.505"> });</span>
<a href="#l24.506"></a><span id="l24.506"> </span>
<a href="#l24.507"></a><span id="l24.507"> add_task(function* test_metadata() {</span>
<a href="#l24.508"></a><span id="l24.508">     gServer.events = [{</span>
<a href="#l24.509"></a><span id="l24.509">         &quot;kind&quot;: &quot;calendar#event&quot;,</span>
<a href="#l24.510"></a><span id="l24.510">         &quot;etag&quot;: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l24.511"></a><span id="l24.511" class="difflineat">@@ -1039,78 +1039,78 @@ add_task(function* test_metadata() {</span>
<a href="#l24.512"></a><span id="l24.512">     let client = yield gServer.getClient();</span>
<a href="#l24.513"></a><span id="l24.513">     let offline = client.wrappedJSObject.mCachedCalendar;</span>
<a href="#l24.514"></a><span id="l24.514">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.515"></a><span id="l24.515"> </span>
<a href="#l24.516"></a><span id="l24.516">     // Check initial metadata</span>
<a href="#l24.517"></a><span id="l24.517">     let items = yield pclient.getAllItems();</span>
<a href="#l24.518"></a><span id="l24.518">     let meta = getAllMeta(offline);</span>
<a href="#l24.519"></a><span id="l24.519">     let [event, task] = items;</span>
<a href="#l24.520"></a><span id="l24.520" class="difflineminus">-    do_check_true(cal.isEvent(event));</span>
<a href="#l24.521"></a><span id="l24.521" class="difflineminus">-    do_check_true(cal.isToDo(task));</span>
<a href="#l24.522"></a><span id="l24.522" class="difflineminus">-    do_check_eq(meta.size, 2);</span>
<a href="#l24.523"></a><span id="l24.523" class="difflineminus">-    do_check_eq(meta.get(event.hashId), ['&quot;1&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.524"></a><span id="l24.524" class="difflineminus">-    do_check_eq(meta.get(task.hashId), ['&quot;2&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.525"></a><span id="l24.525" class="difflineplus">+    ok(cal.isEvent(event));</span>
<a href="#l24.526"></a><span id="l24.526" class="difflineplus">+    ok(cal.isToDo(task));</span>
<a href="#l24.527"></a><span id="l24.527" class="difflineplus">+    equal(meta.size, 2);</span>
<a href="#l24.528"></a><span id="l24.528" class="difflineplus">+    equal(meta.get(event.hashId), ['&quot;1&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.529"></a><span id="l24.529" class="difflineplus">+    equal(meta.get(task.hashId), ['&quot;2&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.530"></a><span id="l24.530"> </span>
<a href="#l24.531"></a><span id="l24.531">     // Modify an event</span>
<a href="#l24.532"></a><span id="l24.532">     gServer.nextEtag = '&quot;3&quot;';</span>
<a href="#l24.533"></a><span id="l24.533">     let newEvent = event.clone();</span>
<a href="#l24.534"></a><span id="l24.534">     newEvent.title = &quot;changed&quot;;</span>
<a href="#l24.535"></a><span id="l24.535">     yield pclient.modifyItem(newEvent, event);</span>
<a href="#l24.536"></a><span id="l24.536"> </span>
<a href="#l24.537"></a><span id="l24.537">     items = yield pclient.getAllItems();</span>
<a href="#l24.538"></a><span id="l24.538">     meta = getAllMeta(offline);</span>
<a href="#l24.539"></a><span id="l24.539">     [event, task] = items;</span>
<a href="#l24.540"></a><span id="l24.540" class="difflineminus">-    do_check_true(cal.isEvent(event));</span>
<a href="#l24.541"></a><span id="l24.541" class="difflineminus">-    do_check_true(cal.isToDo(task));</span>
<a href="#l24.542"></a><span id="l24.542" class="difflineminus">-    do_check_eq(meta.size, 2);</span>
<a href="#l24.543"></a><span id="l24.543" class="difflineminus">-    do_check_eq(meta.get(event.hashId), ['&quot;3&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.544"></a><span id="l24.544" class="difflineminus">-    do_check_eq(meta.get(task.hashId), ['&quot;2&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.545"></a><span id="l24.545" class="difflineplus">+    ok(cal.isEvent(event));</span>
<a href="#l24.546"></a><span id="l24.546" class="difflineplus">+    ok(cal.isToDo(task));</span>
<a href="#l24.547"></a><span id="l24.547" class="difflineplus">+    equal(meta.size, 2);</span>
<a href="#l24.548"></a><span id="l24.548" class="difflineplus">+    equal(meta.get(event.hashId), ['&quot;3&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.549"></a><span id="l24.549" class="difflineplus">+    equal(meta.get(task.hashId), ['&quot;2&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.550"></a><span id="l24.550"> </span>
<a href="#l24.551"></a><span id="l24.551">     // Modify a task</span>
<a href="#l24.552"></a><span id="l24.552">     gServer.nextEtag = '&quot;4&quot;';</span>
<a href="#l24.553"></a><span id="l24.553">     let newTask = task.clone();</span>
<a href="#l24.554"></a><span id="l24.554">     newTask.title = &quot;changed&quot;;</span>
<a href="#l24.555"></a><span id="l24.555">     yield pclient.modifyItem(newTask, task);</span>
<a href="#l24.556"></a><span id="l24.556"> </span>
<a href="#l24.557"></a><span id="l24.557">     items = yield pclient.getAllItems();</span>
<a href="#l24.558"></a><span id="l24.558">     meta = getAllMeta(offline);</span>
<a href="#l24.559"></a><span id="l24.559">     [event, task] = items;</span>
<a href="#l24.560"></a><span id="l24.560" class="difflineminus">-    do_check_eq(meta.size, 2);</span>
<a href="#l24.561"></a><span id="l24.561" class="difflineminus">-    do_check_eq(meta.get(event.hashId), ['&quot;3&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.562"></a><span id="l24.562" class="difflineminus">-    do_check_eq(meta.get(task.hashId), ['&quot;4&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.563"></a><span id="l24.563" class="difflineplus">+    equal(meta.size, 2);</span>
<a href="#l24.564"></a><span id="l24.564" class="difflineplus">+    equal(meta.get(event.hashId), ['&quot;3&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.565"></a><span id="l24.565" class="difflineplus">+    equal(meta.get(task.hashId), ['&quot;4&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.566"></a><span id="l24.566"> </span>
<a href="#l24.567"></a><span id="l24.567">     // Delete an event</span>
<a href="#l24.568"></a><span id="l24.568">     yield pclient.deleteItem(event);</span>
<a href="#l24.569"></a><span id="l24.569">     meta = getAllMeta(offline);</span>
<a href="#l24.570"></a><span id="l24.570" class="difflineminus">-    do_check_eq(meta.size, 1);</span>
<a href="#l24.571"></a><span id="l24.571" class="difflineminus">-    do_check_eq(meta.get(task.hashId), ['&quot;4&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.572"></a><span id="l24.572" class="difflineplus">+    equal(meta.size, 1);</span>
<a href="#l24.573"></a><span id="l24.573" class="difflineplus">+    equal(meta.get(task.hashId), ['&quot;4&quot;', &quot;MTEyMDE2MDE5NzE0NjYzMDk4ODI6MDo0MDI1NDg2NjU&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.574"></a><span id="l24.574"> </span>
<a href="#l24.575"></a><span id="l24.575">     // Delete a task</span>
<a href="#l24.576"></a><span id="l24.576">     yield pclient.deleteItem(task);</span>
<a href="#l24.577"></a><span id="l24.577">     meta = getAllMeta(offline);</span>
<a href="#l24.578"></a><span id="l24.578" class="difflineminus">-    do_check_eq(meta.size, 0);</span>
<a href="#l24.579"></a><span id="l24.579" class="difflineplus">+    equal(meta.size, 0);</span>
<a href="#l24.580"></a><span id="l24.580"> </span>
<a href="#l24.581"></a><span id="l24.581">     // Add an event</span>
<a href="#l24.582"></a><span id="l24.582">     gServer.nextEtag = '&quot;6&quot;';</span>
<a href="#l24.583"></a><span id="l24.583">     newEvent = yield pclient.addItem(event);</span>
<a href="#l24.584"></a><span id="l24.584">     meta = getAllMeta(offline);</span>
<a href="#l24.585"></a><span id="l24.585" class="difflineminus">-    do_check_eq(meta.size, 1);</span>
<a href="#l24.586"></a><span id="l24.586" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.587"></a><span id="l24.587" class="difflineminus">-    do_check_eq(meta.get(newEvent.hashId), ['&quot;6&quot;', gServer.events[0].id, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.588"></a><span id="l24.588" class="difflineplus">+    equal(meta.size, 1);</span>
<a href="#l24.589"></a><span id="l24.589" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.590"></a><span id="l24.590" class="difflineplus">+    equal(meta.get(newEvent.hashId), ['&quot;6&quot;', gServer.events[0].id, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.591"></a><span id="l24.591"> </span>
<a href="#l24.592"></a><span id="l24.592">     // Add a task</span>
<a href="#l24.593"></a><span id="l24.593">     gServer.nextEtag = '&quot;7&quot;';</span>
<a href="#l24.594"></a><span id="l24.594">     newTask = yield pclient.addItem(task);</span>
<a href="#l24.595"></a><span id="l24.595">     meta = getAllMeta(offline);</span>
<a href="#l24.596"></a><span id="l24.596" class="difflineminus">-    do_check_eq(meta.size, 2);</span>
<a href="#l24.597"></a><span id="l24.597" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.598"></a><span id="l24.598" class="difflineminus">-    do_check_eq(gServer.tasks.length, 1);</span>
<a href="#l24.599"></a><span id="l24.599" class="difflineminus">-    do_check_eq(meta.get(newEvent.hashId), ['&quot;6&quot;', gServer.events[0].id, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.600"></a><span id="l24.600" class="difflineminus">-    do_check_eq(meta.get(newTask.hashId), ['&quot;7&quot;', gServer.tasks[0].id, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.601"></a><span id="l24.601" class="difflineplus">+    equal(meta.size, 2);</span>
<a href="#l24.602"></a><span id="l24.602" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.603"></a><span id="l24.603" class="difflineplus">+    equal(gServer.tasks.length, 1);</span>
<a href="#l24.604"></a><span id="l24.604" class="difflineplus">+    equal(meta.get(newEvent.hashId), ['&quot;6&quot;', gServer.events[0].id, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.605"></a><span id="l24.605" class="difflineplus">+    equal(meta.get(newTask.hashId), ['&quot;7&quot;', gServer.tasks[0].id, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.606"></a><span id="l24.606"> </span>
<a href="#l24.607"></a><span id="l24.607">     gServer.resetClient(client);</span>
<a href="#l24.608"></a><span id="l24.608"> });</span>
<a href="#l24.609"></a><span id="l24.609"> </span>
<a href="#l24.610"></a><span id="l24.610"> add_task(function* test_metadata_recurring() {</span>
<a href="#l24.611"></a><span id="l24.611">     gServer.events = [{</span>
<a href="#l24.612"></a><span id="l24.612">         &quot;kind&quot;: &quot;calendar#event&quot;,</span>
<a href="#l24.613"></a><span id="l24.613">         &quot;etag&quot;: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l24.614"></a><span id="l24.614" class="difflineat">@@ -1147,46 +1147,46 @@ add_task(function* test_metadata_recurri</span>
<a href="#l24.615"></a><span id="l24.615">     }];</span>
<a href="#l24.616"></a><span id="l24.616"> </span>
<a href="#l24.617"></a><span id="l24.617">     let client = yield gServer.getClient();</span>
<a href="#l24.618"></a><span id="l24.618">     let offline = client.wrappedJSObject.mCachedCalendar;</span>
<a href="#l24.619"></a><span id="l24.619">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.620"></a><span id="l24.620">     let items = yield pclient.getAllItems();</span>
<a href="#l24.621"></a><span id="l24.621"> </span>
<a href="#l24.622"></a><span id="l24.622">     let meta = getAllMeta(offline);</span>
<a href="#l24.623"></a><span id="l24.623" class="difflineminus">-    do_check_eq(meta.size, 3);</span>
<a href="#l24.624"></a><span id="l24.624" class="difflineminus">-    do_check_eq(meta.get(items[0].hashId), ['&quot;1&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.625"></a><span id="l24.625" class="difflineplus">+    equal(meta.size, 3);</span>
<a href="#l24.626"></a><span id="l24.626" class="difflineplus">+    equal(meta.get(items[0].hashId), ['&quot;1&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.627"></a><span id="l24.627"> </span>
<a href="#l24.628"></a><span id="l24.628">     // The exception metadata should also exist</span>
<a href="#l24.629"></a><span id="l24.629">     let exIds = items[0].recurrenceInfo.getExceptionIds({});</span>
<a href="#l24.630"></a><span id="l24.630" class="difflineminus">-    do_check_eq(exIds.length, 2);</span>
<a href="#l24.631"></a><span id="l24.631" class="difflineplus">+    equal(exIds.length, 2);</span>
<a href="#l24.632"></a><span id="l24.632">     let ex = items[0].recurrenceInfo.getExceptionFor(exIds[0]);</span>
<a href="#l24.633"></a><span id="l24.633" class="difflineminus">-    do_check_eq(meta.get(ex.hashId), ['&quot;2&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo_20060610T160000Z&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.634"></a><span id="l24.634" class="difflineplus">+    equal(meta.get(ex.hashId), ['&quot;2&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo_20060610T160000Z&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.635"></a><span id="l24.635"> </span>
<a href="#l24.636"></a><span id="l24.636">     // Changing an exception should retain the metadata entries</span>
<a href="#l24.637"></a><span id="l24.637">     let newEx = ex.clone();</span>
<a href="#l24.638"></a><span id="l24.638">     newEx.title = &quot;New Event changed again&quot;;</span>
<a href="#l24.639"></a><span id="l24.639">     gServer.nextEtag = '&quot;4&quot;';</span>
<a href="#l24.640"></a><span id="l24.640">     yield pclient.modifyItem(newEx, ex);</span>
<a href="#l24.641"></a><span id="l24.641">     meta = getAllMeta(offline);</span>
<a href="#l24.642"></a><span id="l24.642" class="difflineminus">-    do_check_eq(meta.size, 3);</span>
<a href="#l24.643"></a><span id="l24.643" class="difflineminus">-    do_check_eq(meta.get(newEx.hashId), ['&quot;4&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo_20060610T160000Z&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.644"></a><span id="l24.644" class="difflineplus">+    equal(meta.size, 3);</span>
<a href="#l24.645"></a><span id="l24.645" class="difflineplus">+    equal(meta.get(newEx.hashId), ['&quot;4&quot;', &quot;go6ijb0b46hlpbu4eeu92njevo_20060610T160000Z&quot;, false].join(&quot;\u001A&quot;));</span>
<a href="#l24.646"></a><span id="l24.646"> </span>
<a href="#l24.647"></a><span id="l24.647">     // Deleting an exception should delete the metadata, as it turns into an EXDATE</span>
<a href="#l24.648"></a><span id="l24.648">     let newItem = items[0].clone();</span>
<a href="#l24.649"></a><span id="l24.649">     newItem.recurrenceInfo.removeOccurrenceAt(exIds[0]);</span>
<a href="#l24.650"></a><span id="l24.650">     yield pclient.modifyItem(newItem, items[0]);</span>
<a href="#l24.651"></a><span id="l24.651"> </span>
<a href="#l24.652"></a><span id="l24.652">     meta = getAllMeta(offline);</span>
<a href="#l24.653"></a><span id="l24.653" class="difflineminus">-    do_check_eq(meta.size, 2);</span>
<a href="#l24.654"></a><span id="l24.654" class="difflineplus">+    equal(meta.size, 2);</span>
<a href="#l24.655"></a><span id="l24.655"> </span>
<a href="#l24.656"></a><span id="l24.656">     // Deleting the master item should remove all metadata entries</span>
<a href="#l24.657"></a><span id="l24.657">     yield pclient.deleteItem(items[0]);</span>
<a href="#l24.658"></a><span id="l24.658">     meta = getAllMeta(offline);</span>
<a href="#l24.659"></a><span id="l24.659" class="difflineminus">-    do_check_eq(meta.size, 0);</span>
<a href="#l24.660"></a><span id="l24.660" class="difflineplus">+    equal(meta.size, 0);</span>
<a href="#l24.661"></a><span id="l24.661"> </span>
<a href="#l24.662"></a><span id="l24.662">     gServer.resetClient(client);</span>
<a href="#l24.663"></a><span id="l24.663"> });</span>
<a href="#l24.664"></a><span id="l24.664"> </span>
<a href="#l24.665"></a><span id="l24.665"> add_task(function* test_conflict_modify() {</span>
<a href="#l24.666"></a><span id="l24.666">     // TODO task/event conflicts are handled in the same way so I'm going to</span>
<a href="#l24.667"></a><span id="l24.667">     // skip adding tests for tasks here, but it probably wouldn't hurt to</span>
<a href="#l24.668"></a><span id="l24.668">     // create them at some point.</span>
<a href="#l24.669"></a><span id="l24.669" class="difflineat">@@ -1210,65 +1210,65 @@ add_task(function* test_conflict_modify(</span>
<a href="#l24.670"></a><span id="l24.670">     // Case #1: Modified on server, modify locally, overwrite conflict</span>
<a href="#l24.671"></a><span id="l24.671">     MockConflictPrompt.overwrite = true;</span>
<a href="#l24.672"></a><span id="l24.672">     let newItem = item.clone();</span>
<a href="#l24.673"></a><span id="l24.673">     newItem.title = &quot;local change&quot;;</span>
<a href="#l24.674"></a><span id="l24.674">     gServer.events[0].etag = '&quot;2&quot;';</span>
<a href="#l24.675"></a><span id="l24.675">     gServer.events[0].summary = &quot;remote change&quot;;</span>
<a href="#l24.676"></a><span id="l24.676">     let modifiedItem = yield pclient.modifyItem(newItem, item);</span>
<a href="#l24.677"></a><span id="l24.677">     item = (yield pclient.getAllItems())[0];</span>
<a href="#l24.678"></a><span id="l24.678" class="difflineminus">-    do_check_eq(gServer.events[0].summary, &quot;local change&quot;);</span>
<a href="#l24.679"></a><span id="l24.679" class="difflineminus">-    do_check_neq(gServer.events[0].etag, '&quot;2&quot;')</span>
<a href="#l24.680"></a><span id="l24.680" class="difflineminus">-    do_check_eq(item.title, &quot;local change&quot;);</span>
<a href="#l24.681"></a><span id="l24.681" class="difflineminus">-    do_check_eq(modifiedItem.title, &quot;local change&quot;);</span>
<a href="#l24.682"></a><span id="l24.682" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.683"></a><span id="l24.683" class="difflineplus">+    equal(gServer.events[0].summary, &quot;local change&quot;);</span>
<a href="#l24.684"></a><span id="l24.684" class="difflineplus">+    notEqual(gServer.events[0].etag, '&quot;2&quot;')</span>
<a href="#l24.685"></a><span id="l24.685" class="difflineplus">+    equal(item.title, &quot;local change&quot;);</span>
<a href="#l24.686"></a><span id="l24.686" class="difflineplus">+    equal(modifiedItem.title, &quot;local change&quot;);</span>
<a href="#l24.687"></a><span id="l24.687" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.688"></a><span id="l24.688"> </span>
<a href="#l24.689"></a><span id="l24.689">     // Case #2: Modified on server, modify locally, don't overwrite conflict</span>
<a href="#l24.690"></a><span id="l24.690">     MockConflictPrompt.overwrite = false;</span>
<a href="#l24.691"></a><span id="l24.691">     gServer.events[0].etag = '&quot;3&quot;';</span>
<a href="#l24.692"></a><span id="l24.692">     gServer.events[0].summary = &quot;remote change&quot;;</span>
<a href="#l24.693"></a><span id="l24.693">     try {</span>
<a href="#l24.694"></a><span id="l24.694">         modifiedItem = yield pclient.modifyItem(newItem, item);</span>
<a href="#l24.695"></a><span id="l24.695">         do_throw(&quot;Expected modifyItem to be cancelled&quot;);</span>
<a href="#l24.696"></a><span id="l24.696">     } catch (e if e == Components.interfaces.calIErrors.OPERATION_CANCELLED) {</span>
<a href="#l24.697"></a><span id="l24.697">         // Swallow cancelling the request</span>
<a href="#l24.698"></a><span id="l24.698">     }</span>
<a href="#l24.699"></a><span id="l24.699"> </span>
<a href="#l24.700"></a><span id="l24.700">     yield gServer.waitForLoad(client);</span>
<a href="#l24.701"></a><span id="l24.701"> </span>
<a href="#l24.702"></a><span id="l24.702">     item = (yield pclient.getAllItems())[0];</span>
<a href="#l24.703"></a><span id="l24.703" class="difflineminus">-    do_check_eq(gServer.events[0].summary, &quot;remote change&quot;);</span>
<a href="#l24.704"></a><span id="l24.704" class="difflineminus">-    do_check_eq(gServer.events[0].etag, '&quot;3&quot;')</span>
<a href="#l24.705"></a><span id="l24.705" class="difflineminus">-    do_check_eq(item.title, &quot;remote change&quot;);</span>
<a href="#l24.706"></a><span id="l24.706" class="difflineplus">+    equal(gServer.events[0].summary, &quot;remote change&quot;);</span>
<a href="#l24.707"></a><span id="l24.707" class="difflineplus">+    equal(gServer.events[0].etag, '&quot;3&quot;')</span>
<a href="#l24.708"></a><span id="l24.708" class="difflineplus">+    equal(item.title, &quot;remote change&quot;);</span>
<a href="#l24.709"></a><span id="l24.709"> </span>
<a href="#l24.710"></a><span id="l24.710">     // Case #3: Modified on server, delete locally, don't overwrite conflict</span>
<a href="#l24.711"></a><span id="l24.711">     MockConflictPrompt.overwrite = false;</span>
<a href="#l24.712"></a><span id="l24.712">     gServer.events[0].etag = '&quot;4&quot;';</span>
<a href="#l24.713"></a><span id="l24.713">     gServer.events[0].summary = &quot;remote change&quot;;</span>
<a href="#l24.714"></a><span id="l24.714">     try {</span>
<a href="#l24.715"></a><span id="l24.715">         yield pclient.deleteItem(item);</span>
<a href="#l24.716"></a><span id="l24.716">         do_throw(&quot;Expected deleteItem to be cancelled&quot;);</span>
<a href="#l24.717"></a><span id="l24.717">     } catch (e if e == Components.interfaces.calIErrors.OPERATION_CANCELLED) {</span>
<a href="#l24.718"></a><span id="l24.718">         // Swallow cancelling the request</span>
<a href="#l24.719"></a><span id="l24.719">     }</span>
<a href="#l24.720"></a><span id="l24.720"> </span>
<a href="#l24.721"></a><span id="l24.721">     yield gServer.waitForLoad(client);</span>
<a href="#l24.722"></a><span id="l24.722"> </span>
<a href="#l24.723"></a><span id="l24.723">     item = (yield pclient.getAllItems())[0];</span>
<a href="#l24.724"></a><span id="l24.724" class="difflineminus">-    do_check_eq(gServer.events[0].summary, &quot;remote change&quot;);</span>
<a href="#l24.725"></a><span id="l24.725" class="difflineminus">-    do_check_eq(gServer.events[0].etag, '&quot;4&quot;')</span>
<a href="#l24.726"></a><span id="l24.726" class="difflineminus">-    do_check_eq(item.title, &quot;remote change&quot;);</span>
<a href="#l24.727"></a><span id="l24.727" class="difflineplus">+    equal(gServer.events[0].summary, &quot;remote change&quot;);</span>
<a href="#l24.728"></a><span id="l24.728" class="difflineplus">+    equal(gServer.events[0].etag, '&quot;4&quot;')</span>
<a href="#l24.729"></a><span id="l24.729" class="difflineplus">+    equal(item.title, &quot;remote change&quot;);</span>
<a href="#l24.730"></a><span id="l24.730"> </span>
<a href="#l24.731"></a><span id="l24.731">     // Case #4: Modified on server, delete locally, overwrite conflict</span>
<a href="#l24.732"></a><span id="l24.732">     MockConflictPrompt.overwrite = true;</span>
<a href="#l24.733"></a><span id="l24.733">     gServer.events[0].etag = '&quot;5&quot;';</span>
<a href="#l24.734"></a><span id="l24.734">     gServer.events[0].summary = &quot;remote change&quot;;</span>
<a href="#l24.735"></a><span id="l24.735">     yield pclient.deleteItem(item);</span>
<a href="#l24.736"></a><span id="l24.736">     item = (yield pclient.getAllItems())[0];</span>
<a href="#l24.737"></a><span id="l24.737" class="difflineminus">-    do_check_eq(gServer.events.length, 0);</span>
<a href="#l24.738"></a><span id="l24.738" class="difflineplus">+    equal(gServer.events.length, 0);</span>
<a href="#l24.739"></a><span id="l24.739"> </span>
<a href="#l24.740"></a><span id="l24.740">     gServer.resetClient(client);</span>
<a href="#l24.741"></a><span id="l24.741"> });</span>
<a href="#l24.742"></a><span id="l24.742"> </span>
<a href="#l24.743"></a><span id="l24.743"> add_task(function* test_conflict_delete() {</span>
<a href="#l24.744"></a><span id="l24.744">     // TODO task/event conflicts are handled in the same way so I'm going to</span>
<a href="#l24.745"></a><span id="l24.745">     // skip adding tests for tasks here, but it probably wouldn't hurt to</span>
<a href="#l24.746"></a><span id="l24.746">     // create them at some point.</span>
<a href="#l24.747"></a><span id="l24.747" class="difflineat">@@ -1294,21 +1294,21 @@ add_task(function* test_conflict_delete(</span>
<a href="#l24.748"></a><span id="l24.748"> </span>
<a href="#l24.749"></a><span id="l24.749">     // Case #1: Deleted on server, modify locally, overwrite conflict</span>
<a href="#l24.750"></a><span id="l24.750">     MockConflictPrompt.overwrite = true;</span>
<a href="#l24.751"></a><span id="l24.751">     gServer.events = [];</span>
<a href="#l24.752"></a><span id="l24.752">     let newItem = item.clone();</span>
<a href="#l24.753"></a><span id="l24.753">     newItem.title = &quot;local change&quot;;</span>
<a href="#l24.754"></a><span id="l24.754">     let modifiedItem = yield pclient.modifyItem(newItem, item);</span>
<a href="#l24.755"></a><span id="l24.755">     item = (yield pclient.getAllItems())[0];</span>
<a href="#l24.756"></a><span id="l24.756" class="difflineminus">-    do_check_eq(gServer.events[0].summary, &quot;local change&quot;);</span>
<a href="#l24.757"></a><span id="l24.757" class="difflineminus">-    do_check_neq(gServer.events[0].etag, '&quot;2&quot;')</span>
<a href="#l24.758"></a><span id="l24.758" class="difflineminus">-    do_check_eq(item.title, &quot;local change&quot;);</span>
<a href="#l24.759"></a><span id="l24.759" class="difflineminus">-    do_check_eq(modifiedItem.title, &quot;local change&quot;);</span>
<a href="#l24.760"></a><span id="l24.760" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.761"></a><span id="l24.761" class="difflineplus">+    equal(gServer.events[0].summary, &quot;local change&quot;);</span>
<a href="#l24.762"></a><span id="l24.762" class="difflineplus">+    notEqual(gServer.events[0].etag, '&quot;2&quot;')</span>
<a href="#l24.763"></a><span id="l24.763" class="difflineplus">+    equal(item.title, &quot;local change&quot;);</span>
<a href="#l24.764"></a><span id="l24.764" class="difflineplus">+    equal(modifiedItem.title, &quot;local change&quot;);</span>
<a href="#l24.765"></a><span id="l24.765" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.766"></a><span id="l24.766"> </span>
<a href="#l24.767"></a><span id="l24.767">     // Case #2: Deleted on server, modify locally, don't overwrite conflict</span>
<a href="#l24.768"></a><span id="l24.768">     MockConflictPrompt.overwrite = false;</span>
<a href="#l24.769"></a><span id="l24.769">     gServer.events = [];</span>
<a href="#l24.770"></a><span id="l24.770">     try {</span>
<a href="#l24.771"></a><span id="l24.771">         modifiedItem = yield pclient.modifyItem(newItem, item);</span>
<a href="#l24.772"></a><span id="l24.772">         do_throw(&quot;Expected modifyItem to be cancelled&quot;);</span>
<a href="#l24.773"></a><span id="l24.773">     } catch (e if e == Components.interfaces.calIErrors.OPERATION_CANCELLED) {</span>
<a href="#l24.774"></a><span id="l24.774" class="difflineat">@@ -1316,56 +1316,56 @@ add_task(function* test_conflict_delete(</span>
<a href="#l24.775"></a><span id="l24.775">     }</span>
<a href="#l24.776"></a><span id="l24.776">     // The next synchronize should cause the event to be deleted locally.</span>
<a href="#l24.777"></a><span id="l24.777">     coreEvent.status = &quot;cancelled&quot;;</span>
<a href="#l24.778"></a><span id="l24.778">     gServer.events = [coreEvent];</span>
<a href="#l24.779"></a><span id="l24.779"> </span>
<a href="#l24.780"></a><span id="l24.780">     yield gServer.waitForLoad(client);</span>
<a href="#l24.781"></a><span id="l24.781"> </span>
<a href="#l24.782"></a><span id="l24.782">     let items = yield pclient.getAllItems();</span>
<a href="#l24.783"></a><span id="l24.783" class="difflineminus">-    do_check_eq(items.length, 0);</span>
<a href="#l24.784"></a><span id="l24.784" class="difflineminus">-    do_check_eq(gServer.events.length, 1);</span>
<a href="#l24.785"></a><span id="l24.785" class="difflineplus">+    equal(items.length, 0);</span>
<a href="#l24.786"></a><span id="l24.786" class="difflineplus">+    equal(gServer.events.length, 1);</span>
<a href="#l24.787"></a><span id="l24.787"> </span>
<a href="#l24.788"></a><span id="l24.788">     // Put the event back in the calendar for the next run</span>
<a href="#l24.789"></a><span id="l24.789">     delete gServer.events[0].status;</span>
<a href="#l24.790"></a><span id="l24.790">     client.refresh();</span>
<a href="#l24.791"></a><span id="l24.791">     yield gServer.waitForLoad(client);</span>
<a href="#l24.792"></a><span id="l24.792">     items = yield pclient.getAllItems();</span>
<a href="#l24.793"></a><span id="l24.793" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.794"></a><span id="l24.794" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.795"></a><span id="l24.795"> </span>
<a href="#l24.796"></a><span id="l24.796">     // Case #3: Deleted on server, delete locally, don't overwrite conflict</span>
<a href="#l24.797"></a><span id="l24.797">     MockConflictPrompt.overwrite = false;</span>
<a href="#l24.798"></a><span id="l24.798">     gServer.events = [];</span>
<a href="#l24.799"></a><span id="l24.799">     try {</span>
<a href="#l24.800"></a><span id="l24.800">         yield pclient.deleteItem(item);</span>
<a href="#l24.801"></a><span id="l24.801">         do_throw(&quot;Expected deleteItem to be cancelled&quot;);</span>
<a href="#l24.802"></a><span id="l24.802">     } catch (e if e == Components.interfaces.calIErrors.OPERATION_CANCELLED) {</span>
<a href="#l24.803"></a><span id="l24.803">         // Swallow cancelling the request</span>
<a href="#l24.804"></a><span id="l24.804">     }</span>
<a href="#l24.805"></a><span id="l24.805">     // The next synchronize should cause the event to be deleted locally.</span>
<a href="#l24.806"></a><span id="l24.806">     coreEvent.status = &quot;cancelled&quot;;</span>
<a href="#l24.807"></a><span id="l24.807">     gServer.events = [coreEvent];</span>
<a href="#l24.808"></a><span id="l24.808">     yield gServer.waitForLoad(client);</span>
<a href="#l24.809"></a><span id="l24.809"> </span>
<a href="#l24.810"></a><span id="l24.810">     items = yield pclient.getAllItems();</span>
<a href="#l24.811"></a><span id="l24.811" class="difflineminus">-    do_check_eq(items.length, 0);</span>
<a href="#l24.812"></a><span id="l24.812" class="difflineplus">+    equal(items.length, 0);</span>
<a href="#l24.813"></a><span id="l24.813"> </span>
<a href="#l24.814"></a><span id="l24.814">     // Put the event back in the calendar for the next run</span>
<a href="#l24.815"></a><span id="l24.815">     delete gServer.events[0].status;</span>
<a href="#l24.816"></a><span id="l24.816">     client.refresh();</span>
<a href="#l24.817"></a><span id="l24.817">     yield gServer.waitForLoad(client);</span>
<a href="#l24.818"></a><span id="l24.818">     items = yield pclient.getAllItems();</span>
<a href="#l24.819"></a><span id="l24.819" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.820"></a><span id="l24.820" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.821"></a><span id="l24.821"> </span>
<a href="#l24.822"></a><span id="l24.822">     // Case #4: Deleted on server, delete locally, overwrite conflict</span>
<a href="#l24.823"></a><span id="l24.823">     MockConflictPrompt.overwrite = true;</span>
<a href="#l24.824"></a><span id="l24.824">     gServer.events = [];</span>
<a href="#l24.825"></a><span id="l24.825">     yield pclient.deleteItem(item);</span>
<a href="#l24.826"></a><span id="l24.826">     items = yield pclient.getAllItems();</span>
<a href="#l24.827"></a><span id="l24.827" class="difflineminus">-    do_check_eq(items.length, 0);</span>
<a href="#l24.828"></a><span id="l24.828" class="difflineplus">+    equal(items.length, 0);</span>
<a href="#l24.829"></a><span id="l24.829"> </span>
<a href="#l24.830"></a><span id="l24.830">     gServer.resetClient(client);</span>
<a href="#l24.831"></a><span id="l24.831"> });</span>
<a href="#l24.832"></a><span id="l24.832"> </span>
<a href="#l24.833"></a><span id="l24.833"> add_task(function* test_default_alarms() {</span>
<a href="#l24.834"></a><span id="l24.834">     let defaultReminders = [</span>
<a href="#l24.835"></a><span id="l24.835">         { method: &quot;popup&quot;, minutes: 10 },</span>
<a href="#l24.836"></a><span id="l24.836">         { method: &quot;email&quot;, minutes: 20 },</span>
<a href="#l24.837"></a><span id="l24.837" class="difflineat">@@ -1385,27 +1385,27 @@ add_task(function* test_default_alarms()</span>
<a href="#l24.838"></a><span id="l24.838">        &quot;end&quot;: {&quot;dateTime&quot;: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l24.839"></a><span id="l24.839">        &quot;iCalUID&quot;: &quot;go6ijb0b46hlpbu4eeu92njevo@google.com&quot;,</span>
<a href="#l24.840"></a><span id="l24.840">        &quot;reminders&quot;: { &quot;useDefault&quot;: true }</span>
<a href="#l24.841"></a><span id="l24.841">     }];</span>
<a href="#l24.842"></a><span id="l24.842"> </span>
<a href="#l24.843"></a><span id="l24.843">     // Case #1: read default alarms from event stream</span>
<a href="#l24.844"></a><span id="l24.844">     let client = yield gServer.getClient();</span>
<a href="#l24.845"></a><span id="l24.845">     let pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.846"></a><span id="l24.846" class="difflineminus">-    do_check_eq(client.getProperty(&quot;settings.defaultReminders&quot;), JSON.stringify(defaultReminders));</span>
<a href="#l24.847"></a><span id="l24.847" class="difflineplus">+    equal(client.getProperty(&quot;settings.defaultReminders&quot;), JSON.stringify(defaultReminders));</span>
<a href="#l24.848"></a><span id="l24.848"> </span>
<a href="#l24.849"></a><span id="l24.849">     let item = (yield pclient.getAllItems())[0];</span>
<a href="#l24.850"></a><span id="l24.850">     let alarms = item.getAlarms({});</span>
<a href="#l24.851"></a><span id="l24.851"> </span>
<a href="#l24.852"></a><span id="l24.852" class="difflineminus">-    do_check_eq(alarms.length, 2);</span>
<a href="#l24.853"></a><span id="l24.853" class="difflineminus">-    do_check_true(alarms.every(x =&gt; x.getProperty(&quot;X-DEFAULT-ALARM&quot;) == &quot;TRUE&quot;));</span>
<a href="#l24.854"></a><span id="l24.854" class="difflineminus">-    do_check_eq(alarms[0].action, &quot;DISPLAY&quot;);</span>
<a href="#l24.855"></a><span id="l24.855" class="difflineminus">-    do_check_eq(alarms[0].offset.icalString, &quot;-PT10M&quot;);</span>
<a href="#l24.856"></a><span id="l24.856" class="difflineminus">-    do_check_eq(alarms[1].action, &quot;EMAIL&quot;);</span>
<a href="#l24.857"></a><span id="l24.857" class="difflineminus">-    do_check_eq(alarms[1].offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l24.858"></a><span id="l24.858" class="difflineplus">+    equal(alarms.length, 2);</span>
<a href="#l24.859"></a><span id="l24.859" class="difflineplus">+    ok(alarms.every(x =&gt; x.getProperty(&quot;X-DEFAULT-ALARM&quot;) == &quot;TRUE&quot;));</span>
<a href="#l24.860"></a><span id="l24.860" class="difflineplus">+    equal(alarms[0].action, &quot;DISPLAY&quot;);</span>
<a href="#l24.861"></a><span id="l24.861" class="difflineplus">+    equal(alarms[0].offset.icalString, &quot;-PT10M&quot;);</span>
<a href="#l24.862"></a><span id="l24.862" class="difflineplus">+    equal(alarms[1].action, &quot;EMAIL&quot;);</span>
<a href="#l24.863"></a><span id="l24.863" class="difflineplus">+    equal(alarms[1].offset.icalString, &quot;-PT20M&quot;);</span>
<a href="#l24.864"></a><span id="l24.864"> </span>
<a href="#l24.865"></a><span id="l24.865">     // Case #2: add an item with only default alarms</span>
<a href="#l24.866"></a><span id="l24.866">     let event = cal.createEvent([</span>
<a href="#l24.867"></a><span id="l24.867">         &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l24.868"></a><span id="l24.868">         &quot;SUMMARY:Default Alarms&quot;,</span>
<a href="#l24.869"></a><span id="l24.869">         &quot;DTSTART:20060610T180000Z&quot;,</span>
<a href="#l24.870"></a><span id="l24.870">         &quot;DTEND:20060610T200000Z&quot;,</span>
<a href="#l24.871"></a><span id="l24.871">         &quot;BEGIN:VALARM&quot;,</span>
<a href="#l24.872"></a><span id="l24.872" class="difflineat">@@ -1413,18 +1413,18 @@ add_task(function* test_default_alarms()</span>
<a href="#l24.873"></a><span id="l24.873">         &quot;ACTION:DISPLAY&quot;,</span>
<a href="#l24.874"></a><span id="l24.874">         &quot;TRIGGER;VALUE=DURATION:PT0S&quot;,</span>
<a href="#l24.875"></a><span id="l24.875">         &quot;DESCRIPTION:Description&quot;,</span>
<a href="#l24.876"></a><span id="l24.876">         &quot;END:VALARM&quot;,</span>
<a href="#l24.877"></a><span id="l24.877">         &quot;END:VEVENT&quot;</span>
<a href="#l24.878"></a><span id="l24.878">     ].join(&quot;\r\n&quot;));</span>
<a href="#l24.879"></a><span id="l24.879"> </span>
<a href="#l24.880"></a><span id="l24.880">     yield pclient.addItem(event);</span>
<a href="#l24.881"></a><span id="l24.881" class="difflineminus">-    do_check_true(gServer.events[1].reminders.useDefault);</span>
<a href="#l24.882"></a><span id="l24.882" class="difflineminus">-    do_check_eq(gServer.events[1].reminders.overrides.length, 0);</span>
<a href="#l24.883"></a><span id="l24.883" class="difflineplus">+    ok(gServer.events[1].reminders.useDefault);</span>
<a href="#l24.884"></a><span id="l24.884" class="difflineplus">+    equal(gServer.events[1].reminders.overrides.length, 0);</span>
<a href="#l24.885"></a><span id="l24.885"> </span>
<a href="#l24.886"></a><span id="l24.886">     // Case #3: Mixed default/non-default alarms. Not sure this will happen</span>
<a href="#l24.887"></a><span id="l24.887">     event = cal.createEvent([</span>
<a href="#l24.888"></a><span id="l24.888">         &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l24.889"></a><span id="l24.889">         &quot;SUMMARY:Default Alarms&quot;,</span>
<a href="#l24.890"></a><span id="l24.890">         &quot;DTSTART:20060610T180000Z&quot;,</span>
<a href="#l24.891"></a><span id="l24.891">         &quot;DTEND:20060610T200000Z&quot;,</span>
<a href="#l24.892"></a><span id="l24.892">         &quot;BEGIN:VALARM&quot;,</span>
<a href="#l24.893"></a><span id="l24.893" class="difflineat">@@ -1437,19 +1437,19 @@ add_task(function* test_default_alarms()</span>
<a href="#l24.894"></a><span id="l24.894">         &quot;ACTION:DISPLAY&quot;,</span>
<a href="#l24.895"></a><span id="l24.895">         &quot;TRIGGER;VALUE=DURATION:-PT5M&quot;,</span>
<a href="#l24.896"></a><span id="l24.896">         &quot;DESCRIPTION:Description&quot;,</span>
<a href="#l24.897"></a><span id="l24.897">         &quot;END:VALARM&quot;,</span>
<a href="#l24.898"></a><span id="l24.898">         &quot;END:VEVENT&quot;</span>
<a href="#l24.899"></a><span id="l24.899">     ].join(&quot;\r\n&quot;));</span>
<a href="#l24.900"></a><span id="l24.900"> </span>
<a href="#l24.901"></a><span id="l24.901">     yield pclient.addItem(event);</span>
<a href="#l24.902"></a><span id="l24.902" class="difflineminus">-    do_check_true(gServer.events[2].reminders.useDefault);</span>
<a href="#l24.903"></a><span id="l24.903" class="difflineminus">-    do_check_eq(gServer.events[2].reminders.overrides.length, 1);</span>
<a href="#l24.904"></a><span id="l24.904" class="difflineminus">-    do_check_eq(gServer.events[2].reminders.overrides[0].minutes, 5);</span>
<a href="#l24.905"></a><span id="l24.905" class="difflineplus">+    ok(gServer.events[2].reminders.useDefault);</span>
<a href="#l24.906"></a><span id="l24.906" class="difflineplus">+    equal(gServer.events[2].reminders.overrides.length, 1);</span>
<a href="#l24.907"></a><span id="l24.907" class="difflineplus">+    equal(gServer.events[2].reminders.overrides[0].minutes, 5);</span>
<a href="#l24.908"></a><span id="l24.908"> </span>
<a href="#l24.909"></a><span id="l24.909">     gServer.resetClient(client);</span>
<a href="#l24.910"></a><span id="l24.910"> </span>
<a href="#l24.911"></a><span id="l24.911">     // Case #4a: Empty default alarms</span>
<a href="#l24.912"></a><span id="l24.912">     gServer.calendarListData.defaultReminders = [];</span>
<a href="#l24.913"></a><span id="l24.913">     gServer.eventsData.defaultReminders = [];</span>
<a href="#l24.914"></a><span id="l24.914">     client = yield gServer.getClient();</span>
<a href="#l24.915"></a><span id="l24.915">     pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.916"></a><span id="l24.916" class="difflineat">@@ -1459,29 +1459,29 @@ add_task(function* test_default_alarms()</span>
<a href="#l24.917"></a><span id="l24.917">         &quot;SUMMARY:Default Alarms Empty&quot;,</span>
<a href="#l24.918"></a><span id="l24.918">         &quot;DTSTART:20060610T180000Z&quot;,</span>
<a href="#l24.919"></a><span id="l24.919">         &quot;DTEND:20060610T200000Z&quot;,</span>
<a href="#l24.920"></a><span id="l24.920">         &quot;X-DEFAULT-ALARM:TRUE&quot;,</span>
<a href="#l24.921"></a><span id="l24.921">         &quot;END:VEVENT&quot;</span>
<a href="#l24.922"></a><span id="l24.922">     ].join(&quot;\r\n&quot;));</span>
<a href="#l24.923"></a><span id="l24.923"> </span>
<a href="#l24.924"></a><span id="l24.924">     yield pclient.addItem(event);</span>
<a href="#l24.925"></a><span id="l24.925" class="difflineminus">-    do_check_true(gServer.events[0].reminders.useDefault);</span>
<a href="#l24.926"></a><span id="l24.926" class="difflineminus">-    do_check_eq(gServer.events[0].reminders.overrides, undefined);</span>
<a href="#l24.927"></a><span id="l24.927" class="difflineplus">+    ok(gServer.events[0].reminders.useDefault);</span>
<a href="#l24.928"></a><span id="l24.928" class="difflineplus">+    equal(gServer.events[0].reminders.overrides, undefined);</span>
<a href="#l24.929"></a><span id="l24.929"> </span>
<a href="#l24.930"></a><span id="l24.930">     let events = gServer.events;</span>
<a href="#l24.931"></a><span id="l24.931">     gServer.resetClient(client);</span>
<a href="#l24.932"></a><span id="l24.932"> </span>
<a href="#l24.933"></a><span id="l24.933">     // Case #4b: Read an item with empty default alarms</span>
<a href="#l24.934"></a><span id="l24.934">     gServer.events = events;</span>
<a href="#l24.935"></a><span id="l24.935">     client = yield gServer.getClient();</span>
<a href="#l24.936"></a><span id="l24.936">     pclient = cal.async.promisifyCalendar(client.wrappedJSObject);</span>
<a href="#l24.937"></a><span id="l24.937"> </span>
<a href="#l24.938"></a><span id="l24.938">     item = (yield pclient.getAllItems())[0];</span>
<a href="#l24.939"></a><span id="l24.939" class="difflineminus">-    do_check_eq(item.getProperty(&quot;X-DEFAULT-ALARM&quot;), &quot;TRUE&quot;);</span>
<a href="#l24.940"></a><span id="l24.940" class="difflineplus">+    equal(item.getProperty(&quot;X-DEFAULT-ALARM&quot;), &quot;TRUE&quot;);</span>
<a href="#l24.941"></a><span id="l24.941"> </span>
<a href="#l24.942"></a><span id="l24.942">     gServer.resetClient(client);</span>
<a href="#l24.943"></a><span id="l24.943"> });</span>
<a href="#l24.944"></a><span id="l24.944"> </span>
<a href="#l24.945"></a><span id="l24.945"> add_task(function* test_paginate() {</span>
<a href="#l24.946"></a><span id="l24.946">     gServer.events = [{</span>
<a href="#l24.947"></a><span id="l24.947">        &quot;kind&quot;: &quot;calendar#event&quot;,</span>
<a href="#l24.948"></a><span id="l24.948">        &quot;etag&quot;: &quot;\&quot;1\&quot;&quot;,</span>
<a href="#l24.949"></a><span id="l24.949" class="difflineat">@@ -1531,25 +1531,25 @@ add_task(function* test_paginate() {</span>
<a href="#l24.950"></a><span id="l24.950">     ];</span>
<a href="#l24.951"></a><span id="l24.951"> </span>
<a href="#l24.952"></a><span id="l24.952">     Preferences.set(&quot;calendar.google.maxResultsPerRequest&quot;, 1);</span>
<a href="#l24.953"></a><span id="l24.953"> </span>
<a href="#l24.954"></a><span id="l24.954">     let client = yield gServer.getClient();</span>
<a href="#l24.955"></a><span id="l24.955">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l24.956"></a><span id="l24.956"> </span>
<a href="#l24.957"></a><span id="l24.957">     // Make sure all pages were requested</span>
<a href="#l24.958"></a><span id="l24.958" class="difflineminus">-    do_check_eq(gServer.eventsData.nextPageToken, null);</span>
<a href="#l24.959"></a><span id="l24.959" class="difflineminus">-    do_check_eq(gServer.tasksData.nextPageToken, null);</span>
<a href="#l24.960"></a><span id="l24.960" class="difflineplus">+    equal(gServer.eventsData.nextPageToken, null);</span>
<a href="#l24.961"></a><span id="l24.961" class="difflineplus">+    equal(gServer.tasksData.nextPageToken, null);</span>
<a href="#l24.962"></a><span id="l24.962"> </span>
<a href="#l24.963"></a><span id="l24.963">     // ...and we have all items. Not checking props</span>
<a href="#l24.964"></a><span id="l24.964">     // because the other tests do this sufficiently.</span>
<a href="#l24.965"></a><span id="l24.965">     let items = yield pclient.getAllItems();</span>
<a href="#l24.966"></a><span id="l24.966" class="difflineminus">-    do_check_eq(items.length, 4);</span>
<a href="#l24.967"></a><span id="l24.967" class="difflineplus">+    equal(items.length, 4);</span>
<a href="#l24.968"></a><span id="l24.968"> </span>
<a href="#l24.969"></a><span id="l24.969" class="difflineminus">-    do_check_eq(client.getProperty(&quot;syncToken.events&quot;), &quot;next-sync-token&quot;);</span>
<a href="#l24.970"></a><span id="l24.970" class="difflineplus">+    equal(client.getProperty(&quot;syncToken.events&quot;), &quot;next-sync-token&quot;);</span>
<a href="#l24.971"></a><span id="l24.971"> </span>
<a href="#l24.972"></a><span id="l24.972">     Preferences.reset(&quot;calendar.google.maxResultsPerRequest&quot;);</span>
<a href="#l24.973"></a><span id="l24.973">     gServer.resetClient(client);</span>
<a href="#l24.974"></a><span id="l24.974"> });</span>
<a href="#l24.975"></a><span id="l24.975"> </span>
<a href="#l24.976"></a><span id="l24.976"> add_task(function* test_incremental_reset() {</span>
<a href="#l24.977"></a><span id="l24.977">     gServer.syncs = [{</span>
<a href="#l24.978"></a><span id="l24.978">         token: &quot;1&quot;,</span>
<a href="#l24.979"></a><span id="l24.979" class="difflineat">@@ -1584,23 +1584,23 @@ add_task(function* test_incremental_rese</span>
<a href="#l24.980"></a><span id="l24.980">             &quot;end&quot;: {&quot;dateTime&quot;: &quot;2006-06-10T20:00:00+02:00&quot; },</span>
<a href="#l24.981"></a><span id="l24.981">             &quot;iCalUID&quot;: &quot;fepf8uf6n7n04w7feukucs9n8e@google.com&quot;</span>
<a href="#l24.982"></a><span id="l24.982">         }]</span>
<a href="#l24.983"></a><span id="l24.983">     }];</span>
<a href="#l24.984"></a><span id="l24.984">     let client = yield gServer.getClient();</span>
<a href="#l24.985"></a><span id="l24.985">     let pclient = cal.async.promisifyCalendar(client);</span>
<a href="#l24.986"></a><span id="l24.986"> </span>
<a href="#l24.987"></a><span id="l24.987">     let items = yield pclient.getAllItems();</span>
<a href="#l24.988"></a><span id="l24.988" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.989"></a><span id="l24.989" class="difflineminus">-    do_check_eq(items[0].title, &quot;New Event&quot;);</span>
<a href="#l24.990"></a><span id="l24.990" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.991"></a><span id="l24.991" class="difflineplus">+    equal(items[0].title, &quot;New Event&quot;);</span>
<a href="#l24.992"></a><span id="l24.992"> </span>
<a href="#l24.993"></a><span id="l24.993">     client.refresh();</span>
<a href="#l24.994"></a><span id="l24.994">     yield gServer.waitForLoad(client);</span>
<a href="#l24.995"></a><span id="l24.995"> </span>
<a href="#l24.996"></a><span id="l24.996">     items = yield pclient.getAllItems();</span>
<a href="#l24.997"></a><span id="l24.997" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l24.998"></a><span id="l24.998" class="difflineminus">-    do_check_eq(items[0].title, &quot;New Event 2&quot;);</span>
<a href="#l24.999"></a><span id="l24.999" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l24.1000"></a><span id="l24.1000" class="difflineplus">+    equal(items[0].title, &quot;New Event 2&quot;);</span>
<a href="#l24.1001"></a><span id="l24.1001"> </span>
<a href="#l24.1002"></a><span id="l24.1002" class="difflineminus">-    do_check_eq(gServer.syncs.length, 0);</span>
<a href="#l24.1003"></a><span id="l24.1003" class="difflineminus">-    do_check_eq(client.getProperty(&quot;syncToken.events&quot;), &quot;last&quot;);</span>
<a href="#l24.1004"></a><span id="l24.1004" class="difflineplus">+    equal(gServer.syncs.length, 0);</span>
<a href="#l24.1005"></a><span id="l24.1005" class="difflineplus">+    equal(client.getProperty(&quot;syncToken.events&quot;), &quot;last&quot;);</span>
<a href="#l24.1006"></a><span id="l24.1006"> </span>
<a href="#l24.1007"></a><span id="l24.1007">     gServer.resetClient(client);</span>
<a href="#l24.1008"></a><span id="l24.1008"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/test/unit/test_hashedarray.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/test/unit/test_hashedarray.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -50,21 +50,21 @@ function titleComptor(a, b) {</span>
<a href="#l25.4"></a><span id="l25.4">  * @param testItems     The array of test items</span>
<a href="#l25.5"></a><span id="l25.5">  * @param itemAccessor  The accessor func to retrieve the items</span>
<a href="#l25.6"></a><span id="l25.6">  * @throws Exception    If the arrays are not the same.</span>
<a href="#l25.7"></a><span id="l25.7">  */</span>
<a href="#l25.8"></a><span id="l25.8"> function checkConsistancy(har, testItems, itemAccessor) {</span>
<a href="#l25.9"></a><span id="l25.9">     itemAccessor = itemAccessor || function(o) { return o; }</span>
<a href="#l25.10"></a><span id="l25.10">     for (let idx in testItems) {</span>
<a href="#l25.11"></a><span id="l25.11">         let ti = itemAccessor(testItems[idx]);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        do_check_eq(itemAccessor(har.itemByIndex(idx)).title,</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+        equal(itemAccessor(har.itemByIndex(idx)).title,</span>
<a href="#l25.14"></a><span id="l25.14">                     ti.title);</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-        do_check_eq(itemAccessor(har.itemById(ti.hashId)).title,</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineplus">+        equal(itemAccessor(har.itemById(ti.hashId)).title,</span>
<a href="#l25.17"></a><span id="l25.17">                     ti.title);</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-        do_check_eq(har.indexOf(testItems[idx]), idx);</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineplus">+        equal(har.indexOf(testItems[idx]), idx);</span>
<a href="#l25.20"></a><span id="l25.20">     }</span>
<a href="#l25.21"></a><span id="l25.21"> }</span>
<a href="#l25.22"></a><span id="l25.22"> </span>
<a href="#l25.23"></a><span id="l25.23"> /**</span>
<a href="#l25.24"></a><span id="l25.24">  * Useful for debugging, in case this test fails. Dumps the array showing the</span>
<a href="#l25.25"></a><span id="l25.25">  * title identifications.</span>
<a href="#l25.26"></a><span id="l25.26">  *</span>
<a href="#l25.27"></a><span id="l25.27">  * @param ar        The array to dump</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/test/unit/test_ics.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/test/unit/test_ics.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -125,17 +125,17 @@ function test_roundtrip() {</span>
<a href="#l26.4"></a><span id="l26.4">         // Now, try the same thing with asynchronous parsing. We need a copy of</span>
<a href="#l26.5"></a><span id="l26.5">         // the data variable, otherwise javascript will mix the data between</span>
<a href="#l26.6"></a><span id="l26.6">         // foreach loop iterations.</span>
<a href="#l26.7"></a><span id="l26.7">         do_test_pending();</span>
<a href="#l26.8"></a><span id="l26.8">         let thisdata = data;</span>
<a href="#l26.9"></a><span id="l26.9">         icssrv.parseICSAsync(data.ics, null, {</span>
<a href="#l26.10"></a><span id="l26.10">             onParsingComplete: function onParsingComplete(rc, rootComp) {</span>
<a href="#l26.11"></a><span id="l26.11">                 try {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-                    do_check_true(Components.isSuccessCode(rc));</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+                    ok(Components.isSuccessCode(rc));</span>
<a href="#l26.14"></a><span id="l26.14">                     let event2 = cal.createEvent();</span>
<a href="#l26.15"></a><span id="l26.15">                     event2.icalComponent = rootComp;</span>
<a href="#l26.16"></a><span id="l26.16">                     checkEvent(thisdata, event2);</span>
<a href="#l26.17"></a><span id="l26.17">                     do_test_finished();</span>
<a href="#l26.18"></a><span id="l26.18">                 } catch (e) {</span>
<a href="#l26.19"></a><span id="l26.19">                     do_throw(e + &quot;\n&quot;);</span>
<a href="#l26.20"></a><span id="l26.20">                     do_test_finished();</span>
<a href="#l26.21"></a><span id="l26.21">                 }</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -145,18 +145,18 @@ function test_roundtrip() {</span>
<a href="#l26.23"></a><span id="l26.23"> }</span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25"> function test_folding() {</span>
<a href="#l26.26"></a><span id="l26.26">     // check folding</span>
<a href="#l26.27"></a><span id="l26.27">     const id = &quot;loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong-id-provoking-folding&quot;;</span>
<a href="#l26.28"></a><span id="l26.28">     let todo = cal.createTodo(), todo_ = cal.createTodo();</span>
<a href="#l26.29"></a><span id="l26.29">     todo.id = id;</span>
<a href="#l26.30"></a><span id="l26.30">     todo_.icalString = todo.icalString;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-    do_check_eq(todo.id, todo_.id);</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-    do_check_eq(todo_.icalComponent.getFirstProperty(&quot;UID&quot;).value, id);</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+    equal(todo.id, todo_.id);</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+    equal(todo_.icalComponent.getFirstProperty(&quot;UID&quot;).value, id);</span>
<a href="#l26.35"></a><span id="l26.35"> }</span>
<a href="#l26.36"></a><span id="l26.36"> </span>
<a href="#l26.37"></a><span id="l26.37"> function test_icalProps() {</span>
<a href="#l26.38"></a><span id="l26.38">     checkIcalProp(&quot;ATTACH&quot;, cal.createAttachment());</span>
<a href="#l26.39"></a><span id="l26.39">     checkIcalProp(&quot;ATTENDEE&quot;, cal.createAttendee());</span>
<a href="#l26.40"></a><span id="l26.40">     checkIcalProp(&quot;RELATED-TO&quot;, cal.createRelation());</span>
<a href="#l26.41"></a><span id="l26.41"> }</span>
<a href="#l26.42"></a><span id="l26.42"> </span>
<a href="#l26.43"></a><span id="l26.43" class="difflineat">@@ -169,58 +169,58 @@ function checkIcalProp(aPropName, aObj) </span>
<a href="#l26.44"></a><span id="l26.44">     let prop1 = icssvc.createIcalProperty(aPropName);</span>
<a href="#l26.45"></a><span id="l26.45">     let prop2 = icssvc.createIcalProperty(aPropName);</span>
<a href="#l26.46"></a><span id="l26.46">     prop1.value = &quot;foo&quot;;</span>
<a href="#l26.47"></a><span id="l26.47">     prop2.value = &quot;bar&quot;;</span>
<a href="#l26.48"></a><span id="l26.48">     prop1.setParameter(&quot;X-FOO&quot;, &quot;BAR&quot;);</span>
<a href="#l26.49"></a><span id="l26.49"> </span>
<a href="#l26.50"></a><span id="l26.50">     if (aObj.setParameter) {</span>
<a href="#l26.51"></a><span id="l26.51">         aObj.icalProperty = prop1;</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineminus">-        do_check_eq(aObj.getParameter(&quot;X-FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+        equal(aObj.getParameter(&quot;X-FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l26.54"></a><span id="l26.54">         aObj.icalProperty = prop2;</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineminus">-        do_check_eq(aObj.getParameter(&quot;X-FOO&quot;), null);</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineplus">+        equal(aObj.getParameter(&quot;X-FOO&quot;), null);</span>
<a href="#l26.57"></a><span id="l26.57">     } else if (aObj.setProperty) {</span>
<a href="#l26.58"></a><span id="l26.58">         aObj.icalProperty = prop1;</span>
<a href="#l26.59"></a><span id="l26.59" class="difflineminus">-        do_check_eq(aObj.getProperty(&quot;X-FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l26.60"></a><span id="l26.60" class="difflineplus">+        equal(aObj.getProperty(&quot;X-FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l26.61"></a><span id="l26.61">         aObj.icalProperty = prop2;</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineminus">-        do_check_eq(aObj.getProperty(&quot;X-FOO&quot;), null);</span>
<a href="#l26.63"></a><span id="l26.63" class="difflineplus">+        equal(aObj.getProperty(&quot;X-FOO&quot;), null);</span>
<a href="#l26.64"></a><span id="l26.64">     }</span>
<a href="#l26.65"></a><span id="l26.65"> }</span>
<a href="#l26.66"></a><span id="l26.66"> </span>
<a href="#l26.67"></a><span id="l26.67"> function checkProps(expectedProps, obj) {</span>
<a href="#l26.68"></a><span id="l26.68">     for (let key in expectedProps) {</span>
<a href="#l26.69"></a><span id="l26.69" class="difflineminus">-        do_check_eq(obj[key], expectedProps[key]);</span>
<a href="#l26.70"></a><span id="l26.70" class="difflineplus">+        equal(obj[key], expectedProps[key]);</span>
<a href="#l26.71"></a><span id="l26.71">     }</span>
<a href="#l26.72"></a><span id="l26.72"> }</span>
<a href="#l26.73"></a><span id="l26.73"> </span>
<a href="#l26.74"></a><span id="l26.74"> function checkRoundtrip(expectedProps, obj) {</span>
<a href="#l26.75"></a><span id="l26.75">     let icsdata = obj.icalString;</span>
<a href="#l26.76"></a><span id="l26.76">     for (let key in expectedProps) {</span>
<a href="#l26.77"></a><span id="l26.77">         // Need translation</span>
<a href="#l26.78"></a><span id="l26.78">         let icskey = key;</span>
<a href="#l26.79"></a><span id="l26.79">         switch (key) {</span>
<a href="#l26.80"></a><span id="l26.80">             case &quot;id&quot;:</span>
<a href="#l26.81"></a><span id="l26.81">                 icskey = &quot;uid&quot;;</span>
<a href="#l26.82"></a><span id="l26.82">                 break;</span>
<a href="#l26.83"></a><span id="l26.83">             case &quot;title&quot;:</span>
<a href="#l26.84"></a><span id="l26.84">                 icskey = &quot;summary&quot;;</span>
<a href="#l26.85"></a><span id="l26.85">                 break;</span>
<a href="#l26.86"></a><span id="l26.86">         }</span>
<a href="#l26.87"></a><span id="l26.87" class="difflineminus">-        do_check_true(icsdata.indexOf(icskey.toUpperCase()) &gt; 0);</span>
<a href="#l26.88"></a><span id="l26.88" class="difflineminus">-        do_check_true(icsdata.indexOf(expectedProps[key]) &gt; 0);</span>
<a href="#l26.89"></a><span id="l26.89" class="difflineplus">+        ok(icsdata.indexOf(icskey.toUpperCase()) &gt; 0);</span>
<a href="#l26.90"></a><span id="l26.90" class="difflineplus">+        ok(icsdata.indexOf(expectedProps[key]) &gt; 0);</span>
<a href="#l26.91"></a><span id="l26.91">     }</span>
<a href="#l26.92"></a><span id="l26.92"> }</span>
<a href="#l26.93"></a><span id="l26.93"> </span>
<a href="#l26.94"></a><span id="l26.94"> function test_duration() {</span>
<a href="#l26.95"></a><span id="l26.95">     let e = cal.createEvent();</span>
<a href="#l26.96"></a><span id="l26.96">     e.startDate = cal.createDateTime();</span>
<a href="#l26.97"></a><span id="l26.97">     e.endDate = null;</span>
<a href="#l26.98"></a><span id="l26.98" class="difflineminus">-    do_check_eq(e.duration.icalString, &quot;PT0S&quot;);</span>
<a href="#l26.99"></a><span id="l26.99" class="difflineplus">+    equal(e.duration.icalString, &quot;PT0S&quot;);</span>
<a href="#l26.100"></a><span id="l26.100"> }</span>
<a href="#l26.101"></a><span id="l26.101"> </span>
<a href="#l26.102"></a><span id="l26.102"> function test_serialize() {</span>
<a href="#l26.103"></a><span id="l26.103">     let e = cal.createEvent();</span>
<a href="#l26.104"></a><span id="l26.104">     let prop = cal.getIcsService().createIcalComponent(&quot;VTODO&quot;);</span>
<a href="#l26.105"></a><span id="l26.105"> </span>
<a href="#l26.106"></a><span id="l26.106" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l26.107"></a><span id="l26.107" class="difflineplus">+    throws(function() {</span>
<a href="#l26.108"></a><span id="l26.108">         e.icalComponent = prop;</span>
<a href="#l26.109"></a><span id="l26.109" class="difflineminus">-    }, Components.results.NS_ERROR_INVALID_ARG);</span>
<a href="#l26.110"></a><span id="l26.110" class="difflineplus">+    }, /Illegal value/);</span>
<a href="#l26.111"></a><span id="l26.111"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/test/unit/test_ics_parser.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_parser.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -22,52 +22,52 @@ function test_props_comps() {</span>
<a href="#l27.4"></a><span id="l27.4">         &quot;END:VJOURNAL&quot;,</span>
<a href="#l27.5"></a><span id="l27.5">         &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l27.6"></a><span id="l27.6">         &quot;UID:123&quot;,</span>
<a href="#l27.7"></a><span id="l27.7">         &quot;END:VEVENT&quot;,</span>
<a href="#l27.8"></a><span id="l27.8">         &quot;END:VCALENDAR&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l27.9"></a><span id="l27.9">     parser.parseString(str);</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">     let props = parser.getProperties({});</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    do_check_eq(props.length, 1);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-    do_check_eq(props[0].propertyName, &quot;X-WR-CALNAME&quot;);</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-    do_check_eq(props[0].value, &quot;CALNAME&quot;);</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+    equal(props.length, 1);</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+    equal(props[0].propertyName, &quot;X-WR-CALNAME&quot;);</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+    equal(props[0].value, &quot;CALNAME&quot;);</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19">     let comps = parser.getComponents({});</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineminus">-    do_check_eq(comps.length, 1);</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineminus">-    do_check_eq(comps[0].componentType, &quot;VJOURNAL&quot;);</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineminus">-    do_check_eq(comps[0].location, &quot;BEFORE TIME&quot;);</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+    equal(comps.length, 1);</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+    equal(comps[0].componentType, &quot;VJOURNAL&quot;);</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+    equal(comps[0].location, &quot;BEFORE TIME&quot;);</span>
<a href="#l27.26"></a><span id="l27.26"> }</span>
<a href="#l27.27"></a><span id="l27.27"> </span>
<a href="#l27.28"></a><span id="l27.28"> function test_failures() {</span>
<a href="#l27.29"></a><span id="l27.29">     let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l27.30"></a><span id="l27.30">                            .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l27.31"></a><span id="l27.31"> </span>
<a href="#l27.32"></a><span id="l27.32">     do_test_pending()</span>
<a href="#l27.33"></a><span id="l27.33">     parser.parseString(&quot;BOGUS&quot;, null, {</span>
<a href="#l27.34"></a><span id="l27.34">         onParsingComplete: function(rc, parser) {</span>
<a href="#l27.35"></a><span id="l27.35">             dump(&quot;Note: The previous error message is expected ^^\n&quot;);</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-            do_check_eq(rc, Components.results.NS_ERROR_FAILURE);</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineplus">+            equal(rc, Components.results.NS_ERROR_FAILURE);</span>
<a href="#l27.38"></a><span id="l27.38">             do_test_finished();</span>
<a href="#l27.39"></a><span id="l27.39">         }</span>
<a href="#l27.40"></a><span id="l27.40">     });</span>
<a href="#l27.41"></a><span id="l27.41"> </span>
<a href="#l27.42"></a><span id="l27.42">     // No real error here, but there is a message...</span>
<a href="#l27.43"></a><span id="l27.43">     parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l27.44"></a><span id="l27.44">                        .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l27.45"></a><span id="l27.45">     let str = [</span>
<a href="#l27.46"></a><span id="l27.46">         &quot;BEGIN:VWORLD&quot;,</span>
<a href="#l27.47"></a><span id="l27.47">         &quot;BEGIN:VEVENT&quot;,</span>
<a href="#l27.48"></a><span id="l27.48">         &quot;UID:123&quot;,</span>
<a href="#l27.49"></a><span id="l27.49">         &quot;END:VEVENT&quot;,</span>
<a href="#l27.50"></a><span id="l27.50">         &quot;END:VWORLD&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l27.51"></a><span id="l27.51">     dump(&quot;Note: The following error message is expected:\n&quot;);</span>
<a href="#l27.52"></a><span id="l27.52">     parser.parseString(str);</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-    do_check_eq(parser.getComponents({}).length, 0);</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineminus">-    do_check_eq(parser.getItems({}).length, 0);</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineplus">+    equal(parser.getComponents({}).length, 0);</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineplus">+    equal(parser.getItems({}).length, 0);</span>
<a href="#l27.57"></a><span id="l27.57"> </span>
<a href="#l27.58"></a><span id="l27.58"> }</span>
<a href="#l27.59"></a><span id="l27.59"> </span>
<a href="#l27.60"></a><span id="l27.60"> function test_fake_parent() {</span>
<a href="#l27.61"></a><span id="l27.61">     let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l27.62"></a><span id="l27.62">                            .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l27.63"></a><span id="l27.63"> </span>
<a href="#l27.64"></a><span id="l27.64">     let str = [</span>
<a href="#l27.65"></a><span id="l27.65" class="difflineat">@@ -78,33 +78,33 @@ function test_fake_parent() {</span>
<a href="#l27.66"></a><span id="l27.66">         &quot;DTSTART:20120101T010102&quot;,</span>
<a href="#l27.67"></a><span id="l27.67">         &quot;LOCATION:HELL&quot;,</span>
<a href="#l27.68"></a><span id="l27.68">         &quot;END:VEVENT&quot;,</span>
<a href="#l27.69"></a><span id="l27.69">         &quot;END:VCALENDAR&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l27.70"></a><span id="l27.70"> </span>
<a href="#l27.71"></a><span id="l27.71">     parser.parseString(str);</span>
<a href="#l27.72"></a><span id="l27.72"> </span>
<a href="#l27.73"></a><span id="l27.73">     let items = parser.getItems({});</span>
<a href="#l27.74"></a><span id="l27.74" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l27.75"></a><span id="l27.75" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l27.76"></a><span id="l27.76">     let item = items[0];</span>
<a href="#l27.77"></a><span id="l27.77"> </span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-    do_check_eq(item.id, &quot;123&quot;);</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-    do_check_true(!!item.recurrenceInfo);</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineminus">-    do_check_eq(item.startDate.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineminus">-    do_check_eq(item.getProperty(&quot;X-MOZ-FAKED-MASTER&quot;), &quot;1&quot;);</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineplus">+    equal(item.id, &quot;123&quot;);</span>
<a href="#l27.83"></a><span id="l27.83" class="difflineplus">+    ok(!!item.recurrenceInfo);</span>
<a href="#l27.84"></a><span id="l27.84" class="difflineplus">+    equal(item.startDate.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l27.85"></a><span id="l27.85" class="difflineplus">+    equal(item.getProperty(&quot;X-MOZ-FAKED-MASTER&quot;), &quot;1&quot;);</span>
<a href="#l27.86"></a><span id="l27.86"> </span>
<a href="#l27.87"></a><span id="l27.87">     let rinfo = item.recurrenceInfo;</span>
<a href="#l27.88"></a><span id="l27.88"> </span>
<a href="#l27.89"></a><span id="l27.89" class="difflineminus">-    do_check_eq(rinfo.countRecurrenceItems(), 1);</span>
<a href="#l27.90"></a><span id="l27.90" class="difflineplus">+    equal(rinfo.countRecurrenceItems(), 1);</span>
<a href="#l27.91"></a><span id="l27.91">     let excs = rinfo.getOccurrences(cal.createDateTime(&quot;20120101T010101&quot;), null, 0, {});</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineminus">-    do_check_eq(excs.length, 1);</span>
<a href="#l27.93"></a><span id="l27.93" class="difflineplus">+    equal(excs.length, 1);</span>
<a href="#l27.94"></a><span id="l27.94">     let exc = excs[0];</span>
<a href="#l27.95"></a><span id="l27.95" class="difflineminus">-    do_check_eq(exc.startDate.icalString, &quot;20120101T010102&quot;);</span>
<a href="#l27.96"></a><span id="l27.96" class="difflineplus">+    equal(exc.startDate.icalString, &quot;20120101T010102&quot;);</span>
<a href="#l27.97"></a><span id="l27.97"> </span>
<a href="#l27.98"></a><span id="l27.98" class="difflineminus">-    do_check_eq(parser.getParentlessItems({})[0], exc);</span>
<a href="#l27.99"></a><span id="l27.99" class="difflineplus">+    equal(parser.getParentlessItems({})[0], exc);</span>
<a href="#l27.100"></a><span id="l27.100"> }</span>
<a href="#l27.101"></a><span id="l27.101"> </span>
<a href="#l27.102"></a><span id="l27.102"> function test_async() {</span>
<a href="#l27.103"></a><span id="l27.103">     let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l27.104"></a><span id="l27.104">                            .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l27.105"></a><span id="l27.105">     let str = [</span>
<a href="#l27.106"></a><span id="l27.106">         &quot;BEGIN:VCALENDAR&quot;,</span>
<a href="#l27.107"></a><span id="l27.107">         &quot;BEGIN:VTODO&quot;,</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineat">@@ -118,28 +118,28 @@ function test_async() {</span>
<a href="#l27.109"></a><span id="l27.109">         &quot;DUE:20120101T010104&quot;,</span>
<a href="#l27.110"></a><span id="l27.110">         &quot;END:VTODO&quot;,</span>
<a href="#l27.111"></a><span id="l27.111">         &quot;END:VCALENDAR&quot;].join(&quot;\r\n&quot;);</span>
<a href="#l27.112"></a><span id="l27.112"> </span>
<a href="#l27.113"></a><span id="l27.113">     do_test_pending();</span>
<a href="#l27.114"></a><span id="l27.114">     parser.parseString(str, null, {</span>
<a href="#l27.115"></a><span id="l27.115">         onParsingComplete: function(rc, parser) {</span>
<a href="#l27.116"></a><span id="l27.116">             let items = parser.getItems({});</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineminus">-            do_check_eq(items.length, 2);</span>
<a href="#l27.118"></a><span id="l27.118" class="difflineplus">+            equal(items.length, 2);</span>
<a href="#l27.119"></a><span id="l27.119">             let item = items[0];</span>
<a href="#l27.120"></a><span id="l27.120" class="difflineminus">-            do_check_true(cal.isToDo(item));</span>
<a href="#l27.121"></a><span id="l27.121" class="difflineplus">+            ok(cal.isToDo(item));</span>
<a href="#l27.122"></a><span id="l27.122"> </span>
<a href="#l27.123"></a><span id="l27.123" class="difflineminus">-            do_check_eq(item.entryDate.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l27.124"></a><span id="l27.124" class="difflineminus">-            do_check_eq(item.dueDate.icalString, &quot;20120101T010102&quot;);</span>
<a href="#l27.125"></a><span id="l27.125" class="difflineplus">+            equal(item.entryDate.icalString, &quot;20120101T010101&quot;);</span>
<a href="#l27.126"></a><span id="l27.126" class="difflineplus">+            equal(item.dueDate.icalString, &quot;20120101T010102&quot;);</span>
<a href="#l27.127"></a><span id="l27.127"> </span>
<a href="#l27.128"></a><span id="l27.128">             item = items[1];</span>
<a href="#l27.129"></a><span id="l27.129" class="difflineminus">-            do_check_true(cal.isToDo(item));</span>
<a href="#l27.130"></a><span id="l27.130" class="difflineplus">+            ok(cal.isToDo(item));</span>
<a href="#l27.131"></a><span id="l27.131"> </span>
<a href="#l27.132"></a><span id="l27.132" class="difflineminus">-            do_check_eq(item.entryDate.icalString, &quot;20120101T010103&quot;);</span>
<a href="#l27.133"></a><span id="l27.133" class="difflineminus">-            do_check_eq(item.dueDate.icalString, &quot;20120101T010104&quot;);</span>
<a href="#l27.134"></a><span id="l27.134" class="difflineplus">+            equal(item.entryDate.icalString, &quot;20120101T010103&quot;);</span>
<a href="#l27.135"></a><span id="l27.135" class="difflineplus">+            equal(item.dueDate.icalString, &quot;20120101T010104&quot;);</span>
<a href="#l27.136"></a><span id="l27.136"> </span>
<a href="#l27.137"></a><span id="l27.137">             do_test_finished();</span>
<a href="#l27.138"></a><span id="l27.138">         }</span>
<a href="#l27.139"></a><span id="l27.139">     });</span>
<a href="#l27.140"></a><span id="l27.140"> }</span>
<a href="#l27.141"></a><span id="l27.141"> </span>
<a href="#l27.142"></a><span id="l27.142"> function test_timezone() {</span>
<a href="#l27.143"></a><span id="l27.143">     // TODO</span>
<a href="#l27.144"></a><span id="l27.144" class="difflineat">@@ -169,54 +169,54 @@ function test_roundtrip() {</span>
<a href="#l27.145"></a><span id="l27.145">     parser.parseString(str);</span>
<a href="#l27.146"></a><span id="l27.146"> </span>
<a href="#l27.147"></a><span id="l27.147">     let items = parser.getItems({});</span>
<a href="#l27.148"></a><span id="l27.148">     serializer.addItems(items, items.length);</span>
<a href="#l27.149"></a><span id="l27.149"> </span>
<a href="#l27.150"></a><span id="l27.150">     parser.getProperties({}).forEach(serializer.addProperty, serializer);</span>
<a href="#l27.151"></a><span id="l27.151">     parser.getComponents({}).forEach(serializer.addComponent, serializer);</span>
<a href="#l27.152"></a><span id="l27.152"> </span>
<a href="#l27.153"></a><span id="l27.153" class="difflineminus">-    do_check_eq(serializer.serializeToString().split(&quot;\r\n&quot;).sort().join(&quot;\r\n&quot;),</span>
<a href="#l27.154"></a><span id="l27.154" class="difflineplus">+    equal(serializer.serializeToString().split(&quot;\r\n&quot;).sort().join(&quot;\r\n&quot;),</span>
<a href="#l27.155"></a><span id="l27.155">                 str.split(&quot;\r\n&quot;).sort().join(&quot;\r\n&quot;));</span>
<a href="#l27.156"></a><span id="l27.156"> </span>
<a href="#l27.157"></a><span id="l27.157">     // Test parseFromStream</span>
<a href="#l27.158"></a><span id="l27.158">     parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l27.159"></a><span id="l27.159">                        .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l27.160"></a><span id="l27.160">     let stream = serializer.serializeToInputStream();</span>
<a href="#l27.161"></a><span id="l27.161"> </span>
<a href="#l27.162"></a><span id="l27.162">     parser.parseFromStream(stream);</span>
<a href="#l27.163"></a><span id="l27.163"> </span>
<a href="#l27.164"></a><span id="l27.164">     items = parser.getItems({});</span>
<a href="#l27.165"></a><span id="l27.165">     let comps = parser.getComponents({});</span>
<a href="#l27.166"></a><span id="l27.166">     let props = parser.getProperties({});</span>
<a href="#l27.167"></a><span id="l27.167" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l27.168"></a><span id="l27.168" class="difflineminus">-    do_check_eq(comps.length, 1);</span>
<a href="#l27.169"></a><span id="l27.169" class="difflineminus">-    do_check_eq(props.length, 1);</span>
<a href="#l27.170"></a><span id="l27.170" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l27.171"></a><span id="l27.171" class="difflineplus">+    equal(comps.length, 1);</span>
<a href="#l27.172"></a><span id="l27.172" class="difflineplus">+    equal(props.length, 1);</span>
<a href="#l27.173"></a><span id="l27.173"> </span>
<a href="#l27.174"></a><span id="l27.174">     let everything = items[0].icalString.split(&quot;\r\n&quot;).concat(comps[0].serializeToICS().split(&quot;\r\n&quot;))</span>
<a href="#l27.175"></a><span id="l27.175">     everything.push((props[0].icalString.split(&quot;\r\n&quot;))[0]);</span>
<a href="#l27.176"></a><span id="l27.176">     everything.sort();</span>
<a href="#l27.177"></a><span id="l27.177"> </span>
<a href="#l27.178"></a><span id="l27.178" class="difflineminus">-    do_check_eq(everything.join(&quot;\r\n&quot;), str.split(&quot;\r\n&quot;).concat([&quot;&quot;]).sort().join(&quot;\r\n&quot;));</span>
<a href="#l27.179"></a><span id="l27.179" class="difflineplus">+    equal(everything.join(&quot;\r\n&quot;), str.split(&quot;\r\n&quot;).concat([&quot;&quot;]).sort().join(&quot;\r\n&quot;));</span>
<a href="#l27.180"></a><span id="l27.180"> </span>
<a href="#l27.181"></a><span id="l27.181">     // Test serializeToStream/parseFromStream</span>
<a href="#l27.182"></a><span id="l27.182">     parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l27.183"></a><span id="l27.183">                        .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l27.184"></a><span id="l27.184">     let pipe = Components.classes[&quot;@mozilla.org/pipe;1&quot;]</span>
<a href="#l27.185"></a><span id="l27.185">                          .createInstance(Components.interfaces.nsIPipe);</span>
<a href="#l27.186"></a><span id="l27.186">     pipe.init(true, true, 0, 0, null);</span>
<a href="#l27.187"></a><span id="l27.187"> </span>
<a href="#l27.188"></a><span id="l27.188">     serializer.serializeToStream(pipe.outputStream);</span>
<a href="#l27.189"></a><span id="l27.189">     parser.parseFromStream(pipe.inputStream);</span>
<a href="#l27.190"></a><span id="l27.190"> </span>
<a href="#l27.191"></a><span id="l27.191">     items = parser.getItems({});</span>
<a href="#l27.192"></a><span id="l27.192">     comps = parser.getComponents({});</span>
<a href="#l27.193"></a><span id="l27.193">     props = parser.getProperties({});</span>
<a href="#l27.194"></a><span id="l27.194" class="difflineminus">-    do_check_eq(items.length, 1);</span>
<a href="#l27.195"></a><span id="l27.195" class="difflineminus">-    do_check_eq(comps.length, 1);</span>
<a href="#l27.196"></a><span id="l27.196" class="difflineminus">-    do_check_eq(props.length, 1);</span>
<a href="#l27.197"></a><span id="l27.197" class="difflineplus">+    equal(items.length, 1);</span>
<a href="#l27.198"></a><span id="l27.198" class="difflineplus">+    equal(comps.length, 1);</span>
<a href="#l27.199"></a><span id="l27.199" class="difflineplus">+    equal(props.length, 1);</span>
<a href="#l27.200"></a><span id="l27.200"> </span>
<a href="#l27.201"></a><span id="l27.201">     everything = items[0].icalString.split(&quot;\r\n&quot;).concat(comps[0].serializeToICS().split(&quot;\r\n&quot;));</span>
<a href="#l27.202"></a><span id="l27.202">     everything.push((props[0].icalString.split(&quot;\r\n&quot;))[0]);</span>
<a href="#l27.203"></a><span id="l27.203">     everything.sort();</span>
<a href="#l27.204"></a><span id="l27.204"> </span>
<a href="#l27.205"></a><span id="l27.205" class="difflineminus">-    do_check_eq(everything.join(&quot;\r\n&quot;), str.split(&quot;\r\n&quot;).concat([&quot;&quot;]).sort().join(&quot;\r\n&quot;));</span>
<a href="#l27.206"></a><span id="l27.206" class="difflineplus">+    equal(everything.join(&quot;\r\n&quot;), str.split(&quot;\r\n&quot;).concat([&quot;&quot;]).sort().join(&quot;\r\n&quot;));</span>
<a href="#l27.207"></a><span id="l27.207"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/test/unit/test_ics_service.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_service.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -11,96 +11,96 @@ function run_test() {</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5">     // Only supported with ical.js</span>
<a href="#l28.6"></a><span id="l28.6">     if (Preferences.get(&quot;calendar.icaljs&quot;, false)) test_icalproperty();</span>
<a href="#l28.7"></a><span id="l28.7"> }</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9"> function test_icalstring() {</span>
<a href="#l28.10"></a><span id="l28.10">     function checkComp(createFunc, icalString, members, properties) {</span>
<a href="#l28.11"></a><span id="l28.11">         let thing = createFunc(icalString);</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-        do_check_eq(ics_unfoldline(thing.icalString), icalString + &quot;\r\n&quot;);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+        equal(ics_unfoldline(thing.icalString), icalString + &quot;\r\n&quot;);</span>
<a href="#l28.14"></a><span id="l28.14"> </span>
<a href="#l28.15"></a><span id="l28.15">         if (members) {</span>
<a href="#l28.16"></a><span id="l28.16">             for (let k in members) {</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-                do_check_eq(thing[k], members[k]);</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineplus">+                equal(thing[k], members[k]);</span>
<a href="#l28.19"></a><span id="l28.19">             }</span>
<a href="#l28.20"></a><span id="l28.20">         }</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22">         if (properties) {</span>
<a href="#l28.23"></a><span id="l28.23">             for (let k in properties) {</span>
<a href="#l28.24"></a><span id="l28.24">                 if (&quot;getParameter&quot; in thing) {</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">-                    do_check_eq(thing.getParameter(k), properties[k]);</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineplus">+                    equal(thing.getParameter(k), properties[k]);</span>
<a href="#l28.27"></a><span id="l28.27">                 } else if (&quot;getProperty&quot; in thing) {</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-                    do_check_eq(thing.getProperty(k), properties[k]);</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+                    equal(thing.getProperty(k), properties[k]);</span>
<a href="#l28.30"></a><span id="l28.30">                 }</span>
<a href="#l28.31"></a><span id="l28.31">             }</span>
<a href="#l28.32"></a><span id="l28.32">         }</span>
<a href="#l28.33"></a><span id="l28.33">         return thing;</span>
<a href="#l28.34"></a><span id="l28.34">     }</span>
<a href="#l28.35"></a><span id="l28.35"> </span>
<a href="#l28.36"></a><span id="l28.36">     let attach = checkComp(cal.createAttachment.bind(cal),</span>
<a href="#l28.37"></a><span id="l28.37">                            &quot;ATTACH;ENCODING=BASE64;FMTTYPE=text/calendar;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l28.38"></a><span id="l28.38">                            { formatType: &quot;text/calendar&quot;, encoding: &quot;BASE64&quot; },</span>
<a href="#l28.39"></a><span id="l28.39">                            { FILENAME: &quot;test.ics&quot; });</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">-    do_check_eq(attach.uri.spec, &quot;http://example.com/test.ics&quot;);</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+    equal(attach.uri.spec, &quot;http://example.com/test.ics&quot;);</span>
<a href="#l28.42"></a><span id="l28.42"> </span>
<a href="#l28.43"></a><span id="l28.43">     checkComp(cal.createAttendee.bind(cal),</span>
<a href="#l28.44"></a><span id="l28.44">               &quot;ATTENDEE;RSVP=TRUE;CN=Name;PARTSTAT=ACCEPTED;CUTYPE=RESOURCE;ROLE=REQ-PARTICIPANT;X-THING=BAR:mailto:test@example.com&quot;,</span>
<a href="#l28.45"></a><span id="l28.45">               { id: &quot;mailto:test@example.com&quot;, commonName: &quot;Name&quot;, rsvp: &quot;TRUE&quot;,</span>
<a href="#l28.46"></a><span id="l28.46">                 isOrganizer: false, role: &quot;REQ-PARTICIPANT&quot;, participationStatus: &quot;ACCEPTED&quot;,</span>
<a href="#l28.47"></a><span id="l28.47">                 userType: &quot;RESOURCE&quot; },</span>
<a href="#l28.48"></a><span id="l28.48">               { &quot;X-THING&quot;: &quot;BAR&quot; });</span>
<a href="#l28.49"></a><span id="l28.49"> </span>
<a href="#l28.50"></a><span id="l28.50">     checkComp(cal.createRelation.bind(cal),</span>
<a href="#l28.51"></a><span id="l28.51">               &quot;RELATED-TO;RELTYPE=SIBLING;FOO=BAR:VALUE&quot;,</span>
<a href="#l28.52"></a><span id="l28.52">               { relType: &quot;SIBLING&quot;, relId: &quot;VALUE&quot; },</span>
<a href="#l28.53"></a><span id="l28.53">               { FOO: &quot;BAR&quot; });</span>
<a href="#l28.54"></a><span id="l28.54"> </span>
<a href="#l28.55"></a><span id="l28.55">     let rrule = checkComp(cal.createRecurrenceRule.bind(cal),</span>
<a href="#l28.56"></a><span id="l28.56">                           &quot;RRULE:FREQ=WEEKLY;COUNT=5;INTERVAL=2;BYDAY=MO&quot;,</span>
<a href="#l28.57"></a><span id="l28.57">                           { count: 5, isByCount: true, type: &quot;WEEKLY&quot;, interval: 2 });</span>
<a href="#l28.58"></a><span id="l28.58" class="difflineminus">-    do_check_eq(rrule.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l28.59"></a><span id="l28.59" class="difflineplus">+    equal(rrule.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l28.60"></a><span id="l28.60"> </span>
<a href="#l28.61"></a><span id="l28.61">     if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l28.62"></a><span id="l28.62">         let rdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l28.63"></a><span id="l28.63">                               &quot;RDATE:20120101T000000&quot;,</span>
<a href="#l28.64"></a><span id="l28.64">                               { isNegative: false });</span>
<a href="#l28.65"></a><span id="l28.65" class="difflineminus">-        do_check_eq(rdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l28.66"></a><span id="l28.66" class="difflineplus">+        equal(rdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l28.67"></a><span id="l28.67">     } else {</span>
<a href="#l28.68"></a><span id="l28.68">         let rdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l28.69"></a><span id="l28.69">                               &quot;RDATE;VALUE=DATE-TIME:20120101T000000&quot;,</span>
<a href="#l28.70"></a><span id="l28.70">                               { isNegative: false });</span>
<a href="#l28.71"></a><span id="l28.71" class="difflineminus">-        do_check_eq(rdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l28.72"></a><span id="l28.72" class="difflineplus">+        equal(rdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l28.73"></a><span id="l28.73">     }</span>
<a href="#l28.74"></a><span id="l28.74"> </span>
<a href="#l28.75"></a><span id="l28.75">     /* TODO consider removing period support, ics throws badarg</span>
<a href="#l28.76"></a><span id="l28.76">     let rdateperiod = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l28.77"></a><span id="l28.77">                                 &quot;RDATE;VALUE=PERIOD;20120101T000000Z/20120102T000000Z&quot;);</span>
<a href="#l28.78"></a><span id="l28.78" class="difflineminus">-    do_check_eq(rdate.date.compare(cal.createDateTime(&quot;20120101T000000Z&quot;)), 0);</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineplus">+    equal(rdate.date.compare(cal.createDateTime(&quot;20120101T000000Z&quot;)), 0);</span>
<a href="#l28.80"></a><span id="l28.80">     */</span>
<a href="#l28.81"></a><span id="l28.81"> </span>
<a href="#l28.82"></a><span id="l28.82">     let exdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l28.83"></a><span id="l28.83">                            &quot;EXDATE:20120101T000000&quot;,</span>
<a href="#l28.84"></a><span id="l28.84">                            { isNegative: true });</span>
<a href="#l28.85"></a><span id="l28.85" class="difflineminus">-    do_check_eq(exdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l28.86"></a><span id="l28.86" class="difflineplus">+    equal(exdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l28.87"></a><span id="l28.87"> }</span>
<a href="#l28.88"></a><span id="l28.88"> </span>
<a href="#l28.89"></a><span id="l28.89"> function test_icsservice() {</span>
<a href="#l28.90"></a><span id="l28.90">     let svc = cal.getIcsService();</span>
<a href="#l28.91"></a><span id="l28.91"> </span>
<a href="#l28.92"></a><span id="l28.92">     function checkProp(createFunc, icalString, members, parameters) {</span>
<a href="#l28.93"></a><span id="l28.93">         let thing = createFunc(icalString);</span>
<a href="#l28.94"></a><span id="l28.94" class="difflineminus">-        do_check_eq(ics_unfoldline(thing.icalString), icalString + &quot;\r\n&quot;);</span>
<a href="#l28.95"></a><span id="l28.95" class="difflineplus">+        equal(ics_unfoldline(thing.icalString), icalString + &quot;\r\n&quot;);</span>
<a href="#l28.96"></a><span id="l28.96"> </span>
<a href="#l28.97"></a><span id="l28.97">         for (let k in members) {</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineminus">-            do_check_eq(thing[k], members[k]);</span>
<a href="#l28.99"></a><span id="l28.99" class="difflineplus">+            equal(thing[k], members[k]);</span>
<a href="#l28.100"></a><span id="l28.100">         }</span>
<a href="#l28.101"></a><span id="l28.101"> </span>
<a href="#l28.102"></a><span id="l28.102">         for (let k in parameters) {</span>
<a href="#l28.103"></a><span id="l28.103" class="difflineminus">-            do_check_eq(thing.getParameter(k), parameters[k]);</span>
<a href="#l28.104"></a><span id="l28.104" class="difflineplus">+            equal(thing.getParameter(k), parameters[k]);</span>
<a href="#l28.105"></a><span id="l28.105">         }</span>
<a href="#l28.106"></a><span id="l28.106">         return thing;</span>
<a href="#l28.107"></a><span id="l28.107">     }</span>
<a href="#l28.108"></a><span id="l28.108"> </span>
<a href="#l28.109"></a><span id="l28.109">     // Test ::createIcalPropertyFromString</span>
<a href="#l28.110"></a><span id="l28.110">     checkProp(svc.createIcalPropertyFromString.bind(svc),</span>
<a href="#l28.111"></a><span id="l28.111">               &quot;ATTACH;ENCODING=BASE64;FMTTYPE=text/calendar;FILENAME=test.ics:http://example.com/test.ics&quot;,</span>
<a href="#l28.112"></a><span id="l28.112">               { value: &quot;http://example.com/test.ics&quot;, propertyName: &quot;ATTACH&quot; },</span>
<a href="#l28.113"></a><span id="l28.113" class="difflineat">@@ -108,70 +108,70 @@ function test_icsservice() {</span>
<a href="#l28.114"></a><span id="l28.114"> </span>
<a href="#l28.115"></a><span id="l28.115">     checkProp(svc.createIcalPropertyFromString.bind(svc),</span>
<a href="#l28.116"></a><span id="l28.116">               &quot;DESCRIPTION:new\\nlines\\nare\\ngreat\\,eh?&quot;,</span>
<a href="#l28.117"></a><span id="l28.117">               { value: &quot;new\nlines\nare\ngreat,eh?&quot;,</span>
<a href="#l28.118"></a><span id="l28.118">                 valueAsIcalString: &quot;new\\nlines\\nare\\ngreat\\,eh?&quot; }, {});</span>
<a href="#l28.119"></a><span id="l28.119"> </span>
<a href="#l28.120"></a><span id="l28.120">     // Test ::createIcalProperty</span>
<a href="#l28.121"></a><span id="l28.121">     let attach2 = svc.createIcalProperty(&quot;ATTACH&quot;);</span>
<a href="#l28.122"></a><span id="l28.122" class="difflineminus">-    do_check_eq(attach2.propertyName, &quot;ATTACH&quot;);</span>
<a href="#l28.123"></a><span id="l28.123" class="difflineplus">+    equal(attach2.propertyName, &quot;ATTACH&quot;);</span>
<a href="#l28.124"></a><span id="l28.124">     attach2.value = &quot;http://example.com/&quot;;</span>
<a href="#l28.125"></a><span id="l28.125" class="difflineminus">-    do_check_eq(attach2.icalString, &quot;ATTACH:http://example.com/\r\n&quot;);</span>
<a href="#l28.126"></a><span id="l28.126" class="difflineplus">+    equal(attach2.icalString, &quot;ATTACH:http://example.com/\r\n&quot;);</span>
<a href="#l28.127"></a><span id="l28.127"> }</span>
<a href="#l28.128"></a><span id="l28.128"> </span>
<a href="#l28.129"></a><span id="l28.129"> function test_icalproperty() {</span>
<a href="#l28.130"></a><span id="l28.130">     let svc = cal.getIcsService();</span>
<a href="#l28.131"></a><span id="l28.131">     let comp = svc.createIcalComponent(&quot;VEVENT&quot;);</span>
<a href="#l28.132"></a><span id="l28.132">     let prop = svc.createIcalProperty(&quot;PROP&quot;);</span>
<a href="#l28.133"></a><span id="l28.133">     prop.value = &quot;VAL&quot;;</span>
<a href="#l28.134"></a><span id="l28.134"> </span>
<a href="#l28.135"></a><span id="l28.135">     comp.addProperty(prop);</span>
<a href="#l28.136"></a><span id="l28.136" class="difflineminus">-    do_check_eq(prop.parent.toString(), comp.toString());</span>
<a href="#l28.137"></a><span id="l28.137" class="difflineminus">-    do_check_eq(prop.valueAsDatetime, null);</span>
<a href="#l28.138"></a><span id="l28.138" class="difflineplus">+    equal(prop.parent.toString(), comp.toString());</span>
<a href="#l28.139"></a><span id="l28.139" class="difflineplus">+    equal(prop.valueAsDatetime, null);</span>
<a href="#l28.140"></a><span id="l28.140"> </span>
<a href="#l28.141"></a><span id="l28.141">     prop = svc.createIcalProperty(&quot;PROP&quot;);</span>
<a href="#l28.142"></a><span id="l28.142">     prop.value = &quot;A\nB&quot;;</span>
<a href="#l28.143"></a><span id="l28.143" class="difflineminus">-    do_check_eq(prop.value, &quot;A\nB&quot;);</span>
<a href="#l28.144"></a><span id="l28.144" class="difflineminus">-    do_check_eq(prop.valueAsIcalString, &quot;A\\nB&quot;);</span>
<a href="#l28.145"></a><span id="l28.145" class="difflineminus">-    do_check_eq(prop.valueAsDatetime, null);</span>
<a href="#l28.146"></a><span id="l28.146" class="difflineplus">+    equal(prop.value, &quot;A\nB&quot;);</span>
<a href="#l28.147"></a><span id="l28.147" class="difflineplus">+    equal(prop.valueAsIcalString, &quot;A\\nB&quot;);</span>
<a href="#l28.148"></a><span id="l28.148" class="difflineplus">+    equal(prop.valueAsDatetime, null);</span>
<a href="#l28.149"></a><span id="l28.149"> </span>
<a href="#l28.150"></a><span id="l28.150">     prop = svc.createIcalProperty(&quot;PROP&quot;);</span>
<a href="#l28.151"></a><span id="l28.151">     prop.valueAsIcalString = &quot;A\\nB&quot;;</span>
<a href="#l28.152"></a><span id="l28.152" class="difflineminus">-    do_check_eq(prop.value, &quot;A\nB&quot;);</span>
<a href="#l28.153"></a><span id="l28.153" class="difflineminus">-    do_check_eq(prop.valueAsIcalString, &quot;A\\nB&quot;);</span>
<a href="#l28.154"></a><span id="l28.154" class="difflineminus">-    do_check_eq(prop.valueAsDatetime, null);</span>
<a href="#l28.155"></a><span id="l28.155" class="difflineplus">+    equal(prop.value, &quot;A\nB&quot;);</span>
<a href="#l28.156"></a><span id="l28.156" class="difflineplus">+    equal(prop.valueAsIcalString, &quot;A\\nB&quot;);</span>
<a href="#l28.157"></a><span id="l28.157" class="difflineplus">+    equal(prop.valueAsDatetime, null);</span>
<a href="#l28.158"></a><span id="l28.158"> </span>
<a href="#l28.159"></a><span id="l28.159">     prop = svc.createIcalProperty(&quot;PROP&quot;);</span>
<a href="#l28.160"></a><span id="l28.160">     prop.value = &quot;A\\nB&quot;;</span>
<a href="#l28.161"></a><span id="l28.161" class="difflineminus">-    do_check_eq(prop.value, &quot;A\\nB&quot;);</span>
<a href="#l28.162"></a><span id="l28.162" class="difflineminus">-    do_check_eq(prop.valueAsIcalString, &quot;A\\\\nB&quot;);</span>
<a href="#l28.163"></a><span id="l28.163" class="difflineminus">-    do_check_eq(prop.valueAsDatetime, null);</span>
<a href="#l28.164"></a><span id="l28.164" class="difflineplus">+    equal(prop.value, &quot;A\\nB&quot;);</span>
<a href="#l28.165"></a><span id="l28.165" class="difflineplus">+    equal(prop.valueAsIcalString, &quot;A\\\\nB&quot;);</span>
<a href="#l28.166"></a><span id="l28.166" class="difflineplus">+    equal(prop.valueAsDatetime, null);</span>
<a href="#l28.167"></a><span id="l28.167"> }</span>
<a href="#l28.168"></a><span id="l28.168"> </span>
<a href="#l28.169"></a><span id="l28.169"> function test_icalcomponent() {</span>
<a href="#l28.170"></a><span id="l28.170">     let svc = cal.getIcsService();</span>
<a href="#l28.171"></a><span id="l28.171">     let event = svc.createIcalComponent(&quot;VEVENT&quot;);</span>
<a href="#l28.172"></a><span id="l28.172">     let todo = svc.createIcalComponent(&quot;VTODO&quot;);</span>
<a href="#l28.173"></a><span id="l28.173">     let alarm = svc.createIcalComponent(&quot;VALARM&quot;);</span>
<a href="#l28.174"></a><span id="l28.174">     event.addSubcomponent(alarm);</span>
<a href="#l28.175"></a><span id="l28.175"> </span>
<a href="#l28.176"></a><span id="l28.176">     // Check that the parent works and does not appear on cloned instances</span>
<a href="#l28.177"></a><span id="l28.177">     let alarm2 = alarm.clone();</span>
<a href="#l28.178"></a><span id="l28.178" class="difflineminus">-    do_check_eq(alarm.parent.toString(), event.toString());</span>
<a href="#l28.179"></a><span id="l28.179" class="difflineminus">-    do_check_eq(alarm2.parent, null);</span>
<a href="#l28.180"></a><span id="l28.180" class="difflineplus">+    equal(alarm.parent.toString(), event.toString());</span>
<a href="#l28.181"></a><span id="l28.181" class="difflineplus">+    equal(alarm2.parent, null);</span>
<a href="#l28.182"></a><span id="l28.182"> </span>
<a href="#l28.183"></a><span id="l28.183">     function check_getset(k, v) {</span>
<a href="#l28.184"></a><span id="l28.184">         dump(&quot;Checking &quot; + k + &quot; = &quot; + v + &quot;\n&quot;);</span>
<a href="#l28.185"></a><span id="l28.185">         event[k] = v;</span>
<a href="#l28.186"></a><span id="l28.186">         vstring = v.icalString || v;</span>
<a href="#l28.187"></a><span id="l28.187" class="difflineminus">-        do_check_eq(event[k].icalString || event[k], vstring);</span>
<a href="#l28.188"></a><span id="l28.188" class="difflineminus">-        do_check_eq(event.serializeToICS().match(new RegExp(vstring, &quot;g&quot;)).length, 1);</span>
<a href="#l28.189"></a><span id="l28.189" class="difflineplus">+        equal(event[k].icalString || event[k], vstring);</span>
<a href="#l28.190"></a><span id="l28.190" class="difflineplus">+        equal(event.serializeToICS().match(new RegExp(vstring, &quot;g&quot;)).length, 1);</span>
<a href="#l28.191"></a><span id="l28.191">         event[k] = v;</span>
<a href="#l28.192"></a><span id="l28.192" class="difflineminus">-        do_check_eq(event.serializeToICS().match(new RegExp(vstring, &quot;g&quot;)).length, 1);</span>
<a href="#l28.193"></a><span id="l28.193" class="difflineplus">+        equal(event.serializeToICS().match(new RegExp(vstring, &quot;g&quot;)).length, 1);</span>
<a href="#l28.194"></a><span id="l28.194">     }</span>
<a href="#l28.195"></a><span id="l28.195"> </span>
<a href="#l28.196"></a><span id="l28.196">     let props = [</span>
<a href="#l28.197"></a><span id="l28.197">        [&quot;uid&quot;, &quot;123&quot;],</span>
<a href="#l28.198"></a><span id="l28.198">        [&quot;prodid&quot;, &quot;//abc/123&quot;],</span>
<a href="#l28.199"></a><span id="l28.199">        [&quot;version&quot;, &quot;2.0&quot;],</span>
<a href="#l28.200"></a><span id="l28.200">        [&quot;method&quot;, &quot;REQUEST&quot;],</span>
<a href="#l28.201"></a><span id="l28.201">        [&quot;status&quot;, &quot;TENTATIVE&quot;],</span>
<a href="#l28.202"></a><span id="l28.202" class="difflineat">@@ -196,26 +196,26 @@ function test_icalcomponent() {</span>
<a href="#l28.203"></a><span id="l28.203">         check_getset.apply(null, prop);</span>
<a href="#l28.204"></a><span id="l28.204">     }</span>
<a href="#l28.205"></a><span id="l28.205"> }</span>
<a href="#l28.206"></a><span id="l28.206"> </span>
<a href="#l28.207"></a><span id="l28.207"> function test_param() {</span>
<a href="#l28.208"></a><span id="l28.208">     let svc = cal.getIcsService();</span>
<a href="#l28.209"></a><span id="l28.209">     let prop = svc.createIcalProperty(&quot;DTSTART&quot;);</span>
<a href="#l28.210"></a><span id="l28.210">     prop.value = &quot;20120101T010101&quot;;</span>
<a href="#l28.211"></a><span id="l28.211" class="difflineminus">-    do_check_eq(prop.icalString, &quot;DTSTART:20120101T010101\r\n&quot;);</span>
<a href="#l28.212"></a><span id="l28.212" class="difflineplus">+    equal(prop.icalString, &quot;DTSTART:20120101T010101\r\n&quot;);</span>
<a href="#l28.213"></a><span id="l28.213">     prop.setParameter(&quot;VALUE&quot;, &quot;TEXT&quot;);</span>
<a href="#l28.214"></a><span id="l28.214" class="difflineminus">-    do_check_eq(prop.icalString, &quot;DTSTART;VALUE=TEXT:20120101T010101\r\n&quot;);</span>
<a href="#l28.215"></a><span id="l28.215" class="difflineplus">+    equal(prop.icalString, &quot;DTSTART;VALUE=TEXT:20120101T010101\r\n&quot;);</span>
<a href="#l28.216"></a><span id="l28.216">     prop.removeParameter(&quot;VALUE&quot;);</span>
<a href="#l28.217"></a><span id="l28.217" class="difflineminus">-    do_check_eq(prop.icalString, &quot;DTSTART:20120101T010101\r\n&quot;);</span>
<a href="#l28.218"></a><span id="l28.218" class="difflineplus">+    equal(prop.icalString, &quot;DTSTART:20120101T010101\r\n&quot;);</span>
<a href="#l28.219"></a><span id="l28.219"> </span>
<a href="#l28.220"></a><span id="l28.220">     prop.setParameter(&quot;X-FOO&quot;, &quot;BAR&quot;);</span>
<a href="#l28.221"></a><span id="l28.221" class="difflineminus">-    do_check_eq(prop.icalString, &quot;DTSTART;X-FOO=BAR:20120101T010101\r\n&quot;);</span>
<a href="#l28.222"></a><span id="l28.222" class="difflineplus">+    equal(prop.icalString, &quot;DTSTART;X-FOO=BAR:20120101T010101\r\n&quot;);</span>
<a href="#l28.223"></a><span id="l28.223">     prop.removeParameter(&quot;X-FOO&quot;, &quot;BAR&quot;);</span>
<a href="#l28.224"></a><span id="l28.224" class="difflineminus">-    do_check_eq(prop.icalString, &quot;DTSTART:20120101T010101\r\n&quot;);</span>
<a href="#l28.225"></a><span id="l28.225" class="difflineplus">+    equal(prop.icalString, &quot;DTSTART:20120101T010101\r\n&quot;);</span>
<a href="#l28.226"></a><span id="l28.226"> </span>
<a href="#l28.227"></a><span id="l28.227"> }</span>
<a href="#l28.228"></a><span id="l28.228"> </span>
<a href="#l28.229"></a><span id="l28.229"> function test_iterator() {</span>
<a href="#l28.230"></a><span id="l28.230">     let svc = cal.getIcsService();</span>
<a href="#l28.231"></a><span id="l28.231"> </span>
<a href="#l28.232"></a><span id="l28.232">     // Property iterator</span>
<a href="#l28.233"></a><span id="l28.233">     let comp = svc.createIcalComponent(&quot;VEVENT&quot;);</span>
<a href="#l28.234"></a><span id="l28.234" class="difflineat">@@ -224,53 +224,53 @@ function test_iterator() {</span>
<a href="#l28.235"></a><span id="l28.235">         let prop = svc.createIcalProperty(propNames[i]);</span>
<a href="#l28.236"></a><span id="l28.236">         prop.value = &quot;&quot; + (i+1);</span>
<a href="#l28.237"></a><span id="l28.237">         comp.addProperty(prop);</span>
<a href="#l28.238"></a><span id="l28.238">     }</span>
<a href="#l28.239"></a><span id="l28.239"> </span>
<a href="#l28.240"></a><span id="l28.240">     for (let p = comp.getFirstProperty(&quot;ANY&quot;);</span>
<a href="#l28.241"></a><span id="l28.241">          p;</span>
<a href="#l28.242"></a><span id="l28.242">          p = comp.getNextProperty(&quot;ANY&quot;)) {</span>
<a href="#l28.243"></a><span id="l28.243" class="difflineminus">-        do_check_eq(p.propertyName, propNames.shift());</span>
<a href="#l28.244"></a><span id="l28.244" class="difflineminus">-        do_check_eq(p.parent.toString(), comp.toString());</span>
<a href="#l28.245"></a><span id="l28.245" class="difflineplus">+        equal(p.propertyName, propNames.shift());</span>
<a href="#l28.246"></a><span id="l28.246" class="difflineplus">+        equal(p.parent.toString(), comp.toString());</span>
<a href="#l28.247"></a><span id="l28.247">     }</span>
<a href="#l28.248"></a><span id="l28.248">     propNames = [&quot;X-ONE&quot;, &quot;X-TWO&quot;];</span>
<a href="#l28.249"></a><span id="l28.249">     for (let p = comp.getNextProperty(&quot;ANY&quot;);</span>
<a href="#l28.250"></a><span id="l28.250">          p;</span>
<a href="#l28.251"></a><span id="l28.251">          p = comp.getNextProperty(&quot;ANY&quot;)) {</span>
<a href="#l28.252"></a><span id="l28.252" class="difflineminus">-        do_check_eq(p.propertyName, propNames.shift());</span>
<a href="#l28.253"></a><span id="l28.253" class="difflineminus">-        do_check_eq(p.parent.toString(), comp.toString());</span>
<a href="#l28.254"></a><span id="l28.254" class="difflineplus">+        equal(p.propertyName, propNames.shift());</span>
<a href="#l28.255"></a><span id="l28.255" class="difflineplus">+        equal(p.parent.toString(), comp.toString());</span>
<a href="#l28.256"></a><span id="l28.256">     }</span>
<a href="#l28.257"></a><span id="l28.257"> </span>
<a href="#l28.258"></a><span id="l28.258">     // Property iterator with multiple values</span>
<a href="#l28.259"></a><span id="l28.259">     comp = svc.parseICS(&quot;BEGIN:VEVENT\r\n&quot; +</span>
<a href="#l28.260"></a><span id="l28.260">                         &quot;CATEGORIES:a,b,c\r\n&quot; +</span>
<a href="#l28.261"></a><span id="l28.261">                         &quot;END:VEVENT&quot;, null);</span>
<a href="#l28.262"></a><span id="l28.262">     let propValues = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];</span>
<a href="#l28.263"></a><span id="l28.263">     for (let p = comp.getFirstProperty(&quot;CATEGORIES&quot;);</span>
<a href="#l28.264"></a><span id="l28.264">          p;</span>
<a href="#l28.265"></a><span id="l28.265">          p = comp.getNextProperty(&quot;CATEGORIES&quot;)) {</span>
<a href="#l28.266"></a><span id="l28.266" class="difflineminus">-        do_check_eq(p.propertyName, &quot;CATEGORIES&quot;);</span>
<a href="#l28.267"></a><span id="l28.267" class="difflineminus">-        do_check_eq(p.value, propValues.shift());</span>
<a href="#l28.268"></a><span id="l28.268" class="difflineminus">-        do_check_eq(p.parent.toString(), comp.toString());</span>
<a href="#l28.269"></a><span id="l28.269" class="difflineplus">+        equal(p.propertyName, &quot;CATEGORIES&quot;);</span>
<a href="#l28.270"></a><span id="l28.270" class="difflineplus">+        equal(p.value, propValues.shift());</span>
<a href="#l28.271"></a><span id="l28.271" class="difflineplus">+        equal(p.parent.toString(), comp.toString());</span>
<a href="#l28.272"></a><span id="l28.272">     }</span>
<a href="#l28.273"></a><span id="l28.273"> </span>
<a href="#l28.274"></a><span id="l28.274">     // Param iterator</span>
<a href="#l28.275"></a><span id="l28.275">     let prop = svc.createIcalProperty(&quot;DTSTART&quot;);</span>
<a href="#l28.276"></a><span id="l28.276">     let params = [&quot;X-ONE&quot;, &quot;X-TWO&quot;];</span>
<a href="#l28.277"></a><span id="l28.277">     for (let i = 0; i &lt; params.length; i++) {</span>
<a href="#l28.278"></a><span id="l28.278">         prop.setParameter(params[i], &quot;&quot; + (i+1));</span>
<a href="#l28.279"></a><span id="l28.279">     }</span>
<a href="#l28.280"></a><span id="l28.280"> </span>
<a href="#l28.281"></a><span id="l28.281">     for (let p = prop.getFirstParameterName();</span>
<a href="#l28.282"></a><span id="l28.282">          p;</span>
<a href="#l28.283"></a><span id="l28.283">          p = prop.getNextParameterName()) {</span>
<a href="#l28.284"></a><span id="l28.284" class="difflineminus">-        do_check_eq(p, params.shift());</span>
<a href="#l28.285"></a><span id="l28.285" class="difflineplus">+        equal(p, params.shift());</span>
<a href="#l28.286"></a><span id="l28.286">     }</span>
<a href="#l28.287"></a><span id="l28.287"> </span>
<a href="#l28.288"></a><span id="l28.288">     // Now try again, but start with next. Should act like first</span>
<a href="#l28.289"></a><span id="l28.289">     params = [&quot;X-ONE&quot;, &quot;X-TWO&quot;];</span>
<a href="#l28.290"></a><span id="l28.290">     for (let p = prop.getNextParameterName();</span>
<a href="#l28.291"></a><span id="l28.291">          p;</span>
<a href="#l28.292"></a><span id="l28.292">          p = prop.getNextParameterName()) {</span>
<a href="#l28.293"></a><span id="l28.293" class="difflineminus">-        do_check_eq(p, params.shift());</span>
<a href="#l28.294"></a><span id="l28.294" class="difflineplus">+        equal(p, params.shift());</span>
<a href="#l28.295"></a><span id="l28.295">     }</span>
<a href="#l28.296"></a><span id="l28.296"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/test/unit/test_items.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/test/unit/test_items.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -42,156 +42,156 @@ function test_aclmanager() {</span>
<a href="#l29.4"></a><span id="l29.4">         userCanViewAll: true,</span>
<a href="#l29.5"></a><span id="l29.5">         userCanViewDateAndTime: false,</span>
<a href="#l29.6"></a><span id="l29.6">     };</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8">     let e = cal.createEvent();</span>
<a href="#l29.9"></a><span id="l29.9">     e.id = &quot;withentry&quot;;</span>
<a href="#l29.10"></a><span id="l29.10">     e.calendar = mockCalendar;</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    do_check_eq(e.aclEntry.userCanModify, itemEntry.userCanModify);</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-    do_check_eq(e.aclEntry.userCanRespond, itemEntry.userCanRespond);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-    do_check_eq(e.aclEntry.userCanViewAll, itemEntry.userCanViewAll);</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-    do_check_eq(e.aclEntry.userCanViewDateAndTime, itemEntry.userCanViewDateAndTime);</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineplus">+    equal(e.aclEntry.userCanModify, itemEntry.userCanModify);</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineplus">+    equal(e.aclEntry.userCanRespond, itemEntry.userCanRespond);</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineplus">+    equal(e.aclEntry.userCanViewAll, itemEntry.userCanViewAll);</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+    equal(e.aclEntry.userCanViewDateAndTime, itemEntry.userCanViewDateAndTime);</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21">     let pe = cal.createEvent();</span>
<a href="#l29.22"></a><span id="l29.22">     pe.id = &quot;parententry&quot;;</span>
<a href="#l29.23"></a><span id="l29.23">     pe.calendar = mockCalendar;</span>
<a href="#l29.24"></a><span id="l29.24">     pe.parentItem = e;</span>
<a href="#l29.25"></a><span id="l29.25"> </span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">-    do_check_eq(pe.aclEntry.userCanModify, itemEntry.userCanModify);</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-    do_check_eq(pe.aclEntry.userCanRespond, itemEntry.userCanRespond);</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">-    do_check_eq(pe.aclEntry.userCanViewAll, itemEntry.userCanViewAll);</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-    do_check_eq(pe.aclEntry.userCanViewDateAndTime, itemEntry.userCanViewDateAndTime);</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineplus">+    equal(pe.aclEntry.userCanModify, itemEntry.userCanModify);</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineplus">+    equal(pe.aclEntry.userCanRespond, itemEntry.userCanRespond);</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+    equal(pe.aclEntry.userCanViewAll, itemEntry.userCanViewAll);</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineplus">+    equal(pe.aclEntry.userCanViewDateAndTime, itemEntry.userCanViewDateAndTime);</span>
<a href="#l29.34"></a><span id="l29.34"> </span>
<a href="#l29.35"></a><span id="l29.35">     e = cal.createEvent();</span>
<a href="#l29.36"></a><span id="l29.36">     e.id = &quot;noentry&quot;;</span>
<a href="#l29.37"></a><span id="l29.37">     e.calendar = mockCalendar;</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">-    do_check_eq(e.aclEntry, null);</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineplus">+    equal(e.aclEntry, null);</span>
<a href="#l29.40"></a><span id="l29.40"> </span>
<a href="#l29.41"></a><span id="l29.41"> }</span>
<a href="#l29.42"></a><span id="l29.42"> </span>
<a href="#l29.43"></a><span id="l29.43"> function test_calendar() {</span>
<a href="#l29.44"></a><span id="l29.44"> </span>
<a href="#l29.45"></a><span id="l29.45">     let e = cal.createEvent();</span>
<a href="#l29.46"></a><span id="l29.46">     let pe = cal.createEvent();</span>
<a href="#l29.47"></a><span id="l29.47"> </span>
<a href="#l29.48"></a><span id="l29.48">     let mockCalendar = {</span>
<a href="#l29.49"></a><span id="l29.49">         id: &quot;one&quot;</span>
<a href="#l29.50"></a><span id="l29.50">     };</span>
<a href="#l29.51"></a><span id="l29.51"> </span>
<a href="#l29.52"></a><span id="l29.52">     pe.calendar = mockCalendar;</span>
<a href="#l29.53"></a><span id="l29.53">     e.parentItem = pe;</span>
<a href="#l29.54"></a><span id="l29.54"> </span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-    do_check_neq(e.calendar, null);</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-    do_check_eq(e.calendar.id, &quot;one&quot;);</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineplus">+    notEqual(e.calendar, null);</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineplus">+    equal(e.calendar.id, &quot;one&quot;);</span>
<a href="#l29.59"></a><span id="l29.59"> }</span>
<a href="#l29.60"></a><span id="l29.60"> </span>
<a href="#l29.61"></a><span id="l29.61"> function test_attachment() {</span>
<a href="#l29.62"></a><span id="l29.62">     let e = cal.createEvent();</span>
<a href="#l29.63"></a><span id="l29.63"> </span>
<a href="#l29.64"></a><span id="l29.64">     let a = cal.createAttachment();</span>
<a href="#l29.65"></a><span id="l29.65">     a.rawData = &quot;horst&quot;;</span>
<a href="#l29.66"></a><span id="l29.66"> </span>
<a href="#l29.67"></a><span id="l29.67">     let b = cal.createAttachment();</span>
<a href="#l29.68"></a><span id="l29.68">     b.rawData = &quot;bruno&quot;;</span>
<a href="#l29.69"></a><span id="l29.69"> </span>
<a href="#l29.70"></a><span id="l29.70">     e.addAttachment(a);</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineminus">-    do_check_eq(e.getAttachments({}).length, 1);</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineplus">+    equal(e.getAttachments({}).length, 1);</span>
<a href="#l29.73"></a><span id="l29.73"> </span>
<a href="#l29.74"></a><span id="l29.74">     e.addAttachment(b);</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineminus">-    do_check_eq(e.getAttachments({}).length, 2);</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineplus">+    equal(e.getAttachments({}).length, 2);</span>
<a href="#l29.77"></a><span id="l29.77"> </span>
<a href="#l29.78"></a><span id="l29.78">     e.removeAttachment(a);</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineminus">-    do_check_eq(e.getAttachments({}).length, 1);</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineplus">+    equal(e.getAttachments({}).length, 1);</span>
<a href="#l29.81"></a><span id="l29.81"> </span>
<a href="#l29.82"></a><span id="l29.82">     e.removeAllAttachments();</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineminus">-    do_check_eq(e.getAttachments({}).length, 0);</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineplus">+    equal(e.getAttachments({}).length, 0);</span>
<a href="#l29.85"></a><span id="l29.85"> }</span>
<a href="#l29.86"></a><span id="l29.86"> </span>
<a href="#l29.87"></a><span id="l29.87"> function test_attendee() {</span>
<a href="#l29.88"></a><span id="l29.88"> </span>
<a href="#l29.89"></a><span id="l29.89">     let e = cal.createEvent();</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineminus">-    do_check_eq(e.getAttendeeById(&quot;unknown&quot;), null);</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineminus">-    do_check_eq(e.getAttendees({}).length, 0);</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineplus">+    equal(e.getAttendeeById(&quot;unknown&quot;), null);</span>
<a href="#l29.93"></a><span id="l29.93" class="difflineplus">+    equal(e.getAttendees({}).length, 0);</span>
<a href="#l29.94"></a><span id="l29.94"> </span>
<a href="#l29.95"></a><span id="l29.95">     let a = cal.createAttendee();</span>
<a href="#l29.96"></a><span id="l29.96">     a.id = &quot;mailto:horst&quot;;</span>
<a href="#l29.97"></a><span id="l29.97"> </span>
<a href="#l29.98"></a><span id="l29.98">     let b = cal.createAttendee();</span>
<a href="#l29.99"></a><span id="l29.99">     b.id = &quot;mailto:bruno&quot;;</span>
<a href="#l29.100"></a><span id="l29.100"> </span>
<a href="#l29.101"></a><span id="l29.101">     e.addAttendee(a);</span>
<a href="#l29.102"></a><span id="l29.102" class="difflineminus">-    do_check_eq(e.getAttendees({}).length, 1);</span>
<a href="#l29.103"></a><span id="l29.103" class="difflineminus">-    do_check_eq(e.getAttendeeById(&quot;mailto:horst&quot;), a);</span>
<a href="#l29.104"></a><span id="l29.104" class="difflineplus">+    equal(e.getAttendees({}).length, 1);</span>
<a href="#l29.105"></a><span id="l29.105" class="difflineplus">+    equal(e.getAttendeeById(&quot;mailto:horst&quot;), a);</span>
<a href="#l29.106"></a><span id="l29.106"> </span>
<a href="#l29.107"></a><span id="l29.107">     e.addAttendee(b);</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-    do_check_eq(e.getAttendees({}).length, 2);</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineplus">+    equal(e.getAttendees({}).length, 2);</span>
<a href="#l29.110"></a><span id="l29.110"> </span>
<a href="#l29.111"></a><span id="l29.111">     let comp = e.icalComponent;</span>
<a href="#l29.112"></a><span id="l29.112">     let aprop = comp.getFirstProperty(&quot;ATTENDEE&quot;);</span>
<a href="#l29.113"></a><span id="l29.113" class="difflineminus">-    do_check_eq(aprop.value, &quot;mailto:horst&quot;);</span>
<a href="#l29.114"></a><span id="l29.114" class="difflineplus">+    equal(aprop.value, &quot;mailto:horst&quot;);</span>
<a href="#l29.115"></a><span id="l29.115">     aprop = comp.getNextProperty(&quot;ATTENDEE&quot;);</span>
<a href="#l29.116"></a><span id="l29.116" class="difflineminus">-    do_check_eq(aprop.value, &quot;mailto:bruno&quot;);</span>
<a href="#l29.117"></a><span id="l29.117" class="difflineminus">-    do_check_eq(comp.getNextProperty(&quot;ATTENDEE&quot;), null);</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineplus">+    equal(aprop.value, &quot;mailto:bruno&quot;);</span>
<a href="#l29.119"></a><span id="l29.119" class="difflineplus">+    equal(comp.getNextProperty(&quot;ATTENDEE&quot;), null);</span>
<a href="#l29.120"></a><span id="l29.120"> </span>
<a href="#l29.121"></a><span id="l29.121">     e.removeAttendee(a);</span>
<a href="#l29.122"></a><span id="l29.122" class="difflineminus">-    do_check_eq(e.getAttendees({}).length, 1);</span>
<a href="#l29.123"></a><span id="l29.123" class="difflineminus">-    do_check_eq(e.getAttendeeById(&quot;mailto:horst&quot;), null);</span>
<a href="#l29.124"></a><span id="l29.124" class="difflineplus">+    equal(e.getAttendees({}).length, 1);</span>
<a href="#l29.125"></a><span id="l29.125" class="difflineplus">+    equal(e.getAttendeeById(&quot;mailto:horst&quot;), null);</span>
<a href="#l29.126"></a><span id="l29.126"> </span>
<a href="#l29.127"></a><span id="l29.127">     e.removeAllAttendees();</span>
<a href="#l29.128"></a><span id="l29.128" class="difflineminus">-    do_check_eq(e.getAttendees({}).length, 0);</span>
<a href="#l29.129"></a><span id="l29.129" class="difflineplus">+    equal(e.getAttendees({}).length, 0);</span>
<a href="#l29.130"></a><span id="l29.130"> }</span>
<a href="#l29.131"></a><span id="l29.131"> </span>
<a href="#l29.132"></a><span id="l29.132"> function test_categories() {</span>
<a href="#l29.133"></a><span id="l29.133"> </span>
<a href="#l29.134"></a><span id="l29.134">     let e = cal.createEvent();</span>
<a href="#l29.135"></a><span id="l29.135"> </span>
<a href="#l29.136"></a><span id="l29.136" class="difflineminus">-    do_check_eq(e.getCategories({}).length, 0);</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineplus">+    equal(e.getCategories({}).length, 0);</span>
<a href="#l29.138"></a><span id="l29.138"> </span>
<a href="#l29.139"></a><span id="l29.139">     let cat = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];</span>
<a href="#l29.140"></a><span id="l29.140">     e.setCategories(3, cat);</span>
<a href="#l29.141"></a><span id="l29.141"> </span>
<a href="#l29.142"></a><span id="l29.142">     cat[0] = &quot;err&quot;;</span>
<a href="#l29.143"></a><span id="l29.143" class="difflineminus">-    do_check_eq(e.getCategories({}).join(&quot;,&quot;), &quot;a,b,c&quot;);</span>
<a href="#l29.144"></a><span id="l29.144" class="difflineplus">+    equal(e.getCategories({}).join(&quot;,&quot;), &quot;a,b,c&quot;);</span>
<a href="#l29.145"></a><span id="l29.145"> </span>
<a href="#l29.146"></a><span id="l29.146">     let comp = e.icalComponent;</span>
<a href="#l29.147"></a><span id="l29.147">     let getter = comp.getFirstProperty.bind(comp);</span>
<a href="#l29.148"></a><span id="l29.148"> </span>
<a href="#l29.149"></a><span id="l29.149">     cat[0] = &quot;a&quot;;</span>
<a href="#l29.150"></a><span id="l29.150">     while (cat.length) {</span>
<a href="#l29.151"></a><span id="l29.151" class="difflineminus">-        do_check_eq(cat.shift(), getter(&quot;CATEGORIES&quot;).value);</span>
<a href="#l29.152"></a><span id="l29.152" class="difflineplus">+        equal(cat.shift(), getter(&quot;CATEGORIES&quot;).value);</span>
<a href="#l29.153"></a><span id="l29.153">         getter = comp.getNextProperty.bind(comp);</span>
<a href="#l29.154"></a><span id="l29.154">     }</span>
<a href="#l29.155"></a><span id="l29.155"> }</span>
<a href="#l29.156"></a><span id="l29.156"> </span>
<a href="#l29.157"></a><span id="l29.157"> function test_alarm() {</span>
<a href="#l29.158"></a><span id="l29.158">     let e = cal.createEvent();</span>
<a href="#l29.159"></a><span id="l29.159">     let alarm = cal.createAlarm();</span>
<a href="#l29.160"></a><span id="l29.160"> </span>
<a href="#l29.161"></a><span id="l29.161">     alarm.action = &quot;DISPLAY&quot;;</span>
<a href="#l29.162"></a><span id="l29.162">     alarm.related = Components.interfaces.calIAlarm.ALARM_RELATED_ABSOLUTE;</span>
<a href="#l29.163"></a><span id="l29.163">     alarm.alarmDate = cal.createDateTime();</span>
<a href="#l29.164"></a><span id="l29.164"> </span>
<a href="#l29.165"></a><span id="l29.165">     e.addAlarm(alarm);</span>
<a href="#l29.166"></a><span id="l29.166">     let ecomp = e.icalComponent;</span>
<a href="#l29.167"></a><span id="l29.167">     let vcomp = ecomp.getFirstSubcomponent(&quot;VALARM&quot;);</span>
<a href="#l29.168"></a><span id="l29.168" class="difflineminus">-    do_check_eq(vcomp.serializeToICS(), alarm.icalString);</span>
<a href="#l29.169"></a><span id="l29.169" class="difflineplus">+    equal(vcomp.serializeToICS(), alarm.icalString);</span>
<a href="#l29.170"></a><span id="l29.170"> </span>
<a href="#l29.171"></a><span id="l29.171">     let alarm2 = alarm.clone();</span>
<a href="#l29.172"></a><span id="l29.172"> </span>
<a href="#l29.173"></a><span id="l29.173">     e.addAlarm(alarm2);</span>
<a href="#l29.174"></a><span id="l29.174"> </span>
<a href="#l29.175"></a><span id="l29.175" class="difflineminus">-    do_check_eq(e.getAlarms({}).length, 2);</span>
<a href="#l29.176"></a><span id="l29.176" class="difflineplus">+    equal(e.getAlarms({}).length, 2);</span>
<a href="#l29.177"></a><span id="l29.177">     e.deleteAlarm(alarm);</span>
<a href="#l29.178"></a><span id="l29.178" class="difflineminus">-    do_check_eq(e.getAlarms({}).length, 1);</span>
<a href="#l29.179"></a><span id="l29.179" class="difflineminus">-    do_check_eq(e.getAlarms({})[0], alarm2);</span>
<a href="#l29.180"></a><span id="l29.180" class="difflineplus">+    equal(e.getAlarms({}).length, 1);</span>
<a href="#l29.181"></a><span id="l29.181" class="difflineplus">+    equal(e.getAlarms({})[0], alarm2);</span>
<a href="#l29.182"></a><span id="l29.182"> </span>
<a href="#l29.183"></a><span id="l29.183">     e.clearAlarms();</span>
<a href="#l29.184"></a><span id="l29.184" class="difflineminus">-    do_check_eq(e.getAlarms({}).length, 0);</span>
<a href="#l29.185"></a><span id="l29.185" class="difflineplus">+    equal(e.getAlarms({}).length, 0);</span>
<a href="#l29.186"></a><span id="l29.186"> }</span>
<a href="#l29.187"></a><span id="l29.187"> </span>
<a href="#l29.188"></a><span id="l29.188"> function test_immutable() {</span>
<a href="#l29.189"></a><span id="l29.189"> </span>
<a href="#l29.190"></a><span id="l29.190">     let e = cal.createEvent();</span>
<a href="#l29.191"></a><span id="l29.191"> </span>
<a href="#l29.192"></a><span id="l29.192">     let dt = cal.createDateTime();</span>
<a href="#l29.193"></a><span id="l29.193">     dt.timezone = cal.getTimezoneService().getTimezone(&quot;Europe/Berlin&quot;);</span>
<a href="#l29.194"></a><span id="l29.194" class="difflineat">@@ -208,67 +208,67 @@ function test_immutable() {</span>
<a href="#l29.195"></a><span id="l29.195">     alarm.offset = cal.createDuration(&quot;PT1S&quot;);</span>
<a href="#l29.196"></a><span id="l29.196">     e.addAlarm(alarm);</span>
<a href="#l29.197"></a><span id="l29.197"> </span>
<a href="#l29.198"></a><span id="l29.198">     e.setProperty(&quot;X-NAME&quot;, &quot;X-VALUE&quot;);</span>
<a href="#l29.199"></a><span id="l29.199">     e.setPropertyParameter(&quot;X-NAME&quot;, &quot;X-PARAM&quot;, &quot;X-PARAMVAL&quot;);</span>
<a href="#l29.200"></a><span id="l29.200"> </span>
<a href="#l29.201"></a><span id="l29.201">     e.setCategories(3, [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]);</span>
<a href="#l29.202"></a><span id="l29.202"> </span>
<a href="#l29.203"></a><span id="l29.203" class="difflineminus">-    do_check_eq(e.alarmLastAck.timezone.tzid, cal.UTC().tzid);</span>
<a href="#l29.204"></a><span id="l29.204" class="difflineplus">+    equal(e.alarmLastAck.timezone.tzid, cal.UTC().tzid);</span>
<a href="#l29.205"></a><span id="l29.205"> </span>
<a href="#l29.206"></a><span id="l29.206">     e.makeImmutable();</span>
<a href="#l29.207"></a><span id="l29.207"> </span>
<a href="#l29.208"></a><span id="l29.208">     // call again, should not throw</span>
<a href="#l29.209"></a><span id="l29.209">     e.makeImmutable();</span>
<a href="#l29.210"></a><span id="l29.210"> </span>
<a href="#l29.211"></a><span id="l29.211" class="difflineminus">-    do_check_false(e.alarmLastAck.isMutable);</span>
<a href="#l29.212"></a><span id="l29.212" class="difflineminus">-    do_check_false(org.isMutable);</span>
<a href="#l29.213"></a><span id="l29.213" class="difflineminus">-    do_check_false(alarm.isMutable);</span>
<a href="#l29.214"></a><span id="l29.214" class="difflineplus">+    ok(!e.alarmLastAck.isMutable);</span>
<a href="#l29.215"></a><span id="l29.215" class="difflineplus">+    ok(!org.isMutable);</span>
<a href="#l29.216"></a><span id="l29.216" class="difflineplus">+    ok(!alarm.isMutable);</span>
<a href="#l29.217"></a><span id="l29.217"> </span>
<a href="#l29.218"></a><span id="l29.218" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l29.219"></a><span id="l29.219" class="difflineplus">+    throws(function() {</span>
<a href="#l29.220"></a><span id="l29.220">         e.alarmLastAck = cal.createDateTime();</span>
<a href="#l29.221"></a><span id="l29.221" class="difflineminus">-    }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l29.222"></a><span id="l29.222" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l29.223"></a><span id="l29.223" class="difflineplus">+    }, /Can not modify immutable data container/);</span>
<a href="#l29.224"></a><span id="l29.224" class="difflineplus">+    throws(function() {</span>
<a href="#l29.225"></a><span id="l29.225">         e.calendar = null;</span>
<a href="#l29.226"></a><span id="l29.226" class="difflineminus">-    }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l29.227"></a><span id="l29.227" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l29.228"></a><span id="l29.228" class="difflineplus">+    }, /Can not modify immutable data container/);</span>
<a href="#l29.229"></a><span id="l29.229" class="difflineplus">+    throws(function() {</span>
<a href="#l29.230"></a><span id="l29.230">         e.parentItem = null;</span>
<a href="#l29.231"></a><span id="l29.231" class="difflineminus">-    }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l29.232"></a><span id="l29.232" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l29.233"></a><span id="l29.233" class="difflineplus">+    }, /Can not modify immutable data container/);</span>
<a href="#l29.234"></a><span id="l29.234" class="difflineplus">+    throws(function() {</span>
<a href="#l29.235"></a><span id="l29.235">         e.setCategories(3, [&quot;d&quot;, &quot;e&quot;, &quot;f&quot;]);</span>
<a href="#l29.236"></a><span id="l29.236" class="difflineminus">-    }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l29.237"></a><span id="l29.237" class="difflineplus">+    }, /Can not modify immutable data container/);</span>
<a href="#l29.238"></a><span id="l29.238"> </span>
<a href="#l29.239"></a><span id="l29.239">     let e2 = e.clone();</span>
<a href="#l29.240"></a><span id="l29.240">     e2.organizer.id = &quot;two&quot;;</span>
<a href="#l29.241"></a><span id="l29.241"> </span>
<a href="#l29.242"></a><span id="l29.242" class="difflineminus">-    do_check_eq(org.id, &quot;one&quot;);</span>
<a href="#l29.243"></a><span id="l29.243" class="difflineminus">-    do_check_eq(e2.organizer.id, &quot;two&quot;);</span>
<a href="#l29.244"></a><span id="l29.244" class="difflineplus">+    equal(org.id, &quot;one&quot;);</span>
<a href="#l29.245"></a><span id="l29.245" class="difflineplus">+    equal(e2.organizer.id, &quot;two&quot;);</span>
<a href="#l29.246"></a><span id="l29.246"> </span>
<a href="#l29.247"></a><span id="l29.247" class="difflineminus">-    do_check_eq(e2.getProperty(&quot;X-NAME&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l29.248"></a><span id="l29.248" class="difflineminus">-    do_check_eq(e2.getPropertyParameter(&quot;X-NAME&quot;, &quot;X-PARAM&quot;), &quot;X-PARAMVAL&quot;);</span>
<a href="#l29.249"></a><span id="l29.249" class="difflineplus">+    equal(e2.getProperty(&quot;X-NAME&quot;), &quot;X-VALUE&quot;);</span>
<a href="#l29.250"></a><span id="l29.250" class="difflineplus">+    equal(e2.getPropertyParameter(&quot;X-NAME&quot;, &quot;X-PARAM&quot;), &quot;X-PARAMVAL&quot;);</span>
<a href="#l29.251"></a><span id="l29.251"> </span>
<a href="#l29.252"></a><span id="l29.252">     e2.setPropertyParameter(&quot;X-NAME&quot;, &quot;X-PARAM&quot;, null);</span>
<a href="#l29.253"></a><span id="l29.253" class="difflineminus">-    do_check_eq(e2.getPropertyParameter(&quot;X-NAME&quot;, &quot;X-PARAM&quot;), null);</span>
<a href="#l29.254"></a><span id="l29.254" class="difflineplus">+    equal(e2.getPropertyParameter(&quot;X-NAME&quot;, &quot;X-PARAM&quot;), null);</span>
<a href="#l29.255"></a><span id="l29.255"> </span>
<a href="#l29.256"></a><span id="l29.256">     // TODO more clone checks</span>
<a href="#l29.257"></a><span id="l29.257"> }</span>
<a href="#l29.258"></a><span id="l29.258"> </span>
<a href="#l29.259"></a><span id="l29.259"> function test_lastack() {</span>
<a href="#l29.260"></a><span id="l29.260"> </span>
<a href="#l29.261"></a><span id="l29.261">     let e = cal.createEvent();</span>
<a href="#l29.262"></a><span id="l29.262"> </span>
<a href="#l29.263"></a><span id="l29.263">     e.alarmLastAck = cal.createDateTime(&quot;20120101T010101&quot;);</span>
<a href="#l29.264"></a><span id="l29.264"> </span>
<a href="#l29.265"></a><span id="l29.265">     // Our items don't support this yet</span>
<a href="#l29.266"></a><span id="l29.266" class="difflineminus">-    //do_check_eq(e.getProperty(&quot;X-MOZ-LASTACK&quot;), &quot;20120101T010101&quot;);</span>
<a href="#l29.267"></a><span id="l29.267" class="difflineplus">+    //equal(e.getProperty(&quot;X-MOZ-LASTACK&quot;), &quot;20120101T010101&quot;);</span>
<a href="#l29.268"></a><span id="l29.268"> </span>
<a href="#l29.269"></a><span id="l29.269">     let comp = e.icalComponent;</span>
<a href="#l29.270"></a><span id="l29.270">     let prop = comp.getFirstProperty(&quot;X-MOZ-LASTACK&quot;);</span>
<a href="#l29.271"></a><span id="l29.271"> </span>
<a href="#l29.272"></a><span id="l29.272" class="difflineminus">-    do_check_eq(prop.value, &quot;20120101T010101Z&quot;);</span>
<a href="#l29.273"></a><span id="l29.273" class="difflineplus">+    equal(prop.value, &quot;20120101T010101Z&quot;);</span>
<a href="#l29.274"></a><span id="l29.274"> </span>
<a href="#l29.275"></a><span id="l29.275">     prop.value = &quot;20120101T010102Z&quot;;</span>
<a href="#l29.276"></a><span id="l29.276"> </span>
<a href="#l29.277"></a><span id="l29.277">     e.icalComponent = comp;</span>
<a href="#l29.278"></a><span id="l29.278"> </span>
<a href="#l29.279"></a><span id="l29.279" class="difflineminus">-    do_check_eq(e.alarmLastAck.icalString, &quot;20120101T010102Z&quot;);</span>
<a href="#l29.280"></a><span id="l29.280" class="difflineplus">+    equal(e.alarmLastAck.icalString, &quot;20120101T010102Z&quot;);</span>
<a href="#l29.281"></a><span id="l29.281"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -274,22 +274,22 @@ function run_test() {</span>
<a href="#l30.4"></a><span id="l30.4">         // implement listener</span>
<a href="#l30.5"></a><span id="l30.5">         var count = 0;</span>
<a href="#l30.6"></a><span id="l30.6">         var listener = {</span>
<a href="#l30.7"></a><span id="l30.7">             onOperationComplete: function(aCalendar,</span>
<a href="#l30.8"></a><span id="l30.8">                                           aStatus,</span>
<a href="#l30.9"></a><span id="l30.9">                                           aOperationType,</span>
<a href="#l30.10"></a><span id="l30.10">                                           aId,</span>
<a href="#l30.11"></a><span id="l30.11">                                           aDetail) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-                do_check_eq(aStatus, 0);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+                equal(aStatus, 0);</span>
<a href="#l30.14"></a><span id="l30.14">                 if (aOperationType == Ci.calIOperationListener.ADD) {</span>
<a href="#l30.15"></a><span id="l30.15">                     // perform getItems() on calendar</span>
<a href="#l30.16"></a><span id="l30.16">                     aCalendar.getItems(filter, 0, rangeStart, rangeEnd, listener);</span>
<a href="#l30.17"></a><span id="l30.17">                 } else if (aOperationType == Ci.calIOperationListener.GET) {</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineminus">-                    do_check_eq(count, aResult);</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+                    equal(count, aResult);</span>
<a href="#l30.20"></a><span id="l30.20">                     do_test_finished();</span>
<a href="#l30.21"></a><span id="l30.21">                 }</span>
<a href="#l30.22"></a><span id="l30.22">             },</span>
<a href="#l30.23"></a><span id="l30.23">             onGetResult: function(aCalendar,</span>
<a href="#l30.24"></a><span id="l30.24">                                   aStatus,</span>
<a href="#l30.25"></a><span id="l30.25">                                   aItemType,</span>
<a href="#l30.26"></a><span id="l30.26">                                   aDetail,</span>
<a href="#l30.27"></a><span id="l30.27">                                   aCount,</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineat">@@ -324,23 +324,23 @@ function run_test() {</span>
<a href="#l30.29"></a><span id="l30.29">             var count = 0;</span>
<a href="#l30.30"></a><span id="l30.30">             var returnedItem = null;</span>
<a href="#l30.31"></a><span id="l30.31">             var listener = {</span>
<a href="#l30.32"></a><span id="l30.32">                 onOperationComplete: function(aCalendar,</span>
<a href="#l30.33"></a><span id="l30.33">                                               aStatus,</span>
<a href="#l30.34"></a><span id="l30.34">                                               aOperationType,</span>
<a href="#l30.35"></a><span id="l30.35">                                               aId,</span>
<a href="#l30.36"></a><span id="l30.36">                                               aDetail) {</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineminus">-                    do_check_eq(aStatus, 0);</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineplus">+                    equal(aStatus, 0);</span>
<a href="#l30.39"></a><span id="l30.39">                     if (aOperationType == Ci.calIOperationListener.ADD) {</span>
<a href="#l30.40"></a><span id="l30.40">                         compareItemsSpecific(aDetail, aItem);</span>
<a href="#l30.41"></a><span id="l30.41">                         // perform getItem() on calendar</span>
<a href="#l30.42"></a><span id="l30.42">                         aCalendar.getItem(aId, listener);</span>
<a href="#l30.43"></a><span id="l30.43">                     } else if (aOperationType == Ci.calIOperationListener.GET) {</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineminus">-                        do_check_eq(count, 1);</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+                        equal(count, 1);</span>
<a href="#l30.46"></a><span id="l30.46">                         compareItemsSpecific(returnedItem, aItem);</span>
<a href="#l30.47"></a><span id="l30.47">                     }</span>
<a href="#l30.48"></a><span id="l30.48">                 },</span>
<a href="#l30.49"></a><span id="l30.49">                 onGetResult: function(aCalendar,</span>
<a href="#l30.50"></a><span id="l30.50">                                       aStatus,</span>
<a href="#l30.51"></a><span id="l30.51">                                       aItemType,</span>
<a href="#l30.52"></a><span id="l30.52">                                       aDetail,</span>
<a href="#l30.53"></a><span id="l30.53">                                       aCount,</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineat">@@ -364,55 +364,55 @@ function testMetaData() {</span>
<a href="#l30.55"></a><span id="l30.55">         dump(&quot;testMetaData_() calendar type: &quot; + aCalendar.type + &quot;\n&quot;);</span>
<a href="#l30.56"></a><span id="l30.56">         var event1 = createEventFromIcalString(&quot;BEGIN:VEVENT\n&quot; +</span>
<a href="#l30.57"></a><span id="l30.57">                                                &quot;DTSTART;VALUE=DATE:20020402\n&quot; +</span>
<a href="#l30.58"></a><span id="l30.58">                                                &quot;END:VEVENT\n&quot;);</span>
<a href="#l30.59"></a><span id="l30.59"> </span>
<a href="#l30.60"></a><span id="l30.60">         event1.id = &quot;item1&quot;;</span>
<a href="#l30.61"></a><span id="l30.61">         aCalendar.addItem(event1, null);</span>
<a href="#l30.62"></a><span id="l30.62">         aCalendar.setMetaData(&quot;item1&quot;, &quot;meta1&quot;);</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;item1&quot;), &quot;meta1&quot;);</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;unknown&quot;), null);</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;item1&quot;), &quot;meta1&quot;);</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;unknown&quot;), null);</span>
<a href="#l30.67"></a><span id="l30.67"> </span>
<a href="#l30.68"></a><span id="l30.68">         var event2 = event1.clone();</span>
<a href="#l30.69"></a><span id="l30.69">         event2.id = &quot;item2&quot;;</span>
<a href="#l30.70"></a><span id="l30.70">         aCalendar.addItem(event2, null);</span>
<a href="#l30.71"></a><span id="l30.71">         aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2-&quot;);</span>
<a href="#l30.72"></a><span id="l30.72" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2-&quot;);</span>
<a href="#l30.73"></a><span id="l30.73" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2-&quot;);</span>
<a href="#l30.74"></a><span id="l30.74"> </span>
<a href="#l30.75"></a><span id="l30.75">         aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2&quot;);</span>
<a href="#l30.76"></a><span id="l30.76" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l30.77"></a><span id="l30.77" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l30.78"></a><span id="l30.78"> </span>
<a href="#l30.79"></a><span id="l30.79">         var count = {};</span>
<a href="#l30.80"></a><span id="l30.80">         var ids = {};</span>
<a href="#l30.81"></a><span id="l30.81">         var values = {};</span>
<a href="#l30.82"></a><span id="l30.82">         aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l30.83"></a><span id="l30.83" class="difflineminus">-        do_check_eq(count.value, 2);</span>
<a href="#l30.84"></a><span id="l30.84" class="difflineminus">-        do_check_true(ids.value[0] ==  &quot;item1&quot; || ids.value[1] == &quot;item1&quot;);</span>
<a href="#l30.85"></a><span id="l30.85" class="difflineminus">-        do_check_true(ids.value[0] ==  &quot;item2&quot; || ids.value[1] == &quot;item2&quot;);</span>
<a href="#l30.86"></a><span id="l30.86" class="difflineminus">-        do_check_true(values.value[0] ==  &quot;meta1&quot; || values.value[1] == &quot;meta1&quot;);</span>
<a href="#l30.87"></a><span id="l30.87" class="difflineminus">-        do_check_true(values.value[0] ==  &quot;meta2&quot; || values.value[1] == &quot;meta2&quot;);</span>
<a href="#l30.88"></a><span id="l30.88" class="difflineplus">+        equal(count.value, 2);</span>
<a href="#l30.89"></a><span id="l30.89" class="difflineplus">+        ok(ids.value[0] ==  &quot;item1&quot; || ids.value[1] == &quot;item1&quot;);</span>
<a href="#l30.90"></a><span id="l30.90" class="difflineplus">+        ok(ids.value[0] ==  &quot;item2&quot; || ids.value[1] == &quot;item2&quot;);</span>
<a href="#l30.91"></a><span id="l30.91" class="difflineplus">+        ok(values.value[0] ==  &quot;meta1&quot; || values.value[1] == &quot;meta1&quot;);</span>
<a href="#l30.92"></a><span id="l30.92" class="difflineplus">+        ok(values.value[0] ==  &quot;meta2&quot; || values.value[1] == &quot;meta2&quot;);</span>
<a href="#l30.93"></a><span id="l30.93"> </span>
<a href="#l30.94"></a><span id="l30.94">         aCalendar.deleteItem(event1, null);</span>
<a href="#l30.95"></a><span id="l30.95" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;item1&quot;), null);</span>
<a href="#l30.96"></a><span id="l30.96" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;item1&quot;), null);</span>
<a href="#l30.97"></a><span id="l30.97">         aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l30.98"></a><span id="l30.98" class="difflineminus">-        do_check_eq(count.value, 1);</span>
<a href="#l30.99"></a><span id="l30.99" class="difflineminus">-        do_check_true(ids.value[0] ==  &quot;item2&quot;);</span>
<a href="#l30.100"></a><span id="l30.100" class="difflineminus">-        do_check_true(values.value[0] ==  &quot;meta2&quot;);</span>
<a href="#l30.101"></a><span id="l30.101" class="difflineplus">+        equal(count.value, 1);</span>
<a href="#l30.102"></a><span id="l30.102" class="difflineplus">+        ok(ids.value[0] ==  &quot;item2&quot;);</span>
<a href="#l30.103"></a><span id="l30.103" class="difflineplus">+        ok(values.value[0] ==  &quot;meta2&quot;);</span>
<a href="#l30.104"></a><span id="l30.104"> </span>
<a href="#l30.105"></a><span id="l30.105">         aCalendar.deleteMetaData(&quot;item2&quot;);</span>
<a href="#l30.106"></a><span id="l30.106" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l30.107"></a><span id="l30.107" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l30.108"></a><span id="l30.108">         aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l30.109"></a><span id="l30.109" class="difflineminus">-        do_check_eq(count.value, 0);</span>
<a href="#l30.110"></a><span id="l30.110" class="difflineplus">+        equal(count.value, 0);</span>
<a href="#l30.111"></a><span id="l30.111"> </span>
<a href="#l30.112"></a><span id="l30.112">         aCalendar.setMetaData(&quot;item2&quot;, &quot;meta2&quot;);</span>
<a href="#l30.113"></a><span id="l30.113" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l30.114"></a><span id="l30.114" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;item2&quot;), &quot;meta2&quot;);</span>
<a href="#l30.115"></a><span id="l30.115">         aCalendar.QueryInterface(Ci.calICalendarProvider).deleteCalendar(aCalendar, null);</span>
<a href="#l30.116"></a><span id="l30.116" class="difflineminus">-        do_check_eq(aCalendar.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l30.117"></a><span id="l30.117" class="difflineplus">+        equal(aCalendar.getMetaData(&quot;item2&quot;), null);</span>
<a href="#l30.118"></a><span id="l30.118">         aCalendar.getAllMetaData(count, ids, values);</span>
<a href="#l30.119"></a><span id="l30.119" class="difflineminus">-        do_check_eq(count.value, 0);</span>
<a href="#l30.120"></a><span id="l30.120" class="difflineplus">+        equal(count.value, 0);</span>
<a href="#l30.121"></a><span id="l30.121"> </span>
<a href="#l30.122"></a><span id="l30.122">         aCalendar.deleteMetaData(&quot;unknown&quot;); // check graceful return</span>
<a href="#l30.123"></a><span id="l30.123">     }</span>
<a href="#l30.124"></a><span id="l30.124"> </span>
<a href="#l30.125"></a><span id="l30.125">     testMetaData_(getMemoryCal());</span>
<a href="#l30.126"></a><span id="l30.126">     testMetaData_(getStorageCal());</span>
<a href="#l30.127"></a><span id="l30.127"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -34,56 +34,56 @@ function test_rules() {</span>
<a href="#l31.4"></a><span id="l31.4">         let start = createDate(1990, 0, 1);</span>
<a href="#l31.5"></a><span id="l31.5">         let end = createDate(2020, 0, 1);</span>
<a href="#l31.6"></a><span id="l31.6">         let recdates = event.recurrenceInfo.getOccurrenceDates(start, end, 0, {});</span>
<a href="#l31.7"></a><span id="l31.7">         let occurrences = event.recurrenceInfo.getOccurrences(start, end, 0, {});</span>
<a href="#l31.8"></a><span id="l31.8"> </span>
<a href="#l31.9"></a><span id="l31.9">         // Check number of items</span>
<a href="#l31.10"></a><span id="l31.10">         dump(&quot;Expected &quot; + expected.length + &quot; occurrences\n&quot;);</span>
<a href="#l31.11"></a><span id="l31.11">         dump(&quot;Got: &quot; + recdates.map(function(x) x.toString()) + &quot;\n&quot;);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-        //do_check_eq(recdates.length, expected.length);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+        //equal(recdates.length, expected.length);</span>
<a href="#l31.14"></a><span id="l31.14">         let fmt = cal.getDateFormatter();</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16">         for (let i = 0; i &lt; expected.length; i++) {</span>
<a href="#l31.17"></a><span id="l31.17">             // Check each date</span>
<a href="#l31.18"></a><span id="l31.18">             let ed = cal.createDateTime(expected[i]);</span>
<a href="#l31.19"></a><span id="l31.19">             dump(&quot;Expecting instance at &quot; + ed + &quot;(&quot; + fmt.dayName(ed.weekday) + &quot;)\n&quot;);</span>
<a href="#l31.20"></a><span id="l31.20">             dump(&quot;Recdate:&quot;);</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">-            do_check_eq(recdates[i].icalString, expected[i]);</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+            equal(recdates[i].icalString, expected[i]);</span>
<a href="#l31.23"></a><span id="l31.23"> </span>
<a href="#l31.24"></a><span id="l31.24">             // Make sure occurrences are correct</span>
<a href="#l31.25"></a><span id="l31.25">             dump(&quot;Occurrence:&quot;);</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">-            do_check_eq(occurrences[i].startDate.icalString, expected[i]);</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineplus">+            equal(occurrences[i].startDate.icalString, expected[i]);</span>
<a href="#l31.28"></a><span id="l31.28"> </span>
<a href="#l31.29"></a><span id="l31.29">             if (ignoreNextOccCheck) {</span>
<a href="#l31.30"></a><span id="l31.30">                 continue;</span>
<a href="#l31.31"></a><span id="l31.31">             }</span>
<a href="#l31.32"></a><span id="l31.32"> </span>
<a href="#l31.33"></a><span id="l31.33">             // Make sure getNextOccurrence works correctly</span>
<a href="#l31.34"></a><span id="l31.34">             let nextOcc = event.recurrenceInfo.getNextOccurrence(recdates[i]);</span>
<a href="#l31.35"></a><span id="l31.35">             if (expected.length &gt; i + 1) {</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineminus">-                do_check_neq(nextOcc, null);</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineplus">+                notEqual(nextOcc, null);</span>
<a href="#l31.38"></a><span id="l31.38">                 dump(&quot;Checking next occurrence: &quot; + expected[i+1]+&quot;\n&quot;);</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineminus">-                do_check_eq(nextOcc.startDate.icalString, expected[i + 1]);</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineplus">+                equal(nextOcc.startDate.icalString, expected[i + 1]);</span>
<a href="#l31.41"></a><span id="l31.41">             } else {</span>
<a href="#l31.42"></a><span id="l31.42">                 dump(&quot;Expecting no more occurrences, found &quot; +</span>
<a href="#l31.43"></a><span id="l31.43">                         (nextOcc ? nextOcc.startDate : null) + &quot;\n&quot;);</span>
<a href="#l31.44"></a><span id="l31.44" class="difflineminus">-                do_check_eq(nextOcc, null);</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineplus">+                equal(nextOcc, null);</span>
<a href="#l31.46"></a><span id="l31.46">             }</span>
<a href="#l31.47"></a><span id="l31.47"> </span>
<a href="#l31.48"></a><span id="l31.48">             // Make sure getPreviousOccurrence works correctly</span>
<a href="#l31.49"></a><span id="l31.49">             let prevOcc = event.recurrenceInfo.getPreviousOccurrence(recdates[i]);</span>
<a href="#l31.50"></a><span id="l31.50">             if (i &gt; 0) {</span>
<a href="#l31.51"></a><span id="l31.51">                 dump(&quot;Checking previous occurrence: &quot; + expected[i-1]+&quot;, found &quot; + (prevOcc ? prevOcc.startDate : prevOcc) + &quot;\n&quot;);</span>
<a href="#l31.52"></a><span id="l31.52" class="difflineminus">-                do_check_neq(prevOcc, null);</span>
<a href="#l31.53"></a><span id="l31.53" class="difflineminus">-                do_check_eq(prevOcc.startDate.icalString, expected[i - 1]);</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineplus">+                notEqual(prevOcc, null);</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+                equal(prevOcc.startDate.icalString, expected[i - 1]);</span>
<a href="#l31.56"></a><span id="l31.56">             } else {</span>
<a href="#l31.57"></a><span id="l31.57">                 dump(&quot;Expecting no previous occurrences, found &quot; +</span>
<a href="#l31.58"></a><span id="l31.58">                         (prevOcc ? prevOcc.startDate : prevOcc) + &quot;\n&quot;);</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineminus">-                do_check_eq(prevOcc, null);</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineplus">+                equal(prevOcc, null);</span>
<a href="#l31.61"></a><span id="l31.61">             }</span>
<a href="#l31.62"></a><span id="l31.62">         }</span>
<a href="#l31.63"></a><span id="l31.63"> </span>
<a href="#l31.64"></a><span id="l31.64">         //  Make sure recurrenceInfo.clone works correctly</span>
<a href="#l31.65"></a><span id="l31.65">         test_clone(event);</span>
<a href="#l31.66"></a><span id="l31.66">     }</span>
<a href="#l31.67"></a><span id="l31.67"> </span>
<a href="#l31.68"></a><span id="l31.68">     // Test specific items/rules</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineat">@@ -385,213 +385,213 @@ function test_limit() {</span>
<a href="#l31.70"></a><span id="l31.70">                          &quot;DTEND:20020401T124500\n&quot;);</span>
<a href="#l31.71"></a><span id="l31.71">     dump(&quot;ics: &quot; + item.icalString + &quot;\n&quot;);</span>
<a href="#l31.72"></a><span id="l31.72"> </span>
<a href="#l31.73"></a><span id="l31.73">     let start = createDate(1990, 0, 1);</span>
<a href="#l31.74"></a><span id="l31.74">     let end = createDate(2020, 0, 1);</span>
<a href="#l31.75"></a><span id="l31.75">     let recdates = item.recurrenceInfo.getOccurrenceDates(start, end, 0, {});</span>
<a href="#l31.76"></a><span id="l31.76">     let occurrences = item.recurrenceInfo.getOccurrences(start, end, 0, {});</span>
<a href="#l31.77"></a><span id="l31.77"> </span>
<a href="#l31.78"></a><span id="l31.78" class="difflineminus">-    do_check_eq(recdates.length, 3);</span>
<a href="#l31.79"></a><span id="l31.79" class="difflineminus">-    do_check_eq(occurrences.length, 3);</span>
<a href="#l31.80"></a><span id="l31.80" class="difflineplus">+    equal(recdates.length, 3);</span>
<a href="#l31.81"></a><span id="l31.81" class="difflineplus">+    equal(occurrences.length, 3);</span>
<a href="#l31.82"></a><span id="l31.82"> </span>
<a href="#l31.83"></a><span id="l31.83">     recdates = item.recurrenceInfo.getOccurrenceDates(start, end, 2, {});</span>
<a href="#l31.84"></a><span id="l31.84">     occurrences = item.recurrenceInfo.getOccurrences(start, end, 2, {});</span>
<a href="#l31.85"></a><span id="l31.85"> </span>
<a href="#l31.86"></a><span id="l31.86" class="difflineminus">-    do_check_eq(recdates.length, 2);</span>
<a href="#l31.87"></a><span id="l31.87" class="difflineminus">-    do_check_eq(occurrences.length, 2);</span>
<a href="#l31.88"></a><span id="l31.88" class="difflineplus">+    equal(recdates.length, 2);</span>
<a href="#l31.89"></a><span id="l31.89" class="difflineplus">+    equal(occurrences.length, 2);</span>
<a href="#l31.90"></a><span id="l31.90"> </span>
<a href="#l31.91"></a><span id="l31.91">     recdates = item.recurrenceInfo.getOccurrenceDates(start, end, 9, {});</span>
<a href="#l31.92"></a><span id="l31.92">     occurrences = item.recurrenceInfo.getOccurrences(start, end, 9, {});</span>
<a href="#l31.93"></a><span id="l31.93"> </span>
<a href="#l31.94"></a><span id="l31.94" class="difflineminus">-    do_check_eq(recdates.length, 3);</span>
<a href="#l31.95"></a><span id="l31.95" class="difflineminus">-    do_check_eq(occurrences.length, 3);</span>
<a href="#l31.96"></a><span id="l31.96" class="difflineplus">+    equal(recdates.length, 3);</span>
<a href="#l31.97"></a><span id="l31.97" class="difflineplus">+    equal(occurrences.length, 3);</span>
<a href="#l31.98"></a><span id="l31.98"> }</span>
<a href="#l31.99"></a><span id="l31.99"> </span>
<a href="#l31.100"></a><span id="l31.100"> function test_clone(event) {</span>
<a href="#l31.101"></a><span id="l31.101">     let oldRecurItems = event.recurrenceInfo.getRecurrenceItems({});</span>
<a href="#l31.102"></a><span id="l31.102">     let cloned = event.recurrenceInfo.clone();</span>
<a href="#l31.103"></a><span id="l31.103">     let newRecurItems = cloned.getRecurrenceItems({});</span>
<a href="#l31.104"></a><span id="l31.104"> </span>
<a href="#l31.105"></a><span id="l31.105">     // Check number of recurrence items</span>
<a href="#l31.106"></a><span id="l31.106" class="difflineminus">-    do_check_eq(oldRecurItems.length, newRecurItems.length);</span>
<a href="#l31.107"></a><span id="l31.107" class="difflineplus">+    equal(oldRecurItems.length, newRecurItems.length);</span>
<a href="#l31.108"></a><span id="l31.108"> </span>
<a href="#l31.109"></a><span id="l31.109">     for (let i = 0; i &lt; oldRecurItems.length; i++) {</span>
<a href="#l31.110"></a><span id="l31.110">         // Check if recurrence item cloned correctly</span>
<a href="#l31.111"></a><span id="l31.111" class="difflineminus">-        do_check_eq(oldRecurItems[i].icalProperty.icalString,</span>
<a href="#l31.112"></a><span id="l31.112" class="difflineplus">+        equal(oldRecurItems[i].icalProperty.icalString,</span>
<a href="#l31.113"></a><span id="l31.113">                     newRecurItems[i].icalProperty.icalString);</span>
<a href="#l31.114"></a><span id="l31.114">     }</span>
<a href="#l31.115"></a><span id="l31.115"> }</span>
<a href="#l31.116"></a><span id="l31.116"> </span>
<a href="#l31.117"></a><span id="l31.117"> function test_interface() {</span>
<a href="#l31.118"></a><span id="l31.118">     let item = makeEvent(&quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l31.119"></a><span id="l31.119">                          &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l31.120"></a><span id="l31.120">                          &quot;RRULE:FREQ=WEEKLY;COUNT=6;BYDAY=TU,WE\r\n&quot; +</span>
<a href="#l31.121"></a><span id="l31.121">                          &quot;EXDATE:20020403T114500Z\r\n&quot; +</span>
<a href="#l31.122"></a><span id="l31.122">                          &quot;RDATE:20020401T114500Z\r\n&quot;);</span>
<a href="#l31.123"></a><span id="l31.123"> </span>
<a href="#l31.124"></a><span id="l31.124">     let rinfo = item.recurrenceInfo;</span>
<a href="#l31.125"></a><span id="l31.125" class="difflineminus">-    do_check_true(compareObjects(rinfo.item, item, Components.interfaces.calIEvent));</span>
<a href="#l31.126"></a><span id="l31.126" class="difflineplus">+    ok(compareObjects(rinfo.item, item, Components.interfaces.calIEvent));</span>
<a href="#l31.127"></a><span id="l31.127"> </span>
<a href="#l31.128"></a><span id="l31.128">     // getRecurrenceItems</span>
<a href="#l31.129"></a><span id="l31.129">     let ritems = rinfo.getRecurrenceItems({});</span>
<a href="#l31.130"></a><span id="l31.130" class="difflineminus">-    do_check_eq(ritems.length, 3);</span>
<a href="#l31.131"></a><span id="l31.131" class="difflineplus">+    equal(ritems.length, 3);</span>
<a href="#l31.132"></a><span id="l31.132"> </span>
<a href="#l31.133"></a><span id="l31.133">     let checkritems = new Map([ [ritem.icalProperty.propertyName, ritem.icalProperty] for (ritem of ritems)]);</span>
<a href="#l31.134"></a><span id="l31.134">     let rparts = new Map([ v.split(&quot;=&quot;, 2) for (v of checkritems.get(&quot;RRULE&quot;).value.split(&quot;;&quot;)) ])</span>
<a href="#l31.135"></a><span id="l31.135" class="difflineminus">-    do_check_eq(rparts.size, 3);</span>
<a href="#l31.136"></a><span id="l31.136" class="difflineminus">-    do_check_eq(rparts.get(&quot;FREQ&quot;), &quot;WEEKLY&quot;);</span>
<a href="#l31.137"></a><span id="l31.137" class="difflineminus">-    do_check_eq(rparts.get(&quot;COUNT&quot;), &quot;6&quot;);</span>
<a href="#l31.138"></a><span id="l31.138" class="difflineminus">-    do_check_eq(rparts.get(&quot;BYDAY&quot;), &quot;TU,WE&quot;);</span>
<a href="#l31.139"></a><span id="l31.139" class="difflineminus">-    do_check_eq(checkritems.get(&quot;EXDATE&quot;).value, &quot;20020403T114500Z&quot;);</span>
<a href="#l31.140"></a><span id="l31.140" class="difflineminus">-    do_check_eq(checkritems.get(&quot;RDATE&quot;).value, &quot;20020401T114500Z&quot;);</span>
<a href="#l31.141"></a><span id="l31.141" class="difflineplus">+    equal(rparts.size, 3);</span>
<a href="#l31.142"></a><span id="l31.142" class="difflineplus">+    equal(rparts.get(&quot;FREQ&quot;), &quot;WEEKLY&quot;);</span>
<a href="#l31.143"></a><span id="l31.143" class="difflineplus">+    equal(rparts.get(&quot;COUNT&quot;), &quot;6&quot;);</span>
<a href="#l31.144"></a><span id="l31.144" class="difflineplus">+    equal(rparts.get(&quot;BYDAY&quot;), &quot;TU,WE&quot;);</span>
<a href="#l31.145"></a><span id="l31.145" class="difflineplus">+    equal(checkritems.get(&quot;EXDATE&quot;).value, &quot;20020403T114500Z&quot;);</span>
<a href="#l31.146"></a><span id="l31.146" class="difflineplus">+    equal(checkritems.get(&quot;RDATE&quot;).value, &quot;20020401T114500Z&quot;);</span>
<a href="#l31.147"></a><span id="l31.147"> </span>
<a href="#l31.148"></a><span id="l31.148">     // setRecurrenceItems</span>
<a href="#l31.149"></a><span id="l31.149">     let newRItems = [cal.createRecurrenceRule(), cal.createRecurrenceDate()];</span>
<a href="#l31.150"></a><span id="l31.150"> </span>
<a href="#l31.151"></a><span id="l31.151">     newRItems[0].type = &quot;DAILY&quot;;</span>
<a href="#l31.152"></a><span id="l31.152">     newRItems[0].interval = 1;</span>
<a href="#l31.153"></a><span id="l31.153">     newRItems[0].count = 1;</span>
<a href="#l31.154"></a><span id="l31.154">     newRItems[1].isNegative = true;</span>
<a href="#l31.155"></a><span id="l31.155">     newRItems[1].date = cal.createDateTime(&quot;20020404T114500Z&quot;);</span>
<a href="#l31.156"></a><span id="l31.156"> </span>
<a href="#l31.157"></a><span id="l31.157">     rinfo.setRecurrenceItems(2, newRItems);</span>
<a href="#l31.158"></a><span id="l31.158">     let itemString = item.icalString;</span>
<a href="#l31.159"></a><span id="l31.159"> </span>
<a href="#l31.160"></a><span id="l31.160" class="difflineminus">-    do_check_eq(itemString.match(/RRULE:[A-Z=,]*FREQ=WEEKLY/), null);</span>
<a href="#l31.161"></a><span id="l31.161" class="difflineminus">-    do_check_eq(itemString.match(/EXDATE[A-Z;=-]*:20020403T114500Z/, null));</span>
<a href="#l31.162"></a><span id="l31.162" class="difflineminus">-    do_check_eq(itemString.match(/RDATE[A-Z;=-]*:20020401T114500Z/, null));</span>
<a href="#l31.163"></a><span id="l31.163" class="difflineminus">-    do_check_neq(itemString.match(/RRULE:[A-Z=,]*FREQ=DAILY/), null)</span>
<a href="#l31.164"></a><span id="l31.164" class="difflineminus">-    do_check_neq(itemString.match(/EXDATE[A-Z;=-]*:20020404T114500Z/, null));</span>
<a href="#l31.165"></a><span id="l31.165" class="difflineplus">+    equal(itemString.match(/RRULE:[A-Z=,]*FREQ=WEEKLY/), null);</span>
<a href="#l31.166"></a><span id="l31.166" class="difflineplus">+    equal(itemString.match(/EXDATE[A-Z;=-]*:20020403T114500Z/, null));</span>
<a href="#l31.167"></a><span id="l31.167" class="difflineplus">+    equal(itemString.match(/RDATE[A-Z;=-]*:20020401T114500Z/, null));</span>
<a href="#l31.168"></a><span id="l31.168" class="difflineplus">+    notEqual(itemString.match(/RRULE:[A-Z=,]*FREQ=DAILY/), null)</span>
<a href="#l31.169"></a><span id="l31.169" class="difflineplus">+    notEqual(itemString.match(/EXDATE[A-Z;=-]*:20020404T114500Z/, null));</span>
<a href="#l31.170"></a><span id="l31.170"> </span>
<a href="#l31.171"></a><span id="l31.171">     // This may be an implementation detail, but we don't want this breaking</span>
<a href="#l31.172"></a><span id="l31.172">     rinfo.wrappedJSObject.ensureSortedRecurrenceRules();</span>
<a href="#l31.173"></a><span id="l31.173" class="difflineminus">-    do_check_eq(rinfo.wrappedJSObject.mNegativeRules[0].icalProperty.icalString, newRItems[1].icalProperty.icalString);</span>
<a href="#l31.174"></a><span id="l31.174" class="difflineminus">-    do_check_eq(rinfo.wrappedJSObject.mPositiveRules[0].icalProperty.icalString, newRItems[0].icalProperty.icalString);</span>
<a href="#l31.175"></a><span id="l31.175" class="difflineplus">+    equal(rinfo.wrappedJSObject.mNegativeRules[0].icalProperty.icalString, newRItems[1].icalProperty.icalString);</span>
<a href="#l31.176"></a><span id="l31.176" class="difflineplus">+    equal(rinfo.wrappedJSObject.mPositiveRules[0].icalProperty.icalString, newRItems[0].icalProperty.icalString);</span>
<a href="#l31.177"></a><span id="l31.177"> </span>
<a href="#l31.178"></a><span id="l31.178">     // countRecurrenceItems</span>
<a href="#l31.179"></a><span id="l31.179" class="difflineminus">-    do_check_eq(2, rinfo.countRecurrenceItems());</span>
<a href="#l31.180"></a><span id="l31.180" class="difflineplus">+    equal(2, rinfo.countRecurrenceItems());</span>
<a href="#l31.181"></a><span id="l31.181"> </span>
<a href="#l31.182"></a><span id="l31.182">     // clearRecurrenceItems</span>
<a href="#l31.183"></a><span id="l31.183">     rinfo.clearRecurrenceItems();</span>
<a href="#l31.184"></a><span id="l31.184" class="difflineminus">-    do_check_eq(0, rinfo.countRecurrenceItems());</span>
<a href="#l31.185"></a><span id="l31.185" class="difflineplus">+    equal(0, rinfo.countRecurrenceItems());</span>
<a href="#l31.186"></a><span id="l31.186"> </span>
<a href="#l31.187"></a><span id="l31.187">     // appendRecurrenceItems / getRecurrenceItemAt / insertRecurrenceItemAt</span>
<a href="#l31.188"></a><span id="l31.188">     rinfo.appendRecurrenceItem(ritems[0]);</span>
<a href="#l31.189"></a><span id="l31.189">     rinfo.appendRecurrenceItem(ritems[1]);</span>
<a href="#l31.190"></a><span id="l31.190">     rinfo.insertRecurrenceItemAt(ritems[2], 0);</span>
<a href="#l31.191"></a><span id="l31.191"> </span>
<a href="#l31.192"></a><span id="l31.192" class="difflineminus">-    do_check_true(compareObjects(ritems[2],</span>
<a href="#l31.193"></a><span id="l31.193" class="difflineplus">+    ok(compareObjects(ritems[2],</span>
<a href="#l31.194"></a><span id="l31.194">                                  rinfo.getRecurrenceItemAt(0),</span>
<a href="#l31.195"></a><span id="l31.195">                                  Components.interfaces.calIRecurrenceItem));</span>
<a href="#l31.196"></a><span id="l31.196" class="difflineminus">-    do_check_true(compareObjects(ritems[0],</span>
<a href="#l31.197"></a><span id="l31.197" class="difflineplus">+    ok(compareObjects(ritems[0],</span>
<a href="#l31.198"></a><span id="l31.198">                                  rinfo.getRecurrenceItemAt(1),</span>
<a href="#l31.199"></a><span id="l31.199">                                  Components.interfaces.calIRecurrenceItem));</span>
<a href="#l31.200"></a><span id="l31.200" class="difflineminus">-    do_check_true(compareObjects(ritems[1],</span>
<a href="#l31.201"></a><span id="l31.201" class="difflineplus">+    ok(compareObjects(ritems[1],</span>
<a href="#l31.202"></a><span id="l31.202">                                  rinfo.getRecurrenceItemAt(2),</span>
<a href="#l31.203"></a><span id="l31.203">                                  Components.interfaces.calIRecurrenceItem));</span>
<a href="#l31.204"></a><span id="l31.204"> </span>
<a href="#l31.205"></a><span id="l31.205"> </span>
<a href="#l31.206"></a><span id="l31.206">     // deleteRecurrenceItem</span>
<a href="#l31.207"></a><span id="l31.207">     rinfo.deleteRecurrenceItem(ritems[0]);</span>
<a href="#l31.208"></a><span id="l31.208" class="difflineminus">-    do_check_true(item.icalString.indexOf(&quot;RRULE&quot;) &lt; 0);</span>
<a href="#l31.209"></a><span id="l31.209" class="difflineplus">+    ok(item.icalString.indexOf(&quot;RRULE&quot;) &lt; 0);</span>
<a href="#l31.210"></a><span id="l31.210"> </span>
<a href="#l31.211"></a><span id="l31.211">     // deleteRecurrenceItemAt</span>
<a href="#l31.212"></a><span id="l31.212">     rinfo.deleteRecurrenceItemAt(1);</span>
<a href="#l31.213"></a><span id="l31.213">     itemString = item.icalString;</span>
<a href="#l31.214"></a><span id="l31.214" class="difflineminus">-    do_check_true(itemString.indexOf(&quot;EXDATE&quot;) &lt; 0);</span>
<a href="#l31.215"></a><span id="l31.215" class="difflineminus">-    do_check_false(itemString.indexOf(&quot;RDATE&quot;) &lt; 0);</span>
<a href="#l31.216"></a><span id="l31.216" class="difflineplus">+    ok(itemString.indexOf(&quot;EXDATE&quot;) &lt; 0);</span>
<a href="#l31.217"></a><span id="l31.217" class="difflineplus">+    ok(!(itemString.indexOf(&quot;RDATE&quot;) &lt; 0));</span>
<a href="#l31.218"></a><span id="l31.218"> </span>
<a href="#l31.219"></a><span id="l31.219">     // insertRecurrenceItemAt with exdate</span>
<a href="#l31.220"></a><span id="l31.220">     rinfo.insertRecurrenceItemAt(ritems[1], 1);</span>
<a href="#l31.221"></a><span id="l31.221" class="difflineminus">-    do_check_true(compareObjects(ritems[1],</span>
<a href="#l31.222"></a><span id="l31.222" class="difflineplus">+    ok(compareObjects(ritems[1],</span>
<a href="#l31.223"></a><span id="l31.223">                                  rinfo.getRecurrenceItemAt(1),</span>
<a href="#l31.224"></a><span id="l31.224">                                  Components.interfaces.calIRecurrenceItem));</span>
<a href="#l31.225"></a><span id="l31.225">     rinfo.deleteRecurrenceItem(ritems[1]);</span>
<a href="#l31.226"></a><span id="l31.226"> </span>
<a href="#l31.227"></a><span id="l31.227">     // isFinite = true</span>
<a href="#l31.228"></a><span id="l31.228" class="difflineminus">-    do_check_true(rinfo.isFinite);</span>
<a href="#l31.229"></a><span id="l31.229" class="difflineplus">+    ok(rinfo.isFinite);</span>
<a href="#l31.230"></a><span id="l31.230">     rinfo.appendRecurrenceItem(ritems[0]);</span>
<a href="#l31.231"></a><span id="l31.231" class="difflineminus">-    do_check_true(rinfo.isFinite);</span>
<a href="#l31.232"></a><span id="l31.232" class="difflineplus">+    ok(rinfo.isFinite);</span>
<a href="#l31.233"></a><span id="l31.233"> </span>
<a href="#l31.234"></a><span id="l31.234">     // isFinite = false</span>
<a href="#l31.235"></a><span id="l31.235">     let item2 = makeEvent(&quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l31.236"></a><span id="l31.236">                           &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l31.237"></a><span id="l31.237">                           &quot;RRULE:FREQ=WEEKLY;BYDAY=TU,WE\n&quot;);</span>
<a href="#l31.238"></a><span id="l31.238" class="difflineminus">-    do_check_false(item2.recurrenceInfo.isFinite);</span>
<a href="#l31.239"></a><span id="l31.239" class="difflineplus">+    ok(!item2.recurrenceInfo.isFinite);</span>
<a href="#l31.240"></a><span id="l31.240"> </span>
<a href="#l31.241"></a><span id="l31.241">     // removeOccurrenceAt/restoreOccurreceAt</span>
<a href="#l31.242"></a><span id="l31.242">     let occDate1 = cal.createDateTime(&quot;20020403T114500Z&quot;);</span>
<a href="#l31.243"></a><span id="l31.243">     let occDate2 = cal.createDateTime(&quot;20020404T114500Z&quot;);</span>
<a href="#l31.244"></a><span id="l31.244">     rinfo.removeOccurrenceAt(occDate1);</span>
<a href="#l31.245"></a><span id="l31.245" class="difflineminus">-    do_check_false(item.icalString.indexOf(&quot;EXDATE&quot;) &lt; 0);</span>
<a href="#l31.246"></a><span id="l31.246" class="difflineplus">+    ok(!(item.icalString.indexOf(&quot;EXDATE&quot;) &lt; 0));</span>
<a href="#l31.247"></a><span id="l31.247">     rinfo.restoreOccurrenceAt(occDate1)</span>
<a href="#l31.248"></a><span id="l31.248" class="difflineminus">-    do_check_true(item.icalString.indexOf(&quot;EXDATE&quot;) &lt; 0);</span>
<a href="#l31.249"></a><span id="l31.249" class="difflineplus">+    ok(item.icalString.indexOf(&quot;EXDATE&quot;) &lt; 0);</span>
<a href="#l31.250"></a><span id="l31.250"> </span>
<a href="#l31.251"></a><span id="l31.251">     // modifyException / getExceptionFor</span>
<a href="#l31.252"></a><span id="l31.252">     let occ1 = rinfo.getOccurrenceFor(occDate1);</span>
<a href="#l31.253"></a><span id="l31.253">     occ1.startDate = cal.createDateTime(&quot;20020401T114500&quot;);</span>
<a href="#l31.254"></a><span id="l31.254">     rinfo.modifyException(occ1, true);</span>
<a href="#l31.255"></a><span id="l31.255" class="difflineminus">-    do_check_true(rinfo.getExceptionFor(occDate1) != null);</span>
<a href="#l31.256"></a><span id="l31.256" class="difflineplus">+    ok(rinfo.getExceptionFor(occDate1) != null);</span>
<a href="#l31.257"></a><span id="l31.257"> </span>
<a href="#l31.258"></a><span id="l31.258">     // modifyException immutable</span>
<a href="#l31.259"></a><span id="l31.259">     let occ2 = rinfo.getOccurrenceFor(occDate2);</span>
<a href="#l31.260"></a><span id="l31.260">     occ2.makeImmutable();</span>
<a href="#l31.261"></a><span id="l31.261">     rinfo.modifyException(occ2, true);</span>
<a href="#l31.262"></a><span id="l31.262" class="difflineminus">-    do_check_true(rinfo.getExceptionFor(occDate2) != null);</span>
<a href="#l31.263"></a><span id="l31.263" class="difflineplus">+    ok(rinfo.getExceptionFor(occDate2) != null);</span>
<a href="#l31.264"></a><span id="l31.264"> </span>
<a href="#l31.265"></a><span id="l31.265">     // getExceptionIds</span>
<a href="#l31.266"></a><span id="l31.266">     let ids = rinfo.getExceptionIds({});</span>
<a href="#l31.267"></a><span id="l31.267" class="difflineminus">-    do_check_eq(ids.length, 2);</span>
<a href="#l31.268"></a><span id="l31.268" class="difflineminus">-    do_check_true(ids[0].compare(occDate1) == 0);</span>
<a href="#l31.269"></a><span id="l31.269" class="difflineminus">-    do_check_true(ids[1].compare(occDate2) == 0);</span>
<a href="#l31.270"></a><span id="l31.270" class="difflineplus">+    equal(ids.length, 2);</span>
<a href="#l31.271"></a><span id="l31.271" class="difflineplus">+    ok(ids[0].compare(occDate1) == 0);</span>
<a href="#l31.272"></a><span id="l31.272" class="difflineplus">+    ok(ids[1].compare(occDate2) == 0);</span>
<a href="#l31.273"></a><span id="l31.273"> </span>
<a href="#l31.274"></a><span id="l31.274">     // removeExceptionFor</span>
<a href="#l31.275"></a><span id="l31.275">     rinfo.removeExceptionFor(occDate1);</span>
<a href="#l31.276"></a><span id="l31.276" class="difflineminus">-    do_check_true(rinfo.getExceptionFor(occDate1) == null);</span>
<a href="#l31.277"></a><span id="l31.277" class="difflineminus">-    do_check_eq(rinfo.getExceptionIds({}).length, 1);</span>
<a href="#l31.278"></a><span id="l31.278" class="difflineplus">+    ok(rinfo.getExceptionFor(occDate1) == null);</span>
<a href="#l31.279"></a><span id="l31.279" class="difflineplus">+    equal(rinfo.getExceptionIds({}).length, 1);</span>
<a href="#l31.280"></a><span id="l31.280"> }</span>
<a href="#l31.281"></a><span id="l31.281"> </span>
<a href="#l31.282"></a><span id="l31.282"> function test_rrule_interface() {</span>
<a href="#l31.283"></a><span id="l31.283">     let item = makeEvent(&quot;DTSTART:20020402T114500Z\r\n&quot; +</span>
<a href="#l31.284"></a><span id="l31.284">                          &quot;DTEND:20020402T124500Z\r\n&quot; +</span>
<a href="#l31.285"></a><span id="l31.285">                          &quot;RRULE:INTERVAL=2;FREQ=WEEKLY;COUNT=6;BYDAY=TU,WE\r\n&quot;);</span>
<a href="#l31.286"></a><span id="l31.286"> </span>
<a href="#l31.287"></a><span id="l31.287">     let rrule = item.recurrenceInfo.getRecurrenceItemAt(0);</span>
<a href="#l31.288"></a><span id="l31.288" class="difflineminus">-    do_check_eq(rrule.type, &quot;WEEKLY&quot;);</span>
<a href="#l31.289"></a><span id="l31.289" class="difflineminus">-    do_check_eq(rrule.interval, 2);</span>
<a href="#l31.290"></a><span id="l31.290" class="difflineminus">-    do_check_eq(rrule.count, 6);</span>
<a href="#l31.291"></a><span id="l31.291" class="difflineminus">-    do_check_true(rrule.isByCount);</span>
<a href="#l31.292"></a><span id="l31.292" class="difflineminus">-    do_check_false(rrule.isNegative);</span>
<a href="#l31.293"></a><span id="l31.293" class="difflineminus">-    do_check_true(rrule.isFinite);</span>
<a href="#l31.294"></a><span id="l31.294" class="difflineminus">-    do_check_eq(rrule.getComponent(&quot;BYDAY&quot;, {}).toString(), [3,4].toString());</span>
<a href="#l31.295"></a><span id="l31.295" class="difflineplus">+    equal(rrule.type, &quot;WEEKLY&quot;);</span>
<a href="#l31.296"></a><span id="l31.296" class="difflineplus">+    equal(rrule.interval, 2);</span>
<a href="#l31.297"></a><span id="l31.297" class="difflineplus">+    equal(rrule.count, 6);</span>
<a href="#l31.298"></a><span id="l31.298" class="difflineplus">+    ok(rrule.isByCount);</span>
<a href="#l31.299"></a><span id="l31.299" class="difflineplus">+    ok(!rrule.isNegative);</span>
<a href="#l31.300"></a><span id="l31.300" class="difflineplus">+    ok(rrule.isFinite);</span>
<a href="#l31.301"></a><span id="l31.301" class="difflineplus">+    equal(rrule.getComponent(&quot;BYDAY&quot;, {}).toString(), [3,4].toString());</span>
<a href="#l31.302"></a><span id="l31.302"> </span>
<a href="#l31.303"></a><span id="l31.303">     // Now start changing things</span>
<a href="#l31.304"></a><span id="l31.304">     rrule.setComponent(&quot;BYDAY&quot;, 2, [4,5]);</span>
<a href="#l31.305"></a><span id="l31.305" class="difflineminus">-    do_check_eq(rrule.icalString.match(/BYDAY=WE,TH/), &quot;BYDAY=WE,TH&quot;);</span>
<a href="#l31.306"></a><span id="l31.306" class="difflineplus">+    equal(rrule.icalString.match(/BYDAY=WE,TH/), &quot;BYDAY=WE,TH&quot;);</span>
<a href="#l31.307"></a><span id="l31.307"> </span>
<a href="#l31.308"></a><span id="l31.308">     rrule.count = -1;</span>
<a href="#l31.309"></a><span id="l31.309" class="difflineminus">-    do_check_false(rrule.isByCount);</span>
<a href="#l31.310"></a><span id="l31.310" class="difflineminus">-    do_check_false(rrule.isFinite);</span>
<a href="#l31.311"></a><span id="l31.311" class="difflineminus">-    do_check_eq(rrule.icalString.match(/COUNT=/), null);</span>
<a href="#l31.312"></a><span id="l31.312" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l31.313"></a><span id="l31.313" class="difflineplus">+    ok(!rrule.isByCount);</span>
<a href="#l31.314"></a><span id="l31.314" class="difflineplus">+    ok(!rrule.isFinite);</span>
<a href="#l31.315"></a><span id="l31.315" class="difflineplus">+    equal(rrule.icalString.match(/COUNT=/), null);</span>
<a href="#l31.316"></a><span id="l31.316" class="difflineplus">+    throws(function() {</span>
<a href="#l31.317"></a><span id="l31.317">         rrule.count;</span>
<a href="#l31.318"></a><span id="l31.318" class="difflineminus">-    }, Components.results.NS_ERROR_FAILURE);</span>
<a href="#l31.319"></a><span id="l31.319" class="difflineplus">+    }, /0x80004005/);</span>
<a href="#l31.320"></a><span id="l31.320"> </span>
<a href="#l31.321"></a><span id="l31.321">     rrule.interval = 1;</span>
<a href="#l31.322"></a><span id="l31.322" class="difflineminus">-    do_check_eq(rrule.interval, 1);</span>
<a href="#l31.323"></a><span id="l31.323" class="difflineminus">-    do_check_eq(rrule.icalString.match(/INTERVAL=/), null);</span>
<a href="#l31.324"></a><span id="l31.324" class="difflineplus">+    equal(rrule.interval, 1);</span>
<a href="#l31.325"></a><span id="l31.325" class="difflineplus">+    equal(rrule.icalString.match(/INTERVAL=/), null);</span>
<a href="#l31.326"></a><span id="l31.326"> </span>
<a href="#l31.327"></a><span id="l31.327">     rrule.interval = 3;</span>
<a href="#l31.328"></a><span id="l31.328" class="difflineminus">-    do_check_eq(rrule.interval, 3);</span>
<a href="#l31.329"></a><span id="l31.329" class="difflineminus">-    do_check_eq(rrule.icalString.match(/INTERVAL=3/), &quot;INTERVAL=3&quot;);</span>
<a href="#l31.330"></a><span id="l31.330" class="difflineplus">+    equal(rrule.interval, 3);</span>
<a href="#l31.331"></a><span id="l31.331" class="difflineplus">+    equal(rrule.icalString.match(/INTERVAL=3/), &quot;INTERVAL=3&quot;);</span>
<a href="#l31.332"></a><span id="l31.332"> </span>
<a href="#l31.333"></a><span id="l31.333">     rrule.type = &quot;MONTHLY&quot;;</span>
<a href="#l31.334"></a><span id="l31.334" class="difflineminus">-    do_check_eq(rrule.type, &quot;MONTHLY&quot;);</span>
<a href="#l31.335"></a><span id="l31.335" class="difflineminus">-    do_check_eq(rrule.icalString.match(/FREQ=MONTHLY/), &quot;FREQ=MONTHLY&quot;);</span>
<a href="#l31.336"></a><span id="l31.336" class="difflineplus">+    equal(rrule.type, &quot;MONTHLY&quot;);</span>
<a href="#l31.337"></a><span id="l31.337" class="difflineplus">+    equal(rrule.icalString.match(/FREQ=MONTHLY/), &quot;FREQ=MONTHLY&quot;);</span>
<a href="#l31.338"></a><span id="l31.338"> }</span>
<a href="#l31.339"></a><span id="l31.339"> </span>
<a href="#l31.340"></a><span id="l31.340"> function test_startdate_change() {</span>
<a href="#l31.341"></a><span id="l31.341"> </span>
<a href="#l31.342"></a><span id="l31.342">     // Setting a start date if its missing shouldn't throw</span>
<a href="#l31.343"></a><span id="l31.343">     let item = makeEvent(&quot;DTEND:20020402T124500Z\r\n&quot; +</span>
<a href="#l31.344"></a><span id="l31.344">                          &quot;RRULE:FREQ=DAILY\r\n&quot;);</span>
<a href="#l31.345"></a><span id="l31.345">     item.startDate = cal.createDateTime(&quot;20020502T114500Z&quot;);</span>
<a href="#l31.346"></a><span id="l31.346" class="difflineat">@@ -613,111 +613,111 @@ function test_startdate_change() {</span>
<a href="#l31.347"></a><span id="l31.347">     // Changing an existing start date for a recurring item shouldn't either</span>
<a href="#l31.348"></a><span id="l31.348">     item = makeRecEvent(&quot;RRULE:FREQ=DAILY\r\n&quot;);</span>
<a href="#l31.349"></a><span id="l31.349">     changeBy(item, &quot;PT1H&quot;);</span>
<a href="#l31.350"></a><span id="l31.350"> </span>
<a href="#l31.351"></a><span id="l31.351">     // Event with an rdate</span>
<a href="#l31.352"></a><span id="l31.352">     item = makeRecEvent(&quot;RDATE:20020403T114500Z\r\n&quot;);</span>
<a href="#l31.353"></a><span id="l31.353">     changeBy(item, &quot;PT1H&quot;);</span>
<a href="#l31.354"></a><span id="l31.354">     ritem = item.recurrenceInfo.getRecurrenceItemAt(0);</span>
<a href="#l31.355"></a><span id="l31.355" class="difflineminus">-    do_check_eq(ritem.date.icalString, &quot;20020403T124500Z&quot;);</span>
<a href="#l31.356"></a><span id="l31.356" class="difflineplus">+    equal(ritem.date.icalString, &quot;20020403T124500Z&quot;);</span>
<a href="#l31.357"></a><span id="l31.357"> </span>
<a href="#l31.358"></a><span id="l31.358">     // Event with an exdate</span>
<a href="#l31.359"></a><span id="l31.359">     item = makeRecEvent(&quot;EXDATE:20020403T114500Z\r\n&quot;);</span>
<a href="#l31.360"></a><span id="l31.360">     changeBy(item, &quot;PT1H&quot;);</span>
<a href="#l31.361"></a><span id="l31.361">     ritem = item.recurrenceInfo.getRecurrenceItemAt(0);</span>
<a href="#l31.362"></a><span id="l31.362" class="difflineminus">-    do_check_eq(ritem.date.icalString, &quot;20020403T124500Z&quot;);</span>
<a href="#l31.363"></a><span id="l31.363" class="difflineplus">+    equal(ritem.date.icalString, &quot;20020403T124500Z&quot;);</span>
<a href="#l31.364"></a><span id="l31.364"> </span>
<a href="#l31.365"></a><span id="l31.365">     // Event with an rrule with until date</span>
<a href="#l31.366"></a><span id="l31.366">     item = makeRecEvent(&quot;RRULE:FREQ=WEEKLY;UNTIL=20020406T114500Z\r\n&quot;);</span>
<a href="#l31.367"></a><span id="l31.367">     changeBy(item, &quot;PT1H&quot;);</span>
<a href="#l31.368"></a><span id="l31.368">     ritem = item.recurrenceInfo.getRecurrenceItemAt(0);</span>
<a href="#l31.369"></a><span id="l31.369" class="difflineminus">-    do_check_eq(ritem.untilDate.icalString, &quot;20020406T124500Z&quot;);</span>
<a href="#l31.370"></a><span id="l31.370" class="difflineplus">+    equal(ritem.untilDate.icalString, &quot;20020406T124500Z&quot;);</span>
<a href="#l31.371"></a><span id="l31.371"> </span>
<a href="#l31.372"></a><span id="l31.372">     // Event with an exception item</span>
<a href="#l31.373"></a><span id="l31.373">     item = makeRecEvent(&quot;RRULE:FREQ=DAILY\r\n&quot;);</span>
<a href="#l31.374"></a><span id="l31.374">     let occ = item.recurrenceInfo.getOccurrenceFor(cal.createDateTime(&quot;20020406T114500Z&quot;));</span>
<a href="#l31.375"></a><span id="l31.375">     occ.startDate = cal.createDateTime(&quot;20020406T124500Z&quot;);</span>
<a href="#l31.376"></a><span id="l31.376">     item.recurrenceInfo.modifyException(occ, true);</span>
<a href="#l31.377"></a><span id="l31.377">     changeBy(item, &quot;PT1H&quot;);</span>
<a href="#l31.378"></a><span id="l31.378" class="difflineminus">-    do_check_eq(item.startDate.icalString, &quot;20020402T124500Z&quot;);</span>
<a href="#l31.379"></a><span id="l31.379" class="difflineplus">+    equal(item.startDate.icalString, &quot;20020402T124500Z&quot;);</span>
<a href="#l31.380"></a><span id="l31.380">     occ = item.recurrenceInfo.getExceptionFor(cal.createDateTime(&quot;20020406T124500Z&quot;));</span>
<a href="#l31.381"></a><span id="l31.381" class="difflineminus">-    do_check_eq(occ.startDate.icalString, &quot;20020406T134500Z&quot;);</span>
<a href="#l31.382"></a><span id="l31.382" class="difflineplus">+    equal(occ.startDate.icalString, &quot;20020406T134500Z&quot;);</span>
<a href="#l31.383"></a><span id="l31.383"> }</span>
<a href="#l31.384"></a><span id="l31.384"> </span>
<a href="#l31.385"></a><span id="l31.385"> function test_idchange() {</span>
<a href="#l31.386"></a><span id="l31.386">     let item = makeEvent(&quot;UID:unchanged\r\n&quot; +</span>
<a href="#l31.387"></a><span id="l31.387">                          &quot;DTSTART:20020402T114500Z\r\n&quot; +</span>
<a href="#l31.388"></a><span id="l31.388">                          &quot;DTEND:20020402T124500Z\r\n&quot; +</span>
<a href="#l31.389"></a><span id="l31.389">                          &quot;RRULE:FREQ=DAILY\r\n&quot;);</span>
<a href="#l31.390"></a><span id="l31.390">     let occ = item.recurrenceInfo.getOccurrenceFor(cal.createDateTime(&quot;20020406T114500Z&quot;));</span>
<a href="#l31.391"></a><span id="l31.391">     occ.startDate = cal.createDateTime(&quot;20020406T124500Z&quot;);</span>
<a href="#l31.392"></a><span id="l31.392">     item.recurrenceInfo.modifyException(occ, true);</span>
<a href="#l31.393"></a><span id="l31.393" class="difflineminus">-    do_check_eq(occ.id, &quot;unchanged&quot;);</span>
<a href="#l31.394"></a><span id="l31.394" class="difflineplus">+    equal(occ.id, &quot;unchanged&quot;);</span>
<a href="#l31.395"></a><span id="l31.395"> </span>
<a href="#l31.396"></a><span id="l31.396">     item.id = &quot;changed&quot;;</span>
<a href="#l31.397"></a><span id="l31.397"> </span>
<a href="#l31.398"></a><span id="l31.398">     occ = item.recurrenceInfo.getExceptionFor(cal.createDateTime(&quot;20020406T114500Z&quot;));</span>
<a href="#l31.399"></a><span id="l31.399" class="difflineminus">-    do_check_eq(occ.id , &quot;changed&quot;);</span>
<a href="#l31.400"></a><span id="l31.400" class="difflineplus">+    equal(occ.id , &quot;changed&quot;);</span>
<a href="#l31.401"></a><span id="l31.401"> }</span>
<a href="#l31.402"></a><span id="l31.402"> </span>
<a href="#l31.403"></a><span id="l31.403"> function test_failures() {</span>
<a href="#l31.404"></a><span id="l31.404">     let item = makeEvent(&quot;DTSTART:20020402T114500Z\r\n&quot; +</span>
<a href="#l31.405"></a><span id="l31.405">                          &quot;DTEND:20020402T124500Z\r\n&quot; +</span>
<a href="#l31.406"></a><span id="l31.406">                          &quot;RRULE:INTERVAL=2;FREQ=WEEKLY;COUNT=6;BYDAY=TU,WE\r\n&quot;);</span>
<a href="#l31.407"></a><span id="l31.407">     let rinfo = item.recurrenceInfo;</span>
<a href="#l31.408"></a><span id="l31.408">     let ritem = cal.createRecurrenceDate();</span>
<a href="#l31.409"></a><span id="l31.409"> </span>
<a href="#l31.410"></a><span id="l31.410" class="difflineminus">-    do_check_throws(function() rinfo.getRecurrenceItemAt(-1), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.411"></a><span id="l31.411" class="difflineminus">-    do_check_throws(function() rinfo.getRecurrenceItemAt(1), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.412"></a><span id="l31.412" class="difflineminus">-    do_check_throws(function() rinfo.deleteRecurrenceItemAt(-1), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.413"></a><span id="l31.413" class="difflineminus">-    do_check_throws(function() rinfo.deleteRecurrenceItemAt(1), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.414"></a><span id="l31.414" class="difflineminus">-    do_check_throws(function() rinfo.deleteRecurrenceItem(ritem), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.415"></a><span id="l31.415" class="difflineminus">-    do_check_throws(function() rinfo.insertRecurrenceItemAt(ritem, -1), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.416"></a><span id="l31.416" class="difflineminus">-    do_check_throws(function() rinfo.insertRecurrenceItemAt(ritem, 2), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.417"></a><span id="l31.417" class="difflineminus">-    do_check_throws(function() rinfo.restoreOccurrenceAt(cal.createDateTime(&quot;20080101T010101&quot;)), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.418"></a><span id="l31.418" class="difflineminus">-    do_check_throws(function() cal.createRecurrenceInfo().isFinite, Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l31.419"></a><span id="l31.419" class="difflineplus">+    throws(function() rinfo.getRecurrenceItemAt(-1), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.420"></a><span id="l31.420" class="difflineplus">+    throws(function() rinfo.getRecurrenceItemAt(1), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.421"></a><span id="l31.421" class="difflineplus">+    throws(function() rinfo.deleteRecurrenceItemAt(-1), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.422"></a><span id="l31.422" class="difflineplus">+    throws(function() rinfo.deleteRecurrenceItemAt(1), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.423"></a><span id="l31.423" class="difflineplus">+    throws(function() rinfo.deleteRecurrenceItem(ritem), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.424"></a><span id="l31.424" class="difflineplus">+    throws(function() rinfo.insertRecurrenceItemAt(ritem, -1), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.425"></a><span id="l31.425" class="difflineplus">+    throws(function() rinfo.insertRecurrenceItemAt(ritem, 2), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.426"></a><span id="l31.426" class="difflineplus">+    throws(function() rinfo.restoreOccurrenceAt(cal.createDateTime(&quot;20080101T010101&quot;)), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.427"></a><span id="l31.427" class="difflineplus">+    throws(function() cal.createRecurrenceInfo().isFinite, /Component not initialized/);</span>
<a href="#l31.428"></a><span id="l31.428"> </span>
<a href="#l31.429"></a><span id="l31.429">     // modifyException with a different parent item</span>
<a href="#l31.430"></a><span id="l31.430">     let occ = rinfo.getOccurrenceFor(cal.createDateTime(&quot;20120102T114500Z&quot;));</span>
<a href="#l31.431"></a><span id="l31.431">     occ.calendar = {}</span>
<a href="#l31.432"></a><span id="l31.432">     occ.id = &quot;1234&quot;;</span>
<a href="#l31.433"></a><span id="l31.433">     occ.parentItem = occ;</span>
<a href="#l31.434"></a><span id="l31.434" class="difflineminus">-    do_check_throws(function() rinfo.modifyException(occ, true), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.435"></a><span id="l31.435" class="difflineplus">+    throws(function() rinfo.modifyException(occ, true), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.436"></a><span id="l31.436"> </span>
<a href="#l31.437"></a><span id="l31.437">     occ = rinfo.getOccurrenceFor(cal.createDateTime(&quot;20120102T114500Z&quot;));</span>
<a href="#l31.438"></a><span id="l31.438">     occ.recurrenceId = null;</span>
<a href="#l31.439"></a><span id="l31.439" class="difflineminus">-    do_check_throws(function() rinfo.modifyException(occ, true), Cr.NS_ERROR_INVALID_ARG);</span>
<a href="#l31.440"></a><span id="l31.440" class="difflineplus">+    throws(function() rinfo.modifyException(occ, true), /Illegal value/, &quot;Invalid Argument&quot;);</span>
<a href="#l31.441"></a><span id="l31.441"> </span>
<a href="#l31.442"></a><span id="l31.442">     // Missing DTSTART/DUE but RRULE</span>
<a href="#l31.443"></a><span id="l31.443">     item = createEventFromIcalString(&quot;BEGIN:VCALENDAR\r\n&quot; +</span>
<a href="#l31.444"></a><span id="l31.444">         &quot;BEGIN:VTODO\r\n&quot; +</span>
<a href="#l31.445"></a><span id="l31.445">         &quot;RRULE:FREQ=DAILY\r\n&quot; +</span>
<a href="#l31.446"></a><span id="l31.446">         &quot;END:VTODO\r\n&quot; +</span>
<a href="#l31.447"></a><span id="l31.447">         &quot;END:VCALENDAR\r\n&quot;</span>
<a href="#l31.448"></a><span id="l31.448">     );</span>
<a href="#l31.449"></a><span id="l31.449">     rinfo = item.recurrenceInfo;</span>
<a href="#l31.450"></a><span id="l31.450" class="difflineminus">-    do_check_eq(rinfo.getOccurrenceDates(cal.createDateTime(&quot;20120101T010101&quot;),</span>
<a href="#l31.451"></a><span id="l31.451" class="difflineplus">+    equal(rinfo.getOccurrenceDates(cal.createDateTime(&quot;20120101T010101&quot;),</span>
<a href="#l31.452"></a><span id="l31.452">                                          cal.createDateTime(&quot;20120203T010101&quot;),</span>
<a href="#l31.453"></a><span id="l31.453">                                          0, {}).length, 0);</span>
<a href="#l31.454"></a><span id="l31.454"> }</span>
<a href="#l31.455"></a><span id="l31.455"> </span>
<a href="#l31.456"></a><span id="l31.456"> function test_immutable() {</span>
<a href="#l31.457"></a><span id="l31.457">     item = createEventFromIcalString(&quot;BEGIN:VCALENDAR\r\n&quot; +</span>
<a href="#l31.458"></a><span id="l31.458">         &quot;BEGIN:VTODO\r\n&quot; +</span>
<a href="#l31.459"></a><span id="l31.459">         &quot;RRULE:FREQ=DAILY\r\n&quot; +</span>
<a href="#l31.460"></a><span id="l31.460">         &quot;END:VTODO\r\n&quot; +</span>
<a href="#l31.461"></a><span id="l31.461">         &quot;END:VCALENDAR\r\n&quot;</span>
<a href="#l31.462"></a><span id="l31.462">     );</span>
<a href="#l31.463"></a><span id="l31.463" class="difflineminus">-    do_check_true(item.recurrenceInfo.isMutable);</span>
<a href="#l31.464"></a><span id="l31.464" class="difflineplus">+    ok(item.recurrenceInfo.isMutable);</span>
<a href="#l31.465"></a><span id="l31.465">     let rinfo2 = item.recurrenceInfo.clone();</span>
<a href="#l31.466"></a><span id="l31.466">     rinfo2.makeImmutable();</span>
<a href="#l31.467"></a><span id="l31.467">     rinfo2.makeImmutable(); // Doing so twice shouldn't throw</span>
<a href="#l31.468"></a><span id="l31.468" class="difflineminus">-    do_check_throws(function() rinfo2.appendRecurrenceItem(ritem), Cr.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l31.469"></a><span id="l31.469" class="difflineminus">-    do_check_false(rinfo2.isMutable);</span>
<a href="#l31.470"></a><span id="l31.470" class="difflineplus">+    throws(function() rinfo2.appendRecurrenceItem(ritem), /Can not modify immutable data container/);</span>
<a href="#l31.471"></a><span id="l31.471" class="difflineplus">+    ok(!rinfo2.isMutable);</span>
<a href="#l31.472"></a><span id="l31.472"> </span>
<a href="#l31.473"></a><span id="l31.473">     let ritem = cal.createRecurrenceDate();</span>
<a href="#l31.474"></a><span id="l31.474">     rinfo.appenRecurrenceItem(ritem);</span>
<a href="#l31.475"></a><span id="l31.475"> }</span>
<a href="#l31.476"></a><span id="l31.476"> </span>
<a href="#l31.477"></a><span id="l31.477"> function test_rrule_icalstring() {</span>
<a href="#l31.478"></a><span id="l31.478">     var recRule = createRecurrenceRule();</span>
<a href="#l31.479"></a><span id="l31.479">     recRule.type = &quot;DAILY&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/test/unit/test_relation.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/test/unit/test_relation.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -13,17 +13,17 @@ function run_test() {</span>
<a href="#l32.4"></a><span id="l32.4">     // Testing relation set/get.</span>
<a href="#l32.5"></a><span id="l32.5">     let properties = {</span>
<a href="#l32.6"></a><span id="l32.6">         relType: &quot;PARENT&quot;,</span>
<a href="#l32.7"></a><span id="l32.7">         relId: e2.id</span>
<a href="#l32.8"></a><span id="l32.8">     }</span>
<a href="#l32.9"></a><span id="l32.9"> </span>
<a href="#l32.10"></a><span id="l32.10">     for (let [property, value] in Iterator(properties)) {</span>
<a href="#l32.11"></a><span id="l32.11">         r1[property] = value;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-        do_check_eq(r1[property], value);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+        equal(r1[property], value);</span>
<a href="#l32.14"></a><span id="l32.14">     }</span>
<a href="#l32.15"></a><span id="l32.15"> </span>
<a href="#l32.16"></a><span id="l32.16">     // Add relation to event</span>
<a href="#l32.17"></a><span id="l32.17">     e1.addRelation(r1);</span>
<a href="#l32.18"></a><span id="l32.18"> </span>
<a href="#l32.19"></a><span id="l32.19">     // Add 2nd relation to event.</span>
<a href="#l32.20"></a><span id="l32.20">     let r2 = cal.createRelation();</span>
<a href="#l32.21"></a><span id="l32.21">     r2.relId = &quot;myid2&quot;;</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -39,89 +39,89 @@ function run_test() {</span>
<a href="#l32.23"></a><span id="l32.23">     r2.icalProperty;</span>
<a href="#l32.24"></a><span id="l32.24"> </span>
<a href="#l32.25"></a><span id="l32.25">     test_icalprop();</span>
<a href="#l32.26"></a><span id="l32.26"> }</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28"> function checkRelations(event, expRel) {</span>
<a href="#l32.29"></a><span id="l32.29">     let countObj = {};</span>
<a href="#l32.30"></a><span id="l32.30">     let allRel = event.getRelations(countObj);</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-    do_check_eq(countObj.value, allRel.length);</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineminus">-    do_check_eq(allRel.length, expRel.length);</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineplus">+    equal(countObj.value, allRel.length);</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+    equal(allRel.length, expRel.length);</span>
<a href="#l32.35"></a><span id="l32.35"> </span>
<a href="#l32.36"></a><span id="l32.36">     // check if all expacted relations are found</span>
<a href="#l32.37"></a><span id="l32.37">     for (let i = 0; i &lt; expRel.length; i++) {</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-        do_check_neq(allRel.indexOf(expRel[i]), -1);</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineplus">+        notEqual(allRel.indexOf(expRel[i]), -1);</span>
<a href="#l32.40"></a><span id="l32.40">     }</span>
<a href="#l32.41"></a><span id="l32.41"> </span>
<a href="#l32.42"></a><span id="l32.42">     // Check if all found relations are expected</span>
<a href="#l32.43"></a><span id="l32.43">     for (let i = 0; i &lt; allRel.length; i++) {</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineminus">-        do_check_neq(expRel.indexOf(allRel[i]), -1);</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineplus">+        notEqual(expRel.indexOf(allRel[i]), -1);</span>
<a href="#l32.46"></a><span id="l32.46">     }</span>
<a href="#l32.47"></a><span id="l32.47"> }</span>
<a href="#l32.48"></a><span id="l32.48"> </span>
<a href="#l32.49"></a><span id="l32.49"> function modifyRelations(event, oldRel) {</span>
<a href="#l32.50"></a><span id="l32.50">     let allRel = event.getRelations({});</span>
<a href="#l32.51"></a><span id="l32.51">     let rel = allRel[0];</span>
<a href="#l32.52"></a><span id="l32.52"> </span>
<a href="#l32.53"></a><span id="l32.53">     // modify the properties</span>
<a href="#l32.54"></a><span id="l32.54">     rel.relType = &quot;SIBLING&quot;;</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineminus">-    do_check_eq(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineminus">-    do_check_eq(rel.relType, allRel[0].relType);</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineplus">+    equal(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineplus">+    equal(rel.relType, allRel[0].relType);</span>
<a href="#l32.59"></a><span id="l32.59"> </span>
<a href="#l32.60"></a><span id="l32.60">     // remove one relation</span>
<a href="#l32.61"></a><span id="l32.61">     event.removeRelation(rel);</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineminus">-    do_check_eq(event.getRelations({}).length, oldRel.length - 1);</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+    equal(event.getRelations({}).length, oldRel.length - 1);</span>
<a href="#l32.64"></a><span id="l32.64"> </span>
<a href="#l32.65"></a><span id="l32.65">     // add one relation and remove all relations</span>
<a href="#l32.66"></a><span id="l32.66">     event.addRelation(oldRel[0]);</span>
<a href="#l32.67"></a><span id="l32.67">     event.removeAllRelations();</span>
<a href="#l32.68"></a><span id="l32.68" class="difflineminus">-    do_check_eq(event.getRelations({}), 0);</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineplus">+    equal(event.getRelations({}), 0);</span>
<a href="#l32.70"></a><span id="l32.70"> }</span>
<a href="#l32.71"></a><span id="l32.71"> </span>
<a href="#l32.72"></a><span id="l32.72"> function test_icalprop() {</span>
<a href="#l32.73"></a><span id="l32.73">     let rel = cal.createRelation();</span>
<a href="#l32.74"></a><span id="l32.74"> </span>
<a href="#l32.75"></a><span id="l32.75">     rel.relType = &quot;SIBLING&quot;;</span>
<a href="#l32.76"></a><span id="l32.76">     rel.setParameter(&quot;X-PROP&quot;, &quot;VAL&quot;);</span>
<a href="#l32.77"></a><span id="l32.77">     rel.relId = &quot;value&quot;;</span>
<a href="#l32.78"></a><span id="l32.78"> </span>
<a href="#l32.79"></a><span id="l32.79">     let prop = rel.icalProperty;</span>
<a href="#l32.80"></a><span id="l32.80">     let propOrig = rel.icalProperty;</span>
<a href="#l32.81"></a><span id="l32.81"> </span>
<a href="#l32.82"></a><span id="l32.82" class="difflineminus">-    do_check_eq(rel.icalString, prop.icalString);</span>
<a href="#l32.83"></a><span id="l32.83" class="difflineplus">+    equal(rel.icalString, prop.icalString);</span>
<a href="#l32.84"></a><span id="l32.84"> </span>
<a href="#l32.85"></a><span id="l32.85" class="difflineminus">-    do_check_eq(prop.value, &quot;value&quot;);</span>
<a href="#l32.86"></a><span id="l32.86" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;X-PROP&quot;), &quot;VAL&quot;);</span>
<a href="#l32.87"></a><span id="l32.87" class="difflineminus">-    do_check_eq(prop.getParameter(&quot;RELTYPE&quot;), &quot;SIBLING&quot;);</span>
<a href="#l32.88"></a><span id="l32.88" class="difflineplus">+    equal(prop.value, &quot;value&quot;);</span>
<a href="#l32.89"></a><span id="l32.89" class="difflineplus">+    equal(prop.getParameter(&quot;X-PROP&quot;), &quot;VAL&quot;);</span>
<a href="#l32.90"></a><span id="l32.90" class="difflineplus">+    equal(prop.getParameter(&quot;RELTYPE&quot;), &quot;SIBLING&quot;);</span>
<a href="#l32.91"></a><span id="l32.91"> </span>
<a href="#l32.92"></a><span id="l32.92">     prop.value = &quot;changed&quot;;</span>
<a href="#l32.93"></a><span id="l32.93">     prop.setParameter(&quot;RELTYPE&quot;, &quot;changedtype&quot;);</span>
<a href="#l32.94"></a><span id="l32.94">     prop.setParameter(&quot;X-PROP&quot;, &quot;changedxprop&quot;);</span>
<a href="#l32.95"></a><span id="l32.95"> </span>
<a href="#l32.96"></a><span id="l32.96" class="difflineminus">-    do_check_eq(rel.relId, &quot;value&quot;);</span>
<a href="#l32.97"></a><span id="l32.97" class="difflineminus">-    do_check_eq(rel.getParameter(&quot;X-PROP&quot;), &quot;VAL&quot;);</span>
<a href="#l32.98"></a><span id="l32.98" class="difflineminus">-    do_check_eq(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l32.99"></a><span id="l32.99" class="difflineplus">+    equal(rel.relId, &quot;value&quot;);</span>
<a href="#l32.100"></a><span id="l32.100" class="difflineplus">+    equal(rel.getParameter(&quot;X-PROP&quot;), &quot;VAL&quot;);</span>
<a href="#l32.101"></a><span id="l32.101" class="difflineplus">+    equal(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l32.102"></a><span id="l32.102"> </span>
<a href="#l32.103"></a><span id="l32.103">     rel.icalProperty = prop;</span>
<a href="#l32.104"></a><span id="l32.104"> </span>
<a href="#l32.105"></a><span id="l32.105" class="difflineminus">-    do_check_eq(rel.relId, &quot;changed&quot;);</span>
<a href="#l32.106"></a><span id="l32.106" class="difflineminus">-    do_check_eq(rel.getParameter(&quot;X-PROP&quot;), &quot;changedxprop&quot;);</span>
<a href="#l32.107"></a><span id="l32.107" class="difflineminus">-    do_check_eq(rel.relType, &quot;changedtype&quot;);</span>
<a href="#l32.108"></a><span id="l32.108" class="difflineplus">+    equal(rel.relId, &quot;changed&quot;);</span>
<a href="#l32.109"></a><span id="l32.109" class="difflineplus">+    equal(rel.getParameter(&quot;X-PROP&quot;), &quot;changedxprop&quot;);</span>
<a href="#l32.110"></a><span id="l32.110" class="difflineplus">+    equal(rel.relType, &quot;changedtype&quot;);</span>
<a href="#l32.111"></a><span id="l32.111"> </span>
<a href="#l32.112"></a><span id="l32.112">     rel.icalString = propOrig.icalString;</span>
<a href="#l32.113"></a><span id="l32.113"> </span>
<a href="#l32.114"></a><span id="l32.114" class="difflineminus">-    do_check_eq(rel.relId, &quot;value&quot;);</span>
<a href="#l32.115"></a><span id="l32.115" class="difflineminus">-    do_check_eq(rel.getParameter(&quot;X-PROP&quot;), &quot;VAL&quot;);</span>
<a href="#l32.116"></a><span id="l32.116" class="difflineminus">-    do_check_eq(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l32.117"></a><span id="l32.117" class="difflineplus">+    equal(rel.relId, &quot;value&quot;);</span>
<a href="#l32.118"></a><span id="l32.118" class="difflineplus">+    equal(rel.getParameter(&quot;X-PROP&quot;), &quot;VAL&quot;);</span>
<a href="#l32.119"></a><span id="l32.119" class="difflineplus">+    equal(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l32.120"></a><span id="l32.120"> </span>
<a href="#l32.121"></a><span id="l32.121">     let rel2 = rel.clone();</span>
<a href="#l32.122"></a><span id="l32.122">     rel.icalProperty = prop;</span>
<a href="#l32.123"></a><span id="l32.123"> </span>
<a href="#l32.124"></a><span id="l32.124" class="difflineminus">-    do_check_neq(rel.icalString, rel2.icalString);</span>
<a href="#l32.125"></a><span id="l32.125" class="difflineplus">+    notEqual(rel.icalString, rel2.icalString);</span>
<a href="#l32.126"></a><span id="l32.126"> </span>
<a href="#l32.127"></a><span id="l32.127">     rel.deleteParameter(&quot;X-PROP&quot;);</span>
<a href="#l32.128"></a><span id="l32.128" class="difflineminus">-    do_check_eq(rel.icalProperty.getParameter(&quot;X-PROP&quot;), null);</span>
<a href="#l32.129"></a><span id="l32.129" class="difflineplus">+    equal(rel.icalProperty.getParameter(&quot;X-PROP&quot;), null);</span>
<a href="#l32.130"></a><span id="l32.130"> </span>
<a href="#l32.131"></a><span id="l32.131" class="difflineminus">-    do_check_throws(function() {</span>
<a href="#l32.132"></a><span id="l32.132" class="difflineplus">+    throws(function() {</span>
<a href="#l32.133"></a><span id="l32.133">         rel.icalString = &quot;X-UNKNOWN:value&quot;;</span>
<a href="#l32.134"></a><span id="l32.134" class="difflineminus">-    }, Components.results.NS_ERROR_ILLEGAL_VALUE);</span>
<a href="#l32.135"></a><span id="l32.135" class="difflineplus">+    }, /Illegal value/);</span>
<a href="#l32.136"></a><span id="l32.136"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/test/unit/test_rfc3339_parser.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/test/unit/test_rfc3339_parser.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -34,28 +34,28 @@ function really_run_test() {</span>
<a href="#l33.4"></a><span id="l33.4">             timezone: aExpectedDateTime[6],</span>
<a href="#l33.5"></a><span id="l33.5">             isDate: aExpectedDateTime[7]</span>
<a href="#l33.6"></a><span id="l33.6">         };</span>
<a href="#l33.7"></a><span id="l33.7">         for (let prop in expectedDateProps) {</span>
<a href="#l33.8"></a><span id="l33.8">             do_print(&quot;Checking prop: &quot; + prop);</span>
<a href="#l33.9"></a><span id="l33.9">             // Object comparison fails with ical.js, and we only want to check</span>
<a href="#l33.10"></a><span id="l33.10">             // that we have the right timezone.</span>
<a href="#l33.11"></a><span id="l33.11">             if (prop == &quot;timezone&quot;)</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-                do_check_eq(dateTime[prop].tzid, expectedDateProps[prop].tzid)</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+                equal(dateTime[prop].tzid, expectedDateProps[prop].tzid)</span>
<a href="#l33.14"></a><span id="l33.14">             else</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineminus">-                do_check_eq(dateTime[prop], expectedDateProps[prop]);</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+                equal(dateTime[prop], expectedDateProps[prop]);</span>
<a href="#l33.17"></a><span id="l33.17">         }</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19">         // Test round tripping that dateTime object back to an RFC 3339 string.</span>
<a href="#l33.20"></a><span id="l33.20">         let rfc3339Date = cal.toRFC3339(dateTime);</span>
<a href="#l33.21"></a><span id="l33.21"> </span>
<a href="#l33.22"></a><span id="l33.22">         // In theory this should just match the input RFC 3339 date, but there are</span>
<a href="#l33.23"></a><span id="l33.23">         // multiple ways of generating the same time, e.g. 2006-03-14Z is</span>
<a href="#l33.24"></a><span id="l33.24">         // equivalent to 2006-03-14.</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineminus">-        do_check_eq(rfc3339Date, aExpectedRfc3339Date);</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineplus">+        equal(rfc3339Date, aExpectedRfc3339Date);</span>
<a href="#l33.27"></a><span id="l33.27">     }</span>
<a href="#l33.28"></a><span id="l33.28"> </span>
<a href="#l33.29"></a><span id="l33.29">     /*</span>
<a href="#l33.30"></a><span id="l33.30">      * Some notes about the differences between calIDateTime and the RFC 3339</span>
<a href="#l33.31"></a><span id="l33.31">      * specification:</span>
<a href="#l33.32"></a><span id="l33.32">      * 1. calIDateTime does not support fractions of a second, they are</span>
<a href="#l33.33"></a><span id="l33.33">      *    stripped.</span>
<a href="#l33.34"></a><span id="l33.34">      * 2. If a timezone cannot be matched to the given time offset, the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/test/unit/test_search_service.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/test/unit/test_search_service.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -12,90 +12,90 @@ function run_test() {</span>
<a href="#l34.4"></a><span id="l34.4">     test_found();</span>
<a href="#l34.5"></a><span id="l34.5">     test_failure();</span>
<a href="#l34.6"></a><span id="l34.6">     test_cancel();</span>
<a href="#l34.7"></a><span id="l34.7"> }</span>
<a href="#l34.8"></a><span id="l34.8"> </span>
<a href="#l34.9"></a><span id="l34.9"> function test_found() {</span>
<a href="#l34.10"></a><span id="l34.10">     search.getProviders({}).forEach(search.removeProvider, search);</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    do_check_eq(search.getProviders({}).length, 0);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+    equal(search.getProviders({}).length, 0);</span>
<a href="#l34.14"></a><span id="l34.14"> </span>
<a href="#l34.15"></a><span id="l34.15">     let provider1 = {</span>
<a href="#l34.16"></a><span id="l34.16">         id: 1,</span>
<a href="#l34.17"></a><span id="l34.17">         searchForCalendars: function() {}</span>
<a href="#l34.18"></a><span id="l34.18">     };</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20">     let provider2 = {</span>
<a href="#l34.21"></a><span id="l34.21">         id: 2,</span>
<a href="#l34.22"></a><span id="l34.22">         called: false,</span>
<a href="#l34.23"></a><span id="l34.23">         searchForCalendars: function(aStr, aHint, aMax, aListener) {</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineminus">-            do_check_false(this.called)</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineplus">+            ok(!this.called)</span>
<a href="#l34.26"></a><span id="l34.26">             this.called = true;</span>
<a href="#l34.27"></a><span id="l34.27"> </span>
<a href="#l34.28"></a><span id="l34.28" class="difflineminus">-            do_check_eq(aStr, &quot;str&quot;);</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-            do_check_eq(aHint, HINT_EXACT_MATCH);</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-            do_check_eq(aMax, 0);</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineplus">+            equal(aStr, &quot;str&quot;);</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+            equal(aHint, HINT_EXACT_MATCH);</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineplus">+            equal(aMax, 0);</span>
<a href="#l34.34"></a><span id="l34.34"> </span>
<a href="#l34.35"></a><span id="l34.35">             let mockCalendar = {</span>
<a href="#l34.36"></a><span id="l34.36">                 id: &quot;test&quot;</span>
<a href="#l34.37"></a><span id="l34.37">             };</span>
<a href="#l34.38"></a><span id="l34.38"> </span>
<a href="#l34.39"></a><span id="l34.39">             aListener.onResult(null, [mockCalendar]);</span>
<a href="#l34.40"></a><span id="l34.40">         }</span>
<a href="#l34.41"></a><span id="l34.41">     };</span>
<a href="#l34.42"></a><span id="l34.42">     provider2.wrappedJSObject = provider2;</span>
<a href="#l34.43"></a><span id="l34.43"> </span>
<a href="#l34.44"></a><span id="l34.44">     search.addProvider(provider1);</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineminus">-    do_check_eq(search.getProviders({}).length, 1);</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineplus">+    equal(search.getProviders({}).length, 1);</span>
<a href="#l34.47"></a><span id="l34.47">     search.addProvider(provider2);</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineminus">-    do_check_eq(search.getProviders({}).length, 2);</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineplus">+    equal(search.getProviders({}).length, 2);</span>
<a href="#l34.50"></a><span id="l34.50">     search.removeProvider(provider1);</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineminus">-    do_check_eq(search.getProviders({}).length, 1);</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineminus">-    do_check_eq(search.getProviders({})[0].wrappedJSObject.id, 2);</span>
<a href="#l34.53"></a><span id="l34.53" class="difflineplus">+    equal(search.getProviders({}).length, 1);</span>
<a href="#l34.54"></a><span id="l34.54" class="difflineplus">+    equal(search.getProviders({})[0].wrappedJSObject.id, 2);</span>
<a href="#l34.55"></a><span id="l34.55"> </span>
<a href="#l34.56"></a><span id="l34.56">     let listener = {</span>
<a href="#l34.57"></a><span id="l34.57">         called: false,</span>
<a href="#l34.58"></a><span id="l34.58">         onResult: function(request, result) {</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineminus">-            do_check_false(this.called);</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineplus">+            ok(!this.called);</span>
<a href="#l34.61"></a><span id="l34.61">             this.called = true;</span>
<a href="#l34.62"></a><span id="l34.62"> </span>
<a href="#l34.63"></a><span id="l34.63" class="difflineminus">-            do_check_eq(result.length, 1);</span>
<a href="#l34.64"></a><span id="l34.64" class="difflineminus">-            do_check_eq(result[0].id, &quot;test&quot;);</span>
<a href="#l34.65"></a><span id="l34.65" class="difflineplus">+            equal(result.length, 1);</span>
<a href="#l34.66"></a><span id="l34.66" class="difflineplus">+            equal(result[0].id, &quot;test&quot;);</span>
<a href="#l34.67"></a><span id="l34.67"> </span>
<a href="#l34.68"></a><span id="l34.68">         }</span>
<a href="#l34.69"></a><span id="l34.69">     };</span>
<a href="#l34.70"></a><span id="l34.70"> </span>
<a href="#l34.71"></a><span id="l34.71">     let op = search.searchForCalendars(&quot;str&quot;, HINT_EXACT_MATCH, 0, listener);</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineminus">-    do_check_true(listener.called);</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineminus">-    do_check_true(provider2.called);</span>
<a href="#l34.74"></a><span id="l34.74" class="difflineplus">+    ok(listener.called);</span>
<a href="#l34.75"></a><span id="l34.75" class="difflineplus">+    ok(provider2.called);</span>
<a href="#l34.76"></a><span id="l34.76"> }</span>
<a href="#l34.77"></a><span id="l34.77"> </span>
<a href="#l34.78"></a><span id="l34.78"> function test_failure() {</span>
<a href="#l34.79"></a><span id="l34.79">     search.getProviders({}).forEach(search.removeProvider, search);</span>
<a href="#l34.80"></a><span id="l34.80"> </span>
<a href="#l34.81"></a><span id="l34.81">     let provider = {</span>
<a href="#l34.82"></a><span id="l34.82">         searchForCalendars: function(aStr, aHint, aMax, aListener) {</span>
<a href="#l34.83"></a><span id="l34.83">             throw &quot;error&quot;;</span>
<a href="#l34.84"></a><span id="l34.84">         }</span>
<a href="#l34.85"></a><span id="l34.85">     };</span>
<a href="#l34.86"></a><span id="l34.86"> </span>
<a href="#l34.87"></a><span id="l34.87">     let listener = {</span>
<a href="#l34.88"></a><span id="l34.88">         called: false,</span>
<a href="#l34.89"></a><span id="l34.89">         onResult: function(request, result) {</span>
<a href="#l34.90"></a><span id="l34.90" class="difflineminus">-            do_check_false(this.called);</span>
<a href="#l34.91"></a><span id="l34.91" class="difflineplus">+            ok(!this.called);</span>
<a href="#l34.92"></a><span id="l34.92">             this.called = true;</span>
<a href="#l34.93"></a><span id="l34.93" class="difflineminus">-            do_check_eq(result.length, 0);</span>
<a href="#l34.94"></a><span id="l34.94" class="difflineplus">+            equal(result.length, 0);</span>
<a href="#l34.95"></a><span id="l34.95">         }</span>
<a href="#l34.96"></a><span id="l34.96">     };</span>
<a href="#l34.97"></a><span id="l34.97"> </span>
<a href="#l34.98"></a><span id="l34.98">     search.addProvider(provider);</span>
<a href="#l34.99"></a><span id="l34.99"> </span>
<a href="#l34.100"></a><span id="l34.100">     let op = search.searchForCalendars(&quot;str&quot;, HINT_EXACT_MATCH, 0, listener);</span>
<a href="#l34.101"></a><span id="l34.101" class="difflineminus">-    do_check_true(listener.called);</span>
<a href="#l34.102"></a><span id="l34.102" class="difflineplus">+    ok(listener.called);</span>
<a href="#l34.103"></a><span id="l34.103"> }</span>
<a href="#l34.104"></a><span id="l34.104"> </span>
<a href="#l34.105"></a><span id="l34.105"> function test_cancel() {</span>
<a href="#l34.106"></a><span id="l34.106">     search.getProviders({}).forEach(search.removeProvider, search);</span>
<a href="#l34.107"></a><span id="l34.107"> </span>
<a href="#l34.108"></a><span id="l34.108">     let provider = {</span>
<a href="#l34.109"></a><span id="l34.109">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICalendarSearchProvider, Components.interfaces.calIOperation]),</span>
<a href="#l34.110"></a><span id="l34.110">         searchForCalendars: function(aStr, aHint, aMax, aListener) {</span>
<a href="#l34.111"></a><span id="l34.111" class="difflineat">@@ -116,20 +116,20 @@ function test_cancel() {</span>
<a href="#l34.112"></a><span id="l34.112">         cancel: function() {</span>
<a href="#l34.113"></a><span id="l34.113">             this.cancelCalled = true;</span>
<a href="#l34.114"></a><span id="l34.114">         },</span>
<a href="#l34.115"></a><span id="l34.115">     };</span>
<a href="#l34.116"></a><span id="l34.116"> </span>
<a href="#l34.117"></a><span id="l34.117">     let listener = {</span>
<a href="#l34.118"></a><span id="l34.118">         called: false,</span>
<a href="#l34.119"></a><span id="l34.119">         onResult: function(request, result) {</span>
<a href="#l34.120"></a><span id="l34.120" class="difflineminus">-            do_check_eq(result, null);</span>
<a href="#l34.121"></a><span id="l34.121" class="difflineplus">+            equal(result, null);</span>
<a href="#l34.122"></a><span id="l34.122"> </span>
<a href="#l34.123"></a><span id="l34.123">             // If an exception occurs, the operation is not added to the opgroup</span>
<a href="#l34.124"></a><span id="l34.124" class="difflineminus">-            do_check_false(provider.cancelCalled);</span>
<a href="#l34.125"></a><span id="l34.125" class="difflineplus">+            ok(!provider.cancelCalled);</span>
<a href="#l34.126"></a><span id="l34.126">             do_test_finished();</span>
<a href="#l34.127"></a><span id="l34.127">         }</span>
<a href="#l34.128"></a><span id="l34.128">     };</span>
<a href="#l34.129"></a><span id="l34.129"> </span>
<a href="#l34.130"></a><span id="l34.130">     search.addProvider(provider);</span>
<a href="#l34.131"></a><span id="l34.131"> </span>
<a href="#l34.132"></a><span id="l34.132">     do_test_pending();</span>
<a href="#l34.133"></a><span id="l34.133">     let op = search.searchForCalendars(&quot;str&quot;, HINT_EXACT_MATCH, 0, listener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/test/unit/test_startup_service.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/test/unit/test_startup_service.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -7,24 +7,24 @@ function run_test() {</span>
<a href="#l35.4"></a><span id="l35.4">                          .getService(Components.interfaces.nsIObserver);</span>
<a href="#l35.5"></a><span id="l35.5"> </span>
<a href="#l35.6"></a><span id="l35.6">     let first = {</span>
<a href="#l35.7"></a><span id="l35.7">         startup: function(aListener) {</span>
<a href="#l35.8"></a><span id="l35.8">             second.canStart = true;</span>
<a href="#l35.9"></a><span id="l35.9">             aListener.onResult(null, Cr.NS_OK);</span>
<a href="#l35.10"></a><span id="l35.10">         },</span>
<a href="#l35.11"></a><span id="l35.11">         shutdown: function(aListener) {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-            do_check_true(this.canStop);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+            ok(this.canStop);</span>
<a href="#l35.14"></a><span id="l35.14">             aListener.onResult(null, Cr.NS_OK);</span>
<a href="#l35.15"></a><span id="l35.15">         }</span>
<a href="#l35.16"></a><span id="l35.16">     };</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18">     let second = {</span>
<a href="#l35.19"></a><span id="l35.19">         startup: function(aListener) {</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineminus">-            do_check_true(this.canStart);</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+            ok(this.canStart);</span>
<a href="#l35.22"></a><span id="l35.22">             aListener.onResult(null, Cr.NS_OK);</span>
<a href="#l35.23"></a><span id="l35.23">         },</span>
<a href="#l35.24"></a><span id="l35.24">         shutdown: function(aListener) {</span>
<a href="#l35.25"></a><span id="l35.25">             first.canStop = true;</span>
<a href="#l35.26"></a><span id="l35.26">             aListener.onResult(null, Cr.NS_OK);</span>
<a href="#l35.27"></a><span id="l35.27">         }</span>
<a href="#l35.28"></a><span id="l35.28">     };</span>
<a href="#l35.29"></a><span id="l35.29"> </span>
<a href="#l35.30"></a><span id="l35.30" class="difflineat">@@ -34,14 +34,14 @@ function run_test() {</span>
<a href="#l35.31"></a><span id="l35.31">         let origOrder = oldStartupOrder.call(this);</span>
<a href="#l35.32"></a><span id="l35.32"> </span>
<a href="#l35.33"></a><span id="l35.33">         let notify = origOrder[origOrder.length - 1];</span>
<a href="#l35.34"></a><span id="l35.34">         return [first, second, notify];</span>
<a href="#l35.35"></a><span id="l35.35">     };</span>
<a href="#l35.36"></a><span id="l35.36"> </span>
<a href="#l35.37"></a><span id="l35.37">     // Pretend a startup run</span>
<a href="#l35.38"></a><span id="l35.38">     ssvc.observe(null, &quot;profile-after-change&quot;, null);</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineminus">-    do_check_true(second.canStart);</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+    ok(second.canStart);</span>
<a href="#l35.41"></a><span id="l35.41"> </span>
<a href="#l35.42"></a><span id="l35.42">     // Pretend a stop run</span>
<a href="#l35.43"></a><span id="l35.43">     ssvc.observe(null, &quot;profile-before-change&quot;, null);</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineminus">-    do_check_true(first.canStop);</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineplus">+    ok(first.canStop);</span>
<a href="#l35.46"></a><span id="l35.46"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/test/unit/test_storage.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/test/unit/test_storage.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -33,62 +33,62 @@ function testAttachRoundtrip() {</span>
<a href="#l36.4"></a><span id="l36.4">     });</span>
<a href="#l36.5"></a><span id="l36.5"> </span>
<a href="#l36.6"></a><span id="l36.6">     let retrieveItem = {</span>
<a href="#l36.7"></a><span id="l36.7">         found: false,</span>
<a href="#l36.8"></a><span id="l36.8">         onGetResult: function(c, s, t, d, c, items) {</span>
<a href="#l36.9"></a><span id="l36.9">             let item = items[0];</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11">             // Check start date</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-            do_check_eq(item.startDate.compare(cal.createDateTime(&quot;20120101T010101Z&quot;)), 0);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+            equal(item.startDate.compare(cal.createDateTime(&quot;20120101T010101Z&quot;)), 0);</span>
<a href="#l36.14"></a><span id="l36.14"> </span>
<a href="#l36.15"></a><span id="l36.15">             // Check attachment</span>
<a href="#l36.16"></a><span id="l36.16">             let attaches = item.getAttachments({});</span>
<a href="#l36.17"></a><span id="l36.17">             let attach = attaches[0];</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">-            do_check_eq(attaches.length, 1);</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineminus">-            do_check_eq(attach.uri.spec, &quot;http://example.com/test.ics&quot;);</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineminus">-            do_check_eq(attach.formatType, &quot;text/calendar&quot;);</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">-            do_check_eq(attach.encoding, &quot;BASE64&quot;);</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineminus">-            do_check_eq(attach.getParameter(&quot;FILENAME&quot;), &quot;test.ics&quot;);</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineplus">+            equal(attaches.length, 1);</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineplus">+            equal(attach.uri.spec, &quot;http://example.com/test.ics&quot;);</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineplus">+            equal(attach.formatType, &quot;text/calendar&quot;);</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineplus">+            equal(attach.encoding, &quot;BASE64&quot;);</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineplus">+            equal(attach.getParameter(&quot;FILENAME&quot;), &quot;test.ics&quot;);</span>
<a href="#l36.28"></a><span id="l36.28"> </span>
<a href="#l36.29"></a><span id="l36.29">             // Check attendee</span>
<a href="#l36.30"></a><span id="l36.30">             let attendees = item.getAttendees({});</span>
<a href="#l36.31"></a><span id="l36.31">             let attendee = attendees[0];</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">-            do_check_eq(attendees.length, 1);</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineminus">-            do_check_eq(attendee.id, &quot;mailto:test@example.com&quot;);</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineminus">-            do_check_eq(attendee.commonName, &quot;Name&quot;);</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineminus">-            do_check_eq(attendee.rsvp, &quot;TRUE&quot;);</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-            do_check_eq(attendee.isOrganizer, false);</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineminus">-            do_check_eq(attendee.role, &quot;REQ-PARTICIPANT&quot;);</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineminus">-            do_check_eq(attendee.participationStatus, &quot;ACCEPTED&quot;);</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-            do_check_eq(attendee.userType, &quot;INDIVIDUAL&quot;);</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineminus">-            do_check_eq(attendee.getProperty(&quot;X-THING&quot;), &quot;BAR&quot;);</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineplus">+            equal(attendees.length, 1);</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineplus">+            equal(attendee.id, &quot;mailto:test@example.com&quot;);</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineplus">+            equal(attendee.commonName, &quot;Name&quot;);</span>
<a href="#l36.44"></a><span id="l36.44" class="difflineplus">+            equal(attendee.rsvp, &quot;TRUE&quot;);</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineplus">+            equal(attendee.isOrganizer, false);</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineplus">+            equal(attendee.role, &quot;REQ-PARTICIPANT&quot;);</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineplus">+            equal(attendee.participationStatus, &quot;ACCEPTED&quot;);</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineplus">+            equal(attendee.userType, &quot;INDIVIDUAL&quot;);</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineplus">+            equal(attendee.getProperty(&quot;X-THING&quot;), &quot;BAR&quot;);</span>
<a href="#l36.50"></a><span id="l36.50"> </span>
<a href="#l36.51"></a><span id="l36.51">             // Check relation</span>
<a href="#l36.52"></a><span id="l36.52">             let relations = item.getRelations({});</span>
<a href="#l36.53"></a><span id="l36.53">             let rel = relations[0];</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineminus">-            do_check_eq(relations.length, 1);</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineminus">-            do_check_eq(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l36.56"></a><span id="l36.56" class="difflineminus">-            do_check_eq(rel.relId, &quot;VALUE&quot;);</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineminus">-            do_check_eq(rel.getParameter(&quot;FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineplus">+            equal(relations.length, 1);</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineplus">+            equal(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineplus">+            equal(rel.relId, &quot;VALUE&quot;);</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineplus">+            equal(rel.getParameter(&quot;FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l36.62"></a><span id="l36.62"> </span>
<a href="#l36.63"></a><span id="l36.63">             // Check recurrence item</span>
<a href="#l36.64"></a><span id="l36.64">             for each (let ritem in item.recurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l36.65"></a><span id="l36.65">                 if (ritem instanceof Components.interfaces.calIRecurrenceRule) {</span>
<a href="#l36.66"></a><span id="l36.66" class="difflineminus">-                    do_check_eq(ritem.type, &quot;MONTHLY&quot;);</span>
<a href="#l36.67"></a><span id="l36.67" class="difflineminus">-                    do_check_eq(ritem.interval, 2);</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineminus">-                    do_check_eq(ritem.count, 5);</span>
<a href="#l36.69"></a><span id="l36.69" class="difflineminus">-                    do_check_eq(ritem.isByCount, true);</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineminus">-                    do_check_eq(ritem.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l36.71"></a><span id="l36.71" class="difflineminus">-                    do_check_eq(ritem.isNegative, false);</span>
<a href="#l36.72"></a><span id="l36.72" class="difflineplus">+                    equal(ritem.type, &quot;MONTHLY&quot;);</span>
<a href="#l36.73"></a><span id="l36.73" class="difflineplus">+                    equal(ritem.interval, 2);</span>
<a href="#l36.74"></a><span id="l36.74" class="difflineplus">+                    equal(ritem.count, 5);</span>
<a href="#l36.75"></a><span id="l36.75" class="difflineplus">+                    equal(ritem.isByCount, true);</span>
<a href="#l36.76"></a><span id="l36.76" class="difflineplus">+                    equal(ritem.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineplus">+                    equal(ritem.isNegative, false);</span>
<a href="#l36.78"></a><span id="l36.78">                 } else if (ritem instanceof Components.interfaces.calIRecurrenceDate) {</span>
<a href="#l36.79"></a><span id="l36.79">                     if (ritem.isNegative) {</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineminus">-                        do_check_eq(ritem.date.compare(cal.createDateTime(&quot;20120301T010101Z&quot;)), 0);</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineplus">+                        equal(ritem.date.compare(cal.createDateTime(&quot;20120301T010101Z&quot;)), 0);</span>
<a href="#l36.82"></a><span id="l36.82">                     } else {</span>
<a href="#l36.83"></a><span id="l36.83" class="difflineminus">-                        do_check_eq(ritem.date.compare(cal.createDateTime(&quot;20120201T010101Z&quot;)), 0);</span>
<a href="#l36.84"></a><span id="l36.84" class="difflineplus">+                        equal(ritem.date.compare(cal.createDateTime(&quot;20120201T010101Z&quot;)), 0);</span>
<a href="#l36.85"></a><span id="l36.85">                     }</span>
<a href="#l36.86"></a><span id="l36.86">                 } else {</span>
<a href="#l36.87"></a><span id="l36.87">                     do_throw(&quot;Found unknown recurrence item &quot; + ritem);</span>
<a href="#l36.88"></a><span id="l36.88">                 }</span>
<a href="#l36.89"></a><span id="l36.89">             }</span>
<a href="#l36.90"></a><span id="l36.90"> </span>
<a href="#l36.91"></a><span id="l36.91">             this.found = true;</span>
<a href="#l36.92"></a><span id="l36.92">         },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/test/unit/test_timezone.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/test/unit/test_timezone.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -62,11 +62,11 @@ function run_test() {</span>
<a href="#l37.4"></a><span id="l37.4"> </span>
<a href="#l37.5"></a><span id="l37.5">     f.icalString = str;</span>
<a href="#l37.6"></a><span id="l37.6"> </span>
<a href="#l37.7"></a><span id="l37.7">     let g = f.startDate;</span>
<a href="#l37.8"></a><span id="l37.8">     let h = f.endDate;</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">     g.timezone = tzs.getTimezone(g.timezone.tzid);</span>
<a href="#l37.11"></a><span id="l37.11">     h.timezone = tzs.getTimezone(h.timezone.tzid);</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    do_check_neq(strTz,g.timezone.toString());</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    notEqual(strTz,g.timezone.toString());</span>
<a href="#l37.14"></a><span id="l37.14"> }</span>
<a href="#l37.15"></a><span id="l37.15"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/test/unit/test_utils.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/test/unit/test_utils.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -22,63 +22,63 @@ function really_run_test() {</span>
<a href="#l38.4"></a><span id="l38.4">     test_sameDay();</span>
<a href="#l38.5"></a><span id="l38.5">     test_binarySearch();</span>
<a href="#l38.6"></a><span id="l38.6"> }</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> function test_recentzones() {</span>
<a href="#l38.9"></a><span id="l38.9">     let oldDefaultTz = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;&quot;);</span>
<a href="#l38.10"></a><span id="l38.10">     Preferences.set(&quot;calendar.timezone.local&quot;, &quot;floating&quot;);</span>
<a href="#l38.11"></a><span id="l38.11"> </span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    do_check_eq(cal.getRecentTimezones().length, 0);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">-    do_check_eq(cal.getRecentTimezones(true).length, 0);</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+    equal(cal.getRecentTimezones().length, 0);</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+    equal(cal.getRecentTimezones(true).length, 0);</span>
<a href="#l38.16"></a><span id="l38.16"> </span>
<a href="#l38.17"></a><span id="l38.17">     cal.saveRecentTimezone(&quot;Europe/Berlin&quot;);</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19">     let zones = cal.getRecentTimezones();</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineminus">-    do_check_eq(zones.length, 1);</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineminus">-    do_check_eq(zones[0], &quot;Europe/Berlin&quot;);</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineplus">+    equal(zones.length, 1);</span>
<a href="#l38.23"></a><span id="l38.23" class="difflineplus">+    equal(zones[0], &quot;Europe/Berlin&quot;);</span>
<a href="#l38.24"></a><span id="l38.24">     zones = cal.getRecentTimezones(true);</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineminus">-    do_check_eq(zones.length, 1);</span>
<a href="#l38.26"></a><span id="l38.26" class="difflineminus">-    do_check_eq(zones[0].tzid, &quot;Europe/Berlin&quot;);</span>
<a href="#l38.27"></a><span id="l38.27" class="difflineplus">+    equal(zones.length, 1);</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineplus">+    equal(zones[0].tzid, &quot;Europe/Berlin&quot;);</span>
<a href="#l38.29"></a><span id="l38.29"> </span>
<a href="#l38.30"></a><span id="l38.30">     cal.saveRecentTimezone(cal.calendarDefaultTimezone().tzid);</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-    do_check_eq(cal.getRecentTimezones().length, 1);</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineminus">-    do_check_eq(cal.getRecentTimezones(true).length, 1);</span>
<a href="#l38.33"></a><span id="l38.33" class="difflineplus">+    equal(cal.getRecentTimezones().length, 1);</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineplus">+    equal(cal.getRecentTimezones(true).length, 1);</span>
<a href="#l38.35"></a><span id="l38.35"> </span>
<a href="#l38.36"></a><span id="l38.36">     cal.saveRecentTimezone(&quot;Europe/Berlin&quot;);</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineminus">-    do_check_eq(cal.getRecentTimezones().length, 1);</span>
<a href="#l38.38"></a><span id="l38.38" class="difflineminus">-    do_check_eq(cal.getRecentTimezones(true).length, 1);</span>
<a href="#l38.39"></a><span id="l38.39" class="difflineplus">+    equal(cal.getRecentTimezones().length, 1);</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineplus">+    equal(cal.getRecentTimezones(true).length, 1);</span>
<a href="#l38.41"></a><span id="l38.41"> </span>
<a href="#l38.42"></a><span id="l38.42">     cal.saveRecentTimezone(&quot;America/New_York&quot;);</span>
<a href="#l38.43"></a><span id="l38.43" class="difflineminus">-    do_check_eq(cal.getRecentTimezones().length, 2);</span>
<a href="#l38.44"></a><span id="l38.44" class="difflineminus">-    do_check_eq(cal.getRecentTimezones(true).length, 2);</span>
<a href="#l38.45"></a><span id="l38.45" class="difflineplus">+    equal(cal.getRecentTimezones().length, 2);</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineplus">+    equal(cal.getRecentTimezones(true).length, 2);</span>
<a href="#l38.47"></a><span id="l38.47"> </span>
<a href="#l38.48"></a><span id="l38.48">     cal.saveRecentTimezone(&quot;Unknown&quot;);</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-    do_check_eq(cal.getRecentTimezones().length, 3);</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineminus">-    do_check_eq(cal.getRecentTimezones(true).length, 2);</span>
<a href="#l38.51"></a><span id="l38.51" class="difflineplus">+    equal(cal.getRecentTimezones().length, 3);</span>
<a href="#l38.52"></a><span id="l38.52" class="difflineplus">+    equal(cal.getRecentTimezones(true).length, 2);</span>
<a href="#l38.53"></a><span id="l38.53"> </span>
<a href="#l38.54"></a><span id="l38.54">     Preferences.set(&quot;calendar.timezone.local&quot;, oldDefaultTz);</span>
<a href="#l38.55"></a><span id="l38.55"> }</span>
<a href="#l38.56"></a><span id="l38.56"> </span>
<a href="#l38.57"></a><span id="l38.57"> function test_formatcss() {</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineminus">-    do_check_eq(cal.formatStringForCSSRule(&quot; &quot;), &quot;_&quot;);</span>
<a href="#l38.59"></a><span id="l38.59" class="difflineminus">-    do_check_eq(cal.formatStringForCSSRule(&quot;&quot;), &quot;-uxfc-&quot;);</span>
<a href="#l38.60"></a><span id="l38.60" class="difflineminus">-    do_check_eq(cal.formatStringForCSSRule(&quot;a&quot;), &quot;a&quot;);</span>
<a href="#l38.61"></a><span id="l38.61" class="difflineplus">+    equal(cal.formatStringForCSSRule(&quot; &quot;), &quot;_&quot;);</span>
<a href="#l38.62"></a><span id="l38.62" class="difflineplus">+    equal(cal.formatStringForCSSRule(&quot;&quot;), &quot;-uxfc-&quot;);</span>
<a href="#l38.63"></a><span id="l38.63" class="difflineplus">+    equal(cal.formatStringForCSSRule(&quot;a&quot;), &quot;a&quot;);</span>
<a href="#l38.64"></a><span id="l38.64"> }</span>
<a href="#l38.65"></a><span id="l38.65"> </span>
<a href="#l38.66"></a><span id="l38.66"> function test_attendeeMatchesAddresses() {</span>
<a href="#l38.67"></a><span id="l38.67">     let a = cal.createAttendee(&quot;ATTENDEE:mailto:horst&quot;);</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineminus">-    do_check_true(cal.attendeeMatchesAddresses(a, [&quot;HORST&quot;, &quot;peter&quot;]));</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineminus">-    do_check_false(cal.attendeeMatchesAddresses(a, [&quot;HORSTpeter&quot;, &quot;peter&quot;]));</span>
<a href="#l38.70"></a><span id="l38.70" class="difflineminus">-    do_check_false(cal.attendeeMatchesAddresses(a, [&quot;peter&quot;]));</span>
<a href="#l38.71"></a><span id="l38.71" class="difflineplus">+    ok(cal.attendeeMatchesAddresses(a, [&quot;HORST&quot;, &quot;peter&quot;]));</span>
<a href="#l38.72"></a><span id="l38.72" class="difflineplus">+    ok(!cal.attendeeMatchesAddresses(a, [&quot;HORSTpeter&quot;, &quot;peter&quot;]));</span>
<a href="#l38.73"></a><span id="l38.73" class="difflineplus">+    ok(!cal.attendeeMatchesAddresses(a, [&quot;peter&quot;]));</span>
<a href="#l38.74"></a><span id="l38.74"> </span>
<a href="#l38.75"></a><span id="l38.75">     a = cal.createAttendee(&quot;ATTENDEE;EMAIL=\&quot;horst\&quot;:urn:uuid:horst&quot;);</span>
<a href="#l38.76"></a><span id="l38.76" class="difflineminus">-    do_check_true(cal.attendeeMatchesAddresses(a, [&quot;HORST&quot;, &quot;peter&quot;]));</span>
<a href="#l38.77"></a><span id="l38.77" class="difflineminus">-    do_check_false(cal.attendeeMatchesAddresses(a, [&quot;HORSTpeter&quot;, &quot;peter&quot;]));</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineminus">-    do_check_false(cal.attendeeMatchesAddresses(a, [&quot;peter&quot;]));</span>
<a href="#l38.79"></a><span id="l38.79" class="difflineplus">+    ok(cal.attendeeMatchesAddresses(a, [&quot;HORST&quot;, &quot;peter&quot;]));</span>
<a href="#l38.80"></a><span id="l38.80" class="difflineplus">+    ok(!cal.attendeeMatchesAddresses(a, [&quot;HORSTpeter&quot;, &quot;peter&quot;]));</span>
<a href="#l38.81"></a><span id="l38.81" class="difflineplus">+    ok(!cal.attendeeMatchesAddresses(a, [&quot;peter&quot;]));</span>
<a href="#l38.82"></a><span id="l38.82"> }</span>
<a href="#l38.83"></a><span id="l38.83"> </span>
<a href="#l38.84"></a><span id="l38.84"> function test_getDefaultStartDate() {</span>
<a href="#l38.85"></a><span id="l38.85">     function tt(n, t) {</span>
<a href="#l38.86"></a><span id="l38.86">         now = cal.createDateTime(n);</span>
<a href="#l38.87"></a><span id="l38.87">         return cal.getDefaultStartDate(t ? cal.createDateTime(t) : null);</span>
<a href="#l38.88"></a><span id="l38.88">     }</span>
<a href="#l38.89"></a><span id="l38.89"> </span>
<a href="#l38.90"></a><span id="l38.90" class="difflineat">@@ -86,111 +86,111 @@ function test_getDefaultStartDate() {</span>
<a href="#l38.91"></a><span id="l38.91">     let now = cal.createDateTime(&quot;20120101T000000&quot;);</span>
<a href="#l38.92"></a><span id="l38.92">     cal.now = function() {</span>
<a href="#l38.93"></a><span id="l38.93">         return now;</span>
<a href="#l38.94"></a><span id="l38.94">     };</span>
<a href="#l38.95"></a><span id="l38.95"> </span>
<a href="#l38.96"></a><span id="l38.96">     dump(&quot;TT: &quot; + cal.createDateTime(&quot;20120101T000000&quot;) + &quot;\n&quot;);</span>
<a href="#l38.97"></a><span id="l38.97">     dump(&quot;TT: &quot; + cal.getDefaultStartDate(cal.createDateTime(&quot;20120101T000000&quot;)) + &quot;\n&quot;);</span>
<a href="#l38.98"></a><span id="l38.98"> </span>
<a href="#l38.99"></a><span id="l38.99" class="difflineminus">-    do_check_eq(tt(&quot;20120101T000000&quot;).icalString, &quot;20120101T010000&quot;);</span>
<a href="#l38.100"></a><span id="l38.100" class="difflineminus">-    do_check_eq(tt(&quot;20120101T015959&quot;).icalString, &quot;20120101T020000&quot;);</span>
<a href="#l38.101"></a><span id="l38.101" class="difflineminus">-    do_check_eq(tt(&quot;20120101T230000&quot;).icalString, &quot;20120101T230000&quot;);</span>
<a href="#l38.102"></a><span id="l38.102" class="difflineminus">-    do_check_eq(tt(&quot;20120101T235959&quot;).icalString, &quot;20120101T230000&quot;);</span>
<a href="#l38.103"></a><span id="l38.103" class="difflineplus">+    equal(tt(&quot;20120101T000000&quot;).icalString, &quot;20120101T010000&quot;);</span>
<a href="#l38.104"></a><span id="l38.104" class="difflineplus">+    equal(tt(&quot;20120101T015959&quot;).icalString, &quot;20120101T020000&quot;);</span>
<a href="#l38.105"></a><span id="l38.105" class="difflineplus">+    equal(tt(&quot;20120101T230000&quot;).icalString, &quot;20120101T230000&quot;);</span>
<a href="#l38.106"></a><span id="l38.106" class="difflineplus">+    equal(tt(&quot;20120101T235959&quot;).icalString, &quot;20120101T230000&quot;);</span>
<a href="#l38.107"></a><span id="l38.107"> </span>
<a href="#l38.108"></a><span id="l38.108" class="difflineminus">-    do_check_eq(tt(&quot;20120101T000000&quot;, &quot;20120202&quot;).icalString, &quot;20120202T010000&quot;);</span>
<a href="#l38.109"></a><span id="l38.109" class="difflineminus">-    do_check_eq(tt(&quot;20120101T015959&quot;, &quot;20120202&quot;).icalString, &quot;20120202T020000&quot;);</span>
<a href="#l38.110"></a><span id="l38.110" class="difflineminus">-    do_check_eq(tt(&quot;20120101T230000&quot;, &quot;20120202&quot;).icalString, &quot;20120202T230000&quot;);</span>
<a href="#l38.111"></a><span id="l38.111" class="difflineminus">-    do_check_eq(tt(&quot;20120101T235959&quot;, &quot;20120202&quot;).icalString, &quot;20120202T230000&quot;);</span>
<a href="#l38.112"></a><span id="l38.112" class="difflineplus">+    equal(tt(&quot;20120101T000000&quot;, &quot;20120202&quot;).icalString, &quot;20120202T010000&quot;);</span>
<a href="#l38.113"></a><span id="l38.113" class="difflineplus">+    equal(tt(&quot;20120101T015959&quot;, &quot;20120202&quot;).icalString, &quot;20120202T020000&quot;);</span>
<a href="#l38.114"></a><span id="l38.114" class="difflineplus">+    equal(tt(&quot;20120101T230000&quot;, &quot;20120202&quot;).icalString, &quot;20120202T230000&quot;);</span>
<a href="#l38.115"></a><span id="l38.115" class="difflineplus">+    equal(tt(&quot;20120101T235959&quot;, &quot;20120202&quot;).icalString, &quot;20120202T230000&quot;);</span>
<a href="#l38.116"></a><span id="l38.116"> </span>
<a href="#l38.117"></a><span id="l38.117">     let event = cal.createEvent();</span>
<a href="#l38.118"></a><span id="l38.118">     now = cal.createDateTime(&quot;20120101T015959&quot;);</span>
<a href="#l38.119"></a><span id="l38.119">     cal.setDefaultStartEndHour(event, cal.createDateTime(&quot;20120202&quot;));</span>
<a href="#l38.120"></a><span id="l38.120" class="difflineminus">-    do_check_eq(event.startDate.icalString, &quot;20120202T020000&quot;);</span>
<a href="#l38.121"></a><span id="l38.121" class="difflineminus">-    do_check_eq(event.endDate.icalString, &quot;20120202T030000&quot;);</span>
<a href="#l38.122"></a><span id="l38.122" class="difflineplus">+    equal(event.startDate.icalString, &quot;20120202T020000&quot;);</span>
<a href="#l38.123"></a><span id="l38.123" class="difflineplus">+    equal(event.endDate.icalString, &quot;20120202T030000&quot;);</span>
<a href="#l38.124"></a><span id="l38.124"> </span>
<a href="#l38.125"></a><span id="l38.125">     let todo = cal.createTodo();</span>
<a href="#l38.126"></a><span id="l38.126">     now = cal.createDateTime(&quot;20120101T000000&quot;);</span>
<a href="#l38.127"></a><span id="l38.127">     cal.setDefaultStartEndHour(todo, cal.createDateTime(&quot;20120202&quot;));</span>
<a href="#l38.128"></a><span id="l38.128" class="difflineminus">-    do_check_eq(todo.entryDate.icalString, &quot;20120202T010000&quot;);</span>
<a href="#l38.129"></a><span id="l38.129" class="difflineplus">+    equal(todo.entryDate.icalString, &quot;20120202T010000&quot;);</span>
<a href="#l38.130"></a><span id="l38.130"> </span>
<a href="#l38.131"></a><span id="l38.131">     cal.now = oldNow;</span>
<a href="#l38.132"></a><span id="l38.132"> }</span>
<a href="#l38.133"></a><span id="l38.133"> </span>
<a href="#l38.134"></a><span id="l38.134"> function test_getStartEndProps() {</span>
<a href="#l38.135"></a><span id="l38.135" class="difflineminus">-    do_check_eq(cal.calGetStartDateProp(cal.createEvent()), &quot;startDate&quot;);</span>
<a href="#l38.136"></a><span id="l38.136" class="difflineminus">-    do_check_eq(cal.calGetEndDateProp(cal.createEvent()), &quot;endDate&quot;);</span>
<a href="#l38.137"></a><span id="l38.137" class="difflineminus">-    do_check_eq(cal.calGetStartDateProp(cal.createTodo()), &quot;entryDate&quot;);</span>
<a href="#l38.138"></a><span id="l38.138" class="difflineminus">-    do_check_eq(cal.calGetEndDateProp(cal.createTodo()), &quot;dueDate&quot;);</span>
<a href="#l38.139"></a><span id="l38.139" class="difflineplus">+    equal(cal.calGetStartDateProp(cal.createEvent()), &quot;startDate&quot;);</span>
<a href="#l38.140"></a><span id="l38.140" class="difflineplus">+    equal(cal.calGetEndDateProp(cal.createEvent()), &quot;endDate&quot;);</span>
<a href="#l38.141"></a><span id="l38.141" class="difflineplus">+    equal(cal.calGetStartDateProp(cal.createTodo()), &quot;entryDate&quot;);</span>
<a href="#l38.142"></a><span id="l38.142" class="difflineplus">+    equal(cal.calGetEndDateProp(cal.createTodo()), &quot;dueDate&quot;);</span>
<a href="#l38.143"></a><span id="l38.143"> </span>
<a href="#l38.144"></a><span id="l38.144" class="difflineminus">-    do_check_throws(function() cal.calGetStartDateProp(null),</span>
<a href="#l38.145"></a><span id="l38.145" class="difflineminus">-                    Components.results.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l38.146"></a><span id="l38.146" class="difflineminus">-    do_check_throws(function() cal.calGetEndDateProp(null),</span>
<a href="#l38.147"></a><span id="l38.147" class="difflineminus">-                    Components.results.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l38.148"></a><span id="l38.148" class="difflineplus">+    throws(function() cal.calGetStartDateProp(null),</span>
<a href="#l38.149"></a><span id="l38.149" class="difflineplus">+                    /2147500033/);</span>
<a href="#l38.150"></a><span id="l38.150" class="difflineplus">+   throws(function() cal.calGetEndDateProp(null),</span>
<a href="#l38.151"></a><span id="l38.151" class="difflineplus">+                    /2147500033/);</span>
<a href="#l38.152"></a><span id="l38.152"> }</span>
<a href="#l38.153"></a><span id="l38.153"> </span>
<a href="#l38.154"></a><span id="l38.154"> function test_calOperationGroup() {</span>
<a href="#l38.155"></a><span id="l38.155">     let cancelCalled = false;</span>
<a href="#l38.156"></a><span id="l38.156">     function cancelFunc() cancelCalled = true;</span>
<a href="#l38.157"></a><span id="l38.157"> </span>
<a href="#l38.158"></a><span id="l38.158">     let group = new cal.calOperationGroup(cancelFunc);</span>
<a href="#l38.159"></a><span id="l38.159"> </span>
<a href="#l38.160"></a><span id="l38.160" class="difflineminus">-    do_check_true(group.isEmpty);</span>
<a href="#l38.161"></a><span id="l38.161" class="difflineminus">-    do_check_eq(group.id, cal.calOperationGroup.mOpGroupPrefix + &quot;0&quot;);</span>
<a href="#l38.162"></a><span id="l38.162" class="difflineminus">-    do_check_eq(group.status, Components.results.NS_OK);</span>
<a href="#l38.163"></a><span id="l38.163" class="difflineminus">-    do_check_eq(group.isPending, true);</span>
<a href="#l38.164"></a><span id="l38.164" class="difflineplus">+    ok(group.isEmpty);</span>
<a href="#l38.165"></a><span id="l38.165" class="difflineplus">+    equal(group.id, cal.calOperationGroup.mOpGroupPrefix + &quot;0&quot;);</span>
<a href="#l38.166"></a><span id="l38.166" class="difflineplus">+    equal(group.status, Components.results.NS_OK);</span>
<a href="#l38.167"></a><span id="l38.167" class="difflineplus">+    equal(group.isPending, true);</span>
<a href="#l38.168"></a><span id="l38.168"> </span>
<a href="#l38.169"></a><span id="l38.169">     let completedOp = {</span>
<a href="#l38.170"></a><span id="l38.170">         isPending: false</span>
<a href="#l38.171"></a><span id="l38.171">     };</span>
<a href="#l38.172"></a><span id="l38.172"> </span>
<a href="#l38.173"></a><span id="l38.173">     group.add(completedOp);</span>
<a href="#l38.174"></a><span id="l38.174" class="difflineminus">-    do_check_true(group.isEmpty);</span>
<a href="#l38.175"></a><span id="l38.175" class="difflineminus">-    do_check_eq(group.isPending, true);</span>
<a href="#l38.176"></a><span id="l38.176" class="difflineplus">+    ok(group.isEmpty);</span>
<a href="#l38.177"></a><span id="l38.177" class="difflineplus">+    equal(group.isPending, true);</span>
<a href="#l38.178"></a><span id="l38.178"> </span>
<a href="#l38.179"></a><span id="l38.179">     let pendingOp1 = {</span>
<a href="#l38.180"></a><span id="l38.180">         id: 1,</span>
<a href="#l38.181"></a><span id="l38.181">         isPending: true,</span>
<a href="#l38.182"></a><span id="l38.182">         cancel: function() this.cancelCalled = true</span>
<a href="#l38.183"></a><span id="l38.183">     };</span>
<a href="#l38.184"></a><span id="l38.184"> </span>
<a href="#l38.185"></a><span id="l38.185">     group.add(pendingOp1);</span>
<a href="#l38.186"></a><span id="l38.186" class="difflineminus">-    do_check_false(group.isEmpty);</span>
<a href="#l38.187"></a><span id="l38.187" class="difflineminus">-    do_check_eq(group.isPending, true);</span>
<a href="#l38.188"></a><span id="l38.188" class="difflineplus">+    ok(!group.isEmpty);</span>
<a href="#l38.189"></a><span id="l38.189" class="difflineplus">+    equal(group.isPending, true);</span>
<a href="#l38.190"></a><span id="l38.190"> </span>
<a href="#l38.191"></a><span id="l38.191">     let pendingOp2 = {</span>
<a href="#l38.192"></a><span id="l38.192">         id: 2,</span>
<a href="#l38.193"></a><span id="l38.193">         isPending: true,</span>
<a href="#l38.194"></a><span id="l38.194">         cancel: function() this.cancelCalled = true</span>
<a href="#l38.195"></a><span id="l38.195">     };</span>
<a href="#l38.196"></a><span id="l38.196"> </span>
<a href="#l38.197"></a><span id="l38.197">     group.add(pendingOp2);</span>
<a href="#l38.198"></a><span id="l38.198">     group.remove(pendingOp1);</span>
<a href="#l38.199"></a><span id="l38.199" class="difflineminus">-    do_check_false(group.isEmpty);</span>
<a href="#l38.200"></a><span id="l38.200" class="difflineminus">-    do_check_eq(group.isPending, true);</span>
<a href="#l38.201"></a><span id="l38.201" class="difflineplus">+    ok(!group.isEmpty);</span>
<a href="#l38.202"></a><span id="l38.202" class="difflineplus">+    equal(group.isPending, true);</span>
<a href="#l38.203"></a><span id="l38.203"> </span>
<a href="#l38.204"></a><span id="l38.204">     group.cancel();</span>
<a href="#l38.205"></a><span id="l38.205"> </span>
<a href="#l38.206"></a><span id="l38.206" class="difflineminus">-    do_check_eq(group.status, Components.interfaces.calIErrors.OPERATION_CANCELLED);</span>
<a href="#l38.207"></a><span id="l38.207" class="difflineminus">-    do_check_false(group.isPending);</span>
<a href="#l38.208"></a><span id="l38.208" class="difflineminus">-    do_check_true(cancelCalled);</span>
<a href="#l38.209"></a><span id="l38.209" class="difflineminus">-    do_check_true(pendingOp2.cancelCalled);</span>
<a href="#l38.210"></a><span id="l38.210" class="difflineplus">+    equal(group.status, Components.interfaces.calIErrors.OPERATION_CANCELLED);</span>
<a href="#l38.211"></a><span id="l38.211" class="difflineplus">+    ok(!group.isPending);</span>
<a href="#l38.212"></a><span id="l38.212" class="difflineplus">+    ok(cancelCalled);</span>
<a href="#l38.213"></a><span id="l38.213" class="difflineplus">+    ok(pendingOp2.cancelCalled);</span>
<a href="#l38.214"></a><span id="l38.214"> }</span>
<a href="#l38.215"></a><span id="l38.215"> </span>
<a href="#l38.216"></a><span id="l38.216"> function test_sameDay() {</span>
<a href="#l38.217"></a><span id="l38.217">     let dt = cal.createDateTime;</span>
<a href="#l38.218"></a><span id="l38.218"> </span>
<a href="#l38.219"></a><span id="l38.219" class="difflineminus">-    do_check_true(cal.sameDay(dt(&quot;20120101&quot;), dt(&quot;20120101T120000&quot;)));</span>
<a href="#l38.220"></a><span id="l38.220" class="difflineminus">-    do_check_true(cal.sameDay(dt(&quot;20120101&quot;), dt(&quot;20120101&quot;)));</span>
<a href="#l38.221"></a><span id="l38.221" class="difflineminus">-    do_check_false(cal.sameDay(dt(&quot;20120101&quot;), dt(&quot;20120102&quot;)));</span>
<a href="#l38.222"></a><span id="l38.222" class="difflineminus">-    do_check_false(cal.sameDay(dt(&quot;20120101T120000&quot;), dt(&quot;20120102T120000&quot;)));</span>
<a href="#l38.223"></a><span id="l38.223" class="difflineplus">+    ok(cal.sameDay(dt(&quot;20120101&quot;), dt(&quot;20120101T120000&quot;)));</span>
<a href="#l38.224"></a><span id="l38.224" class="difflineplus">+    ok(cal.sameDay(dt(&quot;20120101&quot;), dt(&quot;20120101&quot;)));</span>
<a href="#l38.225"></a><span id="l38.225" class="difflineplus">+    ok(!cal.sameDay(dt(&quot;20120101&quot;), dt(&quot;20120102&quot;)));</span>
<a href="#l38.226"></a><span id="l38.226" class="difflineplus">+    ok(!cal.sameDay(dt(&quot;20120101T120000&quot;), dt(&quot;20120102T120000&quot;)));</span>
<a href="#l38.227"></a><span id="l38.227"> }</span>
<a href="#l38.228"></a><span id="l38.228"> </span>
<a href="#l38.229"></a><span id="l38.229"> function test_binarySearch() {</span>
<a href="#l38.230"></a><span id="l38.230">     let arr = [2, 5, 7, 9, 20, 27, 34, 39, 41, 53, 62];</span>
<a href="#l38.231"></a><span id="l38.231" class="difflineminus">-    do_check_eq(binarySearch(arr, 27), 5); // Center</span>
<a href="#l38.232"></a><span id="l38.232" class="difflineminus">-    do_check_eq(binarySearch(arr, 2), 0); // Left most</span>
<a href="#l38.233"></a><span id="l38.233" class="difflineminus">-    do_check_eq(binarySearch(arr, 62), 11); // Right most</span>
<a href="#l38.234"></a><span id="l38.234" class="difflineplus">+    equal(binarySearch(arr, 27), 5); // Center</span>
<a href="#l38.235"></a><span id="l38.235" class="difflineplus">+    equal(binarySearch(arr, 2), 0); // Left most</span>
<a href="#l38.236"></a><span id="l38.236" class="difflineplus">+    equal(binarySearch(arr, 62), 11); // Right most</span>
<a href="#l38.237"></a><span id="l38.237"> </span>
<a href="#l38.238"></a><span id="l38.238" class="difflineminus">-    do_check_eq(binarySearch([5], 5), 1) // One element found</span>
<a href="#l38.239"></a><span id="l38.239" class="difflineminus">-    do_check_eq(binarySearch([1], 0), 0) // One element insert left</span>
<a href="#l38.240"></a><span id="l38.240" class="difflineminus">-    do_check_eq(binarySearch([1], 2), 1) // One element insert right</span>
<a href="#l38.241"></a><span id="l38.241" class="difflineplus">+    equal(binarySearch([5], 5), 1) // One element found</span>
<a href="#l38.242"></a><span id="l38.242" class="difflineplus">+    equal(binarySearch([1], 0), 0) // One element insert left</span>
<a href="#l38.243"></a><span id="l38.243" class="difflineplus">+    equal(binarySearch([1], 2), 1) // One element insert right</span>
<a href="#l38.244"></a><span id="l38.244"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/test/unit/test_webcal.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/test/unit/test_webcal.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -6,17 +6,17 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l39.4"></a><span id="l39.4"> Components.utils.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l39.5"></a><span id="l39.5"> Components.utils.import(&quot;resource://testing-common/httpd.js&quot;);</span>
<a href="#l39.6"></a><span id="l39.6"> </span>
<a href="#l39.7"></a><span id="l39.7"> function run_test() {</span>
<a href="#l39.8"></a><span id="l39.8">     let httpserv = new HttpServer();</span>
<a href="#l39.9"></a><span id="l39.9">     httpserv.registerPrefixHandler(&quot;/&quot;, {</span>
<a href="#l39.10"></a><span id="l39.10">         handle: function(request, response) {</span>
<a href="#l39.11"></a><span id="l39.11">           response.setStatusLine(request.httpVersion, 200, &quot;OK&quot;);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-          do_check_eq(request.path, &quot;/test_webcal&quot;);</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+          equal(request.path, &quot;/test_webcal&quot;);</span>
<a href="#l39.14"></a><span id="l39.14">         }</span>
<a href="#l39.15"></a><span id="l39.15">     });</span>
<a href="#l39.16"></a><span id="l39.16">     httpserv.start(-1);</span>
<a href="#l39.17"></a><span id="l39.17"> </span>
<a href="#l39.18"></a><span id="l39.18">     let baseUri = &quot;://localhost:&quot; + httpserv.identity.primaryPort + &quot;/test_webcal&quot;;</span>
<a href="#l39.19"></a><span id="l39.19">     add_test(check_webcal_uri.bind(null, &quot;webcal&quot; + baseUri));</span>
<a href="#l39.20"></a><span id="l39.20">     // TODO webcals needs bug 466524 to be fixed</span>
<a href="#l39.21"></a><span id="l39.21">     // add_test(check_webcal_uri.bind(null, &quot;webcals&quot; + baseUri));</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -24,12 +24,12 @@ function run_test() {</span>
<a href="#l39.23"></a><span id="l39.23"> </span>
<a href="#l39.24"></a><span id="l39.24">     // Now lets go...</span>
<a href="#l39.25"></a><span id="l39.25">     run_next_test();</span>
<a href="#l39.26"></a><span id="l39.26"> }</span>
<a href="#l39.27"></a><span id="l39.27"> </span>
<a href="#l39.28"></a><span id="l39.28"> function check_webcal_uri(uri) {</span>
<a href="#l39.29"></a><span id="l39.29">     let chan = Services.io.newChannel(uri, null, null);</span>
<a href="#l39.30"></a><span id="l39.30">     NetUtil.asyncFetch(chan, function(data, status, request) {</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-        do_check_true(Components.isSuccessCode(status));</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+        ok(Components.isSuccessCode(status));</span>
<a href="#l39.33"></a><span id="l39.33">         run_next_test();</span>
<a href="#l39.34"></a><span id="l39.34">     });</span>
<a href="#l39.35"></a><span id="l39.35"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

