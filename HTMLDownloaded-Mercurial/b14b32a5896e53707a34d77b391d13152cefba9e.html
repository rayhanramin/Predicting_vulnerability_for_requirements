<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 15829:b14b32a5896e53707a34d77b391d13152cefba9e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ b14b32a5896e53707a34d77b391d13152cefba9e" />
<meta property="og:url" content="/comm-central/rev/b14b32a5896e53707a34d77b391d13152cefba9e" />
<meta property="og:description" content="Fix bug 923026 - Make use of Preferences.jsm in calendar code. r=Archaeopteryx" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / b14b32a5896e53707a34d77b391d13152cefba9e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/b14b32a5896e53707a34d77b391d13152cefba9e">shortlog</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/b14b32a5896e53707a34d77b391d13152cefba9e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e">files</a> |
changeset |
<a href="/comm-central/raw-rev/b14b32a5896e53707a34d77b391d13152cefba9e">raw</a>  | <a href="/comm-central/archive/b14b32a5896e53707a34d77b391d13152cefba9e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=923026">bug 923026</a> - Make use of Preferences.jsm in calendar code. r=Archaeopteryx
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 01 Mar 2014 19:52:05 +0100</td></tr>

<tr>
 <td>changeset 15829</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/b14b32a5896e53707a34d77b391d13152cefba9e">b14b32a5896e53707a34d77b391d13152cefba9e</a></td>
</tr>



<tr>
<td>parent 15828</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/138407c9060d5048d9f799d4e3ece86e7a816bb1">138407c9060d5048d9f799d4e3ece86e7a816bb1</a>
</td>
</tr>

<tr>
<td>child 15830</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8b9bd8b734cecbc664390444fad9e96b01db9062">8b9bd8b734cecbc664390444fad9e96b01db9062</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=b14b32a5896e53707a34d77b391d13152cefba9e">9916</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sat, 01 Mar 2014 18:52:36 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@b14b32a5896e [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b14b32a5896e53707a34d77b391d13152cefba9e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=b14b32a5896e53707a34d77b391d13152cefba9e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b14b32a5896e53707a34d77b391d13152cefba9e&newProject=comm-central&newRevision=b14b32a5896e53707a34d77b391d13152cefba9e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b14b32a5896e53707a34d77b391d13152cefba9e&newProject=comm-central&newRevision=b14b32a5896e53707a34d77b391d13152cefba9e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=b14b32a5896e53707a34d77b391d13152cefba9e&newProject=comm-central&newRevision=b14b32a5896e53707a34d77b391d13152cefba9e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Archaeopteryx%29&revcount=50">Archaeopteryx</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=923026">923026</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=923026">bug 923026</a> - Make use of Preferences.jsm in calendar code. r=Archaeopteryx</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-chrome-startup.js">calendar/base/content/calendar-chrome-startup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-chrome-startup.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-chrome-startup.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-chrome-startup.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-chrome-startup.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-chrome-startup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-dnd-listener.js">calendar/base/content/calendar-dnd-listener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-dnd-listener.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-dnd-listener.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-dnd-listener.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-dnd-listener.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-dnd-listener.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-extract.js">calendar/base/content/calendar-extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-extract.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-extract.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-extract.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-extract.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-extract.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-view-core.xml">calendar/base/content/calendar-view-core.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-view-core.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-view-core.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-view-core.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-view-core.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-view-core.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.xml">calendar/base/content/calendar-views.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/calendar-views.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-alarm-dialog.js">calendar/base/content/dialogs/calendar-alarm-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-alarm-dialog.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-alarm-dialog.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-alarm-dialog.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-alarm-dialog.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-alarm-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog.js">calendar/base/content/dialogs/calendar-event-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-event-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-migration-dialog.js">calendar/base/content/dialogs/calendar-migration-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-migration-dialog.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-migration-dialog.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-migration-dialog.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-migration-dialog.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/dialogs/calendar-migration-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/calendar-alarm-widget.xml">calendar/base/content/widgets/calendar-alarm-widget.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/calendar-alarm-widget.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/calendar-alarm-widget.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/calendar-alarm-widget.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/calendar-alarm-widget.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/calendar-alarm-widget.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAlarmUtils.jsm">calendar/base/modules/calAlarmUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAlarmUtils.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAlarmUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAlarmUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAlarmUtils.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAlarmUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAuthUtils.jsm">calendar/base/modules/calAuthUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAuthUtils.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAuthUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAuthUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAuthUtils.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calAuthUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calExtract.jsm">calendar/base/modules/calExtract.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calExtract.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calExtract.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calExtract.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calExtract.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calExtract.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calIteratorUtils.jsm">calendar/base/modules/calIteratorUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calIteratorUtils.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calIteratorUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calIteratorUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calIteratorUtils.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calIteratorUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calPrintUtils.jsm">calendar/base/modules/calPrintUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calPrintUtils.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calPrintUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calPrintUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calPrintUtils.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calPrintUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmMonitor.js">calendar/base/src/calAlarmMonitor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmMonitor.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmMonitor.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmMonitor.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmMonitor.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmMonitor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calDateTimeFormatter.js">calendar/base/src/calDateTimeFormatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calDateTimeFormatter.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calDateTimeFormatter.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calDateTimeFormatter.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calDateTimeFormatter.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calDateTimeFormatter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calWeekInfoService.js">calendar/base/src/calWeekInfoService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calWeekInfoService.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calWeekInfoService.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calWeekInfoService.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calWeekInfoService.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/base/src/calWeekInfoService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calMonthGridPrinter.js">calendar/import-export/calMonthGridPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calMonthGridPrinter.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calMonthGridPrinter.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calMonthGridPrinter.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calMonthGridPrinter.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calMonthGridPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calWeekPrinter.js">calendar/import-export/calWeekPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calWeekPrinter.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calWeekPrinter.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calWeekPrinter.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calWeekPrinter.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/import-export/calWeekPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/itip/calItipEmailTransport.js">calendar/itip/calItipEmailTransport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/itip/calItipEmailTransport.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/itip/calItipEmailTransport.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/itip/calItipEmailTransport.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/itip/calItipEmailTransport.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/itip/calItipEmailTransport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleCalendar.js">calendar/providers/gdata/components/calGoogleCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleCalendar.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleCalendar.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleCalendar.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleCalendar.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleRequest.js">calendar/providers/gdata/components/calGoogleRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleRequest.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleRequest.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleRequest.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleRequest.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleRequest.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleUtils.js">calendar/providers/gdata/components/calGoogleUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleUtils.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleUtils.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleUtils.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleUtils.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/components/calGoogleUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/content/gdata-migration.js">calendar/providers/gdata/content/gdata-migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/content/gdata-migration.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/content/gdata-migration.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/content/gdata-migration.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/content/gdata-migration.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/gdata/content/gdata-migration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapCalendarModule.js">calendar/providers/wcap/calWcapCalendarModule.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapCalendarModule.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapCalendarModule.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapCalendarModule.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapCalendarModule.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapCalendarModule.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapUtils.js">calendar/providers/wcap/calWcapUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapUtils.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapUtils.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapUtils.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapUtils.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/providers/wcap/calWcapUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/resources/content/calendar.js">calendar/resources/content/calendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/resources/content/calendar.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/resources/content/calendar.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/resources/content/calendar.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/resources/content/calendar.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/resources/content/calendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/mozmill/eventDialog/testUTF8.js">calendar/test/mozmill/eventDialog/testUTF8.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/mozmill/eventDialog/testUTF8.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/mozmill/eventDialog/testUTF8.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/mozmill/eventDialog/testUTF8.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/mozmill/eventDialog/testUTF8.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/mozmill/eventDialog/testUTF8.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/head_consts.js">calendar/test/unit/head_consts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/head_consts.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/head_consts.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/head_consts.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/head_consts.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/head_consts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_extract.js">calendar/test/unit/test_extract.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_extract.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_extract.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_extract.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_extract.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_extract.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_freebusy.js">calendar/test/unit/test_freebusy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_freebusy.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_freebusy.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_freebusy.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_freebusy.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_freebusy.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_parser.js">calendar/test/unit/test_ics_parser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_parser.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_parser.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_parser.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_parser.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_parser.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_service.js">calendar/test/unit/test_ics_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_service.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_service.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_service.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_service.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_ics_service.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_recur.js">calendar/test/unit/test_recur.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_recur.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_recur.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_recur.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_recur.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_recur.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_utils.js">calendar/test/unit/test_utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_utils.js">file</a> |
<a href="/comm-central/annotate/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_utils.js">annotate</a> |
<a href="/comm-central/diff/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_utils.js">diff</a> |
<a href="/comm-central/comparison/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_utils.js">comparison</a> |
<a href="/comm-central/log/b14b32a5896e53707a34d77b391d13152cefba9e/calendar/test/unit/test_utils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> function Synthetic(aOpen, aDuration) {</span>
<a href="#l1.12"></a><span id="l1.12">     this.open = aOpen;</span>
<a href="#l1.13"></a><span id="l1.13">     this.duration = aDuration;</span>
<a href="#l1.14"></a><span id="l1.14"> }</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> var agendaListbox = {</span>
<a href="#l1.17"></a><span id="l1.17">     agendaListboxControl: null,</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineat">@@ -24,17 +25,17 @@ function initAgendaListbox() {</span>
<a href="#l1.19"></a><span id="l1.19">     this.agendaListboxControl = document.getElementById(&quot;agenda-listbox&quot;);</span>
<a href="#l1.20"></a><span id="l1.20">     this.agendaListboxControl.removeAttribute(&quot;suppressonselect&quot;);</span>
<a href="#l1.21"></a><span id="l1.21">     var showTodayHeader = (document.getElementById(&quot;today-header-hidden&quot;).getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.22"></a><span id="l1.22">     var showTomorrowHeader = (document.getElementById(&quot;tomorrow-header-hidden&quot;).getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.23"></a><span id="l1.23">     var showSoonHeader = (document.getElementById(&quot;nextweek-header-hidden&quot;).getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.24"></a><span id="l1.24">     this.today = new Synthetic(showTodayHeader, 1);</span>
<a href="#l1.25"></a><span id="l1.25">     this.addPeriodListItem(this.today, &quot;today-header&quot;);</span>
<a href="#l1.26"></a><span id="l1.26">     this.tomorrow = new Synthetic(showTomorrowHeader, 1);</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-    var soondays = getPrefSafe(&quot;calendar.agendaListbox.soondays&quot;, 5);</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+    var soondays = Preferences.get(&quot;calendar.agendaListbox.soondays&quot;, 5);</span>
<a href="#l1.29"></a><span id="l1.29">     this.soon = new Synthetic(showSoonHeader, soondays);</span>
<a href="#l1.30"></a><span id="l1.30">     this.periods = [this.today, this.tomorrow, this.soon];</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32">     // Make sure the agenda listbox is unloaded</span>
<a href="#l1.33"></a><span id="l1.33">     var self = this;</span>
<a href="#l1.34"></a><span id="l1.34">     window.addEventListener(&quot;unload&quot;,</span>
<a href="#l1.35"></a><span id="l1.35">                             function unload_agendaListbox() {</span>
<a href="#l1.36"></a><span id="l1.36">                                 self.uninit();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -179,17 +179,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">                 }</span>
<a href="#l2.5"></a><span id="l2.5">             },</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">             onError: function onError(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">             onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l2.10"></a><span id="l2.10">                 switch (aName) {</span>
<a href="#l2.11"></a><span id="l2.11">                     case &quot;suppressAlarms&quot;:</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                        if (!getPrefSafe(&quot;calendar.alarms.indicator.show&quot;, true) ||</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                        if (!Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true) ||</span>
<a href="#l2.14"></a><span id="l2.14">                             aCalendar.getProperty(&quot;capabilities.alarms.popup.supported&quot;) === false ) {</span>
<a href="#l2.15"></a><span id="l2.15">                             break;</span>
<a href="#l2.16"></a><span id="l2.16">                         }</span>
<a href="#l2.17"></a><span id="l2.17">                         // else fall through</span>
<a href="#l2.18"></a><span id="l2.18">                     case &quot;readOnly&quot;:</span>
<a href="#l2.19"></a><span id="l2.19">                     case &quot;disabled&quot;:</span>
<a href="#l2.20"></a><span id="l2.20">                         // XXXvv we can be smarter about how we handle this stuff</span>
<a href="#l2.21"></a><span id="l2.21">                         this.calView.refresh();</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -246,16 +246,17 @@</span>
<a href="#l2.23"></a><span id="l2.23">                 // don't care, for now</span>
<a href="#l2.24"></a><span id="l2.24">             }</span>
<a href="#l2.25"></a><span id="l2.25">         })</span>
<a href="#l2.26"></a><span id="l2.26">       ]]&gt;&lt;/field&gt;</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l2.29"></a><span id="l2.29">         Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.30"></a><span id="l2.30">         Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33">         const kWorkdaysCommand = &quot;calendar_toggle_workdays_only_command&quot;;</span>
<a href="#l2.34"></a><span id="l2.34">         const kTasksInViewCommand = &quot;calendar_toggle_tasks_in_view_command&quot;;</span>
<a href="#l2.35"></a><span id="l2.35">         const kShowCompleted = &quot;calendar_toggle_show_completed_in_view_command&quot;;</span>
<a href="#l2.36"></a><span id="l2.36">         const kOrientation = &quot;calendar_toggle_orientation_command&quot;;</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">         this.workdaysOnly = (document.getElementById(kWorkdaysCommand)</span>
<a href="#l2.39"></a><span id="l2.39">                                 .getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineat">@@ -272,17 +273,17 @@</span>
<a href="#l2.41"></a><span id="l2.41">         alarmService.addObserver(this.mObserver);</span>
<a href="#l2.42"></a><span id="l2.42">         let self = this;</span>
<a href="#l2.43"></a><span id="l2.43">         this.setAttribute(&quot;type&quot;, this.type);</span>
<a href="#l2.44"></a><span id="l2.44">         this.mResizeHandler = function resizeHandler() {</span>
<a href="#l2.45"></a><span id="l2.45">             self.onResize(self); };</span>
<a href="#l2.46"></a><span id="l2.46">         this.viewBroadcaster.addEventListener(this.getAttribute(&quot;type&quot;) + &quot;viewresized&quot;, this.mResizeHandler, true);</span>
<a href="#l2.47"></a><span id="l2.47">         // add a preference observer to monitor changes</span>
<a href="#l2.48"></a><span id="l2.48">         Services.prefs.addObserver(&quot;calendar.&quot;, this.mPrefObserver, false);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-        this.weekStartOffset = getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+        this.weekStartOffset = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l2.51"></a><span id="l2.51">         this.updateDaysOffPrefs();</span>
<a href="#l2.52"></a><span id="l2.52">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l2.53"></a><span id="l2.53"> </span>
<a href="#l2.54"></a><span id="l2.54">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l2.55"></a><span id="l2.55">         Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.56"></a><span id="l2.56"> </span>
<a href="#l2.57"></a><span id="l2.57">         if (this.mCalendar) {</span>
<a href="#l2.58"></a><span id="l2.58">             this.mCalendar.removeObserver(this.mObserver);</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineat">@@ -639,17 +640,17 @@</span>
<a href="#l2.60"></a><span id="l2.60">             const weekPrefix = &quot;calendar.week.&quot;;</span>
<a href="#l2.61"></a><span id="l2.61">             const prefNames = [&quot;d0sundaysoff&quot;, &quot;d1mondaysoff&quot;, &quot;d2tuesdaysoff&quot;,</span>
<a href="#l2.62"></a><span id="l2.62">                                &quot;d3wednesdaysoff&quot;, &quot;d4thursdaysoff&quot;,</span>
<a href="#l2.63"></a><span id="l2.63">                                &quot;d5fridaysoff&quot;, &quot;d6saturdaysoff&quot;];</span>
<a href="#l2.64"></a><span id="l2.64">             const defaults = [&quot;true&quot;, &quot;false&quot;, &quot;false&quot;, &quot;false&quot;,</span>
<a href="#l2.65"></a><span id="l2.65">                               &quot;false&quot;, &quot;false&quot;, &quot;true&quot;];</span>
<a href="#l2.66"></a><span id="l2.66">             let daysOff = new Array();</span>
<a href="#l2.67"></a><span id="l2.67">             for (let i in prefNames) {</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineminus">-                if (getPrefSafe(weekPrefix+prefNames[i])) {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+                if (Preferences.get(weekPrefix+prefNames[i])) {</span>
<a href="#l2.70"></a><span id="l2.70">                     daysOff.push(Number(i));</span>
<a href="#l2.71"></a><span id="l2.71">                 }</span>
<a href="#l2.72"></a><span id="l2.72">             }</span>
<a href="#l2.73"></a><span id="l2.73">             this.daysOffArray = daysOff;</span>
<a href="#l2.74"></a><span id="l2.74">         ]]&gt;&lt;/body&gt;</span>
<a href="#l2.75"></a><span id="l2.75">       &lt;/method&gt;</span>
<a href="#l2.76"></a><span id="l2.76"> </span>
<a href="#l2.77"></a><span id="l2.77">       &lt;method name=&quot;refreshView&quot;&gt;</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineat">@@ -760,17 +761,17 @@</span>
<a href="#l2.79"></a><span id="l2.79">                 break;</span>
<a href="#l2.80"></a><span id="l2.80">             case kKE.DOM_VK_PAGE_DOWN:</span>
<a href="#l2.81"></a><span id="l2.81">                 this.moveView(1);</span>
<a href="#l2.82"></a><span id="l2.82">                 break;</span>
<a href="#l2.83"></a><span id="l2.83">         }</span>
<a href="#l2.84"></a><span id="l2.84">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l2.85"></a><span id="l2.85">       &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l2.86"></a><span id="l2.86">         const pixelThreshold = 150;</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineminus">-        if (event.shiftKey &amp;&amp; cal.getPrefSafe('calendar.view.mousescroll', true)){</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+        if (event.shiftKey &amp;&amp; Preferences.get('calendar.view.mousescroll', true)){</span>
<a href="#l2.89"></a><span id="l2.89">             if (event.deltaMode == event.DOM_DELTA_LINE) {</span>
<a href="#l2.90"></a><span id="l2.90">                 if (event.deltaY != 0) {</span>
<a href="#l2.91"></a><span id="l2.91">                     deltaView = event.deltaY &lt; 0 ? -1 : 1;</span>
<a href="#l2.92"></a><span id="l2.92">                 }</span>
<a href="#l2.93"></a><span id="l2.93">             } else if (event.deltaMode == event.DOM_DELTA_PIXEL) {</span>
<a href="#l2.94"></a><span id="l2.94">                 this.mPixelScrollDelta += event.deltaY;</span>
<a href="#l2.95"></a><span id="l2.95">                 if (this.mPixelScrollDelta &gt; pixelThreshold){</span>
<a href="#l2.96"></a><span id="l2.96">                     deltaView = 1;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-chrome-startup.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> Components.utils.import(&quot;resource://gre/modules/iteratorUtils.jsm&quot;);</span>
<a href="#l3.9"></a><span id="l3.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12"> /**</span>
<a href="#l3.13"></a><span id="l3.13">  * Common initialization steps for calendar chrome windows.</span>
<a href="#l3.14"></a><span id="l3.14">  */</span>
<a href="#l3.15"></a><span id="l3.15"> function commonInitCalendar() {</span>
<a href="#l3.16"></a><span id="l3.16">     // Move around toolbarbuttons and whatever is needed in the UI.</span>
<a href="#l3.17"></a><span id="l3.17">     migrateCalendarUI();</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19" class="difflineat">@@ -120,51 +121,51 @@ var calendarWindowPrefs = {</span>
<a href="#l3.20"></a><span id="l3.20">      * Observer function called when a pref has changed</span>
<a href="#l3.21"></a><span id="l3.21">      *</span>
<a href="#l3.22"></a><span id="l3.22">      * @see nsIObserver</span>
<a href="#l3.23"></a><span id="l3.23">      */</span>
<a href="#l3.24"></a><span id="l3.24">     observe: function (aSubject, aTopic, aData) {</span>
<a href="#l3.25"></a><span id="l3.25">         if (aTopic == &quot;nsPref:changed&quot;) {</span>
<a href="#l3.26"></a><span id="l3.26">             switch (aData) {</span>
<a href="#l3.27"></a><span id="l3.27">                 case &quot;calendar.view.useSystemColors&quot;: {</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-                    let attributeValue = cal.getPrefSafe(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+                    let attributeValue = Preferences.get(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l3.30"></a><span id="l3.30">                     for each (let win in fixIterator(Services.ww.getWindowEnumerator())) {</span>
<a href="#l3.31"></a><span id="l3.31">                         setElementValue(win.document.documentElement, attributeValue , &quot;systemcolors&quot;);</span>
<a href="#l3.32"></a><span id="l3.32">                     }</span>
<a href="#l3.33"></a><span id="l3.33">                     break;</span>
<a href="#l3.34"></a><span id="l3.34">                 }</span>
<a href="#l3.35"></a><span id="l3.35">             }</span>
<a href="#l3.36"></a><span id="l3.36">         } else if (aTopic == &quot;domwindowopened&quot;) {</span>
<a href="#l3.37"></a><span id="l3.37">             let win = aSubject.QueryInterface(Components.interfaces.nsIDOMWindow);</span>
<a href="#l3.38"></a><span id="l3.38">             win.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-                let attributeValue = cal.getPrefSafe(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+                let attributeValue = Preferences.get(&quot;calendar.view.useSystemColors&quot;, false) &amp;&amp; &quot;true&quot;;</span>
<a href="#l3.41"></a><span id="l3.41">                 setElementValue(win.document.documentElement, attributeValue , &quot;systemcolors&quot;);</span>
<a href="#l3.42"></a><span id="l3.42">             }, false);</span>
<a href="#l3.43"></a><span id="l3.43">         }</span>
<a href="#l3.44"></a><span id="l3.44">     }</span>
<a href="#l3.45"></a><span id="l3.45"> }</span>
<a href="#l3.46"></a><span id="l3.46"> </span>
<a href="#l3.47"></a><span id="l3.47"> /**</span>
<a href="#l3.48"></a><span id="l3.48">  * Migrate calendar UI. This function is called at each startup and can be used</span>
<a href="#l3.49"></a><span id="l3.49">  * to change UI items that require js code intervention</span>
<a href="#l3.50"></a><span id="l3.50">  */</span>
<a href="#l3.51"></a><span id="l3.51"> function migrateCalendarUI() {</span>
<a href="#l3.52"></a><span id="l3.52">     const UI_VERSION = 1;</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-    let currentUIVersion = cal.getPrefSafe(&quot;calendar.ui.version&quot;);</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+    let currentUIVersion = Preferences.get(&quot;calendar.ui.version&quot;);</span>
<a href="#l3.55"></a><span id="l3.55"> </span>
<a href="#l3.56"></a><span id="l3.56">     if (currentUIVersion &gt;= UI_VERSION) {</span>
<a href="#l3.57"></a><span id="l3.57">         return;</span>
<a href="#l3.58"></a><span id="l3.58">     }</span>
<a href="#l3.59"></a><span id="l3.59"> </span>
<a href="#l3.60"></a><span id="l3.60">     try {</span>
<a href="#l3.61"></a><span id="l3.61">         if (currentUIVersion &lt; 1) {</span>
<a href="#l3.62"></a><span id="l3.62">             let calbar = document.getElementById(&quot;calendar-toolbar2&quot;);</span>
<a href="#l3.63"></a><span id="l3.63">             calbar.insertItem(&quot;calendar-appmenu-button&quot;);</span>
<a href="#l3.64"></a><span id="l3.64">             let taskbar = document.getElementById(&quot;task-toolbar2&quot;);</span>
<a href="#l3.65"></a><span id="l3.65">             taskbar.insertItem(&quot;task-appmenu-button&quot;);</span>
<a href="#l3.66"></a><span id="l3.66">         }</span>
<a href="#l3.67"></a><span id="l3.67"> </span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-        cal.setPref(&quot;calendar.ui.version&quot;, UI_VERSION);</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+        Preferences.set(&quot;calendar.ui.version&quot;, UI_VERSION);</span>
<a href="#l3.70"></a><span id="l3.70">     } catch (e) {</span>
<a href="#l3.71"></a><span id="l3.71">         cal.ERROR(&quot;Error upgrading UI from &quot; + currentUIVersion + &quot; to &quot; +</span>
<a href="#l3.72"></a><span id="l3.72">                   UI_VERSION + &quot;: &quot; + e);</span>
<a href="#l3.73"></a><span id="l3.73">     }</span>
<a href="#l3.74"></a><span id="l3.74"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l4.9"></a><span id="l4.9"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l4.10"></a><span id="l4.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.11"></a><span id="l4.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l4.13"></a><span id="l4.13"> </span>
<a href="#l4.14"></a><span id="l4.14"> var itemConversion = {</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">     /**</span>
<a href="#l4.17"></a><span id="l4.17">      * Converts an email message to a calendar item.</span>
<a href="#l4.18"></a><span id="l4.18">      *</span>
<a href="#l4.19"></a><span id="l4.19">      * @param aItem     The target calIItemBase.</span>
<a href="#l4.20"></a><span id="l4.20">      * @param aMessage  The nsIMsgHdr to convert from.</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -139,28 +140,28 @@ var itemConversion = {</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">         this.copyItemBase(aTask, item);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">         // Dates and alarms</span>
<a href="#l4.26"></a><span id="l4.26">         item.startDate = aTask.entryDate;</span>
<a href="#l4.27"></a><span id="l4.27">         if (!item.startDate) {</span>
<a href="#l4.28"></a><span id="l4.28">             if (aTask.dueDate) {</span>
<a href="#l4.29"></a><span id="l4.29">                 item.startDate = aTask.dueDate.clone();</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-                item.startDate.minute -= getPrefSafe(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+                item.startDate.minute -= Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l4.32"></a><span id="l4.32">             } else {</span>
<a href="#l4.33"></a><span id="l4.33">                 item.startDate = cal.getDefaultStartDate();</span>
<a href="#l4.34"></a><span id="l4.34">             }</span>
<a href="#l4.35"></a><span id="l4.35">         }</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37">         item.endDate = aTask.dueDate;</span>
<a href="#l4.38"></a><span id="l4.38">         if (!item.endDate) {</span>
<a href="#l4.39"></a><span id="l4.39">             // Make the event be the default event length if no due date was</span>
<a href="#l4.40"></a><span id="l4.40">             // specified.</span>
<a href="#l4.41"></a><span id="l4.41">             item.endDate = item.startDate.clone();</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-            item.endDate.minute += getPrefSafe(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+            item.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l4.44"></a><span id="l4.44">         }</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46">         // Alarms</span>
<a href="#l4.47"></a><span id="l4.47">         for each (let alarm in aTask.getAlarms({})) {</span>
<a href="#l4.48"></a><span id="l4.48">             item.addAlarm(alarm.clone());</span>
<a href="#l4.49"></a><span id="l4.49">         }</span>
<a href="#l4.50"></a><span id="l4.50">         item.alarmLastAck = (aTask.alarmLastAck ?</span>
<a href="#l4.51"></a><span id="l4.51">                              aTask.alarmLastAck.clone() :</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-extract.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-extract.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> Components.utils.import(&quot;resource://calendar/modules/calExtract.jsm&quot;);</span>
<a href="#l5.9"></a><span id="l5.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12"> let calendarExtract = {</span>
<a href="#l5.13"></a><span id="l5.13">     onShowLocaleMenu: function onShowLocaleMenu(target) {</span>
<a href="#l5.14"></a><span id="l5.14">         let localeList = document.getElementById(target.id);</span>
<a href="#l5.15"></a><span id="l5.15">         let langs = new Array();</span>
<a href="#l5.16"></a><span id="l5.16">         let chrome = Components.classes[&quot;@mozilla.org/chrome/chrome-registry;1&quot;]</span>
<a href="#l5.17"></a><span id="l5.17">                                .getService(Components.interfaces.nsIXULChromeRegistry);</span>
<a href="#l5.18"></a><span id="l5.18">         chrome.QueryInterface(Components.interfaces.nsIToolkitChromeRegistry);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineat">@@ -28,17 +29,17 @@ let calendarExtract = {</span>
<a href="#l5.20"></a><span id="l5.20">                 label = cal.calGetString(&quot;calendar&quot;, &quot;extractUsingRegion&quot;, [langName, localeParts[3]]);</span>
<a href="#l5.21"></a><span id="l5.21">             }</span>
<a href="#l5.22"></a><span id="l5.22"> </span>
<a href="#l5.23"></a><span id="l5.23">             langs.push([label, localeParts[1]]);</span>
<a href="#l5.24"></a><span id="l5.24">         }</span>
<a href="#l5.25"></a><span id="l5.25"> </span>
<a href="#l5.26"></a><span id="l5.26">         // sort</span>
<a href="#l5.27"></a><span id="l5.27">         let pref = &quot;calendar.patterns.last.used.languages&quot;;</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-        let lastUsedLangs = cal.getPrefSafe(pref, &quot;&quot;);</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+        let lastUsedLangs = Preferences.get(pref, &quot;&quot;);</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31">         function createLanguageComptor(lastUsedLangs) {</span>
<a href="#l5.32"></a><span id="l5.32">             return function compare(a, b) {</span>
<a href="#l5.33"></a><span id="l5.33">                 let idx_a = lastUsedLangs.indexOf(a[1]);</span>
<a href="#l5.34"></a><span id="l5.34">                 let idx_b = lastUsedLangs.indexOf(b[1]);</span>
<a href="#l5.35"></a><span id="l5.35"> </span>
<a href="#l5.36"></a><span id="l5.36">                 if (idx_a == -1 &amp;&amp; idx_b == -1) {</span>
<a href="#l5.37"></a><span id="l5.37">                     return a[0].localeCompare(b[0]);</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineat">@@ -85,19 +86,19 @@ let calendarExtract = {</span>
<a href="#l5.39"></a><span id="l5.39">                                                   32768,</span>
<a href="#l5.40"></a><span id="l5.40">                                                   false,</span>
<a href="#l5.41"></a><span id="l5.41">                                                   true,</span>
<a href="#l5.42"></a><span id="l5.42">                                                   { });</span>
<a href="#l5.43"></a><span id="l5.43">         cal.LOG(&quot;[calExtract] Original email content: \n&quot; + title + &quot;\r\n&quot; + content);</span>
<a href="#l5.44"></a><span id="l5.44">         let date = new Date(message.date/1000);</span>
<a href="#l5.45"></a><span id="l5.45">         let time = (new Date()).getTime();</span>
<a href="#l5.46"></a><span id="l5.46"> </span>
<a href="#l5.47"></a><span id="l5.47" class="difflineminus">-        let locale = cal.getPrefSafe(&quot;general.useragent.locale&quot;, &quot;en-US&quot;);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+        let locale = Preferences.get(&quot;general.useragent.locale&quot;, &quot;en-US&quot;);</span>
<a href="#l5.49"></a><span id="l5.49">         let baseUrl = &quot;jar:resource://calendar/chrome/calendar-LOCALE.jar!/locale/LOCALE/calendar/calendar-extract.properties&quot;;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-        let dayStart = cal.getPrefSafe(&quot;calendar.view.daystarthour&quot;, 6);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+        let dayStart = Preferences.get(&quot;calendar.view.daystarthour&quot;, 6);</span>
<a href="#l5.52"></a><span id="l5.52">         let extractor;</span>
<a href="#l5.53"></a><span id="l5.53"> </span>
<a href="#l5.54"></a><span id="l5.54">         if (fixedLang) {</span>
<a href="#l5.55"></a><span id="l5.55">             extractor = new Extractor(baseUrl, fixedLocale, dayStart);</span>
<a href="#l5.56"></a><span id="l5.56">         } else {</span>
<a href="#l5.57"></a><span id="l5.57">             extractor = new Extractor(baseUrl, locale, dayStart, false);</span>
<a href="#l5.58"></a><span id="l5.58">         }</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60" class="difflineat">@@ -133,17 +134,17 @@ let calendarExtract = {</span>
<a href="#l5.61"></a><span id="l5.61">                 if (guessed.hour != null) {</span>
<a href="#l5.62"></a><span id="l5.62">                     item.startDate.hour = guessed.hour;</span>
<a href="#l5.63"></a><span id="l5.63">                 }</span>
<a href="#l5.64"></a><span id="l5.64">                 if (guessed.minute != null) {</span>
<a href="#l5.65"></a><span id="l5.65">                     item.startDate.minute = guessed.minute;</span>
<a href="#l5.66"></a><span id="l5.66">                 }</span>
<a href="#l5.67"></a><span id="l5.67"> </span>
<a href="#l5.68"></a><span id="l5.68">                 item.endDate = item.startDate.clone();</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-                item.endDate.minute += cal.getPrefSafe(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+                item.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l5.71"></a><span id="l5.71"> </span>
<a href="#l5.72"></a><span id="l5.72">                 if (endGuess.year != null) {</span>
<a href="#l5.73"></a><span id="l5.73">                     item.endDate.year = endGuess.year;</span>
<a href="#l5.74"></a><span id="l5.74">                 }</span>
<a href="#l5.75"></a><span id="l5.75">                 if (endGuess.month != null) {</span>
<a href="#l5.76"></a><span id="l5.76">                     item.endDate.month = endGuess.month - 1;</span>
<a href="#l5.77"></a><span id="l5.77">                 }</span>
<a href="#l5.78"></a><span id="l5.78">                 if (endGuess.day != null) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l6.4"></a><span id="l6.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.5"></a><span id="l6.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.6"></a><span id="l6.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l6.9"></a><span id="l6.9"> Components.utils.import(&quot;resource://calendar/modules/calItipUtils.jsm&quot;);</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12"> /**</span>
<a href="#l6.13"></a><span id="l6.13">  * This object contains functions to take care of manipulating requests.</span>
<a href="#l6.14"></a><span id="l6.14">  */</span>
<a href="#l6.15"></a><span id="l6.15"> var gInvitationsRequestManager = {</span>
<a href="#l6.16"></a><span id="l6.16">     mRequestStatusList: {},</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">     /**</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineat">@@ -83,20 +84,20 @@ InvitationsManager.prototype = {</span>
<a href="#l6.20"></a><span id="l6.20">      * @param operationListener   The calIGenericOperationListener to notify.</span>
<a href="#l6.21"></a><span id="l6.21">      */</span>
<a href="#l6.22"></a><span id="l6.22">     scheduleInvitationsUpdate: function IM_scheduleInvitationsUpdate(firstDelay,</span>
<a href="#l6.23"></a><span id="l6.23">                                                                      operationListener) {</span>
<a href="#l6.24"></a><span id="l6.24">         this.cancelInvitationsUpdate();</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">         var self = this;</span>
<a href="#l6.27"></a><span id="l6.27">         this.mTimer = setTimeout(function startInvitationsTimer() {</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">-            if (getPrefSafe(&quot;calendar.invitations.autorefresh.enabled&quot;, true)) {</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+            if (Preferences.get(&quot;calendar.invitations.autorefresh.enabled&quot;, true)) {</span>
<a href="#l6.30"></a><span id="l6.30">                 self.mTimer = setInterval(function repeatingInvitationsTimer() {</span>
<a href="#l6.31"></a><span id="l6.31">                     self.getInvitations(operationListener);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-                    }, getPrefSafe(&quot;calendar.invitations.autorefresh.timeout&quot;, 3) * 60000);</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+                    }, Preferences.get(&quot;calendar.invitations.autorefresh.timeout&quot;, 3) * 60000);</span>
<a href="#l6.34"></a><span id="l6.34">             }</span>
<a href="#l6.35"></a><span id="l6.35">             self.getInvitations(operationListener);</span>
<a href="#l6.36"></a><span id="l6.36">         }, firstDelay);</span>
<a href="#l6.37"></a><span id="l6.37">     },</span>
<a href="#l6.38"></a><span id="l6.38"> </span>
<a href="#l6.39"></a><span id="l6.39">     /**</span>
<a href="#l6.40"></a><span id="l6.40">      * Cancel pending any pending invitations update.</span>
<a href="#l6.41"></a><span id="l6.41">      */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l7.9"></a><span id="l7.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l7.10"></a><span id="l7.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l7.12"></a><span id="l7.12"> </span>
<a href="#l7.13"></a><span id="l7.13"> /**</span>
<a href="#l7.14"></a><span id="l7.14">  * Takes a job and makes sure the dispose function on it is called. If there is</span>
<a href="#l7.15"></a><span id="l7.15">  * no dispose function or the job is null, ignore it.</span>
<a href="#l7.16"></a><span id="l7.16">  *</span>
<a href="#l7.17"></a><span id="l7.17">  * @param job       The job to dispose.</span>
<a href="#l7.18"></a><span id="l7.18">  */</span>
<a href="#l7.19"></a><span id="l7.19"> function disposeJob(job) {</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineat">@@ -97,17 +98,17 @@ function createEventWithDialog(calendar,</span>
<a href="#l7.21"></a><span id="l7.21">                 event.endDate.isDate = true;</span>
<a href="#l7.22"></a><span id="l7.22">                 event.endDate.timezone = floating();</span>
<a href="#l7.23"></a><span id="l7.23">             }</span>
<a href="#l7.24"></a><span id="l7.24">         } else {</span>
<a href="#l7.25"></a><span id="l7.25">             event.endDate = event.startDate.clone();</span>
<a href="#l7.26"></a><span id="l7.26">             if (!aForceAllday) {</span>
<a href="#l7.27"></a><span id="l7.27">                 // If the event is not all day, then add the default event</span>
<a href="#l7.28"></a><span id="l7.28">                 // length.</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineminus">-                event.endDate.minute += getPrefSafe(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+                event.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l7.31"></a><span id="l7.31">             } else {</span>
<a href="#l7.32"></a><span id="l7.32">                 // All day events need to go to the beginning of the next day.</span>
<a href="#l7.33"></a><span id="l7.33">                 event.endDate.day++;</span>
<a href="#l7.34"></a><span id="l7.34">             }</span>
<a href="#l7.35"></a><span id="l7.35">         }</span>
<a href="#l7.36"></a><span id="l7.36"> </span>
<a href="#l7.37"></a><span id="l7.37">         event.calendar = calendar || getSelectedCalendar();</span>
<a href="#l7.38"></a><span id="l7.38"> </span>
<a href="#l7.39"></a><span id="l7.39" class="difflineat">@@ -160,17 +161,17 @@ function createTodoWithDialog(calendar, </span>
<a href="#l7.40"></a><span id="l7.40">         todo.calendar = calendar || getSelectedCalendar();</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">         if (summary)</span>
<a href="#l7.43"></a><span id="l7.43">             todo.title = summary;</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45">         if (dueDate)</span>
<a href="#l7.46"></a><span id="l7.46">             todo.dueDate = dueDate;</span>
<a href="#l7.47"></a><span id="l7.47"> </span>
<a href="#l7.48"></a><span id="l7.48" class="difflineminus">-        if (cal.getPrefSafe(&quot;calendar.alarms.onfortodos&quot;, 0) == 1 &amp;&amp;</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+        if (Preferences.get(&quot;calendar.alarms.onfortodos&quot;, 0) == 1 &amp;&amp;</span>
<a href="#l7.50"></a><span id="l7.50">             !todo.entryDate) {</span>
<a href="#l7.51"></a><span id="l7.51">             // the todo must have an entry date if we want to set an alarm</span>
<a href="#l7.52"></a><span id="l7.52">             todo.entryDate = initialDate;</span>
<a href="#l7.53"></a><span id="l7.53">         }</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55">         cal.alarms.setDefaultValues(todo);</span>
<a href="#l7.56"></a><span id="l7.56">     }</span>
<a href="#l7.57"></a><span id="l7.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l8.9"></a><span id="l8.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l8.12"></a><span id="l8.12"> </span>
<a href="#l8.13"></a><span id="l8.13"> /**</span>
<a href="#l8.14"></a><span id="l8.14">  * Get this window's currently selected calendar.</span>
<a href="#l8.15"></a><span id="l8.15">  *</span>
<a href="#l8.16"></a><span id="l8.16">  * @return      The currently selected calendar.</span>
<a href="#l8.17"></a><span id="l8.17">  */</span>
<a href="#l8.18"></a><span id="l8.18"> function getSelectedCalendar() {</span>
<a href="#l8.19"></a><span id="l8.19">     return getCompositeCalendar().defaultCalendar;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineat">@@ -66,22 +67,22 @@ function loadCalendarManager() {</span>
<a href="#l8.21"></a><span id="l8.21">  */</span>
<a href="#l8.22"></a><span id="l8.22"> function initHomeCalendar() {</span>
<a href="#l8.23"></a><span id="l8.23">     let calMgr = cal.getCalendarManager();</span>
<a href="#l8.24"></a><span id="l8.24">     let composite = getCompositeCalendar();</span>
<a href="#l8.25"></a><span id="l8.25">     let url = cal.makeURL(&quot;moz-storage-calendar://&quot;);</span>
<a href="#l8.26"></a><span id="l8.26">     let homeCalendar = calMgr.createCalendar(&quot;storage&quot;, url);</span>
<a href="#l8.27"></a><span id="l8.27">     homeCalendar.name = calGetString(&quot;calendar&quot;, &quot;homeCalendarName&quot;);</span>
<a href="#l8.28"></a><span id="l8.28">     calMgr.registerCalendar(homeCalendar);</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-    cal.setPref(&quot;calendar.list.sortOrder&quot;, homeCalendar.id);</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+    Preferences.set(&quot;calendar.list.sortOrder&quot;, homeCalendar.id);</span>
<a href="#l8.31"></a><span id="l8.31">     composite.addCalendar(homeCalendar);</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33">     // Wrapping this in a try/catch block, as if any of the migration code</span>
<a href="#l8.34"></a><span id="l8.34">     // fails, the app may not load.</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-    if (cal.getPrefSafe(&quot;calendar.migrator.enabled&quot;, true)) {</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+    if (Preferences.get(&quot;calendar.migrator.enabled&quot;, true)) {</span>
<a href="#l8.37"></a><span id="l8.37">         try {</span>
<a href="#l8.38"></a><span id="l8.38">             gDataMigrator.checkAndMigrate();</span>
<a href="#l8.39"></a><span id="l8.39">         } catch (e) {</span>
<a href="#l8.40"></a><span id="l8.40">             Components.utils.reportError(&quot;Migrator error: &quot; + e);</span>
<a href="#l8.41"></a><span id="l8.41">         }</span>
<a href="#l8.42"></a><span id="l8.42">     }</span>
<a href="#l8.43"></a><span id="l8.43"> </span>
<a href="#l8.44"></a><span id="l8.44">     return homeCalendar;</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineat">@@ -100,17 +101,17 @@ function unloadCalendarManager() {</span>
<a href="#l8.46"></a><span id="l8.46">  * Updates the sort order preference based on the given event. The event is a</span>
<a href="#l8.47"></a><span id="l8.47">  * &quot;SortOrderChanged&quot; event, emitted from the calendar-list-tree binding. You</span>
<a href="#l8.48"></a><span id="l8.48">  * can also pass in an object like { sortOrder: &quot;Space separated calendar ids&quot; }</span>
<a href="#l8.49"></a><span id="l8.49">  *</span>
<a href="#l8.50"></a><span id="l8.50">  * @param event     The SortOrderChanged event described above.</span>
<a href="#l8.51"></a><span id="l8.51">  */</span>
<a href="#l8.52"></a><span id="l8.52"> function updateSortOrderPref(event) {</span>
<a href="#l8.53"></a><span id="l8.53">     let sortOrderString = event.sortOrder.join(&quot; &quot;);</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-    cal.setPref(&quot;calendar.list.sortOrder&quot;, sortOrderString);</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+    Preferences.set(&quot;calendar.list.sortOrder&quot;, sortOrderString);</span>
<a href="#l8.56"></a><span id="l8.56"> }</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58"> /**</span>
<a href="#l8.59"></a><span id="l8.59">  * Handler function to call when the tooltip is showing on the calendar list.</span>
<a href="#l8.60"></a><span id="l8.60">  *</span>
<a href="#l8.61"></a><span id="l8.61">  * @param event     The DOM event provoked by the tooltip showing.</span>
<a href="#l8.62"></a><span id="l8.62">  */</span>
<a href="#l8.63"></a><span id="l8.63"> function calendarListTooltipShowing(event) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -415,18 +415,20 @@</span>
<a href="#l9.4"></a><span id="l9.4">         &lt;/xul:grid&gt;</span>
<a href="#l9.5"></a><span id="l9.5">       &lt;/xul:vbox&gt;</span>
<a href="#l9.6"></a><span id="l9.6">     &lt;/content&gt;</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">     &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">       &lt;!-- constructor --&gt;</span>
<a href="#l9.11"></a><span id="l9.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+          Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+</span>
<a href="#l9.14"></a><span id="l9.14">           // Set the preference for the default start of the week</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-          this.weekStartOffset = getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+          this.weekStartOffset = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">           for (var i = 0; i &lt; 7; i++) {</span>
<a href="#l9.19"></a><span id="l9.19">               let hdr = createXULElement(&quot;calendar-day-label&quot;);</span>
<a href="#l9.20"></a><span id="l9.20">               this.labeldaybox.appendChild(hdr);</span>
<a href="#l9.21"></a><span id="l9.21">               hdr.weekDay = (i + this.mWeekStartOffset) % 7;</span>
<a href="#l9.22"></a><span id="l9.22">               hdr.shortWeekNames = false;</span>
<a href="#l9.23"></a><span id="l9.23">           }</span>
<a href="#l9.24"></a><span id="l9.24">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineat">@@ -963,18 +965,18 @@</span>
<a href="#l9.26"></a><span id="l9.26">           }</span>
<a href="#l9.27"></a><span id="l9.27">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.28"></a><span id="l9.28">       &lt;/method&gt;</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30">       &lt;method name=&quot;flashAlarm&quot;&gt;</span>
<a href="#l9.31"></a><span id="l9.31">         &lt;parameter name=&quot;aAlarmItem&quot;/&gt;</span>
<a href="#l9.32"></a><span id="l9.32">         &lt;parameter name=&quot;aStop&quot;/&gt;</span>
<a href="#l9.33"></a><span id="l9.33">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineminus">-          var showIndicator = getPrefSafe(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-          var totaltime = getPrefSafe(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+          var showIndicator = Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+          var totaltime = Preferences.get(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l9.38"></a><span id="l9.38"> </span>
<a href="#l9.39"></a><span id="l9.39">           if (!aStop &amp;&amp; (!showIndicator || totaltime &lt; 1)) {</span>
<a href="#l9.40"></a><span id="l9.40">             // No need to animate if the indicator should not be shown.</span>
<a href="#l9.41"></a><span id="l9.41">             return;</span>
<a href="#l9.42"></a><span id="l9.42">           }</span>
<a href="#l9.43"></a><span id="l9.43"> </span>
<a href="#l9.44"></a><span id="l9.44">           // Make sure the flashing attribute is set or reset on all visible</span>
<a href="#l9.45"></a><span id="l9.45">           // boxes.</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineat">@@ -1002,17 +1004,17 @@</span>
<a href="#l9.47"></a><span id="l9.47">           }</span>
<a href="#l9.48"></a><span id="l9.48">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.49"></a><span id="l9.49">       &lt;/method&gt;</span>
<a href="#l9.50"></a><span id="l9.50">     &lt;/implementation&gt;</span>
<a href="#l9.51"></a><span id="l9.51"> </span>
<a href="#l9.52"></a><span id="l9.52">     &lt;handlers&gt;</span>
<a href="#l9.53"></a><span id="l9.53">       &lt;handler event=&quot;wheel&quot;&gt;&lt;![CDATA[</span>
<a href="#l9.54"></a><span id="l9.54">         const pixelThreshold = 150;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineminus">-        let scrollEnabled = getPrefSafe('calendar.view.mousescroll', true);</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+        let scrollEnabled = Preferences.get('calendar.view.mousescroll', true);</span>
<a href="#l9.57"></a><span id="l9.57">         if (!event.ctrlKey &amp;&amp; !event.shiftKey &amp;&amp;</span>
<a href="#l9.58"></a><span id="l9.58">             !event.altKey &amp;&amp; !event.metaKey &amp;&amp; scrollEnabled) {</span>
<a href="#l9.59"></a><span id="l9.59">             // In the month view, the only thing that can be scrolled</span>
<a href="#l9.60"></a><span id="l9.60">             // is the month the user is in. calendar-base-view takes care</span>
<a href="#l9.61"></a><span id="l9.61">             // of the shift key, so only move the view when no modifier</span>
<a href="#l9.62"></a><span id="l9.62">             // is pressed.</span>
<a href="#l9.63"></a><span id="l9.63">             let deltaView = 0;</span>
<a href="#l9.64"></a><span id="l9.64">             if (event.deltaMode == event.DOM_DELTA_LINE) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -2506,37 +2506,39 @@</span>
<a href="#l10.4"></a><span id="l10.4">           &lt;xul:box anonid=&quot;daybox&quot; class=&quot;multiday-view-day-box&quot; flex=&quot;1&quot;</span>
<a href="#l10.5"></a><span id="l10.5">                    equalsize=&quot;always&quot;/&gt;</span>
<a href="#l10.6"></a><span id="l10.6">         &lt;/xul:scrollbox&gt;</span>
<a href="#l10.7"></a><span id="l10.7">       &lt;/xul:box&gt;</span>
<a href="#l10.8"></a><span id="l10.8">     &lt;/content&gt;</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">     &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l10.11"></a><span id="l10.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+</span>
<a href="#l10.14"></a><span id="l10.14">         // get day start/end hour from prefs and set on the view</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-        this.setDayStartEndMinutes(cal.getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8) * 60,</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-                                   cal.getPrefSafe(&quot;calendar.view.dayendhour&quot;, 17) * 60);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+        this.setDayStartEndMinutes(Preferences.get(&quot;calendar.view.daystarthour&quot;, 8) * 60,</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+                                   Preferences.get(&quot;calendar.view.dayendhour&quot;, 17) * 60);</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20">         // initially scroll to the day start hour in the view</span>
<a href="#l10.21"></a><span id="l10.21">         this.scrollToMinute(this.mDayStartMin);</span>
<a href="#l10.22"></a><span id="l10.22"> </span>
<a href="#l10.23"></a><span id="l10.23">         // get visible hours from prefs and set on the view</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-        let visibleMinutes = cal.getPrefSafe(&quot;calendar.view.visiblehours&quot;, 9) * 60;</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+        let visibleMinutes = Preferences.get(&quot;calendar.view.visiblehours&quot;, 9) * 60;</span>
<a href="#l10.26"></a><span id="l10.26">         this.setVisibleMinutes(visibleMinutes);</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">         var self = this;</span>
<a href="#l10.29"></a><span id="l10.29">         // set the flex attribute at the scrollbox-innerbox</span>
<a href="#l10.30"></a><span id="l10.30">         // (this can be removed, after Bug 343555 is fixed)</span>
<a href="#l10.31"></a><span id="l10.31">         let scrollbox = document.getAnonymousElementByAttribute(</span>
<a href="#l10.32"></a><span id="l10.32">                        this, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l10.33"></a><span id="l10.33">         document.getAnonymousElementByAttribute(</span>
<a href="#l10.34"></a><span id="l10.34">             scrollbox, &quot;class&quot;, &quot;box-inherit scrollbox-innerbox&quot;).flex = &quot;1&quot;;</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36">         // set the time interval for the time indicator timer</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">-        this.setTimeIndicatorInterval(getPrefSafe(&quot;calendar.view.timeIndicatorInterval&quot;, 15));</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+        this.setTimeIndicatorInterval(Preferences.get(&quot;calendar.view.timeIndicatorInterval&quot;, 15));</span>
<a href="#l10.39"></a><span id="l10.39">         this.enableTimeIndicator();</span>
<a href="#l10.40"></a><span id="l10.40"> </span>
<a href="#l10.41"></a><span id="l10.41">         this.reorient();</span>
<a href="#l10.42"></a><span id="l10.42">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44">       &lt;property name=&quot;daysInView&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l10.45"></a><span id="l10.45">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l10.46"></a><span id="l10.46">           return this.labeldaybox.childNodes &amp;&amp; this.labeldaybox.childNodes.length;</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineat">@@ -2550,17 +2552,17 @@</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49">       &lt;method name=&quot;setTimeIndicatorInterval&quot;&gt;</span>
<a href="#l10.50"></a><span id="l10.50">         &lt;parameter name=&quot;aPrefInterval&quot;/&gt;</span>
<a href="#l10.51"></a><span id="l10.51">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.52"></a><span id="l10.52">           // If the preference just edited by the user is outside the valid</span>
<a href="#l10.53"></a><span id="l10.53">           // range [0, 1440], we change it into the nearest limit (0 or 1440).</span>
<a href="#l10.54"></a><span id="l10.54">           let newTimeInterval = Math.max(0, Math.min(1440, aPrefInterval));</span>
<a href="#l10.55"></a><span id="l10.55">           if (newTimeInterval != aPrefInterval) {</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-              cal.setPref(&quot;calendar.view.timeIndicatorInterval&quot;, newTimeInterval);</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+              Preferences.set(&quot;calendar.view.timeIndicatorInterval&quot;, newTimeInterval);</span>
<a href="#l10.58"></a><span id="l10.58">           }</span>
<a href="#l10.59"></a><span id="l10.59"> </span>
<a href="#l10.60"></a><span id="l10.60">           if (newTimeInterval != this.mTimeIndicatorInterval) {</span>
<a href="#l10.61"></a><span id="l10.61">               this.mTimeIndicatorInterval = newTimeInterval;</span>
<a href="#l10.62"></a><span id="l10.62">           }</span>
<a href="#l10.63"></a><span id="l10.63">           if (this.mTimeIndicatorInterval == 0) {</span>
<a href="#l10.64"></a><span id="l10.64">               timeIndicator.cancel();</span>
<a href="#l10.65"></a><span id="l10.65">           }</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineat">@@ -2732,18 +2734,18 @@</span>
<a href="#l10.67"></a><span id="l10.67">       &lt;field name=&quot;mTimeIndicatorInterval&quot;&gt;15&lt;/field&gt;</span>
<a href="#l10.68"></a><span id="l10.68">       &lt;field name=&quot;mModeHandler&quot;&gt;null&lt;/field&gt;</span>
<a href="#l10.69"></a><span id="l10.69">       &lt;field name=&quot;mTimeIndicatorMinutes&quot;&gt;0&lt;/field&gt;</span>
<a href="#l10.70"></a><span id="l10.70"> </span>
<a href="#l10.71"></a><span id="l10.71">       &lt;method name=&quot;flashAlarm&quot;&gt;</span>
<a href="#l10.72"></a><span id="l10.72">         &lt;parameter name=&quot;aAlarmItem&quot;/&gt;</span>
<a href="#l10.73"></a><span id="l10.73">         &lt;parameter name=&quot;aStop&quot;/&gt;</span>
<a href="#l10.74"></a><span id="l10.74">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-          var showIndicator = cal.getPrefSafe(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-          var totaltime = cal.getPrefSafe(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+          var showIndicator = Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true);</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+          var totaltime = Preferences.get(&quot;calendar.alarms.indicator.totaltime&quot;, 3600);</span>
<a href="#l10.79"></a><span id="l10.79"> </span>
<a href="#l10.80"></a><span id="l10.80">           if (!aStop &amp;&amp; (!showIndicator || totaltime &lt; 1)) {</span>
<a href="#l10.81"></a><span id="l10.81">             // No need to animate if the indicator should not be shown.</span>
<a href="#l10.82"></a><span id="l10.82">             return;</span>
<a href="#l10.83"></a><span id="l10.83">           }</span>
<a href="#l10.84"></a><span id="l10.84"> </span>
<a href="#l10.85"></a><span id="l10.85">           // Helper function to save some duplicate code</span>
<a href="#l10.86"></a><span id="l10.86">           function setFlashingAttribute(aBox) {</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineat">@@ -3783,34 +3785,34 @@</span>
<a href="#l10.88"></a><span id="l10.88">           }</span>
<a href="#l10.89"></a><span id="l10.89">           return this.mVisibleMinutes;</span>
<a href="#l10.90"></a><span id="l10.90">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.91"></a><span id="l10.91">       &lt;/method&gt;</span>
<a href="#l10.92"></a><span id="l10.92"> </span>
<a href="#l10.93"></a><span id="l10.93">       &lt;method name=&quot;zoomIn&quot;&gt;</span>
<a href="#l10.94"></a><span id="l10.94">         &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l10.95"></a><span id="l10.95">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-          let visibleHours = cal.getPrefSafe(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+          let visibleHours = Preferences.get(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l10.98"></a><span id="l10.98">           visibleHours += (aLevel || 1);</span>
<a href="#l10.99"></a><span id="l10.99"> </span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-          cal.setPref(&quot;calendar.view.visiblehours&quot;, Math.min(visibleHours, 24));</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+          Preferences.set(&quot;calendar.view.visiblehours&quot;, Math.min(visibleHours, 24));</span>
<a href="#l10.102"></a><span id="l10.102">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.103"></a><span id="l10.103">       &lt;/method&gt;</span>
<a href="#l10.104"></a><span id="l10.104">       &lt;method name=&quot;zoomOut&quot;&gt;</span>
<a href="#l10.105"></a><span id="l10.105">         &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l10.106"></a><span id="l10.106">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-          let visibleHours = cal.getPrefSafe(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+          let visibleHours = Preferences.get(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l10.109"></a><span id="l10.109">           visibleHours -= (aLevel || 1);</span>
<a href="#l10.110"></a><span id="l10.110"> </span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-          cal.setPref(&quot;calendar.view.visiblehours&quot;, Math.max(1, visibleHours));</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+          Preferences.set(&quot;calendar.view.visiblehours&quot;, Math.max(1, visibleHours));</span>
<a href="#l10.113"></a><span id="l10.113">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.114"></a><span id="l10.114">       &lt;/method&gt;</span>
<a href="#l10.115"></a><span id="l10.115">       &lt;method name=&quot;zoomReset&quot;&gt;</span>
<a href="#l10.116"></a><span id="l10.116">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-          cal.setPref(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+          Preferences.set(&quot;calendar.view.visiblehours&quot;, 9);</span>
<a href="#l10.119"></a><span id="l10.119">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.120"></a><span id="l10.120">       &lt;/method&gt;</span>
<a href="#l10.121"></a><span id="l10.121">     &lt;/implementation&gt;</span>
<a href="#l10.122"></a><span id="l10.122"> </span>
<a href="#l10.123"></a><span id="l10.123">     &lt;handlers&gt;</span>
<a href="#l10.124"></a><span id="l10.124">       &lt;handler event=&quot;click&quot; button=&quot;2&quot;&gt;&lt;![CDATA[</span>
<a href="#l10.125"></a><span id="l10.125">         this.selectedDateTime = null;</span>
<a href="#l10.126"></a><span id="l10.126">       ]]&gt;&lt;/handler&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12"> /**</span>
<a href="#l11.13"></a><span id="l11.13">  * Helper function for filling the form,</span>
<a href="#l11.14"></a><span id="l11.14">  * Set the value of a property of a XUL element</span>
<a href="#l11.15"></a><span id="l11.15">  *</span>
<a href="#l11.16"></a><span id="l11.16">  * @param aElement      ID of XUL element to set, or the element node itself</span>
<a href="#l11.17"></a><span id="l11.17">  * @param aNewValue     value to set property to ( if undefined no change is made )</span>
<a href="#l11.18"></a><span id="l11.18">  * @param aPropertyName OPTIONAL name of property to set, default is &quot;value&quot;,</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineat">@@ -227,17 +228,17 @@ function removeChildren(aElement) {</span>
<a href="#l11.20"></a><span id="l11.20">  * Sorts a sorted array of calendars by pref |calendar.list.sortOrder|.</span>
<a href="#l11.21"></a><span id="l11.21">  * Repairs that pref if dangling entries exist.</span>
<a href="#l11.22"></a><span id="l11.22">  *</span>
<a href="#l11.23"></a><span id="l11.23">  * @param calendars     An array of calendars to sort.</span>
<a href="#l11.24"></a><span id="l11.24">  */</span>
<a href="#l11.25"></a><span id="l11.25"> function sortCalendarArray(calendars) {</span>
<a href="#l11.26"></a><span id="l11.26">     let ret = calendars.concat([]);</span>
<a href="#l11.27"></a><span id="l11.27">     let sortOrder = {};</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">-    let sortOrderPref = cal.getPrefSafe(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+    let sortOrderPref = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l11.30"></a><span id="l11.30">     for (let i = 0; i &lt; sortOrderPref.length; ++i) {</span>
<a href="#l11.31"></a><span id="l11.31">         sortOrder[sortOrderPref[i]] = i;</span>
<a href="#l11.32"></a><span id="l11.32">     }</span>
<a href="#l11.33"></a><span id="l11.33">     function sortFunc(cal1, cal2) {</span>
<a href="#l11.34"></a><span id="l11.34">         let i1 = sortOrder[cal1.id] || -1;</span>
<a href="#l11.35"></a><span id="l11.35">         let i2 = sortOrder[cal2.id] || -1;</span>
<a href="#l11.36"></a><span id="l11.36">         if (i1 &lt; i2) {</span>
<a href="#l11.37"></a><span id="l11.37">             return -1;</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineat">@@ -245,20 +246,20 @@ function sortCalendarArray(calendars) {</span>
<a href="#l11.39"></a><span id="l11.39">         if (i1 &gt; i2) {</span>
<a href="#l11.40"></a><span id="l11.40">             return 1;</span>
<a href="#l11.41"></a><span id="l11.41">         }</span>
<a href="#l11.42"></a><span id="l11.42">         return 0;</span>
<a href="#l11.43"></a><span id="l11.43">     }</span>
<a href="#l11.44"></a><span id="l11.44">     ret.sort(sortFunc);</span>
<a href="#l11.45"></a><span id="l11.45"> </span>
<a href="#l11.46"></a><span id="l11.46">     // check and repair pref:</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-    let sortOrderString = cal.getPrefSafe(&quot;calendar.list.sortOrder&quot;, &quot;&quot;);</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+    let sortOrderString = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;);</span>
<a href="#l11.49"></a><span id="l11.49">     let wantedOrderString = ret.map(function(c) { return c.id; }).join(&quot; &quot;);</span>
<a href="#l11.50"></a><span id="l11.50">     if (wantedOrderString != sortOrderString) {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-        cal.setPref(&quot;calendar.list.sortOrder&quot;, wantedOrderString);</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+        Preferences.set(&quot;calendar.list.sortOrder&quot;, wantedOrderString);</span>
<a href="#l11.53"></a><span id="l11.53">     }</span>
<a href="#l11.54"></a><span id="l11.54"> </span>
<a href="#l11.55"></a><span id="l11.55">     return ret;</span>
<a href="#l11.56"></a><span id="l11.56"> }</span>
<a href="#l11.57"></a><span id="l11.57"> </span>
<a href="#l11.58"></a><span id="l11.58"> /**</span>
<a href="#l11.59"></a><span id="l11.59"> * Fills up a menu - either a menupopup or a menulist - with menuitems that refer</span>
<a href="#l11.60"></a><span id="l11.60"> * to calendars.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -64,16 +64,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">         &lt;/xul:hbox&gt;</span>
<a href="#l12.5"></a><span id="l12.5">       &lt;/xul:vbox&gt;</span>
<a href="#l12.6"></a><span id="l12.6">     &lt;/content&gt;</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">     &lt;implementation&gt;</span>
<a href="#l12.9"></a><span id="l12.9">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l12.10"></a><span id="l12.10">          Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l12.11"></a><span id="l12.11">          Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+         Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14">          let self = this;</span>
<a href="#l12.15"></a><span id="l12.15">          this.eventNameTextbox.onblur = function onBlur() {</span>
<a href="#l12.16"></a><span id="l12.16">              self.stopEditing(true);</span>
<a href="#l12.17"></a><span id="l12.17">          };</span>
<a href="#l12.18"></a><span id="l12.18">          this.eventNameTextbox.onkeypress = function onKeyPress(event) {</span>
<a href="#l12.19"></a><span id="l12.19">              // save on enter</span>
<a href="#l12.20"></a><span id="l12.20">              if (event.keyCode == 13)</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -163,17 +164,17 @@</span>
<a href="#l12.22"></a><span id="l12.22">           var categoriesArray = item.getCategories({});</span>
<a href="#l12.23"></a><span id="l12.23">           if (categoriesArray.length &gt; 0) {</span>
<a href="#l12.24"></a><span id="l12.24">             var cssClassesArray = categoriesArray.map(formatStringForCSSRule);</span>
<a href="#l12.25"></a><span id="l12.25">             this.setAttribute(&quot;categories&quot;, cssClassesArray.join(&quot; &quot;));</span>
<a href="#l12.26"></a><span id="l12.26">           }</span>
<a href="#l12.27"></a><span id="l12.27"> </span>
<a href="#l12.28"></a><span id="l12.28">           // Add alarm icons as needed.</span>
<a href="#l12.29"></a><span id="l12.29">           let alarms = item.getAlarms({});</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-          if (alarms.length &amp;&amp; getPrefSafe(&quot;calendar.alarms.indicator.show&quot;, true)) {</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineplus">+          if (alarms.length &amp;&amp; Preferences.get(&quot;calendar.alarms.indicator.show&quot;, true)) {</span>
<a href="#l12.32"></a><span id="l12.32">               let iconsBox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;alarm-icons-box&quot;);</span>
<a href="#l12.33"></a><span id="l12.33">               cal.alarms.addReminderImages(iconsBox, alarms);</span>
<a href="#l12.34"></a><span id="l12.34"> </span>
<a href="#l12.35"></a><span id="l12.35">               // Set suppressed status on the icons box</span>
<a href="#l12.36"></a><span id="l12.36">               setElementValue(iconsBox,</span>
<a href="#l12.37"></a><span id="l12.37">                               item.calendar.getProperty(&quot;suppressAlarms&quot;) || false,</span>
<a href="#l12.38"></a><span id="l12.38">                               &quot;suppressed&quot;);</span>
<a href="#l12.39"></a><span id="l12.39">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.5"></a><span id="l13.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.6"></a><span id="l13.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l13.9"></a><span id="l13.9"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l13.10"></a><span id="l13.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l13.11"></a><span id="l13.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l13.13"></a><span id="l13.13"> </span>
<a href="#l13.14"></a><span id="l13.14"> /**</span>
<a href="#l13.15"></a><span id="l13.15">  * Controller for the views</span>
<a href="#l13.16"></a><span id="l13.16">  * @see calIcalendarViewController</span>
<a href="#l13.17"></a><span id="l13.17">  */</span>
<a href="#l13.18"></a><span id="l13.18"> var calendarViewController = {</span>
<a href="#l13.19"></a><span id="l13.19">     QueryInterface: function(aIID) {</span>
<a href="#l13.20"></a><span id="l13.20">         if (!aIID.equals(Components.interfaces.calICalendarViewController) &amp;&amp;</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -537,17 +538,17 @@ var categoryManagement = {</span>
<a href="#l13.22"></a><span id="l13.22">             // We haven't created a rule for this category yet, do so now.</span>
<a href="#l13.23"></a><span id="l13.23">             let sheet = getViewStyleSheet();</span>
<a href="#l13.24"></a><span id="l13.24">             let ruleString = '.category-color-box[categories~=&quot;' + aCatName + '&quot;] {} ';</span>
<a href="#l13.25"></a><span id="l13.25">             let ruleIndex = sheet.insertRule(ruleString, sheet.cssRules.length);</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27">             this.categoryStyleCache[aCatName] = sheet.cssRules[ruleIndex];</span>
<a href="#l13.28"></a><span id="l13.28">         }</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-        let color = cal.getPrefSafe(&quot;calendar.category.color.&quot; + aCatName) || &quot;&quot;;</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+        let color = Preferences.get(&quot;calendar.category.color.&quot; + aCatName) || &quot;&quot;;</span>
<a href="#l13.32"></a><span id="l13.32">         this.categoryStyleCache[aCatName].style.backgroundColor = color;</span>
<a href="#l13.33"></a><span id="l13.33">     }</span>
<a href="#l13.34"></a><span id="l13.34"> };</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36"> /**</span>
<a href="#l13.37"></a><span id="l13.37">  * Handler function to set the selected day in the minimonth to the currently</span>
<a href="#l13.38"></a><span id="l13.38">  * selected day in the current view.</span>
<a href="#l13.39"></a><span id="l13.39">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/calendar-views.xml</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.xml</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -109,57 +109,58 @@</span>
<a href="#l14.4"></a><span id="l14.4">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l14.5"></a><span id="l14.5">             &lt;/method&gt;</span>
<a href="#l14.6"></a><span id="l14.6">         &lt;/implementation&gt;</span>
<a href="#l14.7"></a><span id="l14.7">     &lt;/binding&gt;</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">     &lt;binding id=&quot;calendar-multiweek-view&quot; extends=&quot;chrome://calendar/content/calendar-month-view.xml#calendar-month-base-view&quot;&gt;</span>
<a href="#l14.10"></a><span id="l14.10">         &lt;implementation implements=&quot;calICalendarView&quot;&gt;</span>
<a href="#l14.11"></a><span id="l14.11"> 	        &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-                this.mWeeksInView = cal.getPrefSafe(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+                Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+                this.mWeeksInView = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l14.15"></a><span id="l14.15">             ]]&gt;&lt;/constructor&gt;</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">             &lt;field name=&quot;mWeeksInView&quot;&gt;4&lt;/field&gt;</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19">             &lt;property name=&quot;weeksInView&quot;&gt;</span>
<a href="#l14.20"></a><span id="l14.20">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l14.21"></a><span id="l14.21">                     return this.mWeeksInView;</span>
<a href="#l14.22"></a><span id="l14.22">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l14.23"></a><span id="l14.23">                 &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l14.24"></a><span id="l14.24">                     this.mWeeksInView = val;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-                    cal.setPref(&quot;calendar.weeks.inview&quot;, Number(val));</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+                    Preferences.set(&quot;calendar.weeks.inview&quot;, Number(val));</span>
<a href="#l14.27"></a><span id="l14.27">                     this.refreshView();</span>
<a href="#l14.28"></a><span id="l14.28">                     return val;</span>
<a href="#l14.29"></a><span id="l14.29">                 ]]&gt;&lt;/setter&gt;</span>
<a href="#l14.30"></a><span id="l14.30">             &lt;/property&gt;</span>
<a href="#l14.31"></a><span id="l14.31"> </span>
<a href="#l14.32"></a><span id="l14.32">             &lt;property name=&quot;supportsZoom&quot; readonly=&quot;true&quot;</span>
<a href="#l14.33"></a><span id="l14.33">                       onget=&quot;return true;&quot;/&gt;</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35">             &lt;method name=&quot;zoomIn&quot;&gt;</span>
<a href="#l14.36"></a><span id="l14.36">               &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l14.37"></a><span id="l14.37">               &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-                let visibleWeeks = cal.getPrefSafe(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+                let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l14.40"></a><span id="l14.40">                 visibleWeeks += (aLevel || 1);</span>
<a href="#l14.41"></a><span id="l14.41"> </span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-                cal.setPref(&quot;calendar.weeks.inview&quot;, Math.min(visibleWeeks, 6));</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+                Preferences.set(&quot;calendar.weeks.inview&quot;, Math.min(visibleWeeks, 6));</span>
<a href="#l14.44"></a><span id="l14.44">               ]]&gt;&lt;/body&gt;</span>
<a href="#l14.45"></a><span id="l14.45">             &lt;/method&gt;</span>
<a href="#l14.46"></a><span id="l14.46">             &lt;method name=&quot;zoomOut&quot;&gt;</span>
<a href="#l14.47"></a><span id="l14.47">               &lt;parameter name=&quot;aLevel&quot;/&gt;</span>
<a href="#l14.48"></a><span id="l14.48">               &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-                let visibleWeeks = cal.getPrefSafe(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+                let visibleWeeks = Preferences.get(&quot;calendar.weeks.inview&quot;, 4);</span>
<a href="#l14.51"></a><span id="l14.51">                 visibleWeeks -= (aLevel || 1);</span>
<a href="#l14.52"></a><span id="l14.52"> </span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-                cal.setPref(&quot;calendar.weeks.inview&quot;, Math.max(visibleWeeks, 2));</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+                Preferences.set(&quot;calendar.weeks.inview&quot;, Math.max(visibleWeeks, 2));</span>
<a href="#l14.55"></a><span id="l14.55">               ]]&gt;&lt;/body&gt;</span>
<a href="#l14.56"></a><span id="l14.56">             &lt;/method&gt;</span>
<a href="#l14.57"></a><span id="l14.57">             &lt;method name=&quot;zoomReset&quot;&gt;</span>
<a href="#l14.58"></a><span id="l14.58">               &lt;body&gt;&lt;![CDATA[</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-                cal.setPref(&quot;calendar.view.visiblehours&quot;, 4);</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+                Preferences.set(&quot;calendar.view.visiblehours&quot;, 4);</span>
<a href="#l14.61"></a><span id="l14.61">               ]]&gt;&lt;/body&gt;</span>
<a href="#l14.62"></a><span id="l14.62">             &lt;/method&gt;</span>
<a href="#l14.63"></a><span id="l14.63"> </span>
<a href="#l14.64"></a><span id="l14.64">             &lt;property name=&quot;observerID&quot;&gt;</span>
<a href="#l14.65"></a><span id="l14.65">                 &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l14.66"></a><span id="l14.66">                     return &quot;multiweek-view-observer&quot;;</span>
<a href="#l14.67"></a><span id="l14.67">                 ]]&gt;&lt;/getter&gt;</span>
<a href="#l14.68"></a><span id="l14.68">             &lt;/property&gt;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineat">@@ -175,17 +176,17 @@</span>
<a href="#l14.70"></a><span id="l14.70">                     // without changing the start and end of the view.</span>
<a href="#l14.71"></a><span id="l14.71">                     if (aDate) {</span>
<a href="#l14.72"></a><span id="l14.72">                         aDate = aDate.getInTimezone(this.timezone);</span>
<a href="#l14.73"></a><span id="l14.73">                         // Get the first date that should be shown. This is the</span>
<a href="#l14.74"></a><span id="l14.74">                         // start of the week of the day that we're centering around</span>
<a href="#l14.75"></a><span id="l14.75">                         // adjusted for the day the week starts on and the number</span>
<a href="#l14.76"></a><span id="l14.76">                         // of previous weeks we're supposed to display.</span>
<a href="#l14.77"></a><span id="l14.77">                         let d1 = getWeekInfoService().getStartOfWeek(aDate);</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineminus">-                        d1.day -= (7 * cal.getPrefSafe(&quot;calendar.previousweeks.inview&quot;, 0));</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+                        d1.day -= (7 * Preferences.get(&quot;calendar.previousweeks.inview&quot;, 0));</span>
<a href="#l14.80"></a><span id="l14.80">                         // The last day we're supposed to show</span>
<a href="#l14.81"></a><span id="l14.81">                         let d2 = d1.clone();</span>
<a href="#l14.82"></a><span id="l14.82">                         d2.day += ((7 * this.mWeeksInView) - 1);</span>
<a href="#l14.83"></a><span id="l14.83">                         this.setDateRange(d1, d2);</span>
<a href="#l14.84"></a><span id="l14.84">                         this.selectedDay = aDate;</span>
<a href="#l14.85"></a><span id="l14.85">                     } else {</span>
<a href="#l14.86"></a><span id="l14.86">                         this.refresh();</span>
<a href="#l14.87"></a><span id="l14.87">                     }</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineat">@@ -198,17 +199,17 @@</span>
<a href="#l14.89"></a><span id="l14.89">                         let date = now();</span>
<a href="#l14.90"></a><span id="l14.90">                         this.goToDay(date);</span>
<a href="#l14.91"></a><span id="l14.91">                         this.selectedDay = date;</span>
<a href="#l14.92"></a><span id="l14.92">                     } else {</span>
<a href="#l14.93"></a><span id="l14.93">                         let d1 = this.startDay.clone();</span>
<a href="#l14.94"></a><span id="l14.94">                         let savedSelectedDay = this.selectedDay.clone();</span>
<a href="#l14.95"></a><span id="l14.95">                         // aNumber only corresponds to the number of weeks to move</span>
<a href="#l14.96"></a><span id="l14.96">                         // make sure to compensate for previous weeks in view too</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineminus">-                        d1.day += 7 * (aNumber + cal.getPrefSafe(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+                        d1.day += 7 * (aNumber + Preferences.get(&quot;calendar.previousweeks.inview&quot;, 4));</span>
<a href="#l14.99"></a><span id="l14.99">                         this.goToDay(d1);</span>
<a href="#l14.100"></a><span id="l14.100">                         savedSelectedDay.day += 7 * aNumber;</span>
<a href="#l14.101"></a><span id="l14.101">                         this.selectedDay = savedSelectedDay;</span>
<a href="#l14.102"></a><span id="l14.102">                     }</span>
<a href="#l14.103"></a><span id="l14.103">                 ]]&gt;&lt;/body&gt;</span>
<a href="#l14.104"></a><span id="l14.104">             &lt;/method&gt;</span>
<a href="#l14.105"></a><span id="l14.105">         &lt;/implementation&gt;</span>
<a href="#l14.106"></a><span id="l14.106">     &lt;/binding&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.5"></a><span id="l15.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.6"></a><span id="l15.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l15.9"></a><span id="l15.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12"> /**</span>
<a href="#l15.13"></a><span id="l15.13">  * Helper function to get the alarm service and cache it.</span>
<a href="#l15.14"></a><span id="l15.14">  *</span>
<a href="#l15.15"></a><span id="l15.15">  * @return The alarm service component</span>
<a href="#l15.16"></a><span id="l15.16">  */</span>
<a href="#l15.17"></a><span id="l15.17"> function getAlarmService() {</span>
<a href="#l15.18"></a><span id="l15.18">     if (!(&quot;mAlarmService&quot; in window)) {</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineat">@@ -108,17 +109,17 @@ function setupWindow() {</span>
<a href="#l15.20"></a><span id="l15.20"> function finishWindow() {</span>
<a href="#l15.21"></a><span id="l15.21">     let alarmRichlist = document.getElementById(&quot;alarm-richlist&quot;);</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23">     if (alarmRichlist.childNodes.length &gt; 0) {</span>
<a href="#l15.24"></a><span id="l15.24">         // If there are still items, the window wasn't closed using dismiss</span>
<a href="#l15.25"></a><span id="l15.25">         // all/snooze all. This can happen when the closer is clicked or escape</span>
<a href="#l15.26"></a><span id="l15.26">         // is pressed. Snooze all remaining items using the default snooze</span>
<a href="#l15.27"></a><span id="l15.27">         // property.</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-        let snoozePref = getPrefSafe(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+        let snoozePref = Preferences.get(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l15.30"></a><span id="l15.30">         if (snoozePref &lt;= 0) {</span>
<a href="#l15.31"></a><span id="l15.31">             snoozePref = 5;</span>
<a href="#l15.32"></a><span id="l15.32">         }</span>
<a href="#l15.33"></a><span id="l15.33">         snoozeAllItems(snoozePref);</span>
<a href="#l15.34"></a><span id="l15.34">     }</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36">     // Stop updating the relative time</span>
<a href="#l15.37"></a><span id="l15.37">     clearTimeout(gRelativeDateUpdateTimer);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l16.4"></a><span id="l16.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.5"></a><span id="l16.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.6"></a><span id="l16.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> var gStartDate = null;</span>
<a href="#l16.12"></a><span id="l16.12"> var gEndDate = null;</span>
<a href="#l16.13"></a><span id="l16.13"> var gStartTimezone = null;</span>
<a href="#l16.14"></a><span id="l16.14"> var gEndTimezone = null;</span>
<a href="#l16.15"></a><span id="l16.15"> var gDuration = null;</span>
<a href="#l16.16"></a><span id="l16.16"> var gStartHour = 0;</span>
<a href="#l16.17"></a><span id="l16.17"> var gEndHour = 24;</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineat">@@ -817,18 +818,18 @@ function setForce24Hours(aValue) {</span>
<a href="#l16.19"></a><span id="l16.19">  * Initialize the time range, setting the start and end hours from the prefs, or</span>
<a href="#l16.20"></a><span id="l16.20">  * to 24 hrs if gForce24Hours is set.</span>
<a href="#l16.21"></a><span id="l16.21">  */</span>
<a href="#l16.22"></a><span id="l16.22"> function initTimeRange() {</span>
<a href="#l16.23"></a><span id="l16.23">     if (gForce24Hours) {</span>
<a href="#l16.24"></a><span id="l16.24">         gStartHour = 0;</span>
<a href="#l16.25"></a><span id="l16.25">         gEndHour = 24;</span>
<a href="#l16.26"></a><span id="l16.26">     } else {</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineminus">-        gStartHour = getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineminus">-        gEndHour = getPrefSafe(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+        gStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+        gEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l16.31"></a><span id="l16.31">     }</span>
<a href="#l16.32"></a><span id="l16.32"> }</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34"> /**</span>
<a href="#l16.35"></a><span id="l16.35">  * Handler function for the &quot;modify&quot; event, emitted from the attendees-list</span>
<a href="#l16.36"></a><span id="l16.36">  * binding. event.details is an array of objects containing the user's email</span>
<a href="#l16.37"></a><span id="l16.37">  * (calid) and a flag that tells if the user has entered text before the last</span>
<a href="#l16.38"></a><span id="l16.38">  * onModify was called (dirty).</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -1311,16 +1311,18 @@</span>
<a href="#l17.4"></a><span id="l17.4">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l17.5"></a><span id="l17.5">           this.mRatio = val;</span>
<a href="#l17.6"></a><span id="l17.6">           this.update();</span>
<a href="#l17.7"></a><span id="l17.7">           return val;</span>
<a href="#l17.8"></a><span id="l17.8">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l17.9"></a><span id="l17.9">       &lt;/property&gt;</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+</span>
<a href="#l17.14"></a><span id="l17.14">         this.initTimeRange();</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16">         // The basedate is the date/time from which the display</span>
<a href="#l17.17"></a><span id="l17.17">         // of the timebar starts. The range is the number of days</span>
<a href="#l17.18"></a><span id="l17.18">         // we should be able to show. the start- and enddate</span>
<a href="#l17.19"></a><span id="l17.19">         // is the time the event is scheduled for.</span>
<a href="#l17.20"></a><span id="l17.20">         this.mRange = Number(this.getAttribute(&quot;range&quot;));</span>
<a href="#l17.21"></a><span id="l17.21">         this.mSelectionbar =</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -1501,18 +1503,18 @@</span>
<a href="#l17.23"></a><span id="l17.23">       &lt;/method&gt;</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l17.26"></a><span id="l17.26">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l17.27"></a><span id="l17.27">           if (this.force24Hours) {</span>
<a href="#l17.28"></a><span id="l17.28">               this.mStartHour = 0;</span>
<a href="#l17.29"></a><span id="l17.29">               this.mEndHour = 24;</span>
<a href="#l17.30"></a><span id="l17.30">           } else {</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-              this.mStartHour = getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-              this.mEndHour = getPrefSafe(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+              this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+              this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l17.35"></a><span id="l17.35">           }</span>
<a href="#l17.36"></a><span id="l17.36">         ]]&gt;&lt;/body&gt;</span>
<a href="#l17.37"></a><span id="l17.37">       &lt;/method&gt;</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39">       &lt;method name=&quot;moveTime&quot;&gt;</span>
<a href="#l17.40"></a><span id="l17.40">         &lt;parameter name=&quot;time&quot;/&gt;</span>
<a href="#l17.41"></a><span id="l17.41">         &lt;parameter name=&quot;delta&quot;/&gt;</span>
<a href="#l17.42"></a><span id="l17.42">         &lt;parameter name=&quot;doclip&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -103,27 +103,29 @@</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">           let hours = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;hours&quot;);</span>
<a href="#l18.6"></a><span id="l18.6">           removeChildren(hours);</span>
<a href="#l18.7"></a><span id="l18.7">           return val;</span>
<a href="#l18.8"></a><span id="l18.8">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l18.9"></a><span id="l18.9">       &lt;/property&gt;</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+</span>
<a href="#l18.14"></a><span id="l18.14">         this.initTimeRange();</span>
<a href="#l18.15"></a><span id="l18.15">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l18.18"></a><span id="l18.18">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l18.19"></a><span id="l18.19">           if (this.force24Hours) {</span>
<a href="#l18.20"></a><span id="l18.20">               this.mStartHour = 0;</span>
<a href="#l18.21"></a><span id="l18.21">               this.mEndHour = 24;</span>
<a href="#l18.22"></a><span id="l18.22">           } else {</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-              this.mStartHour = getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-              this.mEndHour = getPrefSafe(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+              this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+              this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.27"></a><span id="l18.27">           }</span>
<a href="#l18.28"></a><span id="l18.28">         ]]&gt;&lt;/body&gt;</span>
<a href="#l18.29"></a><span id="l18.29">       &lt;/method&gt;</span>
<a href="#l18.30"></a><span id="l18.30"> </span>
<a href="#l18.31"></a><span id="l18.31">       &lt;property name=&quot;startDate&quot;&gt;</span>
<a href="#l18.32"></a><span id="l18.32">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l18.33"></a><span id="l18.33">           this.mStartDate = val.clone();</span>
<a href="#l18.34"></a><span id="l18.34">           this.mStartDate.minute = 0;</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineat">@@ -404,16 +406,18 @@</span>
<a href="#l18.36"></a><span id="l18.36">           return val;</span>
<a href="#l18.37"></a><span id="l18.37">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l18.38"></a><span id="l18.38">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l18.39"></a><span id="l18.39">           return this.mScrollOffset;</span>
<a href="#l18.40"></a><span id="l18.40">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l18.41"></a><span id="l18.41">       &lt;/property&gt;</span>
<a href="#l18.42"></a><span id="l18.42"> </span>
<a href="#l18.43"></a><span id="l18.43">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+</span>
<a href="#l18.46"></a><span id="l18.46">         var args = window.arguments[0];</span>
<a href="#l18.47"></a><span id="l18.47">         var startTime = args.startTime;</span>
<a href="#l18.48"></a><span id="l18.48">         var endTime = args.endTime;</span>
<a href="#l18.49"></a><span id="l18.49"> </span>
<a href="#l18.50"></a><span id="l18.50">         this.initTimeRange();</span>
<a href="#l18.51"></a><span id="l18.51"> </span>
<a href="#l18.52"></a><span id="l18.52">         // The basedate is the date/time from which the display</span>
<a href="#l18.53"></a><span id="l18.53">         // of the timebar starts. The range is the number of days</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineat">@@ -514,18 +518,18 @@</span>
<a href="#l18.55"></a><span id="l18.55">       &lt;/method&gt;</span>
<a href="#l18.56"></a><span id="l18.56"> </span>
<a href="#l18.57"></a><span id="l18.57">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l18.58"></a><span id="l18.58">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l18.59"></a><span id="l18.59">           if (this.force24Hours) {</span>
<a href="#l18.60"></a><span id="l18.60">               this.mStartHour = 0;</span>
<a href="#l18.61"></a><span id="l18.61">               this.mEndHour = 24;</span>
<a href="#l18.62"></a><span id="l18.62">           } else {</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-              this.mStartHour = getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-              this.mEndHour = getPrefSafe(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineplus">+              this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineplus">+              this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.67"></a><span id="l18.67">           }</span>
<a href="#l18.68"></a><span id="l18.68">         ]]&gt;&lt;/body&gt;</span>
<a href="#l18.69"></a><span id="l18.69">       &lt;/method&gt;</span>
<a href="#l18.70"></a><span id="l18.70">     &lt;/implementation&gt;</span>
<a href="#l18.71"></a><span id="l18.71">   &lt;/binding&gt;</span>
<a href="#l18.72"></a><span id="l18.72"> </span>
<a href="#l18.73"></a><span id="l18.73">   &lt;!--</span>
<a href="#l18.74"></a><span id="l18.74">   ########################################################################</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineat">@@ -670,16 +674,18 @@</span>
<a href="#l18.76"></a><span id="l18.76">               document.getAnonymousElementByAttribute(</span>
<a href="#l18.77"></a><span id="l18.77">                   this, &quot;anonid&quot;, &quot;container&quot;);</span>
<a href="#l18.78"></a><span id="l18.78">           container.x = offset;</span>
<a href="#l18.79"></a><span id="l18.79">           return val;</span>
<a href="#l18.80"></a><span id="l18.80">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l18.81"></a><span id="l18.81">       &lt;/property&gt;</span>
<a href="#l18.82"></a><span id="l18.82"> </span>
<a href="#l18.83"></a><span id="l18.83">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineplus">+</span>
<a href="#l18.86"></a><span id="l18.86">         this.initTimeRange();</span>
<a href="#l18.87"></a><span id="l18.87">         this.mRange = Number(this.getAttribute(&quot;range&quot;));</span>
<a href="#l18.88"></a><span id="l18.88">         this.onLoad();</span>
<a href="#l18.89"></a><span id="l18.89">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l18.90"></a><span id="l18.90"> </span>
<a href="#l18.91"></a><span id="l18.91">       &lt;method name=&quot;onLoad&quot;&gt;</span>
<a href="#l18.92"></a><span id="l18.92">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l18.93"></a><span id="l18.93">           let numHours = this.mEndHour - this.mStartHour;</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineat">@@ -950,18 +956,18 @@</span>
<a href="#l18.95"></a><span id="l18.95">       &lt;/method&gt;</span>
<a href="#l18.96"></a><span id="l18.96"> </span>
<a href="#l18.97"></a><span id="l18.97">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l18.98"></a><span id="l18.98">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l18.99"></a><span id="l18.99">           if (this.force24Hours) {</span>
<a href="#l18.100"></a><span id="l18.100">               this.mStartHour = 0;</span>
<a href="#l18.101"></a><span id="l18.101">               this.mEndHour = 24;</span>
<a href="#l18.102"></a><span id="l18.102">           } else {</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineminus">-              this.mStartHour = getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineminus">-              this.mEndHour = getPrefSafe(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineplus">+              this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineplus">+              this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.107"></a><span id="l18.107">           }</span>
<a href="#l18.108"></a><span id="l18.108">         ]]&gt;&lt;/body&gt;</span>
<a href="#l18.109"></a><span id="l18.109">       &lt;/method&gt;</span>
<a href="#l18.110"></a><span id="l18.110">     &lt;/implementation&gt;</span>
<a href="#l18.111"></a><span id="l18.111">   &lt;/binding&gt;</span>
<a href="#l18.112"></a><span id="l18.112"> </span>
<a href="#l18.113"></a><span id="l18.113">   &lt;!-- ############################################################################# --&gt;</span>
<a href="#l18.114"></a><span id="l18.114">   &lt;!-- 'freebusy-grid'-binding                                                       --&gt;</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineat">@@ -1061,16 +1067,18 @@</span>
<a href="#l18.116"></a><span id="l18.116">                   this, &quot;anonid&quot;, &quot;listbox&quot;);</span>
<a href="#l18.117"></a><span id="l18.117">           var rowcount = listbox.getRowCount();</span>
<a href="#l18.118"></a><span id="l18.118">           listbox.scrollToIndex(Math.floor(rowcount * val));</span>
<a href="#l18.119"></a><span id="l18.119">           return val;</span>
<a href="#l18.120"></a><span id="l18.120">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l18.121"></a><span id="l18.121">       &lt;/property&gt;</span>
<a href="#l18.122"></a><span id="l18.122"> </span>
<a href="#l18.123"></a><span id="l18.123">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineplus">+</span>
<a href="#l18.126"></a><span id="l18.126">         var args = window.arguments[0];</span>
<a href="#l18.127"></a><span id="l18.127"> </span>
<a href="#l18.128"></a><span id="l18.128">         this.initTimeRange();</span>
<a href="#l18.129"></a><span id="l18.129"> </span>
<a href="#l18.130"></a><span id="l18.130">         this.mRange = Number(this.getAttribute(&quot;range&quot;));</span>
<a href="#l18.131"></a><span id="l18.131"> </span>
<a href="#l18.132"></a><span id="l18.132">         this.mMaxFreeBusy = 0;</span>
<a href="#l18.133"></a><span id="l18.133">         this.mPendingRequests = [];</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineat">@@ -1591,16 +1599,16 @@</span>
<a href="#l18.135"></a><span id="l18.135">       &lt;/property&gt;</span>
<a href="#l18.136"></a><span id="l18.136"> </span>
<a href="#l18.137"></a><span id="l18.137">       &lt;method name=&quot;initTimeRange&quot;&gt;</span>
<a href="#l18.138"></a><span id="l18.138">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l18.139"></a><span id="l18.139">           if (this.force24Hours) {</span>
<a href="#l18.140"></a><span id="l18.140">               this.mStartHour = 0;</span>
<a href="#l18.141"></a><span id="l18.141">               this.mEndHour = 24;</span>
<a href="#l18.142"></a><span id="l18.142">           } else {</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineminus">-              this.mStartHour = getPrefSafe(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineminus">-              this.mEndHour = getPrefSafe(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineplus">+              this.mStartHour = Preferences.get(&quot;calendar.view.daystarthour&quot;, 8);</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineplus">+              this.mEndHour = Preferences.get(&quot;calendar.view.dayendhour&quot;, 19);</span>
<a href="#l18.147"></a><span id="l18.147">           }</span>
<a href="#l18.148"></a><span id="l18.148">         ]]&gt;&lt;/body&gt;</span>
<a href="#l18.149"></a><span id="l18.149">       &lt;/method&gt;</span>
<a href="#l18.150"></a><span id="l18.150">     &lt;/implementation&gt;</span>
<a href="#l18.151"></a><span id="l18.151">   &lt;/binding&gt;</span>
<a href="#l18.152"></a><span id="l18.152"> &lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l19.4"></a><span id="l19.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.5"></a><span id="l19.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l19.6"></a><span id="l19.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l19.9"></a><span id="l19.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l19.10"></a><span id="l19.10"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l19.12"></a><span id="l19.12"> </span>
<a href="#l19.13"></a><span id="l19.13"> let allowedActionsMap = {}; </span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15"> /**</span>
<a href="#l19.16"></a><span id="l19.16">  * Sets up the reminder dialog.</span>
<a href="#l19.17"></a><span id="l19.17">  */</span>
<a href="#l19.18"></a><span id="l19.18"> function onLoad() {</span>
<a href="#l19.19"></a><span id="l19.19">     let calendar = window.arguments[0].calendar;</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineat">@@ -357,17 +358,17 @@ function getItemBundleStringName(aPrefix</span>
<a href="#l19.21"></a><span id="l19.21">  * Handler function to be called when the &quot;new&quot; button is pressed, to create a</span>
<a href="#l19.22"></a><span id="l19.22">  * new reminder item.</span>
<a href="#l19.23"></a><span id="l19.23">  */</span>
<a href="#l19.24"></a><span id="l19.24"> function onNewReminder() {</span>
<a href="#l19.25"></a><span id="l19.25">     let itemType = (isEvent(window.arguments[0].item) ? &quot;event&quot; : &quot;todo&quot;);</span>
<a href="#l19.26"></a><span id="l19.26">     let listbox = document.getElementById(&quot;reminder-listbox&quot;);</span>
<a href="#l19.27"></a><span id="l19.27"> </span>
<a href="#l19.28"></a><span id="l19.28">     let reminder = cal.createAlarm();</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">-    let alarmlen = getPrefSafe(&quot;calendar.alarms.&quot; + itemType + &quot;alarmlen&quot;, 15);</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineplus">+    let alarmlen = Preferences.get(&quot;calendar.alarms.&quot; + itemType + &quot;alarmlen&quot;, 15);</span>
<a href="#l19.31"></a><span id="l19.31"> </span>
<a href="#l19.32"></a><span id="l19.32">     // Default is a relative DISPLAY alarm, |alarmlen| minutes before the event.</span>
<a href="#l19.33"></a><span id="l19.33">     // If DISPLAY is not supported by the provider, then pick the provider's</span>
<a href="#l19.34"></a><span id="l19.34">     // first alarm type.</span>
<a href="#l19.35"></a><span id="l19.35">     let offset = cal.createDuration();</span>
<a href="#l19.36"></a><span id="l19.36">     offset.minutes = alarmlen;</span>
<a href="#l19.37"></a><span id="l19.37">     offset.normalize();</span>
<a href="#l19.38"></a><span id="l19.38">     offset.isNegative = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l20.4"></a><span id="l20.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.5"></a><span id="l20.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.6"></a><span id="l20.6"> </span>
<a href="#l20.7"></a><span id="l20.7"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l20.8"></a><span id="l20.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l20.9"></a><span id="l20.9"> Components.utils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l20.10"></a><span id="l20.10"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l20.11"></a><span id="l20.11"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l20.13"></a><span id="l20.13"> </span>
<a href="#l20.14"></a><span id="l20.14"> try {</span>
<a href="#l20.15"></a><span id="l20.15">     Components.utils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l20.16"></a><span id="l20.16"> } catch (e) {</span>
<a href="#l20.17"></a><span id="l20.17">     // This will fail on Seamonkey, but thats ok since the pref for cloudfiles</span>
<a href="#l20.18"></a><span id="l20.18">     // is false, which means the UI will not be shown</span>
<a href="#l20.19"></a><span id="l20.19"> }</span>
<a href="#l20.20"></a><span id="l20.20"> </span>
<a href="#l20.21"></a><span id="l20.21" class="difflineat">@@ -443,17 +444,17 @@ function loadDialog(item) {</span>
<a href="#l20.22"></a><span id="l20.22">         notifyCheckbox.checked = true;</span>
<a href="#l20.23"></a><span id="l20.23">         // hide undisclosure control as this a client only feature</span>
<a href="#l20.24"></a><span id="l20.24">         undiscloseCheckbox.disabled = true;</span>
<a href="#l20.25"></a><span id="l20.25">         document.getElementById(&quot;event-grid-attendee-row-3&quot;).collapsed = true;</span>
<a href="#l20.26"></a><span id="l20.26">     } else {</span>
<a href="#l20.27"></a><span id="l20.27">         let itemProp = item.getProperty(&quot;X-MOZ-SEND-INVITATIONS&quot;);</span>
<a href="#l20.28"></a><span id="l20.28">         notifyCheckbox.checked = (item.calendar.getProperty(&quot;imip.identity&quot;) &amp;&amp;</span>
<a href="#l20.29"></a><span id="l20.29">                                   ((itemProp === null)</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-                                   ? getPrefSafe(&quot;calendar.itip.notify&quot;, true)</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+                                   ? Preferences.get(&quot;calendar.itip.notify&quot;, true)</span>
<a href="#l20.32"></a><span id="l20.32">                                    : (itemProp == &quot;TRUE&quot;)));</span>
<a href="#l20.33"></a><span id="l20.33">         let undiscloseProp = item.getProperty(&quot;X-MOZ-SEND-INVITATIONS-UNDISCLOSED&quot;);</span>
<a href="#l20.34"></a><span id="l20.34">         undiscloseCheckbox.checked = (undiscloseProp === null)</span>
<a href="#l20.35"></a><span id="l20.35">                                      ? false // default value as most common within organizations</span>
<a href="#l20.36"></a><span id="l20.36">                                      : (undiscloseProp == &quot;TRUE&quot;);</span>
<a href="#l20.37"></a><span id="l20.37">         // disable checkbox, if notifyCheckbox is not checked</span>
<a href="#l20.38"></a><span id="l20.38">         undiscloseCheckbox.disabled = (notifyCheckbox.checked == false);</span>
<a href="#l20.39"></a><span id="l20.39">     }</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineat">@@ -1284,17 +1285,17 @@ function onUpdateAllDay() {</span>
<a href="#l20.41"></a><span id="l20.41">     } else {</span>
<a href="#l20.42"></a><span id="l20.42">         gStartTime.isDate = false;</span>
<a href="#l20.43"></a><span id="l20.43">         gEndTime.isDate = false;</span>
<a href="#l20.44"></a><span id="l20.44">         if (!gOldStartTime &amp;&amp; !gOldEndTime) {</span>
<a href="#l20.45"></a><span id="l20.45">             // The checkbox has been unchecked for the first time, the event</span>
<a href="#l20.46"></a><span id="l20.46">             // was an &quot;All day&quot; type, so we have to set default values.</span>
<a href="#l20.47"></a><span id="l20.47">             gStartTime.hour = getDefaultStartDate(window.initialStartDateValue).hour;</span>
<a href="#l20.48"></a><span id="l20.48">             gEndTime.hour = gStartTime.hour;</span>
<a href="#l20.49"></a><span id="l20.49" class="difflineminus">-            gEndTime.minute += getPrefSafe(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineplus">+            gEndTime.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l20.51"></a><span id="l20.51">             gOldStartTimezone = kDefaultTimezone;</span>
<a href="#l20.52"></a><span id="l20.52">             gOldEndTimezone = kDefaultTimezone;</span>
<a href="#l20.53"></a><span id="l20.53">         } else {</span>
<a href="#l20.54"></a><span id="l20.54">             // Restore date-times previously stored.</span>
<a href="#l20.55"></a><span id="l20.55">             gStartTime.hour = gOldStartTime.hour;</span>
<a href="#l20.56"></a><span id="l20.56">             gStartTime.minute = gOldStartTime.minute;</span>
<a href="#l20.57"></a><span id="l20.57">             gEndTime.hour = gOldEndTime.hour;</span>
<a href="#l20.58"></a><span id="l20.58">             gEndTime.minute = gOldEndTime.minute;</span>
<a href="#l20.59"></a><span id="l20.59" class="difflineat">@@ -1388,17 +1389,17 @@ function openNewCardDialog() {</span>
<a href="#l20.60"></a><span id="l20.60"> </span>
<a href="#l20.61"></a><span id="l20.61"> /**</span>
<a href="#l20.62"></a><span id="l20.62">  * Update the transparency status of this dialog, depending on if the event</span>
<a href="#l20.63"></a><span id="l20.63">  * is all-day or not.</span>
<a href="#l20.64"></a><span id="l20.64">  *</span>
<a href="#l20.65"></a><span id="l20.65">  * @param allDay    If true, the event is all-day</span>
<a href="#l20.66"></a><span id="l20.66">  */</span>
<a href="#l20.67"></a><span id="l20.67"> function setShowTimeAs(allDay) {</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-    gShowTimeAs = (allDay ? getPrefSafe(&quot;calendar.allday.defaultTransparency&quot;, &quot;TRANSPARENT&quot;) : &quot;OPAQUE&quot;);</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineplus">+    gShowTimeAs = (allDay ? Preferences.get(&quot;calendar.allday.defaultTransparency&quot;, &quot;TRANSPARENT&quot;) : &quot;OPAQUE&quot;);</span>
<a href="#l20.70"></a><span id="l20.70">     updateShowTimeAs();</span>
<a href="#l20.71"></a><span id="l20.71"> }</span>
<a href="#l20.72"></a><span id="l20.72"> </span>
<a href="#l20.73"></a><span id="l20.73"> function editAttendees() {</span>
<a href="#l20.74"></a><span id="l20.74">     let savedWindow = window;</span>
<a href="#l20.75"></a><span id="l20.75">     let calendar = getCurrentCalendar();</span>
<a href="#l20.76"></a><span id="l20.76"> </span>
<a href="#l20.77"></a><span id="l20.77">     var callback = function(attendees, organizer, startTime, endTime) {</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineat">@@ -1810,17 +1811,17 @@ function updateShowTimeAs() {</span>
<a href="#l20.79"></a><span id="l20.79"> function toggleTimezoneLinks() {</span>
<a href="#l20.80"></a><span id="l20.80">     let cmdTimezone = document.getElementById('cmd_timezone');</span>
<a href="#l20.81"></a><span id="l20.81">     let isChecked = cmdTimezone.getAttribute(&quot;checked&quot;) == &quot;true&quot;;</span>
<a href="#l20.82"></a><span id="l20.82">     cmdTimezone.setAttribute(&quot;checked&quot;, isChecked ? &quot;false&quot; : &quot;true&quot;);</span>
<a href="#l20.83"></a><span id="l20.83">     updateDateTime();</span>
<a href="#l20.84"></a><span id="l20.84"> }</span>
<a href="#l20.85"></a><span id="l20.85"> </span>
<a href="#l20.86"></a><span id="l20.86"> function loadCloudProviders() {</span>
<a href="#l20.87"></a><span id="l20.87" class="difflineminus">-    let cloudFileEnabled = cal.getPrefSafe(&quot;mail.cloud_files.enabled&quot;, false)</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineplus">+    let cloudFileEnabled = Preferences.get(&quot;mail.cloud_files.enabled&quot;, false)</span>
<a href="#l20.89"></a><span id="l20.89">     let cmd = document.getElementById(&quot;cmd_attach_cloud&quot;);</span>
<a href="#l20.90"></a><span id="l20.90"> </span>
<a href="#l20.91"></a><span id="l20.91">     if (!cloudFileEnabled) {</span>
<a href="#l20.92"></a><span id="l20.92">         // If cloud file support is disabled, just hide the attach item</span>
<a href="#l20.93"></a><span id="l20.93">         cmd.hidden = true;</span>
<a href="#l20.94"></a><span id="l20.94">         return;</span>
<a href="#l20.95"></a><span id="l20.95">     }</span>
<a href="#l20.96"></a><span id="l20.96"> </span>
<a href="#l20.97"></a><span id="l20.97" class="difflineat">@@ -2069,17 +2070,17 @@ function addAttachment(attachment, cloud</span>
<a href="#l20.98"></a><span id="l20.98">                 }</span>
<a href="#l20.99"></a><span id="l20.99">             }</span>
<a href="#l20.100"></a><span id="l20.100">         } else {</span>
<a href="#l20.101"></a><span id="l20.101">             if (attachment.uri.schemeIs(&quot;file&quot;)) {</span>
<a href="#l20.102"></a><span id="l20.102">                 listItem.setAttribute(&quot;image&quot;, &quot;moz-icon://&quot; + attachment.uri);</span>
<a href="#l20.103"></a><span id="l20.103">             } else {</span>
<a href="#l20.104"></a><span id="l20.104">                 let leafName = attachment.getParameter(&quot;FILENAME&quot;);</span>
<a href="#l20.105"></a><span id="l20.105">                 let providerType = attachment.getParameter(&quot;PROVIDER&quot;);</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineminus">-                let cloudFileEnabled = cal.getPrefSafe(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineplus">+                let cloudFileEnabled = Preferences.get(&quot;mail.cloud_files.enabled&quot;, false);</span>
<a href="#l20.108"></a><span id="l20.108"> </span>
<a href="#l20.109"></a><span id="l20.109">                 if (leafName) {</span>
<a href="#l20.110"></a><span id="l20.110">                     // TODO security issues?</span>
<a href="#l20.111"></a><span id="l20.111">                     listItem.setAttribute(&quot;label&quot;, leafName);</span>
<a href="#l20.112"></a><span id="l20.112">                 }</span>
<a href="#l20.113"></a><span id="l20.113">                 if (providerType &amp;&amp; cloudFileEnabled) {</span>
<a href="#l20.114"></a><span id="l20.114">                     let cloudProvider = cloudFileAccounts.getProviderForType(providerType);</span>
<a href="#l20.115"></a><span id="l20.115">                     listItem.setAttribute(&quot;image&quot;, cloudProvider.iconClass);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l21.4"></a><span id="l21.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.5"></a><span id="l21.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7"> const SUNBIRD_UID = &quot;{718e30fb-e89b-41dd-9da7-e25a45638b28}&quot;;</span>
<a href="#l21.8"></a><span id="l21.8"> const FIREFOX_UID = &quot;{ec8030f7-c20a-464f-9b0e-13a3a9e97384}&quot;;</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l21.11"></a><span id="l21.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14"> //</span>
<a href="#l21.15"></a><span id="l21.15"> // The front-end wizard bits.</span>
<a href="#l21.16"></a><span id="l21.16"> //</span>
<a href="#l21.17"></a><span id="l21.17"> var gMigrateWizard = {</span>
<a href="#l21.18"></a><span id="l21.18">     /**</span>
<a href="#l21.19"></a><span id="l21.19">      * Called from onload of the migrator window.  Takes all of the migrators</span>
<a href="#l21.20"></a><span id="l21.20">      * that were passed in via window.arguments and adds them to checklist. The</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -706,14 +707,14 @@ var gDataMigrator = {</span>
<a href="#l21.22"></a><span id="l21.22">  * logs to system and error console, depending on the calendar.migration.log</span>
<a href="#l21.23"></a><span id="l21.23">  * preference.</span>
<a href="#l21.24"></a><span id="l21.24">  *</span>
<a href="#l21.25"></a><span id="l21.25">  * XXX Use log4moz instead.</span>
<a href="#l21.26"></a><span id="l21.26">  *</span>
<a href="#l21.27"></a><span id="l21.27">  * @param aString   The string to log</span>
<a href="#l21.28"></a><span id="l21.28">  */</span>
<a href="#l21.29"></a><span id="l21.29"> function migLOG(aString) {</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-    if (!getPrefSafe(&quot;calendar.migration.log&quot;, false)) {</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+    if (!Preferences.get(&quot;calendar.migration.log&quot;, false)) {</span>
<a href="#l21.32"></a><span id="l21.32">         return;</span>
<a href="#l21.33"></a><span id="l21.33">     }</span>
<a href="#l21.34"></a><span id="l21.34">     Services.console.logStringMessage(aString);</span>
<a href="#l21.35"></a><span id="l21.35">     dump(aString+&quot;\n&quot;);</span>
<a href="#l21.36"></a><span id="l21.36"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-alarm-widget.xml</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -238,17 +238,19 @@</span>
<a href="#l22.4"></a><span id="l22.4">         &lt;xul:toolbarbutton anonid=&quot;snooze-popup-cancel&quot;</span>
<a href="#l22.5"></a><span id="l22.5">                            class=&quot;snooze-popup-button snooze-popup-cancel-button&quot;</span>
<a href="#l22.6"></a><span id="l22.6">                            aria-label=&quot;&amp;calendar.alarm.snooze.cancel;&quot;</span>
<a href="#l22.7"></a><span id="l22.7">                            oncommand=&quot;snoozeCancel()&quot;/&gt;</span>
<a href="#l22.8"></a><span id="l22.8">       &lt;/xul:hbox&gt;</span>
<a href="#l22.9"></a><span id="l22.9">     &lt;/content&gt;</span>
<a href="#l22.10"></a><span id="l22.10">     &lt;implementation&gt;</span>
<a href="#l22.11"></a><span id="l22.11">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-        let snoozePref = getPrefSafe(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+        let snoozePref = Preferences.get(&quot;calendar.alarms.defaultsnoozelength&quot;, 0);</span>
<a href="#l22.16"></a><span id="l22.16">         if (snoozePref &lt;= 0) {</span>
<a href="#l22.17"></a><span id="l22.17">           snoozePref = 5;</span>
<a href="#l22.18"></a><span id="l22.18">         }</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">         let unitList = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;snooze-unit-menulist&quot;);</span>
<a href="#l22.21"></a><span id="l22.21">         let unitValue = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;snooze-value-textbox&quot;);</span>
<a href="#l22.22"></a><span id="l22.22"> </span>
<a href="#l22.23"></a><span id="l22.23">         let selectedIndex = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -413,16 +413,17 @@</span>
<a href="#l23.4"></a><span id="l23.4">       &lt;field name=&quot;mDaymap&quot;&gt;null&lt;/field&gt;</span>
<a href="#l23.5"></a><span id="l23.5">       &lt;field name=&quot;mValue&quot;&gt;null&lt;/field&gt;</span>
<a href="#l23.6"></a><span id="l23.6">       &lt;field name=&quot;mEditorDate&quot;&gt;null&lt;/field&gt;</span>
<a href="#l23.7"></a><span id="l23.7">       &lt;field name=&quot;mPixelScrollDelta&quot;&gt;0&lt;/field&gt;</span>
<a href="#l23.8"></a><span id="l23.8">       &lt;field name=&quot;mIsReadOnly&quot;&gt;false&lt;/field&gt;</span>
<a href="#l23.9"></a><span id="l23.9">       &lt;field name=&quot;mObservesComposite&quot;&gt;false&lt;/field&gt;</span>
<a href="#l23.10"></a><span id="l23.10">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l23.11"></a><span id="l23.11">           Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+          Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l23.13"></a><span id="l23.13"> </span>
<a href="#l23.14"></a><span id="l23.14">           this.mToday = false;</span>
<a href="#l23.15"></a><span id="l23.15">           this.mSelected = false;</span>
<a href="#l23.16"></a><span id="l23.16">           this.mValue = new Date() // Default to &quot;today&quot;</span>
<a href="#l23.17"></a><span id="l23.17">           // save references for convenience</span>
<a href="#l23.18"></a><span id="l23.18">           if (this.hasAttribute(&quot;readonly&quot;)) {</span>
<a href="#l23.19"></a><span id="l23.19">               this.mIsReadOnly = this.getAttribute(&quot;readonly&quot;) == &quot;true&quot;;</span>
<a href="#l23.20"></a><span id="l23.20">           }</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineat">@@ -691,17 +692,17 @@</span>
<a href="#l23.22"></a><span id="l23.22">                   break;</span>
<a href="#l23.23"></a><span id="l23.23">           }</span>
<a href="#l23.24"></a><span id="l23.24">         ]]&gt;&lt;/body&gt;</span>
<a href="#l23.25"></a><span id="l23.25">       &lt;/method&gt;</span>
<a href="#l23.26"></a><span id="l23.26"> </span>
<a href="#l23.27"></a><span id="l23.27">       &lt;method name=&quot;refreshDisplay&quot;&gt;</span>
<a href="#l23.28"></a><span id="l23.28">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l23.29"></a><span id="l23.29">           // Find out which should be the first day of the week</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-          this.weekStart = getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineplus">+          this.weekStart = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l23.32"></a><span id="l23.32">           if (!this.mValue) {</span>
<a href="#l23.33"></a><span id="l23.33">               this.mValue = new Date();</span>
<a href="#l23.34"></a><span id="l23.34">           }</span>
<a href="#l23.35"></a><span id="l23.35">           this.setHeader();</span>
<a href="#l23.36"></a><span id="l23.36">           this.showMonth(this.mValue);</span>
<a href="#l23.37"></a><span id="l23.37">         ]]&gt;&lt;/body&gt;</span>
<a href="#l23.38"></a><span id="l23.38">       &lt;/method&gt;</span>
<a href="#l23.39"></a><span id="l23.39">       &lt;method name=&quot;setHeader&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/modules/calAlarmUtils.jsm</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1,36 +1,37 @@</span>
<a href="#l24.4"></a><span id="l24.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.5"></a><span id="l24.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.6"></a><span id="l24.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l24.12"></a><span id="l24.12"> cal.alarms = {</span>
<a href="#l24.13"></a><span id="l24.13">     /**</span>
<a href="#l24.14"></a><span id="l24.14">      * Read default alarm settings from user preferences and apply them to the</span>
<a href="#l24.15"></a><span id="l24.15">      * event/todo passed in. The item's calendar should be set to ensure the</span>
<a href="#l24.16"></a><span id="l24.16">      * correct alarm type is set.</span>
<a href="#l24.17"></a><span id="l24.17">      *</span>
<a href="#l24.18"></a><span id="l24.18">      * @param aItem     The item to apply the default alarm values to.</span>
<a href="#l24.19"></a><span id="l24.19">      */</span>
<a href="#l24.20"></a><span id="l24.20">     setDefaultValues: function cal_alarm_setDefaultValues(aItem) {</span>
<a href="#l24.21"></a><span id="l24.21">         let type = cal.isEvent(aItem) ? &quot;event&quot; : &quot;todo&quot;;</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-        if (cal.getPrefSafe(&quot;calendar.alarms.onfor&quot; + type + &quot;s&quot;, 0) == 1) {</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+        if (Preferences.get(&quot;calendar.alarms.onfor&quot; + type + &quot;s&quot;, 0) == 1) {</span>
<a href="#l24.24"></a><span id="l24.24">             let alarmOffset = cal.createDuration();</span>
<a href="#l24.25"></a><span id="l24.25">             let alarm = cal.createAlarm();</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-            let units = cal.getPrefSafe(&quot;calendar.alarms.&quot; + type + &quot;alarmunit&quot;, &quot;minutes&quot;);</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+            let units = Preferences.get(&quot;calendar.alarms.&quot; + type + &quot;alarmunit&quot;, &quot;minutes&quot;);</span>
<a href="#l24.28"></a><span id="l24.28"> </span>
<a href="#l24.29"></a><span id="l24.29">             // Make sure the alarm pref is valid, default to minutes otherwise</span>
<a href="#l24.30"></a><span id="l24.30">             if ([&quot;weeks&quot;, &quot;days&quot;, &quot;hours&quot;, &quot;minutes&quot;, &quot;seconds&quot;].indexOf(units) &lt; 0) {</span>
<a href="#l24.31"></a><span id="l24.31">                 units = &quot;minutes&quot;;</span>
<a href="#l24.32"></a><span id="l24.32">             }</span>
<a href="#l24.33"></a><span id="l24.33"> </span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-            alarmOffset[units] = cal.getPrefSafe(&quot;calendar.alarms.&quot; + type + &quot;alarmlen&quot;, 0);</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+            alarmOffset[units] = Preferences.get(&quot;calendar.alarms.&quot; + type + &quot;alarmlen&quot;, 0);</span>
<a href="#l24.36"></a><span id="l24.36">             alarmOffset.normalize();</span>
<a href="#l24.37"></a><span id="l24.37">             alarmOffset.isNegative = true;</span>
<a href="#l24.38"></a><span id="l24.38">             if (type == &quot;todo&quot; &amp;&amp; !aItem.entryDate) {</span>
<a href="#l24.39"></a><span id="l24.39">                 // You can't have an alarm if the entryDate doesn't exist.</span>
<a href="#l24.40"></a><span id="l24.40">                 aItem.entryDate = cal.now();</span>
<a href="#l24.41"></a><span id="l24.41">             }</span>
<a href="#l24.42"></a><span id="l24.42">             alarm.related = Components.interfaces.calIAlarm.ALARM_RELATED_START;</span>
<a href="#l24.43"></a><span id="l24.43">             alarm.offset = alarmOffset;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/modules/calAuthUtils.jsm</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/modules/calAuthUtils.jsm</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l25.4"></a><span id="l25.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l25.5"></a><span id="l25.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l25.6"></a><span id="l25.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l25.9"></a><span id="l25.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12"> /*</span>
<a href="#l25.13"></a><span id="l25.13">  * Authentication helper code</span>
<a href="#l25.14"></a><span id="l25.14">  */</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16"> EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l25.17"></a><span id="l25.17"> cal.auth = {</span>
<a href="#l25.18"></a><span id="l25.18">     /**</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineat">@@ -43,17 +44,17 @@ cal.auth = {</span>
<a href="#l25.20"></a><span id="l25.20">             typeof aSavePassword != &quot;object&quot;) {</span>
<a href="#l25.21"></a><span id="l25.21">             throw new Components.Exception(&quot;&quot;, Components.results.NS_ERROR_XPC_NEED_OUT_OBJECT);</span>
<a href="#l25.22"></a><span id="l25.22">         }</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24">         let prompter = Services.ww.getNewPrompter(null);</span>
<a href="#l25.25"></a><span id="l25.25"> </span>
<a href="#l25.26"></a><span id="l25.26">         // Only show the save password box if we are supposed to.</span>
<a href="#l25.27"></a><span id="l25.27">         let savepassword = null;</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-        if (cal.getPrefSafe(&quot;signon.rememberSignons&quot;, true)) {</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+        if (Preferences.get(&quot;signon.rememberSignons&quot;, true)) {</span>
<a href="#l25.30"></a><span id="l25.30">             savepassword = cal.calGetString(&quot;passwordmgr&quot;, &quot;rememberPassword&quot;, null, &quot;passwordmgr&quot;);</span>
<a href="#l25.31"></a><span id="l25.31">         }</span>
<a href="#l25.32"></a><span id="l25.32"> </span>
<a href="#l25.33"></a><span id="l25.33">         let aText;</span>
<a href="#l25.34"></a><span id="l25.34">         if (aFixedUsername) {</span>
<a href="#l25.35"></a><span id="l25.35">             aText = cal.calGetString(&quot;commonDialogs&quot;, &quot;EnterPasswordFor&quot;, [aUsername.value, aCalendarName], &quot;global&quot;);</span>
<a href="#l25.36"></a><span id="l25.36">             return prompter.promptPassword(aTitle,</span>
<a href="#l25.37"></a><span id="l25.37">                                            aText,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/modules/calExtract.jsm</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/modules/calExtract.jsm</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l26.4"></a><span id="l26.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l26.5"></a><span id="l26.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.6"></a><span id="l26.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8"> const EXPORTED_SYMBOLS = [&quot;Extractor&quot;];</span>
<a href="#l26.9"></a><span id="l26.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l26.10"></a><span id="l26.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l26.12"></a><span id="l26.12"> </span>
<a href="#l26.13"></a><span id="l26.13"> /**</span>
<a href="#l26.14"></a><span id="l26.14"> * Initializes extraction</span>
<a href="#l26.15"></a><span id="l26.15"> *</span>
<a href="#l26.16"></a><span id="l26.16"> * @param baseUrl         path for the properties file containing patterns,</span>
<a href="#l26.17"></a><span id="l26.17"> *                            locale in path should be substituted with LOCALE</span>
<a href="#l26.18"></a><span id="l26.18"> * @param fallbackLocale  locale to use when others are not found or</span>
<a href="#l26.19"></a><span id="l26.19"> *                            detection is disabled</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineat">@@ -114,27 +115,27 @@ Extractor.prototype = {</span>
<a href="#l26.21"></a><span id="l26.21">                 this.fallbackLocale = &quot;en-US&quot;;</span>
<a href="#l26.22"></a><span id="l26.22">                 cal.LOG(&quot;[calExtract] &quot; + this.fallbackLocale +</span>
<a href="#l26.23"></a><span id="l26.23">                         &quot; patterns were not found. Using en-US instead&quot;);</span>
<a href="#l26.24"></a><span id="l26.24">             }</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26">             path = this.bundleUrl.replace(&quot;LOCALE&quot;, this.fallbackLocale, &quot;g&quot;);</span>
<a href="#l26.27"></a><span id="l26.27"> </span>
<a href="#l26.28"></a><span id="l26.28">             let pref = &quot;calendar.patterns.last.used.languages&quot;;</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-            let lastUsedLangs = cal.getPrefSafe(pref, &quot;&quot;);</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineplus">+            let lastUsedLangs = Preferences.get(pref, &quot;&quot;);</span>
<a href="#l26.31"></a><span id="l26.31">             if (lastUsedLangs == &quot;&quot;) {</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-                cal.setPref(pref, this.fallbackLocale);</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+                Preferences.set(pref, this.fallbackLocale);</span>
<a href="#l26.34"></a><span id="l26.34">             } else {</span>
<a href="#l26.35"></a><span id="l26.35">                 let langs = lastUsedLangs.split(&quot;,&quot;);</span>
<a href="#l26.36"></a><span id="l26.36">                 let idx = langs.indexOf(this.fallbackLocale);</span>
<a href="#l26.37"></a><span id="l26.37">                 if (idx == -1) {</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-                    cal.setPref(pref, this.fallbackLocale + &quot;,&quot; + lastUsedLangs);</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineplus">+                    Preferences.set(pref, this.fallbackLocale + &quot;,&quot; + lastUsedLangs);</span>
<a href="#l26.40"></a><span id="l26.40">                 } else {</span>
<a href="#l26.41"></a><span id="l26.41">                     langs.splice(idx, 1);</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-                    cal.setPref(pref, this.fallbackLocale + &quot;,&quot; + langs.join(&quot;,&quot;));</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+                    Preferences.set(pref, this.fallbackLocale + &quot;,&quot; + langs.join(&quot;,&quot;));</span>
<a href="#l26.44"></a><span id="l26.44">                 }</span>
<a href="#l26.45"></a><span id="l26.45">             }</span>
<a href="#l26.46"></a><span id="l26.46">         } else {</span>
<a href="#l26.47"></a><span id="l26.47">             let spellclass = &quot;@mozilla.org/spellchecker/engine;1&quot;;</span>
<a href="#l26.48"></a><span id="l26.48">             let mozISpellCheckingEngine = Components.interfaces.mozISpellCheckingEngine;</span>
<a href="#l26.49"></a><span id="l26.49">             let sp = Components.classes[spellclass]</span>
<a href="#l26.50"></a><span id="l26.50">                                .getService(mozISpellCheckingEngine);</span>
<a href="#l26.51"></a><span id="l26.51"> </span>
<a href="#l26.52"></a><span id="l26.52" class="difflineat">@@ -268,17 +269,17 @@ Extractor.prototype = {</span>
<a href="#l26.53"></a><span id="l26.53">                              hour: initial.hour,</span>
<a href="#l26.54"></a><span id="l26.54">                              minute: initial.minute,</span>
<a href="#l26.55"></a><span id="l26.55">                              relation: &quot;start&quot;</span>
<a href="#l26.56"></a><span id="l26.56">         });</span>
<a href="#l26.57"></a><span id="l26.57"> </span>
<a href="#l26.58"></a><span id="l26.58">         this.cleanup();</span>
<a href="#l26.59"></a><span id="l26.59">         cal.LOG(&quot;[calExtract] Email after processing for extraction: \n&quot; + this.email);</span>
<a href="#l26.60"></a><span id="l26.60"> </span>
<a href="#l26.61"></a><span id="l26.61" class="difflineminus">-        this.overrides = JSON.parse(cal.getPrefSafe(&quot;calendar.patterns.override&quot;, &quot;{}&quot;));</span>
<a href="#l26.62"></a><span id="l26.62" class="difflineplus">+        this.overrides = JSON.parse(Preferences.get(&quot;calendar.patterns.override&quot;, &quot;{}&quot;));</span>
<a href="#l26.63"></a><span id="l26.63">         this.setLanguage();</span>
<a href="#l26.64"></a><span id="l26.64"> </span>
<a href="#l26.65"></a><span id="l26.65">         for (let i = 0; i &lt;= 31; i++) {</span>
<a href="#l26.66"></a><span id="l26.66">             this.numbers[i] = this.getPatterns(&quot;number.&quot; + i);</span>
<a href="#l26.67"></a><span id="l26.67">         }</span>
<a href="#l26.68"></a><span id="l26.68">         this.dailyNumbers = this.numbers.join(this.marker);</span>
<a href="#l26.69"></a><span id="l26.69"> </span>
<a href="#l26.70"></a><span id="l26.70">         this.hourlyNumbers = this.numbers[0] + this.marker;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/modules/calIteratorUtils.jsm</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/modules/calIteratorUtils.jsm</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l27.4"></a><span id="l27.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.5"></a><span id="l27.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.6"></a><span id="l27.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l27.9"></a><span id="l27.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l27.11"></a><span id="l27.11"> </span>
<a href="#l27.12"></a><span id="l27.12"> EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l27.13"></a><span id="l27.13"> </span>
<a href="#l27.14"></a><span id="l27.14"> /**</span>
<a href="#l27.15"></a><span id="l27.15">  * Iterates an array of items, i.e. the passed item including all</span>
<a href="#l27.16"></a><span id="l27.16">  * overridden instances of a recurring series.</span>
<a href="#l27.17"></a><span id="l27.17">  *</span>
<a href="#l27.18"></a><span id="l27.18">  * @param items array of items</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineat">@@ -46,17 +47,17 @@ cal.itemIterator = function cal_itemIter</span>
<a href="#l27.20"></a><span id="l27.20">  * @param iter          The Iterator to go through in this loop.</span>
<a href="#l27.21"></a><span id="l27.21">  * @param body          The function called for each iteration. Its parameter is</span>
<a href="#l27.22"></a><span id="l27.22">  *                          the single item from the iterator.</span>
<a href="#l27.23"></a><span id="l27.23">  * @param completed     [optional] The function called after the loop completes.</span>
<a href="#l27.24"></a><span id="l27.24">  */</span>
<a href="#l27.25"></a><span id="l27.25"> cal.forEach = function cal_forEach(iter, body, completed) {</span>
<a href="#l27.26"></a><span id="l27.26">     // This should be a const one day, lets keep it a pref for now though until we</span>
<a href="#l27.27"></a><span id="l27.27">     // find a sane value.</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineminus">-    let LATENCY = cal.getPrefSafe(&quot;calendar.threading.latency&quot;, 250);</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+    let LATENCY = Preferences.get(&quot;calendar.threading.latency&quot;, 250);</span>
<a href="#l27.30"></a><span id="l27.30"> </span>
<a href="#l27.31"></a><span id="l27.31">     let ourIter = iter;</span>
<a href="#l27.32"></a><span id="l27.32">     if (!(iter instanceof Iterator)) {</span>
<a href="#l27.33"></a><span id="l27.33">         // If its not an iterator, we need to use a generator expression to make</span>
<a href="#l27.34"></a><span id="l27.34">         // sure calling this function feels right.</span>
<a href="#l27.35"></a><span id="l27.35">         ourIter = (i for each (i in iter));</span>
<a href="#l27.36"></a><span id="l27.36">     }</span>
<a href="#l27.37"></a><span id="l27.37"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l28.4"></a><span id="l28.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l28.5"></a><span id="l28.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l28.6"></a><span id="l28.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l28.9"></a><span id="l28.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l28.10"></a><span id="l28.10"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l28.11"></a><span id="l28.11"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l28.13"></a><span id="l28.13"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l28.14"></a><span id="l28.14"> </span>
<a href="#l28.15"></a><span id="l28.15"> /**</span>
<a href="#l28.16"></a><span id="l28.16">  * Scheduling and iTIP helper code</span>
<a href="#l28.17"></a><span id="l28.17">  */</span>
<a href="#l28.18"></a><span id="l28.18"> EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l28.19"></a><span id="l28.19"> cal.itip = {</span>
<a href="#l28.20"></a><span id="l28.20">     /**</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineat">@@ -688,17 +689,17 @@ cal.itip = {</span>
<a href="#l28.22"></a><span id="l28.22"> </span>
<a href="#l28.23"></a><span id="l28.23">                 // if send out should be limited to newly added attendees and no major</span>
<a href="#l28.24"></a><span id="l28.24">                 // props (attendee is not such) have changed, only the respective attendee</span>
<a href="#l28.25"></a><span id="l28.25">                 // is added to the recipient list while the attendee information in the</span>
<a href="#l28.26"></a><span id="l28.26">                 // ical is left to enable the new attendee to see who else is attending</span>
<a href="#l28.27"></a><span id="l28.27">                 // the event (if not prevented otherwise)</span>
<a href="#l28.28"></a><span id="l28.28">                 if (isMinorUpdate &amp;&amp;</span>
<a href="#l28.29"></a><span id="l28.29">                     addedAttendees.length &gt; 0 &amp;&amp;</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">-                    cal.getPrefSafe(&quot;calendar.itip.updateInvitationForNewAttendeesOnly&quot;, false)) {</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+                    Preferences.get(&quot;calendar.itip.updateInvitationForNewAttendeesOnly&quot;, false)) {</span>
<a href="#l28.32"></a><span id="l28.32">                     recipients = addedAttendees;</span>
<a href="#l28.33"></a><span id="l28.33">                 }</span>
<a href="#l28.34"></a><span id="l28.34"> </span>
<a href="#l28.35"></a><span id="l28.35">                 if (recipients.length &gt; 0) {</span>
<a href="#l28.36"></a><span id="l28.36">                     sendMessage(requestItem, &quot;REQUEST&quot;, recipients, autoResponse);</span>
<a href="#l28.37"></a><span id="l28.37">                 }</span>
<a href="#l28.38"></a><span id="l28.38"> </span>
<a href="#l28.39"></a><span id="l28.39">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/modules/calPrintUtils.jsm</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/modules/calPrintUtils.jsm</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l29.4"></a><span id="l29.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l29.5"></a><span id="l29.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l29.6"></a><span id="l29.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l29.9"></a><span id="l29.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11"> EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l29.12"></a><span id="l29.12"> cal.print = {</span>
<a href="#l29.13"></a><span id="l29.13">     /**</span>
<a href="#l29.14"></a><span id="l29.14">      * Returns a simple key in the format YYYY-MM-DD for use in the table of</span>
<a href="#l29.15"></a><span id="l29.15">      * dates to day boxes</span>
<a href="#l29.16"></a><span id="l29.16">      *</span>
<a href="#l29.17"></a><span id="l29.17">      * @param dt    The date to translate</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineat">@@ -27,17 +28,17 @@ cal.print = {</span>
<a href="#l29.19"></a><span id="l29.19">      * @param categories    Array of categories to insert rules for.</span>
<a href="#l29.20"></a><span id="l29.20">      */</span>
<a href="#l29.21"></a><span id="l29.21">     insertCategoryRules: function insertCategoryRules(document, categories) {</span>
<a href="#l29.22"></a><span id="l29.22">         let sheet = document.getElementById(&quot;sheet&quot;);</span>
<a href="#l29.23"></a><span id="l29.23">         sheet.insertedCategoryRules = sheet.insertedCategoryRules || {};</span>
<a href="#l29.24"></a><span id="l29.24"> </span>
<a href="#l29.25"></a><span id="l29.25">         for each (let category in categories) {</span>
<a href="#l29.26"></a><span id="l29.26">             let prefName = cal.formatStringForCSSRule(category);</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-            let color = cal.getPrefSafe(&quot;calendar.category.color.&quot; + prefName) || &quot;transparent&quot;;</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineplus">+            let color = Preferences.get(&quot;calendar.category.color.&quot; + prefName) || &quot;transparent&quot;;</span>
<a href="#l29.29"></a><span id="l29.29">             if (!(prefName in sheet.insertedCategoryRules)) {</span>
<a href="#l29.30"></a><span id="l29.30">                 sheet.insertedCategoryRules[prefName] = true;</span>
<a href="#l29.31"></a><span id="l29.31">                 let ruleAdd = ' .category-color-box[categories~=&quot;' + prefName + '&quot;] { ' +</span>
<a href="#l29.32"></a><span id="l29.32">                               ' border: 2px solid ' + color + '; }' + &quot;\n&quot;;</span>
<a href="#l29.33"></a><span id="l29.33">                 sheet.textContent += ruleAdd;</span>
<a href="#l29.34"></a><span id="l29.34">             }</span>
<a href="#l29.35"></a><span id="l29.35">         }</span>
<a href="#l29.36"></a><span id="l29.36">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l30.4"></a><span id="l30.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.5"></a><span id="l30.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.6"></a><span id="l30.6"> </span>
<a href="#l30.7"></a><span id="l30.7"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l30.8"></a><span id="l30.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l30.9"></a><span id="l30.9"> Components.utils.import(&quot;resource://calendar/modules/calAuthUtils.jsm&quot;);</span>
<a href="#l30.10"></a><span id="l30.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l30.11"></a><span id="l30.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l30.13"></a><span id="l30.13"> </span>
<a href="#l30.14"></a><span id="l30.14"> /*</span>
<a href="#l30.15"></a><span id="l30.15">  * Provider helper code</span>
<a href="#l30.16"></a><span id="l30.16">  */</span>
<a href="#l30.17"></a><span id="l30.17"> </span>
<a href="#l30.18"></a><span id="l30.18"> EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even though it's defined in calUtils.jsm, import needs this</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20"> /**</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineat">@@ -713,17 +714,17 @@ cal.ProviderBase.prototype = {</span>
<a href="#l30.22"></a><span id="l30.22">     },</span>
<a href="#l30.23"></a><span id="l30.23"> </span>
<a href="#l30.24"></a><span id="l30.24">     // nsIVariant getProperty(in AUTF8String aName);</span>
<a href="#l30.25"></a><span id="l30.25">     getProperty: function cPB_getProperty(aName) {</span>
<a href="#l30.26"></a><span id="l30.26">         switch (aName) {</span>
<a href="#l30.27"></a><span id="l30.27">             case &quot;itip.transport&quot;: // iTIP/iMIP default:</span>
<a href="#l30.28"></a><span id="l30.28">                 return cal.getImipTransport(this);</span>
<a href="#l30.29"></a><span id="l30.29">             case &quot;itip.notify-replies&quot;: // iTIP/iMIP default:</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-                 return cal.getPrefSafe(&quot;calendar.itip.notify-replies&quot;, false);</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+                 return Preferences.get(&quot;calendar.itip.notify-replies&quot;, false);</span>
<a href="#l30.32"></a><span id="l30.32">             // temporary hack to get the uncached calendar instance:</span>
<a href="#l30.33"></a><span id="l30.33">             case &quot;cache.uncachedCalendar&quot;:</span>
<a href="#l30.34"></a><span id="l30.34">                 return this;</span>
<a href="#l30.35"></a><span id="l30.35">         }</span>
<a href="#l30.36"></a><span id="l30.36"> </span>
<a href="#l30.37"></a><span id="l30.37">         let ret = this.mProperties[aName];</span>
<a href="#l30.38"></a><span id="l30.38">         if (ret === undefined) {</span>
<a href="#l30.39"></a><span id="l30.39">             ret = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -3,16 +3,17 @@</span>
<a href="#l31.4"></a><span id="l31.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6"> // New code must not load/import calUtils.js, but should use calUtils.jsm.</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8"> var gCalThreadingEnabled;</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10"> Components.utils.import(&quot;resource:///modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l31.11"></a><span id="l31.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l31.13"></a><span id="l31.13"> </span>
<a href="#l31.14"></a><span id="l31.14"> // Usually the backend loader gets loaded via profile-after-change, but in case</span>
<a href="#l31.15"></a><span id="l31.15"> // a calendar component hooks in earlier, its very likely it will use calUtils.</span>
<a href="#l31.16"></a><span id="l31.16"> // Getting the service here will load if its not already loaded</span>
<a href="#l31.17"></a><span id="l31.17"> Components.classes[&quot;@mozilla.org/calendar/backend-loader;1&quot;].getService();</span>
<a href="#l31.18"></a><span id="l31.18"> </span>
<a href="#l31.19"></a><span id="l31.19"> EXPORTED_SYMBOLS = [&quot;cal&quot;];</span>
<a href="#l31.20"></a><span id="l31.20"> let cal = {</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineat">@@ -125,17 +126,17 @@ let cal = {</span>
<a href="#l31.22"></a><span id="l31.22">         }</span>
<a href="#l31.23"></a><span id="l31.23">         adapter.QueryInterface = XPCOMUtils.generateQI([iface]);</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25">         return adapter;</span>
<a href="#l31.26"></a><span id="l31.26">     },</span>
<a href="#l31.27"></a><span id="l31.27"> </span>
<a href="#l31.28"></a><span id="l31.28">     get threadingEnabled() {</span>
<a href="#l31.29"></a><span id="l31.29">         if (gCalThreadingEnabled === undefined) {</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-            gCalThreadingEnabled = !cal.getPrefSafe(&quot;calendar.threading.disabled&quot;, false);</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+            gCalThreadingEnabled = !Preferences.get(&quot;calendar.threading.disabled&quot;, false);</span>
<a href="#l31.32"></a><span id="l31.32">         }</span>
<a href="#l31.33"></a><span id="l31.33">         return gCalThreadingEnabled;</span>
<a href="#l31.34"></a><span id="l31.34">     },</span>
<a href="#l31.35"></a><span id="l31.35"> </span>
<a href="#l31.36"></a><span id="l31.36">     /**</span>
<a href="#l31.37"></a><span id="l31.37">      * Checks whether a timezone lacks a definition.</span>
<a href="#l31.38"></a><span id="l31.38">      */</span>
<a href="#l31.39"></a><span id="l31.39">     isPhantomTimezone: function cal_isPhantomTimezone(tz) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l32.4"></a><span id="l32.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l32.5"></a><span id="l32.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.6"></a><span id="l32.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l32.9"></a><span id="l32.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l32.10"></a><span id="l32.10"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l32.11"></a><span id="l32.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l32.12"></a><span id="l32.12"> </span>
<a href="#l32.13"></a><span id="l32.13"> function peekAlarmWindow() {</span>
<a href="#l32.14"></a><span id="l32.14">     return Services.wm.getMostRecentWindow(&quot;Calendar:AlarmWindow&quot;);</span>
<a href="#l32.15"></a><span id="l32.15"> }</span>
<a href="#l32.16"></a><span id="l32.16"> </span>
<a href="#l32.17"></a><span id="l32.17"> /**</span>
<a href="#l32.18"></a><span id="l32.18">  * The alarm monitor takes care of playing the alarm sound and opening one copy</span>
<a href="#l32.19"></a><span id="l32.19">  * of the calendar-alarm-dialog. Both depend on their respective prefs to be</span>
<a href="#l32.20"></a><span id="l32.20" class="difflineat">@@ -71,53 +72,53 @@ calAlarmMonitor.prototype = {</span>
<a href="#l32.21"></a><span id="l32.21">     onAlarm: function cAM_onAlarm(aItem, aAlarm) {</span>
<a href="#l32.22"></a><span id="l32.22">         if (aAlarm.action != &quot;DISPLAY&quot;) {</span>
<a href="#l32.23"></a><span id="l32.23">             // This monitor only looks for DISPLAY alarms.</span>
<a href="#l32.24"></a><span id="l32.24">             return;</span>
<a href="#l32.25"></a><span id="l32.25">         }</span>
<a href="#l32.26"></a><span id="l32.26"> </span>
<a href="#l32.27"></a><span id="l32.27">         this.mAlarms.push([aItem, aAlarm]);</span>
<a href="#l32.28"></a><span id="l32.28"> </span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-        if (getPrefSafe(&quot;calendar.alarms.playsound&quot;, true)) {</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+        if (Preferences.get(&quot;calendar.alarms.playsound&quot;, true)) {</span>
<a href="#l32.31"></a><span id="l32.31">             // We want to make sure the user isn't flooded with alarms so we</span>
<a href="#l32.32"></a><span id="l32.32">             // limit this using a preference. For example, if the user has 20</span>
<a href="#l32.33"></a><span id="l32.33">             // events that fire an alarm in the same minute, then the alarm</span>
<a href="#l32.34"></a><span id="l32.34">             // sound will only play 5 times. All alarms will be shown in the</span>
<a href="#l32.35"></a><span id="l32.35">             // dialog nevertheless.</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-            let maxAlarmSoundCount = cal.getPrefSafe(&quot;calendar.alarms.maxsoundsperminute&quot;, 5);</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+            let maxAlarmSoundCount = Preferences.get(&quot;calendar.alarms.maxsoundsperminute&quot;, 5);</span>
<a href="#l32.38"></a><span id="l32.38">             let now = new Date();</span>
<a href="#l32.39"></a><span id="l32.39"> </span>
<a href="#l32.40"></a><span id="l32.40">             if (!this.mLastAlarmSoundDate ||</span>
<a href="#l32.41"></a><span id="l32.41">                 (now - this.mLastAlarmSoundDate &gt;= 60000)) {</span>
<a href="#l32.42"></a><span id="l32.42">                 // Last alarm was long enough ago, reset counters. Note</span>
<a href="#l32.43"></a><span id="l32.43">                 // subtracting JSDate results in microseconds.</span>
<a href="#l32.44"></a><span id="l32.44">                 this.mAlarmSoundCount = 0;</span>
<a href="#l32.45"></a><span id="l32.45">                 this.mLastAlarmSoundDate = now;</span>
<a href="#l32.46"></a><span id="l32.46">             } else {</span>
<a href="#l32.47"></a><span id="l32.47">                 // Otherwise increase the counter</span>
<a href="#l32.48"></a><span id="l32.48">                 this.mAlarmSoundCount++;</span>
<a href="#l32.49"></a><span id="l32.49">             }</span>
<a href="#l32.50"></a><span id="l32.50"> </span>
<a href="#l32.51"></a><span id="l32.51">             if (maxAlarmSoundCount &gt; this.mAlarmSoundCount) {</span>
<a href="#l32.52"></a><span id="l32.52">                 // Only ring the alarm sound if we haven't hit the max count.</span>
<a href="#l32.53"></a><span id="l32.53">                 try {</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineminus">-                    let soundURL = getPrefSafe(&quot;calendar.alarms.soundURL&quot;, null);</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineplus">+                    let soundURL = Preferences.get(&quot;calendar.alarms.soundURL&quot;, null);</span>
<a href="#l32.56"></a><span id="l32.56">                     if (soundURL &amp;&amp; soundURL.length &gt; 0) {</span>
<a href="#l32.57"></a><span id="l32.57">                         soundURL = makeURL(soundURL);</span>
<a href="#l32.58"></a><span id="l32.58">                         this.mSound.play(soundURL);</span>
<a href="#l32.59"></a><span id="l32.59">                     } else {</span>
<a href="#l32.60"></a><span id="l32.60">                         this.mSound.beep();</span>
<a href="#l32.61"></a><span id="l32.61">                     }</span>
<a href="#l32.62"></a><span id="l32.62">                 } catch (exc) {</span>
<a href="#l32.63"></a><span id="l32.63">                     cal.ERROR(&quot;Error playing alarm sound: &quot; + exc);</span>
<a href="#l32.64"></a><span id="l32.64">                 }</span>
<a href="#l32.65"></a><span id="l32.65">             }</span>
<a href="#l32.66"></a><span id="l32.66">         }</span>
<a href="#l32.67"></a><span id="l32.67"> </span>
<a href="#l32.68"></a><span id="l32.68" class="difflineminus">-        if (!getPrefSafe(&quot;calendar.alarms.show&quot;, true)) {</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineplus">+        if (!Preferences.get(&quot;calendar.alarms.show&quot;, true)) {</span>
<a href="#l32.70"></a><span id="l32.70">             return;</span>
<a href="#l32.71"></a><span id="l32.71">         }</span>
<a href="#l32.72"></a><span id="l32.72"> </span>
<a href="#l32.73"></a><span id="l32.73">         let calAlarmWindow = peekAlarmWindow();</span>
<a href="#l32.74"></a><span id="l32.74">         if (!calAlarmWindow  &amp;&amp; !this.mWindowOpening) {</span>
<a href="#l32.75"></a><span id="l32.75">             this.mWindowOpening = Services.ww.openWindow(</span>
<a href="#l32.76"></a><span id="l32.76">                 null,</span>
<a href="#l32.77"></a><span id="l32.77">                 &quot;chrome://calendar/content/calendar-alarm-dialog.xul&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l33.4"></a><span id="l33.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l33.5"></a><span id="l33.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l33.6"></a><span id="l33.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l33.9"></a><span id="l33.9"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l33.10"></a><span id="l33.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l33.11"></a><span id="l33.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l33.13"></a><span id="l33.13"> </span>
<a href="#l33.14"></a><span id="l33.14"> const kHoursBetweenUpdates = 6;</span>
<a href="#l33.15"></a><span id="l33.15"> const kSleepMonitorInterval = 60000;</span>
<a href="#l33.16"></a><span id="l33.16"> const kSleepMonitorTolerance = 1000;</span>
<a href="#l33.17"></a><span id="l33.17"> </span>
<a href="#l33.18"></a><span id="l33.18"> function nowUTC() {</span>
<a href="#l33.19"></a><span id="l33.19">     return cal.jsDateToDateTime(new Date()).getInTimezone(cal.UTC());</span>
<a href="#l33.20"></a><span id="l33.20"> }</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineat">@@ -346,17 +347,17 @@ calAlarmService.prototype = {</span>
<a href="#l33.22"></a><span id="l33.22">     },</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24">     addAlarmsForItem: function cAS_addAlarmsForItem(aItem) {</span>
<a href="#l33.25"></a><span id="l33.25">         if (cal.isToDo(aItem) &amp;&amp; aItem.isCompleted) {</span>
<a href="#l33.26"></a><span id="l33.26">             // If this is a task and it is completed, don't add the alarm.</span>
<a href="#l33.27"></a><span id="l33.27">             return;</span>
<a href="#l33.28"></a><span id="l33.28">         }</span>
<a href="#l33.29"></a><span id="l33.29"> </span>
<a href="#l33.30"></a><span id="l33.30" class="difflineminus">-        let showMissed = cal.getPrefSafe(&quot;calendar.alarms.showmissed&quot;, true);</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineplus">+        let showMissed = Preferences.get(&quot;calendar.alarms.showmissed&quot;, true);</span>
<a href="#l33.32"></a><span id="l33.32"> </span>
<a href="#l33.33"></a><span id="l33.33">         let alarms = aItem.getAlarms({});</span>
<a href="#l33.34"></a><span id="l33.34">         for each (let alarm in alarms) {</span>
<a href="#l33.35"></a><span id="l33.35">             let alarmDate = cal.alarms.calculateAlarmDate(aItem, alarm);</span>
<a href="#l33.36"></a><span id="l33.36"> </span>
<a href="#l33.37"></a><span id="l33.37">             if (!alarmDate || alarm.action != &quot;DISPLAY&quot;) {</span>
<a href="#l33.38"></a><span id="l33.38">                 // Only take care of DISPLAY alarms with an alarm date.</span>
<a href="#l33.39"></a><span id="l33.39">                 continue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l34.4"></a><span id="l34.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l34.5"></a><span id="l34.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l34.6"></a><span id="l34.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l34.9"></a><span id="l34.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l34.10"></a><span id="l34.10"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l34.11"></a><span id="l34.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l34.12"></a><span id="l34.12"> </span>
<a href="#l34.13"></a><span id="l34.13"> const calICalendar = Components.interfaces.calICalendar;</span>
<a href="#l34.14"></a><span id="l34.14"> const cICL = Components.interfaces.calIChangeLog;</span>
<a href="#l34.15"></a><span id="l34.15"> const cIOL = Components.interfaces.calIOperationListener;</span>
<a href="#l34.16"></a><span id="l34.16"> </span>
<a href="#l34.17"></a><span id="l34.17"> let gNoOpListener = {</span>
<a href="#l34.18"></a><span id="l34.18">     onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l34.19"></a><span id="l34.19">     },</span>
<a href="#l34.20"></a><span id="l34.20" class="difflineat">@@ -172,17 +173,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l34.21"></a><span id="l34.21">                 // afterwards.</span>
<a href="#l34.22"></a><span id="l34.22">                 this.mCachedCalendar.QueryInterface(Components.interfaces.calICalendarProvider)</span>
<a href="#l34.23"></a><span id="l34.23">                                     .deleteCalendar(this.mCachedCalendar, null);</span>
<a href="#l34.24"></a><span id="l34.24">                 if (this.supportsChangeLog) {</span>
<a href="#l34.25"></a><span id="l34.25">                     // start with full sync:</span>
<a href="#l34.26"></a><span id="l34.26">                     this.mUncachedCalendar.resetLog();</span>
<a href="#l34.27"></a><span id="l34.27">                 }</span>
<a href="#l34.28"></a><span id="l34.28">             } else {</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-                let calType = getPrefSafe(&quot;calendar.cache.type&quot;, &quot;storage&quot;);</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineplus">+                let calType = Preferences.get(&quot;calendar.cache.type&quot;, &quot;storage&quot;);</span>
<a href="#l34.31"></a><span id="l34.31">                 // While technically, the above deleteCalendar should delete the</span>
<a href="#l34.32"></a><span id="l34.32">                 // whole calendar, this is nothing more than deleting all events</span>
<a href="#l34.33"></a><span id="l34.33">                 // todos and properties. Therefore the initialization can be</span>
<a href="#l34.34"></a><span id="l34.34">                 // skipped.</span>
<a href="#l34.35"></a><span id="l34.35">                 let cachedCalendar = Components.classes[&quot;@mozilla.org/calendar/calendar;1?type=&quot; + calType]</span>
<a href="#l34.36"></a><span id="l34.36">                                                .createInstance(Components.interfaces.calICalendar);</span>
<a href="#l34.37"></a><span id="l34.37">                 switch (calType) {</span>
<a href="#l34.38"></a><span id="l34.38">                     case &quot;memory&quot;:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l35.4"></a><span id="l35.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l35.5"></a><span id="l35.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l35.6"></a><span id="l35.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8"> Components.utils.import(&quot;resource://gre/modules/AddonManager.jsm&quot;);</span>
<a href="#l35.9"></a><span id="l35.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l35.11"></a><span id="l35.11"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l35.12"></a><span id="l35.12"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l35.13"></a><span id="l35.13"> </span>
<a href="#l35.14"></a><span id="l35.14"> const REGISTRY_BRANCH = &quot;calendar.registry.&quot;;</span>
<a href="#l35.15"></a><span id="l35.15"> const DB_SCHEMA_VERSION = 10;</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17"> function calCalendarManager() {</span>
<a href="#l35.18"></a><span id="l35.18">     this.wrappedJSObject = this;</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineat">@@ -51,17 +52,17 @@ calCalendarManager.prototype = {</span>
<a href="#l35.20"></a><span id="l35.20">         this.mNetworkCalendarCount = 0;</span>
<a href="#l35.21"></a><span id="l35.21">         this.mReadonlyCalendarCount = 0;</span>
<a href="#l35.22"></a><span id="l35.22">         this.mCalendarCount = 0;</span>
<a href="#l35.23"></a><span id="l35.23"> </span>
<a href="#l35.24"></a><span id="l35.24">         Services.obs.addObserver(this, &quot;http-on-modify-request&quot;, false);</span>
<a href="#l35.25"></a><span id="l35.25"> </span>
<a href="#l35.26"></a><span id="l35.26">         // We only add the observer if the pref is set and only check for the</span>
<a href="#l35.27"></a><span id="l35.27">         // pref on startup to avoid checking for every http request</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineminus">-        if (cal.getPrefSafe(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+        if (Preferences.get(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l35.30"></a><span id="l35.30">             Services.obs.addObserver(this, &quot;http-on-examine-response&quot;, false);</span>
<a href="#l35.31"></a><span id="l35.31">         }</span>
<a href="#l35.32"></a><span id="l35.32"> </span>
<a href="#l35.33"></a><span id="l35.33">         aCompleteListener.onResult(null, Components.results.NS_OK);</span>
<a href="#l35.34"></a><span id="l35.34">     },</span>
<a href="#l35.35"></a><span id="l35.35"> </span>
<a href="#l35.36"></a><span id="l35.36">     shutdown: function ccm_shutdown(aCompleteListener) {</span>
<a href="#l35.37"></a><span id="l35.37">         for each (var calendar in this.mCache) {</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineat">@@ -72,17 +73,17 @@ calCalendarManager.prototype = {</span>
<a href="#l35.39"></a><span id="l35.39"> </span>
<a href="#l35.40"></a><span id="l35.40">         Services.obs.removeObserver(this, &quot;http-on-modify-request&quot;);</span>
<a href="#l35.41"></a><span id="l35.41"> </span>
<a href="#l35.42"></a><span id="l35.42">         AddonManager.removeAddonListener(gCalendarManagerAddonListener);</span>
<a href="#l35.43"></a><span id="l35.43"> </span>
<a href="#l35.44"></a><span id="l35.44">         // Remove the observer if the pref is set. This might fail when the</span>
<a href="#l35.45"></a><span id="l35.45">         // user flips the pref, but we assume he is going to restart anyway</span>
<a href="#l35.46"></a><span id="l35.46">         // afterwards.</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineminus">-        if (cal.getPrefSafe(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l35.48"></a><span id="l35.48" class="difflineplus">+        if (Preferences.get(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l35.49"></a><span id="l35.49">             Services.obs.removeObserver(this, &quot;http-on-examine-response&quot;);</span>
<a href="#l35.50"></a><span id="l35.50">         }</span>
<a href="#l35.51"></a><span id="l35.51"> </span>
<a href="#l35.52"></a><span id="l35.52">         aCompleteListener.onResult(null, Components.results.NS_OK);</span>
<a href="#l35.53"></a><span id="l35.53">     },</span>
<a href="#l35.54"></a><span id="l35.54"> </span>
<a href="#l35.55"></a><span id="l35.55"> </span>
<a href="#l35.56"></a><span id="l35.56">     setupOfflineObservers: function ccm_setupOfflineObservers() {</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineat">@@ -162,17 +163,17 @@ calCalendarManager.prototype = {</span>
<a href="#l35.58"></a><span id="l35.58">                 // been removed. Calendar servers might still want to know what</span>
<a href="#l35.59"></a><span id="l35.59">                 // client is used for access, so add our UA String to each</span>
<a href="#l35.60"></a><span id="l35.60">                 // request.</span>
<a href="#l35.61"></a><span id="l35.61">                 let httpChannel = aSubject.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l35.62"></a><span id="l35.62">                 try {</span>
<a href="#l35.63"></a><span id="l35.63">                     // NOTE: For some reason, this observer call doesn't have</span>
<a href="#l35.64"></a><span id="l35.64">                     // the &quot;cal&quot; namespace defined</span>
<a href="#l35.65"></a><span id="l35.65">                     let ua = httpChannel.getRequestHeader(&quot;User-Agent&quot;);</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineminus">-                    let calUAString = getPrefSafe(&quot;calendar.useragent.extra&quot;);</span>
<a href="#l35.67"></a><span id="l35.67" class="difflineplus">+                    let calUAString = Preferences.get(&quot;calendar.useragent.extra&quot;);</span>
<a href="#l35.68"></a><span id="l35.68">                     if (calUAString &amp;&amp; ua.indexOf(calUAString) &lt; 0) {</span>
<a href="#l35.69"></a><span id="l35.69">                         // User-Agent is not a mergeable header. We need to</span>
<a href="#l35.70"></a><span id="l35.70">                         // merge the user agent ourselves.</span>
<a href="#l35.71"></a><span id="l35.71">                         httpChannel.setRequestHeader(&quot;User-Agent&quot;,</span>
<a href="#l35.72"></a><span id="l35.72">                                                      ua + &quot; &quot; + calUAString,</span>
<a href="#l35.73"></a><span id="l35.73">                                                      false);</span>
<a href="#l35.74"></a><span id="l35.74">                     }</span>
<a href="#l35.75"></a><span id="l35.75">                 } catch (e if e.result == Components.results.NS_ERROR_NOT_AVAILABLE) {</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineat">@@ -269,65 +270,65 @@ calCalendarManager.prototype = {</span>
<a href="#l35.77"></a><span id="l35.77">     migrateDB: function calmgr_migrateDB(db) {</span>
<a href="#l35.78"></a><span id="l35.78">         let selectCalendars = db.createStatement(&quot;SELECT * FROM cal_calendars&quot;);</span>
<a href="#l35.79"></a><span id="l35.79">         let selectPrefs = db.createStatement(&quot;SELECT name, value FROM cal_calendars_prefs WHERE calendar = :calendar&quot;);</span>
<a href="#l35.80"></a><span id="l35.80">         try {</span>
<a href="#l35.81"></a><span id="l35.81">             let sortOrder = {};</span>
<a href="#l35.82"></a><span id="l35.82"> </span>
<a href="#l35.83"></a><span id="l35.83">             while (selectCalendars.executeStep()) {</span>
<a href="#l35.84"></a><span id="l35.84">                 let id = cal.getUUID(); // use fresh uuids</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineminus">-                cal.setPref(getPrefBranchFor(id) + &quot;type&quot;, selectCalendars.row.type);</span>
<a href="#l35.86"></a><span id="l35.86" class="difflineminus">-                cal.setPref(getPrefBranchFor(id) + &quot;uri&quot;, selectCalendars.row.uri);</span>
<a href="#l35.87"></a><span id="l35.87" class="difflineplus">+                Preferences.set(getPrefBranchFor(id) + &quot;type&quot;, selectCalendars.row.type);</span>
<a href="#l35.88"></a><span id="l35.88" class="difflineplus">+                Preferences.set(getPrefBranchFor(id) + &quot;uri&quot;, selectCalendars.row.uri);</span>
<a href="#l35.89"></a><span id="l35.89">                 // the former id served as sort position:</span>
<a href="#l35.90"></a><span id="l35.90">                 sortOrder[selectCalendars.row.id] = id;</span>
<a href="#l35.91"></a><span id="l35.91">                 // move over prefs:</span>
<a href="#l35.92"></a><span id="l35.92">                 selectPrefs.params.calendar = selectCalendars.row.id;</span>
<a href="#l35.93"></a><span id="l35.93">                 while (selectPrefs.executeStep()) {</span>
<a href="#l35.94"></a><span id="l35.94">                     let name = selectPrefs.row.name.toLowerCase(); // may come lower case, so force it to be</span>
<a href="#l35.95"></a><span id="l35.95">                     let value = selectPrefs.row.value;</span>
<a href="#l35.96"></a><span id="l35.96">                     switch (name) {</span>
<a href="#l35.97"></a><span id="l35.97">                         case &quot;readonly&quot;:</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineminus">-                            cal.setPref(getPrefBranchFor(id) + &quot;readOnly&quot;, value == &quot;true&quot;);</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+                            Preferences.set(getPrefBranchFor(id) + &quot;readOnly&quot;, value == &quot;true&quot;);</span>
<a href="#l35.100"></a><span id="l35.100">                             break;</span>
<a href="#l35.101"></a><span id="l35.101">                         case &quot;relaxedmode&quot;:</span>
<a href="#l35.102"></a><span id="l35.102" class="difflineminus">-                            cal.setPref(getPrefBranchFor(id) + &quot;relaxedMode&quot;, value == &quot;true&quot;);</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineplus">+                            Preferences.set(getPrefBranchFor(id) + &quot;relaxedMode&quot;, value == &quot;true&quot;);</span>
<a href="#l35.104"></a><span id="l35.104">                             break;</span>
<a href="#l35.105"></a><span id="l35.105">                         case &quot;suppressalarms&quot;:</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineminus">-                            cal.setPref(getPrefBranchFor(id) + &quot;suppressAlarms&quot;, value == &quot;true&quot;);</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineplus">+                            Preferences.set(getPrefBranchFor(id) + &quot;suppressAlarms&quot;, value == &quot;true&quot;);</span>
<a href="#l35.108"></a><span id="l35.108">                             break;</span>
<a href="#l35.109"></a><span id="l35.109">                         case &quot;disabled&quot;:</span>
<a href="#l35.110"></a><span id="l35.110">                         case &quot;cache.supported&quot;:</span>
<a href="#l35.111"></a><span id="l35.111">                         case &quot;auto-enabled&quot;:</span>
<a href="#l35.112"></a><span id="l35.112">                         case &quot;cache.enabled&quot;:</span>
<a href="#l35.113"></a><span id="l35.113">                         case &quot;lightning-main-in-composite&quot;:</span>
<a href="#l35.114"></a><span id="l35.114">                         case &quot;calendar-main-in-composite&quot;:</span>
<a href="#l35.115"></a><span id="l35.115">                         case &quot;lightning-main-default&quot;:</span>
<a href="#l35.116"></a><span id="l35.116">                         case &quot;calendar-main-default&quot;:</span>
<a href="#l35.117"></a><span id="l35.117" class="difflineminus">-                            cal.setPref(getPrefBranchFor(id) + name, value == &quot;true&quot;);</span>
<a href="#l35.118"></a><span id="l35.118" class="difflineplus">+                            Preferences.set(getPrefBranchFor(id) + name, value == &quot;true&quot;);</span>
<a href="#l35.119"></a><span id="l35.119">                             break;</span>
<a href="#l35.120"></a><span id="l35.120">                         case &quot;backup-time&quot;:</span>
<a href="#l35.121"></a><span id="l35.121">                         case &quot;uniquenum&quot;:</span>
<a href="#l35.122"></a><span id="l35.122" class="difflineminus">-                            cal.setPref(getPrefBranchFor(id) + name, Number(value));</span>
<a href="#l35.123"></a><span id="l35.123" class="difflineplus">+                            Preferences.set(getPrefBranchFor(id) + name, Number(value));</span>
<a href="#l35.124"></a><span id="l35.124">                             break;</span>
<a href="#l35.125"></a><span id="l35.125">                         case &quot;name&quot;:</span>
<a href="#l35.126"></a><span id="l35.126" class="difflineminus">-                            cal.setLocalizedPref(getPrefBranchFor(id) + name, value);</span>
<a href="#l35.127"></a><span id="l35.127" class="difflineplus">+                            Preferences.set(getPrefBranchFor(id) + name, value);</span>
<a href="#l35.128"></a><span id="l35.128">                             break;</span>
<a href="#l35.129"></a><span id="l35.129">                         default: // keep as string</span>
<a href="#l35.130"></a><span id="l35.130" class="difflineminus">-                            cal.setPref(getPrefBranchFor(id) + name, value);</span>
<a href="#l35.131"></a><span id="l35.131" class="difflineplus">+                            Preferences.set(getPrefBranchFor(id) + name, value);</span>
<a href="#l35.132"></a><span id="l35.132">                             break;</span>
<a href="#l35.133"></a><span id="l35.133">                     }</span>
<a href="#l35.134"></a><span id="l35.134">                 }</span>
<a href="#l35.135"></a><span id="l35.135">                 selectPrefs.reset();</span>
<a href="#l35.136"></a><span id="l35.136">             }</span>
<a href="#l35.137"></a><span id="l35.137"> </span>
<a href="#l35.138"></a><span id="l35.138">             let sortOrderAr = [];</span>
<a href="#l35.139"></a><span id="l35.139">             for each (let s in sortOrder) {</span>
<a href="#l35.140"></a><span id="l35.140">                 sortOrderAr.push(s);</span>
<a href="#l35.141"></a><span id="l35.141">             }</span>
<a href="#l35.142"></a><span id="l35.142" class="difflineminus">-            cal.setPref(&quot;calendar.list.sortOrder&quot;, sortOrderAr.join(&quot; &quot;));</span>
<a href="#l35.143"></a><span id="l35.143" class="difflineplus">+            Preferences.set(&quot;calendar.list.sortOrder&quot;, sortOrderAr.join(&quot; &quot;));</span>
<a href="#l35.144"></a><span id="l35.144">             flushPrefs();</span>
<a href="#l35.145"></a><span id="l35.145"> </span>
<a href="#l35.146"></a><span id="l35.146">         } finally {</span>
<a href="#l35.147"></a><span id="l35.147">             selectPrefs.reset();</span>
<a href="#l35.148"></a><span id="l35.148">             selectCalendars.reset();</span>
<a href="#l35.149"></a><span id="l35.149">         }</span>
<a href="#l35.150"></a><span id="l35.150">     },</span>
<a href="#l35.151"></a><span id="l35.151"> </span>
<a href="#l35.152"></a><span id="l35.152" class="difflineat">@@ -519,18 +520,18 @@ calCalendarManager.prototype = {</span>
<a href="#l35.153"></a><span id="l35.153">         cal.ASSERT(!calendar.id || !(calendar.id in this.mCache),</span>
<a href="#l35.154"></a><span id="l35.154">                    &quot;[calCalendarManager::registerCalendar] calendar already registered!&quot;,</span>
<a href="#l35.155"></a><span id="l35.155">                    true);</span>
<a href="#l35.156"></a><span id="l35.156"> </span>
<a href="#l35.157"></a><span id="l35.157">         if (!calendar.id) {</span>
<a href="#l35.158"></a><span id="l35.158">             calendar.id = cal.getUUID();</span>
<a href="#l35.159"></a><span id="l35.159">         }</span>
<a href="#l35.160"></a><span id="l35.160"> </span>
<a href="#l35.161"></a><span id="l35.161" class="difflineminus">-        cal.setPref(getPrefBranchFor(calendar.id) + &quot;type&quot;, calendar.type);</span>
<a href="#l35.162"></a><span id="l35.162" class="difflineminus">-        cal.setPref(getPrefBranchFor(calendar.id) + &quot;uri&quot;, calendar.uri.spec);</span>
<a href="#l35.163"></a><span id="l35.163" class="difflineplus">+        Preferences.set(getPrefBranchFor(calendar.id) + &quot;type&quot;, calendar.type);</span>
<a href="#l35.164"></a><span id="l35.164" class="difflineplus">+        Preferences.set(getPrefBranchFor(calendar.id) + &quot;uri&quot;, calendar.uri.spec);</span>
<a href="#l35.165"></a><span id="l35.165"> </span>
<a href="#l35.166"></a><span id="l35.166">         if ((calendar.getProperty(&quot;cache.supported&quot;) !== false) &amp;&amp;</span>
<a href="#l35.167"></a><span id="l35.167">             (calendar.getProperty(&quot;cache.enabled&quot;) ||</span>
<a href="#l35.168"></a><span id="l35.168">              calendar.getProperty(&quot;cache.always&quot;))) {</span>
<a href="#l35.169"></a><span id="l35.169">             calendar = new calCachedCalendar(calendar);</span>
<a href="#l35.170"></a><span id="l35.170">         }</span>
<a href="#l35.171"></a><span id="l35.171"> </span>
<a href="#l35.172"></a><span id="l35.172">         this.setupCalendar(calendar);</span>
<a href="#l35.173"></a><span id="l35.173" class="difflineat">@@ -673,18 +674,18 @@ calCalendarManager.prototype = {</span>
<a href="#l35.174"></a><span id="l35.174"> </span>
<a href="#l35.175"></a><span id="l35.175">             let allCals = {};</span>
<a href="#l35.176"></a><span id="l35.176">             for each (let key in Services.prefs.getChildList(REGISTRY_BRANCH)) { // merge down all keys</span>
<a href="#l35.177"></a><span id="l35.177">                 allCals[key.substring(0, key.indexOf(&quot;.&quot;, REGISTRY_BRANCH.length))] = true;</span>
<a href="#l35.178"></a><span id="l35.178">             }</span>
<a href="#l35.179"></a><span id="l35.179"> </span>
<a href="#l35.180"></a><span id="l35.180">             for (let calBranch in allCals) {</span>
<a href="#l35.181"></a><span id="l35.181">                 let id = calBranch.substring(REGISTRY_BRANCH.length);</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineminus">-                let ctype = cal.getPrefSafe(calBranch + &quot;.type&quot;, null);</span>
<a href="#l35.183"></a><span id="l35.183" class="difflineminus">-                let curi = cal.getPrefSafe(calBranch + &quot;.uri&quot;, null);</span>
<a href="#l35.184"></a><span id="l35.184" class="difflineplus">+                let ctype = Preferences.get(calBranch + &quot;.type&quot;, null);</span>
<a href="#l35.185"></a><span id="l35.185" class="difflineplus">+                let curi = Preferences.get(calBranch + &quot;.uri&quot;, null);</span>
<a href="#l35.186"></a><span id="l35.186"> </span>
<a href="#l35.187"></a><span id="l35.187">                 try {</span>
<a href="#l35.188"></a><span id="l35.188">                     if (!ctype || !curi) { // sanity check</span>
<a href="#l35.189"></a><span id="l35.189">                         Services.prefs.deleteBranch(calBranch + &quot;.&quot;);</span>
<a href="#l35.190"></a><span id="l35.190">                         continue;</span>
<a href="#l35.191"></a><span id="l35.191">                     }</span>
<a href="#l35.192"></a><span id="l35.192"> </span>
<a href="#l35.193"></a><span id="l35.193">                     let uri = cal.makeURL(curi);</span>
<a href="#l35.194"></a><span id="l35.194" class="difflineat">@@ -731,35 +732,30 @@ calCalendarManager.prototype = {</span>
<a href="#l35.195"></a><span id="l35.195">     getCalendarPref_: function(calendar, name) {</span>
<a href="#l35.196"></a><span id="l35.196">         cal.ASSERT(calendar, &quot;Invalid Calendar!&quot;);</span>
<a href="#l35.197"></a><span id="l35.197">         cal.ASSERT(calendar.id !== null, &quot;Calendar id needs to be set!&quot;);</span>
<a href="#l35.198"></a><span id="l35.198">         cal.ASSERT(name &amp;&amp; name.length &gt; 0, &quot;Pref Name must be non-empty!&quot;);</span>
<a href="#l35.199"></a><span id="l35.199"> </span>
<a href="#l35.200"></a><span id="l35.200">         let branch = (getPrefBranchFor(calendar.id) + name);</span>
<a href="#l35.201"></a><span id="l35.201"> </span>
<a href="#l35.202"></a><span id="l35.202">         if ( name === &quot;name&quot; ) {</span>
<a href="#l35.203"></a><span id="l35.203" class="difflineminus">-            return cal.getLocalizedPref(branch, null);</span>
<a href="#l35.204"></a><span id="l35.204" class="difflineplus">+            return Preferences.get(branch, null);</span>
<a href="#l35.205"></a><span id="l35.205">         }</span>
<a href="#l35.206"></a><span id="l35.206" class="difflineminus">-        return cal.getPrefSafe(branch, null);</span>
<a href="#l35.207"></a><span id="l35.207" class="difflineplus">+        return Preferences.get(branch, null);</span>
<a href="#l35.208"></a><span id="l35.208">     },</span>
<a href="#l35.209"></a><span id="l35.209"> </span>
<a href="#l35.210"></a><span id="l35.210">     setCalendarPref_: function(calendar, name, value) {</span>
<a href="#l35.211"></a><span id="l35.211">         cal.ASSERT(calendar, &quot;Invalid Calendar!&quot;);</span>
<a href="#l35.212"></a><span id="l35.212">         cal.ASSERT(calendar.id !== null, &quot;Calendar id needs to be set!&quot;);</span>
<a href="#l35.213"></a><span id="l35.213">         cal.ASSERT(name &amp;&amp; name.length &gt; 0, &quot;Pref Name must be non-empty!&quot;);</span>
<a href="#l35.214"></a><span id="l35.214"> </span>
<a href="#l35.215"></a><span id="l35.215">         let branch = (getPrefBranchFor(calendar.id) + name);</span>
<a href="#l35.216"></a><span id="l35.216" class="difflineminus">-        // Delete before to allow pref-type changes:</span>
<a href="#l35.217"></a><span id="l35.217" class="difflineplus">+        // Delete before to allow pref-type changes, then set the pref.</span>
<a href="#l35.218"></a><span id="l35.218">         Services.prefs.deleteBranch(branch);</span>
<a href="#l35.219"></a><span id="l35.219" class="difflineminus">-</span>
<a href="#l35.220"></a><span id="l35.220" class="difflineminus">-        if ( name === &quot;name&quot; ) {</span>
<a href="#l35.221"></a><span id="l35.221" class="difflineminus">-            cal.setLocalizedPref(branch, value);</span>
<a href="#l35.222"></a><span id="l35.222" class="difflineminus">-        } else {</span>
<a href="#l35.223"></a><span id="l35.223" class="difflineminus">-            cal.setPref(branch, value);</span>
<a href="#l35.224"></a><span id="l35.224" class="difflineminus">-        }</span>
<a href="#l35.225"></a><span id="l35.225" class="difflineplus">+        Preferences.set(branch, value);</span>
<a href="#l35.226"></a><span id="l35.226">     },</span>
<a href="#l35.227"></a><span id="l35.227"> </span>
<a href="#l35.228"></a><span id="l35.228">     deleteCalendarPref_: function(calendar, name) {</span>
<a href="#l35.229"></a><span id="l35.229">         cal.ASSERT(calendar, &quot;Invalid Calendar!&quot;);</span>
<a href="#l35.230"></a><span id="l35.230">         cal.ASSERT(calendar.id !== null, &quot;Calendar id needs to be set!&quot;);</span>
<a href="#l35.231"></a><span id="l35.231">         cal.ASSERT(name &amp;&amp; name.length &gt; 0, &quot;Pref Name must be non-empty!&quot;);</span>
<a href="#l35.232"></a><span id="l35.232">         Services.prefs.deleteBranch(getPrefBranchFor(calendar.id) + name);</span>
<a href="#l35.233"></a><span id="l35.233">     },</span>
<a href="#l35.234"></a><span id="l35.234" class="difflineat">@@ -838,17 +834,17 @@ calMgrCalendarObserver.prototype = {</span>
<a href="#l35.235"></a><span id="l35.235">     },</span>
<a href="#l35.236"></a><span id="l35.236"> </span>
<a href="#l35.237"></a><span id="l35.237">     changeCalendarCache: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l35.238"></a><span id="l35.238">         aOldValue = aOldValue || false;</span>
<a href="#l35.239"></a><span id="l35.239">         aValue = aValue || false;</span>
<a href="#l35.240"></a><span id="l35.240"> </span>
<a href="#l35.241"></a><span id="l35.241">         if (aOldValue != aValue) {</span>
<a href="#l35.242"></a><span id="l35.242">             // Try to find the current sort order</span>
<a href="#l35.243"></a><span id="l35.243" class="difflineminus">-            let sortOrderPref = cal.getPrefSafe(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l35.244"></a><span id="l35.244" class="difflineplus">+            let sortOrderPref = Preferences.get(&quot;calendar.list.sortOrder&quot;, &quot;&quot;).split(&quot; &quot;);</span>
<a href="#l35.245"></a><span id="l35.245">             let initialSortOrderPos = null;</span>
<a href="#l35.246"></a><span id="l35.246">             for (let i = 0; i &lt; sortOrderPref.length; ++i) {</span>
<a href="#l35.247"></a><span id="l35.247">                 if (sortOrderPref[i] == aCalendar.id) {</span>
<a href="#l35.248"></a><span id="l35.248">                     initialSortOrderPos = i;</span>
<a href="#l35.249"></a><span id="l35.249">                 }</span>
<a href="#l35.250"></a><span id="l35.250">             }</span>
<a href="#l35.251"></a><span id="l35.251">             // Enabling or disabling cache on a calendar re-creates</span>
<a href="#l35.252"></a><span id="l35.252">             // it so the registerCalendar call can wrap/unwrap the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l36.4"></a><span id="l36.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l36.5"></a><span id="l36.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l36.6"></a><span id="l36.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l36.9"></a><span id="l36.9"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l36.10"></a><span id="l36.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l36.11"></a><span id="l36.11"> </span>
<a href="#l36.12"></a><span id="l36.12"> const nsIScriptableDateFormat = Components.interfaces.nsIScriptableDateFormat;</span>
<a href="#l36.13"></a><span id="l36.13"> </span>
<a href="#l36.14"></a><span id="l36.14"> function calDateTimeFormatter() {</span>
<a href="#l36.15"></a><span id="l36.15">     this.wrappedJSObject = this;</span>
<a href="#l36.16"></a><span id="l36.16">     this.mDateStringBundle = Services.strings.createBundle(&quot;chrome://calendar/locale/dateFormat.properties&quot;);</span>
<a href="#l36.17"></a><span id="l36.17"> </span>
<a href="#l36.18"></a><span id="l36.18">     this.mDateService =</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineat">@@ -73,17 +74,17 @@ calDateTimeFormatter.prototype = {</span>
<a href="#l36.20"></a><span id="l36.20">         classID: calDateTimeFormatterClassID,</span>
<a href="#l36.21"></a><span id="l36.21">         contractID: &quot;@mozilla.org/calendar/datetime-formatter;1&quot;,</span>
<a href="#l36.22"></a><span id="l36.22">         classDescription: &quot;Formats Dates and Times&quot;,</span>
<a href="#l36.23"></a><span id="l36.23">         interfaces: calDateTimeFormatterInterfaces,</span>
<a href="#l36.24"></a><span id="l36.24">     }),</span>
<a href="#l36.25"></a><span id="l36.25"> </span>
<a href="#l36.26"></a><span id="l36.26">     formatDate: function formatDate(aDate) {</span>
<a href="#l36.27"></a><span id="l36.27">         // Format the date using user's format preference (long or short)</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineminus">-        let format = cal.getPrefSafe(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineplus">+        let format = Preferences.get(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l36.30"></a><span id="l36.30">         return (format == 0 ? this.formatDateLong(aDate) : this.formatDateShort(aDate));</span>
<a href="#l36.31"></a><span id="l36.31">     },</span>
<a href="#l36.32"></a><span id="l36.32"> </span>
<a href="#l36.33"></a><span id="l36.33">     formatDateShort: function formatDateShort(aDate) {</span>
<a href="#l36.34"></a><span id="l36.34">         return this.mDateService.FormatDate(&quot;&quot;,</span>
<a href="#l36.35"></a><span id="l36.35">                                             nsIScriptableDateFormat.dateFormatShort,</span>
<a href="#l36.36"></a><span id="l36.36">                                             aDate.year,</span>
<a href="#l36.37"></a><span id="l36.37">                                             aDate.month + 1,</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineat">@@ -128,17 +129,17 @@ calDateTimeFormatter.prototype = {</span>
<a href="#l36.39"></a><span id="l36.39">                                             aDate.minute,</span>
<a href="#l36.40"></a><span id="l36.40">                                             0);</span>
<a href="#l36.41"></a><span id="l36.41">     },</span>
<a href="#l36.42"></a><span id="l36.42"> </span>
<a href="#l36.43"></a><span id="l36.43">     formatDateTime: function formatDateTime(aDate) {</span>
<a href="#l36.44"></a><span id="l36.44">         let formattedDate = this.formatDate(aDate);</span>
<a href="#l36.45"></a><span id="l36.45">         let formattedTime = this.formatTime(aDate);</span>
<a href="#l36.46"></a><span id="l36.46"> </span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-        let timeBeforeDate = cal.getPrefSafe(&quot;calendar.date.formatTimeBeforeDate&quot;, false);</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineplus">+        let timeBeforeDate = Preferences.get(&quot;calendar.date.formatTimeBeforeDate&quot;, false);</span>
<a href="#l36.49"></a><span id="l36.49">         if (timeBeforeDate) {</span>
<a href="#l36.50"></a><span id="l36.50">             return formattedTime + &quot; &quot; + formattedDate;</span>
<a href="#l36.51"></a><span id="l36.51">         } else {</span>
<a href="#l36.52"></a><span id="l36.52">             return formattedDate + &quot; &quot; + formattedTime;</span>
<a href="#l36.53"></a><span id="l36.53">         }</span>
<a href="#l36.54"></a><span id="l36.54">     },</span>
<a href="#l36.55"></a><span id="l36.55"> </span>
<a href="#l36.56"></a><span id="l36.56">     formatTimeInterval: function formatTimeInterval(aStartDate, aEndDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l37.4"></a><span id="l37.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l37.5"></a><span id="l37.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l37.6"></a><span id="l37.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l37.7"></a><span id="l37.7"> </span>
<a href="#l37.8"></a><span id="l37.8" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l37.9"></a><span id="l37.9" class="difflineplus">+</span>
<a href="#l37.10"></a><span id="l37.10"> /**</span>
<a href="#l37.11"></a><span id="l37.11">  * Object that contains a set of filter properties that may be used by a calFilter object</span>
<a href="#l37.12"></a><span id="l37.12">  * to filter a set of items.</span>
<a href="#l37.13"></a><span id="l37.13">  * Supported filter properties:</span>
<a href="#l37.14"></a><span id="l37.14">  *   start, end:   Specifies the relative date range to use when calculating the filter date</span>
<a href="#l37.15"></a><span id="l37.15">  *               range. The relative date range may relative to the current date and time, the</span>
<a href="#l37.16"></a><span id="l37.16">  *               currently selected date, or the dates range of the current view. The actual</span>
<a href="#l37.17"></a><span id="l37.17">  *               date range used to filter items will be calculated by the calFilter object</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineat">@@ -154,17 +156,17 @@ calFilterProperties.prototype = {</span>
<a href="#l37.19"></a><span id="l37.19">  * Object that allows filtering of a set of items using a set of filter properties. A set</span>
<a href="#l37.20"></a><span id="l37.20">  * of property filters may be defined by a filter name, which may then be used to apply</span>
<a href="#l37.21"></a><span id="l37.21">  * the defined filter properties. A set of commonly used property filters are predefined.</span>
<a href="#l37.22"></a><span id="l37.22">  */</span>
<a href="#l37.23"></a><span id="l37.23"> function calFilter() {</span>
<a href="#l37.24"></a><span id="l37.24">     this.wrappedJSObject = this;</span>
<a href="#l37.25"></a><span id="l37.25">     this.mFilterProperties = new calFilterProperties();</span>
<a href="#l37.26"></a><span id="l37.26">     this.initDefinedFilters();</span>
<a href="#l37.27"></a><span id="l37.27" class="difflineminus">-    this.mMaxIterations = cal.getPrefSafe(&quot;calendar.filter.maxiterations&quot;, 50);</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineplus">+    this.mMaxIterations = Preferences.get(&quot;calendar.filter.maxiterations&quot;, 50);</span>
<a href="#l37.29"></a><span id="l37.29"> }</span>
<a href="#l37.30"></a><span id="l37.30"> </span>
<a href="#l37.31"></a><span id="l37.31"> calFilter.prototype = {</span>
<a href="#l37.32"></a><span id="l37.32">     mStartDate: null,</span>
<a href="#l37.33"></a><span id="l37.33">     mEndDate: null,</span>
<a href="#l37.34"></a><span id="l37.34">     mSelectedDate: null,</span>
<a href="#l37.35"></a><span id="l37.35">     mFilterText: &quot;&quot;,</span>
<a href="#l37.36"></a><span id="l37.36">     mDefinedFilters: {},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l38.4"></a><span id="l38.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l38.5"></a><span id="l38.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l38.6"></a><span id="l38.6"> </span>
<a href="#l38.7"></a><span id="l38.7"> Components.utils.import(&quot;resource://gre/modules/AddonManager.jsm&quot;);</span>
<a href="#l38.8"></a><span id="l38.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l38.9"></a><span id="l38.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l38.10"></a><span id="l38.10"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l38.11"></a><span id="l38.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l38.13"></a><span id="l38.13"> Components.utils.import(&quot;resource://calendar/modules/ical.js&quot;);</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15"> function calStringEnumerator(stringArray) {</span>
<a href="#l38.16"></a><span id="l38.16">     this.mIndex = 0;</span>
<a href="#l38.17"></a><span id="l38.17">     this.mStringArray = stringArray;</span>
<a href="#l38.18"></a><span id="l38.18"> }</span>
<a href="#l38.19"></a><span id="l38.19"> calStringEnumerator.prototype = {</span>
<a href="#l38.20"></a><span id="l38.20">     // nsIUTF8StringEnumerator:</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineat">@@ -84,17 +85,17 @@ calTimezoneService.prototype = {</span>
<a href="#l38.22"></a><span id="l38.22">             cal.ERROR(&quot;Error closing timezone database: &quot; + e);</span>
<a href="#l38.23"></a><span id="l38.23">         }</span>
<a href="#l38.24"></a><span id="l38.24"> </span>
<a href="#l38.25"></a><span id="l38.25">         aCompleteListener.onResult(null, Components.results.NS_OK);</span>
<a href="#l38.26"></a><span id="l38.26">     },</span>
<a href="#l38.27"></a><span id="l38.27"> </span>
<a href="#l38.28"></a><span id="l38.28">     get UTC() {</span>
<a href="#l38.29"></a><span id="l38.29">         if (!this.mUTC) {</span>
<a href="#l38.30"></a><span id="l38.30" class="difflineminus">-            if (cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineplus">+            if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l38.32"></a><span id="l38.32">                 this.mUTC = new calICALJSTimezone(ICAL.Timezone.utcTimezone);</span>
<a href="#l38.33"></a><span id="l38.33">             } else {</span>
<a href="#l38.34"></a><span id="l38.34">                 this.mUTC = new calLibicalTimezone(&quot;UTC&quot;, null, &quot;&quot;, &quot;&quot;);</span>
<a href="#l38.35"></a><span id="l38.35">                 this.mUTC.mUTC = true;</span>
<a href="#l38.36"></a><span id="l38.36">             }</span>
<a href="#l38.37"></a><span id="l38.37"> </span>
<a href="#l38.38"></a><span id="l38.38">             // These UTC aliases are taken from wikipedia, included in case</span>
<a href="#l38.39"></a><span id="l38.39">             // other clients make use of them without specifying a definition.</span>
<a href="#l38.40"></a><span id="l38.40" class="difflineat">@@ -108,17 +109,17 @@ calTimezoneService.prototype = {</span>
<a href="#l38.41"></a><span id="l38.41">             }</span>
<a href="#l38.42"></a><span id="l38.42">         }</span>
<a href="#l38.43"></a><span id="l38.43"> </span>
<a href="#l38.44"></a><span id="l38.44">         return this.mUTC;</span>
<a href="#l38.45"></a><span id="l38.45">     },</span>
<a href="#l38.46"></a><span id="l38.46"> </span>
<a href="#l38.47"></a><span id="l38.47">     get floating() {</span>
<a href="#l38.48"></a><span id="l38.48">         if (!this.mFloating) {</span>
<a href="#l38.49"></a><span id="l38.49" class="difflineminus">-            if (cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l38.50"></a><span id="l38.50" class="difflineplus">+            if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l38.51"></a><span id="l38.51">                 this.mFloating = new calICALJSTimezone(ICAL.Timezone.localTimezone);</span>
<a href="#l38.52"></a><span id="l38.52">             } else {</span>
<a href="#l38.53"></a><span id="l38.53">                 this.mFloating = new calLibicalTimezone(&quot;floating&quot;, null, &quot;&quot;, &quot;&quot;);</span>
<a href="#l38.54"></a><span id="l38.54">                 this.mFloating.isFloating = true;</span>
<a href="#l38.55"></a><span id="l38.55">             }</span>
<a href="#l38.56"></a><span id="l38.56">             this.mTimezoneCache.floating = this.mFloating;</span>
<a href="#l38.57"></a><span id="l38.57">         }</span>
<a href="#l38.58"></a><span id="l38.58"> </span>
<a href="#l38.59"></a><span id="l38.59" class="difflineat">@@ -242,17 +243,17 @@ calTimezoneService.prototype = {</span>
<a href="#l38.60"></a><span id="l38.60">         var tz = this.mTimezoneCache[tzid];</span>
<a href="#l38.61"></a><span id="l38.61">         if (!tz &amp;&amp; !this.mBlacklist[tzid]) {</span>
<a href="#l38.62"></a><span id="l38.62">             this.mSelectByTzid.params.tzid = tzid;</span>
<a href="#l38.63"></a><span id="l38.63">             if (this.mSelectByTzid.executeStep()) {</span>
<a href="#l38.64"></a><span id="l38.64">                 var row = this.mSelectByTzid.row;</span>
<a href="#l38.65"></a><span id="l38.65">                 var alias = row.alias;</span>
<a href="#l38.66"></a><span id="l38.66">                 if (alias &amp;&amp; alias.length &gt; 0) {</span>
<a href="#l38.67"></a><span id="l38.67">                     tz = alias; // resolve later</span>
<a href="#l38.68"></a><span id="l38.68" class="difflineminus">-                } else if (cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l38.69"></a><span id="l38.69" class="difflineplus">+                } else if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l38.70"></a><span id="l38.70">                     let parsedComp = ICAL.parse(&quot;BEGIN:VCALENDAR\r\n&quot; + row.component + &quot;\r\nEND:VCALENDAR&quot;);</span>
<a href="#l38.71"></a><span id="l38.71"> </span>
<a href="#l38.72"></a><span id="l38.72">                     let icalComp = new ICAL.Component(parsedComp[1]);</span>
<a href="#l38.73"></a><span id="l38.73">                     let tzComp = icalComp.getFirstSubcomponent(&quot;vtimezone&quot;);</span>
<a href="#l38.74"></a><span id="l38.74">                     tz = new calICALJSTimezone(ICAL.Timezone.fromData({</span>
<a href="#l38.75"></a><span id="l38.75">                         tzid: row.tzid,</span>
<a href="#l38.76"></a><span id="l38.76">                         component: tzComp,</span>
<a href="#l38.77"></a><span id="l38.77">                         latitude: row.latitude,</span>
<a href="#l38.78"></a><span id="l38.78" class="difflineat">@@ -292,31 +293,31 @@ calTimezoneService.prototype = {</span>
<a href="#l38.79"></a><span id="l38.79">     },</span>
<a href="#l38.80"></a><span id="l38.80"> </span>
<a href="#l38.81"></a><span id="l38.81">     get version() {</span>
<a href="#l38.82"></a><span id="l38.82">         return this.mVersion;</span>
<a href="#l38.83"></a><span id="l38.83">     },</span>
<a href="#l38.84"></a><span id="l38.84"> </span>
<a href="#l38.85"></a><span id="l38.85">     get defaultTimezone() {</span>
<a href="#l38.86"></a><span id="l38.86">         if (!this.mDefaultTimezone) {</span>
<a href="#l38.87"></a><span id="l38.87" class="difflineminus">-            var prefTzid = cal.getPrefSafe(&quot;calendar.timezone.local&quot;, null);</span>
<a href="#l38.88"></a><span id="l38.88" class="difflineplus">+            var prefTzid = Preferences.get(&quot;calendar.timezone.local&quot;, null);</span>
<a href="#l38.89"></a><span id="l38.89">             var tzid = prefTzid;</span>
<a href="#l38.90"></a><span id="l38.90">             if (!tzid) {</span>
<a href="#l38.91"></a><span id="l38.91">                 try {</span>
<a href="#l38.92"></a><span id="l38.92">                     tzid = guessSystemTimezone();</span>
<a href="#l38.93"></a><span id="l38.93">                 } catch (e) {</span>
<a href="#l38.94"></a><span id="l38.94">                     cal.WARN(&quot;An exception occurred guessing the system timezone, trying UTC. Exception: &quot; + e);</span>
<a href="#l38.95"></a><span id="l38.95">                     tzid = &quot;UTC&quot;;</span>
<a href="#l38.96"></a><span id="l38.96">                 }</span>
<a href="#l38.97"></a><span id="l38.97">             }</span>
<a href="#l38.98"></a><span id="l38.98">             this.mDefaultTimezone = this.getTimezone(tzid);</span>
<a href="#l38.99"></a><span id="l38.99">             cal.ASSERT(this.mDefaultTimezone, &quot;Timezone not found: &quot; + tzid);</span>
<a href="#l38.100"></a><span id="l38.100">             // Update prefs if necessary:</span>
<a href="#l38.101"></a><span id="l38.101">             if (this.mDefaultTimezone &amp;&amp; this.mDefaultTimezone.tzid != prefTzid) {</span>
<a href="#l38.102"></a><span id="l38.102" class="difflineminus">-                cal.setPref(&quot;calendar.timezone.local&quot;, this.mDefaultTimezone.tzid);</span>
<a href="#l38.103"></a><span id="l38.103" class="difflineplus">+                Preferences.set(&quot;calendar.timezone.local&quot;, this.mDefaultTimezone.tzid);</span>
<a href="#l38.104"></a><span id="l38.104">             }</span>
<a href="#l38.105"></a><span id="l38.105"> </span>
<a href="#l38.106"></a><span id="l38.106">             // We need to observe the timezone preference to update the default</span>
<a href="#l38.107"></a><span id="l38.107">             // timezone if needed.</span>
<a href="#l38.108"></a><span id="l38.108">             this.setupObservers();</span>
<a href="#l38.109"></a><span id="l38.109">         }</span>
<a href="#l38.110"></a><span id="l38.110">         return this.mDefaultTimezone;</span>
<a href="#l38.111"></a><span id="l38.111">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l39.4"></a><span id="l39.4"> /* This file contains commonly used functions in a centralized place so that</span>
<a href="#l39.5"></a><span id="l39.5">  * various components (and other js scopes) don't need to replicate them. Note</span>
<a href="#l39.6"></a><span id="l39.6">  * that loading this file twice in the same scope will throw errors.</span>
<a href="#l39.7"></a><span id="l39.7">  */</span>
<a href="#l39.8"></a><span id="l39.8"> </span>
<a href="#l39.9"></a><span id="l39.9"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l39.10"></a><span id="l39.10"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l39.11"></a><span id="l39.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l39.13"></a><span id="l39.13"> </span>
<a href="#l39.14"></a><span id="l39.14"> function _calIcalCreator(cid, iid) {</span>
<a href="#l39.15"></a><span id="l39.15">     return function(icalString) {</span>
<a href="#l39.16"></a><span id="l39.16">         let thing = Components.classes[cid].createInstance(iid);</span>
<a href="#l39.17"></a><span id="l39.17">         if (icalString) {</span>
<a href="#l39.18"></a><span id="l39.18">             thing.icalString = icalString;</span>
<a href="#l39.19"></a><span id="l39.19">         }</span>
<a href="#l39.20"></a><span id="l39.20">         return thing;</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineat">@@ -126,29 +127,29 @@ function saveRecentTimezone(aTzid) {</span>
<a href="#l39.22"></a><span id="l39.22">     let recentTimezones = getRecentTimezones();</span>
<a href="#l39.23"></a><span id="l39.23">     const MAX_RECENT_TIMEZONES = 5; // We don't need a pref for *everything*.</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25">     if (aTzid != calendarDefaultTimezone().tzid &amp;&amp;</span>
<a href="#l39.26"></a><span id="l39.26">         recentTimezones.indexOf(aTzid) &lt; 0) {</span>
<a href="#l39.27"></a><span id="l39.27">         // Add the timezone if its not already the default timezone</span>
<a href="#l39.28"></a><span id="l39.28">         recentTimezones.unshift(aTzid);</span>
<a href="#l39.29"></a><span id="l39.29">         recentTimezones.splice(MAX_RECENT_TIMEZONES);</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">-        cal.setPref(&quot;calendar.timezone.recent&quot;, JSON.stringify(recentTimezones));</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineplus">+        Preferences.set(&quot;calendar.timezone.recent&quot;, JSON.stringify(recentTimezones));</span>
<a href="#l39.32"></a><span id="l39.32">     }</span>
<a href="#l39.33"></a><span id="l39.33"> }</span>
<a href="#l39.34"></a><span id="l39.34"> </span>
<a href="#l39.35"></a><span id="l39.35"> /**</span>
<a href="#l39.36"></a><span id="l39.36">  * Gets the list of recent timezones. Optionally retuns the list as</span>
<a href="#l39.37"></a><span id="l39.37">  * calITimezones.</span>
<a href="#l39.38"></a><span id="l39.38">  *</span>
<a href="#l39.39"></a><span id="l39.39">  * @param aConvertZones     (optional) If true, return calITimezones instead</span>
<a href="#l39.40"></a><span id="l39.40">  * @return                  An array of timezone ids or calITimezones.</span>
<a href="#l39.41"></a><span id="l39.41">  */</span>
<a href="#l39.42"></a><span id="l39.42"> function getRecentTimezones(aConvertZones) {</span>
<a href="#l39.43"></a><span id="l39.43" class="difflineminus">-    let recentTimezones = JSON.parse(cal.getPrefSafe(&quot;calendar.timezone.recent&quot;, &quot;[]&quot;) || &quot;[]&quot;);</span>
<a href="#l39.44"></a><span id="l39.44" class="difflineplus">+    let recentTimezones = JSON.parse(Preferences.get(&quot;calendar.timezone.recent&quot;, &quot;[]&quot;) || &quot;[]&quot;);</span>
<a href="#l39.45"></a><span id="l39.45">     if (!Array.isArray(recentTimezones)) {</span>
<a href="#l39.46"></a><span id="l39.46">         recentTimezones = [];</span>
<a href="#l39.47"></a><span id="l39.47">     }</span>
<a href="#l39.48"></a><span id="l39.48"> </span>
<a href="#l39.49"></a><span id="l39.49">     let tzService = cal.getTimezoneService();</span>
<a href="#l39.50"></a><span id="l39.50">     if (aConvertZones) {</span>
<a href="#l39.51"></a><span id="l39.51">         let oldZonesLength = recentTimezones.length;</span>
<a href="#l39.52"></a><span id="l39.52">         for (let i = 0; i &lt; recentTimezones.length; i++) {</span>
<a href="#l39.53"></a><span id="l39.53" class="difflineat">@@ -161,17 +162,17 @@ function getRecentTimezones(aConvertZone</span>
<a href="#l39.54"></a><span id="l39.54">                 // Replace id with found timezone</span>
<a href="#l39.55"></a><span id="l39.55">                 recentTimezones[i] = tz;</span>
<a href="#l39.56"></a><span id="l39.56">             }</span>
<a href="#l39.57"></a><span id="l39.57">         }</span>
<a href="#l39.58"></a><span id="l39.58"> </span>
<a href="#l39.59"></a><span id="l39.59">         if (oldZonesLength != recentTimezones.length) {</span>
<a href="#l39.60"></a><span id="l39.60">             // Looks like the one or other timezone dropped out. Go ahead and</span>
<a href="#l39.61"></a><span id="l39.61">             // modify the pref.</span>
<a href="#l39.62"></a><span id="l39.62" class="difflineminus">-            cal.setPref(&quot;calendar.timezone.recent&quot;, JSON.stringify(recentTimezones));</span>
<a href="#l39.63"></a><span id="l39.63" class="difflineplus">+            Preferences.set(&quot;calendar.timezone.recent&quot;, JSON.stringify(recentTimezones));</span>
<a href="#l39.64"></a><span id="l39.64">         }</span>
<a href="#l39.65"></a><span id="l39.65">     }</span>
<a href="#l39.66"></a><span id="l39.66">     return recentTimezones;</span>
<a href="#l39.67"></a><span id="l39.67"> }</span>
<a href="#l39.68"></a><span id="l39.68"> </span>
<a href="#l39.69"></a><span id="l39.69"> /**</span>
<a href="#l39.70"></a><span id="l39.70">  * Format the given string to work inside a CSS rule selector</span>
<a href="#l39.71"></a><span id="l39.71">  * (and as part of a non-unicode preference key).</span>
<a href="#l39.72"></a><span id="l39.72" class="difflineat">@@ -453,133 +454,120 @@ function isToDo(aObject) {</span>
<a href="#l39.73"></a><span id="l39.73">  * Normal get*Pref calls will throw if the pref is undefined.  This function</span>
<a href="#l39.74"></a><span id="l39.74">  * will get a bool, int, or string pref.  If the pref is undefined, it will</span>
<a href="#l39.75"></a><span id="l39.75">  * return aDefault.</span>
<a href="#l39.76"></a><span id="l39.76">  *</span>
<a href="#l39.77"></a><span id="l39.77">  * @param aPrefName   the (full) name of preference to get</span>
<a href="#l39.78"></a><span id="l39.78">  * @param aDefault    (optional) the value to return if the pref is undefined</span>
<a href="#l39.79"></a><span id="l39.79">  */</span>
<a href="#l39.80"></a><span id="l39.80"> function getPrefSafe(aPrefName, aDefault) {</span>
<a href="#l39.81"></a><span id="l39.81" class="difflineminus">-    const nsIPrefBranch = Components.interfaces.nsIPrefBranch;</span>
<a href="#l39.82"></a><span id="l39.82" class="difflineminus">-    const prefB = Services.prefs;</span>
<a href="#l39.83"></a><span id="l39.83" class="difflineminus">-    // Since bug 193332 does not fix the current branch, calling get*Pref will</span>
<a href="#l39.84"></a><span id="l39.84" class="difflineminus">-    // throw NS_ERROR_UNEXPECTED if clearUserPref() was called and there is no</span>
<a href="#l39.85"></a><span id="l39.85" class="difflineminus">-    // default value. To work around that, catch the exception.</span>
<a href="#l39.86"></a><span id="l39.86" class="difflineminus">-    try {</span>
<a href="#l39.87"></a><span id="l39.87" class="difflineminus">-        switch (prefB.getPrefType(aPrefName)) {</span>
<a href="#l39.88"></a><span id="l39.88" class="difflineminus">-            case nsIPrefBranch.PREF_BOOL:</span>
<a href="#l39.89"></a><span id="l39.89" class="difflineminus">-                return prefB.getBoolPref(aPrefName);</span>
<a href="#l39.90"></a><span id="l39.90" class="difflineminus">-            case nsIPrefBranch.PREF_INT:</span>
<a href="#l39.91"></a><span id="l39.91" class="difflineminus">-                return prefB.getIntPref(aPrefName);</span>
<a href="#l39.92"></a><span id="l39.92" class="difflineminus">-            case nsIPrefBranch.PREF_STRING:</span>
<a href="#l39.93"></a><span id="l39.93" class="difflineminus">-                return prefB.getCharPref(aPrefName);</span>
<a href="#l39.94"></a><span id="l39.94" class="difflineminus">-            default: // includes nsIPrefBranch.PREF_INVALID</span>
<a href="#l39.95"></a><span id="l39.95" class="difflineminus">-                return aDefault;</span>
<a href="#l39.96"></a><span id="l39.96" class="difflineminus">-        }</span>
<a href="#l39.97"></a><span id="l39.97" class="difflineminus">-    } catch (e) {</span>
<a href="#l39.98"></a><span id="l39.98" class="difflineminus">-        return aDefault;</span>
<a href="#l39.99"></a><span id="l39.99" class="difflineplus">+    if (!getPrefSafe.warningIssued) {</span>
<a href="#l39.100"></a><span id="l39.100" class="difflineplus">+        cal.WARN(&quot;Use of getPrefSafe() is deprecated and will be removed &quot; +</span>
<a href="#l39.101"></a><span id="l39.101" class="difflineplus">+                 &quot;with the next release. Use Preferences.get() instead.\n&quot; +</span>
<a href="#l39.102"></a><span id="l39.102" class="difflineplus">+                 cal.STACK(10));</span>
<a href="#l39.103"></a><span id="l39.103" class="difflineplus">+        getPrefSafe.warningIssued = true;</span>
<a href="#l39.104"></a><span id="l39.104">     }</span>
<a href="#l39.105"></a><span id="l39.105" class="difflineplus">+</span>
<a href="#l39.106"></a><span id="l39.106" class="difflineplus">+    return Preferences.get(aPrefName, aDefault);</span>
<a href="#l39.107"></a><span id="l39.107"> }</span>
<a href="#l39.108"></a><span id="l39.108"> </span>
<a href="#l39.109"></a><span id="l39.109"> /**</span>
<a href="#l39.110"></a><span id="l39.110">  * Wrapper for setting prefs of various types.</span>
<a href="#l39.111"></a><span id="l39.111">  *</span>
<a href="#l39.112"></a><span id="l39.112">  * @param aPrefName   the (full) name of preference to set</span>
<a href="#l39.113"></a><span id="l39.113">  * @param aPrefValue  the value to set the pref to</span>
<a href="#l39.114"></a><span id="l39.114">  * @param aPrefType   (optional) the type of preference to set.</span>
<a href="#l39.115"></a><span id="l39.115">  *                    Valid values are: BOOL, INT, and CHAR</span>
<a href="#l39.116"></a><span id="l39.116">  */</span>
<a href="#l39.117"></a><span id="l39.117"> function setPref(aPrefName, aPrefValue, aPrefType) {</span>
<a href="#l39.118"></a><span id="l39.118" class="difflineminus">-    if (!aPrefType) {</span>
<a href="#l39.119"></a><span id="l39.119" class="difflineminus">-        switch (typeof(aPrefValue)) {</span>
<a href="#l39.120"></a><span id="l39.120" class="difflineminus">-            case &quot;boolean&quot;:</span>
<a href="#l39.121"></a><span id="l39.121" class="difflineminus">-                aPrefType = &quot;BOOL&quot;;</span>
<a href="#l39.122"></a><span id="l39.122" class="difflineminus">-                break;</span>
<a href="#l39.123"></a><span id="l39.123" class="difflineminus">-            case &quot;number&quot;: // xxx think: includes non-int numbers, too</span>
<a href="#l39.124"></a><span id="l39.124" class="difflineminus">-                aPrefType = &quot;INT&quot;;</span>
<a href="#l39.125"></a><span id="l39.125" class="difflineminus">-                break;</span>
<a href="#l39.126"></a><span id="l39.126" class="difflineminus">-            default:</span>
<a href="#l39.127"></a><span id="l39.127" class="difflineminus">-                aPrefType = &quot;CHAR&quot;;</span>
<a href="#l39.128"></a><span id="l39.128" class="difflineminus">-                break;</span>
<a href="#l39.129"></a><span id="l39.129" class="difflineminus">-        }</span>
<a href="#l39.130"></a><span id="l39.130" class="difflineplus">+    if (!setPref.warningIssued) {</span>
<a href="#l39.131"></a><span id="l39.131" class="difflineplus">+        cal.WARN(&quot;Use of setPref() is deprecated and will be removed &quot; +</span>
<a href="#l39.132"></a><span id="l39.132" class="difflineplus">+                 &quot;with the next release. Use Preferences.set() instead.\n&quot; +</span>
<a href="#l39.133"></a><span id="l39.133" class="difflineplus">+                 cal.STACK(10));</span>
<a href="#l39.134"></a><span id="l39.134" class="difflineplus">+        setPref.warningIssued = true;</span>
<a href="#l39.135"></a><span id="l39.135">     }</span>
<a href="#l39.136"></a><span id="l39.136" class="difflineminus">-    switch (aPrefType) {</span>
<a href="#l39.137"></a><span id="l39.137" class="difflineminus">-        case &quot;BOOL&quot;:</span>
<a href="#l39.138"></a><span id="l39.138" class="difflineminus">-            Services.prefs.setBoolPref(aPrefName, aPrefValue);</span>
<a href="#l39.139"></a><span id="l39.139" class="difflineminus">-            break;</span>
<a href="#l39.140"></a><span id="l39.140" class="difflineminus">-        case &quot;INT&quot;:</span>
<a href="#l39.141"></a><span id="l39.141" class="difflineminus">-            Services.prefs.setIntPref(aPrefName, aPrefValue);</span>
<a href="#l39.142"></a><span id="l39.142" class="difflineminus">-            break;</span>
<a href="#l39.143"></a><span id="l39.143" class="difflineminus">-        case &quot;CHAR&quot;:</span>
<a href="#l39.144"></a><span id="l39.144" class="difflineminus">-            Services.prefs.setCharPref(aPrefName, aPrefValue);</span>
<a href="#l39.145"></a><span id="l39.145" class="difflineminus">-            break;</span>
<a href="#l39.146"></a><span id="l39.146" class="difflineplus">+</span>
<a href="#l39.147"></a><span id="l39.147" class="difflineplus">+    let prefValue = aPrefValue;</span>
<a href="#l39.148"></a><span id="l39.148" class="difflineplus">+</span>
<a href="#l39.149"></a><span id="l39.149" class="difflineplus">+    if (aPrefType == &quot;BOOL&quot;) {</span>
<a href="#l39.150"></a><span id="l39.150" class="difflineplus">+        prefValue = Boolean(prefValue);</span>
<a href="#l39.151"></a><span id="l39.151" class="difflineplus">+    } else if (aPrefType == &quot;INT&quot;) {</span>
<a href="#l39.152"></a><span id="l39.152" class="difflineplus">+        prefValue = Number(prefValue);</span>
<a href="#l39.153"></a><span id="l39.153" class="difflineplus">+    } else if (aPrefType == &quot;CHAR&quot;) {</span>
<a href="#l39.154"></a><span id="l39.154" class="difflineplus">+        prefValue = String(prefValue);</span>
<a href="#l39.155"></a><span id="l39.155">     }</span>
<a href="#l39.156"></a><span id="l39.156" class="difflineplus">+</span>
<a href="#l39.157"></a><span id="l39.157" class="difflineplus">+    return Preferences.set(aPrefName, prefValue);</span>
<a href="#l39.158"></a><span id="l39.158"> }</span>
<a href="#l39.159"></a><span id="l39.159"> </span>
<a href="#l39.160"></a><span id="l39.160"> /**</span>
<a href="#l39.161"></a><span id="l39.161">  * Helper function to set a localized (complex) pref from a given string</span>
<a href="#l39.162"></a><span id="l39.162">  *</span>
<a href="#l39.163"></a><span id="l39.163">  * @param aPrefName   the (full) name of preference to set</span>
<a href="#l39.164"></a><span id="l39.164">  * @param aString     the string to which the preference value should be set</span>
<a href="#l39.165"></a><span id="l39.165">  */</span>
<a href="#l39.166"></a><span id="l39.166"> function setLocalizedPref(aPrefName, aString) {</span>
<a href="#l39.167"></a><span id="l39.167" class="difflineminus">-    var str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;].</span>
<a href="#l39.168"></a><span id="l39.168" class="difflineminus">-              createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l39.169"></a><span id="l39.169" class="difflineminus">-    str.data = aString;</span>
<a href="#l39.170"></a><span id="l39.170" class="difflineminus">-    Services.prefs.setComplexValue(aPrefName, Components.interfaces.nsISupportsString, str);</span>
<a href="#l39.171"></a><span id="l39.171" class="difflineplus">+    if (!setLocalizedPref.warningIssued) {</span>
<a href="#l39.172"></a><span id="l39.172" class="difflineplus">+        cal.WARN(&quot;Use of setLocalizedPref() is deprecated and will be removed &quot; +</span>
<a href="#l39.173"></a><span id="l39.173" class="difflineplus">+                 &quot;with the next release. Use Preferences.set() instead.\n&quot; +</span>
<a href="#l39.174"></a><span id="l39.174" class="difflineplus">+                 cal.STACK(10));</span>
<a href="#l39.175"></a><span id="l39.175" class="difflineplus">+        setLocalizedPref.warningIssued = true;</span>
<a href="#l39.176"></a><span id="l39.176" class="difflineplus">+    }</span>
<a href="#l39.177"></a><span id="l39.177" class="difflineplus">+</span>
<a href="#l39.178"></a><span id="l39.178" class="difflineplus">+    return Preferences.set(aPrefName, aString);</span>
<a href="#l39.179"></a><span id="l39.179"> }</span>
<a href="#l39.180"></a><span id="l39.180"> </span>
<a href="#l39.181"></a><span id="l39.181"> /**</span>
<a href="#l39.182"></a><span id="l39.182">  * Like getPrefSafe, except for complex prefs (those used for localized data).</span>
<a href="#l39.183"></a><span id="l39.183">  *</span>
<a href="#l39.184"></a><span id="l39.184">  * @param aPrefName   the (full) name of preference to get</span>
<a href="#l39.185"></a><span id="l39.185">  * @param aDefault    (optional) the value to return if the pref is undefined</span>
<a href="#l39.186"></a><span id="l39.186">  */</span>
<a href="#l39.187"></a><span id="l39.187"> function getLocalizedPref(aPrefName, aDefault) {</span>
<a href="#l39.188"></a><span id="l39.188" class="difflineminus">-    var result;</span>
<a href="#l39.189"></a><span id="l39.189" class="difflineminus">-    try {</span>
<a href="#l39.190"></a><span id="l39.190" class="difflineminus">-        result = Services.prefs.getComplexValue(aPrefName, Components.interfaces.nsISupportsString).data;</span>
<a href="#l39.191"></a><span id="l39.191" class="difflineminus">-    } catch(ex) {</span>
<a href="#l39.192"></a><span id="l39.192" class="difflineminus">-        return aDefault;</span>
<a href="#l39.193"></a><span id="l39.193" class="difflineplus">+    if (!getLocalizedPref.warningIssued) {</span>
<a href="#l39.194"></a><span id="l39.194" class="difflineplus">+        cal.WARN(&quot;Use of getLocalizedPref() is deprecated and will be removed &quot; +</span>
<a href="#l39.195"></a><span id="l39.195" class="difflineplus">+                 &quot;with the next release. Use Preferences.get() instead.\n&quot; +</span>
<a href="#l39.196"></a><span id="l39.196" class="difflineplus">+                 cal.STACK(10));</span>
<a href="#l39.197"></a><span id="l39.197" class="difflineplus">+        getLocalizedPref.warningIssued = true;</span>
<a href="#l39.198"></a><span id="l39.198">     }</span>
<a href="#l39.199"></a><span id="l39.199" class="difflineminus">-    return result;</span>
<a href="#l39.200"></a><span id="l39.200" class="difflineplus">+</span>
<a href="#l39.201"></a><span id="l39.201" class="difflineplus">+    return Preferences.get(aPrefName, aDefault);</span>
<a href="#l39.202"></a><span id="l39.202"> }</span>
<a href="#l39.203"></a><span id="l39.203"> </span>
<a href="#l39.204"></a><span id="l39.204"> /**</span>
<a href="#l39.205"></a><span id="l39.205">  * Get array of category names from preferences or locale default,</span>
<a href="#l39.206"></a><span id="l39.206">  * unescaping any commas in each category name.</span>
<a href="#l39.207"></a><span id="l39.207">  * @return array of category names</span>
<a href="#l39.208"></a><span id="l39.208">  */</span>
<a href="#l39.209"></a><span id="l39.209"> function getPrefCategoriesArray() {</span>
<a href="#l39.210"></a><span id="l39.210" class="difflineminus">-    let categories = getLocalizedPref(&quot;calendar.categories.names&quot;, null);</span>
<a href="#l39.211"></a><span id="l39.211" class="difflineplus">+    let categories = Preferences.get(&quot;calendar.categories.names&quot;, null);</span>
<a href="#l39.212"></a><span id="l39.212"> </span>
<a href="#l39.213"></a><span id="l39.213">     // If no categories are configured load a default set from properties file</span>
<a href="#l39.214"></a><span id="l39.214">     if (!categories) {</span>
<a href="#l39.215"></a><span id="l39.215">         categories = setupDefaultCategories();</span>
<a href="#l39.216"></a><span id="l39.216">     }</span>
<a href="#l39.217"></a><span id="l39.217">     return categoriesStringToArray(categories);</span>
<a href="#l39.218"></a><span id="l39.218"> }</span>
<a href="#l39.219"></a><span id="l39.219"> </span>
<a href="#l39.220"></a><span id="l39.220"> /**</span>
<a href="#l39.221"></a><span id="l39.221">  * Sets up the default categories from the localized string</span>
<a href="#l39.222"></a><span id="l39.222">  *</span>
<a href="#l39.223"></a><span id="l39.223">  * @return      The default set of categories as a comma separated string.</span>
<a href="#l39.224"></a><span id="l39.224">  */</span>
<a href="#l39.225"></a><span id="l39.225"> function setupDefaultCategories() {</span>
<a href="#l39.226"></a><span id="l39.226">     // First, set up the category names</span>
<a href="#l39.227"></a><span id="l39.227">     let categories = calGetString(&quot;categories&quot;, &quot;categories2&quot;);</span>
<a href="#l39.228"></a><span id="l39.228" class="difflineminus">-    setLocalizedPref(&quot;calendar.categories.names&quot;, categories);</span>
<a href="#l39.229"></a><span id="l39.229" class="difflineplus">+    Preferences.set(&quot;calendar.categories.names&quot;, categories);</span>
<a href="#l39.230"></a><span id="l39.230"> </span>
<a href="#l39.231"></a><span id="l39.231">     // Now, initialize the category default colors</span>
<a href="#l39.232"></a><span id="l39.232">     let categoryArray = categoriesStringToArray(categories);</span>
<a href="#l39.233"></a><span id="l39.233">     for each (let category in categoryArray) {</span>
<a href="#l39.234"></a><span id="l39.234">         let prefName = formatStringForCSSRule(category);</span>
<a href="#l39.235"></a><span id="l39.235" class="difflineminus">-        setPref(&quot;calendar.category.color.&quot; + prefName,</span>
<a href="#l39.236"></a><span id="l39.236" class="difflineminus">-                hashColor(category),</span>
<a href="#l39.237"></a><span id="l39.237" class="difflineminus">-                &quot;CHAR&quot;);</span>
<a href="#l39.238"></a><span id="l39.238" class="difflineplus">+        Preferences.set(&quot;calendar.category.color.&quot; + prefName,</span>
<a href="#l39.239"></a><span id="l39.239" class="difflineplus">+                        hashColor(category));</span>
<a href="#l39.240"></a><span id="l39.240">     }</span>
<a href="#l39.241"></a><span id="l39.241"> </span>
<a href="#l39.242"></a><span id="l39.242">     // Return the list of categories for further processing</span>
<a href="#l39.243"></a><span id="l39.243">     return categories;</span>
<a href="#l39.244"></a><span id="l39.244"> }</span>
<a href="#l39.245"></a><span id="l39.245"> </span>
<a href="#l39.246"></a><span id="l39.246"> /**</span>
<a href="#l39.247"></a><span id="l39.247">  * Hash the given string into a color from the color palette of the standard</span>
<a href="#l39.248"></a><span id="l39.248" class="difflineat">@@ -637,17 +625,17 @@ function categoriesStringToArray(aCatego</span>
<a href="#l39.249"></a><span id="l39.249"> }</span>
<a href="#l39.250"></a><span id="l39.250"> </span>
<a href="#l39.251"></a><span id="l39.251"> /**</span>
<a href="#l39.252"></a><span id="l39.252">  * Set categories preference, escaping any commas in category names.</span>
<a href="#l39.253"></a><span id="l39.253">  * @param aCategoriesArray array of category names,</span>
<a href="#l39.254"></a><span id="l39.254">  * may contain unescaped commas which will be escaped in combined pref.</span>
<a href="#l39.255"></a><span id="l39.255">  */</span>
<a href="#l39.256"></a><span id="l39.256"> function setPrefCategoriesFromArray(aCategoriesArray) {</span>
<a href="#l39.257"></a><span id="l39.257" class="difflineminus">-    setLocalizedPref(&quot;calendar.categories.names&quot;,</span>
<a href="#l39.258"></a><span id="l39.258" class="difflineplus">+    Preferences.set(&quot;calendar.categories.names&quot;,</span>
<a href="#l39.259"></a><span id="l39.259">                      categoriesArrayToString(aCategoriesList));</span>
<a href="#l39.260"></a><span id="l39.260"> }</span>
<a href="#l39.261"></a><span id="l39.261"> </span>
<a href="#l39.262"></a><span id="l39.262"> /**</span>
<a href="#l39.263"></a><span id="l39.263">  * Convert array of category names to string.</span>
<a href="#l39.264"></a><span id="l39.264">  *</span>
<a href="#l39.265"></a><span id="l39.265">  * Category names may contain commas (,).  Escape commas (\,) in each,</span>
<a href="#l39.266"></a><span id="l39.266">  * then join them in comma separated string for storage.</span>
<a href="#l39.267"></a><span id="l39.267" class="difflineat">@@ -882,17 +870,17 @@ function getDefaultStartDate(aReferenceD</span>
<a href="#l39.268"></a><span id="l39.268">  * @param aReferenceDate    If passed, the time of this date will be modified,</span>
<a href="#l39.269"></a><span id="l39.269">  *                            keeping the date and timezone intact.</span>
<a href="#l39.270"></a><span id="l39.270">  */</span>
<a href="#l39.271"></a><span id="l39.271"> function setDefaultStartEndHour(aItem, aReferenceDate) {</span>
<a href="#l39.272"></a><span id="l39.272">     aItem[calGetStartDateProp(aItem)] = getDefaultStartDate(aReferenceDate);</span>
<a href="#l39.273"></a><span id="l39.273"> </span>
<a href="#l39.274"></a><span id="l39.274">     if (isEvent(aItem)) {</span>
<a href="#l39.275"></a><span id="l39.275">         aItem.endDate = aItem.startDate.clone();</span>
<a href="#l39.276"></a><span id="l39.276" class="difflineminus">-        aItem.endDate.minute += getPrefSafe(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l39.277"></a><span id="l39.277" class="difflineplus">+        aItem.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l39.278"></a><span id="l39.278">     }</span>
<a href="#l39.279"></a><span id="l39.279"> }</span>
<a href="#l39.280"></a><span id="l39.280"> </span>
<a href="#l39.281"></a><span id="l39.281"> /****</span>
<a href="#l39.282"></a><span id="l39.282">  **** debug code</span>
<a href="#l39.283"></a><span id="l39.283">  ****/</span>
<a href="#l39.284"></a><span id="l39.284"> </span>
<a href="#l39.285"></a><span id="l39.285"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/base/src/calWeekInfoService.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/base/src/calWeekInfoService.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l40.4"></a><span id="l40.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l40.5"></a><span id="l40.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l40.6"></a><span id="l40.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l40.9"></a><span id="l40.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l40.10"></a><span id="l40.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12"> function calWeekInfoService() {</span>
<a href="#l40.13"></a><span id="l40.13">     this.wrappedJSObject = this;</span>
<a href="#l40.14"></a><span id="l40.14"> }</span>
<a href="#l40.15"></a><span id="l40.15"> const calWeekInfoServiceClassID = Components.ID(&quot;{6877bbdd-f336-46f5-98ce-fe86d0285cc1}&quot;);</span>
<a href="#l40.16"></a><span id="l40.16"> const calWeekInfoServiceInterfaces = [Components.interfaces.calIWeekInfoService];</span>
<a href="#l40.17"></a><span id="l40.17"> calWeekInfoService.prototype = {</span>
<a href="#l40.18"></a><span id="l40.18">     classID: calWeekInfoServiceClassID,</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineat">@@ -50,17 +51,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l40.20"></a><span id="l40.20">         // which may be part of first/last week in the other year.)</span>
<a href="#l40.21"></a><span id="l40.21">         // The Thursday of a week is the Thursday that follows the first day</span>
<a href="#l40.22"></a><span id="l40.22">         // of the week.</span>
<a href="#l40.23"></a><span id="l40.23">         // The week number of a day is the same as the week number of the first</span>
<a href="#l40.24"></a><span id="l40.24">         // day of the week. (This takes care of days near the start of the year,</span>
<a href="#l40.25"></a><span id="l40.25">         // which may be part of the week counted in the previous year.) So we</span>
<a href="#l40.26"></a><span id="l40.26">         // need the startWeekday.</span>
<a href="#l40.27"></a><span id="l40.27">         const SUNDAY = 0;</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineminus">-        var startWeekday = cal.getPrefSafe(&quot;calendar.week.start&quot;, SUNDAY); // default to monday per ISO8601 standard.</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineplus">+        var startWeekday = Preferences.get(&quot;calendar.week.start&quot;, SUNDAY); // default to monday per ISO8601 standard.</span>
<a href="#l40.30"></a><span id="l40.30"> </span>
<a href="#l40.31"></a><span id="l40.31">         // The number of days since the start of the week.</span>
<a href="#l40.32"></a><span id="l40.32">         // Notice that the result of the substraction might be negative.</span>
<a href="#l40.33"></a><span id="l40.33">         // We correct for that by adding 7, and then using the remainder operator.</span>
<a href="#l40.34"></a><span id="l40.34">         var sinceStartOfWeek = (aDateTime.weekday - startWeekday + 7) % 7; </span>
<a href="#l40.35"></a><span id="l40.35"> </span>
<a href="#l40.36"></a><span id="l40.36">         // The number of days to Thursday is the difference between Thursday</span>
<a href="#l40.37"></a><span id="l40.37">         // and the start-day of the week (again corrected for negative values).</span>
<a href="#l40.38"></a><span id="l40.38" class="difflineat">@@ -91,17 +92,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l40.39"></a><span id="l40.39">      * of the preference setting &quot;calendar.week.start&quot;</span>
<a href="#l40.40"></a><span id="l40.40">      *</span>
<a href="#l40.41"></a><span id="l40.41">      * @param aDate     a date time object</span>
<a href="#l40.42"></a><span id="l40.42">      * @return          a dateTime-object denoting the first day of the week</span>
<a href="#l40.43"></a><span id="l40.43">      */</span>
<a href="#l40.44"></a><span id="l40.44">     getStartOfWeek: function(aDate) {</span>
<a href="#l40.45"></a><span id="l40.45">         var date = aDate.clone();</span>
<a href="#l40.46"></a><span id="l40.46">         date.isDate = true;</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineminus">-        var offset = (cal.getPrefSafe(&quot;calendar.week.start&quot;, 0) - aDate.weekday);</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineplus">+        var offset = (Preferences.get(&quot;calendar.week.start&quot;, 0) - aDate.weekday);</span>
<a href="#l40.49"></a><span id="l40.49">         if (offset &gt; 0) {</span>
<a href="#l40.50"></a><span id="l40.50">             date.day -= (7 - offset);</span>
<a href="#l40.51"></a><span id="l40.51">         } else {</span>
<a href="#l40.52"></a><span id="l40.52">             date.day += offset;</span>
<a href="#l40.53"></a><span id="l40.53">         }</span>
<a href="#l40.54"></a><span id="l40.54">         return date;</span>
<a href="#l40.55"></a><span id="l40.55">     },</span>
<a href="#l40.56"></a><span id="l40.56"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l41.4"></a><span id="l41.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l41.5"></a><span id="l41.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l41.8"></a><span id="l41.8"> </span>
<a href="#l41.9"></a><span id="l41.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l41.10"></a><span id="l41.10"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l41.11"></a><span id="l41.11"> Components.utils.import(&quot;resource://calendar/modules/calPrintUtils.jsm&quot;);</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l41.13"></a><span id="l41.13"> </span>
<a href="#l41.14"></a><span id="l41.14"> /**</span>
<a href="#l41.15"></a><span id="l41.15">  * Prints a rough month-grid of events/tasks</span>
<a href="#l41.16"></a><span id="l41.16">  */</span>
<a href="#l41.17"></a><span id="l41.17"> function calMonthPrinter() {</span>
<a href="#l41.18"></a><span id="l41.18">     this.wrappedJSObject = this;</span>
<a href="#l41.19"></a><span id="l41.19"> }</span>
<a href="#l41.20"></a><span id="l41.20"> </span>
<a href="#l41.21"></a><span id="l41.21" class="difflineat">@@ -151,17 +152,17 @@ calMonthPrinter.prototype = {</span>
<a href="#l41.22"></a><span id="l41.22">         currentMonth.item = startOfMonth.clone();</span>
<a href="#l41.23"></a><span id="l41.23"> </span>
<a href="#l41.24"></a><span id="l41.24">         // Set up the month title</span>
<a href="#l41.25"></a><span id="l41.25">         let monthName = cal.formatMonth(startOfMonth.month + 1, &quot;calendar&quot;, &quot;monthInYear&quot;);</span>
<a href="#l41.26"></a><span id="l41.26">         let monthTitle = cal.calGetString(&quot;calendar&quot;, &quot;monthInYear&quot;, [monthName, startOfMonth.year]);</span>
<a href="#l41.27"></a><span id="l41.27">         currentMonth.querySelector(&quot;.month-name&quot;).textContent = monthTitle;</span>
<a href="#l41.28"></a><span id="l41.28"> </span>
<a href="#l41.29"></a><span id="l41.29">         // Set up the weekday titles</span>
<a href="#l41.30"></a><span id="l41.30" class="difflineminus">-        let wkst = cal.getPrefSafe(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineplus">+        let wkst = Preferences.get(&quot;calendar.week.start&quot;, 0);</span>
<a href="#l41.32"></a><span id="l41.32">         for (let i = 1; i &lt;= 7; i++) {</span>
<a href="#l41.33"></a><span id="l41.33">             let dayNumber = ((i + wkst - 1) % 7) + 1;</span>
<a href="#l41.34"></a><span id="l41.34">             let dayTitle = currentMonth.querySelector(&quot;.day&quot; + i + &quot;-title&quot;);</span>
<a href="#l41.35"></a><span id="l41.35">             dayTitle.textContent = cal.calGetString(&quot;dateFormat&quot;, &quot;day.&quot; + dayNumber + &quot;.Mmm&quot;);</span>
<a href="#l41.36"></a><span id="l41.36">         }</span>
<a href="#l41.37"></a><span id="l41.37"> </span>
<a href="#l41.38"></a><span id="l41.38">         // Set up each week</span>
<a href="#l41.39"></a><span id="l41.39">         let weekInfoService = cal.getWeekInfoService();</span>
<a href="#l41.40"></a><span id="l41.40" class="difflineat">@@ -210,17 +211,17 @@ calMonthPrinter.prototype = {</span>
<a href="#l41.41"></a><span id="l41.41">                     dayTable[dateKey] = [dayTable[dateKey], dayContainer];</span>
<a href="#l41.42"></a><span id="l41.42">                 }</span>
<a href="#l41.43"></a><span id="l41.43">             } else {</span>
<a href="#l41.44"></a><span id="l41.44">                 dayTable[dateKey] = dayContainer;</span>
<a href="#l41.45"></a><span id="l41.45">             }</span>
<a href="#l41.46"></a><span id="l41.46"> </span>
<a href="#l41.47"></a><span id="l41.47">             let weekDay = currentDate.weekday;</span>
<a href="#l41.48"></a><span id="l41.48">             let dayOffPrefName = &quot;calendar.week.d&quot; + weekDay + weekdayMap[weekDay] + &quot;soff&quot;;</span>
<a href="#l41.49"></a><span id="l41.49" class="difflineminus">-            if (cal.getPrefSafe(dayOffPrefName, false)) {</span>
<a href="#l41.50"></a><span id="l41.50" class="difflineplus">+            if (Preferences.get(dayOffPrefName, false)) {</span>
<a href="#l41.51"></a><span id="l41.51">                 dayBox.className += &quot; day-off&quot;;</span>
<a href="#l41.52"></a><span id="l41.52">             }</span>
<a href="#l41.53"></a><span id="l41.53"> </span>
<a href="#l41.54"></a><span id="l41.54">             if (currentDate.month != mainMonth) {</span>
<a href="#l41.55"></a><span id="l41.55">                 dayBox.className += &quot; out-of-month&quot;;</span>
<a href="#l41.56"></a><span id="l41.56">             }</span>
<a href="#l41.57"></a><span id="l41.57">             currentDate.day++;</span>
<a href="#l41.58"></a><span id="l41.58">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l42.4"></a><span id="l42.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l42.5"></a><span id="l42.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l42.6"></a><span id="l42.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l42.9"></a><span id="l42.9"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l42.10"></a><span id="l42.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12"> const localeEn = {</span>
<a href="#l42.13"></a><span id="l42.13">     headTitle       : &quot;Subject&quot;,</span>
<a href="#l42.14"></a><span id="l42.14">     headStartDate   : &quot;Start Date&quot;,</span>
<a href="#l42.15"></a><span id="l42.15">     headStartTime   : &quot;Start Time&quot;,</span>
<a href="#l42.16"></a><span id="l42.16">     headEndDate     : &quot;End Date&quot;,</span>
<a href="#l42.17"></a><span id="l42.17">     headEndTime     : &quot;End Time&quot;,</span>
<a href="#l42.18"></a><span id="l42.18">     headAllDayEvent : &quot;All day event&quot;,</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineat">@@ -264,17 +265,17 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l42.20"></a><span id="l42.20">                     if (!eDate) {</span>
<a href="#l42.21"></a><span id="l42.21">                         // No endDate was found. All day events last one day and</span>
<a href="#l42.22"></a><span id="l42.22">                         // timed events last the default length.</span>
<a href="#l42.23"></a><span id="l42.23">                         eDate = sDate.clone();</span>
<a href="#l42.24"></a><span id="l42.24">                         if (sDate.isDate) {</span>
<a href="#l42.25"></a><span id="l42.25">                             // end date is exclusive, so set to next day after start.</span>
<a href="#l42.26"></a><span id="l42.26">                             eDate.day += 1;</span>
<a href="#l42.27"></a><span id="l42.27">                         } else {</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineminus">-                            eDate.minute += cal.getPrefSafe(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l42.29"></a><span id="l42.29" class="difflineplus">+                            eDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l42.30"></a><span id="l42.30">                         }</span>
<a href="#l42.31"></a><span id="l42.31">                     } else {</span>
<a href="#l42.32"></a><span id="l42.32">                         // An endDate was found.</span>
<a href="#l42.33"></a><span id="l42.33">                         if (sDate.isDate) {</span>
<a href="#l42.34"></a><span id="l42.34">                             // A time part for the startDate is missing or was</span>
<a href="#l42.35"></a><span id="l42.35">                             // not recognized. We have to throw away the endDates</span>
<a href="#l42.36"></a><span id="l42.36">                             // time part too for obtaining a valid event.</span>
<a href="#l42.37"></a><span id="l42.37">                             eDate.isDate = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/import-export/calWeekPrinter.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/import-export/calWeekPrinter.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l43.4"></a><span id="l43.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l43.5"></a><span id="l43.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l43.6"></a><span id="l43.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l43.9"></a><span id="l43.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l43.10"></a><span id="l43.10"> </span>
<a href="#l43.11"></a><span id="l43.11"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l43.12"></a><span id="l43.12"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l43.13"></a><span id="l43.13"> Components.utils.import(&quot;resource://calendar/modules/calPrintUtils.jsm&quot;);</span>
<a href="#l43.14"></a><span id="l43.14"> </span>
<a href="#l43.15"></a><span id="l43.15"> /**</span>
<a href="#l43.16"></a><span id="l43.16">  * Prints a two column view of a week of events, much like a paper day-planner</span>
<a href="#l43.17"></a><span id="l43.17">  */</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineat">@@ -116,17 +117,17 @@ calWeekPrinter.prototype = {</span>
<a href="#l43.19"></a><span id="l43.19">             let weekday = currentDate.weekday;</span>
<a href="#l43.20"></a><span id="l43.20">             let weekdayName = weekdayMap[weekday];</span>
<a href="#l43.21"></a><span id="l43.21">             let dayOffPrefName = &quot;calendar.week.d&quot; +  weekday + weekdayName + &quot;soff&quot;;</span>
<a href="#l43.22"></a><span id="l43.22">             dayTable[cal.print.getDateKey(currentDate)] = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-container&quot;);</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24">             let titleNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-title&quot;);</span>
<a href="#l43.25"></a><span id="l43.25">             titleNode.textContent = dateFormatter.formatDateLong(currentDate.getInTimezone(defaultTimezone));</span>
<a href="#l43.26"></a><span id="l43.26"> </span>
<a href="#l43.27"></a><span id="l43.27" class="difflineminus">-            if (cal.getPrefSafe(dayOffPrefName, false)) {</span>
<a href="#l43.28"></a><span id="l43.28" class="difflineplus">+            if (Preferences.get(dayOffPrefName, false)) {</span>
<a href="#l43.29"></a><span id="l43.29">                 let daysOffNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-box&quot;);</span>
<a href="#l43.30"></a><span id="l43.30">                 daysOffNode.className += &quot; day-off&quot;;</span>
<a href="#l43.31"></a><span id="l43.31">             }</span>
<a href="#l43.32"></a><span id="l43.32">         }</span>
<a href="#l43.33"></a><span id="l43.33"> </span>
<a href="#l43.34"></a><span id="l43.34">         // Now insert the week into the week container, sorting by date (and therefore week number)</span>
<a href="#l43.35"></a><span id="l43.35">         function compareDates(a, b) {</span>
<a href="#l43.36"></a><span id="l43.36">             if (!a || !b) return -1;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/itip/calItipEmailTransport.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/itip/calItipEmailTransport.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l44.4"></a><span id="l44.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l44.5"></a><span id="l44.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l44.6"></a><span id="l44.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l44.7"></a><span id="l44.7"> </span>
<a href="#l44.8"></a><span id="l44.8"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l44.9"></a><span id="l44.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l44.10"></a><span id="l44.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l44.11"></a><span id="l44.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l44.13"></a><span id="l44.13"> </span>
<a href="#l44.14"></a><span id="l44.14"> function convertFromUnicode(aCharset, aSrc) {</span>
<a href="#l44.15"></a><span id="l44.15">     let unicodeConverter = Components.classes[&quot;@mozilla.org/intl/scriptableunicodeconverter&quot;]</span>
<a href="#l44.16"></a><span id="l44.16">                                      .createInstance(Components.interfaces.nsIScriptableUnicodeConverter);</span>
<a href="#l44.17"></a><span id="l44.17">     unicodeConverter.charset = aCharset;</span>
<a href="#l44.18"></a><span id="l44.18">     return unicodeConverter.ConvertFromUnicode(aSrc);</span>
<a href="#l44.19"></a><span id="l44.19"> }</span>
<a href="#l44.20"></a><span id="l44.20"> </span>
<a href="#l44.21"></a><span id="l44.21" class="difflineat">@@ -185,32 +186,32 @@ calItipEmailTransport.prototype = {</span>
<a href="#l44.22"></a><span id="l44.22">         switch (aItem.autoResponse) {</span>
<a href="#l44.23"></a><span id="l44.23">             case (Components.interfaces.calIItipItem.USER): {</span>
<a href="#l44.24"></a><span id="l44.24">                 cal.LOG(&quot;sendXpcomMail: Found USER autoResponse type.\n&quot; +</span>
<a href="#l44.25"></a><span id="l44.25">                         &quot;This type is currently unsupported, the compose API will always enter a text/plain\n&quot; +</span>
<a href="#l44.26"></a><span id="l44.26">                         &quot;or text/html part as first part of the message.\n&quot; +</span>
<a href="#l44.27"></a><span id="l44.27">                         &quot;This will disable OL (up to 2003) to consume the mail as an iTIP invitation showing\n&quot; +</span>
<a href="#l44.28"></a><span id="l44.28">                         &quot;the usual calendar buttons.&quot;);</span>
<a href="#l44.29"></a><span id="l44.29">                 // To somehow have a last resort before sending spam, the user can choose to send the mail.</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineminus">-                let prefCompatMode = cal.getPrefSafe(&quot;calendar.itip.compatSendMode&quot;, 0);</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineplus">+                let prefCompatMode = Preferences.get(&quot;calendar.itip.compatSendMode&quot;, 0);</span>
<a href="#l44.32"></a><span id="l44.32">                 let inoutCheck = { value: (prefCompatMode == 1) };</span>
<a href="#l44.33"></a><span id="l44.33">                 if (Services.prompt.confirmEx(null,</span>
<a href="#l44.34"></a><span id="l44.34">                                               cal.calGetString(&quot;lightning&quot;, &quot;imipSendMail.title&quot;, null, &quot;lightning&quot;),</span>
<a href="#l44.35"></a><span id="l44.35">                                               cal.calGetString(&quot;lightning&quot;, &quot;imipSendMail.text&quot;, null, &quot;lightning&quot;),</span>
<a href="#l44.36"></a><span id="l44.36">                                               Services.prompt.STD_YES_NO_BUTTONS,</span>
<a href="#l44.37"></a><span id="l44.37">                                               null,</span>
<a href="#l44.38"></a><span id="l44.38">                                               null,</span>
<a href="#l44.39"></a><span id="l44.39">                                               null,</span>
<a href="#l44.40"></a><span id="l44.40">                                               cal.calGetString(&quot;lightning&quot;, &quot;imipSendMail.Outlook2000CompatMode.text&quot;, null, &quot;lightning&quot;),</span>
<a href="#l44.41"></a><span id="l44.41">                                               inoutCheck)) {</span>
<a href="#l44.42"></a><span id="l44.42">                     break;</span>
<a href="#l44.43"></a><span id="l44.43">                 } // else go on with auto sending for now</span>
<a href="#l44.44"></a><span id="l44.44">                 compatMode = (inoutCheck.value ? 1 : 0);</span>
<a href="#l44.45"></a><span id="l44.45">                 if (compatMode != prefCompatMode) {</span>
<a href="#l44.46"></a><span id="l44.46" class="difflineminus">-                    cal.setPref(&quot;calendar.itip.compatSendMode&quot;, compatMode);</span>
<a href="#l44.47"></a><span id="l44.47" class="difflineplus">+                    Preferences.set(&quot;calendar.itip.compatSendMode&quot;, compatMode);</span>
<a href="#l44.48"></a><span id="l44.48">                 }</span>
<a href="#l44.49"></a><span id="l44.49">             }</span>
<a href="#l44.50"></a><span id="l44.50">             case (Components.interfaces.calIItipItem.AUTO): {</span>
<a href="#l44.51"></a><span id="l44.51">                 cal.LOG(&quot;sendXpcomMail: Found AUTO autoResponse type.&quot;);</span>
<a href="#l44.52"></a><span id="l44.52">                 let toList = &quot;&quot;;</span>
<a href="#l44.53"></a><span id="l44.53">                 for each (let recipient in aToList) {</span>
<a href="#l44.54"></a><span id="l44.54">                     // Strip leading &quot;mailto:&quot; if it exists.</span>
<a href="#l44.55"></a><span id="l44.55">                     let rId = recipient.id.replace(/^mailto:/i, &quot;&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l45.4"></a><span id="l45.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l45.5"></a><span id="l45.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l45.6"></a><span id="l45.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l45.7"></a><span id="l45.7"> </span>
<a href="#l45.8"></a><span id="l45.8"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l45.9"></a><span id="l45.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l45.10"></a><span id="l45.10"> Components.utils.import(&quot;resource://gre/modules/Timer.jsm&quot;);</span>
<a href="#l45.11"></a><span id="l45.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l45.12"></a><span id="l45.12"> </span>
<a href="#l45.13"></a><span id="l45.13"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l45.14"></a><span id="l45.14"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l45.15"></a><span id="l45.15"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l45.16"></a><span id="l45.16"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l45.17"></a><span id="l45.17"> Components.utils.import(&quot;resource://calendar/modules/calAuthUtils.jsm&quot;);</span>
<a href="#l45.18"></a><span id="l45.18"> Components.utils.import(&quot;resource://calendar/modules/OAuth2.jsm&quot;);</span>
<a href="#l45.19"></a><span id="l45.19"> </span>
<a href="#l45.20"></a><span id="l45.20" class="difflineat">@@ -429,17 +430,17 @@ calDavCalendar.prototype = {</span>
<a href="#l45.21"></a><span id="l45.21">     },</span>
<a href="#l45.22"></a><span id="l45.22"> </span>
<a href="#l45.23"></a><span id="l45.23">     mHaveScheduling: false,</span>
<a href="#l45.24"></a><span id="l45.24">     mShouldPollInbox: true,</span>
<a href="#l45.25"></a><span id="l45.25">     get hasScheduling() { // Whether to use inbox/outbox scheduling</span>
<a href="#l45.26"></a><span id="l45.26">         return this.mHaveScheduling;</span>
<a href="#l45.27"></a><span id="l45.27">     },</span>
<a href="#l45.28"></a><span id="l45.28">     set hasScheduling(value) {</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineminus">-        return (this.mHaveScheduling = (getPrefSafe(&quot;calendar.caldav.sched.enabled&quot;, false) &amp;&amp; value));</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineplus">+        return (this.mHaveScheduling = (Preferences.get(&quot;calendar.caldav.sched.enabled&quot;, false) &amp;&amp; value));</span>
<a href="#l45.31"></a><span id="l45.31">     },</span>
<a href="#l45.32"></a><span id="l45.32">     hasAutoScheduling: false, // Whether server automatically takes care of scheduling</span>
<a href="#l45.33"></a><span id="l45.33">     hasFreebusy: false,</span>
<a href="#l45.34"></a><span id="l45.34"> </span>
<a href="#l45.35"></a><span id="l45.35">     mAuthScheme: null,</span>
<a href="#l45.36"></a><span id="l45.36"> </span>
<a href="#l45.37"></a><span id="l45.37">     mAuthRealm: null,</span>
<a href="#l45.38"></a><span id="l45.38"> </span>
<a href="#l45.39"></a><span id="l45.39" class="difflineat">@@ -2767,17 +2768,17 @@ calDavCalendar.prototype = {</span>
<a href="#l45.40"></a><span id="l45.40">                                &quot;Error preparing http channel&quot;);</span>
<a href="#l45.41"></a><span id="l45.41">             });</span>
<a href="#l45.42"></a><span id="l45.42">         }</span>
<a href="#l45.43"></a><span id="l45.43">     },</span>
<a href="#l45.44"></a><span id="l45.44"> </span>
<a href="#l45.45"></a><span id="l45.45">     mVerboseLogging: undefined,</span>
<a href="#l45.46"></a><span id="l45.46">     verboseLogging: function caldav_verboseLogging() {</span>
<a href="#l45.47"></a><span id="l45.47">         if (this.mVerboseLogging === undefined) {</span>
<a href="#l45.48"></a><span id="l45.48" class="difflineminus">-            this.mVerboseLogging = getPrefSafe(&quot;calendar.debug.log.verbose&quot;, false);</span>
<a href="#l45.49"></a><span id="l45.49" class="difflineplus">+            this.mVerboseLogging = Preferences.get(&quot;calendar.debug.log.verbose&quot;, false);</span>
<a href="#l45.50"></a><span id="l45.50">         }</span>
<a href="#l45.51"></a><span id="l45.51">         return this.mVerboseLogging;</span>
<a href="#l45.52"></a><span id="l45.52">     },</span>
<a href="#l45.53"></a><span id="l45.53"> </span>
<a href="#l45.54"></a><span id="l45.54">     getSerializedItem: function caldav_getSerializedItem(aItem) {</span>
<a href="#l45.55"></a><span id="l45.55">         var serializer = Components.classes[&quot;@mozilla.org/calendar/ics-serializer;1&quot;]</span>
<a href="#l45.56"></a><span id="l45.56">                                    .createInstance(Components.interfaces.calIIcsSerializer);</span>
<a href="#l45.57"></a><span id="l45.57">         serializer.addItems([aItem], 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l46.4"></a><span id="l46.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l46.5"></a><span id="l46.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l46.6"></a><span id="l46.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l46.9"></a><span id="l46.9"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l46.10"></a><span id="l46.10"> Components.utils.import(&quot;resource://gre/modules/Timer.jsm&quot;);</span>
<a href="#l46.11"></a><span id="l46.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l46.12"></a><span id="l46.12"> </span>
<a href="#l46.13"></a><span id="l46.13"> /**</span>
<a href="#l46.14"></a><span id="l46.14">  * This is a handler for the etag request in calDavCalendar.js' getUpdatedItem.</span>
<a href="#l46.15"></a><span id="l46.15">  * It uses the SAX parser to incrementally parse the items and compose the</span>
<a href="#l46.16"></a><span id="l46.16">  * resulting multiget.</span>
<a href="#l46.17"></a><span id="l46.17">  *</span>
<a href="#l46.18"></a><span id="l46.18">  * @param aCalendar             The (unwrapped) calendar this request belongs to</span>
<a href="#l46.19"></a><span id="l46.19">  * @param aBaseUri              The URI requested (i.e inbox or collection)</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineat">@@ -690,17 +691,17 @@ multigetSyncHandler.prototype = {</span>
<a href="#l46.21"></a><span id="l46.21"> </span>
<a href="#l46.22"></a><span id="l46.22">     doMultiGet: function doMultiGet() {</span>
<a href="#l46.23"></a><span id="l46.23">         if (this.calendar.mDisabled) {</span>
<a href="#l46.24"></a><span id="l46.24">             // check if maybe our calendar has become available</span>
<a href="#l46.25"></a><span id="l46.25">             this.calendar.setupAuthentication(this.changeLogListener);</span>
<a href="#l46.26"></a><span id="l46.26">             return;</span>
<a href="#l46.27"></a><span id="l46.27">         }</span>
<a href="#l46.28"></a><span id="l46.28"> </span>
<a href="#l46.29"></a><span id="l46.29" class="difflineminus">-        let batchSize = cal.getPrefSafe(&quot;calendar.caldav.multigetBatchSize&quot;, 100);</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineplus">+        let batchSize = Preferences.get(&quot;calendar.caldav.multigetBatchSize&quot;, 100);</span>
<a href="#l46.31"></a><span id="l46.31">         let hrefString = &quot;&quot;;</span>
<a href="#l46.32"></a><span id="l46.32">         while (this.itemsNeedFetching.length &amp;&amp; batchSize &gt; 0) {</span>
<a href="#l46.33"></a><span id="l46.33">             batchSize--;</span>
<a href="#l46.34"></a><span id="l46.34">             // ensureEncodedPath extracts only the path component of the item and</span>
<a href="#l46.35"></a><span id="l46.35">             // encodes it before it is sent to the server</span>
<a href="#l46.36"></a><span id="l46.36">             let locpath = this.calendar.ensureEncodedPath(this.itemsNeedFetching.pop());</span>
<a href="#l46.37"></a><span id="l46.37">             hrefString += &quot;&lt;D:href&gt;&quot; + cal.xml.escapeString(locpath) + &quot;&lt;/D:href&gt;&quot;;</span>
<a href="#l46.38"></a><span id="l46.38">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l47.4"></a><span id="l47.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l47.5"></a><span id="l47.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l47.6"></a><span id="l47.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l47.7"></a><span id="l47.7"> </span>
<a href="#l47.8"></a><span id="l47.8"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l47.9"></a><span id="l47.9"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l47.10"></a><span id="l47.10"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l47.11"></a><span id="l47.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l47.13"></a><span id="l47.13"> </span>
<a href="#l47.14"></a><span id="l47.14"> const cICL = Components.interfaces.calIChangeLog;</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16"> /**</span>
<a href="#l47.17"></a><span id="l47.17">  * calGoogleCalendar</span>
<a href="#l47.18"></a><span id="l47.18">  * This Implements a calICalendar Object adapted to the Google Calendar</span>
<a href="#l47.19"></a><span id="l47.19">  * Provider.</span>
<a href="#l47.20"></a><span id="l47.20">  *</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineat">@@ -248,30 +249,30 @@ calGoogleCalendar.prototype = {</span>
<a href="#l47.22"></a><span id="l47.22">                 return &quot;mailto:&quot; + this.googleCalendarName;</span>
<a href="#l47.23"></a><span id="l47.23">             case &quot;organizerCN&quot;:</span>
<a href="#l47.24"></a><span id="l47.24">                 if (this.mSession) {</span>
<a href="#l47.25"></a><span id="l47.25">                     return this.session.fullName;</span>
<a href="#l47.26"></a><span id="l47.26">                 }</span>
<a href="#l47.27"></a><span id="l47.27">                 break;</span>
<a href="#l47.28"></a><span id="l47.28">             case &quot;itip.transport&quot;:</span>
<a href="#l47.29"></a><span id="l47.29">                 if (!this.isDefaultCalendar ||</span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">-                    !getPrefSafe(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineplus">+                    !Preferences.get(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l47.32"></a><span id="l47.32">                     // If we explicitly return null here, then these calendars</span>
<a href="#l47.33"></a><span id="l47.33">                     // will not be included in the list of calendars to accept</span>
<a href="#l47.34"></a><span id="l47.34">                     // invitations to and imip will effectively be disabled.</span>
<a href="#l47.35"></a><span id="l47.35">                     return null;</span>
<a href="#l47.36"></a><span id="l47.36">                 }</span>
<a href="#l47.37"></a><span id="l47.37">                 break;</span>
<a href="#l47.38"></a><span id="l47.38">             case &quot;imip.identity.disabled&quot;:</span>
<a href="#l47.39"></a><span id="l47.39">                 // Disabling this hides the picker for identities in the new</span>
<a href="#l47.40"></a><span id="l47.40">                 // calendar wizard and calendar properties dialog. This should</span>
<a href="#l47.41"></a><span id="l47.41">                 // be done for all secondary calendars as they cannot accept</span>
<a href="#l47.42"></a><span id="l47.42">                 // invitations and if email invitations are generally disabled.</span>
<a href="#l47.43"></a><span id="l47.43">                 if (!this.isDefaultCalendar ||</span>
<a href="#l47.44"></a><span id="l47.44" class="difflineminus">-                    !getPrefSafe(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l47.45"></a><span id="l47.45" class="difflineplus">+                    !Preferences.get(&quot;calendar.google.enableEmailInvitations&quot;, false)) {</span>
<a href="#l47.46"></a><span id="l47.46">                     return true;</span>
<a href="#l47.47"></a><span id="l47.47">                 }</span>
<a href="#l47.48"></a><span id="l47.48">                 break;</span>
<a href="#l47.49"></a><span id="l47.49">         }</span>
<a href="#l47.50"></a><span id="l47.50"> </span>
<a href="#l47.51"></a><span id="l47.51">         return this.__proto__.__proto__.getProperty.apply(this, arguments);</span>
<a href="#l47.52"></a><span id="l47.52">     },</span>
<a href="#l47.53"></a><span id="l47.53"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleRequest.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleRequest.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l48.4"></a><span id="l48.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l48.5"></a><span id="l48.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l48.6"></a><span id="l48.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l48.7"></a><span id="l48.7"> </span>
<a href="#l48.8"></a><span id="l48.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l48.9"></a><span id="l48.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l48.10"></a><span id="l48.10"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l48.11"></a><span id="l48.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l48.12"></a><span id="l48.12"> </span>
<a href="#l48.13"></a><span id="l48.13"> /**</span>
<a href="#l48.14"></a><span id="l48.14">  * calGoogleRequest</span>
<a href="#l48.15"></a><span id="l48.15">  * This class represents a HTTP request sent to Google</span>
<a href="#l48.16"></a><span id="l48.16">  *</span>
<a href="#l48.17"></a><span id="l48.17">  * @constructor</span>
<a href="#l48.18"></a><span id="l48.18">  * @class</span>
<a href="#l48.19"></a><span id="l48.19">  */</span>
<a href="#l48.20"></a><span id="l48.20" class="difflineat">@@ -253,17 +254,17 @@ calGoogleRequest.prototype = {</span>
<a href="#l48.21"></a><span id="l48.21">                         this.mUploadContent + &quot;):\n&quot; + this.mUploadData);</span>
<a href="#l48.22"></a><span id="l48.22">             }</span>
<a href="#l48.23"></a><span id="l48.23">         }</span>
<a href="#l48.24"></a><span id="l48.24"> </span>
<a href="#l48.25"></a><span id="l48.25">         aChannel  = aChannel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l48.26"></a><span id="l48.26"> </span>
<a href="#l48.27"></a><span id="l48.27">         // Depending on the preference, we will use X-HTTP-Method-Override to</span>
<a href="#l48.28"></a><span id="l48.28">         // get around some proxies. This will default to true.</span>
<a href="#l48.29"></a><span id="l48.29" class="difflineminus">-        if (getPrefSafe(&quot;calendar.google.useHTTPMethodOverride&quot;, true) &amp;&amp;</span>
<a href="#l48.30"></a><span id="l48.30" class="difflineplus">+        if (Preferences.get(&quot;calendar.google.useHTTPMethodOverride&quot;, true) &amp;&amp;</span>
<a href="#l48.31"></a><span id="l48.31">             (this.method == &quot;PUT&quot; || this.method == &quot;DELETE&quot;)) {</span>
<a href="#l48.32"></a><span id="l48.32"> </span>
<a href="#l48.33"></a><span id="l48.33">             aChannel.requestMethod = &quot;POST&quot;;</span>
<a href="#l48.34"></a><span id="l48.34">             aChannel.setRequestHeader(&quot;X-HTTP-Method-Override&quot;,</span>
<a href="#l48.35"></a><span id="l48.35">                                       this.method,</span>
<a href="#l48.36"></a><span id="l48.36">                                       false);</span>
<a href="#l48.37"></a><span id="l48.37">             if (this.method == &quot;DELETE&quot;) {</span>
<a href="#l48.38"></a><span id="l48.38">                 // DELETE has no body, set an empty one so that Google accepts</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleUtils.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleUtils.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l49.4"></a><span id="l49.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l49.5"></a><span id="l49.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l49.6"></a><span id="l49.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l49.9"></a><span id="l49.9"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l49.10"></a><span id="l49.10"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l49.11"></a><span id="l49.11"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l49.13"></a><span id="l49.13"> </span>
<a href="#l49.14"></a><span id="l49.14"> const atomNS = &quot;http://www.w3.org/2005/Atom&quot;;</span>
<a href="#l49.15"></a><span id="l49.15"> const gdNS = &quot;http://schemas.google.com/g/2005&quot;;</span>
<a href="#l49.16"></a><span id="l49.16"> const gcalNS = &quot;http://schemas.google.com/gCal/2005&quot;;</span>
<a href="#l49.17"></a><span id="l49.17"> </span>
<a href="#l49.18"></a><span id="l49.18"> function gdataNSResolver(prefix) {</span>
<a href="#l49.19"></a><span id="l49.19">     const ns = {</span>
<a href="#l49.20"></a><span id="l49.20">         atom: atomNS,</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineat">@@ -53,18 +54,18 @@ function getGoogleSessionManager() {</span>
<a href="#l49.22"></a><span id="l49.22">  * @param aPrefValue    The Preference value</span>
<a href="#l49.23"></a><span id="l49.23">  *</span>
<a href="#l49.24"></a><span id="l49.24">  * @return              The value of aPrefValue</span>
<a href="#l49.25"></a><span id="l49.25">  *</span>
<a href="#l49.26"></a><span id="l49.26">  * @require aCalendar.googleCalendarName</span>
<a href="#l49.27"></a><span id="l49.27">  */</span>
<a href="#l49.28"></a><span id="l49.28"> function setCalendarPref(aCalendar, aPrefName, aPrefType, aPrefValue) {</span>
<a href="#l49.29"></a><span id="l49.29"> </span>
<a href="#l49.30"></a><span id="l49.30" class="difflineminus">-    cal.setPref(&quot;calendar.google.calPrefs.&quot; + aCalendar.googleCalendarName + &quot;.&quot; +</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-                aPrefName, aPrefValue, aPrefType);</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+    Preferences.set(&quot;calendar.google.calPrefs.&quot; + aCalendar.googleCalendarName + &quot;.&quot; +</span>
<a href="#l49.33"></a><span id="l49.33" class="difflineplus">+                    aPrefName, aPrefValue, aPrefType);</span>
<a href="#l49.34"></a><span id="l49.34"> </span>
<a href="#l49.35"></a><span id="l49.35">     return aPrefValue;</span>
<a href="#l49.36"></a><span id="l49.36"> }</span>
<a href="#l49.37"></a><span id="l49.37"> </span>
<a href="#l49.38"></a><span id="l49.38"> /**</span>
<a href="#l49.39"></a><span id="l49.39">  * getCalendarPref</span>
<a href="#l49.40"></a><span id="l49.40">  * Helper to get an independant Calendar Preference, since I cannot use the</span>
<a href="#l49.41"></a><span id="l49.41">  * calendar manager because of early initialization Problems.</span>
<a href="#l49.42"></a><span id="l49.42" class="difflineat">@@ -72,17 +73,17 @@ function setCalendarPref(aCalendar, aPre</span>
<a href="#l49.43"></a><span id="l49.43">  * @param aCalendar     The calendar to set the pref for</span>
<a href="#l49.44"></a><span id="l49.44">  * @param aPrefName     The preference name</span>
<a href="#l49.45"></a><span id="l49.45">  *</span>
<a href="#l49.46"></a><span id="l49.46">  * @return              The preference value</span>
<a href="#l49.47"></a><span id="l49.47">  *</span>
<a href="#l49.48"></a><span id="l49.48">  * @require aCalendar.googleCalendarName</span>
<a href="#l49.49"></a><span id="l49.49">  */</span>
<a href="#l49.50"></a><span id="l49.50"> function getCalendarPref(aCalendar, aPrefName) {</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineminus">-    return cal.getPrefSafe(&quot;calendar.google.calPrefs.&quot; +</span>
<a href="#l49.52"></a><span id="l49.52" class="difflineplus">+    return Preferences.get(&quot;calendar.google.calPrefs.&quot; +</span>
<a href="#l49.53"></a><span id="l49.53">                            aCalendar.googleCalendarName + &quot;.&quot;  + aPrefName);</span>
<a href="#l49.54"></a><span id="l49.54"> }</span>
<a href="#l49.55"></a><span id="l49.55"> </span>
<a href="#l49.56"></a><span id="l49.56"> /**</span>
<a href="#l49.57"></a><span id="l49.57">  * getFormattedString</span>
<a href="#l49.58"></a><span id="l49.58">  * Returns the string from the properties file, formatted with args</span>
<a href="#l49.59"></a><span id="l49.59">  *</span>
<a href="#l49.60"></a><span id="l49.60">  * @param aBundleName   The .properties file to access</span>
<a href="#l49.61"></a><span id="l49.61" class="difflineat">@@ -399,17 +400,17 @@ function ItemToXMLEntry(aItem, aCalendar</span>
<a href="#l49.62"></a><span id="l49.62">         status = &quot;CONFIRMED&quot;;</span>
<a href="#l49.63"></a><span id="l49.63">     }</span>
<a href="#l49.64"></a><span id="l49.64">     addElemNS(gdNS, &quot;eventStatus&quot;).setAttribute(&quot;value&quot;, kEVENT_SCHEMA + status.toLowerCase());</span>
<a href="#l49.65"></a><span id="l49.65"> </span>
<a href="#l49.66"></a><span id="l49.66">     // gd:where</span>
<a href="#l49.67"></a><span id="l49.67">     addElemNS(gdNS, &quot;where&quot;).setAttribute(&quot;valueString&quot;, aItem.getProperty(&quot;LOCATION&quot;) || &quot;&quot;);</span>
<a href="#l49.68"></a><span id="l49.68"> </span>
<a href="#l49.69"></a><span id="l49.69">     // gd:who</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineminus">-    if (cal.getPrefSafe(&quot;calendar.google.enableAttendees&quot;, false)) {</span>
<a href="#l49.71"></a><span id="l49.71" class="difflineplus">+    if (Preferences.get(&quot;calendar.google.enableAttendees&quot;, false)) {</span>
<a href="#l49.72"></a><span id="l49.72">         // XXX Only parse attendees if they are enabled, due to bug 407961</span>
<a href="#l49.73"></a><span id="l49.73"> </span>
<a href="#l49.74"></a><span id="l49.74">         let attendees = aItem.getAttendees({});</span>
<a href="#l49.75"></a><span id="l49.75">         if (aItem.organizer) {</span>
<a href="#l49.76"></a><span id="l49.76">             // Taking care of the organizer is the same as taking care of any other</span>
<a href="#l49.77"></a><span id="l49.77">             // attendee. Add the organizer to the local attendees list.</span>
<a href="#l49.78"></a><span id="l49.78">             attendees.push(aItem.organizer);</span>
<a href="#l49.79"></a><span id="l49.79">         }</span>
<a href="#l49.80"></a><span id="l49.80" class="difflineat">@@ -459,17 +460,17 @@ function ItemToXMLEntry(aItem, aCalendar</span>
<a href="#l49.81"></a><span id="l49.81">                 let attendeeStatusValue = kEVENT_SCHEMA + attendeeStatusMap[attendee.participationStatus];</span>
<a href="#l49.82"></a><span id="l49.82">                 attendeeStatusElement.setAttribute(&quot;value&quot;, attendeeStatusValue);</span>
<a href="#l49.83"></a><span id="l49.83">             }</span>
<a href="#l49.84"></a><span id="l49.84">         }</span>
<a href="#l49.85"></a><span id="l49.85">     }</span>
<a href="#l49.86"></a><span id="l49.86"> </span>
<a href="#l49.87"></a><span id="l49.87">     // Don't notify attendees by default. Use a preference in case the user</span>
<a href="#l49.88"></a><span id="l49.88">     // wants this to be turned on.</span>
<a href="#l49.89"></a><span id="l49.89" class="difflineminus">-    let notify = cal.getPrefSafe(&quot;calendar.google.sendEventNotifications&quot;, false);</span>
<a href="#l49.90"></a><span id="l49.90" class="difflineplus">+    let notify = Preferences.get(&quot;calendar.google.sendEventNotifications&quot;, false);</span>
<a href="#l49.91"></a><span id="l49.91">     addElemNS(gcalNS, &quot;sendEventNotifications&quot;).setAttribute(&quot;value&quot;, notify ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l49.92"></a><span id="l49.92"> </span>
<a href="#l49.93"></a><span id="l49.93">     // gd:when</span>
<a href="#l49.94"></a><span id="l49.94">     let duration = aItem.endDate.subtractDate(aItem.startDate);</span>
<a href="#l49.95"></a><span id="l49.95">     let whenElement;</span>
<a href="#l49.96"></a><span id="l49.96">     if (!aItem.recurrenceInfo) {</span>
<a href="#l49.97"></a><span id="l49.97">         // gd:when isn't allowed for recurring items where gd:recurrence is set</span>
<a href="#l49.98"></a><span id="l49.98">         whenElement = addElemNS(gdNS, &quot;when&quot;);</span>
<a href="#l49.99"></a><span id="l49.99" class="difflineat">@@ -1023,17 +1024,17 @@ function XMLEntryToItem(aXMLEntry, aTime</span>
<a href="#l49.100"></a><span id="l49.100">                 }</span>
<a href="#l49.101"></a><span id="l49.101">             }</span>
<a href="#l49.102"></a><span id="l49.102">         }</span>
<a href="#l49.103"></a><span id="l49.103"> </span>
<a href="#l49.104"></a><span id="l49.104">         // gd:where</span>
<a href="#l49.105"></a><span id="l49.105">         item.setProperty(&quot;LOCATION&quot;, gdataXPathFirst(aXMLEntry, 'gd:where/@valueString'));</span>
<a href="#l49.106"></a><span id="l49.106"> </span>
<a href="#l49.107"></a><span id="l49.107">         // gd:who</span>
<a href="#l49.108"></a><span id="l49.108" class="difflineminus">-        if (cal.getPrefSafe(&quot;calendar.google.enableAttendees&quot;, false)) {</span>
<a href="#l49.109"></a><span id="l49.109" class="difflineplus">+        if (Preferences.get(&quot;calendar.google.enableAttendees&quot;, false)) {</span>
<a href="#l49.110"></a><span id="l49.110">             // XXX Only parse attendees if they are enabled, due to bug 407961</span>
<a href="#l49.111"></a><span id="l49.111"> </span>
<a href="#l49.112"></a><span id="l49.112">             // This object can easily translate Google's values to our values.</span>
<a href="#l49.113"></a><span id="l49.113">             const attendeeStatusMap = {</span>
<a href="#l49.114"></a><span id="l49.114">                 // role</span>
<a href="#l49.115"></a><span id="l49.115">                 &quot;event.optional&quot;: &quot;OPT-PARTICIPANT&quot;,</span>
<a href="#l49.116"></a><span id="l49.116">                 &quot;event.required&quot;: &quot;REQ-PARTICIPANT&quot;,</span>
<a href="#l49.117"></a><span id="l49.117"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-migration.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-migration.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l50.4"></a><span id="l50.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l50.5"></a><span id="l50.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l50.6"></a><span id="l50.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l50.7"></a><span id="l50.7"> </span>
<a href="#l50.8"></a><span id="l50.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l50.9"></a><span id="l50.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l50.10"></a><span id="l50.10"> </span>
<a href="#l50.11"></a><span id="l50.11"> /**</span>
<a href="#l50.12"></a><span id="l50.12">  * Migrate the calendar selected in the wizard from ics to gdata.</span>
<a href="#l50.13"></a><span id="l50.13">  */</span>
<a href="#l50.14"></a><span id="l50.14"> function migrateSelectedCalendars() {</span>
<a href="#l50.15"></a><span id="l50.15">     let listbox = document.getElementById(&quot;calendars-listbox&quot;);</span>
<a href="#l50.16"></a><span id="l50.16">     let calmgr = cal.getCalendarManager();</span>
<a href="#l50.17"></a><span id="l50.17"> </span>
<a href="#l50.18"></a><span id="l50.18" class="difflineat">@@ -34,18 +35,18 @@ function migrateSelectedCalendars() {</span>
<a href="#l50.19"></a><span id="l50.19">             newCal.setProperty(&quot;calendar-main-default&quot;,</span>
<a href="#l50.20"></a><span id="l50.20">                                item.calendar.getProperty(&quot;calendar-main-default&quot;));</span>
<a href="#l50.21"></a><span id="l50.21"> </span>
<a href="#l50.22"></a><span id="l50.22">             calmgr.registerCalendar(newCal);</span>
<a href="#l50.23"></a><span id="l50.23">         }</span>
<a href="#l50.24"></a><span id="l50.24">     }</span>
<a href="#l50.25"></a><span id="l50.25"> </span>
<a href="#l50.26"></a><span id="l50.26">     // Only bring up the dialog on the next startup if the user wants us to.</span>
<a href="#l50.27"></a><span id="l50.27" class="difflineminus">-    cal.setPref(&quot;calendar.google.migrate&quot;,</span>
<a href="#l50.28"></a><span id="l50.28" class="difflineminus">-                document.getElementById(&quot;showagain-checkbox&quot;).checked);</span>
<a href="#l50.29"></a><span id="l50.29" class="difflineplus">+    Preferences.set(&quot;calendar.google.migrate&quot;,</span>
<a href="#l50.30"></a><span id="l50.30" class="difflineplus">+                    document.getElementById(&quot;showagain-checkbox&quot;).checked);</span>
<a href="#l50.31"></a><span id="l50.31"> }</span>
<a href="#l50.32"></a><span id="l50.32"> </span>
<a href="#l50.33"></a><span id="l50.33"> /**</span>
<a href="#l50.34"></a><span id="l50.34">  * Get all calendars that are ics and point to a google calendar</span>
<a href="#l50.35"></a><span id="l50.35">  *</span>
<a href="#l50.36"></a><span id="l50.36">  * @return An array of calendars that are migratable</span>
<a href="#l50.37"></a><span id="l50.37">  */</span>
<a href="#l50.38"></a><span id="l50.38"> function getMigratableCalendars() {</span>
<a href="#l50.39"></a><span id="l50.39" class="difflineat">@@ -74,21 +75,21 @@ function gdata_migration_loader() {</span>
<a href="#l50.40"></a><span id="l50.40">         for each (let calendar in sortCalendarArray(getMigratableCalendars())) {</span>
<a href="#l50.41"></a><span id="l50.41">             let item = listbox.appendItem(calendar.name, calendar.id);</span>
<a href="#l50.42"></a><span id="l50.42">             item.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l50.43"></a><span id="l50.43">             item.calendar = calendar;</span>
<a href="#l50.44"></a><span id="l50.44">         }</span>
<a href="#l50.45"></a><span id="l50.45"> </span>
<a href="#l50.46"></a><span id="l50.46">         // Set up the &quot;always check&quot; field</span>
<a href="#l50.47"></a><span id="l50.47">         document.getElementById(&quot;showagain-checkbox&quot;).checked =</span>
<a href="#l50.48"></a><span id="l50.48" class="difflineminus">-            cal.getPrefSafe(&quot;calendar.google.migrate&quot;, true);</span>
<a href="#l50.49"></a><span id="l50.49" class="difflineplus">+            Preferences.get(&quot;calendar.google.migrate&quot;, true);</span>
<a href="#l50.50"></a><span id="l50.50">     } else {</span>
<a href="#l50.51"></a><span id="l50.51">         // This is not the migration wizard, so it must be a main window. Check</span>
<a href="#l50.52"></a><span id="l50.52">         // if the migration wizard needs to be shown.</span>
<a href="#l50.53"></a><span id="l50.53" class="difflineminus">-        if (cal.getPrefSafe(&quot;calendar.google.migrate&quot;, true)) {</span>
<a href="#l50.54"></a><span id="l50.54" class="difflineplus">+        if (Preferences.get(&quot;calendar.google.migrate&quot;, true)) {</span>
<a href="#l50.55"></a><span id="l50.55">             // Check if there are calendars that are worth migrating.</span>
<a href="#l50.56"></a><span id="l50.56">             if (getMigratableCalendars().length &gt; 0) {</span>
<a href="#l50.57"></a><span id="l50.57">                 // Do this after load, so the calendar window appears before the</span>
<a href="#l50.58"></a><span id="l50.58">                 // wizard is opened.</span>
<a href="#l50.59"></a><span id="l50.59"> </span>
<a href="#l50.60"></a><span id="l50.60">                 // XXX Waiting a second gives the views enough time to display</span>
<a href="#l50.61"></a><span id="l50.61">                 // right, at least on my system. The viewloaded event is quite</span>
<a href="#l50.62"></a><span id="l50.62">                 // view specific, so there is no good non-hacked way to do this.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l51.4"></a><span id="l51.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l51.5"></a><span id="l51.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l51.6"></a><span id="l51.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l51.7"></a><span id="l51.7"> </span>
<a href="#l51.8"></a><span id="l51.8"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l51.9"></a><span id="l51.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l51.10"></a><span id="l51.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l51.11"></a><span id="l51.11"> </span>
<a href="#l51.12"></a><span id="l51.12"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l51.13"></a><span id="l51.13"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l51.14"></a><span id="l51.14"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l51.15"></a><span id="l51.15"> </span>
<a href="#l51.16"></a><span id="l51.16"> //</span>
<a href="#l51.17"></a><span id="l51.17"> // calICSCalendar.js</span>
<a href="#l51.18"></a><span id="l51.18"> //</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineat">@@ -703,18 +704,18 @@ calICSCalendar.prototype = {</span>
<a href="#l51.20"></a><span id="l51.20">                 oldFile.copyTo(newParentDir, newName);</span>
<a href="#l51.21"></a><span id="l51.21">             } catch(e) {</span>
<a href="#l51.22"></a><span id="l51.22">                 cal.ERROR(&quot;[calICSCalendar] Backup failed, no copy: &quot; + e);</span>
<a href="#l51.23"></a><span id="l51.23">                 // Error in making a daily/initial backup.</span>
<a href="#l51.24"></a><span id="l51.24">                 // not fatal, so just continue</span>
<a href="#l51.25"></a><span id="l51.25">             }</span>
<a href="#l51.26"></a><span id="l51.26">         }</span>
<a href="#l51.27"></a><span id="l51.27"> </span>
<a href="#l51.28"></a><span id="l51.28" class="difflineminus">-        var backupDays = getPrefSafe(&quot;calendar.backup.days&quot;, 1);</span>
<a href="#l51.29"></a><span id="l51.29" class="difflineminus">-        var numBackupFiles = getPrefSafe(&quot;calendar.backup.filenum&quot;, 3);</span>
<a href="#l51.30"></a><span id="l51.30" class="difflineplus">+        var backupDays = Preferences.get(&quot;calendar.backup.days&quot;, 1);</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineplus">+        var numBackupFiles = Preferences.get(&quot;calendar.backup.filenum&quot;, 3);</span>
<a href="#l51.32"></a><span id="l51.32"> </span>
<a href="#l51.33"></a><span id="l51.33">         try {</span>
<a href="#l51.34"></a><span id="l51.34">             var backupDir = cal.getCalendarDirectory();</span>
<a href="#l51.35"></a><span id="l51.35">             backupDir.append(&quot;backup&quot;);</span>
<a href="#l51.36"></a><span id="l51.36">             if (!backupDir.exists()) {</span>
<a href="#l51.37"></a><span id="l51.37">                 backupDir.create(CI.nsIFile.DIRECTORY_TYPE, parseInt(&quot;0755&quot;, 8));</span>
<a href="#l51.38"></a><span id="l51.38">             }</span>
<a href="#l51.39"></a><span id="l51.39">         } catch(e) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarModule.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l52.4"></a><span id="l52.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l52.5"></a><span id="l52.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l52.6"></a><span id="l52.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l52.9"></a><span id="l52.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l52.10"></a><span id="l52.10"> </span>
<a href="#l52.11"></a><span id="l52.11"> //</span>
<a href="#l52.12"></a><span id="l52.12"> // init code for globals, prefs:</span>
<a href="#l52.13"></a><span id="l52.13"> //</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15"> // constants:</span>
<a href="#l52.16"></a><span id="l52.16"> const NS_OK = Components.results.NS_OK;</span>
<a href="#l52.17"></a><span id="l52.17"> const NS_ERROR_UNEXPECTED = Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l52.18"></a><span id="l52.18" class="difflineat">@@ -45,18 +46,18 @@ function initWcapProvider() {</span>
<a href="#l52.19"></a><span id="l52.19">         initLogging();</span>
<a href="#l52.20"></a><span id="l52.20"> </span>
<a href="#l52.21"></a><span id="l52.21">         // some string resources:</span>
<a href="#l52.22"></a><span id="l52.22">         g_privateItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;privateItem.title.text&quot;);</span>
<a href="#l52.23"></a><span id="l52.23">         g_confidentialItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;confidentialItem.title.text&quot;);</span>
<a href="#l52.24"></a><span id="l52.24">         g_busyItemTitle = cal.calGetString(&quot;wcap&quot;, &quot;busyItem.title.text&quot;);</span>
<a href="#l52.25"></a><span id="l52.25">         g_busyPhantomItemUuidPrefix = (&quot;PHANTOM_uuid_&quot; + cal.getUUID());</span>
<a href="#l52.26"></a><span id="l52.26"> </span>
<a href="#l52.27"></a><span id="l52.27" class="difflineminus">-        CACHE_LAST_RESULTS = cal.getPrefSafe(&quot;calendar.wcap.cache_last_results&quot;, 4);</span>
<a href="#l52.28"></a><span id="l52.28" class="difflineminus">-        CACHE_LAST_RESULTS_INVALIDATE = cal.getPrefSafe(&quot;calendar.wcap.cache_last_results_invalidate&quot;, 120);</span>
<a href="#l52.29"></a><span id="l52.29" class="difflineplus">+        CACHE_LAST_RESULTS = Preferences.get(&quot;calendar.wcap.cache_last_results&quot;, 4);</span>
<a href="#l52.30"></a><span id="l52.30" class="difflineplus">+        CACHE_LAST_RESULTS_INVALIDATE = Preferences.get(&quot;calendar.wcap.cache_last_results_invalidate&quot;, 120);</span>
<a href="#l52.31"></a><span id="l52.31">     } catch (exc) {</span>
<a href="#l52.32"></a><span id="l52.32">         logError(exc, &quot;error in init sequence&quot;);</span>
<a href="#l52.33"></a><span id="l52.33">     }</span>
<a href="#l52.34"></a><span id="l52.34"> }</span>
<a href="#l52.35"></a><span id="l52.35"> </span>
<a href="#l52.36"></a><span id="l52.36"> /** Module Registration */</span>
<a href="#l52.37"></a><span id="l52.37"> const scriptLoadOrder = [</span>
<a href="#l52.38"></a><span id="l52.38">     &quot;calUtils.js&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -1,16 +1,17 @@</span>
<a href="#l53.4"></a><span id="l53.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l53.5"></a><span id="l53.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l53.6"></a><span id="l53.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l53.7"></a><span id="l53.7"> </span>
<a href="#l53.8"></a><span id="l53.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l53.9"></a><span id="l53.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l53.10"></a><span id="l53.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l53.11"></a><span id="l53.11"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l53.13"></a><span id="l53.13"> </span>
<a href="#l53.14"></a><span id="l53.14"> function calWcapTimezone(tzProvider, tzid_, component_) {</span>
<a href="#l53.15"></a><span id="l53.15">     this.wrappedJSObject = this;</span>
<a href="#l53.16"></a><span id="l53.16">     this.provider = tzProvider;</span>
<a href="#l53.17"></a><span id="l53.17">     this.icalComponent = component_;</span>
<a href="#l53.18"></a><span id="l53.18">     this.tzid = tzid_;</span>
<a href="#l53.19"></a><span id="l53.19">     this.isUTC = false;</span>
<a href="#l53.20"></a><span id="l53.20">     this.isFloating = false;</span>
<a href="#l53.21"></a><span id="l53.21" class="difflineat">@@ -1152,17 +1153,17 @@ function confirmInsecureLogin(uri)</span>
<a href="#l53.22"></a><span id="l53.22">             // save decision for all running calendars and</span>
<a href="#l53.23"></a><span id="l53.23">             // all future confirmations:</span>
<a href="#l53.24"></a><span id="l53.24">             var confirmedHttpLogins = getPref(&quot;calendar.wcap.confirmed_http_logins&quot;, &quot;&quot;);</span>
<a href="#l53.25"></a><span id="l53.25">             if (confirmedHttpLogins.length &gt; 0) {</span>
<a href="#l53.26"></a><span id="l53.26">                 confirmedHttpLogins += &quot;,&quot;;</span>
<a href="#l53.27"></a><span id="l53.27">             }</span>
<a href="#l53.28"></a><span id="l53.28">             confirmedEntry = (bConfirmed ? &quot;1&quot; : &quot;0&quot;);</span>
<a href="#l53.29"></a><span id="l53.29">             confirmedHttpLogins += (encodedHost + &quot;:&quot; + confirmedEntry);</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineminus">-            cal.setPref(&quot;calendar.wcap.confirmed_http_logins&quot;, confirmedHttpLogins);</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineplus">+            Preferences.set(&quot;calendar.wcap.confirmed_http_logins&quot;, confirmedHttpLogins);</span>
<a href="#l53.32"></a><span id="l53.32">             getPref(&quot;calendar.wcap.confirmed_http_logins&quot;); // log written entry</span>
<a href="#l53.33"></a><span id="l53.33">             confirmInsecureLogin.m_confirmedHttpLogins[encodedHost] = confirmedEntry;</span>
<a href="#l53.34"></a><span id="l53.34">         }</span>
<a href="#l53.35"></a><span id="l53.35">     }</span>
<a href="#l53.36"></a><span id="l53.36"> </span>
<a href="#l53.37"></a><span id="l53.37">     log(&quot;returned: &quot; + bConfirmed, &quot;confirmInsecureLogin(&quot; + host + &quot;)&quot;);</span>
<a href="#l53.38"></a><span id="l53.38">     return bConfirmed;</span>
<a href="#l53.39"></a><span id="l53.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapUtils.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l54.4"></a><span id="l54.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l54.5"></a><span id="l54.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l54.6"></a><span id="l54.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l54.7"></a><span id="l54.7"> </span>
<a href="#l54.8"></a><span id="l54.8"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l54.9"></a><span id="l54.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l54.10"></a><span id="l54.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l54.11"></a><span id="l54.11"> </span>
<a href="#l54.12"></a><span id="l54.12"> var g_bShutdown = false;</span>
<a href="#l54.13"></a><span id="l54.13"> </span>
<a href="#l54.14"></a><span id="l54.14"> function initLogging() {</span>
<a href="#l54.15"></a><span id="l54.15">     initLogging.mLogTimezone = calendarDefaultTimezone();</span>
<a href="#l54.16"></a><span id="l54.16">     if (initLogging.mLogFilestream) {</span>
<a href="#l54.17"></a><span id="l54.17">         try {</span>
<a href="#l54.18"></a><span id="l54.18">             initLogging.mLogFilestream.close();</span>
<a href="#l54.19"></a><span id="l54.19" class="difflineat">@@ -206,13 +207,13 @@ function getDatetimeFromIcalString(val) </span>
<a href="#l54.20"></a><span id="l54.20"> function getDatetimeFromIcalProp(prop) {</span>
<a href="#l54.21"></a><span id="l54.21">     if (!prop) {</span>
<a href="#l54.22"></a><span id="l54.22">         return null;</span>
<a href="#l54.23"></a><span id="l54.23">     }</span>
<a href="#l54.24"></a><span id="l54.24">     return getDatetimeFromIcalString(prop.valueAsIcalString);</span>
<a href="#l54.25"></a><span id="l54.25"> }</span>
<a href="#l54.26"></a><span id="l54.26"> </span>
<a href="#l54.27"></a><span id="l54.27"> function getPref(prefName, defaultValue) {</span>
<a href="#l54.28"></a><span id="l54.28" class="difflineminus">-    var ret = getPrefSafe(prefName, defaultValue);</span>
<a href="#l54.29"></a><span id="l54.29" class="difflineplus">+    var ret = Preferences.get(prefName, defaultValue);</span>
<a href="#l54.30"></a><span id="l54.30">     log(ret, &quot;getPref(): prefName=&quot; + prefName);</span>
<a href="#l54.31"></a><span id="l54.31">     return ret;</span>
<a href="#l54.32"></a><span id="l54.32"> }</span>
<a href="#l54.33"></a><span id="l54.33"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/resources/content/calendar.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/resources/content/calendar.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -2,16 +2,17 @@</span>
<a href="#l55.4"></a><span id="l55.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l55.5"></a><span id="l55.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l55.6"></a><span id="l55.6"> </span>
<a href="#l55.7"></a><span id="l55.7"> /**</span>
<a href="#l55.8"></a><span id="l55.8">  * Called from calendar.xul window onload.</span>
<a href="#l55.9"></a><span id="l55.9">  */</span>
<a href="#l55.10"></a><span id="l55.10"> </span>
<a href="#l55.11"></a><span id="l55.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l55.13"></a><span id="l55.13"> </span>
<a href="#l55.14"></a><span id="l55.14"> function calendarInit() {</span>
<a href="#l55.15"></a><span id="l55.15">     // Take care of common initialization</span>
<a href="#l55.16"></a><span id="l55.16">     commonInitCalendar();</span>
<a href="#l55.17"></a><span id="l55.17"> </span>
<a href="#l55.18"></a><span id="l55.18">     var toolbox = document.getElementById(&quot;calendar-toolbox&quot;);</span>
<a href="#l55.19"></a><span id="l55.19">     toolbox.customizeDone = CalendarToolboxCustomizeDone;</span>
<a href="#l55.20"></a><span id="l55.20"> </span>
<a href="#l55.21"></a><span id="l55.21" class="difflineat">@@ -134,17 +135,17 @@ function closeCalendar() {</span>
<a href="#l55.22"></a><span id="l55.22"> function openPreferences() {</span>
<a href="#l55.23"></a><span id="l55.23">     // Check to see if the prefwindow is already open</span>
<a href="#l55.24"></a><span id="l55.24">     var win = Services.wm.getMostRecentWindow(&quot;Calendar:Preferences&quot;);</span>
<a href="#l55.25"></a><span id="l55.25"> </span>
<a href="#l55.26"></a><span id="l55.26">     if (win) {</span>
<a href="#l55.27"></a><span id="l55.27">         win.focus();</span>
<a href="#l55.28"></a><span id="l55.28">     } else {</span>
<a href="#l55.29"></a><span id="l55.29">         // The prefwindow should only be modal on non-instant-apply platforms</span>
<a href="#l55.30"></a><span id="l55.30" class="difflineminus">-        var instApply = getPrefSafe(&quot;browser.preferences.instantApply&quot;, false);</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineplus">+        var instApply = Preferences.get(&quot;browser.preferences.instantApply&quot;, false);</span>
<a href="#l55.32"></a><span id="l55.32"> </span>
<a href="#l55.33"></a><span id="l55.33">         var features = &quot;chrome,titlebar,toolbar,centerscreen,&quot; +</span>
<a href="#l55.34"></a><span id="l55.34">                        (instApply ? &quot;dialog=no&quot; : &quot;modal&quot;);</span>
<a href="#l55.35"></a><span id="l55.35"> </span>
<a href="#l55.36"></a><span id="l55.36">         var url = &quot;chrome://calendar/content/preferences/preferences.xul&quot;;</span>
<a href="#l55.37"></a><span id="l55.37"> </span>
<a href="#l55.38"></a><span id="l55.38">         openDialog(url, &quot;Preferences&quot;, features);</span>
<a href="#l55.39"></a><span id="l55.39">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/test/mozmill/eventDialog/testUTF8.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -1,24 +1,24 @@</span>
<a href="#l56.4"></a><span id="l56.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l56.5"></a><span id="l56.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l56.6"></a><span id="l56.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l56.7"></a><span id="l56.7"> </span>
<a href="#l56.8"></a><span id="l56.8"> var calUtils = require(&quot;../shared-modules/calendar-utils&quot;);</span>
<a href="#l56.9"></a><span id="l56.9"> var prefs = require(&quot;../shared-modules/prefs&quot;);</span>
<a href="#l56.10"></a><span id="l56.10" class="difflineminus">-// needed to set utf8 values in prefs</span>
<a href="#l56.11"></a><span id="l56.11" class="difflineminus">-Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineplus">+</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l56.14"></a><span id="l56.14"> </span>
<a href="#l56.15"></a><span id="l56.15"> var sleep = 500;</span>
<a href="#l56.16"></a><span id="l56.16"> var UTF8string = &quot;&quot;;</span>
<a href="#l56.17"></a><span id="l56.17"> </span>
<a href="#l56.18"></a><span id="l56.18"> var setupModule = function(module) {</span>
<a href="#l56.19"></a><span id="l56.19">   controller = mozmill.getMail3PaneController();</span>
<a href="#l56.20"></a><span id="l56.20">   calUtils.createCalendar(controller, UTF8string);</span>
<a href="#l56.21"></a><span id="l56.21" class="difflineminus">-  cal.setLocalizedPref(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l56.22"></a><span id="l56.22" class="difflineplus">+  Preferences.set(&quot;calendar.categories.names&quot;, UTF8string);</span>
<a href="#l56.23"></a><span id="l56.23"> }</span>
<a href="#l56.24"></a><span id="l56.24"> </span>
<a href="#l56.25"></a><span id="l56.25"> var testUTF8 = function () {</span>
<a href="#l56.26"></a><span id="l56.26">   let eventDialog = '/id(&quot;calendar-event-dialog&quot;)/id(&quot;event-grid&quot;)/id(&quot;event-grid-rows&quot;)/';</span>
<a href="#l56.27"></a><span id="l56.27">   </span>
<a href="#l56.28"></a><span id="l56.28">   controller.click(new elementslib.ID(controller.window.document,&quot;calendar-tab-button&quot;));</span>
<a href="#l56.29"></a><span id="l56.29">   calUtils.switchToView(controller, &quot;day&quot;);</span>
<a href="#l56.30"></a><span id="l56.30">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/test/unit/head_consts.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/test/unit/head_consts.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l57.4"></a><span id="l57.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l57.5"></a><span id="l57.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l57.6"></a><span id="l57.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l57.7"></a><span id="l57.7"> </span>
<a href="#l57.8"></a><span id="l57.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l57.9"></a><span id="l57.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l57.10"></a><span id="l57.10" class="difflineplus">+</span>
<a href="#l57.11"></a><span id="l57.11"> Components.utils.import(&quot;resource://testing-common/AppInfo.jsm&quot;);</span>
<a href="#l57.12"></a><span id="l57.12"> updateAppInfo();</span>
<a href="#l57.13"></a><span id="l57.13"> </span>
<a href="#l57.14"></a><span id="l57.14"> const Cc = Components.classes;</span>
<a href="#l57.15"></a><span id="l57.15"> const Ci = Components.interfaces;</span>
<a href="#l57.16"></a><span id="l57.16"> const Cr = Components.results;</span>
<a href="#l57.17"></a><span id="l57.17"> </span>
<a href="#l57.18"></a><span id="l57.18"> Services.prefs.setBoolPref(&quot;calendar.icaljs&quot;, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/test/unit/test_extract.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/test/unit/test_extract.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l58.4"></a><span id="l58.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l58.5"></a><span id="l58.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l58.6"></a><span id="l58.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l58.7"></a><span id="l58.7"> </span>
<a href="#l58.8"></a><span id="l58.8"> Components.utils.import(&quot;resource://calendar/modules/calExtract.jsm&quot;);</span>
<a href="#l58.9"></a><span id="l58.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Preferences.jsm&quot;);</span>
<a href="#l58.10"></a><span id="l58.10" class="difflineplus">+</span>
<a href="#l58.11"></a><span id="l58.11"> var baseUrl = &quot;jar:resource://calendar/chrome/calendar-LOCALE.jar!/locale/LOCALE/calendar/calendar-extract.properties&quot;;</span>
<a href="#l58.12"></a><span id="l58.12"> var extractor = new Extractor(baseUrl, &quot;en-US&quot;, 8);</span>
<a href="#l58.13"></a><span id="l58.13"> </span>
<a href="#l58.14"></a><span id="l58.14"> function run_test() {</span>
<a href="#l58.15"></a><span id="l58.15">     test_event_start_end();</span>
<a href="#l58.16"></a><span id="l58.16">     test_event_start_duration();</span>
<a href="#l58.17"></a><span id="l58.17">     test_event_start_end_whitespace();</span>
<a href="#l58.18"></a><span id="l58.18">     test_event_without_date();</span>
<a href="#l58.19"></a><span id="l58.19" class="difflineat">@@ -169,17 +171,17 @@ function test_overrides() {</span>
<a href="#l58.20"></a><span id="l58.20">     do_check_eq(endGuess.hour, undefined);</span>
<a href="#l58.21"></a><span id="l58.21">     do_check_eq(endGuess.minute, undefined);</span>
<a href="#l58.22"></a><span id="l58.22"> </span>
<a href="#l58.23"></a><span id="l58.23">     // recognize a custom &quot;tomorrow&quot; and hour.minutes pattern</span>
<a href="#l58.24"></a><span id="l58.24">     let overrides = {&quot;from.hour.minutes&quot;:</span>
<a href="#l58.25"></a><span id="l58.25">                       {&quot;add&quot;: &quot;%2$S:%1$S&quot;, &quot;remove&quot;: &quot;%1$S:%2$S&quot;},</span>
<a href="#l58.26"></a><span id="l58.26">                      &quot;from.tomorrow&quot;:</span>
<a href="#l58.27"></a><span id="l58.27">                       {&quot;add&quot;: &quot;worromot&quot;}};</span>
<a href="#l58.28"></a><span id="l58.28" class="difflineminus">-    cal.setPref(&quot;calendar.patterns.override&quot;, JSON.stringify(overrides));</span>
<a href="#l58.29"></a><span id="l58.29" class="difflineplus">+    Preferences.set(&quot;calendar.patterns.override&quot;, JSON.stringify(overrides));</span>
<a href="#l58.30"></a><span id="l58.30"> </span>
<a href="#l58.31"></a><span id="l58.31">     collected = extractor.extract(title, content, date, undefined);</span>
<a href="#l58.32"></a><span id="l58.32">     guessed = extractor.guessStart(false);</span>
<a href="#l58.33"></a><span id="l58.33">     endGuess = extractor.guessEnd(guessed, true);</span>
<a href="#l58.34"></a><span id="l58.34"> </span>
<a href="#l58.35"></a><span id="l58.35">     do_check_eq(guessed.year, 2012);</span>
<a href="#l58.36"></a><span id="l58.36">     do_check_eq(guessed.month, 10);</span>
<a href="#l58.37"></a><span id="l58.37">     do_check_eq(guessed.day, 2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/test/unit/test_freebusy.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/test/unit/test_freebusy.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -45,17 +45,17 @@ function test_period() {</span>
<a href="#l59.4"></a><span id="l59.4">     do_check_eq(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l59.5"></a><span id="l59.5"> </span>
<a href="#l59.6"></a><span id="l59.6">     period.icalString = &quot;20120101T010105/PT1S&quot;;</span>
<a href="#l59.7"></a><span id="l59.7">     do_check_eq(period.start.icalString, &quot;20120101T010105&quot;);</span>
<a href="#l59.8"></a><span id="l59.8">     do_check_eq(period.end.icalString, &quot;20120101T010106&quot;);</span>
<a href="#l59.9"></a><span id="l59.9">     do_check_eq(period.duration.icalString, &quot;PT1S&quot;);</span>
<a href="#l59.10"></a><span id="l59.10"> </span>
<a href="#l59.11"></a><span id="l59.11">     period.makeImmutable();</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-    if (!cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+    if (!Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l59.14"></a><span id="l59.14">         // ical.js doesn't support immutability yet</span>
<a href="#l59.15"></a><span id="l59.15">         do_check_throws(function() {</span>
<a href="#l59.16"></a><span id="l59.16">             period.start = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l59.17"></a><span id="l59.17">         }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l59.18"></a><span id="l59.18">         do_check_throws(function() {</span>
<a href="#l59.19"></a><span id="l59.19">             period.end = cal.createDateTime(&quot;20120202T020202&quot;);</span>
<a href="#l59.20"></a><span id="l59.20">         }, Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE);</span>
<a href="#l59.21"></a><span id="l59.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/test/unit/test_ics_parser.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_parser.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l60.4"></a><span id="l60.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l60.5"></a><span id="l60.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l60.6"></a><span id="l60.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l60.7"></a><span id="l60.7"> </span>
<a href="#l60.8"></a><span id="l60.8"> function run_test() {</span>
<a href="#l60.9"></a><span id="l60.9">     test_roundtrip();</span>
<a href="#l60.10"></a><span id="l60.10">     test_async();</span>
<a href="#l60.11"></a><span id="l60.11" class="difflineminus">-    if (cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) test_failures();</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineplus">+    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) test_failures();</span>
<a href="#l60.13"></a><span id="l60.13">     test_fake_parent();</span>
<a href="#l60.14"></a><span id="l60.14">     test_props_comps();</span>
<a href="#l60.15"></a><span id="l60.15">     test_timezone();</span>
<a href="#l60.16"></a><span id="l60.16"> }</span>
<a href="#l60.17"></a><span id="l60.17"> </span>
<a href="#l60.18"></a><span id="l60.18"> function test_props_comps() {</span>
<a href="#l60.19"></a><span id="l60.19">     let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l60.20"></a><span id="l60.20">                            .createInstance(Components.interfaces.calIIcsParser);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/test/unit/test_ics_service.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_service.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l61.4"></a><span id="l61.4"> function run_test() {</span>
<a href="#l61.5"></a><span id="l61.5">     test_iterator();</span>
<a href="#l61.6"></a><span id="l61.6">     test_icalcomponent();</span>
<a href="#l61.7"></a><span id="l61.7">     test_icsservice();</span>
<a href="#l61.8"></a><span id="l61.8">     test_icalstring();</span>
<a href="#l61.9"></a><span id="l61.9">     test_param();</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11">     // Only supported with ical.js</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-    if (cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) test_icalproperty();</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) test_icalproperty();</span>
<a href="#l61.14"></a><span id="l61.14"> }</span>
<a href="#l61.15"></a><span id="l61.15"> </span>
<a href="#l61.16"></a><span id="l61.16"> function test_icalstring() {</span>
<a href="#l61.17"></a><span id="l61.17">     function checkComp(createFunc, icalString, members, properties) {</span>
<a href="#l61.18"></a><span id="l61.18">         let thing = createFunc(icalString);</span>
<a href="#l61.19"></a><span id="l61.19">         do_check_eq(ics_unfoldline(thing.icalString), icalString + &quot;\r\n&quot;);</span>
<a href="#l61.20"></a><span id="l61.20"> </span>
<a href="#l61.21"></a><span id="l61.21">         if (members) {</span>
<a href="#l61.22"></a><span id="l61.22" class="difflineat">@@ -54,17 +54,17 @@ function test_icalstring() {</span>
<a href="#l61.23"></a><span id="l61.23">               { relType: &quot;SIBLING&quot;, relId: &quot;VALUE&quot; },</span>
<a href="#l61.24"></a><span id="l61.24">               { FOO: &quot;BAR&quot; });</span>
<a href="#l61.25"></a><span id="l61.25"> </span>
<a href="#l61.26"></a><span id="l61.26">     let rrule = checkComp(cal.createRecurrenceRule.bind(cal),</span>
<a href="#l61.27"></a><span id="l61.27">                           &quot;RRULE:FREQ=WEEKLY;COUNT=5;INTERVAL=2;BYDAY=MO&quot;,</span>
<a href="#l61.28"></a><span id="l61.28">                           { count: 5, isByCount: true, type: &quot;WEEKLY&quot;, interval: 2 });</span>
<a href="#l61.29"></a><span id="l61.29">     do_check_eq(rrule.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l61.30"></a><span id="l61.30"> </span>
<a href="#l61.31"></a><span id="l61.31" class="difflineminus">-    if (cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l61.32"></a><span id="l61.32" class="difflineplus">+    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l61.33"></a><span id="l61.33">         let rdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l61.34"></a><span id="l61.34">                               &quot;RDATE:20120101T000000&quot;,</span>
<a href="#l61.35"></a><span id="l61.35">                               { isNegative: false });</span>
<a href="#l61.36"></a><span id="l61.36">         do_check_eq(rdate.date.compare(cal.createDateTime(&quot;20120101T000000&quot;)), 0);</span>
<a href="#l61.37"></a><span id="l61.37">     } else {</span>
<a href="#l61.38"></a><span id="l61.38">         let rdate = checkComp(cal.createRecurrenceDate.bind(cal),</span>
<a href="#l61.39"></a><span id="l61.39">                               &quot;RDATE;VALUE=DATE-TIME:20120101T000000&quot;,</span>
<a href="#l61.40"></a><span id="l61.40">                               { isNegative: false });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -301,17 +301,17 @@ function test_clone(event) {</span>
<a href="#l62.4"></a><span id="l62.4">                     newRecurItems[i].icalProperty.icalString);</span>
<a href="#l62.5"></a><span id="l62.5">     }</span>
<a href="#l62.6"></a><span id="l62.6"> }</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8"> function test_interface() {</span>
<a href="#l62.9"></a><span id="l62.9">     let RRULE = &quot;RRULE:FREQ=WEEKLY;COUNT=6;BYDAY=TU,WE\r\n&quot;;</span>
<a href="#l62.10"></a><span id="l62.10">     let EXDATE = &quot;EXDATE:20020403T114500Z\r\n&quot;</span>
<a href="#l62.11"></a><span id="l62.11">     let RDATE;</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-    if (cal.getPrefSafe(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+    if (Preferences.get(&quot;calendar.icaljs&quot;, false)) {</span>
<a href="#l62.14"></a><span id="l62.14">         RDATE = &quot;RDATE:20020401T114500Z\r\n&quot;;</span>
<a href="#l62.15"></a><span id="l62.15">     } else {</span>
<a href="#l62.16"></a><span id="l62.16">         RDATE = &quot;RDATE;VALUE=DATE-TIME:20020401T114500Z\r\n&quot;;</span>
<a href="#l62.17"></a><span id="l62.17">     }</span>
<a href="#l62.18"></a><span id="l62.18"> </span>
<a href="#l62.19"></a><span id="l62.19">     let item = makeEvent(&quot;DTSTART:20020402T114500Z\n&quot; +</span>
<a href="#l62.20"></a><span id="l62.20">                          &quot;DTEND:20020402T124500Z\n&quot; +</span>
<a href="#l62.21"></a><span id="l62.21">                          RRULE + EXDATE + RDATE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/test/unit/test_utils.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/test/unit/test_utils.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -9,18 +9,18 @@ function run_test() {</span>
<a href="#l63.4"></a><span id="l63.4">     test_getDefaultStartDate();</span>
<a href="#l63.5"></a><span id="l63.5">     test_getStartEndProps();</span>
<a href="#l63.6"></a><span id="l63.6">     test_calOperationGroup();</span>
<a href="#l63.7"></a><span id="l63.7">     test_sameDay();</span>
<a href="#l63.8"></a><span id="l63.8">     test_binarySearch();</span>
<a href="#l63.9"></a><span id="l63.9"> }</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11"> function test_recentzones() {</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-    let oldDefaultTz = cal.getPrefSafe(&quot;calendar.timezone.local&quot;, &quot;&quot;);</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineminus">-    cal.setPref(&quot;calendar.timezone.local&quot;, &quot;floating&quot;);</span>
<a href="#l63.14"></a><span id="l63.14" class="difflineplus">+    let oldDefaultTz = Preferences.get(&quot;calendar.timezone.local&quot;, &quot;&quot;);</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, &quot;floating&quot;);</span>
<a href="#l63.16"></a><span id="l63.16"> </span>
<a href="#l63.17"></a><span id="l63.17">     do_check_eq(cal.getRecentTimezones().length, 0);</span>
<a href="#l63.18"></a><span id="l63.18">     do_check_eq(cal.getRecentTimezones(true).length, 0);</span>
<a href="#l63.19"></a><span id="l63.19"> </span>
<a href="#l63.20"></a><span id="l63.20">     cal.saveRecentTimezone(&quot;Europe/Berlin&quot;);</span>
<a href="#l63.21"></a><span id="l63.21"> </span>
<a href="#l63.22"></a><span id="l63.22">     let zones = cal.getRecentTimezones();</span>
<a href="#l63.23"></a><span id="l63.23">     do_check_eq(zones.length, 1);</span>
<a href="#l63.24"></a><span id="l63.24" class="difflineat">@@ -40,17 +40,17 @@ function test_recentzones() {</span>
<a href="#l63.25"></a><span id="l63.25">     cal.saveRecentTimezone(&quot;America/New_York&quot;);</span>
<a href="#l63.26"></a><span id="l63.26">     do_check_eq(cal.getRecentTimezones().length, 2);</span>
<a href="#l63.27"></a><span id="l63.27">     do_check_eq(cal.getRecentTimezones(true).length, 2);</span>
<a href="#l63.28"></a><span id="l63.28"> </span>
<a href="#l63.29"></a><span id="l63.29">     cal.saveRecentTimezone(&quot;Unknown&quot;);</span>
<a href="#l63.30"></a><span id="l63.30">     do_check_eq(cal.getRecentTimezones().length, 3);</span>
<a href="#l63.31"></a><span id="l63.31">     do_check_eq(cal.getRecentTimezones(true).length, 2);</span>
<a href="#l63.32"></a><span id="l63.32"> </span>
<a href="#l63.33"></a><span id="l63.33" class="difflineminus">-    cal.setPref(&quot;calendar.timezone.local&quot;, oldDefaultTz);</span>
<a href="#l63.34"></a><span id="l63.34" class="difflineplus">+    Preferences.set(&quot;calendar.timezone.local&quot;, oldDefaultTz);</span>
<a href="#l63.35"></a><span id="l63.35"> }</span>
<a href="#l63.36"></a><span id="l63.36"> </span>
<a href="#l63.37"></a><span id="l63.37"> function test_formatcss() {</span>
<a href="#l63.38"></a><span id="l63.38">     do_check_eq(cal.formatStringForCSSRule(&quot; &quot;), &quot;_&quot;);</span>
<a href="#l63.39"></a><span id="l63.39">     do_check_eq(cal.formatStringForCSSRule(&quot;&quot;), &quot;-uxfc-&quot;);</span>
<a href="#l63.40"></a><span id="l63.40">     do_check_eq(cal.formatStringForCSSRule(&quot;a&quot;), &quot;a&quot;);</span>
<a href="#l63.41"></a><span id="l63.41"> }</span>
<a href="#l63.42"></a><span id="l63.42"> </span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

