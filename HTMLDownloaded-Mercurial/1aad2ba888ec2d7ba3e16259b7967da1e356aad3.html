<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26331:1aad2ba888ec2d7ba3e16259b7967da1e356aad3</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 1aad2ba888ec2d7ba3e16259b7967da1e356aad3" />
<meta property="og:url" content="/comm-central/rev/1aad2ba888ec2d7ba3e16259b7967da1e356aad3" />
<meta property="og:description" content="Bug 1534345 - Migrate searchvalue binding to custom element. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 1aad2ba888ec2d7ba3e16259b7967da1e356aad3 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/1aad2ba888ec2d7ba3e16259b7967da1e356aad3">shortlog</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/1aad2ba888ec2d7ba3e16259b7967da1e356aad3">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3">files</a> |
changeset |
<a href="/comm-central/raw-rev/1aad2ba888ec2d7ba3e16259b7967da1e356aad3">raw</a>  | <a href="/comm-central/archive/1aad2ba888ec2d7ba3e16259b7967da1e356aad3.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1534345">Bug 1534345</a> - Migrate searchvalue binding to custom element. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#114;&#115;&#104;&#97;&#100;&#32;&#75;&#104;&#97;&#110;&#32;&#60;&#97;&#114;&#115;&#104;&#100;&#107;&#104;&#110;&#49;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 12 Apr 2019 23:24:17 +0200</td></tr>

<tr>
 <td>changeset 26331</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/1aad2ba888ec2d7ba3e16259b7967da1e356aad3">1aad2ba888ec2d7ba3e16259b7967da1e356aad3</a></td>
</tr>



<tr>
<td>parent 26330</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e614af52388152d486513d7ff5b511c2a69fcb2e">e614af52388152d486513d7ff5b511c2a69fcb2e</a>
</td>
</tr>

<tr>
<td>child 26332</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/826410daf770d13ad7ac81e0720c0e9a17cb6a0e">826410daf770d13ad7ac81e0720c0e9a17cb6a0e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=1aad2ba888ec2d7ba3e16259b7967da1e356aad3">15788</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 12 Apr 2019 22:02:02 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@826410daf770 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=826410daf770d13ad7ac81e0720c0e9a17cb6a0e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=826410daf770d13ad7ac81e0720c0e9a17cb6a0e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=826410daf770d13ad7ac81e0720c0e9a17cb6a0e&newProject=comm-central&newRevision=e1c03b7fdd86d87f5396bd0cf3cba39bc22b9690&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=826410daf770d13ad7ac81e0720c0e9a17cb6a0e&newProject=comm-central&newRevision=e1c03b7fdd86d87f5396bd0cf3cba39bc22b9690&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=826410daf770d13ad7ac81e0720c0e9a17cb6a0e&newProject=comm-central&newRevision=e1c03b7fdd86d87f5396bd0cf3cba39bc22b9690&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1534345">1534345</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1534345">Bug 1534345</a> - Migrate searchvalue binding to custom element. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/messenger.css">mail/base/content/messenger.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/messenger.css">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/messenger.css">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/messenger.css">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/messenger.css">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/base/content/messenger.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-display/test-mail-views.js">mail/test/mozmill/folder-display/test-mail-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-display/test-mail-views.js">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-display/test-mail-views.js">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-display/test-mail-views.js">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-display/test-mail-views.js">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-display/test-mail-views.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-widget/test-message-filters.js">mail/test/mozmill/folder-widget/test-message-filters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-widget/test-message-filters.js">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-widget/test-message-filters.js">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-widget/test-message-filters.js">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-widget/test-message-filters.js">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/folder-widget/test-message-filters.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/search-window/test-search-window.js">mail/test/mozmill/search-window/test-search-window.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/search-window/test-search-window.js">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/search-window/test-search-window.js">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/search-window/test-search-window.js">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/search-window/test-search-window.js">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mail/test/mozmill/search-window/test-search-window.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/FilterEditor.js">mailnews/base/search/content/FilterEditor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/FilterEditor.js">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/FilterEditor.js">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/FilterEditor.js">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/FilterEditor.js">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/FilterEditor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchTerm.js">mailnews/base/search/content/searchTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchTerm.js">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchTerm.js">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchTerm.js">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchTerm.js">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchTerm.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchWidgets.js">mailnews/base/search/content/searchWidgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchWidgets.js">file</a> |
<a href="/comm-central/annotate/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchWidgets.js">annotate</a> |
<a href="/comm-central/diff/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchWidgets.js">diff</a> |
<a href="/comm-central/comparison/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchWidgets.js">comparison</a> |
<a href="/comm-central/log/1aad2ba888ec2d7ba3e16259b7967da1e356aad3/mailnews/base/search/content/searchWidgets.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -669,438 +669,16 @@</span>
<a href="#l1.4"></a><span id="l1.4">             } else {</span>
<a href="#l1.5"></a><span id="l1.5">               this.value = menulist.value;</span>
<a href="#l1.6"></a><span id="l1.6">             }</span>
<a href="#l1.7"></a><span id="l1.7">           ]]&gt;</span>
<a href="#l1.8"></a><span id="l1.8">         &lt;/body&gt;</span>
<a href="#l1.9"></a><span id="l1.9">       &lt;/method&gt;</span>
<a href="#l1.10"></a><span id="l1.10">     &lt;/implementation&gt;</span>
<a href="#l1.11"></a><span id="l1.11">   &lt;/binding&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  &lt;!-- searchvalue - a widget which dynamically changes its user interface</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-       depending on what type of data it's supposed to be showing</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-       currently handles arbitrary text entry, and menulists for</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-       priority, status, junk status, tags, hasAttachment status,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-       and addressbook</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-  --&gt;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-  &lt;binding id=&quot;searchvalue&quot; name=&quot;searchValue&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineminus">-      &lt;xul:textbox flex=&quot;1&quot; class=&quot;search-value-textbox&quot; xbl:inherits=&quot;disabled&quot;/&gt;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-      &lt;xul:menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineminus">-        &lt;xul:menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-          &lt;xul:menuitem value=&quot;6&quot; stringTag=&quot;priorityHighest&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineminus">-          &lt;xul:menuitem value=&quot;5&quot; stringTag=&quot;priorityHigh&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineminus">-          &lt;xul:menuitem value=&quot;4&quot; stringTag=&quot;priorityNormal&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-          &lt;xul:menuitem value=&quot;3&quot; stringTag=&quot;priorityLow&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">-          &lt;xul:menuitem value=&quot;2&quot; stringTag=&quot;priorityLowest&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineminus">-      &lt;/xul:menulist&gt;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-      &lt;xul:menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-        &lt;xul:menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-          &lt;xul:menuitem value=&quot;2&quot; stringTag=&quot;replied&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-          &lt;xul:menuitem value=&quot;1&quot; stringTag=&quot;read&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-          &lt;xul:menuitem value=&quot;65536&quot; stringTag=&quot;new&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-          &lt;xul:menuitem value=&quot;4096&quot; stringTag=&quot;forwarded&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-          &lt;xul:menuitem value=&quot;4&quot; stringTag=&quot;flagged&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-      &lt;/xul:menulist&gt;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-      &lt;xul:textbox flex=&quot;1&quot; class=&quot;search-value-textbox&quot; xbl:inherits=&quot;disabled&quot;/&gt;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-      &lt;xul:menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-        &lt;xul:menupopup class=&quot;addrbooksPopup&quot; localonly=&quot;true&quot;/&gt;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-      &lt;/xul:menulist&gt;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-      &lt;xul:menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-        &lt;xul:menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineminus">-      &lt;/xul:menulist&gt;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineminus">-      &lt;xul:menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">-        &lt;xul:menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-          &lt;xul:menuitem value=&quot;2&quot; stringTag=&quot;junk&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-      &lt;/xul:menulist&gt;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-      &lt;xul:menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-        &lt;xul:menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-          &lt;xul:menuitem value=&quot;0&quot; stringTag=&quot;hasAttachments&quot; class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-      &lt;/xul:menulist&gt;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-      &lt;xul:menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; xbl:inherits=&quot;disabled&quot;&gt;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-        &lt;xul:menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineminus">-          &lt;xul:menuitem value=&quot;plugin&quot; stringTag=&quot;junkScoreOriginPlugin&quot;</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineminus">-                        class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineminus">-          &lt;xul:menuitem value=&quot;user&quot; stringTag=&quot;junkScoreOriginUser&quot;</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineminus">-                        class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-          &lt;xul:menuitem value=&quot;filter&quot; stringTag=&quot;junkScoreOriginFilter&quot;</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-                        class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-          &lt;xul:menuitem value=&quot;whitelist&quot; stringTag=&quot;junkScoreOriginWhitelist&quot;</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-                        class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-          &lt;xul:menuitem value=&quot;imapflag&quot; stringTag=&quot;junkScoreOriginImapFlag&quot;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-                        class=&quot;search-value-menuitem&quot;/&gt;</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-        &lt;/xul:menupopup&gt;</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-      &lt;/xul:menulist&gt;</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-      &lt;xul:textbox flex=&quot;1&quot; class=&quot;search-value-textbox&quot; xbl:inherits=&quot;disabled&quot;</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-                   type=&quot;number&quot;/&gt;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; class=&quot;search-value-custom&quot; xbl:inherits=&quot;disabled&quot;/&gt;</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-      &lt;field name=&quot;internalOperator&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-      &lt;field name=&quot;internalAttribute&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-      &lt;field name=&quot;internalValue&quot;&gt;null&lt;/field&gt;</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-      &lt;property name=&quot;opParentValue&quot; onget=&quot;return this.internalOperator;&quot;&gt;</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-        &lt;setter&gt;</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-            // noop if we're not changing it</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-            if (this.internalOperator == val)</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-              return val;</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-            // Keywords has the null field IsEmpty</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-            if (this.searchAttribute == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-              if (val == Ci.nsMsgSearchOp.IsEmpty ||</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-                  val == Ci.nsMsgSearchOp.IsntEmpty)</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineminus">-                this.setAttribute(&quot;selectedIndex&quot;, &quot;-1&quot;);</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineminus">-              else</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineminus">-                this.setAttribute(&quot;selectedIndex&quot;, &quot;5&quot;);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineminus">-            }</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-            // JunkStatus has the null field IsEmpty</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-            if (this.searchAttribute == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-              if (val == Ci.nsMsgSearchOp.IsEmpty ||</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-                  val == Ci.nsMsgSearchOp.IsntEmpty)</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineminus">-                this.setAttribute(&quot;selectedIndex&quot;, &quot;-1&quot;);</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineminus">-              else</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineminus">-                this.setAttribute(&quot;selectedIndex&quot;, &quot;6&quot;);</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineminus">-            }</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineminus">-</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineminus">-              // if it's not sender, to, cc, alladdresses, or toorcc, we don't care</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineminus">-              if (this.searchAttribute != Ci.nsMsgSearchAttrib.Sender &amp;&amp;</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineminus">-                this.searchAttribute != Ci.nsMsgSearchAttrib.To &amp;&amp;</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineminus">-                this.searchAttribute != Ci.nsMsgSearchAttrib.ToOrCC &amp;&amp;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-                this.searchAttribute != Ci.nsMsgSearchAttrib.AllAddresses &amp;&amp;</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-                this.searchAttribute != Ci.nsMsgSearchAttrib.CC) {</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-              this.internalOperator = val;</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineminus">-              return val;</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineminus">-            }</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineminus">-</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineminus">-            var children = document.getAnonymousNodes(this);</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineminus">-            if (val == Ci.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineminus">-                val == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-              // if the old internalOperator was</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineminus">-              // IsntInAB or IsInAB, and the new internalOperator is</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineminus">-              // IsntInAB or IsInAB, noop because the search value</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineminus">-              // was an ab type, and it still is.</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineminus">-              // otherwise, switch to the ab picker and select the PAB</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineminus">-              if (this.internalOperator != Ci.nsMsgSearchOp.IsntInAB &amp;&amp;</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineminus">-                  this.internalOperator != Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineminus">-                var abs = children[4].querySelector(`[value=&quot;moz-abmdbdirectory://abook.mab&quot;]`);</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineminus">-                if (abs)</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineminus">-                  children[4].selectedItem = abs;</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineminus">-                this.setAttribute(&quot;selectedIndex&quot;, &quot;4&quot;);</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineminus">-              }</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineminus">-            } else if (this.internalOperator == Ci.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineminus">-                       this.internalOperator == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-              // if the old internalOperator wasn't</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-              // IsntInAB or IsInAB, and the new internalOperator isn't</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-              // IsntInAB or IsInAB, noop because the search value</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-              // wasn't an ab type, and it still isn't.</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-              // otherwise, switch to the textbox and clear it</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineminus">-              children[0].value = &quot;&quot;;</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;0&quot;);</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineminus">-            }</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineminus">-</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineminus">-            this.internalOperator = val;</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineminus">-            return val;</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineminus">-        &lt;/setter&gt;</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineminus">-      &lt;!-- parentValue forwards to the attribute --&gt;</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-      &lt;property name=&quot;parentValue&quot; onset=&quot;return this.searchAttribute=val;&quot;</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineminus">-                                   onget=&quot;return this.searchAttribute;&quot;/&gt;</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-      &lt;property name=&quot;searchAttribute&quot; onget=&quot;return this.internalAttribute;&quot;&gt;</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-        &lt;setter&gt;</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineminus">-            // noop if we're not changing it</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-            if (this.internalAttribute == val) return val;</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-            this.internalAttribute = val;</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineminus">-</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineminus">-            // if the searchAttribute changing, null out the internalOperator</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineminus">-            this.internalOperator = null;</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineminus">-</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineminus">-            // we inherit from a deck, so just use it's index attribute</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineminus">-            // to hide/show widgets</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineminus">-            if (isNaN(val)) { // Is this a custom attribute?</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;10&quot;);</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineminus">-              let customHbox = document.getAnonymousNodes(this)[10];</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineminus">-              if (this.internalValue)</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineminus">-                customHbox.setAttribute(&quot;value&quot;, this.internalValue.str);</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineminus">-              // the searchAttribute attribute is intended as a selector in</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineminus">-              // CSS for custom search terms to bind a custom value</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineminus">-              customHbox.setAttribute(&quot;searchAttribute&quot;, val);</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.Priority) {</span>
<a href="#l1.169"></a><span id="l1.169" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;1&quot;);</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l1.171"></a><span id="l1.171" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;2&quot;);</span>
<a href="#l1.172"></a><span id="l1.172" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.Date) {</span>
<a href="#l1.173"></a><span id="l1.173" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;3&quot;);</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.Sender) {</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineminus">-              // since the internalOperator is null</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineminus">-              // this is the same as the initial state</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineminus">-              // the initial state for Sender isn't an ab type search</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineminus">-              // it's a text search, so show the textbox</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;0&quot;);</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;5&quot;);</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;6&quot;);</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.HasAttachmentStatus) {</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;7&quot;);</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.JunkScoreOrigin) {</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;8&quot;);</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.AgeInDays) {</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineminus">-              let valueBox = document.getAnonymousNodes(this)[9];</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineminus">-              valueBox.min = -40000; // ~-100 years</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineminus">-              valueBox.max = 40000; // ~100 years</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.Size) {</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineminus">-              let valueBox = document.getAnonymousNodes(this)[9];</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineminus">-              valueBox.min = 0;</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineminus">-              valueBox.max = 1000000000;</span>
<a href="#l1.197"></a><span id="l1.197" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l1.198"></a><span id="l1.198" class="difflineminus">-            } else if (val == Ci.nsMsgSearchAttrib.JunkPercent) {</span>
<a href="#l1.199"></a><span id="l1.199" class="difflineminus">-              let valueBox = document.getAnonymousNodes(this)[9];</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineminus">-              valueBox.min = 0;</span>
<a href="#l1.201"></a><span id="l1.201" class="difflineminus">-              valueBox.max = 100;</span>
<a href="#l1.202"></a><span id="l1.202" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l1.203"></a><span id="l1.203" class="difflineminus">-            } else {</span>
<a href="#l1.204"></a><span id="l1.204" class="difflineminus">-              // a normal text field</span>
<a href="#l1.205"></a><span id="l1.205" class="difflineminus">-              this.setAttribute(&quot;selectedIndex&quot;, &quot;0&quot;);</span>
<a href="#l1.206"></a><span id="l1.206" class="difflineminus">-            }</span>
<a href="#l1.207"></a><span id="l1.207" class="difflineminus">-            return val;</span>
<a href="#l1.208"></a><span id="l1.208" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineminus">-        &lt;/setter&gt;</span>
<a href="#l1.210"></a><span id="l1.210" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l1.211"></a><span id="l1.211" class="difflineminus">-      &lt;property name=&quot;value&quot; onget=&quot;return this.internalValue;&quot;&gt;</span>
<a href="#l1.212"></a><span id="l1.212" class="difflineminus">-        &lt;setter&gt;</span>
<a href="#l1.213"></a><span id="l1.213" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.214"></a><span id="l1.214" class="difflineminus">-          // val is a nsIMsgSearchValue object</span>
<a href="#l1.215"></a><span id="l1.215" class="difflineminus">-          this.internalValue = val;</span>
<a href="#l1.216"></a><span id="l1.216" class="difflineminus">-          var attrib = this.internalAttribute;</span>
<a href="#l1.217"></a><span id="l1.217" class="difflineminus">-          var children = document.getAnonymousNodes(this);</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineminus">-          this.searchAttribute = attrib;</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineminus">-          if (isNaN(attrib)) { // a custom term</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineminus">-            let customHbox = document.getAnonymousNodes(this)[10];</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineminus">-            customHbox.setAttribute(&quot;value&quot;, val.str);</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineminus">-            return val;</span>
<a href="#l1.223"></a><span id="l1.223" class="difflineminus">-          }</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineminus">-          if (attrib == Ci.nsMsgSearchAttrib.Priority) {</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineminus">-            var matchingPriority =</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineminus">-              children[1].querySelector(`[value=&quot;${val.priority}&quot;]`);</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineminus">-            if (matchingPriority)</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineminus">-              children[1].selectedItem = matchingPriority;</span>
<a href="#l1.229"></a><span id="l1.229" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l1.230"></a><span id="l1.230" class="difflineminus">-            var matchingStatus =</span>
<a href="#l1.231"></a><span id="l1.231" class="difflineminus">-              children[2].querySelector(`[value=&quot;${val.status}&quot;]`);</span>
<a href="#l1.232"></a><span id="l1.232" class="difflineminus">-            if (matchingStatus)</span>
<a href="#l1.233"></a><span id="l1.233" class="difflineminus">-              children[2].selectedItem = matchingStatus;</span>
<a href="#l1.234"></a><span id="l1.234" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.AgeInDays) {</span>
<a href="#l1.235"></a><span id="l1.235" class="difflineminus">-            children[9].value = val.age;</span>
<a href="#l1.236"></a><span id="l1.236" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.Date) {</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineminus">-            children[3].value = convertPRTimeToString(val.date);</span>
<a href="#l1.238"></a><span id="l1.238" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.Sender ||</span>
<a href="#l1.239"></a><span id="l1.239" class="difflineminus">-                     attrib == Ci.nsMsgSearchAttrib.To ||</span>
<a href="#l1.240"></a><span id="l1.240" class="difflineminus">-                     attrib == Ci.nsMsgSearchAttrib.CC ||</span>
<a href="#l1.241"></a><span id="l1.241" class="difflineminus">-                     attrib == Ci.nsMsgSearchAttrib.AllAddresses ||</span>
<a href="#l1.242"></a><span id="l1.242" class="difflineminus">-                     attrib == Ci.nsMsgSearchAttrib.ToOrCC) {</span>
<a href="#l1.243"></a><span id="l1.243" class="difflineminus">-            if (this.internalOperator == Ci.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l1.244"></a><span id="l1.244" class="difflineminus">-                this.internalOperator == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l1.245"></a><span id="l1.245" class="difflineminus">-              var abs = children[4].querySelector(`[value=&quot;${val.str}&quot;]`);</span>
<a href="#l1.246"></a><span id="l1.246" class="difflineminus">-              if (abs)</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-                children[4].selectedItem = abs;</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineminus">-            } else {</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineminus">-              children[0].value = val.str;</span>
<a href="#l1.250"></a><span id="l1.250" class="difflineminus">-            }</span>
<a href="#l1.251"></a><span id="l1.251" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l1.252"></a><span id="l1.252" class="difflineminus">-            var keywordVal = children[5].querySelector(`[value=&quot;${val.str}&quot;]`);</span>
<a href="#l1.253"></a><span id="l1.253" class="difflineminus">-            if (keywordVal) {</span>
<a href="#l1.254"></a><span id="l1.254" class="difflineminus">-              children[5].value = val.str;</span>
<a href="#l1.255"></a><span id="l1.255" class="difflineminus">-              children[5].selectedItem = keywordVal;</span>
<a href="#l1.256"></a><span id="l1.256" class="difflineminus">-            }</span>
<a href="#l1.257"></a><span id="l1.257" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineminus">-            var junkStatus =</span>
<a href="#l1.259"></a><span id="l1.259" class="difflineminus">-              children[6].querySelector(`[value=&quot;${val.junkStatus}&quot;]`);</span>
<a href="#l1.260"></a><span id="l1.260" class="difflineminus">-            if (junkStatus)</span>
<a href="#l1.261"></a><span id="l1.261" class="difflineminus">-              children[6].selectedItem = junkStatus;</span>
<a href="#l1.262"></a><span id="l1.262" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.HasAttachmentStatus) {</span>
<a href="#l1.263"></a><span id="l1.263" class="difflineminus">-            var hasAttachmentStatus =</span>
<a href="#l1.264"></a><span id="l1.264" class="difflineminus">-              children[7].querySelector(`[value=&quot;${val.hasAttachmentStatus}&quot;]`);</span>
<a href="#l1.265"></a><span id="l1.265" class="difflineminus">-            if (hasAttachmentStatus)</span>
<a href="#l1.266"></a><span id="l1.266" class="difflineminus">-              children[7].selectedItem = hasAttachmentStatus;</span>
<a href="#l1.267"></a><span id="l1.267" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.JunkScoreOrigin) {</span>
<a href="#l1.268"></a><span id="l1.268" class="difflineminus">-            var junkScoreOrigin =</span>
<a href="#l1.269"></a><span id="l1.269" class="difflineminus">-              children[8].querySelector(`[value=&quot;${val.str}&quot;]`);</span>
<a href="#l1.270"></a><span id="l1.270" class="difflineminus">-            if (junkScoreOrigin)</span>
<a href="#l1.271"></a><span id="l1.271" class="difflineminus">-              children[8].selectedItem = junkScoreOrigin;</span>
<a href="#l1.272"></a><span id="l1.272" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.JunkPercent) {</span>
<a href="#l1.273"></a><span id="l1.273" class="difflineminus">-            children[9].value = val.junkPercent;</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineminus">-          } else if (attrib == Ci.nsMsgSearchAttrib.Size) {</span>
<a href="#l1.275"></a><span id="l1.275" class="difflineminus">-            children[9].value = val.size;</span>
<a href="#l1.276"></a><span id="l1.276" class="difflineminus">-          } else {</span>
<a href="#l1.277"></a><span id="l1.277" class="difflineminus">-            children[0].value = val.str;</span>
<a href="#l1.278"></a><span id="l1.278" class="difflineminus">-          }</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineminus">-          return val;</span>
<a href="#l1.280"></a><span id="l1.280" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.281"></a><span id="l1.281" class="difflineminus">-        &lt;/setter&gt;</span>
<a href="#l1.282"></a><span id="l1.282" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l1.283"></a><span id="l1.283" class="difflineminus">-      &lt;method name=&quot;save&quot;&gt;</span>
<a href="#l1.284"></a><span id="l1.284" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l1.285"></a><span id="l1.285" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.286"></a><span id="l1.286" class="difflineminus">-            var searchValue = this.value;</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineminus">-            var searchAttribute = this.searchAttribute;</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineminus">-            var children = document.getAnonymousNodes(this);</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineminus">-</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineminus">-            searchValue.attrib = searchAttribute;</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineminus">-            if (searchAttribute == Ci.nsMsgSearchAttrib.Priority) {</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineminus">-              searchValue.priority = children[1].selectedItem.value;</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineminus">-              searchValue.status = children[2].value;</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.AgeInDays) {</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineminus">-              searchValue.age = children[9].value;</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.Date) {</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineminus">-              searchValue.date = convertStringToPRTime(children[3].value);</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.Sender ||</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineminus">-                       searchAttribute == Ci.nsMsgSearchAttrib.To ||</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineminus">-                       searchAttribute == Ci.nsMsgSearchAttrib.CC ||</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineminus">-                       searchAttribute == Ci.nsMsgSearchAttrib.AllAddresses ||</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineminus">-                       searchAttribute == Ci.nsMsgSearchAttrib.ToOrCC) {</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineminus">-              if (this.internalOperator == Ci.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineminus">-                  this.internalOperator == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineminus">-                searchValue.str = children[4].selectedItem.value;</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineminus">-              } else {</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineminus">-                searchValue.str = children[0].value;</span>
<a href="#l1.309"></a><span id="l1.309" class="difflineminus">-              }</span>
<a href="#l1.310"></a><span id="l1.310" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineminus">-              searchValue.str = children[5].value;</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineminus">-              searchValue.junkStatus = children[6].value;</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.JunkPercent) {</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineminus">-              searchValue.junkPercent = children[9].value;</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.Size) {</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineminus">-              searchValue.size = children[9].value;</span>
<a href="#l1.318"></a><span id="l1.318" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.HasAttachmentStatus) {</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineminus">-              searchValue.status = Ci.nsMsgMessageFlags.Attachment;</span>
<a href="#l1.320"></a><span id="l1.320" class="difflineminus">-            } else if (searchAttribute == Ci.nsMsgSearchAttrib.JunkScoreOrigin) {</span>
<a href="#l1.321"></a><span id="l1.321" class="difflineminus">-              searchValue.str = children[8].value;</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineminus">-            } else if (isNaN(searchAttribute)) { // a custom term</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineminus">-              searchValue.attrib = Ci.nsMsgSearchAttrib.Custom;</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineminus">-              searchValue.str = children[10].getAttribute(&quot;value&quot;);</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineminus">-            } else {</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineminus">-              searchValue.str = children[0].value;</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineminus">-            }</span>
<a href="#l1.328"></a><span id="l1.328" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.329"></a><span id="l1.329" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineminus">-      &lt;method name=&quot;saveTo&quot;&gt;</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineminus">-        &lt;parameter name=&quot;searchValue&quot;/&gt;</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineminus">-            this.internalValue = searchValue;</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineminus">-            this.save();</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.338"></a><span id="l1.338" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineminus">-      &lt;method name=&quot;fillInTags&quot;&gt;</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l1.342"></a><span id="l1.342" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.343"></a><span id="l1.343" class="difflineminus">-            let menulist = document.getAnonymousNodes(this)[5];</span>
<a href="#l1.344"></a><span id="l1.344" class="difflineminus">-            // Force initialization of the menulist custom element first.</span>
<a href="#l1.345"></a><span id="l1.345" class="difflineminus">-            customElements.upgrade(menulist);</span>
<a href="#l1.346"></a><span id="l1.346" class="difflineminus">-            let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l1.347"></a><span id="l1.347" class="difflineminus">-            for (var i = 0; i &lt; tagArray.length; ++i) {</span>
<a href="#l1.348"></a><span id="l1.348" class="difflineminus">-              var taginfo = tagArray[i];</span>
<a href="#l1.349"></a><span id="l1.349" class="difflineminus">-              let newMenuItem = menulist.appendItem(taginfo.tag, taginfo.key);</span>
<a href="#l1.350"></a><span id="l1.350" class="difflineminus">-              if (!i)</span>
<a href="#l1.351"></a><span id="l1.351" class="difflineminus">-                menulist.selectedItem = newMenuItem;</span>
<a href="#l1.352"></a><span id="l1.352" class="difflineminus">-            }</span>
<a href="#l1.353"></a><span id="l1.353" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.354"></a><span id="l1.354" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l1.355"></a><span id="l1.355" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l1.356"></a><span id="l1.356" class="difflineminus">-      &lt;method name=&quot;fillStringsForChildren&quot;&gt;</span>
<a href="#l1.357"></a><span id="l1.357" class="difflineminus">-        &lt;parameter name=&quot;parentNode&quot;/&gt;</span>
<a href="#l1.358"></a><span id="l1.358" class="difflineminus">-        &lt;parameter name=&quot;bundle&quot;/&gt;</span>
<a href="#l1.359"></a><span id="l1.359" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l1.360"></a><span id="l1.360" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.361"></a><span id="l1.361" class="difflineminus">-            var children = parentNode.childNodes;</span>
<a href="#l1.362"></a><span id="l1.362" class="difflineminus">-            var len = children.length;</span>
<a href="#l1.363"></a><span id="l1.363" class="difflineminus">-            for (var i = 0; i &lt; len; i++) {</span>
<a href="#l1.364"></a><span id="l1.364" class="difflineminus">-              var node = children[i];</span>
<a href="#l1.365"></a><span id="l1.365" class="difflineminus">-              var stringTag = node.getAttribute(&quot;stringTag&quot;);</span>
<a href="#l1.366"></a><span id="l1.366" class="difflineminus">-              if (stringTag) {</span>
<a href="#l1.367"></a><span id="l1.367" class="difflineminus">-                var attr = (node.tagName == &quot;label&quot;) ? &quot;value&quot; : &quot;label&quot;;</span>
<a href="#l1.368"></a><span id="l1.368" class="difflineminus">-                node.setAttribute(attr, bundle.GetStringFromName(stringTag));</span>
<a href="#l1.369"></a><span id="l1.369" class="difflineminus">-              }</span>
<a href="#l1.370"></a><span id="l1.370" class="difflineminus">-            }</span>
<a href="#l1.371"></a><span id="l1.371" class="difflineminus">-            // Force initialization of the menulist custom element.</span>
<a href="#l1.372"></a><span id="l1.372" class="difflineminus">-            customElements.upgrade(parentNode);</span>
<a href="#l1.373"></a><span id="l1.373" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.374"></a><span id="l1.374" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l1.375"></a><span id="l1.375" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l1.376"></a><span id="l1.376" class="difflineminus">-      &lt;method name=&quot;initialize&quot;&gt;</span>
<a href="#l1.377"></a><span id="l1.377" class="difflineminus">-        &lt;parameter name=&quot;menulist&quot;/&gt;</span>
<a href="#l1.378"></a><span id="l1.378" class="difflineminus">-        &lt;parameter name=&quot;bundle&quot;/&gt;</span>
<a href="#l1.379"></a><span id="l1.379" class="difflineminus">-        &lt;body&gt;</span>
<a href="#l1.380"></a><span id="l1.380" class="difflineminus">-          &lt;![CDATA[</span>
<a href="#l1.381"></a><span id="l1.381" class="difflineminus">-            this.fillStringsForChildren(menulist.firstChild, bundle);</span>
<a href="#l1.382"></a><span id="l1.382" class="difflineminus">-          ]]&gt;</span>
<a href="#l1.383"></a><span id="l1.383" class="difflineminus">-        &lt;/body&gt;</span>
<a href="#l1.384"></a><span id="l1.384" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l1.385"></a><span id="l1.385" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l1.386"></a><span id="l1.386" class="difflineminus">-      &lt;![CDATA[</span>
<a href="#l1.387"></a><span id="l1.387" class="difflineminus">-        // initialize strings</span>
<a href="#l1.388"></a><span id="l1.388" class="difflineminus">-        var bundle = Services.strings.createBundle(&quot;chrome://messenger/locale/messenger.properties&quot;);</span>
<a href="#l1.389"></a><span id="l1.389" class="difflineminus">-</span>
<a href="#l1.390"></a><span id="l1.390" class="difflineminus">-        // initialize the priority picker</span>
<a href="#l1.391"></a><span id="l1.391" class="difflineminus">-        this.initialize(document.getAnonymousNodes(this)[1], bundle);</span>
<a href="#l1.392"></a><span id="l1.392" class="difflineminus">-</span>
<a href="#l1.393"></a><span id="l1.393" class="difflineminus">-        // initialize the status picker</span>
<a href="#l1.394"></a><span id="l1.394" class="difflineminus">-        this.initialize(document.getAnonymousNodes(this)[2], bundle);</span>
<a href="#l1.395"></a><span id="l1.395" class="difflineminus">-</span>
<a href="#l1.396"></a><span id="l1.396" class="difflineminus">-        // initialize the date picker</span>
<a href="#l1.397"></a><span id="l1.397" class="difflineminus">-        var datePicker = document.getAnonymousNodes(this)[3];</span>
<a href="#l1.398"></a><span id="l1.398" class="difflineminus">-        var searchAttribute = this.searchAttribute;</span>
<a href="#l1.399"></a><span id="l1.399" class="difflineminus">-        var time;</span>
<a href="#l1.400"></a><span id="l1.400" class="difflineminus">-        if (searchAttribute == Ci.nsMsgSearchAttrib.Date)</span>
<a href="#l1.401"></a><span id="l1.401" class="difflineminus">-         time = datePicker.value;</span>
<a href="#l1.402"></a><span id="l1.402" class="difflineminus">-        else</span>
<a href="#l1.403"></a><span id="l1.403" class="difflineminus">-         time = new Date();</span>
<a href="#l1.404"></a><span id="l1.404" class="difflineminus">-        // do .value instead of .setAttribute(&quot;value&quot;, xxx);</span>
<a href="#l1.405"></a><span id="l1.405" class="difflineminus">-        // to work around for bug #179412</span>
<a href="#l1.406"></a><span id="l1.406" class="difflineminus">-        // (caused by bug #157210)</span>
<a href="#l1.407"></a><span id="l1.407" class="difflineminus">-        //</span>
<a href="#l1.408"></a><span id="l1.408" class="difflineminus">-        // the searchvalue widget has two textboxes</span>
<a href="#l1.409"></a><span id="l1.409" class="difflineminus">-        // one for text, one as a placeholder for a date / calendar widget</span>
<a href="#l1.410"></a><span id="l1.410" class="difflineminus">-        datePicker.value = convertDateToString(time);</span>
<a href="#l1.411"></a><span id="l1.411" class="difflineminus">-</span>
<a href="#l1.412"></a><span id="l1.412" class="difflineminus">-        // initialize the address book picker</span>
<a href="#l1.413"></a><span id="l1.413" class="difflineminus">-        this.initialize(document.getAnonymousNodes(this)[4], bundle);</span>
<a href="#l1.414"></a><span id="l1.414" class="difflineminus">-</span>
<a href="#l1.415"></a><span id="l1.415" class="difflineminus">-        // initialize the junk status picker</span>
<a href="#l1.416"></a><span id="l1.416" class="difflineminus">-        this.initialize(document.getAnonymousNodes(this)[6], bundle);</span>
<a href="#l1.417"></a><span id="l1.417" class="difflineminus">-</span>
<a href="#l1.418"></a><span id="l1.418" class="difflineminus">-        // initialize the has attachment status picker</span>
<a href="#l1.419"></a><span id="l1.419" class="difflineminus">-        this.initialize(document.getAnonymousNodes(this)[7], bundle);</span>
<a href="#l1.420"></a><span id="l1.420" class="difflineminus">-</span>
<a href="#l1.421"></a><span id="l1.421" class="difflineminus">-        // initialize the junk score origin picker</span>
<a href="#l1.422"></a><span id="l1.422" class="difflineminus">-        this.initialize(document.getAnonymousNodes(this)[8], bundle);</span>
<a href="#l1.423"></a><span id="l1.423" class="difflineminus">-</span>
<a href="#l1.424"></a><span id="l1.424" class="difflineminus">-        // initialize the tag list</span>
<a href="#l1.425"></a><span id="l1.425" class="difflineminus">-        this.fillInTags();</span>
<a href="#l1.426"></a><span id="l1.426" class="difflineminus">-      ]]&gt;</span>
<a href="#l1.427"></a><span id="l1.427" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l1.428"></a><span id="l1.428" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l1.429"></a><span id="l1.429" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l1.430"></a><span id="l1.430" class="difflineminus">-      &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_RETURN&quot; modifiers=&quot;accel any&quot;</span>
<a href="#l1.431"></a><span id="l1.431" class="difflineminus">-               action=&quot;onEnterInSearchTerm(event);&quot; preventdefault=&quot;true&quot;/&gt;</span>
<a href="#l1.432"></a><span id="l1.432" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l1.433"></a><span id="l1.433" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l1.434"></a><span id="l1.434"> </span>
<a href="#l1.435"></a><span id="l1.435">   &lt;binding id=&quot;splitmenu&quot;&gt;</span>
<a href="#l1.436"></a><span id="l1.436">     &lt;content&gt;</span>
<a href="#l1.437"></a><span id="l1.437">       &lt;xul:hbox anonid=&quot;menuitem&quot; flex=&quot;1&quot;</span>
<a href="#l1.438"></a><span id="l1.438">                 class=&quot;splitmenu-menuitem&quot;</span>
<a href="#l1.439"></a><span id="l1.439">                 xbl:inherits=&quot;iconic,label,disabled,onclick=oncommand,_moz-menuactive=active&quot;/&gt;</span>
<a href="#l1.440"></a><span id="l1.440">       &lt;xul:menu anonid=&quot;menu&quot; class=&quot;splitmenu-menu&quot;</span>
<a href="#l1.441"></a><span id="l1.441">                 xbl:inherits=&quot;disabled,_moz-menuactive=active&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/messenger.css</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/messenger.css</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -34,19 +34,18 @@</span>
<a href="#l2.4"></a><span id="l2.4"> mail-tagfield[collapsed=&quot;true&quot;] {</span>
<a href="#l2.5"></a><span id="l2.5">   display: none;</span>
<a href="#l2.6"></a><span id="l2.6"> }</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> #searchTermList &gt; richlistitem {</span>
<a href="#l2.9"></a><span id="l2.9">   -moz-binding: url(&quot;chrome://messenger/content/searchWidgets.xml#filterlistitem&quot;);</span>
<a href="#l2.10"></a><span id="l2.10"> }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-searchvalue {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+search-value {</span>
<a href="#l2.14"></a><span id="l2.14">   display: -moz-deck;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/content/mailWidgets.xml#searchvalue&quot;);</span>
<a href="#l2.16"></a><span id="l2.16"> }</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> searchterm {</span>
<a href="#l2.19"></a><span id="l2.19">   -moz-binding: url(&quot;chrome://messenger/content/mailWidgets.xml#searchterm&quot;);</span>
<a href="#l2.20"></a><span id="l2.20"> }</span>
<a href="#l2.21"></a><span id="l2.21"> </span>
<a href="#l2.22"></a><span id="l2.22"> .ruleaction {</span>
<a href="#l2.23"></a><span id="l2.23">   -moz-binding: url(&quot;chrome://messenger/content/searchWidgets.xml#ruleaction&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-mail-views.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-mail-views.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -8,16 +8,17 @@ var MODULE_NAME = 'test-mail-views';</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l3.6"></a><span id="l3.6"> var MODULE_REQUIRES = ['folder-display-helpers', 'window-helpers'];</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> var baseFolder, savedFolder;</span>
<a href="#l3.9"></a><span id="l3.9"> var setUntagged, setTagged;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> var {MailViewConstants} = ChromeUtils.import(&quot;resource:///modules/MailViewManager.jsm&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14"> var setupModule = function(module) {</span>
<a href="#l3.15"></a><span id="l3.15">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l3.16"></a><span id="l3.16">   fdh.installInto(module);</span>
<a href="#l3.17"></a><span id="l3.17">   let wh = collector.getModule('window-helpers');</span>
<a href="#l3.18"></a><span id="l3.18">   wh.installInto(module);</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   // Create a folder with some messages that have no tags and some that are</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -57,18 +58,27 @@ function test_save_view_as_folder() {</span>
<a href="#l3.22"></a><span id="l3.22">   mc.window.ViewChange(MailViewConstants.kViewItemVirtual);</span>
<a href="#l3.23"></a><span id="l3.23">   wait_for_modal_dialog(&quot;mailnews:virtualFolderProperties&quot;);</span>
<a href="#l3.24"></a><span id="l3.24"> }</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26"> function subtest_save_mail_view(savc) {</span>
<a href="#l3.27"></a><span id="l3.27">   // - make sure the name is right</span>
<a href="#l3.28"></a><span id="l3.28">   savc.assertValue(savc.eid(&quot;name&quot;), baseFolder.prettyName + &quot;-Important&quot;);</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+  let elem = savc.window.document.getElementById(&quot;searchVal0&quot;);</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  let index = 0;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+  if (elem.hasAttribute(&quot;selectedIndex&quot;)) {</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+    index = parseInt(elem.getAttribute(&quot;selectedIndex&quot;));</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+  }</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+  elem = elem.childNodes[index];</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+</span>
<a href="#l3.39"></a><span id="l3.39">   // - make sure the constraint is right</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-  savc.assertValue(savc.aid(&quot;searchVal0&quot;, {crazyDeck: 0}), &quot;$label1&quot;);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+  savc.assertValue(new elib.Elem(elem), &quot;$label1&quot;);</span>
<a href="#l3.42"></a><span id="l3.42"> </span>
<a href="#l3.43"></a><span id="l3.43">   // - save it</span>
<a href="#l3.44"></a><span id="l3.44">   savc.window.onOK();</span>
<a href="#l3.45"></a><span id="l3.45"> }</span>
<a href="#l3.46"></a><span id="l3.46"> </span>
<a href="#l3.47"></a><span id="l3.47"> function test_verify_saved_mail_view() {</span>
<a href="#l3.48"></a><span id="l3.48">   // - make sure the folder got created</span>
<a href="#l3.49"></a><span id="l3.49">   savedFolder = baseFolder.getChildNamed(baseFolder.prettyName + &quot;-Important&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/folder-widget/test-message-filters.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/folder-widget/test-message-filters.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -136,17 +136,17 @@ function create_simple_filter() {</span>
<a href="#l4.4"></a><span id="l4.4">     filterName.value = &quot;A Simple Filter&quot;;</span>
<a href="#l4.5"></a><span id="l4.5">     let searchAttr = fec.e(&quot;searchAttr0&quot;);</span>
<a href="#l4.6"></a><span id="l4.6">     let attrList = searchAttr.childNodes[0];</span>
<a href="#l4.7"></a><span id="l4.7">     attrList.value = Ci.nsMsgSearchAttrib.To;</span>
<a href="#l4.8"></a><span id="l4.8">     let searchOp = fec.e(&quot;searchOp0&quot;);</span>
<a href="#l4.9"></a><span id="l4.9">     let opList = searchOp.childNodes[0];</span>
<a href="#l4.10"></a><span id="l4.10">     opList.value = Ci.nsMsgSearchOp.Is;</span>
<a href="#l4.11"></a><span id="l4.11">     let searchValList = fec.e(&quot;searchVal0&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    let searchVal = fec.window.document.getAnonymousNodes(searchValList)[0];</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    let searchVal = searchValList.childNodes[0];</span>
<a href="#l4.14"></a><span id="l4.14">     searchVal.setAttribute(&quot;value&quot;, &quot;test@foo.invalid&quot;);</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16">     let filterActions = fec.e(&quot;filterActionList&quot;);</span>
<a href="#l4.17"></a><span id="l4.17">     let firstAction = filterActions.getItemAtIndex(0);</span>
<a href="#l4.18"></a><span id="l4.18">     firstAction.setAttribute(&quot;value&quot;, &quot;markasflagged&quot;);</span>
<a href="#l4.19"></a><span id="l4.19">     fec.e(&quot;FilterEditor&quot;).acceptDialog();</span>
<a href="#l4.20"></a><span id="l4.20">   }</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -183,18 +183,18 @@ function test_address_books_appear_in_me</span>
<a href="#l4.23"></a><span id="l4.23">     let attrList = searchAttr.childNodes[0];</span>
<a href="#l4.24"></a><span id="l4.24">     attrList.value = Ci.nsMsgSearchAttrib.To;</span>
<a href="#l4.25"></a><span id="l4.25">     let searchOp = fec.e(&quot;searchOp0&quot;);</span>
<a href="#l4.26"></a><span id="l4.26">     let opList = searchOp.childNodes[0];</span>
<a href="#l4.27"></a><span id="l4.27">     opList.value = Ci.nsMsgSearchOp.IsInAB;</span>
<a href="#l4.28"></a><span id="l4.28">     let searchValue = fec.e(&quot;searchVal0&quot;);</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">     // The magic number &quot;4&quot; is because the address book list is the</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-    // 4th child node of the searchvalue widget.</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-    let abList = fec.window.document.getAnonymousNodes(searchValue)[4];</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+    // 4th child node of the search-value widget.</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+    let abList = searchValue.childNodes[4];</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36">     // We should have 2 address books here - one for the Personal Address</span>
<a href="#l4.37"></a><span id="l4.37">     // Book, and one for Collected Addresses.  The LDAP address book should</span>
<a href="#l4.38"></a><span id="l4.38">     // not be shown, since it isn't a local address book.</span>
<a href="#l4.39"></a><span id="l4.39">     assert_equals(2, abList.itemCount, &quot;Did not display the correct number &quot;</span>
<a href="#l4.40"></a><span id="l4.40">                   + &quot;of address books in the filter menu list.&quot;);</span>
<a href="#l4.41"></a><span id="l4.41">   }</span>
<a href="#l4.42"></a><span id="l4.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/search-window/test-search-window.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/search-window/test-search-window.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -9,16 +9,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> &quot;use strict&quot;;</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> var MODULE_NAME = 'test-search-window';</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l5.10"></a><span id="l5.10"> var MODULE_REQUIRES = ['folder-display-helpers', 'search-window-helpers',</span>
<a href="#l5.11"></a><span id="l5.11">                        'window-helpers'];</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+var elib = ChromeUtils.import(&quot;chrome://mozmill/content/modules/elementslib.jsm&quot;);</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> function setupModule(module) {</span>
<a href="#l5.15"></a><span id="l5.15">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l5.16"></a><span id="l5.16">   fdh.installInto(module);</span>
<a href="#l5.17"></a><span id="l5.17">   let wh = collector.getModule('window-helpers');</span>
<a href="#l5.18"></a><span id="l5.18">   wh.installInto(module);</span>
<a href="#l5.19"></a><span id="l5.19">   let sh = collector.getModule('search-window-helpers');</span>
<a href="#l5.20"></a><span id="l5.20">   sh.installInto(module);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -66,25 +67,39 @@ function test_enter_some_stuff() {</span>
<a href="#l5.22"></a><span id="l5.22">   // - put &quot;foo&quot; in the subject contains box</span>
<a href="#l5.23"></a><span id="l5.23">   // Each filter criterion is a listitem in the listbox with id=searchTermList.</span>
<a href="#l5.24"></a><span id="l5.24">   // Each filter criterion has id &quot;searchRowN&quot;, and the textbox has id</span>
<a href="#l5.25"></a><span id="l5.25">   //  &quot;searchValN&quot; exposing the value on attribute &quot;value&quot;.</span>
<a href="#l5.26"></a><span id="l5.26">   // XXX I am having real difficulty getting the click/type pair to actually</span>
<a href="#l5.27"></a><span id="l5.27">   //  get the text in there reliably.  I am just going to poke things directly</span>
<a href="#l5.28"></a><span id="l5.28">   //  into the text widget. (We used to use .aid instead of .a with swc.click</span>
<a href="#l5.29"></a><span id="l5.29">   //  and swc.type.)</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-  let searchVal0 = swc.a(&quot;searchVal0&quot;, {crazyDeck: 0});</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+  let searchVal0 = swc.window.document.getElementById(&quot;searchVal0&quot;);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  let index = 0;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  if (searchVal0.hasAttribute(&quot;selectedIndex&quot;)) {</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    index = parseInt(searchVal0.getAttribute(&quot;selectedIndex&quot;));</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+  }</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+  searchVal0 = searchVal0.childNodes[index];</span>
<a href="#l5.39"></a><span id="l5.39">   searchVal0.value = &quot;foo&quot;;</span>
<a href="#l5.40"></a><span id="l5.40"> </span>
<a href="#l5.41"></a><span id="l5.41">   // - add another subject box</span>
<a href="#l5.42"></a><span id="l5.42">   let plusButton = swc.eid(&quot;searchRow0&quot;, {tagName: &quot;button&quot;, label: &quot;+&quot;});</span>
<a href="#l5.43"></a><span id="l5.43">   swc.click(plusButton);</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">   // - put &quot;bar&quot; in it</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineminus">-  let searchVal1 = swc.a(&quot;searchVal1&quot;, {crazyDeck: 0});</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+  let searchVal1 = swc.window.document.getElementById(&quot;searchVal1&quot;);</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+  index = 0;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+  if (searchVal1.hasAttribute(&quot;selectedIndex&quot;)) {</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+    index = parseInt(searchVal1.getAttribute(&quot;selectedIndex&quot;));</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+  }</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+  searchVal1 = searchVal1.childNodes[index];</span>
<a href="#l5.55"></a><span id="l5.55">   searchVal1.value = &quot;bar&quot;;</span>
<a href="#l5.56"></a><span id="l5.56"> }</span>
<a href="#l5.57"></a><span id="l5.57"> </span>
<a href="#l5.58"></a><span id="l5.58"> /**</span>
<a href="#l5.59"></a><span id="l5.59">  * Trigger the search, make sure the right results show up.</span>
<a href="#l5.60"></a><span id="l5.60">  */</span>
<a href="#l5.61"></a><span id="l5.61"> function test_go_search() {</span>
<a href="#l5.62"></a><span id="l5.62">   // - Trigger the search</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineat">@@ -226,20 +241,37 @@ function test_open_search_result_in_exis</span>
<a href="#l5.64"></a><span id="l5.64"> </span>
<a href="#l5.65"></a><span id="l5.65"> /**</span>
<a href="#l5.66"></a><span id="l5.66">  * Save the search, making sure the constraints propagated.</span>
<a href="#l5.67"></a><span id="l5.67">  */</span>
<a href="#l5.68"></a><span id="l5.68"> function subtest_save_search(savc) {</span>
<a href="#l5.69"></a><span id="l5.69">   // - make sure our constraint propagated</span>
<a href="#l5.70"></a><span id="l5.70">   // The query constraints are displayed using the same widgets (and code) that</span>
<a href="#l5.71"></a><span id="l5.71">   //  we used to enter them, so it's very similar to check.</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-  let searchVal0 = savc.aid(&quot;searchVal0&quot;, {crazyDeck: 0});</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+  let searchVal0 = swc.window.document.getElementById(&quot;searchVal0&quot;);</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+  let index = 0;</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+  if (searchVal0.hasAttribute(&quot;selectedIndex&quot;)) {</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+    index = parseInt(searchVal0.getAttribute(&quot;selectedIndex&quot;));</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+  }</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+  searchVal0 = new elib.Elem(searchVal0.childNodes[index]);</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+</span>
<a href="#l5.82"></a><span id="l5.82">   savc.assertNode(searchVal0);</span>
<a href="#l5.83"></a><span id="l5.83">   savc.assertValue(searchVal0, &quot;foo&quot;);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-  let searchVal1 = savc.aid(&quot;searchVal1&quot;, {crazyDeck: 0});</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+  let searchVal1 = swc.window.document.getElementById(&quot;searchVal1&quot;);</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+  index = 0;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+  if (searchVal1.hasAttribute(&quot;selectedIndex&quot;)) {</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+    index = parseInt(searchVal1.getAttribute(&quot;selectedIndex&quot;));</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+  }</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+  searchVal1 = new elib.Elem(searchVal1.childNodes[index]);</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+</span>
<a href="#l5.95"></a><span id="l5.95">   savc.assertNode(searchVal1);</span>
<a href="#l5.96"></a><span id="l5.96">   savc.assertValue(searchVal1, &quot;bar&quot;);</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98">   // - name the search</span>
<a href="#l5.99"></a><span id="l5.99">   savc.type(savc.eid(&quot;name&quot;), &quot;SearchSaved&quot;);</span>
<a href="#l5.100"></a><span id="l5.100"> </span>
<a href="#l5.101"></a><span id="l5.101">   // - save it!</span>
<a href="#l5.102"></a><span id="l5.102">   // this will close the dialog, which wait_for_modal_dialog is making sure</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/search/content/FilterEditor.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/search/content/FilterEditor.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -643,17 +643,17 @@ function AssignMeaningfulName()</span>
<a href="#l6.4"></a><span id="l6.4">   // If this is a Match All Messages Filter, we already know the name to assign.</span>
<a href="#l6.5"></a><span id="l6.5">   if (termRoot.matchAll)</span>
<a href="#l6.6"></a><span id="l6.6">     stub = gFilterBundle.getString( &quot;matchAllFilterName&quot; );</span>
<a href="#l6.7"></a><span id="l6.7">   else</span>
<a href="#l6.8"></a><span id="l6.8">   {</span>
<a href="#l6.9"></a><span id="l6.9">     // Assign a name based on the first search term.</span>
<a href="#l6.10"></a><span id="l6.10">     let searchValue = termRoot.searchvalue;</span>
<a href="#l6.11"></a><span id="l6.11">     let selIndex = searchValue.getAttribute( &quot;selectedIndex&quot; );</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    let children = document.getAnonymousNodes(searchValue);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    let children = searchValue.childNodes;</span>
<a href="#l6.14"></a><span id="l6.14">     let activeItem = children[selIndex];</span>
<a href="#l6.15"></a><span id="l6.15">     let attribs = Ci.nsMsgSearchAttrib;</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">     // Term, Operator and Value are the three parts of a filter match</span>
<a href="#l6.18"></a><span id="l6.18">     // Term and Operator are easy to retrieve</span>
<a href="#l6.19"></a><span id="l6.19">     let term = termRoot.searchattribute.label;</span>
<a href="#l6.20"></a><span id="l6.20">     let operator = termRoot.searchoperator.label;</span>
<a href="#l6.21"></a><span id="l6.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/search/content/searchTerm.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/search/content/searchTerm.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -188,17 +188,17 @@ function initializeSearchRows(scope, sea</span>
<a href="#l7.4"></a><span id="l7.4">  * @param matchAllValue boolean value from the first search term</span>
<a href="#l7.5"></a><span id="l7.5">  */</span>
<a href="#l7.6"></a><span id="l7.6"> function updateSearchTermsListbox(matchAllValue)</span>
<a href="#l7.7"></a><span id="l7.7"> {</span>
<a href="#l7.8"></a><span id="l7.8">   var searchTerms = document.getElementById(&quot;searchTermList&quot;);</span>
<a href="#l7.9"></a><span id="l7.9">   searchTerms.setAttribute(&quot;disabled&quot;, matchAllValue);</span>
<a href="#l7.10"></a><span id="l7.10">   var searchAttributeList = searchTerms.getElementsByTagName(&quot;search-attribute&quot;);</span>
<a href="#l7.11"></a><span id="l7.11">   var searchOperatorList = searchTerms.getElementsByTagName(&quot;search-operator&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  var searchValueList = searchTerms.getElementsByTagName(&quot;searchvalue&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  var searchValueList = searchTerms.getElementsByTagName(&quot;search-value&quot;);</span>
<a href="#l7.14"></a><span id="l7.14">   for (var i = 0; i &lt; searchAttributeList.length; i++) {</span>
<a href="#l7.15"></a><span id="l7.15">       searchAttributeList[i].setAttribute(&quot;disabled&quot;, matchAllValue);</span>
<a href="#l7.16"></a><span id="l7.16">       searchOperatorList[i].setAttribute(&quot;disabled&quot;, matchAllValue);</span>
<a href="#l7.17"></a><span id="l7.17">       searchValueList[i].setAttribute(&quot;disabled&quot;, matchAllValue);</span>
<a href="#l7.18"></a><span id="l7.18">       if (!matchAllValue)</span>
<a href="#l7.19"></a><span id="l7.19">         searchValueList[i].removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.20"></a><span id="l7.20">   }</span>
<a href="#l7.21"></a><span id="l7.21">   var moreOrLessButtonsList = searchTerms.getElementsByTagName(&quot;button&quot;);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -316,17 +316,17 @@ function booleanChanged(event) {</span>
<a href="#l7.23"></a><span id="l7.23">  * @param searchTerm  nsIMsgSearchTerm object to hold the search term</span>
<a href="#l7.24"></a><span id="l7.24">  * @param aUserAdded  boolean indicating if the row addition was initiated by the user</span>
<a href="#l7.25"></a><span id="l7.25">  *                    (e.g. via the '+' button)</span>
<a href="#l7.26"></a><span id="l7.26">  */</span>
<a href="#l7.27"></a><span id="l7.27"> function createSearchRow(index, scope, searchTerm, aUserAdded)</span>
<a href="#l7.28"></a><span id="l7.28"> {</span>
<a href="#l7.29"></a><span id="l7.29">     var searchAttr = document.createElement(&quot;search-attribute&quot;);</span>
<a href="#l7.30"></a><span id="l7.30">     var searchOp = document.createElement(&quot;search-operator&quot;);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    var searchVal = document.createElement(&quot;searchvalue&quot;);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+    var searchVal = document.createElement(&quot;search-value&quot;);</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34">     var moreButton = document.createElement(&quot;button&quot;);</span>
<a href="#l7.35"></a><span id="l7.35">     var lessButton = document.createElement(&quot;button&quot;);</span>
<a href="#l7.36"></a><span id="l7.36">     moreButton.setAttribute(&quot;class&quot;, &quot;small-button&quot;);</span>
<a href="#l7.37"></a><span id="l7.37">     moreButton.setAttribute(&quot;oncommand&quot;, &quot;onMore(event);&quot;);</span>
<a href="#l7.38"></a><span id="l7.38">     moreButton.setAttribute('label', '+');</span>
<a href="#l7.39"></a><span id="l7.39">     moreButton.setAttribute('tooltiptext', gMoreButtonTooltipText);</span>
<a href="#l7.40"></a><span id="l7.40">     lessButton.setAttribute(&quot;class&quot;, &quot;small-button&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /**</span>
<a href="#l8.5"></a><span id="l8.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.6"></a><span id="l8.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.7"></a><span id="l8.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9" class="difflineminus">-/* global MozXULElement, gFilter, gFilterList */</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+/* global MozXULElement, gFilter, gFilterList, onEnterInSearchTerm, convertDateToString */</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+/* global convertPRTimeToString, convertStringToPRTime */</span>
<a href="#l8.12"></a><span id="l8.12"> </span>
<a href="#l8.13"></a><span id="l8.13"> var {MailUtils} = ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15"> const updateParentNode = (parentNode) =&gt; {</span>
<a href="#l8.16"></a><span id="l8.16">   if (parentNode.hasAttribute(&quot;initialActionIndex&quot;)) {</span>
<a href="#l8.17"></a><span id="l8.17">     let actionIndex = parentNode.getAttribute(&quot;initialActionIndex&quot;);</span>
<a href="#l8.18"></a><span id="l8.18">     let filterAction = gFilter.getActionAt(actionIndex);</span>
<a href="#l8.19"></a><span id="l8.19">     parentNode.initWithAction(filterAction);</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineat">@@ -590,8 +591,438 @@ class MozSearchOperator extends MozSearc</span>
<a href="#l8.21"></a><span id="l8.21">     return val;</span>
<a href="#l8.22"></a><span id="l8.22">   }</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24">   get parentValue() {</span>
<a href="#l8.25"></a><span id="l8.25">     return this.searchAttribute;</span>
<a href="#l8.26"></a><span id="l8.26">   }</span>
<a href="#l8.27"></a><span id="l8.27"> }</span>
<a href="#l8.28"></a><span id="l8.28"> customElements.define(&quot;search-operator&quot;, MozSearchOperator);</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+/**</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+ * MozSearchValue is a widget that allows selecting the value to search or filter on. It can be a</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+ * text entry, priority, status, junk status, tags, hasAttachment status, and addressbook etc.</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+ *</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+ * @extends MozXULElement</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+ */</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+class MozSearchValue extends MozXULElement {</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  static get observedAttributes() {</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+    return [&quot;disabled&quot;];</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  }</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+  constructor() {</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+    super();</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+    this.addEventListener(&quot;keypress&quot;, (event) =&gt; {</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+      if (event.keyCode != KeyEvent.DOM_VK_RETURN) {</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+        return;</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+      }</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+      onEnterInSearchTerm(event);</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+    });</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+    this.internalOperator = null;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+    this.internalAttribute = null;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+    this.internalValue = null;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+  }</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+  connectedCallback() {</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    if (this.delayConnectedCallback()) {</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+        return;</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+    }</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+    // Initialize strings.</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+    const bundle = Services.strings.createBundle(&quot;chrome://messenger/locale/messenger.properties&quot;);</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+    if (!this.hasChildNodes()) {</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+      this.appendChild(MozXULElement.parseXULToFragment(`</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+        &lt;textbox flex=&quot;1&quot; class=&quot;search-value-textbox&quot; inherits=&quot;disabled&quot;&gt;&lt;/textbox&gt;</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+        &lt;menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; inherits=&quot;disabled&quot;&gt;</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+          &lt;menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+            &lt;menuitem value=&quot;6&quot; stringTag=&quot;priorityHighest&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+            &lt;menuitem value=&quot;5&quot; stringTag=&quot;priorityHigh&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+            &lt;menuitem value=&quot;4&quot; stringTag=&quot;priorityNormal&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+            &lt;menuitem value=&quot;3&quot; stringTag=&quot;priorityLow&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+            &lt;menuitem value=&quot;2&quot; stringTag=&quot;priorityLowest&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+        &lt;menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; inherits=&quot;disabled&quot;&gt;</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+          &lt;menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+            &lt;menuitem value=&quot;2&quot; stringTag=&quot;replied&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+            &lt;menuitem value=&quot;1&quot; stringTag=&quot;read&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+            &lt;menuitem value=&quot;65536&quot; stringTag=&quot;new&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+            &lt;menuitem value=&quot;4096&quot; stringTag=&quot;forwarded&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+            &lt;menuitem value=&quot;4&quot; stringTag=&quot;flagged&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+        &lt;textbox flex=&quot;1&quot; class=&quot;search-value-textbox&quot; inherits=&quot;disabled&quot;&gt;&lt;/textbox&gt;</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+        &lt;menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; inherits=&quot;disabled&quot;&gt;</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+          &lt;menupopup class=&quot;addrbooksPopup&quot; localonly=&quot;true&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+        &lt;menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; inherits=&quot;disabled&quot;&gt;</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+          &lt;menupopup class=&quot;search-value-popup&quot;&gt;&lt;/menupopup&gt;</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+        &lt;menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; inherits=&quot;disabled&quot;&gt;</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+          &lt;menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+            &lt;menuitem value=&quot;2&quot; stringTag=&quot;junk&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineplus">+        &lt;menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; inherits=&quot;disabled&quot;&gt;</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+          &lt;menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+            &lt;menuitem value=&quot;0&quot; stringTag=&quot;hasAttachments&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+        &lt;menulist flex=&quot;1&quot; class=&quot;search-value-menulist&quot; inherits=&quot;disabled&quot;&gt;</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+          &lt;menupopup class=&quot;search-value-popup&quot;&gt;</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+            &lt;menuitem value=&quot;plugin&quot; stringTag=&quot;junkScoreOriginPlugin&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineplus">+            &lt;menuitem value=&quot;user&quot; stringTag=&quot;junkScoreOriginUser&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+            &lt;menuitem value=&quot;filter&quot; stringTag=&quot;junkScoreOriginFilter&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+            &lt;menuitem value=&quot;whitelist&quot; stringTag=&quot;junkScoreOriginWhitelist&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+            &lt;menuitem value=&quot;imapflag&quot; stringTag=&quot;junkScoreOriginImapFlag&quot; class=&quot;search-value-menuitem&quot;&gt;&lt;/menuitem&gt;</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+        &lt;/menulist&gt;</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineplus">+        &lt;textbox flex=&quot;1&quot; class=&quot;search-value-textbox&quot; inherits=&quot;disabled&quot; type=&quot;number&quot;&gt;&lt;/textbox&gt;</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+        &lt;hbox flex=&quot;1&quot; class=&quot;search-value-custom&quot; inherits=&quot;disabled&quot;&gt;&lt;/hbox&gt;</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+      `));</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+      // Initialize the priority picker.</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineplus">+      this.fillStringsForChildren(this.childNodes[1].querySelector(&quot;menupopup&quot;), bundle);</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineplus">+</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+      // Initialize the status picker.</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineplus">+      this.fillStringsForChildren(this.childNodes[2].querySelector(&quot;menupopup&quot;), bundle);</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineplus">+      // initialize the address book picker</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineplus">+      this.fillStringsForChildren(this.childNodes[4].querySelector(&quot;menupopup&quot;), bundle);</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineplus">+</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+      // initialize the junk status picker</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineplus">+      this.fillStringsForChildren(this.childNodes[6].querySelector(&quot;menupopup&quot;), bundle);</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineplus">+</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+      // initialize the has attachment status picker</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+      this.fillStringsForChildren(this.childNodes[7].querySelector(&quot;menupopup&quot;), bundle);</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineplus">+</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+      // initialize the junk score origin picker</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineplus">+      this.fillStringsForChildren(this.childNodes[8].querySelector(&quot;menupopup&quot;), bundle);</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineplus">+    }</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineplus">+</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineplus">+    // Initialize the date picker.</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineplus">+    const datePicker = this.childNodes[3];</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineplus">+    const searchAttribute = this.searchAttribute;</span>
<a href="#l8.137"></a><span id="l8.137" class="difflineplus">+    const time = searchAttribute == Ci.nsMsgSearchAttrib.Date ? datePicker.value : new Date();</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineplus">+</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineplus">+    // The search-value widget has two textboxes one for text, one as a placeholder for a</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineplus">+    // date/calendar widget.</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineplus">+    datePicker.setAttribute(&quot;value&quot;, convertDateToString(time));</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineplus">+</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineplus">+    // initialize the tag list</span>
<a href="#l8.144"></a><span id="l8.144" class="difflineplus">+    this.fillInTags();</span>
<a href="#l8.145"></a><span id="l8.145" class="difflineplus">+</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineplus">+    this._updateAttributes();</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineplus">+  }</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineplus">+</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineplus">+  attributeChangedCallback() {</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+    if (!this.isConnectedAndReady) {</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+      return;</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineplus">+    }</span>
<a href="#l8.153"></a><span id="l8.153" class="difflineplus">+</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineplus">+    this._updateAttributes();</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineplus">+  }</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineplus">+</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineplus">+  _updateAttributes() {</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+    this.querySelectorAll(&quot;[inherits='disabled']&quot;).forEach(elem =&gt; {</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineplus">+      if (this.hasAttribute(&quot;disabled&quot;)) {</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineplus">+        elem.setAttribute(&quot;disabled&quot;, this.getAttribute(&quot;disabled&quot;));</span>
<a href="#l8.161"></a><span id="l8.161" class="difflineplus">+      } else {</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineplus">+        elem.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineplus">+      }</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineplus">+    });</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineplus">+  }</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineplus">+</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+  set opParentValue(val) {</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineplus">+    // Noop if we're not changing it.</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+    if (this.internalOperator == val) {</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineplus">+      return val;</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineplus">+    }</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineplus">+</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineplus">+    // Keywords has the null field IsEmpty.</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineplus">+    if (this.searchAttribute == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineplus">+      if (val == Ci.nsMsgSearchOp.IsEmpty || val == Ci.nsMsgSearchOp.IsntEmpty) {</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineplus">+        this.setAttribute(&quot;selectedIndex&quot;, &quot;-1&quot;);</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineplus">+      } else {</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineplus">+        this.setAttribute(&quot;selectedIndex&quot;, &quot;5&quot;);</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineplus">+      }</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineplus">+    }</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineplus">+</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineplus">+    // JunkStatus has the null field IsEmpty.</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineplus">+    if (this.searchAttribute == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineplus">+      if (val == Ci.nsMsgSearchOp.IsEmpty || val == Ci.nsMsgSearchOp.IsntEmpty) {</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineplus">+        this.setAttribute(&quot;selectedIndex&quot;, &quot;-1&quot;);</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineplus">+      } else {</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineplus">+        this.setAttribute(&quot;selectedIndex&quot;, &quot;6&quot;);</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineplus">+      }</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineplus">+    }</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineplus">+</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+    // If it's not sender, to, cc, alladdresses, or to or cc, we don't care.</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineplus">+    if (this.searchAttribute != Ci.nsMsgSearchAttrib.Sender &amp;&amp;</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineplus">+      this.searchAttribute != Ci.nsMsgSearchAttrib.To &amp;&amp;</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+      this.searchAttribute != Ci.nsMsgSearchAttrib.ToOrCC &amp;&amp;</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineplus">+      this.searchAttribute != Ci.nsMsgSearchAttrib.AllAddresses &amp;&amp;</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineplus">+      this.searchAttribute != Ci.nsMsgSearchAttrib.CC) {</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineplus">+      this.internalOperator = val;</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineplus">+      return val;</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineplus">+    }</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineplus">+</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineplus">+    const children = this.childNodes;</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineplus">+    if (val == Ci.nsMsgSearchOp.IsntInAB || val == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineplus">+      // If the old internalOperator was IsntInAB or IsInAB, and the new internalOperator is</span>
<a href="#l8.204"></a><span id="l8.204" class="difflineplus">+      // IsntInAB or IsInAB, noop because the search value was an ab type, and it still is.</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineplus">+      // Otherwise, switch to the ab picker and select the PAB.</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineplus">+      if (this.internalOperator != Ci.nsMsgSearchOp.IsntInAB &amp;&amp;</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineplus">+        this.internalOperator != Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineplus">+        const abs = children[4].querySelector(`[value=&quot;moz-abmdbdirectory://abook.mab&quot;]`);</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+        if (abs) {</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineplus">+          children[4].selectedItem = abs;</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineplus">+        }</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineplus">+        this.setAttribute(&quot;selectedIndex&quot;, &quot;4&quot;);</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineplus">+      }</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineplus">+    } else if (this.internalOperator == Ci.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineplus">+      this.internalOperator == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineplus">+      // If the old internalOperator wasn't IsntInAB or IsInAB, and the new internalOperator isn't</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineplus">+      // IsntInAB or IsInAB, noop because the search value wasn't an ab type, and it still isn't.</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineplus">+      // Otherwise, switch to the textbox and clear it</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+      children[0].value = &quot;&quot;;</span>
<a href="#l8.220"></a><span id="l8.220" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;0&quot;);</span>
<a href="#l8.221"></a><span id="l8.221" class="difflineplus">+    }</span>
<a href="#l8.222"></a><span id="l8.222" class="difflineplus">+</span>
<a href="#l8.223"></a><span id="l8.223" class="difflineplus">+    this.internalOperator = val;</span>
<a href="#l8.224"></a><span id="l8.224" class="difflineplus">+    return val;</span>
<a href="#l8.225"></a><span id="l8.225" class="difflineplus">+  }</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineplus">+</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineplus">+  get opParentValue() {</span>
<a href="#l8.228"></a><span id="l8.228" class="difflineplus">+    return this.internalOperator;</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineplus">+  }</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineplus">+</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+  set parentValue(val) {</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineplus">+    return this.searchAttribute = val;</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineplus">+  }</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineplus">+</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineplus">+  get parentValue() {</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineplus">+    return this.searchAttribute;</span>
<a href="#l8.237"></a><span id="l8.237" class="difflineplus">+  }</span>
<a href="#l8.238"></a><span id="l8.238" class="difflineplus">+</span>
<a href="#l8.239"></a><span id="l8.239" class="difflineplus">+  set searchAttribute(val) {</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineplus">+    // noop if we're not changing it.</span>
<a href="#l8.241"></a><span id="l8.241" class="difflineplus">+    if (this.internalAttribute == val) {</span>
<a href="#l8.242"></a><span id="l8.242" class="difflineplus">+      return val;</span>
<a href="#l8.243"></a><span id="l8.243" class="difflineplus">+    }</span>
<a href="#l8.244"></a><span id="l8.244" class="difflineplus">+    this.internalAttribute = val;</span>
<a href="#l8.245"></a><span id="l8.245" class="difflineplus">+</span>
<a href="#l8.246"></a><span id="l8.246" class="difflineplus">+    // If the searchAttribute changing, null out the internalOperator.</span>
<a href="#l8.247"></a><span id="l8.247" class="difflineplus">+    this.internalOperator = null;</span>
<a href="#l8.248"></a><span id="l8.248" class="difflineplus">+</span>
<a href="#l8.249"></a><span id="l8.249" class="difflineplus">+    // We inherit from a deck, so just use it's index attribute to hide/show widgets.</span>
<a href="#l8.250"></a><span id="l8.250" class="difflineplus">+    if (isNaN(val)) { // Is this a custom attribute?</span>
<a href="#l8.251"></a><span id="l8.251" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;10&quot;);</span>
<a href="#l8.252"></a><span id="l8.252" class="difflineplus">+      let customHbox = this.childNodes[10];</span>
<a href="#l8.253"></a><span id="l8.253" class="difflineplus">+      if (this.internalValue) {</span>
<a href="#l8.254"></a><span id="l8.254" class="difflineplus">+        customHbox.setAttribute(&quot;value&quot;, this.internalValue.str);</span>
<a href="#l8.255"></a><span id="l8.255" class="difflineplus">+      }</span>
<a href="#l8.256"></a><span id="l8.256" class="difflineplus">+      // the searchAttribute attribute is intended as a selector in</span>
<a href="#l8.257"></a><span id="l8.257" class="difflineplus">+      // CSS for custom search terms to bind a custom value</span>
<a href="#l8.258"></a><span id="l8.258" class="difflineplus">+      customHbox.setAttribute(&quot;searchAttribute&quot;, val);</span>
<a href="#l8.259"></a><span id="l8.259" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.Priority) {</span>
<a href="#l8.260"></a><span id="l8.260" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;1&quot;);</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;2&quot;);</span>
<a href="#l8.263"></a><span id="l8.263" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.Date) {</span>
<a href="#l8.264"></a><span id="l8.264" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;3&quot;);</span>
<a href="#l8.265"></a><span id="l8.265" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.Sender) {</span>
<a href="#l8.266"></a><span id="l8.266" class="difflineplus">+      // Since the internalOperator is null, this is the same as the initial state.</span>
<a href="#l8.267"></a><span id="l8.267" class="difflineplus">+      // The initial state for Sender isn't an ab type search, it's a text search,</span>
<a href="#l8.268"></a><span id="l8.268" class="difflineplus">+      // so show the textbox.</span>
<a href="#l8.269"></a><span id="l8.269" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;0&quot;);</span>
<a href="#l8.270"></a><span id="l8.270" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l8.271"></a><span id="l8.271" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;5&quot;);</span>
<a href="#l8.272"></a><span id="l8.272" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l8.273"></a><span id="l8.273" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;6&quot;);</span>
<a href="#l8.274"></a><span id="l8.274" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.HasAttachmentStatus) {</span>
<a href="#l8.275"></a><span id="l8.275" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;7&quot;);</span>
<a href="#l8.276"></a><span id="l8.276" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.JunkScoreOrigin) {</span>
<a href="#l8.277"></a><span id="l8.277" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;8&quot;);</span>
<a href="#l8.278"></a><span id="l8.278" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.AgeInDays) {</span>
<a href="#l8.279"></a><span id="l8.279" class="difflineplus">+      let valueBox = this.childNodes[9];</span>
<a href="#l8.280"></a><span id="l8.280" class="difflineplus">+      valueBox.min = -40000; // ~-100 years</span>
<a href="#l8.281"></a><span id="l8.281" class="difflineplus">+      valueBox.max = 40000; // ~100 years</span>
<a href="#l8.282"></a><span id="l8.282" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l8.283"></a><span id="l8.283" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.Size) {</span>
<a href="#l8.284"></a><span id="l8.284" class="difflineplus">+      let valueBox = this.childNodes[9];</span>
<a href="#l8.285"></a><span id="l8.285" class="difflineplus">+      valueBox.min = 0;</span>
<a href="#l8.286"></a><span id="l8.286" class="difflineplus">+      valueBox.max = 1000000000;</span>
<a href="#l8.287"></a><span id="l8.287" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l8.288"></a><span id="l8.288" class="difflineplus">+    } else if (val == Ci.nsMsgSearchAttrib.JunkPercent) {</span>
<a href="#l8.289"></a><span id="l8.289" class="difflineplus">+      let valueBox = this.childNodes[9];</span>
<a href="#l8.290"></a><span id="l8.290" class="difflineplus">+      valueBox.min = 0;</span>
<a href="#l8.291"></a><span id="l8.291" class="difflineplus">+      valueBox.max = 100;</span>
<a href="#l8.292"></a><span id="l8.292" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;9&quot;);</span>
<a href="#l8.293"></a><span id="l8.293" class="difflineplus">+    } else {</span>
<a href="#l8.294"></a><span id="l8.294" class="difflineplus">+      // a normal text field</span>
<a href="#l8.295"></a><span id="l8.295" class="difflineplus">+      this.setAttribute(&quot;selectedIndex&quot;, &quot;0&quot;);</span>
<a href="#l8.296"></a><span id="l8.296" class="difflineplus">+    }</span>
<a href="#l8.297"></a><span id="l8.297" class="difflineplus">+    return val;</span>
<a href="#l8.298"></a><span id="l8.298" class="difflineplus">+  }</span>
<a href="#l8.299"></a><span id="l8.299" class="difflineplus">+</span>
<a href="#l8.300"></a><span id="l8.300" class="difflineplus">+  get searchAttribute() {</span>
<a href="#l8.301"></a><span id="l8.301" class="difflineplus">+    return this.internalAttribute;</span>
<a href="#l8.302"></a><span id="l8.302" class="difflineplus">+  }</span>
<a href="#l8.303"></a><span id="l8.303" class="difflineplus">+</span>
<a href="#l8.304"></a><span id="l8.304" class="difflineplus">+  set value(val) {</span>
<a href="#l8.305"></a><span id="l8.305" class="difflineplus">+    // val is a nsIMsgSearchValue object</span>
<a href="#l8.306"></a><span id="l8.306" class="difflineplus">+    this.internalValue = val;</span>
<a href="#l8.307"></a><span id="l8.307" class="difflineplus">+    const attrib = this.internalAttribute;</span>
<a href="#l8.308"></a><span id="l8.308" class="difflineplus">+    const children = this.childNodes;</span>
<a href="#l8.309"></a><span id="l8.309" class="difflineplus">+    this.searchAttribute = attrib;</span>
<a href="#l8.310"></a><span id="l8.310" class="difflineplus">+    if (isNaN(attrib)) { // a custom term</span>
<a href="#l8.311"></a><span id="l8.311" class="difflineplus">+      let customHbox = this.childNodes[10];</span>
<a href="#l8.312"></a><span id="l8.312" class="difflineplus">+      customHbox.setAttribute(&quot;value&quot;, val.str);</span>
<a href="#l8.313"></a><span id="l8.313" class="difflineplus">+      return val;</span>
<a href="#l8.314"></a><span id="l8.314" class="difflineplus">+    }</span>
<a href="#l8.315"></a><span id="l8.315" class="difflineplus">+    if (attrib == Ci.nsMsgSearchAttrib.Priority) {</span>
<a href="#l8.316"></a><span id="l8.316" class="difflineplus">+      const matchingPriority = children[1].querySelector(`[value=&quot;${val.priority}&quot;]`);</span>
<a href="#l8.317"></a><span id="l8.317" class="difflineplus">+      if (matchingPriority) {</span>
<a href="#l8.318"></a><span id="l8.318" class="difflineplus">+        children[1].selectedItem = matchingPriority;</span>
<a href="#l8.319"></a><span id="l8.319" class="difflineplus">+      }</span>
<a href="#l8.320"></a><span id="l8.320" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l8.321"></a><span id="l8.321" class="difflineplus">+      const matchingStatus = children[2].querySelector(`[value=&quot;${val.status}&quot;]`);</span>
<a href="#l8.322"></a><span id="l8.322" class="difflineplus">+      if (matchingStatus) {</span>
<a href="#l8.323"></a><span id="l8.323" class="difflineplus">+        children[2].selectedItem = matchingStatus;</span>
<a href="#l8.324"></a><span id="l8.324" class="difflineplus">+      }</span>
<a href="#l8.325"></a><span id="l8.325" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.AgeInDays) {</span>
<a href="#l8.326"></a><span id="l8.326" class="difflineplus">+      children[9].value = val.age;</span>
<a href="#l8.327"></a><span id="l8.327" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.Date) {</span>
<a href="#l8.328"></a><span id="l8.328" class="difflineplus">+      children[3].value = convertPRTimeToString(val.date);</span>
<a href="#l8.329"></a><span id="l8.329" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.Sender ||</span>
<a href="#l8.330"></a><span id="l8.330" class="difflineplus">+      attrib == Ci.nsMsgSearchAttrib.To ||</span>
<a href="#l8.331"></a><span id="l8.331" class="difflineplus">+      attrib == Ci.nsMsgSearchAttrib.CC ||</span>
<a href="#l8.332"></a><span id="l8.332" class="difflineplus">+      attrib == Ci.nsMsgSearchAttrib.AllAddresses ||</span>
<a href="#l8.333"></a><span id="l8.333" class="difflineplus">+      attrib == Ci.nsMsgSearchAttrib.ToOrCC) {</span>
<a href="#l8.334"></a><span id="l8.334" class="difflineplus">+      if (this.internalOperator == Ci.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l8.335"></a><span id="l8.335" class="difflineplus">+        this.internalOperator == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l8.336"></a><span id="l8.336" class="difflineplus">+        const abs = children[4].querySelector(`[value=&quot;${val.str}&quot;]`);</span>
<a href="#l8.337"></a><span id="l8.337" class="difflineplus">+        if (abs) {</span>
<a href="#l8.338"></a><span id="l8.338" class="difflineplus">+          children[4].selectedItem = abs;</span>
<a href="#l8.339"></a><span id="l8.339" class="difflineplus">+        }</span>
<a href="#l8.340"></a><span id="l8.340" class="difflineplus">+      } else {</span>
<a href="#l8.341"></a><span id="l8.341" class="difflineplus">+        children[0].value = val.str;</span>
<a href="#l8.342"></a><span id="l8.342" class="difflineplus">+      }</span>
<a href="#l8.343"></a><span id="l8.343" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l8.344"></a><span id="l8.344" class="difflineplus">+      const keywordVal = children[5].querySelector(`[value=&quot;${val.str}&quot;]`);</span>
<a href="#l8.345"></a><span id="l8.345" class="difflineplus">+      if (keywordVal) {</span>
<a href="#l8.346"></a><span id="l8.346" class="difflineplus">+        children[5].value = val.str;</span>
<a href="#l8.347"></a><span id="l8.347" class="difflineplus">+        children[5].selectedItem = keywordVal;</span>
<a href="#l8.348"></a><span id="l8.348" class="difflineplus">+      }</span>
<a href="#l8.349"></a><span id="l8.349" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l8.350"></a><span id="l8.350" class="difflineplus">+      const junkStatus =</span>
<a href="#l8.351"></a><span id="l8.351" class="difflineplus">+        children[6].querySelector(`[value=&quot;${val.junkStatus}&quot;]`);</span>
<a href="#l8.352"></a><span id="l8.352" class="difflineplus">+      if (junkStatus) {</span>
<a href="#l8.353"></a><span id="l8.353" class="difflineplus">+        children[6].selectedItem = junkStatus;</span>
<a href="#l8.354"></a><span id="l8.354" class="difflineplus">+      }</span>
<a href="#l8.355"></a><span id="l8.355" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.HasAttachmentStatus) {</span>
<a href="#l8.356"></a><span id="l8.356" class="difflineplus">+      const hasAttachmentStatus =</span>
<a href="#l8.357"></a><span id="l8.357" class="difflineplus">+        children[7].querySelector(`[value=&quot;${val.hasAttachmentStatus}&quot;]`);</span>
<a href="#l8.358"></a><span id="l8.358" class="difflineplus">+      if (hasAttachmentStatus) {</span>
<a href="#l8.359"></a><span id="l8.359" class="difflineplus">+        children[7].selectedItem = hasAttachmentStatus;</span>
<a href="#l8.360"></a><span id="l8.360" class="difflineplus">+      }</span>
<a href="#l8.361"></a><span id="l8.361" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.JunkScoreOrigin) {</span>
<a href="#l8.362"></a><span id="l8.362" class="difflineplus">+      const junkScoreOrigin =</span>
<a href="#l8.363"></a><span id="l8.363" class="difflineplus">+        children[8].querySelector(`[value=&quot;${val.str}&quot;]`);</span>
<a href="#l8.364"></a><span id="l8.364" class="difflineplus">+      if (junkScoreOrigin) {</span>
<a href="#l8.365"></a><span id="l8.365" class="difflineplus">+        children[8].selectedItem = junkScoreOrigin;</span>
<a href="#l8.366"></a><span id="l8.366" class="difflineplus">+      }</span>
<a href="#l8.367"></a><span id="l8.367" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.JunkPercent) {</span>
<a href="#l8.368"></a><span id="l8.368" class="difflineplus">+      children[9].value = val.junkPercent;</span>
<a href="#l8.369"></a><span id="l8.369" class="difflineplus">+    } else if (attrib == Ci.nsMsgSearchAttrib.Size) {</span>
<a href="#l8.370"></a><span id="l8.370" class="difflineplus">+      children[9].value = val.size;</span>
<a href="#l8.371"></a><span id="l8.371" class="difflineplus">+    } else {</span>
<a href="#l8.372"></a><span id="l8.372" class="difflineplus">+      children[0].value = val.str;</span>
<a href="#l8.373"></a><span id="l8.373" class="difflineplus">+    }</span>
<a href="#l8.374"></a><span id="l8.374" class="difflineplus">+    return val;</span>
<a href="#l8.375"></a><span id="l8.375" class="difflineplus">+  }</span>
<a href="#l8.376"></a><span id="l8.376" class="difflineplus">+</span>
<a href="#l8.377"></a><span id="l8.377" class="difflineplus">+  get value() {</span>
<a href="#l8.378"></a><span id="l8.378" class="difflineplus">+    return this.internalValue;</span>
<a href="#l8.379"></a><span id="l8.379" class="difflineplus">+  }</span>
<a href="#l8.380"></a><span id="l8.380" class="difflineplus">+</span>
<a href="#l8.381"></a><span id="l8.381" class="difflineplus">+  save() {</span>
<a href="#l8.382"></a><span id="l8.382" class="difflineplus">+    const searchValue = this.value;</span>
<a href="#l8.383"></a><span id="l8.383" class="difflineplus">+    const searchAttribute = this.searchAttribute;</span>
<a href="#l8.384"></a><span id="l8.384" class="difflineplus">+    const children = this.childNodes;</span>
<a href="#l8.385"></a><span id="l8.385" class="difflineplus">+</span>
<a href="#l8.386"></a><span id="l8.386" class="difflineplus">+    searchValue.attrib = searchAttribute;</span>
<a href="#l8.387"></a><span id="l8.387" class="difflineplus">+    if (searchAttribute == Ci.nsMsgSearchAttrib.Priority) {</span>
<a href="#l8.388"></a><span id="l8.388" class="difflineplus">+      searchValue.priority = children[1].selectedItem.value;</span>
<a href="#l8.389"></a><span id="l8.389" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.MsgStatus) {</span>
<a href="#l8.390"></a><span id="l8.390" class="difflineplus">+      searchValue.status = children[2].value;</span>
<a href="#l8.391"></a><span id="l8.391" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.AgeInDays) {</span>
<a href="#l8.392"></a><span id="l8.392" class="difflineplus">+      searchValue.age = children[9].value;</span>
<a href="#l8.393"></a><span id="l8.393" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.Date) {</span>
<a href="#l8.394"></a><span id="l8.394" class="difflineplus">+      searchValue.date = convertStringToPRTime(children[3].value);</span>
<a href="#l8.395"></a><span id="l8.395" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.Sender ||</span>
<a href="#l8.396"></a><span id="l8.396" class="difflineplus">+      searchAttribute == Ci.nsMsgSearchAttrib.To ||</span>
<a href="#l8.397"></a><span id="l8.397" class="difflineplus">+      searchAttribute == Ci.nsMsgSearchAttrib.CC ||</span>
<a href="#l8.398"></a><span id="l8.398" class="difflineplus">+      searchAttribute == Ci.nsMsgSearchAttrib.AllAddresses ||</span>
<a href="#l8.399"></a><span id="l8.399" class="difflineplus">+      searchAttribute == Ci.nsMsgSearchAttrib.ToOrCC) {</span>
<a href="#l8.400"></a><span id="l8.400" class="difflineplus">+      if (this.internalOperator == Ci.nsMsgSearchOp.IsntInAB ||</span>
<a href="#l8.401"></a><span id="l8.401" class="difflineplus">+        this.internalOperator == Ci.nsMsgSearchOp.IsInAB) {</span>
<a href="#l8.402"></a><span id="l8.402" class="difflineplus">+        searchValue.str = children[4].selectedItem.value;</span>
<a href="#l8.403"></a><span id="l8.403" class="difflineplus">+      } else {</span>
<a href="#l8.404"></a><span id="l8.404" class="difflineplus">+        searchValue.str = children[0].value;</span>
<a href="#l8.405"></a><span id="l8.405" class="difflineplus">+      }</span>
<a href="#l8.406"></a><span id="l8.406" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.Keywords) {</span>
<a href="#l8.407"></a><span id="l8.407" class="difflineplus">+      searchValue.str = children[5].value;</span>
<a href="#l8.408"></a><span id="l8.408" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.JunkStatus) {</span>
<a href="#l8.409"></a><span id="l8.409" class="difflineplus">+      searchValue.junkStatus = children[6].value;</span>
<a href="#l8.410"></a><span id="l8.410" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.JunkPercent) {</span>
<a href="#l8.411"></a><span id="l8.411" class="difflineplus">+      searchValue.junkPercent = children[9].value;</span>
<a href="#l8.412"></a><span id="l8.412" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.Size) {</span>
<a href="#l8.413"></a><span id="l8.413" class="difflineplus">+      searchValue.size = children[9].value;</span>
<a href="#l8.414"></a><span id="l8.414" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.HasAttachmentStatus) {</span>
<a href="#l8.415"></a><span id="l8.415" class="difflineplus">+      searchValue.status = Ci.nsMsgMessageFlags.Attachment;</span>
<a href="#l8.416"></a><span id="l8.416" class="difflineplus">+    } else if (searchAttribute == Ci.nsMsgSearchAttrib.JunkScoreOrigin) {</span>
<a href="#l8.417"></a><span id="l8.417" class="difflineplus">+      searchValue.str = children[8].value;</span>
<a href="#l8.418"></a><span id="l8.418" class="difflineplus">+    } else if (isNaN(searchAttribute)) { // a custom term</span>
<a href="#l8.419"></a><span id="l8.419" class="difflineplus">+      searchValue.attrib = Ci.nsMsgSearchAttrib.Custom;</span>
<a href="#l8.420"></a><span id="l8.420" class="difflineplus">+      searchValue.str = children[10].getAttribute(&quot;value&quot;);</span>
<a href="#l8.421"></a><span id="l8.421" class="difflineplus">+    } else {</span>
<a href="#l8.422"></a><span id="l8.422" class="difflineplus">+      searchValue.str = children[0].value;</span>
<a href="#l8.423"></a><span id="l8.423" class="difflineplus">+    }</span>
<a href="#l8.424"></a><span id="l8.424" class="difflineplus">+  }</span>
<a href="#l8.425"></a><span id="l8.425" class="difflineplus">+</span>
<a href="#l8.426"></a><span id="l8.426" class="difflineplus">+  saveTo(searchValue) {</span>
<a href="#l8.427"></a><span id="l8.427" class="difflineplus">+    this.internalValue = searchValue;</span>
<a href="#l8.428"></a><span id="l8.428" class="difflineplus">+    this.save();</span>
<a href="#l8.429"></a><span id="l8.429" class="difflineplus">+  }</span>
<a href="#l8.430"></a><span id="l8.430" class="difflineplus">+</span>
<a href="#l8.431"></a><span id="l8.431" class="difflineplus">+  fillInTags() {</span>
<a href="#l8.432"></a><span id="l8.432" class="difflineplus">+    let menulist = this.childNodes[5];</span>
<a href="#l8.433"></a><span id="l8.433" class="difflineplus">+    // Force initialization of the menulist custom element first.</span>
<a href="#l8.434"></a><span id="l8.434" class="difflineplus">+    customElements.upgrade(menulist);</span>
<a href="#l8.435"></a><span id="l8.435" class="difflineplus">+    let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l8.436"></a><span id="l8.436" class="difflineplus">+    for (let i = 0; i &lt; tagArray.length; i++) {</span>
<a href="#l8.437"></a><span id="l8.437" class="difflineplus">+      const taginfo = tagArray[i];</span>
<a href="#l8.438"></a><span id="l8.438" class="difflineplus">+      const newMenuItem = menulist.appendItem(taginfo.tag, taginfo.key);</span>
<a href="#l8.439"></a><span id="l8.439" class="difflineplus">+      if (i == 0) {</span>
<a href="#l8.440"></a><span id="l8.440" class="difflineplus">+        menulist.selectedItem = newMenuItem;</span>
<a href="#l8.441"></a><span id="l8.441" class="difflineplus">+      }</span>
<a href="#l8.442"></a><span id="l8.442" class="difflineplus">+    }</span>
<a href="#l8.443"></a><span id="l8.443" class="difflineplus">+  }</span>
<a href="#l8.444"></a><span id="l8.444" class="difflineplus">+</span>
<a href="#l8.445"></a><span id="l8.445" class="difflineplus">+  fillStringsForChildren(parentNode, bundle) {</span>
<a href="#l8.446"></a><span id="l8.446" class="difflineplus">+    for (let node of parentNode.childNodes) {</span>
<a href="#l8.447"></a><span id="l8.447" class="difflineplus">+      const stringTag = node.getAttribute(&quot;stringTag&quot;);</span>
<a href="#l8.448"></a><span id="l8.448" class="difflineplus">+      if (stringTag) {</span>
<a href="#l8.449"></a><span id="l8.449" class="difflineplus">+        const attr = (node.tagName == &quot;label&quot;) ? &quot;value&quot; : &quot;label&quot;;</span>
<a href="#l8.450"></a><span id="l8.450" class="difflineplus">+        node.setAttribute(attr, bundle.GetStringFromName(stringTag));</span>
<a href="#l8.451"></a><span id="l8.451" class="difflineplus">+      }</span>
<a href="#l8.452"></a><span id="l8.452" class="difflineplus">+    }</span>
<a href="#l8.453"></a><span id="l8.453" class="difflineplus">+</span>
<a href="#l8.454"></a><span id="l8.454" class="difflineplus">+    // Force initialization of the menulist custom element.</span>
<a href="#l8.455"></a><span id="l8.455" class="difflineplus">+    customElements.upgrade(parentNode);</span>
<a href="#l8.456"></a><span id="l8.456" class="difflineplus">+  }</span>
<a href="#l8.457"></a><span id="l8.457" class="difflineplus">+}</span>
<a href="#l8.458"></a><span id="l8.458" class="difflineplus">+customElements.define(&quot;search-value&quot;, MozSearchValue);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

