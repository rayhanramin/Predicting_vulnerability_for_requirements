<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1714:649e4c6a0e38e805c882ef633083927e6642c51d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 649e4c6a0e38e805c882ef633083927e6642c51d" />
<meta property="og:url" content="/comm-central/rev/649e4c6a0e38e805c882ef633083927e6642c51d" />
<meta property="og:description" content="Final part of Bug 473458 Drop nsIMsgWindow argument from nsIMsgFolder's getMessages and getMsgDatabase functions. r=Neil,sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 649e4c6a0e38e805c882ef633083927e6642c51d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/649e4c6a0e38e805c882ef633083927e6642c51d">shortlog</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/649e4c6a0e38e805c882ef633083927e6642c51d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d">files</a> |
changeset |
<a href="/comm-central/raw-rev/649e4c6a0e38e805c882ef633083927e6642c51d">raw</a>  | <a href="/comm-central/archive/649e4c6a0e38e805c882ef633083927e6642c51d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Final part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=473458">Bug 473458</a> Drop nsIMsgWindow argument from nsIMsgFolder's getMessages and getMsgDatabase functions. r=Neil,sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 22 Jan 2009 10:15:14 +0000</td></tr>

<tr>
 <td>changeset 1714</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/649e4c6a0e38e805c882ef633083927e6642c51d">649e4c6a0e38e805c882ef633083927e6642c51d</a></td>
</tr>



<tr>
<td>parent 1713</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5ae254acdf1e78d3c91d19281e72570543310978">5ae254acdf1e78d3c91d19281e72570543310978</a>
</td>
</tr>

<tr>
<td>child 1715</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1df064913853bac2453c018b385ebe5fad7c7f4b">1df064913853bac2453c018b385ebe5fad7c7f4b</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=649e4c6a0e38e805c882ef633083927e6642c51d">1374</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 22 Jan 2009 10:17:22 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@649e4c6a0e38 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=649e4c6a0e38e805c882ef633083927e6642c51d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=649e4c6a0e38e805c882ef633083927e6642c51d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=649e4c6a0e38e805c882ef633083927e6642c51d&newProject=comm-central&newRevision=5ae254acdf1e78d3c91d19281e72570543310978&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=649e4c6a0e38e805c882ef633083927e6642c51d&newProject=comm-central&newRevision=5ae254acdf1e78d3c91d19281e72570543310978&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=649e4c6a0e38e805c882ef633083927e6642c51d&newProject=comm-central&newRevision=5ae254acdf1e78d3c91d19281e72570543310978&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a>, <a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=473458">473458</a></td></tr>




</table></div>

<div class="page_body description">Final part of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=473458">Bug 473458</a> Drop nsIMsgWindow argument from nsIMsgFolder's getMessages and getMsgDatabase functions. r=Neil,sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/commandglue.js">mail/base/content/commandglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/commandglue.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/commandglue.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/commandglue.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/commandglue.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/commandglue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/messageWindow.js">mail/base/content/messageWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/messageWindow.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/messageWindow.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/messageWindow.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/messageWindow.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/messageWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/searchBar.js">mail/base/content/searchBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/searchBar.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/searchBar.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/searchBar.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/searchBar.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/base/content/searchBar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/SpotlightIntegration.js">mail/components/search/SpotlightIntegration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/SpotlightIntegration.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/SpotlightIntegration.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/SpotlightIntegration.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/SpotlightIntegration.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/SpotlightIntegration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/WinSearchIntegration.js">mail/components/search/WinSearchIntegration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/WinSearchIntegration.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/WinSearchIntegration.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/WinSearchIntegration.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/WinSearchIntegration.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/WinSearchIntegration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/content/searchCommon.js">mail/components/search/content/searchCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/content/searchCommon.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/content/searchCommon.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/content/searchCommon.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/content/searchCommon.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mail/components/search/content/searchCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/public/nsIMsgFolder.idl">mailnews/base/public/nsIMsgFolder.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/public/nsIMsgFolder.idl">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/public/nsIMsgFolder.idl">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/public/nsIMsgFolder.idl">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/public/nsIMsgFolder.idl">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/public/nsIMsgFolder.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/commandglue.js">mailnews/base/resources/content/commandglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/commandglue.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/commandglue.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/commandglue.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/commandglue.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/commandglue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/junkCommands.js">mailnews/base/resources/content/junkCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/junkCommands.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/junkCommands.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/junkCommands.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/junkCommands.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/junkCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailCommands.js">mailnews/base/resources/content/mailCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailCommands.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailCommands.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailCommands.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailCommands.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailContextMenus.js">mailnews/base/resources/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailWindowOverlay.js">mailnews/base/resources/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/markByDate.js">mailnews/base/resources/content/markByDate.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/markByDate.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/markByDate.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/markByDate.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/markByDate.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/markByDate.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/messageWindow.js">mailnews/base/resources/content/messageWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/messageWindow.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/messageWindow.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/messageWindow.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/messageWindow.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/messageWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/msgMail3PaneWindow.js">mailnews/base/resources/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/searchBar.js">mailnews/base/resources/content/searchBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/searchBar.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/searchBar.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/searchBar.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/searchBar.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/searchBar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/virtualFolderProperties.js">mailnews/base/resources/content/virtualFolderProperties.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/virtualFolderProperties.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/virtualFolderProperties.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/virtualFolderProperties.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/virtualFolderProperties.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/virtualFolderProperties.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/widgetglue.js">mailnews/base/resources/content/widgetglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/widgetglue.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/widgetglue.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/widgetglue.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/widgetglue.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/resources/content/widgetglue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/resources/content/searchWidgets.xml">mailnews/base/search/resources/content/searchWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/resources/content/searchWidgets.xml">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/resources/content/searchWidgets.xml">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/resources/content/searchWidgets.xml">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/resources/content/searchWidgets.xml">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/resources/content/searchWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/src/nsMsgLocalSearch.cpp">mailnews/base/search/src/nsMsgLocalSearch.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/src/nsMsgLocalSearch.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/src/nsMsgLocalSearch.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/src/nsMsgLocalSearch.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/src/nsMsgLocalSearch.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/search/src/nsMsgLocalSearch.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMessengerBootstrap.cpp">mailnews/base/src/nsMessengerBootstrap.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMessengerBootstrap.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMessengerBootstrap.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMessengerBootstrap.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMessengerBootstrap.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMessengerBootstrap.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgDBView.cpp">mailnews/base/src/nsMsgDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgDBView.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgDBView.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgDBView.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgDBView.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgFolderCompactor.cpp">mailnews/base/src/nsMsgFolderCompactor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgFolderCompactor.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgFolderCompactor.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgFolderCompactor.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgFolderCompactor.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgFolderCompactor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgSearchDBView.cpp">mailnews/base/src/nsMsgSearchDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgSearchDBView.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgSearchDBView.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgSearchDBView.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgSearchDBView.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgSearchDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFViewThread.cpp">mailnews/base/src/nsMsgXFViewThread.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFViewThread.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFViewThread.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFViewThread.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFViewThread.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFViewThread.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_bug428427.js">mailnews/base/test/unit/test_bug428427.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_bug428427.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_bug428427.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_bug428427.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_bug428427.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_bug428427.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_folderCompact.js">mailnews/base/test/unit/test_folderCompact.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_folderCompact.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_folderCompact.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_folderCompact.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_folderCompact.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_folderCompact.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgTxn.cpp">mailnews/base/util/nsMsgTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgTxn.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgTxn.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgTxn.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgTxn.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/base/util/nsMsgTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgSendLater.cpp">mailnews/compose/src/nsMsgSendLater.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgSendLater.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgSendLater.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgSendLater.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgSendLater.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/compose/src/nsMsgSendLater.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/datamodel.js">mailnews/db/gloda/modules/datamodel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/datamodel.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/datamodel.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/datamodel.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/datamodel.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/datamodel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/indexer.js">mailnews/db/gloda/modules/indexer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/indexer.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/indexer.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/indexer.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/indexer.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/db/gloda/modules/indexer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js">mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/feed-subscriptions.js">mailnews/extensions/newsblog/content/feed-subscriptions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/feed-subscriptions.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/feed-subscriptions.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/feed-subscriptions.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/feed-subscriptions.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/feed-subscriptions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/utils.js">mailnews/extensions/newsblog/content/utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/utils.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/utils.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/utils.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/utils.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/content/utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/js/newsblog.js">mailnews/extensions/newsblog/js/newsblog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/js/newsblog.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/js/newsblog.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/js/newsblog.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/js/newsblog.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/extensions/newsblog/js/newsblog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsAutoSyncState.cpp">mailnews/imap/src/nsAutoSyncState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsAutoSyncState.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsAutoSyncState.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsAutoSyncState.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsAutoSyncState.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsAutoSyncState.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.h">mailnews/imap/src/nsImapMailFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.h">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.h">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.h">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.h">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapMailFolder.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapUndoTxn.cpp">mailnews/imap/src/nsImapUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/imap/src/nsImapUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.h">mailnews/local/src/nsLocalMailFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.h">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.h">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.h">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.h">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalMailFolder.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalUndoTxn.cpp">mailnews/local/src/nsLocalUndoTxn.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalUndoTxn.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalUndoTxn.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalUndoTxn.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalUndoTxn.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsLocalUndoTxn.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMailboxService.cpp">mailnews/local/src/nsMailboxService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMailboxService.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMailboxService.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMailboxService.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMailboxService.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMailboxService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMovemailIncomingServer.cpp">mailnews/local/src/nsMovemailIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMovemailIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMovemailIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMovemailIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMovemailIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsMovemailIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsPop3IncomingServer.cpp">mailnews/local/src/nsPop3IncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsPop3IncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsPop3IncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsPop3IncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsPop3IncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsPop3IncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsRssIncomingServer.cpp">mailnews/local/src/nsRssIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsRssIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsRssIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsRssIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsRssIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/local/src/nsRssIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">mailnews/mapi/mapihook/src/msgMapiImp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPArticleList.cpp">mailnews/news/src/nsNNTPArticleList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPArticleList.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPArticleList.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPArticleList.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPArticleList.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPArticleList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPNewsgroupList.cpp">mailnews/news/src/nsNNTPNewsgroupList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPNewsgroupList.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPNewsgroupList.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPNewsgroupList.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPNewsgroupList.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNNTPNewsgroupList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsDownloader.cpp">mailnews/news/src/nsNewsDownloader.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsDownloader.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsDownloader.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsDownloader.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsDownloader.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsDownloader.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.h">mailnews/news/src/nsNewsFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.h">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.h">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.h">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.h">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/src/nsNewsFolder.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/head_server_setup.js">mailnews/news/test/unit/head_server_setup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/head_server_setup.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/head_server_setup.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/head_server_setup.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/head_server_setup.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/head_server_setup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/test_filter.js">mailnews/news/test/unit/test_filter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/test_filter.js">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/test_filter.js">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/test_filter.js">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/test_filter.js">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/mailnews/news/test/unit/test_filter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/suite/mailnews/mailWidgets.xml">suite/mailnews/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/649e4c6a0e38e805c882ef633083927e6642c51d/suite/mailnews/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/649e4c6a0e38e805c882ef633083927e6642c51d/suite/mailnews/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/649e4c6a0e38e805c882ef633083927e6642c51d/suite/mailnews/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/649e4c6a0e38e805c882ef633083927e6642c51d/suite/mailnews/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/649e4c6a0e38e805c882ef633083927e6642c51d/suite/mailnews/mailWidgets.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/commandglue.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/commandglue.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -227,18 +227,17 @@ function isNewsURI(uri)</span>
<a href="#l1.4"></a><span id="l1.4"> function RerootFolder(uri, newFolder, viewType, viewFlags, sortType, sortOrder)</span>
<a href="#l1.5"></a><span id="l1.5"> {</span>
<a href="#l1.6"></a><span id="l1.6">   viewDebug(&quot;In reroot folder, sortType = &quot; +  sortType + &quot;viewType = &quot; + viewType + &quot;\n&quot;);</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">   if (sortType == 0)</span>
<a href="#l1.9"></a><span id="l1.9">   {</span>
<a href="#l1.10"></a><span id="l1.10">     try</span>
<a href="#l1.11"></a><span id="l1.11">     {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-      var msgdb = newFolder.getMsgDatabase(msgWindow);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-      var dbFolderInfo = msgdb.dBFolderInfo;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      var dbFolderInfo = newFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l1.15"></a><span id="l1.15">       sortType = dbFolderInfo.sortType;</span>
<a href="#l1.16"></a><span id="l1.16">       sortOrder = dbFolderInfo.sortOrder;</span>
<a href="#l1.17"></a><span id="l1.17">       viewFlags = dbFolderInfo.viewFlags;</span>
<a href="#l1.18"></a><span id="l1.18">       viewType = dbFolderInfo.viewType;</span>
<a href="#l1.19"></a><span id="l1.19">       dbFolderInfo = null;</span>
<a href="#l1.20"></a><span id="l1.20">     }</span>
<a href="#l1.21"></a><span id="l1.21">     catch(ex)</span>
<a href="#l1.22"></a><span id="l1.22">     {</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -293,17 +292,17 @@ function RerootFolder(uri, newFolder, vi</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">   if (oldFolder)</span>
<a href="#l1.26"></a><span id="l1.26">   {</span>
<a href="#l1.27"></a><span id="l1.27">     /* we don't null out the db reference for inbox because inbox is like the &quot;main&quot; folder</span>
<a href="#l1.28"></a><span id="l1.28">                and performance outweighs footprint*/</span>
<a href="#l1.29"></a><span id="l1.29">     if (!IsSpecialFolder(oldFolder, Components.interfaces.nsMsgFolderFlags.Inbox, false))</span>
<a href="#l1.30"></a><span id="l1.30">     {</span>
<a href="#l1.31"></a><span id="l1.31">       if (oldFolder.URI != newFolder.URI)</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-        oldFolder.setMsgDatabase(null);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+        oldFolder.msgDatabase = null;</span>
<a href="#l1.34"></a><span id="l1.34">     }</span>
<a href="#l1.35"></a><span id="l1.35">   }</span>
<a href="#l1.36"></a><span id="l1.36">   // that should have initialized gDBView, now re-root the thread pane</span>
<a href="#l1.37"></a><span id="l1.37">   RerootThreadPane();</span>
<a href="#l1.38"></a><span id="l1.38">   SetUpToolbarButtons(uri);</span>
<a href="#l1.39"></a><span id="l1.39">   UpdateStatusMessageCounts(gMsgFolderSelected);</span>
<a href="#l1.40"></a><span id="l1.40">   </span>
<a href="#l1.41"></a><span id="l1.41">   // hook for extra toolbar items</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineat">@@ -845,17 +844,17 @@ function FolderPaneSelectionChange()</span>
<a href="#l1.43"></a><span id="l1.43">             gPrevFolderFlags = folderFlags;</span>
<a href="#l1.44"></a><span id="l1.44">             gCurrentVirtualFolderUri = null;</span>
<a href="#l1.45"></a><span id="l1.45">             // don't get the db if this folder is a server</span>
<a href="#l1.46"></a><span id="l1.46">             // we're going to be display account central</span>
<a href="#l1.47"></a><span id="l1.47">             if (!(msgFolder.isServer)) </span>
<a href="#l1.48"></a><span id="l1.48">             {</span>
<a href="#l1.49"></a><span id="l1.49">               try </span>
<a href="#l1.50"></a><span id="l1.50">               {</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-                var msgDatabase = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+                var msgDatabase = msgFolder.msgDatabase;</span>
<a href="#l1.53"></a><span id="l1.53">                 if (msgDatabase)</span>
<a href="#l1.54"></a><span id="l1.54">                 {</span>
<a href="#l1.55"></a><span id="l1.55">                   var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l1.56"></a><span id="l1.56">                   sortType = dbFolderInfo.sortType;</span>
<a href="#l1.57"></a><span id="l1.57">                   sortOrder = dbFolderInfo.sortOrder;</span>
<a href="#l1.58"></a><span id="l1.58">                   viewFlags = dbFolderInfo.viewFlags;</span>
<a href="#l1.59"></a><span id="l1.59">                   if (folderFlags &amp; Components.interfaces.nsMsgFolderFlags.Virtual)</span>
<a href="#l1.60"></a><span id="l1.60">                   {</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineat">@@ -881,17 +880,17 @@ function FolderPaneSelectionChange()</span>
<a href="#l1.62"></a><span id="l1.62">                     }</span>
<a href="#l1.63"></a><span id="l1.63">                     else</span>
<a href="#l1.64"></a><span id="l1.64">                     {</span>
<a href="#l1.65"></a><span id="l1.65">                       gSearchSession = null;</span>
<a href="#l1.66"></a><span id="l1.66">                       uriToLoad = srchFolderUri;</span>
<a href="#l1.67"></a><span id="l1.67">                       // we need to load the db for the actual folder so that many hdrs to download</span>
<a href="#l1.68"></a><span id="l1.68">                       // will return false...</span>
<a href="#l1.69"></a><span id="l1.69">                       realFolder = GetMsgFolderFromUri(uriToLoad);</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-                      msgDatabase = realFolder.getMsgDatabase(msgWindow);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+                      msgDatabase = realFolder.msgDatabase;</span>
<a href="#l1.72"></a><span id="l1.72">                       gVirtualFolderTerms = CreateGroupedSearchTerms(tempFilter.searchTerms);</span>
<a href="#l1.73"></a><span id="l1.73">                     }</span>
<a href="#l1.74"></a><span id="l1.74">                   }</span>
<a href="#l1.75"></a><span id="l1.75">                   else</span>
<a href="#l1.76"></a><span id="l1.76">                   {</span>
<a href="#l1.77"></a><span id="l1.77">                     gSearchSession = null;</span>
<a href="#l1.78"></a><span id="l1.78">                     viewFlags = dbFolderInfo.viewFlags;</span>
<a href="#l1.79"></a><span id="l1.79">                     viewType = dbFolderInfo.viewType;</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineat">@@ -1009,17 +1008,17 @@ function  CreateVirtualFolder(newName, p</span>
<a href="#l1.81"></a><span id="l1.81">   // ### need to make sure view/folder doesn't exist.</span>
<a href="#l1.82"></a><span id="l1.82">   if (searchFolderURIs &amp;&amp; (searchFolderURIs != &quot;&quot;) &amp;&amp; newName &amp;&amp; (newName != &quot;&quot;)) </span>
<a href="#l1.83"></a><span id="l1.83">   {</span>
<a href="#l1.84"></a><span id="l1.84">     try</span>
<a href="#l1.85"></a><span id="l1.85">     {</span>
<a href="#l1.86"></a><span id="l1.86">       var newFolder = parentFolder.addSubfolder(newName);</span>
<a href="#l1.87"></a><span id="l1.87">       newFolder.prettyName = newName;</span>
<a href="#l1.88"></a><span id="l1.88">       newFolder.setFlag(Components.interfaces.nsMsgFolderFlags.Virtual);</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineminus">-      var vfdb = newFolder.getMsgDatabase(msgWindow);</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+      var vfdb = newFolder.msgDatabase;</span>
<a href="#l1.91"></a><span id="l1.91">       var searchTermString = getSearchTermString(searchTerms);</span>
<a href="#l1.92"></a><span id="l1.92">       var dbFolderInfo = vfdb.dBFolderInfo;</span>
<a href="#l1.93"></a><span id="l1.93">       // set the view string as a property of the db folder info</span>
<a href="#l1.94"></a><span id="l1.94">       // set the original folder name as well.</span>
<a href="#l1.95"></a><span id="l1.95">       dbFolderInfo.setCharProperty(&quot;searchStr&quot;, searchTermString);</span>
<a href="#l1.96"></a><span id="l1.96">       dbFolderInfo.setCharProperty(&quot;searchFolderUri&quot;, searchFolderURIs);</span>
<a href="#l1.97"></a><span id="l1.97">       dbFolderInfo.setBooleanProperty(&quot;searchOnline&quot;, searchOnline);</span>
<a href="#l1.98"></a><span id="l1.98"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1148,19 +1148,19 @@ let gFolderTreeController = {</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">     //xxx useless param</span>
<a href="#l2.6"></a><span id="l2.6">     function rebuildSummary(aFolder) {</span>
<a href="#l2.7"></a><span id="l2.7">       let folder = aFolder || gFolderTreeView.getSelectedFolders()[0];</span>
<a href="#l2.8"></a><span id="l2.8">       if (folder.locked) {</span>
<a href="#l2.9"></a><span id="l2.9">         folder.throwAlertMsg(&quot;operationFailedFolderBusy&quot;, msgWindow);</span>
<a href="#l2.10"></a><span id="l2.10">         return;</span>
<a href="#l2.11"></a><span id="l2.11">       }</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-      folder.getMsgDatabase(msgWindow).summaryValid = false;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+      folder.msgDatabase.summaryValid = false;</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-      var msgDB = folder.getMsgDatabase(msgWindow);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+      var msgDB = folder.msgDatabase;</span>
<a href="#l2.17"></a><span id="l2.17">       msgDB.summaryValid = false;</span>
<a href="#l2.18"></a><span id="l2.18">       try {</span>
<a href="#l2.19"></a><span id="l2.19">         folder.closeAndBackupFolderDB(&quot;&quot;);</span>
<a href="#l2.20"></a><span id="l2.20">       }</span>
<a href="#l2.21"></a><span id="l2.21">       catch(e) {</span>
<a href="#l2.22"></a><span id="l2.22">         // In a failure, proceed anyway since we're dealing with problems</span>
<a href="#l2.23"></a><span id="l2.23">         folder.ForceDBClosed();</span>
<a href="#l2.24"></a><span id="l2.24">       }</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineat">@@ -1286,17 +1286,17 @@ let gFolderTreeController = {</span>
<a href="#l2.26"></a><span id="l2.26">       return;</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">     // Delete any subfolders this folder might have</span>
<a href="#l2.29"></a><span id="l2.29">     let iter = folder.subFolders;</span>
<a href="#l2.30"></a><span id="l2.30">     while (iter.hasMoreElements())</span>
<a href="#l2.31"></a><span id="l2.31">       folder.propagateDelete(iter.getNext(), true, msgWindow);</span>
<a href="#l2.32"></a><span id="l2.32"> </span>
<a href="#l2.33"></a><span id="l2.33">     // Now delete the messages</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-    let iter = fixIterator(folder.getMessages(msgWindow));</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+    let iter = fixIterator(folder.messages);</span>
<a href="#l2.36"></a><span id="l2.36">     let messages = [m for each (m in iter)];</span>
<a href="#l2.37"></a><span id="l2.37">     let children = toXPCOMArray(messages, Ci.nsIMutableArray);</span>
<a href="#l2.38"></a><span id="l2.38">     folder.deleteMessages(children, msgWindow, true, false, null, false);</span>
<a href="#l2.39"></a><span id="l2.39">   },</span>
<a href="#l2.40"></a><span id="l2.40"> </span>
<a href="#l2.41"></a><span id="l2.41">   /**</span>
<a href="#l2.42"></a><span id="l2.42">    * Compacts either a particular folder, or all folders</span>
<a href="#l2.43"></a><span id="l2.43">    *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -425,17 +425,17 @@ function SearchForMessageIdInSubFolder(f</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">   return messageHeader;</span>
<a href="#l3.6"></a><span id="l3.6"> }</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> // check folder for corresponding message to given message id</span>
<a href="#l3.9"></a><span id="l3.9"> // return message header if message was found</span>
<a href="#l3.10"></a><span id="l3.10"> function CheckForMessageIdInFolder(folder, messageId)</span>
<a href="#l3.11"></a><span id="l3.11"> {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  var messageDatabase = folder.getMsgDatabase(msgWindow);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  var messageDatabase = folder.msgDatabase;</span>
<a href="#l3.14"></a><span id="l3.14">   var messageHeader;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">   try</span>
<a href="#l3.17"></a><span id="l3.17">   {</span>
<a href="#l3.18"></a><span id="l3.18">     messageHeader = messageDatabase.getMsgHdrForMessageID(messageId);</span>
<a href="#l3.19"></a><span id="l3.19">   }</span>
<a href="#l3.20"></a><span id="l3.20">   catch (ex)</span>
<a href="#l3.21"></a><span id="l3.21">   {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -443,17 +443,17 @@ function CheckForMessageIdInFolder(folde</span>
<a href="#l3.23"></a><span id="l3.23">   }</span>
<a href="#l3.24"></a><span id="l3.24">   var mailSession = Components.classes[&quot;@mozilla.org/messenger/services/session;1&quot;]</span>
<a href="#l3.25"></a><span id="l3.25">                               .getService(Components.interfaces.nsIMsgMailSession);</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27">   const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l3.28"></a><span id="l3.28">   if (!mailSession.IsFolderOpenInWindow(folder) &amp;&amp;</span>
<a href="#l3.29"></a><span id="l3.29">       !(folder.flags &amp; (nsMsgFolderFlags.Trash | nsMsgFolderFlags.Inbox)))</span>
<a href="#l3.30"></a><span id="l3.30">   {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-    folder.setMsgDatabase(null);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+    folder.msgDatabase = null;</span>
<a href="#l3.33"></a><span id="l3.33">   }</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35">   return messageHeader;</span>
<a href="#l3.36"></a><span id="l3.36"> }</span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38"> function folderPaneOnPopupHiding()</span>
<a href="#l3.39"></a><span id="l3.39"> {</span>
<a href="#l3.40"></a><span id="l3.40">   RestoreSelectionWithoutContentLoad(document.getElementById(&quot;folderTree&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1901,18 +1901,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">             // skip servers, Trash and Junk folders</span>
<a href="#l4.5"></a><span id="l4.5">             if (!aFolder || aFolder.isServer || aFolder.getFlag(kMsgPopupFolderFlagJunk) || aFolder.getFlag(kMsgPopupFolderFlagTrash))</span>
<a href="#l4.6"></a><span id="l4.6">               return false;</span>
<a href="#l4.7"></a><span id="l4.7">             var pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l4.8"></a><span id="l4.8">             var showPreviewText = pref.getBoolPref(&quot;mail.biff.alert.show_preview&quot;);</span>
<a href="#l4.9"></a><span id="l4.9">             var folderArray = new Array;</span>
<a href="#l4.10"></a><span id="l4.10">             if (aFolder.flags &amp; Components.interfaces.nsMsgFolderFlags.Virtual)</span>
<a href="#l4.11"></a><span id="l4.11">             {</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-              var msgDatabase = aFolder.getMsgDatabase(null);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-              var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+              var dbFolderInfo = aFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l4.15"></a><span id="l4.15">               var srchFolderUri = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l4.16"></a><span id="l4.16">               var srchFolderUriArray = srchFolderUri.split('|');</span>
<a href="#l4.17"></a><span id="l4.17">               var foldersAdded = 0;</span>
<a href="#l4.18"></a><span id="l4.18">               var RDF = Components.classes['@mozilla.org/rdf/rdf-service;1'].getService().QueryInterface(Components.interfaces.nsIRDFService);</span>
<a href="#l4.19"></a><span id="l4.19">               for (var i in srchFolderUriArray)</span>
<a href="#l4.20"></a><span id="l4.20">               {</span>
<a href="#l4.21"></a><span id="l4.21">                 var realFolder = RDF.GetResource(srchFolderUriArray[i]).QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l4.22"></a><span id="l4.22">                 if (!realFolder.isServer)</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineat">@@ -1921,38 +1920,38 @@</span>
<a href="#l4.24"></a><span id="l4.24">             }</span>
<a href="#l4.25"></a><span id="l4.25">             else</span>
<a href="#l4.26"></a><span id="l4.26">               folderArray[0] = aFolder;</span>
<a href="#l4.27"></a><span id="l4.27">             var foundNewMsg = false;</span>
<a href="#l4.28"></a><span id="l4.28">             for (var folderIndex = 0; folderIndex &lt; folderArray.length; folderIndex++)</span>
<a href="#l4.29"></a><span id="l4.29">             {</span>
<a href="#l4.30"></a><span id="l4.30">               aFolder = folderArray[folderIndex];</span>
<a href="#l4.31"></a><span id="l4.31">               // now get the database</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-              var msgDatabase = aFolder.getMsgDatabase(null);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-              aFolder.setMsgDatabase(null);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+              var msgDatabase = aFolder.msgDatabase;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+              aFolder.msgDatabase = null;</span>
<a href="#l4.36"></a><span id="l4.36">               var msgKeys = {};</span>
<a href="#l4.37"></a><span id="l4.37">               var numMsgKeys = {};</span>
<a href="#l4.38"></a><span id="l4.38">               msgDatabase.getNewList(numMsgKeys, msgKeys);</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">               if (!numMsgKeys.value)</span>
<a href="#l4.41"></a><span id="l4.41">                 continue;</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43">               if (showPreviewText)</span>
<a href="#l4.44"></a><span id="l4.44">               {</span>
<a href="#l4.45"></a><span id="l4.45">                 // fetchMsgPreviewText forces the previewText property to get generated</span>
<a href="#l4.46"></a><span id="l4.46">                 // for each of the message keys.</span>
<a href="#l4.47"></a><span id="l4.47">                 try {</span>
<a href="#l4.48"></a><span id="l4.48">                   aOutAsync.value = aFolder.fetchMsgPreviewText(msgKeys.value, numMsgKeys.value, false, aUrlListener);</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-                  aFolder.setMsgDatabase(null);</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineplus">+                  aFolder.msgDatabase = null;</span>
<a href="#l4.51"></a><span id="l4.51">                 }</span>
<a href="#l4.52"></a><span id="l4.52">                 catch (ex)</span>
<a href="#l4.53"></a><span id="l4.53">                 {</span>
<a href="#l4.54"></a><span id="l4.54">                   // fetchMsgPreviewText throws an error when we call it on a news folder, we should just not show</span>
<a href="#l4.55"></a><span id="l4.55">                   // the tooltip if this method returns an error.</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-                  aFolder.setMsgDatabase(null);</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+                  aFolder.msgDatabase = null;</span>
<a href="#l4.58"></a><span id="l4.58">                   continue;</span>
<a href="#l4.59"></a><span id="l4.59">                 }</span>
<a href="#l4.60"></a><span id="l4.60">               }</span>
<a href="#l4.61"></a><span id="l4.61">               // if fetching the preview text is going to be an asynch operation and the caller</span>
<a href="#l4.62"></a><span id="l4.62">               // is set up to handle that fact, then don't bother filling in any of the fields since</span>
<a href="#l4.63"></a><span id="l4.63">               // we'll have to do this all over again when the fetch for the preview text completes.</span>
<a href="#l4.64"></a><span id="l4.64">               // We don't expect to get called with a urlListener if we're doing a virtual folder.</span>
<a href="#l4.65"></a><span id="l4.65">               if (aOutAsync.value &amp;&amp; aUrlListener)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1640,17 +1640,17 @@ let mailTabType = {</span>
<a href="#l5.4"></a><span id="l5.4">       try</span>
<a href="#l5.5"></a><span id="l5.5">       {</span>
<a href="#l5.6"></a><span id="l5.6">         if (aTab.selectedMsgId &amp;&amp; aTab.msgSelectedFolder)</span>
<a href="#l5.7"></a><span id="l5.7">         {</span>
<a href="#l5.8"></a><span id="l5.8">           // We clear the selection in order to generate an event when we</span>
<a href="#l5.9"></a><span id="l5.9">           // re-select our message.</span>
<a href="#l5.10"></a><span id="l5.10">           ClearThreadPaneSelection();</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-          var msgDB = aTab.msgSelectedFolder.getMsgDatabase(msgWindow);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+          var msgDB = aTab.msgSelectedFolder.msgDatabase;</span>
<a href="#l5.14"></a><span id="l5.14">           var msgHdr = msgDB.getMsgHdrForMessageID(aTab.selectedMsgId);</span>
<a href="#l5.15"></a><span id="l5.15">           setTimeout(gDBView.selectFolderMsgByKey, 0, aTab.msgSelectedFolder,</span>
<a href="#l5.16"></a><span id="l5.16">                      msgHdr.messageKey);</span>
<a href="#l5.17"></a><span id="l5.17">         }</span>
<a href="#l5.18"></a><span id="l5.18">         // We do not clear the selection if there was more than one message</span>
<a href="#l5.19"></a><span id="l5.19">         // displayed.  this leaves our selection intact. there was originally</span>
<a href="#l5.20"></a><span id="l5.20">         // some claim that the selection might lose synchronization with the</span>
<a href="#l5.21"></a><span id="l5.21">         // view, but this is unsubstantiated.  said comment came from the</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -2748,17 +2748,17 @@ function OnMsgLoaded(aUrl)</span>
<a href="#l5.23"></a><span id="l5.23">   if (imapServer.storeReadMailInPFC)</span>
<a href="#l5.24"></a><span id="l5.24">   {</span>
<a href="#l5.25"></a><span id="l5.25">     // Look in read mail PFC for msg with same msg id - if we find one,</span>
<a href="#l5.26"></a><span id="l5.26">     // don't put this message in the read mail pfc.</span>
<a href="#l5.27"></a><span id="l5.27">     var outputPFC = imapServer.GetReadMailPFC(true);</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">     if (msgHdr &amp;&amp; msgHdr.messageId.length &gt; 0)</span>
<a href="#l5.30"></a><span id="l5.30">     {</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-      var readMailDB = outputPFC.getMsgDatabase(msgWindow);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      var readMailDB = outputPFC.msgDatabase;</span>
<a href="#l5.33"></a><span id="l5.33">       if (readMailDB &amp;&amp; readMailDB.getMsgHdrForMessageID(msgHdr.messageId))</span>
<a href="#l5.34"></a><span id="l5.34">         return; // Don't copy to offline folder.</span>
<a href="#l5.35"></a><span id="l5.35">     }</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37">     var messages = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l5.38"></a><span id="l5.38">                               .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l5.39"></a><span id="l5.39">     messages.appendElement(msgHdr, false);</span>
<a href="#l5.40"></a><span id="l5.40">     outputPFC.copyMessages(folder, messages, false /*isMove*/,</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -2828,17 +2828,17 @@ function HandleMDNResponse(aUrl)</span>
<a href="#l5.42"></a><span id="l5.42">                        msgHdr.messageKey, mimeHdr, false);</span>
<a href="#l5.43"></a><span id="l5.43"> </span>
<a href="#l5.44"></a><span id="l5.44">   // Reset mark msg MDN &quot;Sent&quot; and &quot;Not Needed&quot;.</span>
<a href="#l5.45"></a><span id="l5.45">   const MSG_FLAG_MDN_REPORT_NEEDED = 0x400000;</span>
<a href="#l5.46"></a><span id="l5.46">   msgHdr.flags = (msgFlags &amp; ~MSG_FLAG_MDN_REPORT_NEEDED);</span>
<a href="#l5.47"></a><span id="l5.47">   msgHdr.OrFlags(MSG_FLAG_MDN_REPORT_SENT);</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49">   // Commit db changes.</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-  var msgdb = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+  var msgdb = msgFolder.msgDatabase;</span>
<a href="#l5.52"></a><span id="l5.52">   if (msgdb)</span>
<a href="#l5.53"></a><span id="l5.53">     msgdb.Commit(ADDR_DB_LARGE_COMMIT);</span>
<a href="#l5.54"></a><span id="l5.54"> }</span>
<a href="#l5.55"></a><span id="l5.55"> </span>
<a href="#l5.56"></a><span id="l5.56"> function QuickSearchFocus() </span>
<a href="#l5.57"></a><span id="l5.57"> {</span>
<a href="#l5.58"></a><span id="l5.58">   var quickSearchTextBox = document.getElementById('searchInput');</span>
<a href="#l5.59"></a><span id="l5.59">   if (quickSearchTextBox)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/messageWindow.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/messageWindow.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -369,17 +369,17 @@ function CreateView(originalView)</span>
<a href="#l6.4"></a><span id="l6.4">   {</span>
<a href="#l6.5"></a><span id="l6.5">     viewType = originalView.viewType;</span>
<a href="#l6.6"></a><span id="l6.6">     viewFlags = originalView.viewFlags;</span>
<a href="#l6.7"></a><span id="l6.7">     sortType = originalView.sortType;</span>
<a href="#l6.8"></a><span id="l6.8">     sortOrder = originalView.sortOrder;</span>
<a href="#l6.9"></a><span id="l6.9">   }</span>
<a href="#l6.10"></a><span id="l6.10">   else if (msgFolder)</span>
<a href="#l6.11"></a><span id="l6.11">   {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    var msgDatabase = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    var msgDatabase = msgFolder.msgDatabase;</span>
<a href="#l6.14"></a><span id="l6.14">     if (msgDatabase)</span>
<a href="#l6.15"></a><span id="l6.15">     {</span>
<a href="#l6.16"></a><span id="l6.16">       var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l6.17"></a><span id="l6.17">       sortType = dbFolderInfo.sortType;</span>
<a href="#l6.18"></a><span id="l6.18">       sortOrder = dbFolderInfo.sortOrder;</span>
<a href="#l6.19"></a><span id="l6.19">       viewFlags = dbFolderInfo.viewFlags;</span>
<a href="#l6.20"></a><span id="l6.20">       viewType = dbFolderInfo.viewType;</span>
<a href="#l6.21"></a><span id="l6.21">       msgDatabase = null;</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -623,17 +623,17 @@ function SelectFolder(folderUri)</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">   if (msgfolder.manyHeadersToDownload)</span>
<a href="#l6.25"></a><span id="l6.25">   {</span>
<a href="#l6.26"></a><span id="l6.26">     gRerootOnFolderLoadForStandAlone = true;</span>
<a href="#l6.27"></a><span id="l6.27">     try</span>
<a href="#l6.28"></a><span id="l6.28">     {</span>
<a href="#l6.29"></a><span id="l6.29">       // accessing the db causes the folder loaded notification to get sent</span>
<a href="#l6.30"></a><span id="l6.30">       // for local folders.</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-      var db = msgfolder.getMsgDatabase(msgWindow);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+      var db = msgfolder.msgDatabase;</span>
<a href="#l6.33"></a><span id="l6.33">       msgfolder.startFolderLoading();</span>
<a href="#l6.34"></a><span id="l6.34">       msgfolder.updateFolder(msgWindow);</span>
<a href="#l6.35"></a><span id="l6.35">     }</span>
<a href="#l6.36"></a><span id="l6.36">     catch(ex)</span>
<a href="#l6.37"></a><span id="l6.37">     {</span>
<a href="#l6.38"></a><span id="l6.38">       dump(&quot;Error loading with many headers to download: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l6.39"></a><span id="l6.39">     }</span>
<a href="#l6.40"></a><span id="l6.40">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -258,17 +258,17 @@ var folderListener = {</span>
<a href="#l7.4"></a><span id="l7.4">                 // If the db's view isn't set, something went wrong and we</span>
<a href="#l7.5"></a><span id="l7.5">                 // should reroot the folder, which will re-open the view.</span>
<a href="#l7.6"></a><span id="l7.6">                 if (!gDBView.db)</span>
<a href="#l7.7"></a><span id="l7.7">                   gRerootOnFolderLoad = true;</span>
<a href="#l7.8"></a><span id="l7.8">               }</span>
<a href="#l7.9"></a><span id="l7.9">               if (gRerootOnFolderLoad)</span>
<a href="#l7.10"></a><span id="l7.10">                 RerootFolder(uri, msgFolder, gCurrentLoadingFolderViewType, gCurrentLoadingFolderViewFlags, gCurrentLoadingFolderSortType, gCurrentLoadingFolderSortOrder);</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-              var db = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+              var db = msgFolder.msgDatabase;</span>
<a href="#l7.14"></a><span id="l7.14">               if (db)</span>
<a href="#l7.15"></a><span id="l7.15">                 db.resetHdrCacheSize(100);</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17">               if (gDBView) {</span>
<a href="#l7.18"></a><span id="l7.18">                 gDBView.suppressCommandUpdating = false;</span>
<a href="#l7.19"></a><span id="l7.19">               }</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">               gCurrentLoadingFolderSortType = 0;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -572,18 +572,17 @@ function LoadCurrentlyDisplayedMessage()</span>
<a href="#l7.23"></a><span id="l7.23"> }</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25"> function IsCurrentLoadedFolder(folder)</span>
<a href="#l7.26"></a><span id="l7.26"> {</span>
<a href="#l7.27"></a><span id="l7.27">   var msgfolder = folder.QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l7.28"></a><span id="l7.28">   var currentLoadedFolder = GetThreadPaneFolder();</span>
<a href="#l7.29"></a><span id="l7.29">   if (currentLoadedFolder.flags &amp; Components.interfaces.nsMsgFolderFlags.Virtual)</span>
<a href="#l7.30"></a><span id="l7.30">   {</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    var msgDatabase = currentLoadedFolder.getMsgDatabase(msgWindow);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-    var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+    var dbFolderInfo = currentLoadedFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l7.34"></a><span id="l7.34">     var srchFolderUri = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l7.35"></a><span id="l7.35">     var re = new RegExp(&quot;^&quot; + msgfolder.URI + &quot;$|^&quot; + msgfolder.URI + &quot;\||\|&quot; +</span>
<a href="#l7.36"></a><span id="l7.36">                         msgfolder.URI + &quot;$|\|&quot; + msgfolder.URI +&quot;\|&quot;);</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38">     return currentLoadedFolder.URI.match(re);</span>
<a href="#l7.39"></a><span id="l7.39">   }</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41">   return (currentLoadedFolder.URI == folder.URI);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/searchBar.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/searchBar.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -102,23 +102,22 @@ var gSearchNotificationListener =</span>
<a href="#l8.4"></a><span id="l8.4">         gStatusBar.setAttribute(&quot;mode&quot;,&quot;normal&quot;);</span>
<a href="#l8.5"></a><span id="l8.5">         gSearchInProgress = false;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7">         // ### TODO need to find out if there's quick search within a virtual folder.</span>
<a href="#l8.8"></a><span id="l8.8">         if (gCurrentVirtualFolderUri &amp;&amp;</span>
<a href="#l8.9"></a><span id="l8.9">          (!gSearchInput || gSearchInput.value == &quot;&quot; || gSearchInput.showingSearchCriteria))</span>
<a href="#l8.10"></a><span id="l8.10">         {</span>
<a href="#l8.11"></a><span id="l8.11">           var vFolder = GetMsgFolderFromUri(gCurrentVirtualFolderUri, false);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          var dbFolderInfo = vFolder.getMsgDatabase(msgWindow).dBFolderInfo;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+          var dbFolderInfo = vFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l8.14"></a><span id="l8.14">           dbFolderInfo.numUnreadMessages = gNumUnreadMessages;</span>
<a href="#l8.15"></a><span id="l8.15">           dbFolderInfo.numMessages = gNumTotalMessages;</span>
<a href="#l8.16"></a><span id="l8.16">           vFolder.updateSummaryTotals(true); // force update from db.</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-          var msgdb = vFolder.getMsgDatabase(msgWindow);</span>
<a href="#l8.18"></a><span id="l8.18">           const MSG_DB_LARGE_COMMIT = 1;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-          msgdb.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+          vFolder.msgDatabase.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l8.21"></a><span id="l8.21">           // now that we have finished loading a virtual folder,</span>
<a href="#l8.22"></a><span id="l8.22">           // scroll to the correct message if there is at least one.</span>
<a href="#l8.23"></a><span id="l8.23">           if (vFolder.getTotalMessages(false) &gt; 0)</span>
<a href="#l8.24"></a><span id="l8.24">             ScrollToMessageAfterFolderLoad(vFolder);</span>
<a href="#l8.25"></a><span id="l8.25">         }</span>
<a href="#l8.26"></a><span id="l8.26">     },</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28">     onNewSearch: function()</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineat">@@ -349,17 +348,17 @@ function createSearchTermsWithList(aTerm</span>
<a href="#l8.30"></a><span id="l8.30">   var selectedFolder = GetThreadPaneFolder();</span>
<a href="#l8.31"></a><span id="l8.31">   var ioService = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l8.32"></a><span id="l8.32">                   .getService(Components.interfaces.nsIIOService);</span>
<a href="#l8.33"></a><span id="l8.33">   </span>
<a href="#l8.34"></a><span id="l8.34">   var termsArray = aTermsArray.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">   if (gXFVirtualFolderTerms)</span>
<a href="#l8.37"></a><span id="l8.37">   {</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-    var msgDatabase = selectedFolder.getMsgDatabase(msgWindow);</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+    var msgDatabase = selectedFolder.msgDatabase;</span>
<a href="#l8.40"></a><span id="l8.40">     if (msgDatabase)</span>
<a href="#l8.41"></a><span id="l8.41">     {</span>
<a href="#l8.42"></a><span id="l8.42">       var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l8.43"></a><span id="l8.43">       var srchFolderUri = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l8.44"></a><span id="l8.44">       viewDebug(&quot;createSearchTermsWithList xf vf scope = &quot; + srchFolderUri + &quot;\n&quot;);</span>
<a href="#l8.45"></a><span id="l8.45">       var srchFolderUriArray = srchFolderUri.split('|');</span>
<a href="#l8.46"></a><span id="l8.46">       for (i in srchFolderUriArray) </span>
<a href="#l8.47"></a><span id="l8.47">       {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/search/SpotlightIntegration.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/search/SpotlightIntegration.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -163,17 +163,17 @@ let SearchIntegration =</span>
<a href="#l9.4"></a><span id="l9.4">         text = this._xmlEscapeString(text);</span>
<a href="#l9.5"></a><span id="l9.5">         SearchIntegration._log.debug(&quot;utf8 text = *****************\n&quot;+ text);</span>
<a href="#l9.6"></a><span id="l9.6">         this._outputStream.write(text, text.length);</span>
<a href="#l9.7"></a><span id="l9.7">         // close out the content, dict, and plist</span>
<a href="#l9.8"></a><span id="l9.8">         this._outputStream.write(&quot;&lt;/string&gt;\n&lt;/dict&gt;\n&lt;/plist&gt;\n&quot;, 26);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">         this._msgHdr.setUint32Property(SearchIntegration._hdrIndexedProperty,</span>
<a href="#l9.11"></a><span id="l9.11">                                        1);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-        folder.getMsgDatabase(null).Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+        folder.msgDatabase.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">         this._message = &quot;&quot;;</span>
<a href="#l9.16"></a><span id="l9.16">       }</span>
<a href="#l9.17"></a><span id="l9.17">       catch (ex) {</span>
<a href="#l9.18"></a><span id="l9.18">         SearchIntegration._log.error(ex);</span>
<a href="#l9.19"></a><span id="l9.19">         this._onDoneStreaming(false);</span>
<a href="#l9.20"></a><span id="l9.20">         return;</span>
<a href="#l9.21"></a><span id="l9.21">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/search/WinSearchIntegration.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/search/WinSearchIntegration.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -302,17 +302,17 @@ let SearchIntegration =</span>
<a href="#l10.4"></a><span id="l10.4">           &quot;Date: &quot; + new Date(this._msgHdr.date / 1000).toUTCString() + CRLF);</span>
<a href="#l10.5"></a><span id="l10.5">         this._outputStream.writeString(&quot;Content-Type: &quot; + contentType.value +</span>
<a href="#l10.6"></a><span id="l10.6">                                        &quot;; charset=utf-8&quot; + CRLF + CRLF);</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8">         this._outputStream.writeString(text + CRLF + CRLF);</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">         this._msgHdr.setUint32Property(SearchIntegration._hdrIndexedProperty,</span>
<a href="#l10.11"></a><span id="l10.11">                                        1);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        folder.getMsgDatabase(null).Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+        folder.msgDatabase.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15">         this._message = &quot;&quot;;</span>
<a href="#l10.16"></a><span id="l10.16">         SearchIntegration._log.info(&quot;Successfully written file&quot;);</span>
<a href="#l10.17"></a><span id="l10.17">       }</span>
<a href="#l10.18"></a><span id="l10.18">       catch (ex) {</span>
<a href="#l10.19"></a><span id="l10.19">         SearchIntegration._log.error(ex);</span>
<a href="#l10.20"></a><span id="l10.20">         this._onDoneStreaming(false);</span>
<a href="#l10.21"></a><span id="l10.21">         return;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/search/content/searchCommon.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/search/content/searchCommon.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -278,17 +278,17 @@ let SearchSupport =</span>
<a href="#l11.4"></a><span id="l11.4">       this._currentFolderToIndex = null;</span>
<a href="#l11.5"></a><span id="l11.5">   },</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">   _findNextHdrToIndex: function search_find_next_header()</span>
<a href="#l11.8"></a><span id="l11.8">   {</span>
<a href="#l11.9"></a><span id="l11.9">     try</span>
<a href="#l11.10"></a><span id="l11.10">     {</span>
<a href="#l11.11"></a><span id="l11.11">       if (!this._headerEnumerator)</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        this._headerEnumerator = this._currentFolderToIndex.getMessages(null);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+        this._headerEnumerator = this._currentFolderToIndex.messages;</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15">       // iterate over the folder finding the next message to index</span>
<a href="#l11.16"></a><span id="l11.16">       while (this._headerEnumerator.hasMoreElements())</span>
<a href="#l11.17"></a><span id="l11.17">       {</span>
<a href="#l11.18"></a><span id="l11.18">         let msgHdr = this._headerEnumerator.getNext()</span>
<a href="#l11.19"></a><span id="l11.19">                          .QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l11.20"></a><span id="l11.20">         if (!msgHdr.getUint32Property(this._hdrIndexedProperty))</span>
<a href="#l11.21"></a><span id="l11.21">           return msgHdr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -62,24 +62,25 @@ interface nsILocalFile;</span>
<a href="#l12.4"></a><span id="l12.4"> interface nsIMsgIdentity;</span>
<a href="#l12.5"></a><span id="l12.5"> interface nsIArray;</span>
<a href="#l12.6"></a><span id="l12.6"> interface nsIMutableArray;</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> typedef long nsMsgBiffState;</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> // enumerated type for determining if a message has been replied to, forwarded, etc.</span>
<a href="#l12.11"></a><span id="l12.11"> typedef long nsMsgDispositionState;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-[scriptable, uuid(38444311-d7fb-4fbc-a52e-1899320ce1da)]</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+[scriptable, uuid(f64a0335-2b72-4320-89f6-8d57ac5e70ca)]</span>
<a href="#l12.14"></a><span id="l12.14"> interface nsIMsgFolder : nsISupports {</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16">   const nsMsgBiffState nsMsgBiffState_NewMail = 0; // User has new mail waiting.</span>
<a href="#l12.17"></a><span id="l12.17">   const nsMsgBiffState nsMsgBiffState_NoMail =  1; // No new mail is waiting.</span>
<a href="#l12.18"></a><span id="l12.18">   const nsMsgBiffState nsMsgBiffState_Unknown = 2; // We dunno whether there is new mail.</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-  nsISimpleEnumerator getMessages(in nsIMsgWindow aMsgWindow);</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+  /// Returns an enumerator containing the messages within the current database.</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+  readonly attribute nsISimpleEnumerator messages;</span>
<a href="#l12.23"></a><span id="l12.23"> </span>
<a href="#l12.24"></a><span id="l12.24">   void startFolderLoading();</span>
<a href="#l12.25"></a><span id="l12.25">   void endFolderLoading();</span>
<a href="#l12.26"></a><span id="l12.26"> </span>
<a href="#l12.27"></a><span id="l12.27">   /* get new headers for db */</span>
<a href="#l12.28"></a><span id="l12.28">   void updateFolder(in nsIMsgWindow aWindow);</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30">   readonly attribute AString prettiestName;</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineat">@@ -437,18 +438,18 @@ interface nsIMsgFolder : nsISupports {</span>
<a href="#l12.32"></a><span id="l12.32">    * one can use getDBFolderInfoAndDB.</span>
<a href="#l12.33"></a><span id="l12.33">    *</span>
<a href="#l12.34"></a><span id="l12.34">    * @exception NS_MSG_ERROR_FOLDER_SUMMARY_MISSING If the database does not</span>
<a href="#l12.35"></a><span id="l12.35">    *                         exist.</span>
<a href="#l12.36"></a><span id="l12.36">    * @exception NS_MSG_ERROR_FOLDER_SUMMARY_OUT_OF_DATE If the database contains</span>
<a href="#l12.37"></a><span id="l12.37">    *                         out of date information.</span>
<a href="#l12.38"></a><span id="l12.38">    * @see nsIMsgFolder::getDBFolderInfoAndDB.</span>
<a href="#l12.39"></a><span id="l12.39">    */</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-  nsIMsgDatabase getMsgDatabase(in nsIMsgWindow msgWindow);</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-  void setMsgDatabase (in nsIMsgDatabase msgDatabase);</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+  attribute nsIMsgDatabase msgDatabase;</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineplus">+</span>
<a href="#l12.44"></a><span id="l12.44">   /**</span>
<a href="#l12.45"></a><span id="l12.45">    * Get the backup message database, used in reparsing. This database must</span>
<a href="#l12.46"></a><span id="l12.46">    * be created first using closeAndBackupFolderDB()</span>
<a href="#l12.47"></a><span id="l12.47">    *</span>
<a href="#l12.48"></a><span id="l12.48">    * @return   backup message database</span>
<a href="#l12.49"></a><span id="l12.49">    */</span>
<a href="#l12.50"></a><span id="l12.50">   nsIMsgDatabase getBackupMsgDatabase();</span>
<a href="#l12.51"></a><span id="l12.51">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/resources/content/commandglue.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/resources/content/commandglue.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -266,18 +266,17 @@ function isNewsURI(uri)</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> function RerootFolder(uri, newFolder, viewType, viewFlags, sortType, sortOrder)</span>
<a href="#l13.6"></a><span id="l13.6"> {</span>
<a href="#l13.7"></a><span id="l13.7">   viewDebug(&quot;In reroot folder, sortType = &quot; +  sortType + &quot;viewType = &quot; + viewType + &quot;\n&quot;);</span>
<a href="#l13.8"></a><span id="l13.8">   if (sortType == 0)</span>
<a href="#l13.9"></a><span id="l13.9">   {</span>
<a href="#l13.10"></a><span id="l13.10">     try</span>
<a href="#l13.11"></a><span id="l13.11">     {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-      var msgdb = newFolder.getMsgDatabase(msgWindow);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-      var dbFolderInfo = msgdb.dBFolderInfo;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+      var dbFolderInfo = newFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l13.15"></a><span id="l13.15">       sortType = dbFolderInfo.sortType;</span>
<a href="#l13.16"></a><span id="l13.16">       sortOrder = dbFolderInfo.sortOrder;</span>
<a href="#l13.17"></a><span id="l13.17">       viewFlags = dbFolderInfo.viewFlags;</span>
<a href="#l13.18"></a><span id="l13.18">       viewType = dbFolderInfo.viewType;</span>
<a href="#l13.19"></a><span id="l13.19">       dbFolderInfo = null;</span>
<a href="#l13.20"></a><span id="l13.20">     }</span>
<a href="#l13.21"></a><span id="l13.21">     catch(ex)</span>
<a href="#l13.22"></a><span id="l13.22">     {</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineat">@@ -334,17 +333,17 @@ function RerootFolder(uri, newFolder, vi</span>
<a href="#l13.24"></a><span id="l13.24">   {</span>
<a href="#l13.25"></a><span id="l13.25">     /*disable quick search clear button if we were in the search view on folder switching*/</span>
<a href="#l13.26"></a><span id="l13.26">     disableQuickSearchClearButton();</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">      /*we don't null out the db reference for inbox because inbox is like the &quot;main&quot; folder</span>
<a href="#l13.29"></a><span id="l13.29">        and performance outweighs footprint */</span>
<a href="#l13.30"></a><span id="l13.30">     if (!IsSpecialFolder(oldFolder, nsMsgFolderFlags.Inbox, false))</span>
<a href="#l13.31"></a><span id="l13.31">       if (oldFolder.URI != newFolder.URI)</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-        oldFolder.setMsgDatabase(null);</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+        oldFolder.msgDatabase = null;</span>
<a href="#l13.34"></a><span id="l13.34">   }</span>
<a href="#l13.35"></a><span id="l13.35">   // that should have initialized gDBView, now re-root the thread pane</span>
<a href="#l13.36"></a><span id="l13.36">   RerootThreadPane();</span>
<a href="#l13.37"></a><span id="l13.37"> </span>
<a href="#l13.38"></a><span id="l13.38">   UpdateLocationBar(gMsgFolderSelected);</span>
<a href="#l13.39"></a><span id="l13.39"> </span>
<a href="#l13.40"></a><span id="l13.40">   UpdateStatusMessageCounts(gMsgFolderSelected);</span>
<a href="#l13.41"></a><span id="l13.41">   </span>
<a href="#l13.42"></a><span id="l13.42" class="difflineat">@@ -816,17 +815,17 @@ function FolderPaneSelectionChange()</span>
<a href="#l13.43"></a><span id="l13.43"> //            gSearchInput.showingSearchCriteria = false;</span>
<a href="#l13.44"></a><span id="l13.44">             gCurrentVirtualFolderUri = null;</span>
<a href="#l13.45"></a><span id="l13.45">             // don't get the db if this folder is a server</span>
<a href="#l13.46"></a><span id="l13.46">             // we're going to be display account central</span>
<a href="#l13.47"></a><span id="l13.47">             if (!(msgFolder.isServer)) </span>
<a href="#l13.48"></a><span id="l13.48">             {</span>
<a href="#l13.49"></a><span id="l13.49">               try </span>
<a href="#l13.50"></a><span id="l13.50">               {</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-                var msgDatabase = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+                var msgDatabase = msgFolder.msgDatabase;</span>
<a href="#l13.53"></a><span id="l13.53">                 if (msgDatabase)</span>
<a href="#l13.54"></a><span id="l13.54">                 {</span>
<a href="#l13.55"></a><span id="l13.55">                   gSearchSession = null;</span>
<a href="#l13.56"></a><span id="l13.56">                   var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l13.57"></a><span id="l13.57">                   sortType = dbFolderInfo.sortType;</span>
<a href="#l13.58"></a><span id="l13.58">                   sortOrder = dbFolderInfo.sortOrder;</span>
<a href="#l13.59"></a><span id="l13.59">                   viewType = dbFolderInfo.viewType;</span>
<a href="#l13.60"></a><span id="l13.60">                   viewFlags = dbFolderInfo.viewFlags;</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineat">@@ -854,17 +853,17 @@ function FolderPaneSelectionChange()</span>
<a href="#l13.62"></a><span id="l13.62">                     }</span>
<a href="#l13.63"></a><span id="l13.63">                     else</span>
<a href="#l13.64"></a><span id="l13.64">                     {</span>
<a href="#l13.65"></a><span id="l13.65">                       uriToLoad = srchFolderUri;</span>
<a href="#l13.66"></a><span id="l13.66">                       // we need to load the db for the actual folder so that many hdrs to download</span>
<a href="#l13.67"></a><span id="l13.67">                       // will return false...</span>
<a href="#l13.68"></a><span id="l13.68">                       var realFolderRes = GetResourceFromUri(uriToLoad);</span>
<a href="#l13.69"></a><span id="l13.69">                       var realFolder = realFolderRes.QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineminus">-                      msgDatabase = realFolder.getMsgDatabase(msgWindow);</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+                      msgDatabase = realFolder.msgDatabase;</span>
<a href="#l13.72"></a><span id="l13.72"> //                      dump(&quot;search term string = &quot; + searchTermString + &quot;\n&quot;);</span>
<a href="#l13.73"></a><span id="l13.73">                     </span>
<a href="#l13.74"></a><span id="l13.74">                       gVirtualFolderTerms = CreateGroupedSearchTerms(tempFilter.searchTerms);</span>
<a href="#l13.75"></a><span id="l13.75"> //                      gSearchInput.showingSearchCriteria = false;</span>
<a href="#l13.76"></a><span id="l13.76">                     }</span>
<a href="#l13.77"></a><span id="l13.77">                   }</span>
<a href="#l13.78"></a><span id="l13.78">                   msgDatabase = null;</span>
<a href="#l13.79"></a><span id="l13.79">                   dbFolderInfo = null;</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineat">@@ -1017,17 +1016,17 @@ function  CreateVirtualFolder(newName, p</span>
<a href="#l13.81"></a><span id="l13.81"> {</span>
<a href="#l13.82"></a><span id="l13.82">   // ### need to make sure view/folder doesn't exist.</span>
<a href="#l13.83"></a><span id="l13.83">   if (searchFolderURIs &amp;&amp; (searchFolderURIs != &quot;&quot;) &amp;&amp; newName &amp;&amp; (newName != &quot;&quot;)) </span>
<a href="#l13.84"></a><span id="l13.84">   {</span>
<a href="#l13.85"></a><span id="l13.85">     try</span>
<a href="#l13.86"></a><span id="l13.86">     {</span>
<a href="#l13.87"></a><span id="l13.87">       var newFolder = parentFolder.addSubfolder(newName);</span>
<a href="#l13.88"></a><span id="l13.88">       newFolder.setFlag(Components.interfaces.nsMsgFolderFlags.Virtual);</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineminus">-      var vfdb = newFolder.getMsgDatabase(msgWindow);</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+      var vfdb = newFolder.msgDatabase;</span>
<a href="#l13.91"></a><span id="l13.91">       var searchTermString = getSearchTermString(searchTerms);</span>
<a href="#l13.92"></a><span id="l13.92">       var dbFolderInfo = vfdb.dBFolderInfo;</span>
<a href="#l13.93"></a><span id="l13.93">       // set the view string as a property of the db folder info</span>
<a href="#l13.94"></a><span id="l13.94">       // set the original folder name as well.</span>
<a href="#l13.95"></a><span id="l13.95">       dbFolderInfo.setCharProperty(&quot;searchStr&quot;, searchTermString);</span>
<a href="#l13.96"></a><span id="l13.96">       dbFolderInfo.setCharProperty(&quot;searchFolderUri&quot;, searchFolderURIs);</span>
<a href="#l13.97"></a><span id="l13.97">       dbFolderInfo.setBooleanProperty(&quot;searchOnline&quot;, searchOnline);</span>
<a href="#l13.98"></a><span id="l13.98">       vfdb.summaryValid = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/resources/content/junkCommands.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/resources/content/junkCommands.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -206,17 +206,17 @@ MessageClassifier.prototype =</span>
<a href="#l14.4"></a><span id="l14.4">       var authorEmailAddress = headerParser.extractHeaderAddressMailboxes(aMsgHdr.author);</span>
<a href="#l14.5"></a><span id="l14.5">       var abCard = false;</span>
<a href="#l14.6"></a><span id="l14.6">       for (var abCount = 0; abCount &lt; aWhiteListDirectories.length; abCount++)</span>
<a href="#l14.7"></a><span id="l14.7">       {</span>
<a href="#l14.8"></a><span id="l14.8">         try {</span>
<a href="#l14.9"></a><span id="l14.9">           if (aWhiteListDirectories[abCount].cardForEmailAddress(authorEmailAddress))</span>
<a href="#l14.10"></a><span id="l14.10">           {</span>
<a href="#l14.11"></a><span id="l14.11">             // message is ham from whitelist</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-            var db = aMsgHdr.folder.getMsgDatabase(msgWindow);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+            var db = aMsgHdr.folder.msgDatabase;</span>
<a href="#l14.14"></a><span id="l14.14">             db.setStringProperty(aMsgHdr.messageKey, &quot;junkscore&quot;,</span>
<a href="#l14.15"></a><span id="l14.15">                                  Components.interfaces.nsIJunkMailPlugin.IS_HAM_SCORE);</span>
<a href="#l14.16"></a><span id="l14.16">             db.setStringProperty(aMsgHdr.messageKey, &quot;junkscoreorigin&quot;, &quot;whitelist&quot;);</span>
<a href="#l14.17"></a><span id="l14.17">             this.mGoodMsgHdrs.appendElement(aMsgHdr, false);</span>
<a href="#l14.18"></a><span id="l14.18">             return;</span>
<a href="#l14.19"></a><span id="l14.19">           }</span>
<a href="#l14.20"></a><span id="l14.20">         } catch (e) {}</span>
<a href="#l14.21"></a><span id="l14.21">       }</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -254,17 +254,17 @@ MessageClassifier.prototype =</span>
<a href="#l14.23"></a><span id="l14.23">     var score = (aClassification == nsIJunkMailPlugin.JUNK) ?</span>
<a href="#l14.24"></a><span id="l14.24">       nsIJunkMailPlugin.IS_SPAM_SCORE : nsIJunkMailPlugin.IS_HAM_SCORE;</span>
<a href="#l14.25"></a><span id="l14.25">     const statusDisplayInterval = 1000; // milliseconds between status updates</span>
<a href="#l14.26"></a><span id="l14.26"> </span>
<a href="#l14.27"></a><span id="l14.27">     // set these props via the db (instead of the message header</span>
<a href="#l14.28"></a><span id="l14.28">     // directly) so that the nsMsgDBView knows to update the UI</span>
<a href="#l14.29"></a><span id="l14.29">     //</span>
<a href="#l14.30"></a><span id="l14.30">     var msgHdr = this.mMessages[aClassifiedMsgURI];</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    var db = msgHdr.folder.getMsgDatabase(msgWindow);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    var db = msgHdr.folder.msgDatabase;</span>
<a href="#l14.33"></a><span id="l14.33">     db.setStringProperty(msgHdr.messageKey, &quot;junkscore&quot;, score);</span>
<a href="#l14.34"></a><span id="l14.34">     db.setStringProperty(msgHdr.messageKey, &quot;junkscoreorigin&quot;, &quot;plugin&quot;);</span>
<a href="#l14.35"></a><span id="l14.35">     db.setStringProperty(msgHdr.messageKey, &quot;junkpercent&quot;, aJunkPercent);</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">     if (aClassification == nsIJunkMailPlugin.JUNK)</span>
<a href="#l14.38"></a><span id="l14.38">       this.mJunkMsgHdrs.appendElement(msgHdr, false);</span>
<a href="#l14.39"></a><span id="l14.39">     else if (aClassification == nsIJunkMailPlugin.GOOD)</span>
<a href="#l14.40"></a><span id="l14.40">       this.mGoodMsgHdrs.appendElement(msgHdr, false);</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -418,17 +418,17 @@ function deleteJunkInFolder()</span>
<a href="#l14.42"></a><span id="l14.42"> {</span>
<a href="#l14.43"></a><span id="l14.43">   MsgJunkMailInfo(true);</span>
<a href="#l14.44"></a><span id="l14.44"> </span>
<a href="#l14.45"></a><span id="l14.45">   // use direct folder commands if possible so we don't mess with the selection</span>
<a href="#l14.46"></a><span id="l14.46">   if ( !(gMsgFolderSelected.flags &amp; Components.interfaces.nsMsgFolderFlags.Virtual) )</span>
<a href="#l14.47"></a><span id="l14.47">   {</span>
<a href="#l14.48"></a><span id="l14.48">     var junkMsgHdrs = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l14.49"></a><span id="l14.49">                                 .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-    var enumerator = gDBView.msgFolder.getMessages(msgWindow);</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+    var enumerator = gDBView.msgFolder.messages;</span>
<a href="#l14.52"></a><span id="l14.52">     while (enumerator.hasMoreElements())</span>
<a href="#l14.53"></a><span id="l14.53">     {</span>
<a href="#l14.54"></a><span id="l14.54">       var msgHdr = enumerator.getNext().QueryInterface(Components.interfaces.nsIMsgDBHdr);</span>
<a href="#l14.55"></a><span id="l14.55">       var junkScore = msgHdr.getStringProperty(&quot;junkscore&quot;);</span>
<a href="#l14.56"></a><span id="l14.56">       if (junkScore == Components.interfaces.nsIJunkMailPlugin.IS_SPAM_SCORE)</span>
<a href="#l14.57"></a><span id="l14.57">         junkMsgHdrs.appendElement(msgHdr, false);</span>
<a href="#l14.58"></a><span id="l14.58">     }</span>
<a href="#l14.59"></a><span id="l14.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/resources/content/mailCommands.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/resources/content/mailCommands.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -498,15 +498,15 @@ function deleteAllInFolder(commandName)</span>
<a href="#l15.4"></a><span id="l15.4">   var iter = folder.subFolders;</span>
<a href="#l15.5"></a><span id="l15.5">   while (iter.hasMoreElements())</span>
<a href="#l15.6"></a><span id="l15.6">     folder.propagateDelete(iter.getNext(), true, msgWindow);</span>
<a href="#l15.7"></a><span id="l15.7">   </span>
<a href="#l15.8"></a><span id="l15.8">   var children = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l15.9"></a><span id="l15.9">                   .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l15.10"></a><span id="l15.10">                   </span>
<a href="#l15.11"></a><span id="l15.11">   // Delete messages.</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  iter = folder.getMessages(msgWindow);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  iter = folder.messages;</span>
<a href="#l15.14"></a><span id="l15.14">   while (iter.hasMoreElements()) {</span>
<a href="#l15.15"></a><span id="l15.15">     children.appendElement(iter.getNext(), false);</span>
<a href="#l15.16"></a><span id="l15.16">   }</span>
<a href="#l15.17"></a><span id="l15.17">   folder.deleteMessages(children, msgWindow, true, false, null, false); </span>
<a href="#l15.18"></a><span id="l15.18">   children.clear();</span>
<a href="#l15.19"></a><span id="l15.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/resources/content/mailContextMenus.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/resources/content/mailContextMenus.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -775,17 +775,17 @@ function SearchForMessageIdInSubFolder(f</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5">   return messageHeader;</span>
<a href="#l16.6"></a><span id="l16.6"> }</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> // check folder for corresponding message to given message id</span>
<a href="#l16.9"></a><span id="l16.9"> // return message header if message was found</span>
<a href="#l16.10"></a><span id="l16.10"> function CheckForMessageIdInFolder(folder, messageId)</span>
<a href="#l16.11"></a><span id="l16.11"> {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  var messageDatabase = folder.getMsgDatabase(msgWindow);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  var messageDatabase = folder.msgDatabase;</span>
<a href="#l16.14"></a><span id="l16.14">   var messageHeader;</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">   try</span>
<a href="#l16.17"></a><span id="l16.17">   {</span>
<a href="#l16.18"></a><span id="l16.18">     messageHeader = messageDatabase.getMsgHdrForMessageID(messageId);</span>
<a href="#l16.19"></a><span id="l16.19">   }</span>
<a href="#l16.20"></a><span id="l16.20">   catch (ex)</span>
<a href="#l16.21"></a><span id="l16.21">   {</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -797,17 +797,17 @@ function CheckForMessageIdInFolder(folde</span>
<a href="#l16.23"></a><span id="l16.23">     gMailSession = Components.classes[mailSessionContractID]</span>
<a href="#l16.24"></a><span id="l16.24">                              .getService(Components.interfaces.nsIMsgMailSession);</span>
<a href="#l16.25"></a><span id="l16.25">   }</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27">   const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l16.28"></a><span id="l16.28">   if (!gMailSession.IsFolderOpenInWindow(folder) &amp;&amp;</span>
<a href="#l16.29"></a><span id="l16.29">       !(folder.flags &amp; (nsMsgFolderFlags.Trash | nsMsgFolderFlags.Inbox)))</span>
<a href="#l16.30"></a><span id="l16.30">   {</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-    folder.setMsgDatabase(null);</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+    folder.msgDatabase = null;</span>
<a href="#l16.33"></a><span id="l16.33">   }</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35">   return messageHeader;</span>
<a href="#l16.36"></a><span id="l16.36"> }</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38"> // CreateFilter opens the Message Filters and Filter Rules dialogs.</span>
<a href="#l16.39"></a><span id="l16.39"> //The Filter Rules dialog has focus. The window is prefilled with filtername &lt;email address&gt;</span>
<a href="#l16.40"></a><span id="l16.40"> //Sender condition is selected and the value is prefilled &lt;email address&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/resources/content/mailWindowOverlay.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/resources/content/mailWindowOverlay.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -2499,17 +2499,17 @@ function OnMsgLoaded(aUrl)</span>
<a href="#l17.4"></a><span id="l17.4">       // don't put this message in the read mail pfc.</span>
<a href="#l17.5"></a><span id="l17.5">       var outputPFC = imapServer.GetReadMailPFC(true);</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">       if (msgHdr)</span>
<a href="#l17.8"></a><span id="l17.8">       {</span>
<a href="#l17.9"></a><span id="l17.9">         messageID = msgHdr.messageId;</span>
<a href="#l17.10"></a><span id="l17.10">         if (messageID.length &gt; 0)</span>
<a href="#l17.11"></a><span id="l17.11">         {</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-          var readMailDB = outputPFC.getMsgDatabase(msgWindow);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+          var readMailDB = outputPFC.msgDatabase;</span>
<a href="#l17.14"></a><span id="l17.14">           if (readMailDB)</span>
<a href="#l17.15"></a><span id="l17.15">           {</span>
<a href="#l17.16"></a><span id="l17.16">             var hdrInDestDB = readMailDB.getMsgHdrForMessageID(messageID);</span>
<a href="#l17.17"></a><span id="l17.17">             if (hdrInDestDB)</span>
<a href="#l17.18"></a><span id="l17.18">               copyToOfflineFolder = false;</span>
<a href="#l17.19"></a><span id="l17.19">           }</span>
<a href="#l17.20"></a><span id="l17.20">         }</span>
<a href="#l17.21"></a><span id="l17.21">       }</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -2580,17 +2580,17 @@ function HandleMDNResponse(aUrl)</span>
<a href="#l17.23"></a><span id="l17.23">                                   createInstance(Components.interfaces.nsIMsgMdnGenerator);</span>
<a href="#l17.24"></a><span id="l17.24">   mdnGenerator.process(MDN_DISPOSE_TYPE_DISPLAYED, msgWindow, msgFolder, msgHdr.messageKey, mimeHdr, false);</span>
<a href="#l17.25"></a><span id="l17.25"> </span>
<a href="#l17.26"></a><span id="l17.26">   // Reset mark msg MDN &quot;Sent&quot; and &quot;Not Needed&quot;.</span>
<a href="#l17.27"></a><span id="l17.27">   msgHdr.flags = (msgFlags &amp; ~MSG_FLAG_MDN_REPORT_NEEDED);</span>
<a href="#l17.28"></a><span id="l17.28">   msgHdr.OrFlags(MSG_FLAG_MDN_REPORT_SENT);</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30">   // Commit db changes.</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-  var msgdb = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  var msgdb = msgFolder.msgDatabase;</span>
<a href="#l17.33"></a><span id="l17.33">   if (msgdb)</span>
<a href="#l17.34"></a><span id="l17.34">     msgdb.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l17.35"></a><span id="l17.35"> }</span>
<a href="#l17.36"></a><span id="l17.36"> </span>
<a href="#l17.37"></a><span id="l17.37"> function MsgSearchMessages()</span>
<a href="#l17.38"></a><span id="l17.38"> {</span>
<a href="#l17.39"></a><span id="l17.39">   var preselectedFolder = null;</span>
<a href="#l17.40"></a><span id="l17.40">   if (&quot;GetFirstSelectedMsgFolder&quot; in window)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/resources/content/markByDate.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/resources/content/markByDate.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -103,17 +103,17 @@ function onAccept()</span>
<a href="#l18.4"></a><span id="l18.4"> function markInDatabase( lower, upper )</span>
<a href="#l18.5"></a><span id="l18.5"> {</span>
<a href="#l18.6"></a><span id="l18.6">   var messageFolder;</span>
<a href="#l18.7"></a><span id="l18.7">   var messageDatabase;</span>
<a href="#l18.8"></a><span id="l18.8">   // extract the database</span>
<a href="#l18.9"></a><span id="l18.9">   if ( window.arguments &amp;&amp; window.arguments[0] )</span>
<a href="#l18.10"></a><span id="l18.10">   {</span>
<a href="#l18.11"></a><span id="l18.11">     messageFolder = window.arguments[0];</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    messageDatabase = messageFolder.getMsgDatabase( null );</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    messageDatabase = messageFolder.msgDatabase;</span>
<a href="#l18.14"></a><span id="l18.14">   }</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">   if ( !messageDatabase )</span>
<a href="#l18.17"></a><span id="l18.17">   {</span>
<a href="#l18.18"></a><span id="l18.18">     dump( &quot;markByDate::markInDatabase: there /is/ no database to operate on!\n&quot; );</span>
<a href="#l18.19"></a><span id="l18.19">     return;</span>
<a href="#l18.20"></a><span id="l18.20">   }</span>
<a href="#l18.21"></a><span id="l18.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/resources/content/messageWindow.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/resources/content/messageWindow.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -363,17 +363,17 @@ function CreateView(originalView)</span>
<a href="#l19.4"></a><span id="l19.4">   {</span>
<a href="#l19.5"></a><span id="l19.5">     viewType = originalView.viewType;</span>
<a href="#l19.6"></a><span id="l19.6">     viewFlags = originalView.viewFlags;</span>
<a href="#l19.7"></a><span id="l19.7">     sortType = originalView.sortType;</span>
<a href="#l19.8"></a><span id="l19.8">     sortOrder = originalView.sortOrder;</span>
<a href="#l19.9"></a><span id="l19.9">   }</span>
<a href="#l19.10"></a><span id="l19.10">   else if (msgFolder)</span>
<a href="#l19.11"></a><span id="l19.11">   {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    var msgDatabase = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    var msgDatabase = msgFolder.msgDatabase;</span>
<a href="#l19.14"></a><span id="l19.14">     if (msgDatabase)</span>
<a href="#l19.15"></a><span id="l19.15">     {</span>
<a href="#l19.16"></a><span id="l19.16">       var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l19.17"></a><span id="l19.17">       sortType = dbFolderInfo.sortType;</span>
<a href="#l19.18"></a><span id="l19.18">       sortOrder = dbFolderInfo.sortOrder;</span>
<a href="#l19.19"></a><span id="l19.19">       viewFlags = dbFolderInfo.viewFlags;</span>
<a href="#l19.20"></a><span id="l19.20">       viewType = dbFolderInfo.viewType;</span>
<a href="#l19.21"></a><span id="l19.21">       msgDatabase = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/resources/content/msgMail3PaneWindow.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/resources/content/msgMail3PaneWindow.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -583,18 +583,17 @@ function IsCurrentLoadedFolder(folder)</span>
<a href="#l20.4"></a><span id="l20.4">   {</span>
<a href="#l20.5"></a><span id="l20.5">     var folderResource = msgfolder.QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l20.6"></a><span id="l20.6">     if(folderResource)</span>
<a href="#l20.7"></a><span id="l20.7">     {</span>
<a href="#l20.8"></a><span id="l20.8">       var folderURI = folderResource.Value;</span>
<a href="#l20.9"></a><span id="l20.9">       var currentLoadedFolder = GetThreadPaneFolder();</span>
<a href="#l20.10"></a><span id="l20.10">       if (currentLoadedFolder.flags &amp; Components.interfaces.nsMsgFolderFlags.Virtual)</span>
<a href="#l20.11"></a><span id="l20.11">       {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-        var msgDatabase = currentLoadedFolder.getMsgDatabase(msgWindow);</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-        var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+        var dbFolderInfo = currentLoadedFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l20.15"></a><span id="l20.15">         var srchFolderUri = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l20.16"></a><span id="l20.16">         var re = new RegExp(&quot;^&quot; + folderURI + &quot;$|^&quot; + folderURI + &quot;\||\|&quot; + folderURI + &quot;$|\|&quot; + folderURI +&quot;\|&quot;);</span>
<a href="#l20.17"></a><span id="l20.17">         var retval = (currentLoadedFolder.URI.match(re));</span>
<a href="#l20.18"></a><span id="l20.18">         return retval;</span>
<a href="#l20.19"></a><span id="l20.19"> </span>
<a href="#l20.20"></a><span id="l20.20">       }</span>
<a href="#l20.21"></a><span id="l20.21">       var currentURI = currentLoadedFolder.URI;</span>
<a href="#l20.22"></a><span id="l20.22">       return(currentURI == folderURI);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/resources/content/searchBar.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/resources/content/searchBar.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -86,21 +86,21 @@ var gSearchNotificationListener =</span>
<a href="#l21.4"></a><span id="l21.4">         gProgressMeter.setAttribute(&quot;mode&quot;, &quot;normal&quot;);</span>
<a href="#l21.5"></a><span id="l21.5">         gSearchInProgress = false;</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7">         // ### TODO need to find out if there's quick search within a virtual folder.</span>
<a href="#l21.8"></a><span id="l21.8">         if (gCurrentVirtualFolderUri &amp;&amp;</span>
<a href="#l21.9"></a><span id="l21.9">          (!gSearchInput || gSearchInput.value == &quot;&quot; || gSearchInput.showingSearchCriteria))</span>
<a href="#l21.10"></a><span id="l21.10">         {</span>
<a href="#l21.11"></a><span id="l21.11">           var vFolder = GetMsgFolderFromUri(gCurrentVirtualFolderUri, false);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-          var dbFolderInfo = vFolder.getMsgDatabase(msgWindow).dBFolderInfo;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+          var dbFolderInfo = vFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l21.14"></a><span id="l21.14">           dbFolderInfo.numUnreadMessages = gNumUnreadMessages;</span>
<a href="#l21.15"></a><span id="l21.15">           dbFolderInfo.numMessages = gNumTotalMessages;</span>
<a href="#l21.16"></a><span id="l21.16">           vFolder.updateSummaryTotals(true); // force update from db.</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-          var msgdb = vFolder.getMsgDatabase(msgWindow);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+          var msgdb = vFolder.msgDatabase;</span>
<a href="#l21.19"></a><span id="l21.19">           msgdb.Commit(MSG_DB_LARGE_COMMIT);</span>
<a href="#l21.20"></a><span id="l21.20">           // now that we have finished loading a virtual folder,</span>
<a href="#l21.21"></a><span id="l21.21">           // scroll to the correct message if there is at least one.</span>
<a href="#l21.22"></a><span id="l21.22">           if (vFolder.getTotalMessages(false) &gt; 0)</span>
<a href="#l21.23"></a><span id="l21.23">             ScrollToMessageAfterFolderLoad(vFolder);</span>
<a href="#l21.24"></a><span id="l21.24">         }</span>
<a href="#l21.25"></a><span id="l21.25">     },</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27" class="difflineat">@@ -330,17 +330,17 @@ function createSearchTermsWithList(aTerm</span>
<a href="#l21.28"></a><span id="l21.28">   var searchTerms = gSearchSession.searchTerms;</span>
<a href="#l21.29"></a><span id="l21.29">   var searchTermsArray = searchTerms.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l21.30"></a><span id="l21.30">   searchTermsArray.Clear();</span>
<a href="#l21.31"></a><span id="l21.31"> </span>
<a href="#l21.32"></a><span id="l21.32">   var i;</span>
<a href="#l21.33"></a><span id="l21.33">   var selectedFolder = GetThreadPaneFolder();</span>
<a href="#l21.34"></a><span id="l21.34">   if (gXFVirtualFolderTerms)</span>
<a href="#l21.35"></a><span id="l21.35">   {</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-    var msgDatabase = selectedFolder.getMsgDatabase(msgWindow);</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+    var msgDatabase = selectedFolder.msgDatabase;</span>
<a href="#l21.38"></a><span id="l21.38">     if (msgDatabase)</span>
<a href="#l21.39"></a><span id="l21.39">     {</span>
<a href="#l21.40"></a><span id="l21.40">       var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l21.41"></a><span id="l21.41">       var srchFolderUri = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l21.42"></a><span id="l21.42">       viewDebug(&quot;createSearchTermsWithList xf vf scope = &quot; + srchFolderUri + &quot;\n&quot;);</span>
<a href="#l21.43"></a><span id="l21.43">       var srchFolderUriArray = srchFolderUri.split('|');</span>
<a href="#l21.44"></a><span id="l21.44">       for (i in srchFolderUriArray) </span>
<a href="#l21.45"></a><span id="l21.45">       {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/resources/content/virtualFolderProperties.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/resources/content/virtualFolderProperties.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -129,18 +129,17 @@ function updateOnlineSearchState()</span>
<a href="#l22.4"></a><span id="l22.4"> function InitDialogWithVirtualFolder(aVirtualFolderURI)</span>
<a href="#l22.5"></a><span id="l22.5"> {</span>
<a href="#l22.6"></a><span id="l22.6">   // when editing an existing folder, hide the folder picker that stores the parent location of the folder</span>
<a href="#l22.7"></a><span id="l22.7">   document.getElementById(&quot;chooseFolderLocationRow&quot;).collapsed = true;</span>
<a href="#l22.8"></a><span id="l22.8">   var folderNameField = document.getElementById(&quot;name&quot;);</span>
<a href="#l22.9"></a><span id="l22.9">   folderNameField.disabled = true;</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11">   var msgFolder = GetMsgFolderFromUri(aVirtualFolderURI);</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  var msgDatabase = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-  var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+  var dbFolderInfo = msgFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l22.15"></a><span id="l22.15"> </span>
<a href="#l22.16"></a><span id="l22.16">   gSearchFolderURIs = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l22.17"></a><span id="l22.17">   var searchTermString = dbFolderInfo.getCharProperty(&quot;searchStr&quot;);</span>
<a href="#l22.18"></a><span id="l22.18">   document.getElementById('searchOnline').checked = dbFolderInfo.getBooleanProperty(&quot;searchOnline&quot;, false);</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">   // work around to get our search term string converted into a real array of search terms</span>
<a href="#l22.21"></a><span id="l22.21">   var filterService = Components.classes[&quot;@mozilla.org/messenger/services/filters;1&quot;].getService(Components.interfaces.nsIMsgFilterService);</span>
<a href="#l22.22"></a><span id="l22.22">   var filterList = filterService.getTempFilterList(msgFolder);</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineat">@@ -181,17 +180,17 @@ function onOK()</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25">   if (window.arguments[0].editExistingFolder)</span>
<a href="#l22.26"></a><span id="l22.26">   {</span>
<a href="#l22.27"></a><span id="l22.27">     // update the search terms</span>
<a href="#l22.28"></a><span id="l22.28">     saveSearchTerms(gSearchTermSession.searchTerms, gSearchTermSession);</span>
<a href="#l22.29"></a><span id="l22.29">     var searchTermString = getSearchTermString(gSearchTermSession.searchTerms);</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31">     var msgFolder = window.arguments[0].folder;</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-    var msgDatabase = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineplus">+    var msgDatabase = msgFolder.msgDatabase;</span>
<a href="#l22.34"></a><span id="l22.34">     var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l22.35"></a><span id="l22.35"> </span>
<a href="#l22.36"></a><span id="l22.36">     // set the view string as a property of the db folder info</span>
<a href="#l22.37"></a><span id="l22.37">     // set the original folder name as well.</span>
<a href="#l22.38"></a><span id="l22.38">     dbFolderInfo.setCharProperty(&quot;searchStr&quot;, searchTermString);</span>
<a href="#l22.39"></a><span id="l22.39">     dbFolderInfo.setCharProperty(&quot;searchFolderUri&quot;, gSearchFolderURIs);</span>
<a href="#l22.40"></a><span id="l22.40">     dbFolderInfo.setBooleanProperty(&quot;searchOnline&quot;, searchOnline);</span>
<a href="#l22.41"></a><span id="l22.41">     msgDatabase.Close(true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/resources/content/widgetglue.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/resources/content/widgetglue.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -261,17 +261,17 @@ function MsgFolderProperties()</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> function RebuildSummaryFile(msgFolder)</span>
<a href="#l23.6"></a><span id="l23.6"> {</span>
<a href="#l23.7"></a><span id="l23.7">   if (msgFolder.locked)</span>
<a href="#l23.8"></a><span id="l23.8">   {</span>
<a href="#l23.9"></a><span id="l23.9">     msgFolder.throwAlertMsg(&quot;operationFailedFolderBusy&quot;, msgWindow);</span>
<a href="#l23.10"></a><span id="l23.10">     return;</span>
<a href="#l23.11"></a><span id="l23.11">   }</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  var msgDB = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  var msgDB = msgFolder.msgDatabase;</span>
<a href="#l23.14"></a><span id="l23.14">   msgDB.summaryValid = false;</span>
<a href="#l23.15"></a><span id="l23.15">   try {</span>
<a href="#l23.16"></a><span id="l23.16">     msgFolder.closeAndBackupFolderDB(&quot;&quot;);</span>
<a href="#l23.17"></a><span id="l23.17">   }</span>
<a href="#l23.18"></a><span id="l23.18">   catch(e) {</span>
<a href="#l23.19"></a><span id="l23.19">     // In a failure, proceed anyway since we're dealing with problems</span>
<a href="#l23.20"></a><span id="l23.20">     msgFolder.ForceDBClosed();</span>
<a href="#l23.21"></a><span id="l23.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/search/resources/content/searchWidgets.xml</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/search/resources/content/searchWidgets.xml</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -579,18 +579,17 @@</span>
<a href="#l24.4"></a><span id="l24.4">       &lt;constructor&gt;</span>
<a href="#l24.5"></a><span id="l24.5">         &lt;![CDATA[</span>
<a href="#l24.6"></a><span id="l24.6">             var accountManager = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;].getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l24.7"></a><span id="l24.7">             var identity = accountManager.getFirstIdentityForServer(gFilterList.folder.server);</span>
<a href="#l24.8"></a><span id="l24.8">             var rdfService = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService(Components.interfaces.nsIRDFService);</span>
<a href="#l24.9"></a><span id="l24.9">             var resource = rdfService.GetResource(identity.stationeryFolder);</span>
<a href="#l24.10"></a><span id="l24.10">             var msgFolder = resource.QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l24.11"></a><span id="l24.11">             var msgWindow = GetFilterEditorMsgWindow();</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-            var msgDatabase = msgFolder.getMsgDatabase(msgWindow);</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-            var enumerator = msgDatabase.EnumerateMessages();</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+            var enumerator = msgFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l24.15"></a><span id="l24.15">             var templateListPopup = document.getAnonymousNodes(this)[0].menupopup;</span>
<a href="#l24.16"></a><span id="l24.16"> </span>
<a href="#l24.17"></a><span id="l24.17">             if ( enumerator )</span>
<a href="#l24.18"></a><span id="l24.18">             {</span>
<a href="#l24.19"></a><span id="l24.19">               while (enumerator.hasMoreElements())</span>
<a href="#l24.20"></a><span id="l24.20">               {</span>
<a href="#l24.21"></a><span id="l24.21">                 var header = enumerator.getNext();</span>
<a href="#l24.22"></a><span id="l24.22">                 if (header instanceof Components.interfaces.nsIMsgDBHdr)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -823,17 +823,17 @@ nsMsgSearchOfflineNews::~nsMsgSearchOffl</span>
<a href="#l25.4"></a><span id="l25.4"> nsresult nsMsgSearchOfflineNews::OpenSummaryFile ()</span>
<a href="#l25.5"></a><span id="l25.5"> {</span>
<a href="#l25.6"></a><span id="l25.6">   nsresult err = NS_OK;</span>
<a href="#l25.7"></a><span id="l25.7">   nsCOMPtr &lt;nsIDBFolderInfo&gt;  folderInfo;</span>
<a href="#l25.8"></a><span id="l25.8">   nsCOMPtr &lt;nsIMsgFolder&gt; scopeFolder;</span>
<a href="#l25.9"></a><span id="l25.9">   err = m_scope-&gt;GetFolder(getter_AddRefs(scopeFolder));</span>
<a href="#l25.10"></a><span id="l25.10">   // code here used to check if offline store existed, which breaks offline news.</span>
<a href="#l25.11"></a><span id="l25.11">   if (NS_SUCCEEDED(err) &amp;&amp; scopeFolder)</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    err = scopeFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(m_db));</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+    err = scopeFolder-&gt;GetMsgDatabase(getter_AddRefs(m_db));</span>
<a href="#l25.14"></a><span id="l25.14">   return err;</span>
<a href="#l25.15"></a><span id="l25.15"> }</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17"> nsresult nsMsgSearchOfflineNews::ValidateTerms ()</span>
<a href="#l25.18"></a><span id="l25.18"> {</span>
<a href="#l25.19"></a><span id="l25.19">   return nsMsgSearchOfflineMail::ValidateTerms ();</span>
<a href="#l25.20"></a><span id="l25.20"> }</span>
<a href="#l25.21"></a><span id="l25.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerBootstrap.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -256,17 +256,17 @@ nsresult nsMessengerBootstrap::OpenMesse</span>
<a href="#l26.4"></a><span id="l26.4">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.5"></a><span id="l26.5">   nsCOMPtr&lt;nsIMsgFolder&gt; containingFolder;</span>
<a href="#l26.6"></a><span id="l26.6">   containingFolder = do_QueryInterface(res, &amp;rv);</span>
<a href="#l26.7"></a><span id="l26.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.8"></a><span id="l26.8">   rv = DiscoverFoldersIfNeeded(containingFolder);</span>
<a href="#l26.9"></a><span id="l26.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l26.10"></a><span id="l26.10">   // once we have the folder uri, open the db and search for the message id.</span>
<a href="#l26.11"></a><span id="l26.11">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  containingFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(msgDB));</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+  containingFolder-&gt;GetMsgDatabase(getter_AddRefs(msgDB));</span>
<a href="#l26.14"></a><span id="l26.14">   nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l26.15"></a><span id="l26.15">   if (msgDB)</span>
<a href="#l26.16"></a><span id="l26.16">     msgDB-&gt;GetMsgHdrForMessageID(messageId.get(), getter_AddRefs(msgHdr));</span>
<a href="#l26.17"></a><span id="l26.17">   if (msgHdr)</span>
<a href="#l26.18"></a><span id="l26.18">   {</span>
<a href="#l26.19"></a><span id="l26.19">     nsMsgKey msgKey;</span>
<a href="#l26.20"></a><span id="l26.20">     msgHdr-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l26.21"></a><span id="l26.21">     rv = OpenMessengerWindowWithUri(&quot;mail:messageWindow&quot;, folderUri.get(), msgKey);  </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -2423,17 +2423,17 @@ VirtualFolderChangeListener::OnHdrProper</span>
<a href="#l27.4"></a><span id="l27.4">   const PRUint32 kRead = 0x2;</span>
<a href="#l27.5"></a><span id="l27.5">   const PRUint32 kNew = 0x4;</span>
<a href="#l27.6"></a><span id="l27.6">   NS_ENSURE_ARG_POINTER(aHdrChanged);</span>
<a href="#l27.7"></a><span id="l27.7">   NS_ENSURE_ARG_POINTER(aStatus);</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9">   PRUint32 flags;</span>
<a href="#l27.10"></a><span id="l27.10">   PRBool match;</span>
<a href="#l27.11"></a><span id="l27.11">   nsCOMPtr&lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(nsnull, getter_AddRefs(msgDB));</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(getter_AddRefs(msgDB));</span>
<a href="#l27.14"></a><span id="l27.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.15"></a><span id="l27.15">   // we don't want any early returns from this function, until we've</span>
<a href="#l27.16"></a><span id="l27.16">   // called ClearScopes on the search session.</span>
<a href="#l27.17"></a><span id="l27.17">   m_searchSession-&gt;AddScopeTerm(nsMsgSearchScope::offlineMail, m_folderWatching);</span>
<a href="#l27.18"></a><span id="l27.18">   rv = m_searchSession-&gt;MatchHdr(aHdrChanged, msgDB, &amp;match);</span>
<a href="#l27.19"></a><span id="l27.19">   m_searchSession-&gt;ClearScopes();</span>
<a href="#l27.20"></a><span id="l27.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.21"></a><span id="l27.21">   aHdrChanged-&gt;GetFlags(&amp;flags);</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -2503,17 +2503,17 @@ VirtualFolderChangeListener::OnHdrProper</span>
<a href="#l27.23"></a><span id="l27.23"> </span>
<a href="#l27.24"></a><span id="l27.24">   return NS_OK;</span>
<a href="#l27.25"></a><span id="l27.25"> }</span>
<a href="#l27.26"></a><span id="l27.26"> </span>
<a href="#l27.27"></a><span id="l27.27"> NS_IMETHODIMP VirtualFolderChangeListener::OnHdrFlagsChanged(nsIMsgDBHdr *aHdrChanged, PRUint32 aOldFlags, PRUint32 aNewFlags, nsIDBChangeListener *aInstigator)</span>
<a href="#l27.28"></a><span id="l27.28"> {</span>
<a href="#l27.29"></a><span id="l27.29">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l27.30"></a><span id="l27.30"> </span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(nsnull, getter_AddRefs(msgDB));</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(getter_AddRefs(msgDB));</span>
<a href="#l27.33"></a><span id="l27.33">   PRBool oldMatch = PR_FALSE, newMatch = PR_FALSE;</span>
<a href="#l27.34"></a><span id="l27.34">   // we don't want any early returns from this function, until we've</span>
<a href="#l27.35"></a><span id="l27.35">   // called ClearScopes 0n the search session.</span>
<a href="#l27.36"></a><span id="l27.36">   m_searchSession-&gt;AddScopeTerm(nsMsgSearchScope::offlineMail, m_folderWatching);</span>
<a href="#l27.37"></a><span id="l27.37">   rv = m_searchSession-&gt;MatchHdr(aHdrChanged, msgDB, &amp;newMatch);</span>
<a href="#l27.38"></a><span id="l27.38">   if (NS_SUCCEEDED(rv) &amp;&amp; m_searchOnMsgStatus)</span>
<a href="#l27.39"></a><span id="l27.39">   {</span>
<a href="#l27.40"></a><span id="l27.40">     // if status is a search criteria, check if the header matched before</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineat">@@ -2583,17 +2583,17 @@ NS_IMETHODIMP VirtualFolderChangeListene</span>
<a href="#l27.42"></a><span id="l27.42">   }</span>
<a href="#l27.43"></a><span id="l27.43">   return rv;</span>
<a href="#l27.44"></a><span id="l27.44"> }</span>
<a href="#l27.45"></a><span id="l27.45"> </span>
<a href="#l27.46"></a><span id="l27.46"> NS_IMETHODIMP VirtualFolderChangeListener::OnHdrDeleted(nsIMsgDBHdr *aHdrDeleted, nsMsgKey aParentKey, PRInt32 aFlags, nsIDBChangeListener *aInstigator)</span>
<a href="#l27.47"></a><span id="l27.47"> {</span>
<a href="#l27.48"></a><span id="l27.48">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l27.49"></a><span id="l27.49"> </span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(nsnull, getter_AddRefs(msgDB));</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineplus">+  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(getter_AddRefs(msgDB));</span>
<a href="#l27.52"></a><span id="l27.52">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.53"></a><span id="l27.53">   PRBool match = PR_FALSE;</span>
<a href="#l27.54"></a><span id="l27.54">   m_searchSession-&gt;AddScopeTerm(nsMsgSearchScope::offlineMail, m_folderWatching);</span>
<a href="#l27.55"></a><span id="l27.55">   rv = m_searchSession-&gt;MatchHdr(aHdrDeleted, msgDB, &amp;match);</span>
<a href="#l27.56"></a><span id="l27.56">   m_searchSession-&gt;ClearScopes();</span>
<a href="#l27.57"></a><span id="l27.57">   if (match)</span>
<a href="#l27.58"></a><span id="l27.58">   {</span>
<a href="#l27.59"></a><span id="l27.59">     nsCOMPtr &lt;nsIMsgDatabase&gt; virtDatabase;</span>
<a href="#l27.60"></a><span id="l27.60" class="difflineat">@@ -2624,17 +2624,17 @@ NS_IMETHODIMP VirtualFolderChangeListene</span>
<a href="#l27.61"></a><span id="l27.61">   }</span>
<a href="#l27.62"></a><span id="l27.62">   return rv;</span>
<a href="#l27.63"></a><span id="l27.63"> }</span>
<a href="#l27.64"></a><span id="l27.64"> </span>
<a href="#l27.65"></a><span id="l27.65"> NS_IMETHODIMP VirtualFolderChangeListener::OnHdrAdded(nsIMsgDBHdr *aNewHdr, nsMsgKey aParentKey, PRInt32 aFlags, nsIDBChangeListener *aInstigator)</span>
<a href="#l27.66"></a><span id="l27.66"> {</span>
<a href="#l27.67"></a><span id="l27.67">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l27.68"></a><span id="l27.68"> </span>
<a href="#l27.69"></a><span id="l27.69" class="difflineminus">-  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(nsnull, getter_AddRefs(msgDB));</span>
<a href="#l27.70"></a><span id="l27.70" class="difflineplus">+  nsresult rv = m_folderWatching-&gt;GetMsgDatabase(getter_AddRefs(msgDB));</span>
<a href="#l27.71"></a><span id="l27.71">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l27.72"></a><span id="l27.72">   PRBool match = PR_FALSE;</span>
<a href="#l27.73"></a><span id="l27.73">   m_searchSession-&gt;AddScopeTerm(nsMsgSearchScope::offlineMail, m_folderWatching);</span>
<a href="#l27.74"></a><span id="l27.74">   rv = m_searchSession-&gt;MatchHdr(aNewHdr, msgDB, &amp;match);</span>
<a href="#l27.75"></a><span id="l27.75">   m_searchSession-&gt;ClearScopes();</span>
<a href="#l27.76"></a><span id="l27.76">   if (match)</span>
<a href="#l27.77"></a><span id="l27.77">   {</span>
<a href="#l27.78"></a><span id="l27.78">     nsCOMPtr &lt;nsIMsgDatabase&gt; virtDatabase;</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineat">@@ -2771,17 +2771,18 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l27.80"></a><span id="l27.80">               if (parentFolder)</span>
<a href="#l27.81"></a><span id="l27.81">               {</span>
<a href="#l27.82"></a><span id="l27.82">                 nsAutoString currentFolderNameStr;</span>
<a href="#l27.83"></a><span id="l27.83">                 nsCAutoString currentFolderNameCStr;</span>
<a href="#l27.84"></a><span id="l27.84">                 MsgUnescapeString(nsCString(Substring(buffer, lastSlash + 1, buffer.Length())), 0, currentFolderNameCStr);</span>
<a href="#l27.85"></a><span id="l27.85">                 CopyUTF8toUTF16(currentFolderNameCStr, currentFolderNameStr);</span>
<a href="#l27.86"></a><span id="l27.86">                 nsCOMPtr &lt;nsIMsgFolder&gt; childFolder;</span>
<a href="#l27.87"></a><span id="l27.87">                 nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineminus">-                virtualFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(db)); // force db to get created.</span>
<a href="#l27.89"></a><span id="l27.89" class="difflineplus">+                // force db to get created.</span>
<a href="#l27.90"></a><span id="l27.90" class="difflineplus">+                virtualFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l27.91"></a><span id="l27.91">                 if (db)</span>
<a href="#l27.92"></a><span id="l27.92">                   rv = db-&gt;GetDBFolderInfo(getter_AddRefs(dbFolderInfo));</span>
<a href="#l27.93"></a><span id="l27.93">                 else</span>
<a href="#l27.94"></a><span id="l27.94">                   break;</span>
<a href="#l27.95"></a><span id="l27.95"> </span>
<a href="#l27.96"></a><span id="l27.96">                 parentFolder-&gt;AddSubfolder(currentFolderNameStr, getter_AddRefs(childFolder));</span>
<a href="#l27.97"></a><span id="l27.97">                 virtualFolder-&gt;SetFlag(nsMsgFolderFlags::Virtual);</span>
<a href="#l27.98"></a><span id="l27.98">                 if (childFolder)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -3665,17 +3665,17 @@ nsMsgDBView::GetCollationKey(nsIMsgDBHdr</span>
<a href="#l28.4"></a><span id="l28.4"> nsresult</span>
<a href="#l28.5"></a><span id="l28.5"> nsMsgDBView::GetLocationCollationKey(nsIMsgDBHdr *msgHdr, PRUint8 **result, PRUint32 *len)</span>
<a href="#l28.6"></a><span id="l28.6"> {</span>
<a href="#l28.7"></a><span id="l28.7">   nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9">   nsresult rv = msgHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l28.10"></a><span id="l28.10">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l28.11"></a><span id="l28.11">   nsCOMPtr &lt;nsIMsgDatabase&gt; dbToUse;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  rv = folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(dbToUse));</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  rv = folder-&gt;GetMsgDatabase(getter_AddRefs(dbToUse));</span>
<a href="#l28.14"></a><span id="l28.14">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16">   nsString locationString;</span>
<a href="#l28.17"></a><span id="l28.17">   rv = folder-&gt;GetPrettiestName(locationString);</span>
<a href="#l28.18"></a><span id="l28.18">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20">   return dbToUse-&gt;CreateCollationKey(locationString, result, len);</span>
<a href="#l28.21"></a><span id="l28.21"> }</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -4496,17 +4496,17 @@ nsMsgDBView::GetIndexForThread(nsIMsgDBH</span>
<a href="#l28.23"></a><span id="l28.23">   //to either GetCollationKey or GetLongField</span>
<a href="#l28.24"></a><span id="l28.24">   nsIMsgCustomColumnHandler* colHandler = GetCurColumnHandlerFromDBInfo();</span>
<a href="#l28.25"></a><span id="l28.25"> </span>
<a href="#l28.26"></a><span id="l28.26">   viewSortInfo comparisonContext;</span>
<a href="#l28.27"></a><span id="l28.27">   comparisonContext.view = this;</span>
<a href="#l28.28"></a><span id="l28.28">   comparisonContext.isSecondarySort = PR_FALSE;</span>
<a href="#l28.29"></a><span id="l28.29">   comparisonContext.ascendingSort = (m_sortOrder == nsMsgViewSortOrder::ascending);</span>
<a href="#l28.30"></a><span id="l28.30">   nsCOMPtr &lt;nsIMsgDatabase&gt; hdrDB;</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-  EntryInfo1.folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(hdrDB));</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+  EntryInfo1.folder-&gt;GetMsgDatabase(getter_AddRefs(hdrDB));</span>
<a href="#l28.33"></a><span id="l28.33">   comparisonContext.db = hdrDB.get();</span>
<a href="#l28.34"></a><span id="l28.34">   switch (fieldType)</span>
<a href="#l28.35"></a><span id="l28.35">   {</span>
<a href="#l28.36"></a><span id="l28.36">     case kCollationKey:</span>
<a href="#l28.37"></a><span id="l28.37">       rv = GetCollationKey(msgHdr, m_sortType, &amp;EntryInfo1.key, &amp;EntryInfo1.dword, colHandler);</span>
<a href="#l28.38"></a><span id="l28.38">       NS_ASSERTION(NS_SUCCEEDED(rv),&quot;failed to create collation key&quot;);</span>
<a href="#l28.39"></a><span id="l28.39">       break;</span>
<a href="#l28.40"></a><span id="l28.40">     case kU32:</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineat">@@ -5016,17 +5016,17 @@ nsMsgDBView::GetThreadRootIndex(nsIMsgDB</span>
<a href="#l28.42"></a><span id="l28.42">   //to either GetCollationKey or GetLongField</span>
<a href="#l28.43"></a><span id="l28.43">   nsIMsgCustomColumnHandler* colHandler = GetCurColumnHandlerFromDBInfo();</span>
<a href="#l28.44"></a><span id="l28.44"> </span>
<a href="#l28.45"></a><span id="l28.45">   viewSortInfo comparisonContext;</span>
<a href="#l28.46"></a><span id="l28.46">   comparisonContext.view = this;</span>
<a href="#l28.47"></a><span id="l28.47">   comparisonContext.isSecondarySort = PR_FALSE;</span>
<a href="#l28.48"></a><span id="l28.48">   comparisonContext.ascendingSort = (m_sortOrder == nsMsgViewSortOrder::ascending);</span>
<a href="#l28.49"></a><span id="l28.49">   nsCOMPtr&lt;nsIMsgDatabase&gt; hdrDB;</span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-  EntryInfo1.folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(hdrDB));</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+  EntryInfo1.folder-&gt;GetMsgDatabase(getter_AddRefs(hdrDB));</span>
<a href="#l28.52"></a><span id="l28.52">   comparisonContext.db = hdrDB.get();</span>
<a href="#l28.53"></a><span id="l28.53">   switch (fieldType)</span>
<a href="#l28.54"></a><span id="l28.54">   {</span>
<a href="#l28.55"></a><span id="l28.55">     case kCollationKey:</span>
<a href="#l28.56"></a><span id="l28.56">       rv = GetCollationKey(msgHdr, m_sortType, &amp;EntryInfo1.key, &amp;EntryInfo1.dword, colHandler);</span>
<a href="#l28.57"></a><span id="l28.57">       NS_ASSERTION(NS_SUCCEEDED(rv),&quot;failed to create collation key&quot;);</span>
<a href="#l28.58"></a><span id="l28.58">       break;</span>
<a href="#l28.59"></a><span id="l28.59">     case kU32:</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineat">@@ -5140,17 +5140,17 @@ void nsMsgDBView::InitEntryInfoForIndex(</span>
<a href="#l28.61"></a><span id="l28.61">   msgHdr-&gt;GetMessageKey(&amp;EntryInfo.id);</span>
<a href="#l28.62"></a><span id="l28.62">   msgHdr-&gt;GetFolder(&amp;EntryInfo.folder);</span>
<a href="#l28.63"></a><span id="l28.63">   EntryInfo.folder-&gt;Release();</span>
<a href="#l28.64"></a><span id="l28.64">   //check if a custom column handler exists. If it does then grab it and pass it in</span>
<a href="#l28.65"></a><span id="l28.65">   //to either GetCollationKey or GetLongField</span>
<a href="#l28.66"></a><span id="l28.66">   nsIMsgCustomColumnHandler* colHandler = GetCurColumnHandlerFromDBInfo();</span>
<a href="#l28.67"></a><span id="l28.67"> </span>
<a href="#l28.68"></a><span id="l28.68">   nsCOMPtr&lt;nsIMsgDatabase&gt; hdrDB;</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-  EntryInfo.folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(hdrDB));</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineplus">+  EntryInfo.folder-&gt;GetMsgDatabase(getter_AddRefs(hdrDB));</span>
<a href="#l28.71"></a><span id="l28.71">   switch (fieldType)</span>
<a href="#l28.72"></a><span id="l28.72">   {</span>
<a href="#l28.73"></a><span id="l28.73">     case kCollationKey:</span>
<a href="#l28.74"></a><span id="l28.74">       PR_FREEIF(EntryInfo.key);</span>
<a href="#l28.75"></a><span id="l28.75">       rv = GetCollationKey(msgHdr, m_sortType, &amp;EntryInfo.key, &amp;EntryInfo.dword, colHandler);</span>
<a href="#l28.76"></a><span id="l28.76">       NS_ASSERTION(NS_SUCCEEDED(rv),&quot;failed to create collation key&quot;);</span>
<a href="#l28.77"></a><span id="l28.77">       break;</span>
<a href="#l28.78"></a><span id="l28.78">     case kU32:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -231,17 +231,17 @@ nsFolderCompactState::Compact(nsIMsgFold</span>
<a href="#l29.4"></a><span id="l29.4">            return CompactNextFolder();</span>
<a href="#l29.5"></a><span id="l29.5">          else</span>
<a href="#l29.6"></a><span id="l29.6">            return NS_OK;</span>
<a href="#l29.7"></a><span id="l29.7">        }</span>
<a href="#l29.8"></a><span id="l29.8">      }</span>
<a href="#l29.9"></a><span id="l29.9">    }</span>
<a href="#l29.10"></a><span id="l29.10">    else</span>
<a href="#l29.11"></a><span id="l29.11">    {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-     rv=folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+     rv = folder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l29.14"></a><span id="l29.14">      NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.15"></a><span id="l29.15">    }</span>
<a href="#l29.16"></a><span id="l29.16">    rv = folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l29.17"></a><span id="l29.17">    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19">    rv = folder-&gt;GetBaseMessageURI(baseMessageURI);</span>
<a href="#l29.20"></a><span id="l29.20">    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l29.21"></a><span id="l29.21">     </span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -712,17 +712,17 @@ nsFolderCompactState::OnDataAvailable(ns</span>
<a href="#l29.23"></a><span id="l29.23">           m_fileStream-&gt;Write(statusLine, strlen(statusLine), &amp;bytesWritten);</span>
<a href="#l29.24"></a><span id="l29.24">           m_addedHeaderSize += bytesWritten;</span>
<a href="#l29.25"></a><span id="l29.25">         }</span>
<a href="#l29.26"></a><span id="l29.26">         else</span>
<a href="#l29.27"></a><span id="l29.27">         {</span>
<a href="#l29.28"></a><span id="l29.28">           NS_ASSERTION(PR_FALSE, &quot;not an envelope&quot;);</span>
<a href="#l29.29"></a><span id="l29.29">           // try to mark the db as invalid so it will be reparsed.</span>
<a href="#l29.30"></a><span id="l29.30">           nsCOMPtr &lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-          m_folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(srcDB));</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+          m_folder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l29.33"></a><span id="l29.33">           if (srcDB)</span>
<a href="#l29.34"></a><span id="l29.34">           {</span>
<a href="#l29.35"></a><span id="l29.35">             srcDB-&gt;SetSummaryValid(PR_FALSE);</span>
<a href="#l29.36"></a><span id="l29.36">             srcDB-&gt;ForceClosed();</span>
<a href="#l29.37"></a><span id="l29.37">           }</span>
<a href="#l29.38"></a><span id="l29.38">         }</span>
<a href="#l29.39"></a><span id="l29.39">       }</span>
<a href="#l29.40"></a><span id="l29.40"> #define EXTRA_KEYWORD_HDR &quot;                                                                                 &quot;MSG_LINEBREAK</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgSearchDBView.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -336,18 +336,17 @@ nsresult nsMsgSearchDBView::GetMsgHdrFor</span>
<a href="#l30.4"></a><span id="l30.4"> {</span>
<a href="#l30.5"></a><span id="l30.5">   nsresult rv = NS_MSG_INVALID_DBVIEW_INDEX;</span>
<a href="#l30.6"></a><span id="l30.6">   if (index == nsMsgViewIndex_None || index &gt; (PRUint32) m_folders.Count())</span>
<a href="#l30.7"></a><span id="l30.7">     return rv;</span>
<a href="#l30.8"></a><span id="l30.8">   nsIMsgFolder *folder = m_folders[index];</span>
<a href="#l30.9"></a><span id="l30.9">   if (folder)</span>
<a href="#l30.10"></a><span id="l30.10">   {</span>
<a href="#l30.11"></a><span id="l30.11">     nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow(do_QueryReferent(mMsgWindowWeak));</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-    rv = folder-&gt;GetMsgDatabase(msgWindow, getter_AddRefs(db));</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+    rv = folder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l30.15"></a><span id="l30.15">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.16"></a><span id="l30.16">     if (db)</span>
<a href="#l30.17"></a><span id="l30.17">       rv = db-&gt;GetMsgHdrForKey(m_keys[index], msgHdr);</span>
<a href="#l30.18"></a><span id="l30.18">   }</span>
<a href="#l30.19"></a><span id="l30.19">   return rv;</span>
<a href="#l30.20"></a><span id="l30.20"> }</span>
<a href="#l30.21"></a><span id="l30.21"> </span>
<a href="#l30.22"></a><span id="l30.22"> NS_IMETHODIMP nsMsgSearchDBView::GetFolderForViewIndex(nsMsgViewIndex index, nsIMsgFolder **aFolder)</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineat">@@ -359,17 +358,17 @@ NS_IMETHODIMP nsMsgSearchDBView::GetFold</span>
<a href="#l30.24"></a><span id="l30.24">   return NS_OK;</span>
<a href="#l30.25"></a><span id="l30.25"> }</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27"> nsresult nsMsgSearchDBView::GetDBForViewIndex(nsMsgViewIndex index, nsIMsgDatabase **db)</span>
<a href="#l30.28"></a><span id="l30.28"> {</span>
<a href="#l30.29"></a><span id="l30.29">   nsCOMPtr &lt;nsIMsgFolder&gt; aFolder;</span>
<a href="#l30.30"></a><span id="l30.30">   nsresult rv = GetFolderForViewIndex(index, getter_AddRefs(aFolder));</span>
<a href="#l30.31"></a><span id="l30.31">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineminus">-  return aFolder-&gt;GetMsgDatabase(nsnull, db);</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+  return aFolder-&gt;GetMsgDatabase(db);</span>
<a href="#l30.34"></a><span id="l30.34"> }</span>
<a href="#l30.35"></a><span id="l30.35"> </span>
<a href="#l30.36"></a><span id="l30.36"> nsresult nsMsgSearchDBView::AddHdrFromFolder(nsIMsgDBHdr *msgHdr, nsIMsgFolder *folder)</span>
<a href="#l30.37"></a><span id="l30.37"> {</span>
<a href="#l30.38"></a><span id="l30.38">   if (m_viewFlags &amp; nsMsgViewFlagsType::kGroupBySort)</span>
<a href="#l30.39"></a><span id="l30.39">     return nsMsgGroupView::OnNewHeader(msgHdr, nsMsgKey_None, PR_TRUE);</span>
<a href="#l30.40"></a><span id="l30.40">   nsMsgKey msgKey;</span>
<a href="#l30.41"></a><span id="l30.41">   PRUint32 msgFlags;</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineat">@@ -1240,17 +1239,17 @@ nsresult nsMsgSearchDBView::GetThreadCon</span>
<a href="#l30.43"></a><span id="l30.43">   else if (m_viewFlags &amp; nsMsgViewFlagsType::kThreadedDisplay)</span>
<a href="#l30.44"></a><span id="l30.44">     return GetXFThreadFromMsgHdr(msgHdr, pThread);</span>
<a href="#l30.45"></a><span id="l30.45"> </span>
<a href="#l30.46"></a><span id="l30.46">   // if not threaded, use the real thread. </span>
<a href="#l30.47"></a><span id="l30.47">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l30.48"></a><span id="l30.48">   nsresult rv = msgHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l30.49"></a><span id="l30.49">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.50"></a><span id="l30.50">   nsCOMPtr&lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-  rv = folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(msgDB));</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineplus">+  rv = folder-&gt;GetMsgDatabase(getter_AddRefs(msgDB));</span>
<a href="#l30.53"></a><span id="l30.53">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l30.54"></a><span id="l30.54">   return msgDB-&gt;GetThreadContainingMsgHdr(msgHdr, pThread);</span>
<a href="#l30.55"></a><span id="l30.55"> }</span>
<a href="#l30.56"></a><span id="l30.56"> </span>
<a href="#l30.57"></a><span id="l30.57"> nsresult </span>
<a href="#l30.58"></a><span id="l30.58"> nsMsgSearchDBView::ListIdsInThread(nsIMsgThread *threadHdr, </span>
<a href="#l30.59"></a><span id="l30.59">                                    nsMsgViewIndex startOfThreadViewIndex, </span>
<a href="#l30.60"></a><span id="l30.60">                                    PRUint32 *pNumListed)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFViewThread.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -293,17 +293,17 @@ nsresult nsMsgXFViewThread::AddHdr(nsIMs</span>
<a href="#l31.4"></a><span id="l31.4">   return NS_OK;</span>
<a href="#l31.5"></a><span id="l31.5"> }</span>
<a href="#l31.6"></a><span id="l31.6"> </span>
<a href="#l31.7"></a><span id="l31.7"> NS_IMETHODIMP nsMsgXFViewThread::GetChildAt(PRInt32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l31.8"></a><span id="l31.8"> {</span>
<a href="#l31.9"></a><span id="l31.9">   if (aIndex &gt;= (PRInt32) m_keys.Length())</span>
<a href="#l31.10"></a><span id="l31.10">     return NS_MSG_MESSAGE_NOT_FOUND;</span>
<a href="#l31.11"></a><span id="l31.11">   nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  nsresult rv = m_folders[aIndex]-&gt;GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+  nsresult rv = m_folders[aIndex]-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l31.14"></a><span id="l31.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l31.15"></a><span id="l31.15">   return db-&gt;GetMsgHdrForKey(m_keys[aIndex], aResult);</span>
<a href="#l31.16"></a><span id="l31.16"> }</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18"> NS_IMETHODIMP nsMsgXFViewThread::GetChildHdrAt(PRInt32 aIndex, nsIMsgDBHdr **aResult)</span>
<a href="#l31.19"></a><span id="l31.19"> {</span>
<a href="#l31.20"></a><span id="l31.20">   return GetChildAt(aIndex, aResult);</span>
<a href="#l31.21"></a><span id="l31.21"> }</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -487,17 +487,17 @@ NS_IMETHODIMP nsMsgXFViewThread::GetFirs</span>
<a href="#l31.23"></a><span id="l31.23">     rv = GetChildHdrAt(childIndex, getter_AddRefs(child));</span>
<a href="#l31.24"></a><span id="l31.24">     if (NS_SUCCEEDED(rv) &amp;&amp; child)</span>
<a href="#l31.25"></a><span id="l31.25">     {</span>
<a href="#l31.26"></a><span id="l31.26">       nsMsgKey msgKey;</span>
<a href="#l31.27"></a><span id="l31.27">       child-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l31.28"></a><span id="l31.28">       </span>
<a href="#l31.29"></a><span id="l31.29">       PRBool isRead;</span>
<a href="#l31.30"></a><span id="l31.30">       nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-      nsresult rv = m_folders[childIndex]-&gt;GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+      nsresult rv = m_folders[childIndex]-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l31.33"></a><span id="l31.33">       if (NS_SUCCEEDED(rv))</span>
<a href="#l31.34"></a><span id="l31.34">         rv = db-&gt;IsRead(msgKey, &amp;isRead);</span>
<a href="#l31.35"></a><span id="l31.35">       if (NS_SUCCEEDED(rv) &amp;&amp; !isRead)</span>
<a href="#l31.36"></a><span id="l31.36">       {</span>
<a href="#l31.37"></a><span id="l31.37">         NS_ADDREF(*aResult = child);</span>
<a href="#l31.38"></a><span id="l31.38">         break;</span>
<a href="#l31.39"></a><span id="l31.39">       }</span>
<a href="#l31.40"></a><span id="l31.40">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgXFVirtualFolderDBView.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -215,17 +215,17 @@ nsresult nsMsgXFVirtualFolderDBView::Ins</span>
<a href="#l32.4"></a><span id="l32.4">   // as NoteChange() will call RowCountChanged() which will call our GetRowCount()</span>
<a href="#l32.5"></a><span id="l32.5">   NoteChange(insertIndex, 1, nsMsgViewNotificationCode::insertOrDelete);</span>
<a href="#l32.6"></a><span id="l32.6">   return NS_OK;</span>
<a href="#l32.7"></a><span id="l32.7"> }</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9"> void nsMsgXFVirtualFolderDBView::UpdateCacheAndViewForFolder(nsIMsgFolder *folder, nsMsgKey *newHits, PRUint32 numNewHits)</span>
<a href="#l32.10"></a><span id="l32.10"> {</span>
<a href="#l32.11"></a><span id="l32.11">   nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  nsresult rv = folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  nsresult rv = folder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l32.14"></a><span id="l32.14">   if (NS_SUCCEEDED(rv) &amp;&amp; db)</span>
<a href="#l32.15"></a><span id="l32.15">   {</span>
<a href="#l32.16"></a><span id="l32.16">     nsCString searchUri;</span>
<a href="#l32.17"></a><span id="l32.17">     m_viewFolder-&gt;GetURI(searchUri);</span>
<a href="#l32.18"></a><span id="l32.18">     PRUint32 numBadHits;</span>
<a href="#l32.19"></a><span id="l32.19">     nsMsgKey *badHits;</span>
<a href="#l32.20"></a><span id="l32.20">     rv = db-&gt;RefreshCache(searchUri.get(), numNewHits, newHits,</span>
<a href="#l32.21"></a><span id="l32.21">                      &amp;numBadHits, &amp;badHits);</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -415,17 +415,17 @@ nsMsgXFVirtualFolderDBView::OnNewSearch(</span>
<a href="#l32.23"></a><span id="l32.23">     nsCOMPtr&lt;nsIMsgFolder&gt; searchFolder;</span>
<a href="#l32.24"></a><span id="l32.24">     searchSession-&gt;GetNthSearchScope(i, &amp;scopeId, getter_AddRefs(searchFolder));</span>
<a href="#l32.25"></a><span id="l32.25">     if (searchFolder)</span>
<a href="#l32.26"></a><span id="l32.26">     {</span>
<a href="#l32.27"></a><span id="l32.27">       nsCOMPtr&lt;nsISimpleEnumerator&gt; cachedHits;</span>
<a href="#l32.28"></a><span id="l32.28">       nsCOMPtr&lt;nsIMsgDatabase&gt; searchDB;</span>
<a href="#l32.29"></a><span id="l32.29">       nsCString searchUri;</span>
<a href="#l32.30"></a><span id="l32.30">       m_viewFolder-&gt;GetURI(searchUri);</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-      nsresult rv = searchFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(searchDB));</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+      nsresult rv = searchFolder-&gt;GetMsgDatabase(getter_AddRefs(searchDB));</span>
<a href="#l32.33"></a><span id="l32.33">       if (NS_SUCCEEDED(rv) &amp;&amp; searchDB)</span>
<a href="#l32.34"></a><span id="l32.34">       {</span>
<a href="#l32.35"></a><span id="l32.35">         if (msgDBService)</span>
<a href="#l32.36"></a><span id="l32.36">           msgDBService-&gt;RegisterPendingListener(searchFolder, this);</span>
<a href="#l32.37"></a><span id="l32.37"> </span>
<a href="#l32.38"></a><span id="l32.38">         m_foldersSearchingOver.AppendObject(searchFolder);</span>
<a href="#l32.39"></a><span id="l32.39">         searchDB-&gt;GetCachedHits(searchUri.get(), getter_AddRefs(cachedHits));</span>
<a href="#l32.40"></a><span id="l32.40">         PRBool hasMore;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug428427.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug428427.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -153,17 +153,17 @@ var searchListener =</span>
<a href="#l33.4"></a><span id="l33.4">     //print(&quot;Search hit, isRead is &quot; + dbHdr.isRead);</span>
<a href="#l33.5"></a><span id="l33.5">     numTotalMessages++;</span>
<a href="#l33.6"></a><span id="l33.6">     if (!dbHdr.isRead)</span>
<a href="#l33.7"></a><span id="l33.7">       numUnreadMessages++;</span>
<a href="#l33.8"></a><span id="l33.8">   },</span>
<a href="#l33.9"></a><span id="l33.9">   onSearchDone: function(status)</span>
<a href="#l33.10"></a><span id="l33.10">   { </span>
<a href="#l33.11"></a><span id="l33.11">     print(&quot;Finished search hitCount = &quot; + numTotalMessages);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    var db = virtualFolder.getMsgDatabase(null);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    var db = virtualFolder.msgDatabase;</span>
<a href="#l33.14"></a><span id="l33.14">     var dbFolderInfo = db.dBFolderInfo;</span>
<a href="#l33.15"></a><span id="l33.15">     dbFolderInfo.numMessages = numTotalMessages;</span>
<a href="#l33.16"></a><span id="l33.16">     dbFolderInfo.numUnreadMessages = numUnreadMessages;</span>
<a href="#l33.17"></a><span id="l33.17">     virtualFolder.updateSummaryTotals(true);</span>
<a href="#l33.18"></a><span id="l33.18">     print(&quot;virtual folder unread is &quot; + virtualFolder.getNumUnread(false));</span>
<a href="#l33.19"></a><span id="l33.19">     testVirtualFolder();</span>
<a href="#l33.20"></a><span id="l33.20">   }</span>
<a href="#l33.21"></a><span id="l33.21"> };</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -201,17 +201,17 @@ function testVirtualFolder()</span>
<a href="#l33.23"></a><span id="l33.23"> </span>
<a href="#l33.24"></a><span id="l33.24"> // helper functions</span>
<a href="#l33.25"></a><span id="l33.25"> </span>
<a href="#l33.26"></a><span id="l33.26"> // adapted from commandglue.js</span>
<a href="#l33.27"></a><span id="l33.27"> function CreateVirtualFolder(newName, parentFolder, searchFolderURIs, searchTerm, searchOnline)</span>
<a href="#l33.28"></a><span id="l33.28"> {</span>
<a href="#l33.29"></a><span id="l33.29">   var newFolder = parentFolder.addSubfolder(newName);</span>
<a href="#l33.30"></a><span id="l33.30">   newFolder.setFlag(Ci.nsMsgFolderFlags.Virtual);</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-  var vfdb = newFolder.getMsgDatabase(null);</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+  var vfdb = newFolder.msgDatabase;</span>
<a href="#l33.33"></a><span id="l33.33">   var searchTerms = [];</span>
<a href="#l33.34"></a><span id="l33.34">   var searchTermString = getSearchTermString(searchTerm);</span>
<a href="#l33.35"></a><span id="l33.35">   </span>
<a href="#l33.36"></a><span id="l33.36">   var dbFolderInfo = vfdb.dBFolderInfo;</span>
<a href="#l33.37"></a><span id="l33.37">   // set the view string as a property of the db folder info</span>
<a href="#l33.38"></a><span id="l33.38">   // set the original folder name as well.</span>
<a href="#l33.39"></a><span id="l33.39">   dbFolderInfo.setCharProperty(&quot;searchStr&quot;, searchTermString);</span>
<a href="#l33.40"></a><span id="l33.40">   dbFolderInfo.setCharProperty(&quot;searchFolderUri&quot;, searchFolderURIs);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -88,17 +88,17 @@ function deleteMessages(srcFolder, items</span>
<a href="#l34.4"></a><span id="l34.4">     array.appendElement(item, false);</span>
<a href="#l34.5"></a><span id="l34.5">   });</span>
<a href="#l34.6"></a><span id="l34.6">   </span>
<a href="#l34.7"></a><span id="l34.7">   srcFolder.deleteMessages(array, null, false, true, copyListener, true);</span>
<a href="#l34.8"></a><span id="l34.8"> }</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10"> function calculateFolderSize(folder)</span>
<a href="#l34.11"></a><span id="l34.11"> {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  let msgDB = folder.getMsgDatabase(null);</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  let msgDB = folder.msgDatabase;</span>
<a href="#l34.14"></a><span id="l34.14">   let enumerator = msgDB.EnumerateMessages();</span>
<a href="#l34.15"></a><span id="l34.15">   let totalSize = 0;</span>
<a href="#l34.16"></a><span id="l34.16">   if (enumerator)</span>
<a href="#l34.17"></a><span id="l34.17">   {</span>
<a href="#l34.18"></a><span id="l34.18">     while (enumerator.hasMoreElements())</span>
<a href="#l34.19"></a><span id="l34.19">     {</span>
<a href="#l34.20"></a><span id="l34.20">       var header = enumerator.getNext();</span>
<a href="#l34.21"></a><span id="l34.21">       if (header instanceof Components.interfaces.nsIMsgDBHdr)</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -123,17 +123,17 @@ const gTestArray =</span>
<a href="#l34.23"></a><span id="l34.23">   // Moving/copying messages</span>
<a href="#l34.24"></a><span id="l34.24">   function testCopyMessages1() { copyMessages([gMsgHdrs[0].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l34.25"></a><span id="l34.25">   function testCopyMessages2() { copyMessages([gMsgHdrs[1].hdr, gMsgHdrs[2].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l34.26"></a><span id="l34.26">   function testMoveMessages1() { copyMessages([gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], true, gLocalInboxFolder, gLocalFolder3); },</span>
<a href="#l34.27"></a><span id="l34.27"> </span>
<a href="#l34.28"></a><span id="l34.28">   // Deleting messages</span>
<a href="#l34.29"></a><span id="l34.29">   function testDeleteMessages1() { // delete to trash</span>
<a href="#l34.30"></a><span id="l34.30">     // Let's take a moment to re-initialize stuff that got moved</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-    var folder3DB = gLocalFolder3.getMsgDatabase(null);</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+    var folder3DB = gLocalFolder3.msgDatabase;</span>
<a href="#l34.33"></a><span id="l34.33">     gMsgHdrs[0].hdr = folder3DB.getMsgHdrForMessageID(gMsgHdrs[0].ID);</span>
<a href="#l34.34"></a><span id="l34.34"> </span>
<a href="#l34.35"></a><span id="l34.35">     // Now delete the message</span>
<a href="#l34.36"></a><span id="l34.36">     deleteMessages(gLocalFolder3, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l34.37"></a><span id="l34.37">   },</span>
<a href="#l34.38"></a><span id="l34.38">   function compactFolder()</span>
<a href="#l34.39"></a><span id="l34.39">   {</span>
<a href="#l34.40"></a><span id="l34.40">     gExpectedFolderSize = calculateFolderSize(gLocalFolder3);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -152,41 +152,42 @@ const gTestArray =</span>
<a href="#l35.4"></a><span id="l35.4"> </span>
<a href="#l35.5"></a><span id="l35.5">   // Moving/copying messages</span>
<a href="#l35.6"></a><span id="l35.6">   function testCopyMessages1() { copyMessages([gMsgHdrs[0].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l35.7"></a><span id="l35.7">   function testCopyMessages2() { copyMessages([gMsgHdrs[1].hdr, gMsgHdrs[2].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l35.8"></a><span id="l35.8">   function testMoveMessages1() { copyMessages([gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], true, gLocalInboxFolder, gLocalFolder3); },</span>
<a href="#l35.9"></a><span id="l35.9">   function testMoveMessages2() { copyMessages([gMsgHdrs[2].hdr], true, gLocalInboxFolder, gLocalTrashFolder); },</span>
<a href="#l35.10"></a><span id="l35.10">   function testMoveMessages3() {</span>
<a href="#l35.11"></a><span id="l35.11">     // This is to test whether the notification is correct for moving from trash</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    gMsgHdrs[2].hdr = gLocalTrashFolder.getMsgDatabase(null).getMsgHdrForMessageID(gMsgHdrs[2].ID);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+    gMsgHdrs[2].hdr = gLocalTrashFolder.msgDatabase</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+                                       .getMsgHdrForMessageID(gMsgHdrs[2].ID);</span>
<a href="#l35.15"></a><span id="l35.15">     copyMessages([gMsgHdrs[2].hdr], true, gLocalTrashFolder, gLocalFolder3);</span>
<a href="#l35.16"></a><span id="l35.16">   },</span>
<a href="#l35.17"></a><span id="l35.17"> </span>
<a href="#l35.18"></a><span id="l35.18">   // Moving/copying folders</span>
<a href="#l35.19"></a><span id="l35.19">   function testCopyFolder1() { copyFolders([gLocalFolder3], false, gLocalFolder2); },</span>
<a href="#l35.20"></a><span id="l35.20">   function testMoveFolder1() { copyFolders([gLocalFolder3], true, gLocalInboxFolder); },</span>
<a href="#l35.21"></a><span id="l35.21">   function testMoveFolder2() { copyFolders([gLocalFolder2], true, gLocalInboxFolder); },</span>
<a href="#l35.22"></a><span id="l35.22"> </span>
<a href="#l35.23"></a><span id="l35.23">   // Deleting messages</span>
<a href="#l35.24"></a><span id="l35.24">   function testDeleteMessages1() { // delete to trash</span>
<a href="#l35.25"></a><span id="l35.25">     // Let's take a moment to re-initialize stuff that got moved</span>
<a href="#l35.26"></a><span id="l35.26">     gLocalFolder2 = gLocalInboxFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l35.27"></a><span id="l35.27">     gLocalFolder3 = gLocalFolder2.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineminus">-    var folder3DB = gLocalFolder3.getMsgDatabase(null);</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineplus">+    var folder3DB = gLocalFolder3.msgDatabase;</span>
<a href="#l35.30"></a><span id="l35.30">     for (var i = 0; i &lt; gMsgHdrs.length; i++)</span>
<a href="#l35.31"></a><span id="l35.31">       gMsgHdrs[i].hdr = folder3DB.getMsgHdrForMessageID(gMsgHdrs[i].ID);</span>
<a href="#l35.32"></a><span id="l35.32"> </span>
<a href="#l35.33"></a><span id="l35.33">     // Now delete the message</span>
<a href="#l35.34"></a><span id="l35.34">     deleteMessages(gLocalFolder3, [gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], false, false);</span>
<a href="#l35.35"></a><span id="l35.35">   },</span>
<a href="#l35.36"></a><span id="l35.36">   // shift delete</span>
<a href="#l35.37"></a><span id="l35.37">   function testDeleteMessages2() { deleteMessages(gLocalFolder3, [gMsgHdrs[2].hdr], true, false); },</span>
<a href="#l35.38"></a><span id="l35.38">   function testDeleteMessages3() { // normal delete from trash</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineminus">-    var trashDB = gLocalTrashFolder.getMsgDatabase(null);</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+    var trashDB = gLocalTrashFolder.msgDatabase;</span>
<a href="#l35.41"></a><span id="l35.41">     for (var i = 0; i &lt; gMsgHdrs.length; i++)</span>
<a href="#l35.42"></a><span id="l35.42">       gMsgHdrs[i].hdr = trashDB.getMsgHdrForMessageID(gMsgHdrs[i].ID);</span>
<a href="#l35.43"></a><span id="l35.43">     deleteMessages(gLocalTrashFolder, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l35.44"></a><span id="l35.44">   },</span>
<a href="#l35.45"></a><span id="l35.45">   // shift delete from trash</span>
<a href="#l35.46"></a><span id="l35.46">   function testDeleteMessages4() { deleteMessages(gLocalTrashFolder, [gMsgHdrs[1].hdr], true, false); },</span>
<a href="#l35.47"></a><span id="l35.47"> </span>
<a href="#l35.48"></a><span id="l35.48">   // Renaming folders</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -876,18 +876,17 @@ nsresult nsMsgDBFolder::CreateFileForDB(</span>
<a href="#l36.4"></a><span id="l36.4">   proposedDBName.SetLength(proposedDBName.Length() - NS_LITERAL_CSTRING(SUMMARY_SUFFIX).Length());</span>
<a href="#l36.5"></a><span id="l36.5">   dbPath-&gt;SetNativeLeafName(proposedDBName);</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7">   dbPath.swap(*dbFile);</span>
<a href="#l36.8"></a><span id="l36.8">   return NS_OK;</span>
<a href="#l36.9"></a><span id="l36.9"> }</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11"> NS_IMETHODIMP</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-nsMsgDBFolder::GetMsgDatabase(nsIMsgWindow *aMsgWindow,</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-                              nsIMsgDatabase** aMsgDatabase)</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineplus">+nsMsgDBFolder::GetMsgDatabase(nsIMsgDatabase** aMsgDatabase)</span>
<a href="#l36.15"></a><span id="l36.15"> {</span>
<a href="#l36.16"></a><span id="l36.16">   NS_ENSURE_ARG_POINTER(aMsgDatabase);</span>
<a href="#l36.17"></a><span id="l36.17">   GetDatabase();</span>
<a href="#l36.18"></a><span id="l36.18">   if (!mDatabase)</span>
<a href="#l36.19"></a><span id="l36.19">     return NS_ERROR_FAILURE;</span>
<a href="#l36.20"></a><span id="l36.20">   NS_ADDREF(*aMsgDatabase = mDatabase);</span>
<a href="#l36.21"></a><span id="l36.21">   return NS_OK;</span>
<a href="#l36.22"></a><span id="l36.22"> }</span>
<a href="#l36.23"></a><span id="l36.23" class="difflineat">@@ -1879,17 +1878,17 @@ nsMsgDBFolder::GetDBTransferInfo(nsIDBFo</span>
<a href="#l36.24"></a><span id="l36.24"> }</span>
<a href="#l36.25"></a><span id="l36.25"> </span>
<a href="#l36.26"></a><span id="l36.26"> NS_IMETHODIMP</span>
<a href="#l36.27"></a><span id="l36.27"> nsMsgDBFolder::SetDBTransferInfo(nsIDBFolderInfo *aTransferInfo)</span>
<a href="#l36.28"></a><span id="l36.28"> {</span>
<a href="#l36.29"></a><span id="l36.29">   NS_ENSURE_ARG(aTransferInfo);</span>
<a href="#l36.30"></a><span id="l36.30">   nsCOMPtr &lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l36.31"></a><span id="l36.31">   nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">-  GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineplus">+  GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l36.34"></a><span id="l36.34">   if (db)</span>
<a href="#l36.35"></a><span id="l36.35">   {</span>
<a href="#l36.36"></a><span id="l36.36">     db-&gt;GetDBFolderInfo(getter_AddRefs(dbFolderInfo));</span>
<a href="#l36.37"></a><span id="l36.37">     if(dbFolderInfo)</span>
<a href="#l36.38"></a><span id="l36.38">       dbFolderInfo-&gt;InitFromTransferInfo(aTransferInfo);</span>
<a href="#l36.39"></a><span id="l36.39">     db-&gt;SetSummaryValid(PR_TRUE);</span>
<a href="#l36.40"></a><span id="l36.40">   }</span>
<a href="#l36.41"></a><span id="l36.41">   return NS_OK;</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineat">@@ -2484,17 +2483,17 @@ NS_IMETHODIMP nsMsgDBFolder::GetParentMs</span>
<a href="#l36.43"></a><span id="l36.43"> {</span>
<a href="#l36.44"></a><span id="l36.44">   NS_ENSURE_ARG_POINTER(aParentMsgFolder);</span>
<a href="#l36.45"></a><span id="l36.45">   nsCOMPtr&lt;nsIMsgFolder&gt; parent = do_QueryReferent(mParent);</span>
<a href="#l36.46"></a><span id="l36.46">   parent.swap(*aParentMsgFolder);</span>
<a href="#l36.47"></a><span id="l36.47">   return NS_OK;</span>
<a href="#l36.48"></a><span id="l36.48"> }</span>
<a href="#l36.49"></a><span id="l36.49"> </span>
<a href="#l36.50"></a><span id="l36.50"> NS_IMETHODIMP</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineminus">-nsMsgDBFolder::GetMessages(nsIMsgWindow *aMsgWindow, nsISimpleEnumerator* *result)</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineplus">+nsMsgDBFolder::GetMessages(nsISimpleEnumerator **result)</span>
<a href="#l36.53"></a><span id="l36.53"> {</span>
<a href="#l36.54"></a><span id="l36.54">   // XXX should this return an empty enumeration?</span>
<a href="#l36.55"></a><span id="l36.55">   return NS_ERROR_FAILURE;</span>
<a href="#l36.56"></a><span id="l36.56"> }</span>
<a href="#l36.57"></a><span id="l36.57"> </span>
<a href="#l36.58"></a><span id="l36.58"> NS_IMETHODIMP</span>
<a href="#l36.59"></a><span id="l36.59"> nsMsgDBFolder::UpdateFolder(nsIMsgWindow *)</span>
<a href="#l36.60"></a><span id="l36.60"> {</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineat">@@ -4543,17 +4542,17 @@ NS_IMETHODIMP nsMsgDBFolder::EnableNotif</span>
<a href="#l36.62"></a><span id="l36.62">   {</span>
<a href="#l36.63"></a><span id="l36.63">     mNotifyCountChanges = enable;</span>
<a href="#l36.64"></a><span id="l36.64">     // start and stop db batching here. This is under the theory</span>
<a href="#l36.65"></a><span id="l36.65">     // that any time we want to enable and disable notifications,</span>
<a href="#l36.66"></a><span id="l36.66">     // we're probably doing something that should be batched.</span>
<a href="#l36.67"></a><span id="l36.67">     nsCOMPtr &lt;nsIMsgDatabase&gt; database;</span>
<a href="#l36.68"></a><span id="l36.68"> </span>
<a href="#l36.69"></a><span id="l36.69">     if (dbBatching)  //only if we do dbBatching we need to get db</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineminus">-      GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l36.71"></a><span id="l36.71" class="difflineplus">+      GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l36.72"></a><span id="l36.72"> </span>
<a href="#l36.73"></a><span id="l36.73">     if (enable)</span>
<a href="#l36.74"></a><span id="l36.74">     {</span>
<a href="#l36.75"></a><span id="l36.75">       if (database)</span>
<a href="#l36.76"></a><span id="l36.76">         database-&gt;EndBatch();</span>
<a href="#l36.77"></a><span id="l36.77">       UpdateSummaryTotals(PR_TRUE);</span>
<a href="#l36.78"></a><span id="l36.78">     }</span>
<a href="#l36.79"></a><span id="l36.79">     else if (database)</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineat">@@ -4562,17 +4561,17 @@ NS_IMETHODIMP nsMsgDBFolder::EnableNotif</span>
<a href="#l36.81"></a><span id="l36.81">   }</span>
<a href="#l36.82"></a><span id="l36.82">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l36.83"></a><span id="l36.83"> }</span>
<a href="#l36.84"></a><span id="l36.84"> </span>
<a href="#l36.85"></a><span id="l36.85"> NS_IMETHODIMP nsMsgDBFolder::GetMessageHeader(nsMsgKey msgKey, nsIMsgDBHdr **aMsgHdr)</span>
<a href="#l36.86"></a><span id="l36.86"> {</span>
<a href="#l36.87"></a><span id="l36.87">   NS_ENSURE_ARG_POINTER(aMsgHdr);</span>
<a href="#l36.88"></a><span id="l36.88">   nsCOMPtr &lt;nsIMsgDatabase&gt; database;</span>
<a href="#l36.89"></a><span id="l36.89" class="difflineminus">-  nsresult rv = GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l36.90"></a><span id="l36.90" class="difflineplus">+  nsresult rv = GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l36.91"></a><span id="l36.91">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l36.92"></a><span id="l36.92">   return (database) ? database-&gt;GetMsgHdrForKey(msgKey, aMsgHdr) : NS_ERROR_FAILURE;</span>
<a href="#l36.93"></a><span id="l36.93"> }</span>
<a href="#l36.94"></a><span id="l36.94"> </span>
<a href="#l36.95"></a><span id="l36.95"> // this gets the deep sub-folders too, e.g., the children of the children</span>
<a href="#l36.96"></a><span id="l36.96"> NS_IMETHODIMP nsMsgDBFolder::ListDescendents(nsISupportsArray *descendents)</span>
<a href="#l36.97"></a><span id="l36.97"> {</span>
<a href="#l36.98"></a><span id="l36.98">   NS_ENSURE_ARG(descendents);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/base/util/nsMsgTxn.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgTxn.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -316,17 +316,17 @@ nsMsgTxn::SetTransactionType(PRUint32 tx</span>
<a href="#l37.4"></a><span id="l37.4"> /*none of the callers pass null aFolder, </span>
<a href="#l37.5"></a><span id="l37.5">   we always initialize aResult (before we pass in) for the case where the key is not in the db*/</span>
<a href="#l37.6"></a><span id="l37.6"> nsresult </span>
<a href="#l37.7"></a><span id="l37.7"> nsMsgTxn::CheckForToggleDelete(nsIMsgFolder *aFolder, const nsMsgKey &amp;aMsgKey, PRBool *aResult)</span>
<a href="#l37.8"></a><span id="l37.8"> {</span>
<a href="#l37.9"></a><span id="l37.9">   NS_ENSURE_ARG(aResult);</span>
<a href="#l37.10"></a><span id="l37.10">   nsCOMPtr&lt;nsIMsgDBHdr&gt; message;</span>
<a href="#l37.11"></a><span id="l37.11">   nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-  nsresult rv = aFolder-&gt;GetMsgDatabase(nsnull,getter_AddRefs(db));</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+  nsresult rv = aFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l37.14"></a><span id="l37.14">   if (db)</span>
<a href="#l37.15"></a><span id="l37.15">   {</span>
<a href="#l37.16"></a><span id="l37.16">     PRBool containsKey;</span>
<a href="#l37.17"></a><span id="l37.17">     rv = db-&gt;ContainsKey(aMsgKey, &amp;containsKey);</span>
<a href="#l37.18"></a><span id="l37.18">     if (NS_FAILED(rv) || !containsKey)   // the message has been deleted from db, so we cannot do toggle here</span>
<a href="#l37.19"></a><span id="l37.19">       return NS_OK;</span>
<a href="#l37.20"></a><span id="l37.20">     rv = db-&gt;GetMsgHdrForKey(aMsgKey, getter_AddRefs(message));</span>
<a href="#l37.21"></a><span id="l37.21">     PRUint32 flags;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1808,17 +1808,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l38.4"></a><span id="l38.4">         msgHdr-&gt;GetNumReferences(&amp;numRef);</span>
<a href="#l38.5"></a><span id="l38.5">         if (numRef) {</span>
<a href="#l38.6"></a><span id="l38.6">           // If there are references, look for the first message in the thread</span>
<a href="#l38.7"></a><span id="l38.7">           // firstly, get the database via the folder</span>
<a href="#l38.8"></a><span id="l38.8">           nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l38.9"></a><span id="l38.9">           msgHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l38.10"></a><span id="l38.10">           if (folder) {</span>
<a href="#l38.11"></a><span id="l38.11">             nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-            folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+            folder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15">             if (db) {</span>
<a href="#l38.16"></a><span id="l38.16">               nsCAutoString reference;</span>
<a href="#l38.17"></a><span id="l38.17">               msgHdr-&gt;GetStringReference(0, reference);</span>
<a href="#l38.18"></a><span id="l38.18"> </span>
<a href="#l38.19"></a><span id="l38.19">               nsCOMPtr&lt;nsIMsgDBHdr&gt; refHdr;</span>
<a href="#l38.20"></a><span id="l38.20">               db-&gt;GetMsgHdrForMessageID(reference.get(), getter_AddRefs(refHdr));</span>
<a href="#l38.21"></a><span id="l38.21"> </span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -3049,17 +3049,17 @@ NS_IMETHODIMP nsMsgCompose::RememberQueu</span>
<a href="#l38.23"></a><span id="l38.23">           nsCOMPtr &lt;nsIRDFResource&gt; resource;</span>
<a href="#l38.24"></a><span id="l38.24">           rv = rdfService-&gt;GetResource(m_folderName, getter_AddRefs(resource));</span>
<a href="#l38.25"></a><span id="l38.25">           NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l38.26"></a><span id="l38.26"> </span>
<a href="#l38.27"></a><span id="l38.27">           nsCOMPtr &lt;nsIMsgFolder&gt; msgFolder(do_QueryInterface(resource));</span>
<a href="#l38.28"></a><span id="l38.28">           if (msgFolder)</span>
<a href="#l38.29"></a><span id="l38.29">           {</span>
<a href="#l38.30"></a><span id="l38.30">             nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-            msgFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(msgDB));</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+            msgFolder-&gt;GetMsgDatabase(getter_AddRefs(msgDB));</span>
<a href="#l38.33"></a><span id="l38.33">             if (msgDB)</span>
<a href="#l38.34"></a><span id="l38.34">             {</span>
<a href="#l38.35"></a><span id="l38.35">               msgDB-&gt;CreateNewHdr(msgKey, getter_AddRefs(msgHdr));</span>
<a href="#l38.36"></a><span id="l38.36">               if (msgHdr)</span>
<a href="#l38.37"></a><span id="l38.37">               {</span>
<a href="#l38.38"></a><span id="l38.38">                 nsCString messageId;</span>
<a href="#l38.39"></a><span id="l38.39">                 mMsgSend-&gt;GetMessageId(messageId);</span>
<a href="#l38.40"></a><span id="l38.40">                 msgHdr-&gt;SetMessageId(messageId.get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1159,17 +1159,17 @@ NS_IMETHODIMP nsMsgComposeService::Reply</span>
<a href="#l39.4"></a><span id="l39.4">   nsCString templateMsgHdrUri;</span>
<a href="#l39.5"></a><span id="l39.5">   const char * query = PL_strstr(templateUri, &quot;?messageId=&quot;);</span>
<a href="#l39.6"></a><span id="l39.6">   if (!query)</span>
<a href="#l39.7"></a><span id="l39.7">     return NS_ERROR_FAILURE;</span>
<a href="#l39.8"></a><span id="l39.8"> </span>
<a href="#l39.9"></a><span id="l39.9">   nsCAutoString folderUri(Substring(templateUri, query)); </span>
<a href="#l39.10"></a><span id="l39.10">   nsresult rv = GetExistingFolder(folderUri, getter_AddRefs(templateFolder));</span>
<a href="#l39.11"></a><span id="l39.11">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  rv = templateFolder-&gt;GetMsgDatabase(aMsgWindow, getter_AddRefs(templateDB));</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+  rv = templateFolder-&gt;GetMsgDatabase(getter_AddRefs(templateDB));</span>
<a href="#l39.14"></a><span id="l39.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l39.15"></a><span id="l39.15"> </span>
<a href="#l39.16"></a><span id="l39.16">   const char *subject = PL_strstr(templateUri, &quot;&amp;subject=&quot;);</span>
<a href="#l39.17"></a><span id="l39.17">   if (subject)</span>
<a href="#l39.18"></a><span id="l39.18">   {</span>
<a href="#l39.19"></a><span id="l39.19">     const char *subjectEnd = subject + strlen(subject);</span>
<a href="#l39.20"></a><span id="l39.20">     nsCAutoString messageId(Substring(query + 11, subject));</span>
<a href="#l39.21"></a><span id="l39.21">     nsCAutoString subjectString(Substring(subject + 9, subjectEnd));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendLater.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -664,17 +664,17 @@ nsMsgSendLater::SendUnsentMessages(nsIMs</span>
<a href="#l40.4"></a><span id="l40.4">   nsresult rv = GetUnsentMessagesFolder(aIdentity,</span>
<a href="#l40.5"></a><span id="l40.5">                                         getter_AddRefs(mMessageFolder));</span>
<a href="#l40.6"></a><span id="l40.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8">   m_window = aWindow;</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10">   // ### fix me - if we need to reparse the folder, this will be asynchronous</span>
<a href="#l40.11"></a><span id="l40.11">   nsCOMPtr&lt;nsISimpleEnumerator&gt; enumerator;</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  rv = mMessageFolder-&gt;GetMessages(m_window, getter_AddRefs(enumerator));</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  rv = mMessageFolder-&gt;GetMessages(getter_AddRefs(enumerator));</span>
<a href="#l40.14"></a><span id="l40.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.15"></a><span id="l40.15"> </span>
<a href="#l40.16"></a><span id="l40.16">   // copy all the elements in the enumerator into our isupports array....</span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18">   nsCOMPtr&lt;nsISupports&gt;   currentItem;</span>
<a href="#l40.19"></a><span id="l40.19">   PRBool hasMoreElements = PR_FALSE;</span>
<a href="#l40.20"></a><span id="l40.20">   while (NS_SUCCEEDED(enumerator-&gt;HasMoreElements(&amp;hasMoreElements)) &amp;&amp; hasMoreElements)</span>
<a href="#l40.21"></a><span id="l40.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/db/gloda/modules/datamodel.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/datamodel.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -346,17 +346,17 @@ GlodaFolder.prototype = {</span>
<a href="#l41.4"></a><span id="l41.4">     //  recently than the acceptably old threshold.</span>
<a href="#l41.5"></a><span id="l41.5">     if (this._activeHeaderRetrievalLastStamp &gt; acceptablyOld)</span>
<a href="#l41.6"></a><span id="l41.6">       return false;</span>
<a href="#l41.7"></a><span id="l41.7">     </span>
<a href="#l41.8"></a><span id="l41.8">     if (this._xpcomFolder) {</span>
<a href="#l41.9"></a><span id="l41.9">       // This is the key action we take; the nsIMsgFolder will continue to</span>
<a href="#l41.10"></a><span id="l41.10">       //  exist, but we want it to forget about its database so that it can</span>
<a href="#l41.11"></a><span id="l41.11">       //  be closed and its memory can be reclaimed.</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-      this._xpcomFolder.setMsgDatabase(null);</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+      this._xpcomFolder.msgDatabase = null;</span>
<a href="#l41.14"></a><span id="l41.14">       this._xpcomFolder = null;</span>
<a href="#l41.15"></a><span id="l41.15">       // since the last retrieval time tracks whether we have marked live or</span>
<a href="#l41.16"></a><span id="l41.16">       //  not, this needs to be reset to 0 too.</span>
<a href="#l41.17"></a><span id="l41.17">       this._activeHeaderRetrievalLastStamp = 0;</span>
<a href="#l41.18"></a><span id="l41.18">     }</span>
<a href="#l41.19"></a><span id="l41.19">     </span>
<a href="#l41.20"></a><span id="l41.20">     return true;</span>
<a href="#l41.21"></a><span id="l41.21">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/indexer.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -867,17 +867,17 @@ var GlodaIndexer = {</span>
<a href="#l42.4"></a><span id="l42.4">         this._pendingFolderEntry = this._indexingFolder;</span>
<a href="#l42.5"></a><span id="l42.5">         this._pendingFolderWantsIterator = aNeedIterator;</span>
<a href="#l42.6"></a><span id="l42.6">         return this.kWorkAsync;</span>
<a href="#l42.7"></a><span id="l42.7">       }</span>
<a href="#l42.8"></a><span id="l42.8">       // we get an nsIMsgDatabase out of this (unsurprisingly) which</span>
<a href="#l42.9"></a><span id="l42.9">       //  explicitly inherits from nsIDBChangeAnnouncer, which has the</span>
<a href="#l42.10"></a><span id="l42.10">       //  AddListener call we want.</span>
<a href="#l42.11"></a><span id="l42.11">       if (this._indexingDatabase == null)</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-        this._indexingDatabase = this._indexingFolder.getMsgDatabase(null);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+        this._indexingDatabase = this._indexingFolder.msgDatabase;</span>
<a href="#l42.14"></a><span id="l42.14">       if (aNeedIterator)</span>
<a href="#l42.15"></a><span id="l42.15">         this._indexerGetIterator();</span>
<a href="#l42.16"></a><span id="l42.16">       this._indexingDatabase.AddListener(this._databaseAnnouncerListener);</span>
<a href="#l42.17"></a><span id="l42.17">     }</span>
<a href="#l42.18"></a><span id="l42.18">     catch (ex) {</span>
<a href="#l42.19"></a><span id="l42.19">       this._log.error(&quot;Problem entering folder: &quot; +</span>
<a href="#l42.20"></a><span id="l42.20">                       (this._indexingFolder ?</span>
<a href="#l42.21"></a><span id="l42.21">                          this._indexingFolder.prettiestName : &quot;unknown&quot;) + </span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -900,17 +900,17 @@ var GlodaIndexer = {</span>
<a href="#l42.23"></a><span id="l42.23">   /**</span>
<a href="#l42.24"></a><span id="l42.24">    * If the folder was still parsing/updating when we tried to enter, then this</span>
<a href="#l42.25"></a><span id="l42.25">    *  handler will get called by the listener who got the FolderLoaded message.</span>
<a href="#l42.26"></a><span id="l42.26">    * All we need to do is get the database reference, register a listener on</span>
<a href="#l42.27"></a><span id="l42.27">    *  the db, and retrieve an iterator if desired.</span>
<a href="#l42.28"></a><span id="l42.28">    */</span>
<a href="#l42.29"></a><span id="l42.29">   _indexerCompletePendingFolderEntry:</span>
<a href="#l42.30"></a><span id="l42.30">       function gloda_indexer_indexerCompletePendingFolderEntry() {</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-    this._indexingDatabase = this._indexingFolder.getMsgDatabase(null);</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+    this._indexingDatabase = this._indexingFolder.msgDatabase;</span>
<a href="#l42.33"></a><span id="l42.33">     if (this._pendingFolderWantsIterator)</span>
<a href="#l42.34"></a><span id="l42.34">       this._indexerGetIterator();</span>
<a href="#l42.35"></a><span id="l42.35">     this._indexingDatabase.AddListener(this._databaseAnnouncerListener);</span>
<a href="#l42.36"></a><span id="l42.36">     this._log.debug(&quot;...Folder Loaded!&quot;);</span>
<a href="#l42.37"></a><span id="l42.37"> </span>
<a href="#l42.38"></a><span id="l42.38">     // the load is no longer pending; we certainly don't want more notifications </span>
<a href="#l42.39"></a><span id="l42.39">     this._pendingFolderEntry = null;</span>
<a href="#l42.40"></a><span id="l42.40">     // indexerEnterFolder returned kWorkAsync, which means we need to notify</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineat">@@ -1820,17 +1820,17 @@ var GlodaIndexer = {</span>
<a href="#l42.42"></a><span id="l42.42"> </span>
<a href="#l42.43"></a><span id="l42.43">             for (let iMsgHdr = 0; iMsgHdr &lt; aSrcMsgHdrs.length; iMsgHdr++) {</span>
<a href="#l42.44"></a><span id="l42.44">               let msgHdr = aSrcMsgHdrs.queryElementAt(iMsgHdr, Ci.nsIMsgDBHdr);</span>
<a href="#l42.45"></a><span id="l42.45">               // (note: collissions on message-id headers are possible and sad)</span>
<a href="#l42.46"></a><span id="l42.46">               srcMsgIdToHdr[msgHdr.messageId] = msgHdr;</span>
<a href="#l42.47"></a><span id="l42.47">             }</span>
<a href="#l42.48"></a><span id="l42.48">             let glodaIds = [];</span>
<a href="#l42.49"></a><span id="l42.49">             let newMessageKeys = [];</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-            for each (let destMsgHdr in fixIterator(aDestFolder.getMessages(null),</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+            for each (let destMsgHdr in fixIterator(aDestFolder.messages,</span>
<a href="#l42.52"></a><span id="l42.52">                                                     Ci.nsIMsgDBHdr)) {</span>
<a href="#l42.53"></a><span id="l42.53">               let destMsgId = destMsgHdr.messageId;</span>
<a href="#l42.54"></a><span id="l42.54">               let matchingSrcHdr = srcMsgIdToHdr[destMsgId];</span>
<a href="#l42.55"></a><span id="l42.55">               if (matchingSrcHdr) {</span>
<a href="#l42.56"></a><span id="l42.56">                 try {</span>
<a href="#l42.57"></a><span id="l42.57">                   let glodaId = matchingSrcHdr.getUint32Property(</span>
<a href="#l42.58"></a><span id="l42.58">                     this.indexer.GLODA_MESSAGE_ID_PROPERTY); </span>
<a href="#l42.59"></a><span id="l42.59">                   glodaIds.push(glodaId);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/extensions/mailviews/resources/content/msgViewPickerOverlay.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -174,17 +174,17 @@ function UpdateViewPicker(aValue, aLabel</span>
<a href="#l43.4"></a><span id="l43.4">     viewPicker.setAttribute(&quot;label&quot;, aLabel);</span>
<a href="#l43.5"></a><span id="l43.5">   }</span>
<a href="#l43.6"></a><span id="l43.6"> }</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8"> function GetFolderInfo(aFolder)</span>
<a href="#l43.9"></a><span id="l43.9"> {</span>
<a href="#l43.10"></a><span id="l43.10">   if (aFolder)</span>
<a href="#l43.11"></a><span id="l43.11">   {</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-    var db = aFolder.getMsgDatabase(msgWindow);</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+    var db = aFolder.msgDatabase;</span>
<a href="#l43.14"></a><span id="l43.14">     if (db)</span>
<a href="#l43.15"></a><span id="l43.15">       return db.dBFolderInfo;</span>
<a href="#l43.16"></a><span id="l43.16">   }</span>
<a href="#l43.17"></a><span id="l43.17">   return null;</span>
<a href="#l43.18"></a><span id="l43.18"> }</span>
<a href="#l43.19"></a><span id="l43.19"> </span>
<a href="#l43.20"></a><span id="l43.20"> </span>
<a href="#l43.21"></a><span id="l43.21"> function GetMailViewForFolder(aFolder)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -378,17 +378,18 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l44.4"></a><span id="l44.4">     return folderObject;</span>
<a href="#l44.5"></a><span id="l44.5">   },</span>
<a href="#l44.6"></a><span id="l44.6"> </span>
<a href="#l44.7"></a><span id="l44.7">   getFeedsInFolder: function (aFolder)</span>
<a href="#l44.8"></a><span id="l44.8">   {</span>
<a href="#l44.9"></a><span id="l44.9">     var feeds = new Array();</span>
<a href="#l44.10"></a><span id="l44.10">     try</span>
<a href="#l44.11"></a><span id="l44.11">     {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-      var msgdb = aFolder.QueryInterface(Components.interfaces.nsIMsgFolder).getMsgDatabase(null);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+      var msgdb = aFolder.QueryInterface(Components.interfaces.nsIMsgFolder)</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+                         .msgDatabase;</span>
<a href="#l44.15"></a><span id="l44.15">       var folderInfo = msgdb.dBFolderInfo;</span>
<a href="#l44.16"></a><span id="l44.16">       var feedurls = folderInfo.getCharProperty(&quot;feedUrl&quot;);</span>
<a href="#l44.17"></a><span id="l44.17">       var feedUrlArray = feedurls.split(&quot;|&quot;);</span>
<a href="#l44.18"></a><span id="l44.18">       for (url in feedUrlArray)</span>
<a href="#l44.19"></a><span id="l44.19">       {</span>
<a href="#l44.20"></a><span id="l44.20">         if (!feedUrlArray[url])</span>
<a href="#l44.21"></a><span id="l44.21">           continue;</span>
<a href="#l44.22"></a><span id="l44.22">         var feedResource  = rdf.GetResource(feedUrlArray[url]);</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineat">@@ -592,17 +593,17 @@ var gFeedSubscriptionsWindow = {</span>
<a href="#l44.24"></a><span id="l44.24">     // view layer. Start by removing the child from its parent folder object</span>
<a href="#l44.25"></a><span id="l44.25">     this.mView.removeItemAtIndex(seln.currentIndex);</span>
<a href="#l44.26"></a><span id="l44.26"> </span>
<a href="#l44.27"></a><span id="l44.27">     // If we don't have any more subscriptions pointing into</span>
<a href="#l44.28"></a><span id="l44.28">     // this folder, then I think we should offer to delete it...</span>
<a href="#l44.29"></a><span id="l44.29">     // Cheat and look at the feed url property to see if anyone else is still using the feed...</span>
<a href="#l44.30"></a><span id="l44.30">     // you could also accomplish this by looking at some properties in the data source...</span>
<a href="#l44.31"></a><span id="l44.31"> </span>
<a href="#l44.32"></a><span id="l44.32" class="difflineminus">-//    var msgdb = currentFolder.QueryInterface(Components.interfaces.nsIMsgFolder).getMsgDatabase(null);</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+//    var msgdb = currentFolder.QueryInterface(Components.interfaces.nsIMsgFolder).msgDatabase;</span>
<a href="#l44.34"></a><span id="l44.34"> //   var folderInfo = msgdb.dBFolderInfo;</span>
<a href="#l44.35"></a><span id="l44.35"> //    var oldFeedUrl = folderInfo.getCharProperty(&quot;feedUrl&quot;);</span>
<a href="#l44.36"></a><span id="l44.36"> </span>
<a href="#l44.37"></a><span id="l44.37"> //    if (!oldFeedUrl) // no more feeds pointing to the folder?</span>
<a href="#l44.38"></a><span id="l44.38"> //    {</span>
<a href="#l44.39"></a><span id="l44.39"> //      try {</span>
<a href="#l44.40"></a><span id="l44.40"> //        var openerResource = this.mRSSServer.rootMsgFolder.QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l44.41"></a><span id="l44.41"> //        var folderResource = currentFolder.QueryInterface(Components.interfaces.nsIRDFResource);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/utils.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/utils.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -128,17 +128,18 @@ function addFeed(url, title, destFolder)</span>
<a href="#l45.4"></a><span id="l45.4"> }</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6"> // updates the &quot;feedUrl&quot; property in the message database for the folder in question.</span>
<a href="#l45.7"></a><span id="l45.7"> </span>
<a href="#l45.8"></a><span id="l45.8"> var kFeedUrlDelimiter = '|'; // the delimiter used to delimit feed urls in the msg folder database &quot;feedUrl&quot; property</span>
<a href="#l45.9"></a><span id="l45.9"> </span>
<a href="#l45.10"></a><span id="l45.10"> function updateFolderFeedUrl(aFolder, aFeedUrl, aRemoveUrl)</span>
<a href="#l45.11"></a><span id="l45.11"> {</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  var msgdb = aFolder.QueryInterface(Components.interfaces.nsIMsgFolder).getMsgDatabase(null);</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  var msgdb = aFolder.QueryInterface(Components.interfaces.nsIMsgFolder)</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineplus">+                     .msgDatabase;</span>
<a href="#l45.15"></a><span id="l45.15">   var folderInfo = msgdb.dBFolderInfo;</span>
<a href="#l45.16"></a><span id="l45.16">   var oldFeedUrl = folderInfo.getCharProperty(&quot;feedUrl&quot;);</span>
<a href="#l45.17"></a><span id="l45.17"> </span>
<a href="#l45.18"></a><span id="l45.18">   if (aRemoveUrl)</span>
<a href="#l45.19"></a><span id="l45.19">   {</span>
<a href="#l45.20"></a><span id="l45.20">     // remove our feed url string from the list of feed urls</span>
<a href="#l45.21"></a><span id="l45.21">     var newFeedUrl = oldFeedUrl.replace(kFeedUrlDelimiter + aFeedUrl, &quot;&quot;);</span>
<a href="#l45.22"></a><span id="l45.22">     folderInfo.setCharProperty(&quot;feedUrl&quot;, newFeedUrl);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/extensions/newsblog/js/newsblog.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/js/newsblog.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -67,17 +67,17 @@ var nsNewsBlogFeedDownloader =</span>
<a href="#l46.4"></a><span id="l46.4">           concatenatedUris += &quot;|&quot;;</span>
<a href="#l46.5"></a><span id="l46.5">         concatenatedUris += uri;</span>
<a href="#l46.6"></a><span id="l46.6">       }</span>
<a href="#l46.7"></a><span id="l46.7">       if (concatenatedUris.length &gt; 0)</span>
<a href="#l46.8"></a><span id="l46.8">       {</span>
<a href="#l46.9"></a><span id="l46.9">         aUrl = concatenatedUris;</span>
<a href="#l46.10"></a><span id="l46.10">         try</span>
<a href="#l46.11"></a><span id="l46.11">         {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-          var msgdb = aFolder.getMsgDatabase(null);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+          var msgdb = aFolder.msgDatabase;</span>
<a href="#l46.14"></a><span id="l46.14">           var folderInfo = msgdb.dBFolderInfo;</span>
<a href="#l46.15"></a><span id="l46.15">           folderInfo.setCharProperty(&quot;feedUrl&quot;, concatenatedUris);</span>
<a href="#l46.16"></a><span id="l46.16">         }</span>
<a href="#l46.17"></a><span id="l46.17">         catch (ex) {dump(ex);}</span>
<a href="#l46.18"></a><span id="l46.18">       }</span>
<a href="#l46.19"></a><span id="l46.19">     }</span>
<a href="#l46.20"></a><span id="l46.20">     // aUrl may be a delimited list of feeds for a particular folder. We need to kick off a download</span>
<a href="#l46.21"></a><span id="l46.21">     // for each feed.</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineat">@@ -194,17 +194,18 @@ var nsNewsBlogFeedDownloader =</span>
<a href="#l46.23"></a><span id="l46.23">   },</span>
<a href="#l46.24"></a><span id="l46.24"> </span>
<a href="#l46.25"></a><span id="l46.25">   updateSubscriptionsDS: function(aFolder, aUnsubscribe)</span>
<a href="#l46.26"></a><span id="l46.26">   {</span>
<a href="#l46.27"></a><span id="l46.27">     if (!gExternalScriptsLoaded)</span>
<a href="#l46.28"></a><span id="l46.28">       loadScripts();</span>
<a href="#l46.29"></a><span id="l46.29"> </span>
<a href="#l46.30"></a><span id="l46.30">     // an rss folder was just renamed...we need to update our feed data source</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-    var msgdb = aFolder.QueryInterface(Components.interfaces.nsIMsgFolder).getMsgDatabase(null);</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+    var msgdb = aFolder.QueryInterface(Components.interfaces.nsIMsgFolder)</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineplus">+                       .msgDatabase;</span>
<a href="#l46.34"></a><span id="l46.34">     var folderInfo = msgdb.dBFolderInfo;</span>
<a href="#l46.35"></a><span id="l46.35">     var feedurls = folderInfo.getCharProperty(&quot;feedUrl&quot;);</span>
<a href="#l46.36"></a><span id="l46.36">     var feedUrlArray = feedurls.split(&quot;|&quot;);</span>
<a href="#l46.37"></a><span id="l46.37"> </span>
<a href="#l46.38"></a><span id="l46.38">     var rdf = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;].getService(Components.interfaces.nsIRDFService);</span>
<a href="#l46.39"></a><span id="l46.39">     var ds = getSubscriptionsDS(aFolder.server);</span>
<a href="#l46.40"></a><span id="l46.40"> </span>
<a href="#l46.41"></a><span id="l46.41">     for (url in feedUrlArray)</span>
<a href="#l46.42"></a><span id="l46.42" class="difflineat">@@ -417,17 +418,17 @@ var progressNotifier = {</span>
<a href="#l46.43"></a><span id="l46.43">       updateFolderFeedUrl(feed.folder, feed.url, false);        </span>
<a href="#l46.44"></a><span id="l46.44">       addFeed(feed.url, feed.name, feed.folder); // add feed just adds the feed to the subscription UI and flushes the datasource</span>
<a href="#l46.45"></a><span id="l46.45">       </span>
<a href="#l46.46"></a><span id="l46.46">       // Nice touch: select the folder that now contains the newly subscribed feed...this is particularly nice </span>
<a href="#l46.47"></a><span id="l46.47">       // if we just finished subscribing to a feed URL that the operating system gave us.</span>
<a href="#l46.48"></a><span id="l46.48">       this.mMsgWindow.windowCommands.selectFolder(feed.folder.URI);</span>
<a href="#l46.49"></a><span id="l46.49">     } </span>
<a href="#l46.50"></a><span id="l46.50">     else if (feed.folder)</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineminus">-      feed.folder.setMsgDatabase(null);</span>
<a href="#l46.52"></a><span id="l46.52" class="difflineplus">+      feed.folder.msgDatabase = null;</span>
<a href="#l46.53"></a><span id="l46.53"> </span>
<a href="#l46.54"></a><span id="l46.54">     if (this.mStatusFeedback)</span>
<a href="#l46.55"></a><span id="l46.55">     {</span>
<a href="#l46.56"></a><span id="l46.56">       var newsBlogBundle = GetNewsBlogStringBundle();</span>
<a href="#l46.57"></a><span id="l46.57">       if (aErrorCode == kNewsBlogNoNewItems)</span>
<a href="#l46.58"></a><span id="l46.58">         this.mStatusFeedback.showStatusString(newsBlogBundle.GetStringFromName(&quot;newsblog-noNewArticlesForFeed&quot;));</span>
<a href="#l46.59"></a><span id="l46.59">       else if (aErrorCode == kNewsBlogInvalidFeed)</span>
<a href="#l46.60"></a><span id="l46.60">         this.mStatusFeedback.showStatusString(newsBlogBundle.formatStringFromName(&quot;newsblog-invalidFeed&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -133,17 +133,17 @@ nsresult nsAutoSyncState::PlaceIntoDownl</span>
<a href="#l47.4"></a><span id="l47.4"> {</span>
<a href="#l47.5"></a><span id="l47.5">   nsresult rv;</span>
<a href="#l47.6"></a><span id="l47.6">   if (!aMsgKeyList.IsEmpty())</span>
<a href="#l47.7"></a><span id="l47.7">   {</span>
<a href="#l47.8"></a><span id="l47.8">     nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryReferent(mOwnerFolder, &amp;rv);</span>
<a href="#l47.9"></a><span id="l47.9">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.10"></a><span id="l47.10">         </span>
<a href="#l47.11"></a><span id="l47.11">     nsCOMPtr&lt;nsIMsgDatabase&gt; database;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-    rv = folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+    rv = folder-&gt;GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l47.14"></a><span id="l47.14">     if (!database)</span>
<a href="#l47.15"></a><span id="l47.15">       return NS_ERROR_FAILURE;</span>
<a href="#l47.16"></a><span id="l47.16">     </span>
<a href="#l47.17"></a><span id="l47.17">     nsCOMPtr&lt;nsIAutoSyncManager&gt; autoSyncMgr = do_GetService(NS_AUTOSYNCMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l47.18"></a><span id="l47.18">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l47.19"></a><span id="l47.19">     </span>
<a href="#l47.20"></a><span id="l47.20">     nsCOMPtr&lt;nsIAutoSyncMsgStrategy&gt; msgStrategy;</span>
<a href="#l47.21"></a><span id="l47.21">     autoSyncMgr-&gt;GetMsgStrategy(getter_AddRefs(msgStrategy));</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -196,17 +196,17 @@ nsresult nsAutoSyncState::PlaceIntoDownl</span>
<a href="#l47.23"></a><span id="l47.23"> </span>
<a href="#l47.24"></a><span id="l47.24"> nsresult nsAutoSyncState::SortQueueBasedOnStrategy(nsTArray&lt;nsMsgKey&gt; &amp;aQueue)</span>
<a href="#l47.25"></a><span id="l47.25"> {</span>
<a href="#l47.26"></a><span id="l47.26">   nsresult rv;</span>
<a href="#l47.27"></a><span id="l47.27">   nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryReferent(mOwnerFolder, &amp;rv);</span>
<a href="#l47.28"></a><span id="l47.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.29"></a><span id="l47.29">   </span>
<a href="#l47.30"></a><span id="l47.30">   nsCOMPtr&lt;nsIMsgDatabase&gt; database;</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-  rv = folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineplus">+  rv = folder-&gt;GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l47.33"></a><span id="l47.33">   if (!database)</span>
<a href="#l47.34"></a><span id="l47.34">     return NS_ERROR_FAILURE;</span>
<a href="#l47.35"></a><span id="l47.35">   </span>
<a href="#l47.36"></a><span id="l47.36">   nsCOMPtr&lt;nsIAutoSyncManager&gt; autoSyncMgr = do_GetService(NS_AUTOSYNCMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l47.37"></a><span id="l47.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.38"></a><span id="l47.38">         </span>
<a href="#l47.39"></a><span id="l47.39">   nsCOMPtr&lt;nsIAutoSyncMsgStrategy&gt; msgStrategy;</span>
<a href="#l47.40"></a><span id="l47.40">   rv = autoSyncMgr-&gt;GetMsgStrategy(getter_AddRefs(msgStrategy));</span>
<a href="#l47.41"></a><span id="l47.41" class="difflineat">@@ -227,17 +227,17 @@ NS_IMETHODIMP nsAutoSyncState::GetNextGr</span>
<a href="#l47.42"></a><span id="l47.42">   </span>
<a href="#l47.43"></a><span id="l47.43">   *aActualGroupSize = 0;</span>
<a href="#l47.44"></a><span id="l47.44">   </span>
<a href="#l47.45"></a><span id="l47.45">   nsresult rv;</span>
<a href="#l47.46"></a><span id="l47.46">   nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryReferent(mOwnerFolder, &amp;rv);</span>
<a href="#l47.47"></a><span id="l47.47">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.48"></a><span id="l47.48">   </span>
<a href="#l47.49"></a><span id="l47.49">   nsCOMPtr&lt;nsIMsgDatabase&gt; database;</span>
<a href="#l47.50"></a><span id="l47.50" class="difflineminus">-  folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l47.51"></a><span id="l47.51" class="difflineplus">+  folder-&gt;GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l47.52"></a><span id="l47.52">       </span>
<a href="#l47.53"></a><span id="l47.53">   nsCOMPtr&lt;nsIMutableArray&gt; group = do_CreateInstance(NS_ARRAY_CONTRACTID);</span>
<a href="#l47.54"></a><span id="l47.54">   if (database)</span>
<a href="#l47.55"></a><span id="l47.55">   {</span>
<a href="#l47.56"></a><span id="l47.56">     if (!mDownloadQ.IsEmpty())</span>
<a href="#l47.57"></a><span id="l47.57">     {</span>
<a href="#l47.58"></a><span id="l47.58">       // sort the download queue if new items are added since the last time</span>
<a href="#l47.59"></a><span id="l47.59">       if (mIsDownloadQChanged)</span>
<a href="#l47.60"></a><span id="l47.60" class="difflineat">@@ -336,17 +336,17 @@ NS_IMETHODIMP nsAutoSyncState::ProcessEx</span>
<a href="#l47.61"></a><span id="l47.61"> {</span>
<a href="#l47.62"></a><span id="l47.62">   NS_ENSURE_ARG_POINTER(aLeftToProcess);</span>
<a href="#l47.63"></a><span id="l47.63">   </span>
<a href="#l47.64"></a><span id="l47.64">   nsresult rv;</span>
<a href="#l47.65"></a><span id="l47.65">   nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryReferent(mOwnerFolder, &amp;rv);</span>
<a href="#l47.66"></a><span id="l47.66">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.67"></a><span id="l47.67">   </span>
<a href="#l47.68"></a><span id="l47.68">   nsCOMPtr&lt;nsIMsgDatabase&gt; database;</span>
<a href="#l47.69"></a><span id="l47.69" class="difflineminus">-  rv = folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l47.70"></a><span id="l47.70" class="difflineplus">+  rv = folder-&gt;GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l47.71"></a><span id="l47.71">   if (!database)</span>
<a href="#l47.72"></a><span id="l47.72">     return NS_ERROR_FAILURE;</span>
<a href="#l47.73"></a><span id="l47.73">   </span>
<a href="#l47.74"></a><span id="l47.74">   // create a queue to process existing headers for the first time</span>
<a href="#l47.75"></a><span id="l47.75">   if (mExistingHeadersQ.IsEmpty())</span>
<a href="#l47.76"></a><span id="l47.76">   {</span>
<a href="#l47.77"></a><span id="l47.77">     rv = database-&gt;ListAllKeys(mExistingHeadersQ);</span>
<a href="#l47.78"></a><span id="l47.78">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.79"></a><span id="l47.79" class="difflineat">@@ -634,17 +634,17 @@ NS_IMPL_ISUPPORTS2(nsAutoSyncState, nsIA</span>
<a href="#l47.80"></a><span id="l47.80"> </span>
<a href="#l47.81"></a><span id="l47.81"> #ifdef DEBUG_me</span>
<a href="#l47.82"></a><span id="l47.82"> void nsAutoSyncState::DebugPrintQWithSize(nsTArray&lt;nsMsgKey&gt;&amp; q, PRUint32 toOffset)</span>
<a href="#l47.83"></a><span id="l47.83"> {</span>
<a href="#l47.84"></a><span id="l47.84">   nsCOMPtr &lt;nsIMsgFolder&gt; ownerFolder = do_QueryReferent(mOwnerFolder);</span>
<a href="#l47.85"></a><span id="l47.85">   if (ownerFolder)</span>
<a href="#l47.86"></a><span id="l47.86">   {</span>
<a href="#l47.87"></a><span id="l47.87">     nsCOMPtr&lt;nsIMsgDatabase&gt; database;</span>
<a href="#l47.88"></a><span id="l47.88" class="difflineminus">-    ownerFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l47.89"></a><span id="l47.89" class="difflineplus">+    ownerFolder-&gt;GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l47.90"></a><span id="l47.90">     </span>
<a href="#l47.91"></a><span id="l47.91">     PRUint32 x = q.Length();</span>
<a href="#l47.92"></a><span id="l47.92">     while (x &gt; toOffset &amp;&amp; database) </span>
<a href="#l47.93"></a><span id="l47.93">     {</span>
<a href="#l47.94"></a><span id="l47.94">       x--;</span>
<a href="#l47.95"></a><span id="l47.95">       nsCOMPtr&lt;nsIMsgDBHdr&gt; h;</span>
<a href="#l47.96"></a><span id="l47.96">       database-&gt;GetMsgHdrForKey(q[x], getter_AddRefs(h));</span>
<a href="#l47.97"></a><span id="l47.97">       PRUint32 s;</span>
<a href="#l47.98"></a><span id="l47.98" class="difflineat">@@ -656,17 +656,17 @@ void nsAutoSyncState::DebugPrintQWithSiz</span>
<a href="#l47.99"></a><span id="l47.99"> }</span>
<a href="#l47.100"></a><span id="l47.100"> </span>
<a href="#l47.101"></a><span id="l47.101"> void nsAutoSyncState::DebugPrintQWithSize(nsIMutableArray *q, PRUint32 toOffset)</span>
<a href="#l47.102"></a><span id="l47.102"> {</span>
<a href="#l47.103"></a><span id="l47.103">   nsCOMPtr &lt;nsIMsgFolder&gt; ownerFolder = do_QueryReferent(mOwnerFolder);</span>
<a href="#l47.104"></a><span id="l47.104">   if (ownerFolder)</span>
<a href="#l47.105"></a><span id="l47.105">   {</span>
<a href="#l47.106"></a><span id="l47.106">     nsCOMPtr&lt;nsIMsgDatabase&gt; database;</span>
<a href="#l47.107"></a><span id="l47.107" class="difflineminus">-    ownerFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(database));</span>
<a href="#l47.108"></a><span id="l47.108" class="difflineplus">+    ownerFolder-&gt;GetMsgDatabase(getter_AddRefs(database));</span>
<a href="#l47.109"></a><span id="l47.109"> </span>
<a href="#l47.110"></a><span id="l47.110">     PRUint32 x;</span>
<a href="#l47.111"></a><span id="l47.111">     q-&gt;GetLength(&amp;x);</span>
<a href="#l47.112"></a><span id="l47.112">     while (x &gt; toOffset &amp;&amp; database) </span>
<a href="#l47.113"></a><span id="l47.113">     {</span>
<a href="#l47.114"></a><span id="l47.114">       x--;</span>
<a href="#l47.115"></a><span id="l47.115">       nsCOMPtr&lt;nsIMsgDBHdr&gt; h;</span>
<a href="#l47.116"></a><span id="l47.116">       q-&gt;QueryElementAt(x, NS_GET_IID(nsIMsgDBHdr),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -813,17 +813,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateFo</span>
<a href="#l48.4"></a><span id="l48.4">   else if (NS_SUCCEEDED(rv))  // tell the front end that the folder is loaded if we're not going to</span>
<a href="#l48.5"></a><span id="l48.5">   {                           // actually run a url.</span>
<a href="#l48.6"></a><span id="l48.6">     if (!m_updatingFolder)    // if we're already running an update url, we'll let that one send the folder loaded</span>
<a href="#l48.7"></a><span id="l48.7">       NotifyFolderEvent(mFolderLoadedAtom);</span>
<a href="#l48.8"></a><span id="l48.8">   }</span>
<a href="#l48.9"></a><span id="l48.9">   return rv;</span>
<a href="#l48.10"></a><span id="l48.10"> }</span>
<a href="#l48.11"></a><span id="l48.11"> </span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-NS_IMETHODIMP nsImapMailFolder::GetMessages(nsIMsgWindow *aMsgWindow, nsISimpleEnumerator* *result)</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+NS_IMETHODIMP nsImapMailFolder::GetMessages(nsISimpleEnumerator* *result)</span>
<a href="#l48.14"></a><span id="l48.14"> {</span>
<a href="#l48.15"></a><span id="l48.15">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l48.16"></a><span id="l48.16">   if (!mDatabase)</span>
<a href="#l48.17"></a><span id="l48.17">     GetDatabase();</span>
<a href="#l48.18"></a><span id="l48.18">   if (mDatabase)</span>
<a href="#l48.19"></a><span id="l48.19">     return mDatabase-&gt;EnumerateMessages(result);</span>
<a href="#l48.20"></a><span id="l48.20">   return NS_ERROR_UNEXPECTED;</span>
<a href="#l48.21"></a><span id="l48.21"> }</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineat">@@ -1293,17 +1293,17 @@ NS_IMETHODIMP nsImapMailFolder::EmptyTra</span>
<a href="#l48.23"></a><span id="l48.23">           return NS_ERROR_FAILURE;  // we will not be performing an empty trash....</span>
<a href="#l48.24"></a><span id="l48.24">       } // if we fetched an imap server</span>
<a href="#l48.25"></a><span id="l48.25">     } // if emptying trash on exit which is done through the account manager.</span>
<a href="#l48.26"></a><span id="l48.26"> </span>
<a href="#l48.27"></a><span id="l48.27">     nsCOMPtr&lt;nsIMsgDatabase&gt; trashDB;</span>
<a href="#l48.28"></a><span id="l48.28">     if (WeAreOffline())</span>
<a href="#l48.29"></a><span id="l48.29">     {</span>
<a href="#l48.30"></a><span id="l48.30">       nsCOMPtr &lt;nsIMsgDatabase&gt; trashDB;</span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">-      rv = trashFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(trashDB));</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+      rv = trashFolder-&gt;GetMsgDatabase(getter_AddRefs(trashDB));</span>
<a href="#l48.33"></a><span id="l48.33">       if (trashDB)</span>
<a href="#l48.34"></a><span id="l48.34">       {</span>
<a href="#l48.35"></a><span id="l48.35">         nsMsgKey fakeKey;</span>
<a href="#l48.36"></a><span id="l48.36">         trashDB-&gt;GetNextFakeOfflineMsgKey(&amp;fakeKey);</span>
<a href="#l48.37"></a><span id="l48.37"> </span>
<a href="#l48.38"></a><span id="l48.38">         nsCOMPtr &lt;nsIMsgOfflineImapOperation&gt; op;</span>
<a href="#l48.39"></a><span id="l48.39">         rv = trashDB-&gt;GetOfflineOpForKey(fakeKey, PR_TRUE, getter_AddRefs(op));</span>
<a href="#l48.40"></a><span id="l48.40">         trashFolder-&gt;SetFlag(nsMsgFolderFlags::OfflineEvents);</span>
<a href="#l48.41"></a><span id="l48.41" class="difflineat">@@ -4576,17 +4576,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l48.42"></a><span id="l48.42">         {</span>
<a href="#l48.43"></a><span id="l48.43">           nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryInterface(m_copyState-&gt;m_srcSupport, &amp;rv);</span>
<a href="#l48.44"></a><span id="l48.44">           if (m_copyState-&gt;m_isMove &amp;&amp; !m_copyState-&gt;m_isCrossServerOp)</span>
<a href="#l48.45"></a><span id="l48.45">           {</span>
<a href="#l48.46"></a><span id="l48.46">             if (NS_SUCCEEDED(aExitCode))</span>
<a href="#l48.47"></a><span id="l48.47">             {</span>
<a href="#l48.48"></a><span id="l48.48">               nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l48.49"></a><span id="l48.49">               if (srcFolder)</span>
<a href="#l48.50"></a><span id="l48.50" class="difflineminus">-                  rv = srcFolder-&gt;GetMsgDatabase(msgWindow, getter_AddRefs(srcDB));</span>
<a href="#l48.51"></a><span id="l48.51" class="difflineplus">+                  rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l48.52"></a><span id="l48.52">               if (NS_SUCCEEDED(rv) &amp;&amp; srcDB)</span>
<a href="#l48.53"></a><span id="l48.53">               {</span>
<a href="#l48.54"></a><span id="l48.54">                 nsRefPtr&lt;nsImapMoveCopyMsgTxn&gt; msgTxn;</span>
<a href="#l48.55"></a><span id="l48.55">                 nsTArray&lt;nsMsgKey&gt; srcKeyArray;</span>
<a href="#l48.56"></a><span id="l48.56">                 if (m_copyState-&gt;m_allowUndo)</span>
<a href="#l48.57"></a><span id="l48.57">                 {</span>
<a href="#l48.58"></a><span id="l48.58">                   rv = m_copyState-&gt;m_undoMsgTxn-&gt;QueryInterface(NS_GET_IID(nsImapMoveCopyMsgTxn), getter_AddRefs(msgTxn));</span>
<a href="#l48.59"></a><span id="l48.59">                   if (msgTxn)</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineat">@@ -4654,17 +4654,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l48.61"></a><span id="l48.61">         // deleting a message to start with, but it probably</span>
<a href="#l48.62"></a><span id="l48.62">         // won't do any harm.</span>
<a href="#l48.63"></a><span id="l48.63">           imapMessageFlagsType flags = 0;</span>
<a href="#l48.64"></a><span id="l48.64">           imapUrl-&gt;GetMsgFlags(&amp;flags);</span>
<a href="#l48.65"></a><span id="l48.65">           //we need to subtract the delete flag in db only in case when we show deleted msgs</span>
<a href="#l48.66"></a><span id="l48.66">           if (flags &amp; kImapMsgDeletedFlag &amp;&amp; ShowDeletedMessages())</span>
<a href="#l48.67"></a><span id="l48.67">           {</span>
<a href="#l48.68"></a><span id="l48.68">             nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l48.69"></a><span id="l48.69" class="difflineminus">-            rv = GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l48.70"></a><span id="l48.70" class="difflineplus">+            rv = GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l48.71"></a><span id="l48.71">             if (NS_SUCCEEDED(rv) &amp;&amp; db)</span>
<a href="#l48.72"></a><span id="l48.72">             {</span>
<a href="#l48.73"></a><span id="l48.73">               nsTArray&lt;nsMsgKey&gt; keyArray;</span>
<a href="#l48.74"></a><span id="l48.74">               char *keyString;</span>
<a href="#l48.75"></a><span id="l48.75">               imapUrl-&gt;CreateListOfMessageIdsString(&amp;keyString);</span>
<a href="#l48.76"></a><span id="l48.76">               if (keyString)</span>
<a href="#l48.77"></a><span id="l48.77">               {</span>
<a href="#l48.78"></a><span id="l48.78">                 ParseUidString(keyString, keyArray);</span>
<a href="#l48.79"></a><span id="l48.79" class="difflineat">@@ -4681,17 +4681,17 @@ nsImapMailFolder::OnStopRunningUrl(nsIUR</span>
<a href="#l48.80"></a><span id="l48.80">           imapMessageFlagsType flags = 0;</span>
<a href="#l48.81"></a><span id="l48.81">           imapUrl-&gt;GetMsgFlags(&amp;flags);</span>
<a href="#l48.82"></a><span id="l48.82">           if (flags &amp; kImapMsgDeletedFlag)</span>
<a href="#l48.83"></a><span id="l48.83">           {</span>
<a href="#l48.84"></a><span id="l48.84">             // we need to delete headers from db only when we don't show deleted msgs</span>
<a href="#l48.85"></a><span id="l48.85">             if (!ShowDeletedMessages())</span>
<a href="#l48.86"></a><span id="l48.86">             {</span>
<a href="#l48.87"></a><span id="l48.87">               nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l48.88"></a><span id="l48.88" class="difflineminus">-              rv = GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l48.89"></a><span id="l48.89" class="difflineplus">+              rv = GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l48.90"></a><span id="l48.90">               if (NS_SUCCEEDED(rv) &amp;&amp; db)</span>
<a href="#l48.91"></a><span id="l48.91">               {</span>
<a href="#l48.92"></a><span id="l48.92">                 nsTArray&lt;nsMsgKey&gt; keyArray;</span>
<a href="#l48.93"></a><span id="l48.93">                 char *keyString = nsnull;</span>
<a href="#l48.94"></a><span id="l48.94">                 imapUrl-&gt;CreateListOfMessageIdsString(&amp;keyString);</span>
<a href="#l48.95"></a><span id="l48.95">                 if (keyString)</span>
<a href="#l48.96"></a><span id="l48.96">                 {</span>
<a href="#l48.97"></a><span id="l48.97">                   ParseUidString(keyString, keyArray);</span>
<a href="#l48.98"></a><span id="l48.98" class="difflineat">@@ -6865,17 +6865,17 @@ nsImapFolderCopyState::OnStopRunningUrl(</span>
<a href="#l48.99"></a><span id="l48.99">             {</span>
<a href="#l48.100"></a><span id="l48.100">               m_srcChildFolders-&gt;InsertElementAt(child, m_childIndex + childIndex + 1);</span>
<a href="#l48.101"></a><span id="l48.101">               m_destParents-&gt;InsertElementAt(newMsgFolder, m_childIndex + childIndex + 1);</span>
<a href="#l48.102"></a><span id="l48.102">             }</span>
<a href="#l48.103"></a><span id="l48.103">             ++childIndex;</span>
<a href="#l48.104"></a><span id="l48.104">           }</span>
<a href="#l48.105"></a><span id="l48.105"> </span>
<a href="#l48.106"></a><span id="l48.106">           nsCOMPtr&lt;nsISimpleEnumerator&gt; messages;</span>
<a href="#l48.107"></a><span id="l48.107" class="difflineminus">-          rv = m_srcFolder-&gt;GetMessages(m_msgWindow, getter_AddRefs(messages));</span>
<a href="#l48.108"></a><span id="l48.108" class="difflineplus">+          rv = m_srcFolder-&gt;GetMessages(getter_AddRefs(messages));</span>
<a href="#l48.109"></a><span id="l48.109">           nsCOMPtr&lt;nsIMutableArray&gt; msgArray(do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv));</span>
<a href="#l48.110"></a><span id="l48.110">           NS_ENSURE_TRUE(msgArray, rv);</span>
<a href="#l48.111"></a><span id="l48.111">           PRBool hasMoreElements;</span>
<a href="#l48.112"></a><span id="l48.112">           nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l48.113"></a><span id="l48.113"> </span>
<a href="#l48.114"></a><span id="l48.114">           if (messages)</span>
<a href="#l48.115"></a><span id="l48.115">             messages-&gt;HasMoreElements(&amp;hasMoreElements);</span>
<a href="#l48.116"></a><span id="l48.116"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.h</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.h</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -229,17 +229,17 @@ public:</span>
<a href="#l49.4"></a><span id="l49.4">   nsImapMailFolder();</span>
<a href="#l49.5"></a><span id="l49.5">   virtual ~nsImapMailFolder();</span>
<a href="#l49.6"></a><span id="l49.6"> </span>
<a href="#l49.7"></a><span id="l49.7">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l49.8"></a><span id="l49.8"> </span>
<a href="#l49.9"></a><span id="l49.9">   // nsIMsgFolder methods:</span>
<a href="#l49.10"></a><span id="l49.10">   NS_IMETHOD GetSubFolders(nsISimpleEnumerator **aResult);</span>
<a href="#l49.11"></a><span id="l49.11"> </span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  NS_IMETHOD GetMessages(nsIMsgWindow *aMsgWindow, nsISimpleEnumerator* *result);</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  NS_IMETHOD GetMessages(nsISimpleEnumerator* *result);</span>
<a href="#l49.14"></a><span id="l49.14">   NS_IMETHOD UpdateFolder(nsIMsgWindow *aWindow);</span>
<a href="#l49.15"></a><span id="l49.15"> </span>
<a href="#l49.16"></a><span id="l49.16">   NS_IMETHOD CreateSubfolder(const nsAString&amp; folderName,nsIMsgWindow *msgWindow );</span>
<a href="#l49.17"></a><span id="l49.17">   NS_IMETHOD AddSubfolder(const nsAString&amp; aName, nsIMsgFolder** aChild);</span>
<a href="#l49.18"></a><span id="l49.18">   NS_IMETHODIMP CreateStorageIfMissing(nsIUrlListener* urlListener);</span>
<a href="#l49.19"></a><span id="l49.19"> </span>
<a href="#l49.20"></a><span id="l49.20">   NS_IMETHOD Compact(nsIUrlListener *aListener, nsIMsgWindow *aMsgWindow);</span>
<a href="#l49.21"></a><span id="l49.21">   NS_IMETHOD CompactAll(nsIUrlListener *aListener, nsIMsgWindow *aMsgWindow,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -1993,17 +1993,17 @@ nsresult nsImapService::OfflineAppendFro</span>
<a href="#l50.4"></a><span id="l50.4">                                               nsIMsgFolder* aDstFolder,</span>
<a href="#l50.5"></a><span id="l50.5">                                               const nsACString &amp;messageId,  // to be replaced</span>
<a href="#l50.6"></a><span id="l50.6">                                               PRBool inSelectedState, // needs to be in</span>
<a href="#l50.7"></a><span id="l50.7">                                               nsIUrlListener *aListener,</span>
<a href="#l50.8"></a><span id="l50.8">                                               nsIURI **aURL,</span>
<a href="#l50.9"></a><span id="l50.9">                                               nsISupports *aCopyState)</span>
<a href="#l50.10"></a><span id="l50.10"> {</span>
<a href="#l50.11"></a><span id="l50.11">   nsCOMPtr&lt;nsIMsgDatabase&gt; destDB;</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  nsresult rv = aDstFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(destDB));</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+  nsresult rv = aDstFolder-&gt;GetMsgDatabase(getter_AddRefs(destDB));</span>
<a href="#l50.14"></a><span id="l50.14">   // ### might need to send some notifications instead of just returning</span>
<a href="#l50.15"></a><span id="l50.15"> </span>
<a href="#l50.16"></a><span id="l50.16">   if (NS_SUCCEEDED(rv) &amp;&amp; destDB)</span>
<a href="#l50.17"></a><span id="l50.17">   {</span>
<a href="#l50.18"></a><span id="l50.18">     nsMsgKey fakeKey;</span>
<a href="#l50.19"></a><span id="l50.19">     destDB-&gt;GetNextFakeOfflineMsgKey(&amp;fakeKey);</span>
<a href="#l50.20"></a><span id="l50.20">     </span>
<a href="#l50.21"></a><span id="l50.21">     nsCOMPtr &lt;nsIMsgOfflineImapOperation&gt; op;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapUndoTxn.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -74,17 +74,17 @@ nsImapMoveCopyMsgTxn::Init(nsIMsgFolder*</span>
<a href="#l51.4"></a><span id="l51.4">   nsCString protocolType(uri);</span>
<a href="#l51.5"></a><span id="l51.5">   protocolType.SetLength(protocolType.FindChar(':'));</span>
<a href="#l51.6"></a><span id="l51.6">   // ** jt -- only do this for mailbox protocol</span>
<a href="#l51.7"></a><span id="l51.7">   if (protocolType.LowerCaseEqualsLiteral(&quot;mailbox&quot;))</span>
<a href="#l51.8"></a><span id="l51.8">   {</span>
<a href="#l51.9"></a><span id="l51.9">     m_srcIsPop3 = PR_TRUE;</span>
<a href="#l51.10"></a><span id="l51.10">     PRUint32 i, count = m_srcKeyArray.Length();</span>
<a href="#l51.11"></a><span id="l51.11">     nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    rv = srcFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(srcDB));</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l51.14"></a><span id="l51.14">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l51.15"></a><span id="l51.15">     nsCOMPtr&lt;nsIMsgDBHdr&gt; srcHdr;</span>
<a href="#l51.16"></a><span id="l51.16">     nsCOMPtr&lt;nsIMsgDBHdr&gt; copySrcHdr;</span>
<a href="#l51.17"></a><span id="l51.17">     nsMsgKey pseudoKey;</span>
<a href="#l51.18"></a><span id="l51.18">     </span>
<a href="#l51.19"></a><span id="l51.19">     for (i=0; i&lt;count; i++)</span>
<a href="#l51.20"></a><span id="l51.20">     {</span>
<a href="#l51.21"></a><span id="l51.21">       rv = srcDB-&gt;GetMsgHdrForKey(m_srcKeyArray[i],</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineat">@@ -361,19 +361,19 @@ nsImapMoveCopyMsgTxn::UndoMailboxDelete(</span>
<a href="#l51.23"></a><span id="l51.23">         nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryReferent(m_srcFolder, &amp;rv);</span>
<a href="#l51.24"></a><span id="l51.24">         if (NS_FAILED(rv) || !srcFolder) return rv;</span>
<a href="#l51.25"></a><span id="l51.25"> </span>
<a href="#l51.26"></a><span id="l51.26">         nsCOMPtr&lt;nsIMsgFolder&gt; dstFolder = do_QueryReferent(m_dstFolder, &amp;rv);</span>
<a href="#l51.27"></a><span id="l51.27">         if (NS_FAILED(rv) || !dstFolder) return rv;</span>
<a href="#l51.28"></a><span id="l51.28"> </span>
<a href="#l51.29"></a><span id="l51.29">         nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l51.30"></a><span id="l51.30">         nsCOMPtr&lt;nsIMsgDatabase&gt; dstDB;</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-        rv = srcFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(srcDB));</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineplus">+        rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l51.33"></a><span id="l51.33">         if (NS_FAILED(rv)) return rv;</span>
<a href="#l51.34"></a><span id="l51.34" class="difflineminus">-        rv = dstFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(dstDB));</span>
<a href="#l51.35"></a><span id="l51.35" class="difflineplus">+        rv = dstFolder-&gt;GetMsgDatabase(getter_AddRefs(dstDB));</span>
<a href="#l51.36"></a><span id="l51.36">         if (NS_FAILED(rv)) return rv;</span>
<a href="#l51.37"></a><span id="l51.37">         </span>
<a href="#l51.38"></a><span id="l51.38">         PRUint32 count = m_srcKeyArray.Length();</span>
<a href="#l51.39"></a><span id="l51.39">         PRUint32 i;</span>
<a href="#l51.40"></a><span id="l51.40">         nsCOMPtr&lt;nsIMsgDBHdr&gt; oldHdr;</span>
<a href="#l51.41"></a><span id="l51.41">         nsCOMPtr&lt;nsIMsgDBHdr&gt; newHdr;</span>
<a href="#l51.42"></a><span id="l51.42">         for (i=0; i&lt;count; i++)</span>
<a href="#l51.43"></a><span id="l51.43">         {</span>
<a href="#l51.44"></a><span id="l51.44" class="difflineat">@@ -406,17 +406,17 @@ nsresult</span>
<a href="#l51.45"></a><span id="l51.45"> nsImapMoveCopyMsgTxn::RedoMailboxDelete()</span>
<a href="#l51.46"></a><span id="l51.46"> {</span>
<a href="#l51.47"></a><span id="l51.47">     nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l51.48"></a><span id="l51.48">     if (m_srcIsPop3)</span>
<a href="#l51.49"></a><span id="l51.49">     {</span>
<a href="#l51.50"></a><span id="l51.50">         nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l51.51"></a><span id="l51.51">         nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryReferent(m_srcFolder, &amp;rv);</span>
<a href="#l51.52"></a><span id="l51.52">         if (NS_FAILED(rv) || !srcFolder) return rv;</span>
<a href="#l51.53"></a><span id="l51.53" class="difflineminus">-        rv = srcFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(srcDB));</span>
<a href="#l51.54"></a><span id="l51.54" class="difflineplus">+        rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l51.55"></a><span id="l51.55">         if (NS_SUCCEEDED(rv))</span>
<a href="#l51.56"></a><span id="l51.56">         {</span>
<a href="#l51.57"></a><span id="l51.57">             srcDB-&gt;DeleteMessages(&amp;m_srcKeyArray, nsnull);</span>
<a href="#l51.58"></a><span id="l51.58">             srcDB-&gt;SetSummaryValid(PR_TRUE);</span>
<a href="#l51.59"></a><span id="l51.59">         }</span>
<a href="#l51.60"></a><span id="l51.60">         return NS_OK; // always return NS_OK</span>
<a href="#l51.61"></a><span id="l51.61">     }</span>
<a href="#l51.62"></a><span id="l51.62">     else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -350,18 +350,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Pars</span>
<a href="#l52.4"></a><span id="l52.4">   rv = mailboxService-&gt;ParseMailbox(aMsgWindow, pathFile, parser, this, nsnull);</span>
<a href="#l52.5"></a><span id="l52.5">   if (NS_SUCCEEDED(rv))</span>
<a href="#l52.6"></a><span id="l52.6">     m_parsingFolder = PR_TRUE;</span>
<a href="#l52.7"></a><span id="l52.7">   return rv;</span>
<a href="#l52.8"></a><span id="l52.8"> }</span>
<a href="#l52.9"></a><span id="l52.9"> </span>
<a href="#l52.10"></a><span id="l52.10"> // this won't force a reparse of the folder if the db is invalid.</span>
<a href="#l52.11"></a><span id="l52.11"> NS_IMETHODIMP</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-nsMsgLocalMailFolder::GetMsgDatabase(nsIMsgWindow *aMsgWindow,</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineminus">-                              nsIMsgDatabase** aMsgDatabase)</span>
<a href="#l52.14"></a><span id="l52.14" class="difflineplus">+nsMsgLocalMailFolder::GetMsgDatabase(nsIMsgDatabase** aMsgDatabase)</span>
<a href="#l52.15"></a><span id="l52.15"> {</span>
<a href="#l52.16"></a><span id="l52.16">   return GetDatabaseWOReparse(aMsgDatabase);</span>
<a href="#l52.17"></a><span id="l52.17"> }</span>
<a href="#l52.18"></a><span id="l52.18"> </span>
<a href="#l52.19"></a><span id="l52.19"> NS_IMETHODIMP</span>
<a href="#l52.20"></a><span id="l52.20"> nsMsgLocalMailFolder::GetSubFolders(nsISimpleEnumerator **aResult)</span>
<a href="#l52.21"></a><span id="l52.21"> {</span>
<a href="#l52.22"></a><span id="l52.22">   PRBool isServer;</span>
<a href="#l52.23"></a><span id="l52.23" class="difflineat">@@ -634,17 +633,17 @@ nsMsgLocalMailFolder::UpdateFolder(nsIMs</span>
<a href="#l52.24"></a><span id="l52.24">   // Callers should rely on folder loaded event to ensure completion of loading. So we'll</span>
<a href="#l52.25"></a><span id="l52.25">   // return NS_OK even if parsing is still in progress</span>
<a href="#l52.26"></a><span id="l52.26">   if (rv == NS_ERROR_NOT_INITIALIZED)</span>
<a href="#l52.27"></a><span id="l52.27">     rv = NS_OK;</span>
<a href="#l52.28"></a><span id="l52.28">   return rv;</span>
<a href="#l52.29"></a><span id="l52.29"> }</span>
<a href="#l52.30"></a><span id="l52.30"> </span>
<a href="#l52.31"></a><span id="l52.31"> NS_IMETHODIMP</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineminus">-nsMsgLocalMailFolder::GetMessages(nsIMsgWindow *aMsgWindow, nsISimpleEnumerator* *result)</span>
<a href="#l52.33"></a><span id="l52.33" class="difflineplus">+nsMsgLocalMailFolder::GetMessages(nsISimpleEnumerator **result)</span>
<a href="#l52.34"></a><span id="l52.34"> {</span>
<a href="#l52.35"></a><span id="l52.35">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l52.36"></a><span id="l52.36">   nsresult rv = GetDatabaseWOReparse(getter_AddRefs(msgDB));</span>
<a href="#l52.37"></a><span id="l52.37">   return NS_SUCCEEDED(rv) ? msgDB-&gt;EnumerateMessages(result) : rv;</span>
<a href="#l52.38"></a><span id="l52.38"> }</span>
<a href="#l52.39"></a><span id="l52.39"> </span>
<a href="#l52.40"></a><span id="l52.40"> NS_IMETHODIMP nsMsgLocalMailFolder::GetFolderURL(nsACString&amp; aUrl)</span>
<a href="#l52.41"></a><span id="l52.41"> {</span>
<a href="#l52.42"></a><span id="l52.42" class="difflineat">@@ -1799,17 +1798,17 @@ nsMsgLocalMailFolder::CopyFolderAcrossSe</span>
<a href="#l52.43"></a><span id="l52.43">   nsString folderName;</span>
<a href="#l52.44"></a><span id="l52.44">   srcFolder-&gt;GetName(folderName);</span>
<a href="#l52.45"></a><span id="l52.45"> </span>
<a href="#l52.46"></a><span id="l52.46">   nsCOMPtr&lt;nsIMsgFolder&gt; newMsgFolder;</span>
<a href="#l52.47"></a><span id="l52.47">   nsresult rv = CreateSubfolderInternal(folderName, msgWindow, getter_AddRefs(newMsgFolder));</span>
<a href="#l52.48"></a><span id="l52.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.49"></a><span id="l52.49"> </span>
<a href="#l52.50"></a><span id="l52.50">   nsCOMPtr&lt;nsISimpleEnumerator&gt; messages;</span>
<a href="#l52.51"></a><span id="l52.51" class="difflineminus">-  rv = srcFolder-&gt;GetMessages(msgWindow, getter_AddRefs(messages));</span>
<a href="#l52.52"></a><span id="l52.52" class="difflineplus">+  rv = srcFolder-&gt;GetMessages(getter_AddRefs(messages));</span>
<a href="#l52.53"></a><span id="l52.53"> </span>
<a href="#l52.54"></a><span id="l52.54">   nsCOMPtr&lt;nsIMutableArray&gt; msgArray(do_CreateInstance(NS_ARRAY_CONTRACTID));</span>
<a href="#l52.55"></a><span id="l52.55"> </span>
<a href="#l52.56"></a><span id="l52.56">   PRBool hasMoreElements;</span>
<a href="#l52.57"></a><span id="l52.57">   nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l52.58"></a><span id="l52.58"> </span>
<a href="#l52.59"></a><span id="l52.59">   if (messages)</span>
<a href="#l52.60"></a><span id="l52.60">     messages-&gt;HasMoreElements(&amp;hasMoreElements);</span>
<a href="#l52.61"></a><span id="l52.61" class="difflineat">@@ -2539,17 +2538,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndC</span>
<a href="#l52.62"></a><span id="l52.62">             {</span>
<a href="#l52.63"></a><span id="l52.63">               PRUint32 folderFlags;</span>
<a href="#l52.64"></a><span id="l52.64">               srcFolder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l52.65"></a><span id="l52.65">               // check if the src folder is an imap inbox.</span>
<a href="#l52.66"></a><span id="l52.66">               if ((folderFlags &amp; (nsMsgFolderFlags::Inbox|nsMsgFolderFlags::ImapBox))</span>
<a href="#l52.67"></a><span id="l52.67">                             == (nsMsgFolderFlags::Inbox|nsMsgFolderFlags::ImapBox))</span>
<a href="#l52.68"></a><span id="l52.68">               {</span>
<a href="#l52.69"></a><span id="l52.69">                 nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l52.70"></a><span id="l52.70" class="difflineminus">-                srcFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(db));</span>
<a href="#l52.71"></a><span id="l52.71" class="difflineplus">+                srcFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l52.72"></a><span id="l52.72">                 if (db)</span>
<a href="#l52.73"></a><span id="l52.73">                 {</span>
<a href="#l52.74"></a><span id="l52.74">                   nsMsgKey srcKey;</span>
<a href="#l52.75"></a><span id="l52.75">                   PRBool containsKey;</span>
<a href="#l52.76"></a><span id="l52.76">                   mCopyState-&gt;m_message-&gt;GetMessageKey(&amp;srcKey);</span>
<a href="#l52.77"></a><span id="l52.77">                   db-&gt;ContainsKey(srcKey, &amp;containsKey);</span>
<a href="#l52.78"></a><span id="l52.78">                   // if the db doesn't have the key, it must be a filtered imap</span>
<a href="#l52.79"></a><span id="l52.79">                   // message, getting moved to a local folder.</span>
<a href="#l52.80"></a><span id="l52.80" class="difflineat">@@ -2767,17 +2766,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::EndM</span>
<a href="#l52.81"></a><span id="l52.81">     mCopyState-&gt;m_parseMsgState-&gt;FinishHeader();</span>
<a href="#l52.82"></a><span id="l52.82"> </span>
<a href="#l52.83"></a><span id="l52.83">     rv = mCopyState-&gt;m_parseMsgState-&gt;GetNewMsgHdr(getter_AddRefs(newHdr));</span>
<a href="#l52.84"></a><span id="l52.84">     if (NS_SUCCEEDED(rv) &amp;&amp; newHdr)</span>
<a href="#l52.85"></a><span id="l52.85">     {</span>
<a href="#l52.86"></a><span id="l52.86">       nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryInterface(mCopyState-&gt;m_srcSupport, &amp;rv);</span>
<a href="#l52.87"></a><span id="l52.87">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.88"></a><span id="l52.88">       nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l52.89"></a><span id="l52.89" class="difflineminus">-      srcFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(srcDB));</span>
<a href="#l52.90"></a><span id="l52.90" class="difflineplus">+      srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l52.91"></a><span id="l52.91">       if (srcDB)</span>
<a href="#l52.92"></a><span id="l52.92">       {</span>
<a href="#l52.93"></a><span id="l52.93">         nsCOMPtr &lt;nsIMsgDBHdr&gt; srcMsgHdr;</span>
<a href="#l52.94"></a><span id="l52.94">         srcDB-&gt;GetMsgHdrForKey(key, getter_AddRefs(srcMsgHdr));</span>
<a href="#l52.95"></a><span id="l52.95">         if (srcMsgHdr)</span>
<a href="#l52.96"></a><span id="l52.96">           CopyPropertiesToMsgHdr(newHdr, srcMsgHdr);</span>
<a href="#l52.97"></a><span id="l52.97">       }</span>
<a href="#l52.98"></a><span id="l52.98">       rv = GetDatabaseWOReparse(getter_AddRefs(msgDb));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.h</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.h</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -131,21 +131,20 @@ public:</span>
<a href="#l53.4"></a><span id="l53.4">   NS_IMETHOD Init(const char *aURI);</span>
<a href="#l53.5"></a><span id="l53.5"> </span>
<a href="#l53.6"></a><span id="l53.6">   // nsIUrlListener methods</span>
<a href="#l53.7"></a><span id="l53.7">   NS_IMETHOD OnStartRunningUrl(nsIURI * aUrl);</span>
<a href="#l53.8"></a><span id="l53.8">   NS_IMETHOD OnStopRunningUrl(nsIURI * aUrl, nsresult aExitCode);</span>
<a href="#l53.9"></a><span id="l53.9"> </span>
<a href="#l53.10"></a><span id="l53.10">   // nsIMsgFolder methods:</span>
<a href="#l53.11"></a><span id="l53.11">   NS_IMETHOD GetSubFolders(nsISimpleEnumerator* *aResult);</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-  NS_IMETHOD GetMsgDatabase(nsIMsgWindow *aMsgWindow,</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineminus">-                              nsIMsgDatabase** aMsgDatabase);</span>
<a href="#l53.14"></a><span id="l53.14" class="difflineplus">+  NS_IMETHOD GetMsgDatabase(nsIMsgDatabase **aMsgDatabase);</span>
<a href="#l53.15"></a><span id="l53.15"> </span>
<a href="#l53.16"></a><span id="l53.16">   NS_IMETHOD OnAnnouncerGoingAway(nsIDBChangeAnnouncer *instigator);</span>
<a href="#l53.17"></a><span id="l53.17" class="difflineminus">-  NS_IMETHOD GetMessages(nsIMsgWindow *aMsgWindow, nsISimpleEnumerator* *result);</span>
<a href="#l53.18"></a><span id="l53.18" class="difflineplus">+  NS_IMETHOD GetMessages(nsISimpleEnumerator **result);</span>
<a href="#l53.19"></a><span id="l53.19">   NS_IMETHOD UpdateFolder(nsIMsgWindow *aWindow);</span>
<a href="#l53.20"></a><span id="l53.20"> </span>
<a href="#l53.21"></a><span id="l53.21">   NS_IMETHOD CreateSubfolder(const nsAString&amp; folderName ,nsIMsgWindow *msgWindow);</span>
<a href="#l53.22"></a><span id="l53.22">   NS_IMETHOD AddSubfolder(const nsAString&amp; folderName, nsIMsgFolder** newFolder);</span>
<a href="#l53.23"></a><span id="l53.23"> </span>
<a href="#l53.24"></a><span id="l53.24">   NS_IMETHOD Compact(nsIUrlListener *aListener, nsIMsgWindow *aMsgWindow);</span>
<a href="#l53.25"></a><span id="l53.25">   NS_IMETHOD CompactAll(nsIUrlListener *aListener, nsIMsgWindow *aMsgWindow, PRBool aCompactOfflineAlso);</span>
<a href="#l53.26"></a><span id="l53.26">   NS_IMETHOD EmptyTrash(nsIMsgWindow *msgWindow, nsIUrlListener *aListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUndoTxn.cpp</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -200,17 +200,17 @@ nsLocalMoveCopyMsgTxn::UndoTransaction()</span>
<a href="#l54.4"></a><span id="l54.4">     </span>
<a href="#l54.5"></a><span id="l54.5">     nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = </span>
<a href="#l54.6"></a><span id="l54.6">       do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv); </span>
<a href="#l54.7"></a><span id="l54.7">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l54.8"></a><span id="l54.8">     </span>
<a href="#l54.9"></a><span id="l54.9">     rv = mailSession-&gt;AddFolderListener(mUndoFolderListener, nsIFolderListener::event);</span>
<a href="#l54.10"></a><span id="l54.10">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l54.11"></a><span id="l54.11">     </span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-    rv = dstFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(dstDB));</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+    rv = dstFolder-&gt;GetMsgDatabase(getter_AddRefs(dstDB));</span>
<a href="#l54.14"></a><span id="l54.14">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l54.15"></a><span id="l54.15">   }</span>
<a href="#l54.16"></a><span id="l54.16">   else</span>
<a href="#l54.17"></a><span id="l54.17">     rv = UndoTransactionInternal();</span>
<a href="#l54.18"></a><span id="l54.18">   return rv;</span>
<a href="#l54.19"></a><span id="l54.19"> }</span>
<a href="#l54.20"></a><span id="l54.20"> </span>
<a href="#l54.21"></a><span id="l54.21"> nsresult </span>
<a href="#l54.22"></a><span id="l54.22" class="difflineat">@@ -234,20 +234,20 @@ nsLocalMoveCopyMsgTxn::UndoTransactionIn</span>
<a href="#l54.23"></a><span id="l54.23">   nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l54.24"></a><span id="l54.24">   nsCOMPtr&lt;nsIMsgDatabase&gt; dstDB;</span>
<a href="#l54.25"></a><span id="l54.25">   nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryReferent(m_srcFolder, &amp;rv);</span>
<a href="#l54.26"></a><span id="l54.26">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l54.27"></a><span id="l54.27">   </span>
<a href="#l54.28"></a><span id="l54.28">   nsCOMPtr&lt;nsIMsgFolder&gt; dstFolder = do_QueryReferent(m_dstFolder, &amp;rv);</span>
<a href="#l54.29"></a><span id="l54.29">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l54.30"></a><span id="l54.30">   </span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-  rv = srcFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(srcDB));</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+  rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l54.33"></a><span id="l54.33">   if(NS_FAILED(rv)) return rv;</span>
<a href="#l54.34"></a><span id="l54.34"> </span>
<a href="#l54.35"></a><span id="l54.35" class="difflineminus">-  rv = dstFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(dstDB));</span>
<a href="#l54.36"></a><span id="l54.36" class="difflineplus">+  rv = dstFolder-&gt;GetMsgDatabase(getter_AddRefs(dstDB));</span>
<a href="#l54.37"></a><span id="l54.37">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l54.38"></a><span id="l54.38"> </span>
<a href="#l54.39"></a><span id="l54.39">   PRUint32 count = m_srcKeyArray.Length();</span>
<a href="#l54.40"></a><span id="l54.40">   PRUint32 i;</span>
<a href="#l54.41"></a><span id="l54.41">   nsCOMPtr&lt;nsIMsgDBHdr&gt; oldHdr;</span>
<a href="#l54.42"></a><span id="l54.42">   nsCOMPtr&lt;nsIMsgDBHdr&gt; newHdr;</span>
<a href="#l54.43"></a><span id="l54.43"> </span>
<a href="#l54.44"></a><span id="l54.44">   // protect against a bogus undo txn without any source keys</span>
<a href="#l54.45"></a><span id="l54.45" class="difflineat">@@ -308,19 +308,19 @@ nsLocalMoveCopyMsgTxn::RedoTransaction()</span>
<a href="#l54.46"></a><span id="l54.46">   nsCOMPtr&lt;nsIMsgDatabase&gt; dstDB;</span>
<a href="#l54.47"></a><span id="l54.47"> </span>
<a href="#l54.48"></a><span id="l54.48">   nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder = do_QueryReferent(m_srcFolder, &amp;rv);</span>
<a href="#l54.49"></a><span id="l54.49">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l54.50"></a><span id="l54.50"> </span>
<a href="#l54.51"></a><span id="l54.51">   nsCOMPtr&lt;nsIMsgFolder&gt; dstFolder = do_QueryReferent(m_dstFolder, &amp;rv);</span>
<a href="#l54.52"></a><span id="l54.52">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l54.53"></a><span id="l54.53">   </span>
<a href="#l54.54"></a><span id="l54.54" class="difflineminus">-  rv = srcFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(srcDB));</span>
<a href="#l54.55"></a><span id="l54.55" class="difflineplus">+  rv = srcFolder-&gt;GetMsgDatabase(getter_AddRefs(srcDB));</span>
<a href="#l54.56"></a><span id="l54.56">   if(NS_FAILED(rv)) return rv;</span>
<a href="#l54.57"></a><span id="l54.57" class="difflineminus">-  rv = dstFolder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(dstDB));</span>
<a href="#l54.58"></a><span id="l54.58" class="difflineplus">+  rv = dstFolder-&gt;GetMsgDatabase(getter_AddRefs(dstDB));</span>
<a href="#l54.59"></a><span id="l54.59">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l54.60"></a><span id="l54.60"> </span>
<a href="#l54.61"></a><span id="l54.61">   PRUint32 count = m_srcKeyArray.Length();</span>
<a href="#l54.62"></a><span id="l54.62">   PRUint32 i;</span>
<a href="#l54.63"></a><span id="l54.63">   nsCOMPtr&lt;nsIMsgDBHdr&gt; oldHdr;</span>
<a href="#l54.64"></a><span id="l54.64">   nsCOMPtr&lt;nsIMsgDBHdr&gt; newHdr;</span>
<a href="#l54.65"></a><span id="l54.65"> </span>
<a href="#l54.66"></a><span id="l54.66">   nsCOMPtr&lt;nsIMutableArray&gt; srcMessages = do_CreateInstance(NS_ARRAY_CONTRACTID);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -140,17 +140,17 @@ nsresult nsMailboxService::CopyMessages(</span>
<a href="#l55.4"></a><span id="l55.4">   nsCOMPtr&lt;nsIMailboxUrl&gt; mailboxurl;</span>
<a href="#l55.5"></a><span id="l55.5"> </span>
<a href="#l55.6"></a><span id="l55.6">   nsMailboxAction actionToUse = nsIMailboxUrl::ActionMoveMessage;</span>
<a href="#l55.7"></a><span id="l55.7">   if (!moveMessage)</span>
<a href="#l55.8"></a><span id="l55.8">      actionToUse = nsIMailboxUrl::ActionCopyMessage;</span>
<a href="#l55.9"></a><span id="l55.9"> </span>
<a href="#l55.10"></a><span id="l55.10">   nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l55.11"></a><span id="l55.11">   nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  srcFolder-&gt;GetMsgDatabase(aMsgWindow, getter_AddRefs(db));</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  srcFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l55.14"></a><span id="l55.14">   if (db)</span>
<a href="#l55.15"></a><span id="l55.15">   {</span>
<a href="#l55.16"></a><span id="l55.16">     db-&gt;GetMsgHdrForKey(msgKeys[0], getter_AddRefs(msgHdr));</span>
<a href="#l55.17"></a><span id="l55.17">     if (msgHdr)</span>
<a href="#l55.18"></a><span id="l55.18">     {</span>
<a href="#l55.19"></a><span id="l55.19">       nsCString uri;</span>
<a href="#l55.20"></a><span id="l55.20">       srcFolder-&gt;GetUriForMsg(msgHdr, uri);</span>
<a href="#l55.21"></a><span id="l55.21">       rv = PrepareMessageUrl(uri.get(), aUrlListener, actionToUse , getter_AddRefs(mailboxurl), aMsgWindow);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailIncomingServer.cpp</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailIncomingServer.cpp</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -98,17 +98,17 @@ nsMovemailIncomingServer::PerformBiff(ns</span>
<a href="#l56.4"></a><span id="l56.4">     if (downloadOnBiff)</span>
<a href="#l56.5"></a><span id="l56.5">     {</span>
<a href="#l56.6"></a><span id="l56.6">        nsCOMPtr &lt;nsIMsgLocalMailFolder&gt; localInbox = do_QueryInterface(inbox,</span>
<a href="#l56.7"></a><span id="l56.7">                                                                        &amp;rv);</span>
<a href="#l56.8"></a><span id="l56.8">        if (localInbox &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l56.9"></a><span id="l56.9">        {</span>
<a href="#l56.10"></a><span id="l56.10">            PRBool valid = PR_FALSE;</span>
<a href="#l56.11"></a><span id="l56.11">            nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-           rv = inbox-&gt;GetMsgDatabase(aMsgWindow, getter_AddRefs(db));</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+           rv = inbox-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l56.14"></a><span id="l56.14">            if (NS_SUCCEEDED(rv) &amp;&amp; db)</span>
<a href="#l56.15"></a><span id="l56.15">            {</span>
<a href="#l56.16"></a><span id="l56.16">                rv = db-&gt;GetSummaryValid(&amp;valid);</span>
<a href="#l56.17"></a><span id="l56.17">            }</span>
<a href="#l56.18"></a><span id="l56.18">            if (NS_SUCCEEDED(rv) &amp;&amp; valid)</span>
<a href="#l56.19"></a><span id="l56.19">            {</span>
<a href="#l56.20"></a><span id="l56.20">                rv = movemailService-&gt;GetNewMail(aMsgWindow, urlListener, inbox,</span>
<a href="#l56.21"></a><span id="l56.21">                                                 this, nsnull);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -280,17 +280,17 @@ nsresult nsPop3IncomingServer::GetInbox(</span>
<a href="#l57.4"></a><span id="l57.4">   {</span>
<a href="#l57.5"></a><span id="l57.5">     rootFolder-&gt;GetFolderWithFlags(nsMsgFolderFlags::Inbox, inbox);</span>
<a href="#l57.6"></a><span id="l57.6">   }</span>
<a href="#l57.7"></a><span id="l57.7"> </span>
<a href="#l57.8"></a><span id="l57.8">   nsCOMPtr&lt;nsIMsgLocalMailFolder&gt; localInbox = do_QueryInterface(*inbox, &amp;rv);</span>
<a href="#l57.9"></a><span id="l57.9">   if (NS_SUCCEEDED(rv) &amp;&amp; localInbox)</span>
<a href="#l57.10"></a><span id="l57.10">   {</span>
<a href="#l57.11"></a><span id="l57.11">     nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-    rv = (*inbox)-&gt;GetMsgDatabase(msgWindow, getter_AddRefs(db));</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+    rv = (*inbox)-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l57.14"></a><span id="l57.14">     if (NS_FAILED(rv))</span>
<a href="#l57.15"></a><span id="l57.15">     {</span>
<a href="#l57.16"></a><span id="l57.16">       (*inbox)-&gt;SetMsgDatabase(nsnull);</span>
<a href="#l57.17"></a><span id="l57.17">       (void) localInbox-&gt;SetCheckForNewMessagesAfterParsing(PR_TRUE);</span>
<a href="#l57.18"></a><span id="l57.18">       // this will cause a reparse of the mail folder.</span>
<a href="#l57.19"></a><span id="l57.19">       localInbox-&gt;GetDatabaseWithReparse(nsnull, msgWindow, getter_AddRefs(db));</span>
<a href="#l57.20"></a><span id="l57.20">       rv = NS_MSG_ERROR_FOLDER_SUMMARY_OUT_OF_DATE;</span>
<a href="#l57.21"></a><span id="l57.21">     }</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineat">@@ -326,17 +326,17 @@ NS_IMETHODIMP nsPop3IncomingServer::Perf</span>
<a href="#l57.23"></a><span id="l57.23">   rv = GetDownloadOnBiff(&amp;downloadOnBiff);</span>
<a href="#l57.24"></a><span id="l57.24">   if (downloadOnBiff)</span>
<a href="#l57.25"></a><span id="l57.25">   {</span>
<a href="#l57.26"></a><span id="l57.26">     nsCOMPtr &lt;nsIMsgLocalMailFolder&gt; localInbox = do_QueryInterface(inbox, &amp;rv);</span>
<a href="#l57.27"></a><span id="l57.27">     if (localInbox &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l57.28"></a><span id="l57.28">     {</span>
<a href="#l57.29"></a><span id="l57.29">       PRBool valid = PR_FALSE;</span>
<a href="#l57.30"></a><span id="l57.30">       nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">-      rv = inbox-&gt;GetMsgDatabase(aMsgWindow, getter_AddRefs(db));</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineplus">+      rv = inbox-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l57.33"></a><span id="l57.33">       if (NS_SUCCEEDED(rv) &amp;&amp; db)</span>
<a href="#l57.34"></a><span id="l57.34">         rv = db-&gt;GetSummaryValid(&amp;valid);</span>
<a href="#l57.35"></a><span id="l57.35">       if (NS_SUCCEEDED(rv) &amp;&amp; valid)</span>
<a href="#l57.36"></a><span id="l57.36">         rv = pop3Service-&gt;GetNewMail(aMsgWindow, urlListener, inbox, this, nsnull);</span>
<a href="#l57.37"></a><span id="l57.37">       else</span>
<a href="#l57.38"></a><span id="l57.38">       {</span>
<a href="#l57.39"></a><span id="l57.39">         PRBool isLocked;</span>
<a href="#l57.40"></a><span id="l57.40">         inbox-&gt;GetLocked(&amp;isLocked);</span>
<a href="#l57.41"></a><span id="l57.41" class="difflineat">@@ -604,17 +604,17 @@ nsresult nsPop3GetMailChainer::GetNewMai</span>
<a href="#l57.42"></a><span id="l57.42">   NS_ENSURE_ARG_POINTER(folderToDownloadTo);</span>
<a href="#l57.43"></a><span id="l57.43"> </span>
<a href="#l57.44"></a><span id="l57.44">   m_serversToGetNewMailFor = servers;</span>
<a href="#l57.45"></a><span id="l57.45">   m_folderToDownloadTo = folderToDownloadTo;</span>
<a href="#l57.46"></a><span id="l57.46">   m_downloadingMsgWindow = msgWindow;</span>
<a href="#l57.47"></a><span id="l57.47">   m_listener = listener;</span>
<a href="#l57.48"></a><span id="l57.48">   nsCOMPtr &lt;nsIMsgDatabase&gt; destFolderDB;</span>
<a href="#l57.49"></a><span id="l57.49"> </span>
<a href="#l57.50"></a><span id="l57.50" class="difflineminus">-  nsresult rv = folderToDownloadTo-&gt;GetMsgDatabase(msgWindow, getter_AddRefs(destFolderDB));</span>
<a href="#l57.51"></a><span id="l57.51" class="difflineplus">+  nsresult rv = folderToDownloadTo-&gt;GetMsgDatabase(getter_AddRefs(destFolderDB));</span>
<a href="#l57.52"></a><span id="l57.52">   if (NS_FAILED(rv) || !destFolderDB)</span>
<a href="#l57.53"></a><span id="l57.53">   {</span>
<a href="#l57.54"></a><span id="l57.54">     nsCOMPtr &lt;nsIMsgLocalMailFolder&gt; localFolder = do_QueryInterface(folderToDownloadTo);</span>
<a href="#l57.55"></a><span id="l57.55">     if (localFolder)</span>
<a href="#l57.56"></a><span id="l57.56">     {</span>
<a href="#l57.57"></a><span id="l57.57">       localFolder-&gt;GetDatabaseWithReparse(this, msgWindow, getter_AddRefs(destFolderDB));</span>
<a href="#l57.58"></a><span id="l57.58">       return NS_OK;</span>
<a href="#l57.59"></a><span id="l57.59">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/local/src/nsRssIncomingServer.cpp</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/local/src/nsRssIncomingServer.cpp</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -185,17 +185,17 @@ NS_IMETHODIMP nsRssIncomingServer::GetNe</span>
<a href="#l58.4"></a><span id="l58.4">   if (rootFolder)</span>
<a href="#l58.5"></a><span id="l58.5">     return PerformBiff(aMsgWindow);</span>
<a href="#l58.6"></a><span id="l58.6"> </span>
<a href="#l58.7"></a><span id="l58.7">   PRBool valid = PR_FALSE;</span>
<a href="#l58.8"></a><span id="l58.8">   nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l58.9"></a><span id="l58.9">   nsresult rv;</span>
<a href="#l58.10"></a><span id="l58.10">   nsCOMPtr &lt;nsINewsBlogFeedDownloader&gt; rssDownloader = do_GetService(&quot;@mozilla.org/newsblog-feed-downloader;1&quot;, &amp;rv);</span>
<a href="#l58.11"></a><span id="l58.11">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-  rv = aFolder-&gt;GetMsgDatabase(aMsgWindow, getter_AddRefs(db));</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+  rv = aFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l58.14"></a><span id="l58.14">   if (NS_SUCCEEDED(rv) &amp;&amp; db)</span>
<a href="#l58.15"></a><span id="l58.15">   {</span>
<a href="#l58.16"></a><span id="l58.16">     rv = db-&gt;GetSummaryValid(&amp;valid);</span>
<a href="#l58.17"></a><span id="l58.17">     NS_ASSERTION(valid, &quot;db is invalid&quot;);</span>
<a href="#l58.18"></a><span id="l58.18">     if (valid)</span>
<a href="#l58.19"></a><span id="l58.19">     {</span>
<a href="#l58.20"></a><span id="l58.20">       nsCOMPtr &lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l58.21"></a><span id="l58.21">       rv = db-&gt;GetDBFolderInfo(getter_AddRefs(folderInfo));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -526,17 +526,17 @@ MsgMapiListContext::~MsgMapiListContext </span>
<a href="#l59.4"></a><span id="l59.4"> </span>
<a href="#l59.5"></a><span id="l59.5"> </span>
<a href="#l59.6"></a><span id="l59.6"> nsresult MsgMapiListContext::OpenDatabase (nsIMsgFolder *folder)</span>
<a href="#l59.7"></a><span id="l59.7"> {</span>
<a href="#l59.8"></a><span id="l59.8">   nsresult dbErr = NS_ERROR_FAILURE;</span>
<a href="#l59.9"></a><span id="l59.9">   if (folder)</span>
<a href="#l59.10"></a><span id="l59.10">   {</span>
<a href="#l59.11"></a><span id="l59.11">     m_folder = folder;</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-    dbErr = folder-&gt;GetMsgDatabase(nsnull, getter_AddRefs(m_db));</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+    dbErr = folder-&gt;GetMsgDatabase(getter_AddRefs(m_db));</span>
<a href="#l59.14"></a><span id="l59.14">     if (m_db)</span>
<a href="#l59.15"></a><span id="l59.15">       dbErr = m_db-&gt;EnumerateMessages(getter_AddRefs(m_msgEnumerator));</span>
<a href="#l59.16"></a><span id="l59.16">   }</span>
<a href="#l59.17"></a><span id="l59.17">   return dbErr;</span>
<a href="#l59.18"></a><span id="l59.18"> }</span>
<a href="#l59.19"></a><span id="l59.19"> </span>
<a href="#l59.20"></a><span id="l59.20"> PRBool </span>
<a href="#l59.21"></a><span id="l59.21"> MsgMapiListContext::IsIMAPHost(void)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPArticleList.cpp</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPArticleList.cpp</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -66,17 +66,17 @@ nsNNTPArticleList::Initialize(nsIMsgNews</span>
<a href="#l60.4"></a><span id="l60.4"> </span>
<a href="#l60.5"></a><span id="l60.5">     m_dbIndex = 0;</span>
<a href="#l60.6"></a><span id="l60.6"> </span>
<a href="#l60.7"></a><span id="l60.7">     m_newsFolder = newsFolder;</span>
<a href="#l60.8"></a><span id="l60.8"> </span>
<a href="#l60.9"></a><span id="l60.9">     nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryInterface(m_newsFolder, &amp;rv);</span>
<a href="#l60.10"></a><span id="l60.10">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-    rv = folder-&gt;GetMsgDatabase(nsnull /* msgWindow */, getter_AddRefs(m_newsDB));</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+    rv = folder-&gt;GetMsgDatabase(getter_AddRefs(m_newsDB));</span>
<a href="#l60.14"></a><span id="l60.14">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l60.15"></a><span id="l60.15">     if (!m_newsDB) return NS_ERROR_UNEXPECTED;</span>
<a href="#l60.16"></a><span id="l60.16"> </span>
<a href="#l60.17"></a><span id="l60.17">     rv = m_newsDB-&gt;ListAllKeys(m_idsInDB);</span>
<a href="#l60.18"></a><span id="l60.18">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l60.19"></a><span id="l60.19"> </span>
<a href="#l60.20"></a><span id="l60.20">     return NS_OK;</span>
<a href="#l60.21"></a><span id="l60.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -291,17 +291,17 @@ nsNNTPNewsgroupList::GetRangeOfArtsToDow</span>
<a href="#l61.4"></a><span id="l61.4">   *first = 0;</span>
<a href="#l61.5"></a><span id="l61.5">   *last = 0;</span>
<a href="#l61.6"></a><span id="l61.6"> </span>
<a href="#l61.7"></a><span id="l61.7">   nsCOMPtr &lt;nsIMsgFolder&gt; folder = do_QueryInterface(m_newsFolder, &amp;rv);</span>
<a href="#l61.8"></a><span id="l61.8">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l61.9"></a><span id="l61.9">   m_msgWindow = aMsgWindow;</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11">   if (!m_newsDB)</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-    rv = folder-&gt;GetMsgDatabase(nsnull /* use m_msgWindow? */, getter_AddRefs(m_newsDB));</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+    rv = folder-&gt;GetMsgDatabase(getter_AddRefs(m_newsDB));</span>
<a href="#l61.14"></a><span id="l61.14"> </span>
<a href="#l61.15"></a><span id="l61.15">   nsCOMPtr&lt;nsINewsDatabase&gt; db(do_QueryInterface(m_newsDB, &amp;rv));</span>
<a href="#l61.16"></a><span id="l61.16">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l61.17"></a><span id="l61.17"> </span>
<a href="#l61.18"></a><span id="l61.18">   rv = db-&gt;GetReadSet(&amp;m_set);</span>
<a href="#l61.19"></a><span id="l61.19">   if (NS_FAILED(rv) || !m_set)</span>
<a href="#l61.20"></a><span id="l61.20">     return rv;</span>
<a href="#l61.21"></a><span id="l61.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsDownloader.cpp</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -555,17 +555,17 @@ nsresult nsMsgDownloadAllNewsgroups::Pro</span>
<a href="#l62.4"></a><span id="l62.4">   return m_currentFolder ? m_currentFolder-&gt;GetNewMessages(m_window, this) : NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l62.5"></a><span id="l62.5"> }</span>
<a href="#l62.6"></a><span id="l62.6"> </span>
<a href="#l62.7"></a><span id="l62.7"> nsresult nsMsgDownloadAllNewsgroups::DownloadMsgsForCurrentGroup()</span>
<a href="#l62.8"></a><span id="l62.8"> {</span>
<a href="#l62.9"></a><span id="l62.9">   NS_ENSURE_TRUE(m_downloaderForGroup, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l62.10"></a><span id="l62.10">   nsCOMPtr &lt;nsIMsgDatabase&gt; db;</span>
<a href="#l62.11"></a><span id="l62.11">   nsCOMPtr &lt;nsIMsgDownloadSettings&gt; downloadSettings;</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  m_currentFolder-&gt;GetMsgDatabase(m_window, getter_AddRefs(db));</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+  m_currentFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l62.14"></a><span id="l62.14">   nsresult rv = m_currentFolder-&gt;GetDownloadSettings(getter_AddRefs(downloadSettings));</span>
<a href="#l62.15"></a><span id="l62.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l62.16"></a><span id="l62.16"> </span>
<a href="#l62.17"></a><span id="l62.17">   nsCOMPtr &lt;nsIMsgNewsFolder&gt; newsFolder = do_QueryInterface(m_currentFolder);</span>
<a href="#l62.18"></a><span id="l62.18">   if (newsFolder)</span>
<a href="#l62.19"></a><span id="l62.19">     newsFolder-&gt;SetSaveArticleOffline(PR_TRUE);</span>
<a href="#l62.20"></a><span id="l62.20"> </span>
<a href="#l62.21"></a><span id="l62.21">   nsCOMPtr &lt;nsIMsgSearchSession&gt; searchSession = do_CreateInstance(NS_MSGSEARCHSESSION_CONTRACTID, &amp;rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -414,17 +414,17 @@ nsMsgNewsFolder::GetCanCompact(PRBool *a</span>
<a href="#l63.4"></a><span id="l63.4"> {</span>
<a href="#l63.5"></a><span id="l63.5">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l63.6"></a><span id="l63.6">   *aResult = PR_FALSE;</span>
<a href="#l63.7"></a><span id="l63.7">   // you can't compact a news server or a news group</span>
<a href="#l63.8"></a><span id="l63.8">   return NS_OK;</span>
<a href="#l63.9"></a><span id="l63.9"> }</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11"> NS_IMETHODIMP</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-nsMsgNewsFolder::GetMessages(nsIMsgWindow *aMsgWindow, nsISimpleEnumerator* *result)</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+nsMsgNewsFolder::GetMessages(nsISimpleEnumerator **result)</span>
<a href="#l63.14"></a><span id="l63.14"> {</span>
<a href="#l63.15"></a><span id="l63.15">   nsresult rv = GetDatabase();</span>
<a href="#l63.16"></a><span id="l63.16">   *result = nsnull;</span>
<a href="#l63.17"></a><span id="l63.17"> </span>
<a href="#l63.18"></a><span id="l63.18">   if(NS_SUCCEEDED(rv))</span>
<a href="#l63.19"></a><span id="l63.19">     rv = mDatabase-&gt;EnumerateMessages(result);</span>
<a href="#l63.20"></a><span id="l63.20"> </span>
<a href="#l63.21"></a><span id="l63.21">   return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.h</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.h</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -62,17 +62,17 @@ public:</span>
<a href="#l64.4"></a><span id="l64.4">   NS_DECL_ISUPPORTS_INHERITED</span>
<a href="#l64.5"></a><span id="l64.5">   NS_DECL_NSIMSGNEWSFOLDER</span>
<a href="#l64.6"></a><span id="l64.6"> </span>
<a href="#l64.7"></a><span id="l64.7">   // nsIUrlListener method</span>
<a href="#l64.8"></a><span id="l64.8">   NS_IMETHOD OnStopRunningUrl(nsIURI * aUrl, nsresult aExitCode);</span>
<a href="#l64.9"></a><span id="l64.9">   // nsIMsgFolder methods:</span>
<a href="#l64.10"></a><span id="l64.10">   NS_IMETHOD GetSubFolders(nsISimpleEnumerator **aResult);</span>
<a href="#l64.11"></a><span id="l64.11"> </span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  NS_IMETHOD GetMessages(nsIMsgWindow *aMsgWindow, nsISimpleEnumerator* *result);</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  NS_IMETHOD GetMessages(nsISimpleEnumerator **result);</span>
<a href="#l64.14"></a><span id="l64.14">   NS_IMETHOD UpdateFolder(nsIMsgWindow *aWindow);</span>
<a href="#l64.15"></a><span id="l64.15"> </span>
<a href="#l64.16"></a><span id="l64.16">   NS_IMETHOD CreateSubfolder(const nsAString&amp; folderName,nsIMsgWindow *msgWindow);</span>
<a href="#l64.17"></a><span id="l64.17"> </span>
<a href="#l64.18"></a><span id="l64.18">   NS_IMETHOD Delete ();</span>
<a href="#l64.19"></a><span id="l64.19">   NS_IMETHOD Rename (const nsAString&amp; newName, nsIMsgWindow *msgWindow);</span>
<a href="#l64.20"></a><span id="l64.20"> </span>
<a href="#l64.21"></a><span id="l64.21">   NS_IMETHOD GetAbbreviatedName(nsAString&amp; aAbbreviatedName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/news/test/unit/head_server_setup.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/news/test/unit/head_server_setup.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -154,22 +154,22 @@ function create_post(baseURL, file) {</span>
<a href="#l65.4"></a><span id="l65.4">   var post = Cc[&quot;@mozilla.org/messenger/nntpnewsgrouppost;1&quot;]</span>
<a href="#l65.5"></a><span id="l65.5">                .createInstance(Ci.nsINNTPNewsgroupPost);</span>
<a href="#l65.6"></a><span id="l65.6">   post.postMessageFile = do_get_file(file);</span>
<a href="#l65.7"></a><span id="l65.7">   url.messageToPost = post;</span>
<a href="#l65.8"></a><span id="l65.8">   return url;</span>
<a href="#l65.9"></a><span id="l65.9"> }</span>
<a href="#l65.10"></a><span id="l65.10"> </span>
<a href="#l65.11"></a><span id="l65.11"> function resetFolder(folder) {</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-  var headerEnum = folder.getMessages(null);</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+  var headerEnum = folder.messages;</span>
<a href="#l65.14"></a><span id="l65.14">   var headers = [];</span>
<a href="#l65.15"></a><span id="l65.15">   while (headerEnum.hasMoreElements())</span>
<a href="#l65.16"></a><span id="l65.16">     headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l65.17"></a><span id="l65.17"> </span>
<a href="#l65.18"></a><span id="l65.18" class="difflineminus">-  var db = folder.getMsgDatabase(null);</span>
<a href="#l65.19"></a><span id="l65.19" class="difflineplus">+  var db = folder.msgDatabase;</span>
<a href="#l65.20"></a><span id="l65.20">   db.dBFolderInfo.knownArtsSet = &quot;&quot;;</span>
<a href="#l65.21"></a><span id="l65.21">   for each (var header in headers) {</span>
<a href="#l65.22"></a><span id="l65.22">     db.DeleteHeader(header, null, true, false);</span>
<a href="#l65.23"></a><span id="l65.23">   }</span>
<a href="#l65.24"></a><span id="l65.24"> }</span>
<a href="#l65.25"></a><span id="l65.25"> </span>
<a href="#l65.26"></a><span id="l65.26"> function do_check_transaction(real, expected) {</span>
<a href="#l65.27"></a><span id="l65.27">   // real.them may have an extra QUIT on the end, where the stream is only</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/news/test/unit/test_filter.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_filter.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -98,17 +98,17 @@ function testAttrib(handler, localserver</span>
<a href="#l66.4"></a><span id="l66.4">   server.start(NNTP_PORT);</span>
<a href="#l66.5"></a><span id="l66.5"> </span>
<a href="#l66.6"></a><span id="l66.6">   // Get the folder and force filters to run</span>
<a href="#l66.7"></a><span id="l66.7">   var folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l66.8"></a><span id="l66.8">   folder.getNewMessages(null, {</span>
<a href="#l66.9"></a><span id="l66.9">     OnStopRunningUrl: function () { localserver.closeCachedConnections() }});</span>
<a href="#l66.10"></a><span id="l66.10">   server.performTest();</span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-  var headerEnum = folder.getMessages(null);</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+  var headerEnum = folder.messages;</span>
<a href="#l66.14"></a><span id="l66.14">   var headers = [];</span>
<a href="#l66.15"></a><span id="l66.15">   while (headerEnum.hasMoreElements())</span>
<a href="#l66.16"></a><span id="l66.16">     headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l66.17"></a><span id="l66.17"> </span>
<a href="#l66.18"></a><span id="l66.18">   try</span>
<a href="#l66.19"></a><span id="l66.19">   {</span>
<a href="#l66.20"></a><span id="l66.20">     do_check_eq(headers.length, 7);</span>
<a href="#l66.21"></a><span id="l66.21">     for each (var header in headers) {</span>
<a href="#l66.22"></a><span id="l66.22" class="difflineat">@@ -126,24 +126,22 @@ function testAttrib(handler, localserver</span>
<a href="#l66.23"></a><span id="l66.23">   resetFolder(folder);</span>
<a href="#l66.24"></a><span id="l66.24"> }</span>
<a href="#l66.25"></a><span id="l66.25"> </span>
<a href="#l66.26"></a><span id="l66.26"> // These are the results for testing actual actions</span>
<a href="#l66.27"></a><span id="l66.27"> var actionResults = {</span>
<a href="#l66.28"></a><span id="l66.28">   &quot;1@regular.invalid&quot; : [&quot;priority&quot;, 6],</span>
<a href="#l66.29"></a><span id="l66.29">   // &quot;2@regular.invalid&quot; should not be in database</span>
<a href="#l66.30"></a><span id="l66.30">   &quot;3@regular.invalid&quot; : function (header, folder) {</span>
<a href="#l66.31"></a><span id="l66.31" class="difflineminus">-    var db = folder.getMsgDatabase(null);</span>
<a href="#l66.32"></a><span id="l66.32" class="difflineminus">-    var flags = db.GetThreadContainingMsgHdr(header).flags;</span>
<a href="#l66.33"></a><span id="l66.33" class="difflineplus">+    var flags = folder.msgDatabase.GetThreadContainingMsgHdr(header).flags;</span>
<a href="#l66.34"></a><span id="l66.34">     // This is checking the thread's kill flag</span>
<a href="#l66.35"></a><span id="l66.35">     return (flags &amp; 0x40000) == 0x40000;</span>
<a href="#l66.36"></a><span id="l66.36">   },</span>
<a href="#l66.37"></a><span id="l66.37">   &quot;4@regular.invalid&quot; : function (header, folder) {</span>
<a href="#l66.38"></a><span id="l66.38" class="difflineminus">-    var db = folder.getMsgDatabase(null);</span>
<a href="#l66.39"></a><span id="l66.39" class="difflineminus">-    var flags = db.GetThreadContainingMsgHdr(header).flags;</span>
<a href="#l66.40"></a><span id="l66.40" class="difflineplus">+    var flags = folder.msgDatabase.GetThreadContainingMsgHdr(header).flags;</span>
<a href="#l66.41"></a><span id="l66.41">     // This is checking the thread's watch flag</span>
<a href="#l66.42"></a><span id="l66.42">     return (flags &amp; 0x100) == 0x100;</span>
<a href="#l66.43"></a><span id="l66.43">   },</span>
<a href="#l66.44"></a><span id="l66.44">   &quot;5@regular.invalid&quot; : [&quot;isFlagged&quot;, true],</span>
<a href="#l66.45"></a><span id="l66.45">   &quot;6.odd@regular.invalid&quot; : [&quot;isRead&quot;, false],</span>
<a href="#l66.46"></a><span id="l66.46">   &quot;7@regular.invalid&quot; : function (header, folder) {</span>
<a href="#l66.47"></a><span id="l66.47">     return header.getStringProperty(&quot;keywords&quot;) == &quot;tag&quot;;</span>
<a href="#l66.48"></a><span id="l66.48">   }</span>
<a href="#l66.49"></a><span id="l66.49" class="difflineat">@@ -153,17 +151,17 @@ function testAction(handler, localserver</span>
<a href="#l66.50"></a><span id="l66.50">   server.start(NNTP_PORT);</span>
<a href="#l66.51"></a><span id="l66.51"> </span>
<a href="#l66.52"></a><span id="l66.52">   // Get the folder and force filters to run</span>
<a href="#l66.53"></a><span id="l66.53">   var folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l66.54"></a><span id="l66.54">   folder.getNewMessages(null, {</span>
<a href="#l66.55"></a><span id="l66.55">     OnStopRunningUrl: function () { localserver.closeCachedConnections() }});</span>
<a href="#l66.56"></a><span id="l66.56">   server.performTest();</span>
<a href="#l66.57"></a><span id="l66.57"> </span>
<a href="#l66.58"></a><span id="l66.58" class="difflineminus">-  var headerEnum = folder.getMessages(null);</span>
<a href="#l66.59"></a><span id="l66.59" class="difflineplus">+  var headerEnum = folder.messages;</span>
<a href="#l66.60"></a><span id="l66.60">   var headers = [];</span>
<a href="#l66.61"></a><span id="l66.61">   while (headerEnum.hasMoreElements())</span>
<a href="#l66.62"></a><span id="l66.62">     headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l66.63"></a><span id="l66.63"> </span>
<a href="#l66.64"></a><span id="l66.64">   try</span>
<a href="#l66.65"></a><span id="l66.65">   {</span>
<a href="#l66.66"></a><span id="l66.66">     do_check_eq(headers.length, 6);</span>
<a href="#l66.67"></a><span id="l66.67">     for each (var header in headers) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/suite/mailnews/mailWidgets.xml</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/suite/mailnews/mailWidgets.xml</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -1878,18 +1878,17 @@</span>
<a href="#l67.4"></a><span id="l67.4">             // skip servers, Trash and Junk folders</span>
<a href="#l67.5"></a><span id="l67.5">             if (!aFolder || aFolder.isServer || aFolder.getFlag(kMsgPopupFolderFlagJunk) || aFolder.getFlag(kMsgPopupFolderFlagTrash))</span>
<a href="#l67.6"></a><span id="l67.6">               return false;</span>
<a href="#l67.7"></a><span id="l67.7">             var pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l67.8"></a><span id="l67.8">             var showPreviewText = pref.getBoolPref(&quot;mail.biff.alert.show_preview&quot;);</span>
<a href="#l67.9"></a><span id="l67.9">             var folderArray = new Array;</span>
<a href="#l67.10"></a><span id="l67.10">             if (aFolder.flags  &amp; Components.interfaces.nsMsgFolderFlags.Virtual)</span>
<a href="#l67.11"></a><span id="l67.11">             {</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-              var msgDatabase = aFolder.getMsgDatabase(null);</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineminus">-              var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l67.14"></a><span id="l67.14" class="difflineplus">+              var dbFolderInfo = aFolder.msgDatabase.dBFolderInfo;</span>
<a href="#l67.15"></a><span id="l67.15">               var srchFolderUri = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l67.16"></a><span id="l67.16">               var srchFolderUriArray = srchFolderUri.split('|');</span>
<a href="#l67.17"></a><span id="l67.17">               var foldersAdded = 0;</span>
<a href="#l67.18"></a><span id="l67.18">               var RDF = Components.classes['@mozilla.org/rdf/rdf-service;1'].getService().QueryInterface(Components.interfaces.nsIRDFService);</span>
<a href="#l67.19"></a><span id="l67.19">               for (var i in srchFolderUriArray)</span>
<a href="#l67.20"></a><span id="l67.20">               {</span>
<a href="#l67.21"></a><span id="l67.21">                 var realFolder = RDF.GetResource(srchFolderUriArray[i]).QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l67.22"></a><span id="l67.22">                 if (!realFolder.isServer)</span>
<a href="#l67.23"></a><span id="l67.23" class="difflineat">@@ -1898,38 +1897,38 @@</span>
<a href="#l67.24"></a><span id="l67.24">             }</span>
<a href="#l67.25"></a><span id="l67.25">             else</span>
<a href="#l67.26"></a><span id="l67.26">               folderArray[0] = aFolder;</span>
<a href="#l67.27"></a><span id="l67.27">             var foundNewMsg = false;</span>
<a href="#l67.28"></a><span id="l67.28">             for (var folderIndex = 0; folderIndex &lt; folderArray.length; folderIndex++)</span>
<a href="#l67.29"></a><span id="l67.29">             {</span>
<a href="#l67.30"></a><span id="l67.30">               aFolder = folderArray[folderIndex];</span>
<a href="#l67.31"></a><span id="l67.31">               // now get the database</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineminus">-              var msgDatabase = aFolder.getMsgDatabase(null);</span>
<a href="#l67.33"></a><span id="l67.33" class="difflineminus">-              aFolder.setMsgDatabase(null);</span>
<a href="#l67.34"></a><span id="l67.34" class="difflineplus">+              var msgDatabase = aFolder.msgDatabase;</span>
<a href="#l67.35"></a><span id="l67.35" class="difflineplus">+              aFolder.msgDatabase = null;</span>
<a href="#l67.36"></a><span id="l67.36">               var msgKeys = {};</span>
<a href="#l67.37"></a><span id="l67.37">               var numMsgKeys = {};</span>
<a href="#l67.38"></a><span id="l67.38">               msgDatabase.getNewList(numMsgKeys, msgKeys);</span>
<a href="#l67.39"></a><span id="l67.39"> </span>
<a href="#l67.40"></a><span id="l67.40">               if (!numMsgKeys.value)</span>
<a href="#l67.41"></a><span id="l67.41">                 continue;</span>
<a href="#l67.42"></a><span id="l67.42"> </span>
<a href="#l67.43"></a><span id="l67.43">               if (showPreviewText)</span>
<a href="#l67.44"></a><span id="l67.44">               {</span>
<a href="#l67.45"></a><span id="l67.45">                 // fetchMsgPreviewText forces the previewText property to get generated</span>
<a href="#l67.46"></a><span id="l67.46">                 // for each of the message keys.</span>
<a href="#l67.47"></a><span id="l67.47">                 try {</span>
<a href="#l67.48"></a><span id="l67.48">                   aOutAsync.value = aFolder.fetchMsgPreviewText(msgKeys.value, numMsgKeys.value, false, aUrlListener);</span>
<a href="#l67.49"></a><span id="l67.49" class="difflineminus">-                  aFolder.setMsgDatabase(null);</span>
<a href="#l67.50"></a><span id="l67.50" class="difflineplus">+                  aFolder.msgDatabase = null;</span>
<a href="#l67.51"></a><span id="l67.51">                 }</span>
<a href="#l67.52"></a><span id="l67.52">                 catch (ex)</span>
<a href="#l67.53"></a><span id="l67.53">                 {</span>
<a href="#l67.54"></a><span id="l67.54">                   // fetchMsgPreviewText throws an error when we call it on a news folder, we should just not show</span>
<a href="#l67.55"></a><span id="l67.55">                   // the tooltip if this method returns an error.</span>
<a href="#l67.56"></a><span id="l67.56" class="difflineminus">-                  aFolder.setMsgDatabase(null);</span>
<a href="#l67.57"></a><span id="l67.57" class="difflineplus">+                  aFolder.msgDatabase = null;</span>
<a href="#l67.58"></a><span id="l67.58">                   continue;</span>
<a href="#l67.59"></a><span id="l67.59">                 }</span>
<a href="#l67.60"></a><span id="l67.60">               }</span>
<a href="#l67.61"></a><span id="l67.61">               // if fetching the preview text is going to be an asynch operation and the caller</span>
<a href="#l67.62"></a><span id="l67.62">               // is set up to handle that fact, then don't bother filling in any of the fields since</span>
<a href="#l67.63"></a><span id="l67.63">               // we'll have to do this all over again when the fetch for the preview text completes.</span>
<a href="#l67.64"></a><span id="l67.64">               // We don't expect to get called with a urlListener if we're doing a virtual folder.</span>
<a href="#l67.65"></a><span id="l67.65">               if (aOutAsync.value &amp;&amp; aUrlListener)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

