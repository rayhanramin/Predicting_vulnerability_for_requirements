<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 803:affe0690a3813456d2bcc4a8f528c7b67c1c59c4</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ affe0690a3813456d2bcc4a8f528c7b67c1c59c4" />
<meta property="og:url" content="/comm-central/rev/affe0690a3813456d2bcc4a8f528c7b67c1c59c4" />
<meta property="og:description" content="Bug 462835 Spell collector right in ns(I)AbAddressCollecter. r=bienvenu,sr=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / affe0690a3813456d2bcc4a8f528c7b67c1c59c4 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/affe0690a3813456d2bcc4a8f528c7b67c1c59c4">shortlog</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/affe0690a3813456d2bcc4a8f528c7b67c1c59c4">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4">files</a> |
changeset |
<a href="/comm-central/raw-rev/affe0690a3813456d2bcc4a8f528c7b67c1c59c4">raw</a>  | <a href="/comm-central/archive/affe0690a3813456d2bcc4a8f528c7b67c1c59c4.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=462835">Bug 462835</a> Spell collector right in ns(I)AbAddressCollecter. r=bienvenu,sr=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 03 Nov 2008 16:03:21 +0000</td></tr>

<tr>
 <td>changeset 803</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/affe0690a3813456d2bcc4a8f528c7b67c1c59c4">affe0690a3813456d2bcc4a8f528c7b67c1c59c4</a></td>
</tr>



<tr>
<td>parent 802</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/817b4f7b9c19cbe3631a8b61407c88d40c002d1e">817b4f7b9c19cbe3631a8b61407c88d40c002d1e</a>
</td>
</tr>

<tr>
<td>child 804</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ed3b01f09992ac00c0d4be7897f053b5b3fa5ecf">ed3b01f09992ac00c0d4be7897f053b5b3fa5ecf</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=affe0690a3813456d2bcc4a8f528c7b67c1c59c4">728</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 03 Nov 2008 16:04:22 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@affe0690a381 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4&newProject=comm-central&newRevision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4&newProject=comm-central&newRevision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4&newProject=comm-central&newRevision=affe0690a3813456d2bcc4a8f528c7b67c1c59c4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a>, <a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=462835">462835</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=462835">Bug 462835</a> Spell collector right in ns(I)AbAddressCollecter. r=bienvenu,sr=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/base/content/msgHdrViewOverlay.js">mail/base/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/base/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/base/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/base/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/base/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/base/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/build/nsAbFactory.cpp">mailnews/addrbook/build/nsAbFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/build/nsAbFactory.cpp">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/build/nsAbFactory.cpp">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/build/nsAbFactory.cpp">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/build/nsAbFactory.cpp">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/build/nsAbFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/Makefile.in">mailnews/addrbook/public/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/Makefile.in">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/Makefile.in">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/Makefile.in">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/Makefile.in">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsAbBaseCID.h">mailnews/addrbook/public/nsAbBaseCID.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsAbBaseCID.h">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsAbBaseCID.h">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsAbBaseCID.h">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsAbBaseCID.h">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsAbBaseCID.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollecter.idl">mailnews/addrbook/public/nsIAbAddressCollecter.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollecter.idl">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollecter.idl">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollecter.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollector.idl">mailnews/addrbook/public/nsIAbAddressCollector.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollector.idl">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollector.idl">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollector.idl">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollector.idl">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/public/nsIAbAddressCollector.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/Makefile.in">mailnews/addrbook/src/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/Makefile.in">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/Makefile.in">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/Makefile.in">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/Makefile.in">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.cpp">mailnews/addrbook/src/nsAbAddressCollecter.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.cpp">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.cpp">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.h">mailnews/addrbook/src/nsAbAddressCollecter.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.h">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.h">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollecter.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.cpp">mailnews/addrbook/src/nsAbAddressCollector.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.cpp">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.cpp">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.cpp">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.cpp">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.h">mailnews/addrbook/src/nsAbAddressCollector.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.h">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.h">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.h">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.h">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/src/nsAbAddressCollector.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/test/unit/test_collection.js">mailnews/addrbook/test/unit/test_collection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/test/unit/test_collection.js">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/test/unit/test_collection.js">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/test/unit/test_collection.js">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/test/unit/test_collection.js">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/addrbook/test/unit/test_collection.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/base/resources/content/msgHdrViewOverlay.js">mailnews/base/resources/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/base/resources/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/base/resources/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/base/resources/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/base/resources/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/base/resources/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/build/nsMailModule.cpp">mailnews/build/nsMailModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/build/nsMailModule.cpp">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/build/nsMailModule.cpp">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/build/nsMailModule.cpp">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/build/nsMailModule.cpp">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/build/nsMailModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/resources/content/MsgComposeCommands.js">mailnews/compose/resources/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/resources/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/resources/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/resources/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/resources/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/resources/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/affe0690a3813456d2bcc4a8f528c7b67c1c59c4/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1230,18 +1230,18 @@ function AddContact(emailAddressNode)</span>
<a href="#l1.4"></a><span id="l1.4">     // When we collect an address, it updates the AB which sends out</span>
<a href="#l1.5"></a><span id="l1.5">     // notifications to update the UI. In the add case we don't want to update</span>
<a href="#l1.6"></a><span id="l1.6">     // the UI so that accidentally double-clicking on the star doesn't lead</span>
<a href="#l1.7"></a><span id="l1.7">     // to something strange (i.e star would be moved out from underneath,</span>
<a href="#l1.8"></a><span id="l1.8">     // leaving something else there).</span>
<a href="#l1.9"></a><span id="l1.9">     emailAddressNode.setAttribute(&quot;updatingUI&quot;, true);</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">     // Just save the new node straight away</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    Components.classes[&quot;@mozilla.org/addressbook/services/addressCollecter;1&quot;]</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-      .getService(Components.interfaces.nsIAbAddressCollecter)</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+    Components.classes[&quot;@mozilla.org/addressbook/services/addressCollector;1&quot;]</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+      .getService(Components.interfaces.nsIAbAddressCollector)</span>
<a href="#l1.16"></a><span id="l1.16">       .collectSingleAddress(emailAddressNode.getAttribute(&quot;emailAddress&quot;),</span>
<a href="#l1.17"></a><span id="l1.17">                             emailAddressNode.getAttribute(&quot;displayName&quot;), true,</span>
<a href="#l1.18"></a><span id="l1.18">                             Components.interfaces.nsIAbPreferMailFormat.unknown,</span>
<a href="#l1.19"></a><span id="l1.19">                             true);</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21">     emailAddressNode.removeAttribute(&quot;updatingUI&quot;);</span>
<a href="#l1.22"></a><span id="l1.22">   }</span>
<a href="#l1.23"></a><span id="l1.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1746,17 +1746,17 @@ function GenericSendMessage( msgType )</span>
<a href="#l2.4"></a><span id="l2.4">                             &quot;askSendFormatDialog&quot;, &quot;chrome,modal,titlebar,centerscreen&quot;,</span>
<a href="#l2.5"></a><span id="l2.5">                             result2);</span>
<a href="#l2.6"></a><span id="l2.6">           if (result2.abort)</span>
<a href="#l2.7"></a><span id="l2.7">             return;</span>
<a href="#l2.8"></a><span id="l2.8">           action = result2.action;</span>
<a href="#l2.9"></a><span id="l2.9">         }</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">         // we will remember the users &quot;send format&quot; decision</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        // in the address collector code (see nsAbAddressCollecter::CollectAddress())</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+        // in the address collector code (see nsAbAddressCollector::CollectAddress())</span>
<a href="#l2.14"></a><span id="l2.14">         // by using msgCompFields.forcePlainText and msgCompFields.useMultipartAlternative</span>
<a href="#l2.15"></a><span id="l2.15">         // to determine the nsIAbPreferMailFormat (unknown, plaintext, or html)</span>
<a href="#l2.16"></a><span id="l2.16">         // if the user sends both, we remember html.</span>
<a href="#l2.17"></a><span id="l2.17">         switch (action)</span>
<a href="#l2.18"></a><span id="l2.18">         {</span>
<a href="#l2.19"></a><span id="l2.19">           case nsIMsgCompSendFormat.PlainText:</span>
<a href="#l2.20"></a><span id="l2.20">             msgCompFields.forcePlainText = true;</span>
<a href="#l2.21"></a><span id="l2.21">             msgCompFields.useMultipartAlternative = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/build/nsAbFactory.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/build/nsAbFactory.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -54,17 +54,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #include &quot;nsAbMDBDirectory.h&quot;</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;nsAbMDBCard.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #include &quot;nsAbDirFactoryService.h&quot;</span>
<a href="#l3.7"></a><span id="l3.7"> #include &quot;nsAbMDBDirFactory.h&quot;</span>
<a href="#l3.8"></a><span id="l3.8"> #include &quot;nsAddrDatabase.h&quot;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &quot;nsAbManager.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsAbContentHandler.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsAbDirProperty.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#include &quot;nsAbAddressCollecter.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#include &quot;nsAbAddressCollector.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> #include &quot;nsAddbookProtocolHandler.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15"> #include &quot;nsAddbookUrl.h&quot;</span>
<a href="#l3.16"></a><span id="l3.16"> #include &quot;nsCURILoader.h&quot;</span>
<a href="#l3.17"></a><span id="l3.17"> </span>
<a href="#l3.18"></a><span id="l3.18"> #include &quot;nsAbDirectoryQuery.h&quot;</span>
<a href="#l3.19"></a><span id="l3.19"> #include &quot;nsAbBooleanExpression.h&quot;</span>
<a href="#l3.20"></a><span id="l3.20"> #include &quot;nsAbDirectoryQueryProxy.h&quot;</span>
<a href="#l3.21"></a><span id="l3.21"> #include &quot;nsAbView.h&quot;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -103,17 +103,17 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbManag</span>
<a href="#l3.23"></a><span id="l3.23"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbContentHandler)</span>
<a href="#l3.24"></a><span id="l3.24"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbDirectoryDataSource,Init)</span>
<a href="#l3.25"></a><span id="l3.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirProperty)</span>
<a href="#l3.26"></a><span id="l3.26"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbCardProperty)</span>
<a href="#l3.27"></a><span id="l3.27"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbBSDirectory)</span>
<a href="#l3.28"></a><span id="l3.28"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirectory)</span>
<a href="#l3.29"></a><span id="l3.29"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBCard)</span>
<a href="#l3.30"></a><span id="l3.30"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddrDatabase)</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbAddressCollecter,Init)</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbAddressCollector,Init)</span>
<a href="#l3.33"></a><span id="l3.33"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookUrl)</span>
<a href="#l3.34"></a><span id="l3.34"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirFactoryService)</span>
<a href="#l3.35"></a><span id="l3.35"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirFactory)</span>
<a href="#l3.36"></a><span id="l3.36"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookProtocolHandler)</span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38"> #if defined(XP_WIN) &amp;&amp; !defined(__MINGW32__)</span>
<a href="#l3.39"></a><span id="l3.39"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOutlookDirectory)</span>
<a href="#l3.40"></a><span id="l3.40"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOutlookCard)</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineat">@@ -223,19 +223,19 @@ static const nsModuleComponentInfo compo</span>
<a href="#l3.42"></a><span id="l3.42">     NS_ABCARDPROPERTY_CONTRACTID,</span>
<a href="#l3.43"></a><span id="l3.43">     nsAbCardPropertyConstructor },</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45">   { &quot;Address Book Directory Property&quot;,</span>
<a href="#l3.46"></a><span id="l3.46">     NS_ABDIRPROPERTY_CID,</span>
<a href="#l3.47"></a><span id="l3.47">     NS_ABDIRPROPERTY_CONTRACTID,</span>
<a href="#l3.48"></a><span id="l3.48">     nsAbDirPropertyConstructor },</span>
<a href="#l3.49"></a><span id="l3.49">   { &quot;Address Book Address Collector&quot;,</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-    NS_ABADDRESSCOLLECTER_CID,</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-    NS_ABADDRESSCOLLECTER_CONTRACTID,</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-    nsAbAddressCollecterConstructor },</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+    NS_ABADDRESSCOLLECTOR_CID,</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+    NS_ABADDRESSCOLLECTOR_CONTRACTID,</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+    nsAbAddressCollectorConstructor },</span>
<a href="#l3.56"></a><span id="l3.56">   { &quot;The addbook URL Interface&quot;, </span>
<a href="#l3.57"></a><span id="l3.57">     NS_ADDBOOKURL_CID,</span>
<a href="#l3.58"></a><span id="l3.58">     NS_ADDBOOKURL_CONTRACTID,</span>
<a href="#l3.59"></a><span id="l3.59">     nsAddbookUrlConstructor },</span>
<a href="#l3.60"></a><span id="l3.60">     </span>
<a href="#l3.61"></a><span id="l3.61">   { &quot;The addbook Protocol Handler&quot;, </span>
<a href="#l3.62"></a><span id="l3.62">     NS_ADDBOOK_HANDLER_CID,</span>
<a href="#l3.63"></a><span id="l3.63">     NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX &quot;addbook&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/public/Makefile.in</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/public/Makefile.in</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -51,17 +51,17 @@ XPIDLSRCS	= \</span>
<a href="#l4.4"></a><span id="l4.4"> 		nsIAbCollection.idl \</span>
<a href="#l4.5"></a><span id="l4.5"> 		nsIAbCard.idl \</span>
<a href="#l4.6"></a><span id="l4.6"> 		nsIAbDirectory.idl \</span>
<a href="#l4.7"></a><span id="l4.7"> 		nsIAbMDBDirectory.idl \</span>
<a href="#l4.8"></a><span id="l4.8"> 		nsIAddrDBAnnouncer.idl \</span>
<a href="#l4.9"></a><span id="l4.9"> 		nsIAddrDBListener.idl \</span>
<a href="#l4.10"></a><span id="l4.10"> 		nsIAddrDatabase.idl \</span>
<a href="#l4.11"></a><span id="l4.11"> 		nsIAbManager.idl \</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-		nsIAbAddressCollecter.idl \</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+		nsIAbAddressCollector.idl \</span>
<a href="#l4.14"></a><span id="l4.14"> 		nsIAddbookUrl.idl \</span>
<a href="#l4.15"></a><span id="l4.15"> 		nsIAbDirFactory.idl	\</span>
<a href="#l4.16"></a><span id="l4.16"> 		nsIAbDirFactoryService.idl	\</span>
<a href="#l4.17"></a><span id="l4.17">                 nsIAbDirectoryQueryProxy.idl \</span>
<a href="#l4.18"></a><span id="l4.18"> 		nsIAbDirectoryQuery.idl	\</span>
<a href="#l4.19"></a><span id="l4.19"> 		nsIAbBooleanExpression.idl \</span>
<a href="#l4.20"></a><span id="l4.20"> 		nsIAbDirectorySearch.idl \</span>
<a href="#l4.21"></a><span id="l4.21"> 		nsIAbView.idl \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/public/nsAbBaseCID.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsAbBaseCID.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -164,24 +164,24 @@</span>
<a href="#l5.4"></a><span id="l5.4">   &quot;@mozilla.org/addressbook/properties;1&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> #define NS_ABDIRECTORYPROPERTIES_CID						\</span>
<a href="#l5.6"></a><span id="l5.6"> { /* 8b00a972-1dd2-11b2-9d9c-9c377a9c3dba */		\</span>
<a href="#l5.7"></a><span id="l5.7">     0x8b00a972, 0x1dd2, 0x11b2, \</span>
<a href="#l5.8"></a><span id="l5.8">     {0x9d, 0x9c, 0x9c, 0x37, 0x7a, 0x9c, 0x3d, 0xba} \</span>
<a href="#l5.9"></a><span id="l5.9"> }</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> //</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-// nsAbAddressCollecter</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+// nsAbAddressCollector</span>
<a href="#l5.14"></a><span id="l5.14"> //</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-#define NS_ABADDRESSCOLLECTER_CONTRACTID \</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-  &quot;@mozilla.org/addressbook/services/addressCollecter;1&quot;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-#define NS_ABADDRESSCOLLECTER_CID \</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-{	/* fe04c8e6-501e-11d3-a527-0060b0fc04b7 */		\</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-	0xfe04c8e6, 0x501e, 0x11d3,						\</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-	{0xa5, 0x27, 0x0, 0x60, 0xb0, 0xfc, 0x4, 0xb7}	\</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+#define NS_ABADDRESSCOLLECTOR_CONTRACTID \</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+  &quot;@mozilla.org/addressbook/services/addressCollector;1&quot;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+#define NS_ABADDRESSCOLLECTOR_CID \</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+{	/* e7702d5a-99d8-4648-bab7-919ea29f30b6 */ \</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+	0xe7702d5a, 0x99d8, 0x4648,	\</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+	{0xba, 0xb7, 0x91, 0x9e, 0xa2, 0x9f, 0x30, 0xb6}	\</span>
<a href="#l5.27"></a><span id="l5.27"> }</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29"> //</span>
<a href="#l5.30"></a><span id="l5.30"> // addbook URL</span>
<a href="#l5.31"></a><span id="l5.31"> //</span>
<a href="#l5.32"></a><span id="l5.32"> #define NS_ADDBOOKURL_CONTRACTID \</span>
<a href="#l5.33"></a><span id="l5.33">   &quot;@mozilla.org/addressbook/services/url;1?type=addbook&quot;</span>
<a href="#l5.34"></a><span id="l5.34"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">rename from mailnews/addrbook/public/nsIAbAddressCollecter.idl</span>
<a href="#l6.2"></a><span id="l6.2">rename to mailnews/addrbook/public/nsIAbAddressCollector.idl</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbAddressCollecter.idl</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbAddressCollector.idl</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineat">@@ -37,22 +37,22 @@</span>
<a href="#l6.6"></a><span id="l6.6">  *</span>
<a href="#l6.7"></a><span id="l6.7">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l6.10"></a><span id="l6.10"> </span>
<a href="#l6.11"></a><span id="l6.11"> interface nsIAbCard;</span>
<a href="#l6.12"></a><span id="l6.12"> </span>
<a href="#l6.13"></a><span id="l6.13"> /**</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">- * nsIAbAddressCollecter is the interface to the address collecter service.</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+ * nsIAbAddressCollector is the interface to the address collecter service.</span>
<a href="#l6.16"></a><span id="l6.16">  * It will save and update the supplied addresses into the address book</span>
<a href="#l6.17"></a><span id="l6.17">  * specified by the &quot;mail.collect_addressbook&quot; pref.</span>
<a href="#l6.18"></a><span id="l6.18">  */</span>
<a href="#l6.19"></a><span id="l6.19"> [scriptable, uuid(db4eb202-5dec-48d5-b853-b46d8d5bb055)]</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-interface nsIAbAddressCollecter : nsISupports {</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+interface nsIAbAddressCollector : nsISupports {</span>
<a href="#l6.22"></a><span id="l6.22">   /**</span>
<a href="#l6.23"></a><span id="l6.23">    * Collects email addresses into the address book.</span>
<a href="#l6.24"></a><span id="l6.24">    * If a card already exists for the email, the first/last/display names</span>
<a href="#l6.25"></a><span id="l6.25">    * will be updated if they are supplied alongside the address.</span>
<a href="#l6.26"></a><span id="l6.26">    * If a card does not exist for the email it will be created if aCreateCard</span>
<a href="#l6.27"></a><span id="l6.27">    * is true.</span>
<a href="#l6.28"></a><span id="l6.28">    * </span>
<a href="#l6.29"></a><span id="l6.29">    * @param  aAddresses  The list of emails (in standard header format)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/src/Makefile.in</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/src/Makefile.in</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -75,17 +75,17 @@ REQUIRES	= xpcom \</span>
<a href="#l7.4"></a><span id="l7.4"> CPPSRCS		= \</span>
<a href="#l7.5"></a><span id="l7.5"> 		nsAbManager.cpp \</span>
<a href="#l7.6"></a><span id="l7.6"> 		nsAbRDFDataSource.cpp \</span>
<a href="#l7.7"></a><span id="l7.7"> 		nsDirectoryDataSource.cpp \</span>
<a href="#l7.8"></a><span id="l7.8"> 		nsAbCardProperty.cpp \</span>
<a href="#l7.9"></a><span id="l7.9"> 		nsDirPrefs.cpp \</span>
<a href="#l7.10"></a><span id="l7.10"> 		nsAddrDatabase.cpp \</span>
<a href="#l7.11"></a><span id="l7.11"> 		nsAbDirProperty.cpp \</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-		nsAbAddressCollecter.cpp \</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+		nsAbAddressCollector.cpp \</span>
<a href="#l7.14"></a><span id="l7.14"> 		nsAddbookProtocolHandler.cpp  \</span>
<a href="#l7.15"></a><span id="l7.15"> 		nsAbMDBDirProperty.cpp \</span>
<a href="#l7.16"></a><span id="l7.16"> 		nsAbMDBDirectory.cpp \</span>
<a href="#l7.17"></a><span id="l7.17"> 		nsAbMDBCard.cpp \</span>
<a href="#l7.18"></a><span id="l7.18"> 		nsAbBSDirectory.cpp \</span>
<a href="#l7.19"></a><span id="l7.19"> 		nsAddbookUrl.cpp    \</span>
<a href="#l7.20"></a><span id="l7.20"> 		nsAbDirFactoryService.cpp	\</span>
<a href="#l7.21"></a><span id="l7.21"> 		nsAbMDBDirFactory.cpp	\</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">rename from mailnews/addrbook/src/nsAbAddressCollecter.cpp</span>
<a href="#l8.2"></a><span id="l8.2">rename to mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAddressCollecter.cpp</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineat">@@ -36,60 +36,60 @@</span>
<a href="#l8.6"></a><span id="l8.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.7"></a><span id="l8.7">  *</span>
<a href="#l8.8"></a><span id="l8.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;msgCore.h&quot;  // for pre-compiled headers</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-#include &quot;nsAbAddressCollecter.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+#include &quot;nsAbAddressCollector.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17"> #include &quot;nsIPrefBranch2.h&quot;</span>
<a href="#l8.18"></a><span id="l8.18"> #include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l8.19"></a><span id="l8.19"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l8.20"></a><span id="l8.20"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l8.21"></a><span id="l8.21"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l8.22"></a><span id="l8.22"> #include &quot;prmem.h&quot;</span>
<a href="#l8.23"></a><span id="l8.23"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l8.24"></a><span id="l8.24"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l8.25"></a><span id="l8.25"> #include &quot;nsIAbMDBDirectory.h&quot;</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27" class="difflineminus">-NS_IMPL_ISUPPORTS2(nsAbAddressCollecter, nsIAbAddressCollecter, nsIObserver)</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+NS_IMPL_ISUPPORTS2(nsAbAddressCollector, nsIAbAddressCollector, nsIObserver)</span>
<a href="#l8.29"></a><span id="l8.29"> </span>
<a href="#l8.30"></a><span id="l8.30"> #define PREF_MAIL_COLLECT_ADDRESSBOOK &quot;mail.collect_addressbook&quot;</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-nsAbAddressCollecter::nsAbAddressCollecter()</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+nsAbAddressCollector::nsAbAddressCollector()</span>
<a href="#l8.34"></a><span id="l8.34"> {</span>
<a href="#l8.35"></a><span id="l8.35"> }</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-nsAbAddressCollecter::~nsAbAddressCollecter()</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+nsAbAddressCollector::~nsAbAddressCollector()</span>
<a href="#l8.39"></a><span id="l8.39"> {</span>
<a href="#l8.40"></a><span id="l8.40">   nsresult rv;</span>
<a href="#l8.41"></a><span id="l8.41">   nsCOMPtr&lt;nsIPrefBranch2&gt; pPrefBranchInt(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l8.42"></a><span id="l8.42">   if(NS_SUCCEEDED(rv))</span>
<a href="#l8.43"></a><span id="l8.43">     pPrefBranchInt-&gt;RemoveObserver(PREF_MAIL_COLLECT_ADDRESSBOOK, this);</span>
<a href="#l8.44"></a><span id="l8.44"> }</span>
<a href="#l8.45"></a><span id="l8.45"> </span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-NS_IMETHODIMP nsAbAddressCollecter::GetCardFromAttribute(const nsACString &amp;aName, const nsACString &amp;aValue, nsIAbCard **aCard)</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+NS_IMETHODIMP nsAbAddressCollector::GetCardFromAttribute(const nsACString &amp;aName, const nsACString &amp;aValue, nsIAbCard **aCard)</span>
<a href="#l8.48"></a><span id="l8.48"> {</span>
<a href="#l8.49"></a><span id="l8.49">   NS_ENSURE_ARG_POINTER(aCard);</span>
<a href="#l8.50"></a><span id="l8.50">   if (m_database)</span>
<a href="#l8.51"></a><span id="l8.51">     // Please DO NOT change the 3rd param of GetCardFromAttribute() call to </span>
<a href="#l8.52"></a><span id="l8.52">     // PR_TRUE (i.e. case insensitive) without reading bugs #128535 and #121478.</span>
<a href="#l8.53"></a><span id="l8.53">     return m_database-&gt;GetCardFromAttribute(m_directory.get(),</span>
<a href="#l8.54"></a><span id="l8.54">                                             PromiseFlatCString(aName).get(),</span>
<a href="#l8.55"></a><span id="l8.55">                                             aValue, PR_FALSE /* retain case */,</span>
<a href="#l8.56"></a><span id="l8.56">                                             aCard);</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58">   return NS_ERROR_FAILURE;</span>
<a href="#l8.59"></a><span id="l8.59"> }</span>
<a href="#l8.60"></a><span id="l8.60"> </span>
<a href="#l8.61"></a><span id="l8.61"> NS_IMETHODIMP</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-nsAbAddressCollecter::CollectAddress(const nsACString &amp;aAddresses,</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+nsAbAddressCollector::CollectAddress(const nsACString &amp;aAddresses,</span>
<a href="#l8.64"></a><span id="l8.64">                                      PRBool aCreateCard,</span>
<a href="#l8.65"></a><span id="l8.65">                                      PRUint32 aSendFormat)</span>
<a href="#l8.66"></a><span id="l8.66"> {</span>
<a href="#l8.67"></a><span id="l8.67">   // note that we're now setting the whole recipient list,</span>
<a href="#l8.68"></a><span id="l8.68">   // not just the pretty name of the first recipient.</span>
<a href="#l8.69"></a><span id="l8.69">   PRUint32 numAddresses;</span>
<a href="#l8.70"></a><span id="l8.70">   char *names;</span>
<a href="#l8.71"></a><span id="l8.71">   char *addresses;</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineat">@@ -131,17 +131,17 @@ nsAbAddressCollecter::CollectAddress(con</span>
<a href="#l8.73"></a><span id="l8.73">   }</span>
<a href="#l8.74"></a><span id="l8.74"> </span>
<a href="#l8.75"></a><span id="l8.75">   PR_FREEIF(addresses);</span>
<a href="#l8.76"></a><span id="l8.76">   PR_FREEIF(names);</span>
<a href="#l8.77"></a><span id="l8.77">   return NS_OK;</span>
<a href="#l8.78"></a><span id="l8.78"> }</span>
<a href="#l8.79"></a><span id="l8.79"> </span>
<a href="#l8.80"></a><span id="l8.80"> NS_IMETHODIMP</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-nsAbAddressCollecter::CollectSingleAddress(const nsACString &amp;aEmail,</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+nsAbAddressCollector::CollectSingleAddress(const nsACString &amp;aEmail,</span>
<a href="#l8.83"></a><span id="l8.83">                                            const nsACString &amp;aDisplayName,</span>
<a href="#l8.84"></a><span id="l8.84">                                            PRBool aCreateCard,</span>
<a href="#l8.85"></a><span id="l8.85">                                            PRUint32 aSendFormat,</span>
<a href="#l8.86"></a><span id="l8.86">                                            PRBool aSkipCheckExisting)</span>
<a href="#l8.87"></a><span id="l8.87"> {</span>
<a href="#l8.88"></a><span id="l8.88">   nsresult rv;</span>
<a href="#l8.89"></a><span id="l8.89">   nsCOMPtr&lt;nsIAbCard&gt; card;</span>
<a href="#l8.90"></a><span id="l8.90">   PRBool emailAddressIn2ndEmailColumn = PR_FALSE;</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineat">@@ -209,17 +209,17 @@ nsAbAddressCollecter::CollectSingleAddre</span>
<a href="#l8.92"></a><span id="l8.92">       m_directory-&gt;ModifyCard(card);</span>
<a href="#l8.93"></a><span id="l8.93">   }</span>
<a href="#l8.94"></a><span id="l8.94"> </span>
<a href="#l8.95"></a><span id="l8.95">   return NS_OK;</span>
<a href="#l8.96"></a><span id="l8.96"> }</span>
<a href="#l8.97"></a><span id="l8.97"> </span>
<a href="#l8.98"></a><span id="l8.98"> // Works out the screen name to put on the card for some well-known addresses</span>
<a href="#l8.99"></a><span id="l8.99"> void</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineminus">-nsAbAddressCollecter::AutoCollectScreenName(nsIAbCard *aCard,</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+nsAbAddressCollector::AutoCollectScreenName(nsIAbCard *aCard,</span>
<a href="#l8.102"></a><span id="l8.102">                                             const nsACString &amp;aEmail)</span>
<a href="#l8.103"></a><span id="l8.103"> {</span>
<a href="#l8.104"></a><span id="l8.104">   if (!aCard)</span>
<a href="#l8.105"></a><span id="l8.105">     return;</span>
<a href="#l8.106"></a><span id="l8.106"> </span>
<a href="#l8.107"></a><span id="l8.107">   PRInt32 atPos = aEmail.FindChar('@');</span>
<a href="#l8.108"></a><span id="l8.108">   if (atPos == -1)</span>
<a href="#l8.109"></a><span id="l8.109">     return;</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineat">@@ -234,17 +234,17 @@ nsAbAddressCollecter::AutoCollectScreenN</span>
<a href="#l8.111"></a><span id="l8.111">   if (!domain.IsEmpty() &amp;&amp;</span>
<a href="#l8.112"></a><span id="l8.112">       (domain.Equals(&quot;aol.com&quot;) || domain.Equals(&quot;cs.com&quot;) ||</span>
<a href="#l8.113"></a><span id="l8.113">        domain.Equals(&quot;netscape.net&quot;)))</span>
<a href="#l8.114"></a><span id="l8.114">     aCard-&gt;SetPropertyAsAUTF8String(kScreenNameProperty, Substring(aEmail, 0, atPos));</span>
<a href="#l8.115"></a><span id="l8.115"> }</span>
<a href="#l8.116"></a><span id="l8.116"> </span>
<a href="#l8.117"></a><span id="l8.117"> // Returns true if the card was modified successfully.</span>
<a href="#l8.118"></a><span id="l8.118"> PRBool</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-nsAbAddressCollecter::SetNamesForCard(nsIAbCard *aSenderCard,</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+nsAbAddressCollector::SetNamesForCard(nsIAbCard *aSenderCard,</span>
<a href="#l8.121"></a><span id="l8.121">                                       const nsACString &amp;aFullName)</span>
<a href="#l8.122"></a><span id="l8.122"> {</span>
<a href="#l8.123"></a><span id="l8.123">   nsCString firstName;</span>
<a href="#l8.124"></a><span id="l8.124">   nsCString lastName;</span>
<a href="#l8.125"></a><span id="l8.125">   PRBool modifiedCard = PR_FALSE;</span>
<a href="#l8.126"></a><span id="l8.126"> </span>
<a href="#l8.127"></a><span id="l8.127">   if (NS_SUCCEEDED(aSenderCard-&gt;SetDisplayName(NS_ConvertUTF8toUTF16(aFullName))))</span>
<a href="#l8.128"></a><span id="l8.128">     modifiedCard = PR_TRUE;</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineat">@@ -260,64 +260,64 @@ nsAbAddressCollecter::SetNamesForCard(ns</span>
<a href="#l8.130"></a><span id="l8.130">       NS_SUCCEEDED(aSenderCard-&gt;SetLastName(NS_ConvertUTF8toUTF16(lastName))))</span>
<a href="#l8.131"></a><span id="l8.131">     modifiedCard = PR_TRUE;</span>
<a href="#l8.132"></a><span id="l8.132"> </span>
<a href="#l8.133"></a><span id="l8.133">   return modifiedCard;</span>
<a href="#l8.134"></a><span id="l8.134"> }</span>
<a href="#l8.135"></a><span id="l8.135"> </span>
<a href="#l8.136"></a><span id="l8.136"> // Splits the first and last name based on the space between them.</span>
<a href="#l8.137"></a><span id="l8.137"> void</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineminus">-nsAbAddressCollecter::SplitFullName(const nsCString &amp;aFullName, nsCString &amp;aFirstName,</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineplus">+nsAbAddressCollector::SplitFullName(const nsCString &amp;aFullName, nsCString &amp;aFirstName,</span>
<a href="#l8.140"></a><span id="l8.140">                                     nsCString &amp;aLastName)</span>
<a href="#l8.141"></a><span id="l8.141"> {</span>
<a href="#l8.142"></a><span id="l8.142">   int index = aFullName.RFindChar(' ');</span>
<a href="#l8.143"></a><span id="l8.143">   if (index != -1)</span>
<a href="#l8.144"></a><span id="l8.144">   {</span>
<a href="#l8.145"></a><span id="l8.145">     aLastName = Substring(aFullName, index + 1);</span>
<a href="#l8.146"></a><span id="l8.146">     aFirstName = Substring(aFullName, 0, index);</span>
<a href="#l8.147"></a><span id="l8.147">   }</span>
<a href="#l8.148"></a><span id="l8.148"> }</span>
<a href="#l8.149"></a><span id="l8.149"> </span>
<a href="#l8.150"></a><span id="l8.150"> // Observes the collected address book pref in case it changes.</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineminus">-NS_IMETHODIMP nsAbAddressCollecter::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineplus">+NS_IMETHODIMP nsAbAddressCollector::Observe(nsISupports *aSubject, const char *aTopic, const PRUnichar *aData)</span>
<a href="#l8.153"></a><span id="l8.153"> {</span>
<a href="#l8.154"></a><span id="l8.154">   nsCOMPtr&lt;nsIPrefBranch2&gt; pPrefBranchInt = do_QueryInterface(aSubject);</span>
<a href="#l8.155"></a><span id="l8.155">   if (!pPrefBranchInt) {</span>
<a href="#l8.156"></a><span id="l8.156">     NS_ASSERTION(pPrefBranchInt, &quot;failed to get prefs&quot;);</span>
<a href="#l8.157"></a><span id="l8.157">     return NS_OK;</span>
<a href="#l8.158"></a><span id="l8.158">   }</span>
<a href="#l8.159"></a><span id="l8.159"> </span>
<a href="#l8.160"></a><span id="l8.160">   nsresult rv;</span>
<a href="#l8.161"></a><span id="l8.161">   nsCString prefVal;</span>
<a href="#l8.162"></a><span id="l8.162">   pPrefBranchInt-&gt;GetCharPref(PREF_MAIL_COLLECT_ADDRESSBOOK,</span>
<a href="#l8.163"></a><span id="l8.163">                               getter_Copies(prefVal));</span>
<a href="#l8.164"></a><span id="l8.164">   rv = SetAbURI(prefVal);</span>
<a href="#l8.165"></a><span id="l8.165">   NS_ASSERTION(NS_SUCCEEDED(rv),&quot;failed to change collected ab&quot;);</span>
<a href="#l8.166"></a><span id="l8.166">   return NS_OK;</span>
<a href="#l8.167"></a><span id="l8.167"> }</span>
<a href="#l8.168"></a><span id="l8.168"> </span>
<a href="#l8.169"></a><span id="l8.169" class="difflineminus">-// Initialises the collecter with the required items.</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineminus">-nsresult nsAbAddressCollecter::Init(void)</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineplus">+// Initialises the collector with the required items.</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineplus">+nsresult nsAbAddressCollector::Init(void)</span>
<a href="#l8.173"></a><span id="l8.173"> {</span>
<a href="#l8.174"></a><span id="l8.174">   nsresult rv;</span>
<a href="#l8.175"></a><span id="l8.175">   nsCOMPtr&lt;nsIPrefBranch2&gt; pPrefBranchInt(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l8.176"></a><span id="l8.176">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.177"></a><span id="l8.177"> </span>
<a href="#l8.178"></a><span id="l8.178">   rv = pPrefBranchInt-&gt;AddObserver(PREF_MAIL_COLLECT_ADDRESSBOOK, this, PR_FALSE);</span>
<a href="#l8.179"></a><span id="l8.179">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.180"></a><span id="l8.180"> </span>
<a href="#l8.181"></a><span id="l8.181">   nsCString prefVal;</span>
<a href="#l8.182"></a><span id="l8.182">   pPrefBranchInt-&gt;GetCharPref(PREF_MAIL_COLLECT_ADDRESSBOOK,</span>
<a href="#l8.183"></a><span id="l8.183">                               getter_Copies(prefVal));</span>
<a href="#l8.184"></a><span id="l8.184">   return SetAbURI(prefVal);</span>
<a href="#l8.185"></a><span id="l8.185"> }</span>
<a href="#l8.186"></a><span id="l8.186"> </span>
<a href="#l8.187"></a><span id="l8.187" class="difflineminus">-// Performs the necessary changes to set up the collecter for the specified</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineplus">+// Performs the necessary changes to set up the collector for the specified</span>
<a href="#l8.189"></a><span id="l8.189"> // collected address book.</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineminus">-nsresult nsAbAddressCollecter::SetAbURI(nsCString &amp;aURI)</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+nsresult nsAbAddressCollector::SetAbURI(nsCString &amp;aURI)</span>
<a href="#l8.192"></a><span id="l8.192"> {</span>
<a href="#l8.193"></a><span id="l8.193">   if (aURI.IsEmpty())</span>
<a href="#l8.194"></a><span id="l8.194">     aURI.AssignLiteral(kPersonalAddressbookUri);</span>
<a href="#l8.195"></a><span id="l8.195"> </span>
<a href="#l8.196"></a><span id="l8.196">   if (aURI == m_abURI)</span>
<a href="#l8.197"></a><span id="l8.197">     return NS_OK;</span>
<a href="#l8.198"></a><span id="l8.198"> </span>
<a href="#l8.199"></a><span id="l8.199">   m_database = nsnull;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">rename from mailnews/addrbook/src/nsAbAddressCollecter.h</span>
<a href="#l9.2"></a><span id="l9.2">rename to mailnews/addrbook/src/nsAbAddressCollector.h</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAddressCollecter.h</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbAddressCollector.h</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineat">@@ -1,9 +1,9 @@</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-/* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+/* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.8"></a><span id="l9.8"> /* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.9"></a><span id="l9.9">  * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.10"></a><span id="l9.10">  *</span>
<a href="#l9.11"></a><span id="l9.11">  * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.12"></a><span id="l9.12">  * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.13"></a><span id="l9.13">  * the License. You may obtain a copy of the License at</span>
<a href="#l9.14"></a><span id="l9.14">  * http://www.mozilla.org/MPL/</span>
<a href="#l9.15"></a><span id="l9.15">  *</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineat">@@ -31,44 +31,44 @@</span>
<a href="#l9.17"></a><span id="l9.17">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.18"></a><span id="l9.18">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.19"></a><span id="l9.19">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.20"></a><span id="l9.20">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.21"></a><span id="l9.21">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.22"></a><span id="l9.22">  *</span>
<a href="#l9.23"></a><span id="l9.23">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-#ifndef _nsAbAddressCollecter_H_</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-#define _nsAbAddressCollecter_H_</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+#ifndef _nsAbAddressCollector_H_</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+#define _nsAbAddressCollector_H_</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-#include &quot;nsIAbAddressCollecter.h&quot;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+#include &quot;nsIAbAddressCollector.h&quot;</span>
<a href="#l9.32"></a><span id="l9.32"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l9.33"></a><span id="l9.33"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l9.34"></a><span id="l9.34"> #include &quot;nsIAbDirectory.h&quot;</span>
<a href="#l9.35"></a><span id="l9.35"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l9.36"></a><span id="l9.36"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l9.37"></a><span id="l9.37"> </span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-class nsAbAddressCollecter : public nsIAbAddressCollecter,</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+class nsAbAddressCollector : public nsIAbAddressCollector,</span>
<a href="#l9.40"></a><span id="l9.40">                              public nsIObserver</span>
<a href="#l9.41"></a><span id="l9.41"> {</span>
<a href="#l9.42"></a><span id="l9.42"> public:</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineminus">-  nsAbAddressCollecter();</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineminus">-  virtual ~nsAbAddressCollecter();</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+  nsAbAddressCollector();</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+  virtual ~nsAbAddressCollector();</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48">   NS_DECL_ISUPPORTS</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineminus">-  NS_DECL_NSIABADDRESSCOLLECTER</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+  NS_DECL_NSIABADDRESSCOLLECTOR</span>
<a href="#l9.51"></a><span id="l9.51">   NS_DECL_NSIOBSERVER</span>
<a href="#l9.52"></a><span id="l9.52"> </span>
<a href="#l9.53"></a><span id="l9.53">   nsresult Init();</span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55"> private:</span>
<a href="#l9.56"></a><span id="l9.56">   void AutoCollectScreenName(nsIAbCard *aCard, const nsACString &amp;aEmail);</span>
<a href="#l9.57"></a><span id="l9.57">   PRBool SetNamesForCard(nsIAbCard *aSenderCard, const nsACString &amp;aFullName);</span>
<a href="#l9.58"></a><span id="l9.58">   void SplitFullName(const nsCString &amp;aFullName, nsCString &amp;aFirstName,</span>
<a href="#l9.59"></a><span id="l9.59">                      nsCString &amp;aLastName);</span>
<a href="#l9.60"></a><span id="l9.60">   nsresult SetAbURI(nsCString &amp;aURI);</span>
<a href="#l9.61"></a><span id="l9.61">   nsCOMPtr &lt;nsIAddrDatabase&gt; m_database;</span>
<a href="#l9.62"></a><span id="l9.62">   nsCOMPtr &lt;nsIAbDirectory&gt; m_directory;</span>
<a href="#l9.63"></a><span id="l9.63">   nsCString m_abURI;</span>
<a href="#l9.64"></a><span id="l9.64"> };</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-#endif  // _nsAbAddressCollecter_H_</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+#endif  // _nsAbAddressCollector_H_</span>
<a href="#l9.68"></a><span id="l9.68"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_collection.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_collection.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.5"></a><span id="l10.5"> /*</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">- * Test suite for the Address Collecter Service.</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ * Test suite for the Address Collector Service.</span>
<a href="#l10.8"></a><span id="l10.8">  *</span>
<a href="#l10.9"></a><span id="l10.9">  * XXX Todo: May still need to add test for</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">- * nsIAbAddressCollecter::getCardFromAttribute if its kept.</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+ * nsIAbAddressCollector::getCardFromAttribute if its kept.</span>
<a href="#l10.12"></a><span id="l10.12">  */</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14"> const nsIAbPMF = Components.interfaces.nsIAbPreferMailFormat;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> // Source fields (emailHeader/mailFormat) and expected results for use for</span>
<a href="#l10.17"></a><span id="l10.17"> // testing the addition of new addresses to the database.</span>
<a href="#l10.18"></a><span id="l10.18"> //</span>
<a href="#l10.19"></a><span id="l10.19"> // Note: these email addresses should be different to allow collecting an</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineat">@@ -263,18 +263,18 @@ function run_test()</span>
<a href="#l10.21"></a><span id="l10.21"> </span>
<a href="#l10.22"></a><span id="l10.22">   // Get the actual AB for the collector so we can check cards have been</span>
<a href="#l10.23"></a><span id="l10.23">   // added.</span>
<a href="#l10.24"></a><span id="l10.24">   collectChecker.AB =</span>
<a href="#l10.25"></a><span id="l10.25">     abManager.getDirectory(prefService.getCharPref(&quot;mail.collect_addressbook&quot;));</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">   // Get the actual collecter</span>
<a href="#l10.28"></a><span id="l10.28">   collectChecker.addressCollect =</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-    Components.classes[&quot;@mozilla.org/addressbook/services/addressCollecter;1&quot;]</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-              .getService(Components.interfaces.nsIAbAddressCollecter);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+    Components.classes[&quot;@mozilla.org/addressbook/services/addressCollector;1&quot;]</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+              .getService(Components.interfaces.nsIAbAddressCollector);</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34">   // Test - Addition of header without email address.</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36">   collectChecker.addressCollect.collectAddress(&quot;MyTest &lt;&gt;&quot;, true,</span>
<a href="#l10.37"></a><span id="l10.37">                                                nsIAbPMF.unknown);</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39">   // Address book should have no cards present.</span>
<a href="#l10.40"></a><span id="l10.40">   do_check_false(collectChecker.AB.childCards.hasMoreElements());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/resources/content/msgHdrViewOverlay.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/resources/content/msgHdrViewOverlay.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -48,17 +48,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> // the message headers for a selected message remain as fast as possible. In particular, </span>
<a href="#l11.5"></a><span id="l11.5"> // right now, we only introduce one reflow per message. i.e. if you click on a message in the thread</span>
<a href="#l11.6"></a><span id="l11.6"> // pane, we batch up all the changes for displaying the header pane (to, cc, attachements button, etc.) </span>
<a href="#l11.7"></a><span id="l11.7"> // and we make a single pass to display them. It's critical that we maintain this one reflow per message</span>
<a href="#l11.8"></a><span id="l11.8"> // view in the message header pane. </span>
<a href="#l11.9"></a><span id="l11.9"> ////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11"> const msgHeaderParserContractID      = &quot;@mozilla.org/messenger/headerparser;1&quot;;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-const abAddressCollectorContractID   = &quot;@mozilla.org/addressbook/services/addressCollecter;1&quot;;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+const abAddressCollectorContractID   = &quot;@mozilla.org/addressbook/services/addressCollector;1&quot;;</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15"> var gViewAllHeaders = false;</span>
<a href="#l11.16"></a><span id="l11.16"> var gShowOrganization = false;</span>
<a href="#l11.17"></a><span id="l11.17"> var gShowUserAgent = false;</span>
<a href="#l11.18"></a><span id="l11.18"> var gShowReferences = false;</span>
<a href="#l11.19"></a><span id="l11.19"> var gShowMessageId = false;</span>
<a href="#l11.20"></a><span id="l11.20"> var gCollectIncoming = false;</span>
<a href="#l11.21"></a><span id="l11.21"> var gCollectOutgoing = false;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -427,17 +427,17 @@ var messageHeaderSink = {</span>
<a href="#l11.23"></a><span id="l11.23">           {</span>
<a href="#l11.24"></a><span id="l11.24">             try</span>
<a href="#l11.25"></a><span id="l11.25">             {</span>
<a href="#l11.26"></a><span id="l11.26">               var createCard = (gCollectIncoming &amp;&amp; !dontCollectAddress) || (gCollectNewsgroup &amp;&amp; dontCollectAddress);</span>
<a href="#l11.27"></a><span id="l11.27">               if (createCard || gCollectOutgoing)</span>
<a href="#l11.28"></a><span id="l11.28">               {</span>
<a href="#l11.29"></a><span id="l11.29">                 if (!abAddressCollector)</span>
<a href="#l11.30"></a><span id="l11.30">                   abAddressCollector = Components.classes[abAddressCollectorContractID]</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-                                                 .getService(Components.interfaces.nsIAbAddressCollecter);</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+                                                 .getService(Components.interfaces.nsIAbAddressCollector);</span>
<a href="#l11.33"></a><span id="l11.33"> </span>
<a href="#l11.34"></a><span id="l11.34">                 gCollectAddress = header.headerValue;</span>
<a href="#l11.35"></a><span id="l11.35">                 // collect, add card if doesn't exist and gCollectOutgoing is set, </span>
<a href="#l11.36"></a><span id="l11.36">                 // otherwise only update existing cards, unknown preferred send format</span>
<a href="#l11.37"></a><span id="l11.37">                 gCollectAddressTimer = setTimeout('abAddressCollector.collectAddress(gCollectAddress, ' + createCard + ', Components.interfaces.nsIAbPreferMailFormat.unknown);', 2000);</span>
<a href="#l11.38"></a><span id="l11.38">               }</span>
<a href="#l11.39"></a><span id="l11.39">             }</span>
<a href="#l11.40"></a><span id="l11.40">             catch(ex) {}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/build/nsMailModule.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/build/nsMailModule.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -126,17 +126,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> #include &quot;nsAbMDBDirectory.h&quot;</span>
<a href="#l12.5"></a><span id="l12.5"> #include &quot;nsAbMDBCard.h&quot;</span>
<a href="#l12.6"></a><span id="l12.6"> #include &quot;nsAbDirFactoryService.h&quot;</span>
<a href="#l12.7"></a><span id="l12.7"> #include &quot;nsAbMDBDirFactory.h&quot;</span>
<a href="#l12.8"></a><span id="l12.8"> #include &quot;nsAddrDatabase.h&quot;</span>
<a href="#l12.9"></a><span id="l12.9"> #include &quot;nsAbManager.h&quot;</span>
<a href="#l12.10"></a><span id="l12.10"> #include &quot;nsAbContentHandler.h&quot;</span>
<a href="#l12.11"></a><span id="l12.11"> #include &quot;nsAbDirProperty.h&quot;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-#include &quot;nsAbAddressCollecter.h&quot;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+#include &quot;nsAbAddressCollector.h&quot;</span>
<a href="#l12.14"></a><span id="l12.14"> #include &quot;nsAddbookProtocolHandler.h&quot;</span>
<a href="#l12.15"></a><span id="l12.15"> #include &quot;nsAddbookUrl.h&quot;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> #include &quot;nsAbDirectoryQuery.h&quot;</span>
<a href="#l12.18"></a><span id="l12.18"> #include &quot;nsAbBooleanExpression.h&quot;</span>
<a href="#l12.19"></a><span id="l12.19"> #include &quot;nsAbDirectoryQueryProxy.h&quot;</span>
<a href="#l12.20"></a><span id="l12.20"> #include &quot;nsAbView.h&quot;</span>
<a href="#l12.21"></a><span id="l12.21"> #include &quot;nsMsgVCardService.h&quot;</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -361,17 +361,17 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbManag</span>
<a href="#l12.23"></a><span id="l12.23"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbContentHandler)</span>
<a href="#l12.24"></a><span id="l12.24"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbDirectoryDataSource,Init)</span>
<a href="#l12.25"></a><span id="l12.25"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirProperty)</span>
<a href="#l12.26"></a><span id="l12.26"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbCardProperty)</span>
<a href="#l12.27"></a><span id="l12.27"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbBSDirectory)</span>
<a href="#l12.28"></a><span id="l12.28"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirectory)</span>
<a href="#l12.29"></a><span id="l12.29"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBCard)</span>
<a href="#l12.30"></a><span id="l12.30"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddrDatabase)</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbAddressCollecter,Init)</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsAbAddressCollector,Init)</span>
<a href="#l12.33"></a><span id="l12.33"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookUrl)</span>
<a href="#l12.34"></a><span id="l12.34"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbDirFactoryService)</span>
<a href="#l12.35"></a><span id="l12.35"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbMDBDirFactory)</span>
<a href="#l12.36"></a><span id="l12.36"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAddbookProtocolHandler)</span>
<a href="#l12.37"></a><span id="l12.37"> </span>
<a href="#l12.38"></a><span id="l12.38"> #if defined(XP_WIN) &amp;&amp; !defined(__MINGW32__)</span>
<a href="#l12.39"></a><span id="l12.39"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOutlookDirectory)</span>
<a href="#l12.40"></a><span id="l12.40"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsAbOutlookCard)</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -930,18 +930,18 @@ static const nsModuleComponentInfo gComp</span>
<a href="#l12.42"></a><span id="l12.42">     { &quot;Address MDB Book Card&quot;, NS_ABMDBCARD_CID,</span>
<a href="#l12.43"></a><span id="l12.43">        NS_ABMDBCARD_CONTRACTID, nsAbMDBCardConstructor },</span>
<a href="#l12.44"></a><span id="l12.44">     { &quot;Address Database&quot;, NS_ADDRDATABASE_CID,</span>
<a href="#l12.45"></a><span id="l12.45">       NS_ADDRDATABASE_CONTRACTID, nsAddrDatabaseConstructor },</span>
<a href="#l12.46"></a><span id="l12.46">     { &quot;Address Book Card Property&quot;, NS_ABCARDPROPERTY_CID,</span>
<a href="#l12.47"></a><span id="l12.47">       NS_ABCARDPROPERTY_CONTRACTID, nsAbCardPropertyConstructor },</span>
<a href="#l12.48"></a><span id="l12.48">     { &quot;Address Book Directory Property&quot;, NS_ABDIRPROPERTY_CID,</span>
<a href="#l12.49"></a><span id="l12.49">       NS_ABDIRPROPERTY_CONTRACTID, nsAbDirPropertyConstructor },</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-    { &quot;Address Book Address Collector&quot;, NS_ABADDRESSCOLLECTER_CID,</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-      NS_ABADDRESSCOLLECTER_CONTRACTID, nsAbAddressCollecterConstructor },</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+    { &quot;Address Book Address Collector&quot;, NS_ABADDRESSCOLLECTOR_CID,</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+      NS_ABADDRESSCOLLECTOR_CONTRACTID, nsAbAddressCollectorConstructor },</span>
<a href="#l12.54"></a><span id="l12.54">     { &quot;The addbook URL Interface&quot;, NS_ADDBOOKURL_CID,</span>
<a href="#l12.55"></a><span id="l12.55">       NS_ADDBOOKURL_CONTRACTID, nsAddbookUrlConstructor },</span>
<a href="#l12.56"></a><span id="l12.56">     { &quot;The addbook Protocol Handler&quot;, NS_ADDBOOK_HANDLER_CID,</span>
<a href="#l12.57"></a><span id="l12.57">       NS_NETWORK_PROTOCOL_CONTRACTID_PREFIX &quot;addbook&quot;, nsAddbookProtocolHandlerConstructor },</span>
<a href="#l12.58"></a><span id="l12.58">     { &quot;add vCard content handler&quot;, NS_ABCONTENTHANDLER_CID,</span>
<a href="#l12.59"></a><span id="l12.59">       NS_CONTENT_HANDLER_CONTRACTID_PREFIX&quot;application/x-addvcard&quot;,</span>
<a href="#l12.60"></a><span id="l12.60">       nsAbContentHandlerConstructor },</span>
<a href="#l12.61"></a><span id="l12.61">     { &quot;add vCard content handler&quot;, NS_ABCONTENTHANDLER_CID,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/compose/resources/content/MsgComposeCommands.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/compose/resources/content/MsgComposeCommands.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1766,17 +1766,17 @@ function GenericSendMessage( msgType )</span>
<a href="#l13.4"></a><span id="l13.4">                             &quot;askSendFormatDialog&quot;, &quot;chrome,modal,titlebar,centerscreen&quot;,</span>
<a href="#l13.5"></a><span id="l13.5">                             result2);</span>
<a href="#l13.6"></a><span id="l13.6">           if (result2.abort)</span>
<a href="#l13.7"></a><span id="l13.7">             return;</span>
<a href="#l13.8"></a><span id="l13.8">           action = result2.action;</span>
<a href="#l13.9"></a><span id="l13.9">         }</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">         // we will remember the users &quot;send format&quot; decision</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-        // in the address collector code (see nsAbAddressCollecter::CollectAddress())</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+        // in the address collector code (see nsAbAddressCollector::CollectAddress())</span>
<a href="#l13.14"></a><span id="l13.14">         // by using msgCompFields.forcePlainText and msgCompFields.useMultipartAlternative</span>
<a href="#l13.15"></a><span id="l13.15">         // to determine the nsIAbPreferMailFormat (unknown, plaintext, or html)</span>
<a href="#l13.16"></a><span id="l13.16">         // if the user sends both, we remember html.</span>
<a href="#l13.17"></a><span id="l13.17">         switch (action)</span>
<a href="#l13.18"></a><span id="l13.18">         {</span>
<a href="#l13.19"></a><span id="l13.19">           case nsIMsgCompSendFormat.PlainText:</span>
<a href="#l13.20"></a><span id="l13.20">             msgCompFields.forcePlainText = true;</span>
<a href="#l13.21"></a><span id="l13.21">             msgCompFields.useMultipartAlternative = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -70,17 +70,17 @@</span>
<a href="#l14.4"></a><span id="l14.4"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l14.5"></a><span id="l14.5"> #include &quot;nsIDOMHTMLLinkElement.h&quot;</span>
<a href="#l14.6"></a><span id="l14.6"> #include &quot;nsIDOMHTMLAnchorElement.h&quot;</span>
<a href="#l14.7"></a><span id="l14.7"> #include &quot;nsCExternalHandlerService.h&quot;</span>
<a href="#l14.8"></a><span id="l14.8"> #include &quot;nsIMIMEService.h&quot;</span>
<a href="#l14.9"></a><span id="l14.9"> #include &quot;nsIDocument.h&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> #include &quot;nsIDOMDocument.h&quot;</span>
<a href="#l14.11"></a><span id="l14.11"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#include &quot;nsIAbAddressCollecter.h&quot;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+#include &quot;nsIAbAddressCollector.h&quot;</span>
<a href="#l14.14"></a><span id="l14.14"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l14.15"></a><span id="l14.15"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l14.16"></a><span id="l14.16"> #include &quot;mozITXTToHTMLConv.h&quot;</span>
<a href="#l14.17"></a><span id="l14.17"> #include &quot;nsIMsgStatusFeedback.h&quot;</span>
<a href="#l14.18"></a><span id="l14.18"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l14.19"></a><span id="l14.19"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l14.20"></a><span id="l14.20"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l14.21"></a><span id="l14.21"> #include &quot;nsMailHeaders.h&quot;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -3508,20 +3508,20 @@ nsMsgComposeAndSend::DeliverFileAsMail()</span>
<a href="#l14.23"></a><span id="l14.23">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l14.24"></a><span id="l14.24">   }</span>
<a href="#l14.25"></a><span id="l14.25">   </span>
<a href="#l14.26"></a><span id="l14.26">   PRBool collectOutgoingAddresses = PR_TRUE;</span>
<a href="#l14.27"></a><span id="l14.27">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l14.28"></a><span id="l14.28">   if (pPrefBranch)</span>
<a href="#l14.29"></a><span id="l14.29">     pPrefBranch-&gt;GetBoolPref(PREF_MAIL_COLLECT_EMAIL_ADDRESS_OUTGOING, &amp;collectOutgoingAddresses);</span>
<a href="#l14.30"></a><span id="l14.30"> </span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  nsCOMPtr&lt;nsIAbAddressCollecter&gt; addressCollecter =</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-           do_GetService(NS_ABADDRESSCOLLECTER_CONTRACTID);</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-  PRBool collectAddresses = (collectOutgoingAddresses &amp;&amp; addressCollecter);</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+  nsCOMPtr&lt;nsIAbAddressCollector&gt; addressCollector =</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+           do_GetService(NS_ABADDRESSCOLLECTOR_CONTRACTID);</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+  PRBool collectAddresses = (collectOutgoingAddresses &amp;&amp; addressCollector);</span>
<a href="#l14.39"></a><span id="l14.39">   PRUint32 sendFormat = nsIAbPreferMailFormat::unknown;</span>
<a href="#l14.40"></a><span id="l14.40"> </span>
<a href="#l14.41"></a><span id="l14.41">   // this code is not ready yet</span>
<a href="#l14.42"></a><span id="l14.42">   // see bug #44494 for more details</span>
<a href="#l14.43"></a><span id="l14.43">   // so for now, just pass in nsIAbPreferMailFormat::unknown</span>
<a href="#l14.44"></a><span id="l14.44">   // which will have no effect on the &quot;prefers&quot; attribute in the ab</span>
<a href="#l14.45"></a><span id="l14.45"> #if 0</span>
<a href="#l14.46"></a><span id="l14.46">   PRBool forcePlainText = mCompFields-&gt;GetForcePlainText();</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineat">@@ -3546,32 +3546,32 @@ nsMsgComposeAndSend::DeliverFileAsMail()</span>
<a href="#l14.48"></a><span id="l14.48">     NS_ASSERTION(0,&quot;unknown send format, should not happen&quot;);</span>
<a href="#l14.49"></a><span id="l14.49"> #endif</span>
<a href="#l14.50"></a><span id="l14.50"> </span>
<a href="#l14.51"></a><span id="l14.51">   PL_strcpy (buf, &quot;&quot;);</span>
<a href="#l14.52"></a><span id="l14.52">   buf2 = buf + PL_strlen (buf);</span>
<a href="#l14.53"></a><span id="l14.53">   if (mCompFields-&gt;GetTo() &amp;&amp; *mCompFields-&gt;GetTo())</span>
<a href="#l14.54"></a><span id="l14.54">   {</span>
<a href="#l14.55"></a><span id="l14.55">     PL_strcat (buf2, mCompFields-&gt;GetTo());</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineminus">-    if (addressCollecter)</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineminus">-      addressCollecter-&gt;CollectAddress(nsCString(mCompFields-&gt;GetTo()), </span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+    if (addressCollector)</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+      addressCollector-&gt;CollectAddress(nsCString(mCompFields-&gt;GetTo()), </span>
<a href="#l14.60"></a><span id="l14.60">             collectAddresses /* create card if one doesn't exist */, sendFormat);</span>
<a href="#l14.61"></a><span id="l14.61">   }</span>
<a href="#l14.62"></a><span id="l14.62">   if (mCompFields-&gt;GetCc() &amp;&amp; *mCompFields-&gt;GetCc()) {</span>
<a href="#l14.63"></a><span id="l14.63">     if (*buf2) PL_strcat (buf2, &quot;,&quot;);</span>
<a href="#l14.64"></a><span id="l14.64">       PL_strcat (buf2, mCompFields-&gt;GetCc());</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-    if (addressCollecter)</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-      addressCollecter-&gt;CollectAddress(nsCString(mCompFields-&gt;GetCc()), </span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+    if (addressCollector)</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+      addressCollector-&gt;CollectAddress(nsCString(mCompFields-&gt;GetCc()), </span>
<a href="#l14.69"></a><span id="l14.69">             collectAddresses /* create card if one doesn't exist */, sendFormat);</span>
<a href="#l14.70"></a><span id="l14.70">   }</span>
<a href="#l14.71"></a><span id="l14.71">   if (mCompFields-&gt;GetBcc() &amp;&amp; *mCompFields-&gt;GetBcc()) {</span>
<a href="#l14.72"></a><span id="l14.72">     if (*buf2) PL_strcat (buf2, &quot;,&quot;);</span>
<a href="#l14.73"></a><span id="l14.73">       PL_strcat (buf2, mCompFields-&gt;GetBcc());</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineminus">-    if (addressCollecter)</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineminus">-      addressCollecter-&gt;CollectAddress(nsCString(mCompFields-&gt;GetBcc()), </span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+    if (addressCollector)</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+      addressCollector-&gt;CollectAddress(nsCString(mCompFields-&gt;GetBcc()), </span>
<a href="#l14.78"></a><span id="l14.78">             collectAddresses /* create card if one doesn't exist */, sendFormat);</span>
<a href="#l14.79"></a><span id="l14.79">   }</span>
<a href="#l14.80"></a><span id="l14.80"> </span>
<a href="#l14.81"></a><span id="l14.81">   // We need undo groups to keep only the addresses</span>
<a href="#l14.82"></a><span id="l14.82">   nsresult rv = StripOutGroupNames(buf);</span>
<a href="#l14.83"></a><span id="l14.83">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.84"></a><span id="l14.84"> </span>
<a href="#l14.85"></a><span id="l14.85">   // Ok, now MIME II encode this to prevent 8bit problems...</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

